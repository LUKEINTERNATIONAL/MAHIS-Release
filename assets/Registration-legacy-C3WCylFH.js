System.register(["./index-legacy-CgRFaIIG.js","./ConfirmPrinting-legacy-rLdSBHp6.js","./vendor-legacy-DG-htyL-.js","./BirthRegistration-legacy-Lu5Rlj0m.js","./ncd_appointment_service-legacy-CIcffP5g.js","./lodash-legacy-C-x9g9Na.js","./formatServerData-legacy-hMMRxhJ7.js","./group_validation-legacy-DpYoptwE.js","./vaccines_service-legacy-EP7Et9Nv.js","./app_encounter_service-legacy-Ck3FhT5y.js","./OutcomeModal-legacy-BeI-3iv2.js","./SetRelationship.vue_vue_type_script_lang-legacy-BuL83L9S.js","./relations_service-legacy-NhVHRB5s.js","./relationship_service-legacy-BI-V2aQu.js","./AddVillage-legacy-So-YCoof.js","./DemographicBar-legacy-CwfvTJZ7.js","./SaveProgressModal-legacy-DpXwa7Vl.js","./Stepper-legacy-BmXPNrt_.js","./previousVitals-legacy-C7RGwMxi.js","./apexcharts-legacy-cr31DJB0.js","./SvgDynamicColor-legacy-Cwcw7bqy.js","./patient_complaints_service-legacy-4Z_roHj5.js","./lab_order-legacy-eIec3AV2.js","./UpcomingFeature-legacy-Dk5npnyp.js","./DatePicker.vue_vue_type_script_setup_true_lang-legacy-Ck8Xyzam.js","./vitals_service-legacy-B8czw_Ne.js","./drug_service-legacy-JfEv3znM.js","./drug_prescription_service-legacy-EEZzPHGy.js","./appointment_service-legacy-BB0UYpLn.js","./clinicalDaysStore-legacy-_VKNA6t9.js","./FeatusModal-legacy-DF-1rVSO.js","./diagnosis-legacy-DbmRUhLV.js","./NCDNumber-legacy-Cibp1uVD.js","./sms_service-legacy-TzUgnlck.js","./EIRreportsStore-legacy-CPanI7bt.js","./Export-legacy-7R6WxKZJ.js"],(function(t,e){"use strict";var i,a,n,o,r,s,l,c,d,u,h,p,v,m,g,f,y,b,_,I,D,S,w,x,k,C,L,P,T,R,j,N,H,B,A,M,O,F,U,G,E,z,W,q,$,V,Y,J,K,X,Q,Z,tt,et,it,at,nt,ot,rt,st,lt,ct,dt,ut,ht,pt,vt,mt,gt,ft,yt,bt,_t,It,Dt,St,wt,xt,kt,Ct,Lt,Pt,Tt,Rt,jt,Nt,Ht,Bt,At;return{setters:[t=>{i=t.ah,a=t._,n=t.o,o=t.x,r=t.y,s=t.u,l=t.i,c=t.H,d=t.w,u=t.aa,h=t.ai,p=t.ab,v=t.ad,m=t.S,g=t.g,f=t.a4,y=t.b,b=t.aj,_=t.m,I=t.ak,D=t.t,S=t.al,w=t.am,x=t.A,k=t.F,C=t.E,L=t.P,P=t.C,T=t.r,R=t.I,j=t.an,N=t.s,H=t.p,B=t.n},t=>{A=t.C},t=>{M=t.d,O=t.aa,F=t.U,U=t.T,G=t.ab,E=t.ac,z=t.G,W=t.S,q=t.ad,$=t.E,V=t.y,Y=t.f,J=t.W,K=t.I,X=t.aL,Q=t.c_,Z=t.aM,tt=t.dq,et=t.D,it=t.X,at=t.e,nt=t.m,ot=t.l,rt=t.k,st=t.z,lt=t.B,ct=t.F,dt=t.L,ut=t.A,ht=t.b8,pt=t.ba,vt=t.dt,mt=t.du,gt=t.dv,ft=t.O,yt=t.dw,bt=t.cf,_t=t.dx,It=t.p},t=>{Dt=t._,St=t.B,wt=t.S,xt=t.H,kt=t.C,Ct=t.G,Lt=t.P},t=>{Pt=t.B,Tt=t._,Rt=t.u},t=>{jt=t.l},t=>{Nt=t.f},t=>{Ht=t.v},t=>{Bt=t.g},t=>{At=t.A},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var e=document.createElement("style");e.textContent=".demographics_title[data-v-f1fd3b4e]{font-weight:700;font-size:24px}.gender[data-v-f1fd3b4e]{display:flex;justify-content:space-between;max-width:170px;padding-top:10px}.gender_title[data-v-f1fd3b4e]{margin-top:30px}.demographics_title[data-v-490af540]{font-weight:700;font-size:24px}.gender[data-v-490af540]{display:flex;justify-content:space-between;max-width:170px;padding-top:10px}.gender_title[data-v-490af540]{margin-top:30px}.large-card[data-v-ffb46cdd]{padding:5%;border-radius:15px;border:1px solid #ccc;height:82vh;background-color:#fff;overflow-y:auto;-webkit-box-shadow:0px -2px 19px -2px rgba(196,190,196,1);-moz-box-shadow:0px -2px 19px -2px rgba(196,190,196,1);box-shadow:0 -2px 19px -2px #c4bec4}.header[data-v-ffb46cdd]{display:flex;gap:20px;padding:10px 20px}.position_content[data-v-ffb46cdd]{max-width:100vw}.accordion-expanded[data-v-ffb46cdd]{background-color:#ded}button[aria-expanded=false][data-v-ffb46cdd]{background:rgba(var(--ion-color-rose-rgb),.25)}ion-accordion.accordion-expanding ion-item[slot=header][data-v-ffb46cdd],ion-accordion.accordion-expanded ion-item[slot=header][data-v-ffb46cdd]{--background: #ddeedd}.breadcrumbs[data-v-3fc0b84a]{font-weight:400;font-size:14px;cursor:pointer}ion-toolbar[data-v-3fc0b84a]{--opacity: .5;--background: var(--ion-background-color, #fff)}.header[data-v-3fc0b84a]{color:#000;display:flex;justify-content:space-between;padding:10px 20px}.footer[data-v-3fc0b84a]{color:#000;display:flex;justify-content:space-between;padding:5px 0}ion-breadcrumb ion-icon[data-v-3fc0b84a]{margin-inline:30px}.breadcrumb-active[data-v-3fc0b84a]{color:var(--color)}.active[data-v-3fc0b84a]{color:#00190e;display:flex;height:40px;padding:0 16px;align-items:center;gap:8px}.active .breadcrumb-text[data-v-3fc0b84a]{border-bottom:1px solid #00190e}ion-footer[data-v-3fc0b84a]{border-top:1px solid #e6e6e6}.icon_div[data-v-3fc0b84a]{display:flex;justify-content:space-between;width:70px;position:absolute;right:70px;top:20px}.active_icon[data-v-3fc0b84a]{font-size:25px;background-color:#ded;color:#6fbd70;border-radius:5px}.inactive_icon[data-v-3fc0b84a]{font-size:25px;color:#ccc}.container[data-v-3fc0b84a]{position:relative}.title[data-v-3fc0b84a]{text-align:center;margin-bottom:10px}.demographics_title[data-v-3fc0b84a]{font-weight:700;font-size:22px;padding-top:20px}.demographics[data-v-3fc0b84a]{display:flex;width:unset;justify-content:center}.center_content[data-v-3fc0b84a]{display:flex;justify-content:center}.flex-container[data-v-3fc0b84a]{display:flex;flex-wrap:wrap;gap:10px;padding:10px}.flex-item[data-v-3fc0b84a]{color:#fff;flex:1 1 100px;text-align:center;border-radius:5px;box-sizing:border-box}\n/*$vite$:1*/",document.head.appendChild(e);const Mt=M({name:"Menu",components:{IonContent:q,IonHeader:W,IonItem:z,IonList:E,IonMenu:G,IonTitle:U,IonToolbar:F,BasicCard:Pt},data:()=>({cardData:{},inputField:"",setName:""}),watch:{patientType:{handler(){this.buildCards()},deep:!0}},computed:{...O(i,["patientType"])},props:{editable:{default:!1}},mounted(){this.buildCards()},methods:{buildCards(){this.cardData={mainTitle:"Patient Information",cards:[{cardTitle:"Patient Type",content:this.patientType}]}}}}),Ot=a(Mt,[["render",function(t,e,i,a,n,o){const r=$("basic-card");return Y(),V(r,{content:t.cardData,editable:t.editable},null,8,["content","editable"])}],["__scopeId","data-v-f1fd3b4e"]]),Ft=M({name:"Menu",mixins:[Dt],components:{IonContent:q,IonHeader:W,IonItem:z,IonList:E,IonMenu:G,IonTitle:U,IonToolbar:F,BasicCard:Pt},data:()=>({cardData:{},inputField:"",setName:"",locationData:[]}),computed:{...O(i,["currentLocation","country"]),...O(s,["patient"]),selected_country(){var t;return null===(t=r(this.country,"country","value"))||void 0===t?void 0:t.name},current_district(){var t;return null===(t=r(this.currentLocation,"current_district","value"))||void 0===t?void 0:t.name},current_traditional_authority(){var t;return null===(t=r(this.currentLocation,"current_traditional_authority","value"))||void 0===t?void 0:t.name},current_village(){var t;return null===(t=r(this.currentLocation,"current_village","value"))||void 0===t?void 0:t.name},"Other (specify)"(){return r(this.currentLocation,"Other (specify)","value")}},watch:{currentLocation:{handler(){this.buildCards()},deep:!0},countriesList:{handler(){this.countriesList.length>0&&o(this.country,"country","multiSelectData",this.countriesList)},deep:!0},$route:{async handler(){await this.buildCards(),this.setData()}}},props:{editable:{default:!1}},async mounted(){await this.buildCards(),this.setData()},methods:{setData(){this.setSelectedCountry(),this.editable&&o(this.country,"country","value",{name:"Malawi",district_id:""})},setSelectedCountry(){if(n().setRegSelectedCountry(this.selected_country),"Malawi"===this.selected_country){const t=i();t.setHomeLocation(t.getInitialHomeLocation()),t.setCurrentLocation(t.getInitialCurrentLocation())}},async buildCards(){this.cardData={mainTitle:"Demographics",cards:[{cardTitle:"Country",content:this.country}]}},async handleInputData(t){this.setSelectedCountry()}}}),Ut=a(Ft,[["render",function(t,e,i,a,n,o){const r=$("basic-card");return Y(),V(r,{content:t.cardData,editable:t.editable,"onUpdate:selected":t.handleInputData,"onUpdate:inputValue":t.handleInputData},null,8,["content","editable","onUpdate:selected","onUpdate:inputValue"])}],["__scopeId","data-v-490af540"]]),Gt=M({components:{IonLabel:et,IonAvatar:tt,IonRow:Z,IonImg:Q,IonCol:X,IonList:E,IonItem:z,IonIcon:K,IonButton:J},data:()=>({selectedResult:{},iconsContent:l,isAnyAccordionOpen:!0,isLoading:!1}),methods:{updateAccordionState(t){const e=this.$refs.accordionGroup;this.isAnyAccordionOpen=void 0!==e.value},dismiss(t){it.dismiss(t)},async init(){this.setData(this.deduplicationData[0]||{})},async onSelect(){it.dismiss(this.selectedResult)},setData(t){this.selectedResult=t},dateFormat:t=>c.toStandardHisDisplayFormat(t),probabilityToPercentage:t=>(100*t).toFixed(2)+"%"},props:{deduplicationData:{default:[]},to_be_registered:{default:[]}},mounted(){this.init()},activated(){this.init()}}),Et={key:0,class:"spinner-overlay"},zt={class:"header position_content"},Wt={style:{"font-size":"1.2em","font-weight":"700"}},qt={class:"due_date"},$t={class:"ion-padding",slot:"content"},Vt={style:{display:"flex","justify-content":"end",gap:"10px"}},Yt=a(Gt,[["render",function(t,e,i,a,n,o){const r=$("ion-spinner"),s=$("ion-icon"),l=$("ion-header"),c=$("ion-label"),d=$("ion-item"),u=$("ion-col"),h=$("ion-row"),p=$("ion-accordion"),v=$("ion-accordion-group"),m=$("ion-content"),g=$("ion-button"),f=$("ion-footer");return Y(),at(ct,null,[t.isLoading?(Y(),at("div",Et,[ot(r,{name:"bubbles"}),e[3]||(e[3]=rt("div",{class:"loading-text"},"Please wait...",-1))])):nt("",!0),ot(l,null,{default:st((()=>[rt("div",zt,[rt("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=e=>t.dismiss("back"))},[ot(s,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeft},null,8,["icon"])]),rt("div",Wt,"Matches found: ("+lt(t.deduplicationData.length)+")",1)])])),_:1}),ot(m,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:st((()=>[ot(v,{ref:"accordionGroup",class:"previousView",value:"0",onIonChange:t.updateAccordionState},{default:st((()=>[(Y(!0),at(ct,null,dt(t.deduplicationData,((i,a)=>(Y(),V(p,{style:{"margin-bottom":"15px"},value:a,"toggle-icon-slot":"start",class:"custom_card",button:"",key:a,detail:!0,color:i.value===t.selectedResult.value?"light":"",onClick:e=>t.setData(i)},{default:st((()=>[ot(d,{slot:"header"},{default:st((()=>[ot(c,{class:"previousLabel"},{default:st((()=>{var t,e;return[ut(lt(null==i||null===(t=i.person)||void 0===t?void 0:t.given_name)+" "+lt(null==i||null===(e=i.person)||void 0===e?void 0:e.family_name),1)]})),_:2},1024),rt("div",qt,[e[4]||(e[4]=ut(" Score: ")),rt("b",null,lt(t.probabilityToPercentage(null==i?void 0:i.score)||"-"),1)])])),_:2},1024),rt("div",$t,[ot(h,null,{default:st((()=>[ot(u,null,{default:st((()=>e[5]||(e[5]=[rt("b",null,"To be Registered",-1)]))),_:1,__:[5]}),ot(u,null,{default:st((()=>e[6]||(e[6]=[rt("b",null,"Already Registered",-1)]))),_:1,__:[6]})])),_:1}),ot(h,null,{default:st((()=>[ot(u,null,{default:st((()=>[ot(h,null,{default:st((()=>{var i,a;return[e[7]||(e[7]=ut(" Name: ")),rt("b",null,lt(null===(i=t.to_be_registered)||void 0===i?void 0:i.given_name)+" "+lt(null===(a=t.to_be_registered)||void 0===a?void 0:a.family_name),1)]})),_:1,__:[7]}),ot(h,null,{default:st((()=>{var i;return[e[8]||(e[8]=ut("Gender: ")),rt("b",null,lt(null===(i=t.to_be_registered)||void 0===i?void 0:i.gender),1)]})),_:1,__:[8]}),ot(h,null,{default:st((()=>{var i;return[e[9]||(e[9]=ut("Birthdate: ")),rt("b",null,lt(null===(i=t.to_be_registered)||void 0===i?void 0:i.birthdate),1)]})),_:1,__:[9]}),ot(h,null,{default:st((()=>{var i;return[e[10]||(e[10]=ut("Home District: ")),rt("b",null,lt(null===(i=t.to_be_registered)||void 0===i?void 0:i.home_district),1)]})),_:1,__:[10]}),ot(h,null,{default:st((()=>{var i;return[e[11]||(e[11]=ut("Home TA: ")),rt("b",null,lt(null===(i=t.to_be_registered)||void 0===i?void 0:i.home_traditional_authority),1)]})),_:1,__:[11]})])),_:1}),ot(u,null,{default:st((()=>[ot(h,null,{default:st((()=>{var t,a;return[e[12]||(e[12]=ut(" Name: ")),rt("b",null,lt(null==i||null===(t=i.person)||void 0===t?void 0:t.given_name)+" "+lt(null==i||null===(a=i.person)||void 0===a?void 0:a.family_name),1)]})),_:2,__:[12]},1024),ot(h,null,{default:st((()=>{var t;return[e[13]||(e[13]=ut("Gender: ")),rt("b",null,lt(null==i||null===(t=i.person)||void 0===t?void 0:t.gender),1)]})),_:2,__:[13]},1024),ot(h,null,{default:st((()=>{var a;return[e[14]||(e[14]=ut("Birthdate: ")),rt("b",null,lt(t.dateFormat(null==i||null===(a=i.person)||void 0===a?void 0:a.birthdate)),1)]})),_:2,__:[14]},1024),ot(h,null,{default:st((()=>{var t;return[e[15]||(e[15]=ut("Home District: ")),rt("b",null,lt(null==i||null===(t=i.person)||void 0===t?void 0:t.home_district),1)]})),_:2,__:[15]},1024),ot(h,null,{default:st((()=>{var t;return[e[16]||(e[16]=ut("Home TA: ")),rt("b",null,lt(null==i||null===(t=i.person)||void 0===t?void 0:t.home_traditional_authority),1)]})),_:2,__:[16]},1024)])),_:2},1024)])),_:2},1024)])])),_:2},1032,["value","color","onClick"])))),128))])),_:1},8,["onIonChange"])])),_:1}),ot(f,{collapse:"fade",class:"ion-no-border"},{default:st((()=>[rt("div",Vt,[ot(g,{fill:"solid",color:"secondary",onClick:e[1]||(e[1]=e=>t.dismiss("dismiss"))},{default:st((()=>e[17]||(e[17]=[ut(" Not Duplicate ")]))),_:1,__:[17]}),ot(g,{onClick:e[2]||(e[2]=e=>t.onSelect()),fill:"solid",disabled:!t.isAnyAccordionOpen},{default:st((()=>e[18]||(e[18]=[ut("Select ")]))),_:1,__:[18]},8,["disabled"])])])),_:1})],64)}],["__scopeId","data-v-ffb46cdd"]]),Jt=M({mixins:[Tt,Dt],components:{PatientType:Ot,IonBreadcrumb:mt,IonBreadcrumbs:vt,IonIcon:K,IonContent:q,IonHeader:W,IonMenuButton:pt,IonPage:ht,IonTitle:U,DynamicButton:d,PersonalInformation:Lt,GuardianInformation:Ct,CurrentLocation:kt,Country:Ut,HomeLocation:xt,SocialHistory:wt,BirthRegistration:St},data:()=>({isMilitarySite:!1,ddeId:null,iconListStatus:"active_icon",deduplicationData:"active_icon",iconGridStatus:"inactive_icon",iconsContent:l,demographic:!0,currentStep:"Personal Information",scanner:!1,checkUnderOne:!1,isLoading:!1,checkUnderFourteen:!0,checkUnderNine:!1,checkUnderFive:!1,checkUnderSixWeeks:!1,steps:["Personal Information","Location","Patient Type","Social History","Guardian Information"],disableSaveBtn:!1,workerStore:B()}),props:["registrationType"],computed:{...O(H,["activeProgram"]),...O(n,["NCDUserActions","regSelectedCountry"]),...O(N,["globalPropertyStore"]),...O(i,["personInformation","socialHistory","currentLocation","homeLocation","guardianInformation","country","patientType"]),...O(Rt,["registrationDisplayType"]),...O(j,["birthRegistration"]),...O(y,["apiStatus"]),isPatientTypeRequired(){return 1===this.activeProgram.program_id},patientTypeIsset(){const t=u(this.patientType,"patientType");return`${null!=t?t:""}`.length>=1},nationalID(){return r(this.personInformation,"nationalID","value")},birthID(){return r(this.birthRegistration,"Serial Number","value")},firstname(){return r(this.personInformation,"firstname","value")},lastname(){return r(this.personInformation,"lastname","value")},phoneNumber(){return r(this.personInformation,"phoneNumber","value")},gender(){return u(this.personInformation,"gender")},birthdate(){return c.toStandardHisFormat(r(this.personInformation,"birthdate","value"))},guardianFirstname(){return r(this.guardianInformation,"guardianFirstname","value")},guardianLastname(){return r(this.guardianInformation,"guardianLastname","value")},guardianMiddleName(){return r(this.guardianInformation,"guardianMiddleName","value")},guardianPhoneNumber(){return r(this.guardianInformation,"guardianPhoneNumber","value")},relationship(){return r(this.guardianInformation,"relationship","value")},current_district(){var t;return null===(t=r(this.currentLocation,"current_district","value"))||void 0===t?void 0:t.name},current_traditional_authority(){var t;return null===(t=r(this.currentLocation,"current_traditional_authority","value"))||void 0===t?void 0:t.name},current_village(){var t;return null===(t=r(this.currentLocation,"current_village","value"))||void 0===t?void 0:t.name},"Other (specify)"(){return r(this.currentLocation,"Other (specify)","value")}},async mounted(){T(),this.setIconClass(),this.disableNationalIDInput(),this.checkAge()},watch:{personInformation:{handler(){const t=i();t.setPersonalInformation(this.personInformation),t.setSocialHistory(this.socialHistory),t.setHomeLocation(this.homeLocation),t.setCurrentLocation(this.currentLocation),t.setGuardianInformation(this.guardianInformation),this.checkAge(),this.disableNationalIDInput();const e=i();1===this.programID()&&(t.clearSocialHistoryOccupations(),R.isProp("military_site=true").then((t=>{this.isMilitarySite=t,this.isMilitarySite?(e.setOccupationAsMandatory(),e.setSocialHistoryMilitaryOccupations()):(e.setOccupationNotMandatory(),e.setSocialHistoryOccupations())})))},deep:!0},$route:{async handler(t){this.currentStep="Personal Information",t.name.includes("registration")&&(T(),i().setGuardianInformation(this.guardianInformation)),await this.getLocationData(),o(this.country,"country","multiSelectData",this.countriesList),o(this.currentLocation,"current_district","multiSelectData",this.districtList),o(this.homeLocation,"home_district","multiSelectData",this.districtList)},deep:!0}},setup:()=>({arrowForwardCircle:_t,grid:bt,list:yt}),methods:{async cancel(t){await P("Do you want to cancel registration?","",{confirmBtnLabel:"Yes",icon:"",showBackdrop:!0})&&this.nav("/home")},programID:()=>m.getProgramID(),isEligibleForOccupation(){return ft(m.getSessionDate()).diff(this.birthdate,"years")>=18},async getRegion(t){if(t){let e=[];for(let i of[1,2,3]){if((i=1)&&(e=await this.getDistricts(i)),e.some((e=>e.name.trim()===t)))return"Central Region";if((i=2)&&(e=await this.getDistricts(i)),e.some((e=>e.name.trim()===t)))return"Northern Region";if((i=3)&&(e=await this.getDistricts(i)),e.some((e=>e.name.trim()===t)))return"Southern Region";if((i=4)&&(e=await this.getDistricts(i)),e.some((e=>e.name.trim()===t)))return"Foreign"}}},checkAge(){jt.isEmpty(this.birthdate)||(this.checkUnderFourteen=c.getAgeInYears(this.birthdate)>=14,this.checkUnderNine=c.ageInMonths(this.birthdate)<9,this.checkUnderFive=c.getAgeInYears(this.birthdate)<5,this.checkUnderSixWeeks=c.dateDiffInDays(c.sessionDate(),this.birthdate)<42)},disableNationalIDInput(){"manual"==this.registrationType?o(this.personInformation,"nationalID","displayNone",!0):o(this.personInformation,"nationalID","displayNone",!1)},setCurrentStep(t){this.currentStep=t},nav(t){this.$router.push(t)},async nextStep(){this.checkUnderFourteen||this.checkUnderFive?this.steps=["Personal Information","Location","Patient Type","Social History","Guardian Information"]:this.steps=["Personal Information","Location","Patient Type","Guardian Information"],this.steps=this.steps.reduce(((t,e)=>"Patient Type"!==e||this.isPatientTypeRequired?[...t,e]:t),[]);const t=this.steps.indexOf(this.currentStep);if(t<this.steps.length-1)if("Personal Information"===this.currentStep){const e=["nationalID","firstname","lastname","birthdate","gender"];await this.validations(this.personInformation,e)?this.currentStep=this.steps[t+1]:D("Please fill fileds correctly before you proceed!")}else if("Location"===this.currentStep){const e=["current_district","current_traditional_authority","current_village"];await this.validations(this.currentLocation,e)&&await Ht(this.homeLocation)||"Malawi"!=this.regSelectedCountry?this.currentStep=this.steps[t+1]:D("Please fill fileds correctly before you proceed!")}else if("Social History"===this.currentStep&&this.isMilitarySite&&this.isEligibleForOccupation()){if(!u(this.socialHistory,"occupation"))return D("Occupation is required");this.currentStep=this.steps[t+1]}else if("Patient Type"===this.currentStep&&this.isPatientTypeRequired){if(!this.patientTypeIsset)return D("Patient type is required!");this.currentStep=this.steps[t+1]}else"Social History"===this.currentStep&&(this.checkUnderFive||this.checkUnderOne?await Ht(this.birthRegistration)?this.currentStep=this.steps[t+1]:D("Please fill fileds correctly before you proceed!"):this.currentStep=this.steps[t+1])},previousStep(){const t=this.steps.indexOf(this.currentStep);t>0&&(this.currentStep=this.steps[t-1])},async findPatient(t){const e=await L.findByID(t);await s().setPatientRecord(e),this.setURLs(t)},validateGaudiarnInfo(){return!!this.checkUnderFourteen||Ht(this.guardianInformation)},async validations(t,e){return e.every((e=>C(t,e,this[e])))},async validateLocation(){return"Malawi"!=this.regSelectedCountry||!(!(await Ht(this.homeLocation))||!(await Ht(this.currentLocation)))},async possibleDuplicates(){try{const e=new k;if(this.deduplicationData=await e.checkPotentialDuplicates(gt(this.personInformation[0].selectedData)),this.deduplicationData.length>0){const i=await g(Yt,{class:"fullScreenModal"},!0,{to_be_registered:gt(this.personInformation[0].selectedData),deduplicationData:this.deduplicationData});if("dismiss"!=i&&"back"!=i){var t;const a=await e.importPatient(null==i||null===(t=i.person)||void 0===t?void 0:t.id);return await this.findPatient(a.patient_id),!0}return"back"==i}return!1}catch(e){return!1}},async createPatient(){var t;if(!0===I()){const t=["nationalID","firstname","lastname","birthdate","gender"],e=r(this.currentLocation,"closestLandmark","value");if(null==e||e.name,this.isPatientTypeRequired&&!this.patientTypeIsset)return D("Please complete all required fields");if(!u(this.socialHistory,"occupation")&&this.isMilitarySite&&this.isEligibleForOccupation())return D("Occupation is required");if(await this.validations(this.personInformation,t)&&await this.validateLocation()&&await this.validateBirthData()&&this.validateGaudiarnInfo())try{const t=await S();if(!t){if(0==await w())return;return D("DDE IDs are not available in MODS. patient creation will procede without DDE ID."),void(await this.proceedWithPatientCreation(!0))}this.ddeId=t.npid,await this.proceedWithPatientCreation(!0)}catch(n){return void _("DDE IDs are not available. Please connect to the server to sync the IDs.")}else D("Please complete all required fields");return}const e=await x("dde").then((t=>null==t?void 0:t[0]));let i=!1;var a;if(((null==e||null===(t=e.ids)||void 0===t?void 0:t.length)>0||this.apiStatus)&&(this.ddeId=(null==e||null===(a=e.ids[0])||void 0===a?void 0:a.npid)||"",i=!0),i){const t=["nationalID","firstname","lastname","birthdate","gender"],i=r(this.currentLocation,"closestLandmark","value");if(null==i||i.name,this.isPatientTypeRequired&&!this.patientTypeIsset)return D("Please complete all required fields");u(this.socialHistory,"occupation"),await this.validations(this.personInformation,t)&&await this.validateLocation()&&await this.validateBirthData()&&this.validateGaudiarnInfo()?await this.proceedWithPatientCreation(!1,e):D("Please complete all required fields")}else _("DDE IDs are not available. Please connect to the server to sync the IDs.")},async proceedWithPatientCreation(t=!1,e=null){var i,a;if(await this.buildPersonalInformation(),this.disableSaveBtn=!0,this.isLoading=!0,!t&&"true"===this.globalPropertyStore.dde_enabled&&this.apiStatus&&await this.possibleDuplicates())return this.disableSaveBtn=!1,void(this.isLoading=!1);if(0===Object.keys(this.personInformation[0].selectedData).length)return;const n=await this.buildPatientRecord();if(!t&&(null==e||null===(i=e.ids)||void 0===i?void 0:i.length)>0&&(e.ids=e.ids.slice(1),this.workerStore.postData("OVERRIDE_OBJECT_STORE",{storeName:"dde",data:e})),!t&&(this.apiStatus&&33!=this.programID()&&32!=this.programID()||this.apiStatus&&(null==e||!e.ids))){this.workerStore.postData("SYNC_DDE");const t=await m.postJson("/save_patient_record",{record:n}),e=u(this.patientType,"patientType");if(e){const i=new At(t.patientID,5,-1);await i.createEncounter(),await i.saveValueCodedObs("Type of patient",e)}await s().setPatientRecord(t),this.workerStore.postData("SYNC_ALL_DATA"),this.disableSaveBtn=!1,await this.printBarcode(),await this.setURLs(t.patientID)}else t||!t&&(null==e||null===(a=e.ids)||void 0===a?void 0:a.length)>0?(y().syncingTotal=y().syncingTotal+1,s().setRecord(n),await this.workerStore.postData("ADD_OBJECT_STORE",{storeName:"patientRecords",data:n}),this.isLoading=!1,this.disableSaveBtn=!1,await this.printBarcode(),t&&(null==n.patientID&&b({record:n}),this.workerStore.postData("SYNC_ALL_DATA")),32==this.programID()?this.$router.push("/NCDEnrollment"):this.$router.push("/patientProfile")):_("DDE IDs are not available. Please connect to the server to sync the IDs.")},async printBarcode(){"dismiss"!==await g(A,{class:"small-confirm-modal "})&&(new f).printData("barcode")},async buildPatientRecord(){var t;const e=r(this.birthRegistration,"Weight","value");let i={saved:[],unsaved:[]};e&&(i.unsaved=[{concept_id:5089,obs_datetime:c.sessionDate(),value_numeric:e}]);const a=this.personInformation[0].selectedData.birthdate,n=this.personInformation[0].selectedData.gender;return{patientID:this.ddeId,ID:this.ddeId,NcdID:"",program_id:m.getProgramID()||null,location_id:localStorage.getItem("locationID"),provider_id:localStorage.getItem("userID"),encounter_datetime:(new Date).toISOString(),personInformation:gt(this.personInformation[0].selectedData),guardianInformation:{saved:[],unsaved:[gt(this.guardianInformation[0].selectedData)]},birthRegistration:gt(await Nt(this.birthRegistration)),otherPersonInformation:{nationalID:this.validatedNationalID(),birthID:this.validatedBirthID(),relationshipID:null===(t=r(this.guardianInformation,"relationship","value"))||void 0===t?void 0:t.id},vitals:i,vaccineSchedule:await Bt(n,a),vaccineAdministration:{orders:[],obs:[],voided:[]},appointments:{saved:[],unsaved:[]},saveStatusPersonInformation:"pending",saveStatusGuardianInformation:"pending",saveStatusBirthRegistration:"pending",saveStatusVitals:"pending",date_created:"",creator:"",sync_status:"unsynced"}},checkWeightForAge(t,e){let i=!1;return(t>=0&&t<1&&e>=.5&&e<=13.1||t>=1&&t<2&&e>13.1&&e<=15||t>=2&&t<3&&e>15&&e<=20.9||t>=3&&t<4&&e>20.9&&e<=24.1||t>=4&&t<5&&e>24.1&&e<=28)&&(i=!0),i},async validateBirthData(){return!this.checkUnderNine||(this.checkWeightForAge(c.getAgeInYears(this.birthdate),r(this.birthRegistration,"Weight","value"))?Ht(this.birthRegistration):!!(await v(`Do you want to continue with this weight (${r(this.birthRegistration,"Weight","value")}) for age (${c.getAgeInYears(this.birthdate)})`)))},validatedNationalID(){return""==this.nationalID||r(this.personInformation,"nationalID","alertsErrorMassage")?"":this.nationalID},validatedBirthID(){return""==this.birthID||r(this.birthRegistration,"Serial Number","alertsErrorMassage")?"":this.birthID},async setURLs(t=""){await h(),this.isLoading=!1,this.disableSaveBtn=!1;let e="";e=32==this.programID()&&this.apiStatus?(await p.userProgramData(t)).url:"/patientProfile",this.$router.push(e)},patientIdentifier(t){const e=t.patient_identifiers.length-1;return e>=0?t.patient_identifiers[e].identifier:""},async buildPersonalInformation(){var t,e,i,a,n,o,s,l;const c=null===(t=r(this.currentLocation,"closestLandmark","value"))||void 0===t?void 0:t.name,d=r(this.currentLocation,"Other (specify)","value"),h="Other"===c?d:c;this.personInformation[0].selectedData={given_name:r(this.personInformation,"firstname","value"),middle_name:r(this.personInformation,"middleName","value"),family_name:r(this.personInformation,"lastname","value"),gender:this.gender,birthdate:r(this.personInformation,"birthdate","value"),birthdate_estimated:"false",home_region:await this.getRegion(null===(e=r(this.homeLocation,"home_district","value"))||void 0===e?void 0:e.name)||await this.getRegion(null===(i=r(this.country,"country","value"))||void 0===i?void 0:i.name),home_district:null===(a=r(this.homeLocation,"home_district","value"))||void 0===a?void 0:a.name,home_traditional_authority:null===(n=r(this.homeLocation,"home_traditional_authority","value"))||void 0===n?void 0:n.name,home_village:null===(o=r(this.homeLocation,"home_village","value"))||void 0===o?void 0:o.name,current_region:await this.getRegion(this.current_district),current_district:this.current_district,current_traditional_authority:this.current_traditional_authority,current_village:this.current_village,country:null===(s=r(this.country,"country","value"))||void 0===s?void 0:s.name,landmark:h,cell_phone_number:r(this.personInformation,"phoneNumber","value"),occupation:u(this.socialHistory,"occupation"),marital_status:u(this.socialHistory,"maritalStatus"),religion:null===(l=r(this.socialHistory,"religion","value"))||void 0===l?void 0:l.name,education_level:u(this.socialHistory,"highestLevelOfEducation")}},setDisplayType(t){Rt().setRegistrationDisplayType(t),this.setIconClass()},setIconClass(){this.iconListStatus="inactive_icon",this.iconGridStatus="inactive_icon","list"==this.registrationDisplayType?this.iconListStatus="active_icon":"grid"==this.registrationDisplayType&&(this.iconGridStatus="active_icon")}}}),Kt={key:0,class:"spinner-overlay"},Xt={class:"header position_content"},Qt={style:{display:"flex","align-items":"center"}},Zt={class:"container"},te={class:"title"},ee={class:"demographics_title"},ie={class:"icon_div displayNoneMobile"},ae={key:0,class:"center_content"},ne={key:0,class:"flex-container"},oe={class:"flex-item"},re={class:"flex-item"},se={class:"flex-item"},le={key:1},ce={key:0},de={key:1},ue={style:{"justify-content":"center"}},he={key:0},pe={key:1},ve={key:2},me={key:3},ge={key:4},fe={key:1,class:"footer2"},ye={class:"footer position_content"};t("default",a(Jt,[["render",function(t,e,i,a,n,o){const r=$("ion-spinner"),s=$("ion-icon"),l=$("ion-header"),c=$("PersonalInformation"),d=$("Country"),u=$("CurrentLocation"),h=$("HomeLocation"),p=$("PatientType"),v=$("SocialHistory"),m=$("BirthRegistration"),g=$("GuardianInformation"),f=$("ion-content"),y=$("DynamicButton"),b=$("ion-breadcrumb"),_=$("ion-breadcrumbs"),I=$("ion-footer"),D=$("ion-page");return Y(),V(D,{class:It({loading:t.isLoading})},{default:st((()=>[t.isLoading?(Y(),at("div",Kt,[ot(r,{name:"bubbles"}),e[11]||(e[11]=rt("div",{class:"loading-text"},"Please wait...",-1))])):nt("",!0),ot(l,null,{default:st((()=>[rt("div",Xt,[rt("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=e=>t.nav("/home"))},[ot(s,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeft},null,8,["icon"]),e[12]||(e[12]=rt("span",{style:{"padding-left":"10px"}},"Go back",-1))]),e[14]||(e[14]=rt("div",null,null,-1)),rt("div",Qt,[ot(s,{slot:"separator",size:"large",icon:t.iconsContent.help},null,8,["icon"]),e[13]||(e[13]=rt("span",{style:{"padding-left":"10px"}}," Need any help?",-1))])])])),_:1}),ot(f,null,{default:st((()=>[rt("div",Zt,[rt("div",te,[rt("div",ee,"New "+lt(33!=t.programID()?"patient":"client")+" registration",1)]),rt("div",ie,[ot(s,{class:It(t.iconListStatus),icon:t.list,onClick:e[1]||(e[1]=e=>t.setDisplayType("list"))},null,8,["class","icon"]),ot(s,{class:It(t.iconGridStatus),style:{"font-size":"21px","margin-top":"1.5px"},icon:t.grid,onClick:e[2]||(e[2]=e=>t.setDisplayType("grid"))},null,8,["class","icon"])])]),"grid"==t.registrationDisplayType&&t.screenWidth>991?(Y(),at("div",ae,["grid"==t.registrationDisplayType?(Y(),at("div",ne,[rt("div",oe,[ot(c)]),rt("div",re,[ot(d),"Malawi"==t.regSelectedCountry?(Y(),V(u,{key:0})):nt("",!0),"Malawi"==t.regSelectedCountry?(Y(),V(h,{key:1})):nt("",!0)]),rt("div",se,[t.isPatientTypeRequired?(Y(),V(p,{key:0})):nt("",!0),t.checkUnderFourteen?(Y(),V(v,{key:1})):nt("",!0),t.checkUnderNine?(Y(),V(m,{key:2})):nt("",!0),ot(g)])])):nt("",!0)])):nt("",!0),"list"==t.registrationDisplayType||t.screenWidth<=991?(Y(),at("div",le,["Personal Information"==t.currentStep?(Y(),at("div",ce,[ot(c)])):nt("",!0),"Location"==t.currentStep?(Y(),at("div",de,[rt("div",ue,[rt("div",null,[ot(d)]),"Malawi"==t.regSelectedCountry?(Y(),at("div",he,[ot(u)])):nt("",!0),"Malawi"==t.regSelectedCountry?(Y(),at("div",pe,[ot(h)])):nt("",!0)])])):nt("",!0),"Patient Type"==t.currentStep&&t.isPatientTypeRequired?(Y(),at("div",ve,[ot(p)])):nt("",!0),"Social History"==t.currentStep?(Y(),at("div",me,[t.checkUnderFourteen?(Y(),V(v,{key:0})):nt("",!0),t.checkUnderFive?(Y(),V(m,{key:1})):nt("",!0)])):nt("",!0),"Guardian Information"==t.currentStep?(Y(),at("div",ge,[ot(g)])):nt("",!0)])):nt("",!0)])),_:1}),"grid"==t.registrationDisplayType&&t.screenWidth>991?(Y(),at("div",fe,[ot(y,{name:"Save",iconSlot:"end",icon:t.iconsContent.saveWhite,disabledValue:t.disableSaveBtn,onClick:e[3]||(e[3]=e=>t.createPatient())},null,8,["icon","disabledValue"])])):nt("",!0),"list"==t.registrationDisplayType||t.screenWidth<=991?(Y(),V(I,{key:2},{default:st((()=>[rt("div",ye,["Personal Information"==t.currentStep?(Y(),V(y,{key:0,name:"Cancel",color:"danger",onClick:e[4]||(e[4]=e=>t.cancel(e))})):(Y(),V(y,{key:1,name:"Previous",icon:t.iconsContent.arrowLeftWhite,color:"medium",onClick:t.previousStep},null,8,["icon","onClick"])),ot(_,{class:"breadcrumbs displayNoneMobile"},{default:st((()=>[ot(b,{onClick:e[5]||(e[5]=e=>t.setCurrentStep("Personal Information")),class:It({active:"Personal Information"===t.currentStep})},{separator:st((()=>[ot(s,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])])),default:st((()=>[e[15]||(e[15]=rt("span",{class:"breadcrumb-text"},"Personal Information",-1))])),_:1,__:[15]},8,["class"]),ot(b,{onClick:e[6]||(e[6]=e=>t.setCurrentStep("Location")),class:It({active:"Location"===t.currentStep})},{separator:st((()=>[ot(s,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])])),default:st((()=>[e[16]||(e[16]=rt("span",{class:"breadcrumb-text"},"Location",-1))])),_:1,__:[16]},8,["class"]),t.isPatientTypeRequired?(Y(),V(b,{key:0,onClick:e[7]||(e[7]=e=>t.setCurrentStep("Patient Type")),class:It({active:"Patient Type"===t.currentStep})},{separator:st((()=>[ot(s,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])])),default:st((()=>[e[17]||(e[17]=rt("span",{class:"breadcrumb-text"},"Patient Type",-1))])),_:1,__:[17]},8,["class"])):nt("",!0),ot(b,{onClick:e[8]||(e[8]=e=>t.setCurrentStep("Social History")),class:It({active:"Social History"===t.currentStep})},{separator:st((()=>[ot(s,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])])),default:st((()=>[e[18]||(e[18]=rt("span",{class:"breadcrumb-text"},"Social History",-1))])),_:1,__:[18]},8,["class"]),ot(b,{onClick:e[9]||(e[9]=e=>t.setCurrentStep("Guardian Information")),class:It({active:"Guardian Information"===t.currentStep})},{separator:st((()=>[ot(s,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])])),default:st((()=>[e[19]||(e[19]=rt("span",{class:"breadcrumb-text"},"Guardian Information",-1))])),_:1,__:[19]},8,["class"])])),_:1}),"Guardian Information"==t.currentStep?(Y(),V(y,{key:2,name:"Save",iconSlot:"end",icon:t.iconsContent.saveWhite,onClick:e[10]||(e[10]=e=>t.createPatient())},null,8,["icon"])):(Y(),V(y,{key:3,name:"Next",disabledValue:!1,iconSlot:"end",icon:t.iconsContent.arrowRightWhite,onClick:t.nextStep},null,8,["icon","onClick"]))])])),_:1})):nt("",!0)])),_:1},8,["class"])}],["__scopeId","data-v-3fc0b84a"]]))}}}));

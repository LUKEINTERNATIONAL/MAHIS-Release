System.register(["./report_service-legacy-BE7jg1JT.js","./index-legacy-BbTdUV_o.js","./vendor-legacy-90IlaDvi.js","./lodash-legacy-C-x9g9Na.js"],(function(e,t){"use strict";var l,a,r,o,n,i,u,s,d,c,p,y,f,m,v,h,b,g,D,w,B,A,R,S,F,C,_,x,E,M,T,k,P,j,$,q,H,I,N,L;return{setters:[e=>{l=e.g,a=e.a,r=e.D},e=>{o=e.s,n=e.f,i=e.g,u=e.p,s=e.e,d=e.d,c=e.a,p=e.i,y=e.m,f=e.r},e=>{m=e.ae,v=e.cK,h=e.d,b=e.r,g=e.c,D=e.ey,w=e.y,B=e.f,A=e.u,R=e.aP,S=e.z,F=e.l,C=e.aO,_=e.m,x=e.aN,E=e.c8,M=e.A,T=e.k,k=e.B,P=e.aM,j=e.ez,$=e.eA,q=e.cR,H=e.L,I=e.j,N=e.eB},e=>{L=e.l}],execute:function(){var t=document.createElement("style");function V(e="person_id",t=m()){return{label:"view client",icon:v,color:"light",action:l=>t.push(`/patient/${l[e]}`)}}t.textContent=".no-data-table{height:55vh!important}\n/*$vite$:1*/",document.head.appendChild(t),e({g:V,t:function(e,t={}){return Array.isArray(e)?e.map((e=>({label:e,path:e,drillable:!0,sortable:!0,...t}))):Object.entries(e).map((([e,l])=>({path:e,label:l,drillable:!0,sortable:!1,...t})))}}),e("_",h({__name:"ReportTable",props:{title:{type:String,default:"Report"},subtitle:{type:String,default:""},period:{type:String,default:""},date:{type:String,default:""},quarter:{type:Object,default:()=>({})},totalClients:{type:Array},columns:{type:Array,default:()=>[]},rows:{type:Array,default:()=>[]},asyncRows:{type:Function},actionButtons:{type:Array,default:()=>[]},rowActionButtons:{type:Array,default:()=>[]},canExportCsv:{type:Boolean,default:!0},canExportPDF:{type:Boolean,default:!0},useSecureExport:{type:Boolean,default:!1},showRefreshButton:{type:Boolean,default:!0},useDateRangeFilter:{type:Boolean,default:!1},useQuarterFilter:{type:Boolean,default:!1},useDateFilter:{type:Boolean,default:!1},customFilters:{type:Array,default:()=>[]},showIndices:{type:Boolean,default:!1},filename:{type:String,default:""},reportType:{type:String,default:""},drillTitle:{type:Function,default:()=>"Drill-down table"},customDrillColumns:{type:Array},drillRowParser:{type:Function},customDrillHandler:{type:Function},showDrillSelectButton:{type:Boolean,default:!0}},emits:["generate"],setup(e,{emit:t}){const m=t,v=e,h=b({}),O=b({}),Q=g((()=>o(`\n  ${v.reportType} \n  ${n().facilityName} \n  ${(v.filename||v.title).replace(v.reportType,"")} \n  ${v.period?v.period:v.date}\n`))),U=g((()=>{const e=[...v.customFilters];return v.useDateRangeFilter?(e.push({id:"startDate",label:"Start Date",type:"date",placeholder:"Start Date",slotName:"datePicker",value:v.period.split("-")[0]}),e.push({id:"endDate",label:"End Date",placeholder:"End Date",type:"date",slotName:"datePicker",value:v.period.split("-")[1]})):v.useQuarterFilter?e.push({id:"quarter",label:"Quarter:",type:"select",value:v.quarter,options:i(10).map((e=>({label:e.name,value:e.name,other:e})))}):v.useDateFilter&&e.push({id:"date",label:"Date",type:"date",slotName:"datePicker",value:v.date}),e})),z=g((()=>{var e,t;const r=[...v.actionButtons];return v.canExportCsv&&r.push(l(Q.value,null===(e=v.quarter)||void 0===e?void 0:e.label,v.period)),v.canExportPDF&&r.push(a(Q.value,v.useSecureExport,null===(t=v.quarter)||void 0===t?void 0:t.label,v.period)),v.showRefreshButton&&r.push({label:"Refresh/Rebuild",icon:D,color:"primary",action:()=>{if(L.isEmpty(O.value))return c("Invalid filters");m("generate",O.value,!0)}}),r})),G=g((()=>{var e;return null!==(e=v.customDrillColumns)&&void 0!==e?e:[{path:"identifier",label:"ARV Number",preSort:u,initialSort:!0},{path:"birthdate",label:"Date of Birth",formatter:s},{path:"gender",label:"Gender",formatter:d}]}));function K(e){if("startDate"in e&&"endDate"in e){const{startDate:t,endDate:l}=h.value;if(!p(t,l))return c("Invalid date range");e.startDate=t,e.endDate=l,e.dateRange={startDate:t,endDate:l}}if("date"in e){if(L.isEmpty(h.value.date))return c("Invalid date");e.date=h.value.date}if(function(e){return U.value.every((t=>!1===t.required||!L.isEmpty(e[t.id])&&("object"!=typeof e[t.id]||Object.values(e[t.id]).every(Boolean))))}(e))return O.value=e,m("generate",e,!1);c("Invalid filters")}function J(e){return e.preventDefault(),W({row:{clients:v.totalClients},column:{path:"clients",label:"Total Clients"}})}async function W(e){var t,o;if("function"==typeof v.customDrillHandler)return v.customDrillHandler(e);const n=v.drillTitle(e),i=b([]);return async function(e,t){if("function"==typeof v.drillRowParser)t.push(...await v.drillRowParser(e));else{const r=L.get(e.row,e.column.path,[]);for(const e of L.chunk(r,100)){var l,a;const r=await N.getAll(e);if(!r.ok)return c(null!==(l=r.errorMessage)&&void 0!==l?l:"Unable to load patient data");t.push(...null!==(a=r.data)&&void 0!==a?a:[])}}}(e,i.value),y.show(r,{title:n,columns:G.value,rows:i.value,rowActionButtons:v.showDrillSelectButton?[V("person_id",f)]:[],actionButtons:[l(n,null===(t=v.quarter)||void 0===t?void 0:t.label,v.period),a(n,!1,null===(o=v.quarter)||void 0===o?void 0:o.label,v.period)]})}return(t,l)=>(B(),w(A(R),{style:{padding:"0 !important"}},{default:S((()=>[F(A(C),{style:{"border-bottom":"1px solid #c2c2c2","font-weight":"500",color:"#000"}},{default:S((()=>{var t;return[F(A(x),{innerHTML:e.title},null,8,["innerHTML"]),e.subtitle?(B(),w(A(E),{key:0,innerHTML:e.subtitle,style:{color:"#818181"}},null,8,["innerHTML"])):_("",!0),null!==(t=e.totalClients)&&void 0!==t&&t.length?(B(),w(A(E),{key:1},{default:S((()=>[l[0]||(l[0]=M(" Total Clients: ")),T("a",{href:"#",onClick:J},k(e.totalClients.length),1)])),_:1,__:[0]})):_("",!0)]})),_:1}),F(A(P),{class:"ion-no-padding",style:{"padding-bottom":"30px","min-height":"55vh"}},{default:S((()=>[F(A(j),{rows:e.rows,"async-rows":e.asyncRows,columns:e.columns,"actions-buttons":z.value,"row-actions-buttons":e.rowActionButtons,"custom-filters":U.value,config:{showIndices:e.showIndices},onCustomFilter:K,onDrilldown:W,color:"light"},$({datePicker:S((({filter:e})=>{var t,l;return[F(A(q),{modelValue:h.value[e.id],"onUpdate:modelValue":t=>h.value[e.id]=t,"enable-time-picker":!1,"model-type":"dd/MMM/yyyy",format:"dd/MMM/yyyy",placeholder:null!==(t=null!==(l=e.placeholder)&&void 0!==l?l:e.label)&&void 0!==t?t:"Select Date","auto-apply":"","text-input":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])]})),_:2},[H(t.$slots,((e,l)=>({name:l,fn:S((({filter:e})=>[I(t.$slots,l,{filter:{filter:e}})]))})))]),1032,["rows","async-rows","columns","actions-buttons","row-actions-buttons","custom-filters","config"])])),_:3})])),_:3}))}}))}}}));

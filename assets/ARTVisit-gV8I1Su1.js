import{d as ae,ct as oe,aS as le,aI as ie,r as s,w as se,O as u,f as o,J as l,l as a,u as e,eQ as re,k as C,ac as ue,a7 as ce,e as v,F as M,P as O,dA as g,ad as de,a2 as fe,L as m,eR as me,d$ as pe,eM as ve,K as V,bU as ge,M as W,G,N as B,Q as E,e9 as ye,aP as K,aM as U,m as z,ew as _e,bN as be,bP as ke,cK as we,eS as xe,aa as he,R as Ie}from"./vendor-CwRShy1a.js";import{S as Q,u as Te,P as J,T as Ce,bJ as Se,s as A,bi as Pe,ai as Y,Z as Ne,bK as De,l as Re,bL as Be,a8 as Ee,_ as Ae}from"./index-DOaVu21k.js";import{i as Fe,a as Le}from"./tasks-BT_aQiRX.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-B7MGi37O.js";class S extends Q{constructor(){super()}static nextTask(y){return super.getJson("/workflows/".concat(super.getProgramID(),"/").concat(y),{date:super.getSessionDate()})}static async getNextTaskParams(y,P=""){let d=P;try{if(!d){const{name:k}=await S.nextTask(y);d=k}}catch(k){d=""}return{name:d.toLowerCase(),params:{patient_id:y}}}}const $e={key:0,class:"ion-padding"},Me={key:2,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},Oe={class:"ion-page",id:"main"},Ve={key:0,class:"ion-padding"},We={key:1},Ge={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}},Ke={style:{color:"black"}},Ue=ae({__name:"ARTVisit",setup(ze){const y=oe(),P=Te(),{patient:d}=le(P),k=new J,F=ie(),f=s(-1),h=s(null),c=s([]),L=s([]),I=s(!1),w=s(!1),N=s(-1),_=s(""),x=s(""),Z=s(""),D=s(!1),T=s(null);function j(n){var t;return L.value.includes((t=n==null?void 0:n.encounterTypeID)!=null?t:0)}function R(n){var t;return n?!w.value&&N.value===(n==null?void 0:n.encounterTypeID)||((t=n==null?void 0:n.otherWorkflowNames)!=null?t:[]).includes(_.value):!1}async function q(){const n=await Pe.getEncounters(d.value.patientID,{date:S.getSessionDate()});L.value=n.map(t=>t.encounter_type)}async function $(){var n,t;D.value=(n=Q.isBDE())!=null?n:!1,Z.value="",w.value=!0,x.value="",_.value="";try{const r=await S.nextTask(d.value.patientID);if(!r){x.value="No workflows found. You may exit this page or refresh",w.value=!1,f.value=-1;return}_.value=r.name,N.value=(t=r==null?void 0:r.encounter_type_id)!=null?t:-1;const i=c.value.findIndex(p=>{var b;return(p==null?void 0:p.encounterTypeID)===N.value||((b=p.otherWorkflowNames)!=null?b:[]).includes(_.value)});i!==-1||(x.value=_.value?'"'.concat(_.value,'" is not available in the current workflow. Contact your administrator or update ART activity selection'):"No next task found"),f.value=i}catch(r){x.value="An error has occured while loading next task: "+r,console.error(r)}finally{await q(),w.value=!1}}async function H(){f.value=-1,c.value=[],I.value=!0;try{const n=Y.map(async t=>{if(!(typeof t.disabled=="function"&&t.disabled(Y))){if(t.workflowID&&t.component){if(!await Fe(t.workflowID)||!await Le(t.workflowID))return}else return;return t}});c.value=(await Promise.all(n)).filter(t=>t!==void 0),X()}catch(n){A("Unable to load activities"),console.error(n)}finally{I.value=!1}}async function X(){if(await Ne.isProp("".concat(De.FILING_NUMBERS,"=true"))){if(k.patient=await J.findByID(d.value.patientID),!/n\/a/i.test(k.getFilingNumber()))return;Re(Ee,{},!1,{title:"New filing number assignment",useComponent:Be,onClose:()=>{Ie.dismiss()}})}}function ee(){if(D.value)if(T.value){if(!T.value.isProviderSelected()){A("Please select a provider"),T.value.openModal();return}}else{A("BDE Provider component is not available");return}return h.value&&typeof h.value.onSubmit=="function"?h.value.onSubmit():Promise.resolve(!0)}function te(){ee().then(n=>n&&$())}function ne(n){if(n<0||n>=c.value.length)return;const t=c.value[n];t&&R(t)&&(f.value=n)}return se(()=>y.fullPath,()=>{H().then($)},{immediate:!0,deep:!0}),(n,t)=>(o(),u(e(he),null,{default:l(()=>[a(Ce),a(e(re),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:l(()=>{var r;return[a(e(ue),{contentId:"main"},{default:l(()=>[a(e(ce),null,{default:l(()=>[I.value?(o(),v("div",$e,[(o(),v(M,null,O(5,i=>a(e(g),{key:i,animated:"",style:{height:"60px","margin-bottom":"10px","border-radius":"8px"}})),64))])):c.value.length>0?(o(),u(e(de),{key:1},{default:l(()=>[(o(!0),v(M,null,O(c.value,(i,p)=>(o(),u(e(fe),{onClick:b=>ne(p),lines:"none",key:p,disabled:!R(i),button:""},{default:l(()=>{var b;return[j(i)?(o(),u(e(m),{key:0,icon:e(me),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):R(i)?(o(),u(e(m),{key:2,icon:e(ve),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(o(),u(e(m),{key:1,icon:e(pe),style:{padding:"10px"},slot:"start"},null,8,["icon"])),C("b",null,V((b=i.displayName)!=null?b:i.name),1)]}),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(o(),v("div",Me,[a(e(m),{style:{"font-size":"2rem"},icon:e(ge)},null,8,["icon"]),t[2]||(t[2]=C("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),a(e(W),null,{default:l(()=>[a(e(G),{color:"light"},{default:l(()=>[a(e(B),{onClick:t[0]||(t[0]=i=>e(F).back())},{default:l(()=>[a(e(m),{icon:e(ye),slot:"start"},null,8,["icon"]),t[3]||(t[3]=E(" Back to dashboard "))]),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),C("div",Oe,[w.value||I.value?(o(),v("div",Ve,[a(e(K),null,{default:l(()=>[a(e(U),null,{default:l(()=>[a(e(g),{animated:"",style:{height:"40px","margin-bottom":"20px"}}),a(e(g),{animated:"",style:{height:"20px",width:"80%","margin-bottom":"15px"}}),a(e(g),{animated:"",style:{height:"20px",width:"60%","margin-bottom":"15px"}}),a(e(g),{animated:"",style:{height:"60px","margin-bottom":"20px"}}),a(e(g),{animated:"",style:{height:"20px",width:"70%","margin-bottom":"15px"}}),a(e(g),{animated:"",style:{height:"20px",width:"50%","margin-bottom":"15px"}})]),_:1})]),_:1})])):(r=c.value[f.value])!=null&&r.component?(o(),v("div",We,[a(e(K),null,{default:l(()=>[a(e(U),null,{default:l(()=>{var i;return[D.value?(o(),u(Se,{key:0,ref_key:"bdeProviderComponent",ref:T},null,512)):z("",!0),(o(),u(_e,null,[(o(),u(be((i=c.value[f.value])==null?void 0:i.component),{ref_key:"formRef",ref:h},null,512))],1024))]}),_:1})]),_:1})])):(o(),v("div",Ge,[a(e(m),{style:{color:"green","font-size":"80px"},icon:e(ke)},null,8,["icon"]),C("h2",Ke,V(x.value),1),a(e(B),{size:"large",fill:"clear",onClick:t[1]||(t[1]=i=>e(F).back())},{default:l(()=>[a(e(m),{slot:"start",icon:e(we)},null,8,["icon"]),t[4]||(t[4]=E(" Exit page "))]),_:1,__:[4]})])),a(e(W),null,{default:l(()=>[a(e(G),{color:"light"},{default:l(()=>[f.value>=0?(o(),u(e(B),{key:0,onClick:te,color:"primary",style:{padding:"4px"},slot:"end"},{default:l(()=>[t[5]||(t[5]=E(" Save and continue ")),a(e(m),{style:{padding:"4px"},icon:e(xe),slot:"end"},null,8,["icon"])]),_:1,__:[5]})):z("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),qe=Ae(Ue,[["__scopeId","data-v-9a619323"]]);export{qe as default};

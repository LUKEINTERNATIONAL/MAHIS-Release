System.register(["./vendor-legacy-B___aDYJ.js","./useFormWizard-legacy-BD51HXrr.js","./index-legacy-bIC3wV2f.js","./DemographicBar-legacy-Dv0w-XU2.js","./OPDOutcome-legacy-D9_Rp3qF.js","./NextAppointment-legacy-Bi4fDF-a.js","./OPDPrintingModal-legacy-D61ZPYr2.js","./lodash-legacy-pOOc9Efu.js","./usePatientProfile-legacy-C3pdxdBO.js","./Outcome-legacy-Dnj3_yTr.js","./apexcharts-legacy-CV868ovh.js","./patient_complaints_service-legacy-DDRph2ju.js","./DashBox-legacy-Cc3dOSJV.js","./useExposeFromStandardForm-legacy-DOW4Jd1Y.js","./BasicForm-legacy-DEPtPNbH.js","./DateInputField-legacy-Dzz08_4c.js","./formatServerData-legacy-D7-O0OGa.js","./drug_prescription_service-legacy-BWV_zs4p.js","./drug_service-legacy-CBVI2lHq.js","./lab_order-legacy-B-YPaxra.js","./group_validation-legacy-BMyq9ZGf.js","./ncd_appointment_service-legacy-DzESfrSw.js","./Registration-legacy-bHNdLrG-.js","./useLocation-legacy-CcS_Ku5p.js","./vaccines_service-legacy-CSyPhOud.js","./sms_service-legacy-BlnIn7d5.js","./EIRreportsStore-legacy-Ba-6Mqyh.js","./Export-legacy-BhFfdsKR.js"],function(e,a){"use strict";var t,n,l,i,s,o,r,u,c,d,v,m,g,p,y,f,h,b,w,_,P,x,D,O,j,I,A,N,S,T,C,k,F,E,L,R,B,z,M,H,U,G,W,$,J,Q,Z,q,V,X,Y,K,ee,ae,te,ne,le,ie,se,oe,re,ue,ce,de,ve,me,ge;return{setters:[e=>{t=e.d,n=e.ar,l=e.cm,i=e.r,s=e.a$,o=e.c,r=e.a,u=e.w,c=e.y,d=e.f,v=e.z,m=e.l,g=e.e,p=e.m,y=e.k,f=e.u,h=e.bN,b=e.d6,w=e.ah,_=e.i,P=e.bG,x=e.v,D=e.an,O=e.dJ,j=e.bg},e=>{I=e.u,A=e._},e=>{N=e.u,S=e.aA,T=e.aO,C=e.a1,k=e.c,F=e.aC,E=e.M,L=e.a2,R=e.aP,B=e.aQ,z=e.aG,M=e.T,H=e.D,U=e.t,G=e.y,W=e.m,$=e.a9,J=e.E,Q=e.H,Z=e.aD,q=e.ay,V=e.aR,X=e.S,Y=e.k,K=e._},e=>{ee=e.D},e=>{ae=e.C,te=e.O,ne=e.a,le=e.b},e=>{ie=e.I,se=e.N,oe=e.s,re=e.a,ue=e.d,ce=e.b},e=>{de=e.O},e=>{ve=e.l},e=>{me=e.u},e=>{ge=e.S},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".disabled[data-v-dda9e993]{color:red}.spinner-overlay[data-v-dda9e993]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-dda9e993]{width:80px;height:80px}.loading-text[data-v-dda9e993]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-dda9e993]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-dda9e993]{pointer-events:none}.back_profile[data-v-dda9e993]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(a);const pe={key:0,class:"spinner-overlay"},ye={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},fe={class:"back_profile"};e("default",K(t({__name:"ConsultationPlan",setup(e){const{currentTabIndex:a}=I("Consultation Plan"),{printVisitSummary:t}=me(),K=n(),he=l(),be=i(!1),we=i(!0),_e=i(!1),Pe=i(!1),xe=i(!0),De=i(!1),Oe=i(!1),je=i(!1),Ie=N(),Ae=S(),Ne=T(),Se=C(),Te=k(),Ce=F(),ke=E(),Fe=L(),Ee=R(),Le=B(),{patient:Re}=s(Ie),{investigations:Be}=s(Ae),{OPDdiagnosis:ze}=s(Ne),{selectedMedicalDrugsList:Me,nonPharmalogicalTherapyAndOtherNotes:He}=s(Se),{OPDActivities:Ue}=s(Te),{outcomes:Ge}=s(Ce),{currentSelectedNextAppointmentDate:We}=s(Ee),{presentingComplaints:$e}=s(Le),{vitals:Je}=s(Fe),Qe=z(),Ze=o(()=>Qe.selectedMedicalAllergiesList),qe=i(null),Ve=i(null),Xe=i(null),Ye=i(null),Ke=i(null),ea=i(null),aa=i(null),ta=()=>Ue.value.map(e=>({title:e,icon:""})),na=i(ta()),la=i({}),ia=async(e,t,n)=>{0===t&&await va(),await ua()?(await ca(),e%1==0&&(a.value=e),aa.value&&n&&aa.value.changeTab(e)):U("Please add presenting complaints before proceeding.")},sa=()=>{var e;if(!na.value||0===na.value.length)return null;const t=a.value>=0&&a.value<na.value.length?a.value:0;switch(null===(e=na.value[t])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(Ue.value.length>0)switch(Ue.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},oa=async()=>{Pe.value=!0,G("Printing consultation summary... Please wait.");try{await t(),G("Consultation summary printed successfully!"),setTimeout(()=>{K.push("home")},3500)}catch(e){W("Failed to print consultation summary.")}finally{Pe.value=!1}},ra=()=>{G("Patient has finished consultation!"),K.push("home")},ua=async()=>{const e=await $.getObsByEncounterIdAndDate(J.PRESENTING_COMPLAINTS);return!!(e&&e.length>0)},ca=async()=>{const e=Q.sessionDate();for(let t=0;t<na.value.length;t++)if(await ua()){we.value=!0,_e.value=!1;const n=na.value[t];if(la.value={title:"Untitled"},"Clinical Assessment"===n.title){const a=Z("presentingComplaints");na.value[t].icon=da(e,a)?j:""}else if("Investigations"===n.title){var a;const n=null===(a=Re.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,l=null==n?void 0:n.filter(a=>Q.toStandardHisFormat(e)===Q.toStandardHisFormat(a.order_date));na.value[t].icon=(null==l?void 0:l.length)>0?j:""}else if("Diagnosis"===n.title){const a=Z("diagnosis");na.value[t].icon=da(e,a)?j:""}else if("Treatment Plan"===n.title){const e=Z("treatment");na.value[t].icon=(null==e?void 0:e.length)>0?j:""}else if("Next Appointment"===n.title){const a=Z("appointments");na.value[t].icon=da(e,a)?j:""}else if("Outcome"===n.title){const e=Z("outcomes");na.value[t].icon=(null==e?void 0:e.length)>0?j:""}}else we.value=!1,"Clinical Assessment"!==na.value[t].title&&(na.value[t].icon=O)},da=(e,a)=>{if(!a)return!1;const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime||e.order_date);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},va=async()=>{be.value=!0;try{var e;await ma(),await Promise.all([null===(e=qe.value)||void 0===e?void 0:e.onSubmit()]),await q(Re.value),V()}catch(a){throw console.error("Error saving clinical assessment:",a),W("Failed to save clinical assessment"),a}finally{be.value=!1}},ma=async()=>{try{if(!ve.isEmpty(Ze.value)){const e=ga();await oe(e)}}catch(e){console.error("Failed to save allergies:",e),U("Failed to save allergies")}},ga=()=>Ze.value.map(e=>({concept_id:985,obs_datetime:X.getSessionDate(),value_coded:e.concept_id,location_id:ke.facilityLocation.code})),pa=async()=>{try{var e;null!==(e=Xe.value)&&void 0!==e&&e.onSubmit(),await(async()=>{try{if(!ve.isEmpty(He.value)){const e=[{concept_id:2688,obs_datetime:localStorage.getItem("sessionDate"),value_text:He.value,location_id:ke.facilityLocation.code}];await re(e)}await ue(),await ce().saveNonPharmaTherapyPatientData()}catch(e){console.error("Failed to save treatment plan:",e),U("Failed to save treatment plan")}})(),await Ce.saveOutcomPatientData(),await V(),await q(Re.value);const a=localStorage.getItem("locationID"),t=localStorage.getItem("userRoles");if(!a)return void W("Location ID could not be found. Please check your settings.");const n=t?JSON.parse(t):[];n.some(e=>"Lab"===e.role)?(await ge.movePatientToNextStage(Re.value.patientID,"LAB","CONSULTATION",a,Re.value.visitID||Re.value.visit_id),await Y().refresh(a),await K.push("home"),G("Lab results submitted. Patient can return to consultation")):(await ge.movePatientToNextStage(Re.value.patientID,"CONSULTATION","DISPENSATION",a,Re.value.visitID||Re.value.visit_id),await Y().refresh(a),await K.push("home"),G("Consultation patient saved successfully."))}catch(a){console.error("Error saving consultation data:",a),W("Failed to save consultation data")}};return r(async()=>{0!==Ue.value.length?(na.value=ta(),await ca(),(void 0===a.value||a.value<0)&&(a.value=0)):await K.push("home")}),u(Je,async()=>{await ca()},{deep:!0}),u(Re,async()=>{await ca()},{deep:!0}),u(Be,async()=>{await ca()},{deep:!0}),u(ze,async()=>{await ca()},{deep:!0}),u(Me,async()=>{await ca()},{deep:!0}),u(Ge,async()=>{await ca()},{deep:!0}),u(We,async()=>{await ca()}),u($e,async()=>{await ca()},{deep:!0}),u(he,async()=>{xe.value=!1,setTimeout(()=>{a.value=0,xe.value=!0},0)},{deep:!0}),u(je,e=>{Oe.value=e,Oe.value&&setTimeout(()=>{Oe.value=!1},15e3)}),(e,a)=>(d(),c(f(D),null,{default:v(()=>[m(de,{onYes:oa,onNo:ra,isOpen:De.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),be.value?(d(),g("div",pe,[m(f(h),{name:"bubbles"}),a[2]||(a[2]=y("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),m(f(b),{"is-open":Pe.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),m(M),m(f(w),{fullscreen:!0},{default:v(()=>[m(ee),y("div",ye,[xe.value?(d(),c(A,{key:0,ref_key:"wizard",ref:aa,"vertical-tabs":"","navigable-tabs":we.value,"scrollable-tabs":"",startIndex:0,doneButton:{text:"Finish",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},nextButton:{disabled:_e.value},"custom-tabs":na.value,tabs:na.value,onChange:ia,"onComplete:wizard":a[1]||(a[1]=e=>pa())},{default:v(()=>[y("div",null,[y("div",fe,[m(H,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:f(P),"font-weight":"600",onClick:a[0]||(a[0]=e=>{K.push("home")})},null,8,["icon"])])]),_(y("div",null,[m(ae,{ref_key:"clinicalAssessmentRef",ref:qe},null,512)],512),[[x,"ClinicalAssessment"===sa()]]),_(y("div",null,[m(ie,{ref_key:"investigationsRef",ref:Ve},null,512)],512),[[x,"Investigations"===sa()]]),_(y("div",null,[m(te,{ref_key:"diagnosisRef",ref:Xe},null,512)],512),[[x,"OPDDiagnosis"===sa()]]),_(y("div",null,[m(ne,{ref_key:"treatmentPlanRef",ref:Ye},null,512)],512),[[x,"OPDTreatmentPlan"===sa()]]),_(y("div",null,[m(se,{ref_key:"nextAppointmentRef",ref:Ke},null,512)],512),[[x,"NextAppointment"===sa()]]),_(y("div",null,[m(le,{ref_key:"outcomeRef",ref:ea},null,512)],512),[[x,"Outcome"===sa()]])]),_:1},8,["navigable-tabs","nextButton","custom-tabs","tabs"])):p("",!0)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-dda9e993"]]))}}});

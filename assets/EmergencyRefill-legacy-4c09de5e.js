System.register(["./vendor-legacy-b155b5ab.js","./index-legacy-d7d54202.js","./adherence_service-legacy-c26089ae.js","./LocationFieldOptions-legacy-d7f91380.js","./lodash-legacy-78c9f2a0.js","./apexcharts-legacy-d546c9db.js","./chartjs-legacy-11371d29.js","./barcode-qrcode-reader-legacy-b9a6bf31.js"],(function(e,l){"use strict";var t,a,n,i,r,d,o,u,c,s,f,m,g,_,p,y,v,b,h,x,A,D,w,j,O,V,q,F,I,k,P,$,E,H,S,U,C,L;return{setters:[e=>{t=e.d,a=e.cF,n=e.r,i=e.a,r=e.e,d=e.y,o=e.z,u=e.l,c=e.x,s=e.aI,f=e.aJ,m=e.j,g=e.aK,_=e.be,p=e.aL,y=e.aM,v=e.D,b=e.A,h=e.B,x=e.bj,A=e.f,D=e.F,w=e.J,j=e.G,O=e.b7,V=e.V,q=e.aH,F=e.N},e=>{I=e.a,k=e.A,P=e.c,$=e.j,E=e.t,H=e.k,S=e.b,U=e._},e=>{C=e.A},e=>{L=e.g},null,null,null,null],execute:function(){var l=document.createElement("style");l.textContent=".section-header ion-label[data-v-e5e911b4]{font-size:1rem;font-weight:600;letter-spacing:.5px;color:var(--ion-color-primary);text-transform:uppercase}.drug-item[data-v-e5e911b4]{border:1px solid #eee;border-radius:8px;margin-bottom:10px;padding:10px}.error[data-v-e5e911b4]{color:red;font-weight:700;font-style:italic}\n",document.head.appendChild(l);const z={class:"ion-padding",style:{"border-bottom":"dashed #ccc"}},M={class:"error"},N={class:"ion-padding",style:{"border-bottom":"dashed #ccc"}},R={class:"error"},Y={class:"ion-padding",style:{"border-bottom":"dashed #ccc"}},B={class:"error"},G={class:"ion-padding",style:{"border-bottom":"dashed #ccc"}},J={class:"error"},Q={class:"ion-padding"};e("default",U(t({__name:"EmergencyRefill",setup(e){const l=new I,t=new k(l.getID(),25,-1,""),U=new C(l.getID(),t.providerID),T=a({date_of_emergency_refill:"",facility:"",drugs:[],next_appointment:"",selectedFacilityObj:null}),K=n({}),W=n([]),X={date_of_emergency_refill:{required:()=>!0,dataHandler:e=>{T.date_of_emergency_refill=e},validation:async()=>{var e;if(!T.date_of_emergency_refill)return void(K.value.date_of_emergency_refill="Date is required");if(F(T.date_of_emergency_refill).isAfter(F()))return void(K.value.date_of_emergency_refill="Date cannot be in the future");const l=null===(e=U.getLastDrugs())||void 0===e||null===(e=e[0])||void 0===e||null===(e=e.order)||void 0===e?void 0:e.start_date;l&&F(T.date_of_emergency_refill).isBefore(l)&&await $(`Date entered is less than last known dispensation of ${F(l).format("DD-MMM-YYYY")}`)},buildObs:()=>t.buildValueDate("Prescription refill date",T.date_of_emergency_refill)},facility:{required:()=>!0,dataHandler:e=>{T.facility=e.label,T.selectedFacilityObj=e},searchFacilities:e=>L(e).then((e=>W.value=e)),validation:()=>{T.facility||(K.value.facility="Facility is required")},buildObs:()=>t.buildValueText("Health facility name",T.facility)},drugs:{required:()=>!0,dataHandler:e=>{"remainingAmount"===e.field?T.drugs[e.index].other.remainingAmount=e.value:"givenAmount"===e.field&&(T.drugs[e.index].other.givenAmount=e.value)},validation:()=>{T.drugs.some((e=>!e.other.remainingAmount||!e.other.givenAmount))&&(K.value.drugs="Please enter both remaining and given amounts for all drugs")},buildObs:()=>T.drugs.map((async e=>{const l=U.calculateAdherence(e.other.drug.quantity,e.other.remainingAmount,function(e){const l=e=>`${e}`.match(/qod/i)?"QOD":`${e}`.match(/weekly/i)?"QW":e;return U.calculateExpected(e.quantity,e.equivalent_daily_dose,e.order.start_date,l(e.frequency))}(e.other.drug));return{...await U.buildValueCoded("Medications dispensed",e.value),child:[await U.buildPillCountObs(e.other.drug.order_id,e.other.remainingAmount),await U.buildAdherenceObs(e.other.drug.order_id,e.other.drug.drug_id,l,T.date_of_emergency_refill),await U.buildValueNumber("Amount of drug dispensed",e.other.givenAmount)]}}))},next_appointment:{required:()=>!0,dataHandler:e=>{T.next_appointment=e},validation:()=>{T.next_appointment?T.date_of_emergency_refill&&F(T.next_appointment).isBefore(T.date_of_emergency_refill)&&(K.value.next_appointment="Next appointment date must be after emergency refill date"):K.value.next_appointment="Next appointment date is required"},buildObs:()=>t.buildValueDate("Appointment date",T.next_appointment)}};function Z(e,l){e in X&&"function"==typeof X[e].dataHandler&&X[e].dataHandler(l),ee(e)}function ee(e){K.value[e]="","function"!=typeof X[e].required||!X[e].required()||T[e]?T[e]&&"function"==typeof X[e].validation&&X[e].validation():K.value[e]="This field is required"}async function le(){if(Object.keys(X).forEach((e=>ee(e))),Object.keys(K.value).some((e=>`${K.value[e]}`.length>=1)))return E("Please review form for errors");try{if(!(await t.createEncounter()))return H("Failed to create encounter");const e=await Promise.all(Object.keys(T).reduce(((e,l)=>{if(l in X&&T[l]&&"function"==typeof X[l].buildObs){const t=X[l].buildObs();return Array.isArray(t)?[...e,...t]:[...e,t]}return e}),[]));await t.saveObservationList(e),S("Emergency refill saved successfully")}catch(e){console.error("Error saving emergency refill data:",e),H("Failed to save emergency refill data")}}return i((async()=>{await async function(){await U.loadPreviousDrugs(),T.drugs=U.getLastDrugs().map((e=>({label:e.drug.name,value:e.drug.concept_id,other:{givenAmount:"",remainingAmount:"",drug:e}})))}()})),(e,l)=>(r(),d(c(q),null,{default:o((()=>[u(c(s),null,{default:o((()=>[u(c(f),null,{default:o((()=>l[5]||(l[5]=[m("span",{class:"section-header ion-text-center",style:{"margin-bottom":"10px"}},[m("h2",null,"Emergency Refill"),m("hr",{style:{"border-top":"1px dashed #0c0c0c","margin-top":"10px"}})],-1)]))),_:1,__:[5]})])),_:1}),u(c(g),null,{default:o((()=>[m("div",z,[u(c(_),null,{default:o((()=>[u(c(p),null,{default:o((()=>[u(c(y),null,{default:o((()=>[u(c(v),null,{default:o((()=>l[6]||(l[6]=[b("Date of emergency refill")]))),_:1,__:[6]}),u(P,{place_holder:"Select date",onDateUpDated:l[0]||(l[0]=e=>Z("date_of_emergency_refill",`${e.value.year}-${e.value.month}-${e.value.day}`)),date_prop:""}),m("div",M,h(K.value.date_of_emergency_refill),1)])),_:1})])),_:1})])),_:1})]),m("div",N,[u(c(_),null,{default:o((()=>[u(c(p),null,{default:o((()=>[u(c(y),null,{default:o((()=>[u(c(x),{modelValue:T.selectedFacilityObj,"onUpdate:modelValue":[l[1]||(l[1]=e=>T.selectedFacilityObj=e),l[2]||(l[2]=e=>Z("facility",e))],multiple:!1,taggable:!1,"close-on-select":!0,openDirection:"bottom","tag-placeholder":"Find and select facility",placeholder:"Select facility where emergency refill was collected",selectLabel:"",label:"label",searchable:!0,"track-by":"label",onSearchChange:l[3]||(l[3]=e=>X.facility.searchFacilities(e)),options:W.value},null,8,["modelValue","options"]),m("div",R,h(K.value.facility),1)])),_:1})])),_:1})])),_:1})]),m("div",Y,[u(c(v),null,{default:o((()=>l[7]||(l[7]=[b("Emergency Supply Drugs")]))),_:1,__:[7]}),(r(!0),A(D,null,w(T.drugs,((e,l)=>(r(),A("div",{key:l,class:"drug-item"},[u(c(_),null,{default:o((()=>[u(c(p),null,{default:o((()=>[u(c(y),{size:"12"},{default:o((()=>[u(c(j),{lines:"none"},{default:o((()=>[u(c(v),null,{default:o((()=>[b(h(e.label),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),u(c(p),null,{default:o((()=>[u(c(y),{size:"6"},{default:o((()=>[u(c(O),{modelValue:e.other.remainingAmount,"onUpdate:modelValue":l=>e.other.remainingAmount=l,onIonInput:e=>Z("drugs",{index:l,field:"remainingAmount",value:e.detail.value}),placeholder:"Pills Remaining",label:"Pills Remaining","label-placement":"stacked",type:"number",fill:"outline"},null,8,["modelValue","onUpdate:modelValue","onIonInput"])])),_:2},1024),u(c(y),{size:"6"},{default:o((()=>[u(c(O),{modelValue:e.other.givenAmount,"onUpdate:modelValue":l=>e.other.givenAmount=l,onIonInput:e=>Z("drugs",{index:l,field:"givenAmount",value:e.detail.value}),placeholder:"Pills Given",label:"Pills Given","label-placement":"stacked",type:"number",fill:"outline"},null,8,["modelValue","onUpdate:modelValue","onIonInput"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])))),128)),m("div",B,h(K.value.drugs),1)]),m("div",G,[u(c(_),null,{default:o((()=>[u(c(p),null,{default:o((()=>[u(c(y),null,{default:o((()=>[u(c(v),null,{default:o((()=>l[8]||(l[8]=[b("Next Appointment Date")]))),_:1,__:[8]}),u(P,{place_holder:"Select next appointment date",onDateUpDated:l[4]||(l[4]=e=>Z("next_appointment",`${e.value.year}-${e.value.month}-${e.value.day}`)),date_prop:""}),m("div",J,h(K.value.next_appointment),1)])),_:1})])),_:1})])),_:1})]),m("div",Q,[u(c(V),{color:"primary",onClick:le},{default:o((()=>l[9]||(l[9]=[b("Submit")]))),_:1,__:[9]})])])),_:1})])),_:1}))}}),[["__scopeId","data-v-e5e911b4"]]))}}}));

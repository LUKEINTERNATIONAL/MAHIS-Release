import{a4 as T,ah as I,ai as X,aj as Y,S as Z,ak as tt,al as Q,t as L,_ as w,am as et,P as $}from"./index-7qwbP5UI.js";import{aG as W,r as J,bA as C,X as x,d as S,c as it,a as K,e as f,f as b,k as t,j as nt,m as lt,d1 as at,ds as st,dt,y as P,z as D,B as n,A as v,u as ot,F as rt,L as ut,du as ct,dv as vt}from"./vendor-8nEYVyB7.js";import{l as F}from"./lodash-Dt8AsbQm.js";const p=J(!1);function _(){C.getTop().then(e=>e?C.dismiss():null)}async function gt(){const e=new T;let s=await e.getDefaultPrinter();if(F.isEmpty(s)&&(s=await e.selectDefaultPrinter()),F.isEmpty(s))throw new Error("No printer device found");return s}async function bt(e,s){const a=I.updateUrlParamString(s,{raw:!0});X.emit(Y.SHOW_MODAL,"zebra-modal");const d=await Z.getText(a);if(!d)throw"Unable to print Label. Try again later";if((e==null?void 0:e.port)==="BT")return new T().printToBluetoothDevice(e,d);W.printLabel({eplCommands:d,name:e.name,address:e.address,url:await tt.expandPath(a)}),await Q(2e3)}async function mt(e,s,a){var l,o,r,u,c;if(p.value)return;p.value=!0;let d={};await(await C.create({message:"Processing label...",backdropDismiss:!1})).present();try{if(typeof a.onGenerateProps=="function")d=await a.onGenerateProps();else if(typeof a.lblUrl=="string")d=await T.getJson(I.removeParams(a.lblUrl),I.extractParams(a.lblUrl));else{p.value=!1,console.error("No generation parameters provided"),L("No label generation parameters specified!"),_();return}_();const g=await x.create({id:"printout",component:s,backdropDismiss:!1,cssClass:"small-modal",componentProps:{...(l=d==null?void 0:d.data)!=null?l:d}});await g.present();const{data:m}=await g.onWillDismiss(),h=(o=a.copies)!=null?o:1;for(let y=0;y<h;++y)await W.printLabel({address:e.address,name:e.name,eplCommands:(r=d.zpl)!=null?r:"",height:(u=a.scaleHeight)!=null?u:0,width:(c=a.scaleWidth)!=null?c:562,image:m.generatedLabelImage&&a.useImage!==!1?m.generatedLabelImage:void 0});p.value=!1}catch(g){p.value=!1,console.error(g),_(),x.getTop().then(m=>m?x.dismiss():null),L("An error occurred while generating label")}}async function k(e,s){const a=await gt();return/Browser/i.test(a.address)||a.port==="BT"?bt(a,s.lblUrl):mt(a,e,s)}const ft=["id"],yt={id:"img-canvas"},pt={key:0,class:"print-section ion-text-center vertically-align"},ht=["id"],wt=50,St=S({__name:"PrintLabel",props:{id:String,width:Number,height:Number},emits:["labelOutput"],setup(e,{emit:s}){const a=s,d=e,i=J(!1),l=it(()=>"".concat(d.id).concat(new Date().toISOString()));function o(){const r=document.getElementById(l.value);r&&st(r,{scale:7,backgroundColor:"#ffffff"}).then(function(u){try{const c=u.toDataURL("image/png"),g=document.getElementById("".concat([l.value],"-image"));g.src=c,i.value=!0,a("labelOutput",c),Q(wt).then(()=>dt.dismiss({generatedLabelImage:c},void 0,"printout"))}catch(c){console.error(c)}})}return K(()=>setTimeout(()=>o(),80)),(r,u)=>(b(),f("div",null,[t("div",{id:l.value,class:"label-canvas"},[nt(r.$slots,"default",{},void 0,!0)],8,ft),t("div",yt,[i.value?lt("",!0):(b(),f("div",pt,u[0]||(u[0]=[at('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve" data-v-d8afb20c><metadata data-v-d8afb20c> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata><g data-v-d8afb20c><g transform="translate(0.000000,511.000000) scale(0.100000,-0.100000)" data-v-d8afb20c><path d="M2918.3,4119.3c-303-51.3-610.8-284.4-753-568.8c-102.6-212.1-125.9-359-125.9-822.9v-380h-533.8c-575.8,0-720.3-16.3-899.8-104.9c-237.8-116.6-454.6-410.3-491.9-669l-14-109.6l258.8-128.2l258.8-130.5H5000h4382.5l258.7,130.5l258.8,128.2l-14,109.6c-37.3,261.1-247.1,550.1-487.2,666.7c-184.2,90.9-324,107.2-904.5,107.2h-533.8v380c0,463.9-23.3,610.8-125.9,822.9c-142.2,286.7-435.9,508.2-757.6,568.8C6927.8,4147.2,3088.5,4147.2,2918.3,4119.3z M7158.6,3776.6c79.3-25.6,156.2-81.6,256.4-179.5c216.8-216.8,219.1-230.8,219.1-1102.6v-729.6H5000H2365.8v729.6c0,871.8,2.3,885.8,219.1,1102.6c233.1,230.8,51.3,214.5,2405.7,216.8C6850.9,3816.2,7053.7,3811.5,7158.6,3776.6z" data-v-d8afb20c></path><path d="M109.3-267.9l7-1382.3l74.6-153.8c90.9-184.2,258.7-349.7,445.2-435.9c130.5-60.6,146.9-62.9,692.3-74.6l559.5-11.7l14-338c11.7-275.1,23.3-361.3,65.3-466.2c163.2-401,484.9-671.4,909.1-757.6c146.9-32.6,452.2-35,2202.9-30.3c2030.4,7,2030.4,7,2184.3,58.3c363.7,123.5,643.4,396.3,773.9,752.9c37.3,95.6,51.3,209.8,60.6,454.6l14,326.4l559.5,11.7l561.8,11.7l153.9,76.9c191.2,93.2,366,277.4,442.9,466.2l53.6,132.9l7,1370.7l7,1370.7l-209.8-107.2l-212.1-104.9H5000H524.3l-212.1,104.9l-209.8,107.2L109.3-267.9z M1107,121.4c207.5-107.2,167.8-435.9-60.6-498.9c-104.9-28-186.5-7-263.4,69.9C701.4-225.9,678.1-121,720.1-20.8C785.4,137.7,955.5,200.7,1107,121.4z M7487.3-368.1c139.9-42,223.8-128.2,268.1-275.1c23.3-72.3,30.3-370.7,30.3-1181.9c0-1079.3,0-1084-53.6-1216.8c-76.9-188.8-251.8-373-442.9-466.2l-156.2-76.9H5000H2867l-156.2,76.9c-191.1,93.2-366,277.4-442.9,466.2c-53.6,130.6-53.6,149.2-60.6,1135.3c-7,1046.7,4.7,1244.8,88.6,1382.3c51.3,86.3,135.2,144.5,240.1,167.8c39.6,11.7,1144.6,18.7,2454.7,21C7053.7-333.2,7384.7-337.8,7487.3-368.1z M1125.7-766.7c65.3-44.3,121.2-151.5,121.2-230.8c0-79.3-55.9-186.5-121.2-230.8c-67.6-48.9-216.8-46.6-298.4,2.4c-172.5,100.2-167.8,368.3,4.7,466.2C906.6-720.1,1062.8-722.5,1125.7-766.7z" data-v-d8afb20c></path><path d="M3149.1-927.6c-60.6-62.9-67.6-130.5-18.7-195.8l44.3-60.6h1708.7h1708.7l44.3,60.6c48.9,65.3,42,132.9-18.7,195.8c-32.6,30.3-251.8,35-1734.4,35C3400.9-892.6,3181.7-897.3,3149.1-927.6z" data-v-d8afb20c></path><path d="M3149.1-1860c-60.6-62.9-67.6-130.5-18.7-195.8l44.3-60.6h1708.7h1708.7l44.3,60.6c48.9,65.3,42,132.9-18.7,195.8c-32.6,30.3-251.8,35-1734.4,35C3400.9-1825.1,3181.7-1829.7,3149.1-1860z" data-v-d8afb20c></path><path d="M3149.1-2792.5c-60.6-62.9-67.6-130.5-18.7-195.8l44.3-60.6h1708.7h1708.7l44.3,60.6c48.9,65.3,42,132.9-18.7,195.8c-32.6,30.3-251.8,35-1734.4,35C3400.9-2757.5,3181.7-2762.2,3149.1-2792.5z" data-v-d8afb20c></path></g></g></svg>',1)]))),t("img",{src:"",id:"".concat(l.value,"-image")},null,8,ht)])]))}}),A=w(St,[["__scopeId","data-v-d8afb20c"]]),xt={id:"container"},_t={style:{display:"flex","justify-content":"space-between",width:"100%"}},It={style:{background:"black","font-weight":"bold",color:"white",padding:"1.7px"}},Lt={style:{width:"100%"}},$t={style:{display:"flex","justify-content":"space-between",width:"100%"}},Ct={style:{display:"flex","justify-content":"space-between","border-bottom":"3px solid black",width:"100%"}},Tt={style:{width:"100%","text-align":"center"}},Pt={style:{"text-align":"right"}},Dt=S({__name:"ArtVisitLbl",props:{visit_by:{type:String},date:{type:String},arv_number:{type:String},patient_details:{type:String},height:{type:String},weight:{type:String},bmi:{type:String},viral_load:{type:String},outcome_date:{type:String},outcome:{type:String},next_appointment_date:{type:String},seen_by:{type:String},se:{type:String},tb_status:{type:String},adherence:{type:String},drugs:{type:Object}},emits:["label-out"],setup(e,{emit:s}){const a=s;return(d,i)=>(b(),P(A,{id:"visit-summary",onLabelOutput:i[0]||(i[0]=l=>a("label-out",l))},{default:D(()=>{var l,o;return[t("div",xt,[t("div",_t,[t("span",null,[t("b",null,n(e.date),1)]),t("span",null,"("+n((l=e.visit_by)!=null?l:"??")+")",1),t("span",It,n(e.arv_number),1)]),t("div",Lt,[t("span",null,[t("b",null,n(e.patient_details),1)]),i[1]||(i[1]=t("span",null,[t("b",null," :Patient visit")],-1))]),t("div",$t,[t("span",null,n(e.weight)+"kg",1),t("span",null,n(e.height)+"cm",1),t("span",null,[i[2]||(i[2]=t("b",null,"BMI:",-1)),v(n(e.bmi),1)]),t("span",null,[i[3]||(i[3]=t("b",null,"VL:",-1)),v(n(e.viral_load),1)])]),t("div",Ct,[t("span",null,[i[4]||(i[4]=t("b",null,"OUTC:",-1)),v(n(e.outcome)+" ",1)]),t("span",null,n(ot(et)((o=e.outcome_date)!=null?o:"")),1)]),t("table",Tt,[i[6]||(i[6]=t("thead",null,[t("tr",null,[t("th",null,"SE"),t("th",null,"TB"),t("th",null,"Adh"),t("th",null,"DRUG(S) Given")])],-1)),t("tbody",null,[t("tr",null,[i[5]||(i[5]=t("td",null,null,-1)),t("td",null,n(e.tb_status),1),t("td",null,n(e.adherence),1),t("td",null,[t("ul",null,[(b(!0),f(rt,null,ut(e.drugs,(r,u)=>(b(),f("li",{key:u},n(r),1))),128))])])])])]),i[7]||(i[7]=t("p",null,null,-1)),t("div",Pt,[t("div",null,[t("div",null,"Next: "+n(e.next_appointment_date),1),t("div",null,n(e.seen_by),1)])])])]}),_:1}))}}),kt=w(Dt,[["__scopeId","data-v-34a856c3"]]),At={id:"container"},Nt={class:"label"},Bt={style:{"font-weight":"600"},class:"row"},Et={style:{"margin-top":"2%"}},Ot={style:{"max-height":"316px",overflow:"hidden"}},Ut={class:"row"},Mt={class:"row"},Ht={class:"row"},zt={class:"row"},jt={style:{"margin-top":"14px"}},Gt=S({__name:"PatientDemographicLbl",props:{arv_number:{type:String},patient_details:{type:Object},art_initiation_status:{type:Object}},emits:["label-out"],setup(e,{emit:s}){const a=s;return(d,i)=>(b(),P(A,{id:"art_demographics",onLabelOutput:i[0]||(i[0]=l=>a("label-out",l))},{default:D(()=>{var l,o,r,u,c,g,m,h,y,N,B,E,O,U,M,H,z,j,G,V,q,R;return[t("div",At,[t("div",Nt,[t("div",Bt,[i[1]||(i[1]=t("div",null,"PATIENT DETAILS",-1)),t("div",null,n(e.arv_number),1)]),t("div",null,[t("div",null,"Name: "+n((l=e.patient_details)==null?void 0:l.name),1),t("div",null,"DOB: "+n((o=e.patient_details)==null?void 0:o.dob),1),t("div",null,"Phone: "+n((r=e.patient_details)==null?void 0:r.phone),1),t("div",null,"Addr: "+n((u=e.patient_details)==null?void 0:u.address),1),t("div",null,"Guard: "+n((c=e.patient_details)==null?void 0:c.guardian),1),t("div",Et,[t("div",null,"TI: "+n((g=e.patient_details)==null?void 0:g.transfer_in),1),t("div",null,"FUP: "+n((m=e.patient_details)==null?void 0:m.agrees_to_followup),1)])])]),i[13]||(i[13]=t("div",{style:{margin:"150px"}},null,-1)),t("div",Ot,[t("div",Ut,[i[2]||(i[2]=t("div",null,[t("b",null,"STATUS AT ART INITIATION")],-1)),t("div",null,"(DSA: "+n((h=e.art_initiation_status)==null?void 0:h.art_start_date)+")",1),t("div",null,[t("b",null,n(e.arv_number),1)])]),t("div",Mt,[t("div",null,[i[3]||(i[3]=t("b",null,"RFS: ",-1)),v(n((y=e.art_initiation_status)==null?void 0:y.reason_for_art_eligibility),1)]),t("div",null,[i[4]||(i[4]=t("b",null,"TB: ",-1)),v(n((N=e.art_initiation_status)==null?void 0:N.tb_status),1)]),t("div",null,[i[5]||(i[5]=t("b",null,"HEIGHT: ",-1)),v(n((B=e.art_initiation_status)==null?void 0:B.initial_height),1)])]),t("div",Ht,[t("div",null,[i[6]||(i[6]=t("b",null,"KS: ",-1)),v(n((E=e.art_initiation_status)==null?void 0:E.ks_status),1)]),t("div",null,[i[7]||(i[7]=t("b",null,"WEIGHT: ",-1)),v(n((O=e.art_initiation_status)==null?void 0:O.initial_weight),1)])]),t("div",zt,[t("div",null,[i[8]||(i[8]=t("b",null,"1st + Test:",-1)),v(" "+n((U=e.art_initiation_status)==null?void 0:U.hiv_test_date),1)]),t("div",null,[i[9]||(i[9]=t("b",null,"Preg: ",-1)),v(n((M=e.art_initiation_status)==null?void 0:M.pregnant),1)]),t("div",null,[i[10]||(i[10]=t("b",null,"Init Age: ",-1)),v(n((H=e.art_initiation_status)==null?void 0:H.age_at_initiation),1)])]),i[11]||(i[11]=t("div",{style:{"border-top":"3px solid black",width:"100%"}},null,-1)),i[12]||(i[12]=t("div",{style:{"font-weight":"bold",display:"flex","justify-content":"right"}}," STAGE DEFINING CONDITIONS ",-1)),t("div",jt,n([...(j=(z=e.art_initiation_status)==null?void 0:z.first_line_drugs)!=null?j:[],...(V=(G=e.art_initiation_status)==null?void 0:G.alt_first_line_drugs)!=null?V:[],...(R=(q=e.art_initiation_status)==null?void 0:q.second_line_drugs)!=null?R:[]].join(",")),1)])])]}),_:1}))}}),Vt=w(Gt,[["__scopeId","data-v-56ecfb68"]]),qt={id:"container"},Rt={key:0},Ft={key:1},Qt={style:{display:"flex","align-items":"center"}},Wt=S({__name:"NpidLbl",props:{name:{type:String,default:"??"},national_id:{type:String,required:!0,default:"??"},birthdate:{type:String,default:"??"},sex:{type:String,gender:"??"},address:{type:String,default:"??"},useQrCode:{type:Boolean},qr:{type:String}},emits:["label-out"],setup(e,{emit:s}){const a=s,d=e;return K(()=>{if(!d.useQrCode)ct("#patient-barcode",d.national_id,{height:56,width:2,displayValue:!1,format:"CODE128"});else{const i=document.getElementById("patient-qrcode");i&&d.qr&&vt.toCanvas(i,d.qr,{width:160},l=>{l&&(console.log(l),L("Unable to generate QR code"))})}}),(i,l)=>(b(),P(A,{id:"npid-label",onLabelOutput:l[0]||(l[0]=o=>a("label-out",o))},{default:D(()=>[t("div",qt,[e.useQrCode?(b(),f("div",Ft,[t("div",null,[t("div",Qt,[l[2]||(l[2]=t("div",null,[t("canvas",{id:"patient-qrcode"})],-1)),t("div",null,[t("div",null,n(e.name),1),t("div",null,n(e.national_id),1),t("div",null,n(e.birthdate),1),t("div",null,n(e.sex),1),t("div",null,n(e.address),1)])])])])):(b(),f("div",Rt,[t("div",null,[t("div",null,[t("div",null,n(e.name),1),t("div",null,n(e.national_id)+" "+n(e.birthdate)+" "+n(e.sex),1),t("div",null,n(e.address),1)]),l[1]||(l[1]=t("svg",{id:"patient-barcode"},null,-1))])]))])]),_:1}))}}),Jt=w(Wt,[["__scopeId","data-v-2829f777"]]);function Zt(e,s=$.getSessionDate()){k(kt,{copies:2,lblUrl:"programs/".concat($.getProgramID(),"/patients/").concat(e,"/labels/visits?date=").concat(s)})}function te(e){k(Vt,{lblUrl:"programs/".concat($.getProgramID(),"/patients/").concat(e,"/labels/patient_history")})}async function ee(e,s=!1){return k(Jt,{scaleHeight:280,useImage:!1,lblUrl:"patients/".concat(e,"/labels/national_health_id?qr_code=").concat(s)})}export{te as a,Zt as b,ee as p};

System.register(["./vendor-legacy-BH_ZsSq_.js","./index-legacy-D5JbQ37a.js","./ImmunizationGroupGraph-legacy-fSDnWgdO.js","./StockStore-legacy-Djv2jq0n.js","./BasicForm-legacy-RVXbktIz.js","./customDatePicker.vue_vue_type_style_index_0_lang-legacy-DvmEmzXp.js","./group_validation-legacy-CYanHvIS.js","./stock_service-legacy-BbODzr_q.js","./drug_service-legacy-DFieG4rN.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-BgAxpgBq.js","./DateInputField-legacy-HQwQxlH0.js"],function(t,e){"use strict";var a,n,i,o,s,d,l,r,c,u,p,h,g,m,f,x,v,y,_,w,b,k,D,S,B,I,C,z,T,P,M,j,q,N,F,V,A,E,H,L,O,U,G,R,$,W,Y,K,Q,X,J,Z,tt,et,at,nt,it,ot,st,dt,lt,rt,ct,ut,pt,ht,gt,mt,ft,xt,vt,yt,_t,wt,bt,kt,Dt,St,Bt;return{setters:[t=>{a=t.d,n=t.ao,i=t.ab,o=t.U,s=t.T,d=t.ap,l=t.ak,r=t.G,c=t.S,u=t.ah,p=t.X,h=t.aq,g=t.a9,m=t.aa,f=t.E,x=t.e,v=t.f,y=t.l,_=t.z,w=t.A,b=t.B,k=t.k,D=t.F,S=t.R,B=t.a8,I=t.W,C=t.d0,z=t.d1,T=t.d2,P=t.I,M=t.b0,j=t.aj,q=t.ai,N=t.an,F=t.ba,V=t.r,A=t.cF,E=t.bd,H=t.cG,L=t.cH,O=t.cI,U=t.cJ,G=t.cK,R=t.cL,$=t.cM,W=t.cN,Y=t.bG,K=t.y,Q=t.m,X=t.L,J=t.p},t=>{Z=t.D,tt=t.g,et=t.B,at=t.y,nt=t.z,it=t.H,ot=t.t,st=t.C,dt=t.p,lt=t.u,rt=t.i,ct=t._,ut=t.F,pt=t.T,ht=t.b,gt=t.j,mt=t.m,ft=t.G,xt=t.d},t=>{vt=t.I,yt=t.a},t=>{_t=t.u},t=>{wt=t.B},t=>{bt=t._},t=>{kt=t.v},t=>{Dt=t.S},t=>{St=t.D},t=>{Bt=t.l},null,null],execute:function(){var e=O.createElement("style");e.textContent=".OtherVitalsTitle[data-v-88dde239]{font-style:normal;font-weight:600;font-size:20px;color:#00190e}.drug_container[data-v-840df9ed]{justify-content:center;flex-wrap:wrap;gap:30px;margin:20px}ion-row[data-v-840df9ed]{line-height:10px}.content[data-v-840df9ed]{font-size:14px;color:#939393}.contentBold[data-v-840df9ed]{font-weight:700;font-size:14px;color:gray;line-height:16px}.container[data-v-840df9ed]{display:flex;align-content:center;align-items:center}.drug_content[data-v-840df9ed]{padding-bottom:10px;margin-bottom:10px;border-bottom:1px solid #f2f2f2;position:relative;overflow:hidden}.watermark[data-v-840df9ed]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-45deg);font-size:4em;color:rgba(255,110,110,.2);white-space:nowrap;pointer-events:none;z-index:0}.bigGroupButton[data-v-840df9ed]{margin-top:10px}#container[data-v-840df9ed]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container strong[data-v-840df9ed]{font-size:20px;line-height:26px}#container p[data-v-840df9ed]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container a[data-v-840df9ed]{text-decoration:none}.centered-content[data-v-840df9ed]{display:flex;justify-content:center;align-items:center}.graphBackground[data-v-840df9ed]{position:absolute;width:100vw;height:62vh;left:0;top:23vh;background:linear-gradient(158.66deg,#d6d5d6 .36%,#f8f8f8 40.1%);border-radius:22px}.total[data-v-840df9ed]{position:absolute;width:251px;height:128px;top:25px;left:50%;transform:translate(-50%,10%);text-align:center;background:rgba(237,235,238,.95);opacity:.8;border-radius:6px}.totalNumber[data-v-840df9ed]{height:77px;font-style:normal;font-weight:700;font-size:60px;line-height:77px;color:#5d5d5d}.totalText[data-v-840df9ed]{width:229px;height:48px;font-style:normal;font-weight:700;font-size:15px;line-height:150%;display:flex;align-items:center;text-align:center;color:#08475e}.dueMiss[data-v-840df9ed]{display:flex;justify-content:space-around;margin-top:10px}.missed[data-v-840df9ed],.due[data-v-840df9ed]{width:187px;height:90px;left:14px;background:#fff;border-radius:6px;text-align:center}.dueMissText[data-v-840df9ed]{font-style:normal;font-weight:700;font-size:14px;line-height:17px;display:flex;align-items:center;text-align:center;padding:7px;color:#004d4d}.dueNumber[data-v-840df9ed]{font-style:normal;font-weight:700;font-size:36px;line-height:30px;margin-top:10px;color:#016302}.missedNumber[data-v-840df9ed]{font-style:normal;font-weight:700;font-size:36px;line-height:30px;margin-top:10px;color:#b42318}.clientSeen[data-v-840df9ed]{height:120px;margin-top:15px;background:#fff}.clientSeenTitle[data-v-840df9ed]{padding-top:10px;margin-left:10px;font-style:normal;font-weight:400;font-size:16px;color:#2d3648}.clientSeenBoxChild[data-v-840df9ed]{background:#2d3648!important}.clientSeenBoxMen[data-v-840df9ed]{background:#004d4d!important}.clientSeenBoxWomen[data-v-840df9ed]{background:#556080!important}.clientSeenBox[data-v-840df9ed]{width:68px;height:68px;background:#006401;border-radius:7px;padding-top:8px}.clientSeenBoxes[data-v-840df9ed]{display:flex;justify-content:space-around;margin-top:10px}.clientSeenBoxText[data-v-840df9ed]{font-style:normal;font-weight:400;font-size:14px;line-height:150%;align-items:center;text-align:center;color:#fff}.clientSeenBoxNumber[data-v-840df9ed]{font-style:normal;font-weight:700;font-size:24px;line-height:29px;text-align:center;color:#fff}.graphCard[data-v-840df9ed]{width:98vw;margin:10px auto 0}.modal_wrapper[data-v-840df9ed]{border-radius:8px}.bigButton[data-v-840df9ed]{font-weight:500;height:180px}.centerBigBtnContain[data-v-840df9ed]{align-items:center;align-content:center}.bigBtnHeader[data-v-840df9ed]{font-weight:700;font-size:20px;margin-bottom:10px}ion-button[data-v-840df9ed]{margin-right:10px}.addBtn[data-v-840df9ed]{height:50px;align-items:center}.example-one .pagination-container{column-gap:10px}.example-one .paginate-buttons{height:40px;width:40px;border-radius:20px;cursor:pointer;background-color:#f2f2f2;border:1px solid rgb(217,217,217);color:#000}.example-one .paginate-buttons:hover{background-color:#d8d8d8}.example-one .active-page{background-color:#3498db;border:1px solid #3498db;color:#fff}.example-one .active-page:hover{background-color:#2988c8}.example-one .back-button:active,.example-one .next-button:active{background-color:#c4c4c4}.drug_container[data-v-3da0763e]{justify-content:center;flex-wrap:wrap;gap:30px;margin:20px}ion-row[data-v-3da0763e]{line-height:10px}.content[data-v-3da0763e]{font-size:14px;color:#939393}.contentBold[data-v-3da0763e]{font-weight:700;font-size:14px;color:gray;line-height:16px}.container[data-v-3da0763e]{display:flex;align-content:center;align-items:center}.drug_content[data-v-3da0763e]{padding-bottom:10px;margin-bottom:10px;border-bottom:1px solid #f2f2f2}.bigGroupButton[data-v-3da0763e]{margin-top:10px}#container[data-v-3da0763e]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container strong[data-v-3da0763e]{font-size:20px;line-height:26px}#container p[data-v-3da0763e]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container a[data-v-3da0763e]{text-decoration:none}.centered-content[data-v-3da0763e]{display:flex;justify-content:center;align-items:center}.graphBackground[data-v-3da0763e]{position:absolute;width:100vw;height:62vh;left:0;top:23vh;background:linear-gradient(158.66deg,#d6d5d6 .36%,#f8f8f8 40.1%);border-radius:22px}.total[data-v-3da0763e]{position:absolute;width:251px;height:128px;top:25px;left:50%;transform:translate(-50%,10%);text-align:center;background:rgba(237,235,238,.95);opacity:.8;border-radius:6px}.totalNumber[data-v-3da0763e]{height:77px;font-style:normal;font-weight:700;font-size:60px;line-height:77px;color:#5d5d5d}.totalText[data-v-3da0763e]{width:229px;height:48px;font-style:normal;font-weight:700;font-size:15px;line-height:150%;display:flex;align-items:center;text-align:center;color:#08475e}.dueMiss[data-v-3da0763e]{display:flex;justify-content:space-around;margin-top:10px}.missed[data-v-3da0763e],.due[data-v-3da0763e]{width:187px;height:90px;left:14px;background:#fff;border-radius:6px;text-align:center}.dueMissText[data-v-3da0763e]{font-style:normal;font-weight:700;font-size:14px;line-height:17px;display:flex;align-items:center;text-align:center;padding:7px;color:#004d4d}.dueNumber[data-v-3da0763e]{font-style:normal;font-weight:700;font-size:36px;line-height:30px;margin-top:10px;color:#016302}.missedNumber[data-v-3da0763e]{font-style:normal;font-weight:700;font-size:36px;line-height:30px;margin-top:10px;color:#b42318}.clientSeen[data-v-3da0763e]{height:120px;margin-top:15px;background:#fff}.clientSeenTitle[data-v-3da0763e]{padding-top:10px;margin-left:10px;font-style:normal;font-weight:400;font-size:16px;color:#2d3648}.clientSeenBoxChild[data-v-3da0763e]{background:#2d3648!important}.clientSeenBoxMen[data-v-3da0763e]{background:#004d4d!important}.clientSeenBoxWomen[data-v-3da0763e]{background:#556080!important}.clientSeenBox[data-v-3da0763e]{width:68px;height:68px;background:#006401;border-radius:7px;padding-top:8px}.clientSeenBoxes[data-v-3da0763e]{display:flex;justify-content:space-around;margin-top:10px}.clientSeenBoxText[data-v-3da0763e]{font-style:normal;font-weight:400;font-size:14px;line-height:150%;align-items:center;text-align:center;color:#fff}.clientSeenBoxNumber[data-v-3da0763e]{font-style:normal;font-weight:700;font-size:24px;line-height:29px;text-align:center;color:#fff}.graphCard[data-v-3da0763e]{width:98vw;margin:10px auto 0}.modal_wrapper[data-v-3da0763e]{border-radius:8px}.bigButton[data-v-3da0763e]{font-weight:500;height:180px}.centerBigBtnContain[data-v-3da0763e]{align-items:center;align-content:center}.bigBtnHeader[data-v-3da0763e]{font-weight:700;font-size:20px;margin-bottom:10px}ion-button[data-v-3da0763e]{margin-right:10px}.addBtn[data-v-3da0763e]{height:50px;align-items:center}\n/*$vite$:1*/",O.head.appendChild(e);const It=a({components:{IonContent:u,IonHeader:c,IonItem:r,IonList:l,IonMenu:d,IonTitle:s,IonToolbar:o,IonInput:i,BasicInputField:et,BasicForm:wt,PreviousVitals:tt,customDatePicker:bt,DynamicButton:Z},data:()=>({iconsContent:rt,BMI:{},BPStatus:{},vValidations:"",title:"",relationships:"",hasValidationErrors:[],vitalsInstance:{},validationStatus:{heightWeight:!1,bloodPressure:!1},showPD:!1,stockService:{}}),computed:{...n(lt,["patient"]),...n(_t,["stock"])},props:{data:{default:{}}},created(){this.stockService=new Dt},async mounted(){this.resetData(),this.data?(this.modifyFieldValue(),this.title="Edit Stock"):this.title="Add Stock",await this.getDrugs()},setup:()=>({checkmark:m,pulseOutline:g}),methods:{modifyFieldValue(){at(this.stock,"product name","value",{id:"",name:this.data.drug_legacy_name}),at(this.stock,"batch","value",this.data.batch_number),at(this.stock,"manufacture","value",this.data.manufacture),at(this.stock,"doses_wasted","value",this.data.doses_wasted),at(this.stock,"expire date","value",this.data.expiry_date),at(this.stock,"quantity","value",this.data.delivered_quantity),at(this.stock,"delivery_date","value",this.data.delivery_date),at(this.stock,"product name","disabled","true"),at(this.stock,"batch","disabled","true"),at(this.stock,"manufacture","disabled","true"),at(this.stock,"expire date","disabled","true"),at(this.stock,"quantity","disabled","true"),at(this.stock,"delivery_date","disabled","true")},async handleBatch(){this.data?await this.updateBatch():await this.createBatch(),dt().postData("SYNC_STOCK_RECORD")},async createBatch(){if(!kt(this.stock))return ot("Batch not save"),!1;{const t=nt(this.stock,"product name","value").drug_id,e=[{batch_number:nt(this.stock,"batch","value"),location_id:"",vvm_stage:"",items:[{barcode:"",drug_id:t,expiry_date:nt(this.stock,"expire date","value"),manufacture:nt(this.stock,"manufacture","value"),quantity:nt(this.stock,"quantity","value"),delivery_date:nt(this.stock,"delivery_date","value")||it.sessionDate(),product_code:"",pack_size:""}]}],a=await this.stockService.postItems(e);await this.handleWaste(a[0].items[0].id),st("Batch save successfully"),p.dismiss("dismiss")}},async updateBatch(){const t=parseInt(nt(this.stock,"doses_wasted","value")),e=parseInt(nt(this.stock,"quantity","value"));if(this.data.current_quantity,e<this.data.dispensed_quantity+this.data.doses_wasted+t)return ot("Quantity delivered can not be greater than quantity wasted and dispensed"),!1;if(!kt(this.stock))return ot("Batch not save"),!1;{const e={doses_wasted:t,drug_id:nt(this.stock,"product name","value").drug_id,reallocation_code:"MA20",waste_reason:"Something wrong with the drug",date:it.sessionDate(),reason:"Mistake Entirely"};try{await this.stockService.updateItem(this.data.id,e),st("Batch save successfully"),p.dismiss("dismiss")}catch(a){ot(a)}}},async handleWaste(t){const e=nt(this.stock,"doses_wasted","value");if(e){const a={reallocation_code:"MA20",quantity:e,date:it.sessionDate(),reason:"Something wrong with the drug"};await this.stockService.disposeItems(t,a)}},navigationMenu(t){h.close(),this.$router.push(t)},resetData(){const t=_t();t.setStock(t.getInitialStock())},async getDrugs(t=""){const e=await St.getDrugs({name:t,page:1,page_size:10,concept_set:"Immunizations"});at(this.stock,"product name","multiSelectData",e)},async handleInputData(t){"Product Name *"==t.inputHeader&&await this.getDrugs("")},dismiss(){p.dismiss()}}}),Ct={class:"modal_wrapper"},zt={class:"ion-padding",slot:"content",style:{"padding-bottom":"200px"}},Tt=ct(It,[["render",function(t,e,a,n,i,o){const s=f("ion-title"),d=f("ion-icon"),l=f("ion-header"),r=f("basic-form"),c=f("ion-content"),u=f("DynamicButton"),p=f("ion-col"),h=f("ion-row"),g=f("ion-footer");return v(),x(D,null,[y(l,{style:{display:"flex","justify-content":"space-between"}},{default:_(()=>[y(s,{class:"modalTitle"},{default:_(()=>[w(b(t.title),1)]),_:1}),y(d,{onClick:e[0]||(e[0]=e=>t.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:t.iconsContent.cancel},null,8,["icon"])]),_:1}),y(c,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:_(()=>[k("div",Ct,[k("div",zt,[k("div",null,[y(r,{contentData:t.stock,"onUpdate:inputValue":t.handleInputData,onSearchChange:t.getDrugs},null,8,["contentData","onUpdate:inputValue","onSearchChange"])])])])]),_:1}),y(g,{collapse:"fade",class:"ion-no-border"},{default:_(()=>[y(h,null,{default:_(()=>[y(p,null,{default:_(()=>[y(u,{onClick:e[1]||(e[1]=e=>t.handleBatch()),name:"Save",fill:"solid",style:{float:"right",margin:"2%",width:"130px"}})]),_:1})]),_:1})]),_:1})],64)}],["__scopeId","data-v-88dde239"]]),Pt=[{data:{rowData:[{colData:[{inputHeader:"Search",icon:rt.search,value:"",name:"search",eventType:"input",alertsErrorMassage:"",selectedID:""}]}]}}],Mt=S("searchName",{state:()=>({searchName:[...Pt]}),actions:{setsearchName(t){this.searchName=t},getInitialName:()=>[...Bt.cloneDeep(Pt)]}}),jt=[{data:{rowData:[{colData:[{inputHeader:"Quantity*",icon:rt.weight,valueType:"number",value:"",name:"quantity",eventType:"input",alertsErrorMassage:"",required:!0,validationFunctionName:"isNumber"}]}]}},{data:{rowData:[{colData:[{inputHeader:"Reason *",icon:rt.search,valueType:"text",isSingleSelect:!0,popOver:!0,value:"",name:"reason",validationFunctionName:"required",trackBy:"id",multiSelectData:[],eventType:"input",required:!0,alertsErrorMassage:"",id:""}]}]}}],qt=S("stockDiscard",{state:()=>({stockDiscard:[...jt]}),actions:{setStockDiscard(t){this.stockDiscard=t},getInitialStockDiscard:()=>[...Bt.cloneDeep(jt)]},persist:!0}),Nt=a({name:"StockManagementModal",mixins:[ht],components:{IonContent:u,IonHeader:c,IonMenuButton:F,IonPage:N,IonTitle:s,IonToolbar:o,Toolbar:pt,ToolbarSearch:ut,IonRow:q,IonCol:j,ImmunizationTrendsGraph:yt,ImmunizationGroupGraph:vt,IonCard:M,DynamicButton:Z,BasicForm:wt,IonIcon:P,IonFab:T,IonFabButton:z,IonFabList:C,IonButton:I,IonPopover:B},data:()=>({iconsContent:rt,reportData:[],currentStock:[],stockData:[],allStock:[],outStock:[],filter:"",startDate:it.sessionDate(),endDate:it.sessionDate(),options:{responsive:!0,select:!0},selectedButton:"all",isLoading:!1,popoverOpen:!1,popoverName:"",event:null,stockService:{},disabled:!1,totalPages:0}),setup:()=>({currentPage:V(1),chevronBackOutline:Y,checkmark:m,grid:W,chevronDownCircle:$,chevronForwardCircle:R,chevronUpCircle:G,colorPalette:U,document:O,globe:L,medkit:H,add:E,person:A}),created(){this.stockService=new Dt},props:{data:{default:{}}},computed:{...n(_t,["stock"]),...n(Mt,["searchName"]),...n(qt,["stockDiscard"]),...n(xt,["apiStatus"])},$route:{async handler(){await this.buildTableData()},deep:!0},watch:{stock:{async handler(){},deep:!0}},async mounted(){await this.buildTableData()},methods:{checkExpired(t){const e=new Date(t.expiry_date);return!(new Date(it.sessionDate())>=e)},async updateBatch(){const t=parseInt(nt(this.stockDiscard,"quantity","value")),e=nt(this.stockDiscard,"reason","value").name,a=parseInt(this.stockData.delivered_quantity);if(this.stockData.current_quantity,a<this.stockData.dispensed_quantity+this.stockData.doses_wasted+t)return ot("Quantity delivered can not be greater than quantity wasted and dispensed"),!1;if(!kt(this.stockDiscard))return ot("Failing to discard"),!1;{const a={doses_wasted:t,drug_id:this.stockData.drug_id,reallocation_code:"MA20",waste_reason:e,date:it.sessionDate(),reason:e};try{await this.stockService.updateItem(this.stockData.id,a),st("Discard successfully"),await this.buildTableData(),this.closePopover()}catch(n){ot(n)}}},async adjustStock(){let t=parseInt(nt(this.stockDiscard,"quantity","value")),e=nt(this.stockDiscard,"reason","value").name;if("Negative Adjustment"==e||"Negative Mathematical Error"==e){if(t>this.stockData.current_quantity)return ot("Quantity Available can not be greater than adjustment quantity"),!1;t=-t}if(!kt(this.stockDiscard))return ot("Failing to adjust"),!1;{const n={adjust_stock:t,drug_id:this.stockData.drug_id,reallocation_code:"MA20",waste_reason:e,date:it.sessionDate(),reason:e};try{await this.stockService.updateItem(this.stockData.id,n),st("Adjust successfully"),await this.buildTableData(),this.closePopover()}catch(a){ot(a)}}},whichPopover(t,e,a){this.popoverName=a,qt().setStockDiscard(qt().getInitialStockDiscard()),at(this.stockDiscard,"reason","multiSelectData","adjust"==a?[{id:1,name:"Positive Adjustment"},{id:2,name:"Negative Adjustment"},{id:3,name:"Negative Mathematical Error"},{id:4,name:"Positive Mathematical Error"}]:[{id:1,name:"VVM stage > 2"},{id:2,name:"Frozen"},{id:3,name:"Damage"},{id:4,name:"Wastage"}]),this.openPopover(t,e)},openPopover(t,e){this.stockData=e,this.event=t,this.popoverOpen=!0},closePopover(){this.event=null,this.popoverOpen=!1},dismiss(){p.dismiss("dismiss")},async onClickHandler(t){await this.buildTableData(t)},formatDate:t=>it.toStandardHisDisplayFormat(t),async handleInputData(t){"Search"==t.inputHeader&&(this.filter=t.value,await this.buildTableData())},async voidStock(t,e){if(await ft(`Do you want to void "${e.drug_legacy_name}", batch: ${e.batch_number} ?`,t,{confirmBtnLabel:"Void"})){const t=new Dt;await t.deleteItem(e.id,{reason:"voided"}),await this.buildTableData()}},async buildTableData(t=1){this.isLoading=!0,dt().postData("SYNC_STOCK_RECORD");try{if(this.apiStatus){var e,a;const n=new Dt;this.reportData={records:await n.getItems({start_date:"2000-01-01",end_date:this.endDate,drug_name:this.data.drug_legacy_name,page:t,page_size:4})},null!==(e=this.reportData)&&void 0!==e&&e.records&&(this.totalPages=null===(a=this.reportData)||void 0===a||null===(a=a.records[0])||void 0===a?void 0:a.total_count)}else this.reportData=await mt("stock",{whereClause:{drug_legacy_name:this.data.drug_legacy_name},currentPage:this.currentPage,itemsPerPage:4}),this.totalPages=this.reportData.totalCount}catch(n){ot("An error occurred while loading data.")}finally{this.isLoading=!1}},async selectButton(t){this.selectedButton=t,await this.buildTableData()},async openAddStockModal(t){"dismiss"==await gt(Tt,{class:"fullScreenModal"},!0,{data:t})&&await this.buildTableData()}}}),Ft={key:0,class:"spinner-overlay"},Vt={class:"container"},At={style:{width:"70vw",top:"-2px",position:"relative","margin-right":"10px"}},Et={class:"drug_container"},Ht={key:0,class:"watermark"},Lt={key:1,class:"watermark"},Ot={style:{"font-weight":"700","font-size":"16px",color:"#939393"}},Ut={key:2},Gt={class:"example-one"},Rt={style:{"margin-bottom":"160px"}},$t={style:{display:"flex","justify-content":"space-between",padding:"10px"}},Wt=ct(Nt,[["render",function(t,e,a,n,i,o){const s=f("ion-spinner"),d=f("ion-title"),l=f("ion-icon"),r=f("ion-header"),c=f("basic-form"),u=f("ion-col"),p=f("ion-row"),h=f("ion-button"),g=f("vue-awesome-paginate"),m=f("ion-popover"),S=f("ion-content"),B=f("ion-page");return v(),K(B,{class:J({loading:t.isLoading})},{default:_(()=>[t.isLoading?(v(),x("div",Ft,[y(s,{name:"bubbles"}),e[6]||(e[6]=k("div",{class:"loading-text"},"Please wait...",-1))])):Q("",!0),y(r,{style:{display:"flex","justify-content":"space-between"}},{default:_(()=>[y(d,{class:"modalTitle"},{default:_(()=>e[7]||(e[7]=[w("Inventory Management ",-1)])),_:1,__:[7]}),y(l,{onClick:e[0]||(e[0]=e=>t.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:t.iconsContent.cancel},null,8,["icon"])]),_:1}),y(S,{style:{"--background":"#fff"}},{default:_(()=>[k("div",Vt,[k("div",At,[y(c,{contentData:t.searchName,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:inputValue"])]),k("div",Et,[(v(!0),x(D,null,X(t.reportData.records,(a,n)=>(v(),x("div",{class:"drug_content",key:n},[t.checkExpired(a)?Q("",!0):(v(),x("div",Ht,"EXPIRED")),a.current_quantity<=0?(v(),x("div",Lt,"Stock out")):Q("",!0),y(p,{class:"search_header"},{default:_(()=>[y(u,{class:""},{default:_(()=>[k("span",Ot,b(a.drug_legacy_name),1)]),_:2},1024)]),_:2},1024),y(p,{class:"search_header"},{default:_(()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_(()=>e[8]||(e[8]=[w("Batch/Lot Number",-1)])),_:1,__:[8]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_(()=>[w(b(a.batch_number),1)]),_:2},1024)]),_:2},1024),y(p,{class:"search_header"},{default:_(()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_(()=>e[9]||(e[9]=[w("Manufacturer",-1)])),_:1,__:[9]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_(()=>[w(b(a.manufacture),1)]),_:2},1024)]),_:2},1024),y(p,{class:"search_header"},{default:_(()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_(()=>e[10]||(e[10]=[w("Expiration date ",-1)])),_:1,__:[10]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_(()=>[w(b(t.formatDate(a.expiry_date)),1)]),_:2},1024)]),_:2},1024),y(p,{class:"search_header"},{default:_(()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_(()=>e[11]||(e[11]=[w("Date received",-1)])),_:1,__:[11]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_(()=>[w(b(t.formatDate(a.delivery_date)),1)]),_:2},1024)]),_:2},1024),y(p,{class:"search_header"},{default:_(()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_(()=>e[12]||(e[12]=[w("Doses Received",-1)])),_:1,__:[12]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_(()=>[w(b(a.delivered_quantity),1)]),_:2},1024)]),_:2},1024),y(p,{class:"search_header"},{default:_(()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_(()=>e[13]||(e[13]=[w("Doses wasted",-1)])),_:1,__:[13]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_(()=>[w(b(a.doses_wasted),1)]),_:2},1024)]),_:2},1024),y(p,{class:"search_header"},{default:_(()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_(()=>e[14]||(e[14]=[w("Doses Issued",-1)])),_:1,__:[14]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_(()=>[w(b(a.dispensed_quantity),1)]),_:2},1024)]),_:2},1024),y(p,{class:"search_header"},{default:_(()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_(()=>e[15]||(e[15]=[w("Doses Available",-1)])),_:1,__:[15]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_(()=>[w(b(a.current_quantity),1)]),_:2},1024)]),_:2},1024),t.apiStatus?(v(),x("div",Ut,[t.checkExpired(a)&&a.current_quantity>0?(v(),K(h,{key:0,size:"small",color:"danger",name:"Discard Stock",style:{"font-size":"12px"},onClick:e=>t.whichPopover(e,a,"discard")},{default:_(()=>e[16]||(e[16]=[w(" Discard Stock ",-1)])),_:2,__:[16]},1032,["onClick"])):(v(),K(h,{key:1,size:"small",color:"danger",name:"Discard Stock",style:{"font-size":"12px"},onClick:e=>t.voidStock(e,a)},{default:_(()=>e[17]||(e[17]=[w(" Void Stock ",-1)])),_:2,__:[17]},1032,["onClick"])),y(h,{color:"success",size:"small",name:"Update Stock",style:{"font-size":"12px"},onClick:e=>t.whichPopover(e,a,"adjust")},{default:_(()=>e[18]||(e[18]=[w("Adjust Stock",-1)])),_:2,__:[18]},1032,["onClick"])])):Q("",!0)]))),128))]),k("div",Gt,[t.totalPages>0?(v(),K(g,{key:0,"total-items":t.totalPages,"items-per-page":4,"max-pages-shown":2,modelValue:t.currentPage,"onUpdate:modelValue":e[1]||(e[1]=e=>t.currentPage=e),onClick:t.onClickHandler},null,8,["total-items","modelValue","onClick"])):Q("",!0)])]),y(m,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!1,event:t.event,onDidDismiss:e[5]||(e[5]=e=>t.popoverOpen=!1)},{default:_(()=>[k("div",Rt,[y(c,{contentData:t.stockDiscard,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:inputValue"])]),k("div",$t,[y(h,{size:"small",color:"danger",name:"Discard Stock",style:{"font-size":"14px"},onClick:e[2]||(e[2]=e=>t.closePopover())},{default:_(()=>e[19]||(e[19]=[w("Cancel",-1)])),_:1,__:[19]}),"adjust"==t.popoverName?(v(),K(h,{key:0,color:"success",size:"small",name:"Update Stock",style:{"font-size":"14px"},onClick:e[3]||(e[3]=e=>t.adjustStock())},{default:_(()=>e[20]||(e[20]=[w("Save",-1)])),_:1,__:[20]})):Q("",!0),"discard"==t.popoverName?(v(),K(h,{key:1,color:"success",size:"small",name:"Update Stock",style:{"font-size":"14px"},onClick:e[4]||(e[4]=e=>t.updateBatch())},{default:_(()=>e[21]||(e[21]=[w("Save",-1)])),_:1,__:[21]})):Q("",!0)])]),_:1},8,["is-open","event"])]),_:1})]),_:1},8,["class"])}],["__scopeId","data-v-840df9ed"]]),Yt=a({name:"StockManagement",mixins:[ht],components:{IonContent:u,IonHeader:c,IonMenuButton:F,IonPage:N,IonTitle:s,IonToolbar:o,Toolbar:pt,ToolbarSearch:ut,IonRow:q,IonCol:j,ImmunizationTrendsGraph:yt,ImmunizationGroupGraph:vt,IonCard:M,DynamicButton:Z,BasicForm:wt,IonIcon:P,IonFab:T,IonFabButton:z,IonFabList:C,IonButton:I},data:()=>({reportData:[],currentStock:[],allStock:[],outStock:[],filter:"",startDate:it.sessionDate(),endDate:it.sessionDate(),options:{responsive:!0,select:!0},selectedButton:"all",isLoading:!1,combinedBatches:[],stockData:[],totalPages:0}),setup:()=>({currentPage:V(1),chevronBackOutline:Y,checkmark:m,grid:W,chevronDownCircle:$,chevronForwardCircle:R,chevronUpCircle:G,colorPalette:U,document:O,globe:L,medkit:H,add:E,person:A}),computed:{...n(_t,["stock"]),...n(dt,["workerData"]),...n(Mt,["searchName"]),...n(xt,["apiStatus"])},watch:{stock:{async handler(){},deep:!0},$route:{async handler(t){"stockManagement"==t.name&&await this.updateBuildStockData()},deep:!0}},async mounted(){await this.updateBuildStockData()},methods:{combineDrugBatches(t){const e=t.reduce((t,e)=>{const a=e.drug_legacy_name;return t[a]||(t[a]=[]),t[a].push(e),t},{});return this.combinedBatches=Object.keys(e).map(t=>{const a=e[t];return{drug_legacy_name:t,delivered_quantity:a.reduce((t,e)=>t+e.delivered_quantity,0),current_quantity:a.reduce((t,e)=>t+e.current_quantity,0),dispensed_quantity:a.reduce((t,e)=>t+e.dispensed_quantity,0),doses_wasted:a.reduce((t,e)=>t+e.doses_wasted,0)}}),this.combinedBatches},async onClickHandler(t){await this.buildTableData(t)},formatDate:t=>it.toStandardHisDisplayFormat(t),async handleInputData(t){"Search"==t.inputHeader&&(this.filter=t.value,await this.buildTableData())},async discardStock(t,e){if(await ft(`Do you want to void "${e.drug_legacy_name}", batch: ${e.batch_number} ?`,t,{confirmBtnLabel:"Void"})){const t=new Dt;await t.deleteItem(e.id,{reason:"voided"}),await this.buildTableData()}},async updateBuildStockData(){dt().postData("SYNC_STOCK_RECORD"),this.buildTableData()},async buildTableData(t=1){this.isLoading=!0;try{if(this.apiStatus){var e,a;const n=new Dt;this.reportData={items:await n.getItems({start_date:"2000-01-01",end_date:this.endDate,drug_name:this.filter,page:t,page_size:4,display_details:"true"})},null!==(e=this.reportData)&&void 0!==e&&e.items&&(this.totalPages=null===(a=this.reportData)||void 0===a||null===(a=a.items[0])||void 0===a?void 0:a.total_count)}else{var n;this.stockData=await mt("stock"),this.reportData=this.paginateArray(this.combineDrugBatches(this.stockData),this.currentPage),this.totalPages=null===(n=this.combinedBatches)||void 0===n?void 0:n.length}}catch(i){ot("An error occurred while loading data.")}finally{this.isLoading=!1}},paginateArray(t,e){if(!Array.isArray(t))throw new Error("Input must be an array");const a=Math.max(1,Number(e)||1),n=4*(a-1),i=n+4,o=t.slice(n,i);return{currentPage:a,totalPages:Math.ceil(t.length/4),totalItems:t.length,items:o}},async selectButton(t){this.selectedButton=t,await this.buildTableData()},async openMoreDetailsModal(t){"dismiss"==await gt(Wt,{class:"fullScreenModal"},!0,{data:t})&&await this.buildTableData()},async openAddStockModal(t){"dismiss"==await gt(Tt,{class:"fullScreenModal"},!0,{data:t})&&await this.buildTableData()}}}),Kt={key:0,class:"spinner-overlay"},Qt={class:"container"},Xt={style:{width:"80vw",top:"-10px",position:"relative","margin-right":"10px"}},Jt={class:"drug_container"},Zt={style:{"font-weight":"700","font-size":"16px",color:"#939393"}},te={class:"example-one"};t("default",ct(Yt,[["render",function(t,e,a,n,i,o){const s=f("ion-spinner"),d=f("Toolbar"),l=f("basic-form"),r=f("ion-col"),c=f("ion-row"),u=f("ion-button"),p=f("vue-awesome-paginate"),h=f("ion-icon"),g=f("ion-fab-button"),m=f("ion-fab"),S=f("ion-content"),B=f("ion-page");return v(),K(B,{class:J({loading:t.isLoading}),"keep-alive":!1},{default:_(()=>[t.isLoading?(v(),x("div",Kt,[y(s,{name:"bubbles"}),e[2]||(e[2]=k("div",{class:"loading-text"},"Please wait...",-1))])):Q("",!0),y(d),y(S,{style:{"--background":"#fff"}},{default:_(()=>{var a;return[k("div",Qt,[e[8]||(e[8]=k("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Inventory Management",-1)),k("div",Xt,[y(l,{contentData:t.searchName,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:inputValue"])]),k("div",Jt,[(v(!0),x(D,null,X(null===(a=t.reportData)||void 0===a?void 0:a.items,(a,n)=>(v(),x("div",{class:"drug_content",key:n},[y(c,{class:"search_header"},{default:_(()=>[y(r,{class:""},{default:_(()=>[k("span",Zt,b(a.drug_legacy_name),1)]),_:2},1024)]),_:2},1024),y(c,{class:"search_header"},{default:_(()=>[y(r,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_(()=>e[3]||(e[3]=[w("Doses Received",-1)])),_:1,__:[3]}),y(r,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_(()=>[w(b(a.delivered_quantity),1)]),_:2},1024)]),_:2},1024),y(c,{class:"search_header"},{default:_(()=>[y(r,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_(()=>e[4]||(e[4]=[w("Doses wasted",-1)])),_:1,__:[4]}),y(r,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_(()=>[w(b(a.doses_wasted),1)]),_:2},1024)]),_:2},1024),y(c,{class:"search_header"},{default:_(()=>[y(r,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_(()=>e[5]||(e[5]=[w("Doses Issued",-1)])),_:1,__:[5]}),y(r,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_(()=>[w(b(a.dispensed_quantity),1)]),_:2},1024)]),_:2},1024),y(c,{class:"search_header"},{default:_(()=>[y(r,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_(()=>e[6]||(e[6]=[w("Doses Available",-1)])),_:1,__:[6]}),y(r,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_(()=>[w(b(a.current_quantity),1)]),_:2},1024)]),_:2},1024),k("div",null,[y(u,{color:"success",size:"small",name:"Update Stock",style:{"font-size":"12px"},onClick:e=>t.openMoreDetailsModal(a)},{default:_(()=>e[7]||(e[7]=[w(" More Stock Details ",-1)])),_:2,__:[7]},1032,["onClick"])])]))),128))]),k("div",te,[t.totalPages>0?(v(),K(p,{key:0,"total-items":t.totalPages,"items-per-page":4,"max-pages-shown":2,modelValue:t.currentPage,"onUpdate:modelValue":e[0]||(e[0]=e=>t.currentPage=e),onClick:t.onClickHandler},null,8,["total-items","modelValue","onClick"])):Q("",!0)])]),t.apiStatus?(v(),K(m,{key:0,slot:"fixed",vertical:"bottom",horizontal:"end",onClick:e[1]||(e[1]=e=>t.openAddStockModal(""))},{default:_(()=>[y(g,{color:"primary"},{default:_(()=>[y(h,{icon:t.add},null,8,["icon"])]),_:1})]),_:1})):Q("",!0)]}),_:1})]),_:1},8,["class"])}],["__scopeId","data-v-3da0763e"]]))}}});

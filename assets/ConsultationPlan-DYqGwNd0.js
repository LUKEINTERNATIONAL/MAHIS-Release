import{d as be,ar as we,cl as Ae,r as o,b2 as f,a as ke,w as d,y as U,f as j,z as x,l as r,u as y,ah as Te,k as c,m as Pe,i as S,bG as Re,v as h,an as xe,bg as C}from"./vendor-D_pL91wi.js";import{az as q,u as Ne,aA as Ie,aB as Ve,a3 as Be,c as Fe,aC as Me,f as ze,M as Oe,d as He,T as $e,D as Ee,z as Le,H as N,aD as w,aE as Ge,aF as We,j as Ue,aG as A,C as je,aH as qe,O as J,S as K}from"./index-DK5fJS4G.js";import{D as Je}from"./DemographicBar-B7l3eQdo.js";import{u as I,D as Ke,C as Qe,T as Xe}from"./TreatmentPlan-ApFuAPby.js";import{u as Ye,I as Ze,N as et,M as tt,s as at,a as st,b as nt,c as it,d as ot}from"./NextAppointment-CUNlglYL.js";import{_ as rt}from"./RiskAssessment.vue_vue_type_script_setup_true_lang-Ci8N4Gu3.js";import{_ as lt}from"./Vitals.vue_vue_type_script_setup_true_lang-CrPIA0kF.js";import{u as ct,_ as ut}from"./useFormWizard-Ba-DNRTU.js";import{l as Q}from"./lodash-Dt8AsbQm.js";import{a as X,b as mt}from"./formatServerData-Bjd0Zl8W.js";import{C as pt}from"./Registration-Cft3_z8M.js";import{u as ft}from"./usePatientProfile-CLt67NV7.js";import"./apexcharts-f-yxlPgg.js";import"./DashBox-DP7QsjDx.js";import"./BasicForm-BW1F7zHw.js";import"./DateInputField-DryHYA0D.js";import"./previousDiagnosis-B2j1aoJp.js";import"./group_validation-DY5IGe2m.js";import"./drug_service-CbFKyCIH.js";import"./lab_order-DnenBs6p.js";import"./stages-D9ljQ_O9.js";import"./drug_prescription_service-BAfetdEM.js";import"./ncd_appointment_service-DZsj68rq.js";import"./useLocation-BbuC4GMn.js";import"./useExposeFromStandardForm-DlKikE1r.js";import"./vaccines_service-B7hiBQ9m.js";import"./sms_service-CBjAdiAp.js";import"./EIRreportsStore-BaMpQynv.js";import"./Export-BTHWLq-U.js";import"./Outcome-BvUTMtlB.js";const dt={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},gt={class:"back_profile"},Jt=be({__name:"ConsultationPlan",setup(vt,{expose:Y}){const{onTabBeforeChange:Z,onChangeCurrentTab:ee,currentTabIndex:g}=ct("Consultation Plan"),{printVisitSummary:te}=ft(),k=we(),ae=Ae();o([]),o([]),o(!1);const T=o(!0),se=q(),ne=Ne(),ie=Ie(),oe=Ve(),V=Be(),re=Ye(),_=Fe();Me();const le=ze(),ce=I(),ue=Oe(),{patient:u}=f(ne),{vitals:me}=f(se),{investigations:pe}=f(ie),{diagnosis:fe}=f(oe),{substance:de}=f(le),{selectedNCDMedicationList:B}=f(re),{FootScreening:ge,visualScreening:ve,cvScreening:Se}=f(ce),{sessionDate:F}=f(ue),{apiStatus:St}=f(He()),he=()=>{k.push("patientProfile")},P=()=>_.NCDActivities.map(e=>({title:e,icon:""})),n=o(P()),M=o(null),z=o(null),O=o(null),H=o(null),$=o(null),E=o(null),L=o(null),v=()=>{var a;if(!n.value||n.value.length===0)return console.log("Tabs not yet initialized"),null;const e=g.value>=0&&g.value<n.value.length?g.value:0;switch((a=n.value[e])==null?void 0:a.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(_.NCDActivities.length>0)switch(_.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},R=()=>{T.value=!1,setTimeout(()=>{g.value=0,T.value=!0},0)},G=()=>{const e=q();e.setVitals(e.getInitialVitals(u.value.ID))},m=async()=>{var a,l;const e=Le(F.value,"sessionDate","value")||N.sessionDate(),t=w("vitals");for(let s=0;s<n.value.length;s++){const p=n.value[s];if(p.title==="Vital Signs")n.value[s].icon=b(e,t)?C:"";else if(p.title==="Risk Assessment"){const i=w("substanceAbuse");n.value[s].icon=b(e,i)?C:""}else if(p.title==="Investigations"){const i=(l=(a=u==null?void 0:u.value)==null?void 0:a.labOrders)==null?void 0:l.saved,D=i==null?void 0:i.filter(_e=>N.toStandardHisFormat(e)===N.toStandardHisFormat(_e.order_date));n.value[s].icon=(D==null?void 0:D.length)>0?C:""}else if(p.title==="Diagnosis"){const i=w("diagnosis");n.value[s].icon=b(e,i)?C:""}else if(p.title==="Complications Screening"){const i=w("screening");n.value[s].icon=b(e,i)?C:""}else p.title==="Treatment Plan"&&(B.value.length>0?n.value[s].icon=tt()?C:"":n.value[s].icon="")}},b=(e,t)=>{const a=new Date(e);return a.setHours(0,0,0,0),t.some(l=>{const s=new Date(l.obs_datetime);return s.setHours(0,0,0,0),s.getTime()===a.getTime()})},De=async()=>{var s,p,i,D;const e=[],t=await X(ve.value),a=await mt(ge.value),l=await X(Se.value);t.length>0&&e.push({concept_id:await A.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:A.getSessionDate(),child:t}),a.length>0&&e.push({concept_id:await A.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:A.getSessionDate(),child:a}),l.length>0&&e.push(...l),e.length>0&&((D=(i=(p=(s=u.value).screening)!=null?p:s.screening={}).unsaved)!=null||(i.unsaved=[]),u.value.screening.unsaved.push(...e),je("Complications saved successfully"))},Ce=async()=>{const e=qe();if(!Q.isEmpty(e.selectedMedicalAllergiesList)){const t=J(),a=e.selectedMedicalAllergiesList.map(s=>({concept_id:985,obs_datetime:K.getSessionDate(),value_coded:s.concept_id,location_id:t.facilityLocation.code})),l=await at(a);await st(l),e.clearSelectedMedicalAllergiesList()}if(!Q.isEmpty(V.nonPharmalogicalTherapyAndOtherNotes)){const t=J(),a=[{concept_id:2688,obs_datetime:K.getSessionDate(),value_text:V.nonPharmalogicalTherapyAndOtherNotes,location_id:t.facilityLocation.code}];await nt(a)}await it(),await ot().saveNonPharmaTherapyPatientData()},W=async()=>{const e=[{ref:M,name:"Vitals"},{ref:z,name:"Risk Assessment"},{ref:O,name:"Investigations"},{ref:H,name:"Diagnosis"},{ref:$,name:"Complications Screening"},{ref:E,name:"Treatment Plan"},{ref:L,name:"Next Appointment"}];for(const t of e)if(t.ref.value&&typeof t.ref.value.onSubmit=="function")try{await t.ref.value.onSubmit()}catch(a){console.error("Error calling ".concat(t.name," onSubmit:"),a)}else console.log("".concat(t.name," component ref not available or no onSubmit method"));await Ce(),await De(),await Ge(),await We(u.value),await ye(),k.push("patientProfile")},ye=async()=>{await Ue(pt,{class:"small-confirm-modal "})!=="dismiss"&&await te()};return ke(async()=>{if(_.NCDActivities.length===0){k.push("patientProfile");return}I().resetScreening(),n.value=P(),await m(),(g.value===void 0||g.value<0)&&(g.value=0,console.log("Setting initial tab index to 0"))}),d(me,async()=>{await m()},{deep:!0}),d(u,async()=>{I().resetScreening(),await m()},{deep:!0}),d(F,async()=>{await m()},{deep:!0}),d(pe,async()=>{await m()},{deep:!0}),d(fe,async()=>{await m()},{deep:!0}),d(de,async()=>{await m()},{deep:!0}),d(B,async()=>{await m()},{deep:!0}),d(ae,async e=>{R(),G(),n.value=P()},{deep:!0}),d(u,async(e,t)=>{e.ID!=t.ID&&(R(),G())},{deep:!0}),Y({saveData:W,markWizard:m,refreshWizard:R}),(e,t)=>(j(),U(y(xe),null,{default:x(()=>[r($e),r(y(Te),{fullscreen:!0},{default:x(()=>[r(Je),c("div",dt,[T.value?(j(),U(ut,{key:0,ref:"wizard","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:{text:"Finish",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},"custom-tabs":n.value,beforeChange:y(Z),onChange:y(ee),"onComplete:wizard":t[1]||(t[1]=a=>W())},{default:x(()=>[c("div",null,[c("div",gt,[r(Ee,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:y(Re),"font-weight":"600",onClick:t[0]||(t[0]=a=>he())},null,8,["icon"])])]),S(c("div",null,[r(lt,{ref_key:"vitalsRef",ref:M},null,512)],512),[[h,v()=="Vitals"]]),S(c("div",null,[r(rt,{ref_key:"riskAssessmentRef",ref:z},null,512)],512),[[h,v()=="RiskAssessment"]]),S(c("div",null,[r(Ze,{ref_key:"investigationsRef",ref:O},null,512)],512),[[h,v()=="Investigations"]]),S(c("div",null,[r(Ke,{ref_key:"diagnosisRef",ref:H},null,512)],512),[[h,v()=="DiagnosisComponent"]]),S(c("div",null,[r(Qe,{ref_key:"complicationsRef",ref:$},null,512)],512),[[h,v()=="ComplicationsScreening"]]),S(c("div",null,[r(Xe,{ref_key:"treatmentPlanRef",ref:E},null,512)],512),[[h,v()=="TreatmentPlan"]]),S(c("div",null,[r(et,{ref_key:"nextAppointmentRef",ref:L},null,512)],512),[[h,v()=="NextAppointment"]])]),_:1},8,["custom-tabs","beforeChange","onChange"])):Pe("",!0)])]),_:1})]),_:1}))}});export{Jt as default};

import{d as O,y as fe,f as r,r as b,e as u,l as n,z as o,u as e,U as B,T,k as t,aU as L,W as A,I as M,a8 as ae,S as ie,aa as me,ab as ve,a9 as oe,V as le,F,X as re,au as ge,b2 as ye,c as V,a as ue,w as be,ap as he,ac as _e,m as p,G as ee,D as xe,B as g,aB as we,df as Ie,a3 as Ne,aY as Ce,aK as De,bp as Pe,A as U,L as ke,dx as $e,b5 as Me}from"./vendor-BzS-GRGX.js";import{u as ce,P as te,W as Se,am as Ve,_ as de,f as E,X as ne,S as se}from"./index-xmN8DORW.js";import{R as Oe}from"./Registration-BTDjuIgj.js";import{O as Ae}from"./Outcome-8JgPSUxD.js";import{c as Te,b as ze}from"./index-Bk28Y7lh.js";import"./lodash-Dt8AsbQm.js";const Ue=O({__name:"personalInformationModal",setup(s){return(C,I)=>(r(),fe(Oe,{editMode:!0}))}}),Be={style:{"font-weight":"400","font-size":"19px"}},Ee={style:{display:"flex","align-items":"center"}},Le={class:""},Fe={class:"center text_12"},Re=O({watch:{},name:"xxxComponent"}),je=O({...Re,props:{is_open:{},user_id:{}},emits:["closePopoover","save"],setup(s,{emit:C}){b("");const I=C;function N(){I("closePopoover",!1),re.dismiss()}return(f,c)=>(r(),u(F,null,[n(e(ie),null,{default:o(()=>[n(e(B),null,{default:o(()=>[n(e(T),null,{default:o(()=>c[1]||(c[1]=[t("div",{style:{display:"flex","align-items":"center"}},[t("b",{style:{"margin-left":"6px"}},"Patient Outcome")],-1)])),_:1,__:[1]}),n(e(L),{slot:"end"},{default:o(()=>[n(e(T),null,{default:o(()=>[n(e(A),{onClick:c[0]||(c[0]=_=>N()),fill:"solid"},{default:o(()=>[t("span",Be,[t("div",Ee,[n(e(M),{icon:e(ae),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),c[2]||(c[2]=t("span",{style:{"margin-left":"6px"}},"Close",-1))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(e(oe),{class:"ion-padding"},{default:o(()=>[t("div",Le,[t("div",Fe,[n(e(me),null,{default:o(()=>[n(e(ve),null,{default:o(()=>[n(Ae)]),_:1})]),_:1})])])]),_:1}),n(e(le),null,{default:o(()=>[n(e(B))]),_:1})],64))}}),qe={style:{display:"flex","align-items":"center"}},Ge={style:{"font-weight":"400","font-size":"19px"}},We={style:{display:"flex","align-items":"center"}},Xe={style:{"font-weight":"600","font-size":"17px"}},He={style:{"margin-top":"15px",width:"100%"}},Ke={key:0,class:"error-message"},Qe={key:1},Ye={slot:"start",class:"prefix-container"},Je=["value"],Ze={key:0,class:"error-message"},et={style:{"font-size":"16px","font-weight":"600px",color:"red"}},tt={key:1},nt={style:{"font-weight":"400","font-size":"19px"}},st={style:{display:"flex","align-items":"center"}},at={style:{"font-weight":"400","font-size":"20px"}},it={style:{display:"flex","align-items":"center"}},ot=O({name:"UpdateNCDNumberModal"}),lt=O({...ot,emits:["closePopoover","save"],setup(s,{emit:C}){const I=ge(),N=ce(),{patient:f}=ye(N),c=b(""),_=b(""),x=b(""),D=b(!1),z=new te;let w=null;const l=d=>{const i=d.target.value.replace(/[^0-9]/g,"");i!==d.target.value&&(D.value=!0,w&&clearTimeout(w),w=window.setTimeout(()=>{D.value=!1,w=null},3e3),c.value=i)},a=()=>{D.value=!1,w&&(clearTimeout(w),w=null)},m=V(()=>c.value&&c.value.trim()!==""),v=async()=>{try{const d=await Se.getNextSuggestedNCDNumber(),i=d.ncd_number.replace(/^\D+|\s/g,""),h=d.ncd_number.replace(/\d+/g,"")+"-NCD-";c.value=i,_.value=h}catch(d){console.error("Error fetching suggested NCD number:",d),x.value="Failed to fetch suggested NCD number (missing SITE Prefix)"}};ue(()=>{v()}),be(()=>f.value.ID,()=>{v()},{deep:!0});const S=C;function P(){S("closePopoover",!1),re.dismiss()}function k(d){try{console.log(d),I.push(d)}catch(i){console.error(i)}}async function $(){try{if(x.value="",!m.value){x.value="Please enter a valid NCD number";return}const d="".concat(_.value).concat(c.value),i=await te.findByID(f.value.patientID);for(const h of i.patient_identifiers)h.identifier_type===31&&(await z.updateNCDNumber(h.patient_identifier_id,d),S("save",{newNcdId:d}));await Ve(f.value),P()}catch(d){console.error(d)}}return(d,i)=>(r(),u(F,null,[n(e(ie),null,{default:o(()=>[n(e(B),null,{default:o(()=>[n(e(T),null,{default:o(()=>[t("div",qe,[n(e(M),{icon:e(he),class:"sub-menu-icon",style:{"font-size":"1.6rem"}},null,8,["icon"]),i[3]||(i[3]=t("b",{style:{"margin-left":"6px"}},"Update NCD Number",-1))])]),_:1}),n(e(L),{slot:"end"},{default:o(()=>[n(e(T),null,{default:o(()=>[n(e(A),{onClick:i[0]||(i[0]=h=>P()),fill:"solid"},{default:o(()=>[t("span",Ge,[t("div",We,[n(e(M),{icon:e(ae),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),i[4]||(i[4]=t("span",{style:{"margin-left":"6px"}},"Close",-1))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(e(oe),{class:"ion-padding"},{default:o(()=>[n(e(_e),null,{default:o(()=>[n(e(ee),{class:"current-ncd-item"},{default:o(()=>[n(e(xe),null,{default:o(()=>[i[5]||(i[5]=t("h2",null,"Current NCD Number",-1)),t("p",Xe,g(e(f).NcdID||"Not assigned"),1)]),_:1,__:[5]})]),_:1}),n(e(ee),null,{default:o(()=>[t("div",He,[D.value?(r(),u("div",Ke,[n(e(M),{icon:e(we),color:"danger"},null,8,["icon"]),i[6]||(i[6]=t("span",{style:{"font-size":"16px","font-weight":"600px",color:"red"}},"Only numbers are allowed",-1)),n(e(A),{fill:"clear",size:"small",onClick:a},{default:o(()=>[n(e(M),{icon:e(Ie)},null,8,["icon"])]),_:1})])):p("",!0),x.value?p("",!0):(r(),u("div",Qe,[i[7]||(i[7]=t("span",{style:{"font-weight":"600","font-size":"17px",color:"grey"}},"New NCD Number",-1)),n(e(Ne),{modelValue:c.value,"onUpdate:modelValue":i[1]||(i[1]=h=>c.value=h),placeholder:"Enter number",inputmode:"numeric",pattern:"[0-9]*",onInput:l,class:"custom-input"},{default:o(()=>[t("div",Ye,[t("input",{value:_.value,readonly:"",class:"prefix-part",type:"text"},null,8,Je)])]),_:1},8,["modelValue"])]))])]),_:1}),x.value?(r(),u("div",Ze,[n(e(Ce),{color:"danger"},{default:o(()=>[t("span",et,g(x.value),1)]),_:1})])):p("",!0),x.value?(r(),u("div",tt,[n(e(A),{onClick:i[2]||(i[2]=h=>k("setSitePrefix")),fill:"solid",style:{margin:"14px"}},{default:o(()=>[t("span",nt,[t("div",st,[n(e(M),{icon:e(De),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),i[8]||(i[8]=t("span",{style:{"margin-left":"6px"}},"set Site Prefix",-1))])])]),_:1})])):p("",!0)]),_:1})]),_:1}),n(e(le),null,{default:o(()=>[n(e(B),null,{default:o(()=>[n(e(L),{slot:"end"},{default:o(()=>[n(e(T),null,{default:o(()=>[n(e(A),{onClick:$,fill:"solid",disabled:!m.value},{default:o(()=>[t("span",at,[t("div",it,[n(e(M),{icon:e(Pe),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),i[9]||(i[9]=t("span",{style:{"margin-left":"6px"}},"Save",-1))])])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})],64))}}),rt=de(lt,[["__scopeId","data-v-28e133b4"]]),ut={key:0,style:{display:"flex","justify-content":"space-between",width:"100%"}},ct={key:0},dt={key:1,style:{"font-weight":"bold",padding:"1.7px"}},pt={key:1,style:{display:"flex","flex-wrap":"wrap",gap:"20px",width:"100%"}},ft={key:0},mt={key:1},vt={key:2},gt={key:2},yt={style:{display:"flex","flex-wrap":"wrap",gap:"8px",width:"100%"}},bt={key:3,style:{display:"flex","flex-wrap":"wrap",gap:"20px",width:"100%"}},ht={key:0},_t={key:1},xt={key:2},wt={key:3},It={key:4,style:{width:"100%","text-align":"center"}},Nt={key:0},Ct=O({__name:"ArtVisitLbl",props:{imageOut:{type:Object},patient:{type:Object}},emits:["label-out"],setup(s,{emit:C}){const I=C,N=b(null),f=b(0),c=s,_=V(()=>{var l;return(l=c.patient)!=null&&l.medications?c.patient.medications.filter(a=>a&&(a.name||a.dose||a.frequency||a.quantity)):[]}),x=V(()=>{var a,m;const l=(a=c.patient)==null?void 0:a.vitals;return l&&(l.height||l.weight||l.bloodPressure||((m=c.patient)==null?void 0:m.bloodGlucose))}),D=V(()=>{const l=_.value;if(l.length===0)return[];if(f.value===0)return l.slice(0,2);{const a=2+(f.value-1)*4;return l.slice(a,a+4)}});V(()=>{const l=_.value.length;if(l<=2)return!0;const a=l-2,m=Math.ceil(a/4);return f.value===m});const z=V(()=>{const l=_.value.length;if(l<=2)return 1;const a=l-2;return 1+Math.ceil(a/4)}),w=async()=>{const l=[];for(let a=0;a<z.value;a++){f.value=a,await new Promise(m=>setTimeout(m,100));try{const m=await $e.toPng(N.value,{height:300,width:594});l.push(m)}catch(m){console.error("Error generating image for page",a,m)}}return l};return ue(async()=>{try{const l=await w();I("label-out",l),typeof c.imageOut=="function"&&c.imageOut(l)}catch(l){console.error("Error generating patient labels:",l)}}),(l,a)=>{var m,v,S,P,k,$,d,i,h,R,j,q,G,W,X,H,K,Q,Y,J,Z;return r(),u("div",{ref_key:"lblComponent",ref:N,id:"container"},[f.value===0&&((m=s.patient)!=null&&m.latestVisitDate||(v=s.patient)!=null&&v.patientID)?(r(),u("div",ut,[(S=s.patient)!=null&&S.latestVisitDate?(r(),u("span",ct,[a[0]||(a[0]=t("b",null,"Visit:",-1)),U(" "+g(s.patient.latestVisitDate),1)])):p("",!0),(P=s.patient)!=null&&P.patientID?(r(),u("span",dt,g(s.patient.patientID),1)):p("",!0)])):p("",!0),f.value===0&&((k=s.patient)!=null&&k.patientName||($=s.patient)!=null&&$.gender||(d=s.patient)!=null&&d.diagnoses&&s.patient.diagnoses.length>0)?(r(),u("div",pt,[(i=s.patient)!=null&&i.patientName||(h=s.patient)!=null&&h.gender?(r(),u("span",ft,[t("b",null,g((R=s.patient)==null?void 0:R.patientName)+g((j=s.patient)!=null&&j.gender?"(".concat(s.patient.gender,")"):""),1)])):p("",!0),(q=s.patient)!=null&&q.prescriber?(r(),u("span",mt,[a[1]||(a[1]=t("b",null,"Seen by:",-1)),U(g(s.patient.prescriber),1)])):p("",!0),(G=s.patient)!=null&&G.nextAppointment?(r(),u("span",vt,[a[2]||(a[2]=t("b",null,"Nxt App:",-1)),U(" "+g(s.patient.nextAppointment),1)])):p("",!0)])):p("",!0),f.value===0&&((W=s.patient)!=null&&W.diagnoses)&&s.patient.diagnoses.length>0?(r(),u("div",gt,[t("span",yt,[a[3]||(a[3]=t("b",null,"Diagnoses:",-1)),U(" "+g(s.patient.diagnoses.filter(y=>y).join(", ")),1)])])):p("",!0),f.value===0&&x.value?(r(),u("div",bt,[(H=(X=s.patient)==null?void 0:X.vitals)!=null&&H.height?(r(),u("span",ht,g(s.patient.vitals.height),1)):p("",!0),(Q=(K=s.patient)==null?void 0:K.vitals)!=null&&Q.weight?(r(),u("span",_t,g(s.patient.vitals.weight),1)):p("",!0),(J=(Y=s.patient)==null?void 0:Y.vitals)!=null&&J.bloodPressure?(r(),u("span",xt,g(s.patient.vitals.bloodPressure),1)):p("",!0),(Z=s.patient)!=null&&Z.bloodGlucose?(r(),u("span",wt,g(s.patient.bloodGlucose),1)):p("",!0)])):p("",!0),D.value.length>0?(r(),u("table",It,[f.value===0?(r(),u("thead",Nt,a[4]||(a[4]=[t("tr",null,[t("th",null,"Drug"),t("th",null,"Dose"),t("th",null,"Freq"),t("th",null,"Qty")],-1)]))):p("",!0),t("tbody",null,[(r(!0),u(F,null,ke(D.value,(y,pe)=>(r(),u("tr",{key:pe},[t("td",null,g((y==null?void 0:y.name)||""),1),t("td",null,g((y==null?void 0:y.dose)||""),1),t("td",null,g((y==null?void 0:y.frequency)||""),1),t("td",null,g((y==null?void 0:y.quantity)||""),1)]))),128))])])):p("",!0)],512)}}}),Dt=de(Ct,[["__scopeId","data-v-777d67d0"]]);async function Pt(){await Te(Dt,{copies:1})}function At(){const s=b(Me.isNativePlatform()),C=b([]),I=b(null),N=b(!1),f=b(null),_=ce().patient;return{isMobile:s,visits:C,event:I,popoverOpen:N,program:f,patient:_,openPopover:v=>{I.value=v,N.value=!0},openPIM:()=>{E(Ue,{class:"fullScreenModal"})},openOutCome:()=>{E(je,{class:"large-modal-x10"})},printVisitSummary:async()=>{se.getProgramID()==1?await ze():se.getProgramID()==32?await Pt():new ne().printData("visit")},printID:()=>{new ne().printData("barcode")},formatCurrentAddress:v=>{var P,k,$;return[(P=v==null?void 0:v.personInformation)==null?void 0:P.current_district,(k=v==null?void 0:v.personInformation)==null?void 0:k.current_traditional_authority,($=v==null?void 0:v.personInformation)==null?void 0:$.current_village].filter(Boolean).join(",")},openUpdateNCDNUmbers:()=>{E(rt,{class:"large-modal-x10"})}}}export{Ue as _,At as u};

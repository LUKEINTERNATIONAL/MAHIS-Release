System.register(["./vendor-legacy-B0ctPPIE.js","./useFormWizard-legacy-BLkTDF4c.js","./index-legacy-BfHk0QIs.js","./DemographicBar-legacy-ByXJk-bb.js","./OPDOutcome-legacy-CEwvQFIf.js","./NextAppointment-legacy-B7d4MEDR.js","./OPDPrintingModal-legacy-Cnygp6wE.js","./lodash-legacy-pOOc9Efu.js","./usePatientProfile-legacy-zFkqOSXf.js","./Outcome-legacy-Dpfsz9DA.js","./apexcharts-legacy-BwM20G2n.js","./patient_complaints_service-legacy-D2W5NAVX.js","./DashBox-legacy-CY2U0sN-.js","./useExposeFromStandardForm-legacy-Bmrh-G6J.js","./BasicForm-legacy-BRppwWVs.js","./DateInputField-legacy-D5RDzLmf.js","./formatServerData-legacy-DxvHtfMg.js","./drug_prescription_service-legacy-BPhrTPBz.js","./drug_service-legacy-Bhu6-mnr.js","./lab_order-legacy-DNBr_3R1.js","./group_validation-legacy-BLnOnwQk.js","./ncd_appointment_service-legacy-93JZ4zPI.js","./Registration-legacy-kODKkCIg.js","./useLocation-legacy-DimDfak9.js","./vaccines_service-legacy-C1Hip323.js","./sms_service-legacy-CTU2d94J.js","./EIRreportsStore-legacy-BVtuVEy5.js","./Export-legacy-BPJfl4ii.js"],function(e,a){"use strict";var t,n,l,i,s,o,r,u,c,v,d,m,g,p,y,f,b,h,w,D,_,P,x,I,O,j,S,A,T,N,C,k,F,E,L,R,B,M,z,H,U,W,$,G,Q,Z,q,J,V,X,Y,K,ee,ae,te,ne,le,ie,se,oe,re,ue,ce,ve,de,me;return{setters:[e=>{t=e.d,n=e.ar,l=e.cl,i=e.r,s=e.a$,o=e.a,r=e.w,u=e.y,c=e.f,v=e.z,d=e.l,m=e.e,g=e.m,p=e.k,y=e.u,f=e.bM,b=e.d5,h=e.ah,w=e.i,D=e.bG,_=e.v,P=e.an,x=e.dI,I=e.bg},e=>{O=e.u,j=e._},e=>{S=e.u,A=e.aA,T=e.aO,N=e.a1,C=e.c,k=e.aC,F=e.M,E=e.a2,L=e.aP,R=e.aQ,B=e.T,M=e.D,z=e.t,H=e.y,U=e.m,W=e.a9,$=e.E,G=e.H,Q=e.aD,Z=e.ay,q=e.aR,J=e.S,V=e.k,X=e._},e=>{Y=e.D},e=>{K=e.C,ee=e.O,ae=e.a,te=e.b},e=>{ne=e.I,le=e.N,ie=e.T,se=e.s,oe=e.a,re=e.d,ue=e.b},e=>{ce=e.O},e=>{ve=e.l},e=>{de=e.u},e=>{me=e.S},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".disabled[data-v-fb36e59a]{color:red}.spinner-overlay[data-v-fb36e59a]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-fb36e59a]{width:80px;height:80px}.loading-text[data-v-fb36e59a]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-fb36e59a]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-fb36e59a]{pointer-events:none}.back_profile[data-v-fb36e59a]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(a);const ge={key:0,class:"spinner-overlay"},pe={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},ye={class:"back_profile"};e("default",X(t({__name:"ConsultationPlan",setup(e){const{currentTabIndex:a}=O("Consultation Plan"),{printVisitSummary:t}=de(),X=n(),fe=l(),be=i(!1),he=i(!0),we=i(!1),De=i(!1),_e=i(!0),Pe=i(!1),xe=i(!1),Ie=i(!1),Oe=S(),je=A(),Se=T(),Ae=N(),Te=C(),Ne=k(),Ce=F(),ke=E(),Fe=L(),Ee=R(),{patient:Le}=s(Oe),{investigations:Re}=s(je),{OPDdiagnosis:Be}=s(Se),{selectedMedicalDrugsList:Me,nonPharmalogicalTherapyAndOtherNotes:ze,selectedMedicalAllergiesList:He}=s(Ae),{OPDActivities:Ue}=s(Te),{outcomes:We}=s(Ne),{currentSelectedNextAppointmentDate:$e}=s(Fe),{presentingComplaints:Ge}=s(Ee),{vitals:Qe}=s(ke),Ze=i(null),qe=i(null),Je=i(null),Ve=i(null),Xe=i(null),Ye=i(null),Ke=i(null),ea=()=>Ue.value.map(e=>({title:e,icon:""})),aa=i(ea()),ta=i({}),na=async(e,t,n)=>{0===t&&await ca(),await oa()?(await ra(),e%1==0&&(a.value=e),Ke.value&&n&&Ke.value.changeTab(e)):z("Please add presenting complaints before proceeding.")},la=()=>{var e;if(!aa.value||0===aa.value.length)return null;const t=a.value>=0&&a.value<aa.value.length?a.value:0;switch(null===(e=aa.value[t])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(Ue.value.length>0)switch(Ue.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},ia=async()=>{De.value=!0,H("Printing consultation summary... Please wait.");try{await t(),H("Consultation summary printed successfully!"),setTimeout(()=>{X.push("home")},3500)}catch(e){U("Failed to print consultation summary.")}finally{De.value=!1}},sa=()=>{H("Patient has finished consultation!"),X.push("home")},oa=async()=>{const e=await W.getObsByEncounterIdAndDate($.PRESENTING_COMPLAINTS);return!!(e&&e.length>0)},ra=async()=>{const e=G.sessionDate();for(let t=0;t<aa.value.length;t++)if(await oa()){he.value=!0,we.value=!1;const n=aa.value[t];if(ta.value={title:"Untitled"},"Clinical Assessment"===n.title){const a=Q("presentingComplaints");aa.value[t].icon=ua(e,a)?I:""}else if("Investigations"===n.title){var a;const n=null===(a=Le.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,l=null==n?void 0:n.filter(a=>G.toStandardHisFormat(e)===G.toStandardHisFormat(a.order_date));aa.value[t].icon=(null==l?void 0:l.length)>0?I:""}else if("Diagnosis"===n.title){const a=Q("diagnosis");aa.value[t].icon=ua(e,a)?I:""}else if("Treatment Plan"===n.title){const e=Q("treatment");aa.value[t].icon=(null==e?void 0:e.length)>0?I:""}else if("Next Appointment"===n.title){const a=Q("appointments");aa.value[t].icon=ua(e,a)?I:""}else if("Outcome"===n.title){const e=Q("outcomes");aa.value[t].icon=(null==e?void 0:e.length)>0?I:""}}else he.value=!1,"Clinical Assessment"!==aa.value[t].title&&(aa.value[t].icon=x)},ua=(e,a)=>{if(!a)return!1;const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime||e.order_date);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},ca=async()=>{be.value=!0;try{var e;await Promise.all([null===(e=Ze.value)||void 0===e?void 0:e.onSubmit(),va()]),await Z(Le.value),q()}catch(a){throw console.error("Error saving clinical assessment:",a),U("Failed to save clinical assessment"),a}finally{be.value=!1}},va=async()=>{try{const e=localStorage.getItem("userID"),a=Le.value.patientID;if(!ve.isEmpty(He.value)){const t=da(),n=new ie;await n.onSubmitAllergies(a,e,t),await se(t)}}catch(e){console.error("Failed to save allergies:",e),z("Failed to save allergies")}},da=()=>He.value.map(e=>({concept_id:985,obs_datetime:J.getSessionDate(),value_coded:e.concept_id,location_id:Ce.facilityLocation.code})),ma=async()=>{try{var e;null!==(e=Je.value)&&void 0!==e&&e.onSubmit(),await(async()=>{try{const e=localStorage.getItem("userID"),a=Le.value.patientID,t=new ie;if(!ve.isEmpty(He.value)){const n=da();await t.onSubmitAllergies(a,e,n)}if(!ve.isEmpty(ze.value)){const e=[{concept_id:2688,obs_datetime:localStorage.getItem("sessionDate"),value_text:ze.value,location_id:Ce.facilityLocation.code}];await oe(e)}await re(),await ue().saveNonPharmaTherapyPatientData()}catch(e){console.error("Failed to save treatment plan:",e),z("Failed to save treatment plan")}})(),await Ne.saveOutcomPatientData(),await q(),await Z(Le.value);const a=localStorage.getItem("locationID"),t=localStorage.getItem("userRoles");if(!a)return void U("Location ID could not be found. Please check your settings.");const n=t?JSON.parse(t):[];n.some(e=>"Lab"===e.role)?(await me.movePatientToNextStage(Le.value.patientID,"LAB","CONSULTATION",a,Le.value.visitID||Le.value.visit_id),await V().refresh(a),await X.push("home"),H("Lab results submitted. Patient can return to consultation")):(await me.movePatientToNextStage(Le.value.patientID,"CONSULTATION","DISPENSATION",a,Le.value.visitID||Le.value.visit_id),await V().refresh(a),await X.push("home"),H("Consultation patient saved successfully."))}catch(a){console.error("Error saving consultation data:",a),U("Failed to save consultation data")}};return o(async()=>{0!==Ue.value.length?(aa.value=ea(),await ra(),(void 0===a.value||a.value<0)&&(a.value=0)):await X.push("home")}),r(Qe,async()=>{await ra()},{deep:!0}),r(Le,async()=>{await ra()},{deep:!0}),r(Re,async()=>{await ra()},{deep:!0}),r(Be,async()=>{await ra()},{deep:!0}),r(Me,async()=>{await ra()},{deep:!0}),r(We,async()=>{await ra()},{deep:!0}),r($e,async()=>{await ra()}),r(Ge,async()=>{await ra()},{deep:!0}),r(fe,async()=>{_e.value=!1,setTimeout(()=>{a.value=0,_e.value=!0},0)},{deep:!0}),r(Ie,e=>{xe.value=e,xe.value&&setTimeout(()=>{xe.value=!1},15e3)}),(e,a)=>(c(),u(y(P),null,{default:v(()=>[d(ce,{onYes:ia,onNo:sa,isOpen:Pe.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),be.value?(c(),m("div",ge,[d(y(f),{name:"bubbles"}),a[2]||(a[2]=p("div",{class:"loading-text"},"Please wait...",-1))])):g("",!0),d(y(b),{"is-open":De.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),d(B),d(y(h),{fullscreen:!0},{default:v(()=>[d(Y),p("div",pe,[_e.value?(c(),u(j,{key:0,ref_key:"wizard",ref:Ke,"vertical-tabs":"","navigable-tabs":he.value,"scrollable-tabs":"",startIndex:0,doneButton:{text:"Finish",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},nextButton:{disabled:we.value},"custom-tabs":aa.value,tabs:aa.value,onChange:na,"onComplete:wizard":a[1]||(a[1]=e=>ma())},{default:v(()=>[p("div",null,[p("div",ye,[d(M,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:y(D),"font-weight":"600",onClick:a[0]||(a[0]=e=>{X.push("home")})},null,8,["icon"])])]),w(p("div",null,[d(K,{ref_key:"clinicalAssessmentRef",ref:Ze},null,512)],512),[[_,"ClinicalAssessment"===la()]]),w(p("div",null,[d(ne,{ref_key:"investigationsRef",ref:qe},null,512)],512),[[_,"Investigations"===la()]]),w(p("div",null,[d(ee,{ref_key:"diagnosisRef",ref:Je},null,512)],512),[[_,"OPDDiagnosis"===la()]]),w(p("div",null,[d(ae,{ref_key:"treatmentPlanRef",ref:Ve},null,512)],512),[[_,"OPDTreatmentPlan"===la()]]),w(p("div",null,[d(le,{ref_key:"nextAppointmentRef",ref:Xe},null,512)],512),[[_,"NextAppointment"===la()]]),w(p("div",null,[d(te,{ref_key:"outcomeRef",ref:Ye},null,512)],512),[[_,"Outcome"===la()]])]),_:1},8,["navigable-tabs","nextButton","custom-tabs","tabs"])):g("",!0)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-fb36e59a"]]))}}});

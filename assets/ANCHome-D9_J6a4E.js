import{d as Y,r as y,a as zt,e as Ht,f as T,l as o,y as E,m as X,z as i,u as l,aL as D,k as p,D as q,A as S,B as k,aM as x,d8 as Rt,W as J,F as Ut,X as K,aa as B,b5 as Et,b8 as Jt,ad as Lt,cg as Zt,bH as Yt,cz as Wt,b0 as jt,aS as Gt,E as w}from"./vendor-Bx_IVmwz.js";import{u as V,H as I,S as it,P as tt,B as Qt,t as L,f as Xt,x as et,bj as qt,_ as rt,T as Kt,w as te,g as nt,k as ee,m as ne,ai as ae,Q as oe}from"./index-C_B4etN5.js";import{D as se}from"./DemographicBar-BJRfu0o2.js";import{N as ie,u as Z,a as re,L as le}from"./NextAppointmentModal-ChFQhtOq.js";import{S as ce}from"./SaveProgressModal-DFFuj7CT.js";import{F as pe}from"./FeatusModal-CGPh80er.js";import{f as ue}from"./formatServerData-BzcHYZIH.js";import{A as de}from"./app_encounter_service-CL70yiSF.js";import{u as F,A as at,a as me,v as ot}from"./vaccines_service-CXrAoPNg.js";import{S as st}from"./sms_service-DME6LzNo.js";import{R as fe}from"./relationship_service-CaoTKr6p.js";import{A as ge}from"./appointment_service-DIIxf7o3.js";import"./lodash-Dt8AsbQm.js";import"./EIRreportsStore-BlkYIFN9.js";import"./Export-DIPzHoQo.js";class he extends de{constructor(r,m){super(r,7,m)}}const ye={class:"lbl-ct"},De={class:"lbl-ct"},Ae={style:{"margin-right":"20px",color:"black"}},_e={style:{"font-size":"16px",color:"#666","margin-top":"5px"}},ve=Y({watch:{},name:"xxxComponent",computed:{...B(Z,["nextAppointmentDate"]),...B(V,["patient"])},methods:{handleInputData(a){qt(this.nextAppointmentDate,ie,a.name,a.value),this.handleDateOfScheduledAppointmentRange(a)},closeOutline(){return Et},handleDateOfScheduledAppointmentRange(a){const r=new Date,m=new Date(r);m.setDate(m.getDate()+1);const f=m.toISOString().split("T")[0],A=new Date(r);A.setDate(A.getDate()+32);const M=A.toISOString().split("T")[0];et(this.nextAppointmentDate,"Appointment date","minDate",f),et(this.nextAppointmentDate,"Appointment date","maxDate",M)}}}),we=Y({...ve,props:{patient_Id:{},encounter_Id:{}},setup(a){const r=V(),m=V(),f=y(),A=y(),M=y(!1),C=y(!1),P=I.toStandardHisDisplayFormat(it.getSessionDate()),g=y(!1),O=y(),$=y(0),N=y([]),_=[],v=a;async function lt(){await dt(),await _t();const e=await(v.patient_Id?new at(v.patient_Id):new at).createAppointment();pt(),ut(),j(),ct(e)}async function ct(t){if(N.value.length==0){L("No phone numbers available for sms reminder!");return}Array.isArray(t)&&t.length>0&&(C.value?await(await K.create({component:me,componentProps:{date:t[1],patient:t[0],modalaction:"saveAppointment"}})).present():await st.appointment(t[0],t[1]))}async function pt(){const t=Xt();t.setVaccineReload(!t.getVaccineReload())}async function ut(){const t=F();t.setAppointmentsReload(!t.getAppointmentsReload())}async function dt(){try{await ot(v.encounter_Id,"Rescheduled"),await ot(v.encounter_Id,"Rescheduled")}catch(t){}}zt(async()=>{F().clearAppointmentMent(),await At(),await mt()});async function mt(){try{const t=new tt,e=v.patient_Id!==void 0?v.patient_Id:t.getID(),n=await yt(e);if(_.length>0){const s=_[_.length-1];console.log(s),await ft(s,e)==!1&&(f.value=Q(s.vaccine.date_administered,G(n.age)),A.value=I.toStandardHisDisplayFormat(f.value),vt(f.value),wt(f.value),M.value=!0)}}catch(t){}}async function ft(t,e){try{const n=await tt.findByID(e),s=new Date(n.person.birthdate),u=Q(s,G(t.age)),c=gt(t.vaccine.date_administered),d=new Date(u);return console.log(W(c,d)),W(c,d)}catch(n){}}function gt(t){const e={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},n=t.split(/[:/ ]/),s="".concat(n[2],"-").concat(e[n[1]],"-").concat(n[0],"T").concat(n[3],":").concat(n[4],":").concat(n[5]);return new Date(s)}function W(t,e){const n=t.getFullYear(),s=t.getMonth(),u=t.getDate(),c=e.getFullYear(),d=e.getMonth(),b=e.getDate();return n!==c?n>c:s!==d?s>d:u>b}function ht(t){return t.forEach(e=>{e.antigens.forEach(n=>{n.status=="administered"&&_.push({age:e.age,vaccine:n})})}),_}async function yt(t){try{const e=m.vaccineSchedule;ht(e.vaccine_schedule);for(const n of e.vaccine_schedule)if(n.milestone_status==="current"||n.milestone_status==="upcoming")return n;return null}catch(e){return null}}async function Dt(t){try{const e=await ge.getDailiyAppointments(I.toStandardHisFormat(t),I.toStandardHisFormat(t));$.value=e.length+1}catch(e){}}function j(){K.dismiss()}async function At(){try{let t=await st.getConfigurations();C.value=t.show_sms_popup}catch(t){}}async function _t(){var t,e;try{const n=await fe.getRelationships(r.patient.patientID);if(n.length>0){const s=n[0].relation.person_attributes.find(u=>u.type.name=="Cell Phone Number");s&&N.value.push(s.value)}(e=(t=r.patient)==null?void 0:t.personInformation)!=null&&e.cell_phone_number&&N.value.push(r.patient.patientID)}catch(n){}}async function vt(t){const e=F(),n={counter:1,date:t};e.setAppointmentMent(n),g.value=!1,await Dt(t),g.value=!0,O.value=I.toStandardHisDisplayFormat(t)}function wt(t){const n=F().getAppointmentMents(),s=d=>{const b=new Date(d);return b.setHours(0,0,0,0),b.getTime()},u=s(new Date(t)),c=n.find(d=>s(new Date(d.date))===u);return c?c.counter:null}function G(t){const e=/(\d+)\s*(week|month|year)s?/i,n=t.match(e);if(!n)return"Invalid input format";const s=parseInt(n[1]);switch(n[2].toLowerCase()){case"week":return s*7;case"month":return s*30;case"year":return s*365;default:return"Invalid time unit"}}function Q(t,e){let n;if(t instanceof Date)n=new Date(t);else{const[h,U]=t.split(" "),[Ot,$t,Ft]=h.split("/"),[Tt,Bt,Vt]=U.split(":"),Pt={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};n=new Date(Number(Ft),Pt[$t],Number(Ot),Number(Tt),Number(Bt),Number(Vt))}n.setDate(n.getDate()+e);const s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=h=>String(h).padStart(2,"0"),d=s[n.getDay()],b=u[n.getMonth()],bt=c(n.getDate()),St=n.getFullYear(),xt=c(n.getHours()),Mt=c(n.getMinutes()),Nt=c(n.getSeconds()),z=-n.getTimezoneOffset(),It=Math.floor(Math.abs(z)/60),kt=Math.abs(z)%60,Ct="GMT".concat(z>=0?"+":"-").concat(c(It)).concat(c(kt)),H=Intl.DateTimeFormat().resolvedOptions().timeZone;let R;try{const h=new Intl.DateTimeFormat("en",{timeZone:H,timeZoneName:"long"}).formatToParts(n).find(U=>U.type==="timeZoneName");R=h?h.value:H}catch(h){console.error("Error getting localized time zone name:",h),R=H}return"Date ".concat(d," ").concat(b," ").concat(bt," ").concat(St," ").concat(xt,":").concat(Mt,":").concat(Nt," ").concat(Ct," (").concat(R,")")}return(t,e)=>(T(),Ht(Ut,null,[o(l(x),{style:{"margin-top":"10px"}},{default:i(()=>[o(l(D),{style:{"margin-left":"-3px"}},{default:i(()=>e[0]||(e[0]=[p("div",{class:"om",style:{"font-weight":"600",color:"#8d8686"}},"Set Next Appointment Date",-1)])),_:1,__:[0]}),o(l(D),{size:"6",style:{"text-align":"right"}},{default:i(()=>[o(l(q),{class:"lbl-tl",style:{"font-size":"13px"}},{default:i(()=>[e[1]||(e[1]=S(" Todays Date: ")),p("span",ye,k(l(P)),1)]),_:1,__:[1]})]),_:1})]),_:1}),o(l(x),{style:{"margin-top":"10px"}},{default:i(()=>[o(l(D),{style:{"margin-left":"-3px"}},{default:i(()=>e[2]||(e[2]=[p("div",{class:"om"},null,-1)])),_:1,__:[2]}),g.value?(T(),E(l(D),{key:0,size:"10",style:{"text-align":"right"}},{default:i(()=>[o(l(q),{class:"lbl-tl",style:{"font-size":"16px","font-weight":"500"}},{default:i(()=>[e[3]||(e[3]=S(" Total Appointments ")),p("span",De,"("+k(O.value)+")",1),e[4]||(e[4]=S(": ")),p("span",Ae,[o(l(Rt),{color:"primary",style:{"margin-bottom":"-5px","font-size":"15px"}},{default:i(()=>[S(k($.value),1)]),_:1})])]),_:1,__:[3,4]})]),_:1})):X("",!0)]),_:1}),o(l(x),{style:{"margin-top":"20px"}},{default:i(()=>[o(l(D),null,{default:i(()=>[o(Qt,{contentData:t.nextAppointmentDate,"onUpdate:selected":t.handleInputData,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:selected","onUpdate:inputValue"])]),_:1})]),_:1}),M.value?(T(),E(l(x),{key:0,style:{"margin-top":"0px","margin-bottom":"0px"}},{default:i(()=>[o(l(D),{style:{"background-color":"#f0f0f0",padding:"15px","border-radius":"8px","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)"}},{default:i(()=>[e[5]||(e[5]=p("div",{style:{"font-size":"17px",color:"#333","font-weight":"bold"}},"Suggested Date:",-1)),p("div",_e,k(A.value),1)]),_:1,__:[5]})]),_:1})):X("",!0),o(l(x),{style:{"margin-top":"10px","margin-bottom":"10px"}},{default:i(()=>[o(l(D),null,{default:i(()=>[o(l(J),{onClick:j,id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"}},{default:i(()=>e[6]||(e[6]=[S(" Cancel ")])),_:1,__:[6]})]),_:1}),o(l(D),{style:{"text-align":"right"}},{default:i(()=>[o(l(J),{onClick:lt,class:"btnText",fill:"solid",style:{width:"130px"}},{default:i(()=>e[7]||(e[7]=[S(" save ")])),_:1,__:[7]})]),_:1})]),_:1})],64))}}),be=rt(we,[["__scopeId","data-v-adf180ee"]]),Se=Y({name:"TB screening",components:{IonRow:x,IonButton:J,FeatusModal:pe,DynamicButton:te,IonContent:Lt,IonPage:Jt,Toolbar:Kt,DemographicBar:se,LandingPage:le,NextAppointmentModal:re},props:{backBtn:{type:String,default:"Back to profile"},backUrl:{type:String,default:""},contact:{type:String,default:""}},data(){return{isModalOpen:!1,dateOfAppointment:""}},mounted(){this.handleAppointment()},setup(){return{checkmark:Gt,pulseOutline:jt}},computed:{...B(Z,["nextAppointmentDate"]),...B(V,["patient"])},methods:{calendar(){return Wt},eye(){return Yt},chevronBackOutline(){return Zt},openBackController(){this.backUrl?this.$router.push(this.backUrl):nt(ce)},async handleAppointment(){const a=await oe.getFirstObsValue(this.patient.patientID,"Appointment date","value_text");this.dateOfAppointment=a},async saveData(){if(!await Z().validate()){ne("Next appointment date has errors");return}await this.saveDate(),this.closeAppointmentModal(),await this.$router.push("ANCHome"),await await ae()},async saveDate(){if(this.nextAppointmentDate.length>=0){const a=it.getUserID(),r=new he(this.patient.patientID,a);if(!await r.createEncounter())return L("Unable to create appointment date encounter");if(!await r.saveObservationList(await this.buildNextAppointment()))return L("Unable to create date!");ee("Client has been scheduled for next contact")}console.log(await this.buildNextAppointment())},openNextVaccineAppoinment(){nt(be,{class:"otherVitalsModal"},!1)},async buildNextAppointment(){return[...await ue(this.nextAppointmentDate)]},cancelModal(){this.closeAppointmentModal()},async nextAppointment(){this.toggleAppointmentModal()},toggleAppointmentModal(){this.isModalOpen=!this.isModalOpen},closeAppointmentModal(){this.isModalOpen=!1},previousContacts(){this.$router.push("/contacts")},navigateToContact(){this.$router.push("/contact")}}}),xe={class:"container"},Me={class:"back_profile"},Ne={class:"AppointmentDate"},Ie={style:{color:"#0b5ed7"}},ke={class:"button-container ion-justify-content-center ion-align-items-center"};function Ce(a,r,m,f,A,M){const C=w("Toolbar"),P=w("DemographicBar"),g=w("DynamicButton"),O=w("NextAppointmentModal"),$=w("LandingPage"),N=w("ion-content"),_=w("ion-page");return T(),E(_,null,{default:i(()=>[o(C),o(N,{fullscreen:!0},{default:i(()=>[o(P),p("div",xe,[p("div",Me,[o(g,{name:a.backBtn,iconSlot:"start",fill:"clear",icon:a.chevronBackOutline(),onClick:r[0]||(r[0]=v=>a.openBackController())},null,8,["name","icon"]),p("div",Ne,[r[1]||(r[1]=p("span",{style:{"font-size":"14px"}},"Appointment Date: ",-1)),p("b",Ie,k(a.dateOfAppointment||"Not scheduled"),1)])]),p("div",ke,[o(g,{style:{"padding-right":"1%"},name:"New ANC contact",iconSlot:"start",fill:"solid",icon:a.checkmark,onClick:a.navigateToContact},null,8,["icon","onClick"]),o(g,{style:{"padding-right":"1%"},name:"View ANC contacts",iconSlot:"start",fill:"solid",icon:a.eye(),onClick:a.previousContacts},null,8,["icon","onClick"]),o(g,{name:"Schedule next contact",iconSlot:"start",fill:"solid",icon:a.calendar(),onClick:a.nextAppointment},null,8,["icon","onClick"])]),o(O,{isOpen:a.isModalOpen,title:"",closeModalFunc:a.closeAppointmentModal,onYes:a.saveData,onNo:a.cancelModal},null,8,["isOpen","closeModalFunc","onYes","onNo"]),r[2]||(r[2]=p("hr",null,null,-1)),o($)])]),_:1})]),_:1})}const Ye=rt(Se,[["render",Ce],["__scopeId","data-v-75067a76"]]);export{Ye as default};

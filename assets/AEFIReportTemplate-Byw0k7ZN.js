import{d as O,bK as j,a0 as q,b1 as J,a1 as Q,ab as Y,cb as Z,aP as W,aO as X,E as ee,L as te,I as ne,aR as ae,a8 as B,aa as U,a9 as V,bh as oe,r as b,bq as se,c as T,a as ie,w as re,ar as le,bf as ce,d1 as de,aA as ue,az as pe,aI as me,Q as $,H as d,e as f,f as l,l as n,J as s,P,K as h,k as r,N as F,m as k,F as I,O as E,af as fe,ae as ge,Y as _e}from"./vendor-f_p5GZUu.js";import{B as he,H as ye,_ as z,P as R,u as ve,o as Ie,aI as we}from"./index-DzUJ3B4y.js";import{f as Pe,h as Ce}from"./vaccines_service-ByXSKhNB.js";import{E as S}from"./EIRreportsStore-DefHbVI2.js";import{b as Ee}from"./bottomNavBar-BFx_56xH.js";const be=O({name:"PersonCardComponent",components:{IonGrid:oe,IonRow:V,bottomNavBar:Ee,IonCol:U,BasicInputField:he,IonContent:B,IonCard:ae,IonHeader:ne,IonFooter:te,IonTitle:ee,IonCardContent:X,IonCardTitle:W,IonCardSubtitle:Z,IonList:Y,IonItem:Q,IonLabel:J,IonIcon:q,IonSpinner:j},props:{people:{type:Array,required:!0},headingText:{type:String,required:!0,default:"Provide heading text"}},setup(e){const t=b(""),u=b(!1),_=b(!1),a=b(""),o=se({page:1,itemsPerPage:6}),g=T(()=>{if(!t.value)return e.people;const i=new RegExp(t.value,"i");return e.people.filter(m=>i.test(m.given_name)||i.test(m.family_name))}),p=T(()=>{const i=(o.page-1)*o.itemsPerPage,m=i+o.itemsPerPage;return g.value.slice(i,m)}),c=i=>/^[a-zA-Z\s]*$/.test(i),v=i=>{const m=i.target;t.value=m.value,u.value=!c(t.value),o.page=1},y=async i=>{try{const m=await $.getTop();m&&m.dispatchEvent(new CustomEvent("view-client",{detail:{client_id:i}}))}catch(m){console.error("Error viewing patient profile:",m)}},D=async()=>{try{await $.dismiss()}catch(i){console.error("Error dismissing modal:",i)}},A=({page:i,itemsPerPage:m})=>{o.page=i,o.itemsPerPage=m},C=async()=>{_.value=!0,a.value="";try{await new Promise(i=>setTimeout(i,1e3)),_.value=!1}catch(i){_.value=!1,a.value="Failed to fetch data. Please try again.",console.error("Error fetching data:",i)}};return ie(()=>{C()}),re(t,()=>{o.page=1}),{calendarOutline:me,personOutline:pe,locationOutline:ue,eyeOutline:de,searchOutline:ce,alertCircleOutline:le,searchText:t,searchTextError:u,isLoading:_,error:a,displayPeople:g,paginatedItems:p,getBirthdateAge:ye.getBirthdateAge,searchTextUpdated:v,viewPatientProfile:y,dismiss:D,handlePaginationUpdate:A,pagination:o}}}),De={key:0,class:"loading-spinner"},Ae={key:1,class:"error-message"},Fe={key:2,class:"no-results"},Te={key:3,style:{"overflow-y":"auto"}},$e={class:"card-header"};function ke(e,t,u,_,a,o){const g=d("ion-title"),p=d("ion-col"),c=d("ion-row"),v=d("BasicInputField"),y=d("ion-label"),D=d("ion-header"),A=d("ion-spinner"),C=d("ion-icon"),i=d("ion-card-title"),m=d("ion-item"),N=d("ion-list"),M=d("ion-card-content"),L=d("ion-card"),x=d("ion-content"),G=d("bottomNavBar"),H=d("ion-button"),K=d("ion-footer");return l(),f(I,null,[n(D,null,{default:s(()=>[n(c,null,{default:s(()=>[n(p,{style:{padding:"1px"}},{default:s(()=>[n(g,{class:"modalTitle"},{default:s(()=>[P(h(e.headingText),1)]),_:1})]),_:1})]),_:1}),n(c,null,{default:s(()=>[n(p,{style:{"margin-left":"10px","margin-right":"10px"}},{default:s(()=>[n(v,{placeholder:"Find client",icon:e.searchOutline,inputValue:e.searchText,"onUpdate:inputValue":e.searchTextUpdated,minHeight:40},null,8,["icon","inputValue","onUpdate:inputValue"]),r("div",null,[e.searchTextError?(l(),F(y,{key:0,class:"error-label"},{default:s(()=>t[1]||(t[1]=[P(" Only letters allowed ",-1)])),_:1,__:[1]})):k("",!0)])]),_:1})]),_:1})]),_:1}),n(x,{fullscreen:!0,class:"ion-padding"},{default:s(()=>[e.isLoading?(l(),f("div",De,[n(A,{name:"crescent"})])):e.error?(l(),f("div",Ae,[n(C,{icon:e.alertCircleOutline},null,8,["icon"]),r("p",null,h(e.error),1)])):e.paginatedItems.length===0?(l(),f("div",Fe,t[2]||(t[2]=[r("p",null,"No results found",-1)]))):(l(),f("div",Te,[n(c,null,{default:s(()=>[(l(!0),f(I,null,E(e.paginatedItems,w=>(l(),F(p,{style:{width:"900px"},key:w.id},{default:s(()=>[n(L,{class:"person-card"},{default:s(()=>[n(M,{class:"person-card-23"},{default:s(()=>[r("div",$e,[r("div",null,[n(i,{style:{"font-size":"16px"}},{default:s(()=>[P(h(w.given_name)+" "+h(w.family_name),1)]),_:2},1024),n(y,{style:{"font-size":"17px"}},{default:s(()=>[P(h(e.getBirthdateAge(w.birthdate)),1)]),_:2},1024)]),n(C,{icon:e.eyeOutline,onClick:ze=>e.viewPatientProfile(w.patient_id),class:"eye-icon","aria-label":"View patient profile"},null,8,["icon","onClick"])]),n(N,{lines:"none",style:{"border-radius":"6px"}},{default:s(()=>[n(m,{class:"p-inf"},{default:s(()=>[n(C,{class:"eye-icon",icon:e.personOutline,slot:"start","aria-hidden":"true"},null,8,["icon"]),n(y,null,{default:s(()=>[t[3]||(t[3]=r("span",{class:"s-inf"},"Gender:",-1)),P(" "+h(w.gender),1)]),_:2,__:[3]},1024)]),_:2},1024),t[5]||(t[5]=r("hr",{class:"solid-line"},null,-1)),n(m,{class:"p-inf"},{default:s(()=>[n(C,{class:"eye-icon",icon:e.locationOutline,slot:"start","aria-hidden":"true"},null,8,["icon"]),n(y,null,{default:s(()=>[t[4]||(t[4]=r("span",{class:"s-inf"},"Village:",-1)),P(" "+h(w.city_village),1)]),_:2,__:[4]},1024)]),_:2},1024)]),_:2,__:[5]},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1}),n(K,{collapse:"fade",class:"ion-no-border"},{default:s(()=>[n(c,null,{default:s(()=>[n(p,null,{default:s(()=>[e.displayPeople.length>0?(l(),F(G,{key:0,style:{"margin-left":"20px","margin-right":"20px"},totalItems:e.displayPeople.length,currentPage:e.pagination.page,itemsPerPage:e.pagination.itemsPerPage,"onUpdate:pagination":e.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])):k("",!0)]),_:1})]),_:1}),n(c,null,{default:s(()=>[n(p,null,{default:s(()=>[n(H,{id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px","margin-left":"20px"},onClick:t[0]||(t[0]=w=>e.dismiss())},{default:s(()=>t[6]||(t[6]=[P(" Cancel ",-1)])),_:1,__:[6]})]),_:1})]),_:1})]),_:1})],64)}const Re=z(be,[["render",ke],["__scopeId","data-v-4ec49661"]]),Se=O({name:"TableComponent",components:{IonContent:B,IonPage:ge,IonRow:V,IonCol:U},data(){const e=b([]);return{route:"",vaccines:[],categories:[{name:"Minor AEFIs",cases:[]},{name:"Serious AEFIs",cases:[]}],personsDemoData:e}},watch:{$route:{async handler(e){e.name=="EIRReport"&&await this.initReport()},deep:!0}},computed:{...fe(S,["start_date","end_date","navigationPayload"])},async mounted(){await this.initReport()},methods:{async initReport(){this.vaccines=await this.UnderFiveImmunizations(),this.categories[0].cases=await this.getAEFIKnownList(this.categories[0].name,this.vaccines),this.categories[1].cases=await this.getAEFIKnownList(this.categories[1].name,this.vaccines),await this.initAefiReport(this.categories)},async initAefiReport(e){try{const t=await Ce(this.start_date,this.end_date),u=new Map;t.data.forEach(a=>{const o=u.get(a.concept_id)||new Map;a.drugs.forEach(g=>{const p=o.get(g.drug_inventory_id)||{count:0,personIds:new Set};o.set(g.drug_inventory_id,{count:p.count+1,personIds:new Set(p.personIds).add(a.person_id)})}),u.set(a.concept_id,o)}),e.forEach(a=>{a.cases.forEach(o=>{const g=u.get(o.concept_id);g&&o.data.forEach(p=>{const c=g.get(p.drug_id);c&&(p.count+=c.count,p.personIds=new Set([...p.personIds||[],...c.personIds]))})})}),S().setAEFIReportData({vaccines:this.vaccines,categories:this.categories})}catch(t){console.error("Error in initAefiReport:",t)}},async UnderFiveImmunizations(){const e=[];return(await Pe()).forEach(u=>{e.push(u)}),e},async getAEFIKnownList(e,t){const u=[];return(await we.getConceptSet(e)).forEach(a=>{const o=t.map(g=>({...g,count:0}));u.push({concept_id:a.concept_id,name:a.name,data:o})}),u.sort((a,o)=>a.name.localeCompare(o.name)),u},async openPersonCardComponent(e){this.personsDemoData.value=await this.getClientsDemoGraphicData(e);const t=[];this.personsDemoData.value.forEach(a=>{const o={...a[0].person,...a[0].person.addresses[0],...a[0].person.names[0],patient_id:a[0].patient_id};t.push(o)});const u=a=>{this.openPatientProfile(a.detail.client_id)},_={people:t,headingText:"Immunization (Client Drill Down | ".concat(this.navigationPayload.subTxt,")")};Ie(Re,{class:"large-modal"},!0,_,{"view-client":u})},async openPatientProfile(e){this.personsDemoData.value.forEach(async t=>{if(t[0].patient_id==e){await ve().setPatientRecord(t[0]),this.$router.push("patientProfile");return}})},async getClientsDemoGraphicData(e){try{const u=Array.from(e).map(async a=>{try{const o=await R.findByID(a);return!o||!o.patient_identifiers||o.patient_identifiers.length===0?(console.warn("No patient data or identifiers found for client ID: ".concat(a)),null):await R.findByNpid(o.patient_identifiers[0].identifier)}catch(o){return console.error("Error processing client ID ".concat(a,":"),o),null}});return(await Promise.all(u)).filter(a=>a!==null)}catch(t){throw console.error("Error in getClientsDemoGraphicData:",t),t}}}}),Oe=["colspan"],Be=["onClick"];function Ue(e,t,u,_,a,o){const g=d("ion-col"),p=d("ion-row");return l(),f(I,null,[n(p,null,{default:s(()=>[n(g,null,{default:s(()=>t[0]||(t[0]=[r("h1",{style:{width:"100%","text-align":"left","font-weight":"400"}},"Adverse Events Following Immunization - AEFI",-1)])),_:1,__:[0]})]),_:1}),r("table",null,[(l(!0),f(I,null,E(e.vaccines,(c,v)=>(l(),f("colgroup",{key:v},[r("col",{style:_e({width:100/e.vaccines.length+"%"})},null,4)]))),128)),r("thead",null,[r("tr",null,[t[1]||(t[1]=r("th",null,"Cases",-1)),(l(!0),f(I,null,E(e.vaccines,c=>(l(),f("th",{key:c},h(c.name),1))),128))])]),r("tbody",null,[(l(!0),f(I,null,E(e.categories,c=>(l(),f(I,{key:c.name},[r("tr",null,[r("td",{colspan:e.vaccines.length+1,id:"hugo"},[r("strong",null,h(c.name),1)],8,Oe)]),(l(!0),f(I,null,E(c.cases,v=>(l(),f("tr",{key:v.name},[r("td",null,h(v.name),1),(l(!0),f(I,null,E(v.data,y=>(l(),f("td",{key:y},[r("div",{style:{cursor:"pointer"},onClick:D=>e.openPersonCardComponent(y.personIds)},h(y.count),9,Be)]))),128))]))),128))],64))),128))])])],64)}const Ve=z(Se,[["render",Ue],["__scopeId","data-v-704cfbc0"]]),He=Object.freeze(Object.defineProperty({__proto__:null,default:Ve},Symbol.toStringTag,{value:"Module"}));export{Ve as A,Re as P,He as a};

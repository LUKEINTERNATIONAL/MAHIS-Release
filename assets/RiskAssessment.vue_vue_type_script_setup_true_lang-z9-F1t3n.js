import{d as F,b2 as V,r as l,c as A,a as R,E as i,e as m,f as _,k as t,l as a,z as n,u as x,G as B,A as C,F as b,L as O,B as H}from"./vendor-BBnHTtmR.js";import{u as I,ar as L,t as M,a7 as c,E as v,y as $,ax as G,H as P,i as W}from"./index-53Jeodb6.js";const z={class:"card-container"},J={class:"custom-card"},j={class:"ion-padding",slot:"content"},q={class:"table-responsive"},Y=F({__name:"RiskAssessment",setup(K,{expose:f}){const g=I(),{patient:Q}=V(g),d=l([]),S=l(W),h=["Substance","Answer","Date","Action"],y={responsive:!0,select:!1,layout:{topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1},k=A(()=>[{componentType:"Heading",name:"Substance use / Consumption",position:"center"},{componentType:"radioButtonField",header:"Smoking",name:"Smoking history",grid:{s:"3"},obsValueType:"value_coded",options:[{label:"Smoking",value:"Smoking"},{label:"Never",value:"Never"},{label:"Stopped",value:"Stopped"}]},{grid:{s:"2"}},{componentType:"radioButtonField",header:"Drinking alcohol",name:"Does the patient drink alcohol?",grid:{s:"3"},obsValueType:"value_coded",options:[{label:"Drinking",value:"Drinking"},{label:"Never",value:"Never"},{label:"Stopped",value:"Stopped"}]}]),r=l(null),D=async()=>{if(!r.value){console.error("Form reference is not available");return}const e=r.value.getFormValues();if(!(e["Smoking history"]&&e["Does the patient drink alcohol?"])){M("Risk assessment not saved");return}const o=await c.buildObsValuesWithEncounterType(e,v.ASSESSMENT);await c.buildSaveObs([o]),r.value.resetForm(),$("Risk assessment saved successful"),u()},u=async()=>{var o;const e=await c.getObsByEncounterId(v.ASSESSMENT);if(!e||!(e!=null&&e.obs)||((o=e==null?void 0:e.obs)==null?void 0:o.length)===0)return[];d.value=await Promise.all(e.obs.map(async s=>[s.concept_name||"",await G.getConceptName(s.value_coded)||"",P.toStandardHisFormat(s.obs_datetime),'<button class="btn btn-outline-danger btn-sm delete-btn" data-id=\''.concat(JSON.stringify(s),"'>\n                            ").concat(S.value.delete2,"</button>")]))};return R(async()=>{await u()}),f({validateForm:()=>{var e;return(e=r.value)==null?void 0:e.validateForm()},onSubmit:D}),(e,o)=>{const s=i("ion-label"),T=i("DataTable"),w=i("ion-accordion"),E=i("ion-accordion-group"),N=i("ion-row");return _(),m(b,null,[t("div",z,[t("div",J,[a(L,{formData:k.value,ref_key:"formRef",ref:r},null,8,["formData"])])]),a(N,null,{default:n(()=>[a(E,{ref:"accordionGroup",class:"previousView"},{default:n(()=>[a(w,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:n(()=>[a(x(B),{slot:"header",color:"light"},{default:n(()=>[a(s,{class:"previousLabel"},{default:n(()=>o[0]||(o[0]=[C("Previous Visits")])),_:1,__:[0]})]),_:1}),t("div",j,[t("div",q,[a(T,{ref:"dataTableRef",options:y,data:d.value,class:"display nowrap modern-table",width:"100%"},{default:n(()=>[t("thead",null,[t("tr",null,[(_(),m(b,null,O(h,p=>t("th",{key:p},H(p),1)),64))])])]),_:1},8,["data"])])])]),_:1})]),_:1},512)]),_:1})],64)}}});export{Y as _};

!function(){function t(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,e||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}System.register(["./index-legacy-7oXqeObQ.js","./lodash-legacy-pOOc9Efu.js","./vendor-legacy-Cd1x6k36.js","./sms_service-legacy-3TuqCEkj.js","./EIRreportsStore-legacy-B9wLO9Nn.js","./Export-legacy-BlG3I_jO.js"],function(e,n){"use strict";var a,i,o,s,r,l,d,c,u,p,m,g,f,v,h,_,y,b,w,D,x,S,A,M,I,$,F,J,N,E,k,z,P,T,O,C,V,j,R,H,L,U,B,Y,q;return{setters:[t=>{a=t.H,i=t.aL,o=t.u,s=t.S,r=t.aA,l=t.C,d=t._,c=t.P,u=t.t,p=t.j,m=t.h,g=t.A,f=t.O,v=t.m,h=t.d},t=>{_=t.l},t=>{y=t.R,b=t.d,w=t.aj,D=t.W,x=t.ak,S=t.G,A=t.ai,M=t.X,I=t.E,$=t.e,F=t.f,J=t.l,N=t.k,E=t.z,k=t.A,z=t.F,P=t.r,T=t.a,O=t.y,C=t.m,V=t.u,j=t.D,R=t.B,H=t.br},t=>{L=t.S},t=>{U=t.E},t=>{B=t.u,Y=t.F,q=t.e}],execute:function(){var n=document.createElement("style");n.textContent=".saveBtn[data-v-2bafd924]{display:flex;justify-content:space-between;margin:20px;align-items:center}ion-row.centered-content[data-v-2bafd924]{display:flex;justify-content:center;align-items:center;border-radius:10px}.text-container[data-v-2bafd924]{text-align:center;padding:20px}.text-container div[data-v-2bafd924]{margin-bottom:10px;font-family:Arial,sans-serif;color:#333}.text-container div[data-v-2bafd924]:last-child{margin-bottom:0}.ilbl[data-v-8927d721]{font-size:23px}.calender[data-v-8927d721]{--dp-cell-padding: 30px;--dp-menu-padding: 20px 5px;--dp-font-size: 18px}.card_content[data-v-8927d721]{width:100%}.dp__flex_display[data-v-8927d721]{display:inherit}.toggle-green[data-v-8927d721]{--toggle-bg-on: #006401;--toggle-border-on: #006401;--toggle-width: 6.3rem;--toggle-height: 1.9rem;--toggle-border: .525rem;--toggle-font-size: 1rem;margin-bottom:30px}.lbl-tl[data-v-8927d721]{min-width:20px;color:#b3b3b3!important;white-space:nowrap}.lbl-ct[data-v-8927d721]{white-space:nowrap;color:#08475e;font-size:14px}.btnText[data-v-8927d721]{font-style:normal;font-weight:500;font-size:14px}\n/*$vite$:1*/",document.head.appendChild(n),e({b:async function(){return await s.getJson("immunization/months_picker")},c:async function(){return await s.getJson("/immunization/vaccine_names")},d:async function(t,e){return await s.getJson("immunization/vaccines_administered",{start_date:t,end_date:e})},e:function(){try{const t=U(),e=f(),{activePlatformProfile:n}=B();let a=function(t){let e="Category,Static <1y,Static >1y,Outreach <1y,Outreach >1y\n";for(const n of t){e+=[ct(n.label),n.fixed.lessThan1y,n.fixed.moreThan1y,n.outreach.lessThan1y,n.outreach.moreThan1y].join(",")+"\n"}return e}(t.$state.immunizationMonthlyRepoartData);a+="\n",a+=function(t){let e="Cases,"+t.vaccines.map(t=>ct(t.name)).join(",")+"\n";for(const n of t.categories){e+=ct(n.name)+"\n";for(const t of n.cases){e+=[ct(t.name),...t.data.map(t=>t.count)].join(",")+"\n"}}return e}(t.$state.AEFIReportData),a+="\n",a+=`\n        Date Created: ${(new Date).toISOString().split("T")[0]}\n        Report Period: ${t.$state.navigationPayload.subTxt}\n        Site: ${e.$state.userFacilityName}`;const i=new Blob([a],{type:"text/csv;charset=utf-8;"}),o=`${e.$state.userFacilityName}_${t.$state.navigationPayload.subTxt}_${t.$state.navigationPayload.title}`;if(n.value.fileExport===Y.WEB){const t=document.createElement("a");t.href=window.URL.createObjectURL(i),t.setAttribute("download",`${o}.csv`),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}else n.value.fileExport===Y.FILE_SYSTEM?q(`${o}.csv`,i,"blob"):u("Platform not supported")}catch(t){console.error("Error exporting CSV:",t)}},f:async function(){return await s.getJson("immunization/under_five_immunizations_drugs")},g:async function(t,e){const n=await async function(t){try{let e;if(e=s.getUseIndexDBStatus()&&s.getModsStatus()?await v("genericVaccineSchedule"):await s.getJson("eir/schedule/generic",{paginate:!1}),e.length>0){if("M"==t)return e[0].genericVaccineSchedule.male_schedule;if("F"==t)return e[0].genericVaccineSchedule.female_schedule}else if(h().apiStatus){if(e=await s.getJson("eir/schedule/generic",{paginate:!1}),"M"==t)return e.male_schedule;if("F"==t)return e.female_schedule}}catch(e){return console.error("Error getting offline generic vaccine schedule",e),[]}}(t);return await async function(t,e){const n=new Date;return e.forEach(e=>{const a=e.age.toLowerCase();let i=null;if("at birth"===a)i=new Date(t);else if(a.includes("weeks")){const e=parseInt(a.split(" ")[0],10);i=new Date(t),i.setDate(t.getDate()+7*e)}else if(a.includes("months")){const e=parseInt(a.split(" ")[0],10);i=new Date(t),i.setMonth(t.getMonth()+e)}else if(a.includes("years")){const e=parseInt(a.split(" ")[0],10);i=new Date(t),i.setFullYear(t.getFullYear()+e)}i?i>n?e.milestone_status="upcoming":i.toDateString()===n.toDateString()?e.milestone_status="current":e.milestone_status="passed":e.milestone_status="unknown"}),{vaccine_schedule:e}}(new Date(e),n)},h:async function(t,e){return await s.getJson("immunization/aefi_report",{start_date:t,end_date:e})},i:function(t){return 1==function(t){const e=["Vit","Albendazole"],n=t.toLowerCase().split(/[\s,()]+/);return e.some(t=>t.toLowerCase().split(/[\s,()]+/).some(t=>n.some(e=>e.includes(t)||t.includes(e))))}(t.drug_name)},j:async function(t,e,n){const a=JSON.parse(JSON.stringify(t));let i=null==a?void 0:a.vaccineAdministration;i.orders.some(t=>t.drug_name===e.drug.drug_name)?(i.orders=i.orders.filter(t=>t.drug_name!==e.drug.drug_name),i.obs=i.obs.filter(t=>t.value_text!==e.drug.drug_name)):i.voided=[...null==i?void 0:i.voided,{reason:n,order_id:e.drug.order_id,drug_name:e.drug.drug_name}];lt(a,e.drug.drug_name,"pending",""),await r(a)},s:async function(t){const e=JSON.parse(JSON.stringify(t)),n=m();if(!_.isEmpty(n.getAdministeredVaccines())){var a,i;const t=function(){const t=m();return t.getAdministeredVaccines().map(t=>{var e,n;return{drug_name:(null==t||null===(e=t.drug_)||void 0===e||null===(e=e.drug)||void 0===e?void 0:e.drug_name)||(null==t||null===(n=t.drug_)||void 0===n?void 0:n.drug_name),drug_inventory_id:t.drug_id,equivalent_daily_dose:1,start_date:t.date_administered,auto_expire_date:dt(t.date_administered,1),units:"ml",instructions:"",dose:1,frequency:"Unknown",batch_number:t.batch_number||"Unknown",prn:0}})}(),o=await async function(){const t=m(),e=t.getAdministeredVaccines();return await Promise.all(e.map(async t=>{var e,n;return{concept_id:2876,value_text:(null==t||null===(e=t.drug_)||void 0===e||null===(e=e.drug)||void 0===e?void 0:e.drug_name)||(null==t||null===(n=t.drug_)||void 0===n?void 0:n.drug_name),obs_datetime:t.date_administered}}))}();let s=null==e?void 0:e.vaccineAdministration;s.orders=[...null==s?void 0:s.orders,...t],s.voided=s.voided.filter(e=>{var n;return e.drug_name!==(null===(n=t[0])||void 0===n?void 0:n.drug_name)}),s.obs=[...null==s?void 0:s.obs,...o],n.setVaccineReload(!n.getVaccineReload()),s.orders.length>0&&n.setLastVaccineAdminstredOnschedule(s.orders),lt(e,null===(a=t[0])||void 0===a?void 0:a.drug_name,"administered",null===(i=o[0])||void 0===i?void 0:i.obs_datetime),await r(e),l("Saved successful"),await async function(t){const e=m(),n=e.getLastVaccineAdminstredOnschedule();var a;n.length>0&&(null==t||null===(a=t.vaccineSchedule)||void 0===a||null===(a=a.vaccine_schedule)||void 0===a||a.forEach(t=>{1==t.antigens.every(t=>"administered"===t.status)&&t.antigens.forEach(t=>{t.drug_id==n[0].drug_inventory_id&&p(rt,{class:"otherVitalsModal"},!1)})}));e.setLastVaccineAdminstredOnschedule([])}(e)}},v:async function(t,e){return s.void(`/encounters/${t}`,{reason:e})}});const Z=e("u",y("immunizationAppointMentStore",{state:()=>({selectedAppointmentMent:[],selectedAppointmentMentForAppointmentsPage:"",AppointmentsReload:!1,startDate:a.sessionDate(),endDate:a.sessionDate()}),actions:{getAppointmentMents(){return this.selectedAppointmentMent},setAppointmentMent(t){this.selectedAppointmentMent.length=0,this.selectedAppointmentMent.push(t)},clearAppointmentMent(){this.selectedAppointmentMent.length=0},getSelectedAppointmentMentForAppointmentsPage(){return this.selectedAppointmentMentForAppointmentsPage},setSelectedAppointmentMentForAppointmentsPage(t){this.selectedAppointmentMentForAppointmentsPage=t},setAppointmentsReload(t){this.AppointmentsReload=t},getAppointmentsReload(){return this.AppointmentsReload},setStartEndDate(t,e){this.startDate=t,this.endDate=e},getStartEndDate(){return{startDate:this.startDate,endDate:this.endDate}}}}));class W extends i{constructor(e){const n=void 0!==e?e:W.getPatientID(),a=W.getProviderID();super(n,7,a),t(this,"patientID",void 0),t(this,"providerID",void 0),this.patientID=n,this.providerID=a}static getPatientID(){return o().patient.patientID}static getProviderID(){return s.getUserID()}async setPatientID(t){this.patientID=t}async createAppointment(t){var e;let n=JSON.parse(JSON.stringify(t));const i=[];Z().selectedAppointmentMent.forEach(t=>{const e=a.toStandardHisFormat(t.date);i.push(e)});const o=await this.buildValueDate("Appointment date",i[0]);return null==n||null===(e=n.appointments.unsaved)||void 0===e||e.push(o),await r(n),l("next Appointment Set Successfully"),i[0]}async getNextAppointment(){if(this.programID&&this.patientID)return i.getJson(`/programs/${this.programID}/patients/${this.patientID}/next_appointment_date`,{date:this.date})}async getDailiyAppointments(t){const e=i.getProgramID();return i.getJson(`/programs/${e}/booked_appointments`,{date:t,paginate:!1})}}e("A",W);const G=b({components:{IonRow:A,IonItem:S,IonList:x,IonButton:D,IonCol:w},props:{date:{type:String,required:!0},patient:{type:Number,required:!0},modalaction:{type:String,required:!0}},data(){return{formattedDate:a.toStandardHisFormat(this.date)}},methods:{async dismissModal(){await M.dismiss()},async sendSMS(){await M.dismiss("send-SMS")}}}),X={class:"saveBtn"};const K=e("a",d(G,[["render",function(t,e,n,a,i,o){const s=I("ion-row"),r=I("ion-button"),l=I("ion-col");return F(),$(z,null,[J(s,{class:"centered-content"},{default:E(()=>e[0]||(e[0]=[N("div",{class:"text-container"},[N("div",null,"Do you want to send SMS reminder?")],-1)])),_:1,__:[0]}),N("div",X,[J(s,null,{default:E(()=>[J(l,null,{default:E(()=>[J(r,{onClick:t.dismissModal,id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"}},{default:E(()=>e[1]||(e[1]=[k(" No ",-1)])),_:1,__:[1]},8,["onClick"])]),_:1}),J(l,null,{default:E(()=>[J(r,{onClick:t.sendSMS,class:"btnText",fill:"solid",style:{width:"130px","text-align":"right"}},{default:E(()=>e[2]||(e[2]=[k(" Yes ",-1)])),_:1,__:[2]},8,["onClick"])]),_:1})]),_:1})])],64)}],["__scopeId","data-v-2bafd924"]])),Q={class:"lbl-ct"},tt={class:"lbl-ct"},et={style:{"margin-right":"20px",color:"black"}},nt={key:0},at={style:{color:"#999"}},it={style:{"font-size":"16px",color:"#666","margin-top":"5px"}},ot=b({watch:{},name:"xxxComponent"}),st=b({...ot,props:{patient_Id:{},encounter_Id:{}},setup(t){const e=o(),n=P(),i=P(),l=P(!1),d=P(!1),f=a.toStandardHisDisplayFormat(s.getSessionDate()),v=P(!1),h=P(),_=P(0),y=P([]),b=[];function x(t){const e=new Date(s.getSessionDate());return e.setHours(0,0,0,0),t<e}const S=t;async function U(){if(Z().selectedAppointmentMent.length>0)try{await async function(){var t,n;const a=JSON.parse(JSON.stringify(e.patient.guardianInformation)),i=[...null==a?void 0:a.unsaved,...null==a?void 0:a.saved];i.length>0&&null!==(t=i[0])&&void 0!==t&&t.cell_phone_number&&y.value.push(null===(n=i[0])||void 0===n?void 0:n.cell_phone_number);e.patient.personInformation.cell_phone_number&&y.value.push(e.patient.personInformation.cell_phone_number)}();const t=new W,n=await t.createAppointment(e.patient);await async function(){const t=m();t.setVaccineReload(!t.getVaccineReload())}(),await async function(){const t=Z();t.setAppointmentsReload(!t.getAppointmentsReload())}(),await Y(),async function(t){if(0==y.value.length)return void u("No phone numbers available for sms reminder!");if(t){if("send-SMS"==await p(K,{class:"nationalIDModal"})){const n=JSON.parse(JSON.stringify(e.patient));n.sms={appointment_date:t},await r(n)}}}(n)}catch(t){}else u("please select next appointment date on the calendar")}function B(t,e){const n=t.getFullYear(),a=t.getMonth(),i=t.getDate(),o=e.getFullYear(),s=e.getMonth(),r=e.getDate();return n!==o?n>o:a!==s?a>s:i>r}async function Y(){try{await M.dismiss()}catch(t){console.error("Modal dismissal error:",t)}}async function q(t){const e={counter:1,date:t};Z().setAppointmentMent(e),v.value=!1,await async function(t){try{const e=await g.getDailiyAppointments(a.toStandardHisFormat(t),a.toStandardHisFormat(t));_.value=e.length}catch(e){}}(t),v.value=!0,h.value=a.toStandardHisDisplayFormat(t)}function G(t){const e=Z().getAppointmentMents(),n=t=>{const e=new Date(t);return e.setHours(0,0,0,0),e.getTime()},a=n(new Date(t)),i=e.find(t=>n(new Date(t.date))===a);return i?i.counter:null}function X(t){const e=t.match(/(\d+)\s*(week|month|year)s?/i);if(!e)return"Invalid input format";const n=parseInt(e[1]);switch(e[2].toLowerCase()){case"week":return 7*n;case"month":return 30*n;case"year":return 365*n;default:return"Invalid time unit"}}function ot(t,e){if("Invalid input format"==e)return"";let n;if(t instanceof Date)n=new Date(t);else{const[e,a]=t.split(" "),[i,o,s]=e.split("/"),[r,l,d]=a.split(":"),c={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};n=new Date(Number(s),c[o],Number(i),Number(r),Number(l),Number(d))}n.setDate(n.getDate()+e);const a=t=>String(t).padStart(2,"0"),i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n.getDay()],o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()],s=a(n.getDate()),r=n.getFullYear(),l=a(n.getHours()),d=a(n.getMinutes()),c=a(n.getSeconds()),u=-n.getTimezoneOffset(),p=Math.floor(Math.abs(u)/60),m=Math.abs(u)%60,g=`GMT${u>=0?"+":"-"}${a(p)}${a(m)}`,f=Intl.DateTimeFormat().resolvedOptions().timeZone;let v;try{const t=new Intl.DateTimeFormat("en",{timeZone:f,timeZoneName:"long"}).formatToParts(n).find(t=>"timeZoneName"===t.type);v=t?t.value:f}catch(h){console.error("Error getting localized time zone name:",h),v=f}return`Date ${i} ${o} ${s} ${r} ${l}:${d}:${c} ${g} (${v})`}return T(async()=>{Z().clearAppointmentMent(),await async function(){try{let t=await L.getConfigurations();d.value=t.show_sms_popup}catch(t){}}(),await async function(){try{const t=new c,o=(void 0!==S.patient_Id?S.patient_Id:t.getID(),await async function(){try{const t=e.patient.vaccineSchedule;t.vaccine_schedule.forEach(t=>{t.antigens.forEach(e=>{"administered"==e.status&&b.push({age:t.age,vaccine:e})})});for(const e of t.vaccine_schedule){if("current"===e.milestone_status)return e;if("upcoming"===e.milestone_status)return e}return null}catch(t){return null}}());if(b.length>0){const t=b[b.length-1];0==await async function(t){try{const n=ot(new Date(e.patient.personInformation.birthdate),X(t.age)),a=function(t){const e={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},n=t.split(/[:/ ]/),a=`${n[2]}-${e[n[1]]}-${n[0]}T${n[3]}:${n[4]}:${n[5]}`;return new Date(a)}(t.vaccine.date_administered),i=new Date(n);return console.log(B(a,i)),B(a,i)}catch(n){}}(t)&&(n.value=ot(t.vaccine.date_administered,X(o.age)),i.value=a.toStandardHisDisplayFormat(n.value),q(n.value),G(n.value),l.value=!0)}}catch(t){}}()}),(t,e)=>{const a=I("VueDatePicker");return F(),$(z,null,[J(V(A),{style:{"margin-top":"10px"}},{default:E(()=>[J(V(w),{style:{"margin-left":"-3px"}},{default:E(()=>e[1]||(e[1]=[N("div",{class:"om",style:{"font-weight":"600",color:"#8d8686"}},"Set Next Appointment Date",-1)])),_:1,__:[1]}),J(V(w),{size:"6",style:{"text-align":"right"}},{default:E(()=>[J(V(j),{class:"lbl-tl",style:{"font-size":"13"}},{default:E(()=>[e[2]||(e[2]=k(" Todays Date: ",-1)),N("span",Q,R(V(f)),1)]),_:1,__:[2]})]),_:1})]),_:1}),J(V(A),{style:{"margin-top":"10px"}},{default:E(()=>[J(V(w),{style:{"margin-left":"-3px"}},{default:E(()=>e[3]||(e[3]=[N("div",{class:"om"},null,-1)])),_:1,__:[3]}),v.value?(F(),O(V(w),{key:0,size:"10",style:{"text-align":"right"}},{default:E(()=>[J(V(j),{class:"lbl-tl",style:{"font-size":"16","font-weight":"500"}},{default:E(()=>[e[4]||(e[4]=k(" Total Appointments ",-1)),N("span",tt,"("+R(h.value)+")",1),e[5]||(e[5]=k(": ",-1)),N("span",et,[J(V(H),{color:"primary",style:{"margin-bottom":"-5px","font-size":"15px"}},{default:E(()=>[k(R(_.value),1)]),_:1})])]),_:1,__:[4,5]})]),_:1})):C("",!0)]),_:1}),J(V(A),{style:{"margin-top":"20px"}},{default:E(()=>[J(V(w),null,{default:E(()=>[J(a,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value=t),onDateUpdate:q,"enable-time-picker":!1,inline:"","auto-apply":"","disabled-dates":x},{day:E(({day:t,date:e})=>[(F(),$("p",nt,[k(R(t),1),N("sup",at,R(G(e)),1)]))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l.value?(F(),O(V(A),{key:0,style:{"margin-top":"0px","margin-bottom":"0px"}},{default:E(()=>[J(V(w),{style:{"background-color":"#f0f0f0",padding:"15px","border-radius":"8px","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)"}},{default:E(()=>[e[6]||(e[6]=N("div",{style:{"font-size":"17px",color:"#333","font-weight":"bold"}},"Suggested Date:",-1)),N("div",it,R(i.value),1)]),_:1,__:[6]})]),_:1})):C("",!0),J(V(A),{style:{"margin-top":"10px","margin-bottom":"10px"}},{default:E(()=>[J(V(w),null,{default:E(()=>[J(V(D),{onClick:Y,id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"}},{default:E(()=>e[7]||(e[7]=[k(" Cancel ",-1)])),_:1,__:[7]})]),_:1}),J(V(w),{style:{"text-align":"right"}},{default:E(()=>[J(V(D),{onClick:U,class:"btnText",fill:"solid",style:{width:"130px"}},{default:E(()=>e[8]||(e[8]=[k(" save ",-1)])),_:1,__:[8]})]),_:1})]),_:1})],64)}}}),rt=e("n",d(st,[["__scopeId","data-v-8927d721"]]));function lt(t,e,n,a){t.vaccineSchedule.vaccine_schedule.forEach(t=>{t.antigens.forEach(t=>{t.drug_name===e&&(t.status=n,t.date_administered=a)})})}function dt(t,e){const n=new Date(t);return n.setDate(n.getDate()+parseInt(e)),a.toStandardHisFormat(n)}function ct(t){return/[,"\n]/.test(t)?`"${t.replace(/"/g,'""')}"`:t}}}})}();

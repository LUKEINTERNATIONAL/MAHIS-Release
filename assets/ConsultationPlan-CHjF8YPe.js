import{d as ke,ak as Ae,cl as xe,r,c as Re,aT as g,w as l,a as Te,O as Q,f as Z,J as B,l as u,u as y,a8 as Pe,k as f,m as Ie,i as h,bC as Ne,v as D,ae as Be,b7 as C}from"./vendor-C-fC0sMU.js";import{aB as q,u as Ve,aC as $e,aD as Fe,aE as Me,c as ze,aF as He,f as Ee,Z as Le,d as We,T as je,M as Ge,Q as Ue,H as V,aG as A,aH as Je,aI as Ke,K as X,t as Qe,n as Ze,aJ as x,aK as qe,a0 as Xe,S as Ye}from"./index-DRzM1P0v.js";import{D as Oe}from"./DemographicBar-BXzOkvcl.js";import{u as $,D as et,C as tt,T as at}from"./TreatmentPlan-B8xc9NjO.js";import{u as st,I as nt,N as ot,M as it,s as rt,c as lt,a as ct}from"./NextAppointment-G_Udj5fv.js";import{_ as ut}from"./RiskAssessment.vue_vue_type_script_setup_true_lang-DzAJX3f-.js";import{_ as mt}from"./Vitals.vue_vue_type_script_setup_true_lang-Dpq5sVFk.js";import{u as ft,_ as vt}from"./useFormWizard-CcbFjnqB.js";import{l as dt}from"./lodash-NJiRuGo9.js";import{a as Y,b as gt}from"./formatServerData-CeGcZ-Bi.js";import{C as pt}from"./Registration-DAYBy1Qc.js";import{u as St}from"./usePatientProfile-DBOMV3wr.js";import"./apexcharts-DuXjb34J.js";import"./DashBox-DHzOsJq2.js";import"./BasicForm-CqumrQM8.js";import"./DateInputField-DJWBxUZg.js";import"./previousDiagnosis-8K_xTNNf.js";import"./group_validation-A7gpI9E7.js";import"./drug_service-DPVCS6Vq.js";import"./lab_order-Cfr_wyib.js";import"./drug_prescription_service-Ci7VPJQ2.js";import"./ncd_appointment_service-BEw0iFwH.js";import"./useLocation-CSTcKuKj.js";import"./useExposeFromStandardForm-DxqRXU-C.js";import"./vaccines_service-DsIZyFWq.js";import"./sms_service-Bp2OvGG2.js";import"./EIRreportsStore-FVN6Q6Ia.js";import"./Export-DBD0S8nr.js";import"./Outcome-CxtrwbqC.js";const ht={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},Dt={class:"back_profile"},Xt=ke({__name:"ConsultationPlan",setup(bt,{expose:O}){const{onTabBeforeChange:ee,onChangeCurrentTab:te,currentTabIndex:v}=ft("Consultation Plan"),{printVisitSummary:ae}=St(),R=Ae(),se=xe();r([]),r([]),r(!1);const T=r(!0),P=r(!1),S=r(!1),F=Re(()=>({text:S.value?"Saving...":"Finish",icon:S.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:P.value||S.value})),ne=q(),oe=Ve(),ie=$e(),re=Fe();Me();const le=st(),_=ze();He();const ce=Ee(),ue=$(),me=Le(),{patient:o}=g(oe),{vitals:fe}=g(ne),{investigations:ve}=g(ie),{diagnosis:de}=g(re),{substance:ge}=g(ce),{selectedNCDMedicationList:M}=g(le),{FootScreening:pe,visualScreening:Se,cvScreening:he}=g(ue),{sessionDate:z}=g(me),{apiStatus:Ct}=g(We());l(F,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:v.value,tabsLength:n.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),l(S,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const De=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},w=()=>{let e=!1;return p(),S.value&&(e=!0),P.value=e,!e},be=()=>{R.push("patientProfile")},I=()=>_.NCDActivities.map(e=>({title:e,icon:""})),n=r(I()),H=r(null),E=r(null),L=r(null),W=r(null),j=r(null),G=r(null),U=r(null),p=()=>{var a;if(!n.value||n.value.length===0)return console.log("Tabs not yet initialized"),null;const e=v.value>=0&&v.value<n.value.length?v.value:0;switch((a=n.value[e])==null?void 0:a.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(_.NCDActivities.length>0)switch(_.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},N=()=>{T.value=!1,setTimeout(()=>{v.value=0,T.value=!0},0)},J=()=>{const e=q();e.setVitals(e.getInitialVitals(o.value.ID))},d=async()=>{var a,m;const e=Ue(z.value,"sessionDate","value")||V.sessionDate(),t=A("vitals");for(let s=0;s<n.value.length;s++){const c=n.value[s];if(c.title==="Vital Signs")n.value[s].icon=k(e,t)?C:"";else if(c.title==="Risk Assessment"){const i=A("substanceAbuse");n.value[s].icon=k(e,i)?C:""}else if(c.title==="Investigations"){const i=(m=(a=o==null?void 0:o.value)==null?void 0:a.labOrders)==null?void 0:m.saved,b=i==null?void 0:i.filter(we=>V.toStandardHisFormat(e)===V.toStandardHisFormat(we.order_date));n.value[s].icon=(b==null?void 0:b.length)>0?C:""}else if(c.title==="Diagnosis"){const i=A("diagnosis");n.value[s].icon=k(e,i)?C:""}else if(c.title==="Complications Screening"){const i=A("screening");n.value[s].icon=k(e,i)?C:""}else c.title==="Treatment Plan"&&(M.value.length>0?n.value[s].icon=it()?C:"":n.value[s].icon="")}w()},k=(e,t)=>{const a=new Date(e);return a.setHours(0,0,0,0),t.some(m=>{const s=new Date(m.obs_datetime);return s.setHours(0,0,0,0),s.getTime()===a.getTime()})},Ce=async()=>{var s,c,i,b;const e=[],t=await Y(Se.value),a=await gt(pe.value),m=await Y(he.value);t.length>0&&e.push({concept_id:await x.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:x.getSessionDate(),child:t}),a.length>0&&e.push({concept_id:await x.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:x.getSessionDate(),child:a}),m.length>0&&e.push(...m),e.length>0&&((b=(i=(c=(s=o.value).screening)!=null?c:s.screening={}).unsaved)!=null||(i.unsaved=[]),o.value.screening.unsaved.push(...e),X("Complications saved successfully"))},ye=async()=>{const e=qe();if(!dt.isEmpty(e.selectedMedicalAllergiesList)){const m=Xe(),s=e.selectedMedicalAllergiesList.map(i=>({concept_id:i.concept_id,obs_datetime:Ye.getSessionDate(),value_coded:i.concept_id,location_id:m.facilityLocation.code,value_text:i.name})),c=await rt(s);o.value=Object.assign(o.value,c),console.log("Allergies staged successfully:",o.value),e.clearSelectedMedicalAllergiesList()}const t=await lt();o.value=Object.assign(o.value,t);const a=await ct().saveNonPharmaTherapyPatientData();o.value=Object.assign(o.value,a)},K=async()=>{S.value=!0;try{const e=[{ref:H,name:"Vitals"},{ref:E,name:"Risk Assessment"},{ref:L,name:"Investigations"},{ref:W,name:"Diagnosis"},{ref:j,name:"Complications Screening"},{ref:G,name:"Treatment Plan"},{ref:U,name:"Next Appointment"}];for(const t of e)if(t.ref.value&&typeof t.ref.value.onSubmit=="function")try{await t.ref.value.onSubmit()}catch(a){throw console.error("Error calling ".concat(t.name," onSubmit:"),a),a}else console.log("".concat(t.name," component ref not available or no onSubmit method"));await ye(),await Ce(),await Je(),await Ke(o.value),await _e(),X("Data saved successfully!"),R.push("patientProfile")}catch(e){console.error("Error saving data:",e),Qe("Error occurred while saving data. Please try again.")}finally{S.value=!1}},_e=async()=>{await Ze(pt,{class:"small-confirm-modal "})!=="dismiss"&&await ae()};return Te(async()=>{if(_.NCDActivities.length===0){R.push("patientProfile");return}$().resetScreening(),n.value=I(),await d(),(v.value===void 0||v.value<0)&&(v.value=0,console.log("Setting initial tab index to 0")),P.value=!1,w()}),l(v,async()=>{await w()}),l(fe,async()=>{await d()},{deep:!0}),l(o,async()=>{$().resetScreening(),await d()},{deep:!0}),l(z,async()=>{await d()},{deep:!0}),l(ve,async()=>{await d()},{deep:!0}),l(de,async()=>{await d()},{deep:!0}),l(ge,async()=>{await d()},{deep:!0}),l(M,async()=>{await d()},{deep:!0}),l(se,async e=>{N(),J(),n.value=I()},{deep:!0}),l(o,async(e,t)=>{e.ID!=t.ID&&(N(),J())},{deep:!0}),O({saveData:K,markWizard:d,refreshWizard:N,validateDoneButtonState:w}),(e,t)=>(Z(),Q(y(Be),null,{default:B(()=>[u(je),u(y(Pe),{fullscreen:!0},{default:B(()=>[u(Oe),f("div",ht,[T.value?(Z(),Q(vt,{key:0,ref:"wizard","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:F.value,"custom-tabs":n.value,beforeChange:y(ee),onChange:y(te),"onComplete:wizard":t[1]||(t[1]=a=>K()),onDoneButtonChanged:De},{default:B(()=>[f("div",null,[f("div",Dt,[u(Ge,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:y(Ne),"font-weight":"600",onClick:t[0]||(t[0]=a=>be())},null,8,["icon"])])]),h(f("div",null,[u(mt,{ref_key:"vitalsRef",ref:H},null,512)],512),[[D,p()=="Vitals"]]),h(f("div",null,[u(ut,{ref_key:"riskAssessmentRef",ref:E},null,512)],512),[[D,p()=="RiskAssessment"]]),h(f("div",null,[u(nt,{ref_key:"investigationsRef",ref:L},null,512)],512),[[D,p()=="Investigations"]]),h(f("div",null,[u(et,{ref_key:"diagnosisRef",ref:W},null,512)],512),[[D,p()=="DiagnosisComponent"]]),h(f("div",null,[u(tt,{ref_key:"complicationsRef",ref:j},null,512)],512),[[D,p()=="ComplicationsScreening"]]),h(f("div",null,[u(at,{ref_key:"treatmentPlanRef",ref:G},null,512)],512),[[D,p()=="TreatmentPlan"]]),h(f("div",null,[u(ot,{ref_key:"nextAppointmentRef",ref:U},null,512)],512),[[D,p()=="NextAppointment"]])]),_:1},8,["doneButton","custom-tabs","beforeChange","onChange"])):Ie("",!0)])]),_:1})]),_:1}))}});export{Xt as default};

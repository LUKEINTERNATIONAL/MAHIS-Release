var V=Object.defineProperty;var q=(n,t,e)=>t in n?V(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var m=(n,t,e)=>q(n,typeof t!="symbol"?t+"":t,e);import{c as C,r as y,eC as A,bS as T,bT as k,O as F,d as E,y as O,f as U,z as f,l as p,u as c,S as Y,U as z,b2 as H,W as L,I as G,aQ as N,T as W,A as J,B as K,ad as X,ez as Z,b7 as tt,eD as et}from"./vendor-CXKPF0xO.js";import{A as S,h as B,j as at,s as M,f as nt,k as rt,m as st,_ as ot,n as it,o as D,e as P,q as I}from"./index-BSejzNmf.js";import{l as w}from"./lodash-Dt8AsbQm.js";const v=y(""),g=y(""),$=y(""),lt=C(()=>"".concat(v.value||"-"," / ").concat(g.value||"-"));function ut(){v.value="v".concat(B.version),$.value=B.version}async function ct(){let t=await(await S.get("version")).json();g.value=t["System version"]||"-"}function dt(){const[n,t,e]=$.value.split("."),[s,r,a]=g.value.split(".");return!((parseInt(s)||0)<(parseInt(n)||0)||(parseInt(r)||0)<(parseInt(t)||0)||(parseInt(a)||0)<(parseInt(e)||0))}function pt(){return{appVersion:v,apiVersion:g,minApiVersion:$,fullVersion:lt,loadAppVersions:ut,loadApiVersion:ct,isValidApiVersion:dt}}const{appVersion:ft,apiVersion:ht}=pt(),{facilityUUID:mt}=nt();function bt(){const n=rt().getUser().username;return{encryption:{userPassword:n,ownerPassword:n,userPermissions:["print"]}}}function Q(n,t){return t||n.exportable!==!1}function _(n,t=!1){return n.filter(e=>Q(e,t)).map(e=>e.label)}function j(n,t,e=!1){return t.map(s=>n.filter(r=>Q(r,e)).map(r=>{let a=w.get(s,r.path,"");return typeof r.formatter=="function"&&a&&(a=r.formatter(a,s)),M("".concat(r.drillable&&Array.isArray(a)?a.length:a))}))}function gt(n){const{columns:t,rows:e,quarter:s,period:r,filters:a,safeMode:i}=n,o=_(t,i),u=j(t,A(e,(a==null?void 0:a.sort)||[]),i);let l=o.join(",")+"\n";return l+=u.map(d=>d.join(",")).join("\n"),l+="\nDate Created:  ".concat(F().format("DD/MMM/YYYY HH:MM:ss")),s&&(l+="\nQuarter: ".concat(s)),r&&(l+="\nQuarter: ".concat(r)),l+="\ne-Mastercard Version : ".concat(ft.value),l+="\nAPI Version ".concat(ht.value),l+="\nSite UUID: ".concat(mt),l}function Dt(n){const t=new Blob([gt(n)],{type:"text/csv;charset=utf-8;"}),e=document.createElement("a");e.href=window.URL.createObjectURL(t),e.setAttribute("download","".concat(n.filename,".csv")),document.body.appendChild(e),e.click(),document.body.removeChild(e)}function wt(n){const{filename:t,canHorizontalPageBreak:e,columns:s,rows:r,filters:a,safeMode:i}=n,o=[_(s,i)],u=j(s,A(r,(a==null?void 0:a.sort)||[]),i),l=i?bt():{},d=new T({...l}),h=d.splitTextToSize(M(t),180),x=h.length<=1?20:h.length*10;d.text(h,14,10);const b={startY:x,head:o,body:u};e&&(b.tableWidth="wrap",b.horizontalPageBreak=!0,b.horizontalPageBreakRepeat=0),k(d,b);const R="".concat(t,".pdf");d.save(R)}function At(n,t,e,s){return{label:"PDF",color:"primary",action:async(r,a,i,o)=>{let u=t&&await at("PDF may contain private data that will require a password to unlock, To access private data choose Secure PDF over Regular PDF",{header:"Security warning",confirmBtnLabel:"Secure PDF",cancelBtnLabel:"Regular PDF"});wt({rows:a,filters:i,columns:o,filename:n,safeMode:u})}}}function Ft(n,t,e){return{label:"CSV",color:"primary",action:async(s,r,a,i)=>{Dt({rows:r,filters:a,columns:i,quarter:t,period:e,filename:n})}}}const yt=E({__name:"DrilldownTable",props:{title:{type:String,default:"Drill down table"},rows:{type:Array,required:!0},columns:{type:Array,required:!1},actionButtons:{type:Array},rowActionButtons:{type:Array},config:{type:Object,default:()=>({showSubmitButton:!1})}},setup(n){return(t,e)=>(U(),O(c(tt),null,{default:f(()=>[p(c(Y),null,{default:f(()=>[p(c(z),null,{default:f(()=>[p(c(H),{slot:"end"},{default:f(()=>[p(c(L),{slot:"end",onClick:e[0]||(e[0]=s=>c(st).hide()),"icon-only":""},{default:f(()=>[p(c(G),{icon:c(N)},null,8,["icon"])]),_:1})]),_:1}),p(c(W),null,{default:f(()=>[J(K(n.title),1)]),_:1})]),_:1})]),_:1}),p(c(X),null,{default:f(()=>[p(c(Z),{rows:n.rows,columns:n.columns,config:n.config,"row-actions-buttons":n.rowActionButtons,"actions-buttons":n.actionButtons,color:"light"},null,8,["rows","columns","config","row-actions-buttons","actions-buttons"])]),_:1})]),_:1}))}}),St=ot(yt,[["__scopeId","data-v-dd3e8006"]]),vt=1,Mt=23;class Qt{constructor(){m(this,"date");m(this,"startDate");m(this,"endDate");m(this,"programId");m(this,"useDefaultParams");this.programId=vt,this.date=it(),this.endDate="",this.startDate="",this.useDefaultParams=!0}setDate(t){this.date=D(t)}setStartDate(t){this.startDate=D(t)}setEndDate(t){this.endDate=D(t)}getDateIntervalPeriod(){return this.startDate&&this.endDate?"".concat(P(this.startDate)," - ").concat(P(this.endDate)):"-"}buildParams(t){let e={};return this.useDefaultParams&&(e.date=this.date,e.program_id=this.programId),this.startDate&&(e.start_date=this.startDate),this.endDate&&(e.end_date=this.endDate),t&&(e={...e,...t}),e}async getReport(t,e){return(await S.get(I(t,this.buildParams(e)))).json()}static getReportQuarters(t=5){const e=[];let s=new Date,r=s.getFullYear();const a=r;s=new Date("".concat(a,"-").concat(s.getMonth()+1,"-").concat(s.getDate()," 00:00"));let o=this.getQtrByDate(s).qtr,u=0;for(o===4&&e.push(this.buildQtrObj("Q1",r+1));u<t;)u===0&&o<4&&e.push(this.buildQtrObj("Q".concat(o+1),r)),e.push(this.buildQtrObj("Q".concat(o),r)),o=o>0?o-=1:o,r=o==0?r-1:r,o=o==0?o+=4:o,u++;return e}static getQtrByDate(t){const e=this.getQuarterBounds(t.getFullYear());for(const s in e){const{start:r,end:a}=e[s];if(t>=new Date(r)&&t<=new Date(a))return e[s]}return null}static buildQtrObj(t,e){const s=this.getQuarterBounds(e),{start:r,end:a}=s[t];return{start:r,end:a,name:"".concat(t," ").concat(e)}}static getQuarterBounds(t){const e=a=>F("".concat(t,"-").concat(a,"-01")).daysInMonth(),s=a=>"".concat(t,"-").concat(a,"-01 00:00"),r=a=>"".concat(t,"-").concat(a,"-").concat(e(a)," 00:00");return{Q1:{qtr:1,start:s("01"),end:r("03")},Q2:{qtr:2,start:s("04"),end:r("06")},Q3:{qtr:3,start:s("07"),end:r("09")},Q4:{qtr:4,start:s("10"),end:r("12")}}}async getMaternalStatus(t,e="pepfar"){var a;if(w.isEmpty(t))return{FP:[],FBf:[]};const s=I("vl_maternal_status",this.buildParams({report_definition:e}));return(a=(await et.postJson(s,{patient_ids:t})).data)!=null?a:{FP:[],FBf:[]}}async buildMaternityAgreggateRows(t,e="pepfar"){const s=w.uniq(Object.values(t).flat(1).map(o=>o instanceof Object?o.patient_id:o)),r=Object.keys(t),a=await this.getMaternalStatus(s,e),i=a.FBf.concat(a.FP);return["FP","FNP","FBf"].map(o=>r.reduce((u,l)=>({[l]:t[l].filter(d=>{const h=d instanceof Object?d.patient_id:d;return o==="FNP"?!i.includes(h):a[o].includes(h)}),...u}),{ageGroup:"All",gender:o}))}}export{St as D,Mt as L,Qt as R,At as a,Dt as e,Ft as g};

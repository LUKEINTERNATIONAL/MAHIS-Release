System.register(["./vendor-legacy-BXa8kD6l.js","./useFormWizard-legacy-C0eAHfjs.js","./index-legacy-BM3w2e78.js","./DemographicBar-legacy-DHRH-qwY.js","./OPDOutcome-legacy-_95kjLOg.js","./NextAppointment-legacy-BKVatx_o.js","./OPDPrintingModal-legacy-C_qSSjyr.js","./lodash-legacy-C-x9g9Na.js","./usePatientProfile-legacy-CJ9uTXeL.js","./apexcharts-legacy-BTTocXvA.js","./patient_complaints_service-legacy-g1o_nL_d.js","./DashBox-legacy-Dt6Q8qQb.js","./BasicForm-legacy-CWVHh-lQ.js","./DateInputField-legacy-CUCKsFt6.js","./formatServerData-legacy-CNaUnxvT.js","./drug_prescription_service-legacy-B8D8eYC1.js","./Outcome-legacy---dZnq1w.js","./LabOrdersList-legacy-NjOR2s9u.js","./group_validation-legacy-CGsVVgsh.js","./ncd_appointment_service-legacy-lytR_LdJ.js","./Registration-legacy-D-aW6qDt.js","./useLocation-legacy-C-Cgnwp_.js","./vaccines_service-legacy-DAeYoIDJ.js","./sms_service-legacy-BUxkBtG4.js","./EIRreportsStore-legacy-BHK0UICf.js","./Export-legacy-ybDzPBgK.js"],(function(e,a){"use strict";var t,n,l,i,s,o,u,c,r,d,v,m,g,p,y,f,b,h,w,x,P,_,D,O,j,A,S,T,C,I,N,k,L,F,R,B,E,H,z,M,J,$,V,W,G,U,Y,q,K,Z,Q,X,ee,ae,te,ne,le,ie,se,oe,ue,ce,re,de,ve,me;return{setters:[e=>{t=e.d,n=e.an,l=e.cC,i=e.r,s=e.c,o=e.aV,u=e.a,c=e.w,r=e.O,d=e.f,v=e.J,m=e.l,g=e.e,p=e.m,y=e.k,f=e.u,b=e.bP,h=e.dm,w=e.a4,x=e.i,P=e.bG,_=e.v,D=e.a7,O=e.eB,j=e.b9},e=>{A=e.u,S=e._},e=>{T=e.u,C=e.aH,I=e.bL,N=e.aJ,k=e.d,L=e.aL,F=e.a1,R=e.aV,B=e.bt,E=e.bH,H=e.aR,z=e.T,M=e.K,J=e.J,$=e.v,V=e.ag,W=e.aW,G=e.H,U=e.aM,Y=e.aO,q=e.bN,K=e.t,Z=e.S,Q=e.bv,X=e.q,ee=e._},e=>{ae=e.D},e=>{te=e.C,ne=e.d,le=e.c,ie=e.O},e=>{se=e.I,oe=e.N,ue=e.s,ce=e.d,re=e.u},e=>{de=e.O},e=>{ve=e.l},e=>{me=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".disabled[data-v-9e14c0db]{color:red}.spinner-overlay[data-v-9e14c0db]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-9e14c0db]{width:80px;height:80px}.loading-text[data-v-9e14c0db]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-9e14c0db]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-9e14c0db]{pointer-events:none}.back_profile[data-v-9e14c0db]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(a);const ge={key:0,class:"spinner-overlay"},pe={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},ye={class:"back_profile"};e("default",ee(t({__name:"ConsultationPlan",setup(e){const{currentTabIndex:a}=A("Consultation Plan"),{printVisitSummary:t}=me(),ee=n(),fe=l(),be=i(!1),he=i(!0),we=i(!1),xe=i(!1),Pe=i(!0),_e=i(!1),De=i(!1),Oe=i(!1),je=T(),Ae=C(),Se=I(),Te=N(),Ce=k(),Ie=L(),Ne=F(),ke=R(),Le=B(),Fe=E(),Re=i(!1),Be=i(!1),Ee=s((()=>({text:Be.value?"Saving...":"Finish",icon:Be.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:Re.value||Be.value}))),{patient:He}=o(je),{investigations:ze}=o(Ae),{OPDdiagnosis:Me}=o(Se),{selectedMedicalDrugsList:Je,nonPharmalogicalTherapyAndOtherNotes:$e}=o(Te),{OPDActivities:Ve}=o(Ce),{outcomes:We}=o(Ie),{currentSelectedNextAppointmentDate:Ge}=o(Le),{presentingComplaints:Ue}=o(Fe),{vitals:Ye}=o(ke),qe=H(),Ke=s((()=>qe.selectedMedicalAllergiesList)),Ze=i(null),Qe=i(null),Xe=i(null),ea=i(null),aa=i(null),ta=i(null),na=i(null),la=()=>Ve.value.map((e=>({title:e,icon:""}))),ia=i(),sa=i({}),oa=async(e,t,n)=>{0===t&&await ga(),await da()&&(await va(),e%1==0&&(a.value=e),na.value&&n&&na.value.changeTab(e))},ua=()=>{var e;if(!ia.value||0===ia.value.length)return null;const t=a.value>=0&&a.value<ia.value.length?a.value:0;switch(null===(e=ia.value[t])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(Ve.value.length>0)switch(Ve.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},ca=async()=>{xe.value=!0,J("Printing consultation summary... Please wait.");try{await t(),J("Consultation summary printed successfully!"),setTimeout((()=>{ee.push("home")}),3500)}catch(e){$("Failed to print consultation summary.")}finally{xe.value=!1}},ra=()=>{J("Patient has finished consultation!"),ee.push("home")},da=async()=>{const e=await V.getObsByEncounterIdAndDate(W.PRESENTING_COMPLAINTS);return!!(e&&e.length>0)},va=async()=>{const e=G.sessionDate();for(let t=0;t<ia.value.length;t++)if(await da()){he.value=!0,we.value=!1;const n=ia.value[t];if(sa.value={title:"Untitled"},"Clinical Assessment"===n.title){const a=U("presentingComplaints");ia.value[t].icon=ma(e,a)?j:""}else if("Investigations"===n.title){var a;const n=null===(a=He.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,l=null==n?void 0:n.filter((a=>G.toStandardHisFormat(e)===G.toStandardHisFormat(a.order_date)));ia.value[t].icon=(null==l?void 0:l.length)>0?j:""}else if("Diagnosis"===n.title){const a=U("diagnosis");ia.value[t].icon=ma(e,a)?j:""}else if("Treatment Plan"===n.title){const e=U("treatment");ia.value[t].icon=(null==e?void 0:e.length)>0?j:""}else if("Next Appointment"===n.title){const a=U("appointments");ia.value[t].icon=ma(e,a)?j:""}else if("Outcome"===n.title){const e=U("outcomes");ia.value[t].icon=(null==e?void 0:e.length)>0?j:""}}else he.value=!1,"Clinical Assessment"!==ia.value[t].title&&(ia.value[t].icon=O);ba()},ma=(e,a)=>{if(!a)return!1;const t=new Date(e);return t.setHours(0,0,0,0),a.some((e=>{const a=new Date(e.obs_datetime||e.order_date);return a.setHours(0,0,0,0),a.getTime()===t.getTime()}))},ga=async()=>{be.value=!0;try{var e;await pa(),await Promise.all([null===(e=Ze.value)||void 0===e?void 0:e.onSubmit()]),await Y(He.value),q()}catch(a){throw console.error("Error saving clinical assessment:",a),$("Failed to save clinical assessment"),a}finally{be.value=!1}},pa=async()=>{try{if(!ve.isEmpty(Ke.value)){const e=ya(),a=await ue(e);je.setPatientRecord(a)}}catch(e){console.error("Failed to save allergies:",e),K("Failed to save allergies")}},ya=()=>Ke.value.map((e=>({concept_id:e.concept_id,obs_datetime:Z.getSessionDate(),value_coded:e.concept_id,location_id:Ne.facilityLocation.code,value_text:e.name}))),fa=async()=>{try{var e;Be.value=!0,null!==(e=Xe.value)&&void 0!==e&&e.onSubmit(),await(async()=>{try{const e=await ce();He.value=Object.assign(He.value,e);const a=await re().saveNonPharmaTherapyPatientData();He.value=Object.assign(He.value,a)}catch(e){console.error("Failed to save treatment plan:",e),K("Failed to save treatment plan")}})(),await Ie.saveOutcomPatientData(),await q(),await Y(He.value);const a=localStorage.getItem("locationID"),t=localStorage.getItem("userRoles");if(!a)return void $("Location ID could not be found. Please check your settings.");const n=t?JSON.parse(t):[];n.some((e=>"Lab"===e.role))?(await Q.addPatientToStage(He.value,"CONSULTATION"),await X().refresh(a),await ee.push("home"),J("Lab results submitted. Patient can return to consultation")):(await Q.addPatientToStage(He.value,"DISPENSATION"),await X().refresh(a),await ee.push("home"),J("Consultation patient saved successfully."))}catch(a){console.error("Error saving consultation data:",a),$("Failed to save consultation data"),await ee.push("home")}finally{Be.value=!1}};u((async()=>{0!==Ve.value.length?(ia.value=la(),await va(),(void 0===a.value||a.value<0)&&(a.value=0),Re.value=!1,ba()):await ee.push("home")})),c(a,(async()=>{await ba()})),c(Ye,(async()=>{await va()}),{deep:!0}),c(He,(async()=>{await va()}),{deep:!0}),c(ze,(async()=>{await va()}),{deep:!0}),c(Me,(async()=>{await va()}),{deep:!0}),c(Je,(async()=>{await va()}),{deep:!0}),c(We,(async()=>{await va()}),{deep:!0}),c(Ge,(async()=>{await va()})),c(Ue,(async()=>{await va()}),{deep:!0}),c(fe,(async()=>{Pe.value=!1,ia.value=la(),setTimeout((()=>{a.value=0,Pe.value=!0}),0)}),{deep:!0}),c(Oe,(e=>{De.value=e,De.value&&setTimeout((()=>{De.value=!1}),15e3)})),c(Ee,((e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:a.value,tabsLength:ia.value.length}),e.disabled!==(null==t?void 0:t.disabled)&&console.log("Done button "+(e.disabled?"disabled":"enabled")),e.text!==(null==t?void 0:t.text)&&console.log(`Done button text changed from "${null==t?void 0:t.text}" to "${e.text}"`)}),{deep:!0});const ba=()=>{let e=!1;return ua(),Be.value&&(e=!0),Re.value=e,!e};return(e,a)=>(d(),r(f(D),null,{default:v((()=>[m(de,{onYes:ca,onNo:ra,isOpen:_e.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),be.value?(d(),g("div",ge,[m(f(b),{name:"bubbles"}),a[2]||(a[2]=y("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),m(f(h),{"is-open":xe.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),m(z),m(f(w),{fullscreen:!0},{default:v((()=>[m(ae),y("div",pe,[Pe.value?(d(),r(S,{key:0,ref_key:"wizard",ref:na,"vertical-tabs":"","navigable-tabs":he.value,"scrollable-tabs":"",startIndex:0,doneButton:Ee.value,nextButton:{disabled:we.value},"custom-tabs":ia.value,tabs:ia.value,onChange:oa,"onComplete:wizard":a[1]||(a[1]=e=>fa())},{default:v((()=>[y("div",null,[y("div",ye,[m(M,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:f(P),"font-weight":"600",onClick:a[0]||(a[0]=e=>{ee.push("home")})},null,8,["icon"])])]),x(y("div",null,[m(te,{ref_key:"clinicalAssessmentRef",ref:Ze},null,512)],512),[[_,"ClinicalAssessment"===ua()]]),x(y("div",null,[m(se,{ref_key:"investigationsRef",ref:Qe},null,512)],512),[[_,"Investigations"===ua()]]),x(y("div",null,[m(ne,{ref_key:"diagnosisRef",ref:Xe},null,512)],512),[[_,"OPDDiagnosis"===ua()]]),x(y("div",null,[m(le,{ref_key:"treatmentPlanRef",ref:ea},null,512)],512),[[_,"OPDTreatmentPlan"===ua()]]),x(y("div",null,[m(oe,{ref_key:"nextAppointmentRef",ref:aa},null,512)],512),[[_,"NextAppointment"===ua()]]),x(y("div",null,[m(ie,{ref_key:"outcomeRef",ref:ta},null,512)],512),[[_,"Outcome"===ua()]])])),_:1},8,["navigable-tabs","doneButton","nextButton","custom-tabs","tabs"])):p("",!0)])])),_:1})])),_:1}))}}),[["__scopeId","data-v-9e14c0db"]]))}}}));

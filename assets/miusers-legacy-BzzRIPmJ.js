System.register(["./vendor-legacy-phTeNEOA.js","./NavigationMenu-legacy-DHjCP1X0.js","./EIRreportsStore-legacy-B6AukLGs.js","./bottomNavBar-legacy-CpSTWFcg.js","./index-legacy-41CLX9DW.js","./lodash-legacy-C-x9g9Na.js","./apexcharts-legacy-Daa5aA7l.js"],(function(e,a){"use strict";var t,l,r,s,n,o,i,u,c,d,m,f,v,p,g,h,y,b,w,x,_,U,k,T,N,S,C,F,E,B,A,O,I,$,P,D,V,M,j,z,L,q,R,G,J,Q,Y,H,K,Z,W,X,ee,ae,te,le,re,se,ne,oe,ie,ue,ce,de,me,fe,ve,pe,ge,he,ye,be,we,xe,_e,Ue,ke,Te,Ne,Se;return{setters:[e=>{t=e.dJ,l=e.dK,r=e.d,s=e.r,n=e.w,o=e.a,i=e.O,u=e.f,c=e.u,d=e.bg,m=e.J,f=e.l,v=e.I,p=e.G,g=e.E,h=e.Q,y=e.K,b=e.aY,w=e.N,x=e.L,_=e.a6,U=e.a7,k=e.k,T=e.e,N=e.m,S=e.a2,C=e.p,F=e.b0,E=e._,B=e.a4,A=e.a3,O=e.bn,I=e.F,$=e.P,P=e.bo,D=e.bq,V=e.M,M=e.c,j=e.aP,z=e.aO,L=e.dF,q=e.aN,R=e.ck,G=e.cN,J=e.d7,Q=e.bs,Y=e.c6,H=e.cw,K=e.aM,Z=e.dL,W=e.dM,X=e.dN,ee=e.dO,ae=e.dP,te=e.dQ,le=e.dR,re=e.dS,se=e.ai,ne=e.ci,oe=e.U,ie=e.a9,ue=e.bx,ce=e.dT,de=e.a8,me=e.d0,fe=e.d1,ve=e.cu,pe=e.aa},e=>{ge=e.N},e=>{he=e.E},e=>{ye=e.B},e=>{be=e.at,we=e.au,xe=e.a6,_e=e.U,Ue=e.av,ke=e.F,Te=e.H,Ne=e.s,Se=e._},null,null],execute:function(){var a=document.createElement("style");a.textContent="ion-modal[data-v-1b8f3b47]{--width: 90%;--height: 94%;--border-radius: 12px;--box-shadow: 0 28px 48px rgba(0, 0, 0, .4);--backdrop-opacity: var(--ion-backdrop-opacity, .32);--box-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1)}ion-radio-group[data-v-1b8f3b47]{width:100%}.form_el[data-v-1b8f3b47]{margin-right:10px;margin-left:10px;max-width:600px}.error-item[data-v-1b8f3b47]{--border-color: #ff4444 !important;--highlight-color: #ff4444 !important}.error-input[data-v-1b8f3b47]{--border-color: #ff4444 !important;--color: #ff4444 !important}.error-label[data-v-1b8f3b47]{color:#f44!important}.error-section[data-v-1b8f3b47]{border:1px solid #ff4444;border-radius:8px;padding:8px;margin-bottom:16px}.error-message[data-v-1b8f3b47]{color:#f44;font-size:14px;margin-left:16px;margin-top:4px;margin-bottom:12px}ion-item[data-v-1b8f3b47]{margin-bottom:8px}.search-section[data-v-fcbcffb9]{margin-bottom:16px}.search-section ion-segment[data-v-fcbcffb9]{margin-top:12px}.users-grid[data-v-fcbcffb9]{display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr));gap:16px;margin-bottom:20px}.user-card[data-v-fcbcffb9]{margin:0;box-shadow:0 2px 8px rgba(0,0,0,.1);transition:transform .2s ease,box-shadow .2s ease}.user-card[data-v-fcbcffb9]:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.15)}.user-header[data-v-fcbcffb9]{display:flex;align-items:flex-start;gap:12px}.user-info[data-v-fcbcffb9]{flex:1}.user-meta[data-v-fcbcffb9]{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px;font-size:12px;color:var(--ion-color-medium)}.meta-item[data-v-fcbcffb9]{display:flex;align-items:center;gap:4px}.meta-icon[data-v-fcbcffb9]{font-size:14px}.status-chip[data-v-fcbcffb9]{margin:4px 0 0}.user-details[data-v-fcbcffb9]{margin:16px 0;display:flex;flex-direction:column;gap:8px}.detail-item[data-v-fcbcffb9]{display:flex;align-items:flex-start;gap:8px;font-size:14px;color:var(--ion-color-medium);line-height:1.4}.detail-icon[data-v-fcbcffb9]{font-size:16px;color:var(--ion-color-primary);margin-top:2px;flex-shrink:0}.action-buttons[data-v-fcbcffb9]{display:flex;gap:8px;flex-wrap:wrap;margin-top:16px}.action-buttons ion-button[data-v-fcbcffb9]{flex:1;min-width:80px}.empty-state[data-v-fcbcffb9]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:64px 32px;text-align:center;color:var(--ion-color-medium)}.empty-icon[data-v-fcbcffb9]{font-size:64px;margin-bottom:16px;opacity:.5}@media (max-width: 768px){.users-grid[data-v-fcbcffb9]{grid-template-columns:1fr;gap:12px}.action-buttons[data-v-fcbcffb9]{flex-direction:column}.action-buttons ion-button[data-v-fcbcffb9]{width:100%}.user-header[data-v-fcbcffb9]{flex-direction:column;align-items:flex-start;gap:8px}.status-chip[data-v-fcbcffb9]{align-self:flex-end}.user-meta[data-v-fcbcffb9]{flex-direction:column;gap:4px}}.sticky-user-nav[data-v-5071b8a1]{position:sticky;top:0;z-index:1000;background:var(--ion-background-color, #ffffff);box-shadow:0 2px 4px rgba(0,0,0,.1);border-bottom:1px solid var(--ion-color-light, #e0e0e0)}\n/*$vite$:1*/",document.head.appendChild(a);const Ce="authToken",Fe="authTokenExpiry",Ee=(()=>{async function e(e){try{const a=await fetch("http://localhost:4000/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(null!=a&&a.ok){const e=await a.json();localStorage.setItem(Ce,e.access_token);const t=Date.now()+36e5;return localStorage.setItem(Fe,t.toString()),e}return void console.error("Login failed:",null==a?void 0:a.statusText)}catch(a){return void console.error("Login error:",a)}}function a(){return localStorage.getItem(Ce)}return{login:e,logout:function(){localStorage.removeItem(Ce),localStorage.removeItem(Fe)},getToken:a,isAuthenticated:function(){return!!a()},isTokenValid:function(){if(!a())return!1;const e=localStorage.getItem(Fe);return!!e&&Date.now()<parseInt(e,10)},autoLogin:async function(){const a={username:"admin",password:"admin123"};try{return!!(await e(a))}catch(t){return console.error("Auto-login failed:",t),!1}}}})(),Be=(e=>{var a,t;const l={testingMode:null!==(a=null==e?void 0:e.testingMode)&&void 0!==a&&a,testingBaseUrl:null!==(t=null==e?void 0:e.testingBaseUrl)&&void 0!==t?t:"http://localhost:4000/api",...e};async function r(e,a,t){0==Ee.isTokenValid()&&await Ee.autoLogin();const r=Ee.getToken(),s={"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`}};if(!l.testingMode)return t?await e(a,t,s):await e(a,s);{const r=`${l.testingBaseUrl}/${a}`,o={method:e.name.toUpperCase(),mode:"cors",headers:s,...t&&{body:JSON.stringify(t)}};try{return await fetch(r,o)}catch(n){return void console.error("Testing mode API call failed:",n)}}}async function s(e,a){0==Ee.isTokenValid()&&await Ee.autoLogin();const t=a?be.parameterizeUrl(e,a):e,r=Ee.getToken(),s={"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`}};if(!l.testingMode)return await we.get(t,s);{const t=a?`${l.testingBaseUrl}/${be.parameterizeUrl(e,a)}`:`${l.testingBaseUrl}/${e}`;try{return await fetch(t,{method:"GET",mode:"cors",headers:s})}catch(n){return void console.error("Testing mode API call failed:",n)}}}async function n(e,a){0==Ee.isTokenValid()&&await Ee.autoLogin();const t=`${e}/${a}`;return r(we.get,t)}return{getAll:s,getById:n,create:async function(e,a){return r(we.post,e,a)},update:async function(e,a,t){const l=`${e}/${a}`;return r(we.put,l,t)},deleteById:async function(e,a){const t=`${e}/${a}`;return r(we.remove,t,{})},bulkDelete:async function(e,a){const t=`${e}/bulk-delete`;return r(we.remove,t,{ids:a})},search:async function(e,a,t,l){return s(e,{...l,search:a,...t&&{search_fields:t.join(",")}})},paginate:async function(e,a=1,t=20,l){return s(e,{...l,page:a,per_page:t})},sort:async function(e,a,t="asc",l){return s(e,{...l,sort_by:a,sort_order:t})},filter:async function(e,a,t){return s(e,{...t,...a})},exists:async function(e,a){try{const t=await n(e,a);return(null==t?void 0:t.ok)||!1}catch(t){return!1}},count:async function(e,a){const t=`${e}/count`;return a?s(`${e}/count`,a):r(we.get,t)},customQuery:async function(e,a,t="GET",l){const s=`${e}/${a}`;switch(t.toUpperCase()){case"GET":return r(we.get,s);case"POST":return r(we.post,s,l||{});case"PUT":return r(we.put,s,l||{});case"DELETE":return r(we.remove,s,l||{});default:throw new Error(`Unsupported HTTP method: ${t}`)}},configure:function(e){Object.assign(l,e)},getConfig:function(){return{...l}}}})(),Ae=(()=>{const e=Be;return{getPrograms:async function(a){const t=await e.getAll("programs",a);if(null!=t&&t.ok)return await t.json();throw new Error("Failed to retrieve programs.")},getEMRPrograms:async function(){const e=await xe.getAllPrograms(),a=[];return e.forEach((e=>{a.push({name:e.name,other:e,selected:!1})})),e}}})(),Oe=(()=>{const e=Be;return{getUserRoles:async function(a){const t=await e.getAll("roles",a);if(null!=t&&t.ok)return await t.json();throw new Error("Failed to retrieve user roles.")},getEMRUserRoles:async function(){return await _e.getAllRoles()}}})(),Ie={key:0,class:"error-message"},$e={key:1,class:"error-message"},Pe={key:2,class:"error-message"},De={key:4,class:"error-message"},Ve={key:5,class:"error-message"},Me={key:0,class:"error-message"},je={style:{display:"flex",gap:"20px","margin-top":"8px"}},ze={key:6,class:"error-message"},Le={key:7,class:"error-message"},qe={key:8,class:"error-message"},Re={class:"form_el"},Ge=r({__name:"UserFormModal",props:{isOpen:{type:Boolean},editingUser:{}},emits:["save","close"],setup(e,{emit:a}){const t=e,l=a,r=s(!1),M=s(null),j=s([]),z=s({}),L=s(),q=s({name:!1,firstName:!1,lastName:!1,email:!1,password:!1,dateOfBirth:!1,gender:!1,roles:!1,programs:!1}),R=s({name:"",firstName:"",lastName:"",email:"",password:"",gender:"",roles:[],programs:[]}),G=s([]),J=s([]);function Q(e){const a=e.value.formattedDate;L.value=Te.toStandardHisFormat(a),q.value.dateOfBirth=!1}function Y(){M.value?r.value=!1:r.value=!0}const H=e=>{M.value=e.selected_location,Y()},K=()=>{R.value={name:"",firstName:"",lastName:"",email:"",password:"",dateOfBirth:"",gender:"",facility:null,roles:[],programs:[]},L.value=null,M.value=null,z.value={},r.value=!1,Object.keys(q.value).forEach((e=>{q.value[e]=!1}))};n((()=>R.value.name),(()=>{R.value.name.trim()&&(q.value.name=!1)})),n((()=>R.value.firstName),(()=>{R.value.firstName.trim()&&(q.value.firstName=!1)})),n((()=>R.value.lastName),(()=>{R.value.lastName.trim()&&(q.value.lastName=!1)})),n((()=>R.value.email),(()=>{R.value.email.trim()&&(q.value.email=!1)})),n((()=>R.value.password),(()=>{var e;null!==(e=R.value.password)&&void 0!==e&&e.trim()&&(q.value.password=!1)})),n((()=>R.value.gender),(()=>{R.value.gender&&(q.value.gender=!1)})),n((()=>R.value.roles),(()=>{R.value.roles.length>0&&(q.value.roles=!1)})),n((()=>R.value.programs),(()=>{R.value.programs.length>0&&(q.value.programs=!1)})),n((()=>t.editingUser),(e=>{if(e){const a=e.name.split(" "),t=a[0]||"",l=a.length>1?a.slice(1).join(" "):"";R.value={name:e.name,firstName:t,lastName:l,email:e.email,dateOfBirth:e.dateOfBirth||"",gender:e.gender||"",facility:e.facility||null,roles:e.roles,programs:e.programs},e.dateOfBirth&&(L.value=e.dateOfBirth),e.facility&&(M.value=e.facility,z.value=e.facility)}else K()}),{immediate:!0}),n((()=>t.isOpen),(e=>{e&&K()}));const Z=async()=>{const e=(()=>{var e;Object.keys(q.value).forEach((e=>{q.value[e]=!1}));let a=!0;return R.value.name.trim()||(q.value.name=!0,a=!1),R.value.firstName.trim()||(q.value.firstName=!0,a=!1),R.value.lastName.trim()||(q.value.lastName=!0,a=!1),R.value.email.trim()||(q.value.email=!0,a=!1),t.editingUser||null!==(e=R.value.password)&&void 0!==e&&e.trim()||(q.value.password=!0,a=!1),L.value||(q.value.dateOfBirth=!0,a=!1),R.value.gender||(q.value.gender=!0,a=!1),R.value.roles.length||(q.value.roles=!0,a=!1),R.value.programs.length||(q.value.programs=!0,a=!1),a})();if(Y(),!e||r.value)return void Ne("Please fill out all required fields.");const a={...R.value,dateOfBirth:L.value,facility:M.value};l("save",a)},W=()=>{l("close")};return o((()=>{K(),(async()=>{try{const e=Ae,a=await e.getEMRPrograms();G.value=a.map((e=>e.name))}catch(e){console.error("Failed to fetch programs:",e),Ne("Failed to load programs.")}})(),(async()=>{try{const e=Oe,a=await e.getEMRUserRoles();J.value=a.map((e=>e.role))}catch(e){Ne("Failed to load roles.")}})()})),(e,a)=>(u(),i(c(d),{"is-open":e.isOpen,onDidDismiss:W},{default:m((()=>[f(c(v),null,{default:m((()=>[f(c(p),null,{default:m((()=>[f(c(g),null,{default:m((()=>[h(y(e.editingUser?"Edit User":"Add New User"),1)])),_:1}),f(c(b),{slot:"end"},{default:m((()=>[f(c(w),{onClick:W,fill:"clear"},{default:m((()=>[f(c(x),{style:{"font-size":"35px"},icon:c(_)},null,8,["icon"])])),_:1})])),_:1})])),_:1})])),_:1}),f(c(U),{class:"ion-padding"},{default:m((()=>[k("form",{id:"user-form",onSubmit:D(Z,["prevent"])},[f(c(S),{class:C({"error-item":q.value.name})},{default:m((()=>[f(c(F),{modelValue:R.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>R.value.name=e),label:"Username","label-placement":"stacked",placeholder:"Enter username",required:"",class:C({"error-input":q.value.name})},null,8,["modelValue","class"])])),_:1},8,["class"]),q.value.name?(u(),T("div",Ie," Username is required ")):N("",!0),f(c(S),{class:C({"error-item":q.value.firstName})},{default:m((()=>[f(c(F),{modelValue:R.value.firstName,"onUpdate:modelValue":a[1]||(a[1]=e=>R.value.firstName=e),label:"First Name","label-placement":"stacked",placeholder:"Enter first name",required:"",class:C({"error-input":q.value.firstName})},null,8,["modelValue","class"])])),_:1},8,["class"]),q.value.firstName?(u(),T("div",$e," First name is required ")):N("",!0),f(c(S),{class:C({"error-item":q.value.lastName})},{default:m((()=>[f(c(F),{modelValue:R.value.lastName,"onUpdate:modelValue":a[2]||(a[2]=e=>R.value.lastName=e),label:"Last Name","label-placement":"stacked",placeholder:"Enter last name",required:"",class:C({"error-input":q.value.lastName})},null,8,["modelValue","class"])])),_:1},8,["class"]),q.value.lastName?(u(),T("div",Pe," Last name is required ")):N("",!0),e.editingUser?N("",!0):(u(),i(c(S),{key:3,class:C({"error-item":q.value.password})},{default:m((()=>[f(c(F),{modelValue:R.value.password,"onUpdate:modelValue":a[3]||(a[3]=e=>R.value.password=e),label:"Password","label-placement":"stacked",placeholder:"Enter password",type:"password",required:"",class:C({"error-input":q.value.password})},null,8,["modelValue","class"])])),_:1},8,["class"])),q.value.password&&!e.editingUser?(u(),T("div",De," Password is required ")):N("",!0),f(c(S),{class:C({"error-item":q.value.email})},{default:m((()=>[f(c(F),{modelValue:R.value.email,"onUpdate:modelValue":a[4]||(a[4]=e=>R.value.email=e),label:"Email","label-placement":"stacked",placeholder:"Enter email address",type:"email",required:"",class:C({"error-input":q.value.email})},null,8,["modelValue","class"])])),_:1},8,["class"]),q.value.email?(u(),T("div",Ve," Email is required ")):N("",!0),k("div",{class:C(["form_el",{"error-section":q.value.dateOfBirth}])},[k("h6",{style:{"font-size":"16px","font-weight":"400"},class:C({"error-label":q.value.dateOfBirth})}," Date Of Birth ",2),f(Ue,{place_holder:"Date Of Birth",onDateUpDated:Q,date_prop:""}),q.value.dateOfBirth?(u(),T("div",Me," Date of birth is required ")):N("",!0)],2),f(c(S),{class:C({"error-item":q.value.gender})},{default:m((()=>[f(c(E),{position:"stacked",class:C({"error-label":q.value.gender})},{default:m((()=>a[8]||(a[8]=[h("Gender")]))),_:1,__:[8]},8,["class"]),f(c(B),{modelValue:R.value.gender,"onUpdate:modelValue":a[5]||(a[5]=e=>R.value.gender=e)},{default:m((()=>[k("div",je,[f(c(S),{lines:"none",style:{"--padding-start":"0"}},{default:m((()=>[f(c(A),{slot:"start",value:"male"}),f(c(E),null,{default:m((()=>a[9]||(a[9]=[h("Male")]))),_:1,__:[9]})])),_:1}),f(c(S),{lines:"none",style:{"--padding-start":"0"}},{default:m((()=>[f(c(A),{slot:"start",value:"female"}),f(c(E),null,{default:m((()=>a[10]||(a[10]=[h("Female")]))),_:1,__:[10]})])),_:1})])])),_:1},8,["modelValue"])])),_:1},8,["class"]),q.value.gender?(u(),T("div",ze," Gender is required ")):N("",!0),f(c(S),{class:C({"error-item":q.value.roles})},{default:m((()=>[f(c(O),{modelValue:R.value.roles,"onUpdate:modelValue":a[6]||(a[6]=e=>R.value.roles=e),label:"Roles","label-placement":"stacked",placeholder:"Select roles",multiple:"",class:C({"error-input":q.value.roles})},{default:m((()=>[(u(!0),T(I,null,$(J.value,(e=>(u(),i(c(P),{key:e,value:e},{default:m((()=>[h(y(e),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue","class"])])),_:1},8,["class"]),q.value.roles?(u(),T("div",Le," At least one role is required ")):N("",!0),f(c(S),{class:C({"error-item":q.value.programs})},{default:m((()=>[f(c(O),{modelValue:R.value.programs,"onUpdate:modelValue":a[7]||(a[7]=e=>R.value.programs=e),label:"Programs","label-placement":"stacked",placeholder:"Select programs",multiple:"",class:C({"error-input":q.value.programs})},{default:m((()=>[(u(!0),T(I,null,$(G.value,(e=>(u(),i(c(P),{key:e,value:e},{default:m((()=>[h(y(e),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue","class"])])),_:1},8,["class"]),q.value.programs?(u(),T("div",qe," At least one program is required ")):N("",!0),k("div",Re,[a[11]||(a[11]=k("h6",{style:{"font-size":"16px","font-weight":"400"}},"Facility",-1)),f(ke,{show_error:r.value,onFacilitySelected:H,selected_district_ids:j.value,selected_location:z.value},null,8,["show_error","selected_district_ids","selected_location"])])],32)])),_:1}),f(c(V),null,{default:m((()=>[f(c(p),null,{default:m((()=>[f(c(b),{slot:"end"},{default:m((()=>[k("div",null,[f(c(w),{onClick:W,fill:"solid"},{default:m((()=>a[12]||(a[12]=[h(" Cancel ")]))),_:1,__:[12]}),f(c(w),{onClick:Z,fill:"solid",style:{"margin-left":"10px","margin-right":"10px"}},{default:m((()=>[h(y(e.editingUser?"Update":"Create")+" User ",1)])),_:1})])])),_:1})])),_:1})])),_:1})])),_:1},8,["is-open"]))}}),Je=Se(Ge,[["__scopeId","data-v-1b8f3b47"]]),Qe=(()=>{const e="users",a=Be;return{register:async function(t){const l=await a.customQuery(e,"register","POST",t);if(null!=l&&l.ok)return await l.json();throw new Error("Failed to register user.")},getUserById:async function(t){const l=await a.getById(e,t);if(null!=l&&l.ok)return await l.json();throw new Error(`User with ID ${t} not found.`)},updatePassword:async function(t,l){const r=await a.update(e,t,l);if(null==r||!r.ok)throw new Error("Failed to update password.")},getUsers:async function(){const t=await a.getAll(e);if(null!=t&&t.ok)return await t.json();throw new Error("Failed to fetch users.")}}})(),Ye={class:"users-grid"},He={class:"user-header"},Ke=["src","alt"],Ze={class:"user-info"},We={key:0,class:"user-meta"},Xe={key:0,class:"meta-item"},ea={key:1,class:"meta-item"},aa={class:"user-details"},ta={key:0,class:"detail-item"},la={key:1,class:"detail-item"},ra={key:2,class:"detail-item"},sa={class:"detail-item"},na={class:"detail-item"},oa={class:"action-buttons"},ia={key:0,class:"empty-state"},ua=r({__name:"miUsersTemplate",props:{initialSearchTerm:{default:""},initialStatusFilter:{default:"all"},initialItemsPerPage:{default:6},enableSearch:{type:Boolean,default:!0},enableStatusFilter:{type:Boolean,default:!0},enablePagination:{type:Boolean,default:!0},searchPlaceholder:{default:"Search users..."},searchDebounceTime:{default:300}},emits:["search-changed","status-filter-changed","users-filtered","user-edited","user-deleted","user-status-changed","user-created"],setup(e,{expose:a,emit:r}){const d=e,v=r,p=s([]),g=s(d.initialSearchTerm),b=s(d.initialStatusFilter),_=s(1),S=s(d.initialItemsPerPage),C=s(!1),F=s(null);let B=null;const A=e=>{var a,r,s,n,o;const{getAvatarUrl:i}=function(){const e=()=>{let e="";for(let a=0;a<6;a++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e};return{getAvatarUrl:(a,r=128)=>{const s=t(l,{seed:`${a}`,size:r,backgroundColor:[e()]}).toString(),n=unescape(encodeURIComponent(s));return`data:image/svg+xml;base64,${btoa(n)}`}}}();return{id:e.id,name:e.username,email:e.username,dateOfBirth:null===(a=e.profile)||void 0===a?void 0:a.dateOfBirth,gender:null===(r=e.profile)||void 0===r?void 0:r.gender,facility:null!==(s=e.facilities)&&void 0!==s&&null!==(s=s[0])&&void 0!==s&&s.facility?{name:e.facilities[0].facility.facility_name,code:e.facilities[0].facility.facility_code}:null,roles:(null===(n=e.roles)||void 0===n?void 0:n.map((e=>e.role.name)))||[],programs:(null===(o=e.programs)||void 0===o?void 0:o.map((e=>e.program.name)))||[],status:"active",avatar:i(e.username),createdAt:new Date(e.createdAt),lastActive:new Date(e.updatedAt)}},O=M((()=>{let e=p.value;if(d.enableSearch&&g.value){const a=g.value.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(a)||e.email.toLowerCase().includes(a)||e.roles&&e.roles.some((e=>e.toLowerCase().includes(a)))||e.programs&&e.programs.some((e=>e.toLowerCase().includes(a)))||e.gender&&e.gender.toLowerCase().includes(a)||e.facility&&e.facility.name&&e.facility.name.toLowerCase().includes(a)))}return d.enableStatusFilter&&"all"!==b.value&&(e=e.filter((e=>e.status===b.value))),e})),P=M((()=>{if(!d.enablePagination)return O.value;const e=(_.value-1)*S.value,a=e+S.value;return O.value.slice(e,a)}));n((()=>g.value),(e=>{B&&clearTimeout(B),B=setTimeout((()=>{v("search-changed",e),_.value=1}),d.searchDebounceTime)}),{immediate:!1}),n((()=>b.value),(e=>{v("status-filter-changed",e),_.value=1}),{immediate:!1}),n((()=>O.value),(e=>{v("users-filtered",e)}),{deep:!0,immediate:!0});const D=e=>{_.value=e.page,S.value=e.itemsPerPage},ie=e=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(e),ue=e=>{const a=new Date,t=new Date(e);let l=a.getFullYear()-t.getFullYear();const r=a.getMonth()-t.getMonth();return(r<0||0===r&&a.getDate()<t.getDate())&&l--,l},ce=()=>{C.value=!1,F.value=null},de=async e=>{try{if(F.value){const a=p.value.findIndex((e=>e.id===F.value.id));if(-1!==a){const t={...p.value[a],...e};p.value[a]=t,v("user-edited",t)}(await ne.create({message:"User updated successfully",duration:2e3,color:"success"})).present()}else{const a=await me(e),t=await Qe.register(a),l=A(t);p.value.push(l),v("user-created",l),(await ne.create({message:"User created successfully",duration:2e3,color:"success"})).present()}ce()}catch(a){(await ne.create({message:`Error saving user: ${a.message}`,duration:2e3,color:"danger"})).present()}},me=async e=>{if(!e||!e.facility)throw new Error("Invalid user data. 'facility' is required.");return{username:e.name,password:e.password,roles:e.roles,programs:e.programs,facilities:[e.facility.code],profile:{firstName:e.firstName,lastName:e.lastName,gender:e.gender,dateOfBirth:"1990-01-01T00:00:00.000Z"}}},fe=async()=>{try{const e=await Qe.getUsers();p.value=e.map(A)}catch(e){console.error("Failed to fetch MIUM users:",e),ne.create({message:"Failed to load users.",duration:2e3,color:"danger"}).then((e=>e.present()))}};return o((async()=>{await fe()})),a({setSearchTerm:e=>{g.value=e},setStatusFilter:e=>{b.value=e},refreshUsers:fe,cleanup:()=>{B&&clearTimeout(B)},openAddUserModal:()=>{F.value=null,C.value=!0},users:p.value,filteredUsers:O,paginatedUsers:P}),(e,a)=>(u(),T(I,null,[f(c(U),{class:"ion-padding",style:{height:"80vh"}},{default:m((()=>[k("div",Ye,[(u(!0),T(I,null,$(P.value,(e=>(u(),i(c(j),{key:e.id,class:"user-card"},{default:m((()=>[f(c(z),null,{default:m((()=>[k("div",He,[f(c(L),null,{default:m((()=>[k("img",{src:e.avatar,alt:e.name},null,8,Ke)])),_:2},1024),k("div",Ze,[f(c(q),null,{default:m((()=>[h(y(e.name),1)])),_:2},1024),f(c(R),null,{default:m((()=>[h(y(e.email),1)])),_:2},1024),e.gender||e.dateOfBirth?(u(),T("div",We,[e.gender?(u(),T("span",Xe,[f(c(x),{icon:c(G),class:"meta-icon"},null,8,["icon"]),h(" "+y(e.gender),1)])):N("",!0),e.dateOfBirth?(u(),T("span",ea,[f(c(x),{icon:c(J),class:"meta-icon"},null,8,["icon"]),h(" "+y(ue(e.dateOfBirth))+" years old ",1)])):N("",!0)])):N("",!0)]),f(c(Q),{color:"active"===e.status?"success":"medium",class:"status-chip"},{default:m((()=>[f(c(x),{icon:"active"===e.status?c(Y):c(H),slot:"start"},null,8,["icon"]),f(c(E),null,{default:m((()=>[h(y(e.status),1)])),_:2},1024)])),_:2},1032,["color"])])])),_:2},1024),f(c(K),null,{default:m((()=>[k("div",aa,[e.roles&&e.roles.length?(u(),T("div",ta,[f(c(x),{icon:c(Z),class:"detail-icon"},null,8,["icon"]),k("span",null,y(e.roles.join(", ")),1)])):N("",!0),e.programs&&e.programs.length?(u(),T("div",la,[f(c(x),{icon:c(W),class:"detail-icon"},null,8,["icon"]),k("span",null,y(e.programs.join(", ")),1)])):N("",!0),e.facility?(u(),T("div",ra,[f(c(x),{icon:c(X),class:"detail-icon"},null,8,["icon"]),k("span",null,y(e.facility.name||"Assigned Facility"),1)])):N("",!0),k("div",sa,[f(c(x),{icon:c(J),class:"detail-icon"},null,8,["icon"]),k("span",null,"Joined "+y(ie(e.createdAt)),1)]),k("div",na,[f(c(x),{icon:c(ee),class:"detail-icon"},null,8,["icon"]),k("span",null,"Last active "+y(ie(e.lastActive)),1)])]),k("div",oa,[f(c(w),{onClick:a=>(e=>{F.value=e,C.value=!0})(e),fill:"outline",size:"small",color:"primary"},{default:m((()=>[f(c(x),{icon:c(ae),slot:"start"},null,8,["icon"]),a[0]||(a[0]=h(" Edit "))])),_:2,__:[0]},1032,["onClick"]),f(c(w),{onClick:a=>(async e=>{(await oe.create({header:"Confirm Status Change",message:`Are you sure you want to ${"active"===e.status?"deactivate":"activate"} ${e.name}?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Confirm",handler:()=>{e.status="active"===e.status?"inactive":"active",v("user-status-changed",e),ne.create({message:`User ${"active"===e.status?"activated":"deactivated"} successfully`,duration:2e3,color:"success"}).then((e=>e.present()))}}]})).present()})(e),fill:"outline",size:"small",color:"active"===e.status?"warning":"success"},{default:m((()=>[f(c(x),{icon:"active"===e.status?c(te):c(le),slot:"start"},null,8,["icon"]),h(" "+y("active"===e.status?"Deactivate":"Activate"),1)])),_:2},1032,["onClick","color"]),f(c(w),{onClick:a=>(async e=>{(await oe.create({header:"Confirm Delete",message:`Are you sure you want to delete ${e.name}? This action cannot be undone.`,buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",role:"destructive",handler:()=>{const a=p.value.findIndex((a=>a.id===e.id));-1!==a&&(p.value.splice(a,1),v("user-deleted",e.id),ne.create({message:"User deleted successfully",duration:2e3,color:"success"}).then((e=>e.present())))}}]})).present()})(e),fill:"outline",size:"small",color:"danger"},{default:m((()=>[f(c(x),{icon:c(re),slot:"start"},null,8,["icon"]),a[1]||(a[1]=h(" Delete "))])),_:2,__:[1]},1032,["onClick"])])])),_:2},1024)])),_:2},1024)))),128))]),0===O.value.length?(u(),T("div",ia,[f(c(x),{icon:c(se),class:"empty-icon"},null,8,["icon"]),a[2]||(a[2]=k("h3",null,"No users found",-1)),a[3]||(a[3]=k("p",null,"Try adjusting your search or filter criteria",-1))])):N("",!0)])),_:1}),f(c(V),null,{default:m((()=>[f(ye,{"total-items":O.value.length,"current-page":_.value,"items-per-page":S.value,"onUpdate:pagination":D},null,8,["total-items","current-page","items-per-page"])])),_:1}),f(Je,{"is-open":C.value,"editing-user":F.value,onSave:de,onClose:ce},null,8,["is-open","editing-user"])],64))}}),ca=Se(ua,[["__scopeId","data-v-fcbcffb9"]]),da=r({__name:"UserNav",props:{searchTerm:{type:String,required:!0},statusFilter:{type:String,required:!0}},emits:["update:searchTerm","update:statusFilter","openAddUserModal"],setup:(e,{emit:a})=>(a,t)=>(u(),T(I,null,[f(c(de),{class:"ion-align-items-center"},{default:m((()=>[f(c(ie),{size:"8"},{default:m((()=>[f(c(ue),{value:e.searchTerm,onIonInput:t[0]||(t[0]=e=>a.$emit("update:searchTerm",e.detail.value)),placeholder:"Search users...","show-clear-button":"focus",debounce:"300"},null,8,["value"])])),_:1}),f(c(ie),{size:"4",class:"ion-text-right"},{default:m((()=>[f(c(w),{onClick:t[1]||(t[1]=e=>a.$emit("openAddUserModal")),fill:"solid"},{default:m((()=>[f(c(x),{icon:c(ce),slot:"start"},null,8,["icon"]),t[3]||(t[3]=h(" Add User "))])),_:1,__:[3]})])),_:1})])),_:1}),f(c(de),{class:"ion-padding-start ion-padding-end"},{default:m((()=>[f(c(ie),{size:"12"},{default:m((()=>[f(c(me),{value:e.statusFilter,onIonChange:t[2]||(t[2]=e=>a.$emit("update:statusFilter",e.detail.value))},{default:m((()=>[f(c(fe),{value:"all"},{default:m((()=>[f(c(E),null,{default:m((()=>t[4]||(t[4]=[h("All")]))),_:1,__:[4]})])),_:1}),f(c(fe),{value:"active"},{default:m((()=>[f(c(E),null,{default:m((()=>t[5]||(t[5]=[h("Active")]))),_:1,__:[5]})])),_:1}),f(c(fe),{value:"inactive"},{default:m((()=>[f(c(E),null,{default:m((()=>t[6]||(t[6]=[h("Inactive")]))),_:1,__:[6]})])),_:1})])),_:1},8,["value"])])),_:1})])),_:1})],64))}),ma={class:"sticky-user-nav"};e("default",Se(r({__name:"miusers",setup(e,{expose:a}){const t=s(""),l=s("all"),r=s([]),n=s(0),d=s();M((()=>t.value)),M((()=>l.value));const v=e=>{t.value=e,console.log("Search term updated:",e)},p=e=>{l.value=e,console.log("Status filter updated:",e)},g=e=>{t.value!==e&&(t.value=e),console.log("Internal search changed:",e)},h=e=>{l.value!==e&&(l.value=e),console.log("Internal filter changed:",e)},y=e=>{n.value=e.length},b=e=>{console.log("User created:",e)},w=e=>{console.log("User edited:",e)},x=e=>{console.log("User deleted:",e)},_=e=>{console.log("User status changed:",e)},T=()=>{d.value?d.value.openAddUserModal():console.log("usersTemplateRef is not yet available.")},N=async()=>{try{console.log("Loading users...")}catch(e){console.error("Error loading users:",e)}};return o((async()=>{await(async()=>{he().setNavigationPayload("Manage Integrated Users",!0,!1,"/","home","")})(),await N()})),ve((()=>{d.value&&"function"==typeof d.value.cleanup&&d.value.cleanup()})),a({refreshUsers:()=>{d.value&&d.value.refreshUsers(),N()},setSearch:e=>{t.value=e,d.value&&d.value.setSearchTerm(e)},setFilter:e=>{l.value=e,d.value&&d.value.setStatusFilter(e)},searchTerm:t,statusFilter:l,usersList:r,filteredUsersCount:n}),(e,a)=>(u(),i(c(pe),null,{default:m((()=>[f(ge),f(c(U),{fullscreen:!0},{default:m((()=>[k("div",ma,[f(da,{fullscreen:!0,searchTerm:t.value,statusFilter:l.value,"onUpdate:searchTerm":v,"onUpdate:statusFilter":p,onOpenAddUserModal:T},null,8,["searchTerm","statusFilter"])]),f(ca,{ref_key:"usersTemplateRef",ref:d,"initial-users":r.value,"initial-search-term":t.value,"initial-status-filter":l.value,"search-debounce-time":500,"enable-search":!0,"enable-status-filter":!0,"enable-pagination":!0,onSearchChanged:g,onStatusFilterChanged:h,onUsersFiltered:y,onUserCreated:b,onUserEdited:w,onUserDeleted:x,onUserStatusChanged:_},null,8,["initial-users","initial-search-term","initial-status-filter"])])),_:1})])),_:1}))}}),[["__scopeId","data-v-5071b8a1"]]))}}}));

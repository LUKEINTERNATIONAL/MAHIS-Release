import{d as B,r as m,a as $,b6 as S,cL as x,O as M,f as u,J as f,e as b,m as D,l as p,k as i,u as o,bP as J,a4 as j,$ as q,X as z,Q as E,bq as G,F as K,P as Q,br as U,K as T,p as W,a7 as X,n as H}from"./vendor-B45YKAfe.js";import{T as R,I as _,t as I,o as Y,_ as Z}from"./index-CbqN2xJF.js";import{O as ee}from"./OfflineMoreDetailsModal-BkwKbSbK.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-T5qsywHO.js";import"./SetRelationship.vue_vue_type_script_lang-6oSvyOYW.js";import"./BasicForm-BaWpSm9h.js";import"./DateInputField-BxlutdIE.js";import"./customDatePicker-B73-LbUA.js";const te={key:0,class:"spinner-overlay"},ae={class:"container"},ie={class:"select-group-wide"},ne={key:0,class:"content-area"},le={class:"table-section"},se={style:{width:"100%","text-align":"center","font-weight":"700",margin:"20px 0"}},oe={key:0,class:"table-responsive"},re={key:1,class:"placeholder-content"},de={style:{"text-align":"center",color:"#666","font-style":"italic"}},ce=B({__name:"MultipleIdentifiers",setup(ue){const v=m(!1),l=m(null),h=m([]),s=m([]),r=m(null),y=m(!1),A={responsive:!0,select:!1,layout:{topStart:null,topEnd:"search",bottomStart:"info",bottomEnd:"paging"}},O=async()=>{try{v.value=!0;const t=await _.getIdentifierTypes();h.value=t.map(e=>({id:e.patient_identifier_type_id||e.id,name:e.name}))}catch(t){console.error("Error loading identifier types:",t),I("Failed to load identifier types.")}finally{v.value=!1}},C=async t=>{l.value=t,await k(t)},k=async t=>{v.value=!0;try{const e=new _;e.setIdentifierType(t);const a=await e.getMultipleIdentifiers();a&&a.length>0?(s.value=a.map((n,d)=>[n.given_name||"N/A",n.family_name||"N/A",n.gender||"N/A",n.identifiers?n.identifiers.length.toString():"0",'<button class="btn btn-sm btn-primary view-btn" data-index="'.concat(d,"\" data-identifiers='").concat(JSON.stringify(n.identifiers||[]),"'>View</button>")]),y.value=!0):(s.value=[],y.value=!1),S.use(x),await H(),setTimeout(()=>{L()},100)}catch(e){console.error("Error building table data:",e),I("An error occurred while loading data."),y.value=!1,s.value=[]}finally{v.value=!1}},L=()=>{if(r.value&&y.value){const t=r.value.dt;t.columns.adjust().draw(),t.off("click",".view-btn"),t.on("click",".view-btn",e=>{const a=e.target,n=a.getAttribute("data-identifiers"),d=a.getAttribute("data-index");P(n,d)})}},N=()=>{const t=h.value.find(e=>e.id===l.value);return t?t.name:""},P=async(t,e)=>{if(!(!t||!e))try{const a=JSON.parse(t);await V(a,parseInt(e))}catch(a){console.error("Error parsing identifiers:",a),I("Error viewing identifier details")}},V=async(t,e)=>{new _().setIdentifierType(l.value||0),await Y(ee,{class:"fullScreenModal"},!0,{clientData:{title:"Identifiers belonging to client",identifiers:t,onVoidIdentifier:async(g,w)=>{await F(g,t,w,e)}}})==="dismiss"&&l.value&&await k(l.value)},F=async(t,e,a,n)=>{var d;if(confirm("Are you sure you want to void this identifier? Please provide a reason."))try{const g=prompt("Please provide a reason for voiding this identifier:")||"No reason provided",w=new _;if(w.setIdentifierType(l.value||0),await w.voidMultipleIdentifiers([t],g,((d=e[0])==null?void 0:d.identifier_type)||l.value),e.splice(a,1),e.length<=1){if(s.value.splice(n,1),r.value){const c=r.value.dt;c.clear(),c.rows.add(s.value),c.draw()}}else{if(s.value[n][3]=e.length.toString(),r.value){const c=r.value.dt;c.clear(),c.rows.add(s.value),c.draw()}await V(e,n)}}catch(g){console.error("Error voiding identifier:",g),I("Failed to void identifier")}};return $(async()=>{S.use(x),await O()}),(t,e)=>(u(),M(o(X),{class:W({loading:v.value})},{default:f(()=>[v.value?(u(),b("div",te,[p(o(J),{name:"bubbles"}),e[2]||(e[2]=i("div",{class:"loading-text"},"Please wait...",-1))])):D("",!0),p(R),p(o(j),null,{default:f(()=>[i("div",ae,[e[5]||(e[5]=i("h4",{style:{"text-align":"center","font-weight":"bold","margin-bottom":"20px"}}," Select Identifier Type ",-1)),i("div",ie,[p(o(q),null,{default:f(()=>[p(o(z),{position:"stacked"},{default:f(()=>[...e[3]||(e[3]=[E("Identifier Type",-1)])]),_:1}),p(o(G),{interface:"popover",placeholder:"Select Identifier Type",modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value=a),onIonChange:e[1]||(e[1]=a=>C(a.detail.value)),class:"wide-select"},{default:f(()=>[(u(!0),b(K,null,Q(h.value,a=>(u(),M(o(U),{key:a.id,value:a.id},{default:f(()=>[E(T(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),l.value?(u(),b("div",ne,[i("div",le,[i("h4",se," Multiple Identifier by "+T(N()),1),y.value?(u(),b("div",oe,[p(o(S),{ref_key:"dataTable",ref:r,options:A,data:s.value,class:"display nowrap",width:"100%"},{default:f(()=>[...e[4]||(e[4]=[i("thead",null,[i("tr",null,[i("th",null,"First Name"),i("th",null,"Last Name"),i("th",null,"Gender"),i("th",null,"Number of Identifiers"),i("th",null,"View")])],-1)])]),_:1},8,["data"])])):(u(),b("div",re,[i("p",de,T(N())+" identifier functionality will be implemented here ",1)]))])])):D("",!0)])]),_:1})]),_:1},8,["class"]))}}),Ie=Z(ce,[["__scopeId","data-v-f704827c"]]);export{Ie as default};

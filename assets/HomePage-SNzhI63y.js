var ue=Object.defineProperty;var pe=(t,e,o)=>e in t?ue(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var Y=(t,e,o)=>pe(t,typeof e!="symbol"?e+"":e,o);import{d as E,c8 as me,au as Ht,r as O,c as vt,a as yt,e as h,f as i,k as a,m as w,p as X,B as g,l as n,u as H,a3 as kt,A,I as G,F as B,L as J,c9 as he,bt as fe,aB as ge,ca as _e,cb as ve,cc as It,bp as ye,E as u,z as s,R as be,ar as Q,cd as De,ce as Ce,cf as $e,cg as Pt,bi as Se,ch as we,ci as ke,cj as Ie,ck as Pe,cl as Ae,cm as Te,cn as Oe,co as Ne,a2 as Re,cp as Be,at as xe,n as Jt,y as R,ab as pt,W as Gt,aa as mt,U as K,af as At,S as Z,a9 as q,cq as Ve,aS as Ct,b1 as bt,w as ct,$ as tt,cr as jt,aO as Yt,c4 as Tt,D as Qt,br as Zt,T as it,as as rt,ac as at,G as nt,X as Ot,a1 as qt,cs as Le,ct as Fe,cu as Ue,cv as Ee,bO as ht,bP as Me,a0 as We,aY as ze,aZ as He,a_ as Je,a$ as Ge,cw as je,bV as Nt,bW as Ye,cx as Qe}from"./vendor-CKGLxZg5.js";import{S as U,u as et,_ as W,H as P,a as Xt,P as ot,b as Kt,c as Ze,d as ft,B as te,t as Lt,e as Ft,i as Rt,f as St,g as Bt,h as xt,j as qe,k as Dt,l as Xe,m as ee,U as Vt,T as ae,n as Ke,o as ta,p as st,r as Ut,q as Et,s as ea,v as Mt,L as aa}from"./index-kdr2EpoV.js";import{m as ne}from"./apexcharts-PU4wsIkv.js";import{A as na}from"./appointment_service-CRplC5P0.js";import{A as se,B as gt}from"./ncd_appointment_service-ClUVt5R9.js";import{D as oe}from"./DateInputField-BI5B_HHR.js";import{C as sa}from"./chartjs-DSgRvDEJ.js";import{E as Wt}from"./encounter_type-DMB82Ecf.js";import{B as lt}from"./BasicForm-dBPc1w0c.js";import{u as oa}from"./AdministerOtherVaccinesStore-Cz4mux-n.js";import{P as ie}from"./previousVitals-Cly_UMjM.js";import{_ as re}from"./customDatePicker.vue_vue_type_style_index_0_lang-L_ZXSZff.js";import{s as ia}from"./vaccines_service-CbixEgRR.js";import{l as _t}from"./lodash-Dt8AsbQm.js";import{g as ra}from"./dashboard_service-OTcwAq81.js";import{i as la}from"./Img-CJEgX1Vr.js";import da from"./FacilityReports-d75uQ67l.js";import{M as ca,_ as ua}from"./ActionButtons.vue_vue_type_script_setup_true_lang-CpbxJkbM.js";import"./app_encounter_service-98GsPszC.js";import"./clinicalDaysStore-B8mFLyXf.js";import"./SvgDynamicColor-CvZStkge.js";import"./sms_service-pu0o93Nu.js";import"./EIRreportsStore-zKv7S2eM.js";import"./Export-D4js6FKi.js";import"./Arrays-CfBll-2n.js";class zt extends U{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(e){return await super.getJson("fhir/patient/".concat(e),{id:e})}static async getFhirObservations(e){return await super.getJson("fhir/patient/".concat(e,"/observations/"),{id:e})}}const pa={class:"fhir-viewer"},ma={class:"container"},ha={key:0,class:"main-header"},fa={class:"header-line"},ga={key:0,class:"last-updated-display"},_a={key:1,class:"card initial-input-card"},va={class:"action-area-initial"},ya={key:0,class:"card patient-card"},ba={class:"card-title"},Da={class:"patient-info-grid"},Ca={class:"info-item"},$a={class:"info-value"},Sa={class:"info-item"},wa={class:"info-value"},ka={class:"info-item"},Ia={class:"info-value"},Pa={class:"info-item age-item"},Aa={class:"info-value age-display"},Ta={class:"info-label"},Oa={class:"info-value identifier-value-highlight"},Na={key:0,class:"identifier-sub-details"},Ra={key:0,class:"sub-detail-chip"},Ba={key:1,class:"sub-detail-chip"},xa={key:2,class:"card observations-card"},Va={class:"card-title"},La={class:"observations-grid"},Fa={class:"obs-header"},Ua={class:"obs-title"},Ea={class:"obs-details"},Ma={class:"obs-detail obs-value-highlight"},Wa={class:"obs-value"},za={class:"obs-detail"},Ha={class:"obs-value"},Ja={key:0,class:"obs-detail"},Ga={class:"obs-value"},ja={key:3,class:"no-data-found"},Ya={key:4,class:"no-data-found"},Qa={key:5,class:"main-footer"},Za=E({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(t){me({"person-circle-outline":ye,"clipboard-outline":It,"search-outline":ve,"information-circle-outline":_e,"alert-circle-outline":ge,"person-add-outline":fe,"arrow-back-outline":he});const e=t,o=Ht(),d=O(!1),l=O([]),y=O(),r=O(),p=O(null),b=O([]),f=vt(()=>l.value.some(D=>D.resourceType==="Bundle"&&D.entry&&D.entry.some(c=>c.resource&&c.resource.resourceType==="Patient"))),m=vt(()=>b.value.length>0),$=async()=>{if(l.value=[],r.value=null,p.value=null,b.value=[],!y.value){console.error("Please enter a Patient Identifier.");return}d.value=!0;try{const D=await zt.getFhirPatient(y.value);if(D&&D.entry&&D.entry.length>0){const c=D.entry[0].resource,x=c.id,F=await zt.getFhirObservations(x);l.value=[D],F&&(l.value.push(F),b.value=F.entry.filter(z=>z.resource&&z.resource.resourceType==="Observation").map(z=>{const k=z.resource;return{id:k.id,display:N(k),value:dt(k),date:k.effectiveDateTime,category:k.category&&k.category[0]&&k.category[0].coding&&k.category[0].coding[0]?k.category[0].coding[0].display||k.category[0].coding[0].code:"N/A"}}));const V=c.name&&c.name[0];p.value={personInformation:{given_name:V&&V.given?V.given.join(" "):"",middle_name:V&&V.middle?V.middle.join(" "):"",family_name:V&&V.family?V.family:"",gender:c.gender||"",birthdate:c.birthDate||""}};const S=[D,F].filter(Boolean).reduce((z,k)=>{if(k.meta&&k.meta.lastUpdated){const j=new Date(k.meta.lastUpdated);return z===null||j>z?j:z}return z},null);S&&(r.value=v(S.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch(D){console.error("Error loading FHIR data:",D),l.value=[],r.value=null,p.value=null,b.value=[]}finally{d.value=!1}},_=D=>{if(D.name&&D.name[0]){const c=D.name[0],x=c.given?c.given.join(" "):"",F=c.family||"";return"".concat(x," ").concat(F).trim()||"N/A"}return"N/A"},C=D=>D.identifier&&D.identifier.length>0?D.identifier.map(c=>{let x="Unknown System";if(c.type&&c.type.coding&&c.type.coding[0]&&c.type.coding[0].display)x=c.type.coding[0].display;else if(c.system){const V=c.system.split("/");x=V[V.length-1]||c.system,c.system==="urn:oid:2.16.840.1.113883.4.6"&&(x="Social Security Number")}sessionStorage.setItem(x,c.value);let F=null;return c.assigner&&c.assigner.display?F=c.assigner.display:c.assigner&&c.assigner.reference&&(F=c.assigner.reference.split("/").pop()||c.assigner.reference),{value:c.value||"N/A",systemDisplay:x,periodStart:c.period?c.period.start:null,periodEnd:c.period?c.period.end:null,assignerDisplay:F}}):[],I=D=>{if(!D)return"N/A";try{return new Date(D).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(c){return console.error("Invalid date string for formatDate:",D,c),"Invalid Date"}},v=D=>{if(!D)return"N/A";try{return new Date(D).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(c){return console.error("Invalid date time string for formatDateTime:",D,c),"Invalid Date/Time"}},L=D=>{if(!D)return"N/A";try{const c=new Date,x=new Date(D);let F=c.getFullYear()-x.getFullYear();const V=c.getMonth()-x.getMonth();return(V<0||V===0&&c.getDate()<x.getDate())&&F--,F}catch(c){return console.error("Invalid birth date string for calculateAge:",D,c),"N/A"}},M=D=>{if(D.meta&&D.meta.tag){const c=D.meta.tag.find(x=>x.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return c?c.code:"Unknown"}return"Unknown"},N=D=>D.code&&D.code.coding&&D.code.coding[0]&&(D.code.coding[0].display||D.code.coding[0].code)||"Unknown Observation",dt=D=>D.valueQuantity?"".concat(D.valueQuantity.value," ").concat(D.valueQuantity.unit||"").trim():D.valueString?D.valueString:D.valueBoolean!==void 0?D.valueBoolean?"True":"False":"N/A",$t=()=>{et().setRecord(p.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(b.value)),de("/registration/manual")},le=()=>{l.value=[],y.value="",r.value=null,p.value=null,b.value=[]},de=D=>{o.push({path:D})};return yt(()=>{var D;if(e.initialData.length>0){l.value=e.initialData;const x=e.initialData.filter(Boolean).reduce((T,S)=>{if(S.meta&&S.meta.lastUpdated){const z=new Date(S.meta.lastUpdated);return T===null||z>T?z:T}return T},null);x&&(r.value=v(x.toISOString()));const F=e.initialData.find(T=>T.resourceType==="Bundle"&&T.entry&&T.entry.some(S=>S.resource&&S.resource.resourceType==="Patient"));if(F){const T=(D=F.entry.find(S=>S.resource&&S.resource.resourceType==="Patient"))==null?void 0:D.resource;if(T){const S=T.name&&T.name[0];p.value={personInformation:{given_name:S&&S.given?S.given.join(" "):"",middle_name:S&&S.middle?S.middle.join(" "):"",family_name:S&&S.family?S.family:"",gender:T.gender||"",birthdate:T.birthDate||""}}}}const V=e.initialData.find(T=>T.resourceType==="Bundle"&&T.entry&&T.entry.some(S=>S.resource&&S.resource.resourceType==="Observation"));V&&(b.value=V.entry.filter(T=>T.resource&&T.resource.resourceType==="Observation").map(T=>{const S=T.resource;return{id:S.id,display:N(S),value:dt(S),date:S.effectiveDateTime,category:S.category&&S.category[0]&&S.category[0].coding&&S.category[0].coding[0]?S.category[0].coding[0].display||S.category[0].coding[0].code:"N/A"}}))}}),(D,c)=>{var x,F,V,T,S,z;return i(),h("div",pa,[a("div",ma,[(x=l.value)!=null&&x.length?(i(),h("header",ha,[a("div",fa,[c[1]||(c[1]=a("h5",{class:"header-title"},"Referred Patient Overview",-1)),a("div",null,[a("span",{style:{"margin-right":"5px"},class:X(["last-updated-display","status-"+M(l.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+g(M(l.value[0].entry[0].resource)),3),r.value?(i(),h("span",ga,"Last Updated: "+g(r.value),1)):w("",!0)])])])):w("",!0),(F=l.value)!=null&&F.length?w("",!0):(i(),h("section",_a,[n(H(kt),{modelValue:y.value,"onUpdate:modelValue":c[0]||(c[0]=k=>y.value=k),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),a("div",va,[a("button",{onClick:$,class:"load-data-btn"},[n(H(G),{name:"search-outline"}),c[2]||(c[2]=A(" Find Patient "))])])])),(i(!0),h(B,null,J(l.value,k=>(i(),h("div",{key:k.id},[k.resourceType==="Bundle"&&k.entry&&k.entry[0]&&k.entry[0].resource.resourceType==="Patient"?(i(),h("section",ya,[a("h2",ba,[n(H(G),{name:"person-circle-outline"}),c[3]||(c[3]=A(" Patient Demographics"))]),a("div",Da,[a("div",Ca,[c[4]||(c[4]=a("span",{class:"info-label"},"Full Name",-1)),a("span",$a,g(_(k.entry[0].resource)),1)]),a("div",Sa,[c[5]||(c[5]=a("span",{class:"info-label"},"Gender",-1)),a("span",wa,g(k.entry[0].resource.gender||"Not specified"),1)]),a("div",ka,[c[6]||(c[6]=a("span",{class:"info-label"},"Date of Birth",-1)),a("span",Ia,g(I(k.entry[0].resource.birthDate)),1)]),a("div",Pa,[c[7]||(c[7]=a("span",{class:"info-label"},"Age",-1)),a("span",Aa,g(L(k.entry[0].resource.birthDate))+" years",1)]),(i(!0),h(B,null,J(C(k.entry[0].resource),(j,ce)=>(i(),h("div",{key:j.value||ce,class:"info-item identifier-info-item"},[a("span",Ta,g(j.systemDisplay),1),a("span",Oa,g(j.value),1),j.periodStart||j.assignerDisplay?(i(),h("div",Na,[j.periodStart?(i(),h("span",Ra,"Valid From: "+g(I(j.periodStart)),1)):w("",!0),j.assignerDisplay?(i(),h("span",Ba,"Issuer: "+g(j.assignerDisplay),1)):w("",!0)])):w("",!0)]))),128))])])):w("",!0)]))),128)),((V=b.value)==null?void 0:V.length)>0?(i(),h("section",xa,[a("h2",Va,[n(H(G),{name:"clipboard-outline"}),c[8]||(c[8]=A(" Clinical Observations"))]),a("div",La,[(i(!0),h(B,null,J(b.value,k=>(i(),h("div",{key:k.id,class:"observation-item"},[a("div",Fa,[a("h3",Ua,g(k.display),1)]),a("div",Ea,[a("div",Ma,[c[9]||(c[9]=a("span",{class:"obs-label"},"Value:",-1)),a("span",Wa,g(k.value),1)]),a("div",za,[c[10]||(c[10]=a("span",{class:"obs-label"},"Date:",-1)),a("span",Ha,g(v(k.date)),1)]),k.category&&k.category!=="N/A"?(i(),h("div",Ja,[c[11]||(c[11]=a("span",{class:"obs-label"},"Category:",-1)),a("span",Ga,g(k.category),1)])):w("",!0)])]))),128))])])):w("",!0),(T=l.value)!=null&&T.length&&!f.value?(i(),h("div",ja,[a("p",null,[n(H(G),{name:"alert-circle-outline"}),c[12]||(c[12]=A(" No patient data found for the provided identifier. Please try again."))])])):(S=l.value)!=null&&S.length&&f.value&&!m.value?(i(),h("div",Ya,[a("p",null,[n(H(G),{name:"information-circle-outline"}),c[13]||(c[13]=A(" No clinical observations found for this patient."))])])):w("",!0),(z=l.value)!=null&&z.length?(i(),h("footer",Qa,[a("button",{onClick:le,class:"back-to-search-btn small-btn"},[n(H(G),{name:"arrow-back-outline"}),c[14]||(c[14]=A(" Back to Search "))]),a("button",{onClick:$t,class:"register-btn small-btn"},[n(H(G),{name:"person-add-outline"}),c[15]||(c[15]=A(" Register New Patient "))])])):w("",!0)])])}}}),qa=W(Za,[["__scopeId","data-v-2f8d27b6"]]),Xa=E({name:"referrals",components:{ExternalReferrals:qa},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){this.segmentContent=t}}}),Ka={key:0},tn={style:{display:"flex","margin-top":"10px"}},en={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},an={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},nn={key:1};function sn(t,e,o,d,l,y){const r=u("ion-label"),p=u("ion-segment-button"),b=u("ion-segment"),f=u("ExternalReferrals");return i(),h(B,null,[a("div",null,[n(b,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:s(()=>[n(p,{value:"External referrals",onClick:e[0]||(e[0]=m=>t.setSegmentContent("External referrals"))},{default:s(()=>[n(r,null,{default:s(()=>e[2]||(e[2]=[A("External referrals")])),_:1,__:[2]})]),_:1}),n(p,{value:"Internal referrals",onClick:e[1]||(e[1]=m=>t.setSegmentContent("Internal referrals"))},{default:s(()=>[n(r,null,{default:s(()=>e[3]||(e[3]=[A("Internal referrals")])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(i(),h("div",Ka,[a("div",tn,[t.checkUnderFive?(i(),h("div",en)):w("",!0),e[4]||(e[4]=a("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?w("",!0):(i(),h("div",an))])])):w("",!0),t.segmentContent=="External referrals"?(i(),h("div",nn,[n(f)])):w("",!0)],64)}const on=W(Xa,[["render",sn],["__scopeId","data-v-e09d6a6b"]]),wt=be("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(t){this.selectedItem=t},getSelectedItem(){return this.selectedItem}},persist:!0}),rn=()=>{const t=O(null);return{activeIteminMixin:t,setActiveItem:o=>{t.value=o,console.log("lll: ",t.value)}}},ut=E({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:t,setActiveItem:e}=rn();return{chevronBackOutline:Be,checkmark:Re,grid:Ne,chevronDownCircle:Oe,chevronForwardCircle:Te,chevronUpCircle:Ae,colorPalette:Pe,document:Ie,globe:ke,medkit:we,add:Se,person:Pt,people:$e,thermometer:Ce,clipboard:De,activeIteminMixin:t,setActiveItem:e}},async mounted(){await this.setAppointments()},computed:{...Q(et,["patient"])},watch:{$route:{async handler(t){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await na.getDailiyAppointments(P.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((t,e)=>t.given_name.localeCompare(e.given_name)))},formatBirthdate(t){return P.getBirthdateAge(t)},setActiveItemRefFN(t){wt().setSelectedItem(t)}}}),ln=E({name:"NCDDashboard",mixins:[ut],components:{ApexChart:ne},setup(){return{router:Ht()}},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await Jt(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){try{return U.getJson("programs/32/reports/ncd_dashboard",{start_date:P.toStandardHisFormat(P.sessionDate()),end_date:P.toStandardHisFormat(P.sessionDate())})}catch(t){return[]}},navigationMenu(t){try{xe.close(),this.router.push(t).then(()=>{})}catch(e){console.error(e)}}}}),dn={class:"cards-container"},cn={class:"top-card-text"},un={class:"text-2xl font-bold"},pn={class:"top-card-text"},mn={class:"text-2xl font-bold"},hn={class:"top-card-text"},fn={class:"text-2xl font-bold"},gn={class:"top-card-text"},_n={class:"text-2xl font-bold"},vn={class:"top-card-text"},yn={class:"text-2xl font-bold"},bn={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},Dn={ref:"chartRef1"},Cn={ref:"chartRef2"};function $n(t,e,o,d,l,y){const r=u("ion-card-content"),p=u("ion-card"),b=u("ApexChart");return i(),h(B,null,[a("div",dn,[n(p,{class:"top-card action-card",onClick:e[0]||(e[0]=f=>t.setActiveItemRefFN("appointments"))},{default:s(()=>[n(r,null,{default:s(()=>[a("div",cn,[a("div",un,g(t.appointments.length),1),e[2]||(e[2]=a("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]),_:1})]),_:1}),n(p,{class:"top-card action-card"},{default:s(()=>[n(r,null,{default:s(()=>{var f;return[a("div",pn,[a("div",mn,g((f=t.dashboardData)==null?void 0:f.total_pending_dispensations),1),e[3]||(e[3]=a("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]}),_:1})]),_:1}),n(p,{class:"top-card action-card"},{default:s(()=>[n(r,null,{default:s(()=>{var f;return[a("div",hn,[a("div",fn,g((f=t.dashboardData)==null?void 0:f.total_defaulters),1),e[4]||(e[4]=a("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]}),_:1})]),_:1}),n(p,{class:"top-card action-card"},{default:s(()=>[n(r,null,{default:s(()=>{var f;return[a("div",gn,[a("div",_n,g((f=t.dashboardData)==null?void 0:f.total_complications),1),e[5]||(e[5]=a("h3",{class:"text-sm font-medium"},"Complications",-1))])]}),_:1})]),_:1}),n(p,{class:"top-card action-card",onClick:e[1]||(e[1]=f=>t.navigationMenu("NCDActivePatients"))},{default:s(()=>[n(r,null,{default:s(()=>{var f;return[a("div",vn,[a("div",yn,g((f=t.dashboardData)==null?void 0:f.total_client_registered),1),e[6]||(e[6]=a("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]}),_:1})]),_:1})]),a("div",bn,[n(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[n(r,null,{default:s(()=>[e[7]||(e[7]=a("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),a("div",Dn,[t.isChartReady?(i(),R(b,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):w("",!0)],512)]),_:1,__:[7]})]),_:1}),n(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[n(r,null,{default:s(()=>[e[8]||(e[8]=a("div",{class:"font-medium"},"Patients by gender",-1)),a("div",Cn,[t.isChartReady?(i(),R(b,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):w("",!0)],512)]),_:1,__:[8]})]),_:1})])],64)}const Sn=W(ln,[["render",$n],["__scopeId","data-v-18251377"]]),wn=E({name:"Home",mixins:[Xt,ut],components:{IonContent:q,IonHeader:Z,IonPage:At,IonToolbar:K,IonRow:mt,DateInputField:oe,IonIcon:G,IonButton:Gt,IonCol:pt},data(){const t=localStorage.getItem("ncdStartDate"),e=localStorage.getItem("ncdEndDate"),o=O(t||P.sessionDate()),d=O(e||P.sessionDate()),l=O(P.sessionDate()),y=O([]);return{minDate:l,startDate:o,endDate:d,people:y,calendarOutline:Ct,openOutline:Ve}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{formatBirthdate(t){return P.getBirthdateAge(t)},async getAppointments(){if(Kt().apiStatus){this.people=[];try{(await se.getAppointments(this.startDate,this.endDate,"")).forEach(o=>{const d={person_id:o.person_id,npid:o.npid,appointment_id:103,encounter_id:o.encounter_id,name:o.given_name.concat(" ",o.family_name),gender:o.gender,ageDob:this.formatBirthdate(o.birthdate),village:o.city_village,appointmentDate:P.toStandardHisDisplayFormat(o.appointment_date)};this.people.push(d)})}catch(e){}}},async getAppointmentsD1(t){this.startDate=P.toStandardHisFormat(t),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=P.toStandardHisFormat(t),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(t){const e=await ot.findByNpid(t);et().setPatientRecord(e[0]),this.redirectUser()},redirectUser(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(o=>e.some(d=>d.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")}}}),kn={class:"appointments-container"},In={class:"date-filter"},Pn={class:"appointments-table"};function An(t,e,o,d,l,y){const r=u("DateInputField"),p=u("ion-col"),b=u("ion-row"),f=u("ion-icon"),m=u("ion-button"),$=u("ion-card");return i(),h("div",kn,[a("div",In,[n(b,null,{default:s(()=>[n(p,null,{default:s(()=>[n(r,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),n(p,null,{default:s(()=>[n(r,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})]),t.people.length>0?(i(),R($,{key:0},{default:s(()=>[a("table",Pn,[e[0]||(e[0]=a("thead",null,[a("tr",null,[a("th",null,"Name"),a("th",null,"NPID"),a("th",null,"Age/DOB"),a("th",null,"Gender"),a("th",null,"Village"),a("th",null,"Appointment Date")])],-1)),a("tbody",null,[(i(!0),h(B,null,J(t.people,_=>(i(),h("tr",{key:_.npid},[a("td",null,[n(b,null,{default:s(()=>[n(p,null,{default:s(()=>[A(g(_.name),1)]),_:2},1024),n(p,null,{default:s(()=>[n(m,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:C=>t.openClientProfile(_.npid),color:"primary",fill:"clear",size:"small"},{default:s(()=>[n(f,{icon:t.openOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),a("td",null,g(_.npid),1),a("td",null,g(_.ageDob),1),a("td",null,g(_.gender),1),a("td",null,g(_.village),1),a("td",null,g(_.appointmentDate),1)]))),128))])])]),_:1})):(i(),R($,{key:1},{default:s(()=>e[1]||(e[1]=[a("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])),_:1,__:[1]}))])}const Tn=W(wn,[["render",An],["__scopeId","data-v-9dc99262"]]),On={key:0,class:"left_col"},Nn={class:"nav-menu"},Rn=["onClick"],Bn={class:"ellipsis"},xn={key:1,style:{"padding-left":"20px","padding-right":"20px"}},Vn=E({__name:"NCDDashboard",setup(t){const e=wt(),o=vt(()=>e.selectedItem),{screenWidth:d}=Ze(),l=O([{id:"dashboard",label:"Dashboard",icon:jt},{id:"referrals",label:"Referrals",icon:Yt},{id:"appointments",label:"Appointments",icon:Ct}]),y=O("dashboard"),r=ft(),{substance:p}=bt(r);ct(()=>p.value,(f,m)=>{f!==m&&console.log("Substance changed:",f)},{deep:!0,immediate:!0});const b=f=>{y.value=f,wt().setSelectedItem(y.value)};return ct(()=>o.value,f=>{console.log("Active item from mixin changed:",f),f&&f!=null&&b(f)},{immediate:!0}),(f,m)=>{const $=u("ion-segment-button"),_=u("ion-segment");return i(),h("div",{style:tt(H(d)>940?"display: flex":"display: block")},[H(d)>940?(i(),h("div",On,[a("nav",Nn,[a("ul",null,[(i(!0),h(B,null,J(l.value,C=>(i(),h("li",{key:C.id,class:X({active:y.value===C.id}),onClick:I=>b(C.id)},[n(H(G),{icon:C.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),a("span",Bn,g(C.label),1)],10,Rn))),128))])])])):w("",!0),H(d)<=940?(i(),h("div",xn,[n(_,{value:y.value,style:{"margin-top":"5px","justify-content":"left"}},{default:s(()=>[(i(!0),h(B,null,J(l.value,C=>(i(),R($,{value:C.id,key:C.id,class:X({active:y.value===C.id}),onClick:I=>b(C.id)},{default:s(()=>[n(H(G),{icon:C.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),a("span",null,g(C.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):w("",!0),a("div",{class:"right_col",style:tt(H(d)>940?"width: 85%":"width: 100%")},[a("div",null,[y.value==="referrals"?(i(),R(on,{key:0})):w("",!0),y.value==="dashboard"?(i(),R(Sn,{key:1})):w("",!0),y.value==="appointments"?(i(),R(Tn,{key:2})):w("",!0)])],4)],4)}}}),Ln=W(Vn,[["__scopeId","data-v-a1132315"]]),Fn=""+new URL("icon/checklist.svg",import.meta.url).href,Un=""+new URL("icon/dashboard.svg",import.meta.url).href,En={name:"Dashboard",setup(){yt(async()=>{o.value=await p(),await b();const m=await f(),{labels:$,totalVisits:_,incompleteVisits:C}=t(m);e($,_,C)});function t(m){if(!m)return{labels:[],totalVisits:[],incompleteVisits:[]};const $=[],_=[],C=[];return Object.entries(m).forEach(([I,v])=>{const M=new Date(I).toLocaleDateString("en-US",{weekday:"long"});$.push(M),_.push(v.complete),C.push(v.incomplete)}),{labels:$,totalVisits:_,incompleteVisits:C}}function e(m,$,_){const C=document.getElementById("myChart");new sa(C,{type:"bar",data:{labels:m,datasets:[{label:"Total visits",data:$,backgroundColor:"#5aa3b1"},{label:"Incomplete visits",data:_,backgroundColor:"#dba6a2"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}const o=O([]),d=O({}),l=m=>{const $=Object.entries(Wt).find(([_,C])=>C===m);return $?$[0]:"Unknown (".concat(m,")")},y=m=>Object.keys(m).map($=>{var L,M;const _=Number($),C=l(_),I=((L=m[_])==null?void 0:L.F)||0,v=((M=m[_])==null?void 0:M.M)||0;return{encounter:r(C),female:I,male:v,me:I+v,facility:I+v}}),r=m=>m.toLowerCase().replace(/_/g," ").replace(/\b\w/g,$=>$.toUpperCase()),p=async()=>{try{const m=Object.values(Wt).filter(v=>typeof v=="number"),[$,_]=await Promise.all([U.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:m}),U.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:[9,51,6,52,53,68,25,54,7],all:!0})]),C=y(_),I=y($);return C.map(v=>{const L=I.find(M=>M.encounter===v.encounter);return{...v,me:L?L.female+L.male:0}})}catch(m){return console.error("Error fetching dashboard stats:",m),[]}},b=async()=>{try{const $=new Date().toISOString().split("T")[0],_=await U.getJson("programs/1/dashboard",{date:$});d.value=_}catch(m){console.error("Error fetching visits stats:",m)}},f=async()=>{try{const m=new Date,$=new Date;$.setDate(m.getDate()-5);const _=C=>C.toISOString().split("T")[0];return await U.getJson("programs/1/reports/visits",{name:"visits",end_date:_(m),start_date:_($)})}catch(m){console.error("Error fetching visits stats:",m)}};return{checkListIcon:Fn,dashboardIcon:Un,rows:o,dashboardScoreStats:d}}},Mn={class:"dashboard-container"},Wn={class:"summary-cards"},zn={class:"card"},Hn={class:"card"},Jn={class:"card"},Gn={class:"card"},jn={class:"main-section"},Yn={class:"encounters-section"},Qn={class:"his-sm-text"},Zn={key:0},qn={class:"encounter-td"},Xn={class:"other-td"},Kn={class:"other-td"},ts={class:"other-td"},es={class:"other-td"},as={key:1};function ns(t,e,o,d,l,y){var r,p,b,f,m,$,_,C;return i(),h("div",Mn,[a("div",Wn,[a("div",zn,[a("h2",null,g(((p=(r=d.dashboardScoreStats)==null?void 0:r.total_patients_today)!=null?p:[]).length||0),1),e[0]||(e[0]=a("p",null,"Total patients today",-1))]),a("div",Hn,[a("h2",null,g(((f=(b=d.dashboardScoreStats)==null?void 0:b.waiting_for_vitals)!=null?f:[]).length||0),1),e[1]||(e[1]=a("p",null,"Waiting for vitals",-1))]),a("div",Jn,[a("h2",null,g((($=(m=d.dashboardScoreStats)==null?void 0:m.waiting_for_consultation)!=null?$:[]).length||0),1),e[2]||(e[2]=a("p",null,"Waiting for consultation",-1))]),a("div",Gn,[a("h2",null,g(((C=(_=d.dashboardScoreStats)==null?void 0:_.waiting_for_dispensation)!=null?C:[]).length||0),1),e[3]||(e[3]=a("p",null,"Waiting for dispensation",-1))])]),a("div",jn,[e[7]||(e[7]=a("div",{class:"chart-section"},[a("h3",null,"Total visits/incomplete visits: last 5 days"),a("canvas",{id:"myChart"})],-1)),a("div",Yn,[e[6]||(e[6]=a("h3",null,"Encounters created today",-1)),a("table",Qn,[e[5]||(e[5]=a("thead",null,[a("tr",null,[a("th",null,"Encounters"),a("th",null,"Female"),a("th",null,"Male"),a("th",null,"Me"),a("th",null,"Facility Total")])],-1)),d.rows.length?(i(),h("tbody",Zn,[(i(!0),h(B,null,J(d.rows,(I,v)=>(i(),h("tr",{key:v},[a("td",qn,g(I.encounter),1),a("td",Xn,g(I.female),1),a("td",Kn,g(I.male),1),a("td",ts,g(I.me),1),a("td",es,g(I.facility),1)]))),128))])):(i(),h("tbody",as,e[4]||(e[4]=[a("tr",null,[a("td",{colspan:"5"},"Loading encounter stats...")],-1)])))])])])])}const ss=W(En,[["render",ns]]);class os{constructor(){Y(this,"socket",null);Y(this,"channel","ImmunizationReportChannel");Y(this,"isConnected",!1);Y(this,"pendingFetch",null);Y(this,"location_id");Y(this,"initPromise");Y(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});Y(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});Y(this,"onError",e=>{console.error("WebSocket error:",e),this.isConnected=!1});this.initPromise=this.init()}async init(){const e=localStorage.getItem("apiURL"),o=localStorage.getItem("apiPort"),d=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const l="".concat(d,"://").concat(e,"/api/v1/cable");this.socket=new WebSocket(l),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(l){console.error(l),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const e={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(e))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await U.getJson("immunization/stats",{start_date:P.getDateBeforeByDays(P.sessionDate(),365),end_date:P.sessionDate()})}async setMessageHandler(e){await this.initPromise,this.socket?this.socket.onmessage=o=>{e(o)}:console.error("WebSocket connection not established.")}}const is=E({components:{IonContent:q,IonHeader:Z,IonItem:nt,IonList:at,IonMenu:rt,IonTitle:it,IonToolbar:K,IonInput:kt,BasicInputField:te,BasicForm:lt,PreviousVitals:ie,customDatePicker:re,IonCol:pt,IonRow:mt,VueMultiselect:Zt,IonLabel:Qt,DataTable:Tt},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:Rt,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:P.toStandardHisDisplayFormat(U.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...Q(oa,["administerOtherVaccine"]),...Q(Ft,["tempScannedBatchNumber"]),...Q(et,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await ra(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:Pt,pulseOutline:qt,clipboardOutline:It}},methods:{formatBirthdate(t){return P.getBirthdateAge(t)},async openClientProfile(t){const e=await ot.findByID(t);await et().setPatientRecord(e),this.$router.push("patientProfile")},processData(){var e;return((e=this.data)==null?void 0:e.map(o=>{if(o.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let d=[];const l=y=>y.map(p=>{let b=0;return p.clients.map(f=>{(p.drug_name==this.drug_name&&(this.village==f.table.city_village||this.village=="All")||(p.drug_name==this.drug_name||this.village==f.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:f.table.given_name,family_name:f.table.family_name,patient_id:f.table.patient_id,birthdate:f.table.birthdate,city_village:f.table.city_village}),b++),this.villageList.push(f.table.city_village)}),[p.drug_name,b]}).filter(p=>p[1]!==0);return this.title=="Client due today"&&(d=l(o.value.due_today_antigens)),this.title=="Client due this week"&&(d=l(o.value.due_this_week_antigens)),this.title=="Client due this month"&&(d=l(o.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(d=l(o.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(d=l(o.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(y=>JSON.stringify(y)))].map(y=>JSON.parse(y)),this.villageList=[...new Set(this.villageList)],d}}))[0]},handleVillageClick(t){this.drug_name="",this.village=t,this.tableData=this.processData()},handleRowClick(t){var o;this.tableEvent=t.target;const e=this.tableEvent.closest("tr");if(e){const d=Array.from(((o=e.parentNode)==null?void 0:o.children)||[]).indexOf(e),l=this.tableData[d];this.drug_name=l[0],e.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(t){return P.calculateDisplayAge(t)},openPopover(t){this.event=t,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(t){var o;const e=t.target.value;this.batchNumber=e||((o=this.tempScannedBatchNumber)==null?void 0:o.text)||""},saveBatchWithTodayDate(){let t=U.getSessionDate();this.saveDta(t)},dismiss(){Ot.dismiss()},saveBatch(){let t;_t.isEmpty(this.vaccineDate)==!0?t=U.getSessionDate():t=this.vaccineDate,this.saveDta(t)},validateVaccineName(){if(_t.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(_t.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(t){this.currentDrugOb=t},isAlphaNumeric(t){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(t)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(t){this.batchNumber=t},saveDta(t){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){Lt("Enter batch number!");return}if(this.batchNumber==""){Lt("Enter batch number!");return}const e={batch_number:this.batchNumber,date_administered:t,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},o=Ft();o.setAdministeredVaccine(e),ia(this.patient),this.dismiss(),o.setTempScannedBatchNumber(null)}}}),rs={key:0,class:"spinner-overlay"},ls={class:"header position_content"},ds={style:{"font-size":"1.2em","font-weight":"700"}},cs={class:"dueCardContent"},us=["onClick"],ps={style:{"margin-right":"15px"}},ms={style:{"align-items":"center",display:"flex"}},hs={style:{"line-height":"1"}},fs={class:"client_name"},gs={class:"name"},_s={class:"demographicsOtherRow"},vs={class:"demographicsText"};function ys(t,e,o,d,l,y){const r=u("ion-spinner"),p=u("ion-icon"),b=u("ion-header"),f=u("ion-card-title"),m=u("ion-card-header"),$=u("DataTable"),_=u("ion-card-content"),C=u("ion-card"),I=u("ion-item"),v=u("ion-list"),L=u("ion-popover"),M=u("ion-content");return i(),h(B,null,[t.isLoading?(i(),h("div",rs,[n(r,{name:"bubbles"}),e[3]||(e[3]=a("div",{class:"loading-text"},"Please wait...",-1))])):w("",!0),n(b,null,{default:s(()=>[a("div",ls,[a("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=N=>t.dismiss())},[n(p,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),a("div",ds,g(t.title),1),a("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=N=>t.openPopover(N))},[n(p,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),n(M,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:s(()=>[a("div",null,[n(C,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:s(()=>[n(m,null,{default:s(()=>[n(f,{class:"sectionTitle"},{default:s(()=>e[4]||(e[4]=[A(" Summary of required doses ")])),_:1,__:[4]})]),_:1}),n(_,null,{default:s(()=>[a("div",cs,[n($,{options:t.options,data:t.tableData,class:"display nowrap",width:"100%",onClick:t.handleRowClick},{default:s(()=>e[5]||(e[5]=[a("thead",null,[a("tr",null,[a("th",null,"Vaccine"),a("th",null,"Quantity")])],-1)])),_:1,__:[5]},8,["options","data","onClick"])])]),_:1})]),_:1}),n(C,{class:"section",style:{"margin-inline":"0px"}},{default:s(()=>[n(m,null,{default:s(()=>[n(f,{class:"sectionTitle"},{default:s(()=>e[6]||(e[6]=[A("Client Details ")])),_:1,__:[6]})]),_:1}),n(_,null,{default:s(()=>[(i(!0),h(B,null,J(t.clientDetails,(N,dt)=>(i(),h("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:dt,onClick:$t=>t.openClientProfile(N.patient_id)},[a("div",ps,[a("div",{class:X((N==null?void 0:N.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[n(p,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),a("div",ms,[a("div",hs,[a("div",fs,[a("div",gs,g(N.given_name)+" "+g(N.family_name),1)]),a("div",_s,[a("div",vs,[A(g(N.gender=="M"?"Male":"Female")+" ",1),e[7]||(e[7]=a("span",{class:"dot"},".",-1)),A(g(t.formatBirthdate(N.birthdate)),1)])]),a("div",null,"Village: "+g(N.city_village),1)])])],8,us))),128))]),_:1})]),_:1})]),n(L,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:t.event,onDidDismiss:e[2]||(e[2]=N=>t.popoverOpen=!1)},{default:s(()=>[a("div",null,[e[8]||(e[8]=a("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(i(!0),h(B,null,J(t.villageList,(N,dt)=>(i(),R(v,{class:X(N==t.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:dt},{default:s(()=>[n(I,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:$t=>t.handleVillageClick(N)},{default:s(()=>[A(g(N),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const bs=W(is,[["render",ys],["__scopeId","data-v-2b76e9ce"]]),Ds=E({name:"Menu",mixins:[ut],components:{IonContent:q,IonHeader:Z,IonItem:nt,IonList:at,IonMenu:rt,IonTitle:it,IonToolbar:K,IonCheckbox:ht,BasicForm:lt,BasicCard:gt,Carousel:Ee,Slide:Ue,Pagination:Fe,Navigation:Le},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},computed:{...Q(ft,["substance"]),backgroundStyle(){return{background:"linear-gradient(180deg, rgba(150, 152, 152, 0.7) 0%, rgba(255, 255, 255, 0.9) 100%), url(".concat(la("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",height:"22.8vh"}}},watch:{},async mounted(){new os().setMessageHandler(this.onMessage)},methods:{async onMessage(t){var o,d,l;const e=JSON.parse(t.data);e.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=e.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((o=this.reportData)==null?void 0:o.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((d=this.reportData)==null?void 0:d.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((l=this.reportData)==null?void 0:l.total_male_vaccinated_this_year)||0}])},openDueModal(t){const e={title:t,dashBoardData:this.reportData};St(bs,{class:"fullScreenModal"},!0,e)},async openClientProfile(t){const e=await ot.findByNpid(t);await et().setPatientRecord(e[0]),this.$router.push("patientProfile")}}}),Cs={class:"topStats"},$s={class:"totalStats",style:{background:"linear-gradient(180deg, #20b2aa 0%, #40c0b0 50%, rgb(233, 233, 233) 100%)"}},Ss={class:"statsValue",style:{"font-size":"1.4em"}},ws={class:"statsText",style:{"font-size":"0.9em"}},ks={class:"dueCardContent"},Is={class:"statsValue"},Ps={class:"statsValue"},As={class:"statsValue"},Ts={class:"overDueCardContent"},Os={class:"statsValue"},Ns={class:"statsValue"},Rs=["onClick"],Bs={style:{"margin-right":"15px"}},xs={style:{"align-items":"center",display:"flex"}},Vs={style:{"line-height":"1"}},Ls={class:"client_name"},Fs={class:"name"},Us={class:"demographicsOtherRow"},Es={class:"demographicsText"};function Ms(t,e,o,d,l,y){const r=u("Slide"),p=u("Pagination"),b=u("Carousel"),f=u("ion-card-title"),m=u("ion-card-header"),$=u("ion-card-content"),_=u("ion-card"),C=u("ion-icon"),I=u("ion-content");return i(),R(I,{class:"content"},{default:s(()=>[a("div",Cs,[a("div",null,[a("div",{style:tt(t.backgroundStyle)},[n(b,{autoplay:4e3,"wrap-around":!0,itemsToShow:1.2,transition:600,style:{"padding-top":"20px"}},{addons:s(()=>[n(p)]),default:s(()=>[(i(!0),h(B,null,J(t.totalStats,v=>(i(),R(r,{key:v},{default:s(()=>[a("div",$s,[a("div",Ss,g(v.value),1),a("div",ws,g(v.name),1)])]),_:2},1024))),128))]),_:1})],4)]),n(_,{class:"section"},{default:s(()=>[n(m,null,{default:s(()=>[n(f,{class:"cardTitle"},{default:s(()=>e[5]||(e[5]=[A(" Clients due ")])),_:1,__:[5]})]),_:1}),n($,null,{default:s(()=>{var v,L,M;return[a("div",ks,[a("div",{class:"dueCard",onClick:e[0]||(e[0]=N=>t.openDueModal("Client due today")),style:{border:"1px solid rgb(158, 207, 136)"}},[a("div",Is,g(((v=t.reportData)==null?void 0:v.due_today_count)||0),1),e[6]||(e[6]=a("div",{class:"statsText"},"Due today",-1))]),a("div",{class:"dueCard",style:{border:"1px solid rgb(239, 221, 121)"},onClick:e[1]||(e[1]=N=>t.openDueModal("Client due this week"))},[a("div",Ps,g(((L=t.reportData)==null?void 0:L.due_this_week_count)||0),1),e[7]||(e[7]=a("div",{class:"statsText"},"Due this week",-1))]),a("div",{class:"dueCard",style:{border:"1px solid rgb(241, 154, 154)"},onClick:e[2]||(e[2]=N=>t.openDueModal("Client due this month"))},[a("div",As,g(((M=t.reportData)==null?void 0:M.due_this_month_count)||0),1),e[8]||(e[8]=a("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),n(_,{class:"section"},{default:s(()=>[n(m,null,{default:s(()=>[n(f,{class:"cardTitle"},{default:s(()=>e[9]||(e[9]=[A(" Clients overdue ")])),_:1,__:[9]})]),_:1}),n($,null,{default:s(()=>{var v,L;return[a("div",Ts,[a("div",{class:"overDueCard",onClick:e[3]||(e[3]=M=>t.openDueModal("Client overdue under 5yrs"))},[a("div",Os,g(((v=t.reportData)==null?void 0:v.under_five_overdue)||0),1),e[10]||(e[10]=a("div",{class:"statsText"},"Under 5yrs",-1))]),a("div",{class:"overDueCard",onClick:e[4]||(e[4]=M=>t.openDueModal("Client overdue over 5yrs"))},[a("div",Ns,g(((L=t.reportData)==null?void 0:L.over_five_overdue)||0),1),e[11]||(e[11]=a("div",{class:"statsText"},"Over 5yrs",-1))])])]}),_:1})]),_:1}),n(_,{class:"section"},{default:s(()=>[n(m,null,{default:s(()=>[n(f,{class:"cardTitle"},{default:s(()=>{var v;return[A("Today's appointments("+g((v=t.appointments)==null?void 0:v.length)+") ",1)]}),_:1})]),_:1}),n($,null,{default:s(()=>[(i(!0),h(B,null,J(t.appointments,(v,L)=>(i(),h("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:L,onClick:M=>t.openClientProfile(v.npid)},[a("div",Bs,[a("div",{class:X(v.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[n(C,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),a("div",xs,[a("div",Vs,[a("div",Ls,[a("div",Fs,g(v.given_name)+" "+g(v.family_name),1)]),a("div",Us,[a("div",Es,[A(g(v.gender=="M"?"Male":"Female")+" ",1),e[12]||(e[12]=a("span",{class:"dot"},".",-1)),A(g(t.formatBirthdate(v.birthdate)),1)])]),a("div",null,"Village: "+g(v==null?void 0:v.city_village),1)])])],8,Rs))),128))]),_:1})]),_:1})])]),_:1})}const Ws=W(Ds,[["render",Ms],["__scopeId","data-v-a8eeb2dc"]]),zs=E({components:{IonContent:q,IonHeader:Z,IonItem:nt,IonList:at,IonMenu:rt,IonTitle:it,IonToolbar:K,IonInput:kt,BasicInputField:te,BasicForm:lt,PreviousVitals:ie,customDatePicker:re,IonCol:pt,IonRow:mt,VueMultiselect:Zt,IonLabel:Qt,DataTable:Tt},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:Rt,showPD:!1,batchNumber:"",clientDetails:[],dueData:[],workerStore:ee(),sessionDate:P.toStandardHisDisplayFormat(U.getSessionDate()),showDateBtns:!0,patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:t=>this.waitingTime(t)},{title:"Actions",data:null,render:(t,e,o)=>{const d=document.createElement("div"),l=document.createElement("ion-button");l.innerText=this.buttonTitle,l.size="small",l.classList.add("btn-edit"),l.style.color="#fff",l.style.marginRight="8px",l.addEventListener("click",()=>this.navigateTo(o.patient_id,this.buttonLink)),d.appendChild(l);const y=document.createElement("ion-button");y.innerText="Profile",y.size="small",y.classList.add("btn-edit"),y.style.color="#fd7e14",y.style.marginRight="8px",y.addEventListener("click",()=>this.navigateTo(o.patient_id,"/patientProfile")),d.appendChild(y);const r=document.createElement("ion-button");return r.innerText="Abscond",r.size="small",r.classList.add("btn-edit"),r.style.color="#dc3545",r.style.marginRight="8px",r.addEventListener("click",()=>this.handleAbscond(o)),d.appendChild(r),d},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]]}}},props:{title:{default:[]},list:{default:""},buttonTitle:{default:""},buttonLink:{default:""}},computed:{...Q(Dt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","counter"])},async mounted(){this.setList()},watch:{patientsWaitingForConsultation:{handler(t){this.list==="CONSULTATION"&&(this.patients=t)},deep:!0},patientsWaitingForVitals:{handler(t){this.list==="VITALS"&&(this.patients=t)},deep:!0},patientsWaitingForLab:{handler(t){this.list==="LAB"&&(this.patients=t)},deep:!0},patientsWaitingForDispensation:{handler(t){this.list==="DISPENSATION"&&(this.patients=t)},deep:!0},counter:{handler(){this.setList()}}},setup(){return{person:Pt,pulseOutline:qt,clipboardOutline:It}},methods:{openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Ot.dismiss()},async navigateTo(t,e){const o=await ot.findByID(t);await et().setPatientRecord(o),this.$router.push(e)},async handleAbscond(t){try{const e=await Bt(),o=e?e.code:null;await xt.checkOutPatient(t.visit_id,P.todayDateFormatted()),this.patients=this.patients.filter(d=>d.patient_id!==t.patient_id),qe("Patient absconded successfully."),await Dt().refresh(o)}catch(e){Xe("Failed to abscond patient.")}},setList(){const t={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation};this.patients=t[this.list]||[]},waitingTime(t){return P.calculateTimeDifference(t)}}}),Hs={key:0,class:"spinner-overlay"},Js={class:"header position_content"},Gs={style:{"font-size":"1.2em","font-weight":"700"}},js={class:"dueCardContent"};function Ys(t,e,o,d,l,y){const r=u("ion-spinner"),p=u("ion-icon"),b=u("ion-header"),f=u("ion-card-title"),m=u("ion-card-header"),$=u("DataTable"),_=u("ion-card-content"),C=u("ion-card"),I=u("ion-content");return i(),h(B,null,[e[3]||(e[3]=A(" Spinner ")),t.isLoading?(i(),h("div",Hs,[n(r,{name:"bubbles"}),e[2]||(e[2]=a("div",{class:"loading-text"},"Please wait...",-1))])):w("",!0),n(b,null,{default:s(()=>[a("div",Js,[a("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=(...v)=>t.dismiss&&t.dismiss(...v))},[n(p,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),a("div",Gs,g(t.title),1),a("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=v=>t.openPopover(v))},[n(p,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),n(I,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:s(()=>[a("div",null,[n(C,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:s(()=>[n(m,null,{default:s(()=>[n(f,{class:"sectionTitle"})]),_:1}),n(_,null,{default:s(()=>[a("div",js,[n($,{data:t.patients,columns:t.tableColumns,options:t.tableOptions,class:"display nowrap",width:"100%"},null,8,["data","columns","options"])])]),_:1})]),_:1})])]),_:1})],64)}const Qs=W(zs,[["render",Ys],["__scopeId","data-v-ec4c9422"]]),Zs=E({components:{IonRow:mt,IonCol:pt,IonContent:q,IonHeader:Z,IonItem:nt,IonList:at,IonIcon:G,IonCard:Ge,IonCardHeader:Je,IonCardTitle:He,IonCardContent:ze,IonPopover:We,DataTable:Tt,IonSpinner:Me},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:Rt,patientList:[],patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Service Time",data:"arrivalTime",render:t=>this.formatArrivalTime(t)},{title:"Actions",data:null,render:(t,e,o)=>{const d=document.createElement("div"),l=document.createElement("ion-button");return l.innerText="Profile",l.size="small",l.style.color="#fff",l.style.padding="8px 12px",l.style.marginRight="8px",l.addEventListener("click",()=>this.navigateTo(o.patient_id,"/patientProfile")),d.appendChild(l),d},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,dom:"Bfrtip",order:[[1,"asc"]]}}},props:{title:{default:"Patient List"}},async mounted(){this.isLoading=!0;try{const t=await Bt(),e=t?t.code:null,d=(await xt.getAllPatientsVisitsToday()).filter(l=>l.location_id===e);this.patients=await Promise.all(d.map(async l=>{const y=await ot.findByID(l.patientId);if(y&&y.person){const r=y.person.names;return{fullName:r&&r.length>0?"".concat(r[0].given_name||""," ").concat(r[0].family_name||"").trim():"Unknown",arrivalTime:l.startDate,patient_id:l.patientId}}else return{fullName:"Unknown",arrivalTime:l.startDate,patient_id:l.patientId}}))}catch(t){console.error("Error fetching patients:",t)}finally{this.isLoading=!1}},methods:{openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Ot.dismiss()},async navigateTo(t,e){const o=await ot.findByID(t);await et().setPatientRecord(o),this.$router.push(e)},formatArrivalTime(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}}}),qs={class:"header position_content"},Xs={style:{"font-size":"1.2em","font-weight":"700"}},Ks={class:"dueCardContent"};function to(t,e,o,d,l,y){const r=u("ion-icon"),p=u("ion-header"),b=u("DataTable"),f=u("ion-card-content"),m=u("ion-card"),$=u("ion-item"),_=u("ion-list"),C=u("ion-popover"),I=u("ion-content");return i(),h(B,null,[n(p,null,{default:s(()=>[a("div",qs,[a("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=(...v)=>t.dismiss&&t.dismiss(...v))},[n(r,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),a("div",Xs,g(t.title),1),a("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=v=>t.openPopover(v))},[n(r,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),n(I,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:s(()=>[a("div",null,[n(m,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:s(()=>[n(f,null,{default:s(()=>[a("div",Ks,[n(b,{data:t.patients,columns:t.tableColumns,options:t.tableOptions,class:"display nowrap",width:"100%"},null,8,["data","columns","options"])])]),_:1})]),_:1})]),n(C,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:t.event,onDidDismiss:e[2]||(e[2]=v=>t.popoverOpen=!1)},{default:s(()=>[a("div",null,[n(_,{style:{"--ion-background-color":"#fff","--offset-x":"-30px"}},{default:s(()=>[n($,{button:!0,detail:!1,style:{cursor:"pointer"}})]),_:1})])]),_:1},8,["is-open","event"])]),_:1})],64)}const eo=W(Zs,[["render",to],["__scopeId","data-v-79afebaf"]]),ao=E({name:"OPD Dashboard",mixins:[ut],components:{IonContent:q,IonHeader:Z,IonItem:nt,IonList:at,IonMenu:rt,IonTitle:it,IonToolbar:K,IonCheckbox:ht,BasicForm:lt,BasicCard:gt,FacilityReports:da},data(){return{totalPatientsToday:0,canViewVitals:!1,canViewConsultation:!1,canViewLab:!1,canViewDispensation:!1,userRoles:[],showReports:!1}},computed:{...Q(Dt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{$route:{async handler(t){await this.fetchUserData()},deep:!0}},async mounted(){const t=await Bt(),e=t?t.code:null;try{const d=(await xt.getAllPatientsVisitsToday()).filter(l=>l.location_id===e);this.totalPatientsToday=d.length,await Dt().refresh(e)}catch(o){}await this.fetchUserData()},methods:{toggleReports(){this.showReports=!this.showReports,this.showReports&&setTimeout(()=>{const t=document.getElementById("reports-section");t&&t.scrollIntoView({behavior:"smooth"})},100)},async fetchUserData(){const t=await Vt.getCurrentUser();t&&(this.userRoles=t.roles.map(e=>e.role),this.updateCardVisibility())},updateCardVisibility(){this.canViewVitals=this.isUserRole("Clinician")||this.isUserRole("Nurse")||this.isUserRole("Superuser"),this.canViewConsultation=this.isUserRole("Clinician")||this.isUserRole("Superuser"),this.canViewLab=this.isUserRole("Lab"),this.canViewDispensation=this.isUserRole("Clinician")||this.isUserRole("Pharmacist")||this.isUserRole("Superuser")},isUserRole(t){return this.userRoles.includes(t)},openAllModal(t,e,o){St(eo,{class:"fullScreenModal"},!0,{title:t,buttonLink:e,buttonTitle:o})},dueCardStyle(t){const e={success:"rgb(158, 207, 136)",warning:"rgb(239, 221, 121)",info:"rgb(144, 202, 249)",danger:"rgb(241, 154, 154)"};return{border:"1px solid ".concat(e[t]),padding:"20px",margin:"10px"}},openPatientsListModal(t,e,o,d){St(Qs,{class:"fullScreenModal"},!0,{title:t,list:e,buttonTitle:o,buttonLink:d})}}}),no={id:"containertwo"},so={class:"centered-content OPDDueCardWrapper"},oo={class:"OPDDueCardContent"},io={class:"OPDStatsValue"},ro={class:"OPDStatsValue"},lo={class:"OPDStatsValue"},co={class:"OPDStatsValue"},uo={class:"OPDStatsValue"};function po(t,e,o,d,l,y){const r=u("ion-card-title"),p=u("ion-card-header"),b=u("ion-icon"),f=u("ion-card-content"),m=u("ion-card"),$=u("ion-content");return i(),R($,{fullscreen:!0},{default:s(()=>[a("div",no,[a("div",so,[n(m,{class:"section",style:{width:"80%"}},{default:s(()=>[n(p,null,{default:s(()=>[n(r,{class:"cardTitle"},{default:s(()=>e[5]||(e[5]=[A("Today's patients list")])),_:1,__:[5]})]),_:1}),n(f,null,{default:s(()=>[a("div",oo,[a("div",{class:"OPDDueCard",onClick:e[0]||(e[0]=_=>t.openAllModal("All patients today","View profile","/patientProfile")),style:tt(t.dueCardStyle("success"))},[n(b,{icon:t.people,class:"dueCardIcon"},null,8,["icon"]),a("div",io,g(t.totalPatientsToday),1),e[6]||(e[6]=a("div",{class:"OPDStatsText"},"Total patients today",-1))],4),t.canViewVitals?(i(),h("div",{key:0,class:"OPDDueCard",onClick:e[1]||(e[1]=_=>t.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals")),style:tt(t.dueCardStyle("success"))},[n(b,{icon:t.thermometer,class:"dueCardIcon"},null,8,["icon"]),a("div",ro,g(t.patientsWaitingForVitals.length),1),e[7]||(e[7]=a("div",{class:"OPDStatsText"},"Waiting for vitals",-1))],4)):w("",!0),t.canViewConsultation?(i(),h("div",{key:1,class:"OPDDueCard",onClick:e[2]||(e[2]=_=>t.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan")),style:tt(t.dueCardStyle("success"))},[n(b,{icon:t.clipboard,class:"dueCardIcon"},null,8,["icon"]),a("div",lo,g(t.patientsWaitingForConsultation.length),1),e[8]||(e[8]=a("div",{class:"OPDStatsText"},"Waiting for consultation",-1))],4)):w("",!0),t.canViewLab?(i(),h("div",{key:2,class:"OPDDueCard",onClick:e[3]||(e[3]=_=>t.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan")),style:tt(t.dueCardStyle("success"))},[n(b,{icon:t.clipboard,class:"dueCardIcon"},null,8,["icon"]),a("div",co,g(t.patientsWaitingForLab.length),1),e[9]||(e[9]=a("div",{class:"OPDStatsText"},"Waiting for lab",-1))],4)):w("",!0),t.canViewDispensation?(i(),h("div",{key:3,class:"OPDDueCard",onClick:e[4]||(e[4]=_=>t.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations")),style:tt(t.dueCardStyle("success"))},[n(b,{icon:t.medkit,class:"dueCardIcon"},null,8,["icon"]),a("div",uo,g(t.patientsWaitingForDispensation.length),1),e[10]||(e[10]=a("div",{class:"OPDStatsText"},"Waiting for dispensation",-1))],4)):w("",!0)])]),_:1})]),_:1})])])]),_:1})}const mo=W(ao,[["render",po],["__scopeId","data-v-08236ccc"]]),ho=E({name:"NCDDashboard",mixins:[ut],components:{ApexChart:ne},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await Jt(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return U.getJson("programs/32/reports/ncd_dashboard",{start_date:P.toStandardHisFormat(P.sessionDate()),end_date:P.toStandardHisFormat(P.sessionDate())})}}}),fo={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},go={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},_o={ref:"chartRef1"},vo={ref:"chartRef2"};function yo(t,e,o,d,l,y){const r=u("ion-card-content"),p=u("ion-card"),b=u("ApexChart");return i(),h(B,null,[a("div",fo,[n(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[n(r,null,{default:s(()=>e[0]||(e[0]=[a("div",{class:"top-card-text"},[a("div",{class:"text-2xl font-bold"},"0"),a("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])),_:1,__:[0]})]),_:1}),n(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[n(r,null,{default:s(()=>e[1]||(e[1]=[a("div",{class:"top-card-text"},[a("div",{class:"text-2xl font-bold"},"0"),a("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])),_:1,__:[1]})]),_:1}),n(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[n(r,null,{default:s(()=>e[2]||(e[2]=[a("div",{class:"top-card-text"},[a("div",{class:"text-2xl font-bold"},"0"),a("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])),_:1,__:[2]})]),_:1}),n(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[n(r,null,{default:s(()=>e[3]||(e[3]=[a("div",{class:"top-card-text"},[a("div",{class:"text-2xl font-bold"},"0"),a("h3",{class:"text-sm font-medium"},"Due this week")],-1)])),_:1,__:[3]})]),_:1})]),a("div",go,[n(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[n(r,null,{default:s(()=>[e[4]||(e[4]=a("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),a("div",_o,[t.isChartReady?(i(),R(b,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):w("",!0)],512)]),_:1,__:[4]})]),_:1}),n(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[n(r,null,{default:s(()=>[e[5]||(e[5]=a("div",{class:"font-medium"},"Patients distribution by age",-1)),a("div",vo,[t.isChartReady?(i(),R(b,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):w("",!0)],512)]),_:1,__:[5]})]),_:1})])],64)}const bo=W(ho,[["render",yo],["__scopeId","data-v-58e2a3d8"]]),Do=E({name:"Home",mixins:[Xt,ut],components:{IonContent:q,IonHeader:Z,IonPage:At,IonToolbar:K,Toolbar:ae,IonRow:mt,DateInputField:oe,IonIcon:G,IonButton:Gt,IonCol:pt},data(){const t=O(P.sessionDate()),e=O(P.sessionDate()),o=O(P.sessionDate()),d=O([]);return{segmentContent:"Today",minDate:o,startDate:t,endDate:e,people:d,calendarOutline:Ct,eyeOutline:je}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(t){this.segmentContent=t},formatBirthdate(t){return P.getBirthdateAge(t)},async getAppointments(){this.people=[],(await se.getAppointments(this.startDate,this.endDate,"")).forEach(e=>{const o={person_id:e.person_id,npid:e.npid,appointment_id:103,encounter_id:e.encounter_id,name:e.given_name.concat(" ",e.family_name),gender:e.gender,ageDob:this.formatBirthdate(e.birthdate),village:e.city_village,appointmentDate:P.toStandardHisDisplayFormat(e.appointment_date)};this.people.push(o)})},async getAppointmentsD1(t){this.startDate=P.toStandardHisFormat(t),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=P.toStandardHisFormat(t),await this.getAppointments()},async openClientProfile(t){await ot.findByNpid(t),this.isPharmacist()},isPharmacist(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(o=>e.some(d=>d.role==="Pharmacist"))&&(this.$router.push("dispensation"),U.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),Co={class:"appointments-container"},$o={key:0,class:"date-filter"},So={class:"appointments-table"};function wo(t,e,o,d,l,y){const r=u("ion-label"),p=u("ion-segment-button"),b=u("ion-segment"),f=u("DateInputField"),m=u("ion-col"),$=u("ion-row"),_=u("ion-icon"),C=u("ion-button"),I=u("ion-card");return i(),h("div",Co,[a("div",null,[n(b,{value:t.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:s(()=>[n(p,{value:"Today",onClick:e[0]||(e[0]=v=>t.setSegmentContent("Today"))},{default:s(()=>[n(r,null,{default:s(()=>e[3]||(e[3]=[A("Today")])),_:1,__:[3]})]),_:1}),n(p,{value:"Tomorrow",onClick:e[1]||(e[1]=v=>t.setSegmentContent("Tomorrow"))},{default:s(()=>[n(r,null,{default:s(()=>e[4]||(e[4]=[A("Tomorrow")])),_:1,__:[4]})]),_:1}),n(p,{value:"Date range",onClick:e[2]||(e[2]=v=>t.setSegmentContent("Date range"))},{default:s(()=>[n(r,null,{default:s(()=>e[5]||(e[5]=[A("Date range")])),_:1,__:[5]})]),_:1})]),_:1},8,["value"])]),t.segmentContent==="Date range"?(i(),h("div",$o,[n($,null,{default:s(()=>[n(m,null,{default:s(()=>[n(f,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),n(m,null,{default:s(()=>[n(f,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):w("",!0),t.people.length>0?(i(),R(I,{key:1},{default:s(()=>[a("table",So,[e[6]||(e[6]=a("thead",null,[a("tr",null,[a("th",null,"Name"),a("th",null,"NPID"),a("th",null,"Age/DOB"),a("th",null,"Gender"),a("th",null,"Village"),a("th",null,"Appointment Date")])],-1)),a("tbody",null,[(i(!0),h(B,null,J(t.people,v=>(i(),h("tr",{key:v.npid},[a("td",null,[n($,null,{default:s(()=>[n(m,null,{default:s(()=>[A(g(v.name),1)]),_:2},1024),n(m,null,{default:s(()=>[n(C,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:L=>t.openClientProfile(v.npid),color:"primary",fill:"clear",size:"small"},{default:s(()=>[n(_,{icon:t.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),a("td",null,g(v.npid),1),a("td",null,g(v.ageDob),1),a("td",null,g(v.gender),1),a("td",null,g(v.village),1),a("td",null,g(v.appointmentDate),1)]))),128))])])]),_:1})):(i(),R(I,{key:2},{default:s(()=>e[7]||(e[7]=[a("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])),_:1,__:[7]}))])}const ko=W(Do,[["render",wo],["__scopeId","data-v-c47f7768"]]),Io=E({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){}}}),Po={key:0},Ao={style:{display:"flex","margin-top":"10px"}},To={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},Oo={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},No={key:1};function Ro(t,e,o,d,l,y){const r=u("ion-label"),p=u("ion-segment-button"),b=u("ion-segment"),f=u("VisitsHistory");return i(),h(B,null,[a("div",null,[n(b,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:s(()=>[n(p,{value:"Internal referrals",onClick:e[0]||(e[0]=m=>t.setSegmentContent("Internal referrals"))},{default:s(()=>[n(r,null,{default:s(()=>e[2]||(e[2]=[A("Internal referrals")])),_:1,__:[2]})]),_:1}),n(p,{value:"External referrals",onClick:e[1]||(e[1]=m=>t.setSegmentContent("External referrals"))},{default:s(()=>[n(r,null,{default:s(()=>e[3]||(e[3]=[A("External referrals")])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(i(),h("div",Po,[a("div",Ao,[t.checkUnderFive?(i(),h("div",To)):w("",!0),e[4]||(e[4]=a("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?w("",!0):(i(),h("div",Oo))])])):w("",!0),t.segmentContent=="External referrals"?(i(),h("div",No,[n(f)])):w("",!0)],64)}const Bo=W(Io,[["render",Ro],["__scopeId","data-v-faad8f8b"]]),xo=E({name:"Menu",components:{IonContent:q,IonHeader:Z,IonItem:nt,IonList:at,IonMenu:rt,IonTitle:it,IonToolbar:K,IonCheckbox:ht,IonIcon:G,BasicForm:lt,BasicCard:gt,Referrals:Bo,Dashboard:bo,ANCAppointments:ko},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:jt},{id:"referrals",label:"Referrals",icon:Yt},{id:"appointments",label:"Appointments",icon:Ct}],activeItem:"dashboard"}},computed:{...Q(ft,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Vo={style:{display:"flex"}},Lo={class:"left_col"},Fo={class:"nav-menu"},Uo=["onClick"],Eo={class:"right_col"};function Mo(t,e,o,d,l,y){const r=u("ion-icon"),p=u("Dashboard"),b=u("ANCAppointments"),f=u("Referrals");return i(),h("div",Vo,[a("div",Lo,[a("nav",Fo,[a("ul",null,[(i(!0),h(B,null,J(t.menuItems,m=>(i(),h("li",{key:m.id,class:X({active:t.activeItem===m.id}),onClick:$=>t.setActiveItem(m.id)},[n(r,{icon:m.icon,size:"large",class:"menu-icon"},null,8,["icon"]),a("span",null,g(m.label),1)],10,Uo))),128))])])]),a("div",Eo,[a("div",null,[t.activeItem==="dashboard"?(i(),R(p,{key:0})):w("",!0),t.activeItem==="appointments"?(i(),R(b,{key:1})):w("",!0),t.activeItem==="referrals"?(i(),R(f,{key:2})):w("",!0)])])])}const Wo=W(xo,[["render",Mo],["__scopeId","data-v-7e786ea4"]]),zo=E({name:"Menu",components:{IonContent:q,IonHeader:Z,IonItem:nt,IonList:at,IonMenu:rt,IonTitle:it,IonToolbar:K,IonCheckbox:ht,BasicForm:lt,BasicCard:gt},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Q(ft,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Ho={class:"left_col"},Jo={class:"nav-menu"},Go=["onClick"];function jo(t,e,o,d,l,y){return i(),h("div",null,[a("div",Ho,[a("nav",Jo,[a("ul",null,[(i(!0),h(B,null,J(t.menuItems,r=>(i(),h("li",{key:r.id,class:X({active:t.activeItem===r.id}),onClick:p=>t.setActiveItem(r.id)},g(r.label),11,Go))),128))])])]),e[0]||(e[0]=a("div",{class:"right_col"},null,-1))])}const Yo=W(zo,[["render",jo],["__scopeId","data-v-32dd02d3"]]),Qo=E({name:"Menu",components:{IonContent:q,IonHeader:Z,IonItem:nt,IonList:at,IonMenu:rt,IonTitle:it,IonToolbar:K,IonCheckbox:ht,BasicForm:lt,BasicCard:gt},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Q(ft,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Zo={class:"left_col"},qo={class:"nav-menu"},Xo=["onClick"];function Ko(t,e,o,d,l,y){return i(),h("div",null,[a("div",Zo,[a("nav",qo,[a("ul",null,[(i(!0),h(B,null,J(t.menuItems,r=>(i(),h("li",{key:r.id,class:X({active:t.activeItem===r.id}),onClick:p=>t.setActiveItem(r.id)},g(r.label),11,Xo))),128))])])]),e[0]||(e[0]=a("div",{class:"right_col"},null,-1))])}const ti=W(Qo,[["render",Ko],["__scopeId","data-v-b49d8600"]]);function ei(){const t=Nt(),e=Ke(),o=O(!1),{OPDActivities:d,NCDActivities:l}=bt(e),y=async p=>{var b;try{const f=U.getUserID(),m=await Vt.getJson("user_properties",{user_id:f,property:p});return m!=null&&m.property_value?(b=m==null?void 0:m.property_value)==null?void 0:b.split(","):[]}catch(f){return console.error("Error fetching user activities:",f),[]}},r=async()=>{try{o.value=!1;const[p,b]=await Promise.all([y("OPD_activities"),y("NCD_activities")]);p.length>0&&e.setOPDActivity(p),b.length>0&&e.setNCDActivity(b)}catch(p){console.error("Error updating activities:",p)}finally{o.value=!0}};return ct(()=>t.path,async()=>{await r()},{immediate:!0,deep:!0}),{ready:o,OPDActivities:d,NCDActivities:l,getUserActivities:y,updateActivities:r}}function ai(){const t=Nt(),e=O(""),o=O(!1),d=O({}),l=()=>{const y=U.getUserRoles(),r=U.getProgramID(),p=U.getProgramName();e.value=y,o.value=!1,y==="Lab"&&r===14?d.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:r===14&&y!=="Lab"?d.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:r===12?d.value={url:"contact",btnName:"Back"}:p==="LABOUR AND DELIVERY PROGRAM"?d.value={url:"labour/labourHome",btnName:"Back to home"}:p==="PNC PROGRAM"?d.value={url:"pnc/home",btnName:"Back to home"}:d.value={url:"",btnName:""},o.value=!0};return ct(()=>t.path,()=>{l()},{immediate:!0,deep:!0}),{userRole:e,ready:o,userRoleSettings:d,updateUserRoleSettings:l}}const ni={key:0,class:"spinner-overlay"},Ti=E({__name:"HomePage",setup(t){const e=O(!0),o=Nt(),d=ee(),l=O(localStorage.getItem("sessionDate")||"");ai();const y=ta(),{apiStatus:r}=bt(Kt()),{activeProgram:p}=bt(y),b=vt(()=>{switch(p.value.program_id){case st.IMMUNIZATION_PROGRAM:return Ws;case st.OPD_PROGRAM:return mo;case st.NCD_PROGRAM:return Ln;case st.ANC_PROGRAM:return Wo;case st.PNC_PROGRAM:return ti;case st.LABOUR_AND_DELIVERY_PROGRAM:return Yo;case st.HIV_PROGRAM:return ss;default:return null}}),f=()=>{const _=localStorage.getItem("sessionDate");(!_||_.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),Mt()),l.value=_||""};let m=null;yt(()=>{m=()=>f(),window.addEventListener("storage",m);const _=setInterval(f,1e3);Ye(()=>{clearInterval(_),m&&window.removeEventListener("storage",m)}),f()}),ct(l,(_,C)=>{(!_||_.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),Mt())}),ct(()=>o.name,async _=>{_==="Home"&&(Ut(),await Et().loadGlobalProperty(),d.initWorker(),d.postData("SYNC_ALL_DATA"))},{immediate:!0,deep:!0});const $=async()=>{try{const _=U.getUserID(),C=await Vt.getUserByID(_);if(C.location_id!=null){const I=await aa.getLocation(C.location_id);localStorage.setItem("locationData",JSON.stringify(I))}}catch(_){console.error("Failed to retrieve location data:",_)}};return r.value&&(ei(),$()),yt(async()=>{try{e.value=!0,d.terminate(),Ut(),await Et().loadGlobalProperty(),_t.isEmpty(p.value)&&await ea.show(ca,{},"module-picker-modal")}catch(_){console.error("Error initializing component:",_)}finally{e.value=!1}}),(_,C)=>{const I=u("ion-spinner"),v=u("ion-content");return i(),R(H(At),null,{default:s(()=>[e.value?(i(),h("div",ni,[n(I,{name:"bubbles"}),C[0]||(C[0]=a("div",{class:"loading-text"},"Please wait...",-1))])):w("",!0),n(ae),n(ua),b.value?(i(),R(Qe(b.value),{key:1})):(i(),R(v,{key:2},{default:s(()=>C[1]||(C[1]=[a("div",{class:"container"},[a("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),a("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])),_:1,__:[1]}))]),_:1})}}});export{Ti as default};

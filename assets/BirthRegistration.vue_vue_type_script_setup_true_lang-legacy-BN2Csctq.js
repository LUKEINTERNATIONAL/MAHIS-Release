!function(){function e(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}System.register(["./index-legacy-BXpyZFmT.js","./vendor-legacy-Wjk6MKAM.js","./StandardForm.vue_vue_type_script_setup_true_lang-legacy-8fZguQIm.js","./useExposeFromStandardForm-legacy-CDtnBsX3.js","./vaccines_service-legacy-B5tTHsNg.js","./relations_service-legacy-D2T8YBKg.js"],function(t,a){"use strict";var i,n,o,l,r,d,s,u,c,m,v,p,h,_,g,f,y,b,I,D,w,T,F,S,k,R,N,x,C,B,P,V,A,L,M,E,H,O,Y,G,j,q,W,U,z,J,$,X,Z,K,Q,ee,te,ae,ie,ne;return{setters:[e=>{i=e.i,n=e.D,o=e._,l=e.ao,r=e.H,d=e.u,s=e.S,u=e.z,c=e.aY,m=e.m,v=e.E,p=e.f,h=e.P,_=e.X,g=e.l,f=e.a4,y=e.j,b=e.a7,I=e.b,D=e.L,w=e.G},e=>{T=e.d,F=e.W,S=e.I,k=e.G,R=e.ac,N=e.ab,x=e.d2,C=e.aa,B=e.dt,P=e.D,V=e.X,A=e.E,L=e.e,M=e.f,E=e.m,H=e.l,O=e.k,Y=e.z,G=e.A,j=e.F,q=e.c,W=e.b1,U=e.a,z=e.w,J=e.y,$=e.u,X=e.B,Z=e.L,K=e.O,Q=e.r,ee=e.bV},e=>{te=e._},e=>{ae=e.u},e=>{ie=e.g},e=>{ne=e.R}],execute:function(){var a=document.createElement("style");a.textContent=".large-card[data-v-ffb46cdd]{padding:5%;border-radius:15px;border:1px solid #ccc;height:82vh;background-color:#fff;overflow-y:auto;-webkit-box-shadow:0px -2px 19px -2px rgba(196,190,196,1);-moz-box-shadow:0px -2px 19px -2px rgba(196,190,196,1);box-shadow:0 -2px 19px -2px #c4bec4}.header[data-v-ffb46cdd]{display:flex;gap:20px;padding:10px 20px}.position_content[data-v-ffb46cdd]{max-width:100vw}.accordion-expanded[data-v-ffb46cdd]{background-color:#ded}button[aria-expanded=false][data-v-ffb46cdd]{background:rgba(var(--ion-color-rose-rgb),.25)}ion-accordion.accordion-expanding ion-item[slot=header][data-v-ffb46cdd],ion-accordion.accordion-expanded ion-item[slot=header][data-v-ffb46cdd]{--background: #ddeedd}\n/*$vite$:1*/",document.head.appendChild(a),t("u",Ie);const oe=T({components:{IonLabel:P,IonAvatar:B,IonRow:C,IonImg:x,IonCol:N,IonList:R,IonItem:k,IonIcon:S,IonButton:F,DynamicButton:n},data:()=>({selectedResult:{},iconsContent:i,isAnyAccordionOpen:!0,isLoading:!1}),methods:{dismiss(e){V.dismiss(e)}}}),le={key:0,class:"spinner-overlay"};const re=t("C",o(oe,[["render",function(e,t,a,i,n,o){const l=A("ion-spinner"),r=A("ion-title"),d=A("ion-icon"),s=A("ion-header"),u=A("center"),c=A("ion-content"),m=A("DynamicButton"),v=A("ion-col"),p=A("ion-row"),h=A("ion-footer");return M(),L(j,null,[e.isLoading?(M(),L("div",le,[H(l,{name:"bubbles"}),t[3]||(t[3]=O("div",{class:"loading-text"},"Please wait...",-1))])):E("",!0),H(s,{style:{display:"flex","justify-content":"space-between"}},{default:Y(()=>[H(r,{class:"modalTitle"},{default:Y(()=>t[4]||(t[4]=[G("Printer")])),_:1,__:[4]}),H(d,{onClick:t[0]||(t[0]=t=>e.dismiss("dismiss")),style:{"padding-top":"10px","padding-right":"10px"},icon:e.iconsContent.cancel},null,8,["icon"])]),_:1}),H(c,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:Y(()=>[H(u,null,{default:Y(()=>t[5]||(t[5]=[O("h3",{class:"ion-padding"},"Do you want to print a barcode?",-1)])),_:1,__:[5]})]),_:1}),H(h,null,{default:Y(()=>[H(p,null,{default:Y(()=>[H(v,null,{default:Y(()=>[H(m,{color:"danger",onClick:t[1]||(t[1]=t=>e.dismiss("dismiss")),name:"No",fill:"solid",style:{float:"right","margin-right":"2%",width:"100px"}}),H(m,{onClick:t[2]||(t[2]=t=>e.dismiss("Yes")),name:"Yes",fill:"solid",style:{float:"right","margin-right":"2%",width:"100px"}})]),_:1})]),_:1})]),_:1})],64)}]])),de=(t("c",T({__name:"PersonalInformation",setup(e,{expose:t}){const a=d(),{patient:n}=W(a),{personalInformation:o}=(()=>{function e(e,t){const a=new Date(e);return a.setFullYear(a.getFullYear()-t),a.toISOString().split("T")[0]}return{personalInformation:q(()=>[{componentType:"Heading",name:"Personal Information",position:"center"},{componentType:"inputField",header:"National ID",name:"nationalID",placeholder:"__-__-__-__",icon:i.nationalID,validation:e=>l.isMWNationalID(e)},{componentType:"inputField",header:"First name",name:"firstname",icon:i.fullName,validation:e=>l.isName(e)},{componentType:"inputField",header:"Middle name",name:"middleName",icon:i.fullName,validation:e=>l.isNamesEmpty(e)},{componentType:"inputField",header:"Last name",name:"lastname",icon:i.fullName,validation:e=>l.isName(e)},{componentType:"radioButtonField",header:"Gender",name:"gender",type:"inline",validation:e=>l.required(e),options:[{label:"Male",value:"M"},{label:"Female",value:"F"}]},{componentType:"dateInputField",header:"Date of birth",name:"birthdate",icon:i.calenderPrimary,minDate:e(r.sessionDate(),110),validation:e=>l.required(e),condition:e=>!e.Estimate,disabled:e=>e.Estimate},{componentType:"inputField",header:"Estimated age",name:"estimation",icon:i.time,validation:e=>l.isEstimationDate(e),initialUnit:"Years",unitOptions:[{label:"Days",value:"Days"},{label:"Months",value:"Months"},{label:"Years",value:"Years"}],unitValidation:e=>e&&""!==e?null:"Please select a unit.",condition:e=>e.Estimate},{componentType:"checkboxField",name:"Estimate",type:"single",label:"Estimate age"},{componentType:"phoneInputField",name:"Phone Number",header:"Phone Number",validation:e=>l.isMWPhoneNumber(e.phoneNumber)}])}})(),{formRef:s,exposeFormMethods:u}=ae();U(()=>{c(n.value.personInformation)}),z(()=>n.value.personInformation,e=>{c(e)});const c=e=>{var t,a,i,n;null===(t=s.value)||void 0===t||t.setFormValue("firstname",null==e?void 0:e.given_name),null===(a=s.value)||void 0===a||a.setFormValue("lastname",null==e?void 0:e.family_name),null===(i=s.value)||void 0===i||i.setFormValue("gender","male"==(null==e?void 0:e.gender)?"M":"female"==(null==e?void 0:e.gender)?"F":""),null===(n=s.value)||void 0===n||n.setFormValue("birthdate",null!=e&&e.birthdate?r.toStandardHisDisplayFormat(null==e?void 0:e.birthdate):"")};return t(u()),(e,t)=>(M(),J(te,{formData:$(o),ref_key:"formRef",ref:s},null,8,["formData"]))}})),T({components:{IonLabel:P,IonAvatar:B,IonRow:C,IonImg:x,IonCol:N,IonList:R,IonItem:k,IonIcon:S,IonButton:F},data:()=>({selectedResult:{},iconsContent:i,isAnyAccordionOpen:!0,isLoading:!1}),methods:{updateAccordionState(e){const t=this.$refs.accordionGroup;this.isAnyAccordionOpen=void 0!==t.value},dismiss(e){V.dismiss(e)},async init(){this.setData(this.deduplicationData[0]||{})},async onSelect(){V.dismiss(this.selectedResult)},setData(e){this.selectedResult=e},dateFormat:e=>r.toStandardHisDisplayFormat(e),probabilityToPercentage:e=>(100*e).toFixed(2)+"%"},props:{deduplicationData:{default:[]},to_be_registered:{default:[]}},mounted(){this.init()},activated(){this.init()}})),se={key:0,class:"spinner-overlay"},ue={class:"header position_content"},ce={style:{"font-size":"1.2em","font-weight":"700"}},me={class:"due_date"},ve={class:"ion-padding",slot:"content"},pe={style:{display:"flex","justify-content":"end",gap:"10px"}};const he=o(de,[["render",function(e,t,a,i,n,o){const l=A("ion-spinner"),r=A("ion-icon"),d=A("ion-header"),s=A("ion-label"),u=A("ion-item"),c=A("ion-col"),m=A("ion-row"),v=A("ion-accordion"),p=A("ion-accordion-group"),h=A("ion-content"),_=A("ion-button"),g=A("ion-footer");return M(),L(j,null,[e.isLoading?(M(),L("div",se,[H(l,{name:"bubbles"}),t[3]||(t[3]=O("div",{class:"loading-text"},"Please wait...",-1))])):E("",!0),H(d,null,{default:Y(()=>[O("div",ue,[O("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=t=>e.dismiss("back"))},[H(r,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeft},null,8,["icon"])]),O("div",ce,"Matches found: ("+X(e.deduplicationData.length)+")",1)])]),_:1}),H(h,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:Y(()=>[H(p,{ref:"accordionGroup",class:"previousView",value:"0",onIonChange:e.updateAccordionState},{default:Y(()=>[(M(!0),L(j,null,Z(e.deduplicationData,(a,i)=>(M(),J(v,{style:{"margin-bottom":"15px"},value:i,"toggle-icon-slot":"start",class:"custom_card",button:"",key:i,detail:!0,color:a.value===e.selectedResult.value?"light":"",onClick:t=>e.setData(a)},{default:Y(()=>[H(u,{slot:"header"},{default:Y(()=>[H(s,{class:"previousLabel"},{default:Y(()=>{var e,t;return[G(X(null==a||null===(e=a.person)||void 0===e?void 0:e.given_name)+" "+X(null==a||null===(t=a.person)||void 0===t?void 0:t.family_name),1)]}),_:2},1024),O("div",me,[t[4]||(t[4]=G(" Score: ")),O("b",null,X(e.probabilityToPercentage(null==a?void 0:a.score)||"-"),1)])]),_:2},1024),O("div",ve,[H(m,null,{default:Y(()=>[H(c,null,{default:Y(()=>t[5]||(t[5]=[O("b",null,"To be Registered",-1)])),_:1,__:[5]}),H(c,null,{default:Y(()=>t[6]||(t[6]=[O("b",null,"Already Registered",-1)])),_:1,__:[6]})]),_:1}),H(m,null,{default:Y(()=>[H(c,null,{default:Y(()=>[H(m,null,{default:Y(()=>{var a,i;return[t[7]||(t[7]=G(" Name: ")),O("b",null,X(null===(a=e.to_be_registered)||void 0===a?void 0:a.given_name)+" "+X(null===(i=e.to_be_registered)||void 0===i?void 0:i.family_name),1)]}),_:1,__:[7]}),H(m,null,{default:Y(()=>{var a;return[t[8]||(t[8]=G("Gender: ")),O("b",null,X(null===(a=e.to_be_registered)||void 0===a?void 0:a.gender),1)]}),_:1,__:[8]}),H(m,null,{default:Y(()=>{var a;return[t[9]||(t[9]=G("Birthdate: ")),O("b",null,X(null===(a=e.to_be_registered)||void 0===a?void 0:a.birthdate),1)]}),_:1,__:[9]}),H(m,null,{default:Y(()=>{var a;return[t[10]||(t[10]=G("Home District: ")),O("b",null,X(null===(a=e.to_be_registered)||void 0===a?void 0:a.home_district),1)]}),_:1,__:[10]}),H(m,null,{default:Y(()=>{var a;return[t[11]||(t[11]=G("Home TA: ")),O("b",null,X(null===(a=e.to_be_registered)||void 0===a?void 0:a.home_traditional_authority),1)]}),_:1,__:[11]})]),_:1}),H(c,null,{default:Y(()=>[H(m,null,{default:Y(()=>{var e,i;return[t[12]||(t[12]=G(" Name: ")),O("b",null,X(null==a||null===(e=a.person)||void 0===e?void 0:e.given_name)+" "+X(null==a||null===(i=a.person)||void 0===i?void 0:i.family_name),1)]}),_:2,__:[12]},1024),H(m,null,{default:Y(()=>{var e;return[t[13]||(t[13]=G("Gender: ")),O("b",null,X(null==a||null===(e=a.person)||void 0===e?void 0:e.gender),1)]}),_:2,__:[13]},1024),H(m,null,{default:Y(()=>{var i;return[t[14]||(t[14]=G("Birthdate: ")),O("b",null,X(e.dateFormat(null==a||null===(i=a.person)||void 0===i?void 0:i.birthdate)),1)]}),_:2,__:[14]},1024),H(m,null,{default:Y(()=>{var e;return[t[15]||(t[15]=G("Home District: ")),O("b",null,X(null==a||null===(e=a.person)||void 0===e?void 0:e.home_district),1)]}),_:2,__:[15]},1024),H(m,null,{default:Y(()=>{var e;return[t[16]||(t[16]=G("Home TA: ")),O("b",null,X(null==a||null===(e=a.person)||void 0===e?void 0:e.home_traditional_authority),1)]}),_:2,__:[16]},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["value","color","onClick"]))),128))]),_:1},8,["onIonChange"])]),_:1}),H(g,{collapse:"fade",class:"ion-no-border"},{default:Y(()=>[O("div",pe,[H(_,{fill:"solid",color:"secondary",onClick:t[1]||(t[1]=t=>e.dismiss("dismiss"))},{default:Y(()=>t[17]||(t[17]=[G(" Not Duplicate ")])),_:1,__:[17]}),H(_,{onClick:t[2]||(t[2]=t=>e.onSelect()),fill:"solid",disabled:!e.isAnyAccordionOpen},{default:Y(()=>t[18]||(t[18]=[G("Select ")])),_:1,__:[18]},8,["disabled"])])]),_:1})],64)}],["__scopeId","data-v-ffb46cdd"]]),_e=m();class ge{async getDDEIds(){const e=s.getUseIndexDBStatus(),t=s.getModsStatus(),a=s.getAPIStatus();if(e)return await u("dde");if(t){const e=await c();return(null==e?void 0:e.npid)||[]}if(a)try{const e=await s.getJson("/dde/patients/sync_npids",{count:1,program_id:s.getProgramID()});return(null==e?void 0:e.npids)||[]}catch(i){return[]}return[]}async updateDDEIds(e){e=e.slice(1),_e.postData("OVERRIDE_OBJECT_STORE",{storeName:"dde",data:e})}async possibleDuplicates(e){try{const a=new v,i=await a.checkPotentialDuplicates(e);if(i.length>0){const n=await p(he,{class:"fullScreenModal"},!0,{to_be_registered:e,deduplicationData:i});if("dismiss"!=n&&"back"!=n){var t;const e=await a.importPatient(null==n||null===(t=n.person)||void 0===t?void 0:t.id),i=await h.findByID(e.patient_id);return await d().setPatientRecord(i),!0}return"back"==n}return!1}catch(a){return!1}}}class fe{getRegion(e){return{1:"Central Region",2:"Northern Region",3:"Southern Region",4:"Foreign"}[e]}hasValidData(e,t=[]){return!(!e||"object"!=typeof e)&&(0===t.length?Object.values(e).some(e=>null!=e&&""!==e):t.every(t=>null!==e[t]&&void 0!==e[t]&&""!==e[t]))}async buildObservation(e,t){if(!t)return null;const a="object"==typeof t&&t.name?t.name:t;return await _.buildValueText(e,a)}buildGuardianInfo(e){const t={};return t.given_name=(null==e?void 0:e.guardianFirstname)||"",t.middle_name=(null==e?void 0:e.guardianMiddleName)||"",t.family_name=(null==e?void 0:e.guardianLastname)||"",t.cell_phone_number=(null==e?void 0:e.guardianPhoneNumber.phoneNumber)||"",t.national_id=(null==e?void 0:e.guardianNationalID)||"",t.gender="",t.birthdate="",t.birthdate_estimated="false",t.home_region="",t.home_district="",t.home_traditional_authority="",t.home_village="",t.current_region="",t.current_district="",t.current_traditional_authority="",t.current_village="",t.landmark="",{saved:[],unsaved:[t]}}async buildVitals(e){return null!=e&&e.Weight?{saved:[],unsaved:[await this.buildObservation("Weight",e.Weight)]}:null}async buildARTPatientType(e,t){const a=[];let i=[];return e&&a.push(await _.buildValueText("Art clinic location",e)),t&&a.push(await _.buildValueCoded("Type of patient",t)),0===a.length?[]:(i=[{encounter_type:"REGISTRATION",status:"unsaved",obs:a}],i)}async buildBirthRegistrationObservations(e){if(!this.hasValidData(e))return null;const t=(await Promise.all([this.buildObservation("How many doses of Tdv did the mother receive?",e["How many doses of Tdv did the mother receive?"]),this.buildObservation("Protected at birth",e["Protected at birth"]),this.buildObservation("HIV status",e["HIV status"])])).filter(e=>null!==e);return t.length>0?t:null}async buildPatientRecord(e,t){var a,i,n,o,l,r,d,u,c,m,v,p,h;const{personalInformation:_,currentLocation:g,homeLocation:f,birthRegistration:y,guardianInformation:b,socialHistory:I,patientType:D}=e;return{patientID:t,ID:t,NcdID:"",personInformation:{given_name:(null==_?void 0:_.firstname)||"",middle_name:(null==_?void 0:_.middleName)||"",family_name:(null==_?void 0:_.lastname)||"",gender:(null==_?void 0:_.gender)||"",birthdate:null!=_&&_.Estimate?(new ye).calculateDoB(null==_?void 0:_.estimation,(null==_?void 0:_.estimation_unit)||"Years"):(null==_?void 0:_.birthdate)||"",birthdate_estimated:null!=_&&_.Estimate?"true":"false",home_region:this.getRegion(null==f||null===(a=f.home_district)||void 0===a?void 0:a.region_id)||"",home_district:(null==f||null===(i=f.home_district)||void 0===i?void 0:i.name)||"",home_traditional_authority:(null==f||null===(n=f.home_traditional_authority)||void 0===n?void 0:n.name)||"",home_village:(null==f||null===(o=f.home_village)||void 0===o?void 0:o.name)||"",current_region:this.getRegion(null==g||null===(l=g.current_district)||void 0===l?void 0:l.region_id)||"",current_district:(null==g||null===(r=g.current_district)||void 0===r?void 0:r.name)||"",current_traditional_authority:(null==g||null===(d=g.current_traditional_authority)||void 0===d?void 0:d.name)||"",current_village:(null==g||null===(u=g.current_village)||void 0===u?void 0:u.name)||"",country:(null==e?void 0:e.country.country.name)||"",landmark:(null==g||null===(c=g.closestLandmark)||void 0===c?void 0:c.name)||"",cell_phone_number:(null===(m=_["Phone Number"])||void 0===m?void 0:m.phoneNumber)||"",occupation:(null==I?void 0:I.occupation)||"",marital_status:(null==I?void 0:I.maritalStatus)||"",religion:(null==I||null===(v=I.religion)||void 0===v?void 0:v.name)||"",education_level:(null==I?void 0:I.highestLevelOfEducation)||""},guardianInformation:this.buildGuardianInfo(b),birthRegistration:await this.buildBirthRegistrationObservations(y),otherPersonInformation:{nationalID:(null==_?void 0:_.nationalID)||"",ichisID:s.getIchisId()||"",TEI:s.getTEI()||"",birthID:y["Serial Number"]||"",relationshipID:(null==b||null===(p=b.relationship)||void 0===p?void 0:p.id)||""},vitals:await this.buildVitals(y),vaccineSchedule:await ie(null==_?void 0:_.gender,null==_?void 0:_.birthdate),vaccineAdministration:{orders:[],obs:[],voided:[]},observations:await this.buildARTPatientType(null==D||null===(h=D.facility)||void 0===h?void 0:h.name,null==D?void 0:D.patient_type),appointments:{saved:[],unsaved:[]},saveStatusPersonInformation:"pending",saveStatusGuardianInformation:"pending",saveStatusBirthRegistration:"pending",saveStatusVitals:"pending",date_created:"",creator:"",sync_status:"unsynced"}}}class ye extends s{constructor(){super(),e(this,"patientRecordBuilder",void 0),this.patientRecordBuilder=new fe}async saveRegistrationData(e){var t;const a=await(new ge).getDDEIds();if(a.length<=0&&g("DDE IDs are not available."),a.length<=0&&!s.getAPIStatus())return!1;const i=await this.patientRecordBuilder.buildPatientRecord(e,null===(t=a[0])||void 0===t?void 0:t.npid);if(s.getAPIStatus()&&!s.getModsStatus()&&await(new ge).possibleDuplicates(i.personInformation))return!0;const n=await(async e=>{const t=s.getIchisDiagnosis();if(t.length<=0)return;const a=await Promise.all(t.map(async e=>{var t;const a=(null==e||null===(t=e.value)||void 0===t||null===(t=t.match(/[\d.]+/))||void 0===t?void 0:t[0])||"",i=null==e?void 0:e.date;if("NCD_CV_D_Likelihood of Diabetes"==e.display){var n;const t=null==e||null===(n=e.id)||void 0===n?void 0:n.split("-");return await _.buildValueNumber("Unspecified Diabetes",a,null,null,i,t[1])}return"NCD_SHD_CV_Client waist circumference"==e.display?await _.buildValueNumber("Waist circumference",a,null,null,i):"NCD_SHD_CV_Client systolic blood pressure"==e.display?await _.buildValueNumber("Systolic blood pressure",a,null,null,i):"NCD_SHD_CV_Client diastolic blood pressure"==e.display?await _.buildValueNumber("Diastolic blood pressure",a,null,null,i):void 0}));return e.observations.push({encounter_type:"VITALS",status:"unsaved",obs:a}),e})(i);return console.log("🚀 ~ RegistrationService ~ saveRegistrationData ~ patientRecordData:",n),!!(await f(n))&&(y("Registration successful"),s.getUseIndexDBStatus()&&await(new ge).updateDDEIds(a),await this.printBarcode(),!0)}checkIfChild(e){if(!(null!=e&&e.estimation||null!=e&&e.birthdate))return{moreThanThirteenYears:!0,underNineMonths:!1,underFiveYears:!1};let t="";return t=e.estimation?this.calculateDoB(e.estimation,e.estimation_unit||"Years")||"":e.birthdate,{moreThanThirteenYears:r.getAgeInYears(t)>13,underNineMonths:r.ageInMonths(t)<9,underFiveYears:r.getAgeInYears(t)<5}}async printBarcode(){"dismiss"!==await p(re,{class:"small-confirm-modal "})&&(new b).printData("barcode")}calculateDoB(e,t){try{let a=K(s.getSessionDate());if("Years"===t&&e<0)a=a.add(Math.abs(e),"years");else switch(t){case"Days":a=a.subtract(e,"days");break;case"Months":a=a.subtract(e,"months");break;case"Years":a=a.subtract(e,"years");break;default:return null}return r.toStandardHisDisplayFormat(a.format("YYYY-MM-DD"))||""}catch(a){return console.error("Error calculating date:",a),null}}}t("R",ye);const be=(e,t)=>{const a=q(()=>(new ye).checkIfChild(e.value).moreThanThirteenYears),{getRelationships:n}=function(){const e=Q([]),t=Q([]),a=Q([]),i=I();ee();const n=q(()=>i.apiStatus),o=e=>{var i;const n=["Brother","Father","Son","Grandfather","Grandson","Boyfriend","Stepfather","Stepson"],o=["Sister","Mother","Daughter","Grandmother","Granddaughter","Girlfriend","Stepmother","Stepdaughter"],l=["Spouse/Partner","Aunt/Uncle","Niece/Nephew","Doctor","Other","Patient","TB Contact Person","TB Patient","treatment suporter"];(null===(i=t.value)||void 0===i?void 0:i.length)>0&&(a.value=t.value.filter(t=>"M"===e?n.includes(t.a_is_to_b)||l.includes(t.a_is_to_b):"F"===e&&(o.includes(t.a_is_to_b)||l.includes(t.a_is_to_b))))};return{relationships:e,relationshipsData:t,filteredRelationships:a,apiStatus:n,getRelationships:async l=>{var r;if(l)return t.value=await u("relationship"),n.value&&t.value.length!==(null===(r=i.offlineRelationshipStatus)||void 0===r?void 0:r.total)&&(t.value=await ne.getRelations()),o(l),e.value=e.value=a.value.map(e=>[{name:e.b_is_to_a,id:e.relationship_type_id,trackByID:e.relationship_type_id+e.b_is_to_a}]).reduce((e,t)=>e.concat(t),[]),e.value},filterRelationships:o}}(),o=Q();z(e,async e=>{e&&(o.value=await n(e.gender))});return{guardianInformation:q(()=>[{componentType:"Heading",name:"Guardian Information",position:"center"},{componentType:"inputField",header:"Guardian National ID",name:"guardianNationalID",placeholder:"__-__-__-__",icon:i.nationalID,validation:e=>l.isMWNationalID(e)},{componentType:"inputField",header:"First name",name:"guardianFirstname",icon:i.fullName,validation:e=>a.value?l.isNameEmpty(e):l.isName(e)},{componentType:"inputField",header:"Middle name",name:"guardianMiddleName",icon:i.fullName,validation:e=>l.isNameEmpty(e)},{componentType:"inputField",header:"Last name",name:"guardianLastname",icon:i.fullName,validation:e=>a.value?l.isNameEmpty(e):l.isName(e)},{componentType:"phoneInputField",name:"guardianPhoneNumber",header:"Phone Number",validation:e=>l.isMWPhoneNumber(e.phoneNumber)},{componentType:"multiSelectInputField",header:"Relationship to patient",name:"relationship",trackBy:"trackByID",icon:i.search,validation:e=>a.value?null:l.required(null==e?void 0:e.name),options:()=>o.value,disabled:()=>!o.value}])}};t("b",T({__name:"GuardianInformation",props:{personalInformationFormValues:{}},setup(e,{expose:t}){const{formRef:a,exposeFormMethods:i}=ae(),n=e,o=q(()=>n.personalInformationFormValues),{guardianInformation:l}=be(o);return t(i()),(e,t)=>(M(),J(te,{formData:$(l),ref_key:"formRef",ref:a},null,8,["formData"]))}}));function Ie(){const e=Q([]),t=Q([]),a=Q([]),i=Q([]),n=Q([]),o=Q([]),l=Q(null),r=Q(null),d=Q(!1),s=I(),c=q(()=>s.apiStatus);z(l,async e=>{if(e)try{t.value=await v(e)}catch(a){t.value=[]}else t.value=[]}),z(r,async e=>{if(e)try{a.value=await m(e)}catch(t){a.value=[]}else a.value=[]});const m=async e=>{try{const t=await u("villages",{whereClause:{traditional_authority_id:e}});return t.length>0?t:c.value?await D.getVillages(e):[]}catch(t){return console.error("Error getting villages:",t),[]}},v=async e=>{try{const t=await u("TAs",{whereClause:{district_id:e}});return t.length>0?t:c.value?await D.getTraditionalAuthorities(e):[]}catch(t){return console.error("Error getting TAs:",t),[]}};return{districtList:e,countriesList:i,locations:o,isLoading:d,selectedDistrictId:l,TAs:t,villages:a,selectedTraditionalAuthorityId:r,facilityList:n,apiStatus:c,getVillages:m,getTAs:v,getDistricts:async()=>{d.value=!0;try{var t;if(e.value=await u("districts"),c.value&&e.value.length!==(null===(t=s.offlineDistrictStatus)||void 0===t?void 0:t.total))for(let t of[1,2,3]){const a=await D.getDistricts(t);e.value.push(...a)}return e.value}catch(a){console.error("Error loading location data:",a)}finally{d.value=!1}},getCountries:async()=>{d.value=!0;try{var e;return i.value=await u("countries"),c.value&&i.value.length!==(null===(e=s.offlineCountriesStatus)||void 0===e?void 0:e.total)&&(i.value=await D.getDistricts(4)),i.value}catch(t){console.error("Error loading location data:",t)}finally{d.value=!1}},getFacilities:async()=>{n.value=await D.getAllFacilities()}}}const De=(e,t)=>(null==e||!e.same_as_current)&&!(null!=t&&t.length),we=(e,t)=>a=>{setTimeout(()=>{a?((e,t)=>{if(null==e||!e.value||null==t||!t.value)return;const{current_district:a,current_traditional_authority:i,current_village:n}=e.value;t.value.setFormValue("home_district",a),t.value.setFormValue("home_traditional_authority",i),t.value.setFormValue("home_village",n)})(e,t):(e=>{null!=e&&e.value&&(e.value.setFormValue("home_district",[]),e.value.setFormValue("home_traditional_authority",[]),e.value.setFormValue("home_village",[]))})(t)},0)};t("_",T({__name:"HomeLocation",props:{currentLocationFormValues:{}},setup(e,{expose:t}){const a=e,{formRef:n,exposeFormMethods:o}=ae(),r=q(()=>a.currentLocationFormValues),{homeLocation:d}=((e,t)=>{const{getDistricts:a,districtList:n,selectedTraditionalAuthorityId:o,villages:r,selectedDistrictId:d,TAs:s}=Ie();a();const u=q(()=>[{componentType:"Heading",name:"Home Location",position:"center"},{componentType:"checkboxField",type:"single",name:"same_as_current",label:"Same as current",onChange:we(e,t)},{componentType:"multiSelectInputField",header:"Home district",name:"home_district",trackBy:"district_id",icon:i.search,validation:l.required,options:n.value,onChange:e=>((e,t,a)=>{t.value=(null==e?void 0:e.district_id)||null,null!=a&&a.value&&(a.value.setFormValue("home_traditional_authority",[]),a.value.setFormValue("home_village",[]))})(e,d,t)},{componentType:"multiSelectInputField",header:"Home traditional authority",name:"home_traditional_authority",trackBy:"traditional_authority_id",validation:l.required,icon:i.search,options:s.value,disabled:e=>De(e,s.value),onChange:e=>((e,t,a)=>{var i;t.value=(null==e?void 0:e.traditional_authority_id)||null,null==a||null===(i=a.value)||void 0===i||i.setFormValue("home_village",[])})(e,o,t),openDirection:"auto"},{componentType:"multiSelectInputField",header:"Home village",name:"home_village",trackBy:"village_id",icon:i.search,validation:l.required,options:r.value,disabled:e=>De(e,r.value),openDirection:"auto"}]);return{homeLocation:u}})(r,n);return t(o()),(e,t)=>(M(),J(te,{formData:$(d),ref_key:"formRef",ref:n},null,8,["formData"]))}})),t("a",T({__name:"CurrentLocation",setup(e,{expose:t}){const{currentLocation:a}=(()=>{const e=Q(!1),{getDistricts:t,districtList:a,selectedTraditionalAuthorityId:n,villages:o,selectedDistrictId:r,TAs:d}=Ie();return t(),{currentLocation:q(()=>[{componentType:"Heading",name:"Current Location",position:"center"},{componentType:"multiSelectInputField",header:"Current district",name:"current_district",trackBy:"district_id",validation:e=>l.required(e),icon:i.search,options:a.value,onChange:(e,t)=>{r.value=(null==e?void 0:e.district_id)||null}},{componentType:"multiSelectInputField",header:"Current traditional authority",name:"current_traditional_authority",trackBy:"traditional_authority_id",validation:e=>l.required(e),icon:i.search,options:d.value,disabled:e=>{var t;return!(null!=d&&null!==(t=d.value)&&void 0!==t&&t.length)},onChange:(e,t)=>{n.value=(null==e?void 0:e.traditional_authority_id)||null}},{componentType:"multiSelectInputField",header:"Current village",name:"current_village",trackBy:"village_id",icon:i.search,validation:e=>l.required(e),options:o.value,disabled:e=>{var t;return!(null!=o&&null!==(t=o.value)&&void 0!==t&&t.length)}},{componentType:"multiSelectInputField",header:"Closest landmark/Plot number",name:"closestLandmark",trackBy:"id",icon:i.search,options:[{id:1,name:"Church"},{id:2,name:"Mosque"},{id:3,name:"Primary School"},{id:4,name:"Borehole"},{id:5,name:"Secondary School"},{id:6,name:"College"},{id:7,name:"Market"},{id:8,name:"Football Ground"},{id:9,name:"Other"}]}]),TAs:d,isLoadingTAs:e,selectedDistrictId:r}})(),{formRef:n,exposeFormMethods:o}=ae();return t(o()),(e,t)=>(M(),J(te,{formData:$(a),ref_key:"formRef",ref:n},null,8,["formData"]))}})),t("d",T({__name:"SocialHistory",setup(e,{expose:t}){const{socialHistory:a}=(()=>{const e=Q();return w.isProp("military_site=true").then(t=>{e.value=t}),{socialHistory:q(()=>[{componentType:"Heading",name:"Social History",position:"center"},{componentType:"multiSelectInputField",header:"Religion",name:"religion",icon:i.search,trackBy:"id",options:[{id:1,name:"Christianity"},{id:2,name:"Islam"},{id:3,name:"Judaism"},{id:4,name:"Hinduism"},{id:5,name:"Buddhism"},{id:6,name:"Sikhism"},{id:7,name:"Jainism"},{id:8,name:"Bahá'í Faith"},{id:9,name:"Zoroastrianism"},{id:10,name:"Confucianism"},{id:11,name:"Taoism"},{id:12,name:"Shinto"},{id:13,name:"Baha'i Faith"},{id:14,name:"Juche"},{id:15,name:"Rastafari"}]},{componentType:"radioButtonField",header:"Occupation status",name:"occupation",type:"inline",validation:l.required,condition:()=>1==s.getProgramID()&&e.value,options:[{label:"Military",value:"Military"},{label:"Civilian",value:"Civilian"}]},{componentType:"radioButtonField",header:"Occupation status",name:"occupation",type:"inline",condition:t=>!e,options:[{label:"Employed",value:"employed"},{label:"Student",value:"Student"},{label:"Unemployed",value:"unemployed"},{label:"Other",value:"Other"}]},{componentType:"radioButtonField",header:"Marital status",name:"maritalStatus",type:"inline",options:[{label:"Single",value:"single"},{label:"Married",value:"married"},{label:"Widow",value:"widow"},{label:"Widower",value:"widower"},{label:"Divorced",value:"divorced"}]},{componentType:"radioButtonField",header:"Highest level of education",name:"highestLevelOfEducation",type:"inline",options:[{label:"No education",value:"No education"},{label:"Primary school",value:"primary school"},{label:"Secondary school",value:"secondary school"},{label:"Tertiary education",value:"tertiary education"}]}])}})(),{formRef:n,exposeFormMethods:o}=ae();return t(o()),(e,t)=>(M(),J(te,{formData:$(a),ref_key:"formRef",ref:n},null,8,["formData"]))}})),t("e",T({__name:"BirthRegistration",setup(e,{expose:t}){const{formRef:a,exposeFormMethods:n}=ae(),{birthRegistration:o}=(e=>({birthRegistration:q(()=>[{componentType:"Heading",name:"Birth Registration",position:"center"},{componentType:"inputField",header:"Birth certificate number",name:"Serial Number",icon:i.nationalID,placeholder:"__-__-__-__"},{componentType:"inputField",header:"Birth Weight/First weight (kg)",name:"Weight",icon:i.weight,validation:e=>l.validateWeight(e)},{componentType:"multiSelectInputField",header:"How many doses of Tdv did the mother receive?",name:"How many doses of Tdv did the mother receive?",icon:i.search,options:[{concept_id:11997,name:"0-2 doses, less than two weeks before delivery"},{concept_id:11998,name:"2-5 doses more than two weeks of delivery"},{concept_id:1067,name:"Unknown"}],trackBy:"concept_id",validation:e=>l.required(e),onChange:t=>{const a=null==t?void 0:t.name;"Unknown"==a?e.value.setFormValue("Protected at birth",{concept_id:1067,name:"Don't know"}):"0-2 doses, less than two weeks before delivery"==a?e.value.setFormValue("Protected at birth",{concept_id:1066,name:"No"}):"2-5 doses more than two weeks of delivery"==a&&e.value.setFormValue("Protected at birth",{concept_id:1065,name:"Yes"})}},{componentType:"multiSelectInputField",header:"Protected at birth (PAB)",name:"Protected at birth",icon:i.search,trackBy:"concept_id",validation:e=>l.required(e),disabled:e=>!e["How many doses of Tdv did the mother receive?"]},{componentType:"multiSelectInputField",header:"HIV status of the Child's Mother",name:"HIV status",icon:i.search,options:[{id:703,name:"Positive"},{id:664,name:"Negative"},{id:1067,name:"Unknown"}],trackBy:"id",validation:e=>l.required(e)}])}))(a);return t(n()),(e,t)=>(M(),J(te,{formData:$(o),ref_key:"formRef",ref:a},null,8,["formData"]))}}))}}})}();

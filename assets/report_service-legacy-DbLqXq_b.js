!function(){function t(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}System.register(["./vendor-legacy-Co5nIMqP.js","./index-legacy-BQ75WRWR.js","./lodash-legacy-C-x9g9Na.js"],(function(e,n){"use strict";var r,a,s,i,o,l,u,c,d,p,f,h,m,g,b,y,v,w,D,P,$,j,B,_,Q,A,F,S,I,M,O,V,q,x,R,T,U,k,C;return{setters:[t=>{r=t.dP,a=t.c,s=t.r,i=t.ev,o=t.bS,l=t.bT,u=t.O,c=t.d,d=t.y,p=t.f,f=t.z,h=t.l,m=t.u,g=t.S,b=t.U,y=t.b0,v=t.W,w=t.I,D=t.aO,P=t.T,$=t.A,j=t.B,B=t.ad,_=t.ew,Q=t.b5,A=t.ex},t=>{F=t.A,S=t.d,I=t.e,M=t.s,O=t.f,V=t.g,q=t.m,x=t._,R=t.h,T=t.i,U=t.c,k=t.j},t=>{C=t.l}],execute:function(){var n=document.createElement("style");n.textContent=".close-button[data-v-dd3e8006]{float:right;margin-top:0;padding-top:0;font-size:x-large;cursor:pointer}\n/*$vite$:1*/",document.head.appendChild(n),e({a:function(t,e,n,r){return{label:"PDF",color:"primary",action:async(n,r,a,s)=>{let u=e&&await I("PDF may contain private data that will require a password to unlock, To access private data choose Secure PDF over Regular PDF",{header:"Security warning",confirmBtnLabel:"Secure PDF",cancelBtnLabel:"Regular PDF"});!function(t){const{filename:e,canHorizontalPageBreak:n,columns:r,rows:a,filters:s,safeMode:u}=t,c=[Z(r,u)],d=tt(r,i(a,(null==s?void 0:s.sort)||[]),u),p=u?function(){const t=V().getUser().username;return{encryption:{userPassword:t,ownerPassword:t,userPermissions:["print"]}}}():{},f=new o({...p}),h=f.splitTextToSize(M(e),180),m=h.length<=1?20:10*h.length;f.text(h,14,10);const g={startY:m,head:c,body:d};n&&(g.tableWidth="wrap",g.horizontalPageBreak=!0,g.horizontalPageBreakRepeat=0);l(f,g);const b=`${e}.pdf`;f.save(b)}({rows:r,filters:a,columns:s,filename:t,safeMode:u})}}},e:nt,g:function(t,e,n){return{label:"CSV",color:"primary",action:async(r,a,s,i)=>{nt({rows:a,filters:s,columns:i,quarter:e,period:n,filename:t})}}}});e("l",{show:async t=>(await r.create({message:t||"Loading...",spinner:"crescent",translucent:!0})).present(),async hide(){r.getTop().then((t=>t?r.dismiss():null))}});const Y=s(""),z=s(""),L=s(""),E=a((()=>`${Y.value||"-"} / ${z.value||"-"}`));function H(){Y.value=`v${S.version}`,L.value=S.version}async function N(){const t=await F.get("version");let e=await t.json();z.value=e["System version"]||"-"}function W(){const[t,e,n]=L.value.split("."),[r,a,s]=z.value.split(".");return!((parseInt(r)||0)<(parseInt(t)||0))&&(!((parseInt(a)||0)<(parseInt(e)||0))&&!((parseInt(s)||0)<(parseInt(n)||0)))}const{appVersion:G,apiVersion:J}={appVersion:Y,apiVersion:z,minApiVersion:L,fullVersion:E,loadAppVersions:H,loadApiVersion:N,isValidApiVersion:W},{facilityUUID:K}=O();function X(t,e){return e||!1!==t.exportable}function Z(t,e=!1){return t.filter((t=>X(t,e))).map((t=>t.label))}function tt(t,e,n=!1){return e.map((e=>t.filter((t=>X(t,n))).map((t=>{let n=C.get(e,t.path,"");return"function"==typeof t.formatter&&n&&(n=t.formatter(n,e)),M(`${t.drillable&&Array.isArray(n)?n.length:n}`)}))))}function et(t){const{columns:e,rows:n,quarter:r,period:a,filters:s,safeMode:o}=t,l=Z(e,o),c=tt(e,i(n,(null==s?void 0:s.sort)||[]),o);let d=l.join(",")+"\n";return d+=c.map((t=>t.join(","))).join("\n"),d+=`\nDate Created:  ${u().format("DD/MMM/YYYY HH:MM:ss")}`,r&&(d+=`\nQuarter: ${r}`),a&&(d+=`\nQuarter: ${a}`),d+=`\ne-Mastercard Version : ${G.value}`,d+=`\nAPI Version ${J.value}`,d+=`\nSite UUID: ${K}`,d}function nt(t){const e=new Blob([et(t)],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.setAttribute("download",`${t.filename}.csv`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}e("D",x(c({__name:"DrilldownTable",props:{title:{type:String,default:"Drill down table"},rows:{type:Array,required:!0},columns:{type:Array,required:!1},actionButtons:{type:Array},rowActionButtons:{type:Array},config:{type:Object,default:()=>({showSubmitButton:!1})}},setup:t=>(e,n)=>(p(),d(m(Q),null,{default:f((()=>[h(m(g),null,{default:f((()=>[h(m(b),null,{default:f((()=>[h(m(y),{slot:"end"},{default:f((()=>[h(m(v),{slot:"end",onClick:n[0]||(n[0]=t=>m(q).hide()),"icon-only":""},{default:f((()=>[h(m(w),{icon:m(D)},null,8,["icon"])])),_:1})])),_:1}),h(m(P),null,{default:f((()=>[$(j(t.title),1)])),_:1})])),_:1})])),_:1}),h(m(B),null,{default:f((()=>[h(m(_),{rows:t.rows,columns:t.columns,config:t.config,"row-actions-buttons":t.rowActionButtons,"actions-buttons":t.actionButtons,color:"light"},null,8,["rows","columns","config","row-actions-buttons","actions-buttons"])])),_:1})])),_:1}))}),[["__scopeId","data-v-dd3e8006"]])),e("L",23);e("R",class{constructor(){t(this,"date",void 0),t(this,"startDate",void 0),t(this,"endDate",void 0),t(this,"programId",void 0),t(this,"useDefaultParams",void 0),this.programId=1,this.date=R(),this.endDate="",this.startDate="",this.useDefaultParams=!0}setDate(t){this.date=T(t)}setStartDate(t){this.startDate=T(t)}setEndDate(t){this.endDate=T(t)}getDateIntervalPeriod(){return this.startDate&&this.endDate?`${U(this.startDate)} - ${U(this.endDate)}`:"-"}buildParams(t){let e={};return this.useDefaultParams&&(e.date=this.date,e.program_id=this.programId),this.startDate&&(e.start_date=this.startDate),this.endDate&&(e.end_date=this.endDate),t&&(e={...e,...t}),e}async getReport(t,e){return(await F.get(k(t,this.buildParams(e)))).json()}static getReportQuarters(t=5){const e=[];let n=new Date,r=n.getFullYear();n=new Date(`${r}-${n.getMonth()+1}-${n.getDate()} 00:00`);let a=this.getQtrByDate(n).qtr,s=0;for(4===a&&e.push(this.buildQtrObj("Q1",r+1));s<t;)0===s&&a<4&&e.push(this.buildQtrObj(`Q${a+1}`,r)),e.push(this.buildQtrObj(`Q${a}`,r)),a=a>0?a-=1:a,r=0==a?r-1:r,a=0==a?a+=4:a,s++;return e}static getQtrByDate(t){const e=this.getQuarterBounds(t.getFullYear());for(const n in e){const{start:r,end:a}=e[n];if(t>=new Date(r)&&t<=new Date(a))return e[n]}return null}static buildQtrObj(t,e){const n=this.getQuarterBounds(e),{start:r,end:a}=n[t];return{start:r,end:a,name:`${t} ${e}`}}static getQuarterBounds(t){const e=e=>`${t}-${e}-01 00:00`,n=e=>`${t}-${e}-${(e=>u(`${t}-${e}-01`).daysInMonth())(e)} 00:00`;return{Q1:{qtr:1,start:e("01"),end:n("03")},Q2:{qtr:2,start:e("04"),end:n("06")},Q3:{qtr:3,start:e("07"),end:n("09")},Q4:{qtr:4,start:e("10"),end:n("12")}}}async getMaternalStatus(t,e="pepfar"){var n;if(C.isEmpty(t))return{FP:[],FBf:[]};const r=k("vl_maternal_status",this.buildParams({report_definition:e}));return null!==(n=(await A.postJson(r,{patient_ids:t})).data)&&void 0!==n?n:{FP:[],FBf:[]}}async buildMaternityAgreggateRows(t,e="pepfar"){const n=C.uniq(Object.values(t).flat(1).map((t=>t instanceof Object?t.patient_id:t))),r=Object.keys(t),a=await this.getMaternalStatus(n,e),s=a.FBf.concat(a.FP);return["FP","FNP","FBf"].map((e=>r.reduce(((n,r)=>({[r]:t[r].filter((t=>{const n=t instanceof Object?t.patient_id:t;return"FNP"===e?!s.includes(n):a[e].includes(n)})),...n})),{ageGroup:"All",gender:e})))}})}}}))}();

!function(){function e(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,a||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}System.register(["./vendor-legacy-PwJwfeg2.js","./index-legacy-CAqY44sk.js","./app_encounter_service-legacy-LJRPnsbp.js","./relations_service-legacy-CPBw0Zvw.js","./patient_registration_service-legacy-DmWS8kKb.js","./identifier_service-legacy-JXcUb0cc.js","./lodash-legacy-C-x9g9Na.js"],(function(a,t){"use strict";var r,l,i,n,o,s,d,u,c,v,p,m,b,f,g,h,_,x,y,w,N,k,P,A,V,S,q,I,C,G,D,R,U,j,z,$,F,O,T,Y,E,L,M,B,H,J,W,Q,Z,K,X,ee,ae,te,re,le,ie,ne,oe,se,de,ue,ce;return{setters:[e=>{r=e.d,l=e.aT,i=e.r,n=e.c,o=e.a,s=e.w,d=e.E,u=e.y,c=e.f,v=e.u,p=e.b4,m=e.z,b=e.l,f=e.U,g=e.T,h=e.A,_=e.W,x=e.S,y=e.k,w=e.e,N=e.m,k=e.G,P=e.b6,A=e.I,V=e.cP,S=e.be,q=e.as,I=e.F,C=e.L,G=e.B,D=e.bm,R=e.p,U=e.D,j=e.bh,z=e.aM,$=e.aL,F=e.bp,O=e.ad,T=e.d7,Y=e.aN,E=e.d5,L=e.aE,M=e.aF,B=e.i,H=e.bf,J=e.aQ},e=>{W=e.a3,Q=e.u,Z=e.b,K=e.A,X=e.L,ee=e.e,ae=e.cm,te=e.P,re=e.t,le=e.k,ie=e._,ne=e.s,oe=e.m},e=>{se=e.A},e=>{de=e.R},e=>{ue=e.P},e=>{ce=e.I},null],execute:function(){var t=document.createElement("style");t.textContent='.guardian-modal[data-v-ce6b14cf]{--height: 800px;--max-height: 90vh;--border-radius: 8px;--width: 95%;--max-width: 800px}.modal-content[data-v-ce6b14cf]{height:100%;overflow-y:auto}.search-loading[data-v-ce6b14cf]{padding:16px;text-align:center;color:#666}.search-results[data-v-ce6b14cf]{max-height:1000px;border:1px solid #e0e0e0;border-radius:8px;margin-top:8px;transition:all .3s ease}.no-results[data-v-ce6b14cf]{padding:16px;text-align:center;color:#666}.pagination-button[data-v-ce6b14cf]{background:#f8f9fa;border:1px solid #ddd;border-radius:4px;padding:8px 16px;cursor:pointer;margin:0 8px}.pagination-button[data-v-ce6b14cf]:disabled{opacity:.5;cursor:not-allowed}.page-info[data-v-ce6b14cf]{font-size:.9rem;color:#555}.form-row[data-v-ce6b14cf]{display:flex;flex-wrap:wrap;margin-bottom:15px;gap:20px}.form-group label[data-v-ce6b14cf]{display:block;margin-bottom:5px;font-weight:500;color:#333}.required[data-v-ce6b14cf]{color:red}ion-modal[data-v-ce6b14cf]{--width: 100%;--max-width: 800px;--height: 85%;--max-height: 1000px;--border-radius: 4px}.modal-content[data-v-ce6b14cf]{--padding-top: 16px;--padding-bottom: 16px}.modal-title[data-v-ce6b14cf]{font-size:1.3rem;font-weight:500;padding-left:15px}.close-button[data-v-ce6b14cf]{--color: var(--ion-color-primary)}.modal-content[data-v-ce6b14cf]{padding:16px}.section-header ion-label[data-v-ce6b14cf]{font-size:1rem;font-weight:600;letter-spacing:.5px;color:var(--ion-color-primary);text-transform:uppercase}.save-button[data-v-ce6b14cf]{--padding-top: 16px;--padding-bottom: 16px;font-weight:500;width:20%;margin-top:100px}ion-input[data-v-ce6b14cf]::part(label),ion-select[data-v-ce6b14cf]::part(label){font-weight:600}.form-container[data-v-ce6b14cf]{background:#fff;border-radius:4px;padding:2px;height:100%}.form-grid[data-v-ce6b14cf]{padding:0}.form-row[data-v-ce6b14cf]{margin-bottom:10px}.form-column[data-v-ce6b14cf]{padding:0 5px}.save-button[data-v-ce6b14cf]{--border-radius: 3px;--padding-top: 12px;--padding-bottom: 12px;--background: #d4edda;margin-top:20px;margin-left:auto;font-weight:500;width:fit-content;display:block;color:#006400;height:40px}.search-section[data-v-ce6b14cf]{margin-bottom:40px;transition:all .3s ease}.search-item ion-button[data-v-ce6b14cf]{--padding-start: 8px;--padding-end: 8px;margin:0}.search-item ion-button ion-icon[data-v-ce6b14cf]{font-size:25px;margin:0 2px}.no-results[data-v-ce6b14cf]{display:flex;justify-content:center;align-items:center;padding:10px;margin:0;color:#666}.no-results ion-button[data-v-ce6b14cf]{--padding-start: 0;--padding-end: 0;margin:0}.result-item[data-v-ce6b14cf]{padding:12px;border-bottom:1px solid #eee;cursor:pointer;transition:background-color .2s}.result-item[data-v-ce6b14cf]:last-child{border-bottom:none}.create-form-section[data-v-ce6b14cf]{margin-top:20px;animation:fadeIn-ce6b14cf .3s ease}@keyframes fadeIn-ce6b14cf{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.form-row[data-v-ce6b14cf]{margin-bottom:15px}ion-segment-button[data-v-ce6b14cf]{--color: #495057;--color-checked: #fff;--background-checked: #d4edda;--background: #f3f0f0;--indicator-color: transparent;--border-radius: 4px;--padding-top: 6px;--padding-bottom: 8px;--padding-right: 100px;--margin-start: 10px;--margin-end: 10px;min-width:50px;font-size:.7rem;font-weight:600;margin:0 2px}.required[data-v-ce6b14cf]{color:#dc3545}@media (max-width: 768px){.pagination[data-v-ce6b14cf]{display:flex;justify-content:center;align-items:center;gap:16px;margin-top:16px;padding:12px}.pagination-button[data-v-ce6b14cf]{background:#f8f9fa;border:1px solid #ddd;border-radius:4px;padding:8px 16px;cursor:pointer;transition:all .2s}.pagination-button[data-v-ce6b14cf]:hover:not(:disabled){background:#e9ecef}.pagination-button[data-v-ce6b14cf]:disabled{opacity:.5;cursor:not-allowed}.page-info[data-v-ce6b14cf]{font-size:.9rem;color:#555}}.error-label[data-v-ce6b14cf]{color:#b42318;text-transform:none;padding:1% 3%;margin-top:2px;display:flex;text-align:center}.new-tag[data-v-ce6b14cf]{color:#666;font-style:italic;font-size:.8em}.result-item[data-v-ce6b14cf]{padding:12px;border-bottom:1px solid #eee;cursor:pointer;transition:background-color .2s;display:flex;justify-content:space-between}.result-item[data-v-ce6b14cf]:hover{background-color:#f5f5f5}.pagination[data-v-ce6b14cf]{display:flex;justify-content:center;align-items:center;padding:12px;border-top:1px solid #eee}.result-item-content[data-v-ce6b14cf]{display:grid;grid-template-columns:.5fr 1.5fr;gap:16px;width:100%}.guardian-name[data-v-ce6b14cf]{font-weight:500;text-align:left;height:30px;background:#efefef}.guardian-address[data-v-ce6b14cf]{text-align:left;font-size:.9em;color:#666;word-break:break-word}@media (max-width: 768px){.result-item-content[data-v-ce6b14cf]{grid-template-columns:1fr;gap:4px}}.radio-group[data-v-ce6b14cf]{display:flex;width:100%}.inline-radio-group[data-v-ce6b14cf]{display:flex;gap:30px}.inline-radio-item[data-v-ce6b14cf]{--inner-padding-end: 0;--padding-start: 0;margin:0}.relationship-selector[data-v-ce6b14cf]{padding:10px;background:#f8f9fa;border-top:1px solid #eee;width:45%}.relationship-dropdown[data-v-ce6b14cf]{margin-bottom:10px}.relationship-actions[data-v-ce6b14cf]{display:flex;gap:10px;margin-left:auto}.confirm-btn[data-v-ce6b14cf]{--background: var(--ion-color-primary)}.cancel-btn[data-v-ce6b14cf]{--color: var(--ion-color-primary)}.relationship-badge[data-v-ce6b14cf]{font-size:.8em;color:#666;margin-left:8px;font-style:italic}.relationship-dropdown.error-state .multiselect__tags[data-v-ce6b14cf]{border-color:#eb445a!important}.error-label[data-v-ce6b14cf]{color:#eb445a;font-size:12px;margin-left:5px}.error-state[data-v-ce6b14cf]{border:1px solid #eb445a!important;border-radius:4px}.spacer[data-v-ce6b14cf]{flex-grow:1}ion-item[data-v-2b388e8e]{--padding-start: 0;--inner-padding-end: 0}ion-radio[data-v-2b388e8e]{margin-right:8px}.reception-form[data-v-2b388e8e]{margin-bottom:7px}.form-section[data-v-2b388e8e]{margin-bottom:20px}.form-row[data-v-2b388e8e]{display:flex;flex-wrap:wrap;margin-bottom:15px;gap:20px}.form-group[data-v-2b388e8e]{flex:1;min-width:200px}.form-group label[data-v-2b388e8e]{display:block;margin-bottom:5px;font-weight:500;color:#333}.required[data-v-2b388e8e]{color:red}.form-control[data-v-2b388e8e]{width:100%;padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px}.input-group[data-v-2b388e8e]{display:flex;align-items:center}.input-group .form-control[data-v-2b388e8e]{border-top-right-radius:0;border-bottom-right-radius:0;flex:1}.input-group-text[data-v-2b388e8e]{padding:8px 12px;background-color:#f5f5f5;border:1px solid #ddd;border-left:none;border-top-right-radius:4px;border-bottom-right-radius:4px;color:#555}.form-footer[data-v-2b388e8e]{display:flex;justify-content:flex-start;margin-top:20px}ion-modal[data-v-2b388e8e]{--width: 90%;--max-width: 700px;--height: 50%;--border-radius: 4px}.section-header ion-label[data-v-2b388e8e]{font-size:1rem;font-weight:600;letter-spacing:.5px;color:var(--ion-color-primary);text-transform:uppercase}ion-input[data-v-2b388e8e]::part(label),ion-select[data-v-2b388e8e]::part(label){font-weight:600}.form-row[data-v-2b388e8e]{margin-bottom:10px}.no-results p[data-v-2b388e8e]{margin:0;color:#666}.no-results ion-button[data-v-2b388e8e]{--padding-start: 0;--padding-end: 0;margin:0}@keyframes fadeIn-2b388e8e{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.label-title[data-v-2b388e8e]{font-weight:700;font-size:1rem;color:#555}.form-row[data-v-2b388e8e]{margin-bottom:15px}.segment-group[data-v-2b388e8e]{display:flex;align-items:center;background-color:#f8f9fa;padding:12px 16px;border-radius:4px;gap:15px;position:relative}.segment-group[data-v-2b388e8e]:after{content:"";flex:0 0 30%;min-width:300px;visibility:hidden}.segment-label-container[data-v-2b388e8e]{min-width:300px;font-weight:800;flex:0 40% 0}.label-title[data-v-2b388e8e]{margin:0;color:gray;font-size:17px;font-weight:600}.required[data-v-2b388e8e]{color:#dc3545}@media (max-width: 576px){.segment-group[data-v-2b388e8e]{flex-direction:column;align-items:flex-start;gap:8px}.custom-segment[data-v-2b388e8e]{width:50%;height:20%;padding:0 4px}}.segment-group[data-v-2b388e8e]{display:flex;align-items:center;width:100%}.segment-label-container[data-v-2b388e8e]{width:40%;min-width:200px}.arv-input-container[data-v-2b388e8e]{width:100%}.arv-input-container .input-group[data-v-2b388e8e]{width:100%;height:45px}.arv-input-container .form-control[data-v-2b388e8e]{height:100%;border-radius:2px 0 0 2px}.arv-input-container .input-group-text[data-v-2b388e8e]{height:100%;border-radius:0 4px 4px 0;padding:0 16px}@media (max-width: 768px){.segment-group[data-v-2b388e8e]{flex-direction:column;align-items:flex-start}.segment-group[data-v-2b388e8e]:after{display:none}.segment-label-container[data-v-2b388e8e]{width:100%;margin-bottom:8px}.arv-input-container[data-v-2b388e8e]{margin-left:0;width:100%}}.error-label[data-v-2b388e8e]{color:#f10;font-size:.875rem;margin-top:4px;display:block;font-style:italic;font-weight:700!important}.arv-input-container[data-v-2b388e8e]{display:flex;align-items:center;gap:8px;width:100%}.arv-input-container .input-group-text[data-v-2b388e8e]{padding:0 12px;background-color:#f5f5f5;border:1px solid #ddd;border-radius:4px;color:#555;height:45px;display:flex;align-items:center}.has-error[data-v-2b388e8e]{border:1px solid #b42318!important;box-shadow:0 0 0 1px #b42318!important}.input-group-error[data-v-2b388e8e]{border-radius:4px;box-shadow:0 0 0 1px #b42318}.input-group-text.has-error[data-v-2b388e8e]{border-left:1px solid #b42318!important;border-color:#b42318!important}.error-label[data-v-2b388e8e]{color:#b42318;font-size:.875rem;margin-top:4px;display:block;font-weight:300!important}.input-group[data-v-2b388e8e]{border-radius:4px;overflow:hidden}.input-group .form-control[data-v-2b388e8e]{border:1px solid #ddd;border-right:none}.input-group .input-group-text[data-v-2b388e8e]{border:1px solid #ddd;border-left:none}\n/*$vite$:1*/',document.head.appendChild(t);class ve extends se{constructor(a,t,r){super(a,51,t,r),e(this,"sitePrefix",void 0),this.sitePrefix=""}getSitePrefix(){return this.sitePrefix}createArvNumber(e){return W.postJson("/patient_identifiers/",{patient_id:this.patientID,identifier_type:4,identifier:e})}buildArvNumber(e){return`${this.sitePrefix}-ARV-${e}`}}const pe={class:"form-container"},me={class:"search-section"},be={key:0,class:"search-results"},fe={key:0,class:"search-loading"},ge={key:1},he=["onClick"],_e={class:"guardian-name"},xe={key:0,class:"relationship-badge"},ye={key:0,class:"guardian-address"},we={key:0,class:"relationship-selector"},Ne={class:"relationship-actions"},ke={class:"pagination"},Pe=["disabled"],Ae={class:"page-info"},Ve=["disabled"],Se={key:2,class:"no-results"},qe={key:0,class:"create-form-section"},Ie={key:0},Ce={key:1},Ge={key:2},De={key:0},Re={key:1},Ue={key:2},je={class:"form-row"},ze={class:"form-group radio-group"},$e={class:"radio-label-container"},Fe=r({__name:"ManageGuardian",props:{isOpen:{type:Boolean,required:!0}},emits:["close","whenSaved","guardianSelected"],setup(e,{emit:a}){const t=Q(),{patient:r}=l(t),T=Z(),{apiStatus:Y}=l(T),E=a,L=i(""),M=i([]),B=i(!1),H=i(!1),J=i(1),W=i([]),ie=i([]),ne=i([]),oe=i(null),se=i(null),ce=i({firstName:"",lastName:"",gender:"",phone:"",address:{},relationship:""}),ve=i(null),Fe=i(null),Oe=i(null),Te=i([]),Ye=i([]),Ee=i([]),Le=i(!1),Me=i(!1),Be=i(!1),He=i(!1),Je=i([]),We=i(null),Qe=i(!1),Ze=i(!1),Ke=i(!1),Xe=i(!1),ea=i(!1),aa=i(""),ta=i(""),ra=n((()=>Math.ceil(W.value.length/10))),la=n((()=>{const e=10*(J.value-1),a=e+10;return W.value.slice(e,a)}));n((()=>""!==ce.value.firstName.trim()&&""!==ce.value.lastName.trim()&&ce.value.relationship)),o((async()=>{await pa(),await wa()}));const ia=()=>{Na(),E("close")},na=()=>{clearTimeout(oa),oa=setTimeout((()=>{H.value=!1,sa()}),300)};let oa;const sa=async()=>{if(!L.value.trim())return W.value=[],void(J.value=1);B.value=!0;try{const e=await te.getJson(`people/${r.value.patientID}/relationships`);ie.value=e.map((e=>{var a,t,l,i,n,o;if((null===(a=e.relation)||void 0===a||null===(a=a.person_id)||void 0===a?void 0:a.toString())===r.value.patientID)return null;const s=(null===(t=e.relation)||void 0===t||null===(t=t.names)||void 0===t?void 0:t[0])||{},d=(null===(l=e.relation)||void 0===l||null===(l=l.addresses)||void 0===l?void 0:l[0])||{};return{id:null===(i=e.relation)||void 0===i||null===(i=i.person_id)||void 0===i?void 0:i.toString(),firstName:s.given_name||"Unknown",lastName:s.family_name||"",phone:(null===(n=e.relation)||void 0===n||null===(n=n.person_attributes)||void 0===n||null===(n=n.find((e=>e.value)))||void 0===n?void 0:n.value)||"",relationship:(null===(o=e.type)||void 0===o?void 0:o.b_is_to_a)||"Other",address:{city_village:d.city_village||"",township_division:d.township_division||"",state_province:d.state_province||""},source:"existing"}})).filter(Boolean);const a=L.value.split(" "),t={given_name:a[0],family_name:a.length>=2?a[1]:"",page:"1",per_page:"20",exclude_patient_id:r.value.patientID},l=await te.search(t);ne.value=l.filter((e=>e.person.person_id.toString()!==r.value.patientID)).map((e=>{var a;const t=e.person.names[0],r=e.person.addresses[0]||{};return{id:e.person.person_id.toString(),firstName:t.given_name,lastName:t.family_name,phone:(null===(a=e.person.attributes)||void 0===a||null===(a=a.find((e=>"Cell Phone Number"===e.attribute_type)))||void 0===a?void 0:a.value)||"",relationship:"",address:{city_village:r.city_village||"",township_division:r.township_division||"",state_province:r.state_province||""},source:"search"}})),W.value=[...ie.value,...ne.value.filter((e=>!ie.value.some((a=>a.id===e.id))))].sort(((e,a)=>{const t=`${e.firstName} ${e.lastName}`.toUpperCase(),r=`${a.firstName} ${a.lastName}`.toUpperCase();return t.localeCompare(r)})),J.value=1}catch(e){re("Failed to search guardians")}finally{B.value=!1}},da=async e=>{try{const a=Je.value.find((a=>{var t;return a.value===(e.relationship||(null===(t=oe.value)||void 0===t?void 0:t.value))}));a&&(await de.createRelation(r.value.patientID,e.id,a.other.relationship_type_id),E("guardianSelected",{...e,relationship:a.value,address:e.address||{city_village:"",township_division:"",state_province:""}}),ia(),le("Guardian relationship created successfully"))}catch(a){re("Failed to create guardian relationship")}finally{va()}},ua=()=>{ea.value=!oe.value,oe.value?da(se.value):re("Please select a relationship")},ca=()=>{va()},va=()=>{se.value=null,oe.value=null,ea.value=!1},pa=async()=>{try{const e=await K("districts"),a=Array.isArray(e)?e:(null==e?void 0:e.records)||[];if(Te.value=a.map((e=>({name:e.name,district_id:e.district_id||e.id}))),0===Te.value.length&&Y.value){const e=await X.getAllDistricts();Te.value=e.map((e=>({name:e.name,district_id:e.district_id||e.id})))}}catch(e){console.error("District loading error:",e),Te.value=[]}},ma=e=>{const a=e.trim();return""===a?{valid:!1,reason:"required"}:/^[A-Za-z']+$/.test(a)?a.length<3?{valid:!1,reason:"too_short"}:{valid:!0,reason:""}:{valid:!1,reason:"invalid_chars"}},ba=e=>{ce.value.lastName=e.target.value;const a=ma(ce.value.lastName);return ta.value=a.reason,Ke.value=!a.valid,{valid:!0,reason:""}},fa=e=>{var a;ce.value.phone=e.target.value,Xe.value=(a=ce.value.phone,!/^(88|99|98|89)\d{7}$/.test(a.trim()))},ga=e=>{ve.value=e,Le.value=!e,e&&(async e=>{try{const a=await K("TAs",{whereClause:{district_id:e.district_id}}),t=Array.isArray(a)?a:(null==a?void 0:a.records)||[];if(Ye.value=t.map((e=>({name:e.name,traditional_authority_id:e.traditional_authority_id||e.id}))),0===Ye.value.length&&Y.value){const a=await X.getTraditionalAuthorities(e.district_id);Ye.value=a.map((e=>({name:e.name,traditional_authority_id:e.traditional_authority_id||e.id})))}}catch(a){console.error("TA loading error:",a),Ye.value=[]}})(e)},ha=e=>{Fe.value=e,Me.value=!e,e&&(async e=>{try{const a=await K("villages",{whereClause:{traditional_authority_id:e.traditional_authority_id}}),t=Array.isArray(a)?a:(null==a?void 0:a.records)||[];if(Ee.value=t.map((e=>({name:e.name,village_id:e.village_id||e.id}))),0===Ee.value.length&&Y.value){const a=await X.getVillages(e.traditional_authority_id);Ee.value=a.map((e=>({name:e.name,village_id:e.village_id||e.id})))}}catch(a){console.error("Village loading error:",a),Ee.value=[]}})(e)},_a=e=>{Oe.value=e,Be.value=!e},xa=e=>{We.value=e,ce.value.relationship=(null==e?void 0:e.value)||"",Qe.value=!ce.value.relationship},ya=async()=>{if((()=>{const e=ma(ce.value.firstName);Ze.value=!e.valid,aa.value=e.reason;const a=ma(ce.value.lastName);return Ke.value=!a.valid,ta.value=a.reason,He.value=!ce.value.gender,Le.value=!ve.value,Me.value=!Fe.value,Be.value=!Oe.value,Qe.value=!ce.value.relationship,!(Ze.value||Ke.value||He.value||Le.value||Me.value||Be.value||Qe.value)})())try{var e,a,t;const i=(null===(e=Oe.value)||void 0===e?void 0:e.name)||"",n=(null===(a=Fe.value)||void 0===a?void 0:a.name)||"",o=(null===(t=ve.value)||void 0===t?void 0:t.name)||"",s={given_name:ce.value.firstName,family_name:ce.value.lastName,gender:ce.value.gender,birthdate:"",birthdate_estimated:!0,attributes:{cell_phone_number:ce.value.phone}},d=new ue,u=await d.registerGuardian(s);if(!u||!u.person_id)throw new Error("Failed to create guardian - no person ID returned");const c=u.person_id;console.log("Guardian created with ID:",c);const v={person_id:c,address1:i,address2:n,city_village:i,township_division:n,state_province:o,country:"Malawi",preferred:1,latitude:"",longitude:""};let p;try{p=await X.createAddress(v),p||(p=await X.postJson("person/"+c+"/address",v))}catch(l){}const m=Je.value.find((e=>e.value===ce.value.relationship));m&&await de.createRelation(r.value.patientID,c,m.other.relationship_type_id);const b={id:c.toString(),firstName:ce.value.firstName,lastName:ce.value.lastName,phone:ce.value.phone,relationship:ce.value.relationship,address:{city_village:i,township_division:n,state_province:o,country:"Malawi"}};E("whenSaved",b),ia(),le("Guardian created successfully")}catch(i){re("Failed to complete guardian creation: ")}else re("Please fill all required fields")},wa=async()=>{try{const e=await de.getRelations();Je.value=e.map((e=>({label:e.b_is_to_a,value:e.b_is_to_a,other:e})))}catch(e){console.error("Failed to load relationships",e)}},Na=()=>{ce.value={firstName:"",lastName:"",gender:"",phone:"",address:{},relationship:""},ve.value=null,Fe.value=null,Oe.value=null,We.value=null,L.value="",M.value=[],W.value=[],J.value=1,Ze.value=!1,Ke.value=!1,Xe.value=!1,He.value=!1,Le.value=!1,Me.value=!1,Be.value=!1,Qe.value=!1,ea.value=!1,aa.value="",ta.value="",H.value=!1,se.value=null,oe.value=null};return wa(),s(H,(e=>{e?M.value=[]:L.value&&sa()})),(a,t)=>{const r=d("ion-buttons"),l=d("ion-radio"),i=d("ion-radio-group");return c(),u(v(p),{"is-open":e.isOpen,onDidDismiss:ia,class:"guardian-modal"},{default:m((()=>[b(v(x),null,{default:m((()=>[b(v(f),null,{default:m((()=>[b(v(g),{class:"modal-title"},{default:m((()=>t[12]||(t[12]=[h("Search/Add Guardian")]))),_:1,__:[12]}),b(r,{slot:"end"},{default:m((()=>[b(v(_),{onClick:ia,class:"close-button"},{default:m((()=>t[13]||(t[13]=[h("Close")]))),_:1,__:[13]})])),_:1})])),_:1})])),_:1}),b(v(O),{class:"ion-padding modal-content"},{default:m((()=>[y("div",pe,[y("div",me,[b(v(k),{class:"search-item",lines:"full"},{default:m((()=>[b(v(P),{modelValue:L.value,"onUpdate:modelValue":t[0]||(t[0]=e=>L.value=e),placeholder:"Search Guardian",onIonInput:na,class:"search-input"},{default:m((()=>[b(v(A),{icon:v(V),slot:"start"},null,8,["icon"])])),_:1},8,["modelValue"]),b(v(_),{slot:"end",fill:"clear",onClick:t[1]||(t[1]=e=>H.value=!0),title:"Create new guardian"},{default:m((()=>[b(v(A),{icon:v(S)},null,8,["icon"]),b(v(A),{icon:v(q)},null,8,["icon"])])),_:1})])),_:1}),L.value&&!H.value?(c(),w("div",be,[B.value?(c(),w("div",fe," Searching... ")):W.value.length>0?(c(),w("div",ge,[(c(!0),w(I,null,C(la.value,(e=>{var a;return c(),w("div",{key:e.id,class:"result-item"},[y("div",{class:"result-item-content",onClick:a=>(e=>{e.relationship?da(e):(se.value=e,oe.value=null)})(e)},[y("div",_e,[h(G(e.firstName)+" "+G(e.lastName)+" ",1),e.relationship?(c(),w("span",xe,"("+G(e.relationship)+")",1)):N("",!0)]),e.address?(c(),w("div",ye,G("object"==typeof e.address?`${e.address.city_village}${e.address.township_division?", "+e.address.township_division:""}${e.address.state_province?", "+e.address.state_province:""}`:"Address available"),1)):N("",!0)],8,he),(null===(a=se.value)||void 0===a?void 0:a.id)===e.id?(c(),w("div",we,[b(v(D),{modelValue:oe.value,"onUpdate:modelValue":t[2]||(t[2]=e=>oe.value=e),options:Je.value,label:"label","track-by":"value",placeholder:"Select relationship*",searchable:!0,class:R({"error-state":ea.value}),onInput:t[3]||(t[3]=e=>ea.value=!1)},null,8,["modelValue","options","class"]),ea.value?(c(),u(v(U),{key:0,class:"error-label",style:{display:"block","margin-top":"5px"}},{default:m((()=>t[14]||(t[14]=[h(" Relationship is required ")]))),_:1,__:[14]})):N("",!0),y("div",Ne,[b(v(_),{onClick:ua,size:"small",class:"confirm-btn"},{default:m((()=>t[15]||(t[15]=[h(" Confirm ")]))),_:1,__:[15]}),t[17]||(t[17]=y("div",{class:"spacer"},null,-1)),b(v(_),{onClick:ca,fill:"outline",size:"small",class:"cancel-btn"},{default:m((()=>t[16]||(t[16]=[h(" Cancel ")]))),_:1,__:[16]})])])):N("",!0)])})),128)),y("div",ke,[y("button",{onClick:t[4]||(t[4]=e=>J.value=Math.max(1,J.value-1)),disabled:1===J.value,class:"pagination-button"}," < ",8,Pe),y("span",Ae,"Page "+G(J.value)+" of "+G(ra.value),1),y("button",{onClick:t[5]||(t[5]=e=>J.value=Math.min(ra.value,J.value+1)),disabled:J.value===ra.value,class:"pagination-button"}," > ",8,Ve)])])):(c(),w("div",Se,[y("p",null,'No guardians found matching "'+G(L.value)+'"',1)]))])):N("",!0)]),H.value?(c(),w("div",qe,[b(v(j),{class:"form-grid"},{default:m((()=>[b(v(z),{class:"form-row"},{default:m((()=>[b(v($),{class:"form-column"},{default:m((()=>[b(ee,{inputHeader:"First name*",inputValue:ce.value.firstName,"onUpdate:inputValue":t[6]||(t[6]=e=>(e=>{ce.value.firstName=e.target.value;const a=ma(ce.value.firstName);return aa.value=a.reason,Ze.value=!a.valid,{valid:!0,reason:""}})(e)),inputType:"text",error:Ze.value},null,8,["inputValue","error"]),Ze.value?(c(),u(v(U),{key:0,class:"error-label"},{default:m((()=>["required"===aa.value?(c(),w("span",Ie,"First name is required")):"invalid_chars"===aa.value?(c(),w("span",Ce,"First name can only contain letters and apostrophes")):"too_short"===aa.value?(c(),w("span",Ge,"First name must be at least 3 characters")):N("",!0)])),_:1})):N("",!0)])),_:1}),b(v($),{class:"form-column"},{default:m((()=>[b(ee,{inputHeader:"Last name*",inputValue:ce.value.lastName,"onUpdate:inputValue":ba,inputType:"text",required:!0,error:Ke.value},null,8,["inputValue","error"]),Ke.value?(c(),u(v(U),{key:0,class:"error-label"},{default:m((()=>["required"===ta.value?(c(),w("span",De,"First name is required")):"invalid_chars"===ta.value?(c(),w("span",Re,"First name can only contain letters and apostrophes")):"too_short"===ta.value?(c(),w("span",Ue,"First name must be at least 3 characters")):N("",!0)])),_:1})):N("",!0)])),_:1})])),_:1}),y("div",je,[b(v($),{class:"form-column"},{default:m((()=>[y("div",ze,[y("div",$e,[t[21]||(t[21]=y("label",{class:"label-title"},[h("Gender "),y("span",{class:"required"},"*")],-1)),b(i,{value:ce.value.gender,onIonChange:t[7]||(t[7]=e=>{return a=e.detail.value,ce.value.gender=a,void(He.value=!a);var a}),class:"inline-radio-group"},{default:m((()=>[b(v(k),{lines:"none",class:"inline-radio-item",style:{"--background":"white"}},{default:m((()=>[b(l,{slot:"start",value:"M",style:{"margin-right":"16px"}}),b(v(U),null,{default:m((()=>t[18]||(t[18]=[h("Male")]))),_:1,__:[18]})])),_:1}),b(v(k),{lines:"none",class:"inline-radio-item",style:{"--background":"white"}},{default:m((()=>[b(l,{slot:"start",value:"F",style:{"margin-right":"16px"},class:"custom-radio"}),b(v(U),null,{default:m((()=>t[19]||(t[19]=[h("Female")]))),_:1,__:[19]})])),_:1})])),_:1},8,["value"]),He.value?(c(),u(v(U),{key:0,class:"error-label"},{default:m((()=>t[20]||(t[20]=[h(" Gender is required ")]))),_:1,__:[20]})):N("",!0)])])])),_:1}),b(v($),{class:"form-column"},{default:m((()=>[b(v(U),{position:"stacked",style:{"font-weight":"500"},class:"labl-cls"},{default:m((()=>t[22]||(t[22]=[h("District"),y("span",{class:"required"}," *",-1)]))),_:1,__:[22]}),b(v(D),{modelValue:ve.value,"onUpdate:modelValue":[t[8]||(t[8]=e=>ve.value=e),ga],options:Te.value,label:"name","track-by":"district_id",placeholder:"Select district",searchable:!0,"close-on-select":!0,class:R({"error-state":Le.value})},null,8,["modelValue","options","class"]),Le.value?(c(),u(v(U),{key:0,class:"error-label"},{default:m((()=>t[23]||(t[23]=[h(" District is required ")]))),_:1,__:[23]})):N("",!0)])),_:1})]),b(v(z),{class:"form-row"},{default:m((()=>[b(v($),{class:"form-column"},{default:m((()=>[b(v(U),{position:"stacked",style:{"font-weight":"500"},class:"labl-cls"},{default:m((()=>t[24]||(t[24]=[h("T/A or Area"),y("span",{class:"required"}," *",-1)]))),_:1,__:[24]}),b(v(D),{modelValue:Fe.value,"onUpdate:modelValue":[t[9]||(t[9]=e=>Fe.value=e),ha],options:Ye.value,label:"name","track-by":"traditional_authority_id",placeholder:"Select traditional authority",searchable:!0,"close-on-select":!0,disabled:!ve.value,class:R({"error-state":Me.value})},null,8,["modelValue","options","disabled","class"]),Me.value?(c(),u(v(U),{key:0,class:"error-label"},{default:m((()=>t[25]||(t[25]=[h(" Traditional Authority/Area is required ")]))),_:1,__:[25]})):N("",!0)])),_:1}),b(v($),{class:"form-column"},{default:m((()=>[b(v(U),{position:"stacked",style:{"font-weight":"500"},class:"labl-cls"},{default:m((()=>t[26]||(t[26]=[h("Village or Township"),y("span",{class:"required"}," *",-1)]))),_:1,__:[26]}),b(v(D),{modelValue:Oe.value,"onUpdate:modelValue":[t[10]||(t[10]=e=>Oe.value=e),_a],options:Ee.value,label:"name","track-by":"village_id",placeholder:"Select village",searchable:!0,"close-on-select":!0,disabled:!Fe.value,class:R({"error-state":Be.value}),error:Be.value},null,8,["modelValue","options","disabled","class","error"]),Be.value?(c(),u(v(U),{key:0,class:"error-label"},{default:m((()=>t[27]||(t[27]=[h(" Village/Township is required ")]))),_:1,__:[27]})):N("",!0)])),_:1})])),_:1}),b(v(z),{class:"form-row"},{default:m((()=>[b(v($),{class:"form-column"},{default:m((()=>[b(ae,{inputHeader:"Phone number",inputValue:ce.value.phone,"onUpdate:inputValue":fa,inputType:"tel",required:!0,class:R({"error-state":Xe.value}),error:Xe.value},null,8,["inputValue","class","error"]),Xe.value?(c(),u(v(U),{key:0,class:"error-label"},{default:m((()=>t[28]||(t[28]=[h(" Phone must be 9 digits starting with 88, 99, 98, or 89 ")]))),_:1,__:[28]})):N("",!0)])),_:1}),b(v($),{class:"form-column"},{default:m((()=>[b(v(U),{position:"stacked",style:{"font-weight":"500"},class:"labl-cls"},{default:m((()=>t[29]||(t[29]=[h("Relationship"),y("span",{class:"required"}," *",-1)]))),_:1,__:[29]}),b(v(D),{modelValue:We.value,"onUpdate:modelValue":[t[11]||(t[11]=e=>We.value=e),xa],multiple:!1,taggable:!1,"hide-selected":!0,"close-on-select":!0,openDirection:"bottom",placeholder:"Select relationship",selectLabel:"",label:"label",searchable:!0,"track-by":"value",options:Je.value,disabled:!1,class:R({"error-state":Qe.value}),error:Qe.value},null,8,["modelValue","options","class","error"]),Qe.value?(c(),u(v(U),{key:0,class:"error-label"},{default:m((()=>t[30]||(t[30]=[h(" Relationship is required ")]))),_:1,__:[30]})):N("",!0)])),_:1})])),_:1})])),_:1})])):N("",!0),H.value?(c(),u(v(_),{key:1,expand:"block",onClick:ya,class:"save-button"},{default:m((()=>[b(v(A),{icon:v(F),slot:"start"},null,8,["icon"]),t[31]||(t[31]=h(" Save "))])),_:1,__:[31]})):N("",!0)])])),_:1})])),_:1},8,["is-open"])}}}),Oe=ie(Fe,[["__scopeId","data-v-ce6b14cf"]]),Te={class:"segment-label-container"},Ye={class:"segment-label-container"},Ee={class:"segment-label-container"},Le={class:"form-row"},Me={class:"form-group segment-group"},Be={class:"segment-label-container"},He={class:"arv-input-container"},Je=["disabled"];a("default",ie(r({__name:"Reception",setup(e,{expose:a}){const t=new te,r=new ve(t.getID(),-1,""),n=i({}),s=i(!1),d=ne(),p=Q(),{patient:f}=l(p),g=i({}),_=i({isInit:!1,isLoading:!1,canSubmit:!1,hasGuardian:!1,captureArvNumber:"",sitePrefix:"",guardianPresent:"",patientPresent:"",hasArvNumber:!1,arvNumber:""}),x={guardianPresent:{label:"Guardian present",required:()=>!0,buildObs:()=>r.buildValueCoded("Guardian present",_.value.guardianPresent),validation:()=>{P("guardianPresent")&&("Yes"!==_.value.guardianPresent||_.value.hasGuardian||(n.value.guardianPresent="Please register a new guardian",s.value=!0))},onGuardianSelected:()=>{_.value.hasGuardian=!0,n.value.guardianPresent=""},onFormUpdate:(e,a)=>{"patientPresent"===e&&"No"===a&&"No"===_.value.guardianPresent&&(_.value.guardianPresent="Yes",n.value.guardianPresent=""),"guardianPresent"!==e||"Yes"!==a||_.value.hasGuardian||(s.value=!0)}},patientPresent:{label:"Patient present",required:()=>!0,buildObs:()=>r.buildValueCoded("Patient present",_.value.patientPresent),onFormUpdate:(e,a)=>{"guardianPresent"===e&&"No"===a&&"No"===_.value.patientPresent&&(_.value.patientPresent="Yes",n.value.patientPresent="")},validation:()=>P("patientPresent")},hasGuardian:{init:async()=>t.getGuardian().then((e=>{_.value.hasGuardian=e.length>0}))},hasArvNumber:{init:async()=>{var e;_.value.hasArvNumber=!1;const a=await te.findByID(f.value.patientID);if(_.value.hasArvNumber=null===(e=a.patient_identifiers)||void 0===e?void 0:e.some((e=>"ARV Number"===e.type.name&&/\w+-ARV-\d+/i.test(`${e.identifier}`))),!_.value.hasArvNumber){var t,r;const e=await W.getNextSuggestedARVNumber();_.value.arvNumber=null!==(t=null===(r=`${e.arv_number}`.split(/\s/))||void 0===r?void 0:r[1])&&void 0!==t?t:e.arv_number.replace(/^\D+|\s/g,""),await d.loadSitePrefix(),_.value.sitePrefix=d.globalPropertyStore.sitePrefix||"_ERROR_"}}},captureArvNumber:{label:"Capture ART number?",required:()=>!_.value.hasArvNumber,validation:()=>P("captureArvNumber")},arvNumber:{label:"ART Number",required:()=>"Yes"===_.value.captureArvNumber,formatArvNumber:()=>{const e=_.value.arvNumber.replace(/^.*-/,"");return`${_.value.sitePrefix}-ARV-${e}`},onFormUpdate:(e,a)=>{"captureArvNumber"===e&&"No"===a&&(n.value.arvNumber="")},onSubmit:async()=>{if(n.value.arvNumber="",!x.arvNumber.required())return!0;try{return await r.createArvNumber(x.arvNumber.formatArvNumber())?(_.value.hasArvNumber=!0,!0):(n.value.arvNumber="Unable to save ARV number",!1)}catch(e){return n.value.arvNumber="Error saving arv Number",!1}},validation:()=>{if(P("arvNumber")){if(!/^\d+$/.test(_.value.arvNumber))return void(n.value.arvNumber="Only numbers are allowed");if(parseInt(_.value.arvNumber)<=0)return void(n.value.arvNumber="Number must be positive");const e=x.arvNumber.required();_.value.isLoading=!0,_.value.canSubmit=!1,ce.arvNumberExists(x.arvNumber.formatArvNumber()).then((a=>{n.value.arvNumber=a&&e?"ARV number already exists":""})).catch((()=>{n.value.arvNumber="",e&&(n.value.arvNumber="Error verifying ARV number")})).finally((()=>{_.value.canSubmit=!0,_.value.isLoading=!1}))}}}};function w(e){n.value[e]="","function"==typeof x[e].validation&&x[e].validation()}function P(e){n.value[e]="";return"function"==typeof x[e].required&&x[e].required()?!!_.value[e]||(n.value[e]=`${x[e].label} is required`,!1):`${_.value[e]}`.length>0}function A(e,a){w(e),Object.keys(x).forEach((t=>{var r;return(null===(r=x[t])||void 0===r?void 0:r.onFormUpdate)&&x[t].onFormUpdate(e,a)}))}function V(){return Object.keys(x).forEach((e=>w(e))),Object.keys(n.value).some((e=>`${n.value[e]}`.length>=1))}return o((()=>async function(){_.value.isLoading=!0,_.value.canSubmit=!1,await Promise.all(Object.keys(x).filter((e=>"function"==typeof x[e].init)).map((e=>x[e].init()))),_.value.isLoading=!1,_.value.isInit=!0,_.value.canSubmit=!0}())),a({onSubmit:async function(){if(!_.value.isInit||!_.value.canSubmit)return re("Please wait for all data to load before submitting"),!1;if(V())return re("Please review form for errors"),!1;if(await function(){const e=Object.keys(x).filter((e=>!g.value[e]&&"function"==typeof x[e].onSubmit)).map((e=>x[e].onSubmit&&x[e].onSubmit().then((()=>{g.value[e]=!0}))));return Promise.all(e)}(),V())return re("Please review form for errors"),!1;try{return await r.createEncounter(),await r.saveObservationList(await Promise.all(Object.keys(x).reduce(((e,a)=>{if(a in x&&"function"==typeof x[a].required&&x[a].required()&&"function"==typeof x[a].buildObs){const t=x[a].buildObs();return Array.isArray(t)?[...e,...t]:[...e,t]}return e}),[]))),!0}catch(e){return console.error(e),oe("unable to save reception data"),!1}}}),(e,a)=>(c(),u(v(J),null,{default:m((()=>[_.value.isLoading?(c(),u(v(T),{key:0,type:"indeterminate"})):N("",!0),b(v(Y),null,{default:m((()=>[b(v(j),null,{default:m((()=>[b(v(z),null,{default:m((()=>[b(v($),{size:"12"},{default:m((()=>[y("div",Te,[a[9]||(a[9]=y("label",{class:"label-title"},[h("Patient present? "),y("span",{class:"required"},"*")],-1)),n.value.patientPresent?(c(),u(v(E),{key:0,class:"error-label"},{default:m((()=>[h(G(n.value.patientPresent),1)])),_:1})):N("",!0)]),b(v(L),{disabled:!_.value.isInit,modelValue:_.value.patientPresent,"onUpdate:modelValue":a[0]||(a[0]=e=>_.value.patientPresent=e),onIonChange:a[1]||(a[1]=e=>A("patientPresent",e.detail.value))},{default:m((()=>[b(v(k),{lines:"none"},{default:m((()=>[b(v(M),{value:"Yes"}),b(v(U),null,{default:m((()=>a[10]||(a[10]=[h("Yes")]))),_:1,__:[10]})])),_:1}),b(v(k),{lines:"none"},{default:m((()=>[b(v(M),{value:"No"}),b(v(U),null,{default:m((()=>a[11]||(a[11]=[h("No")]))),_:1,__:[11]})])),_:1})])),_:1},8,["disabled","modelValue"])])),_:1}),b(v($),{size:"12"},{default:m((()=>[y("div",Ye,[a[12]||(a[12]=y("label",{class:"label-title"},[h("Guardian present? "),y("span",{class:"required"},"*")],-1)),n.value.guardianPresent?(c(),u(v(E),{key:0,class:"error-label"},{default:m((()=>[h(G(n.value.guardianPresent),1)])),_:1})):N("",!0)]),b(v(L),{disabled:!_.value.isInit,modelValue:_.value.guardianPresent,"onUpdate:modelValue":a[2]||(a[2]=e=>_.value.guardianPresent=e),onIonChange:a[3]||(a[3]=e=>A("guardianPresent",e.detail.value))},{default:m((()=>[b(v(k),{lines:"none"},{default:m((()=>[b(v(M),{value:"Yes"}),b(v(U),null,{default:m((()=>a[13]||(a[13]=[h("Yes")]))),_:1,__:[13]})])),_:1}),b(v(k),{lines:"none"},{default:m((()=>[b(v(M),{value:"No"}),b(v(U),null,{default:m((()=>a[14]||(a[14]=[h("No")]))),_:1,__:[14]})])),_:1})])),_:1},8,["disabled","modelValue"])])),_:1})])),_:1}),x.captureArvNumber.required()?(c(),u(v(z),{key:0},{default:m((()=>[b(v($),null,{default:m((()=>[y("div",Ee,[a[15]||(a[15]=y("label",{class:"label-title"},[h("Capture ART number? "),y("span",{class:"required"},"*")],-1)),n.value.captureArvNumber?(c(),u(v(E),{key:0,class:"error-label"},{default:m((()=>[h(G(n.value.captureArvNumber),1)])),_:1})):N("",!0)]),b(v(L),{disabled:!_.value.isInit,modelValue:_.value.captureArvNumber,"onUpdate:modelValue":a[4]||(a[4]=e=>_.value.captureArvNumber=e),onIonChange:a[5]||(a[5]=e=>A("captureArvNumber",e.detail.value))},{default:m((()=>[b(v(k),{lines:"none"},{default:m((()=>[b(v(M),{value:"Yes"}),b(v(U),null,{default:m((()=>a[16]||(a[16]=[h("Yes")]))),_:1,__:[16]})])),_:1}),b(v(k),{lines:"none"},{default:m((()=>[b(v(M),{value:"No"}),b(v(U),null,{default:m((()=>a[17]||(a[17]=[h("No")]))),_:1,__:[17]})])),_:1})])),_:1},8,["disabled","modelValue"])])),_:1})])),_:1})):N("",!0),x.arvNumber.required()?(c(),u(v(z),{key:1},{default:m((()=>[b(v($),null,{default:m((()=>{var e,t,r;return[y("div",Le,[y("div",Me,[y("div",Be,[a[18]||(a[18]=y("label",{class:"label-title"},[h("ART Number "),y("span",{class:"required"},"*")],-1)),n.value.arvNumber?(c(),u(v(E),{key:0,class:"error-label"},{default:m((()=>[h(G(n.value.arvNumber),1)])),_:1})):N("",!0)]),y("div",He,[y("div",{class:R(["input-group",{"input-group-error":null!==(e=n.value.arvNumber)&&void 0!==e&&e}])},[B(y("input",{disabled:!_.value.isInit,type:"text",class:R(["form-control",{"has-error":null!==(t=n.value.arvNumber)&&void 0!==t&&t}]),"onUpdate:modelValue":a[6]||(a[6]=e=>_.value.arvNumber=e),onInput:a[7]||(a[7]=e=>A("arvNumber",e.target.value)),required:""},null,42,Je),[[H,_.value.arvNumber]]),y("span",{class:R(["input-group-text",{"has-error":null!==(r=n.value.arvNumber)&&void 0!==r&&r}])},G(_.value.sitePrefix)+"-ARV ",3)],2)])])])]})),_:1})])),_:1})):N("",!0)])),_:1})])),_:1}),b(Oe,{isOpen:s.value,patientID:v(f).patientID,onClose:a[8]||(a[8]=e=>s.value=!1),onGuardianSelected:x.guardianPresent.onGuardianSelected,onWhenSaved:x.guardianPresent.onGuardianSelected},null,8,["isOpen","patientID","onGuardianSelected","onWhenSaved"])])),_:1}))}}),[["__scopeId","data-v-2b388e8e"]]))}}}))}();

!function(){function t(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}System.register(["./vendor-legacy-BOMZZk9P.js","./index-legacy-BpDt3Jmu.js","./lodash-legacy-C-x9g9Na.js"],(function(e,n){"use strict";var r,a,i,o,s,u,l,c,d,p,f,h,m,g,b,v,y,w,D,$,P,j,B,_,A,F,Q,I,S,M,O,V,q,R,U,k,x,C;return{setters:[t=>{r=t.c,a=t.r,i=t.eF,o=t.bT,s=t.bU,u=t.O,l=t.d,c=t.y,d=t.f,p=t.z,f=t.l,h=t.u,m=t.S,g=t.U,b=t.b3,v=t.W,y=t.I,w=t.aR,D=t.T,$=t.A,P=t.B,j=t.ad,B=t.eC,_=t.b8,A=t.eG},t=>{F=t.A,Q=t.k,I=t.n,S=t.s,M=t.g,O=t.o,V=t.m,q=t._,R=t.q,U=t.v,k=t.e,x=t.w},t=>{C=t.l}],execute:function(){var n=document.createElement("style");n.textContent=".close-button[data-v-dd3e8006]{float:right;margin-top:0;padding-top:0;font-size:x-large;cursor:pointer}\n/*$vite$:1*/",document.head.appendChild(n),e({a:function(t,e,n,r){return{label:"PDF",color:"primary",action:async(n,r,a,u)=>{let l=e&&await I("PDF may contain private data that will require a password to unlock, To access private data choose Secure PDF over Regular PDF",{header:"Security warning",confirmBtnLabel:"Secure PDF",cancelBtnLabel:"Regular PDF"});!function(t){const{filename:e,canHorizontalPageBreak:n,columns:r,rows:a,filters:u,safeMode:l}=t,c=[X(r,l)],d=Z(r,i(a,(null==u?void 0:u.sort)||[]),l),p=l?function(){const t=O().getUser().username;return{encryption:{userPassword:t,ownerPassword:t,userPermissions:["print"]}}}():{},f=new o({...p}),h=f.splitTextToSize(S(e),180),m=h.length<=1?20:10*h.length;f.text(h,14,10);const g={startY:m,head:c,body:d};n&&(g.tableWidth="wrap",g.horizontalPageBreak=!0,g.horizontalPageBreakRepeat=0);s(f,g);const b=`${e}.pdf`;f.save(b)}({rows:r,filters:a,columns:u,filename:t,safeMode:l})}}},e:et,g:function(t,e,n){return{label:"CSV",color:"primary",action:async(r,a,i,o)=>{et({rows:a,filters:i,columns:o,quarter:e,period:n,filename:t})}}}});const T=a(""),Y=a(""),z=a(""),E=r((()=>`${T.value||"-"} / ${Y.value||"-"}`));function L(){T.value=`v${Q.version}`,z.value=Q.version}async function H(){const t=await F.get("version");let e=await t.json();Y.value=e["System version"]||"-"}function N(){const[t,e,n]=z.value.split("."),[r,a,i]=Y.value.split(".");return!((parseInt(r)||0)<(parseInt(t)||0))&&(!((parseInt(a)||0)<(parseInt(e)||0))&&!((parseInt(i)||0)<(parseInt(n)||0)))}const{appVersion:G,apiVersion:W}={appVersion:T,apiVersion:Y,minApiVersion:z,fullVersion:E,loadAppVersions:L,loadApiVersion:H,isValidApiVersion:N},{facilityUUID:J}=M();function K(t,e){return e||!1!==t.exportable}function X(t,e=!1){return t.filter((t=>K(t,e))).map((t=>t.label))}function Z(t,e,n=!1){return e.map((e=>t.filter((t=>K(t,n))).map((t=>{let n=C.get(e,t.path,"");return"function"==typeof t.formatter&&n&&(n=t.formatter(n,e)),S(`${t.drillable&&Array.isArray(n)?n.length:n}`)}))))}function tt(t){const{columns:e,rows:n,quarter:r,period:a,filters:o,safeMode:s}=t,l=X(e,s),c=Z(e,i(n,(null==o?void 0:o.sort)||[]),s);let d=l.join(",")+"\n";return d+=c.map((t=>t.join(","))).join("\n"),d+=`\nDate Created:  ${u().format("DD/MMM/YYYY HH:MM:ss")}`,r&&(d+=`\nQuarter: ${r}`),a&&(d+=`\nQuarter: ${a}`),d+=`\ne-Mastercard Version : ${G.value}`,d+=`\nAPI Version ${W.value}`,d+=`\nSite UUID: ${J}`,d}function et(t){const e=new Blob([tt(t)],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.setAttribute("download",`${t.filename}.csv`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}e("D",q(l({__name:"DrilldownTable",props:{title:{type:String,default:"Drill down table"},rows:{type:Array,required:!0},columns:{type:Array,required:!1},actionButtons:{type:Array},rowActionButtons:{type:Array},config:{type:Object,default:()=>({showSubmitButton:!1})}},setup:t=>(e,n)=>(d(),c(h(_),null,{default:p((()=>[f(h(m),null,{default:p((()=>[f(h(g),null,{default:p((()=>[f(h(b),{slot:"end"},{default:p((()=>[f(h(v),{slot:"end",onClick:n[0]||(n[0]=t=>h(V).hide()),"icon-only":""},{default:p((()=>[f(h(y),{icon:h(w)},null,8,["icon"])])),_:1})])),_:1}),f(h(D),null,{default:p((()=>[$(P(t.title),1)])),_:1})])),_:1})])),_:1}),f(h(j),null,{default:p((()=>[f(h(B),{rows:t.rows,columns:t.columns,config:t.config,"row-actions-buttons":t.rowActionButtons,"actions-buttons":t.actionButtons,color:"light"},null,8,["rows","columns","config","row-actions-buttons","actions-buttons"])])),_:1})])),_:1}))}),[["__scopeId","data-v-dd3e8006"]])),e("L",23);e("R",class{constructor(){t(this,"date",void 0),t(this,"startDate",void 0),t(this,"endDate",void 0),t(this,"programId",void 0),t(this,"useDefaultParams",void 0),t(this,"occupation",void 0),this.programId=1,this.date=R(),this.endDate="",this.startDate="",this.useDefaultParams=!0,this.occupation=""}setDate(t){this.date=U(t)}setStartDate(t){this.startDate=U(t)}setEndDate(t){this.endDate=U(t)}setOccupation(t){this.occupation="All"===t?"":t}getDateIntervalPeriod(){return this.startDate&&this.endDate?`${k(this.startDate)} - ${k(this.endDate)}`:"-"}buildParams(t){let e={};return this.useDefaultParams&&(e.date=this.date,e.program_id=this.programId),this.startDate&&(e.start_date=this.startDate),this.endDate&&(e.end_date=this.endDate),this.occupation&&(e.occupation=this.occupation),t&&(e={...e,...t}),e}async getReport(t,e){return(await F.get(x(t,this.buildParams(e)))).json()}static getReportQuarters(t=5){const e=[];let n=new Date,r=n.getFullYear();n=new Date(`${r}-${n.getMonth()+1}-${n.getDate()} 00:00`);let a=this.getQtrByDate(n).qtr,i=0;for(4===a&&e.push(this.buildQtrObj("Q1",r+1));i<t;)0===i&&a<4&&e.push(this.buildQtrObj(`Q${a+1}`,r)),e.push(this.buildQtrObj(`Q${a}`,r)),a=a>0?a-=1:a,r=0==a?r-1:r,a=0==a?a+=4:a,i++;return e}static getQtrByDate(t){const e=this.getQuarterBounds(t.getFullYear());for(const n in e){const{start:r,end:a}=e[n];if(t>=new Date(r)&&t<=new Date(a))return e[n]}return null}static buildQtrObj(t,e){const n=this.getQuarterBounds(e),{start:r,end:a}=n[t];return{start:r,end:a,name:`${t} ${e}`}}static getQuarterBounds(t){const e=e=>`${t}-${e}-01 00:00`,n=e=>`${t}-${e}-${(e=>u(`${t}-${e}-01`).daysInMonth())(e)} 00:00`;return{Q1:{qtr:1,start:e("01"),end:n("03")},Q2:{qtr:2,start:e("04"),end:n("06")},Q3:{qtr:3,start:e("07"),end:n("09")},Q4:{qtr:4,start:e("10"),end:n("12")}}}async getMaternalStatus(t,e="pepfar"){var n;if(C.isEmpty(t))return{FP:[],FBf:[]};const r=x("vl_maternal_status",this.buildParams({report_definition:e}));return null!==(n=(await A.postJson(r,{patient_ids:t})).data)&&void 0!==n?n:{FP:[],FBf:[]}}async buildMaternityAgreggateRows(t,e="pepfar"){const n=C.uniq(Object.values(t).flat(1).map((t=>t instanceof Object?t.patient_id:t))),r=Object.keys(t),a=await this.getMaternalStatus(n,e),i=a.FBf.concat(a.FP);return["FP","FNP","FBf"].map((e=>r.reduce(((n,r)=>({[r]:t[r].filter((t=>{const n=t instanceof Object?t.patient_id:t;return"FNP"===e?!i.includes(n):a[e].includes(n)})),...n})),{ageGroup:"All",gender:e})))}})}}}))}();

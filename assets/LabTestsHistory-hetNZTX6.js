import{d as M,ar as m,cw as D,U as y,T as O,as as R,ac as C,G as _,S as B,a9 as k,cz as F,X as N,a1 as H,a2 as P,E as h,e as l,f as c,m as L,l as g,k as f,z as $,F as A,L as E,B as V}from"./vendor-Oa4k5SKv.js";import{D as W,aw as z,H as b,az as v,i as w,F as q,h as J,j as U,l as S,g as G,ay as T,k as K,aA as j,S as X,aB as Q,aC as Y,aD as Z,u as x,_ as ee}from"./index-BdhC1is7.js";import{S as ae,L as te,a as se,P as ne,u as I,E as ie,b as oe}from"./lab_order-DYr07rRi.js";import{D as re}from"./DashBox-9Mj3niSm.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-B1bBG-op.js";import"./BasicForm-B6ipZRal.js";import"./DateInputField-CI9dtAgA.js";import"./group_validation-tm_CyvCS.js";const de=M({name:"Menu",components:{CheckInConfirmationModal:z,IonContent:k,IonHeader:B,IonItem:_,IonList:C,IonMenu:R,IonTitle:O,IonToolbar:y,DynamicButton:W,DashBox:re,LabModal:se,LabViewResultsModal:te,SendToLabConfirmationModal:ae,DataTable:D},computed:{...m(x,["patient"]),...m(I,["labResults"]),...m(Z,["investigations"]),...m(S,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"]),hasEnterResults(){return this.listOrders.some(e=>e.btn&&e.btn.includes("enter_results"))}},props:{propOrders:{default:[]}},data(){return{loading:!1,tableData:[],options:{responsive:!0,select:!1,layout:{topStart:"",topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1,order:[[3,"desc"]]},header:["Lab Test","Specimen","Accession Number","Order Date","Result"],iconsContent:w,valueNumericArray:[],obsDatetime:[],graphIcon:Y(["#006401"]),listIcon:Q(["#636363"]),displayGraph:!0,sendToLabModalOpen:!1,orders:[],userRoles:[],height:[],BMI:[],iconBg:{},activeWeight:[],activeHeight:[],activeBMI:[],listOrders:[],listResults:[],hasPatientsWaitingForLab:!1,labResultsContent:"",listHeaderOrders:"",service:"",openModal:!1,openResultsModal:!1,series:[{name:"",data:[]}]}},setup(){return{checkmark:P,pulseOutline:H}},async mounted(){this.loading=!0,await this.updateInvestigationWizard(),await this.setListData(),this.loading=!1,this.$nextTick(()=>{const e=this.$refs.dataTable.dt;e.columns.adjust().draw(),e.on("click",".result-btn",t=>{const n=t.target.getAttribute("data-id");this.openResultsForm(JSON.parse(n))}),e.on("click",".view-btn",t=>{const n=t.target.getAttribute("data-id");this.viewLabOrder(JSON.parse(n))}),e.on("click",".delete-btn",t=>{const n=t.target.getAttribute("data-id");this.voidLabOrder(JSON.parse(n),t)}),e.on("click",".order-btn",t=>{const n=t.target.getAttribute("data-id");this.saveTest(JSON.parse(n))})}),this.orders=this.propOrders,this.service=new j(this.patient.patientID),this.userRoles=await X.getUserRoles()},watch:{$route:{async handler(){await this.setListData()},deep:!0},patient:{async handler(e){e&&e.patientID&&await this.setListData()},immediate:!0},tableData:{handler(e){if(this.$refs.dataTable){const t=this.$refs.dataTable.dt;t.clear(),t.rows.add(e),t.draw()}},deep:!0}},methods:{async closeModal(){this.openModal=!1,await this.setListData()},async saveTest(e){await new oe().postActivities(this.patient.patientID,[{concept_id:await T.getConceptID(e.name,!0),name:e.name,specimen:e.specimen,reason:"Routine",specimenConcept:await T.getConceptID(e.specimen,!0)}]),K("Successfully saved"),this.orders=await v.getOrders(this.patient.patientID),this.tableData=this.generateListItems(this.orders,"order"),this.tableData.sort((s,a)=>{const o=new Date(s[3]);return new Date(a[3]).getTime()-o.getTime()});const n=this.$refs.dataTable.dt;n.clear(),n.rows.add(this.tableData),n.draw()},async openEnterResultModal(){await G(ie,{class:"lab-results-modal"},!0,{title:"name"}),await this.setListData()},toggleSendToLabModal(){this.sendToLabModalOpen=!this.sendToLabModalOpen},async fetchPatientLabStageData(){const e=await J(),t=e?e.code:null;if(t){const n=await U.getPatientList("LAB",t);await S().refresh(t),this.patient.patientID&&(this.hasPatientsWaitingForLab=n.some(s=>s.patient_id===this.patient.patientID))}},async updateInvestigationWizard(){this.orders=await v.getOrders(this.patient.patientID);const e=await this.orders.filter(t=>b.toStandardHisFormat(b.sessionDate())===b.toStandardHisFormat(t.order_date));e.length>0?this.investigations[0].selectedData=e:this.investigations[0].selectedData=""},dismiss(){N.dismiss()},async voidLabOrder(e,t){await q("Do you want to delete ".concat(e.tests[0].name," ?"),t)&&await this.service.voidOrder(e.id,"Mistake entry"),await this.setListData()},async openResultsForm(e){const t=await ne.getTestIndicatorsWithID(e.concept_id);console.log({testIndicators:t});const n=[e,{validationStatus:"",data:{rowData:[{colData:[]}]}}];t.forEach(a=>{let o={inputHeader:a.name,value:"",colSize:3,id:a.concept_id,name:a.name,required:!0,eventType:"input",alertsErrorMassage:""};if(a.name=="RBS"&&(o={inputHeader:a.name,value:"",colSize:3,id:a.concept_id,name:a.name,required:!0,eventType:"input",alertsErrorMassage:"",validationFunctionName:"validateRBS",unit:"mg/dL"}),a.name=="FBS"&&(o={inputHeader:a.name,value:"",colSize:3,id:a.concept_id,name:a.name,required:!0,eventType:"input",alertsErrorMassage:"",validationFunctionName:"validateFBS",unit:"mg/dL"}),a.name=="MRDT"||a.name=="Tuberculosis program"||a.name=="Vdrl"||a.name=="Hepatitis B"||a.name=="Lam"||a.name=="CrAg"||a.name=="CD4 count"||a.name=="Leukocytes"||a.name=="Protein"||a.name=="Nitrite"||a.name=="Urine Ketones"||a.name=="HIV test"){let i=[];(a.name=="MRDT"||a.name=="Vdrl"||a.name=="Hepatitis B"||a.name=="CrAg"||a.name=="Lam")&&(i=[{id:"1",name:"Positive"},{id:"2",name:"Negative"},{id:"3",name:"Invalid"}]),a.name=="Tuberculosis program"&&(i=[{id:"1",name:"Scanty"},{id:"2",name:"Negative"},{id:"3",name:"1+"},{id:"4",name:"2+"},{id:"5",name:"3+"}]),a.name=="CD4 count"&&(i=[{id:"1",name:"below reference line"},{id:"2",name:"above reference line"}]),(a.name=="Leukocytes"||a.name=="Protein"||a.name=="Nitrite"||a.name=="Ketones"||a.name=="Urine Ketones")&&(i=[{id:"2",name:"Negative"},{id:"1",name:"Trace"},{id:"3",name:"1+"},{id:"4",name:"2+"},{id:"5",name:"3+"},{id:"6",name:"4+"}]),a.name=="HIV test"&&(i=[{id:"2",name:"Positive"},{id:"1",name:"Negative"},{id:"3",name:"Invalid"}]),o={inputHeader:a.name,icon:w.search,value:"",name:"units",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,trackBy:"id",multiSelectData:i,id:a.concept_id,idName:"district_id"}}n[1].data.rowData[0].colData.push(o)}),I().setLabResults(n),this.openModal=!0,this.orders=await v.getOrders(this.patient.patientID),console.log("ðŸš€ ~ openResultsForm ~ this.orders:",this.orders)},async viewLabOrder(e){this.labResultsContent=e,this.openResultsModal=!0},async setListData(){this.loading=!0,this.orders=await v.getOrders(this.patient.patientID);let e=this.generateListItems(this.orders,"order");e.sort((o,i)=>{const r=new Date(o[3]);return new Date(i[3]).getTime()-r.getTime()});const t=[],n=t.filter(o=>!e.some(i=>i[0]===o[0])),s=e.filter(o=>t.some(i=>i[0]===o[0])),a=e.filter(o=>!s.some(i=>i[0]===o[0]));this.tableData=[...s,...n,...a],await this.updateInvestigationWizard(),this.loading=!1,D.use(F)},generateListItems(e,t){return e.length>0?e.flatMap(n=>n.tests.flatMap(s=>{var i,r,d,u;const a='<button class="btn btn-outline-secondary btn-sm view-btn" data-id=\''.concat(JSON.stringify(s),"'>").concat(this.iconsContent.view2,"</button> ");let o="";return((i=s==null?void 0:s.result)==null?void 0:i.length)==1?o=(s==null?void 0:s.result)!=null?((r=s==null?void 0:s.result[0])==null?void 0:r.value_modifier)+((d=s==null?void 0:s.result[0])==null?void 0:d.value):null:((u=s==null?void 0:s.result)==null?void 0:u.length)>1&&(s==null||s.result,o=a),[[s.name,n.specimen.name,n.accession_number,b.toStandardHisFormat(n.order_date),o]]})):[]}}}),le={class:"container"},ce={key:0,class:"loading-container"},ue={key:1,class:"table-responsive"};function pe(e,t,n,s,a,o){const i=h("ion-spinner"),r=h("DataTable"),d=h("LabViewResultsModal"),u=h("LabModal");return c(),l("div",le,[e.loading?(c(),l("div",ce,[g(i,{name:"crescent"}),t[2]||(t[2]=f("p",null,"Loading lab results...",-1))])):L("",!0),e.loading?L("",!0):(c(),l("div",ue,[g(r,{ref:"dataTable",options:e.options,data:e.tableData,class:"display nowrap",width:"100%"},{default:$(()=>[f("thead",null,[f("tr",null,[(c(!0),l(A,null,E(e.header,p=>(c(),l("th",{key:p,"data-orderable":!0},V(p),1))),128))])])]),_:1},8,["options","data"])])),g(d,{popoverOpen:e.openResultsModal,content:e.labResultsContent,onCloseModal:t[0]||(t[0]=p=>e.openResultsModal=!1)},null,8,["popoverOpen","content"]),g(u,{popoverOpen:e.openModal,onSaved:e.closeModal,onCloseModal:t[1]||(t[1]=p=>e.openModal=!1)},null,8,["popoverOpen","onSaved"])])}const Se=ee(de,[["render",pe],["__scopeId","data-v-519fa306"]]);export{Se as default};

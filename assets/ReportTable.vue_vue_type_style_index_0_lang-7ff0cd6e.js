import{s as N,g as P,c as S,d as F,p as q,b as $,t as j,a as p,i as L,m as O,D as Q}from"./report_service-a40c5252.js";import{u as U,r as z}from"./index-5bd70645.js";import{cH as G,ae as J,d as _,r as g,c as m,es as K,e as w,y as B,z as d,l as f,x as i,aI as W,aJ as X,c6 as T,m as x,A as Y,j as Z,B as ee,aK as te,eq as ae,et as re,cO as le,J as oe,k as ne,aH as se,eu as ie}from"./vendor-9911d1c7.js";import{l as y}from"./lodash-7be49fbd.js";function ue(l="person_id",u=J()){return{label:"view client",icon:G,color:"light",action:n=>u.push("/patient/".concat(n[l]))}}function ye(l,u={}){return Array.isArray(l)?l.map(n=>({label:n,path:n,drillable:!0,sortable:!0,...u})):Object.entries(l).map(([n,t])=>({path:n,label:t,drillable:!0,sortable:!1,...u}))}const me=_({__name:"ReportTable",props:{title:{type:String,default:"Report"},subtitle:{type:String,default:""},period:{type:String,default:""},date:{type:String,default:""},quarter:{type:Object,default:()=>({})},totalClients:{type:Array},columns:{type:Array,default:()=>[]},rows:{type:Array,default:()=>[]},asyncRows:{type:Function},actionButtons:{type:Array,default:()=>[]},rowActionButtons:{type:Array,default:()=>[]},canExportCsv:{type:Boolean,default:!0},canExportPDF:{type:Boolean,default:!0},useSecureExport:{type:Boolean,default:!1},showRefreshButton:{type:Boolean,default:!0},useDateRangeFilter:{type:Boolean,default:!1},useQuarterFilter:{type:Boolean,default:!1},useDateFilter:{type:Boolean,default:!1},customFilters:{type:Array,default:()=>[]},showIndices:{type:Boolean,default:!1},filename:{type:String,default:""},reportType:{type:String,default:""},drillTitle:{type:Function,default:()=>"Drill-down table"},customDrillColumns:{type:Array},drillRowParser:{type:Function},customDrillHandler:{type:Function},showDrillSelectButton:{type:Boolean,default:!0}},emits:["generate"],setup(l,{emit:u}){const n=u,t=l,c=g({}),b=g({}),v=m(()=>N("\n  ".concat(t.reportType," \n  ").concat(U().facilityName," \n  ").concat((t.filename||t.title).replace(t.reportType,"")," \n  ").concat(t.period?t.period:t.date,"\n"))),C=m(()=>{const e=[...t.customFilters];return t.useDateRangeFilter?(e.push({id:"startDate",label:"Start Date",type:"date",placeholder:"Start Date",slotName:"datePicker",value:t.period.split("-")[0]}),e.push({id:"endDate",label:"End Date",placeholder:"End Date",type:"date",slotName:"datePicker",value:t.period.split("-")[1]})):t.useQuarterFilter?e.push({id:"quarter",label:"Quarter:",type:"select",value:t.quarter,options:P(10).map(a=>({label:a.name,value:a.name,other:a}))}):t.useDateFilter&&e.push({id:"date",label:"Date",type:"date",slotName:"datePicker",value:t.date}),e}),A=m(()=>{var a,r;const e=[...t.actionButtons];return t.canExportCsv&&e.push(S(v.value,(a=t.quarter)==null?void 0:a.label,t.period)),t.canExportPDF&&e.push(F(v.value,t.useSecureExport,(r=t.quarter)==null?void 0:r.label,t.period)),t.showRefreshButton&&e.push(k()),e}),I=m(()=>{var e;return(e=t.customDrillColumns)!=null?e:[{path:"identifier",label:"ARV Number",preSort:q,initialSort:!0},{path:"birthdate",label:"Date of Birth",formatter:$},{path:"gender",label:"Gender",formatter:j}]});function k(){return{label:"Refresh/Rebuild",icon:K,color:"primary",action:()=>{if(y.isEmpty(b.value))return p("Invalid filters");n("generate",b.value,!0)}}}function E(e){return C.value.every(a=>a.required===!1?!0:y.isEmpty(e[a.id])?!1:typeof e[a.id]=="object"?Object.values(e[a.id]).every(Boolean):!0)}function V(e){if("startDate"in e&&"endDate"in e){const{startDate:a,endDate:r}=c.value;if(!L(a,r))return p("Invalid date range");e.startDate=a,e.endDate=r,e.dateRange={startDate:a,endDate:r}}if("date"in e){if(y.isEmpty(c.value.date))return p("Invalid date");e.date=c.value.date}if(E(e))return b.value=e,n("generate",e,!1);p("Invalid filters")}function H(e){return e.preventDefault(),R({row:{clients:t.totalClients},column:{path:"clients",label:"Total Clients"}})}async function M(e,a){var r,o;if(typeof t.drillRowParser=="function")a.push(...await t.drillRowParser(e));else{const s=y.get(e.row,e.column.path,[]);for(const h of y.chunk(s,100)){const D=await ie.getAll(h);if(!D.ok)return p((r=D.errorMessage)!=null?r:"Unable to load patient data");a.push(...(o=D.data)!=null?o:[])}}}async function R(e){var o,s;if(typeof t.customDrillHandler=="function")return t.customDrillHandler(e);const a=t.drillTitle(e),r=g([]);return M(e,r.value),O.show(Q,{title:a,columns:I.value,rows:r.value,rowActionButtons:t.showDrillSelectButton?[ue("person_id",z)]:[],actionButtons:[S(a,(o=t.quarter)==null?void 0:o.label,t.period),F(a,!1,(s=t.quarter)==null?void 0:s.label,t.period)]})}return(e,a)=>(w(),B(i(se),{style:{padding:"0 !important"}},{default:d(()=>[f(i(W),{style:{"border-bottom":"1px solid #c2c2c2","font-weight":"500",color:"#000"}},{default:d(()=>{var r;return[f(i(X),{innerHTML:l.title},null,8,["innerHTML"]),l.subtitle?(w(),B(i(T),{key:0,innerHTML:l.subtitle,style:{color:"#818181"}},null,8,["innerHTML"])):x("",!0),(r=l.totalClients)!=null&&r.length?(w(),B(i(T),{key:1},{default:d(()=>[a[0]||(a[0]=Y(" Total Clients: ")),Z("a",{href:"#",onClick:H},ee(l.totalClients.length),1)]),_:1,__:[0]})):x("",!0)]}),_:1}),f(i(te),{class:"ion-no-padding",style:{"padding-bottom":"30px","min-height":"55vh"}},{default:d(()=>[f(i(ae),{rows:l.rows,"async-rows":l.asyncRows,columns:l.columns,"actions-buttons":A.value,"row-actions-buttons":l.rowActionButtons,"custom-filters":C.value,config:{showIndices:l.showIndices},onCustomFilter:V,onDrilldown:R,color:"light"},re({datePicker:d(({filter:r})=>{var o,s;return[f(i(le),{modelValue:c.value[r.id],"onUpdate:modelValue":h=>c.value[r.id]=h,"enable-time-picker":!1,"model-type":"dd/MMM/yyyy",format:"dd/MMM/yyyy",placeholder:(s=(o=r.placeholder)!=null?o:r.label)!=null?s:"Select Date","auto-apply":"","text-input":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])]}),_:2},[oe(e.$slots,(r,o)=>({name:o,fn:d(({filter:s})=>[ne(e.$slots,o,{filter:{filter:s}})])}))]),1032,["rows","async-rows","columns","actions-buttons","row-actions-buttons","custom-filters","config"])]),_:3})]),_:3}))}});export{me as _,ue as g,ye as t};

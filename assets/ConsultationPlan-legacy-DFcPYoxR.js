System.register(["./vendor-legacy-CYsozF-N.js","./index-legacy-aZwH83jw.js","./DemographicBar-legacy-Fvf5DuJr.js","./TreatmentPlan-legacy-ChVsXR7o.js","./NextAppointment-legacy-D7CPaWlS.js","./RiskAssessment.vue_vue_type_script_setup_true_lang-legacy-DRZELRCb.js","./Vitals.vue_vue_type_script_setup_true_lang-legacy-qbd_7bKd.js","./useFormWizard-legacy-Bs4I04wF.js","./lodash-legacy-pOOc9Efu.js","./formatServerData-legacy-BuGO5pl3.js","./Registration-legacy-BwDrp-Xq.js","./usePatientProfile-legacy-DhYcfpZA.js","./apexcharts-legacy-D1PYWur1.js","./DashBox-legacy-Dc-byQki.js","./BasicForm-legacy-Dw-1P2mB.js","./DateInputField-legacy-DeYCIEP9.js","./previousDiagnosis-legacy-CFNvnS5m.js","./group_validation-legacy-BE1ngGEF.js","./drug_service-legacy-CIUiabo6.js","./lab_order-legacy-bJWMcTZO.js","./stages-legacy-larju8Tn.js","./drug_prescription_service-legacy-DDC-m-LL.js","./ncd_appointment_service-legacy-DdBhaCUE.js","./useLocation-legacy-BLxvAbUI.js","./useExposeFromStandardForm-legacy-Ypmu3pU6.js","./vaccines_service-legacy-C01BK__g.js","./sms_service-legacy-DcKoHG16.js","./EIRreportsStore-legacy-Cjj-LifG.js","./Export-legacy-9gz60ngO.js","./Outcome-legacy-CBqkbY_n.js"],function(e,a){"use strict";var t,n,s,l,i,o,c,r,u,g,v,d,m,p,f,y,h,b,_,D,S,w,j,C,x,k,A,I,P,T,R,N,V,F,B,L,z,E,O,$,H,M,W,J,K,U,X,Z,G,Y,q,Q,ee,ae,te,ne,se,le,ie,oe,ce,re,ue,ge,ve,de;return{setters:[e=>{t=e.d,n=e.ar,s=e.cp,l=e.r,i=e.c,o=e.b2,c=e.w,r=e.a,u=e.y,g=e.f,v=e.z,d=e.l,m=e.u,p=e.ah,f=e.k,y=e.m,h=e.i,b=e.bJ,_=e.v,D=e.an,S=e.bg},e=>{w=e.aC,j=e.u,C=e.aD,x=e.aE,k=e.a8,A=e.c,I=e.aF,P=e.f,T=e.V,R=e.d,N=e.T,V=e.F,F=e.J,B=e.H,L=e.aG,z=e.aH,E=e.aI,O=e.K,$=e.t,H=e.m,M=e.aJ,W=e.aK,J=e.X,K=e.S},e=>{U=e.D},e=>{X=e.u,Z=e.D,G=e.C,Y=e.T},e=>{q=e.u,Q=e.I,ee=e.N,ae=e.M,te=e.s,ne=e.c,se=e.a},e=>{le=e._},e=>{ie=e._},e=>{oe=e.u,ce=e._},e=>{re=e.l},e=>{ue=e.a,ge=e.b},e=>{ve=e.C},e=>{de=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){const a={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},me={class:"back_profile"};e("default",t({__name:"ConsultationPlan",setup(e,{expose:t}){const{onTabBeforeChange:pe,onChangeCurrentTab:fe,currentTabIndex:ye}=oe("Consultation Plan"),{printVisitSummary:he}=de(),be=n(),_e=s();l([]),l([]),l(!1);const De=l(!0),Se=l(!1),we=l(!1),je=i(()=>({text:we.value?"Saving...":"Finish",icon:we.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:Se.value||we.value})),Ce=w(),xe=j(),ke=C(),Ae=x();k();const Ie=q(),Pe=A();I();const Te=P(),Re=X(),Ne=T(),{patient:Ve}=o(xe),{vitals:Fe}=o(Ce),{investigations:Be}=o(ke),{diagnosis:Le}=o(Ae),{substance:ze}=o(Te),{selectedNCDMedicationList:Ee}=o(Ie),{FootScreening:Oe,visualScreening:$e,cvScreening:He}=o(Re),{sessionDate:Me}=o(Ne),{apiStatus:We}=o(R());c(je,(e,a)=>{console.log("Done button options changed:",{from:a,to:e,currentStep:ye.value,tabsLength:Xe.value.length}),e.disabled!==(null==a?void 0:a.disabled)&&console.log("Done button "+(e.disabled?"disabled":"enabled")),e.text!==(null==a?void 0:a.text)&&console.log(`Done button text changed from "${null==a?void 0:a.text}" to "${e.text}"`)},{deep:!0}),c(we,(e,a)=>{e!==a&&(console.log(`Saving state changed: ${a} -> ${e}`),e?console.log("Starting save process..."):console.log("Save process completed"))});const Je=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},Ke=()=>{let e=!1;return ta(),we.value&&(e=!0),Se.value=e,!e},Ue=()=>Pe.NCDActivities.map(e=>({title:e,icon:""})),Xe=l(Ue()),Ze=l(null),Ge=l(null),Ye=l(null),qe=l(null),Qe=l(null),ea=l(null),aa=l(null),ta=()=>{var e;if(!Xe.value||0===Xe.value.length)return console.log("Tabs not yet initialized"),null;const a=ye.value>=0&&ye.value<Xe.value.length?ye.value:0;switch(null===(e=Xe.value[a])||void 0===e?void 0:e.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(Pe.NCDActivities.length>0)switch(Pe.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},na=()=>{De.value=!1,setTimeout(()=>{ye.value=0,De.value=!0},0)},sa=()=>{const e=w();e.setVitals(e.getInitialVitals(Ve.value.ID))},la=async()=>{const e=F(Me.value,"sessionDate","value")||B.sessionDate(),a=L("vitals");for(let n=0;n<Xe.value.length;n++){const s=Xe.value[n];if("Vital Signs"===s.title)Xe.value[n].icon=ia(e,a)?S:"";else if("Risk Assessment"===s.title){const a=L("substanceAbuse");Xe.value[n].icon=ia(e,a)?S:""}else if("Investigations"===s.title){var t;const a=null==Ve||null===(t=Ve.value)||void 0===t||null===(t=t.labOrders)||void 0===t?void 0:t.saved,s=null==a?void 0:a.filter(a=>B.toStandardHisFormat(e)===B.toStandardHisFormat(a.order_date));Xe.value[n].icon=(null==s?void 0:s.length)>0?S:""}else if("Diagnosis"===s.title){const a=L("diagnosis");Xe.value[n].icon=ia(e,a)?S:""}else if("Complications Screening"===s.title){const a=L("screening");Xe.value[n].icon=ia(e,a)?S:""}else"Treatment Plan"===s.title&&(Ee.value.length>0?Xe.value[n].icon=ae()?S:"":Xe.value[n].icon="")}Ke()},ia=(e,a)=>{const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},oa=async()=>{we.value=!0;try{const a=[{ref:Ze,name:"Vitals"},{ref:Ge,name:"Risk Assessment"},{ref:Ye,name:"Investigations"},{ref:qe,name:"Diagnosis"},{ref:Qe,name:"Complications Screening"},{ref:ea,name:"Treatment Plan"},{ref:aa,name:"Next Appointment"}];for(const t of a)if(t.ref.value&&"function"==typeof t.ref.value.onSubmit)try{await t.ref.value.onSubmit()}catch(e){throw console.error(`Error calling ${t.name} onSubmit:`,e),e}else console.log(`${t.name} component ref not available or no onSubmit method`);await(async()=>{const e=W();if(!re.isEmpty(e.selectedMedicalAllergiesList)){const a=J(),t=e.selectedMedicalAllergiesList.map(e=>({concept_id:985,obs_datetime:K.getSessionDate(),location_id:a.facilityLocation.code,value_text:e.name})),n=await te(t);Ve.value=Object.assign(Ve.value,n),console.log("Allergies staged successfully:",Ve.value),e.clearSelectedMedicalAllergiesList()}const a=await ne();Ve.value=Object.assign(Ve.value,a);const t=await se().saveNonPharmaTherapyPatientData();Ve.value=Object.assign(Ve.value,t)})(),await(async()=>{const e=[],a=await ue($e.value),t=await ge(Oe.value),n=await ue(He.value);var s,l,i,o;a.length>0&&e.push({concept_id:await M.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:M.getSessionDate(),child:a}),t.length>0&&e.push({concept_id:await M.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:M.getSessionDate(),child:t}),n.length>0&&e.push(...n),e.length>0&&(null!==(l=(s=null!==(o=(i=Ve.value).screening)&&void 0!==o?o:i.screening={}).unsaved)&&void 0!==l||(s.unsaved=[]),Ve.value.screening.unsaved.push(...e),O("Complications saved successfully"))})(),await z(),await E(Ve.value),await ca(),O("Data saved successfully!"),be.push("patientProfile")}catch(e){console.error("Error saving data:",e),$("Error occurred while saving data. Please try again.")}finally{we.value=!1}},ca=async()=>{"dismiss"!==await H(ve,{class:"small-confirm-modal "})&&await he()};return r(async()=>{0!==Pe.NCDActivities.length?(X().resetScreening(),Xe.value=Ue(),await la(),(void 0===ye.value||ye.value<0)&&(ye.value=0,console.log("Setting initial tab index to 0")),Se.value=!1,Ke()):be.push("patientProfile")}),c(ye,async()=>{await Ke()}),c(Fe,async()=>{await la()},{deep:!0}),c(Ve,async()=>{X().resetScreening(),await la()},{deep:!0}),c(Me,async()=>{await la()},{deep:!0}),c(Be,async()=>{await la()},{deep:!0}),c(Le,async()=>{await la()},{deep:!0}),c(ze,async()=>{await la()},{deep:!0}),c(Ee,async()=>{await la()},{deep:!0}),c(_e,async e=>{na(),sa(),Xe.value=Ue()},{deep:!0}),c(Ve,async(e,a)=>{e.ID!=a.ID&&(na(),sa())},{deep:!0}),t({saveData:oa,markWizard:la,refreshWizard:na,validateDoneButtonState:Ke}),(e,t)=>(g(),u(m(D),null,{default:v(()=>[d(N),d(m(p),{fullscreen:!0},{default:v(()=>[d(U),f("div",a,[De.value?(g(),u(ce,{key:0,ref:"wizard","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:je.value,"custom-tabs":Xe.value,beforeChange:m(pe),onChange:m(fe),"onComplete:wizard":t[1]||(t[1]=e=>oa()),onDoneButtonChanged:Je},{default:v(()=>[f("div",null,[f("div",me,[d(V,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:m(b),"font-weight":"600",onClick:t[0]||(t[0]=e=>{be.push("patientProfile")})},null,8,["icon"])])]),h(f("div",null,[d(ie,{ref_key:"vitalsRef",ref:Ze},null,512)],512),[[_,"Vitals"==ta()]]),h(f("div",null,[d(le,{ref_key:"riskAssessmentRef",ref:Ge},null,512)],512),[[_,"RiskAssessment"==ta()]]),h(f("div",null,[d(Q,{ref_key:"investigationsRef",ref:Ye},null,512)],512),[[_,"Investigations"==ta()]]),h(f("div",null,[d(Z,{ref_key:"diagnosisRef",ref:qe},null,512)],512),[[_,"DiagnosisComponent"==ta()]]),h(f("div",null,[d(G,{ref_key:"complicationsRef",ref:Qe},null,512)],512),[[_,"ComplicationsScreening"==ta()]]),h(f("div",null,[d(Y,{ref_key:"treatmentPlanRef",ref:ea},null,512)],512),[[_,"TreatmentPlan"==ta()]]),h(f("div",null,[d(ee,{ref_key:"nextAppointmentRef",ref:aa},null,512)],512),[[_,"NextAppointment"==ta()]])]),_:1},8,["doneButton","custom-tabs","beforeChange","onChange"])):y("",!0)])]),_:1})]),_:1}))}}))}}});

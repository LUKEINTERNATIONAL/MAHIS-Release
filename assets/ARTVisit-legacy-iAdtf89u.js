System.register(["./vendor-legacy-w6nxQZiT.js","./index-legacy-DO03sHn_.js","./tasks-legacy-Bf82qb3b.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-D4F51Brg.js"],function(e,n){"use strict";var l,t,a,o,i,u,r,s,c,d,v,f,p,y,m,g,k,h,w,b,x,_,I,D,P,C,N,T,S,E,j,$,R,B,L,A,F,z,G,M,O,Y,J,K,U,V,W,Q,q,H,X,Z,ee,ne,le,te,ae,oe;return{setters:[e=>{l=e.d,t=e.cl,a=e.aT,o=e.ak,i=e.r,u=e.w,r=e.O,s=e.f,c=e.J,d=e.l,v=e.u,f=e.eE,p=e.k,y=e.ag,m=e.a8,g=e.e,k=e.ab,h=e.F,w=e.P,b=e.a1,x=e.L,_=e.eF,I=e.dL,D=e.eA,P=e.K,C=e.bS,N=e.M,T=e.G,S=e.N,E=e.Q,j=e.dV,$=e.bK,R=e.aR,B=e.aO,L=e.m,A=e.ej,F=e.bL,z=e.bN,G=e.cE,M=e.eG,O=e.ae,Y=e.R},e=>{J=e.S,K=e.u,U=e.P,V=e.T,W=e.bN,Q=e.s,q=e.bn,H=e.aj,X=e.$,Z=e.bO,ee=e.n,ne=e.bP,le=e.a8,te=e._},e=>{ae=e.i,oe=e.a},null,null],execute:function(){var n=document.createElement("style");n.textContent="#main[data-v-70d01902]{height:calc(100vh - 69px);overflow-y:auto}.placeholder-content[data-v-70d01902]{padding:20px}\n/*$vite$:1*/",document.head.appendChild(n);class ie extends J{constructor(){super()}static nextTask(e){return super.getJson(`/workflows/${super.getProgramID()}/${e}`,{date:super.getSessionDate()})}static async getNextTaskParams(e,n=""){let l=n;try{if(!l){const{name:n}=await ie.nextTask(e);l=n}}catch(t){l=""}return{name:l.toLowerCase(),params:{patient_id:e}}}}const ue={key:1,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},re={class:"ion-page",id:"main"},se={key:0,class:"placeholder-content"},ce={style:{margin:"0px auto"},class:"ion-text-center"},de={key:1},ve={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}},fe={style:{color:"black"}};e("default",te(l({__name:"ARTVisit",setup(e){const n=t(),l=K(),{patient:te}=a(l),pe=new U,ye=o(),me=i(-1),ge=i(null),ke=i([]),he=i([]),we=i(!1),be=i(-1),xe=i(""),_e=i(""),Ie=i(""),De=i(!1),Pe=i(null);function Ce(e){var n;return!!e&&(!we.value&&be.value===(null==e?void 0:e.encounterTypeID)||(null!==(n=null==e?void 0:e.otherWorkflowNames)&&void 0!==n?n:[]).includes(xe.value))}async function Ne(){var e;De.value=null!==(e=J.isBDE())&&void 0!==e&&e,Ie.value="",we.value=!0,_e.value="",xe.value="";try{var n;const e=await ie.nextTask(te.value.patientID);if(!e)return _e.value="No workflows found. You may exit this page or refresh",we.value=!1,void(me.value=-1);xe.value=e.name,be.value=null!==(n=null==e?void 0:e.encounter_type_id)&&void 0!==n?n:-1;const l=ke.value.findIndex(e=>{var n;return(null==e?void 0:e.encounterTypeID)===be.value||(null!==(n=e.otherWorkflowNames)&&void 0!==n?n:[]).includes(xe.value)});-1!==l||(_e.value=xe.value?`"${xe.value}" is not available in the current workflow. Contact your administrator or update ART activity selection`:"No next task found"),me.value=l}catch(l){_e.value="An error has occured while loading next task: "+l,console.error(l)}finally{await async function(){const e=await q.getEncounters(te.value.patientID,{date:ie.getSessionDate()});he.value=e.map(e=>e.encounter_type)}(),we.value=!1}}async function Te(){me.value=-1,ke.value=[];try{const e=H.map(async e=>{if(("function"!=typeof e.disabled||!e.disabled(H))&&e.workflowID&&e.component&&await ae(e.workflowID)&&await oe(e.workflowID))return e});ke.value=(await Promise.all(e)).filter(e=>void 0!==e),async function(){if(await X.isProp(`${Z.FILING_NUMBERS}=true`)){if(pe.patient=await U.findByID(te.value.patientID),!/n\/a/i.test(pe.getFilingNumber()))return;ee(le,{},!1,{title:"New filing number assignment",useComponent:ne,onClose:()=>{Y.dismiss()}})}}()}catch(e){Q("Unable to load activities"),console.error(e)}}function Se(){(function(){if(De.value){if(!Pe.value)return void Q("BDE Provider component is not available");if(!Pe.value.isProviderSelected())return Q("Please select a provider"),void Pe.value.openModal()}return ge.value&&"function"==typeof ge.value.onSubmit?ge.value.onSubmit():Promise.resolve(!0)})().then(e=>e&&Ne())}return u(()=>n.fullPath,()=>{Te().then(Ne)},{immediate:!0,deep:!0}),(e,n)=>(s(),r(v(O),null,{default:c(()=>[d(V),d(v(f),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:c(()=>{var e;return[d(v(y),{contentId:"main"},{default:c(()=>[d(v(m),null,{default:c(()=>[ke.value.length>0?(s(),r(v(k),{key:0},{default:c(()=>[(s(!0),g(h,null,w(ke.value,(e,n)=>(s(),r(v(b),{onClick:e=>function(e){if(e<0||e>=ke.value.length)return;const n=ke.value[e];n&&Ce(n)&&(me.value=e)}(n),lines:"none",key:n,disabled:!Ce(e),button:""},{default:c(()=>{return[(n=e,he.value.includes(null!==(l=null==n?void 0:n.encounterTypeID)&&void 0!==l?l:0)?(s(),r(v(x),{key:0,icon:v(_),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):Ce(e)?(s(),r(v(x),{key:2,icon:v(D),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(s(),r(v(x),{key:1,icon:v(I),style:{padding:"10px"},slot:"start"},null,8,["icon"]))),p("b",null,P(e.name),1)];var n,l}),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(s(),g("div",ue,[d(v(x),{style:{"font-size":"2rem"},icon:v(C)},null,8,["icon"]),n[2]||(n[2]=p("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),d(v(N),null,{default:c(()=>[d(v(T),{color:"light"},{default:c(()=>[d(v(S),{onClick:n[0]||(n[0]=e=>v(ye).back())},{default:c(()=>[d(v(x),{icon:v(j),slot:"start"},null,8,["icon"]),n[3]||(n[3]=E(" Back to dashboard ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),p("div",re,[we.value?(s(),g("div",se,[p("div",ce,[d(v($),{name:"bubbles"}),n[4]||(n[4]=p("p",null,[p("h1",null,"Please wait...")],-1))])])):null!==(e=ke.value[me.value])&&void 0!==e&&e.component?(s(),g("div",de,[d(v(R),null,{default:c(()=>[d(v(B),null,{default:c(()=>{var e;return[De.value?(s(),r(W,{key:0,ref_key:"bdeProviderComponent",ref:Pe},null,512)):L("",!0),(s(),r(A,null,[(s(),r(F(null===(e=ke.value[me.value])||void 0===e?void 0:e.component),{ref_key:"formRef",ref:ge},null,512))],1024))]}),_:1})]),_:1})])):(s(),g("div",ve,[d(v(x),{style:{color:"green","font-size":"80px"},icon:v(z)},null,8,["icon"]),p("h2",fe,P(_e.value),1),d(v(S),{size:"large",fill:"clear",onClick:n[1]||(n[1]=e=>v(ye).back())},{default:c(()=>[d(v(x),{slot:"start",icon:v(G)},null,8,["icon"]),n[5]||(n[5]=E(" Exit page ",-1))]),_:1})])),d(v(N),null,{default:c(()=>[d(v(T),{color:"light"},{default:c(()=>[me.value>=0?(s(),r(v(S),{key:0,onClick:Se,color:"primary",style:{padding:"4px"},slot:"end"},{default:c(()=>[n[6]||(n[6]=E(" Save and continue ",-1)),d(v(x),{style:{padding:"4px"},icon:v(M),slot:"end"},null,8,["icon"])]),_:1})):L("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),[["__scopeId","data-v-70d01902"]]))}}});

import{d as U,cj as Y,b2 as j,au as G,r as u,w as J,y as c,f as r,z as s,l as a,u as t,es as K,k as p,as as Z,a9 as q,e as I,ac as H,F as Q,L as X,G as ee,I as d,et as te,eu as ne,eo as ae,B as A,bN as oe,V as B,U as E,W as S,A as D,dP as le,bM as se,b0 as re,aZ as ie,e4 as ue,cT as ce,dv as de,cz as fe,m as ve,ev as pe,af as me}from"./vendor-nmnlhkKn.js";import{S as ye,u as ke,T as ge,a$ as _e,ac as V,m as we,_ as Ie}from"./index-BtuSuMhC.js";import{i as Te,a as xe}from"./tasks-BeqSmDbN.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-BRGQbDZT.js";class b extends ye{constructor(){super()}static nextTask(m){return super.getJson("/workflows/".concat(super.getProgramID(),"/").concat(m),{date:super.getSessionDate()})}static async getNextTaskParams(m,h=""){let f=h;try{if(!f){const{name:k}=await b.nextTask(m);f=k}}catch(k){f=""}return{name:f.toLowerCase(),params:{patient_id:m}}}}const be={key:1,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},he={class:"ion-page",id:"main"},Ce={key:0,class:"placeholder-content"},Se={style:{margin:"0px auto"},class:"ion-text-center"},De={key:1},Ne={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}},Pe={style:{color:"black"}},Re=U({__name:"ARTVisit",setup(Ae){const m=Y(),h=ke(),{patient:f}=j(h),k=G(),i=u(-1),T=u(null),l=u([]),N=u([]),g=u(!1),C=u(-1),y=u(""),_=u(""),P=u("");function W(n){var e;return N.value.includes((e=n==null?void 0:n.encounterTypeID)!=null?e:0)}function x(n){var e;return n?!g.value&&C.value===(n==null?void 0:n.encounterTypeID)||((e=n==null?void 0:n.otherWorkflowNames)!=null?e:[]).includes(y.value):!1}function $(){if(l.value.length===0||i.value===l.value.length-1)return!1;const n=l.value[i.value];return n&&x(n)}async function z(){const n=await _e.getEncounters(f.value.patientID,{date:b.getSessionDate()});N.value=n.map(e=>e.encounter_type)}async function R(){var n;P.value="",g.value=!0,_.value="",y.value="";try{const e=await b.nextTask(f.value.patientID);if(!e){_.value="No workflows found. You may exit this page or refresh",g.value=!1,i.value=-1;return}y.value=e.name,C.value=(n=e==null?void 0:e.encounter_type_id)!=null?n:-1;const v=l.value.findIndex(o=>{var w;return(o==null?void 0:o.encounterTypeID)===C.value||((w=o.otherWorkflowNames)!=null?w:[]).includes(y.value)});if(v!==-1){P.value=e.description;const o=[...l.value.slice(v),...l.value.slice(0,v)];l.value=o,i.value=0}else _.value=y.value?'"'.concat(y.value,'" is not available in the current workflow. Contact your administrator or update ART activity selection'):"No next task found",i.value=v}catch(e){_.value="An error has occured while loading next task: "+e,console.error(e)}finally{await z(),g.value=!1}}async function F(){i.value=-1,l.value=[];try{const n=V.map(async e=>{if(!(typeof e.disabled=="function"&&e.disabled(V))){if(e.workflowID&&e.component){if(!await Te(e.workflowID)||!await xe(e.workflowID))return}else return;return e}});l.value=(await Promise.all(n)).filter(e=>e!==void 0)}catch(n){we("Unable to load activities"),console.error(n)}}function L(){return T.value&&typeof T.value.onSubmit=="function"?T.value.onSubmit():Promise.resolve(!0)}function O(){L().then(n=>n&&R())}function M(n){if(n<0||n>=l.value.length)return;const e=l.value[n];e&&x(e)&&(i.value=n)}return J(()=>m.fullPath,()=>{F().then(R)},{immediate:!0,deep:!0}),(n,e)=>(r(),c(t(me),null,{default:s(()=>[a(ge),a(t(K),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:s(()=>{var v;return[a(t(Z),{contentId:"main"},{default:s(()=>[a(t(q),null,{default:s(()=>[l.value.length>0?(r(),c(t(H),{key:0},{default:s(()=>[(r(!0),I(Q,null,X(l.value,(o,w)=>(r(),c(t(ee),{onClick:Be=>M(w),lines:"none",key:w,disabled:!x(o),button:""},{default:s(()=>[W(o)?(r(),c(t(d),{key:0,icon:t(te),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):x(o)?(r(),c(t(d),{key:2,icon:t(ae),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(r(),c(t(d),{key:1,icon:t(ne),style:{padding:"10px"},slot:"start"},null,8,["icon"])),p("b",null,A(o.name),1)]),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(r(),I("div",be,[a(t(d),{style:{"font-size":"2rem"},icon:t(oe)},null,8,["icon"]),e[2]||(e[2]=p("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),a(t(B),null,{default:s(()=>[a(t(E),{color:"light"},{default:s(()=>[a(t(S),{onClick:e[0]||(e[0]=o=>t(k).back())},{default:s(()=>[a(t(d),{icon:t(le),slot:"start"},null,8,["icon"]),e[3]||(e[3]=D(" Back to dashboard "))]),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),p("div",he,[g.value?(r(),I("div",Ce,[p("div",Se,[a(t(se),{name:"bubbles"}),e[4]||(e[4]=p("p",null,[p("h1",null,"Please wait...")],-1))])])):(v=l.value[i.value])!=null&&v.component?(r(),I("div",De,[a(t(re),null,{default:s(()=>[a(t(ie),null,{default:s(()=>{var o;return[(r(),c(ue,null,[(r(),c(ce((o=l.value[i.value])==null?void 0:o.component),{ref_key:"formRef",ref:T},null,512))],1024))]}),_:1})]),_:1})])):(r(),I("div",Ne,[a(t(d),{style:{color:"green","font-size":"80px"},icon:t(de)},null,8,["icon"]),p("h2",Pe,A(_.value),1),a(t(S),{size:"large",fill:"clear",onClick:e[1]||(e[1]=o=>t(k).back())},{default:s(()=>[a(t(d),{slot:"start",icon:t(fe)},null,8,["icon"]),e[5]||(e[5]=D(" Exit page "))]),_:1,__:[5]})])),a(t(B),null,{default:s(()=>[a(t(E),{color:"light"},{default:s(()=>[$()?(r(),c(t(S),{key:0,onClick:O,color:"primary",style:{padding:"4px"},slot:"end"},{default:s(()=>[e[6]||(e[6]=D(" Save and continue ")),a(t(d),{style:{padding:"4px"},icon:t(pe),slot:"end"},null,8,["icon"])]),_:1,__:[6]})):ve("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),Fe=Ie(Re,[["__scopeId","data-v-5043e891"]]);export{Fe as default};

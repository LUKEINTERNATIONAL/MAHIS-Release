!function(){function t(t,e,a){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var n=a.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}System.register(["./vendor-legacy-FCLUfW7v.js","./index-legacy-D173WeVu.js","./BasicForm-legacy-CeSK8VIg.js"],function(e,a){"use strict";var n,o,s,i,l,d,r,u,c,p,f,m,b,v,h,g,y,_,I,x,w,D,k,O,C,S,T,B,R,M,F,z,L,j,$,P,E,q,A,U,J,N,W,Y,H,V,G,X,K,Q,Z,tt,et,at,nt,ot,st,it;return{setters:[t=>{n=t.R,o=t.d,s=t.ar,i=t.V,l=t.as,d=t.af,r=t.D,u=t.dr,c=t.dy,p=t.ac,f=t.G,m=t.T,b=t.U,v=t.a9,h=t.S,g=t.b8,y=t.W,_=t.aU,I=t.X,x=t.E,w=t.y,D=t.f,k=t.z,O=t.l,C=t.k,S=t.B,T=t.A,B=t.e,R=t.F,M=t.L,F=t.b2,z=t.cl,L=t.r,j=t.c,$=t.w,P=t.a,E=t.u,q=t.I,A=t.a8,U=t.j},t=>{J=t.aP,N=t.az,W=t.D,Y=t.aO,H=t.S,V=t.m,G=t.H,X=t.ax,K=t.z,Q=t.u,Z=t._,tt=t.ar,et=t.i,at=t.as,nt=t.t,ot=t.ay,st=t.bl},t=>{it=t.B}],execute:function(){var a=document.createElement("style");a.textContent="ion-footer[data-v-a9001ab2]{--ion-toolbar-background: #f4f4f4f4}ion-modal[data-v-a9001ab2]{--width: 90%;--height: 94%}ion-footer[data-v-5d6713fe]{--ion-toolbar-background: #f4f4f4f4}ion-modal[data-v-5d6713fe]{--width: 90%;--height: 94%}.ion-padding[data-v-7d276145]{--padding-start: var(--ion-padding, 0px);--padding-end: var(--ion-padding, 0px);--padding-top: var(--ion-padding, 0px);--padding-bottom: var(--ion-padding, 16px)}#container[data-v-7d276145]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container strong[data-v-7d276145]{font-size:20px;line-height:26px}#container p[data-v-7d276145]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container a[data-v-7d276145]{text-decoration:none}.action_buttons[data-v-7d276145]{color:var(--ion-color-primary);display:flex;align-items:center;float:right;max-width:70px}.modify_buttons[data-v-7d276145]{padding-left:20px}.item_no_border[data-v-7d276145]{--border-color: transparent}.search_result[data-v-7d276145]{padding:10px}.action_buttons[data-v-7d276145]{opacity:0;transition:opacity .3s}.dashed_bottom_border:hover .action_buttons[data-v-7d276145]{opacity:1}.dashed_bottom_border[data-v-7d276145]{font-weight:700}.sub_item_body[data-v-7d276145]{margin-left:45px}ion-segment-button[data-v-7d276145]{background:#fff;margin-right:1px;font-size:12px;text-transform:unset}.bottomSummary[data-v-7d276145]{margin-top:20px;max-width:600px}.bottomSummary .segment-button-checked[data-v-7d276145]{background:#fff!important;--indicator-color: none}.bottomSummary ion-segment-button[data-v-7d276145]{background:#e6e6e6;margin-right:5px;border-top-right-radius:10px;border-top-left-radius:10px;text-transform:unset;font-style:normal;font-weight:700;font-size:12px}ion-modal[data-v-72d46b65]{--background: rgba(0, 0, 0, .9);--width: 100%;--height: 200px;--max-width: 700px;--max-height: 100%}.modal-wrapper[data-v-72d46b65]{display:flex;flex-direction:column;gap:20px;padding:16px}.modal-header[data-v-72d46b65]{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap}.modal-title[data-v-72d46b65]{top:20px;font-size:1.3rem;font-weight:600;color:#1e1e1e;line-height:1.4;max-width:90%;white-space:normal;word-break:break-word}.close-btn[data-v-72d46b65]{font-size:1.5rem;color:#b02a37;--padding-start: 0;--padding-end: 0;margin-left:auto}.modal-body[data-v-72d46b65]{font-size:1rem;color:#444;line-height:1.5;padding:4px;margin-left:20px;margin-right:15px}.modal-footer[data-v-72d46b65]{display:flex;justify-content:flex-end;gap:12px;flex-wrap:wrap}.action-btn[data-v-72d46b65]{min-width:100px;height:40px;font-size:.9rem;border-radius:8px;text-transform:none;padding:20px}.confirm-btn[data-v-72d46b65]{--background: var(--ion-color-success);color:#fff}\n/*$vite$:1*/",document.head.appendChild(a);const lt=e("u",n("labResultsStore",{state:()=>({labResults:[]}),actions:{setLabResults(t){this.labResults=t}},persist:!0}));class dt extends J{constructor(e){super(e,32),t(this,"patientID",void 0),t(this,"testTypeID",void 0),t(this,"resultDate",void 0),t(this,"testID",void 0),this.patientID=e,this.testTypeID=-1,this.resultDate="",this.testID=-1}createLabResult(t){return J.postJson(`lab/tests/${this.testID}/results`,{encounter_id:this.encounterID,date:this.resultDate,measures:t})}getTestID(){return this.testID}getTestTypeID(){return this.testTypeID}setTestTypeID(t){this.testTypeID=t}setResultDate(t){this.resultDate=t}setTestID(t){this.testID=t}getTestsWithoutResults(){return N.getOrders(this.patientID,{status:"drawn"})}getTestIndicators(){return N.getJson("lab/test_result_indicators",{test_type_id:this.testTypeID})}static getTestIndicatorsWithID(t){return N.getJson("lab/test_result_indicators",{test_type_id:t})}}e("P",dt);const rt=o({components:{IonButtons:_,IonButton:y,IonModal:g,IonHeader:h,IonContent:v,IonToolbar:b,IonTitle:m,IonItem:f,IonList:p,IonAvatar:c,IonImg:u,IonLabel:r,IonPage:d,IonMenu:l,BasicForm:it,IonFooter:i,DynamicButton:W},data:()=>({popoverStatus:null}),props:{keyboardClose:{type:Boolean,default:!1},keepContentsMounted:{type:Boolean,default:!1},content:{type:Object,default:{}},popoverOpen:{type:Boolean,default:!1},event:{type:Event,default:""},title:{type:String,default:""}},computed:{...s(Q,["patient"]),...s(lt,["labResults"])},mounted(){},methods:{dismiss(){I.dismiss()},async saveResults(){const t=await this.buildResults();this.patient.labOrders.results=[{encounter_id:"",date:G.sessionDate(),measures:t,test_id:this.labResults[0].id}];let e=!1;for(let a=0;a<this.patient.labOrders.unsaved.length;a++)if(this.patient.labOrders.unsaved[a].tests[0].id===this.labResults[0].id&&this.patient.labOrders.unsaved[a].tests&&this.patient.labOrders.unsaved[a].tests.length>0){this.patient.labOrders.unsaved[a].tests[0].result=t,e=!0;break}if(!e)for(let a=0;a<this.patient.labOrders.saved.length;a++)if(this.patient.labOrders.saved[a].tests[0].id===this.labResults[0].id&&this.patient.labOrders.saved[a].tests&&this.patient.labOrders.saved[a].tests.length>0){this.patient.labOrders.saved[a].tests[0].result=t;break}await X(this.patient),K("Saved successfully"),this.$emit("saved")},async buildResults(){let t=[];return await Promise.all(this.labResults[1].data.rowData[0].colData.map(async e=>{var a;let n;n=H.getUseIndexDBStatus()||H.getModsStatus()?await V("testResultIndicators",{whereClause:{test_type_id:e.id}}):await dt.getTestIndicatorsWithID(e.id),t.push({indicator:{name:null===(a=n[0])||void 0===a?void 0:a.name,concept_id:e.id},value:e.value.name||e.value||"not done",value_modifier:"",value_type:"text"})})),t},async nav(t,e){const a=lt();"not_save"==e?(await Y(),a.setLabResults(!1)):a.setLabResults(!0),this.dismiss(),this.$router.push(t)}}}),ut={class:"modal_wrapper"},ct={class:"center text_12"};e("a",Z(rt,[["render",function(t,e,a,n,o,s){const i=x("ion-title"),l=x("ion-button"),d=x("ion-buttons"),r=x("ion-toolbar"),u=x("ion-header"),c=x("basic-form"),p=x("ion-row"),f=x("ion-content"),m=x("DynamicButton"),b=x("ion-footer"),v=x("ion-modal");return D(),w(v,{"is-open":t.popoverOpen,"show-backdrop":!0,onDidDismiss:e[2]||(e[2]=e=>t.$emit("closePopoover",!1)),"keyboard-close":t.keyboardClose},{default:k(()=>[O(u,null,{default:k(()=>[O(r,null,{default:k(()=>[O(i,null,{default:k(()=>[C("b",null,"Enter lab results for ("+S(t.labResults[0].name)+") test",1)]),_:1}),O(d,{slot:"end"},{default:k(()=>[O(l,{onClick:e[0]||(e[0]=e=>t.$emit("closeModal"))},{default:k(()=>e[3]||(e[3]=[T("Close")])),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),O(f,{class:"ion-padding"},{default:k(()=>[C("div",ut,[C("div",ct,[O(p,null,{default:k(()=>[O(c,{contentData:t.labResults},null,8,["contentData"])]),_:1})])])]),_:1}),O(b,{translucent:!0},{default:k(()=>[O(r,null,{default:k(()=>[O(m,{onClick:e[1]||(e[1]=e=>t.saveResults()),name:"Save",fill:"clear",iconSlot:"icon-only",style:{float:"right"}})]),_:1})]),_:1})]),_:1},8,["is-open","keyboard-close"])}],["__scopeId","data-v-a9001ab2"]]));const pt=o({components:{IonButtons:_,IonButton:y,IonModal:g,IonHeader:h,IonContent:v,IonToolbar:b,IonTitle:m,IonItem:f,IonList:p,IonAvatar:c,IonImg:u,IonLabel:r,IonPage:d,IonMenu:l,BasicForm:it,IonFooter:i,DynamicButton:W},data:()=>({popoverStatus:null}),props:{keyboardClose:{type:Boolean,default:!1},keepContentsMounted:{type:Boolean,default:!1},content:{default:[]},popoverOpen:{type:Boolean,default:!1},event:{type:Event,default:""},title:{type:String,default:""}},methods:{dismiss(){I.dismiss()},nav(t,e){this.dismiss(),this.$router.push(t)}}}),ft={class:"modal_wrapper"},mt={class:"center text_12"};e("L",Z(pt,[["render",function(t,e,a,n,o,s){const i=x("ion-title"),l=x("ion-button"),d=x("ion-buttons"),r=x("ion-toolbar"),u=x("ion-header"),c=x("ion-col"),p=x("ion-row"),f=x("ion-content"),m=x("ion-modal");return D(),w(m,{"is-open":t.popoverOpen,"show-backdrop":!0,onDidDismiss:e[1]||(e[1]=e=>t.$emit("closePopoover",!1)),"keyboard-close":t.keyboardClose},{default:k(()=>[O(u,null,{default:k(()=>[O(r,null,{default:k(()=>[O(i,null,{default:k(()=>[C("b",null,"Lab results for ("+S(t.content.name)+") test",1)]),_:1}),O(d,{slot:"end"},{default:k(()=>[O(l,{onClick:e[0]||(e[0]=e=>t.$emit("closeModal"))},{default:k(()=>e[2]||(e[2]=[T("Close")])),_:1,__:[2]})]),_:1})]),_:1})]),_:1}),O(f,{class:"ion-padding"},{default:k(()=>[C("div",ft,[C("div",mt,[O(p,null,{default:k(()=>[(D(!0),B(R,null,M(t.content.result,(t,a)=>(D(),w(c,{size:"4",key:a},{default:k(()=>[O(p,null,{default:k(()=>[O(c,{size:"8"},{default:k(()=>[T(S(t.indicator.name),1)]),_:2},1024),O(c,{class:"bold",size:"0.5"},{default:k(()=>e[3]||(e[3]=[T(":")])),_:1,__:[3]}),O(c,{class:"bold",size:"2"},{default:k(()=>[T(S(t.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),_:1})]),_:1},8,["is-open","keyboard-close"])}],["__scopeId","data-v-5d6713fe"]])),e("E",Z(o({__name:"EnterResultModal",setup(t){const e=Q(),{patient:a}=F(e);z();const n=et,o=L(""),s=L(""),i=L(""),l=L(""),d=L(null),r=j(()=>[{componentType:"multiSelectInputField",name:"test",header:"Test",options:l.value,grid:{s:"6"},icon:et.search,validation:tt.required,onChange:t=>{o.value=t.name}},{componentType:"multiSelectInputField",name:"specimen",header:"Specimen",grid:{s:"6"},icon:et.search,validation:tt.required,value:1==i.value.length?i.value[0]:"",options:i.value.length>1?i.value:[]}]);$(o,async t=>{if(t)try{i.value=await u(t)}catch(e){i.value=[]}else i.value=[]});const u=async t=>{let e;e=H.getUseIndexDBStatus()||H.getModsStatus()?await V("specimens"):await N.getSpecimens("",1e3);return await ot.getConceptSet(t,"",{names:e.map(t=>t.name)})};$(a,async()=>{s.value=[...a.value.labOrders.saved,...a.value.labOrders.unsaved]},{deep:!0});const c=()=>{I.dismiss()};return P(async()=>{l.value=await(async()=>H.getUseIndexDBStatus()||H.getModsStatus()?await V("testTypes"):await N.getTestTypes())()}),(t,e)=>{const o=x("ion-icon"),i=x("ion-col"),l=x("ion-row"),u=x("ion-footer");return D(),B(R,null,[O(E(h),{style:{display:"flex","justify-content":"space-between"}},{default:k(()=>[O(E(m),{class:"modalTitle"},{default:k(()=>e[2]||(e[2]=[T("Add Lab Test")])),_:1,__:[2]}),O(o,{onClick:e[0]||(e[0]=t=>c()),style:{"padding-top":"10px","padding-right":"10px"},icon:E(n).cancel},null,8,["icon"])]),_:1}),O(E(v),{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:k(()=>[O(at,{formData:r.value,ref_key:"formRef",ref:d},null,8,["formData"])]),_:1}),O(u,{collapse:"fade",class:"ion-no-border"},{default:k(()=>[O(l,null,{default:k(()=>[O(i,null,{default:k(()=>[O(W,{onClick:e[1]||(e[1]=t=>(async()=>{var t,e,n,o,i,l;if(d.value.validateForm())return void nt("Test not saved");if(!d.value)return void console.error("Form reference is not available");const r=d.value.getFormValues(),u=[{concept_id:r.test.concept_id,name:r.test.name,specimen:r.specimen.name,reason:"Routine",specimenConcept:await ot.getConceptID(r.specimen.name,!0)}];let p=(await N.buildLabOrders("",u))[0];p.order_date=p.date,p.specimen.name=r.specimen.name,p.tests[0].name=r.test.name;const f=JSON.parse(JSON.stringify(a.value));null!==(e=(t=null!==(n=f.labOrders)&&void 0!==n?n:f.labOrders={}).unsaved)&&void 0!==e||(t.unsaved=[]),null!==(i=(o=null!==(l=f.labOrders)&&void 0!==l?l:f.labOrders={}).saved)&&void 0!==i||(o.saved=[]),f.labOrders.unsaved.push(p),await X(f),s.value=[...f.labOrders.saved,...f.labOrders.unsaved],c()})()),name:"Save",fill:"solid",style:{float:"right",margin:"2%",width:"130px"}})]),_:1})]),_:1})]),_:1})],64)}}}),[["__scopeId","data-v-7d276145"]]));const bt=o({name:"CheckInConfirmationModal",components:{IonModal:g,IonTitle:m,IonButton:y,IonContent:v,IonIcon:q,DynamicButton:W},props:{isOpen:{type:Boolean,required:!0,default:!1},closeModalFunc:{type:Function,required:!0},onYes:{type:Function,required:!0},onNo:{type:Function,required:!0},title:{type:String,required:!0}},methods:{closeCircleOutline:()=>A,closeModal(){this.closeModalFunc()}}}),vt={class:"modal-header"},ht={class:"modal-body"},gt={class:"modal-footer"};e("S",Z(bt,[["render",function(t,e,a,n,o,s){const i=x("ion-title"),l=x("ion-icon"),d=x("ion-button"),r=x("DynamicButton"),u=x("ion-content"),c=x("ion-modal");return D(),w(c,{"is-open":t.isOpen,"show-backdrop":!0,onDidDismiss:t.closeModal},{default:k(()=>[O(u,{class:"modal-wrapper"},{default:k(()=>[C("div",vt,[O(i,{class:"modal-title"},{default:k(()=>[T(S(t.title),1)]),_:1}),O(d,{fill:"clear",class:"close-btn",onClick:t.closeModal},{default:k(()=>[O(l,{icon:t.closeCircleOutline()},null,8,["icon"])]),_:1},8,["onClick"])]),C("div",ht,[U(t.$slots,"default",{},()=>[e[0]||(e[0]=T(" Sending the patient to the lab will pause this consultation. Youâ€™ll return to the waiting list while waiting for lab results this patient. "))],!0)]),C("div",gt,[O(d,{fill:"outline",color:"danger",class:"action-btn",onClick:t.onNo,style:{"--border-color":"#b42318"}},{default:k(()=>e[1]||(e[1]=[T(" Cancel ")])),_:1,__:[1]},8,["onClick"]),O(r,{name:"Confirm",color:"success",class:"action-btn confirm-btn",fill:"solid",onClick:t.onYes},null,8,["onClick"])])]),_:3})]),_:3},8,["is-open","onDidDismiss"])}],["__scopeId","data-v-72d46b65"]]));e("b",class extends N{constructor(){super()}async postActivities(t,e){const a=e.location_id,n=new st(parseInt(t),-1,a),o=await n.createEncounter();if(o){const t=await N.buildLabOrders(o,e.orders||e);if(!(await N.saveOrdersArray(o.encounter_id,t)))return nt("Unable to save lab orders")}}})}}})}();

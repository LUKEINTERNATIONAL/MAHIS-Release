import{d as ue,bU as me,r as _,c as T,a as pe,y as m,f as c,z as l,l as a,u as e,ad as ve,k as s,I as g,dp as z,aM as E,aL as w,as as C,d5 as S,A as u,b6 as K,c$ as H,W as x,co as Q,cP as W,aQ as _e,aN as ge,e as N,m as k,aE as fe,ac as X,F as j,L as J,G as Y,p as Z,dq as ee,B as r,D as te,d8 as V,aF as he,dr as ye,bq as Ie,b8 as be}from"./vendor-Bx_IVmwz.js";import{T as Pe,ad as ke,P as M,m as De,u as we,_ as Ce}from"./index-C_B4etN5.js";import{_ as Se}from"./ActionButtons.vue_vue_type_script_setup_true_lang-C7P3OQLG.js";import{p as Ne}from"./index-DoktQT7U.js";import"./lodash-Dt8AsbQm.js";import"./Arrays-CfBll-2n.js";const Ve=""+new URL("merge-patient-search-placeholder-grGtXK01.png",import.meta.url).href,Re={class:"full-height-container"},Ae={class:"centered-content"},Be={class:"header-section"},Le={class:"title-container"},xe={class:"search-card",mode:"ios"},Me={class:"search-content"},Oe={class:"patient-section primary-section"},qe={class:"section-header"},Ue={class:"input-group"},$e={class:"patient-section secondary-section"},Fe={class:"section-header"},Ge={class:"input-group"},Te={class:"preview-header"},ze={key:0,class:"results-container"},Ee={class:"results-section primary-results"},Ke={class:"results-title"},He={class:"avatar-placeholder"},Qe={class:"patient-name"},We={class:"patient-details"},Xe={class:"patient-ids"},je={class:"patient-location"},Je={class:"results-section secondary-results"},Ye={class:"results-title"},Ze={class:"avatar-placeholder"},et={class:"patient-name"},tt={class:"patient-details"},at={class:"patient-ids"},st={class:"patient-location"},lt={key:1,class:"preview-placeholder"},nt={class:"action-section"},ot=ue({__name:"MergePatients",setup(it){const O=me(),R=_(),h=_(""),A=_(!1),B=_(!1),y=_(""),I=_([]),b=_([]),d=_([]),f=_(null),L=T(()=>f.value&&d.value.length>0),ae=T(()=>I.value.length>0||b.value.length>0),D=async(n,t=!0)=>{if(!n.trim())return;const o=t?A:B,i=t?I:b;o.value=!0,i.value=[];try{const[v,P]=n.trim().split(" "),ie={...v&&{given_name:v},...P&&{family_name:P}},re=await M.search(ie);i.value=await Promise.all(re.map(async(ce,de)=>{await we().setPatientRecord(ce);const p=new M;return{index:de,id:p.getID(),name:p.getFullName()||"Unknown",docID:p.getDocID()||"NA",birthdate:p.getBirthdate(),arvNum:p.getArvNumber(),npid:p.getNationalID(),gender:p.getGender(),homeDistrict:p.getHomeDistrict(),homeVillage:p.getHomeVillage(),currentDistrict:p.getCurrentDistrict(),currentVillage:p.getCurrentVillage(),isChecked:!1}}))}catch(v){console.error("Patient search failed:",v),i.value=[]}finally{o.value=!1}},q=()=>{D(h.value,!0)},U=()=>{d.value=[],D(y.value,!1)},se=n=>{f.value=n},le=(n,t)=>{t?d.value.find(o=>o.id===n.id)||d.value.push(n):d.value=d.value.filter(o=>o.id!==n.id)},$=n=>d.value.some(t=>t.id===n),F=n=>n?new Date(n).toLocaleDateString():"N/A",G=n=>n.toLowerCase()==="m"?"primary":"secondary",ne=async()=>{if(L.value&&await ke("Are you sure you want to merge selected ".concat(d.value.length," secondary patient(s) to merge with primary patient.")))try{const n=await M.mergePatients({primary:{patient_id:f.value.id,doc_id:f.value.docID},secondary:d.value.map(t=>({patient_id:t.id,doc_id:t.docID}))});await Ne(n.patient_id),I.value=[],b.value=[],f.value=[],d.value=[],h.value="",y.value=""}catch(n){De("".concat(n))}},oe=()=>{const n=O.query.q;n&&n.trim()&&(h.value=n.trim(),y.value=n.trim(),D(n.trim(),!0),D(n.trim(),!1))};return pe(()=>{oe(),!O.query.q&&R.value&&setTimeout(()=>{R.value.$el.setFocus()},200)}),(n,t)=>(c(),m(e(be),null,{default:l(()=>[a(Pe),a(Se),a(e(ve),{fullscreen:!0,class:"main-content"},{default:l(()=>[s("div",Re,[s("div",Ae,[s("div",Be,[s("div",Le,[a(e(g),{icon:e(z),class:"title-icon"},null,8,["icon"]),t[3]||(t[3]=s("h1",{class:"page-title"},"Merge Clients",-1))]),t[4]||(t[4]=s("p",{class:"page-subtitle"},"Select primary and secondary patients to merge their records",-1))]),s("div",xe,[s("div",Me,[a(e(E),{class:"search-row"},{default:l(()=>[a(e(w),{class:"search-col"},{default:l(()=>[s("div",Oe,[s("div",qe,[a(e(g),{icon:e(C),class:"section-icon primary-icon"},null,8,["icon"]),t[6]||(t[6]=s("span",{class:"section-title"},"Primary Patient",-1)),a(e(S),{class:"section-note"},{default:l(()=>t[5]||(t[5]=[u("Main record")])),_:1,__:[5]})]),s("div",Ue,[a(e(K),{ref_key:"primaryInputRef",ref:R,modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=o=>h.value=o),label:"Search primary patient","label-placement":"floating",fill:"outline",placeholder:"Enter patient name or ID",class:"patient-input",onKeyup:H(q,["enter"])},null,8,["modelValue"]),a(e(x),{fill:"solid",color:"primary",class:"search-button",disabled:A.value||!h.value.trim(),onClick:q},{default:l(()=>[A.value?(c(),m(e(Q),{key:0,name:"crescent"})):(c(),m(e(g),{key:1,icon:e(W)},null,8,["icon"]))]),_:1},8,["disabled"])])])]),_:1}),a(e(w),{class:"search-col"},{default:l(()=>[s("div",$e,[s("div",Fe,[a(e(g),{icon:e(C),class:"section-icon secondary-icon"},null,8,["icon"]),t[8]||(t[8]=s("span",{class:"section-title"},"Secondary Patient",-1)),a(e(S),{class:"section-note"},{default:l(()=>t[7]||(t[7]=[u("Will be merged into primary")])),_:1,__:[7]})]),s("div",Ge,[a(e(K),{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=o=>y.value=o),label:"Search secondary patient","label-placement":"floating",fill:"outline",placeholder:"Enter patient name or ID",class:"patient-input",onKeyup:H(U,["enter"])},null,8,["modelValue"]),a(e(x),{fill:"solid",color:"secondary",class:"search-button",disabled:B.value||!y.value.trim(),onClick:U},{default:l(()=>[B.value?(c(),m(e(Q),{key:0,name:"crescent"})):(c(),m(e(g),{key:1,icon:e(W)},null,8,["icon"]))]),_:1},8,["disabled"])])])]),_:1})]),_:1})])]),a(e(_e),{class:"preview-card",mode:"ios"},{default:l(()=>[a(e(ge),{class:"preview-content"},{default:l(()=>[s("div",Te,[t[10]||(t[10]=s("h2",{class:"preview-title"},"Patient Search Results",-1)),a(e(S),{class:"preview-note"},{default:l(()=>t[9]||(t[9]=[u("Select patients from search results to preview merge")])),_:1,__:[9]})]),ae.value?(c(),N("div",ze,[a(e(E),null,{default:l(()=>[I.value.length>0?(c(),m(e(w),{key:0},{default:l(()=>{var o;return[s("div",Ee,[s("h3",Ke,[a(e(g),{icon:e(C),class:"results-icon primary-icon"},null,8,["icon"]),t[11]||(t[11]=u(" Primary Patient Options "))]),a(e(fe),{value:(o=f.value)==null?void 0:o.id,onIonChange:t[2]||(t[2]=i=>se(I.value.find(v=>v.id===i.detail.value)))},{default:l(()=>[a(e(X),{class:"patient-list scrollable-list ion-padding"},{default:l(()=>[(c(!0),N(j,null,J(I.value,i=>{var v;return c(),m(e(Y),{key:i.id,class:Z(["patient-item",{selected:((v=f.value)==null?void 0:v.id)===i.id}]),lines:"none"},{default:l(()=>[a(e(ee),{class:"patient-avatar"},{default:l(()=>[s("div",He,r(i.name.charAt(0)),1)]),_:2},1024),a(e(te),null,{default:l(()=>[s("h3",Qe,r(i.name),1),s("p",We,[a(e(V),{color:G(i.gender),class:"gender-badge"},{default:l(()=>[u(r(i.gender),1)]),_:2},1032,["color"]),u(" DOB: "+r(F(i.birthdate)),1)]),s("p",Xe,"ID: "+r(i.id)+" | ARV: "+r(i.arvNum||"N/A"),1),s("p",je,r(i.currentDistrict)+", "+r(i.currentVillage),1)]),_:2},1024),a(e(he),{value:i.id,color:"primary"},{default:l(()=>{var P;return[((P=f.value)==null?void 0:P.id)===i.id?(c(),m(e(g),{key:0,icon:e(ye),color:"primary",class:"selected-icon"},null,8,["icon"])):k("",!0)]}),_:2},1032,["value"])]),_:2},1032,["class"])}),128))]),_:1})]),_:1},8,["value"])])]}),_:1})):k("",!0),b.value.length>0?(c(),m(e(w),{key:1},{default:l(()=>[s("div",Je,[s("h3",Ye,[a(e(g),{icon:e(C),class:"results-icon secondary-icon"},null,8,["icon"]),t[12]||(t[12]=u(" Secondary Patient Options ")),d.value.length>0?(c(),m(e(V),{key:0,color:"secondary",class:"selection-count"},{default:l(()=>[u(r(d.value.length)+" selected ",1)]),_:1})):k("",!0)]),a(e(X),{class:"patient-list scrollable-list ion-padding"},{default:l(()=>[(c(!0),N(j,null,J(b.value,o=>(c(),m(e(Y),{key:o.id,class:Z(["patient-item",{selected:$(o.id)}]),lines:"none"},{default:l(()=>[a(e(ee),{class:"patient-avatar"},{default:l(()=>[s("div",Ze,r(o.name.charAt(0)),1)]),_:2},1024),a(e(te),null,{default:l(()=>[s("h3",et,r(o.name),1),s("p",tt,[a(e(V),{color:G(o.gender),class:"gender-badge"},{default:l(()=>[u(r(o.gender),1)]),_:2},1032,["color"]),u(" DOB: "+r(F(o.birthdate)),1)]),s("p",at,"ID: "+r(o.id)+" | ARV: "+r(o.arvNum||"N/A"),1),s("p",st,r(o.currentDistrict)+", "+r(o.currentVillage),1)]),_:2},1024),a(e(Ie),{checked:$(o.id),color:"secondary",onIonChange:i=>le(o,i.detail.checked)},null,8,["checked","onIonChange"])]),_:2},1032,["class"]))),128))]),_:1})])]),_:1})):k("",!0)]),_:1})])):(c(),N("div",lt,t[13]||(t[13]=[s("img",{src:Ve,alt:"Patient search placeholder",class:"placeholder-image"},null,-1)])))]),_:1})]),_:1}),s("div",nt,[a(e(x),{expand:"block",size:"large",color:"success",class:"merge-button",disabled:!L.value,onClick:ne},{default:l(()=>[a(e(g),{icon:e(z)},null,8,["icon"]),t[14]||(t[14]=u(" Merge Selected Patients ")),d.value.length>1?(c(),m(e(V),{key:0,color:"light",class:"merge-count"},{default:l(()=>[u(" 1 â†’ "+r(d.value.length),1)]),_:1})):k("",!0)]),_:1,__:[14]},8,["disabled"]),a(e(S),{class:"action-note"},{default:l(()=>[u(r(L.value?"Ready to merge ".concat(d.value.length," secondary patient(s) into primary patient"):"Select one primary patient and at least one secondary patient to enable merge"),1)]),_:1})])])])]),_:1})]),_:1}))}}),_t=Ce(ot,[["__scopeId","data-v-d7b1aff6"]]);export{_t as default};

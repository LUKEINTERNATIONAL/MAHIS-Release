var qt=Object.defineProperty;var Zt=(t,e,i)=>e in t?qt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var x=(t,e,i)=>Zt(t,typeof e!="symbol"?e+"":e,i);import{r as T,a as rt,e as v,f as l,k as s,m as S,l as a,u as W,a3 as ft,F as O,L,B as m,p as U,d as R,E as c,z as o,A,R as Xt,ar as B,c7 as Kt,c8 as te,c9 as ee,ca as _t,bi as se,cb as ae,cc as ne,cd as oe,ce as ie,cf as re,cg as le,ch as de,ci as ce,a2 as ue,cj as pe,at as me,n as Tt,au as he,y as P,ab as et,W as Ot,I as X,aa as st,U as M,af as gt,S as F,a9 as E,ck as fe,aS as ct,c as Nt,b1 as lt,w as K,$ as z,cl as Rt,aO as Vt,c3 as vt,D as Lt,bq as xt,T as Q,as as q,ac as H,G as J,X as bt,cm as Bt,a1 as Ft,cn as _e,co as ge,cp as ve,cq as be,bN as at,bO as ye,a0 as De,aY as Ce,aZ as $e,a_ as we,a$ as Se,cr as ke,bU as yt,bV as Ie,cs as Pe}from"./vendor--FxeD1z3.js";import{S as N,_ as V,H as w,u as j,a as Et,P as Y,b as Ut,c as Ae,d as nt,B as Mt,t as St,e as kt,i as Dt,f as mt,g as Ct,h as $t,j as Te,k as dt,l as Oe,m as Wt,U as wt,T as zt,n as Ne,o as Re,p as G,r as It,q as Pt,s as Ve,v as pt,L as Le}from"./index-BwanHY4k.js";import{m as Ht}from"./apexcharts-CTtppnOG.js";import{A as xe}from"./appointment_service-C-IbUly9.js";import{A as Jt,B as ot}from"./ncd_appointment_service-CSoRgPV_.js";import{D as Gt}from"./DateInputField-AadWpl-c.js";import{C as Be}from"./chartjs-C-3B1het.js";import{E as At}from"./encounter_type-B4iqc-Rj.js";import{B as Z}from"./BasicForm-DeB0odrT.js";import{u as Fe}from"./AdministerOtherVaccinesStore-BXtg1KA3.js";import{P as jt}from"./previousVitals-BxWpeR2I.js";import{_ as Yt}from"./customDatePicker.vue_vue_type_style_index_0_lang-D2elsBiC.js";import{s as Ee}from"./vaccines_service-Bm_CkP0S.js";import{l as it}from"./lodash-Dt8AsbQm.js";import{g as Ue}from"./dashboard_service-BuQnFlFe.js";import{i as Me}from"./Img-CJEgX1Vr.js";import We from"./FacilityReports-D1fm9HYv.js";import{M as ze,_ as He}from"./ActionButtons.vue_vue_type_script_setup_true_lang-DFGaA-5M.js";import"./app_encounter_service-Btkwsnyb.js";import"./clinicalDaysStore-B9zD7M1X.js";import"./SvgDynamicColor-CNFbOfIb.js";import"./sms_service-DWqTnsBI.js";import"./EIRreportsStore-B7hgyKPS.js";import"./Export-BWm4Vl7x.js";import"./Arrays-CfBll-2n.js";class Je extends N{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(e){return await super.getJson("fhir/patient/".concat(e),{id:e})}static async getFhirObservations(e){return await super.getJson("fhir/patient/".concat(e,"/observations/"),{id:e})}}const Ge={class:"fhir-viewer"},je={class:"container"},Ye={key:0,class:"card"},Qe={key:0,class:"card"},qe={class:"patient-info"},Ze={class:"info-item"},Xe={class:"info-value"},Ke={class:"info-item"},ts={class:"info-value"},es={class:"info-item"},ss={class:"info-value"},as={class:"info-item"},ns={class:"info-value age-display"},os={class:"info-item"},is={class:"info-value"},rs={class:"info-item"},ls={class:"info-value"},ds={class:"status-badge status-pending"},cs={class:"meta-info"},us={class:"meta-item"},ps={class:"meta-item"},ms={class:"meta-item"},hs={key:1,class:"card"},fs={class:"observations-grid"},_s={class:"obs-title"},gs={class:"obs-details"},vs={class:"obs-detail"},bs={class:"obs-value"},ys={key:0,class:"obs-detail"},Ds={class:"obs-value"},Cs={class:"obs-detail"},$s={class:"obs-value"},ws={class:"obs-detail"},Ss={class:"obs-value"},ks={class:"obs-detail"},Is={class:"obs-value"},Ps={__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(t){const e=t,i=T([]),r=T(""),h=async()=>{i.value=[await Je.getFhirPatient(r.value)],console.log("ðŸš€ ~ loadSampleData ~ fhirData:",i.value)},b=g=>{if(g.name&&g.name[0]){const n=g.name[0],$=n.given?n.given.join(" "):"",k=n.family||"";return"".concat($," ").concat(k).trim()}return"Unknown"},d=g=>g?new Date(g).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Not specified",p=g=>g?new Date(g).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Not specified",y=g=>{if(!g)return"Unknown";const n=new Date,$=new Date(g);let k=n.getFullYear()-$.getFullYear();const I=n.getMonth()-$.getMonth();return(I<0||I===0&&n.getDate()<$.getDate())&&k--,k},f=g=>{if(g.meta&&g.meta.tag){const n=g.meta.tag.find($=>$.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return n?n.code:"Unknown"}return"Unknown"},u=g=>g.entry&&g.entry.some(n=>n.resource&&n.resource.resourceType==="Observation"),C=g=>g.entry?g.entry.filter(n=>n.resource&&n.resource.resourceType==="Observation"):[],_=g=>g.code&&g.code.coding&&g.code.coding[0]?g.code.coding[0].display||g.code.coding[0].code:"Unknown Observation",D=g=>g.category&&g.category[0]&&g.category[0].coding?g.category[0].coding[0].display||g.category[0].coding[0].code:"Unknown";return rt(()=>{e.initialData.length>0&&(i.value=e.initialData)}),(g,n)=>(l(),v("div",Ge,[s("div",je,[n[19]||(n[19]=s("div",{class:"header"},[s("h3",null,"Referred Patient")],-1)),i.value.length?S("",!0):(l(),v("div",Ye,[a(W(ft),{modelValue:r.value,"onUpdate:modelValue":n[0]||(n[0]=$=>r.value=$),placeholder:"Enter Patient Identifier",onIonInput:g.FindDrugName,fill:"outline"},null,8,["modelValue","onIonInput"]),s("div",{class:"no-data"},[n[1]||(n[1]=s("br",null,null,-1)),s("button",{onClick:h,class:"load-data-btn"},"Find Patient")])])),(l(!0),v(O,null,L(i.value,$=>(l(),v("div",{key:$.id},[$.resourceType==="Bundle"&&$.entry&&$.entry[0]&&$.entry[0].resource.resourceType==="Patient"?(l(),v("div",Qe,[n[12]||(n[12]=s("h2",{class:"card-title"},"ðŸ‘¤ Patient Information",-1)),s("div",qe,[s("div",Ze,[n[2]||(n[2]=s("div",{class:"info-label"},"Full Name",-1)),s("div",Xe,m(b($.entry[0].resource)),1)]),s("div",Ke,[n[3]||(n[3]=s("div",{class:"info-label"},"Gender",-1)),s("div",ts,m($.entry[0].resource.gender||"Not specified"),1)]),s("div",es,[n[4]||(n[4]=s("div",{class:"info-label"},"Birth Date",-1)),s("div",ss,m(d($.entry[0].resource.birthDate)),1)]),s("div",as,[n[5]||(n[5]=s("div",{class:"info-label"},"Age",-1)),s("div",ns,m(y($.entry[0].resource.birthDate))+" years",1)]),s("div",os,[n[6]||(n[6]=s("div",{class:"info-label"},"Patient ID",-1)),s("div",is,m($.entry[0].resource.id),1)]),s("div",rs,[n[7]||(n[7]=s("div",{class:"info-label"},"Sync Status",-1)),s("div",ls,[s("span",ds,m(f($.entry[0].resource)),1)])])]),s("div",cs,[n[11]||(n[11]=s("h4",null,"Bundle Metadata",-1)),s("div",us,[n[8]||(n[8]=s("span",null,"Bundle ID:",-1)),s("span",null,m($.id),1)]),s("div",ps,[n[9]||(n[9]=s("span",null,"Last Updated:",-1)),s("span",null,m(p($.meta.lastUpdated)),1)]),s("div",ms,[n[10]||(n[10]=s("span",null,"Total Entries:",-1)),s("span",null,m($.total),1)])])])):S("",!0),$.resourceType==="Bundle"&&u($)?(l(),v("div",hs,[n[18]||(n[18]=s("h2",{class:"card-title"},"ðŸ“Š Clinical Observations",-1)),s("div",fs,[(l(!0),v(O,null,L(C($),k=>(l(),v("div",{key:k.resource.id,class:"observation-card"},[s("div",_s,m(_(k.resource)),1),s("div",gs,[s("div",vs,[n[13]||(n[13]=s("span",{class:"obs-label"},"Status:",-1)),s("span",bs,[s("span",{class:U("status-badge status-"+k.resource.status)},m(k.resource.status),3)])]),k.resource.valueQuantity?(l(),v("div",ys,[n[14]||(n[14]=s("span",{class:"obs-label"},"Value:",-1)),s("span",Ds,m(k.resource.valueQuantity.value)+" "+m(k.resource.valueQuantity.unit),1)])):S("",!0),s("div",Cs,[n[15]||(n[15]=s("span",{class:"obs-label"},"Category:",-1)),s("span",$s,m(D(k.resource)),1)]),s("div",ws,[n[16]||(n[16]=s("span",{class:"obs-label"},"Date:",-1)),s("span",Ss,m(p(k.resource.effectiveDateTime)),1)]),s("div",ks,[n[17]||(n[17]=s("span",{class:"obs-label"},"Code:",-1)),s("span",Is,m(k.resource.code.coding[0].code),1)])])]))),128))])])):S("",!0)]))),128))])]))}},As=V(Ps,[["__scopeId","data-v-eb83e3f4"]]),Ts=R({name:"referrals",components:{ExternalReferrals:As},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){this.segmentContent=t}}}),Os={key:0},Ns={style:{display:"flex","margin-top":"10px"}},Rs={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},Vs={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},Ls={key:1};function xs(t,e,i,r,h,b){const d=c("ion-label"),p=c("ion-segment-button"),y=c("ion-segment"),f=c("ExternalReferrals");return l(),v(O,null,[s("div",null,[a(y,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:o(()=>[a(p,{value:"Internal referrals",onClick:e[0]||(e[0]=u=>t.setSegmentContent("Internal referrals"))},{default:o(()=>[a(d,null,{default:o(()=>e[2]||(e[2]=[A("Internal referrals")])),_:1,__:[2]})]),_:1}),a(p,{value:"External referrals",onClick:e[1]||(e[1]=u=>t.setSegmentContent("External referrals"))},{default:o(()=>[a(d,null,{default:o(()=>e[3]||(e[3]=[A("External referrals")])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(l(),v("div",Os,[s("div",Ns,[t.checkUnderFive?(l(),v("div",Rs)):S("",!0),e[4]||(e[4]=s("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?S("",!0):(l(),v("div",Vs))])])):S("",!0),t.segmentContent=="External referrals"?(l(),v("div",Ls,[a(f)])):S("",!0)],64)}const Bs=V(Ts,[["render",xs],["__scopeId","data-v-77e5c38f"]]),ht=Xt("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(t){this.selectedItem=t},getSelectedItem(){return this.selectedItem}},persist:!0}),Fs=()=>{const t=T(null);return{activeIteminMixin:t,setActiveItem:i=>{t.value=i,console.log("lll: ",t.value)}}},tt=R({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:t,setActiveItem:e}=Fs();return{chevronBackOutline:pe,checkmark:ue,grid:ce,chevronDownCircle:de,chevronForwardCircle:le,chevronUpCircle:re,colorPalette:ie,document:oe,globe:ne,medkit:ae,add:se,person:_t,people:ee,thermometer:te,clipboard:Kt,activeIteminMixin:t,setActiveItem:e}},async mounted(){await this.setAppointments()},computed:{...B(j,["patient"])},watch:{$route:{async handler(t){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await xe.getDailiyAppointments(w.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((t,e)=>t.given_name.localeCompare(e.given_name)))},formatBirthdate(t){return w.getBirthdateAge(t)},setActiveItemRefFN(t){ht().setSelectedItem(t)}}}),Es=R({name:"NCDDashboard",mixins:[tt],components:{ApexChart:Ht},setup(){return{router:he()}},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await Tt(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){try{return N.getJson("programs/32/reports/ncd_dashboard",{start_date:w.toStandardHisFormat(w.sessionDate()),end_date:w.toStandardHisFormat(w.sessionDate())})}catch(t){return[]}},navigationMenu(t){try{me.close(),this.router.push(t).then(()=>{})}catch(e){console.error(e)}}}}),Us={class:"cards-container"},Ms={class:"top-card-text"},Ws={class:"text-2xl font-bold"},zs={class:"top-card-text"},Hs={class:"text-2xl font-bold"},Js={class:"top-card-text"},Gs={class:"text-2xl font-bold"},js={class:"top-card-text"},Ys={class:"text-2xl font-bold"},Qs={class:"top-card-text"},qs={class:"text-2xl font-bold"},Zs={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},Xs={ref:"chartRef1"},Ks={ref:"chartRef2"};function ta(t,e,i,r,h,b){const d=c("ion-card-content"),p=c("ion-card"),y=c("ApexChart");return l(),v(O,null,[s("div",Us,[a(p,{class:"top-card action-card",onClick:e[0]||(e[0]=f=>t.setActiveItemRefFN("appointments"))},{default:o(()=>[a(d,null,{default:o(()=>[s("div",Ms,[s("div",Ws,m(t.appointments.length),1),e[2]||(e[2]=s("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]),_:1})]),_:1}),a(p,{class:"top-card action-card"},{default:o(()=>[a(d,null,{default:o(()=>{var f;return[s("div",zs,[s("div",Hs,m((f=t.dashboardData)==null?void 0:f.total_pending_dispensations),1),e[3]||(e[3]=s("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]}),_:1})]),_:1}),a(p,{class:"top-card action-card"},{default:o(()=>[a(d,null,{default:o(()=>{var f;return[s("div",Js,[s("div",Gs,m((f=t.dashboardData)==null?void 0:f.total_defaulters),1),e[4]||(e[4]=s("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]}),_:1})]),_:1}),a(p,{class:"top-card action-card"},{default:o(()=>[a(d,null,{default:o(()=>{var f;return[s("div",js,[s("div",Ys,m((f=t.dashboardData)==null?void 0:f.total_complications),1),e[5]||(e[5]=s("h3",{class:"text-sm font-medium"},"Complications",-1))])]}),_:1})]),_:1}),a(p,{class:"top-card action-card",onClick:e[1]||(e[1]=f=>t.navigationMenu("NCDActivePatients"))},{default:o(()=>[a(d,null,{default:o(()=>{var f;return[s("div",Qs,[s("div",qs,m((f=t.dashboardData)==null?void 0:f.total_client_registered),1),e[6]||(e[6]=s("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]}),_:1})]),_:1})]),s("div",Zs,[a(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(d,null,{default:o(()=>[e[7]||(e[7]=s("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),s("div",Xs,[t.isChartReady?(l(),P(y,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1,__:[7]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(d,null,{default:o(()=>[e[8]||(e[8]=s("div",{class:"font-medium"},"Patients by gender",-1)),s("div",Ks,[t.isChartReady?(l(),P(y,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1,__:[8]})]),_:1})])],64)}const ea=V(Es,[["render",ta],["__scopeId","data-v-18251377"]]),sa=R({name:"Home",mixins:[Et,tt],components:{IonContent:E,IonHeader:F,IonPage:gt,IonToolbar:M,IonRow:st,DateInputField:Gt,IonIcon:X,IonButton:Ot,IonCol:et},data(){const t=localStorage.getItem("ncdStartDate"),e=localStorage.getItem("ncdEndDate"),i=T(t||w.sessionDate()),r=T(e||w.sessionDate()),h=T(w.sessionDate()),b=T([]);return{minDate:h,startDate:i,endDate:r,people:b,calendarOutline:ct,openOutline:fe}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{formatBirthdate(t){return w.getBirthdateAge(t)},async getAppointments(){if(Ut().apiStatus){this.people=[];try{(await Jt.getAppointments(this.startDate,this.endDate,"")).forEach(i=>{const r={person_id:i.person_id,npid:i.npid,appointment_id:103,encounter_id:i.encounter_id,name:i.given_name.concat(" ",i.family_name),gender:i.gender,ageDob:this.formatBirthdate(i.birthdate),village:i.city_village,appointmentDate:w.toStandardHisDisplayFormat(i.appointment_date)};this.people.push(r)})}catch(e){}}},async getAppointmentsD1(t){this.startDate=w.toStandardHisFormat(t),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=w.toStandardHisFormat(t),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(t){const e=await Y.findByNpid(t);j().setPatientRecord(e[0]),this.redirectUser()},redirectUser(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(i=>e.some(r=>r.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")}}}),aa={class:"appointments-container"},na={class:"date-filter"},oa={class:"appointments-table"};function ia(t,e,i,r,h,b){const d=c("DateInputField"),p=c("ion-col"),y=c("ion-row"),f=c("ion-icon"),u=c("ion-button"),C=c("ion-card");return l(),v("div",aa,[s("div",na,[a(y,null,{default:o(()=>[a(p,null,{default:o(()=>[a(d,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(p,null,{default:o(()=>[a(d,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})]),t.people.length>0?(l(),P(C,{key:0},{default:o(()=>[s("table",oa,[e[0]||(e[0]=s("thead",null,[s("tr",null,[s("th",null,"Name"),s("th",null,"NPID"),s("th",null,"Age/DOB"),s("th",null,"Gender"),s("th",null,"Village"),s("th",null,"Appointment Date")])],-1)),s("tbody",null,[(l(!0),v(O,null,L(t.people,_=>(l(),v("tr",{key:_.npid},[s("td",null,[a(y,null,{default:o(()=>[a(p,null,{default:o(()=>[A(m(_.name),1)]),_:2},1024),a(p,null,{default:o(()=>[a(u,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:D=>t.openClientProfile(_.npid),color:"primary",fill:"clear",size:"small"},{default:o(()=>[a(f,{icon:t.openOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),s("td",null,m(_.npid),1),s("td",null,m(_.ageDob),1),s("td",null,m(_.gender),1),s("td",null,m(_.village),1),s("td",null,m(_.appointmentDate),1)]))),128))])])]),_:1})):(l(),P(C,{key:1},{default:o(()=>e[1]||(e[1]=[s("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])),_:1,__:[1]}))])}const ra=V(sa,[["render",ia],["__scopeId","data-v-9dc99262"]]),la={key:0,class:"left_col"},da={class:"nav-menu"},ca=["onClick"],ua={class:"ellipsis"},pa={key:1,style:{"padding-left":"20px","padding-right":"20px"}},ma=R({__name:"NCDDashboard",setup(t){const e=ht(),i=Nt(()=>e.selectedItem),{screenWidth:r}=Ae(),h=T([{id:"dashboard",label:"Dashboard",icon:Rt},{id:"referrals",label:"Referrals",icon:Vt},{id:"appointments",label:"Appointments",icon:ct}]),b=T("dashboard"),d=nt(),{substance:p}=lt(d);K(()=>p.value,(f,u)=>{f!==u&&console.log("Substance changed:",f)},{deep:!0,immediate:!0});const y=f=>{b.value=f,ht().setSelectedItem(b.value)};return K(()=>i.value,f=>{console.log("Active item from mixin changed:",f),f&&f!=null&&y(f)},{immediate:!0}),(f,u)=>{const C=c("ion-segment-button"),_=c("ion-segment");return l(),v("div",{style:z(W(r)>940?"display: flex":"display: block")},[W(r)>940?(l(),v("div",la,[s("nav",da,[s("ul",null,[(l(!0),v(O,null,L(h.value,D=>(l(),v("li",{key:D.id,class:U({active:b.value===D.id}),onClick:g=>y(D.id)},[a(W(X),{icon:D.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),s("span",ua,m(D.label),1)],10,ca))),128))])])])):S("",!0),W(r)<=940?(l(),v("div",pa,[a(_,{value:b.value,style:{"margin-top":"5px","justify-content":"left"}},{default:o(()=>[(l(!0),v(O,null,L(h.value,D=>(l(),P(C,{value:D.id,key:D.id,class:U({active:b.value===D.id}),onClick:g=>y(D.id)},{default:o(()=>[a(W(X),{icon:D.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),s("span",null,m(D.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):S("",!0),s("div",{class:"right_col",style:z(W(r)>940?"width: 85%":"width: 100%")},[s("div",null,[b.value==="referrals"?(l(),P(Bs,{key:0})):S("",!0),b.value==="dashboard"?(l(),P(ea,{key:1})):S("",!0),b.value==="appointments"?(l(),P(ra,{key:2})):S("",!0)])],4)],4)}}}),ha=V(ma,[["__scopeId","data-v-eda11853"]]),fa=""+new URL("icon/checklist.svg",import.meta.url).href,_a=""+new URL("icon/dashboard.svg",import.meta.url).href,ga={name:"Dashboard",setup(){rt(async()=>{i.value=await p(),await y();const u=await f(),{labels:C,totalVisits:_,incompleteVisits:D}=t(u);e(C,_,D)});function t(u){if(!u)return{labels:[],totalVisits:[],incompleteVisits:[]};const C=[],_=[],D=[];return Object.entries(u).forEach(([g,n])=>{const k=new Date(g).toLocaleDateString("en-US",{weekday:"long"});C.push(k),_.push(n.complete),D.push(n.incomplete)}),{labels:C,totalVisits:_,incompleteVisits:D}}function e(u,C,_){const D=document.getElementById("myChart");new Be(D,{type:"bar",data:{labels:u,datasets:[{label:"Total visits",data:C,backgroundColor:"#5aa3b1"},{label:"Incomplete visits",data:_,backgroundColor:"#dba6a2"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}const i=T([]),r=T({}),h=u=>{const C=Object.entries(At).find(([_,D])=>D===u);return C?C[0]:"Unknown (".concat(u,")")},b=u=>Object.keys(u).map(C=>{var $,k;const _=Number(C),D=h(_),g=(($=u[_])==null?void 0:$.F)||0,n=((k=u[_])==null?void 0:k.M)||0;return{encounter:d(D),female:g,male:n,me:g+n,facility:g+n}}),d=u=>u.toLowerCase().replace(/_/g," ").replace(/\b\w/g,C=>C.toUpperCase()),p=async()=>{try{const u=Object.values(At).filter(n=>typeof n=="number"),[C,_]=await Promise.all([N.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:u}),N.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:[9,51,6,52,53,68,25,54,7],all:!0})]),D=b(_),g=b(C);return D.map(n=>{const $=g.find(k=>k.encounter===n.encounter);return{...n,me:$?$.female+$.male:0}})}catch(u){return console.error("Error fetching dashboard stats:",u),[]}},y=async()=>{try{const C=new Date().toISOString().split("T")[0],_=await N.getJson("programs/1/dashboard",{date:C});r.value=_}catch(u){console.error("Error fetching visits stats:",u)}},f=async()=>{try{const u=new Date,C=new Date;C.setDate(u.getDate()-5);const _=D=>D.toISOString().split("T")[0];return await N.getJson("programs/1/reports/visits",{name:"visits",end_date:_(u),start_date:_(C)})}catch(u){console.error("Error fetching visits stats:",u)}};return{checkListIcon:fa,dashboardIcon:_a,rows:i,dashboardScoreStats:r}}},va={class:"dashboard-container"},ba={class:"summary-cards"},ya={class:"card"},Da={class:"card"},Ca={class:"card"},$a={class:"card"},wa={class:"main-section"},Sa={class:"encounters-section"},ka={class:"his-sm-text"},Ia={key:0},Pa={class:"encounter-td"},Aa={class:"other-td"},Ta={class:"other-td"},Oa={class:"other-td"},Na={class:"other-td"},Ra={key:1};function Va(t,e,i,r,h,b){var d,p,y,f,u,C,_,D;return l(),v("div",va,[s("div",ba,[s("div",ya,[s("h2",null,m(((p=(d=r.dashboardScoreStats)==null?void 0:d.total_patients_today)!=null?p:[]).length||0),1),e[0]||(e[0]=s("p",null,"Total patients today",-1))]),s("div",Da,[s("h2",null,m(((f=(y=r.dashboardScoreStats)==null?void 0:y.waiting_for_vitals)!=null?f:[]).length||0),1),e[1]||(e[1]=s("p",null,"Waiting for vitals",-1))]),s("div",Ca,[s("h2",null,m(((C=(u=r.dashboardScoreStats)==null?void 0:u.waiting_for_consultation)!=null?C:[]).length||0),1),e[2]||(e[2]=s("p",null,"Waiting for consultation",-1))]),s("div",$a,[s("h2",null,m(((D=(_=r.dashboardScoreStats)==null?void 0:_.waiting_for_dispensation)!=null?D:[]).length||0),1),e[3]||(e[3]=s("p",null,"Waiting for dispensation",-1))])]),s("div",wa,[e[7]||(e[7]=s("div",{class:"chart-section"},[s("h3",null,"Total visits/incomplete visits: last 5 days"),s("canvas",{id:"myChart"})],-1)),s("div",Sa,[e[6]||(e[6]=s("h3",null,"Encounters created today",-1)),s("table",ka,[e[5]||(e[5]=s("thead",null,[s("tr",null,[s("th",null,"Encounters"),s("th",null,"Female"),s("th",null,"Male"),s("th",null,"Me"),s("th",null,"Facility Total")])],-1)),r.rows.length?(l(),v("tbody",Ia,[(l(!0),v(O,null,L(r.rows,(g,n)=>(l(),v("tr",{key:n},[s("td",Pa,m(g.encounter),1),s("td",Aa,m(g.female),1),s("td",Ta,m(g.male),1),s("td",Oa,m(g.me),1),s("td",Na,m(g.facility),1)]))),128))])):(l(),v("tbody",Ra,e[4]||(e[4]=[s("tr",null,[s("td",{colspan:"5"},"Loading encounter stats...")],-1)])))])])])])}const La=V(ga,[["render",Va]]);class xa{constructor(){x(this,"socket",null);x(this,"channel","ImmunizationReportChannel");x(this,"isConnected",!1);x(this,"pendingFetch",null);x(this,"location_id");x(this,"initPromise");x(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});x(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});x(this,"onError",e=>{console.error("WebSocket error:",e),this.isConnected=!1});this.initPromise=this.init()}async init(){const e=localStorage.getItem("apiURL"),i=localStorage.getItem("apiPort"),r=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const h="".concat(r,"://").concat(e,"/api/v1/cable");this.socket=new WebSocket(h),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(h){console.error(h),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const e={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(e))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await N.getJson("immunization/stats",{start_date:w.getDateBeforeByDays(w.sessionDate(),365),end_date:w.sessionDate()})}async setMessageHandler(e){await this.initPromise,this.socket?this.socket.onmessage=i=>{e(i)}:console.error("WebSocket connection not established.")}}const Ba=R({components:{IonContent:E,IonHeader:F,IonItem:J,IonList:H,IonMenu:q,IonTitle:Q,IonToolbar:M,IonInput:ft,BasicInputField:Mt,BasicForm:Z,PreviousVitals:jt,customDatePicker:Yt,IonCol:et,IonRow:st,VueMultiselect:xt,IonLabel:Lt,DataTable:vt},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:Dt,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:w.toStandardHisDisplayFormat(N.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...B(Fe,["administerOtherVaccine"]),...B(kt,["tempScannedBatchNumber"]),...B(j,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await Ue(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:_t,pulseOutline:Ft,clipboardOutline:Bt}},methods:{formatBirthdate(t){return w.getBirthdateAge(t)},async openClientProfile(t){const e=await Y.findByID(t);await j().setPatientRecord(e),this.$router.push("patientProfile")},processData(){var e;return((e=this.data)==null?void 0:e.map(i=>{if(i.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let r=[];const h=b=>b.map(p=>{let y=0;return p.clients.map(f=>{(p.drug_name==this.drug_name&&(this.village==f.table.city_village||this.village=="All")||(p.drug_name==this.drug_name||this.village==f.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:f.table.given_name,family_name:f.table.family_name,patient_id:f.table.patient_id,birthdate:f.table.birthdate,city_village:f.table.city_village}),y++),this.villageList.push(f.table.city_village)}),[p.drug_name,y]}).filter(p=>p[1]!==0);return this.title=="Client due today"&&(r=h(i.value.due_today_antigens)),this.title=="Client due this week"&&(r=h(i.value.due_this_week_antigens)),this.title=="Client due this month"&&(r=h(i.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(r=h(i.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(r=h(i.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(b=>JSON.stringify(b)))].map(b=>JSON.parse(b)),this.villageList=[...new Set(this.villageList)],r}}))[0]},handleVillageClick(t){this.drug_name="",this.village=t,this.tableData=this.processData()},handleRowClick(t){var i;this.tableEvent=t.target;const e=this.tableEvent.closest("tr");if(e){const r=Array.from(((i=e.parentNode)==null?void 0:i.children)||[]).indexOf(e),h=this.tableData[r];this.drug_name=h[0],e.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(t){return w.calculateDisplayAge(t)},openPopover(t){this.event=t,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(t){var i;const e=t.target.value;this.batchNumber=e||((i=this.tempScannedBatchNumber)==null?void 0:i.text)||""},saveBatchWithTodayDate(){let t=N.getSessionDate();this.saveDta(t)},dismiss(){bt.dismiss()},saveBatch(){let t;it.isEmpty(this.vaccineDate)==!0?t=N.getSessionDate():t=this.vaccineDate,this.saveDta(t)},validateVaccineName(){if(it.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(it.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(t){this.currentDrugOb=t},isAlphaNumeric(t){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(t)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(t){this.batchNumber=t},saveDta(t){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){St("Enter batch number!");return}if(this.batchNumber==""){St("Enter batch number!");return}const e={batch_number:this.batchNumber,date_administered:t,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},i=kt();i.setAdministeredVaccine(e),Ee(this.patient),this.dismiss(),i.setTempScannedBatchNumber(null)}}}),Fa={key:0,class:"spinner-overlay"},Ea={class:"header position_content"},Ua={style:{"font-size":"1.2em","font-weight":"700"}},Ma={class:"dueCardContent"},Wa=["onClick"],za={style:{"margin-right":"15px"}},Ha={style:{"align-items":"center",display:"flex"}},Ja={style:{"line-height":"1"}},Ga={class:"client_name"},ja={class:"name"},Ya={class:"demographicsOtherRow"},Qa={class:"demographicsText"};function qa(t,e,i,r,h,b){const d=c("ion-spinner"),p=c("ion-icon"),y=c("ion-header"),f=c("ion-card-title"),u=c("ion-card-header"),C=c("DataTable"),_=c("ion-card-content"),D=c("ion-card"),g=c("ion-item"),n=c("ion-list"),$=c("ion-popover"),k=c("ion-content");return l(),v(O,null,[t.isLoading?(l(),v("div",Fa,[a(d,{name:"bubbles"}),e[3]||(e[3]=s("div",{class:"loading-text"},"Please wait...",-1))])):S("",!0),a(y,null,{default:o(()=>[s("div",Ea,[s("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=I=>t.dismiss())},[a(p,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),s("div",Ua,m(t.title),1),s("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=I=>t.openPopover(I))},[a(p,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(k,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:o(()=>[s("div",null,[a(D,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:o(()=>[a(u,null,{default:o(()=>[a(f,{class:"sectionTitle"},{default:o(()=>e[4]||(e[4]=[A(" Summary of required doses ")])),_:1,__:[4]})]),_:1}),a(_,null,{default:o(()=>[s("div",Ma,[a(C,{options:t.options,data:t.tableData,class:"display nowrap",width:"100%",onClick:t.handleRowClick},{default:o(()=>e[5]||(e[5]=[s("thead",null,[s("tr",null,[s("th",null,"Vaccine"),s("th",null,"Quantity")])],-1)])),_:1,__:[5]},8,["options","data","onClick"])])]),_:1})]),_:1}),a(D,{class:"section",style:{"margin-inline":"0px"}},{default:o(()=>[a(u,null,{default:o(()=>[a(f,{class:"sectionTitle"},{default:o(()=>e[6]||(e[6]=[A("Client Details ")])),_:1,__:[6]})]),_:1}),a(_,null,{default:o(()=>[(l(!0),v(O,null,L(t.clientDetails,(I,ut)=>(l(),v("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:ut,onClick:Qt=>t.openClientProfile(I.patient_id)},[s("div",za,[s("div",{class:U((I==null?void 0:I.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(p,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),s("div",Ha,[s("div",Ja,[s("div",Ga,[s("div",ja,m(I.given_name)+" "+m(I.family_name),1)]),s("div",Ya,[s("div",Qa,[A(m(I.gender=="M"?"Male":"Female")+" ",1),e[7]||(e[7]=s("span",{class:"dot"},".",-1)),A(m(t.formatBirthdate(I.birthdate)),1)])]),s("div",null,"Village: "+m(I.city_village),1)])])],8,Wa))),128))]),_:1})]),_:1})]),a($,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:t.event,onDidDismiss:e[2]||(e[2]=I=>t.popoverOpen=!1)},{default:o(()=>[s("div",null,[e[8]||(e[8]=s("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(l(!0),v(O,null,L(t.villageList,(I,ut)=>(l(),P(n,{class:U(I==t.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:ut},{default:o(()=>[a(g,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:Qt=>t.handleVillageClick(I)},{default:o(()=>[A(m(I),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const Za=V(Ba,[["render",qa],["__scopeId","data-v-2b76e9ce"]]),Xa=R({name:"Menu",mixins:[tt],components:{IonContent:E,IonHeader:F,IonItem:J,IonList:H,IonMenu:q,IonTitle:Q,IonToolbar:M,IonCheckbox:at,BasicForm:Z,BasicCard:ot,Carousel:be,Slide:ve,Pagination:ge,Navigation:_e},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},computed:{...B(nt,["substance"]),backgroundStyle(){return{background:"linear-gradient(180deg, rgba(150, 152, 152, 0.7) 0%, rgba(255, 255, 255, 0.9) 100%), url(".concat(Me("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",height:"22.8vh"}}},watch:{},async mounted(){new xa().setMessageHandler(this.onMessage)},methods:{async onMessage(t){var i,r,h;const e=JSON.parse(t.data);e.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=e.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((i=this.reportData)==null?void 0:i.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((r=this.reportData)==null?void 0:r.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((h=this.reportData)==null?void 0:h.total_male_vaccinated_this_year)||0}])},openDueModal(t){const e={title:t,dashBoardData:this.reportData};mt(Za,{class:"fullScreenModal"},!0,e)},async openClientProfile(t){const e=await Y.findByNpid(t);await j().setPatientRecord(e[0]),this.$router.push("patientProfile")}}}),Ka={class:"topStats"},tn={class:"totalStats",style:{background:"linear-gradient(180deg, #20b2aa 0%, #40c0b0 50%, rgb(233, 233, 233) 100%)"}},en={class:"statsValue",style:{"font-size":"1.4em"}},sn={class:"statsText",style:{"font-size":"0.9em"}},an={class:"dueCardContent"},nn={class:"statsValue"},on={class:"statsValue"},rn={class:"statsValue"},ln={class:"overDueCardContent"},dn={class:"statsValue"},cn={class:"statsValue"},un=["onClick"],pn={style:{"margin-right":"15px"}},mn={style:{"align-items":"center",display:"flex"}},hn={style:{"line-height":"1"}},fn={class:"client_name"},_n={class:"name"},gn={class:"demographicsOtherRow"},vn={class:"demographicsText"};function bn(t,e,i,r,h,b){const d=c("Slide"),p=c("Pagination"),y=c("Carousel"),f=c("ion-card-title"),u=c("ion-card-header"),C=c("ion-card-content"),_=c("ion-card"),D=c("ion-icon"),g=c("ion-content");return l(),P(g,{class:"content"},{default:o(()=>[s("div",Ka,[s("div",null,[s("div",{style:z(t.backgroundStyle)},[a(y,{autoplay:4e3,"wrap-around":!0,itemsToShow:1.2,transition:600,style:{"padding-top":"20px"}},{addons:o(()=>[a(p)]),default:o(()=>[(l(!0),v(O,null,L(t.totalStats,n=>(l(),P(d,{key:n},{default:o(()=>[s("div",tn,[s("div",en,m(n.value),1),s("div",sn,m(n.name),1)])]),_:2},1024))),128))]),_:1})],4)]),a(_,{class:"section"},{default:o(()=>[a(u,null,{default:o(()=>[a(f,{class:"cardTitle"},{default:o(()=>e[5]||(e[5]=[A(" Clients due ")])),_:1,__:[5]})]),_:1}),a(C,null,{default:o(()=>{var n,$,k;return[s("div",an,[s("div",{class:"dueCard",onClick:e[0]||(e[0]=I=>t.openDueModal("Client due today")),style:{border:"1px solid rgb(158, 207, 136)"}},[s("div",nn,m(((n=t.reportData)==null?void 0:n.due_today_count)||0),1),e[6]||(e[6]=s("div",{class:"statsText"},"Due today",-1))]),s("div",{class:"dueCard",style:{border:"1px solid rgb(239, 221, 121)"},onClick:e[1]||(e[1]=I=>t.openDueModal("Client due this week"))},[s("div",on,m((($=t.reportData)==null?void 0:$.due_this_week_count)||0),1),e[7]||(e[7]=s("div",{class:"statsText"},"Due this week",-1))]),s("div",{class:"dueCard",style:{border:"1px solid rgb(241, 154, 154)"},onClick:e[2]||(e[2]=I=>t.openDueModal("Client due this month"))},[s("div",rn,m(((k=t.reportData)==null?void 0:k.due_this_month_count)||0),1),e[8]||(e[8]=s("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),a(_,{class:"section"},{default:o(()=>[a(u,null,{default:o(()=>[a(f,{class:"cardTitle"},{default:o(()=>e[9]||(e[9]=[A(" Clients overdue ")])),_:1,__:[9]})]),_:1}),a(C,null,{default:o(()=>{var n,$;return[s("div",ln,[s("div",{class:"overDueCard",onClick:e[3]||(e[3]=k=>t.openDueModal("Client overdue under 5yrs"))},[s("div",dn,m(((n=t.reportData)==null?void 0:n.under_five_overdue)||0),1),e[10]||(e[10]=s("div",{class:"statsText"},"Under 5yrs",-1))]),s("div",{class:"overDueCard",onClick:e[4]||(e[4]=k=>t.openDueModal("Client overdue over 5yrs"))},[s("div",cn,m((($=t.reportData)==null?void 0:$.over_five_overdue)||0),1),e[11]||(e[11]=s("div",{class:"statsText"},"Over 5yrs",-1))])])]}),_:1})]),_:1}),a(_,{class:"section"},{default:o(()=>[a(u,null,{default:o(()=>[a(f,{class:"cardTitle"},{default:o(()=>{var n;return[A("Today's appointments("+m((n=t.appointments)==null?void 0:n.length)+") ",1)]}),_:1})]),_:1}),a(C,null,{default:o(()=>[(l(!0),v(O,null,L(t.appointments,(n,$)=>(l(),v("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:$,onClick:k=>t.openClientProfile(n.npid)},[s("div",pn,[s("div",{class:U(n.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(D,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),s("div",mn,[s("div",hn,[s("div",fn,[s("div",_n,m(n.given_name)+" "+m(n.family_name),1)]),s("div",gn,[s("div",vn,[A(m(n.gender=="M"?"Male":"Female")+" ",1),e[12]||(e[12]=s("span",{class:"dot"},".",-1)),A(m(t.formatBirthdate(n.birthdate)),1)])]),s("div",null,"Village: "+m(n==null?void 0:n.city_village),1)])])],8,un))),128))]),_:1})]),_:1})])]),_:1})}const yn=V(Xa,[["render",bn],["__scopeId","data-v-a8eeb2dc"]]),Dn=R({components:{IonContent:E,IonHeader:F,IonItem:J,IonList:H,IonMenu:q,IonTitle:Q,IonToolbar:M,IonInput:ft,BasicInputField:Mt,BasicForm:Z,PreviousVitals:jt,customDatePicker:Yt,IonCol:et,IonRow:st,VueMultiselect:xt,IonLabel:Lt,DataTable:vt},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:Dt,showPD:!1,batchNumber:"",clientDetails:[],dueData:[],workerStore:Wt(),sessionDate:w.toStandardHisDisplayFormat(N.getSessionDate()),showDateBtns:!0,patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:t=>this.waitingTime(t)},{title:"Actions",data:null,render:(t,e,i)=>{const r=document.createElement("div"),h=document.createElement("ion-button");h.innerText=this.buttonTitle,h.size="small",h.classList.add("btn-edit"),h.style.color="#fff",h.style.marginRight="8px",h.addEventListener("click",()=>this.navigateTo(i.patient_id,this.buttonLink)),r.appendChild(h);const b=document.createElement("ion-button");b.innerText="Profile",b.size="small",b.classList.add("btn-edit"),b.style.color="#fd7e14",b.style.marginRight="8px",b.addEventListener("click",()=>this.navigateTo(i.patient_id,"/patientProfile")),r.appendChild(b);const d=document.createElement("ion-button");return d.innerText="Abscond",d.size="small",d.classList.add("btn-edit"),d.style.color="#dc3545",d.style.marginRight="8px",d.addEventListener("click",()=>this.handleAbscond(i)),r.appendChild(d),r},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]]}}},props:{title:{default:[]},list:{default:""},buttonTitle:{default:""},buttonLink:{default:""}},computed:{...B(dt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","counter"])},async mounted(){this.setList()},watch:{patientsWaitingForConsultation:{handler(t){this.list==="CONSULTATION"&&(this.patients=t)},deep:!0},patientsWaitingForVitals:{handler(t){this.list==="VITALS"&&(this.patients=t)},deep:!0},patientsWaitingForLab:{handler(t){this.list==="LAB"&&(this.patients=t)},deep:!0},patientsWaitingForDispensation:{handler(t){this.list==="DISPENSATION"&&(this.patients=t)},deep:!0},counter:{handler(){this.setList()}}},setup(){return{person:_t,pulseOutline:Ft,clipboardOutline:Bt}},methods:{openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){bt.dismiss()},async navigateTo(t,e){const i=await Y.findByID(t);await j().setPatientRecord(i),this.$router.push(e)},async handleAbscond(t){try{const e=await Ct(),i=e?e.code:null;await $t.checkOutPatient(t.visit_id,w.todayDateFormatted()),this.patients=this.patients.filter(r=>r.patient_id!==t.patient_id),Te("Patient absconded successfully."),await dt().refresh(i)}catch(e){Oe("Failed to abscond patient.")}},setList(){const t={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation};this.patients=t[this.list]||[]},waitingTime(t){return w.calculateTimeDifference(t)}}}),Cn={key:0,class:"spinner-overlay"},$n={class:"header position_content"},wn={style:{"font-size":"1.2em","font-weight":"700"}},Sn={class:"dueCardContent"};function kn(t,e,i,r,h,b){const d=c("ion-spinner"),p=c("ion-icon"),y=c("ion-header"),f=c("ion-card-title"),u=c("ion-card-header"),C=c("DataTable"),_=c("ion-card-content"),D=c("ion-card"),g=c("ion-content");return l(),v(O,null,[e[3]||(e[3]=A(" Spinner ")),t.isLoading?(l(),v("div",Cn,[a(d,{name:"bubbles"}),e[2]||(e[2]=s("div",{class:"loading-text"},"Please wait...",-1))])):S("",!0),a(y,null,{default:o(()=>[s("div",$n,[s("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=(...n)=>t.dismiss&&t.dismiss(...n))},[a(p,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),s("div",wn,m(t.title),1),s("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=n=>t.openPopover(n))},[a(p,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(g,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:o(()=>[s("div",null,[a(D,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:o(()=>[a(u,null,{default:o(()=>[a(f,{class:"sectionTitle"})]),_:1}),a(_,null,{default:o(()=>[s("div",Sn,[a(C,{data:t.patients,columns:t.tableColumns,options:t.tableOptions,class:"display nowrap",width:"100%"},null,8,["data","columns","options"])])]),_:1})]),_:1})])]),_:1})],64)}const In=V(Dn,[["render",kn],["__scopeId","data-v-ec4c9422"]]),Pn=R({components:{IonRow:st,IonCol:et,IonContent:E,IonHeader:F,IonItem:J,IonList:H,IonIcon:X,IonCard:Se,IonCardHeader:we,IonCardTitle:$e,IonCardContent:Ce,IonPopover:De,DataTable:vt,IonSpinner:ye},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:Dt,patientList:[],patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Service Time",data:"arrivalTime",render:t=>this.formatArrivalTime(t)},{title:"Actions",data:null,render:(t,e,i)=>{const r=document.createElement("div"),h=document.createElement("ion-button");return h.innerText="Profile",h.size="small",h.style.color="#fff",h.style.padding="8px 12px",h.style.marginRight="8px",h.addEventListener("click",()=>this.navigateTo(i.patient_id,"/patientProfile")),r.appendChild(h),r},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,dom:"Bfrtip",order:[[1,"asc"]]}}},props:{title:{default:"Patient List"}},async mounted(){this.isLoading=!0;try{const t=await Ct(),e=t?t.code:null,r=(await $t.getAllPatientsVisitsToday()).filter(h=>h.location_id===e);this.patients=await Promise.all(r.map(async h=>{const b=await Y.findByID(h.patientId);if(b&&b.person){const d=b.person.names;return{fullName:d&&d.length>0?"".concat(d[0].given_name||""," ").concat(d[0].family_name||"").trim():"Unknown",arrivalTime:h.startDate,patient_id:h.patientId}}else return{fullName:"Unknown",arrivalTime:h.startDate,patient_id:h.patientId}}))}catch(t){console.error("Error fetching patients:",t)}finally{this.isLoading=!1}},methods:{openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){bt.dismiss()},async navigateTo(t,e){const i=await Y.findByID(t);await j().setPatientRecord(i),this.$router.push(e)},formatArrivalTime(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}}}),An={class:"header position_content"},Tn={style:{"font-size":"1.2em","font-weight":"700"}},On={class:"dueCardContent"};function Nn(t,e,i,r,h,b){const d=c("ion-icon"),p=c("ion-header"),y=c("DataTable"),f=c("ion-card-content"),u=c("ion-card"),C=c("ion-item"),_=c("ion-list"),D=c("ion-popover"),g=c("ion-content");return l(),v(O,null,[a(p,null,{default:o(()=>[s("div",An,[s("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=(...n)=>t.dismiss&&t.dismiss(...n))},[a(d,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),s("div",Tn,m(t.title),1),s("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=n=>t.openPopover(n))},[a(d,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(g,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:o(()=>[s("div",null,[a(u,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:o(()=>[a(f,null,{default:o(()=>[s("div",On,[a(y,{data:t.patients,columns:t.tableColumns,options:t.tableOptions,class:"display nowrap",width:"100%"},null,8,["data","columns","options"])])]),_:1})]),_:1})]),a(D,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:t.event,onDidDismiss:e[2]||(e[2]=n=>t.popoverOpen=!1)},{default:o(()=>[s("div",null,[a(_,{style:{"--ion-background-color":"#fff","--offset-x":"-30px"}},{default:o(()=>[a(C,{button:!0,detail:!1,style:{cursor:"pointer"}})]),_:1})])]),_:1},8,["is-open","event"])]),_:1})],64)}const Rn=V(Pn,[["render",Nn],["__scopeId","data-v-79afebaf"]]),Vn=R({name:"OPD Dashboard",mixins:[tt],components:{IonContent:E,IonHeader:F,IonItem:J,IonList:H,IonMenu:q,IonTitle:Q,IonToolbar:M,IonCheckbox:at,BasicForm:Z,BasicCard:ot,FacilityReports:We},data(){return{totalPatientsToday:0,canViewVitals:!1,canViewConsultation:!1,canViewLab:!1,canViewDispensation:!1,userRoles:[],showReports:!1}},computed:{...B(dt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{$route:{async handler(t){await this.fetchUserData()},deep:!0}},async mounted(){const t=await Ct(),e=t?t.code:null;try{const r=(await $t.getAllPatientsVisitsToday()).filter(h=>h.location_id===e);this.totalPatientsToday=r.length,await dt().refresh(e)}catch(i){}await this.fetchUserData()},methods:{toggleReports(){this.showReports=!this.showReports,this.showReports&&setTimeout(()=>{const t=document.getElementById("reports-section");t&&t.scrollIntoView({behavior:"smooth"})},100)},async fetchUserData(){const t=await wt.getCurrentUser();t&&(this.userRoles=t.roles.map(e=>e.role),this.updateCardVisibility())},updateCardVisibility(){this.canViewVitals=this.isUserRole("Clinician")||this.isUserRole("Nurse")||this.isUserRole("Superuser"),this.canViewConsultation=this.isUserRole("Clinician")||this.isUserRole("Superuser"),this.canViewLab=this.isUserRole("Lab"),this.canViewDispensation=this.isUserRole("Clinician")||this.isUserRole("Pharmacist")||this.isUserRole("Superuser")},isUserRole(t){return this.userRoles.includes(t)},openAllModal(t,e,i){mt(Rn,{class:"fullScreenModal"},!0,{title:t,buttonLink:e,buttonTitle:i})},dueCardStyle(t){const e={success:"rgb(158, 207, 136)",warning:"rgb(239, 221, 121)",info:"rgb(144, 202, 249)",danger:"rgb(241, 154, 154)"};return{border:"1px solid ".concat(e[t]),padding:"20px",margin:"10px"}},openPatientsListModal(t,e,i,r){mt(In,{class:"fullScreenModal"},!0,{title:t,list:e,buttonTitle:i,buttonLink:r})}}}),Ln={id:"containertwo"},xn={class:"centered-content OPDDueCardWrapper"},Bn={class:"OPDDueCardContent"},Fn={class:"OPDStatsValue"},En={class:"OPDStatsValue"},Un={class:"OPDStatsValue"},Mn={class:"OPDStatsValue"},Wn={class:"OPDStatsValue"};function zn(t,e,i,r,h,b){const d=c("ion-card-title"),p=c("ion-card-header"),y=c("ion-icon"),f=c("ion-card-content"),u=c("ion-card"),C=c("ion-content");return l(),P(C,{fullscreen:!0},{default:o(()=>[s("div",Ln,[s("div",xn,[a(u,{class:"section",style:{width:"80%"}},{default:o(()=>[a(p,null,{default:o(()=>[a(d,{class:"cardTitle"},{default:o(()=>e[5]||(e[5]=[A("Today's patients list")])),_:1,__:[5]})]),_:1}),a(f,null,{default:o(()=>[s("div",Bn,[s("div",{class:"OPDDueCard",onClick:e[0]||(e[0]=_=>t.openAllModal("All patients today","View profile","/patientProfile")),style:z(t.dueCardStyle("success"))},[a(y,{icon:t.people,class:"dueCardIcon"},null,8,["icon"]),s("div",Fn,m(t.totalPatientsToday),1),e[6]||(e[6]=s("div",{class:"OPDStatsText"},"Total patients today",-1))],4),t.canViewVitals?(l(),v("div",{key:0,class:"OPDDueCard",onClick:e[1]||(e[1]=_=>t.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals")),style:z(t.dueCardStyle("success"))},[a(y,{icon:t.thermometer,class:"dueCardIcon"},null,8,["icon"]),s("div",En,m(t.patientsWaitingForVitals.length),1),e[7]||(e[7]=s("div",{class:"OPDStatsText"},"Waiting for vitals",-1))],4)):S("",!0),t.canViewConsultation?(l(),v("div",{key:1,class:"OPDDueCard",onClick:e[2]||(e[2]=_=>t.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan")),style:z(t.dueCardStyle("success"))},[a(y,{icon:t.clipboard,class:"dueCardIcon"},null,8,["icon"]),s("div",Un,m(t.patientsWaitingForConsultation.length),1),e[8]||(e[8]=s("div",{class:"OPDStatsText"},"Waiting for consultation",-1))],4)):S("",!0),t.canViewLab?(l(),v("div",{key:2,class:"OPDDueCard",onClick:e[3]||(e[3]=_=>t.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan")),style:z(t.dueCardStyle("success"))},[a(y,{icon:t.clipboard,class:"dueCardIcon"},null,8,["icon"]),s("div",Mn,m(t.patientsWaitingForLab.length),1),e[9]||(e[9]=s("div",{class:"OPDStatsText"},"Waiting for lab",-1))],4)):S("",!0),t.canViewDispensation?(l(),v("div",{key:3,class:"OPDDueCard",onClick:e[4]||(e[4]=_=>t.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations")),style:z(t.dueCardStyle("success"))},[a(y,{icon:t.medkit,class:"dueCardIcon"},null,8,["icon"]),s("div",Wn,m(t.patientsWaitingForDispensation.length),1),e[10]||(e[10]=s("div",{class:"OPDStatsText"},"Waiting for dispensation",-1))],4)):S("",!0)])]),_:1})]),_:1})])])]),_:1})}const Hn=V(Vn,[["render",zn],["__scopeId","data-v-08236ccc"]]),Jn=R({name:"NCDDashboard",mixins:[tt],components:{ApexChart:Ht},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await Tt(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return N.getJson("programs/32/reports/ncd_dashboard",{start_date:w.toStandardHisFormat(w.sessionDate()),end_date:w.toStandardHisFormat(w.sessionDate())})}}}),Gn={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},jn={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},Yn={ref:"chartRef1"},Qn={ref:"chartRef2"};function qn(t,e,i,r,h,b){const d=c("ion-card-content"),p=c("ion-card"),y=c("ApexChart");return l(),v(O,null,[s("div",Gn,[a(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(d,null,{default:o(()=>e[0]||(e[0]=[s("div",{class:"top-card-text"},[s("div",{class:"text-2xl font-bold"},"0"),s("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])),_:1,__:[0]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(d,null,{default:o(()=>e[1]||(e[1]=[s("div",{class:"top-card-text"},[s("div",{class:"text-2xl font-bold"},"0"),s("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])),_:1,__:[1]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(d,null,{default:o(()=>e[2]||(e[2]=[s("div",{class:"top-card-text"},[s("div",{class:"text-2xl font-bold"},"0"),s("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])),_:1,__:[2]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(d,null,{default:o(()=>e[3]||(e[3]=[s("div",{class:"top-card-text"},[s("div",{class:"text-2xl font-bold"},"0"),s("h3",{class:"text-sm font-medium"},"Due this week")],-1)])),_:1,__:[3]})]),_:1})]),s("div",jn,[a(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(d,null,{default:o(()=>[e[4]||(e[4]=s("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),s("div",Yn,[t.isChartReady?(l(),P(y,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1,__:[4]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(d,null,{default:o(()=>[e[5]||(e[5]=s("div",{class:"font-medium"},"Patients distribution by age",-1)),s("div",Qn,[t.isChartReady?(l(),P(y,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1,__:[5]})]),_:1})])],64)}const Zn=V(Jn,[["render",qn],["__scopeId","data-v-58e2a3d8"]]),Xn=R({name:"Home",mixins:[Et,tt],components:{IonContent:E,IonHeader:F,IonPage:gt,IonToolbar:M,Toolbar:zt,IonRow:st,DateInputField:Gt,IonIcon:X,IonButton:Ot,IonCol:et},data(){const t=T(w.sessionDate()),e=T(w.sessionDate()),i=T(w.sessionDate()),r=T([]);return{segmentContent:"Today",minDate:i,startDate:t,endDate:e,people:r,calendarOutline:ct,eyeOutline:ke}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(t){this.segmentContent=t},formatBirthdate(t){return w.getBirthdateAge(t)},async getAppointments(){this.people=[],(await Jt.getAppointments(this.startDate,this.endDate,"")).forEach(e=>{const i={person_id:e.person_id,npid:e.npid,appointment_id:103,encounter_id:e.encounter_id,name:e.given_name.concat(" ",e.family_name),gender:e.gender,ageDob:this.formatBirthdate(e.birthdate),village:e.city_village,appointmentDate:w.toStandardHisDisplayFormat(e.appointment_date)};this.people.push(i)})},async getAppointmentsD1(t){this.startDate=w.toStandardHisFormat(t),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=w.toStandardHisFormat(t),await this.getAppointments()},async openClientProfile(t){await Y.findByNpid(t),this.isPharmacist()},isPharmacist(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(i=>e.some(r=>r.role==="Pharmacist"))&&(this.$router.push("dispensation"),N.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),Kn={class:"appointments-container"},to={key:0,class:"date-filter"},eo={class:"appointments-table"};function so(t,e,i,r,h,b){const d=c("ion-label"),p=c("ion-segment-button"),y=c("ion-segment"),f=c("DateInputField"),u=c("ion-col"),C=c("ion-row"),_=c("ion-icon"),D=c("ion-button"),g=c("ion-card");return l(),v("div",Kn,[s("div",null,[a(y,{value:t.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:o(()=>[a(p,{value:"Today",onClick:e[0]||(e[0]=n=>t.setSegmentContent("Today"))},{default:o(()=>[a(d,null,{default:o(()=>e[3]||(e[3]=[A("Today")])),_:1,__:[3]})]),_:1}),a(p,{value:"Tomorrow",onClick:e[1]||(e[1]=n=>t.setSegmentContent("Tomorrow"))},{default:o(()=>[a(d,null,{default:o(()=>e[4]||(e[4]=[A("Tomorrow")])),_:1,__:[4]})]),_:1}),a(p,{value:"Date range",onClick:e[2]||(e[2]=n=>t.setSegmentContent("Date range"))},{default:o(()=>[a(d,null,{default:o(()=>e[5]||(e[5]=[A("Date range")])),_:1,__:[5]})]),_:1})]),_:1},8,["value"])]),t.segmentContent==="Date range"?(l(),v("div",to,[a(C,null,{default:o(()=>[a(u,null,{default:o(()=>[a(f,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(u,null,{default:o(()=>[a(f,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):S("",!0),t.people.length>0?(l(),P(g,{key:1},{default:o(()=>[s("table",eo,[e[6]||(e[6]=s("thead",null,[s("tr",null,[s("th",null,"Name"),s("th",null,"NPID"),s("th",null,"Age/DOB"),s("th",null,"Gender"),s("th",null,"Village"),s("th",null,"Appointment Date")])],-1)),s("tbody",null,[(l(!0),v(O,null,L(t.people,n=>(l(),v("tr",{key:n.npid},[s("td",null,[a(C,null,{default:o(()=>[a(u,null,{default:o(()=>[A(m(n.name),1)]),_:2},1024),a(u,null,{default:o(()=>[a(D,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:$=>t.openClientProfile(n.npid),color:"primary",fill:"clear",size:"small"},{default:o(()=>[a(_,{icon:t.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),s("td",null,m(n.npid),1),s("td",null,m(n.ageDob),1),s("td",null,m(n.gender),1),s("td",null,m(n.village),1),s("td",null,m(n.appointmentDate),1)]))),128))])])]),_:1})):(l(),P(g,{key:2},{default:o(()=>e[7]||(e[7]=[s("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])),_:1,__:[7]}))])}const ao=V(Xn,[["render",so],["__scopeId","data-v-c47f7768"]]),no=R({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){}}}),oo={key:0},io={style:{display:"flex","margin-top":"10px"}},ro={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},lo={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},co={key:1};function uo(t,e,i,r,h,b){const d=c("ion-label"),p=c("ion-segment-button"),y=c("ion-segment"),f=c("VisitsHistory");return l(),v(O,null,[s("div",null,[a(y,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:o(()=>[a(p,{value:"Internal referrals",onClick:e[0]||(e[0]=u=>t.setSegmentContent("Internal referrals"))},{default:o(()=>[a(d,null,{default:o(()=>e[2]||(e[2]=[A("Internal referrals")])),_:1,__:[2]})]),_:1}),a(p,{value:"External referrals",onClick:e[1]||(e[1]=u=>t.setSegmentContent("External referrals"))},{default:o(()=>[a(d,null,{default:o(()=>e[3]||(e[3]=[A("External referrals")])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(l(),v("div",oo,[s("div",io,[t.checkUnderFive?(l(),v("div",ro)):S("",!0),e[4]||(e[4]=s("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?S("",!0):(l(),v("div",lo))])])):S("",!0),t.segmentContent=="External referrals"?(l(),v("div",co,[a(f)])):S("",!0)],64)}const po=V(no,[["render",uo],["__scopeId","data-v-faad8f8b"]]),mo=R({name:"Menu",components:{IonContent:E,IonHeader:F,IonItem:J,IonList:H,IonMenu:q,IonTitle:Q,IonToolbar:M,IonCheckbox:at,IonIcon:X,BasicForm:Z,BasicCard:ot,Referrals:po,Dashboard:Zn,ANCAppointments:ao},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:Rt},{id:"referrals",label:"Referrals",icon:Vt},{id:"appointments",label:"Appointments",icon:ct}],activeItem:"dashboard"}},computed:{...B(nt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),ho={style:{display:"flex"}},fo={class:"left_col"},_o={class:"nav-menu"},go=["onClick"],vo={class:"right_col"};function bo(t,e,i,r,h,b){const d=c("ion-icon"),p=c("Dashboard"),y=c("ANCAppointments"),f=c("Referrals");return l(),v("div",ho,[s("div",fo,[s("nav",_o,[s("ul",null,[(l(!0),v(O,null,L(t.menuItems,u=>(l(),v("li",{key:u.id,class:U({active:t.activeItem===u.id}),onClick:C=>t.setActiveItem(u.id)},[a(d,{icon:u.icon,size:"large",class:"menu-icon"},null,8,["icon"]),s("span",null,m(u.label),1)],10,go))),128))])])]),s("div",vo,[s("div",null,[t.activeItem==="dashboard"?(l(),P(p,{key:0})):S("",!0),t.activeItem==="appointments"?(l(),P(y,{key:1})):S("",!0),t.activeItem==="referrals"?(l(),P(f,{key:2})):S("",!0)])])])}const yo=V(mo,[["render",bo],["__scopeId","data-v-7e786ea4"]]),Do=R({name:"Menu",components:{IonContent:E,IonHeader:F,IonItem:J,IonList:H,IonMenu:q,IonTitle:Q,IonToolbar:M,IonCheckbox:at,BasicForm:Z,BasicCard:ot},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...B(nt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Co={class:"left_col"},$o={class:"nav-menu"},wo=["onClick"];function So(t,e,i,r,h,b){return l(),v("div",null,[s("div",Co,[s("nav",$o,[s("ul",null,[(l(!0),v(O,null,L(t.menuItems,d=>(l(),v("li",{key:d.id,class:U({active:t.activeItem===d.id}),onClick:p=>t.setActiveItem(d.id)},m(d.label),11,wo))),128))])])]),e[0]||(e[0]=s("div",{class:"right_col"},null,-1))])}const ko=V(Do,[["render",So],["__scopeId","data-v-32dd02d3"]]),Io=R({name:"Menu",components:{IonContent:E,IonHeader:F,IonItem:J,IonList:H,IonMenu:q,IonTitle:Q,IonToolbar:M,IonCheckbox:at,BasicForm:Z,BasicCard:ot},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...B(nt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Po={class:"left_col"},Ao={class:"nav-menu"},To=["onClick"];function Oo(t,e,i,r,h,b){return l(),v("div",null,[s("div",Po,[s("nav",Ao,[s("ul",null,[(l(!0),v(O,null,L(t.menuItems,d=>(l(),v("li",{key:d.id,class:U({active:t.activeItem===d.id}),onClick:p=>t.setActiveItem(d.id)},m(d.label),11,To))),128))])])]),e[0]||(e[0]=s("div",{class:"right_col"},null,-1))])}const No=V(Io,[["render",Oo],["__scopeId","data-v-b49d8600"]]);function Ro(){const t=yt(),e=Ne(),i=T(!1),{OPDActivities:r,NCDActivities:h}=lt(e),b=async p=>{var y;try{const f=N.getUserID(),u=await wt.getJson("user_properties",{user_id:f,property:p});return u!=null&&u.property_value?(y=u==null?void 0:u.property_value)==null?void 0:y.split(","):[]}catch(f){return console.error("Error fetching user activities:",f),[]}},d=async()=>{try{i.value=!1;const[p,y]=await Promise.all([b("OPD_activities"),b("NCD_activities")]);p.length>0&&e.setOPDActivity(p),y.length>0&&e.setNCDActivity(y)}catch(p){console.error("Error updating activities:",p)}finally{i.value=!0}};return K(()=>t.path,async()=>{await d()},{immediate:!0,deep:!0}),{ready:i,OPDActivities:r,NCDActivities:h,getUserActivities:b,updateActivities:d}}function Vo(){const t=yt(),e=T(""),i=T(!1),r=T({}),h=()=>{const b=N.getUserRoles(),d=N.getProgramID(),p=N.getProgramName();e.value=b,i.value=!1,b==="Lab"&&d===14?r.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:d===14&&b!=="Lab"?r.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:d===12?r.value={url:"contact",btnName:"Back"}:p==="LABOUR AND DELIVERY PROGRAM"?r.value={url:"labour/labourHome",btnName:"Back to home"}:p==="PNC PROGRAM"?r.value={url:"pnc/home",btnName:"Back to home"}:r.value={url:"",btnName:""},i.value=!0};return K(()=>t.path,()=>{h()},{immediate:!0,deep:!0}),{userRole:e,ready:i,userRoleSettings:r,updateUserRoleSettings:h}}const Lo={key:0,class:"spinner-overlay"},li=R({__name:"HomePage",setup(t){const e=T(!0),i=yt(),r=Wt(),h=T(localStorage.getItem("sessionDate")||"");Vo();const b=Re(),{apiStatus:d}=lt(Ut()),{activeProgram:p}=lt(b),y=Nt(()=>{switch(p.value.program_id){case G.IMMUNIZATION_PROGRAM:return yn;case G.OPD_PROGRAM:return Hn;case G.NCD_PROGRAM:return ha;case G.ANC_PROGRAM:return yo;case G.PNC_PROGRAM:return No;case G.LABOUR_AND_DELIVERY_PROGRAM:return ko;case G.HIV_PROGRAM:return La;default:return null}}),f=()=>{const _=localStorage.getItem("sessionDate");(!_||_.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),pt()),h.value=_||""};let u=null;rt(()=>{u=()=>f(),window.addEventListener("storage",u);const _=setInterval(f,1e3);Ie(()=>{clearInterval(_),u&&window.removeEventListener("storage",u)}),f()}),K(h,(_,D)=>{(!_||_.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),pt())}),K(()=>i.name,async _=>{_==="Home"&&(It(),await Pt().loadGlobalProperty(),r.initWorker(),r.postData("SYNC_ALL_DATA"),await pt())},{immediate:!0,deep:!0});const C=async()=>{try{const _=N.getUserID(),D=await wt.getUserByID(_);if(D.location_id!=null){const g=await Le.getLocation(D.location_id);localStorage.setItem("locationData",JSON.stringify(g))}}catch(_){console.error("Failed to retrieve location data:",_)}};return d.value&&(Ro(),C()),rt(async()=>{try{e.value=!0,r.terminate(),It(),await Pt().loadGlobalProperty(),it.isEmpty(p.value)&&await Ve.show(ze,{},"module-picker-modal")}catch(_){console.error("Error initializing component:",_)}finally{e.value=!1}}),(_,D)=>{const g=c("ion-spinner"),n=c("ion-content");return l(),P(W(gt),null,{default:o(()=>[e.value?(l(),v("div",Lo,[a(g,{name:"bubbles"}),D[0]||(D[0]=s("div",{class:"loading-text"},"Please wait...",-1))])):S("",!0),a(zt),a(He),y.value?(l(),P(Pe(y.value),{key:1})):(l(),P(n,{key:2},{default:o(()=>D[1]||(D[1]=[s("div",{class:"container"},[s("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),s("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])),_:1,__:[1]}))]),_:1})}}});export{li as default};

import{Y as Q,P as B,a3 as z,aR as J,aS as K,aT as X,S as Y,aU as Z,aV as G,u as tt,t as j,_ as O,aW as et}from"./index-BUOqMZYn.js";import{b2 as R,r as W,X as L,d as N,c as nt,a as F,e as S,f as b,k as t,j as it,m as at,d3 as lt,dG as st,dH as ot,y as k,z as A,B as i,A as m,u as dt,F as rt,L as ut,dI as ct,dJ as vt}from"./vendor-IHO26Iap.js";import{l as q}from"./lodash-Dt8AsbQm.js";async function mt(e){const s=e.visits.visitsDates.map(a=>new Date(a)),o=new Date(Math.max(...s)),d=o.toISOString().split("T")[0],n="".concat(e.personInformation.given_name," ").concat(e.personInformation.family_name),l=[...e.vitals.saved||[],...e.vitals.unsaved||[]],c=[...e.diagnosis.saved||[],...e.diagnosis.unsaved||[]],u=[...e.MedicationOrder.saved||[],...e.MedicationOrder.unsaved||[]],r=[...e.labOrders.saved||[],...e.labOrders.unsaved||[]],v=l.filter(a=>new Date(a.obs_datetime).toDateString()===o.toDateString()),g=c.filter(a=>new Date(a.obs_datetime).toDateString()===o.toDateString()),_=u.filter(a=>new Date(a.encounter_date).toDateString()===o.toDateString()),f=r.filter(a=>new Date(a.order_date).toDateString()===o.toDateString()),D=f.length>0?f[0].requesting_clinician:void 0,I=e.appointments.saved.length>0?e.appointments.saved[0].value:void 0,x=await Promise.all(g.map(async a=>await Q.getConceptName(a.value_coded))),y=l.filter(a=>a.concept_name==="Height (cm)").sort((a,w)=>new Date(w.obs_datetime).getTime()-new Date(a.obs_datetime).getTime())[0],h=(a,w)=>{const p=v.find($=>$.concept_name==a);return(p==null?void 0:p.value_numeric)!==void 0?"".concat(p.value_numeric).concat(w):void 0},T=()=>{const a=new B().getBloodGlucose(e);if(a)return a.name+":"+a.value+a.unit};return{patientID:e.NcdID,patientName:n,latestVisitDate:d,gender:e.personInformation.gender,vitals:{height:"Ht:"+(y==null?void 0:y.value_numeric)+"cm",weight:"Wt"+h("Weight (kg)","kg"),bloodPressure:"Bp"+h("Systolic blood pressure","")+"/"+h("Diastolic blood pressure","")+"mmHg"},bloodGlucose:T(),diagnoses:x.length>0?x:void 0,medications:_.length>0?_.map(a=>({name:a.drug_name,dose:a.dose?"".concat(a.dose," ").concat(a.units||"").trim():void 0,frequency:a.frequency,quantity:a.equivalent_daily_dose,duration:a.expire_date&&a.start_date?Math.ceil((Number(new Date(a.expire_date))-Number(new Date(a.start_date)))/(1e3*60*60*24)):void 0})):void 0,labOrders:f.length>0?f.map(a=>({test:a.tests&&a.tests.length>0?a.tests[0].name:void 0,orderDate:a.order_date?new Date(a.order_date).toISOString().split("T")[0]:void 0,accessionNumber:a.accession_number})):void 0,prescriber:D,nextAppointment:I}}const C=W(!1);async function gt(){const e=new z;let s=await e.getDefaultPrinter();if(q.isEmpty(s)&&(s=await e.selectDefaultPrinter()),q.isEmpty(s))throw new Error("No printer device found");return s}async function bt(e,s){const o=J.updateUrlParamString(s,{raw:!0});K.emit(X.SHOW_MODAL,"zebra-modal"),console.time(s);const d=await Y.getText(o);if(!d)throw"Unable to print Label. Try again later";if((e==null?void 0:e.port)==="BT")return new z().printToBluetoothDevice(e,d);R.printLabel({eplCommands:d,name:e.name,address:e.address,url:await Z.expandPath(o)}),console.timeEnd(s),await G(2e3)}async function ft(e,s,o){if(!C.value){C.value=!0;try{const d=await mt(tt().patient),n=await L.create({id:"printout",component:s,backdropDismiss:!1,cssClass:"visit-modal",componentProps:{patient:d,imageOut:async l=>{var u;console.log("ðŸš€ ~ imageOut: ~ images:",l);const c=(u=o.copies)!=null?u:1;for(let r=0;r<c;++r){const v=l.map(g=>{console.log("ðŸš€ ~ res ~ image:",g),R.printLabel({address:e.address,name:e.name,height:302,width:582,image:g})});await Promise.all(v)}setTimeout(()=>L.getTop().then(r=>r&&n.dismiss()),1e3),C.value=!1}}});await n.present()}catch(d){console.error(d),C.value=!1,L.getTop().then(n=>n?L.dismiss():null),j("An error occurred while generating label")}}}async function E(e,s){console.log("ðŸš€ ~ printLabel ~ labelComponent:",e);const o=await gt();return/zebra/i.test(o.name)||/Browser/i.test(o.address)||o.port==="BT"?bt(o,s.lblUrl):await ft(o,e,s)}const pt=["id"],yt={id:"img-canvas"},ht={key:0,class:"print-section ion-text-center vertically-align"},wt=["id"],St=50,_t=N({__name:"PrintLabel",props:{id:String,width:Number,height:Number},emits:["labelOutput"],setup(e,{emit:s}){const o=s,d=e,n=W(!1),l=nt(()=>"".concat(d.id).concat(new Date().toISOString()));function c(){const u=document.getElementById(l.value);u&&st(u,{scale:7,backgroundColor:"#ffffff"}).then(function(r){try{const v=r.toDataURL("image/png"),g=document.getElementById("".concat([l.value],"-image"));g.src=v,n.value=!0,o("labelOutput",v),G(St).then(()=>ot.dismiss({generatedLabelImage:v},void 0,"printout"))}catch(v){console.error(v)}})}return F(()=>setTimeout(()=>c(),80)),(u,r)=>(b(),S("div",null,[t("div",{id:l.value,class:"label-canvas"},[it(u.$slots,"default",{},void 0,!0)],8,pt),t("div",yt,[n.value?at("",!0):(b(),S("div",ht,r[0]||(r[0]=[lt('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve" data-v-d8afb20c><metadata data-v-d8afb20c> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata><g data-v-d8afb20c><g transform="translate(0.000000,511.000000) scale(0.100000,-0.100000)" data-v-d8afb20c><path d="M2918.3,4119.3c-303-51.3-610.8-284.4-753-568.8c-102.6-212.1-125.9-359-125.9-822.9v-380h-533.8c-575.8,0-720.3-16.3-899.8-104.9c-237.8-116.6-454.6-410.3-491.9-669l-14-109.6l258.8-128.2l258.8-130.5H5000h4382.5l258.7,130.5l258.8,128.2l-14,109.6c-37.3,261.1-247.1,550.1-487.2,666.7c-184.2,90.9-324,107.2-904.5,107.2h-533.8v380c0,463.9-23.3,610.8-125.9,822.9c-142.2,286.7-435.9,508.2-757.6,568.8C6927.8,4147.2,3088.5,4147.2,2918.3,4119.3z M7158.6,3776.6c79.3-25.6,156.2-81.6,256.4-179.5c216.8-216.8,219.1-230.8,219.1-1102.6v-729.6H5000H2365.8v729.6c0,871.8,2.3,885.8,219.1,1102.6c233.1,230.8,51.3,214.5,2405.7,216.8C6850.9,3816.2,7053.7,3811.5,7158.6,3776.6z" data-v-d8afb20c></path><path d="M109.3-267.9l7-1382.3l74.6-153.8c90.9-184.2,258.7-349.7,445.2-435.9c130.5-60.6,146.9-62.9,692.3-74.6l559.5-11.7l14-338c11.7-275.1,23.3-361.3,65.3-466.2c163.2-401,484.9-671.4,909.1-757.6c146.9-32.6,452.2-35,2202.9-30.3c2030.4,7,2030.4,7,2184.3,58.3c363.7,123.5,643.4,396.3,773.9,752.9c37.3,95.6,51.3,209.8,60.6,454.6l14,326.4l559.5,11.7l561.8,11.7l153.9,76.9c191.2,93.2,366,277.4,442.9,466.2l53.6,132.9l7,1370.7l7,1370.7l-209.8-107.2l-212.1-104.9H5000H524.3l-212.1,104.9l-209.8,107.2L109.3-267.9z M1107,121.4c207.5-107.2,167.8-435.9-60.6-498.9c-104.9-28-186.5-7-263.4,69.9C701.4-225.9,678.1-121,720.1-20.8C785.4,137.7,955.5,200.7,1107,121.4z M7487.3-368.1c139.9-42,223.8-128.2,268.1-275.1c23.3-72.3,30.3-370.7,30.3-1181.9c0-1079.3,0-1084-53.6-1216.8c-76.9-188.8-251.8-373-442.9-466.2l-156.2-76.9H5000H2867l-156.2,76.9c-191.1,93.2-366,277.4-442.9,466.2c-53.6,130.6-53.6,149.2-60.6,1135.3c-7,1046.7,4.7,1244.8,88.6,1382.3c51.3,86.3,135.2,144.5,240.1,167.8c39.6,11.7,1144.6,18.7,2454.7,21C7053.7-333.2,7384.7-337.8,7487.3-368.1z M1125.7-766.7c65.3-44.3,121.2-151.5,121.2-230.8c0-79.3-55.9-186.5-121.2-230.8c-67.6-48.9-216.8-46.6-298.4,2.4c-172.5,100.2-167.8,368.3,4.7,466.2C906.6-720.1,1062.8-722.5,1125.7-766.7z" data-v-d8afb20c></path><path d="M3149.1-927.6c-60.6-62.9-67.6-130.5-18.7-195.8l44.3-60.6h1708.7h1708.7l44.3,60.6c48.9,65.3,42,132.9-18.7,195.8c-32.6,30.3-251.8,35-1734.4,35C3400.9-892.6,3181.7-897.3,3149.1-927.6z" data-v-d8afb20c></path><path d="M3149.1-1860c-60.6-62.9-67.6-130.5-18.7-195.8l44.3-60.6h1708.7h1708.7l44.3,60.6c48.9,65.3,42,132.9-18.7,195.8c-32.6,30.3-251.8,35-1734.4,35C3400.9-1825.1,3181.7-1829.7,3149.1-1860z" data-v-d8afb20c></path><path d="M3149.1-2792.5c-60.6-62.9-67.6-130.5-18.7-195.8l44.3-60.6h1708.7h1708.7l44.3,60.6c48.9,65.3,42,132.9-18.7,195.8c-32.6,30.3-251.8,35-1734.4,35C3400.9-2757.5,3181.7-2762.2,3149.1-2792.5z" data-v-d8afb20c></path></g></g></svg>',1)]))),t("img",{src:"",id:"".concat(l.value,"-image")},null,8,wt)])]))}}),M=O(_t,[["__scopeId","data-v-d8afb20c"]]),xt={id:"container"},Dt={style:{display:"flex","justify-content":"space-between",width:"100%"}},It={style:{background:"black","font-weight":"bold",color:"white",padding:"1.7px"}},Tt={style:{width:"100%"}},$t={style:{display:"flex","justify-content":"space-between",width:"100%"}},Lt={style:{display:"flex","justify-content":"space-between","border-bottom":"3px solid black",width:"100%"}},Ct={style:{width:"100%","text-align":"center"}},Ot={style:{"text-align":"right"}},Nt=N({__name:"ArtVisitLbl",props:{visit_by:{type:String},date:{type:String},arv_number:{type:String},patient_details:{type:String},height:{type:String},weight:{type:String},bmi:{type:String},viral_load:{type:String},outcome_date:{type:String},outcome:{type:String},next_appointment_date:{type:String},seen_by:{type:String},se:{type:String},tb_status:{type:String},adherence:{type:String},drugs:{type:Object}},emits:["label-out"],setup(e,{emit:s}){const o=s;return(d,n)=>(b(),k(M,{id:"visit-summary",onLabelOutput:n[0]||(n[0]=l=>o("label-out",l))},{default:A(()=>{var l,c;return[t("div",xt,[t("div",Dt,[t("span",null,[t("b",null,i(e.date),1)]),t("span",null,"("+i((l=e.visit_by)!=null?l:"??")+")",1),t("span",It,i(e.arv_number),1)]),t("div",Tt,[t("span",null,[t("b",null,i(e.patient_details),1)]),n[1]||(n[1]=t("span",null,[t("b",null,"Â :Patient visit")],-1))]),t("div",$t,[t("span",null,i(e.weight)+"kg",1),t("span",null,i(e.height)+"cm",1),t("span",null,[n[2]||(n[2]=t("b",null,"BMI:",-1)),m(i(e.bmi),1)]),t("span",null,[n[3]||(n[3]=t("b",null,"VL:",-1)),m(i(e.viral_load),1)])]),t("div",Lt,[t("span",null,[n[4]||(n[4]=t("b",null,"OUTC:",-1)),m(i(e.outcome)+"Â ",1)]),t("span",null,i(dt(et)((c=e.outcome_date)!=null?c:"")),1)]),t("table",Ct,[n[6]||(n[6]=t("thead",null,[t("tr",null,[t("th",null,"SE"),t("th",null,"TB"),t("th",null,"Adh"),t("th",null,"DRUG(S) Given")])],-1)),t("tbody",null,[t("tr",null,[n[5]||(n[5]=t("td",null,null,-1)),t("td",null,i(e.tb_status),1),t("td",null,i(e.adherence),1),t("td",null,[t("ul",null,[(b(!0),S(rt,null,ut(e.drugs,(u,r)=>(b(),S("li",{key:r},i(u),1))),128))])])])])]),n[7]||(n[7]=t("p",null,null,-1)),t("div",Ot,[t("div",null,[t("div",null,"Next: "+i(e.next_appointment_date),1),t("div",null,i(e.seen_by),1)])])])]}),_:1}))}}),Pt=O(Nt,[["__scopeId","data-v-34a856c3"]]),Bt={id:"container"},kt={class:"label"},At={style:{"font-weight":"600"},class:"row"},Et={style:{"margin-top":"2%"}},Mt={style:{"max-height":"316px",overflow:"hidden"}},Vt={class:"row"},Ht={class:"row"},Ut={class:"row"},qt={class:"row"},zt={style:{"margin-top":"14px"}},Gt=N({__name:"PatientDemographicLbl",props:{arv_number:{type:String},patient_details:{type:Object},art_initiation_status:{type:Object}},emits:["label-out"],setup(e,{emit:s}){const o=s;return(d,n)=>(b(),k(M,{id:"art_demographics",onLabelOutput:n[0]||(n[0]=l=>o("label-out",l))},{default:A(()=>{var l,c,u,r,v,g,_,f,D,I,x,y,h,T,P,a,w,p,$,V,H,U;return[t("div",Bt,[t("div",kt,[t("div",At,[n[1]||(n[1]=t("div",null,"PATIENT DETAILS",-1)),t("div",null,i(e.arv_number),1)]),t("div",null,[t("div",null,"Name: "+i((l=e.patient_details)==null?void 0:l.name),1),t("div",null,"DOB: "+i((c=e.patient_details)==null?void 0:c.dob),1),t("div",null,"Phone: "+i((u=e.patient_details)==null?void 0:u.phone),1),t("div",null,"Addr: "+i((r=e.patient_details)==null?void 0:r.address),1),t("div",null,"Guard: "+i((v=e.patient_details)==null?void 0:v.guardian),1),t("div",Et,[t("div",null,"TI: "+i((g=e.patient_details)==null?void 0:g.transfer_in),1),t("div",null,"FUP: "+i((_=e.patient_details)==null?void 0:_.agrees_to_followup),1)])])]),n[13]||(n[13]=t("div",{style:{margin:"150px"}},null,-1)),t("div",Mt,[t("div",Vt,[n[2]||(n[2]=t("div",null,[t("b",null,"STATUS AT ART INITIATION")],-1)),t("div",null,"(DSA: "+i((f=e.art_initiation_status)==null?void 0:f.art_start_date)+")",1),t("div",null,[t("b",null,i(e.arv_number),1)])]),t("div",Ht,[t("div",null,[n[3]||(n[3]=t("b",null,"RFS: ",-1)),m(i((D=e.art_initiation_status)==null?void 0:D.reason_for_art_eligibility),1)]),t("div",null,[n[4]||(n[4]=t("b",null,"TB: ",-1)),m(i((I=e.art_initiation_status)==null?void 0:I.tb_status),1)]),t("div",null,[n[5]||(n[5]=t("b",null,"HEIGHT: ",-1)),m(i((x=e.art_initiation_status)==null?void 0:x.initial_height),1)])]),t("div",Ut,[t("div",null,[n[6]||(n[6]=t("b",null,"KS: ",-1)),m(i((y=e.art_initiation_status)==null?void 0:y.ks_status),1)]),t("div",null,[n[7]||(n[7]=t("b",null,"WEIGHT: ",-1)),m(i((h=e.art_initiation_status)==null?void 0:h.initial_weight),1)])]),t("div",qt,[t("div",null,[n[8]||(n[8]=t("b",null,"1st + Test:",-1)),m(" "+i((T=e.art_initiation_status)==null?void 0:T.hiv_test_date),1)]),t("div",null,[n[9]||(n[9]=t("b",null,"Preg: ",-1)),m(i((P=e.art_initiation_status)==null?void 0:P.pregnant),1)]),t("div",null,[n[10]||(n[10]=t("b",null,"Init Age: ",-1)),m(i((a=e.art_initiation_status)==null?void 0:a.age_at_initiation),1)])]),n[11]||(n[11]=t("div",{style:{"border-top":"3px solid black",width:"100%"}},null,-1)),n[12]||(n[12]=t("div",{style:{"font-weight":"bold",display:"flex","justify-content":"right"}}," STAGE DEFINING CONDITIONS ",-1)),t("div",zt,i([...(p=(w=e.art_initiation_status)==null?void 0:w.first_line_drugs)!=null?p:[],...(V=($=e.art_initiation_status)==null?void 0:$.alt_first_line_drugs)!=null?V:[],...(U=(H=e.art_initiation_status)==null?void 0:H.second_line_drugs)!=null?U:[]].join(",")),1)])])]}),_:1}))}}),jt=O(Gt,[["__scopeId","data-v-56ecfb68"]]),Rt={id:"container"},Wt={key:0},Ft={key:1},Qt={style:{display:"flex","align-items":"center"}},Jt=N({__name:"NpidLbl",props:{name:{type:String,default:"??"},national_id:{type:String,required:!0,default:"??"},birthdate:{type:String,default:"??"},sex:{type:String,gender:"??"},address:{type:String,default:"??"},useQrCode:{type:Boolean},qr:{type:String}},emits:["label-out"],setup(e,{emit:s}){const o=s,d=e;return F(()=>{if(!d.useQrCode)ct("#patient-barcode",d.national_id,{height:56,width:2,displayValue:!1,format:"CODE128"});else{const n=document.getElementById("patient-qrcode");n&&d.qr&&vt.toCanvas(n,d.qr,{width:160},l=>{l&&(console.log(l),j("Unable to generate QR code"))})}}),(n,l)=>(b(),k(M,{id:"npid-label",onLabelOutput:l[0]||(l[0]=c=>o("label-out",c))},{default:A(()=>[t("div",Rt,[e.useQrCode?(b(),S("div",Ft,[t("div",null,[t("div",Qt,[l[2]||(l[2]=t("div",null,[t("canvas",{id:"patient-qrcode"})],-1)),t("div",null,[t("div",null,i(e.name),1),t("div",null,i(e.national_id),1),t("div",null,i(e.birthdate),1),t("div",null,i(e.sex),1),t("div",null,i(e.address),1)])])])])):(b(),S("div",Wt,[t("div",null,[t("div",null,[t("div",null,i(e.name),1),t("div",null,i(e.national_id)+" "+i(e.birthdate)+" "+i(e.sex),1),t("div",null,i(e.address),1)]),l[1]||(l[1]=t("svg",{id:"patient-barcode"},null,-1))])]))])]),_:1}))}}),Kt=O(Jt,[["__scopeId","data-v-2829f777"]]);function te(e,s=B.getSessionDate()){E(Pt,{copies:2})}function ee(e){E(jt,{lblUrl:"programs/".concat(B.getProgramID(),"/patients/").concat(e,"/labels/patient_history")})}async function ne(e,s=!1){return E(Kt,{scaleHeight:280,useImage:!1,lblUrl:"patients/".concat(e,"/labels/national_health_id?qr_code=").concat(s)})}export{ee as a,te as b,E as c,ne as p};

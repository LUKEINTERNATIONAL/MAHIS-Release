import{d as Z,cm as Q,a$ as ee,ar as ne,r as u,w as te,y as c,f as l,z as s,l as a,u as n,eu as ae,k as m,ap as oe,ah as le,e as w,ak as se,F as re,L as ie,G as ue,I as p,ev as ce,dJ as de,eq as fe,B as O,bT as ve,V as W,U as L,W as D,A as B,dT as pe,bN as me,aZ as ge,aW as ye,m as V,e7 as ke,bO as _e,dA as be,cC as we,ew as Ie,an as Te,X as xe}from"./vendor-DHEgn6Fp.js";import{S as z,u as he,P as M,T as Ce,bF as Ne,k as A,bg as Se,ag as G,N as Pe,bG as De,j as Be,bH as Ae,a1 as Ee,_ as Fe}from"./index-hsTmLo0U.js";import{i as Re,a as $e}from"./tasks-DFOtg1aq.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-BKi_EpK-.js";class h extends z{constructor(){super()}static nextTask(g){return super.getJson("/workflows/".concat(super.getProgramID(),"/").concat(g),{date:super.getSessionDate()})}static async getNextTaskParams(g,C=""){let v=C;try{if(!v){const{name:k}=await h.nextTask(g);v=k}}catch(k){v=""}return{name:v.toLowerCase(),params:{patient_id:g}}}}const Oe={key:1,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},We={class:"ion-page",id:"main"},Le={key:0,class:"placeholder-content"},Ve={style:{margin:"0px auto"},class:"ion-text-center"},Me={key:1},Ge={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}},ze={style:{color:"black"}},Ue=Z({__name:"ARTVisit",setup(Ye){const g=Q(),C=he(),{patient:v}=ee(C),k=new M,E=ne(),d=u(-1),I=u(null),o=u([]),F=u([]),_=u(!1),N=u(-1),y=u(""),b=u(""),R=u(""),S=u(!1),T=u(null);function U(t){var e;return F.value.includes((e=t==null?void 0:t.encounterTypeID)!=null?e:0)}function x(t){var e;return t?!_.value&&N.value===(t==null?void 0:t.encounterTypeID)||((e=t==null?void 0:t.otherWorkflowNames)!=null?e:[]).includes(y.value):!1}function Y(){if(o.value.length===0||d.value===o.value.length-1)return!1;const t=o.value[d.value];return t&&x(t)}async function J(){const t=await Se.getEncounters(v.value.patientID,{date:h.getSessionDate()});F.value=t.map(e=>e.encounter_type)}async function $(){var t,e;S.value=(t=z.isBDE())!=null?t:!1,R.value="",_.value=!0,b.value="",y.value="";try{const i=await h.nextTask(v.value.patientID);if(!i){b.value="No workflows found. You may exit this page or refresh",_.value=!1,d.value=-1;return}y.value=i.name,N.value=(e=i==null?void 0:i.encounter_type_id)!=null?e:-1;const r=o.value.findIndex(f=>{var P;return(f==null?void 0:f.encounterTypeID)===N.value||((P=f.otherWorkflowNames)!=null?P:[]).includes(y.value)});if(r!==-1){R.value=i.description;const f=[...o.value.slice(r),...o.value.slice(0,r)];o.value=f,d.value=0}else b.value=y.value?'"'.concat(y.value,'" is not available in the current workflow. Contact your administrator or update ART activity selection'):"No next task found",d.value=r}catch(i){b.value="An error has occured while loading next task: "+i,console.error(i)}finally{await J(),_.value=!1}}async function j(){d.value=-1,o.value=[];try{const t=G.map(async e=>{if(!(typeof e.disabled=="function"&&e.disabled(G))){if(e.workflowID&&e.component){if(!await Re(e.workflowID)||!await $e(e.workflowID))return}else return;return e}});o.value=(await Promise.all(t)).filter(e=>e!==void 0),q()}catch(t){A("Unable to load activities"),console.error(t)}}async function q(){if(await Pe.isProp("".concat(De.FILING_NUMBERS,"=true"))){if(k.patient=await M.findByID(v.value.patientID),!/n\/a/i.test(k.getFilingNumber()))return;Be(Ee,{},!1,{title:"New filing number assignment",useComponent:Ae,onClose:()=>{xe.dismiss()}})}}function H(){if(S.value)if(T.value){if(!T.value.isProviderSelected()){A("Please select a provider"),T.value.openModal();return}}else{A("BDE Provider component is not available");return}return I.value&&typeof I.value.onSubmit=="function"?I.value.onSubmit():Promise.resolve(!0)}function K(){H().then(t=>t&&$())}function X(t){if(t<0||t>=o.value.length)return;const e=o.value[t];e&&x(e)&&(d.value=t)}return te(()=>g.fullPath,()=>{j().then($)},{immediate:!0,deep:!0}),(t,e)=>(l(),c(n(Te),null,{default:s(()=>[a(Ce),a(n(ae),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:s(()=>{var i;return[a(n(oe),{contentId:"main"},{default:s(()=>[a(n(le),null,{default:s(()=>[o.value.length>0?(l(),c(n(se),{key:0},{default:s(()=>[(l(!0),w(re,null,ie(o.value,(r,f)=>(l(),c(n(ue),{onClick:P=>X(f),lines:"none",key:f,disabled:!x(r),button:""},{default:s(()=>[U(r)?(l(),c(n(p),{key:0,icon:n(ce),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):x(r)?(l(),c(n(p),{key:2,icon:n(fe),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(l(),c(n(p),{key:1,icon:n(de),style:{padding:"10px"},slot:"start"},null,8,["icon"])),m("b",null,O(r.name),1)]),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(l(),w("div",Oe,[a(n(p),{style:{"font-size":"2rem"},icon:n(ve)},null,8,["icon"]),e[2]||(e[2]=m("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),a(n(W),null,{default:s(()=>[a(n(L),{color:"light"},{default:s(()=>[a(n(D),{onClick:e[0]||(e[0]=r=>n(E).back())},{default:s(()=>[a(n(p),{icon:n(pe),slot:"start"},null,8,["icon"]),e[3]||(e[3]=B(" Back to dashboard ",-1))]),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),m("div",We,[_.value?(l(),w("div",Le,[m("div",Ve,[a(n(me),{name:"bubbles"}),e[4]||(e[4]=m("p",null,[m("h1",null,"Please wait...")],-1))])])):(i=o.value[d.value])!=null&&i.component?(l(),w("div",Me,[a(n(ge),null,{default:s(()=>[a(n(ye),null,{default:s(()=>{var r;return[S.value?(l(),c(Ne,{key:0,ref_key:"bdeProviderComponent",ref:T},null,512)):V("",!0),(l(),c(ke,null,[(l(),c(_e((r=o.value[d.value])==null?void 0:r.component),{ref_key:"formRef",ref:I},null,512))],1024))]}),_:1})]),_:1})])):(l(),w("div",Ge,[a(n(p),{style:{color:"green","font-size":"80px"},icon:n(be)},null,8,["icon"]),m("h2",ze,O(b.value),1),a(n(D),{size:"large",fill:"clear",onClick:e[1]||(e[1]=r=>n(E).back())},{default:s(()=>[a(n(p),{slot:"start",icon:n(we)},null,8,["icon"]),e[5]||(e[5]=B(" Exit page ",-1))]),_:1,__:[5]})])),a(n(W),null,{default:s(()=>[a(n(L),{color:"light"},{default:s(()=>[Y()?(l(),c(n(D),{key:0,onClick:K,color:"primary",style:{padding:"4px"},slot:"end"},{default:s(()=>[e[6]||(e[6]=B(" Save and continue ",-1)),a(n(p),{style:{padding:"4px"},icon:n(Ie),slot:"end"},null,8,["icon"])]),_:1,__:[6]})):V("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),Xe=Fe(Ue,[["__scopeId","data-v-f9671703"]]);export{Xe as default};

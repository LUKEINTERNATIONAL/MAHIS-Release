System.register(["./report_service-legacy-GaC4oudj.js","./ReportTable.vue_vue_type_style_index_0_lang-legacy-D1hW0FC4.js","./index-legacy-vNvbOqfP.js","./age_groups-legacy-PcrIMUD9.js","./lodash-legacy-C-x9g9Na.js","./vendor-legacy-BJ1xAwcR.js","./apexcharts-legacy-B-A4pbfR.js","./chartjs-legacy-DSEVAC0A.js","./barcode-qrcode-reader-legacy-57P3_eyA.js"],(function(e,t){"use strict";var a,l,r,s,u,i,n,o,d,g,p,c,b,v,h,_;return{setters:[e=>{a=e.R,l=e.L,r=e.l},e=>{s=e.g,u=e._},e=>{i=e.t,n=e.p,o=e.c,d=e.b},e=>{g=e.A},e=>{p=e.l},e=>{c=e.d,b=e.r,v=e.c,h=e.y,_=e.f},null,null,null],execute:function(){class t extends a{constructor(){super(),this.programId=l}buildLabPatientLevelData(e){return e.flatMap((e=>e.measures.map((t=>({...e,test_name:t.name,result:`${t.modifier} ${t.value}`})))))}buildLabResultRowData(e,t,a){const l=e.filter((e=>e.gender===a&&e.age_group===t)).map((({patient_id:e})=>e));return{ageGroup:t,gender:a,viral_load:l}}buildLabDisaggregatedData(e){const t=[],a=[];return g.forEach((l=>{t.push(this.buildLabResultRowData(e,l,"M")),a.push(this.buildLabResultRowData(e,l,"F"))})),[...a,...t]}async getLabResultReport(){const e=await this.getReport("lab_test_results");if(!e)return{};const t=this.buildLabPatientLevelData(e);return{patientLevelData:t,disaggregatedData:this.buildLabDisaggregatedData(t)}}}e("default",c({__name:"LabResultsReport",setup(e){const a=b("-"),l=b(""),g=[s("patient_id")],c=b({}),m=v((()=>p.isEmpty(c.value)?[]:"disaggregated"===l.value?c.value.disaggregatedData:c.value.patientLevelData)),R=v((()=>"disaggregated"===l.value?[{path:"ageGroup",label:"Age Group"},{path:"gender",label:"Gender",formatter:i},{path:"viral_load",label:"HIV viral load",drillable:!0}]:[{path:"arv_number",label:"ARV Number",preSort:n,initialSort:!0},{path:"gender",label:"Gender",formatter:i},{path:"birthdate",label:"Birthdate",formatter:o},{path:"order_date",label:"Ordered",formatter:o},{path:"test",label:"Specimen"},{path:"test_name",label:"Test"},{path:"result",label:"Result"},{path:"result_date",label:"Released",formatter:o}])),y=v((()=>[{id:"type",label:"Select report type",required:!1,type:"select",options:[{label:"Disaggregated",value:"disaggregated"},{label:"Patient level",value:"patient_level"}],onUpdate:e=>{l.value=e.value}}]));async function D(e){await r.show();try{const l=new t;l.setStartDate(e.dateRange.startDate),l.setEndDate(e.dateRange.endDate),a.value=l.getDateIntervalPeriod(),c.value=await l.getLabResultReport()}catch(l){d("Unable to load report data"),console.error(l)}await r.hide()}return(e,t)=>(_(),h(u,{"report-type":"Clinic",title:"Lab Test Result(s) Report",columns:R.value,rows:m.value,period:a.value,"row-action-buttons":g,"custom-filters":y.value,"use-date-range-filter":"","use-secure-export":"",onGenerate:D},null,8,["columns","rows","period","custom-filters"]))}}))}}}));

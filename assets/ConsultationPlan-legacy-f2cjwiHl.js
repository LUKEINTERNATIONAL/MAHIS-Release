System.register(["./vendor-legacy-DuE25wDu.js","./index-legacy-jGUaR9S1.js","./DemographicBar-legacy-BVEC_Z7D.js","./OPDOutcome-legacy-D2Ctw06o.js","./NextAppointment-legacy-Yr3GV5U5.js","./OPDPrintingModal-legacy-BJfRzTdg.js","./lodash-legacy-pOOc9Efu.js","./usePatientProfile-legacy-CYuPBeAM.js","./useFormWizard-legacy-D6ECIxN4.js","./formatServerData-legacy-jNiob8zE.js","./diagnosis-legacy-JZ5SGzGE.js","./apexcharts-legacy-BTGre5ff.js","./BasicForm-legacy-CmDYp1Q1.js","./DateInputField-legacy-Wv4T493L.js","./patient_complaints_service-legacy-untvgn3A.js","./DashBox-legacy-Yy6qCISv.js","./useExposeFromStandardForm-legacy-C06-WCmJ.js","./BasicCard-legacy-VoeuCs_J.js","./lab_order-legacy-DD4oGNjA.js","./LabTestsHistory-legacy-DJ6rsCq3.js","./userService-legacy-_rzxmBQr.js","./group_validation-legacy-CWld8TCP.js","./drug_prescription_service-legacy-Bi90TW-_.js","./drug_service-legacy-Cb8qb9Te.js","./Outcome-legacy-CqjVjmPY.js","./ncd_appointment_service-legacy-7_AVL-Ys.js","./Registration-legacy-D0TwGc5f.js","./useLocation-legacy-Dh9bOEjl.js","./vaccines_service-legacy-CePid8vH.js","./sms_service-legacy-DiCiAlQk.js","./EIRreportsStore-legacy-eepoiqNw.js","./Export-legacy-OMti8Xre.js"],function(e,a){"use strict";var t,l,n,s,i,o,c,u,r,d,v,g,m,p,y,h,f,w,D,b,x,_,P,I,j,O,S,C,T,A,k,F,N,E,L,H,M,R,z,B,U,V,W,Y,Z,$,J,X,G,K,Q,q,ee,ae,te,le,ne,se,ie,oe,ce,ue,re,de,ve,ge,me,pe,ye,he;return{setters:[e=>{t=e.d,l=e.ar,n=e.cl,s=e.r,i=e.a$,o=e.a,c=e.w,u=e.y,r=e.f,d=e.z,v=e.l,g=e.e,m=e.m,p=e.k,y=e.u,h=e.bM,f=e.d5,w=e.ah,D=e.dE,b=e.i,x=e.bG,_=e.v,P=e.an},e=>{I=e.u,j=e.aD,O=e.aT,S=e.a1,C=e.c,T=e.aJ,A=e.N,k=e.a2,F=e.aU,N=e.aV,E=e.aW,L=e.aX,H=e.aY,M=e.aZ,R=e.T,z=e.D,B=e.z,U=e.n,V=e.H,W=e.aK,Y=e.ax,Z=e.a_,$=e.t,J=e.S,X=e.k,G=e.l,K=e._},e=>{Q=e.D},e=>{q=e.C,ee=e.I,ae=e.O,te=e.a,le=e.b},e=>{ne=e.N,se=e.T,ie=e.s,oe=e.a,ce=e.d,ue=e.b},e=>{re=e.O},e=>{de=e.l},e=>{ve=e.u},e=>{ge=e.u},e=>{me=e.f,pe=e.c,ye=e.a},e=>{he=e.D},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".disabled[data-v-800d7e90]{color:red}.spinner-overlay[data-v-800d7e90]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-800d7e90]{width:80px;height:80px}.loading-text[data-v-800d7e90]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-800d7e90]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-800d7e90]{pointer-events:none}.back_profile[data-v-800d7e90]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(a);const fe={key:0,class:"spinner-overlay"},we={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},De={class:"back_profile"};e("default",K(t({__name:"ConsultationPlan",setup(e){const{onTabBeforeChange:a,currentTabIndex:t}=ge("Consultation Plan"),K=async e=>{e%1==0&&(t.value=e),await wa()},{printVisitSummary:be}=ve(),xe=l(),_e=n(),Pe=s(!1),Ie=s(!1),je=s(!0),Oe=s(!1),Se=s(!1),Ce=s(!1),Te=I(),Ae=j(),ke=O(),Fe=S(),Ne=C(),Ee=T(),Le=A(),He=k(),Me=F(),Re=N(),ze=E(),Be=L(),Ue=H(),Ve=M(),{patient:We}=i(Te),{investigations:Ye}=i(Ae),{OPDdiagnosis:Ze}=i(ke),{selectedMedicalDrugsList:$e,nonPharmalogicalTherapyAndOtherNotes:Je,selectedMedicalAllergiesList:Xe}=i(Fe),{OPDActivities:Ge}=i(Ne),{outcomes:Ke}=i(Ee),{currentSelectedNextAppointmentDate:Qe}=i(Me),{presentingComplaints:qe}=i(Re),{pregnancy:ea}=i(ze),{pastMedicalHistory:aa}=i(Be),{adult:ta,minor:la}=i(Ue),{physicalExam:na}=i(Ve),{vitals:sa}=i(He),ia=s(null),oa=s(null),ca=s(null),ua=s(null),ra=s(null),da=s(null),va=()=>Ge.value.map(e=>({title:e,icon:"",active:"disabled"})),ga=s(va()),ma=()=>{var e;if(!ga.value||0===ga.value.length)return null;const a=t.value>=0&&t.value<ga.value.length?t.value:0;switch(null===(e=ga.value[a])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(Ge.value.length>0)switch(Ge.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},pa=async()=>{Ie.value=!0,B("Printing consultation summary... Please wait.");try{await be(),B("Consultation summary printed successfully!"),setTimeout(()=>{xe.push("home")},3500)}catch(e){U("Failed to print consultation summary.")}finally{Ie.value=!1}},ya=()=>{B("Patient has finished consultation!"),xe.push("home")},ha=async()=>{const e=V.sessionDate();W("vitals");for(let t=0;t<ga.value.length;t++){const l=ga.value[t];if("Clinical Assessment"===l.title){const a=W("presentingComplaints");ga.value[t].icon=fa(e,a)?"check":""}else if("Investigations"===l.title){var a;const l=null===(a=We.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,n=null==l?void 0:l.filter(a=>V.toStandardHisFormat(e)===V.toStandardHisFormat(a.order_date));ga.value[t].icon=(null==n?void 0:n.length)>0?"check":""}else if("Diagnosis"===l.title){const a=W("diagnosis");ga.value[t].icon=fa(e,a)?"check":""}else if("Treatment Plan"===l.title){const e=W("treatment");ga.value[t].icon=(null==e?void 0:e.length)>0?"check":""}else if("Next Appointment"===l.title){const a=W("appointments");ga.value[t].icon=fa(e,a)?"check":""}else if("Outcome"===l.title){const e=W("outcomes");ga.value[t].icon=(null==e?void 0:e.length)>0?"check":""}}},fa=(e,a)=>{if(!a)return!1;const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime||e.order_date);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},wa=async()=>{Pe.value=!0;try{var e;await Promise.all([Da(),null===(e=ia.value)||void 0===e?void 0:e.onSubmit(),ba(),xa(),Pa(),_a()]),await Y(We.value),Z()}catch(a){throw console.error("Error saving clinical assessment:",a),U("Failed to save clinical assessment"),a}finally{Pe.value=!1}},Da=async()=>{try{const n=V.getAgeInYears(We.value.personInformation.birthdate)<18?await me(la.value):await me(ta.value);var e,a,t,l;n.length>0&&(null!==(a=(e=null!==(l=(t=We.value).levelOfConsciousness)&&void 0!==l?l:t.levelOfConsciousness={}).unsaved)&&void 0!==a||(e.unsaved=[]),We.value.levelOfConsciousness.unsaved.push(...n),B("Level of Consciousness saved successfully"))}catch(n){console.error("Failed to save consciousness assessment:",n),$("Failed to save consciousness assessment")}},ba=async()=>{try{const n=await me(ea.value);var e,a,t,l;n.length>0&&(null!==(a=(e=null!==(l=(t=We.value).pregnancy)&&void 0!==l?l:t.pregnancy={}).unsaved)&&void 0!==a||(e.unsaved=[]),We.value.pregnancy.unsaved.push(...n),B("Pregnancy status saved successfully"))}catch(n){console.error("Failed to save pregnancy status:",n),$("Failed to save pregnancy status")}},xa=async()=>{try{const n=await ja();var e,a,t,l;n.length>0&&(null!==(a=(e=null!==(l=(t=We.value).pastMedicalHistory)&&void 0!==l?l:t.pastMedicalHistory={}).unsaved)&&void 0!==a||(e.unsaved=[]),We.value.pastMedicalHistory.unsaved.push(...n),B("Past medical history saved successfully"))}catch(n){console.error("Failed to save past medical history:",n),$("Failed to save past medical history")}},_a=async()=>{try{const n=await Oa();var e,a,t,l;n.length>0&&(null!==(a=(e=null!==(l=(t=We.value).physicalExam)&&void 0!==l?l:t.physicalExam={}).unsaved)&&void 0!==a||(e.unsaved=[]),We.value.physicalExam.unsaved.push(...n),B("Physical examination saved successfully"))}catch(n){console.error("Failed to save physical examination:",n),$("Failed to save physical examination")}},Pa=async()=>{try{const e=localStorage.getItem("userID"),a=We.value.patientID;if(!de.isEmpty(Xe.value)){const t=Sa(),l=new se;await l.onSubmitAllergies(a,e,t),await ie(t)}}catch(e){console.error("Failed to save allergies:",e),$("Failed to save allergies")}},Ia=e=>e?e.map(e=>(null==e?void 0:e.data[0])||(null==e?void 0:e.data)):[],ja=async()=>[...await pe(aa.value),...await me(aa.value),...await ye(aa.value)],Oa=async()=>[...await pe(na.value),...await me(na.value),...await ye(na.value)],Sa=()=>Xe.value.map(e=>({concept_id:985,obs_datetime:J.getSessionDate(),value_coded:e.concept_id,location_id:Le.facilityLocation.code})),Ca=async()=>{try{await(async()=>{try{var e;if((null===(e=Ze.value[0])||void 0===e||null===(e=e.selectedData)||void 0===e?void 0:e.length)>0){var a,t,l,n;const e=localStorage.getItem("userID"),s=new he;await s.onSubmit(We.value.patientID,e,Ia(Ze.value[0].selectedData));const i=Ia(Ze.value[0].selectedData);null!==(t=(a=null!==(n=(l=We.value).diagnosis)&&void 0!==n?n:l.diagnosis={}).unsaved)&&void 0!==t||(a.unsaved=[]),We.value.diagnosis.unsaved.push(...i)}Ze.value[0].selectedData=[]}catch(s){console.error("Failed to save diagnosis:",s),$("Failed to save diagnosis")}})(),await(async()=>{try{const e=localStorage.getItem("userID"),a=We.value.patientID,t=new se;if(!de.isEmpty(Xe.value)){const l=Sa();await t.onSubmitAllergies(a,e,l)}if(!de.isEmpty(Je.value)){const e=[{concept_id:2688,obs_datetime:localStorage.getItem("sessionDate"),value_text:Je.value,location_id:Le.facilityLocation.code}];await oe(e)}await ce(),await ue().saveNonPharmaTherapyPatientData()}catch(e){console.error("Failed to save treatment plan:",e),$("Failed to save treatment plan")}})(),await Ee.saveOutcomPatientData(),await Z(),await Y(We.value);const e=localStorage.getItem("locationID"),a=localStorage.getItem("userRoles");if(!e)return void U("Location ID could not be found. Please check your settings.");const t=a?JSON.parse(a):[];t.some(e=>"Lab"===e.role)?(await X.movePatientToNextStage(We.value.patientID,"LAB","CONSULTATION",e,We.value.visitID||We.value.visit_id),await G().refresh(e),await xe.push("home"),B("Lab results submitted. Patient can return to consultation")):(await X.movePatientToNextStage(We.value.patientID,"CONSULTATION","DISPENSATION",e,We.value.visitID||We.value.visit_id),await G().refresh(e),await xe.push("home"),B("Consultation patient saved successfully."))}catch(e){console.error("Error saving consultation data:",e),U("Failed to save consultation data")}};return o(async()=>{0!==Ge.value.length?(ga.value=va(),await ha(),(void 0===t.value||t.value<0)&&(t.value=0)):await xe.push("home")}),c(sa,async()=>{await ha()},{deep:!0}),c(We,async()=>{await ha()},{deep:!0}),c(Ye,async()=>{await ha()},{deep:!0}),c(Ze,async()=>{await ha()},{deep:!0}),c($e,async()=>{await ha()},{deep:!0}),c(Ke,async()=>{await ha()},{deep:!0}),c(Qe,async()=>{await ha()}),c(qe,async()=>{await ha()},{deep:!0}),c(_e,async()=>{je.value=!1,setTimeout(()=>{t.value=0,je.value=!0},0)},{deep:!0}),c(Ce,e=>{Se.value=e,Se.value&&setTimeout(()=>{Se.value=!1},15e3)}),(e,t)=>(r(),u(y(P),null,{default:d(()=>[v(re,{onYes:pa,onNo:ya,isOpen:Oe.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),Pe.value?(r(),g("div",fe,[v(y(h),{name:"bubbles"}),t[2]||(t[2]=p("div",{class:"loading-text"},"Please wait...",-1))])):m("",!0),v(y(f),{"is-open":Ie.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),v(R),v(y(w),{fullscreen:!0},{default:d(()=>[v(Q),p("div",we,[je.value?(r(),u(y(D),{key:0,ref:"wizard","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",disabled:!0,startIndex:0,doneButton:{text:"Finish",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},"custom-tabs":ga.value,beforeChange:y(a),onChange:K,"onComplete:wizard":t[1]||(t[1]=e=>Ca())},{default:d(()=>[p("div",null,[p("div",De,[v(z,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:y(x),"font-weight":"600",onClick:t[0]||(t[0]=e=>{xe.push("home")})},null,8,["icon"])])]),b(p("div",null,[v(q,{ref_key:"clinicalAssessmentRef",ref:ia},null,512)],512),[[_,"ClinicalAssessment"===ma()]]),b(p("div",null,[v(ee,{ref_key:"investigationsRef",ref:oa},null,512)],512),[[_,"Investigations"===ma()]]),b(p("div",null,[v(ae,{ref_key:"diagnosisRef",ref:ca},null,512)],512),[[_,"OPDDiagnosis"===ma()]]),b(p("div",null,[v(te,{ref_key:"treatmentPlanRef",ref:ua},null,512)],512),[[_,"OPDTreatmentPlan"===ma()]]),b(p("div",null,[v(ne,{ref_key:"nextAppointmentRef",ref:ra},null,512)],512),[[_,"NextAppointment"===ma()]]),b(p("div",null,[v(le,{ref_key:"outcomeRef",ref:da},null,512)],512),[[_,"Outcome"===ma()]])]),_:1},8,["custom-tabs","beforeChange"])):m("",!0)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-800d7e90"]]))}}});

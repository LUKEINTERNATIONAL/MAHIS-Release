import{d as G,b2 as x,bQ as J,r as c,c as h,w as L,a as X,E as N,e as m,f as i,l as w,z as f,k as s,F as O,L as F,y as b,m as Z,B as I,u as ee,b$ as te}from"./vendor-BzS-GRGX.js";import{ap as ae,u as oe,o as se,D as B,aK as $,j as ne,l as ie,a4 as le,H as z,P as R,i as re,_ as ce}from"./index-TGgrguwo.js";import{p as ue}from"./ARTConsultation-CWPmCftL.js";import"./lodash-Dt8AsbQm.js";import"./prescription_service-CnvIlSpr.js";import"./app_encounter_service-1D5RNuZY.js";import"./BasicYesNoSelect-BKFG_D_s.js";import"./BasicRadioSelect-DByUV3Lx.js";import"./Arrays-CfBll-2n.js";import"./patient_type_service-Ce6rxhGj.js";import"./SelectFacility-BV6O3A7t.js";import"./patient_lab_service-BfByiNeD.js";import"./apexcharts-C_xTRKVr.js";const ve={class:"visitContent"},de={class:"visitData"},pe={class:"table-header"},me={class:"encounter-title"},fe={class:"table-responsive"},_e={key:0,class:"loading-state"},ye={key:1,class:"empty-state"},ge=G({__name:"VisitsHistory",setup(he){const U=ae(),{investigations:A}=x(U),T=oe(),{patient:P}=x(T),j=se(),{activeProgram:we}=x(j),q=J();c(re);const _=c([]),D=c([]),n=c(""),y=c([]),g=c(),v=c([]),S=c(!1),C=h(()=>{const e=new Set;return D.value.filter(t=>{var a;return((a=t.type)==null?void 0:a.name)&&!e.has(t.type.name)&&e.add(t.type.name)}).map(t=>{const a=t.type.name;return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()})}),K=h(()=>({paging:!0,lengthChange:!1,searching:!1,ordering:!0,info:!0,autoWidth:!0,responsive:!0,pageLength:8})),M=h(()=>[{data:"observation",title:"Observation"},{data:"value",title:"Value"},{data:"date",title:"Date"}]);h(()=>{var e;return(e=A.value[0])==null?void 0:e.selectedData});const Q=async e=>{n.value=e,await k()},W=async()=>{ue(async e=>{var t;$.voidEncounter((t=g.value)==null?void 0:t.encounter_id,e).then(async()=>{await V(y.value),ne("Encounter has been voided!",2e3)}).catch(a=>{ie("".concat(a),32e3)})})},k=async()=>{var e,t;if(!n.value){v.value=[];return}S.value=!0;try{if(g.value=D.value.find(l=>{var r,u,d,p;return((u=(r=l.type)==null?void 0:r.name)==null?void 0:u.charAt(0).toUpperCase())+((p=(d=l.type)==null?void 0:d.name)==null?void 0:p.slice(1).toLowerCase())===n.value}),!((e=g.value)!=null&&e.observations)){v.value=[];return}const a=await Promise.all((t=g.value)==null?void 0:t.observations.map(async l=>{var u,d,p;const o=((p=(d=(u=l.concept)==null?void 0:u.concept_names)==null?void 0:d.find(H=>H.concept_name_type==="FULLY_SPECIFIED"||H.concept_name_type==="SHORT"))==null?void 0:p.name)||"Unknown Observation";let r=await le.resolvePrimaryValue(l)||"";return{observation:o,value:r,date:z.toStandardHisDisplayFormat(l.obs_datetime)}}));v.value=a}catch(a){console.error("Error loading table data:",a),v.value=[]}finally{S.value=!1}},E=async()=>{const e=new R;_.value=await R.getPatientVisits(e.getID(),!1),_.value.length>0&&await V(_.value[0])},Y=e=>z.toStandardHisDisplayFormat(e),V=async e=>{y.value=e,D.value=await $.getEncounters(P.value.patientID,{date:e}),C.value.length>0&&(n.value=C.value[0],await k())};return L(P,async()=>{await E()},{deep:!0}),L(q,async()=>{await E()},{deep:!0}),L(n,async()=>{await k()}),X(async()=>{await E()}),(e,t)=>{const a=N("ion-col"),l=N("ion-row");return i(),m("div",ve,[w(l,null,{default:f(()=>[w(a,{size:"1.6",style:{height:"62vh","overflow-y":"auto","padding-right":"0px","padding-left":"0px"}},{default:f(()=>[s("div",null,[(i(!0),m(O,null,F(_.value,(o,r)=>(i(),b(B,{class:"",style:{"margin-bottom":"5px",width:"96%",height:"45px"},onClick:u=>V(o),key:r,name:Y(o),fill:y.value!=o?"outline":"solid",color:y.value==o?"success":""},null,8,["onClick","name","fill","color"]))),128))])]),_:1}),w(a,{size:"2.3"},{default:f(()=>[s("div",null,[(i(!0),m(O,null,F(C.value,(o,r)=>(i(),b(B,{class:"",style:{"margin-bottom":"5px",width:"96%",height:"45px"},onClick:u=>Q(o),key:r,name:o,fill:n.value!=o?"outline":"solid",color:n.value==o?"success":""},null,8,["onClick","name","fill","color"]))),128))])]),_:1}),w(a,{offset:"0.1",size:"8"},{default:f(()=>[s("div",de,[s("div",pe,[s("h3",me,I(n.value)+" Observations",1),n.value?(i(),b(B,{key:0,name:"Void Encounter",fill:"solid",color:"danger",onClick:t[0]||(t[0]=o=>W())})):Z("",!0)]),s("div",fe,[S.value?(i(),m("div",_e,t[1]||(t[1]=[s("p",null,"Loading observations...",-1)]))):v.value.length===0&&n.value?(i(),m("div",ye,[s("p",null,"No observations found for "+I(n.value),1)])):(i(),b(ee(te),{key:2,ref:"dataTable",class:"display nowrap modern-table",width:"100%",data:v.value,columns:M.value,options:K.value},{default:f(()=>t[2]||(t[2]=[s("thead",null,[s("tr",null,[s("th",null,"Observation"),s("th",null,"Value"),s("th",null,"Date")])],-1)])),_:1,__:[2]},8,["data","columns","options"]))])])]),_:1})]),_:1})])}}}),Oe=ce(ge,[["__scopeId","data-v-eabefd69"]]);export{Oe as default};

import{d as Z,cj as q,b2 as H,au as Q,r as u,w as X,y as c,f as l,z as s,l as o,u as t,es as ee,k as m,as as te,a9 as ne,e as I,ac as oe,F as ae,L as le,G as se,I as v,et as re,eu as ie,eo as ue,B as W,bN as ce,V as $,U as F,W as N,A as B,dP as de,bM as fe,b0 as ve,aZ as pe,m as O,e4 as me,cT as ye,dv as ke,cz as ge,ev as _e,af as we}from"./vendor-TY9m0NZU.js";import{S as L,u as Ie,T as Te,m as E,a$ as xe,ac as z,_ as be}from"./index-CBoLhjht.js";import{P as he,i as Ce,a as Se}from"./ProviderFormOption-BJXw9Q03.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-BIuG5FXD.js";class h extends L{constructor(){super()}static nextTask(y){return super.getJson("/workflows/".concat(super.getProgramID(),"/").concat(y),{date:super.getSessionDate()})}static async getNextTaskParams(y,C=""){let p=C;try{if(!p){const{name:g}=await h.nextTask(y);p=g}}catch(g){p=""}return{name:p.toLowerCase(),params:{patient_id:y}}}}const De={key:1,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},Pe={class:"ion-page",id:"main"},Ne={key:0,class:"placeholder-content"},Be={style:{margin:"0px auto"},class:"ion-text-center"},Ee={key:1},Re={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}},Ae={style:{color:"black"}},Ve=Z({__name:"ARTVisit",setup(We){const y=q(),C=Ie(),{patient:p}=H(C),g=Q(),d=u(-1),T=u(null),a=u([]),R=u([]),_=u(!1),S=u(-1),k=u(""),w=u(""),A=u(""),D=u(!1),x=u(null);function M(n){var e;return R.value.includes((e=n==null?void 0:n.encounterTypeID)!=null?e:0)}function b(n){var e;return n?!_.value&&S.value===(n==null?void 0:n.encounterTypeID)||((e=n==null?void 0:n.otherWorkflowNames)!=null?e:[]).includes(k.value):!1}function U(){if(a.value.length===0||d.value===a.value.length-1)return!1;const n=a.value[d.value];return n&&b(n)}async function Y(){const n=await xe.getEncounters(p.value.patientID,{date:h.getSessionDate()});R.value=n.map(e=>e.encounter_type)}async function V(){var n,e;D.value=(n=L.isBDE())!=null?n:!1,A.value="",_.value=!0,w.value="",k.value="";try{const i=await h.nextTask(p.value.patientID);if(!i){w.value="No workflows found. You may exit this page or refresh",_.value=!1,d.value=-1;return}k.value=i.name,S.value=(e=i==null?void 0:i.encounter_type_id)!=null?e:-1;const r=a.value.findIndex(f=>{var P;return(f==null?void 0:f.encounterTypeID)===S.value||((P=f.otherWorkflowNames)!=null?P:[]).includes(k.value)});if(r!==-1){A.value=i.description;const f=[...a.value.slice(r),...a.value.slice(0,r)];a.value=f,d.value=0}else w.value=k.value?'"'.concat(k.value,'" is not available in the current workflow. Contact your administrator or update ART activity selection'):"No next task found",d.value=r}catch(i){w.value="An error has occured while loading next task: "+i,console.error(i)}finally{await Y(),_.value=!1}}async function j(){d.value=-1,a.value=[];try{const n=z.map(async e=>{if(!(typeof e.disabled=="function"&&e.disabled(z))){if(e.workflowID&&e.component){if(!await Ce(e.workflowID)||!await Se(e.workflowID))return}else return;return e}});a.value=(await Promise.all(n)).filter(e=>e!==void 0)}catch(n){E("Unable to load activities"),console.error(n)}}function G(){if(D.value)if(x.value){if(!x.value.isProviderSelected()){E("Please select a provider"),x.value.openModal();return}}else{E("BDE Provider component is not available");return}return T.value&&typeof T.value.onSubmit=="function"?T.value.onSubmit():Promise.resolve(!0)}function J(){G().then(n=>n&&V())}function K(n){if(n<0||n>=a.value.length)return;const e=a.value[n];e&&b(e)&&(d.value=n)}return X(()=>y.fullPath,()=>{j().then(V)},{immediate:!0,deep:!0}),(n,e)=>(l(),c(t(we),null,{default:s(()=>[o(Te),o(t(ee),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:s(()=>{var i;return[o(t(te),{contentId:"main"},{default:s(()=>[o(t(ne),null,{default:s(()=>[a.value.length>0?(l(),c(t(oe),{key:0},{default:s(()=>[(l(!0),I(ae,null,le(a.value,(r,f)=>(l(),c(t(se),{onClick:P=>K(f),lines:"none",key:f,disabled:!b(r),button:""},{default:s(()=>[M(r)?(l(),c(t(v),{key:0,icon:t(re),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):b(r)?(l(),c(t(v),{key:2,icon:t(ue),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(l(),c(t(v),{key:1,icon:t(ie),style:{padding:"10px"},slot:"start"},null,8,["icon"])),m("b",null,W(r.name),1)]),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(l(),I("div",De,[o(t(v),{style:{"font-size":"2rem"},icon:t(ce)},null,8,["icon"]),e[2]||(e[2]=m("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),o(t($),null,{default:s(()=>[o(t(F),{color:"light"},{default:s(()=>[o(t(N),{onClick:e[0]||(e[0]=r=>t(g).back())},{default:s(()=>[o(t(v),{icon:t(de),slot:"start"},null,8,["icon"]),e[3]||(e[3]=B(" Back to dashboard "))]),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),m("div",Pe,[_.value?(l(),I("div",Ne,[m("div",Be,[o(t(fe),{name:"bubbles"}),e[4]||(e[4]=m("p",null,[m("h1",null,"Please wait...")],-1))])])):(i=a.value[d.value])!=null&&i.component?(l(),I("div",Ee,[o(t(ve),null,{default:s(()=>[o(t(pe),null,{default:s(()=>{var r;return[D.value?(l(),c(he,{key:0,ref_key:"bdeProviderComponent",ref:x},null,512)):O("",!0),(l(),c(me,null,[(l(),c(ye((r=a.value[d.value])==null?void 0:r.component),{ref_key:"formRef",ref:T},null,512))],1024))]}),_:1})]),_:1})])):(l(),I("div",Re,[o(t(v),{style:{color:"green","font-size":"80px"},icon:t(ke)},null,8,["icon"]),m("h2",Ae,W(w.value),1),o(t(N),{size:"large",fill:"clear",onClick:e[1]||(e[1]=r=>t(g).back())},{default:s(()=>[o(t(v),{slot:"start",icon:t(ge)},null,8,["icon"]),e[5]||(e[5]=B(" Exit page "))]),_:1,__:[5]})])),o(t($),null,{default:s(()=>[o(t(F),{color:"light"},{default:s(()=>[U()?(l(),c(t(N),{key:0,onClick:J,color:"primary",style:{padding:"4px"},slot:"end"},{default:s(()=>[e[6]||(e[6]=B(" Save and continue ")),o(t(v),{style:{padding:"4px"},icon:t(_e),slot:"end"},null,8,["icon"])]),_:1,__:[6]})):O("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),Me=be(Ve,[["__scopeId","data-v-b525e13c"]]);export{Me as default};

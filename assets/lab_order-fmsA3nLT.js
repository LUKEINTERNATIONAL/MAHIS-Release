var ut=Object.defineProperty;var ct=(t,e,s)=>e in t?ut(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var O=(t,e,s)=>ct(t,typeof e!="symbol"?e+"":e,s);import{R as et,d as T,ar as k,V as H,as as z,af as st,D as nt,dk as at,dv as ot,ac as q,G as V,T as L,U as F,a9 as M,S as N,b8 as W,W as x,aU as J,X as G,E as o,y as B,f as w,z as a,l as n,k as f,B as R,A as y,e as it,F as lt,L as pt,a0 as mt,a3 as _t,a1 as ht,a2 as ft,I as vt,aa as bt,ab as gt,a8 as yt}from"./vendor-Oa4k5SKv.js";import{aP as X,az as v,D as E,aO as Dt,S as h,C as U,H as $,ax as rt,k as It,u as dt,_ as P,i as A,aE as St,B as wt,aF as Ot,x as _,ay as K,bm as Rt,t as Tt}from"./index-C-PUWSbe.js";import{B as Y}from"./BasicForm-DcS8ncwU.js";import{D as Ct}from"./DashBox-C_lRo1xq.js";import{v as Q}from"./group_validation-YXlptIyC.js";const Z=et("labResultsStore",{state:()=>({labResults:[]}),actions:{setLabResults(t){this.labResults=t}},persist:!0});class $t extends X{constructor(s){super(s,32);O(this,"patientID");O(this,"testTypeID");O(this,"resultDate");O(this,"testID");this.patientID=s,this.testTypeID=-1,this.resultDate="",this.testID=-1}createLabResult(s){return X.postJson("lab/tests/".concat(this.testID,"/results"),{encounter_id:this.encounterID,date:this.resultDate,measures:s})}getTestID(){return this.testID}getTestTypeID(){return this.testTypeID}setTestTypeID(s){this.testTypeID=s}setResultDate(s){this.resultDate=s}setTestID(s){this.testID=s}getTestsWithoutResults(){return v.getOrders(this.patientID,{status:"drawn"})}getTestIndicators(){return v.getJson("lab/test_result_indicators",{test_type_id:this.testTypeID})}static getTestIndicatorsWithID(s){return v.getJson("lab/test_result_indicators",{test_type_id:s})}}const kt=T({components:{IonButtons:J,IonButton:x,IonModal:W,IonHeader:N,IonContent:M,IonToolbar:F,IonTitle:L,IonItem:V,IonList:q,IonAvatar:ot,IonImg:at,IonLabel:nt,IonPage:st,IonMenu:z,BasicForm:Y,IonFooter:H,DynamicButton:E},data(){return{popoverStatus:null}},props:{keyboardClose:{type:Boolean,default:!1},keepContentsMounted:{type:Boolean,default:!1},content:{type:Object,default:{}},popoverOpen:{type:Boolean,default:!1},event:{type:Event,default:""},title:{type:String,default:""}},computed:{...k(dt,["patient"]),...k(Z,["labResults"])},mounted(){},methods:{dismiss(){G.dismiss()},async saveResults(){const t=await this.buildResults();this.patient.labOrders.results=[{encounter_id:"",date:$.sessionDate(),measures:t,test_id:this.labResults[0].id}];let e=!1;for(let s=0;s<this.patient.labOrders.unsaved.length;s++)if(this.patient.labOrders.unsaved[s].tests[0].id===this.labResults[0].id&&this.patient.labOrders.unsaved[s].tests&&this.patient.labOrders.unsaved[s].tests.length>0){this.patient.labOrders.unsaved[s].tests[0].result=t,e=!0;break}if(!e){for(let s=0;s<this.patient.labOrders.saved.length;s++)if(this.patient.labOrders.saved[s].tests[0].id===this.labResults[0].id&&this.patient.labOrders.saved[s].tests&&this.patient.labOrders.saved[s].tests.length>0){this.patient.labOrders.saved[s].tests[0].result=t;break}}await rt(this.patient),It("Saved successfully"),this.$emit("saved")},async buildResults(){let t=[];return await Promise.all(this.labResults[1].data.rowData[0].colData.map(async e=>{var i;let s;h.getUseIndexDBStatus()||h.getModsStatus()?s=await U("testResultIndicators",{whereClause:{test_type_id:e.id}}):s=await $t.getTestIndicatorsWithID(e.id),t.push({indicator:{name:(i=s[0])==null?void 0:i.name,concept_id:e.id},value:e.value.name||e.value||"not done",value_modifier:"",value_type:"text"})})),t},async nav(t,e){const s=Z();e=="not_save"?(await Dt(),s.setLabResults(!1)):s.setLabResults(!0),this.dismiss(),this.$router.push(t)}}}),Bt={class:"modal_wrapper"},Lt={class:"center text_12"};function Ft(t,e,s,i,D,c){const l=o("ion-title"),r=o("ion-button"),d=o("ion-buttons"),u=o("ion-toolbar"),b=o("ion-header"),p=o("basic-form"),g=o("ion-row"),I=o("ion-content"),S=o("DynamicButton"),m=o("ion-footer"),C=o("ion-modal");return w(),B(C,{"is-open":t.popoverOpen,"show-backdrop":!0,onDidDismiss:e[2]||(e[2]=j=>t.$emit("closePopoover",!1)),"keyboard-close":t.keyboardClose},{default:a(()=>[n(b,null,{default:a(()=>[n(u,null,{default:a(()=>[n(l,null,{default:a(()=>[f("b",null,"Enter lab results for ("+R(t.labResults[0].name)+") test",1)]),_:1}),n(d,{slot:"end"},{default:a(()=>[n(r,{onClick:e[0]||(e[0]=j=>t.$emit("closeModal"))},{default:a(()=>e[3]||(e[3]=[y("Close")])),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),n(I,{class:"ion-padding"},{default:a(()=>[f("div",Bt,[f("div",Lt,[n(g,null,{default:a(()=>[n(p,{contentData:t.labResults},null,8,["contentData"])]),_:1})])])]),_:1}),n(m,{translucent:!0},{default:a(()=>[n(u,null,{default:a(()=>[n(S,{onClick:e[1]||(e[1]=j=>t.saveResults()),name:"Save",fill:"clear",iconSlot:"icon-only",style:{float:"right"}})]),_:1})]),_:1})]),_:1},8,["is-open","keyboard-close"])}const Qt=P(kt,[["render",Ft],["__scopeId","data-v-a9001ab2"]]),Mt=T({components:{IonButtons:J,IonButton:x,IonModal:W,IonHeader:N,IonContent:M,IonToolbar:F,IonTitle:L,IonItem:V,IonList:q,IonAvatar:ot,IonImg:at,IonLabel:nt,IonPage:st,IonMenu:z,BasicForm:Y,IonFooter:H,DynamicButton:E},data(){return{popoverStatus:null}},props:{keyboardClose:{type:Boolean,default:!1},keepContentsMounted:{type:Boolean,default:!1},content:{default:[]},popoverOpen:{type:Boolean,default:!1},event:{type:Event,default:""},title:{type:String,default:""}},methods:{dismiss(){G.dismiss()},nav(t,e){this.dismiss(),this.$router.push(t)}}}),Nt={class:"modal_wrapper"},Et={class:"center text_12"};function Pt(t,e,s,i,D,c){const l=o("ion-title"),r=o("ion-button"),d=o("ion-buttons"),u=o("ion-toolbar"),b=o("ion-header"),p=o("ion-col"),g=o("ion-row"),I=o("ion-content"),S=o("ion-modal");return w(),B(S,{"is-open":t.popoverOpen,"show-backdrop":!0,onDidDismiss:e[1]||(e[1]=m=>t.$emit("closePopoover",!1)),"keyboard-close":t.keyboardClose},{default:a(()=>[n(b,null,{default:a(()=>[n(u,null,{default:a(()=>[n(l,null,{default:a(()=>[f("b",null,"Lab results for ("+R(t.content.name)+") test",1)]),_:1}),n(d,{slot:"end"},{default:a(()=>[n(r,{onClick:e[0]||(e[0]=m=>t.$emit("closeModal"))},{default:a(()=>e[2]||(e[2]=[y("Close")])),_:1,__:[2]})]),_:1})]),_:1})]),_:1}),n(I,{class:"ion-padding"},{default:a(()=>[f("div",Nt,[f("div",Et,[n(g,null,{default:a(()=>[(w(!0),it(lt,null,pt(t.content.result,(m,C)=>(w(),B(p,{size:"4",key:C},{default:a(()=>[n(g,null,{default:a(()=>[n(p,{size:"8"},{default:a(()=>[y(R(m.indicator.name),1)]),_:2},1024),n(p,{class:"bold",size:"0.5"},{default:a(()=>e[3]||(e[3]=[y(":")])),_:1,__:[3]}),n(p,{class:"bold",size:"2"},{default:a(()=>[y(R(m.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),_:1})]),_:1},8,["is-open","keyboard-close"])}const Zt=P(Mt,[["render",Pt],["__scopeId","data-v-5d6713fe"]]),tt=et("investigationNCDStore",{state:()=>({investigations:[{db_data:[],isFinishBtn:!1,selectedData:[],displayData:[],data:{rowData:[{colData:[{inputHeader:"Test",icon:A.search,value:"",name:"test",popOver:!0,eventType:"input",required:!0,alertsErrorMassage:"",isSingleSelect:!0,trackBy:"concept_id",multiSelectData:[],id:"",idName:"test_id",validationFunctionName:"required"},{inputHeader:"Specimen",icon:A.search,value:"",name:"specimen",eventType:"input",required:!0,alertsErrorMassage:"",disabled:!0,isSingleSelect:!0,trackBy:"concept_id",multiSelectData:[],id:"",idName:"specimen_id",validationFunctionName:"required"}]}]}}]}),actions:{setInvestigations(t){this.investigations=t}}}),Ut=T({data:()=>({userRole:"",ready:!1,userRoleSettings:{}}),watch:{$route:{async handler(t){this.userRole=h.getUserRoles();const e=h.getProgramID(),s=h.getProgramName();this.userRole=="Lab"&&e==14&&(this.userRoleSettings={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}),e==14&&this.userRole!="Lab"&&(this.userRoleSettings={url:"home",btnName:"Go to waiting list",stepperTitle:"Consultation Plan"}),e==12&&(this.userRoleSettings={url:"contact",btnName:"Back"}),s=="LABOUR AND DELIVERY PROGRAM"&&(this.userRoleSettings={url:"labour/labourHome",btnName:"Back to home"}),s=="PNC PROGRAM"&&(this.userRoleSettings={url:"pnc/home",btnName:"Back to home"})},immediate:!0,deep:!0}}}),At=T({name:"Menu",mixins:[Ut],components:{IonContent:M,IonHeader:N,IonItem:V,IonList:q,IonMenu:z,IonTitle:L,IonToolbar:F,IonInput:_t,IonPopover:mt,DashBox:Ct,SelectionPopover:Ot,BasicInputField:wt,BasicForm:Y,List:St,DynamicButton:E},data(){return{segmentContent:"Lab Investigations",iconsContent:A,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",testResult:"",test:"",labOrders:"",filteredSpecimen:"",testData:[],popoverOpen:!1,labOrderStatus:!1,event:"",specimen:"",radiologyOrdersStatus:!1,otherOrdersStatus:!1}},setup(){return{checkmark:ft,pulseOutline:ht}},computed:{...k(tt,["investigations"]),...k(dt,["patient"]),inputFields(){return this.investigations[0].data.rowData[0].colData}},watch:{investigations:{handler(){this.setDashedBox()},deep:!0},patient:{async handler(){this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved]},deep:!0},$route:{async handler(){await this.getTests()},deep:!0}},async mounted(){await this.getTests(),this.updateInvestigationsStores(),this.setDashedBox(),this.updateInvestigationWizard()},methods:{dismiss(){G.dismiss()},setSegmentContent(t){this.segmentContent=t},async getTests(){let t;h.getUseIndexDBStatus()&&h.getModsStatus()?t=await U("testTypes"):t=await v.getTestTypes(),_(this.investigations,"test","multiSelectData",t)},toggleLabOrderStatus(){this.labOrderStatus=!this.labOrderStatus},async updateInvestigationWizard(){this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved];const t=await this.labOrders.filter(e=>$.toStandardHisFormat($.sessionDate())===$.toStandardHisFormat(e.order_date));t.length>0?this.investigations[0].selectedData=t:this.investigations[0].selectedData=""},async updateInvestigationsStores(){await this.updateInvestigationWizard(),tt().setInvestigations(this.investigations)},displayInputFields(){this.testResult="",this.selectedText="",this.no_item=!1,this.addItemButton=!1,this.search_item=!0},async validateRowData(){return Q(this.investigations)},async checkTest(){return await this.isNameInData(this.inputFields[0].value.name,await this.investigations[0].selectedData)?(_(this.investigations,"test","alertsErrorMassage","Lab order already selected"),!1):(_(this.investigations,"test","alertsErrorMassage",""),!0)},async addNewRow(){Q(this.investigations)&&await this.checkTest()&&(await this.saveTest(),this.investigations[0].data.rowData[0].colData[0].value="",this.investigations[0].data.rowData[0].colData[1].value="",this.search_item=!1,this.display_item=!0,this.addItemButton=!0),this.updateInvestigationWizard(),this.dismiss()},isNameInData(t,e){for(let s of e)for(let i of s.tests)if(i.name===t)return!0;return!1},async saveTest(){var D,c,l,r,d,u;const t=[{concept_id:this.inputFields[0].value.concept_id,name:this.inputFields[0].value.name,specimen:this.inputFields[1].value.name,reason:"Routine",specimenConcept:await K.getConceptID(this.inputFields[1].value.name,!0)}];let s=(await v.buildLabOrders("",t))[0];s.order_date=s.date,s.specimen.name=this.inputFields[1].value.name,s.tests[0].name=this.inputFields[0].value.name;const i=JSON.parse(JSON.stringify(this.patient));(l=(c=(D=i.labOrders)!=null?D:i.labOrders={}).unsaved)!=null||(c.unsaved=[]),(u=(d=(r=i.labOrders)!=null?r:i.labOrders={}).saved)!=null||(d.saved=[]),i.labOrders.unsaved.push(s),await rt(i),_(this.investigations,"specimen","disabled",!0),this.labOrders=[...i.labOrders.saved,...i.labOrders.unsaved]},async handleInputData(t){if(t.inputHeader=="Test"&&this.checkTest(),_(this.investigations,"specimen","alertsErrorMassage",""),t.inputHeader=="Test"&&t.value){let e;h.getUseIndexDBStatus()&&h.getModsStatus()?e=await U("specimens"):e=await v.getSpecimens("",1e3),this.specimen=await K.getConceptSet(t.value.name,"",{names:e.map(s=>s.name)}),this.specimen.length==1?(_(this.investigations,"specimen","value",this.specimen[0]),_(this.investigations,"specimen","disabled",!0)):(_(this.investigations,"specimen","value",""),_(this.investigations,"specimen","disabled",!1)),_(this.investigations,"specimen","multiSelectData",this.specimen)}},async filterTest(t){return await this.labOrders.filter(e=>e.name.toLowerCase().includes(t.toLowerCase()))},async filterSpecimen(t){var e;return(e=this.specimen[0])!=null&&e.name&&t?await this.specimen.filter(s=>s==null?void 0:s.name.toLowerCase().includes(t.toLowerCase())):[]},setTest(t){this.selectedText=t.name,this.inputFields[1].inputHeader=="Test"?this.investigations[0].data.rowData[0].colData[0].value=t.name:this.investigations[0].data.rowData[0].colData[1].value=t.name,this.updateInvestigationsStores()},setDashedBox(){(this.inputFields[1].value||this.inputFields[0].value)&&(this.addItemButton=!1,this.search_item=!0,this.no_item=!1),this.investigations[0].selectedData.length>0?(this.display_item=!0,this.no_item=!1):this.search_item||(this.no_item=!0)}}}),Ht={class:"modal_wrapper"},zt={class:""};function qt(t,e,s,i,D,c){const l=o("ion-title"),r=o("ion-icon"),d=o("ion-header"),u=o("basic-form"),b=o("ion-content"),p=o("DynamicButton"),g=o("ion-col"),I=o("ion-row"),S=o("ion-footer");return w(),it(lt,null,[n(d,{style:{display:"flex","justify-content":"space-between"}},{default:a(()=>[n(l,{class:"modalTitle"},{default:a(()=>e[2]||(e[2]=[y("Add Lab Test")])),_:1,__:[2]}),n(r,{onClick:e[0]||(e[0]=m=>t.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:t.iconsContent.cancel},null,8,["icon"])]),_:1}),n(b,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:a(()=>[f("div",Ht,[f("div",zt,[n(u,{contentData:t.investigations,"onUpdate:selected":t.handleInputData,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:selected","onUpdate:inputValue"])])])]),_:1}),n(S,{collapse:"fade",class:"ion-no-border"},{default:a(()=>[n(I,null,{default:a(()=>[n(g,null,{default:a(()=>[n(p,{onClick:e[1]||(e[1]=m=>t.addNewRow()),name:"Save",fill:"solid",style:{float:"right",margin:"2%",width:"130px"}})]),_:1})]),_:1})]),_:1})],64)}const te=P(At,[["render",qt],["__scopeId","data-v-bae5aa39"]]),Vt=T({name:"CheckInConfirmationModal",components:{IonCol:gt,IonRow:bt,IonFooter:H,DynamicButton:E,IonModal:W,IonHeader:N,IonToolbar:F,IonTitle:L,IonButtons:J,IonButton:x,IonContent:M,IonIcon:vt},props:{isOpen:{type:Boolean,required:!0,default:!1},closeModalFunc:{type:Function,required:!0},onYes:{type:Function,required:!0},onNo:{type:Function,required:!0},title:{type:String,required:!0}},computed:{},methods:{closeOutline(){return yt},closeModal(){this.closeModalFunc()},confirm(t){this.closeModal()}}}),Wt={style:{display:"flex"}};function xt(t,e,s,i,D,c){const l=o("ion-title"),r=o("ion-icon"),d=o("ion-button"),u=o("ion-buttons"),b=o("ion-col"),p=o("DynamicButton"),g=o("ion-row"),I=o("ion-footer"),S=o("ion-content"),m=o("ion-modal");return w(),B(m,{"is-open":t.isOpen,"show-backdrop":!0,onDidDismiss:t.closeModal},{default:a(()=>[n(u,{slot:"start"},{default:a(()=>[n(l,{style:{color:"#0c0c0c"}},{default:a(()=>[y(R(t.title),1)]),_:1}),n(d,{onClick:t.closeModal},{default:a(()=>[n(r,{slot:"icon-only",icon:t.closeOutline(),style:{color:"#b02a37"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:1}),n(S,null,{default:a(()=>[f("div",Wt,[n(I,{collapse:"fade",class:"ion-no-border"},{default:a(()=>[n(g,null,{default:a(()=>[n(b,null,{default:a(()=>[n(d,{id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"},onClick:t.onNo},{default:a(()=>e[1]||(e[1]=[y(" Cancel ")])),_:1,__:[1]},8,["onClick"])]),_:1}),n(b,null,{default:a(()=>[n(p,{name:"Send",onClick:e[0]||(e[0]=C=>t.onYes()),fill:"solid",style:{float:"right",margin:"2%",width:"130px"}})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1},8,["is-open","onDidDismiss"])}const ee=P(Vt,[["render",xt],["__scopeId","data-v-be6bf3e1"]]);class se extends v{constructor(){super()}async postActivities(e,s){const i=s.location_id,c=await new Rt(parseInt(e),-1,i).createEncounter();if(c){const l=await v.buildLabOrders(c,s.orders||s);if(!await v.saveOrdersArray(c.encounter_id,l))return Tt("Unable to save lab orders")}}}export{te as E,Zt as L,$t as P,ee as S,Ut as _,Qt as a,se as b,Z as u};

import{d as J,c as w,y as k,f,z as i,l as r,u as s,S as Q,U as Z,k as o,T as Y,A as h,ah as W,ai as B,aj as M,an as X,X as V,cn as q,r as y,w as j,a as G,e as T,cy as ee,n as te,m as C,bQ as ne,G as z,D as R,d5 as ae,ak as se,F as re,L as oe,B as ie,W as U,p as le}from"./vendor-dNDOhqnE.js";import{i as A,au as N,D as E,av as H,S as P,_ as K,j as de,n as $,C as O,aw as ue,T as ce}from"./index-CsAvUa8E.js";import{u as pe}from"./useExposeFromStandardForm-D0AH3uGd.js";import{u as fe}from"./useLocation-CxRG_u_T.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-Sa00GEsj.js";const me={style:{display:"flex","justify-content":"space-between"}},_e={style:{"max-width":"500px",margin:"auto"}},ge=J({__name:"AddWebPrinter",setup(L){const{formRef:m}=pe(),{facilityList:g,getFacilities:_}=fe();_();const c=w(()=>[{componentType:"inputField",header:"Print name",name:"printer_name",icon:A.print,validation:d=>N.required(d)},{componentType:"inputField",header:"Printer IP address",name:"ip_address",icon:A.networkBarDark,validation:d=>N.required(d)},{componentType:"multiSelectInputField",header:"Facility",name:"location_id",trackBy:"facility_id",openDirection:"auto",icon:A.search,validation:d=>N.required(d),options:g.value.facilities}]),v=()=>{V.dismiss()},p=()=>{var u;const d=(u=m.value)==null?void 0:u.getFormValues();d.location_id=d.location_id.code,P.postJson("/printer_configurations",d),V.dismiss()};return(d,u)=>(f(),k(s(X),null,{default:i(()=>[r(s(Q),null,{default:i(()=>[r(s(Z),null,{default:i(()=>[o("div",me,[r(s(Y),null,{default:i(()=>u[2]||(u[2]=[h("Add Web Printer",-1)])),_:1,__:[2]}),r(E,{name:"X",style:{"margin-right":"10px"},onClick:u[0]||(u[0]=b=>v())})])]),_:1})]),_:1}),r(s(W),{class:"ion-padding"},{default:i(()=>[o("div",_e,[r(s(B),null,{default:i(()=>[r(s(M),{size:"12"},{default:i(()=>[r(H,{formData:c.value,ref_key:"formRef",ref:m},null,8,["formData"])]),_:1})]),_:1}),r(s(B),{class:"ion-justify-content-end ion-margin-top"},{default:i(()=>[r(s(M),{size:"auto"},{default:i(()=>[r(E,{name:"Add printer",onClick:u[1]||(u[1]=b=>p())})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),ve=K(ge,[["__scopeId","data-v-bce6abd1"]]),ye={class:""},Pe={class:"table-header",style:{display:"flex","justify-content":"space-between","align-items":"center"}},be={style:{"min-width":"400px",display:"flex","align-items":"center"}},Ie={class:"table-responsive"},Se={key:0,class:"loading-state"},ke={key:1,class:"empty-state"},we=J({__name:"ManageIPPrinters",setup(L){const m=q(),g=y([]),_=y(!1),c=y(null),v=w(()=>({paging:!0,lengthChange:!1,searching:!1,ordering:!0,info:!0,autoWidth:!0,responsive:!0,pageLength:8})),p=w(()=>[{data:0,title:"Printer name"},{data:1,title:"Ip address"},{data:2,title:"Date"},{data:3,title:"Actions",orderable:!1,className:"text-left"}]),d=w(()=>[{componentType:"multiSelectInputField",value:P.getDefaultPrinter()||"",trackBy:"id",onChange:e=>{localStorage.setItem("defaultPrinter",JSON.stringify(e))},options:g.value.map(e=>({name:e.printer_name,id:e._id,ip_address:e.ip_address}))}]),u=w(()=>b(g.value)),b=e=>e.length>0?e.map(t=>[t.printer_name,t.ip_address,t.created_at,'<div class="action-buttons">\n                    <button class="test-print-btn action-button" data-id=\''.concat(JSON.stringify({id:t._id,printer_name:t.printer_name,ip_address:t.ip_address,created_at:t.created_at,location_id:t.location_id}),"'>Test Print</button>\n                    <button class=\"edit-btn action-button\" data-id='").concat(JSON.stringify({id:t._id,printer_name:t.printer_name,ip_address:t.ip_address,created_at:t.created_at,location_id:t.location_id}),"'>Edit</button>\n                    <button class=\"delete-btn action-button delete-button\" data-id='").concat(JSON.stringify({id:t._id,printer_name:t.printer_name,ip_address:t.ip_address,created_at:t.created_at,location_id:t.location_id}),"'>Delete</button>\n                </div>")]):[],I=()=>{te(()=>{const e=c.value.dt;e.columns.adjust().draw(),e.off("click",".test-print-btn"),e.off("click",".edit-btn"),e.off("click",".delete-btn"),e.on("click",".test-print-btn",t=>{const l=t.target.getAttribute("data-id");n(JSON.parse(l))}),e.on("click",".edit-btn",t=>{const l=t.target.getAttribute("data-id");S(JSON.parse(l))}),e.on("click",".delete-btn",t=>{const l=t.target.getAttribute("data-id");F(JSON.parse(l))})})},D=async(e=null)=>{await de(ve,{class:"large-modal"},!0),await a()},S=async e=>{console.log("Editing printer:",e),O("Edit functionality for ".concat(e.printer_name," is under development."))},F=async e=>{if(confirm("Are you sure you want to delete printer: ".concat(e.printer_name,"?")))try{await P.delete("/printer_configurations/".concat(e.id),{id:e.id}),O("Printer ".concat(e.printer_name," deleted successfully!")),await a()}catch(t){console.error("Error deleting printer:",t),$("Failed to delete printer ".concat(e.printer_name,"."))}},n=async e=>{const t="^XA\n        ^FO50,50^A0N,60,60^FDTest Print from Vue App!^FS\n        ^FO50,150^A0N,30,30^FDPrinter: ".concat(e.printer_name,"^FS\n        ^FO50,200^A0N,30,30^FDIP Address: ").concat(e.ip_address,"^FS\n        ^XZ");try{const l=await fetch("https://".concat(e.ip_address,"/print"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({zpl:t})});if(l.ok)O("Test print sent successfully to ".concat(e.printer_name));else{const x=await l.json();$("Failed to send test print to ".concat(e.printer_name,". Error: ").concat(x.message||l.statusText))}}catch(l){console.error("Error sending test print:",l),$("Error sending test print to ".concat(e.printer_name,". Please check your network or server connection."))}},a=async()=>{_.value=!0;try{g.value=await P.getJson("/printer_configurations",{location_id:P.getUserLocationId()}),I()}catch(e){console.error("Error loading printer configurations:",e),$("Failed to load printer configurations.")}finally{_.value=!1}};return j(m,async()=>{await a()},{deep:!0}),j(u,()=>{I()}),G(async()=>{P.getDefaultPrinter(),console.log("ðŸš€ ~ onMounted ~ Service.getDefaultPrinter():",P.getDefaultPrinter()),await a()}),(e,t)=>(f(),T("div",ye,[o("div",null,[o("div",Pe,[t[2]||(t[2]=o("h3",{class:"encounter-title"},"Manage web printers",-1)),o("div",be,[t[1]||(t[1]=o("span",{style:{"font-weight":"700"}},"Default Printer",-1)),r(H,{formData:d.value,ref:"formRef"},null,8,["formData"])]),r(E,{name:"Add printer",fill:"solid",onClick:t[0]||(t[0]=l=>D())})]),o("div",Ie,[_.value?(f(),T("div",Se,t[3]||(t[3]=[o("p",null,"Loading printers...",-1)]))):g.value.length===0?(f(),T("div",ke,t[4]||(t[4]=[o("p",null,"No printers found",-1)]))):(f(),k(s(ee),{key:2,ref_key:"dataTableRef",ref:c,class:"display nowrap modern-table",width:"100%",data:u.value,columns:p.value,options:v.value},{default:i(()=>t[5]||(t[5]=[o("thead",null,[o("tr",null,[o("th",null,"Printer name"),o("th",null,"Ip address"),o("th",null,"Date"),o("th",null,"Actions")])],-1)])),_:1,__:[5]},8,["data","columns","options"]))])])]))}}),he={key:0,class:"spinner-overlay"},Te={class:"container"},$e=J({__name:"ManagePrinters",setup(L){q();const m=y(!1),g=y(Math.random()),_=y([]),c=y({}),v=new ue,p=y(!1);function d(){try{localStorage.setItem("isIpPrinters",JSON.stringify(p.value)),console.log("isIpPrinters state saved:",p.value)}catch(n){console.error("Error saving isIpPrinters state to localStorage:",n)}}function u(){try{const n=localStorage.getItem("isIpPrinters");n!==null&&(p.value=JSON.parse(n),console.log("isIpPrinters state loaded:",p.value))}catch(n){console.error("Error loading isIpPrinters state from localStorage:",n)}}async function b(){if(!m.value){m.value=!0;try{const n=await v.getAllPrinters();console.log("Discovered printers",JSON.stringify(n)),_.value=F(n)}catch(n){console.error("Error loading printers:",n)}finally{m.value=!1,g.value=Math.random()}}}function I(n,a){const e=n.name||"",t=a.name||"",l=n.address||"",x=a.address||"";return e!==t?e.localeCompare(t):l.localeCompare(x)}function D(n){v.setDefaultPrinter(n),c.value=n,g.value=Math.random(),b()}function S(n){return I(n,c.value)===0}function F(n){return n.sort((a,e)=>{const t=S(a),l=S(e);return t&&!l?-1:!t&&l?1:I(a,e)})}return G(async()=>{u(),c.value=await v.getDefaultPrinter()||{},c.value&&(c.value.name||c.value.address)&&(_.value.some(a=>I(a,c.value)===0)||_.value.push(c.value)),b()}),(n,a)=>(f(),k(s(X),{class:le({loading:m.value})},{default:i(()=>[m.value?(f(),T("div",he,[r(s(ne),{name:"bubbles"}),a[1]||(a[1]=o("div",{class:"loading-text"},"Please wait...",-1))])):C("",!0),r(ce),r(s(W),null,{default:i(()=>[o("div",Te,[a[5]||(a[5]=o("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Printer Management",-1)),r(s(z),null,{default:i(()=>[r(s(R),null,{default:i(()=>a[2]||(a[2]=[h("Use IP Printers",-1)])),_:1,__:[2]}),r(s(ae),{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),onIonChange:d},null,8,["modelValue"])]),_:1}),p.value?C("",!0):(f(),k(s(se),{key:0},{default:i(()=>[(f(!0),T(re,null,oe(_.value,e=>(f(),k(s(z),{key:e.name||e.address||"unknown-printer"},{default:i(()=>[r(s(R),null,{default:i(()=>[h(ie(e.name||e.address||"Unnamed Printer"),1)]),_:2},1024),r(s(U),{size:"small",color:S(e)?"success":"primary",onClick:t=>D(e),disabled:S(e)},{default:i(()=>a[3]||(a[3]=[h(" Set as Default ",-1)])),_:2,__:[3]},1032,["color","onClick","disabled"]),r(s(U),{onClick:t=>s(v).printTestLbl(e),size:"small"},{default:i(()=>a[4]||(a[4]=[h(" Test Print ",-1)])),_:2,__:[4]},1032,["onClick"])]),_:2},1024))),128))]),_:1})),p.value?(f(),k(we,{key:1,style:{"margin-top":"10px"}})):C("",!0)])]),_:1})]),_:1},8,["class"]))}}),Oe=K($e,[["__scopeId","data-v-94d8d5a1"]]);export{Oe as default};

import{d as S,O as ye,f as r,r as b,e as u,l as s,J as o,u as t,G as U,E as O,k as n,a_ as R,N as M,L as $,a3 as j,I as re,a5 as ge,a6 as be,a4 as ue,M as de,F as q,R as ce,aO as xe,aV as he,c as V,a as pe,w as _e,cq as we,aj as Ie,m as c,$ as ae,X as Ne,K as m,av as Ce,b2 as De,_ as ke,aE as Pe,bn as $e,Q as L,P as Se,W as Me,da as ie,a8 as Ve}from"./vendor-DAXCTcTD.js";import{u as fe,P as oe,a9 as Oe,aO as ze,_ as me,S as A,J as Ee,o as B,aD as le,bi as Te}from"./index-CU_yUvdq.js";import{R as Le}from"./Registration-ChhbbqIp.js";import{O as Ue}from"./Outcome-bMfJ75FT.js";const Ae=S({__name:"personalInformationModal",setup(a){return(N,I)=>(r(),ye(Le,{editMode:!0}))}}),Be={style:{"font-weight":"400","font-size":"19px"}},Re={style:{display:"flex","align-items":"center"}},je={class:""},qe={class:"center text_12"},Fe=S({watch:{},name:"xxxComponent"}),Ge=S({...Fe,props:{is_open:{},user_id:{}},emits:["closePopover","save"],setup(a,{emit:N}){b("");const I=N;function w(){I("closePopover",!1),ce.dismiss()}return(v,p)=>(r(),u(q,null,[s(t(re),null,{default:o(()=>[s(t(U),null,{default:o(()=>[s(t(O),null,{default:o(()=>[...p[1]||(p[1]=[n("div",{style:{display:"flex","align-items":"center"}},[n("b",{style:{"margin-left":"6px"}},"Patient Outcome")],-1)])]),_:1}),s(t(R),{slot:"end"},{default:o(()=>[s(t(O),null,{default:o(()=>[s(t(M),{onClick:p[0]||(p[0]=x=>w()),fill:"solid"},{default:o(()=>[n("span",Be,[n("div",Re,[s(t($),{icon:t(j),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),p[2]||(p[2]=n("span",{style:{"margin-left":"6px"}},"Close",-1))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(t(ue),{class:"ion-padding"},{default:o(()=>[n("div",je,[n("div",qe,[s(t(ge),null,{default:o(()=>[s(t(be),null,{default:o(()=>[s(Ue)]),_:1})]),_:1})])])]),_:1}),s(t(de),null,{default:o(()=>[s(t(U))]),_:1})],64))}}),Je={style:{display:"flex","align-items":"center"}},Qe={style:{"font-weight":"400","font-size":"19px"}},We={style:{display:"flex","align-items":"center"}},He={style:{"font-weight":"600","font-size":"17px"}},Ke={style:{"margin-top":"15px",width:"100%"}},Xe={key:0,class:"error-message"},Ye={key:1},Ze={slot:"start",class:"prefix-container"},et=["value"],tt={key:0,class:"error-message"},nt={style:{"font-size":"16px","font-weight":"600px",color:"red"}},st={key:1},at={style:{"font-weight":"400","font-size":"19px"}},it={style:{display:"flex","align-items":"center"}},ot={style:{"font-weight":"400","font-size":"20px"}},lt={style:{display:"flex","align-items":"center"}},rt=S({name:"UpdateNCDNumberModal"}),ut=S({...rt,emits:["closePopover","save"],setup(a,{emit:N}){const I=xe(),w=fe(),{patient:v}=he(w),p=b(""),x=b(""),y=b(""),C=b(!1),z=new oe;let h=null;const E=d=>{const i=d.target.value.replace(/[^0-9]/g,"");i!==d.target.value&&(C.value=!0,h&&clearTimeout(h),h=window.setTimeout(()=>{C.value=!1,h=null},3e3),p.value=i)},T=()=>{C.value=!1,h&&(clearTimeout(h),h=null)},l=V(()=>p.value&&p.value.trim()!==""),e=async()=>{try{const d=await Oe.getNextSuggestedNCDNumber(),i=d.ncd_number.replace(/^\D+|\s/g,""),_=d.ncd_number.replace(/\d+/g,"")+"-NCD-";p.value=i,x.value=_}catch(d){console.error("Error fetching suggested NCD number:",d),y.value="Failed to fetch suggested NCD number (missing SITE Prefix)"}};pe(()=>{e()}),_e(()=>v.value.ID,()=>{e()},{deep:!0});const f=N;function D(){f("closePopover",!1),ce.dismiss()}function k(d){try{console.log(d),I.push(d)}catch(i){console.error(i)}}async function P(){try{if(y.value="",!l.value){y.value="Please enter a valid NCD number";return}const d="".concat(x.value).concat(p.value),i=await oe.findByID(v.value.patientID);for(const _ of i.patient_identifiers)_.identifier_type===31&&(await z.updateNCDNumber(_.patient_identifier_id,d),f("save",{newNcdId:d}));await ze(v.value),D()}catch(d){console.error(d)}}return(d,i)=>(r(),u(q,null,[s(t(re),null,{default:o(()=>[s(t(U),null,{default:o(()=>[s(t(O),null,{default:o(()=>[n("div",Je,[s(t($),{icon:t(we),class:"sub-menu-icon",style:{"font-size":"1.6rem"}},null,8,["icon"]),i[3]||(i[3]=n("b",{style:{"margin-left":"6px"}},"Update NCD Number",-1))])]),_:1}),s(t(R),{slot:"end"},{default:o(()=>[s(t(O),null,{default:o(()=>[s(t(M),{onClick:i[0]||(i[0]=_=>D()),fill:"solid"},{default:o(()=>[n("span",Qe,[n("div",We,[s(t($),{icon:t(j),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),i[4]||(i[4]=n("span",{style:{"margin-left":"6px"}},"Close",-1))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(t(ue),{class:"ion-padding"},{default:o(()=>[s(t(Ie),null,{default:o(()=>[s(t(ae),{class:"current-ncd-item"},{default:o(()=>[s(t(Ne),null,{default:o(()=>[i[5]||(i[5]=n("h2",null,"Current NCD Number",-1)),n("p",He,m(t(v).NcdID||"Not assigned"),1)]),_:1})]),_:1}),s(t(ae),null,{default:o(()=>[n("div",Ke,[C.value?(r(),u("div",Xe,[s(t($),{icon:t(Ce),color:"danger"},null,8,["icon"]),i[6]||(i[6]=n("span",{style:{"font-size":"16px","font-weight":"600px",color:"red"}},"Only numbers are allowed",-1)),s(t(M),{fill:"clear",size:"small",onClick:T},{default:o(()=>[s(t($),{icon:t(j)},null,8,["icon"])]),_:1})])):c("",!0),y.value?c("",!0):(r(),u("div",Ye,[i[7]||(i[7]=n("span",{style:{"font-weight":"600","font-size":"17px",color:"grey"}},"New NCD Number",-1)),s(t(De),{modelValue:p.value,"onUpdate:modelValue":i[1]||(i[1]=_=>p.value=_),placeholder:"Enter number",inputmode:"numeric",pattern:"[0-9]*",onInput:E,class:"custom-input"},{default:o(()=>[n("div",Ze,[n("input",{value:x.value,readonly:"",class:"prefix-part",type:"text"},null,8,et)])]),_:1},8,["modelValue"])]))])]),_:1}),y.value?(r(),u("div",tt,[s(t(ke),{color:"danger"},{default:o(()=>[n("span",nt,m(y.value),1)]),_:1})])):c("",!0),y.value?(r(),u("div",st,[s(t(M),{onClick:i[2]||(i[2]=_=>k("setSitePrefix")),fill:"solid",style:{margin:"14px"}},{default:o(()=>[n("span",at,[n("div",it,[s(t($),{icon:t(Pe),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),i[8]||(i[8]=n("span",{style:{"margin-left":"6px"}},"set Site Prefix",-1))])])]),_:1})])):c("",!0)]),_:1})]),_:1}),s(t(de),null,{default:o(()=>[s(t(U),null,{default:o(()=>[s(t(R),{slot:"end"},{default:o(()=>[s(t(O),null,{default:o(()=>[s(t(M),{onClick:P,fill:"solid",disabled:!l.value},{default:o(()=>[n("span",ot,[n("div",lt,[s(t($),{icon:t($e),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),i[9]||(i[9]=n("span",{style:{"margin-left":"6px"}},"Save",-1))])])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})],64))}}),dt=me(ut,[["__scopeId","data-v-f93731e2"]]),ct={key:0,style:{display:"flex","justify-content":"space-between",width:"100%"}},pt={key:0},ft={key:1,style:{"font-weight":"bold",padding:"1.7px"}},mt={key:1,style:{display:"flex","flex-wrap":"wrap",gap:"20px",width:"100%"}},vt={key:0},yt={key:1},gt={key:2},bt={key:2},xt={style:{display:"flex","flex-wrap":"wrap",gap:"8px",width:"100%"}},ht={key:3,style:{display:"flex","flex-wrap":"wrap",gap:"20px",width:"100%"}},_t={key:0},wt={key:1},It={key:2},Nt={key:3},Ct={key:4,style:{width:"100%","text-align":"center","border-collapse":"collapse",border:"1px solid black"}},Dt={key:0},kt={style:{border:"1px solid black"}},Pt={style:{border:"1px solid black"}},$t={style:{border:"1px solid black"}},St={style:{border:"1px solid black"}},Mt=S({__name:"NCDVisitLbl",props:{imageOut:{type:Object},patient:{type:Object}},emits:["label-out"],setup(a,{emit:N}){const I=N,w=b(null),v=b(0),p=b(""),x=b(4),y=a,C=V(()=>{var l;return(l=y.patient)!=null&&l.medications?y.patient.medications.filter(e=>e&&(e.name||e.dose||e.frequency||e.quantity)):[]}),z=V(()=>{var e,f;const l=(e=y.patient)==null?void 0:e.vitals;return l&&(l.height||l.weight||l.bloodPressure||((f=y.patient)==null?void 0:f.bloodGlucose))}),h=V(()=>{const l=C.value;if(l.length===0)return[];if(v.value===0)return l.slice(0,2);{const e=2+(v.value-1)*x.value;return l.slice(e,e+x.value)}}),E=V(()=>{const l=C.value.length;if(l<=2)return 1;const e=l-2;return 1+Math.ceil(e/x.value)}),T=async()=>{const l=[];for(let e=0;e<E.value;e++){v.value=e,await new Promise(f=>setTimeout(f,100));try{let f;A.getIsIpPrintersStatus()?f=await ie.toCanvas(w.value,{height:300,width:800}):f=await ie.toPng(w.value,{height:300,width:594}),l.push(f)}catch(f){console.error("Error generating image for page",e,f)}}return l};return pe(async()=>{try{const l=A.getIsIpPrintersStatus();x.value=l?7:4,p.value=l?"800px":"594px";const e=await T();I("label-out",e),typeof y.imageOut=="function"&&y.imageOut(e)}catch(l){console.error("Error generating patient labels:",l)}}),(l,e)=>{var f,D,k,P,d,i,_,F,G,J,Q,W,H,K,X,Y,Z,ee,te,ne,se;return r(),u("div",{ref_key:"lblComponent",ref:w,id:"container",style:Me("padding: 15px; width:"+p.value)},[v.value===0&&((f=a.patient)!=null&&f.latestVisitDate||(D=a.patient)!=null&&D.patientID)?(r(),u("div",ct,[(k=a.patient)!=null&&k.latestVisitDate?(r(),u("span",pt,[e[0]||(e[0]=n("b",null,"Visit:",-1)),L(" "+m(a.patient.latestVisitDate),1)])):c("",!0),(P=a.patient)!=null&&P.patientID?(r(),u("span",ft,m(a.patient.patientID),1)):c("",!0)])):c("",!0),v.value===0&&((d=a.patient)!=null&&d.patientName||(i=a.patient)!=null&&i.gender||(_=a.patient)!=null&&_.diagnoses&&a.patient.diagnoses.length>0)?(r(),u("div",mt,[(F=a.patient)!=null&&F.patientName||(G=a.patient)!=null&&G.gender?(r(),u("span",vt,[n("b",null,m((J=a.patient)==null?void 0:J.patientName)+m((Q=a.patient)!=null&&Q.gender?"(".concat(a.patient.gender,")"):""),1)])):c("",!0),(W=a.patient)!=null&&W.prescriber?(r(),u("span",yt,[e[1]||(e[1]=n("b",null,"Seen by:",-1)),L(m(a.patient.prescriber),1)])):c("",!0),(H=a.patient)!=null&&H.nextAppointment?(r(),u("span",gt,[e[2]||(e[2]=n("b",null,"Nxt App:",-1)),L(" "+m(a.patient.nextAppointment),1)])):c("",!0)])):c("",!0),v.value===0&&((K=a.patient)!=null&&K.diagnoses)&&a.patient.diagnoses.length>0?(r(),u("div",bt,[n("span",xt,[e[3]||(e[3]=n("b",null,"Diagnoses:",-1)),L(" "+m(a.patient.diagnoses.filter(g=>g).join(", ")),1)])])):c("",!0),v.value===0&&z.value?(r(),u("div",ht,[(Y=(X=a.patient)==null?void 0:X.vitals)!=null&&Y.height?(r(),u("span",_t,m(a.patient.vitals.height||""),1)):c("",!0),(ee=(Z=a.patient)==null?void 0:Z.vitals)!=null&&ee.weight?(r(),u("span",wt,m(a.patient.vitals.weight||""),1)):c("",!0),(ne=(te=a.patient)==null?void 0:te.vitals)!=null&&ne.bloodPressure?(r(),u("span",It,m(a.patient.vitals.bloodPressure||""),1)):c("",!0),(se=a.patient)!=null&&se.bloodGlucose?(r(),u("span",Nt,m(a.patient.bloodGlucose||""),1)):c("",!0)])):c("",!0),h.value.length>0?(r(),u("table",Ct,[v.value===0?(r(),u("thead",Dt,[...e[4]||(e[4]=[n("tr",null,[n("th",{style:{border:"1px solid black"}},"Drug"),n("th",{style:{border:"1px solid black"}},"Dose"),n("th",{style:{border:"1px solid black"}},"Freq"),n("th",{style:{border:"1px solid black"}},"Qty")],-1)])])):c("",!0),n("tbody",null,[(r(!0),u(q,null,Se(h.value,(g,ve)=>(r(),u("tr",{key:ve},[n("td",kt,m((g==null?void 0:g.name)||""),1),n("td",Pt,m((g==null?void 0:g.dose)||""),1),n("td",$t,m((g==null?void 0:g.frequency)||""),1),n("td",St,m((g==null?void 0:g.quantity)||""),1)]))),128))])])):c("",!0)],4)}}}),Vt=me(Mt,[["__scopeId","data-v-cde3e630"]]);async function Ot(){await Ee(Vt,{copies:1})}function Ut(){const a=b(Ve.isNativePlatform()),N=b([]),I=b(null),w=b(!1),v=b(null),x=fe().patient;return{isMobile:a,visits:N,event:I,popoverOpen:w,program:v,patient:x,openPopover:e=>{I.value=e,w.value=!0},openPIM:()=>{B(Ae,{class:"fullScreenModal"})},openOutCome:()=>{B(Ge,{class:"large-modal-x10"})},printVisitSummary:async()=>{A.getProgramID()==1?await Te():A.getProgramID()==32?await Ot():new le().printData("visit")},printID:()=>{new le().printData("barcode")},formatCurrentAddress:e=>{var D,k,P;return[(D=e==null?void 0:e.personInformation)==null?void 0:D.current_district,(k=e==null?void 0:e.personInformation)==null?void 0:k.current_traditional_authority,(P=e==null?void 0:e.personInformation)==null?void 0:P.current_village].filter(Boolean).join(",")},openUpdateNCDNUmbers:()=>{B(dt,{class:"large-modal-x10"})}}}export{Ae as _,Ut as u};

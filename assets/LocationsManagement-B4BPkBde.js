import{d as N,a as $,r as v,H as y,e as O,f as S,k as e,l as n,J as _,Q as h,u as T,N as X,R as B,cl as Y,w as J,b4 as H,cC as Z,n as tt,O as at,m as et,a7 as st,p as it,aa as lt}from"./vendor-C2-6JN9w.js";import{Q as x,L as nt,x as C,K as I,t as k,_ as M,N as P,S as q,H as j,k as E,M as ot,n as L,W as rt,q as A,T as _t}from"./index-cswYPnpf.js";import{u as dt}from"./StockStore-Da4FH5Ge.js";import{u as ct}from"./StartEndDate-BnAHFlVz.js";import{B as F}from"./BasicForm-CKzXpU3w.js";import{v as z}from"./group_validation-BZEz_qUi.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-k3hWD3Dm.js";import"./DateInputField-DrNcdbyy.js";const pt={class:"pim-cls-1 modal_wrapper"},vt={class:"center text_12"},gt={class:"btnContent"},ft={class:"saveBtn"},mt=N({__name:"AddVillage",props:{taData:Object},setup(w){$(async()=>{});const p=w,m=()=>{B.dismiss()},g=async()=>{if(await z(d.value)){const o=x(d.value,"Village","value").split(","),s=await nt.createAddress({address_type:"Village",addresses:o,parent_location:p.taData.traditional_authority_id});s&&(Promise.all(s.village_data.map(i=>C().postData("ADD_OBJECT_STORE",{storeName:"villages",data:i}))),I("Location added successfully")),m()}else k("Please fill all the required field")},d=v([{data:{rowData:[{colData:[{inputHeader:"Village*",value:"",name:"Village",eventType:"input",alertsErrorMassage:"",validate:!1,required:!0}]}]}}]);return(o,s)=>{const i=y("ion-row");return S(),O("div",pt,[s[3]||(s[3]=e("div",{class:"OtherVitalsHeading"},[e("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add Village")],-1)),e("div",null,[e("div",vt,[n(i,null,{default:_(()=>[n(F,{contentData:d.value},null,8,["contentData"])]),_:1})])]),e("div",gt,[e("div",ft,[n(T(X),{class:"btnText",color:"danger",fill:"solid",onClick:s[0]||(s[0]=u=>m()),style:{"margin-right":"8px"}},{default:_(()=>[...s[1]||(s[1]=[h(" Cancel ",-1)])]),_:1}),n(T(X),{class:"btnText",fill:"solid",onClick:g},{default:_(()=>[...s[2]||(s[2]=[h(" Save ",-1)])]),_:1})])])])}}}),yt=M(mt,[["__scopeId","data-v-67cc418d"]]),Dt={class:"pim-cls-1 modal_wrapper"},Tt={class:"center text_12"},wt={class:"btnContent"},ht={class:"saveBtn"},bt=N({__name:"UpdateVillage",props:{villageData:Object},setup(w){$(async()=>{await m()});const p=w,m=async()=>{P(o.value,"Village","value",p.villageData.name)},g=()=>{B.dismiss()},d=async()=>{if(await z(o.value)){const s=x(o.value,"Village","value"),i=await q.putJson("villages/".concat(p.villageData.village_id),{id:p.villageData.village_id,name:s,ta_id:p.villageData.traditional_authority_id});i&&(C().postData("UPDATE_RECORD",{storeName:"villages",data:i.data,whereClause:{village_id:p.villageData.village_id}}),I("Village updated successfully")),g()}else k("Please fill all the required field")},o=v([{data:{rowData:[{colData:[{inputHeader:"Village*",value:"",name:"Village",eventType:"input",alertsErrorMassage:"",validate:!1,required:!0}]}]}}]);return(s,i)=>{const u=y("ion-row"),f=y("ion-button");return S(),O("div",Dt,[i[3]||(i[3]=e("div",{class:"OtherVitalsHeading"},[e("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add TA")],-1)),e("div",null,[e("div",Tt,[n(u,null,{default:_(()=>[n(F,{contentData:o.value},null,8,["contentData"])]),_:1})])]),e("div",wt,[e("div",ht,[n(f,{class:"btnText",color:"danger",fill:"solid",onClick:i[0]||(i[0]=R=>g()),style:{"margin-right":"8px"}},{default:_(()=>[...i[1]||(i[1]=[h(" Cancel ",-1)])]),_:1}),n(f,{class:"btnText",fill:"solid",onClick:d},{default:_(()=>[...i[2]||(i[2]=[h(" Save ",-1)])]),_:1})])])])}}}),At=M(bt,[["__scopeId","data-v-76d4cdfb"]]),St={key:0,class:"spinner-overlay"},Ct={class:"container"},Vt={style:{"margin-top":"25px"}},xt={class:"table-responsive"},Et=N({__name:"ManageVillageModal",props:{taData:Object},setup(w){const p=dt(),m=C();ct();const g=Y(),d=v(null),o=v(!1);v("all"),v(j.sessionDate()),v(j.sessionDate());const s=w,i=v({responsive:!0,select:!1,processing:!0,serverSide:!0,pageLength:10,searching:!0,ajax:async function(l,r){var t,a;try{o.value=!0;let D={currentPage:Math.floor(l.start/l.length)+1,itemsPerPage:l.length,likeClause:"",whereClause:{traditional_authority_id:s.taData.traditional_authority_id}};(t=l.search)!=null&&t.value&&(D.likeClause={name:"%"+((a=l.search)==null?void 0:a.value)+"%"||""});const b=await A("villages",D),G=await Promise.all(b.records.map(async V=>({name:V.name,actions:'\n                            <button class="btn btn-sm btn-primary edit-btn" data-id=\''.concat(JSON.stringify(V),"'>Edit</button>\n                            <button class=\"btn btn-sm btn-danger delete-btn\" data-id='").concat(JSON.stringify(V),"'>Delete</button>\n                        ")})));r({draw:l.draw,recordsTotal:b.totalCount,recordsFiltered:b.totalCount,data:G})}catch(c){console.error("Error fetching data:",c),k("An error occurred while loading data."),r({draw:l.draw,recordsTotal:0,recordsFiltered:0,data:[]})}finally{o.value=!1}},columns:[{data:"name"},{data:"actions"}],language:{processing:"Loading...",emptyTable:"No data available",info:"Showing _START_ to _END_ of _TOTAL_ entries",infoEmpty:"Showing 0 to 0 of 0 entries",lengthMenu:"Show _MENU_ entries",loadingRecords:"Loading...",search:"Search:",zeroRecords:"No matching records found"}});function u(){B.dismiss("dismiss")}const f=(l=!0)=>{d.value.dt.ajax.reload(null,l)},R=async()=>{const l=JSON.parse(JSON.stringify(s.taData));await L(yt,{class:"fullScreenModal"},!0,{taData:l}),f(!1)},U=async(l,r)=>{await rt("Do you want to delete village ".concat(l.name," ?"),r)&&W(l)},W=async l=>{const r=await q.delete("villages/".concat(l.village_id),{id:l.village_id});(r==null?void 0:r.message)=="Village successfully deleted"&&await m.postData("DELETE_RECORD",{storeName:"villages",whereClause:{village_id:l.village_id}}),f(!1)};J(()=>p.stock,async()=>{const l=d.value.dt;l==null||l.ajax.reload()},{deep:!0}),J(()=>g,async()=>{const l=d.value.dt;l==null||l.ajax.reload()},{deep:!0});const Q=async l=>{await L(At,{class:"fullScreenModal"},!0,{villageData:l}),f(!1)},K=()=>{const l=d.value.dt;l.on("click",".edit-btn",r=>{const t=r.target.getAttribute("data-id");t&&Q(JSON.parse(t))}),l.on("click",".delete-btn",r=>{const t=r.target.getAttribute("data-id");t&&U(JSON.parse(t),r)})};return $(()=>{H.use(Z),tt(()=>{K()})}),(l,r)=>{const t=y("ion-spinner"),a=y("ion-title"),c=y("ion-icon"),D=y("ion-header");return S(),at(T(lt),{class:it({loading:o.value})},{default:_(()=>[o.value?(S(),O("div",St,[n(t,{name:"bubbles"}),r[2]||(r[2]=e("div",{class:"loading-text"},"Please wait...",-1))])):et("",!0),n(D,{style:{display:"flex","justify-content":"space-between"}},{default:_(()=>[n(a,{class:"modalTitle"},{default:_(()=>[...r[3]||(r[3]=[h("Village Management",-1)])]),_:1}),n(c,{onClick:r[0]||(r[0]=b=>u()),style:{"padding-top":"10px","padding-right":"10px"},icon:T(E).cancel},null,8,["icon"])]),_:1}),n(T(st),{style:{"--background":"#fff"}},{default:_(()=>[e("div",Ct,[e("div",Vt,[n(ot,{style:{height:"45px"},name:" Add Village",size:"small",iconSlot:"start",icon:T(E).plusWhite,onClick:r[1]||(r[1]=b=>R())},null,8,["icon"])]),e("div",xt,[n(T(H),{ref_key:"dataTableRef",ref:d,options:i.value,class:"display nowrap",width:"100%"},{default:_(()=>[...r[4]||(r[4]=[e("thead",null,[e("tr",null,[e("th",null,"Villages"),e("th",null,"Action")])],-1)])]),_:1},8,["options"])])])]),_:1})]),_:1},8,["class"])}}}),Nt=M(Et,[["__scopeId","data-v-6223be37"]]),$t={class:"pim-cls-1 modal_wrapper"},Ot={class:"center text_12"},kt={class:"btnContent"},Mt={class:"saveBtn"},Rt=N({__name:"AddTA",setup(w){$(async()=>{await p()});const p=async()=>{P(d.value,"TA_district","multiSelectData",await A("districts"))},m=()=>{B.dismiss()},g=async()=>{if(await z(d.value)){const o=x(d.value,"TA","value"),s=x(d.value,"Village","value").split(","),i=x(d.value,"TA_district","value").district_id,u=await nt.createAddress({address_type:"Village",addresses:s,parent_location:i,ta_name:o});u&&(C().postData("ADD_OBJECT_STORE",{storeName:"TAs",data:u.ta_data}),Promise.all(u.village_data.map(f=>C().postData("ADD_OBJECT_STORE",{storeName:"villages",data:f}))),I("Location added successfully")),m()}else k("Please fill all the required field")},d=v([{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"District*",icon:E.search,value:"",name:"TA_district",setName:"TALocation",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,popOver:!0,trackBy:"district_id",multiSelectData:[],id:"",idName:"district_id",validationFunctionName:"required"}]}]}},{data:{rowData:[{colData:[{inputHeader:"TA*",value:"",name:"TA",eventType:"input",alertsErrorMassage:"",validationFunctionName:"required"}]}]}},{data:{rowData:[{colData:[{inputHeader:"Village*",value:"",name:"Village",eventType:"input",alertsErrorMassage:"",validate:!1,validationFunctionName:"required"}]}]}}]);return(o,s)=>{const i=y("ion-row"),u=y("ion-button");return S(),O("div",$t,[s[3]||(s[3]=e("div",{class:"OtherVitalsHeading"},[e("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add TA")],-1)),e("div",null,[e("div",Ot,[n(i,null,{default:_(()=>[n(F,{contentData:d.value},null,8,["contentData"])]),_:1})])]),e("div",kt,[e("div",Mt,[n(u,{class:"btnText",color:"danger",fill:"solid",onClick:s[0]||(s[0]=f=>m()),style:{"margin-right":"8px"}},{default:_(()=>[...s[1]||(s[1]=[h(" Cancel ",-1)])]),_:1}),n(u,{class:"btnText",fill:"solid",onClick:g},{default:_(()=>[...s[2]||(s[2]=[h(" Save ",-1)])]),_:1})])])])}}}),Pt=M(Rt,[["__scopeId","data-v-a02493d1"]]),Lt={class:"pim-cls-1 modal_wrapper"},Bt={class:"center text_12"},Ft={class:"btnContent"},Jt={class:"saveBtn"},Ht=N({__name:"UpdateTA",props:{taData:Object},setup(w){$(async()=>{await m()});const p=w,m=async()=>{const s=await A("districts",{whereClause:{district_id:p.taData.district_id}});P(o.value,"TA_district","multiSelectData",await A("districts")),P(o.value,"TA_district","value",s[0]),P(o.value,"TA","value",p.taData.name)},g=()=>{B.dismiss()},d=async()=>{if(await z(o.value)){const s=x(o.value,"TA","value"),i=x(o.value,"TA_district","value").district_id,u=await q.putJson("traditional_authorities/".concat(p.taData.traditional_authority_id),{id:p.taData.traditional_authority_id,name:s,district_id:i});u&&(C().postData("UPDATE_RECORD",{storeName:"TAs",data:u.data,whereClause:{traditional_authority_id:p.taData.traditional_authority_id}}),I("TA updated successfully")),g()}else k("Please fill all the required field")},o=v([{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"District*",icon:E.search,value:"",name:"TA_district",setName:"TALocation",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,popOver:!0,trackBy:"district_id",multiSelectData:[],id:"",idName:"district_id",validationFunctionName:"required"}]}]}},{data:{rowData:[{colData:[{inputHeader:"TA*",value:"",name:"TA",eventType:"input",alertsErrorMassage:"",validationFunctionName:"required"}]}]}}]);return(s,i)=>{const u=y("ion-row"),f=y("ion-button");return S(),O("div",Lt,[i[3]||(i[3]=e("div",{class:"OtherVitalsHeading"},[e("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add TA")],-1)),e("div",null,[e("div",Bt,[n(u,null,{default:_(()=>[n(F,{contentData:o.value},null,8,["contentData"])]),_:1})])]),e("div",Ft,[e("div",Jt,[n(f,{class:"btnText",color:"danger",fill:"solid",onClick:i[0]||(i[0]=R=>g()),style:{"margin-right":"8px"}},{default:_(()=>[...i[1]||(i[1]=[h(" Cancel ",-1)])]),_:1}),n(f,{class:"btnText",fill:"solid",onClick:d},{default:_(()=>[...i[2]||(i[2]=[h(" Save ",-1)])]),_:1})])])])}}}),jt=M(Ht,[["__scopeId","data-v-ffada563"]]),It={key:0,class:"spinner-overlay"},qt={class:"container"},zt={style:{display:"flex","justify-content":"space-between"}},Ut={style:{width:"50%","max-width":"350px"}},Wt={style:{"margin-top":"25px"}},Qt={class:"table-responsive"},Kt=N({__name:"LocationsManagement",setup(w){const p=dt();ct();const m=Y(),g=v(null),d=v(!1);v("all"),v(j.sessionDate()),v(j.sessionDate());const o=v(""),s=v([]),i=async t=>Promise.all(t.map(async a=>{const c=await A("districts",{whereClause:{district_id:a.district_id}}),D=await A("villages",{whereClause:{traditional_authority_id:a.traditional_authority_id}});return{ta_id:a.traditional_authority_id,name:a.name,district:c[0].name,villages:'<button class="btn btn-sm btn-primary view-btn" data-id=\''.concat(JSON.stringify(a),"'> View ").concat(D.length,"   </button>"),actions:'\n                    <button class="btn btn-sm btn-primary edit-btn" data-id=\''.concat(JSON.stringify(a),"'>Edit</button>\n                    <button class=\"btn btn-sm btn-danger delete-btn\" data-id='").concat(JSON.stringify(a),"'>Delete</button>\n                ")}})),u=(t=!0)=>{g.value.dt.ajax.reload(null,t)},f=v({responsive:!0,select:!1,processing:!0,serverSide:!0,pageLength:10,searching:!0,ajax:async function(t,a){var c,D;try{d.value=!0;let G={currentPage:Math.floor(t.start/t.length)+1,itemsPerPage:t.length,likeClause:(c=t.search)!=null&&c.value?{name:"%"+((D=t.search)==null?void 0:D.value)+"%"}:"",whereClause:o.value?{district_id:o.value}:""};const V=await A("TAs",G),ut=await i(V.records);a({draw:t.draw,recordsTotal:V.totalCount,recordsFiltered:V.totalCount,data:ut})}catch(b){console.error("Error fetching data:",b),k("An error occurred while loading data."),a({draw:t.draw,recordsTotal:0,recordsFiltered:0,data:[]})}finally{d.value=!1}},columns:[{data:"ta_id"},{data:"name"},{data:"district"},{data:"villages"},{data:"actions"}],language:{processing:"Loading...",emptyTable:"No data available",info:"Showing _START_ to _END_ of _TOTAL_ entries",infoEmpty:"Showing 0 to 0 of 0 entries",lengthMenu:"Show _MENU_ entries",loadingRecords:"Loading...",search:"Search:",zeroRecords:"No matching records found"}}),R=async t=>{await L(Nt,{class:"fullScreenModal"},!0,{taData:t})==="dismiss"&&u(!1)},U=async t=>{var a;o.value=(a=t==null?void 0:t.value)==null?void 0:a.district_id,u()},W=async(t,a)=>{const c=JSON.parse(t);await rt("Do you want to delete TA ".concat(c.name," ?"),a)&&Q(c)},Q=async t=>{const a=await q.delete("traditional_authorities/".concat(t.traditional_authority_id),{id:t.traditional_authority_id});(a==null?void 0:a.message)=="Traditional Authority and associated villages successfully deleted"&&(C().postData("DELETE_RECORD",{storeName:"TAs",whereClause:{traditional_authority_id:t.traditional_authority_id}}),C().postData("DELETE_RECORD",{storeName:"villages",whereClause:{traditional_authority_id:t.traditional_authority_id}})),u(!1)},K=async()=>{await L(Pt,{class:"otherVitalsModal"}),u(!1)},l=async t=>{await L(jt,{class:"otherVitalsModal"},!0,{taData:t}),u(!1)};J(()=>p.stock,async()=>{const t=g.value.dt;t==null||t.ajax.reload()},{deep:!0}),J(()=>m,async t=>{if(t.name=="LocationsManagement"){const a=g.value.dt;a==null||a.ajax.reload()}},{deep:!0});const r=()=>{const t=g.value.dt;t.on("click",".edit-btn",a=>{const c=a.target.getAttribute("data-id");c&&l(JSON.parse(c))}),t.on("click",".delete-btn",a=>{const c=a.target.getAttribute("data-id");c&&W(c,a)}),t.on("click",".view-btn",a=>{const c=a.target.getAttribute("data-id");c&&R(JSON.parse(c))})};return $(async()=>{s.value=[{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"Filter by districts",popOver:!0,icon:E.search,value:"",name:"filter_district",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,trackBy:"district_id",multiSelectData:await A("districts"),id:"",idName:"district_id"}]}]}}],H.use(Z),tt(()=>{r()})}),(t,a)=>{const c=y("ion-spinner");return S(),at(T(lt),{class:it({loading:d.value})},{default:_(()=>[d.value?(S(),O("div",It,[n(c,{name:"bubbles"}),a[1]||(a[1]=e("div",{class:"loading-text"},"Please wait...",-1))])):et("",!0),n(_t),n(T(st),null,{default:_(()=>[e("div",qt,[a[3]||(a[3]=e("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"TA Management",-1)),e("div",zt,[e("div",Ut,[n(F,{contentData:s.value,"onUpdate:inputValue":U},null,8,["contentData"])]),e("div",Wt,[n(ot,{style:{height:"45px"},name:" Add TA",size:"small",iconSlot:"start",icon:T(E).plusWhite,onClick:a[0]||(a[0]=D=>K())},null,8,["icon"])])]),e("div",Qt,[n(T(H),{ref_key:"dataTableRef",ref:g,options:f.value,class:"display nowrap",width:"100%"},{default:_(()=>[...a[2]||(a[2]=[e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"TA"),e("th",null,"District"),e("th",null,"Villages"),e("th",null,"Action")])],-1)])]),_:1},8,["options"])])])]),_:1})]),_:1},8,["class"])}}}),la=M(Kt,[["__scopeId","data-v-bceb24e9"]]);export{la as default};

import{d as G,aa as Z,bm as Nt,b_ as $t,V as tt,cs as Lt,cr as kt,bs as Ot,b6 as ht,D as yt,aL as bt,aM as wt,b7 as Mt,I as T,U as F,T as A,b8 as Vt,b9 as Bt,ba as Tt,S as et,ad as nt,X as R,aB as Rt,cj as Et,dw as At,bk as Gt,dK as Ht,E as C,e as p,f,l as n,z as i,A as V,k as o,F as X,r as k,u as s,b3 as Y,W as U,b5 as It,ae as Ut,aT as Ft,c as E,a as Dt,w as zt,a8 as qt,ac as jt,m as D,G as ft,B as P,ak as Wt,bt as Kt,aK as Qt,at as Xt,bp as Zt,aG as xt,L as Jt,dL as Yt,a$ as te}from"./vendor-8nEYVyB7.js";import{B as ee,D as ne,e as ae,w as ie,z as oe,P as K,u as z,aC as se,y as I,aa as q,L as j,k as le,t as St,an as re,_ as at,a3 as ce,a1 as ue,Z as de,a4 as Q,ah as me,ai as pe,aj as fe,S as Ct,ak as ge,al as _e,g as J}from"./index-7qwbP5UI.js";import{P as ve}from"./patient_registration_service-DqW5iI0B.js";import{R as gt}from"./relationship_service-5k3lDrA7.js";import{R as _t}from"./relations_service-CLEMAHmR.js";import{u as he}from"./FollowUpStore-DA7PglNR.js";import{B as ye,S as be,H as we,C as Ie,G as De,P as xe}from"./BirthRegistration-dmA609_O.js";import{O as Se}from"./Stepper-dfCMn-tB.js";import{l as vt}from"./lodash-Dt8AsbQm.js";const Ce=G({name:"Home",username:"",components:{IonContent:nt,IonHeader:et,IonMenuButton:Tt,IonSearchbar:Bt,IonPage:Vt,IonTitle:A,IonToolbar:F,ToolbarSearch:oe,IonIcon:T,IonPopover:Mt,IonRow:wt,IonCol:bt,IonLabel:yt,IonInput:ht,IonDatetime:Ot,IonSelect:kt,IonSelectOption:Lt,IonFooter:tt,DynamicButton:ie,BasicInputField:ae,vSelect:$t,VueMultiselect:Nt,DateInputField:ne,BasicForm:ee,PersonalInformation:xe,GuardianInformation:De,CurrentLocation:Ie,HomeLocation:we,SocialHistory:be,BirthRegistration:ye},data(){return{popoverOpen:!1}},computed:{...Z(he,["changeGuardianInfo","vaccineAdverseEffects","protectedAtBirth"]),...Z(z,["patient"]),...Z(re,["personInformation","socialHistory","homeLocation","currentLocation","guardianInformation"])},watch:{patient:{handler(){},immediate:!0}},setup(){return{notificationsOutline:Ht,personCircleOutline:Gt,createOutline:At,clipboardOutline:Et,calendarOutline:Rt}},methods:{handleCancel(){R.dismiss()},async saveDetails(){try{await this.updateDemographics(),await this.updateGuardian(),await this.updatePatientDemographics(),le("Successfully Updated Patient"),this.handleCancel()}catch(t){St("Failed to save details")}},async getRegion(t){let a=[];for(let l of[1,2,3]){if((l=1)&&(a=await j.getDistricts(l)),a.some(d=>d.name.trim()===t))return"Central Region";if((l=2)&&(a=await j.getDistricts(l)),a.some(d=>d.name.trim()===t))return"Northern Region";if((l=3)&&(a=await j.getDistricts(l)),a.some(d=>d.name.trim()===t))return"Southern Region";if((l=4)&&(a=await j.getDistricts(l)),a.some(d=>d.name.trim()===t))return"Foreign"}},async updateDemographics(){var a,l,d,m,u,v,b,g,x,w;const t={person_id:this.patient.patientID,given_name:I(this.personInformation,"firstname","value"),family_name:I(this.personInformation,"lastname","value"),middle_name:I(this.personInformation,"middleName","value"),gender:q(this.personInformation,"gender"),birthdate:I(this.personInformation,"birthdate","value"),cell_phone_number:I(this.personInformation,"phoneNumber","value"),birthdate_estimated:!1,home_region:await this.getRegion((a=I(this.homeLocation,"home_district","value"))==null?void 0:a.name),home_district:(l=I(this.homeLocation,"home_district","value"))==null?void 0:l.name,home_traditional_authority:(d=I(this.homeLocation,"home_traditional_authority","value"))==null?void 0:d.name,home_village:(m=I(this.homeLocation,"home_village","value"))==null?void 0:m.name,current_region:await this.getRegion((u=I(this.currentLocation,"current_district","value"))==null?void 0:u.name),current_district:(v=I(this.currentLocation,"current_district","value"))==null?void 0:v.name,current_traditional_authority:(b=I(this.currentLocation,"current_traditional_authority","value"))==null?void 0:b.name,current_village:(g=I(this.currentLocation,"current_village","value"))==null?void 0:g.name,landmark:(x=I(this.currentLocation,"current_village","value"))==null?void 0:x.name,occupation:q(this.socialHistory,"occupation"),religion:(w=I(this.socialHistory,"religion","value"))==null?void 0:w.name,marital_status:q(this.socialHistory,"maritalStatus"),education_level:q(this.socialHistory,"highestLevelOfEducation"),facility_name:"",patient_type:""};await this.updatePerson(this.patient.patientID,t)},async updateGuardian(){var d,m;let t={given_name:I(this.guardianInformation,"guardianFirstname","value"),family_name:I(this.guardianInformation,"guardianLastname","value"),middle_name:I(this.guardianInformation,"guardianMiddleName","value"),cell_phone_number:I(this.guardianInformation,"guardianPhoneNumber","value"),gender:"",birthdate:"",birthdate_estimated:!1,home_district:"",home_traditional_authority:"",home_village:"",current_district:"",current_traditional_authority:"",current_village:"",landmark:"",occupation:"",religion:"",marital_status:"",education_level:"",facility_name:"",patient_type:"",national_id:""},a=await gt.getRelationships(this.patient.patientID);const l=(d=I(this.guardianInformation,"relationship","value"))==null?void 0:d.id;if(l)if(a.length>0){const u=await gt.getRelationships(this.patient.patientID);await _t.amendRelation(this.patient.patientID,a[0].person_b,a[0].relationship_id,l),await this.updatePerson((m=u[0])==null?void 0:m.person_b,t)}else{const u=new ve;await u.registerGuardian(t);const v=u.getPersonID();await _t.createRelation(this.patient.patientID,v,l)}},async updatePerson(t,a){await new se(a).update(t)},async updatePatientDemographics(){const t=await K.findByID(this.patient.patientID);z().setPatientRecord(t)},patientIdentifier(t){const a=t.patient_identifiers.length-1;return a>=0?t.patient_identifiers[a].identifier:""}}}),Pe={class:"ion-padding",slot:"content",style:{"padding-bottom":"200px"}},Ne={class:"ion-padding",slot:"content",style:{"padding-bottom":"200px"}},$e={class:""},Le={class:"ion-padding",slot:"content",style:{"padding-bottom":"120px"}},ke={class:"ion-padding",slot:"content",style:{"padding-bottom":"120px"}},Oe={class:"ion-padding",slot:"content",style:{"padding-bottom":"120px"}};function Me(t,a,l,d,m,u){const v=C("ion-title"),b=C("ion-header"),g=C("ion-label"),x=C("ion-item"),w=C("PersonalInformation"),c=C("ion-accordion"),r=C("GuardianInformation"),h=C("SocialHistory"),y=C("CurrentLocation"),O=C("HomeLocation"),N=C("ion-accordion-group"),L=C("ion-content"),M=C("ion-button"),_=C("ion-col"),e=C("DynamicButton"),S=C("ion-row"),B=C("ion-footer");return f(),p(X,null,[n(b,null,{default:i(()=>[n(v,{class:"modalTitle"},{default:i(()=>a[1]||(a[1]=[V("Edit Patient Demographics")])),_:1,__:[1]})]),_:1}),n(L,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:i(()=>[n(N,{ref:"accordionGroup",class:"previousView"},{default:i(()=>[n(c,{value:"first","toggle-icon-slot":"start",class:"custom_card"},{default:i(()=>[n(x,{slot:"header",color:"light"},{default:i(()=>[n(g,{class:"previousLabel"},{default:i(()=>a[2]||(a[2]=[V("Personal information")])),_:1,__:[2]})]),_:1}),o("div",Pe,[n(w,{editable:!0})])]),_:1}),n(c,{value:"second","toggle-icon-slot":"start",class:"custom_card"},{default:i(()=>[n(x,{slot:"header",color:"light"},{default:i(()=>[n(g,{class:"previousLabel"},{default:i(()=>a[3]||(a[3]=[V("Guardian")])),_:1,__:[3]})]),_:1}),o("div",Ne,[o("div",$e,[n(r,{editable:!0})])])]),_:1}),n(c,{value:"third","toggle-icon-slot":"start",class:"custom_card"},{default:i(()=>[n(x,{slot:"header",color:"light"},{default:i(()=>[n(g,{class:"previousLabel"},{default:i(()=>a[4]||(a[4]=[V("Social history")])),_:1,__:[4]})]),_:1}),o("div",Le,[n(h,{editable:!0})])]),_:1}),n(c,{value:"four","toggle-icon-slot":"start",class:"custom_card"},{default:i(()=>[n(x,{slot:"header",color:"light"},{default:i(()=>[n(g,{class:"previousLabel"},{default:i(()=>a[5]||(a[5]=[V("Current location")])),_:1,__:[5]})]),_:1}),o("div",ke,[n(y,{editable:!0})])]),_:1}),n(c,{value:"five","toggle-icon-slot":"start",class:"custom_card"},{default:i(()=>[n(x,{slot:"header",color:"light"},{default:i(()=>[n(g,{class:"previousLabel"},{default:i(()=>a[6]||(a[6]=[V("Home location")])),_:1,__:[6]})]),_:1}),o("div",Oe,[n(O,{editable:!0})])]),_:1})]),_:1},512),a[7]||(a[7]=o("hr",{class:"dashed-hr",style:{"margin-bottom":"0px !important"}},null,-1))]),_:1,__:[7]}),n(B,{collapse:"fade",class:"ion-no-border"},{default:i(()=>[n(S,null,{default:i(()=>[n(_,null,{default:i(()=>[n(M,{id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"},onClick:t.handleCancel},{default:i(()=>a[8]||(a[8]=[V(" Cancel ")])),_:1,__:[8]},8,["onClick"])]),_:1}),n(_,null,{default:i(()=>[n(e,{onClick:a[0]||(a[0]=H=>t.saveDetails()),name:"Save changes",fill:"solid",style:{float:"right",margin:"2%",width:"130px"}})]),_:1})]),_:1})]),_:1})],64)}const Ve=at(Ce,[["render",Me],["__scopeId","data-v-a10cb2a3"]]),Be={style:{"font-weight":"400","font-size":"19px"}},Te={style:{display:"flex","align-items":"center"}},Re={class:""},Ee={class:"center text_12"},Ae=G({watch:{},name:"xxxComponent"}),Ge=G({...Ae,props:{is_open:{},user_id:{}},emits:["closePopoover","save"],setup(t,{emit:a}){k("");const l=a;function d(){l("closePopoover",!1),R.dismiss()}return(m,u)=>(f(),p(X,null,[n(s(et),null,{default:i(()=>[n(s(F),null,{default:i(()=>[n(s(A),null,{default:i(()=>u[1]||(u[1]=[o("div",{style:{display:"flex","align-items":"center"}},[o("b",{style:{"margin-left":"6px"}},"Patient Outcome")],-1)])),_:1,__:[1]}),n(s(Y),{slot:"end"},{default:i(()=>[n(s(A),null,{default:i(()=>[n(s(U),{onClick:u[0]||(u[0]=v=>d()),fill:"solid"},{default:i(()=>[o("span",Be,[o("div",Te,[n(s(T),{icon:s(It),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),u[2]||(u[2]=o("span",{style:{"margin-left":"6px"}},"Close",-1))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(s(nt),{class:"ion-padding"},{default:i(()=>[o("div",Re,[o("div",Ee,[n(s(wt),null,{default:i(()=>[n(s(bt),null,{default:i(()=>[n(Se)]),_:1})]),_:1})])])]),_:1}),n(s(tt),null,{default:i(()=>[n(s(F))]),_:1})],64))}}),He={style:{display:"flex","align-items":"center"}},Ue={style:{"font-weight":"400","font-size":"19px"}},Fe={style:{display:"flex","align-items":"center"}},ze={style:{"font-weight":"600","font-size":"17px"}},qe={style:{"margin-top":"15px",width:"100%"}},je={key:0,class:"error-message"},We={key:1},Ke={slot:"start",class:"prefix-container"},Qe=["value"],Xe={key:0,class:"error-message"},Ze={style:{"font-size":"16px","font-weight":"600px",color:"red"}},Je={key:1},Ye={style:{"font-weight":"400","font-size":"19px"}},tn={style:{display:"flex","align-items":"center"}},en={style:{"font-weight":"400","font-size":"20px"}},nn={style:{display:"flex","align-items":"center"}},an=G({name:"UpdateNCDNumberModal"}),on=G({...an,emits:["closePopoover","save"],setup(t,{emit:a}){const l=Ut(),d=z(),{patient:m}=Ft(d),u=k(""),v=k(""),b=k(""),g=k(!1),x=new K;let w=null;const c=_=>{const e=_.target.value.replace(/[^0-9]/g,"");e!==_.target.value&&(g.value=!0,w&&clearTimeout(w),w=window.setTimeout(()=>{g.value=!1,w=null},3e3),u.value=e)},r=()=>{g.value=!1,w&&(clearTimeout(w),w=null)},h=E(()=>u.value&&u.value.trim()!==""),y=async()=>{try{const _=await ce.getNextSuggestedNCDNumber(),e=_.ncd_number.replace(/^\D+|\s/g,""),S=_.ncd_number.replace(/\d+/g,"")+"-NCD-";u.value=e,v.value=S}catch(_){console.error("Error fetching suggested NCD number:",_),b.value="Failed to fetch suggested NCD number (missing SITE Prefix)"}};Dt(()=>{y()}),zt(()=>m.value.ID,()=>{y()},{deep:!0});const O=a;function N(){O("closePopoover",!1),R.dismiss()}function L(_){try{console.log(_),l.push(_)}catch(e){console.error(e)}}async function M(){try{if(b.value="",!h.value){b.value="Please enter a valid NCD number";return}const _="".concat(v.value).concat(u.value),e=await K.findByID(m.value.patientID);for(const S of e.patient_identifiers)S.identifier_type===31&&(await x.updateNCDNumber(S.patient_identifier_id,_),O("save",{newNcdId:_}));await ue(m.value),N()}catch(_){console.error(_)}}return(_,e)=>(f(),p(X,null,[n(s(et),null,{default:i(()=>[n(s(F),null,{default:i(()=>[n(s(A),null,{default:i(()=>[o("div",He,[n(s(T),{icon:s(qt),class:"sub-menu-icon",style:{"font-size":"1.6rem"}},null,8,["icon"]),e[3]||(e[3]=o("b",{style:{"margin-left":"6px"}},"Update NCD Number",-1))])]),_:1}),n(s(Y),{slot:"end"},{default:i(()=>[n(s(A),null,{default:i(()=>[n(s(U),{onClick:e[0]||(e[0]=S=>N()),fill:"solid"},{default:i(()=>[o("span",Ue,[o("div",Fe,[n(s(T),{icon:s(It),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),e[4]||(e[4]=o("span",{style:{"margin-left":"6px"}},"Close",-1))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(s(nt),{class:"ion-padding"},{default:i(()=>[n(s(jt),null,{default:i(()=>[n(s(ft),{class:"current-ncd-item"},{default:i(()=>[n(s(yt),null,{default:i(()=>[e[5]||(e[5]=o("h2",null,"Current NCD Number",-1)),o("p",ze,P(s(m).NcdID||"Not assigned"),1)]),_:1,__:[5]})]),_:1}),n(s(ft),null,{default:i(()=>[o("div",qe,[g.value?(f(),p("div",je,[n(s(T),{icon:s(Wt),color:"danger"},null,8,["icon"]),e[6]||(e[6]=o("span",{style:{"font-size":"16px","font-weight":"600px",color:"red"}},"Only numbers are allowed",-1)),n(s(U),{fill:"clear",size:"small",onClick:r},{default:i(()=>[n(s(T),{icon:s(Kt)},null,8,["icon"])]),_:1})])):D("",!0),b.value?D("",!0):(f(),p("div",We,[e[7]||(e[7]=o("span",{style:{"font-weight":"600","font-size":"17px",color:"grey"}},"New NCD Number",-1)),n(s(ht),{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=S=>u.value=S),placeholder:"Enter number",inputmode:"numeric",pattern:"[0-9]*",onInput:c,class:"custom-input"},{default:i(()=>[o("div",Ke,[o("input",{value:v.value,readonly:"",class:"prefix-part",type:"text"},null,8,Qe)])]),_:1},8,["modelValue"])]))])]),_:1}),b.value?(f(),p("div",Xe,[n(s(Qt),{color:"danger"},{default:i(()=>[o("span",Ze,P(b.value),1)]),_:1})])):D("",!0),b.value?(f(),p("div",Je,[n(s(U),{onClick:e[2]||(e[2]=S=>L("setSitePrefix")),fill:"solid",style:{margin:"14px"}},{default:i(()=>[o("span",Ye,[o("div",tn,[n(s(T),{icon:s(Xt),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),e[8]||(e[8]=o("span",{style:{"margin-left":"6px"}},"set Site Prefix",-1))])])]),_:1})])):D("",!0)]),_:1})]),_:1}),n(s(tt),null,{default:i(()=>[n(s(F),null,{default:i(()=>[n(s(Y),{slot:"end"},{default:i(()=>[n(s(A),null,{default:i(()=>[n(s(U),{onClick:M,fill:"solid",disabled:!h.value},{default:i(()=>[o("span",en,[o("div",nn,[n(s(T),{icon:s(Zt),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),e[9]||(e[9]=o("span",{style:{"margin-left":"6px"}},"Save",-1))])])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})],64))}}),sn=at(on,[["__scopeId","data-v-d3b9b80f"]]);async function ln(t){const a=t.visits.visitsDates.map(e=>new Date(e)),l=new Date(Math.max(...a)),d=l.toISOString().split("T")[0],m="".concat(t.personInformation.given_name," ").concat(t.personInformation.family_name),u=[...t.vitals.saved||[],...t.vitals.unsaved||[]],v=[...t.diagnosis.saved||[],...t.diagnosis.unsaved||[]],b=[...t.MedicationOrder.saved||[],...t.MedicationOrder.unsaved||[]],g=[...t.labOrders.saved||[],...t.labOrders.unsaved||[]],x=u.filter(e=>new Date(e.obs_datetime).toDateString()===l.toDateString()),w=v.filter(e=>new Date(e.obs_datetime).toDateString()===l.toDateString()),c=b.filter(e=>new Date(e.encounter_date).toDateString()===l.toDateString()),r=g.filter(e=>new Date(e.order_date).toDateString()===l.toDateString()),h=r.length>0?r[0].requesting_clinician:void 0,y=t.appointments.saved.length>0?t.appointments.saved[0].value:void 0,O=await Promise.all(w.map(async e=>await de.getConceptName(e.value_coded))),N=u.filter(e=>e.concept_name==="Height (cm)").sort((e,S)=>new Date(S.obs_datetime).getTime()-new Date(e.obs_datetime).getTime())[0],L=(e,S)=>{const B=x.find(H=>H.concept_name==e);return(B==null?void 0:B.value_numeric)!==void 0?"".concat(B.value_numeric).concat(S):void 0},M=()=>{const e=new K().getBloodGlucose(t);if(e)return e.name+":"+e.value+e.unit};return{patientID:t.NcdID,patientName:m,latestVisitDate:d,gender:t.personInformation.gender,vitals:{height:"Ht:"+(N==null?void 0:N.value_numeric)+"cm",weight:"Wt"+L("Weight (kg)","kg"),bloodPressure:"Bp"+L("Systolic blood pressure","")+"/"+L("Diastolic blood pressure","")+"mmHg"},bloodGlucose:M(),diagnoses:O.length>0?O:void 0,medications:c.length>0?c.map(e=>({name:e.drug_name,dose:e.dose?"".concat(e.dose," ").concat(e.units||"").trim():void 0,frequency:e.frequency,quantity:e.equivalent_daily_dose,duration:e.expire_date&&e.start_date?Math.ceil((Number(new Date(e.expire_date))-Number(new Date(e.start_date)))/(1e3*60*60*24)):void 0})):void 0,labOrders:r.length>0?r.map(e=>({test:e.tests&&e.tests.length>0?e.tests[0].name:void 0,orderDate:e.order_date?new Date(e.order_date).toISOString().split("T")[0]:void 0,accessionNumber:e.accession_number})):void 0,prescriber:h,nextAppointment:y}}const W=k(!1);async function rn(){const t=new Q;let a=await t.getDefaultPrinter();if(vt.isEmpty(a)&&(a=await t.selectDefaultPrinter()),vt.isEmpty(a))throw new Error("No printer device found");return a}async function cn(t,a){const l=me.updateUrlParamString(a,{raw:!0});pe.emit(fe.SHOW_MODAL,"zebra-modal"),console.time(a);const d=await Ct.getText(l);if(!d)throw"Unable to print Label. Try again later";if((t==null?void 0:t.port)==="BT")return new Q().printToBluetoothDevice(t,d);xt.printLabel({eplCommands:d,name:t.name,address:t.address,url:await ge.expandPath(l)}),console.timeEnd(a),await _e(2e3)}async function un(t,a,l){if(!W.value){W.value=!0;try{const d=await ln(z().patient),m=await R.create({id:"printout",component:a,backdropDismiss:!1,cssClass:"visit-modal",componentProps:{patient:d,imageOut:async u=>{var b;console.log("🚀 ~ imageOut: ~ images:",u);const v=(b=l.copies)!=null?b:1;for(let g=0;g<v;++g){const x=u.map(w=>{console.log("🚀 ~ res ~ image:",w),xt.printLabel({address:t.address,name:t.name,height:302,width:582,image:w})});await Promise.all(x)}setTimeout(()=>R.getTop().then(g=>g&&m.dismiss()),1e3),W.value=!1}}});await m.present()}catch(d){console.error(d),W.value=!1,R.getTop().then(m=>m?R.dismiss():null),St("An error occurred while generating label")}}}async function dn(t,a){console.log("🚀 ~ printLabel ~ labelComponent:",t);const l=await rn();return/zebra/i.test(l.name)||/Browser/i.test(l.address)||l.port==="BT"?cn(l,a.lblUrl):await un(l,t,a)}const mn={key:0,style:{display:"flex","justify-content":"space-between",width:"100%"}},pn={key:0},fn={key:1,style:{"font-weight":"bold",padding:"1.7px"}},gn={key:1,style:{display:"flex","flex-wrap":"wrap",gap:"20px",width:"100%"}},_n={key:0},vn={key:1},hn={key:2},yn={key:2},bn={style:{display:"flex","flex-wrap":"wrap",gap:"8px",width:"100%"}},wn={key:3,style:{display:"flex","flex-wrap":"wrap",gap:"20px",width:"100%"}},In={key:0},Dn={key:1},xn={key:2},Sn={key:3},Cn={key:4,style:{width:"100%","text-align":"center"}},Pn={key:0},Nn=G({__name:"ArtVisitLbl",props:{imageOut:{type:Object},patient:{type:Object}},emits:["label-out"],setup(t,{emit:a}){const l=a,d=k(null),m=k(0),u=t,v=E(()=>{var c;return(c=u.patient)!=null&&c.medications?u.patient.medications.filter(r=>r&&(r.name||r.dose||r.frequency||r.quantity)):[]}),b=E(()=>{var r,h;const c=(r=u.patient)==null?void 0:r.vitals;return c&&(c.height||c.weight||c.bloodPressure||((h=u.patient)==null?void 0:h.bloodGlucose))}),g=E(()=>{const c=v.value;if(c.length===0)return[];if(m.value===0)return c.slice(0,2);{const r=2+(m.value-1)*4;return c.slice(r,r+4)}});E(()=>{const c=v.value.length;if(c<=2)return!0;const r=c-2,h=Math.ceil(r/4);return m.value===h});const x=E(()=>{const c=v.value.length;if(c<=2)return 1;const r=c-2;return 1+Math.ceil(r/4)}),w=async()=>{const c=[];for(let r=0;r<x.value;r++){m.value=r,await new Promise(h=>setTimeout(h,100));try{const h=await Yt.toPng(d.value,{height:300,width:594});c.push(h)}catch(h){console.error("Error generating image for page",r,h)}}return c};return Dt(async()=>{try{const c=await w();l("label-out",c),typeof u.imageOut=="function"&&u.imageOut(c)}catch(c){console.error("Error generating patient labels:",c)}}),(c,r)=>{var h,y,O,N,L,M,_,e,S,B,H,it,ot,st,lt,rt,ct,ut,dt,mt,pt;return f(),p("div",{ref_key:"lblComponent",ref:d,id:"container"},[m.value===0&&((h=t.patient)!=null&&h.latestVisitDate||(y=t.patient)!=null&&y.patientID)?(f(),p("div",mn,[(O=t.patient)!=null&&O.latestVisitDate?(f(),p("span",pn,[r[0]||(r[0]=o("b",null,"Visit:",-1)),V(" "+P(t.patient.latestVisitDate),1)])):D("",!0),(N=t.patient)!=null&&N.patientID?(f(),p("span",fn,P(t.patient.patientID),1)):D("",!0)])):D("",!0),m.value===0&&((L=t.patient)!=null&&L.patientName||(M=t.patient)!=null&&M.gender||(_=t.patient)!=null&&_.diagnoses&&t.patient.diagnoses.length>0)?(f(),p("div",gn,[(e=t.patient)!=null&&e.patientName||(S=t.patient)!=null&&S.gender?(f(),p("span",_n,[o("b",null,P((B=t.patient)==null?void 0:B.patientName)+P((H=t.patient)!=null&&H.gender?"(".concat(t.patient.gender,")"):""),1)])):D("",!0),(it=t.patient)!=null&&it.prescriber?(f(),p("span",vn,[r[1]||(r[1]=o("b",null,"Seen by:",-1)),V(P(t.patient.prescriber),1)])):D("",!0),(ot=t.patient)!=null&&ot.nextAppointment?(f(),p("span",hn,[r[2]||(r[2]=o("b",null,"Nxt App:",-1)),V(" "+P(t.patient.nextAppointment),1)])):D("",!0)])):D("",!0),m.value===0&&((st=t.patient)!=null&&st.diagnoses)&&t.patient.diagnoses.length>0?(f(),p("div",yn,[o("span",bn,[r[3]||(r[3]=o("b",null,"Diagnoses:",-1)),V(" "+P(t.patient.diagnoses.filter($=>$).join(", ")),1)])])):D("",!0),m.value===0&&b.value?(f(),p("div",wn,[(rt=(lt=t.patient)==null?void 0:lt.vitals)!=null&&rt.height?(f(),p("span",In,P(t.patient.vitals.height),1)):D("",!0),(ut=(ct=t.patient)==null?void 0:ct.vitals)!=null&&ut.weight?(f(),p("span",Dn,P(t.patient.vitals.weight),1)):D("",!0),(mt=(dt=t.patient)==null?void 0:dt.vitals)!=null&&mt.bloodPressure?(f(),p("span",xn,P(t.patient.vitals.bloodPressure),1)):D("",!0),(pt=t.patient)!=null&&pt.bloodGlucose?(f(),p("span",Sn,P(t.patient.bloodGlucose),1)):D("",!0)])):D("",!0),g.value.length>0?(f(),p("table",Cn,[m.value===0?(f(),p("thead",Pn,r[4]||(r[4]=[o("tr",null,[o("th",null,"Drug"),o("th",null,"Dose"),o("th",null,"Freq"),o("th",null,"Qty")],-1)]))):D("",!0),o("tbody",null,[(f(!0),p(X,null,Jt(g.value,($,Pt)=>(f(),p("tr",{key:Pt},[o("td",null,P(($==null?void 0:$.name)||""),1),o("td",null,P(($==null?void 0:$.dose)||""),1),o("td",null,P(($==null?void 0:$.frequency)||""),1),o("td",null,P(($==null?void 0:$.quantity)||""),1)]))),128))])])):D("",!0)],512)}}}),$n=at(Nn,[["__scopeId","data-v-777d67d0"]]);async function Ln(){await dn($n,{copies:1})}function Gn(){const t=k(te.isNativePlatform()),a=k([]),l=k(null),d=k(!1),m=k(null),v=z().patient;return{isMobile:t,visits:a,event:l,popoverOpen:d,program:m,patient:v,openPopover:y=>{l.value=y,d.value=!0},openPIM:()=>{J(Ve,{class:"otherVitalsModal largeModal"})},openOutCome:()=>{J(Ge,{class:"large-modal-x10"})},printVisitSummary:async()=>{Ct.getProgramID()==32?await Ln():new Q().printData("visit")},printID:()=>{new Q().printData("barcode")},formatCurrentAddress:y=>{var N,L,M;return[(N=y==null?void 0:y.personInformation)==null?void 0:N.current_district,(L=y==null?void 0:y.personInformation)==null?void 0:L.current_traditional_authority,(M=y==null?void 0:y.personInformation)==null?void 0:M.current_village].filter(Boolean).join(",")},openUpdateNCDNUmbers:()=>{J(sn,{class:"large-modal-x10"})}}}export{Ve as p,Gn as u};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BaseTextInput-CJOyBcGe.js","./vendor-DsxEpk-1.js","./lodash-NJiRuGo9.js","./vendor-DbiJpP_M.css","./Export-Cx0a4sfL.js","./index-CIrmiTzZ.js","./apexcharts-DDANAUjz.js","./index-DfbtxZkW.css","./BaseTextInput-im3w8IG-.css","./FieldMixin-C9VdJBBr.js","./FieldMixin.vue_vue_type_script_lang-s8Z7qEb3.js","./FilingNumberView-BAwr9JA2.js","./FilingNumberView-pSC3NKRb.css","./HisArtRegimenSelection-DnrukAVQ.js","./SelectMixin-YkLkm2CW.js","./KbHandler-BFT2Bt2h.js","./SelectMixin-Fz_2IHAq.css","./HisArtRegimenSelection-wUvbJP8Y.css","./HisCardSelector-b4A_Euvp.js","./HisCardSelector-BhcOqAQI.css","./HisComplaintsPicker-DBNzO-b7.js","./patient_complaints_service-XVvmjXRw.js","./HisComplaintsPicker-Dvl4G5-7.css","./HisDataTable-BJXSFF4N.js","./HisDataTable-B2EViXEM.css","./HisDateInput-BBG_5PK1.js","./HisDateInput-CEuyog-B.css","./HisInfiniteScrollMultipleSelect-crZUBEpu.js","./HisMonthlyDays-CS408GCz.js","./HisMultiSelectGrid-BUf_N-2Y.js","./HisMultiSelectGrid-SzGiN7Yd.css","./HisNextVisitInterval-DhIi6ls8.js","./HisNextVisitInterval-Bz2r61Oi.css","./HisNumberInput-zIYnLTD1.js","./HisSelect-LFON2pgG.js","./HisSelect-0MS4TLtS.css","./PersonMatchView-DzcOrVBW.js","./PersonMatchView-Djotg6oa.css","./PersonSearchView-DXapthJ9.js","./PersonSearchView-UnAjhQF2.css","./RelationsSelection-D0k_zMVu.js","./RelationsSelection-I01GXrLd.css"])))=>i.map(i=>d[i]);
var He=Object.defineProperty;var Le=(e,t,n)=>t in e?He(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var G=(e,t,n)=>Le(e,typeof t!="symbol"?t+"":t,n);import{eh as ge,d as L,ei as Me,ej as Be,bz as xe,by as Ue,ek as Ye,L as qe,N as ne,H as p,e as b,f as c,k as w,m as O,F as x,P as q,p as W,Z as X,Q as N,O as I,K as k,l as h,bp as Ge,J as d,j as Ie,a9 as oe,aa as re,bh as We,E as Pe,I as ce,G as de,M as pe,a8 as me,ae as he,a_ as je,bO as ve,R as U,U as ye,c8 as De,ct as Se,ci as _,el as Ce,bL as fe,i as Re,v as ze,a2 as Ke,a1 as Je,r as se,w as Qe,dP as Ze,z,br as Xe}from"./vendor-DsxEpk-1.js";import{l as A}from"./lodash-NJiRuGo9.js";import{S as P,ay as et,bF as tt,H,bG as nt,bH as ot,s as te,bI as rt,_ as B,t as Ae,h as Te,g as st,bJ as it,bK as at,bL as lt,P as ie}from"./index-CIrmiTzZ.js";import{t as ut,a as ct}from"./Export-Cx0a4sfL.js";const dt={one:"AL 1",two:"AL 2",three:"AL 3",four:"LA 4"},no=["Diabetes","Hypertension","Stroke","Suspected cancer","Confirmed cancer","Palliative cancer","Asthma","Depression","Acute psychosis","Chronic psychosis","Epilepsy"],oo=["Organic mental disorder (Chronic)","Organic mental disorder (acute)","Alcohol use mental disorder","Drug use mental disorder","Schizophrenia","Acute and transient psychotic disorder","Schizo-affective disorder","Mood-affective disorder (MANIC)","Mood-affective disorder (BIPOLAR)","Mood-affective disorder (DEPRESSION)","Anxiety disorder","Stress reaction adjustment disorder","Dissociative conversion disorder","Somatoform disorder","Puerperal mental disorder","Personality/Behaviour disorder","Mental retardation","Psychological mental disorder","Hyperkinetic conduct disorder","Epilepsy"];class $e extends P{constructor(){super();G(this,"programID");G(this,"startDate");G(this,"endDate");G(this,"date");G(this,"epiweek");this.endDate="",this.startDate="",this.epiweek="",this.date=P.getSessionDate(),this.programID=P.getProgramID()}getPatientsWithNIDs(){return this.getReport("with_nids")}getClinicRegistrations(){return this.getReport("registration")}getAttendance(){return this.getReport("programs/".concat(this.programID,"/reports/attendance"))}getDrugs(){const n="programs/".concat(this.programID,"/reports/drug");return P.getJson(n,{start_date:this.startDate,end_date:this.endDate,date:this.date})}getDiagnosis(){const n="programs/".concat(this.programID,"/reports/diagnosis");return P.getJson(n,{start_date:this.startDate,end_date:this.endDate,date:this.date})}getDiagnosisByAddress(){return this.getReport("diagnosis_by_address")}getLaPrescriptions(){const n="programs/".concat(this.programID,"/reports/la_prescriptions");return P.getJson(n,{start_date:this.startDate,end_date:this.endDate})}getMalariaReport(){const n="programs/".concat(this.programID,"/reports/malaria_report");return P.getJson(n,{start_date:this.startDate,end_date:this.endDate,date:this.date})}printLaReport(n){const o=new et,r="programs/".concat(this.programID,"/barcodes/la_report"),a={"date[start]":this.startDate,"date[end]":this.endDate};return Object.keys(dt).forEach((s,u)=>{u++,a["".concat(u,"[prescription]")]=n["total_la_".concat(s,"_prescribed_drugs")],a["".concat(u,"[dispensed]")]=n["total_la_".concat(s,"_dispensed_drugs")]}),o.printLbl("".concat(r,"?").concat(tt.parameterizeObjToString(a)))}getDateIntervalPeriod(){return"".concat(H.toStandardHisDisplayFormat(this.startDate)," - ").concat(H.toStandardHisDisplayFormat(this.endDate))}setStartDate(n){this.startDate=n}setEndDate(n){this.endDate=n}setEpiWeek(n){this.epiweek=n}getReportPeriod(){return this.startDate&&this.endDate?"".concat(H.toStandardHisDisplayFormat(this.startDate)," - ").concat(H.toStandardHisDisplayFormat(this.endDate)):"-"}getReport(n,o={}){return P.getJson(n,this.buildRequest(o))}buildRequest(n={}){const o={date:this.date,program_id:this.programID};return this.startDate&&this.endDate&&(o.start_date=this.startDate,o.end_date=this.endDate),this.epiweek&&(o.epiweek=this.epiweek),{...o,...n}}static getReportQuarters(n=4){const o=[];let r=H.getCurrentYear();for(let a=0;a<n;++a)o.push({name:"Q4 ".concat(r),start:"".concat(r,"-10-01"),end:"".concat(r,"-12-31")}),o.push({name:"Q3 ".concat(r),start:"".concat(r,"-07-01"),end:"".concat(r,"-09-30")}),o.push({name:"Q2 ".concat(r),start:"".concat(r,"-04-01"),end:"".concat(r,"-06-30")}),o.push({name:"Q1 ".concat(r),start:"".concat(r,"-01-01"),end:"".concat(r,"-03-31")}),--r;return o}}function ee(e){return typeof e!="string"?e:ot(e).replace(/,/gi," ").trim()}function be(e,t,n=""){const o=[],r=[],a=s=>{if(n==="csvMode"&&"csvExportable"in s)return s.csvExportable||!1;if(n==="pdfMode"&&"pdfExportable"in s)return s.pdfExportable!=null?s.pdfExportable:!0;if(n==="ignorePDFColumnexport"&&"pdfExportable"in s&&s.pdfExportable)return!1;if("exportable"in s)return s.exportable||!1};for(const s in t){const u=[];t[s].forEach((m,g)=>{const f=e[e.length-1][g];a(f)&&u.push(m.value?ee(m.value):ee(m.td))}),o.push(u)}for(const s in e){const u=[];e[s].forEach(m=>{a(m)&&u.push(m.value?ee(m.value):ee(m.th))}),A.isEmpty(u)||r.push(u)}return{columns:r,rows:o}}function Q(e){const t={th:()=>e.th?e.th:"",td:()=>e.td?e.td:"",value:()=>e.value?e.value:"",sortValue:()=>e.sortValue?e.sortValue:0,type(){return e.type?e.type:"string"},exportable(){return"exportable"in e?e.exportable:!0},csvExportable(){return"csvExportable"in e?e.csvExportable:!0},pdfExportable(){return"pdfExportable"in e?e.pdfExportable:void 0},sortable(){return"sortable"in e?e.sortable:!0},colspan(){return e.colspan?e.colspan:0},cssClass(){return e.cssClass?e.cssClass:0},style(){return e.style?e.style:0},ascSort(){return e.ascSort?e.ascSort:(o,r)=>ge(r).asc(a=>{var s,u;return((s=a[o])==null?void 0:s.sortValue)||((u=a[o])==null?void 0:u.td)})},descSort(){return e.descSort?e.descSort:(o,r)=>ge(r).desc(a=>{var s,u;return((s=a[o])==null?void 0:s.sortValue)||((u=a[o])==null?void 0:u.td)})}},n={};for(const o in t)n[o]=t[o]();return n}function pt(e,t={}){const n=t;return n.th=e,n.type="string",Q(n)}function mt(e,t={}){const n=t;return n.th=e,n.type="date",Q(n)}function ht(e,t={}){const n=t;return n.th=e,n.type="number",Q(n)}function ft(e,t={}){const n={...t};return n.td=nt(e),n.sortValue=parseInt("".concat(e)),n.style={textAlign:"right",paddingRight:".5rem",...n.style},Q(n)}function _t(e,t={}){const n=t;return n.td=e?H.toStandardHisDisplayFormat(e):"",Q(n)}function gt(e,t={}){return{td:e,...t}}function vt(e,t,n={}){return{td:e,event:{click:t,obj:"link"},...n}}function yt(e,t,n={},o=""){const r={td:e,event:{click:t,color:o,obj:"button"}};return n.event&&(r.event={...r.event,...n.event},delete n.event),Object.assign(r,n)}const T={thTxt:pt,thNum:ht,thDate:mt,tdNum:ft,td:gt,tdBtn:yt,tdDate:_t,tdLink:vt},Dt=L({emits:["onActiveRows","onActiveColumns","onPagination","onIsLoading","onTableRows"],components:{IonButton:ne,IonIcon:qe,IonSkeletonText:Ye},props:{config:{type:Object,default:()=>({})},columns:{type:Object,required:!0},rows:{type:Array,default:()=>[]},newPage:{type:Number},rowsPerPage:{type:Number},asyncRows:{type:Function},asyncRowParser:{type:Function},rowParser:{type:Function},searchFilter:{type:String},showFilters:{type:Boolean,default:!1},paginated:{type:Boolean,default:!1}},data:()=>({arrowUp:Ue,arrowDown:xe,caretBack:Be,caretForward:Me,sortedIndex:-1,sortOrder:"descSort",tableColumns:[],tableRows:[],paginatedRows:[],activeRows:[],currentPage:0,itemsPerPage:20,isLoading:!1,errorMessage:""}),watch:{isLoading:{handler(e){typeof e=="boolean"&&this.$emit("onIsLoading",e)},immediate:!0},newPage:{handler(e){typeof e=="number"&&this.onChangePage(e)},immediate:!0},rowsPerPage:{handler(e){typeof e=="number"&&(this.itemsPerPage=e)},immediate:!0},async itemsPerPage(e){A.isEmpty(this.tableRows)||(this.currentPage=0,await rt(100),this.paginateTableRows(e),await this.setPage(this.currentPage))},tableRows:{handler(e){A.isEmpty(e)||this.$emit("onTableRows",e)},immediate:!0,deep:!0},searchFilter(e){e?this.activeRows=this.searchDataSet(e,this.tableRows):this.paginated?this.setPage(this.currentPage):this.activeRows=this.tableRows},activeRows:{handler(e){this.$emit("onActiveRows",e)},immediate:!0,deep:!0},columns:{handler(e){if(!A.isEmpty(e)){if(this.showIndex()){const t=[...this.columns],n=this.columns.length-1;t[n]=[T.thNum("#"),...t[n]],this.tableColumns=t}else this.tableColumns=e;this.$emit("onActiveColumns",this.tableColumns)}},immediate:!0,deep:!0},asyncRows:{async handler(e){if(this.errorMessage="",typeof e=="function"){this.isLoading=!0;try{this.tableRows=this.addColumnIndexes(await e()),this.paginated?(this.paginateTableRows(),await this.setPage(0)):this.activeRows=this.tableRows}catch(t){this.errorMessage="".concat(t),te("".concat(t)),console.error(t)}this.isLoading=!1}},immediate:!0,deep:!0},rows:{async handler(e){if(this.errorMessage="",!e||A.isEmpty(e)){this.activeRows=[],this.tableRows=[];return}this.tableRows=this.addColumnIndexes(e),this.paginated?(this.paginateTableRows(),await this.setPage(0)):this.activeRows=this.tableRows},immediate:!0,deep:!0}},methods:{showIndex(){return this.config&&"showIndex"in this.config?this.config.showIndex:!1},addColumnIndexes(e){return this.showIndex()?e.map((t,n)=>{const o=[T.td(n+1)];return Array.isArray(t)?o.concat(t):[...o,t]}):e},paginateTableRows(e=0){this.paginatedRows=A.chunk(this.tableRows,e||this.itemsPerPage),this.$emit("onPagination",this.paginatedRows)},async setPage(e){this.activeRows=[];const t=this.paginatedRows[e];if(t){try{if(typeof this.asyncRowParser=="function"){this.activeRows=t;for(const n in t)this.activeRows[n]=await this.asyncRowParser(t[n])}else this.isLoading=!0,this.activeRows=typeof this.rowParser=="function"?await this.rowParser(t):t}catch(n){te("".concat(n)),this.errorMessage="".concat(n),console.error(n)}this.isLoading=!1}},async sort(e,t){this.showIndex()&&typeof this.rowParser=="function"&&e!=0||(e===this.sortedIndex?this.sortOrder=this.sortOrder==="ascSort"?"descSort":"ascSort":this.sortOrder="ascSort",this.sortedIndex=e,this.sortOrder in t&&(this.paginated?(this.tableRows=t[this.sortOrder](e,this.tableRows),this.paginateTableRows(),await this.setPage(this.currentPage)):this.activeRows=t[this.sortOrder](e,this.tableRows)))},searchDataSet(e,t){return t.filter(n=>{var r;const o=(r=JSON.stringify(n).match(/"td":"(.*?)"/g))==null?void 0:r.join(" ").replace(/"td":|"/g,"");return(o==null?void 0:o.match(new RegExp(e,"i")))||!1})},async onChangePage(e){this.currentPage=e,await this.setPage(e)}},computed:{noData(){return!this.isLoading&&A.isEmpty(this.activeRows)},columnLength(){try{return this.tableColumns[0].length}catch(e){return console.warn(e),5}},skeletonRows(){const e=[],t=this.config.skeletonTextRows?this.config.skeletonTextRows:10;for(let n=0;n<t;++n)e.push(n);return e}}}),Tt={key:0,class:"stick-report-header"},bt=["colspan","onClick"],Et={key:1},Ft=["colspan"],wt={key:2},It=["colspan"],Pt={key:0},St=["onClick"],Ct={key:1},Rt={key:0,class:"no-data-section vertically-align"},At={key:0},$t={key:1};function kt(e,t,n,o,r,a){const s=p("ion-icon"),u=p("ion-skeleton-text"),m=p("ion-button");return c(),b(x,null,[w("table",{class:W(["report-table",e.config.tableCssTheme||""])},[e.tableColumns?(c(),b("thead",Tt,[(c(!0),b(x,null,q(e.tableColumns,(g,f)=>(c(),b("tr",{key:f},[(c(!0),b(x,null,q(g,(l,y)=>(c(),b("th",{key:y,colspan:l.colspan||0,onClick:v=>e.sort(y,l),style:X(l.style),class:W(l.cssClass)},[N(k(l.th)+" ",1),e.sortedIndex===y&&l.sortable&&f+1===e.tableColumns.length?(c(),I(s,{key:0,icon:e.sortOrder==="ascSort"?e.arrowUp:e.arrowDown},null,8,["icon"])):O("",!0)],14,bt))),128))]))),128))])):O("",!0),e.isLoading?(c(),b("tbody",Et,[(c(!0),b(x,null,q(e.skeletonRows,(g,f)=>(c(),b("tr",{key:f},[w("td",{colspan:e.columnLength},[h(u,{animated:"",style:{width:"100%",height:"30px"}})],8,Ft)]))),128))])):O("",!0),e.noData?O("",!0):(c(),b("tbody",wt,[(c(!0),b(x,null,q(e.activeRows,(g,f)=>(c(),b("tr",{key:f},[(c(!0),b(x,null,q(g,(l,y)=>{var v,$,V;return c(),b("td",{key:y,colspan:l.colspan||0,class:W(l.cssClass),style:X(l.style)},[l.event?(c(),b("div",Pt,[((v=l==null?void 0:l.event)==null?void 0:v.obj)==="link"?(c(),b("a",{key:0,href:"#",class:W(["his-sm-text",l.cssClass]),style:X(l.style),onClick:Ge(S=>l.event.click(),["prevent"])},k(l.td),15,St)):O("",!0),l.event.obj==="button"?(c(),I(m,{key:1,color:(($=l==null?void 0:l.event)==null?void 0:$.color)||"",class:W(l.cssClass),style:X(l.style),disabled:((V=l==null?void 0:l.event)==null?void 0:V.disabled)!=null?l.event.disabled===!0:!1,onClick:S=>l.event.click()},{default:d(()=>[N(k(l.td),1)]),_:2},1032,["color","class","style","disabled","onClick"])):O("",!0)])):(c(),b("div",Ct,[h(s,{class:"his-sm-text",slot:"start","aria-hidden":"true",icon:l.td},null,8,["icon"])]))],14,It)}),128))]))),128))]))],2),e.noData?(c(),b("h1",Rt,[e.errorMessage?(c(),b("span",At,k(e.errorMessage),1)):(c(),b("span",$t," No data available in table "))])):O("",!0)],64)}const Nt=B(Dt,[["render",kt],["__scopeId","data-v-38e5dc7d"]]),ke=(e,t,n)=>{const o=e[t];return o?typeof o=="function"?o():Promise.resolve(o):new Promise((r,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==n?". Note that variables only represent file names one level deep.":""))))})};var M=(e=>(e.TT_LINKAGE_CODE="LinkageCodeInput",e.TT_MULTI_SELECT_GRID="HisMultiSelectGrid",e.TT_AGE_INPUT="HisAgeInput",e.TT_GROUP_SELECTOR="HisGroupSelector",e.TT_DATA_TABLE="HisDataTable",e.TT_GRID_SELECTOR="HisGridSelector",e.TT_NOTE="HisNote",e.TT_BARCODE="HisBarcodeInput",e.TT_MONTHLY_DAYS="HisMonthlyDays",e.TT_TEXT="HisTextInput",e.TT_NUMBER="HisNumberInput",e.TT_DATETIME="datetime",e.TT_SELECT="HisSelect",e.TT_MULTIPLE_SELECT="HisMultipleSelect",e.TT_ART_REGIMEN_SELECTION="HisArtRegimenSelection",e.TT_NEXT_VISIT_INTERVAL_SELECTION="HisNextVisitInterval",e.TT_TABLE_VIEWER="HisTableViewer",e.TT_DOSAGE_INPUT="HisDosageInput",e.TT_YES_NO="YesNoSelect",e.TT_MULTIPLE_YES_NO="MultiYesNoSelect",e.TT_SUMMARY="HisSummary",e.TT_WEIGHT_CHART="HisWeightChart",e.TT_VITALS_ENTRY="HisVitalsEntry",e.TT_ADHERENCE_INPUT="HisAdherenceInput",e.TT_ART_STAGING_SUMMARY="ArtStagingSummary",e.TT_LAB_ORDERS="HisLabOrders",e.TT_APPOINTMENTS_ENTRY="HisAppointments",e.TT_DISPENSATION_INPUT="DrugDispensationSelection",e.TT_PROGRAM_SELECTION="ProgramSelection",e.TT_DATE_PICKER="HisDatePicker",e.TT_PERSON_RESULT_VIEW="PersonSearchView",e.TT_RELATION_SELECTION="RelationsSelection",e.TT_FILING_NUMBER_VIEW="FilingNumberView",e.TT_CARD_SELECTOR="HisCardSelector",e.TT_PERSON_MATCH_VIEW="PersonMatchView",e.TT_FULL_DATE="HisDateInput",e.TT_BATCH_ENTRY="HisBatchEntry",e.TT_BATCH_VERIFICATION="HisBatchVerification",e.TT_BATCH_MOVEMENT="HisBatchMovement",e.TT_COMPLAINTS_PICKER="HisComplaintsPicker",e.TT_RADIOLOGY_PICKER="HisRadiologyPicker",e.TT_IP_ADDRESS="HisIPAddress",e.TT_TEXT_BANNER="HisTextBanner",e.TT_DRUG_DISPENSER="GeneralDrugDispenser",e.TT_CLINIC_HOLIDAY_PICKER="HisClinicHolidayPicker",e.TT_ANC_PREGNANCY_INPUT_CONFIG="AncPregnancyInfoConfig",e.TT_ANC_PREGNANCY_DETAILS_INPUT="AncPregnancyDetailsInput",e.TT_ANC_LMP_DATE_INPUT="AncLmpDateInput",e.TT_ANC_DRUGSET_INPUT="AncDrugSetInput",e.TT_DRUG_TRANSFER_IN="DrugTransferInput",e.TT_PRESCRIPTION_INPUT="HisPrescriptionInput",e.TT_INFINITE_SCROLL_MULTIPLE_SELECT="HisInfiniteScrollMultipleSelect",e))(M||{});const Ne=["LinkageCodeInput","HisMultiSelectGrid","HisAgeInput","HisBarcodeInput","HisNote","HisSelect","HisCardSelector","HisMultipleSelect","HisTextInput","HisNumberInput","HisMonthlyDays","HisArtRegimenSelection","HisNextVisitInterval","HisTableViewer","HisDosageInput","YesNoSelect","MultiYesNoSelect","HisWeightChart","HisVitalsEntry","HisAppointments","HisComplaintsPicker","HisClinicHolidayPicker","HisSummary","ArtStagingSummary","HisAdherenceInput","HisLabOrders","PersonSearchView","ProgramSelection","HisDatePicker","RelationsSelection","FilingNumberView","PersonMatchView","HisDateInput","HisBatchEntry","HisBatchVerification","HisBatchMovement","HisIPAddress","HisTextBanner","DrugDispensationSelection","HisDataTable","HisGroupSelector","AncPregnancyInfoConfig","AncPregnancyDetailsInput","AncLmpDateInput","DrugTransferInput","HisGridSelector","AncDrugSetInput","HisRadiologyPicker","HisPrescriptionInput","HisInfiniteScrollMultipleSelect","GeneralDrugDispenser"],Vt=L({name:"ToolBarMediumCard"}),Ot={class:"tool-bar-medium-card"};function Ht(e,t,n,o,r,a){return c(),b("div",Ot,[Ie(e.$slots,"default")])}const Lt=B(Vt,[["render",Ht]]);function Mt(e,t=2){return e.reduce((n,o,r)=>(r%t===0&&n.push(e.slice(r,r+t)),n),[])}function Bt(e,t){return Object.keys(e).sort((n,o)=>t(n,o)).reduce((n,o)=>(n[o]=e[o],n),{})}const xt={convertArrayToTurples:Mt,orderObj:Bt},Ut=L({name:"HisResultCard",components:{ToolBarMediumCard:Lt,IonGrid:We,IonCol:re,IonRow:oe},props:{items:{type:Object,required:!0}},computed:{rowItems(){return xt.convertArrayToTurples(this.items,2)}}});function Yt(e,t,n,o,r,a){const s=p("ion-col"),u=p("ion-row"),m=p("ion-grid"),g=p("tool-bar-medium-card");return c(),I(g,null,{default:d(()=>[h(m,null,{default:d(()=>[(c(!0),b(x,null,q(e.rowItems,(f,l)=>(c(),I(u,{key:l},{default:d(()=>[(c(!0),b(x,null,q(f,(y,v)=>(c(),I(s,{class:"col his-sm-text",key:v},{default:d(()=>[w("b",null,k(y.label)+":",1),N(" "+k(y.value),1)]),_:2},1024))),128))]),_:2},1024))),128))]),_:1})]),_:1})}const qt=B(Ut,[["render",Yt],["__scopeId","data-v-19f0802a"]]),Gt=L({name:"ViewPort",props:{showFull:{type:Boolean,default:()=>!0}}});function Wt(e,t,n,o,r,a){return c(),b("div",{id:"view-port",class:W(e.showFull?"":"half")},[Ie(e.$slots,"default",{},void 0,!0)],2)}const Ve=B(Gt,[["render",Wt],["__scopeId","data-v-b4da23b3"]]),jt=L({components:{ViewPort:Ve}});function zt(e,t,n,o,r,a){const s=p("view-port");return c(),I(s,null,{default:d(()=>[...t[0]||(t[0]=[w("div",{class:"linear-background"},[w("div",{class:"inter-draw"}),w("div",{class:"inter-crop"}),w("div",{class:"inter-right--top"}),w("div",{class:"inter-right--bottom"})],-1)])]),_:1})}const Kt=B(jt,[["render",zt],["__scopeId","data-v-e764537f"]]),Jt=L({components:{ViewPort:Ve}});function Qt(e,t,n,o,r,a){const s=p("view-port");return c(),I(s,null,{default:d(()=>[...t[0]||(t[0]=[w("div",{class:"vertically-align"}," Error Loading form element. Exit app and try again and check your network. ",-1)])]),_:1})}const Zt=B(Jt,[["render",Qt]]);function Xt(){const e={};return Ne.forEach(t=>{e[t]=Se({loader:()=>ke(Object.assign({"../FormElements/BaseTextInput.vue":()=>_(()=>import("./BaseTextInput-CJOyBcGe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url),"../FormElements/FieldMixin.vue":()=>_(()=>import("./FieldMixin-C9VdJBBr.js"),__vite__mapDeps([9,10,1,2,3]),import.meta.url),"../FormElements/FilingNumberView.vue":()=>_(()=>import("./FilingNumberView-BAwr9JA2.js"),__vite__mapDeps([11,10,1,2,3,5,6,7,4,12]),import.meta.url),"../FormElements/HisArtRegimenSelection.vue":()=>_(()=>import("./HisArtRegimenSelection-DnrukAVQ.js"),__vite__mapDeps([13,14,15,1,2,3,5,6,7,0,4,8,10,16,17]),import.meta.url),"../FormElements/HisCardSelector.vue":()=>_(()=>import("./HisCardSelector-b4A_Euvp.js"),__vite__mapDeps([18,14,15,1,2,3,5,6,7,0,4,8,10,16,19]),import.meta.url),"../FormElements/HisComplaintsPicker.vue":()=>_(()=>import("./HisComplaintsPicker-DBNzO-b7.js"),__vite__mapDeps([20,1,2,3,14,15,5,6,7,0,4,8,10,16,21,22]),import.meta.url),"../FormElements/HisDataTable.vue":()=>_(()=>import("./HisDataTable-BJXSFF4N.js"),__vite__mapDeps([23,10,1,2,3,5,6,7,4,24]),import.meta.url),"../FormElements/HisDateInput.vue":()=>_(()=>import("./HisDateInput-BBG_5PK1.js"),__vite__mapDeps([25,10,1,2,3,5,6,7,4,26]),import.meta.url),"../FormElements/HisInfiniteScrollMultipleSelect.vue":()=>_(()=>import("./HisInfiniteScrollMultipleSelect-crZUBEpu.js"),__vite__mapDeps([27,15,1,2,3,5,6,7,0,4,8,10]),import.meta.url),"../FormElements/HisMonthlyDays.vue":()=>_(()=>import("./HisMonthlyDays-CS408GCz.js"),__vite__mapDeps([28,0,1,2,3,4,5,6,7,8,15,10]),import.meta.url),"../FormElements/HisMultiSelectGrid.vue":()=>_(()=>import("./HisMultiSelectGrid-BUf_N-2Y.js"),__vite__mapDeps([29,10,1,2,3,5,6,7,4,30]),import.meta.url),"../FormElements/HisNextVisitInterval.vue":()=>_(()=>import("./HisNextVisitInterval-DhIi6ls8.js"),__vite__mapDeps([31,1,2,3,5,6,7,14,15,0,4,8,10,16,32]),import.meta.url),"../FormElements/HisNumberInput.vue":()=>_(()=>import("./HisNumberInput-zIYnLTD1.js"),__vite__mapDeps([33,0,1,2,3,4,5,6,7,8,15,10]),import.meta.url),"../FormElements/HisSelect.vue":()=>_(()=>import("./HisSelect-LFON2pgG.js"),__vite__mapDeps([34,14,15,1,2,3,5,6,7,0,4,8,10,16,35]),import.meta.url),"../FormElements/PersonMatchView.vue":()=>_(()=>import("./PersonMatchView-DzcOrVBW.js"),__vite__mapDeps([36,1,2,3,10,5,6,7,37]),import.meta.url),"../FormElements/PersonSearchView.vue":()=>_(()=>import("./PersonSearchView-DXapthJ9.js"),__vite__mapDeps([38,1,2,3,10,5,6,7,39]),import.meta.url),"../FormElements/RelationsSelection.vue":()=>_(()=>import("./RelationsSelection-D0k_zMVu.js"),__vite__mapDeps([40,10,1,2,3,5,6,7,4,41]),import.meta.url),"../FormElements/SelectMixin.vue":()=>_(()=>import("./SelectMixin-YkLkm2CW.js"),__vite__mapDeps([14,15,1,2,3,5,6,7,0,4,8,10,16]),import.meta.url)}),"../FormElements/".concat(t,".vue"),3),loadingComponent:Kt,errorComponent:Zt,delay:150,timeout:5e4})}),e}const en=L({name:"TouchscreenForm",components:{InfoCard:qt,IonButtons:je,IonPage:he,IonContent:me,IonFooter:pe,IonToolbar:de,IonButton:ne,IonHeader:ce,IonTitle:Pe,IonCol:re,IonRow:oe,...Xt()},emits:["onFinish","onIndex"],props:{onFinish:{type:Function},skipSummary:{type:Boolean,default:!1},activeField:{type:String},fields:{type:Object,required:!0},cancelDestinationPath:{type:String},disableAutoModalDismiss:{type:Boolean},cancelAction:{type:Function}},data:()=>({ftBtnEvent:{eventIndex:0,btnName:"",btnOutput:null},helpText:"",valueClearIndex:0,currentIndex:0,currentField:{},currentFieldContext:null,formData:{},computedFormData:{},footerBtns:[],currentFields:[],fieldsInitialisedOnce:{},state:""}),watch:{fields:{async handler(e){if(!A.isEmpty(e)){this.buildFormData(e);let t=e;this.skipSummary||(t=[...t,this.getDefaultSummaryField()]),this.currentFields=t,this.activeField?this.mountField(this.activeField):await this.onNext()}},immediate:!0,deep:!0},state:{handler(e){["onValue","onClear","next","prev","onfinish","onload","unload"].includes(e)&&(ve.getTop().then(t=>t?ve.dismiss():null),this.disableAutoModalDismiss||U.getTop().then(t=>t&&U.dismiss()),ye.getTop().then(t=>t?ye.dismiss():null),De.getTop().then(t=>t?De.dismiss():null))},immediate:!0,deep:!0},activeField:{async handler(e){e&&this.mountField(e)}}},mounted(){this.footerBtns=[this.getCancelBtn()]},methods:{clearValue(){this.valueClearIndex+=1,this.setActiveFieldValue(null)},async onFtButtonClicked(e){this.ftBtnEvent.eventIndex+=1,this.ftBtnEvent.btnName=e.name,this.ftBtnEvent.btnOutput=await e.onClick(this.formData,this.computedFormData,this.currentFieldContext),e.onClickComponentEvents?this.ftBtnEvent.onClickComponentEvents=e.onClickComponentEvents:this.ftBtnEvent.onClickComponentEvents&&delete this.ftBtnEvent.onClickComponentEvents},async mountField(e){if(e==="_NEXT_FIELD_")return await this.goNext(),this.$emit("onIndex",this.currentIndex);const t=A.findIndex(this.currentFields,{id:e});t>=0&&t<=this.currentFields.length&&(this.setActiveFieldComputedValue(),this.setActiveField(t),this.$emit("onIndex",t))},getCancelBtn(e={}){const t=e||{};return{name:t.name||"Cancel",color:t.color||"danger",onClick:async()=>{if(t.onClick)return t.onClick();if(await Te("Are you sure you want to cancel?")){if(typeof this.cancelAction=="function")return this.cancelAction();this.cancelDestinationPath?this.$router.push(this.cancelDestinationPath):this.$router.back()}}}},getClearBtn(e={}){const t=e||{};return{name:t.name||"Clear",color:t.color||"warning",slot:"end",onClick:async()=>{if(t.onClick)return t.onClick();await Te("Are you sure you want to clear field data?")&&this.clearValue()}}},getBackBtn(e={}){const t=e||{},n=()=>!(this.currentFields.length===1||this.currentIndex<=0);return{name:(t==null?void 0:t.name)||"Back",slot:"end",state:{disabled:{default:()=>!1,onsubmit:()=>!0},visible:{onload:()=>n(),default:()=>n()}},onClick:()=>t.onClick?t.onClick():this.goBack()}},getNextBtn(e={}){const t=e||{},n=()=>!(this.currentIndex+1>=this.currentFields.length||this.currentFields.length<=1);return{name:(t==null?void 0:t.name)||"Next",color:(t==null?void 0:t.color)||"success",slot:"end",state:(t==null?void 0:t.state)||{disabled:{onsubmit:()=>!0,default(o){return"requireNext"in o?!o.requireNext:!1}},visible:{onsubmit:()=>!1,onfinish:()=>!1,default:()=>n(),onload:()=>n()}},onClick:()=>t.onClick?t.onClick():this.goNext()}},getFinishBtn(e={}){const t=e||{},n=()=>this.currentIndex+1>=this.currentFields.length;return{name:(t==null?void 0:t.name)||"Finish",color:(t==null?void 0:t.color)||"success",slot:"end",state:{disabled:{default:()=>!1,onsubmit:()=>!0},visible:{onfinish:()=>!0,onsubmit:()=>!0,default:()=>n(),onload:()=>n()}},onClick:()=>t.onClick?t.onClick():this.goNext()}},onVisibleBtnState(e){var t,n,o;try{if((n=(t=this.currentField)==null?void 0:t.config)!=null&&n.hiddenFooterBtns.includes(e.name))return!1}catch(r){}if((o=e==null?void 0:e.state)!=null&&o.visible){if(this.state in e.state.visible)return e.state.visible[this.state](this.currentField,this.formData);if("default"in e.state.visible)return e.state.visible.default(this.currentField,this.formData)}return!0},onDisabledBtnState(e){var t;if((t=e==null?void 0:e.state)!=null&&t.disabled){if(this.state in e.state.disabled)return e.state.disabled[this.state](this.currentField,this.formData);if("default"in e.state.disabled)return e.state.disabled.default(this.currentField,this.formData)}return!1},getDefaultSummaryField(){return{id:"__form_summary__",helpText:"Summary",type:M.TT_SUMMARY,config:{hiddenFooterBtns:["Clear"]},options:(e,t)=>{const n=[];for(const o in e){const r=this.currentFields.filter(u=>u.id===o||u.proxyID===o)[0],a=e[o];if(!a||r.appearInSummary!=null&&!r.appearInSummary(e,o))continue;(Array.isArray(a)?a:[a]).forEach(u=>{if(r.summaryMapValue){n.push(r.summaryMapValue(u,e,t[o]));return}n.push({label:r.helpText,value:u.label})})}return n}}},resolveFormValues(e){const t={};for(const n in e)e[n]!=null&&(t[n]=e[n]);return t},async onFinishAction(){const e=this.resolveFormValues(this.formData),t=this.resolveFormValues(this.computedFormData);if(this.onFinish)try{this.state="onsubmit",await this.onFinish(e,t)}catch(n){console.error(n),te("".concat(n))}this.state="onfinish",this.$emit("onFinish",e,t)},async goNext(){if(this.currentField.validation){const e=this.formData[this.currentField.id],t=this.currentField.validation(e,this.formData,this.computedFormData);if(t)return Ae(t.join(", "),2e3)}this.currentField.beforeNext&&!await this.currentField.beforeNext(this.formData[this.currentField.id],this.formData,this.computedFormData,this)||await this.onNext()},async goBack(){for(let e=this.currentIndex;e>=0;--e){const t=this.currentFields[e];if(!(!A.isEmpty(this.currentField)&&this.currentField.id===t.id)){await this.initFieldOnce(t);try{if(!await this.checkFieldCondition(t))continue}catch(n){continue}await this.setActiveField(e,"prev");return}}},async checkFieldCondition(e){return e.condition&&!await e.condition(this.formData,this.computedFormData)?(typeof e.onConditionFalse=="function"&&e.onConditionFalse(),this.formData[e.id]=e.defaultOutput?e.defaultOutput(this.formData,this.computedFormData):null,e.computedValue&&(this.computedFormData[e.id]=e.defaultComputedOutput?e.defaultComputedOutput(this.formData,this.computedFormData):null),!1):!0},onFieldActivated(e){this.state="onload",this.currentFieldContext=e,this.currentField.onload&&this.currentField.onload(e)},async onUnload(e=""){try{if(this.state="unload",!A.isEmpty(this.currentField)&&this.currentField.unload){const t=this.formData[this.currentField.id];await this.currentField.unload(t,e,this.formData,this.computedFormData,this)}}catch(t){console.error(t)}},buildFormData(e){this.formData={},e.forEach(t=>{t.proxyID&&(this.formData[t.proxyID]=null),this.formData[t.id]=null})},async setActiveFieldValue(e){this.state="onValue";const t=this.currentField.proxyID,n=this.currentField.id;t&&(this.formData[t]=e),this.formData[n]=e,typeof this.currentField.updateHelpTextOnValue=="function"&&(this.helpText=this.currentField.updateHelpTextOnValue(e,this.formData))},async onNext(){const e=this.currentFields.length;for(let t=this.currentIndex;t<e;++t){const n=this.currentFields[t];if(!(!A.isEmpty(this.currentField)&&this.currentField.id===n.id)){await this.initFieldOnce(n);try{if(!await this.checkFieldCondition(n))continue}catch(o){continue}if(typeof this.currentField.exitsForm=="function"&&this.currentField.exitsForm(this.formData,this.computedFormData))break;this.setActiveFieldComputedValue(),this.setActiveField(t,"next");return}}this.setActiveFieldComputedValue(),await this.onFinishAction()},async setActiveField(e,t=""){var o;await this.onUnload(t),this.state=t,this.currentIndex=e,this.currentField=this.currentFields[this.currentIndex],await this.initFieldOnce(this.currentField),this.helpText=this.currentField.dynamicHelpText?this.currentField.dynamicHelpText(this.formData):typeof this.currentField.updateHelpTextOnValue=="function"?this.currentField.updateHelpTextOnValue(this.formData[this.currentField.id],this.computedFormData[this.currentField.id]):this.currentField.helpText,this.footerBtns=[this.getCancelBtn()],this.currentField.config&&this.currentField.config.footerBtns&&(this.footerBtns=this.footerBtns.concat(this.currentField.config.footerBtns));const n=(o=this.currentField.config)==null?void 0:o.overrideDefaultFooterBtns;this.footerBtns.push(this.getClearBtn(n==null?void 0:n.clearBtn)),this.footerBtns.push(this.getBackBtn(n==null?void 0:n.backBtn)),this.footerBtns.push(this.getNextBtn(n==null?void 0:n.nextBtn)),this.footerBtns.push(this.getFinishBtn(n==null?void 0:n.finishBtn))},setActiveFieldComputedValue(){if(typeof this.currentField=="object"&&typeof this.currentField.computedValue=="function"){const e=this.currentField.proxyID||this.currentField.id,t=this.formData[e];t!=null||!t?this.computedFormData[e]=this.currentField.computedValue(t,this.formData,this.computedFormData):this.computedFormData[e]=null}},onFieldValue(e){this.setActiveFieldValue(e),"requireNext"in this.currentField&&!this.currentField.requireNext&&this.onNext()},async initFieldOnce(e){typeof e.init=="function"&&(this.fieldsInitialisedOnce[e.id]||(this.fieldsInitialisedOnce["".concat(e.id)]=await e.init(this.formData,this.computedFormData)))}}});function tn(e,t,n,o,r,a){const s=p("ion-title"),u=p("ion-col"),m=p("info-card"),g=p("ion-row"),f=p("ion-toolbar"),l=p("ion-header"),y=p("ion-content"),v=p("ion-button"),$=p("ion-footer"),V=p("ion-page");return c(),b(x,null,[N(k(e.currentField)+" ",1),h(V,null,{default:d(()=>[h(l,null,{default:d(()=>[h(f,null,{default:d(()=>[h(g,null,{default:d(()=>{var S,Y;return[h(u,null,{default:d(()=>[h(s,{class:"his-lg-text"},{default:d(()=>[N(k(e.helpText),1)]),_:1})]),_:1}),(Y=(S=e.currentField)==null?void 0:S.config)!=null&&Y.toolbarInfo?(c(),I(u,{key:0},{default:d(()=>{var E,K;return[h(m,{style:{height:"100%"},items:(K=(E=e.currentField)==null?void 0:E.config)==null?void 0:K.toolbarInfo},null,8,["items"])]}),_:1})):O("",!0)]}),_:1})]),_:1})]),_:1}),h(y,null,{default:d(()=>[(c(),I(Ce,null,[(c(),I(fe(e.currentField.type),{key:e.currentField.id,config:e.currentField.config,options:e.currentField.options,preset:e.currentField.preset,clear:e.valueClearIndex,fdata:e.formData,cdata:e.computedFormData,activationState:e.state,onValue:e.currentField.onValue,defaultValue:e.currentField.defaultValue,onValueUpdate:e.currentField.onValueUpdate,footerButtonEvent:e.ftBtnEvent,onOnValue:e.onFieldValue,onOnFieldActivated:e.onFieldActivated},null,40,["config","options","preset","clear","fdata","cdata","activationState","onValue","defaultValue","onValueUpdate","footerButtonEvent","onOnValue","onOnFieldActivated"]))],1024))]),_:1}),h($,null,{default:d(()=>[h(f,{color:"dark"},{default:d(()=>[(c(!0),b(x,null,q(e.footerBtns,(S,Y)=>Re((c(),I(v,{key:Y,slot:S.slot||"start",class:W(S.styleClass),onClick:E=>e.onFtButtonClicked(S),color:S.color||"primary",size:S.size||"large",disabled:e.onDisabledBtnState(S)},{default:d(()=>[N(k(S.name),1)]),_:2},1032,["slot","class","onClick","color","size","disabled"])),[[ze,e.onVisibleBtnState(S)]])),128))]),_:1})]),_:1})]),_:1})],64)}const nn=B(en,[["render",tn]]),on=L({name:"HisStandardForm",components:{TouchScreenForm:nn},emits:["onFinish","onIndex"],data:()=>({formType:"touch-screen-form"}),props:{onFinishAction:{type:Function},skipSummary:{type:Boolean,default:!1},activeField:{type:String},fields:{type:Object,required:!0},cancelDestinationPath:{type:String,required:!1}},methods:{onFinish(e,t){this.$emit("onFinish",e,t)},onIndex(e){this.$emit("onIndex",e)}}});function rn(e,t,n,o,r,a){return c(),I(fe(e.formType),{fields:e.fields,skipSummary:e.skipSummary,activeField:e.activeField,cancelDestinationPath:e.cancelDestinationPath,onOnFinish:e.onFinish,onFinish:e.onFinishAction,onOnIndex:e.onIndex},null,40,["fields","skipSummary","activeField","cancelDestinationPath","onOnFinish","onFinish","onOnIndex"])}const ro=B(on,[["render",rn]]);function sn(){const e={};return Ne.forEach(t=>{e[t]=Se(()=>ke(Object.assign({"../FormElements/BaseTextInput.vue":()=>_(()=>import("./BaseTextInput-CJOyBcGe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url),"../FormElements/FieldMixin.vue":()=>_(()=>import("./FieldMixin-C9VdJBBr.js"),__vite__mapDeps([9,10,1,2,3]),import.meta.url),"../FormElements/FilingNumberView.vue":()=>_(()=>import("./FilingNumberView-BAwr9JA2.js"),__vite__mapDeps([11,10,1,2,3,5,6,7,4,12]),import.meta.url),"../FormElements/HisArtRegimenSelection.vue":()=>_(()=>import("./HisArtRegimenSelection-DnrukAVQ.js"),__vite__mapDeps([13,14,15,1,2,3,5,6,7,0,4,8,10,16,17]),import.meta.url),"../FormElements/HisCardSelector.vue":()=>_(()=>import("./HisCardSelector-b4A_Euvp.js"),__vite__mapDeps([18,14,15,1,2,3,5,6,7,0,4,8,10,16,19]),import.meta.url),"../FormElements/HisComplaintsPicker.vue":()=>_(()=>import("./HisComplaintsPicker-DBNzO-b7.js"),__vite__mapDeps([20,1,2,3,14,15,5,6,7,0,4,8,10,16,21,22]),import.meta.url),"../FormElements/HisDataTable.vue":()=>_(()=>import("./HisDataTable-BJXSFF4N.js"),__vite__mapDeps([23,10,1,2,3,5,6,7,4,24]),import.meta.url),"../FormElements/HisDateInput.vue":()=>_(()=>import("./HisDateInput-BBG_5PK1.js"),__vite__mapDeps([25,10,1,2,3,5,6,7,4,26]),import.meta.url),"../FormElements/HisInfiniteScrollMultipleSelect.vue":()=>_(()=>import("./HisInfiniteScrollMultipleSelect-crZUBEpu.js"),__vite__mapDeps([27,15,1,2,3,5,6,7,0,4,8,10]),import.meta.url),"../FormElements/HisMonthlyDays.vue":()=>_(()=>import("./HisMonthlyDays-CS408GCz.js"),__vite__mapDeps([28,0,1,2,3,4,5,6,7,8,15,10]),import.meta.url),"../FormElements/HisMultiSelectGrid.vue":()=>_(()=>import("./HisMultiSelectGrid-BUf_N-2Y.js"),__vite__mapDeps([29,10,1,2,3,5,6,7,4,30]),import.meta.url),"../FormElements/HisNextVisitInterval.vue":()=>_(()=>import("./HisNextVisitInterval-DhIi6ls8.js"),__vite__mapDeps([31,1,2,3,5,6,7,14,15,0,4,8,10,16,32]),import.meta.url),"../FormElements/HisNumberInput.vue":()=>_(()=>import("./HisNumberInput-zIYnLTD1.js"),__vite__mapDeps([33,0,1,2,3,4,5,6,7,8,15,10]),import.meta.url),"../FormElements/HisSelect.vue":()=>_(()=>import("./HisSelect-LFON2pgG.js"),__vite__mapDeps([34,14,15,1,2,3,5,6,7,0,4,8,10,16,35]),import.meta.url),"../FormElements/PersonMatchView.vue":()=>_(()=>import("./PersonMatchView-DzcOrVBW.js"),__vite__mapDeps([36,1,2,3,10,5,6,7,37]),import.meta.url),"../FormElements/PersonSearchView.vue":()=>_(()=>import("./PersonSearchView-DXapthJ9.js"),__vite__mapDeps([38,1,2,3,10,5,6,7,39]),import.meta.url),"../FormElements/RelationsSelection.vue":()=>_(()=>import("./RelationsSelection-D0k_zMVu.js"),__vite__mapDeps([40,10,1,2,3,5,6,7,4,41]),import.meta.url),"../FormElements/SelectMixin.vue":()=>_(()=>import("./SelectMixin-YkLkm2CW.js"),__vite__mapDeps([14,15,1,2,3,5,6,7,0,4,8,10,16]),import.meta.url)}),"../FormElements/".concat(t,".vue"),3))}),e}const an=L({name:"SingleFieldTouchForm",components:{IonPage:he,IonContent:me,IonFooter:pe,IonToolbar:de,IonButton:ne,IonHeader:ce,IonTitle:Pe,...sn()},props:{dismissType:{type:String},onFinish:{type:Function,required:!0},currentField:{type:Object,required:!0}},data:()=>({valueClearIndex:0,formData:{},computedFormData:{},state:"",value:null,disableBtn:!1}),methods:{onClose(){this.dismissType==="modal"?U.dismiss():this.$router.back()},onClear(){this.valueClearIndex+=1,this.value=null},onFieldValue(e){this.value=e},onDone(){if(this.disableBtn=!0,this.currentField.validation){const e=this.currentField.validation(this.value);if(this.disableBtn=!1,e)return Ae(e.join(", "),6e4)}try{this.onFinish(this.value)}catch(e){te("".concat(e)),console.error(e)}this.onClose(),this.disableBtn=!1}}});function ln(e,t,n,o,r,a){const s=p("ion-title"),u=p("ion-toolbar"),m=p("ion-header"),g=p("ion-content"),f=p("ion-button"),l=p("ion-footer"),y=p("ion-page");return c(),I(y,null,{default:d(()=>[h(m,null,{default:d(()=>[h(u,null,{default:d(()=>[h(s,{class:"his-lg-text ion-text-center"},{default:d(()=>[N(k(e.currentField.helpText),1)]),_:1})]),_:1})]),_:1}),h(g,null,{default:d(()=>[(c(),I(Ce,null,[(c(),I(fe(e.currentField.type),{key:e.currentField.id,options:e.currentField.options,preset:e.currentField.preset,clear:e.valueClearIndex,fdata:e.formData,config:e.currentField.config,cdata:e.computedFormData,activationState:e.state,onValue:e.currentField.onValue,defaultValue:e.currentField.defaultValue,onValueUpdate:e.currentField.onValueUpdate,onOnValue:e.onFieldValue},null,40,["options","preset","clear","fdata","config","cdata","activationState","onValue","defaultValue","onValueUpdate","onOnValue"]))],1024))]),_:1}),h(l,null,{default:d(()=>[h(u,{color:"light"},{default:d(()=>[h(f,{disabled:e.disableBtn,onClick:e.onClose,slot:"start",color:"danger",size:"large"},{default:d(()=>[...t[0]||(t[0]=[N(" Close ",-1)])]),_:1},8,["disabled","onClick"]),h(f,{disabled:e.disableBtn,onClick:e.onClear,slot:"end",color:"warning",size:"large"},{default:d(()=>[...t[1]||(t[1]=[N(" Clear ",-1)])]),_:1},8,["disabled","onClick"]),h(f,{disabled:e.disableBtn,onClick:e.onDone,slot:"end",color:"success",size:"large"},{default:d(()=>[...t[2]||(t[2]=[N(" Done ",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1})}const un=B(an,[["render",ln]]),cn=L({emits:["onItemsPerPage","onSearchFilter","onItemsVLtype"],components:{IonItem:Je,IonCol:re,IonRow:oe,IonInput:Ke,IonButton:ne},props:{customFilter:{type:Function},totalRowCount:{type:Number,default:15e3},disableSearchFilter:{type:Boolean,default:!1},disablePerPageFilter:{type:Boolean,default:!1},showPerPageFilter:{type:Boolean,default:!1}},setup(e,{emit:t}){const n=se(50),o=se(""),r=se("");async function a(f,l){(await U.create({component:un,backdropDismiss:!1,cssClass:"full-modal",componentProps:{dismissType:"modal",currentField:f,onFinish:l}})).present()}function s(f){t("onSearchFilter",f)}function u(){o.value="",s("")}async function m(){typeof e.customFilter=="function"&&(r.value=await e.customFilter())}function g(){a({id:"search",helpText:"Search table data",defaultValue:()=>o.value,type:M.TT_TEXT},f=>{o.value=f?f.value:"",s(o.value)})}return Qe(n,f=>{typeof f=="number"&&t("onItemsPerPage",f)},{immediate:!0}),{reset:u,itemsPerPage:n,searchFilter:o,launchFilter:m,launchKeyboard:a,launchSearcher:g,customFilterValue:r}}}),dn=["disabled"],pn=["selected"],mn=["selected"],hn=["selected"],fn=["selected"],_n=["selected"],gn=["selected"],vn=["selected","value"];function yn(e,t,n,o,r,a){const s=p("ion-col"),u=p("ion-input"),m=p("ion-button"),g=p("ion-item"),f=p("ion-row");return c(),I(f,null,{default:d(()=>[e.showPerPageFilter?(c(),I(s,{key:0},{default:d(()=>[Re(w("select",{class:"input_display","onUpdate:modelValue":t[0]||(t[0]=l=>e.itemsPerPage=l),disabled:e.disablePerPageFilter},[w("option",{selected:e.itemsPerPage===5,value:5},"5 rows/page",8,pn),w("option",{selected:e.itemsPerPage===10,value:10},"10 rows/page",8,mn),w("option",{selected:e.itemsPerPage===20,value:20},"20 rows/page",8,hn),w("option",{selected:e.itemsPerPage===50,value:50},"50 rows/page",8,fn),w("option",{selected:e.itemsPerPage===100,value:100},"100 rows/page",8,_n),w("option",{selected:e.itemsPerPage===1e3,value:1e3},"1000 rows/page",8,gn),w("option",{selected:e.itemsPerPage===e.totalRowCount,value:e.totalRowCount},"Show all rows("+k(e.totalRowCount)+")",9,vn)],8,dn),[[Ze,e.itemsPerPage]])]),_:1})):O("",!0),typeof e.customFilter=="function"?(c(),I(s,{key:1},{default:d(()=>[h(u,{class:"input_display",value:e.customFilterValue,onClick:e.launchFilter,placeholder:"Filter..."},null,8,["value","onClick"])]),_:1})):O("",!0),h(s,null,{default:d(()=>[h(g,{lines:"none"},{default:d(()=>[h(u,{disabled:e.disableSearchFilter,class:"input_display",value:e.searchFilter,onClick:e.launchSearcher,placeholder:"Search here..."},null,8,["disabled","value","onClick"]),e.searchFilter?(c(),I(m,{key:0,class:"reset_button",size:"large",onClick:t[1]||(t[1]=l=>e.reset()),color:"secondary"},{default:d(()=>[...t[2]||(t[2]=[N(" Reset ",-1)])]),_:1})):O("",!0)]),_:1})]),_:1})]),_:1})}const Dn=B(cn,[["render",yn],["__scopeId","data-v-7bf42b5b"]]),Oe=[{label:"Jan",value:1},{label:"Feb",value:2},{label:"Mar",value:3},{label:"Apr",value:4},{label:"May",value:5},{label:"Jun",value:6},{label:"Jul",value:7},{label:"Aug",value:8},{label:"Sep",value:9},{label:"Oct",value:10},{label:"Nov",value:11},{label:"Dec",value:12}];function Tn(e){try{for(const t in e){const n=e[t]();if(n)return n}}catch(t){return[t]}}function bn(e){return A.isEmpty(e)?["Value is required"]:null}function En(e){return A.isPlainObject(e)&&!/^[-+]?[0-9]*\.?[0-9]+$/.test("".concat(e==null?void 0:e.value))?["Not a valid number"]:null}function Fn(e){const t=/^(\+?265|0)(((8[89]|9[89])\d{7})|(1\d{6})|(2\d{8})|(31\d{8}))$/;return!e||!e.value.match(t)?["Not a valid phone number"]:null}function wn(e){const t=/^(?=[a-zA-Z0-9]*$)(?=\d+[a-zA-Z]|[a-zA-Z]+\d)([a-zA-Z\d]){8}$/;return A.isEmpty(e)||!e.value.toString().match(t)?["Not a valid Malawi National ID number"]:null}function In(e){const t=/\b(?:(?:2(?:[0-4][0-9]|5[0-5])|[0-1]?[0-9]?[0-9])\.){3}(?:(?:2([0-4][0-9]|5[0-5])|[0-1]?[0-9]?[0-9]))\b/;return!e||!e.value.match(t)?["Not a valid IP address"]:null}function Pn(e){const t=/^(?=.{2,100}$)[a-z!A-Z]+(?:['_.\-!\][a-z]+[a-z!A-Z])*$/;return!e||!e.label.match(t)?["Invalid name Input"]:null}function Sn(e){return isNaN(parseInt(e.value))?["Value must be a number"]:null}function Cn(e,t,n){const o=e?e.label.length:0;return o>=t&&o<=n?null:["Value length not within range of ".concat(t," - ").concat(n)]}function Rn(e,t,n){const o=parseInt(e.label);return o>=t&&o<=n?null:["".concat(o," not within range of ").concat(t," - ").concat(n)]}function An(e){return e.filter(n=>(n.value||n.other.value)==="No").length==e.length?["All values can not be no"]:null}function $n(e){const t=["all must be selected"];return e?e.filter(o=>o.value==="").length>0?t:null:t}function kn(e,t){return e===t?["Values can not be the same"]:null}const j={isFloatingPointNumber:En,validateSeries:Tn,required:bn,isMWPhoneNumber:Fn,isName:Pn,isNumber:Sn,hasLengthRangeOf:Cn,rangeOf:Rn,neitherOr:An,anyEmpty:$n,notTheSame:kn,isIPAddress:In,isMWNationalID:wn},Nn=[["1","2","3","+","-","/","*"],["4","5","6","%","=","<",">","Qwerty"],["7","8","9",".",","],["","0",""]],Z=[["1","2","3"],["4","5","6"],["7","8","9"],["","0",""]],Vn=[["1","2","3","4","5","6","7"],["8","9","10","11","12","13","14"],["15","16","17","18","19","20","21"],["22","23","24","25","26","27","28"],["29","30","31"]],On=[["a","b","c","d","e","f","g","h","."],["i","j","k","l","m","n","o","p","q"],["r","s","t","u","v","w","x","y","z"]],Hn=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l","'"],["z","x","c","v","b","n","m",",",".","A-Z"]],Ln=[Nn,[["","Delete"]]],so=[Z,[["Delete"]]],io=[Z,[["N/A"],["Delete","Unknown"]]],Mn=[Z,[["Delete"]]],Bn=[Z,[["Unknown","Delete"],["Qwerty","A-Z"]]],ao=[Vn,[["Unknown"]]],xn=[On,[["0-9","Delete"],["Qwerty","Unknown"],["","Space"]]],Un=[Hn,[["","Delete"],["?123","0-9"],["Space","Unknown"]]],lo=[{btn:"0-9",keyboard:Bn},{btn:"?123",keyboard:Ln},{btn:"A-Z",keyboard:xn},{btn:"Qwerty",keyboard:Un}];function Yn(e,t,n=!0){const o=[];return n&&o.push("UNKNOWN"),{id:e,helpText:"".concat(t," Year"),appearInSummary:()=>!1,type:M.TT_TEXT,config:{customKeyboard:[Z,[o,["DELETE"]]]}}}function qn(e,t){return{id:e,helpText:"".concat(t," Month"),appearInSummary:()=>!1,type:M.TT_SELECT,options:()=>Oe}}function Gn(e,t){return{id:e,helpText:"".concat(t," Day"),type:M.TT_MONTHLY_DAYS,appearInSummary:()=>!1}}function Wn(e,t){return{id:e,helpText:"".concat(t," Estimated period"),type:M.TT_SELECT,appearInSummary:()=>!1,options:()=>[{label:"6 months ago",value:180},{label:"12 months ago",value:365},{label:"18 months ago",value:540},{label:"24 months ago",value:730},{label:"Over 2 years ago",value:730}]}}function jn(e,t){return{id:e,helpText:"".concat(t," Age Estimate"),type:M.TT_NUMBER,appearInSummary:()=>!1,config:{keypad:Mn}}}function ae(e){return parseInt(e)<10?"0".concat(e):e}async function le(e,t,n){if(t.defaultValue){const o=await t.defaultValue(e);if(o){const[r,a,s]=o.split("-");switch(n){case"Year":return r||"";case"Month":return parseInt(a)||"";case"Day":return parseInt(s)||""}}}return""}function J(e){return H.toStandardHisDisplayFormat(e)}function ue(e,t,n,o){if(t.minDate){const r=t.minDate(n,o);if(new Date(e)<new Date(r))return["".concat(J(e)," is less than minimum date of ").concat(J(r))]}if(t.maxDate){const r=t.maxDate(n,o);if(r&&new Date(e)>new Date(r))return["".concat(J(e)," is greater than max date of  ").concat(J(r))]}}function Ee(e){let t="",n="",o="",r="",a=!1;const s="year_".concat(e.id),u="month_".concat(e.id),m="day_".concat(e.id),g="age_estimate_".concat(e.id),f="duration_estimate_".concat(e.id),l=Yn(s,e.helpText,e.estimation.allowUnknown),y=qn(u,e.helpText),v=Gn(m,e.helpText),$=jn(g,e.helpText),V=Wn(f,e.helpText),S=typeof e.estimation.allowUnknownMonthDay=="boolean"&&e.estimation.allowUnknownMonthDay,Y=i=>i[s]&&i[s].value&&["Unknown"].includes(i[s].value)?!1:e.condition?e.condition(i):!0,E=(i,D)=>[{type:"year",value:n,default:"YYYY"},{type:"month",value:o,default:"MM"},{type:"day",value:r,default:"DD"}].reduce((F,R)=>{const _e=[null,void 0,"Unknown",""];return D===R.type?_e.includes(i)?F.push(R.default):F.push(i):_e.includes(R.value)?F.push(R.default):F.push(R.value),F},[]).join("-");typeof e.init=="function"&&(l.init=e.init),l.updateHelpTextOnValue=i=>"".concat(l.helpText," (").concat(E(i==null?void 0:i.label,"year"),")"),l.proxyID=e.id,l.unload=i=>n=i.value.toString(),l.config={...l.config,...e.config},l.defaultValue=i=>le(i,e,"Year"),l.condition=i=>e.condition?e.condition(i):!0,l.validation=(i,D,C)=>{if(e.required&&j.required(i))return["Year cannot be empty"];const F=i?i.value:"";if(!e.estimation.allowUnknown&&F.toString().match(/unknown/i))return["Value unknown is not permitted"];if(F&&!["Unknown"].includes(F)&&isNaN(F)||F<1900)return["Invalid Year"];if(F&&typeof e.minDate=="function"){const R=H.getYear(e.minDate(D,C));if(parseInt(F)<R)return["Year of ".concat(F," is less than Minimum year of ").concat(R)]}if(F&&typeof e.maxDate=="function"){const R=e.maxDate(D,C);if(R&&F>H.getYear(R))return["Year of ".concat(F," exceeds Maximum year of ").concat(H.getYear(R))]}return null},l.summaryMapValue=()=>({label:e.summaryLabel||e.helpText,value:t?J(t):"Unknown"}),l.appearInSummary=(i,D)=>D===e.id,l.computedValue=i=>{if(t){const[,D,C]=t.split("-");return t="".concat(i.value,"-").concat(D,"-").concat(C),e.computeValue(t,!1)}if(i&&i.value==="Unknown")return t="",e.computeValue("Unknown",!1)},y.updateHelpTextOnValue=i=>"".concat(y.helpText," (").concat(E(i==null?void 0:i.label,"month"),")"),y.proxyID=e.id,y.unload=i=>o=ae(i.value.toString()),y.condition=i=>Y(i),y.validation=i=>j.required(i),y.defaultValue=i=>le(i,e,"Month"),S&&(y.options=()=>[...Oe,{label:"Unknown",value:"Unknown"}]),y.computedValue=(i,D)=>{if("".concat(i.value).match(/unknown/i))return t="".concat(D[s].value,"-07-15"),e.computeValue(t,!0);if(t){const[C,,F]=t.split("-"),R=ae("".concat(i.value));return t="".concat(C,"-").concat(R,"-").concat(F),e.computeValue(t,!1)}},v.proxyID=e.id,v.updateHelpTextOnValue=i=>"".concat(v.helpText," (").concat(E(i==null?void 0:i.label,"day"),")"),v.condition=i=>!"".concat(i[u].value).match(/unknown/i)&&Y(i),v.validation=(i,D,C)=>j.required(i)?["Day is required for date"]:(a=!!"".concat(i.value).match(/unknown/i),r=a?"15":ae("".concat(i.value)),t="".concat(n,"-").concat(o,"-").concat(r),ue(t,e,D,C)),v.defaultValue=i=>le(i,e,"Day"),v.computedValue=()=>e.computeValue(t,a),v.unload=(i,D,C,F)=>{e.unload&&e.unload(i,D,C,F)},v.beforeNext=(i,D)=>e.beforeNext?e.beforeNext(t,D):!0,v.config={year:i=>i[s].value,month:i=>i[u].value},S||(v.config.keyboardActions=[]);const K=(i,D)=>[i[s].value==="Unknown",e.condition?e.condition(i):!0,e.estimation.estimationFieldType===D].every(Boolean);return $.proxyID=e.id,$.validation=(i,D,C)=>{if(i&&i.value>300)return["Age estimate is too high and exceeding hard limit of 300"];if(isNaN(parseInt(i.value.toString())))return["Please enter a valid number"];const F=/^(12[0-7]|1[01][0-9]|[1-9]?[0-9])$/;if(!i.value.toString().match(F))return["Not a valid age estimate"];const R=z(P.getSessionDate()).subtract(i.value,"years").year();return t="".concat(R,"-07-15"),ue(t,e,D,C)},$.condition=i=>K(i,"age-estimate-field"),$.computedValue=()=>e.computeValue(t,!0),$.beforeNext=(i,D)=>e.beforeNext?e.beforeNext(t,D):!0,V.proxyID=e.id,V.validation=(i,D,C)=>j.required(i)?["Please select an estimate"]:(t=z(P.getSessionDate()).subtract(i.value,"day").format(st),ue(t,e,D,C)),V.condition=i=>K(i,"month-period-estimate-field"),V.computedValue=()=>e.computeValue(t,!0),V.beforeNext=(i,D)=>e.beforeNext?e.beforeNext(t,D):!0,[l,y,v,$,V]}const zn=L({components:{IonCol:re,IonRow:oe,Pagination:at,ReportTable:Nt,ReportFilter:Dn,HisFooter:it,IonPage:he,IonHeader:ce,IonContent:me,IonToolbar:de,IonChip:Xe,IonFooter:pe},props:{title:{type:String,required:!0},columns:{type:Array,required:!0},encryptPDF:{type:Boolean,default:!1},rows:{type:Array,default:()=>[]},rowParser:{type:Function},showFilters:{type:Boolean,default:!1},rowsPerPage:{type:Number},asyncRows:{type:Function},paginated:{type:Boolean,default:!1},customBtns:{type:Array,default:()=>[]},showReportStamp:{type:Boolean,default:!0},footerColor:{type:String,default:"dark"},customFileName:{type:String,default:""},canExport:{type:Boolean,default:!0},onFinish:{type:Function}},data:()=>({btns:[],isTableLoading:!1,searchFilter:"",itemsPerPage:50,currentPage:0,coreVersion:P.getCoreVersion(),tableRows:[],totalPages:0,activeColumns:[],activeRows:[],date:H.toStandardHisDisplayFormat(P.getSessionDate()),apiVersion:P.getApiVersion(),siteUUID:P.getSiteUUID()}),methods:{getFileName(){return this.customFileName?this.customFileName:this.title},pdfEncryptionData(){const e=P.getUserName();return{encryption:{userPassword:e,ownerPassword:e,userPermissions:["print"]}}}},created(){this.btns=[...this.customBtns,{name:"CSV",size:"large",slot:"start",color:"primary",visible:this.canExport,onClick:()=>{const{columns:e,rows:t}=be(this.activeColumns,this.activeRows,"csvMode");ut(e,[...t,["Date Created: ".concat(this.date)],["MaHIS Version: ".concat(this.coreVersion)],["API Version: ".concat(this.apiVersion)],["Site UUID: ".concat(this.siteUUID)],["Generated by: ".concat(P.getUserName())]],this.getFileName())}},{name:"PDF",size:"large",slot:"start",color:"primary",visible:this.canExport,onClick:async()=>{let e="pdfMode";this.encryptPDF&&(e=await lt("Security warning","PDF may contain private data that will require a password to unlock","To access private data choose Secure PDF over Regular PDF",[{name:"Secure PDF",slot:"start",color:"success"},{name:"Regular PDF",slot:"start",color:"success"}],"his-danger-color")==="Secure PDF"?"pdfMode":"ignorePDFColumnexport");const{columns:t,rows:n}=be(this.activeColumns,this.activeRows,e);ct(t,n,this.getFileName(),!1,this.encryptPDF&&e!="ignorePDFColumnexport"?this.pdfEncryptionData():{})}},{name:"Finish",size:"large",slot:"end",color:"success",visible:!0,onClick:()=>{if(typeof this.onFinish=="function")return this.onFinish();this.$router.push({path:"/"})}}]}}),Kn={class:"report-content"};function Jn(e,t,n,o,r,a){const s=p("ion-col"),u=p("ion-row"),m=p("ion-toolbar"),g=p("report-filter"),f=p("ion-header"),l=p("report-table"),y=p("ion-content"),v=p("pagination"),$=p("ion-chip"),V=p("ion-footer"),S=p("his-footer"),Y=p("ion-page");return c(),I(Y,null,{default:d(()=>[h(f,null,{default:d(()=>[h(m,null,{default:d(()=>[h(u,null,{default:d(()=>[h(s,null,{default:d(()=>[w("h1",null,k(e.title),1)]),_:1})]),_:1})]),_:1}),h(m,null,{default:d(()=>[h(g,{showPerPageFilter:e.showFilters||e.paginated,disableSearchFilter:e.isTableLoading,disablePerPageFilter:e.isTableLoading,totalRowCount:e.tableRows.length,onOnItemsPerPage:t[0]||(t[0]=E=>e.itemsPerPage=E),onOnSearchFilter:t[1]||(t[1]=E=>e.searchFilter=E)},null,8,["showPerPageFilter","disableSearchFilter","disablePerPageFilter","totalRowCount"])]),_:1})]),_:1}),h(y,null,{default:d(()=>[w("div",Kn,[h(l,{rows:e.rows,paginated:e.paginated,asyncRows:e.asyncRows,rowParser:e.rowParser,columns:e.columns,showFilters:e.showFilters,newPage:e.currentPage,searchFilter:e.searchFilter,rowsPerPage:e.itemsPerPage,onOnIsLoading:t[2]||(t[2]=E=>e.isTableLoading=E),onOnTableRows:t[3]||(t[3]=E=>e.tableRows=E),onOnPagination:t[4]||(t[4]=E=>e.totalPages=E.length),onOnActiveColumns:t[5]||(t[5]=E=>e.activeColumns=E),onOnActiveRows:t[6]||(t[6]=E=>e.activeRows=E)},null,8,["rows","paginated","asyncRows","rowParser","columns","showFilters","newPage","searchFilter","rowsPerPage"])])]),_:1}),h(V,null,{default:d(()=>[h(m,null,{default:d(()=>[!e.searchFilter&&e.paginated||!e.searchFilter&&e.totalPages>0&&e.paginated?(c(),I(v,{key:0,onClickPrevious:()=>{},onClickNext:()=>{},page:1,disableNext:!1,disablePrevious:!1,perPage:e.itemsPerPage,maxVisibleButtons:10,totalPages:e.totalPages,onOnChangePage:t[7]||(t[7]=E=>e.currentPage=E)},null,8,["perPage","totalPages"])):O("",!0)]),_:1}),e.showReportStamp?(c(),I(m,{key:0},{default:d(()=>[h($,{color:"primary"},{default:d(()=>[t[8]||(t[8]=N("Date Created: ",-1)),w("b",null,k(e.date),1)]),_:1}),h($,{color:"primary"},{default:d(()=>[t[9]||(t[9]=N("MaHIS Version: ",-1)),w("b",null,k(e.coreVersion),1)]),_:1}),h($,{color:"primary"},{default:d(()=>[t[10]||(t[10]=N("API Version: ",-1)),w("b",null,k(e.apiVersion),1)]),_:1})]),_:1})):O("",!0)]),_:1}),h(S,{color:e.footerColor,btns:e.btns},null,8,["color","btns"])]),_:1})}const Fe=B(zn,[["render",Jn]]);class we extends $e{constructor(){super();G(this,"regenerate");this.regenerate=!1}setRegenerate(n){this.regenerate=n}requestIDSRWeekly(){return this.getReport("generate_weekly_idsr_report",{request:"true"})}requestIDSRMonthly(){return this.getReport("generate_monthly_idsr_report",{request:"true"})}renderResults(n){const o=[];let r=1;for(const[a,s]of Object.entries(n)){const u=[],m=s,g={id:0,name:"",lessThanFiveYears:"",lessThanFiveYearsPatientIds:"",greaterThanEqualFiveYears:"",greaterThanEqualFiveYearsPatientIds:"",total:0,totalPatientIds:""};g.name=a;let f=0;g.id=r,r+=1;for(const[l,y]of Object.entries(m)){const v=y;v!=null&&(f+=v.length,g.total=f,v.length&&(u.push(...v),g.totalPatientIds=u),l=="<5yrs"&&(g.lessThanFiveYears=v.length,g.lessThanFiveYearsPatientIds=v),l==">=5yrs"&&(g.greaterThanEqualFiveYears=v.length,g.greaterThanEqualFiveYearsPatientIds=v))}o.push(g)}return o}getCSVString(n){let o="Diseases/Events/Conditions, <5 yrs, >=5 yrs, Total,\n";for(const r of n)o+="".concat(r.name,",").concat(r.lessThanFiveYears,",").concat(r.greaterThanEqualFiveYears,",").concat(r.total,",\n");return{CSVString:o}}static async getReportEpiWeeks(){const n=[];return(await P.getJson("get_weeks")).reverse().forEach(r=>{const a=r[1].split(" "),s=a[0],u=a[2],m=r[0].split("W"),g=m[0]+"/W"+m[1];n.push({name:g,start:s,end:u})}),n}static async getReportMonths(){const n=[];return(await P.getJson("get_months")).forEach(r=>{const a=r[1],s=a[0],m=a[1].split("to");n.push({name:s,start:m[0],end:m[1].trim()})}),n}}const uo=L({data:()=>({fields:[],report:{},reportReady:!1,period:"",startDate:"",endDate:"",customFileName:"",drillDownCache:{}}),methods:{toDate(e){return H.toStandardHisDisplayFormat(e)},confirmPatient(e){return this.$router.push("/patients/confirm?person_id=".concat(e))},async exportToCustomPDF(e){const t=open("","","width:1024px, height:768px"),n=document.getElementById("report-content");n&&t&&(t.document.write("\n                    <html>\n                    <head>\n                        <title>".concat(e,'</title>\n                        <link rel="stylesheet" media="print" href="/assets/css/cohort.css" />\n                    </head>\n                    <body>\n                        ').concat(n.innerHTML,"\n                    </body>\n                    </html>\n                ")),setTimeout(()=>{t.print(),t.close()},3500))},async onDrillDown(e,t){if(A.isEmpty(t))return;const n=[[T.thTxt("First name"),T.thTxt("Last name"),T.thTxt("Gender"),T.thTxt("Age"),T.thTxt("Phone"),T.thTxt("Address"),T.thTxt("Action")]],o=async r=>await Promise.all(r.map(async a=>{await ie.findByID(a);const s=new ie;return[T.td(s.getGivenName()),T.td(s.getFamilyName()),T.td(s.getGender()),T.td(s.getAge()),T.td(s.getPhoneNumber()),T.td("".concat(s.getCurrentDistrict(),", ").concat(s.getCurrentVillage(),", ").concat(s.getClosestLandmark())),T.tdBtn("Select",async()=>{await U.dismiss({}),this.$router.push({path:"/patient/dashboard/".concat(a)})})]}));return this.drilldownData(e,n,t,o)},async drilldownAsyncRows(e,t,n){(await U.create({component:Fe,cssClass:"large-modal",componentProps:{title:e,columns:t,asyncRows:n,showFilters:!0,rowsPerPage:50,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>U.dismiss()}})).present()},async drilldownData(e,t,n,o){(await U.create({component:Fe,cssClass:"large-modal",componentProps:{title:e,columns:t,rows:n,rowParser:o,rowsPerPage:50,showFilters:!0,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>U.dismiss()}})).present()},getDefaultDrillDownTable(){const e=[[T.thTxt("ARV number"),T.thTxt("Gender"),T.thTxt("Birth Date"),T.thTxt("Actions")]];return{rowParser:n=>n.map(async o=>{const[r,a]=o;if(a in this.drillDownCache)return[r];const s=await ie.findByID(a),u=new s,m=[r,T.td(u.getArvNumber()),T.td(u.getGender()),T.tdDate(u.getBirthdate().toString()),T.tdBtn("Show",async()=>{await U.dismiss({}),this.$router.push({path:"/patient/dashboard/".concat(a)})})];return this.drillDownCache[a]=m,m}),columns:e}},runTableDrill(e,t="Drilldown patients"){const{columns:n,rowParser:o}=this.getDefaultDrillDownTable();this.drilldownData(t,n,e,o)},drill(e,t="Drill table"){return e&&e.length>0?T.tdLink(e.length,()=>this.runTableDrill(e,t)):T.td(0)},getEpiweeksFields(){return[{id:"epiweek",helpText:"Select EPI week",type:M.TT_SELECT,validation:e=>j.required(e),options:async()=>(await we.getReportEpiWeeks()).map(n=>({label:n.name+" - ("+z(n.start).format("DD/MMM/YYYY")+" - "+z(n.end).format("DD/MMM/YYYY")+")",value:n.start,other:n}))}]},getMonthlyFields(){return[{id:"idsrmonth",helpText:"Select Month",type:M.TT_SELECT,validation:e=>j.required(e),options:async()=>(await we.getReportMonths()).map(n=>({label:n.name+" - ("+z(n.start).format("DD/MMM/YYYY")+" - "+z(n.end).format("DD/MMM/YYYY")+")",value:n.start,other:n}))}]},getDateDurationFields(e=!1,t=!1,n=5){const o="2001-01-01",r=P.getSessionDate();return[{id:"quarter",helpText:"Select Quarter",type:M.TT_SELECT,condition:()=>e,validation:a=>j.required(a),options:()=>{let s=$e.getReportQuarters(n).map(u=>({label:u.name,value:u.start,other:u}));return t&&(s=[{label:"Set custom period",value:"custom_period",other:{}},...s]),s}},...Ee({id:"start_date",helpText:"Start",required:!0,condition:a=>a.quarter&&a.quarter.value==="custom_period"||!e,minDate:()=>o,maxDate:()=>r,estimation:{allowUnknown:!1},computeValue:a=>a}),...Ee({id:"end_date",helpText:"End",required:!0,condition:a=>a.quarter&&a.quarter.value==="custom_period"||!e,unload:(a,s,u,m)=>{s==="next"&&(this.endDate=m.end_date)},minDate:(a,s)=>s.start_date,maxDate:()=>r,estimation:{allowUnknown:!1},computeValue:a=>a})]}}});export{Nt as H,we as I,lo as K,dt as L,oo as M,no as N,$e as O,Un as Q,Dn as R,xt as T,Ve as V,uo as _,ro as a,be as b,Vn as c,ao as d,so as e,io as f,T as t};

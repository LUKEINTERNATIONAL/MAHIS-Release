System.register(["./vendor-legacy-DYPX_RFx.js","./index-legacy-OY9Pz0c2.js","./DemographicBar-legacy-DWEaFYTW.js","./NextAppointmentModal-legacy-CaVLCCsl.js","./SaveProgressModal-legacy-DdzJVVZ7.js","./FeatusModal-legacy-CYtmD3x7.js","./formatServerData-legacy-BEY7NtEW.js","./vaccines_service-legacy-pdmCcFbI.js","./sms_service-legacy-BVi1AzKa.js","./BasicForm-legacy-BUUbSHPY.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-CCVjl9bz.js","./EIRreportsStore-legacy-DgWkg3ha.js","./Export-legacy-B30Y5DvS.js","./DateInputField-legacy-BQBVaNz4.js"],function(t,e){"use strict";var n,a,o,i,l,s,c,r,p,d,u,m,g,f,h,y,v,x,b,w,D,A,_,M,S,k,I,N,C,O,F,$,T,j,z,B,R,H,U,J,P,V,Y,E,L,Z,K,Q,W,q,G,X,tt,et,nt,at,ot,it,lt,st,ct,rt,pt;return{setters:[t=>{n=t.d,a=t.r,o=t.a,i=t.e,l=t.f,s=t.l,c=t.O,r=t.m,p=t.J,d=t.u,u=t.a6,m=t.k,g=t.X,f=t.Q,h=t.K,y=t.a5,v=t.bn,x=t.N,b=t.F,w=t.R,D=t.ah,A=t.a3,_=t.a7,M=t.a4,S=t.bF,k=t.c1,I=t.d8,N=t.bf,C=t.aU,O=t.H},t=>{F=t.aW,$=t.u,T=t.H,j=t.S,z=t.P,B=t.t,R=t.j,H=t.A,U=t.bZ,J=t.Q,P=t.bH,V=t._,Y=t.T,E=t.M,L=t.n,Z=t.K,K=t.s,Q=t.aT,W=t.ag},t=>{q=t.D},t=>{G=t.N,X=t.u,tt=t.a,et=t.L},t=>{nt=t.S},t=>{at=t.F},t=>{ot=t.a},t=>{it=t.u,lt=t.A,st=t.a,ct=t.v},t=>{rt=t.S},t=>{pt=t.B},null,null,null,null,null],execute:function(){var e=document.createElement("style");e.textContent=".ilbl[data-v-f063c32f]{font-size:23px}.calender[data-v-f063c32f]{--dp-cell-padding: 30px;--dp-menu-padding: 20px 5px;--dp-font-size: 18px}.card_content[data-v-f063c32f]{width:100%}.dp__flex_display[data-v-f063c32f]{display:inherit}.toggle-green[data-v-f063c32f]{--toggle-bg-on: #006401;--toggle-border-on: #006401;--toggle-width: 6.3rem;--toggle-height: 1.9rem;--toggle-border: .525rem;--toggle-font-size: 1rem;margin-bottom:30px}.lbl-tl[data-v-f063c32f]{min-width:20px;color:#b3b3b3!important;white-space:nowrap}.lbl-ct[data-v-f063c32f]{white-space:nowrap;color:#08475e;font-size:14px}.btnText[data-v-f063c32f]{font-style:normal;font-weight:500;font-size:14px}.container[data-v-75067a76]{text-align:center;position:fixed;left:0;right:0;top:35%;transform:translateY(-50%)}.back_profile[data-v-75067a76]{display:flex;justify-content:space-between;align-items:center;width:100%;font-weight:400;font-size:14px;z-index:1000;padding-left:25%;padding-right:25%}.AppointmentDate[data-v-75067a76]{margin-right:5%}ion-card[data-v-75067a76]{width:300px;margin:8px}.button-container[data-v-75067a76]{display:block;justify-content:space-around;margin:10px 0}.dynamic-button[data-v-75067a76]{flex:1;margin:0 5px;min-width:120px}@media(max-width:768px){.dynamic-button[data-v-75067a76]{margin:0 15px}.container[data-v-75067a76]{text-align:center;position:absolute;left:0;right:0;top:43%;transform:translateY(-50%)}ion-card[data-v-75067a76]{width:400px;margin:4px}.button-container[data-v-75067a76]{display:flex;justify-content:space-around;margin:5px;padding-left:1%;padding-right:1%}.back_profile[data-v-75067a76]{display:flex;justify-content:space-between;width:100%;font-weight:400;font-size:14px;z-index:1000;padding:0 5%;margin-bottom:10px}.AppointmentDate[data-v-75067a76]{margin-left:0}}hr[data-v-75067a76]{margin:20px 0;border:2px solid #ccc}\n/*$vite$:1*/",document.head.appendChild(e);class dt extends F{constructor(t,e){super(t,7,e)}}const ut={class:"lbl-ct"},mt={class:"lbl-ct"},gt={style:{"margin-right":"20px",color:"black"}},ft={style:{"font-size":"16px",color:"#666","margin-top":"5px"}},ht=n({watch:{},name:"xxxComponent",computed:{...D(X,["nextAppointmentDate"]),...D($,["patient"])},methods:{handleInputData(t){P(this.nextAppointmentDate,G,t.name,t.value),this.handleDateOfScheduledAppointmentRange(t)},closeCircleOutline:()=>A,handleDateOfScheduledAppointmentRange(t){const e=new Date,n=new Date(e);n.setDate(n.getDate()+1);const a=n.toISOString().split("T")[0],o=new Date(e);o.setDate(o.getDate()+32);const i=o.toISOString().split("T")[0];J(this.nextAppointmentDate,"Appointment date","minDate",a),J(this.nextAppointmentDate,"Appointment date","maxDate",i)}}}),yt=n({...ht,props:{patient_Id:{},encounter_Id:{}},setup(t){const e=$(),n=$(),D=a(),A=a(),_=a(!1),M=a(!1),S=T.toStandardHisDisplayFormat(j.getSessionDate()),k=a(!1),I=a(),N=a(0),C=a([]),O=[],F=t;async function J(){await async function(){try{await ct(F.encounter_Id,"Rescheduled"),await ct(F.encounter_Id,"Rescheduled")}catch(t){}}(),await async function(){try{var t;const n=await U.getRelationships(e.patient.patientID);if(n.length>0){const t=n[0].relation.person_attributes.find(t=>"Cell Phone Number"==t.type.name);t&&C.value.push(t.value)}null!==(t=e.patient)&&void 0!==t&&null!==(t=t.personInformation)&&void 0!==t&&t.cell_phone_number&&C.value.push(e.patient.patientID)}catch(n){}}();const t=F.patient_Id?new lt(F.patient_Id):new lt,n=await t.createAppointment();!async function(){const t=R();t.setVaccineReload(!t.getVaccineReload())}(),async function(){const t=it();t.setAppointmentsReload(!t.getAppointmentsReload())}(),V(),async function(t){if(0!=C.value.length){if(Array.isArray(t)&&t.length>0)if(M.value){const e=await w.create({component:st,componentProps:{date:t[1],patient:t[0],modalaction:"saveAppointment"}});await e.present()}else await rt.appointment(t[0],t[1])}else B("No phone numbers available for sms reminder!")}(n)}function P(t,e){const n=t.getFullYear(),a=t.getMonth(),o=t.getDate(),i=e.getFullYear(),l=e.getMonth(),s=e.getDate();return n!==i?n>i:a!==l?a>l:o>s}function V(){w.dismiss()}function Y(t){const e=t.match(/(\d+)\s*(week|month|year)s?/i);if(!e)return"Invalid input format";const n=parseInt(e[1]);switch(e[2].toLowerCase()){case"week":return 7*n;case"month":return 30*n;case"year":return 365*n;default:return"Invalid time unit"}}function E(t,e){let n;if(t instanceof Date)n=new Date(t);else{const[e,a]=t.split(" "),[o,i,l]=e.split("/"),[s,c,r]=a.split(":"),p={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};n=new Date(Number(l),p[i],Number(o),Number(s),Number(c),Number(r))}n.setDate(n.getDate()+e);const a=t=>String(t).padStart(2,"0"),o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n.getDay()],i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()],l=a(n.getDate()),s=n.getFullYear(),c=a(n.getHours()),r=a(n.getMinutes()),p=a(n.getSeconds()),d=-n.getTimezoneOffset(),u=Math.floor(Math.abs(d)/60),m=Math.abs(d)%60,g=`GMT${d>=0?"+":"-"}${a(u)}${a(m)}`,f=Intl.DateTimeFormat().resolvedOptions().timeZone;let h;try{const t=new Intl.DateTimeFormat("en",{timeZone:f,timeZoneName:"long"}).formatToParts(n).find(t=>"timeZoneName"===t.type);h=t?t.value:f}catch(y){console.error("Error getting localized time zone name:",y),h=f}return`Date ${o} ${i} ${l} ${s} ${c}:${r}:${p} ${g} (${h})`}return o(async()=>{it().clearAppointmentMent(),await async function(){try{let t=await rt.getConfigurations();M.value=t.show_sms_popup}catch(t){}}(),await async function(){try{const t=new z,e=void 0!==F.patient_Id?F.patient_Id:t.getID(),a=await async function(){try{const t=n.vaccineSchedule;t.vaccine_schedule.forEach(t=>{t.antigens.forEach(e=>{"administered"==e.status&&O.push({age:t.age,vaccine:e})})});for(const e of t.vaccine_schedule){if("current"===e.milestone_status)return e;if("upcoming"===e.milestone_status)return e}return null}catch(t){return null}}();if(O.length>0){const t=O[O.length-1];console.log(t);const n=await async function(t,e){try{const n=await z.findByID(e),a=E(new Date(n.person.birthdate),Y(t.age)),o=function(t){const e={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},n=t.split(/[:/ ]/),a=`${n[2]}-${e[n[1]]}-${n[0]}T${n[3]}:${n[4]}:${n[5]}`;return new Date(a)}(t.vaccine.date_administered),i=new Date(a);return console.log(P(o,i)),P(o,i)}catch(n){}}(t,e);0==n&&(D.value=E(t.vaccine.date_administered,Y(a.age)),A.value=T.toStandardHisDisplayFormat(D.value),async function(t){const e=it(),n={counter:1,date:t};e.setAppointmentMent(n),k.value=!1,await async function(t){try{const e=await H.getDailyAppointments(T.toStandardHisFormat(t),T.toStandardHisFormat(t));N.value=e.length+1}catch(e){}}(t),k.value=!0,I.value=T.toStandardHisDisplayFormat(t)}(D.value),function(t){const e=it(),n=e.getAppointmentMents(),a=t=>{const e=new Date(t);return e.setHours(0,0,0,0),e.getTime()},o=a(new Date(t)),i=n.find(t=>a(new Date(t.date))===o);i&&i.counter}(D.value),_.value=!0)}}catch(t){}}()}),(t,e)=>(l(),i(b,null,[s(d(y),{style:{"margin-top":"10px"}},{default:p(()=>[s(d(u),{style:{"margin-left":"-3px"}},{default:p(()=>[...e[0]||(e[0]=[m("div",{class:"om",style:{"font-weight":"600",color:"#8d8686"}},"Set Next Appointment Date",-1)])]),_:1}),s(d(u),{size:"6",style:{"text-align":"right"}},{default:p(()=>[s(d(g),{class:"lbl-tl",style:{"font-size":"13px"}},{default:p(()=>[e[1]||(e[1]=f(" Todays Date: ",-1)),m("span",ut,h(d(S)),1)]),_:1})]),_:1})]),_:1}),s(d(y),{style:{"margin-top":"10px"}},{default:p(()=>[s(d(u),{style:{"margin-left":"-3px"}},{default:p(()=>[...e[2]||(e[2]=[m("div",{class:"om"},null,-1)])]),_:1}),k.value?(l(),c(d(u),{key:0,size:"10",style:{"text-align":"right"}},{default:p(()=>[s(d(g),{class:"lbl-tl",style:{"font-size":"16px","font-weight":"500"}},{default:p(()=>[e[3]||(e[3]=f(" Total Appointments ",-1)),m("span",mt,"("+h(I.value)+")",1),e[4]||(e[4]=f(": ",-1)),m("span",gt,[s(d(v),{color:"primary",style:{"margin-bottom":"-5px","font-size":"15px"}},{default:p(()=>[f(h(N.value),1)]),_:1})])]),_:1})]),_:1})):r("",!0)]),_:1}),s(d(y),{style:{"margin-top":"20px"}},{default:p(()=>[s(d(u),null,{default:p(()=>[s(pt,{contentData:t.nextAppointmentDate,"onUpdate:selected":t.handleInputData,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:selected","onUpdate:inputValue"])]),_:1})]),_:1}),_.value?(l(),c(d(y),{key:0,style:{"margin-top":"0px","margin-bottom":"0px"}},{default:p(()=>[s(d(u),{style:{"background-color":"#f0f0f0",padding:"15px","border-radius":"8px","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)"}},{default:p(()=>[e[5]||(e[5]=m("div",{style:{"font-size":"17px",color:"#333","font-weight":"bold"}},"Suggested Date:",-1)),m("div",ft,h(A.value),1)]),_:1})]),_:1})):r("",!0),s(d(y),{style:{"margin-top":"10px","margin-bottom":"10px"}},{default:p(()=>[s(d(u),null,{default:p(()=>[s(d(x),{onClick:V,id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"}},{default:p(()=>[...e[6]||(e[6]=[f(" Cancel ",-1)])]),_:1})]),_:1}),s(d(u),{style:{"text-align":"right"}},{default:p(()=>[s(d(x),{onClick:J,class:"btnText",fill:"solid",style:{width:"130px"}},{default:p(()=>[...e[7]||(e[7]=[f(" save ",-1)])]),_:1})]),_:1})]),_:1})],64))}}),vt=V(yt,[["__scopeId","data-v-f063c32f"]]),xt=n({name:"TB screening",components:{IonRow:y,IonButton:x,FeatusModal:at,DynamicButton:E,IonContent:M,IonPage:_,Toolbar:Y,DemographicBar:q,LandingPage:et,NextAppointmentModal:tt},props:{backBtn:{type:String,default:"Back to profile"},backUrl:{type:String,default:""},contact:{type:String,default:""}},data:()=>({isModalOpen:!1,dateOfAppointment:""}),mounted(){this.handleAppointment()},setup:()=>({checkmark:C,pulseOutline:N}),computed:{...D(X,["nextAppointmentDate"]),...D($,["patient"])},methods:{calendar:()=>I,eye:()=>k,chevronBackOutline:()=>S,openBackController(){this.backUrl?this.$router.push(this.backUrl):L(nt)},async handleAppointment(){const t=await W.getFirstObsValue(this.patient.patientID,"Appointment date","value_text");this.dateOfAppointment=t},async saveData(){const t=X();await t.validate()?(await this.saveDate(),this.closeAppointmentModal(),await this.$router.push("ANCHome"),await await Q()):K("Next appointment date has errors")},async saveDate(){if(this.nextAppointmentDate.length>=0){const t=j.getUserID(),e=new dt(this.patient.patientID,t);if(!(await e.createEncounter()))return B("Unable to create appointment date encounter");if(!(await e.saveObservationList(await this.buildNextAppointment())))return B("Unable to create date!");Z("Client has been scheduled for next contact")}console.log(await this.buildNextAppointment())},openNextVaccineAppoinment(){L(vt,{class:"otherVitalsModal"},!1)},async buildNextAppointment(){return[...await ot(this.nextAppointmentDate)]},cancelModal(){this.closeAppointmentModal()},async nextAppointment(){this.toggleAppointmentModal()},toggleAppointmentModal(){this.isModalOpen=!this.isModalOpen},closeAppointmentModal(){this.isModalOpen=!1},previousContacts(){this.$router.push("/contacts")},navigateToContact(){this.$router.push("/contact")}}}),bt={class:"container"},wt={class:"back_profile"},Dt={class:"AppointmentDate"},At={style:{color:"#0b5ed7"}},_t={class:"button-container ion-justify-content-center ion-align-items-center"};t("default",V(xt,[["render",function(t,e,n,a,o,i){const r=O("Toolbar"),d=O("DemographicBar"),u=O("DynamicButton"),g=O("NextAppointmentModal"),f=O("LandingPage"),y=O("ion-content"),v=O("ion-page");return l(),c(v,null,{default:p(()=>[s(r),s(y,{fullscreen:!0},{default:p(()=>[s(d),m("div",bt,[m("div",wt,[s(u,{name:t.backBtn,iconSlot:"start",fill:"clear",icon:t.chevronBackOutline(),onClick:e[0]||(e[0]=e=>t.openBackController())},null,8,["name","icon"]),m("div",Dt,[e[1]||(e[1]=m("span",{style:{"font-size":"14px"}},"Appointment Date: ",-1)),m("b",At,h(t.dateOfAppointment||"Not scheduled"),1)])]),m("div",_t,[s(u,{style:{"padding-right":"1%"},name:"New ANC contact",iconSlot:"start",fill:"solid",icon:t.checkmark,onClick:t.navigateToContact},null,8,["icon","onClick"]),s(u,{style:{"padding-right":"1%"},name:"View ANC contacts",iconSlot:"start",fill:"solid",icon:t.eye(),onClick:t.previousContacts},null,8,["icon","onClick"]),s(u,{name:"Schedule next contact",iconSlot:"start",fill:"solid",icon:t.calendar(),onClick:t.nextAppointment},null,8,["icon","onClick"])]),s(g,{isOpen:t.isModalOpen,title:"",closeModalFunc:t.closeAppointmentModal,onYes:t.saveData,onNo:t.cancelModal},null,8,["isOpen","closeModalFunc","onYes","onNo"]),e[2]||(e[2]=m("hr",null,null,-1)),s(f)])]),_:1})]),_:1})}],["__scopeId","data-v-75067a76"]]))}}});

System.register(["./vendor-legacy-qLaA4lfC.js","./index-legacy-Bh_KV0Am.js","./DemographicBar-legacy-BUlfEEEZ.js","./SaveProgressModal-legacy-DwOhrWAu.js","./Stepper-legacy-BHdvcqm8.js","./NextAppointment-legacy-CSL9ckFX.js","./lodash-legacy-pOOc9Efu.js","./diagnosis-legacy-B5Bm2XN_.js","./formatServerData-legacy-CKvH3-Z7.js","./patient_complaints_service-legacy-CuceAI-d.js","./app_encounter_service-legacy-DK_afvJ-.js","./BasicFooter-legacy-CHwF8xyT.js","./lab_order-legacy-MMf01ErI.js","./SetEncounter.vue_vue_type_script_lang-legacy-vt1h0Ga0.js","./OPDPrintingModal-legacy-BmisEk19.js","./usePatientProfile-legacy-TmpvN-oq.js","./SvgDynamicColor-legacy-Qi5sQrl3.js","./DashBox-legacy-BpXYzc_A.js","./StandardForm.vue_vue_type_script_setup_true_lang-legacy-BFfa7Lyx.js","./useExposeFromStandardForm-legacy-ZO3UEy3P.js","./BasicForm-legacy-OyYFoqdD.js","./DateInputField-legacy-ofNJJcav.js","./patient_lab_service-legacy-oiI5gPVL.js","./LabTestsHistory-legacy-O-UCWAf9.js","./ncd_appointment_service-legacy-DNZ0Nwg6.js","./clinicalDaysStore-legacy-BKnHj5TK.js","./UpcomingFeature-legacy-BKHReD_0.js","./previousVitals-legacy-Ct64vYtT.js","./apexcharts-legacy-DX-O3ogC.js","./Outcome-legacy-f6sOMKFz.js","./SelectFacility-legacy-Dbv9Uepw.js","./group_validation-legacy-CL9u_jYI.js","./drug_prescription_service-legacy-zAxJDyo9.js","./drug_service-legacy-DkNHpHcZ.js","./appointment_service-legacy-C_VZ9nHl.js","./FeatusModal-legacy-D5IbhIse.js","./PastObstreticHistoryStore-legacy-ABmlQcHZ.js","./previousDiagnosis-legacy-C8zHopW8.js","./vitals_service-legacy-DQA9jzbC.js","./Registration-legacy-CHr2jTej.js","./useLocation-legacy-QOLXPLf5.js","./vaccines_service-legacy-zwOJH_Xr.js","./sms_service-legacy-CTxlOuIi.js","./EIRreportsStore-legacy-BdL_d_iB.js","./Export-legacy--q8wsR2j.js","./relations_service-legacy-DMDg8uA4.js","./index-legacy-D1Gv8CkB.js"],function(t,e){"use strict";var a,i,s,n,o,r,l,c,p,d,h,u,g,m,y,D,v,P,w,b,S,f,I,_,O,A,L,j,x,k,C,F,T,M,z,W,E,N,U,B,H,R,V,$,G,Y,q,J,Z,K,Q,X,tt,et,at,it,st,nt,ot,rt,lt,ct,pt,dt,ht,ut,gt,mt,yt,Dt,vt,Pt,wt,bt,St,ft,It,_t,Ot,At,Lt,jt,xt,kt,Ct,Ft,Tt,Mt;return{setters:[t=>{a=t.d,i=t.V,s=t.G,n=t.S,o=t.a9,r=t.E,l=t.y,c=t.f,p=t.z,d=t.k,h=t.l,u=t.ar,g=t.b8,m=t.D,y=t.M,D=t.J,v=t.a_,P=t.bC,w=t.a$,b=t.aZ,S=t.b0,f=t.W,I=t.cA,_=t.U,O=t.T,A=t.af,L=t.ba,j=t.r,x=t.a2,k=t.ck,C=t.e,F=t.m},t=>{T=t.D,M=t._,z=t.y,W=t.T,E=t.al,N=t.S,U=t.t,B=t.H,H=t.I,R=t.f,V=t.am,$=t.j,G=t.as,Y=t.aB,q=t.h,J=t.g,Z=t.k,K=t.a4,Q=t.aC,X=t.l,tt=t.aD,et=t.n,at=t.aE,it=t.a0,st=t.aF,nt=t.aG,ot=t.ap,rt=t.a1,lt=t.aH,ct=t.aI,pt=t.aJ,dt=t.u,ht=t.i,ut=t.P,gt=t.aK,mt=t.an},t=>{yt=t.D},t=>{Dt=t.S},t=>{vt=t.S},t=>{Pt=t.e,wt=t.b,bt=t.f,St=t.d,ft=t.s},t=>{It=t.l},t=>{_t=t.D},t=>{Ot=t.c,At=t.f,Lt=t.a},t=>{jt=t.P},t=>{xt=t.A},t=>{kt=t.B},t=>{Ct=t._},t=>{Ft=t._},t=>{Tt=t.O},t=>{Mt=t.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var e=document.createElement("style");e.textContent=".button-container[data-v-e844e8f2]{float:left;margin-left:38%}@media (max-width: 1024px){.button-container[data-v-e844e8f2]{margin-left:9%}}.spinner-overlay[data-v-13a9186a]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-13a9186a]{width:80px;height:80px}.loading-text[data-v-13a9186a]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-13a9186a]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-13a9186a]{pointer-events:none}\n/*$vite$:1*/",document.head.appendChild(e);class zt extends xt{constructor(t,e){super(t,111,e)}}class Wt extends xt{constructor(t,e){super(t,30,e)}}class Et extends xt{constructor(t,e){super(t,141,e)}}class Nt extends xt{constructor(t,e){super(t,28,e)}}const Ut=a({name:"Menu",components:{IonContent:o,IonHeader:n,IonItem:s,IonFooter:i,DynamicButton:T},data:()=>({}),props:{status:{type:Boolean,default:!0},name:{type:String,default:"Save and end visit"}},methods:{}}),Bt={class:"button-container"},Ht=a({name:"ConsultationPlan",mixins:[Ct,Ft],components:{OPDPrintingModal:Tt,CheckInConfirmationModal:E,IonContent:o,IonHeader:n,IonMenuButton:L,IonPage:A,IonTitle:O,IonToolbar:_,IonLoading:I,Toolbar:W,ToolbarSearch:z,DemographicBar:yt,IonButton:f,IonCard:S,IonCardContent:b,IonCardHeader:w,IonCardSubtitle:P,IonCardTitle:v,IonAccordion:D,IonAccordionGroup:y,IonItem:s,IonLabel:m,IonModal:g,Stepper:vt,BasicFooter:kt,OPDFooter:M(Ut,[["render",function(t,e,a,i,s,n){const o=r("DynamicButton"),u=r("ion-footer");return c(),l(u,{translucent:!0,class:"ion-no-border"},{default:p(()=>[d("div",Bt,[h(o,{name:t.name,iconSlot:"end",onClick:e[0]||(e[0]=e=>t.$emit("finishBtn"))},null,8,["name"])])]),_:1})}],["__scopeId","data-v-e844e8f2"]])},data:()=>({openStepper:"1",wizardData:[],StepperData:[],isOpen:!1,hasPatientsWaitingForLab:!1,iconsContent:ht,isLoading:!1,isLoadingPrinter:!1,patients:[],showAlert:!1,checkedIn:!1,printModalOpen:!1}),props:{list:{default:""}},computed:{...u(dt,["patient"]),...u(pt,["pregnancy"]),...u(ct,["presentingComplaints"]),...u(lt,["pastMedicalHistory"]),...u(rt,["vitals"]),...u(ot,["investigations"]),...u(nt,["OPDdiagnosis"]),...u(st,["physicalExam"]),...u(it,["selectedMedicalDrugsList","nonPharmalogicalTherapyAndOtherNotes","selectedMedicalAllergiesList"]),...u(at,["adult","minor"]),...u(G,["outcomes"]),...u(et,["OPDActivities"]),...u(Z,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","counter"]),...u(tt,["currentSelectedNextAppointmentDate"])},async created(){},async mounted(){await this.getData(),await this.fetchPatientLabStageData(),this.markWizard()},watch:{patientsWaitingForLab(t){this.hasPatientsWaitingForLab=t.some(t=>t.patient_id===this.patient.patientID),this.showAlert=this.hasPatientsWaitingForLab,this.showAlert&&setTimeout(()=>{this.showAlert=!1},15e3)},vitals:{handler(){this.markWizard()},deep:!0},$route:{async handler(){await this.getData(),this.markWizard(),this.fetchPatientLabStageData(),this.hasPatientsWaitingForLab=!1},deep:!0},investigations:{handler(){this.markWizard()},deep:!0},OPDdiagnosis:{handler(){this.markWizard()},deep:!0},selectedMedicalDrugsList:{handler(){this.markWizard()}},outcomes:{handler(){this.markWizard()}},currentSelectedNextAppointmentDate:{handler(){this.markWizard()}},hasPatientsWaitingForLab:{immediate:!0,handler(t){}}},setup(){const{printVisitSummary:t}=Mt(),e=j([]);async function a(t){const a=new ut,i=await gt.getEncounters(a.getID(),{date:t});await async function(t){try{var a;const i=null===(a=t.find(t=>"PRESENTING COMPLAINTS"===t.type.name))||void 0===a?void 0:a.observations;e.value=i?await async function(t){return t.length>0?Promise.all(t.map(async t=>await mt.getConceptName(t.value_coded))):[]}(async function(t,e){return null==t?void 0:t.filter(t=>t.concept.concept_names.some(t=>t.name===e))}(i,"Presenting complaint")):[]}catch(i){console.error("Error setting presenting complaints encounters:",i)}}(i)}return(async()=>{const t=(new Date).toISOString().split("T")[0];await a(t)})(),{presentingComplaintsValue:e,printVisitSummary:t,loadSavedEncounters:a,chevronBackOutline:k,checkmark:x}},methods:{endConsultation(){},togglePrintModal(){this.printModalOpen=!this.printModalOpen},closeCheckInModal(){this.printModalOpen=!1},async printYes(){this.isLoadingPrinter=!0,$("Printing consultation summary... Please wait.");try{await this.printVisitSummary(),$("Consultation summary printed successfully!"),setTimeout(()=>{this.$router.push("home")},3500)}catch(t){X("Failed to print consultation summary.")}finally{this.isLoadingPrinter=!1}},async printNo(){$("Patient has finished consultation!"),this.$router.push("home")},getSaveFunction(t){return t<this.StepperData.length-1?0===t&&0===this.presentingComplaintsValue.length?this.saveClinicalAssessment:()=>Promise.resolve():async()=>{await this.saveDiagnosis(),await this.saveTreatmentPlan(),await G().saveOutcomPatientData(),Y();const t=await J(),e=t?t.code:null;e?"Lab"!==this.userRole?(await q.addPatientToStage(this.patient.patientID,B.todayDateFormatted(),"DISPENSATION",e),await Z().refresh(e),this.$router.push("home"),$("Patient has finished consultation!")):(await q.addPatientToStage(this.patient.patientID,B.todayDateFormatted(),"CONSULTATION",e),await Z().refresh(e),this.$router.push("home"),$("Lab results submitted. Patient can return to consultation")):X("Location ID could not be found. Please check your settings.")}},async fetchPatientLabStageData(){const t=await J(),e=t?t.code:null;if(e){const t=await q.getPatientList("LAB",e);this.patient.patientID&&(this.hasPatientsWaitingForLab=t.some(t=>t.patient_id===this.patient.patientID))}},setList(){const t={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation};this.patients=t[this.list]||[]},async getData(){try{this.wizardData=[],this.StepperData=[];for(let t=0;t<this.OPDActivities.length;t++){let e="common_step";"Clinical Assessment"==this.OPDActivities[t]&&(this.openStepper=t+1),"Investigations"==this.OPDActivities[t]&&(this.openStepper=t+1),"Diagnosis"==this.OPDActivities[t]&&(this.openStepper=t+1),"Treatment Plan"==this.OPDActivities[t]&&(this.openStepper=t+1),"Outcome"==this.OPDActivities[t]&&(this.openStepper=t+1);let a=this.OPDActivities[t],i=this.OPDActivities[t];"Diagnosis"==this.OPDActivities[t]&&(i="OPDDiagnosis"),"Treatment Plan"==this.OPDActivities[t]&&(i="OPDTreatmentPlan");const s=t+1;this.wizardData.push({title:a,class:e,checked:0!==t&&"",disabled:!1,number:s,last_step:t===this.OPDActivities.length-1?"last_step":""}),this.StepperData.push({title:a,component:i.replace(/\s+/g,""),value:s.toString()})}}catch(t){console.error(t)}},markWizard(){this.presentingComplaints?Q(this.wizardData,"Clinical Assessments",{checked:!0,class:"open_step common_step"}):Q(this.wizardData,"Clinical Assessments",{checked:!1}),this.investigations[0].selectedData.length>0?Q(this.wizardData,"Investigations",{checked:!0,class:"open_step common_step"}):Q(this.wizardData,"Investigations",{checked:!1}),this.OPDdiagnosis[0].selectedData.length>0?Q(this.wizardData,"Diagnosis",{checked:!0,class:"open_step common_step"}):Q(this.wizardData,"Diagnosis",{checked:!1}),this.selectedMedicalDrugsList.length>0?Q(this.wizardData,"Treatment Plan",{checked:!0,class:"open_step common_step"}):Q(this.wizardData,"Treatment Plan",{checked:!1}),this.currentSelectedNextAppointmentDate?Q(this.wizardData,"Next Appointment",{checked:!0,class:"open_step common_step"}):Q(this.wizardData,"Next Appointment",{checked:!1}),this.outcomes.length>0?Q(this.wizardData,"Outcome",{checked:!0,class:"open_step common_step"}):Q(this.wizardData,"Outcome",{checked:!1})},getFormatedData:t=>t.map(t=>(null==t?void 0:t.data[0])||(null==t?void 0:t.data)),async saveClinicalAssessment(){this.isLoading=!0;try{const t=await K.getAll(this.patient.patientID,"Presenting complaint");let e=[];if(t&&(e=t.filter(t=>B.toStandardHisFormat(B.sessionDate())===B.toStandardHisFormat(t.obs_datetime))),!(this.presentingComplaints[0].selectedData.length>0||e.length>0))return void U("Patient complaints are required");await this.saveConsciousness(),await this.savePresentingComplaints(),await this.saveWomenStatus(),await this.savePastMedicalHistory(),await this.saveAllergies(),await this.savePhysicalExam(),Y()}catch(t){}finally{this.isLoading=!1}},async saveData(){try{await this.saveDiagnosis(),await this.saveTreatmentPlan(),await G().saveOutcomPatientData(),Y();const t=await q.getCheckInStatus(this.patient.patientID);await q.checkOutPatient(t[0].id,B.todayDateFormatted());const e=await J(),a=e?e.code:null;await Z().refresh(a),this.checkedIn=!1}catch(t){}this.togglePrintModal()},async savePastMedicalHistory(){const t=await this.buildPastMedicalHistory(),e=N.getUserID();if(t.length>0){const a=new Wt(this.patient.patientID,e);if(!(await a.createEncounter()))return U("Unable to create past medical history encounter");if(!(await a.saveObservationList(t)))return U("Unable to create past medical history!");$("Past medical history has been created")}},async savePresentingComplaints(){if(this.presentingComplaints[0].selectedData.length>0){const t=N.getUserID(),e=new jt(this.patient.patientID,t);if(!(await e.createEncounter()))return U("Unable to create patient complaints encounter");if(!(await e.saveObservationList(this.getFormatedData(this.presentingComplaints[0].selectedData))))return U("Unable to create patient complaints  !");$("Patient complaints has been created")}this.presentingComplaints[0].selectedData},async savePhysicalExam(){const t=await this.buildPhysicalExamination();if(t.length>0){const e=N.getUserID(),a=new Nt(this.patient.patientID,e);if(!(await a.createEncounter()))return U("Unable to create patient physical examination encounter");if(!(await a.saveObservationList(t)))return U("Unable to create patient physical examination  !");$("Physical examination has been created")}},async saveWomenStatus(){const t=await At(this.pregnancy);if(t.length>0){const e=N.getUserID(),a=new zt(this.patient.patientID,e);if(!(await a.createEncounter()))return U("Unable to create pregnant Status encounter");if(!(await a.saveObservationList(t)))return U("Unable to create pregnant Status !");$("Pregnant Status has been created")}},async saveDiagnosis(){if(this.OPDdiagnosis[0].selectedData.length>0){var t,e,a,i;const s=N.getUserID(),n=new _t,o=this.getFormatedData(this.OPDdiagnosis[0].selectedData);console.log(this.patient),null!==(e=(t=null!==(i=(a=this.patient).diagnosis)&&void 0!==i?i:a.diagnosis={}).unsaved)&&void 0!==e||(t.unsaved=[]),this.patient.diagnosis.unsaved.push(...o),await V(this.patient),await n.onSubmit(this.patient.patientID,s,this.getFormatedData(this.OPDdiagnosis[0].selectedData))}this.OPDdiagnosis[0].selectedData=[]},async saveAllergies(){if(N.getUserID(),this.patient.patientID,!It.isEmpty(this.selectedMedicalAllergiesList)){const t=this.mapToAllergies();ft(t)}},async saveTreatmentPlan(){const t=N.getUserID(),e=this.patient.patientID,a=new Pt;if(!It.isEmpty(this.selectedMedicalAllergiesList)){const i=this.mapToAllergies();a.onSubmitAllergies(e,t,i)}if(!It.isEmpty(this.nonPharmalogicalTherapyAndOtherNotes)){const t=H(),e=[{concept_id:2688,obs_datetime:N.getSessionDate(),value_text:this.nonPharmalogicalTherapyAndOtherNotes,location_id:t.facilityLocation.code}];await wt(e)}bt(),await St().saveNonPharmaTherapyPatientData()},saveInvestigations(){},openModal(){R(Dt)},mapToAllergies(){const t=H();return this.selectedMedicalAllergiesList.map(e=>({concept_id:985,obs_datetime:N.getSessionDate(),value_coded:e.concept_id,location_id:t.facilityLocation.code}))},async buildPastMedicalHistory(){return[...await Ot(this.pastMedicalHistory),...await At(this.pastMedicalHistory),...await Lt(this.pastMedicalHistory)]},async saveConsciousness(){if((await At(this.adult)).length>0){const t=N.getUserID(),e=new Et(this.patient.patientID,t);if(!(await e.createEncounter()))return U("Unable to create patient complaints encounter");let a;a=B.getAgeInYears(this.patient.personInformation.birthdate)<18?await At(this.minor):await At(this.adult),await e.saveObservationList(a)}},async buildPhysicalExamination(){return[...await Ot(this.physicalExam),...await At(this.physicalExam),...await Lt(this.physicalExam)]}}}),Rt={key:0,class:"spinner-overlay"},Vt={key:1,class:"pause-alert"};t("default",M(Ht,[["render",function(t,e,a,i,s,n){const o=r("OPDPrintingModal"),u=r("ion-spinner"),g=r("ion-loading"),m=r("Toolbar"),y=r("DemographicBar"),D=r("Stepper"),v=r("ion-content"),P=r("ion-page");return c(),l(P,null,{default:p(()=>[h(o,{onYes:t.printYes,onNo:t.printNo,isOpen:t.printModalOpen,title:"Do you want to print the consultation summary?"},null,8,["onYes","onNo","isOpen"]),t.isLoading?(c(),C("div",Rt,[h(u,{name:"bubbles"}),e[0]||(e[0]=d("div",{class:"loading-text"},"Please wait...",-1))])):F("",!0),h(g,{"is-open":t.isLoadingPrinter,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),h(m),h(v,{fullscreen:!0},{default:p(()=>[h(y),h(D,{stepperTitle:t.userRoleSettings.stepperTitle,wizardData:t.wizardData,onUpdateStatus:t.markWizard,StepperData:t.StepperData,openStepper:t.openStepper,backUrl:t.userRoleSettings.url,backBtn:t.userRoleSettings.btnName,getSaveFunction:t.getSaveFunction,hasPatientsWaitingList:t.hasPatientsWaitingForLab,specialButtonLabel:"save & end visit",specialButtonFn:t.saveData,userRole:t.userRole},null,8,["stepperTitle","wizardData","onUpdateStatus","StepperData","openStepper","backUrl","backBtn","getSaveFunction","hasPatientsWaitingList","specialButtonFn","userRole"])]),_:1}),"Clinician"!==t.userRole&&"Superuser"!==t.userRole||!t.showAlert?F("",!0):(c(),C("div",Vt," Consultation for this patient is paused due to lab orders. "))]),_:1})}],["__scopeId","data-v-13a9186a"]]))}}});

import{d as E,ao as D,b8 as y,D as B,G as F,M as C,J as z,aX as P,cb as M,aY as T,aW as W,aZ as L,W as H,U as $,T as O,an as R,ba as U,S as A,ah as N,aa as G,bG as Y,E as h,y as j,f as g,z as S,e as q,m as J,l as m,k as X}from"./vendor-BVQaapOZ.js";import{F as Z,T as K,j as Q,aU as w,H as v,aT as I,m as V,t as _,S as b,C as k,aA as x,aF as aa,z as ta,a4 as sa,u as ea,i as oa,_ as ia}from"./index-Dk2KSmQR.js";import{B as ra}from"./BasicFooter-CzOTHii3.js";import{D as na}from"./DemographicBar-C9sV67PO.js";import{S as la}from"./SaveProgressModal-Bfid8k42.js";import{S as ca}from"./Stepper-DI0QGogd.js";import{d as da,a as ha}from"./formatServerData-4478vga2.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-nnNPWyhZ.js";import"./NextAppointment-BRmj3NzP.js";import"./DashBox-CqrtsKRE.js";import"./BasicForm-DQTwznP4.js";import"./DateInputField-CZ05A9YX.js";import"./lab_order-CAtFcIof.js";import"./group_validation-Cjw7Dlvp.js";import"./drug_prescription_service-C3r4aszi.js";import"./drug_service-BCGi4nYD.js";import"./ncd_appointment_service-BHt8NWHz.js";import"./OPDOutcome-C1jShXXm.js";import"./patient_complaints_service-DJkJJF2t.js";import"./useExposeFromStandardForm-ptmgnQkS.js";import"./Outcome-x0eQLrEa.js";import"./TreatmentPlan-BvHudlHK.js";import"./previousDiagnosis-8An-NhS4.js";import"./FeatusModal-Dgpuk2by.js";import"./BasicCard-C21stYmJ.js";import"./PastObstreticHistoryStore-Cx1z0zdH.js";import"./UpcomingFeature-CIiKEULB.js";const pa=E({name:"Home",components:{IonContent:N,IonHeader:A,IonMenuButton:U,IonPage:R,IonTitle:O,IonToolbar:$,Toolbar:K,ToolbarSearch:Z,DemographicBar:na,IonButton:H,IonCard:L,IonCardContent:W,IonCardHeader:T,IonCardSubtitle:M,IonCardTitle:P,IonAccordion:z,IonAccordionGroup:C,IonItem:F,IonLabel:B,IonModal:y,Stepper:ca,BasicFooter:ra},data(){return{isLoading:!1,hasValidationErrors:[],outcomes:"",actionBtn:"",wizardData:[{title:"Vital Signs",class:"common_step",checked:!1,disabled:!1,number:1,last_step:"last_step"}],StepperData:[{title:"Vital Signs",component:"VitalSigns",value:"1"}],isOpen:!1,iconsContent:oa}},computed:{...D(ea,["patient"]),...D(sa,["vitals"]),"Height Weight Reason"(){return ta(this.vitals,"Height Weight Reason","value")}},async created(){},mounted(){this.markWizard()},watch:{vitals:{handler(){this.markWizard()},deep:!0},investigations:{handler(){this.markWizard()},deep:!0},diagnosis:{handler(){this.markWizard()},deep:!0},selectedMedicalDrugsList:{handler(){this.markWizard()}}},setup(){return{chevronBackOutline:Y,checkmark:G}},methods:{markWizard(){this.actionBtn=this.vitals[0].actionBtn;const a=v.sessionDate(),l=aa("vitals").some(o=>v.toStandardHisFormat(o.obs_datetime)===v.toStandardHisFormat(a));this.vitals.validationStatus||l?(this.wizardData[0].checked=!0,this.wizardData[0].class="open_step common_step"):this.wizardData[0].checked=!1},async saveVitals(){var a,t,l,o;try{const i=localStorage.getItem("userID")||b.getUserID();await new w(this.patient.patientID,i).onFinish(this.vitals);const s=await da(this.vitals),c=await ha(this.vitals);(c.length>0||s.length>0)&&((o=(l=(t=(a=this.patient).vitals)!=null?t:a.vitals={}).unsaved)!=null||(l.unsaved=[]),this.patient.vitals.unsaved.push(...c,...s),await x(this.patient)),k("Vitals saved successfully")}catch(i){throw console.error("Vitals save failed:",i),i}},async moveToNextStageAndRedirect(){const a=localStorage.getItem("locationID"),t=localStorage.getItem("userRoles")||b.getUserRoles();if(!a){V("Location ID not found");return}k("Vitals have been saved!"),t.includes("Nurse")?this.$router.push("patientProfile"):this.$router.push("OPDConsultationPlan")},async getSaveFunction(){this.isLoading=!0;try{if(!(this.actionBtn==="Finish")){if(await this.validaterowData(),!this.vitals.validationStatus){_("Please fill all required fields");return}await this.saveVitals()}await I(),await this.moveToNextStageAndRedirect()}catch(a){console.error("Error in getSaveFunction: ",a)}finally{this.isLoading=!1}},async saveData(){this.isLoading=!0;try{if(this.actionBtn!="Finish")if(this.vitals.validationStatus){if(await this.saveVitals(),I(),!localStorage.getItem("locationID")){V("Location ID not found");return}this.$router.push("OPDConsultationPlan")}else await this.validaterowData(),_("Please correct validation errors in form");else this.$router.push("OPDConsultationPlan")}catch(a){console.error("Error in saveData: ",a)}finally{this.isLoading=!1}},async validaterowData(){var o,i;this.hasValidationErrors=[];const a=localStorage.getItem("userID"),t=new w(this.patient.patientID,a),l=v.getAgeInYears((i=(o=this.patient)==null?void 0:o.personInformation)==null?void 0:i.birthdate);this.vitals.forEach((r,s)=>{var c,u;(c=r==null?void 0:r.data)!=null&&c.rowData&&((u=r==null?void 0:r.data)==null||u.rowData.forEach((f,n)=>{f.colData.some((p,d)=>{if(p.name==="Respiratory rate"&&l<=5){const e=t.validator(p);if((e==null?void 0:e.length)>0)return this.hasValidationErrors.push("false"),this.vitals[s].data.rowData[n].colData[d].alertsErrorMassage=e.flat(1/0)[0],!0;this.hasValidationErrors.push("true"),this.vitals[s].data.rowData[n].colData[d].alertsErrorMassage=!1,this.vitals[s].data.rowData[n].colData[d].alertsErrorMassage=""}else{const e=t.validator(p);if((e==null?void 0:e.length)>0)return this.hasValidationErrors.push("false"),this.vitals[s].data.rowData[n].colData[d].alertsErrorMassage=e.flat(1/0)[0],!0;this.hasValidationErrors.push("true"),this.vitals[s].data.rowData[n].colData[d].alertsErrorMassage=!1,this.vitals[s].data.rowData[n].colData[d].alertsErrorMassage=""}return!1})}))}),this.vitals.validationStatus=!this.hasValidationErrors.includes("false")},openModal(){Q(la)}}}),ma={key:0,class:"spinner-overlay"};function ua(a,t,l,o,i,r){const s=h("ion-spinner"),c=h("Toolbar"),u=h("DemographicBar"),f=h("Stepper"),n=h("ion-content"),p=h("ion-page");return g(),j(p,null,{default:S(()=>[a.isLoading?(g(),q("div",ma,[m(s,{name:"bubbles"}),t[1]||(t[1]=X("div",{class:"loading-text"},"Please wait...",-1))])):J("",!0),m(c),m(n,{fullscreen:!0},{default:S(()=>[m(u),m(f,{stepperTitle:"Vitals",wizardData:a.wizardData,onUpdateStatus:a.markWizard,onFinishBtn:t[0]||(t[0]=d=>a.saveData()),StepperData:a.StepperData,getSaveFunction:a.getSaveFunction},null,8,["wizardData","onUpdateStatus","StepperData","getSaveFunction"])]),_:1})]),_:1})}const Na=ia(pa,[["render",ua],["__scopeId","data-v-8da25146"]]);export{Na as default};

import{d as Y,r as y,a as zt,e as Rt,f as T,l as o,y as E,m as q,z as i,u as l,ab as D,k as p,D as K,A as S,B as k,aa as x,br as Ht,W as J,F as Ut,X as Q,ar as B,a8 as Et,af as Jt,a9 as Zt,bG as Lt,c6 as Yt,c_ as Wt,a1 as Gt,a2 as jt,E as w}from"./vendor-nmnlhkKn.js";import{aO as Xt,u as V,H as I,S as it,P as tt,t as Z,f as qt,A as Kt,x as et,bx as Qt,_ as rt,T as te,D as ee,g as nt,k as ne,m as ae,aN as oe,a7 as se}from"./index-BvWP6-de.js";import{D as ie}from"./DemographicBar-BgeGvF23.js";import{N as re,u as L,a as le,L as ce}from"./NextAppointmentModal-wAymm8_Q.js";import{S as pe}from"./SaveProgressModal-Bou5w9zV.js";import{F as ue}from"./FeatusModal-fTCDHdEL.js";import{a as de}from"./formatServerData-DaQnIy7B.js";import{u as F,A as at,a as me,v as ot}from"./vaccines_service-BaZU0suJ.js";import{S as st}from"./sms_service-DNDtHxyI.js";import{R as fe}from"./relationship_service-BsyubxIE.js";import{B as ge}from"./BasicForm-b1lG9heW.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-BRGQbDZT.js";import"./EIRreportsStore-CzpHvhAR.js";import"./Export-BBZGMHZD.js";import"./DateInputField-B95VrN-N.js";class he extends Xt{constructor(r,m){super(r,7,m)}}const ye={class:"lbl-ct"},De={class:"lbl-ct"},_e={style:{"margin-right":"20px",color:"black"}},Ae={style:{"font-size":"16px",color:"#666","margin-top":"5px"}},ve=Y({watch:{},name:"xxxComponent",computed:{...B(L,["nextAppointmentDate"]),...B(V,["patient"])},methods:{handleInputData(a){Qt(this.nextAppointmentDate,re,a.name,a.value),this.handleDateOfScheduledAppointmentRange(a)},closeOutline(){return Et},handleDateOfScheduledAppointmentRange(a){const r=new Date,m=new Date(r);m.setDate(m.getDate()+1);const f=m.toISOString().split("T")[0],_=new Date(r);_.setDate(_.getDate()+32);const M=_.toISOString().split("T")[0];et(this.nextAppointmentDate,"Appointment date","minDate",f),et(this.nextAppointmentDate,"Appointment date","maxDate",M)}}}),we=Y({...ve,props:{patient_Id:{},encounter_Id:{}},setup(a){const r=V(),m=V(),f=y(),_=y(),M=y(!1),C=y(!1),P=I.toStandardHisDisplayFormat(it.getSessionDate()),g=y(!1),O=y(),$=y(0),N=y([]),A=[],v=a;async function lt(){await dt(),await At();const e=await(v.patient_Id?new at(v.patient_Id):new at).createAppointment();pt(),ut(),G(),ct(e)}async function ct(t){if(N.value.length==0){Z("No phone numbers available for sms reminder!");return}Array.isArray(t)&&t.length>0&&(C.value?await(await Q.create({component:me,componentProps:{date:t[1],patient:t[0],modalaction:"saveAppointment"}})).present():await st.appointment(t[0],t[1]))}async function pt(){const t=qt();t.setVaccineReload(!t.getVaccineReload())}async function ut(){const t=F();t.setAppointmentsReload(!t.getAppointmentsReload())}async function dt(){try{await ot(v.encounter_Id,"Rescheduled"),await ot(v.encounter_Id,"Rescheduled")}catch(t){}}zt(async()=>{F().clearAppointmentMent(),await _t(),await mt()});async function mt(){try{const t=new tt,e=v.patient_Id!==void 0?v.patient_Id:t.getID(),n=await yt(e);if(A.length>0){const s=A[A.length-1];console.log(s),await ft(s,e)==!1&&(f.value=X(s.vaccine.date_administered,j(n.age)),_.value=I.toStandardHisDisplayFormat(f.value),vt(f.value),wt(f.value),M.value=!0)}}catch(t){}}async function ft(t,e){try{const n=await tt.findByID(e),s=new Date(n.person.birthdate),u=X(s,j(t.age)),c=gt(t.vaccine.date_administered),d=new Date(u);return console.log(W(c,d)),W(c,d)}catch(n){}}function gt(t){const e={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},n=t.split(/[:/ ]/),s="".concat(n[2],"-").concat(e[n[1]],"-").concat(n[0],"T").concat(n[3],":").concat(n[4],":").concat(n[5]);return new Date(s)}function W(t,e){const n=t.getFullYear(),s=t.getMonth(),u=t.getDate(),c=e.getFullYear(),d=e.getMonth(),b=e.getDate();return n!==c?n>c:s!==d?s>d:u>b}function ht(t){return t.forEach(e=>{e.antigens.forEach(n=>{n.status=="administered"&&A.push({age:e.age,vaccine:n})})}),A}async function yt(t){try{const e=m.vaccineSchedule;ht(e.vaccine_schedule);for(const n of e.vaccine_schedule)if(n.milestone_status==="current"||n.milestone_status==="upcoming")return n;return null}catch(e){return null}}async function Dt(t){try{const e=await Kt.getDailiyAppointments(I.toStandardHisFormat(t),I.toStandardHisFormat(t));$.value=e.length+1}catch(e){}}function G(){Q.dismiss()}async function _t(){try{let t=await st.getConfigurations();C.value=t.show_sms_popup}catch(t){}}async function At(){var t,e;try{const n=await fe.getRelationships(r.patient.patientID);if(n.length>0){const s=n[0].relation.person_attributes.find(u=>u.type.name=="Cell Phone Number");s&&N.value.push(s.value)}(e=(t=r.patient)==null?void 0:t.personInformation)!=null&&e.cell_phone_number&&N.value.push(r.patient.patientID)}catch(n){}}async function vt(t){const e=F(),n={counter:1,date:t};e.setAppointmentMent(n),g.value=!1,await Dt(t),g.value=!0,O.value=I.toStandardHisDisplayFormat(t)}function wt(t){const n=F().getAppointmentMents(),s=d=>{const b=new Date(d);return b.setHours(0,0,0,0),b.getTime()},u=s(new Date(t)),c=n.find(d=>s(new Date(d.date))===u);return c?c.counter:null}function j(t){const e=/(\d+)\s*(week|month|year)s?/i,n=t.match(e);if(!n)return"Invalid input format";const s=parseInt(n[1]);switch(n[2].toLowerCase()){case"week":return s*7;case"month":return s*30;case"year":return s*365;default:return"Invalid time unit"}}function X(t,e){let n;if(t instanceof Date)n=new Date(t);else{const[h,U]=t.split(" "),[Ot,$t,Ft]=h.split("/"),[Tt,Bt,Vt]=U.split(":"),Pt={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};n=new Date(Number(Ft),Pt[$t],Number(Ot),Number(Tt),Number(Bt),Number(Vt))}n.setDate(n.getDate()+e);const s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=h=>String(h).padStart(2,"0"),d=s[n.getDay()],b=u[n.getMonth()],bt=c(n.getDate()),St=n.getFullYear(),xt=c(n.getHours()),Mt=c(n.getMinutes()),Nt=c(n.getSeconds()),z=-n.getTimezoneOffset(),It=Math.floor(Math.abs(z)/60),kt=Math.abs(z)%60,Ct="GMT".concat(z>=0?"+":"-").concat(c(It)).concat(c(kt)),R=Intl.DateTimeFormat().resolvedOptions().timeZone;let H;try{const h=new Intl.DateTimeFormat("en",{timeZone:R,timeZoneName:"long"}).formatToParts(n).find(U=>U.type==="timeZoneName");H=h?h.value:R}catch(h){console.error("Error getting localized time zone name:",h),H=R}return"Date ".concat(d," ").concat(b," ").concat(bt," ").concat(St," ").concat(xt,":").concat(Mt,":").concat(Nt," ").concat(Ct," (").concat(H,")")}return(t,e)=>(T(),Rt(Ut,null,[o(l(x),{style:{"margin-top":"10px"}},{default:i(()=>[o(l(D),{style:{"margin-left":"-3px"}},{default:i(()=>e[0]||(e[0]=[p("div",{class:"om",style:{"font-weight":"600",color:"#8d8686"}},"Set Next Appointment Date",-1)])),_:1,__:[0]}),o(l(D),{size:"6",style:{"text-align":"right"}},{default:i(()=>[o(l(K),{class:"lbl-tl",style:{"font-size":"13px"}},{default:i(()=>[e[1]||(e[1]=S(" Todays Date: ")),p("span",ye,k(l(P)),1)]),_:1,__:[1]})]),_:1})]),_:1}),o(l(x),{style:{"margin-top":"10px"}},{default:i(()=>[o(l(D),{style:{"margin-left":"-3px"}},{default:i(()=>e[2]||(e[2]=[p("div",{class:"om"},null,-1)])),_:1,__:[2]}),g.value?(T(),E(l(D),{key:0,size:"10",style:{"text-align":"right"}},{default:i(()=>[o(l(K),{class:"lbl-tl",style:{"font-size":"16px","font-weight":"500"}},{default:i(()=>[e[3]||(e[3]=S(" Total Appointments ")),p("span",De,"("+k(O.value)+")",1),e[4]||(e[4]=S(": ")),p("span",_e,[o(l(Ht),{color:"primary",style:{"margin-bottom":"-5px","font-size":"15px"}},{default:i(()=>[S(k($.value),1)]),_:1})])]),_:1,__:[3,4]})]),_:1})):q("",!0)]),_:1}),o(l(x),{style:{"margin-top":"20px"}},{default:i(()=>[o(l(D),null,{default:i(()=>[o(ge,{contentData:t.nextAppointmentDate,"onUpdate:selected":t.handleInputData,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:selected","onUpdate:inputValue"])]),_:1})]),_:1}),M.value?(T(),E(l(x),{key:0,style:{"margin-top":"0px","margin-bottom":"0px"}},{default:i(()=>[o(l(D),{style:{"background-color":"#f0f0f0",padding:"15px","border-radius":"8px","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)"}},{default:i(()=>[e[5]||(e[5]=p("div",{style:{"font-size":"17px",color:"#333","font-weight":"bold"}},"Suggested Date:",-1)),p("div",Ae,k(_.value),1)]),_:1,__:[5]})]),_:1})):q("",!0),o(l(x),{style:{"margin-top":"10px","margin-bottom":"10px"}},{default:i(()=>[o(l(D),null,{default:i(()=>[o(l(J),{onClick:G,id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"}},{default:i(()=>e[6]||(e[6]=[S(" Cancel ")])),_:1,__:[6]})]),_:1}),o(l(D),{style:{"text-align":"right"}},{default:i(()=>[o(l(J),{onClick:lt,class:"btnText",fill:"solid",style:{width:"130px"}},{default:i(()=>e[7]||(e[7]=[S(" save ")])),_:1,__:[7]})]),_:1})]),_:1})],64))}}),be=rt(we,[["__scopeId","data-v-adf180ee"]]),Se=Y({name:"TB screening",components:{IonRow:x,IonButton:J,FeatusModal:ue,DynamicButton:ee,IonContent:Zt,IonPage:Jt,Toolbar:te,DemographicBar:ie,LandingPage:ce,NextAppointmentModal:le},props:{backBtn:{type:String,default:"Back to profile"},backUrl:{type:String,default:""},contact:{type:String,default:""}},data(){return{isModalOpen:!1,dateOfAppointment:""}},mounted(){this.handleAppointment()},setup(){return{checkmark:jt,pulseOutline:Gt}},computed:{...B(L,["nextAppointmentDate"]),...B(V,["patient"])},methods:{calendar(){return Wt},eye(){return Yt},chevronBackOutline(){return Lt},openBackController(){this.backUrl?this.$router.push(this.backUrl):nt(pe)},async handleAppointment(){const a=await se.getFirstObsValue(this.patient.patientID,"Appointment date","value_text");this.dateOfAppointment=a},async saveData(){if(!await L().validate()){ae("Next appointment date has errors");return}await this.saveDate(),this.closeAppointmentModal(),await this.$router.push("ANCHome"),await await oe()},async saveDate(){if(this.nextAppointmentDate.length>=0){const a=it.getUserID(),r=new he(this.patient.patientID,a);if(!await r.createEncounter())return Z("Unable to create appointment date encounter");if(!await r.saveObservationList(await this.buildNextAppointment()))return Z("Unable to create date!");ne("Client has been scheduled for next contact")}console.log(await this.buildNextAppointment())},openNextVaccineAppoinment(){nt(be,{class:"otherVitalsModal"},!1)},async buildNextAppointment(){return[...await de(this.nextAppointmentDate)]},cancelModal(){this.closeAppointmentModal()},async nextAppointment(){this.toggleAppointmentModal()},toggleAppointmentModal(){this.isModalOpen=!this.isModalOpen},closeAppointmentModal(){this.isModalOpen=!1},previousContacts(){this.$router.push("/contacts")},navigateToContact(){this.$router.push("/contact")}}}),xe={class:"container"},Me={class:"back_profile"},Ne={class:"AppointmentDate"},Ie={style:{color:"#0b5ed7"}},ke={class:"button-container ion-justify-content-center ion-align-items-center"};function Ce(a,r,m,f,_,M){const C=w("Toolbar"),P=w("DemographicBar"),g=w("DynamicButton"),O=w("NextAppointmentModal"),$=w("LandingPage"),N=w("ion-content"),A=w("ion-page");return T(),E(A,null,{default:i(()=>[o(C),o(N,{fullscreen:!0},{default:i(()=>[o(P),p("div",xe,[p("div",Me,[o(g,{name:a.backBtn,iconSlot:"start",fill:"clear",icon:a.chevronBackOutline(),onClick:r[0]||(r[0]=v=>a.openBackController())},null,8,["name","icon"]),p("div",Ne,[r[1]||(r[1]=p("span",{style:{"font-size":"14px"}},"Appointment Date: ",-1)),p("b",Ie,k(a.dateOfAppointment||"Not scheduled"),1)])]),p("div",ke,[o(g,{style:{"padding-right":"1%"},name:"New ANC contact",iconSlot:"start",fill:"solid",icon:a.checkmark,onClick:a.navigateToContact},null,8,["icon","onClick"]),o(g,{style:{"padding-right":"1%"},name:"View ANC contacts",iconSlot:"start",fill:"solid",icon:a.eye(),onClick:a.previousContacts},null,8,["icon","onClick"]),o(g,{name:"Schedule next contact",iconSlot:"start",fill:"solid",icon:a.calendar(),onClick:a.nextAppointment},null,8,["icon","onClick"])]),o(O,{isOpen:a.isModalOpen,title:"",closeModalFunc:a.closeAppointmentModal,onYes:a.saveData,onNo:a.cancelModal},null,8,["isOpen","closeModalFunc","onYes","onNo"]),r[2]||(r[2]=p("hr",null,null,-1)),o($)])]),_:1})]),_:1})}const We=rt(Se,[["render",Ce],["__scopeId","data-v-75067a76"]]);export{We as default};

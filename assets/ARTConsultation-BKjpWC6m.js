import{d as U,e as D,f as d,l as n,k as _,y as p,m as g,z as r,B as V,u as l,aX as he,A as v,D as P,d9 as re,F as Y,L as j,G as F,bO as Ne,ac as Ie,a3 as Fe,cz as Be,cy as Me,r as M,a as me,W as Z,I as le,ca as Ae,O as A,br as $e,aa as I,ab as S,bj as ke,a8 as Ee,bm as L,b1 as Ce,c as He,w as Le,be as Ue,aL as We,d1 as Ye,d0 as Xe,dd as ie,i as ze,v as je,$ as Qe,d$ as Ge,e0 as Ke,e1 as Je,aY as E,a$ as H,J as X,M as Ze}from"./vendor-CIegBHSo.js";import{cr as et,_ as ee,ac as tt,aj as fe,t as ne,cs as be,a6 as at,s as J,az as ue,a1 as G,j as _e,l as de,u as Se,H as oe,S as qe,a5 as lt,X as rt,P as ge,U as nt,ct as Oe,cu as we}from"./index-CUlU9rSI.js";import{C as ae,P as it,R as st}from"./prescription_service-2g5eGbdu.js";import{B as z}from"./BasicYesNoSelect-ZXWAFkGV.js";import{B as W}from"./BasicRadioSelect-MJp_XH-h.js";import{u as ot}from"./Arrays-CfBll-2n.js";import{l as K}from"./lodash-Dt8AsbQm.js";import{P as ut}from"./patient_type_service--Nj729DN.js";import{A as pe}from"./app_encounter_service-F3MLsbNN.js";import{S as dt}from"./SelectFacility-DQmQ2DwN.js";import{P as ye}from"./patient_lab_service-C7ZYncW-.js";import{m as ct}from"./apexcharts-uyb6bGBl.js";async function ft(y,T="action-sheet-modal"){const C=await et("Are you sure you want to void record?","Please specify reason for voiding this record",["Mistake/ Wrong Entry","Duplicate","System Error"],[{name:"Cancel",slot:"start"},{name:"Void",color:"danger",slot:"end",role:"action"}],"",T);C.selection&&C.action==="Void"&&await y(C.selection)}const _t={style:{border:"1px dotted #ccc","border-radius":"15px"},class:"ion-padding"},mt={key:0,style:{color:"green","font-style":"italic"}},pt=U({__name:"BasicMultiSelect",props:{label:String,required:Boolean,errorMessage:String,modelValue:Object},emits:["update:modelValue","onChange"],setup(y,{emit:T}){const C=y,b=T;function c(o,O){var e;const u=[...(e=C.modelValue)!=null?e:[]].map(i=>i.value===o.value?{...i,checked:O}:i),q={...o,checked:O};b("update:modelValue",u),b("onChange",q)}return(o,O)=>(d(),D("div",_t,[n(l(P),null,{default:r(()=>[_("b",null,V(y.label),1),y.required?(d(),p(l(he),{key:0,color:"danger"},{default:r(()=>O[0]||(O[0]=[v("*")])),_:1,__:[0]})):g("",!0)]),_:1}),O[1]||(O[1]=_("br",null,null,-1)),y.errorMessage?(d(),p(l(re),{key:0,color:"danger"},{default:r(()=>[v(V(y.errorMessage),1)]),_:1})):g("",!0),O[2]||(O[2]=_("p",null,null,-1)),n(l(Ie),null,{default:r(()=>[(d(!0),D(Y,null,j(y.modelValue,(u,q)=>(d(),p(l(F),{key:q},{default:r(()=>[n(l(Ne),{disabled:u.disabled,checked:u.checked,slot:"start",onIonChange:e=>c(u,e.detail.checked)},null,8,["disabled","checked","onIonChange"]),n(l(P),{style:{"margin-left":"10px"}},{default:r(()=>[v(V(u.label)+" ",1),u.status?(d(),D("p",mt,V(u.status),1)):g("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1}),O[3]||(O[3]=_("p",null,null,-1)),y.errorMessage?(d(),p(l(re),{key:1,color:"danger"},{default:r(()=>[v(V(y.errorMessage),1)]),_:1})):g("",!0)]))}}),ve=ee(pt,[["__scopeId","data-v-224c666e"]]),vt={style:{border:"1px dotted #ccc","border-radius":"15px"},class:"ion-padding"},bt=U({__name:"BasicInput",props:{label:String,modelValue:String,required:Boolean,disabled:Boolean,errorMessage:String,placeholder:String,inputType:Object,onChange:Object},emits:["update:modelValue","onChange"],setup(y,{emit:T}){const C=T;function b(c){const o=c.target.value;C("update:modelValue",o),C("onChange",o)}return(c,o)=>(d(),D("div",vt,[n(l(P),null,{default:r(()=>[_("b",null,V(y.label),1),y.required?(d(),p(l(he),{key:0,color:"danger"},{default:r(()=>o[0]||(o[0]=[v("*")])),_:1,__:[0]})):g("",!0)]),_:1}),o[1]||(o[1]=_("p",null,null,-1)),n(l(Fe),{fill:"outline",value:y.modelValue,disabled:y.disabled,type:y.inputType,onIonInput:b,placeholder:y.placeholder},null,8,["value","disabled","type","placeholder"]),o[2]||(o[2]=_("p",null,null,-1)),y.errorMessage?(d(),p(l(re),{key:0,color:"danger"},{default:r(()=>[v(V(y.errorMessage),1)]),_:1})):g("",!0)]))}}),se=ee(bt,[["__scopeId","data-v-b25669b7"]]),gt={style:{border:"1px dotted #ccc","border-radius":"15px"},class:"ion-padding"},yt={key:0,style:{color:"red"}},xe=U({__name:"BasicSelect",props:{label:String,required:Boolean,multiple:Boolean,errorMessage:String,placeholder:String,options:Object,modelValue:Object},emits:["update:modelValue","onChange"],setup(y,{emit:T}){const C=T;function b(c){C("update:modelValue",c),C("onChange",c)}return(c,o)=>{var O;return d(),D("div",gt,[n(l(P),null,{default:r(()=>[_("b",null,V(y.label),1),y.required?(d(),D("span",yt,"*")):g("",!0)]),_:1}),n(l(Me),{multiple:y.multiple,fill:"outline",onIonChange:o[0]||(o[0]=u=>b(u.detail.value)),interface:"popover",placeholder:(O=y.placeholder)!=null?O:"Select an option"},{default:r(()=>[(d(!0),D(Y,null,j(y.options,u=>(d(),p(l(Be),{key:u.value,value:u},{default:r(()=>[v(V(u.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["multiple","placeholder"]),y.errorMessage?(d(),p(l(re),{key:0,color:"danger"},{default:r(()=>[v(V(y.errorMessage),1)]),_:1})):g("",!0)])}}}),ht={style:{border:"1px dotted #ccc","border-radius":"15px"},class:"ion-padding"},Ct={key:0,style:{color:"red"}},St=U({__name:"BasicDateInput",props:{label:String,modelValue:String,required:Boolean,errorMessage:String},emits:["update:modelValue","onChange"],setup(y,{emit:T}){const C=T;function b(c){C("update:modelValue",c),C("onChange",c)}return(c,o)=>(d(),D("div",ht,[n(l(P),{class:"form-label"},{default:r(()=>[v(V(y.label)+" ",1),y.required?(d(),D("span",Ct,"*")):g("",!0)]),_:1}),n(tt,{place_holder:"",date_prop:"",onDateUpDated:o[0]||(o[0]=O=>{b(O.value.standardDate)}),error:!1}),y.errorMessage?(d(),p(l(re),{key:0,color:"danger"},{default:r(()=>[v(V(y.errorMessage),1)]),_:1})):g("",!0)]))}}),ce=ee(St,[["__scopeId","data-v-284aefe8"]]);class Vt extends pe{constructor(T,C){super(T,13,C)}async buildDefferedOrder(T){const C=await pe.getConceptID("HIV viral load"),b=await pe.getConceptID("Delayed milestones");return[{concept_id:C,value_text:"Wait till next milestone",value_coded:b,value_numeric:T}]}}const qt={key:0},Ot={key:0,class:"info-container"},wt={class:"info-card"},xt={class:"main-message"},Dt={class:"message-content"},Tt={class:"info-list"},It=U({__name:"vl-info-alert",props:{patientID:{}},setup(y){const T=y,C=M(!0),b=M(null),c=M(!1),o=async()=>{if(await fe("Are you sure you want to wait till next milestone?")){const i=new Vt(T.patientID,-1),f=await i.createEncounter(),x=await i.buildDefferedOrder(null);if(!f)return ne("Unable to create encounter");const k=await i.saveObservationList(x);C.value=!k}},O=async()=>{await fe("Are you sure you want to remind me later?")&&(C.value=!1)},u=async()=>{await fe("Are you sure you want to close this milestone notification?")&&(C.value=!1)},q=async()=>{try{if(c.value=await be.VLEnabled(),!c.value)return;const i=await at.getPatientVLInfo(T.patientID);b.value=i}catch(i){console.error("Error fetching VL data:",i)}},e=i=>i?A(i).format("DD MMM, YYYY"):"N/A";return me(()=>{q()}),(i,f)=>{var x,k;return c.value?(d(),D("div",qt,[C.value&&((x=b.value)!=null&&x.eligibile)&&!b.value.skip_milestone?(d(),D("div",Ot,[_("div",wt,[_("button",{class:"close-button",onClick:u,"aria-label":"Close notification"},f[0]||(f[0]=[_("svg",{class:"close-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[_("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),_("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])),_("div",xt,[f[10]||(f[10]=_("svg",{class:"info-icon",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},[_("path",{fill:"currentColor",d:"M24.586 6.586A2 2 0 0 0 23.17 6H16V2h-2v4H6a2.003 2.003 0 0 0-2 2v6a2.003 2.003 0 0 0 2 2h8v14h2V16h7.171a2 2 0 0 0 1.415-.586L29 11ZM23.17 14H6V8h17.172l3 3Z"})],-1)),_("div",Dt,[f[9]||(f[9]=_("h2",null,"VL milestone has been reached",-1)),_("ul",Tt,[_("li",null,[f[1]||(f[1]=v("Patient has been on ART for ")),_("b",null,V(b.value.period_on_art),1),f[2]||(f[2]=v(" months"))]),_("li",null,[f[3]||(f[3]=v("Treatment started on ")),_("b",null,V(e(b.value.earliest_start_date)),1)]),_("li",null,[f[4]||(f[4]=v("Current regimen: ")),_("b",null,V(b.value.current_regimen.name),1),f[5]||(f[5]=v(" since ")),_("b",null,V(e(b.value.current_regimen.date_started)),1)]),_("li",null,[f[6]||(f[6]=v("Last VL order date: ")),_("b",null,V(e((k=b.value)==null?void 0:k.last_order_date)),1)])]),_("div",null,[n(l(Z),{class:"ion-padding",onClick:o,color:"primary",fill:"outline",size:"small"},{default:r(()=>f[7]||(f[7]=[v(" Wait till next milestone ")])),_:1,__:[7]}),n(l(Z),{class:"ion-padding",onClick:O,color:"primary",fill:"outline",size:"small"},{default:r(()=>f[8]||(f[8]=[v(" Remind me later ")])),_:1,__:[8]})])])])])])):(d(),p(l(F),{key:1,lines:"none"},{default:r(()=>[n(l(le),{style:{"font-size":"1.3rem"},slot:"start",size:"large",icon:l(Ae)},null,8,["icon"]),n(l(P),{style:{"font-size":"1.2rem"},slot:"start"},{default:r(()=>{var $;return[v(V(($=b.value)==null?void 0:$.message),1)]}),_:1})]),_:1}))])):g("",!0)}}}),kt=ee(It,[["__scopeId","data-v-4f22786e"]]),Pt={style:{border:"1px dotted #ccc","border-radius":"15px"},class:"ion-padding"},Rt=U({__name:"BasicFacilitySelector",props:{label:String,modelValue:String,required:Boolean,disabled:Boolean,errorMessage:String,onChange:Object},emits:["update:modelValue","onChange"],setup(y,{emit:T}){const C=T;function b(c){C("update:modelValue",c),C("onChange",c)}return(c,o)=>(d(),D("div",Pt,[n(l(P),null,{default:r(()=>[_("b",null,V(y.label),1),y.required?(d(),p(l(he),{key:0,style:{color:"red"}},{default:r(()=>o[1]||(o[1]=[v("*")])),_:1,__:[1]})):g("",!0),o[2]||(o[2]=_("br",null,null,-1)),y.errorMessage?(d(),p(l(re),{key:1},{default:r(()=>[v(V(y.errorMessage),1)]),_:1})):g("",!0)]),_:1,__:[2]}),n(dt,{show_error:!1,selected_district_ids:[],selected_location:null,onFacilitySelected:o[0]||(o[0]=O=>{b(O.selected_location.name)})})]))}}),Nt=ee(Rt,[["__scopeId","data-v-f7a4b4f8"]]),Ft={style:{border:"1px dotted #ccc","border-radius":"15px"},class:"ion-padding"},Bt={key:0,style:{color:"red"}},De=U({__name:"BasicVueSelect",props:{label:String,required:Boolean,disabled:Boolean,placeholder:String,errorMessage:String,options:Object,modelValue:Object},emits:["update:modelValue","onChange"],setup(y,{emit:T}){const C=M(null),b=T;function c(o){b("update:modelValue",o),b("onChange",o)}return(o,O)=>{var u;return d(),D("div",Ft,[n(l(P),null,{default:r(()=>[_("b",null,V(y.label),1),y.required?(d(),D("span",Bt,"*")):g("",!0)]),_:1}),n(l($e),{modelValue:C.value,"onUpdate:modelValue":[O[0]||(O[0]=q=>C.value=q),c],teleport:"",multiple:!1,"hide-selected":!1,"close-on-select":!0,openDirection:"auto","tag-placeholder":"",placeholder:y.placeholder,selectLabel:"",label:"label",searchable:!0,"track-by":"label",options:y.options,disabled:(u=y.disabled)!=null?u:!1},null,8,["modelValue","placeholder","options","disabled"]),y.errorMessage?(d(),p(l(re),{key:0,color:"danger"},{default:r(()=>[v(V(y.errorMessage),1)]),_:1})):g("",!0)])}}}),Pe=U({__name:"NewOrder",props:{patientID:{type:Number,required:!0},onNewOrder:{type:Object,required:!1},canOrder:{type:Object,required:!1},testFilters:{type:Object,default:()=>[]}},emits:["onNewOrder"],setup(y,{emit:T}){const C=T,b=y,c=M({test_name:null,reason_for_test:"",specimen:null}),o=M([]),O=M([]),u=M(["Routine","Targeted","Confirmatory","Stat","Repeat / Missing"]),q=M({}),e={general:["Routine","Targeted","Confirmatory","Stat","Repeat / Missing"],"HIV viral load":["Routine","Targeted","Confirmatory","Stat","Repeat / Missing","Follow up after Low Level Viremia","Follow up after High Viral Load"]};function i(B){c.value.specimen="",f(B),k(B)}function f(B){var m;u.value=(m=e[B])!=null?m:e.general}function x(){ue.getTestTypes().then(B=>{o.value=B.filter(m=>b.testFilters.length===0||b.testFilters.includes(m.name)).map(m=>({label:m.name,value:m.concept_id}))})}async function k(B){O.value=[],q.value[B]||(q.value[B]=await ue.getSpecimens(B).then(m=>m.map(N=>({label:N.name,value:N.concept_id})))),O.value=q.value[B]}async function $(){if(typeof b.canOrder=="function"&&!b.canOrder(c.value))return;const B=new ye(b.patientID);try{const m=await B.placeOrder({target_lab:ye.getLocationName(),reason_for_test_id:G.getCachedConceptID(c.value.reason_for_test,!0),specimen:{concept_id:c.value.specimen.value},tests:[{concept_id:c.value.test_name.value}],combine_tests:!0});m?(b.onNewOrder&&b.onNewOrder(m),C("onNewOrder",m),_e("Lab investigation saved successfully"),J.hide()):de("Failed to save lab investigation")}catch(m){de("Failed to save lab investigation: ".concat(m))}}return x(),(B,m)=>(d(),p(l(L),null,{default:r(()=>[n(l(I),null,{default:r(()=>[n(l(S),null,{default:r(()=>[n(De,{modelValue:c.value.test_name,"onUpdate:modelValue":m[0]||(m[0]=N=>c.value.test_name=N),required:"",label:"Select Test",onOnChange:m[1]||(m[1]=N=>i(N.label)),options:o.value},null,8,["modelValue","options"])]),_:1}),n(l(S),null,{default:r(()=>[n(De,{required:"",modelValue:c.value.specimen,"onUpdate:modelValue":m[2]||(m[2]=N=>c.value.specimen=N),label:"Select Specimen",options:O.value},null,8,["modelValue","options"])]),_:1})]),_:1}),n(l(I),null,{default:r(()=>[n(l(S),null,{default:r(()=>[n(W,{modelValue:c.value.reason_for_test,"onUpdate:modelValue":m[3]||(m[3]=N=>c.value.reason_for_test=N),required:"",label:"Reason for Test",options:u.value.map(N=>({label:N,value:N}))},null,8,["modelValue","options"])]),_:1})]),_:1}),n(l(I),null,{default:r(()=>[n(l(S),null,{default:r(()=>[n(l(Z),{disabled:!c.value.test_name||!c.value.specimen||!c.value.reason_for_test,onClick:$},{default:r(()=>[n(l(le),{icon:l(ke),slot:"start"},null,8,["icon"]),m[4]||(m[4]=v(" Save "))]),_:1,__:[4]},8,["disabled"]),n(l(Z),{fill:"clear",onClick:l(J).hide},{default:r(()=>[n(l(le),{icon:l(Ee),slot:"start"},null,8,["icon"]),m[5]||(m[5]=v(" Cancel "))]),_:1,__:[5]},8,["onClick"])]),_:1}),n(l(S))]),_:1})]),_:1}))}}),Mt={key:0,style:{border:"1px dashed #ccc",padding:"20px"}},At={key:1,class:"modern-table"},$t=U({__name:"ArtLabOrders",setup(y){const T=Se(),{patient:C}=Ce(T),b=M(),c=M([]),o=He(()=>b.value?c.value.filter(f=>new RegExp(b.value,"i").test(JSON.stringify(f))):c.value);function O(f){return oe.toStandardHisDisplayFormat(f)}async function u(f){if(O(f.ordered)!=O(qe.getSessionDate()))return ne("Printing order #".concat(f.accession_number," is restricted to today. Consider using BDE mode/set session date to the order date"));if(await fe("Do you want to print order with accession number ".concat(f.accession_number,"?")))return new lt(C.value.patientID).printLabOrderLbl(f.order_id)}function q(f){ft(async x=>{new ye(-1).voidOrder(f.order_id,x).then(k=>{k?de("An error has occured while voiding record"):(c.value=c.value.filter($=>$.order_id!=f.order_id),_e("Record has been voided successfully!"))}).catch(k=>{de("An error has occured while deleting order: ".concat(k))})})}function e(){J.show(Pe,{patientID:C.value.patientID,canOrder:f=>c.value.filter(k=>O(k.ordered)===O(qe.getSessionDate())).some(k=>k.test_name===f.test_name.label)?(ne("You have already ordered ".concat(f.test_name," today")),!1):!0,onNewOrder:f=>{c.value.push(...ue.formatLabs(f))}})}async function i(f){const k=(await ue.getOrders(f,{patientID:C.value.patientID})).map(async $=>{const B={...$,result_given:!1},m=$.tests.filter(N=>N.result!=null).map(N=>N.result).reduce((N,w)=>[...N,...w],[]).reduce((N,w)=>w.id,null);try{B.result_given=m?await(await rt.get(m)).children.reduce(async(N,w)=>await G.getConceptID("Result Given to Client")===w.concept_id&&await G.getConceptName(w.value_coded)==="Yes"?"Yes":N,"No"):"N/A"}catch(N){console.error(N)}return B});c.value=ue.formatLabs(await Promise.all(k))}return Le(()=>C.value.patientID,f=>i(f),{immediate:!0}),(f,x)=>(d(),D("div",null,[n(l(F),{lines:"none"},{default:r(()=>[n(l(Z),{onClick:e},{default:r(()=>[n(l(le),{icon:l(ke),slot:"start"},null,8,["icon"]),x[1]||(x[1]=v(" Order Test "))]),_:1,__:[1]}),n(l(Ue),{modelValue:b.value,"onUpdate:modelValue":x[0]||(x[0]=k=>b.value=k),color:"light",style:{width:"45%"},slot:"end"},null,8,["modelValue"])]),_:1}),c.value.length===0?(d(),D("div",Mt,x[2]||(x[2]=[_("h1",{class:"ion-text-center"}," Lab orders not available at the moment ",-1)]))):(d(),D("table",At,[x[6]||(x[6]=_("thead",null,[_("tr",null,[_("th",null,"Lab Test"),_("th",null,"Specimen"),_("th",null,"Accession Number"),_("th",null,"Order Date"),_("th",null,"Result"),_("th",null,"Action")])],-1)),_("tbody",null,[(d(!0),D(Y,null,j(o.value,(k,$)=>(d(),D("tr",{key:$},[_("td",null,V(k.test_name),1),_("td",null,V(k.specimen),1),_("td",null,V(k.accession_number),1),_("td",null,V(O(k.ordered)),1),_("td",null,[(d(!0),D(Y,null,j(k.result,(B,m)=>(d(),D("span",{key:m},[v(V(B)+" ",1),x[3]||(x[3]=_("br",null,null,-1))]))),128))]),_("td",null,[n(l(Z),{onClick:B=>u(k),color:"light"},{default:r(()=>[n(l(le),{color:"primary",icon:l(We),slot:"start"},null,8,["icon"]),x[4]||(x[4]=v(" Print "))]),_:2,__:[4]},1032,["onClick"]),n(l(Z),{onClick:B=>q(k),color:"light",class:"ion-margin-start"},{default:r(()=>[n(l(le),{style:{color:"red"},icon:l(Ye),slot:"start"},null,8,["icon"]),x[5]||(x[5]=v(" Void "))]),_:2,__:[5]},1032,["onClick"])])]))),128))])]))]))}}),Et=ee($t,[["__scopeId","data-v-1287381f"]]),Ht={key:0,style:{border:"1px dashed #ccc",padding:"20px"}},Lt=U({__name:"ArtWeightChart",setup(y){const T=new ge,C=M([]),b=M(!1),c=Xe({prevWeight:"-",curWeight:"-",curWeightChange:"-",weightState:"",age:"-",bmi:{}}),o={chart:{id:"weight_chart"},title:{text:"Weight trail (2 year period)"},stroke:{curve:"smooth"},yaxis:{title:{text:"Weight Kg(s)"},min:0},xaxis:{categories:[]},dataLabels:{enabled:!0,textAnchor:"start",formatter:function(u,q){var i;const e=(i=q.w.config.series[0].data[q.dataPointIndex-1])==null?void 0:i.y;return e&&e>0?(u/e*100-100).toFixed(2)+" %":"0.0%"}}};function O(u){var i,f;const q=((i=u.values[u.values.length-2])==null?void 0:i.y)||0,e=((f=u.values[u.values.length-1])==null?void 0:f.y)||0;c.curWeight=e||"-",c.prevWeight=q||"-",c.age=u.age,c.bmi=u.bmi,e>0&&q>0&&(c.curWeightChange=Math.abs(e/q*100-100).toFixed(2)+" %",c.weightState=e>q?Ge:e<q?Ke:Je)}return me(async()=>{const u=await T.getWeightHistory(),q=await T.getBMI(),e=u.map(i=>({x:A(i.date).format("DD/MMM/YYYY"),y:i.weight}));b.value=e.length>0,C.value=[{name:"Weight",data:e.sort((i,f)=>{const x=new Date(i.x),k=new Date(f.x);return x-k}).map(i=>{const[f,x]=i.x.split("/");return{x:"".concat(f,".").concat(x),y:i.y}})}],O({bmi:q,age:T.getAge(),values:e})}),(u,q)=>b.value?(d(),p(l(L),{key:1},{default:r(()=>[n(l(I),null,{default:r(()=>[n(l(S),{"size-md":"8","size-sm":"12"},{default:r(()=>[n(l(ct),{width:"100%",height:"560px",type:"area",options:o,series:C.value},null,8,["series"])]),_:1}),n(l(S),{"size-md":"4","size-sm":"12"},{default:r(()=>[n(l(Ie),null,{default:r(()=>[n(l(F),null,{default:r(()=>[n(l(P),{class:"title"},{default:r(()=>q[1]||(q[1]=[v("Previous weight")])),_:1,__:[1]}),n(l(ie),{slot:"end",color:"primary"},{default:r(()=>[v(V(c.prevWeight),1)]),_:1})]),_:1}),n(l(F),null,{default:r(()=>[n(l(P),{class:"title"},{default:r(()=>q[2]||(q[2]=[v("Latest weight")])),_:1,__:[2]}),n(l(ie),{slot:"end",color:"primary"},{default:r(()=>[v(V(c.curWeight),1)]),_:1})]),_:1}),n(l(F),null,{default:r(()=>[n(l(P),{class:"title"},{default:r(()=>q[3]||(q[3]=[v("Latest weight change")])),_:1,__:[3]}),ze(n(l(le),{color:"primary",icon:c.weightState,width:"50"},null,8,["icon"]),[[je,c.weightState]]),n(l(ie),{slot:"end",color:"primary"},{default:r(()=>[v(V(c.curWeightChange),1)]),_:1})]),_:1}),n(l(F),null,{default:r(()=>[n(l(P),{class:"title"},{default:r(()=>q[4]||(q[4]=[v("Patient Age")])),_:1,__:[4]}),n(l(ie),{slot:"end",color:"primary"},{default:r(()=>[v(V(c.age),1)]),_:1})]),_:1}),n(l(F),null,{default:r(()=>[n(l(P),{class:"title"},{default:r(()=>q[5]||(q[5]=[v("Patient BMI")])),_:1,__:[5]}),n(l(ie),{slot:"end",color:"primary"},{default:r(()=>[v(V(c.bmi.index),1)]),_:1})]),_:1}),n(l(F),null,{default:r(()=>[n(l(P),{style:Qe({"background-color":c.bmi.color,color:"white",padding:"10px","text-align":"center"})},{default:r(()=>[v(V(c.bmi.result),1)]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(d(),D("div",Ht,q[0]||(q[0]=[_("h1",{class:"ion-text-center"}," No weight data available for this patient ",-1)])))}}),Ut={key:0,style:{border:"1px dashed #ccc",padding:"20px"}},Wt={key:1},Yt=U({__name:"SideEffectInput",props:{contraIndicationConceptName:{type:String,required:!0},onReason:{type:Object,required:!1}},setup(y){const T=y,C=M(null),b=M(null),c=Se(),{patient:o}=Ce(c),O=new ae(o.value.patientID,-1),u=M([]),q=M([{label:"Other, not drug related",value:"Other, not drug related"},{label:"Drug side effect",value:"Drug side effect"}]);async function e(){var i,f,x,k;if(T.onReason&&typeof T.onReason=="function"){const $={type:C.value?"Drug induced":b.value,obs:{concept_id:(f=(i=await G.getCachedConceptID("Drug induced",!0))==null?void 0:i[0])==null?void 0:f.concept_id,value_coded:(k=(x=await G.getCachedConceptID(T.contraIndicationConceptName,!0))==null?void 0:x[0])==null?void 0:k.concept_id,value_text:b.value?"Past medication history":null,value_drug:C.value?C.value:null}};T.onReason($)}}return me(()=>{O.getPreviousDrugs().then(i=>{u.value=Object.keys(i).map(f=>({label:i[f].drug.name,value:Number(f)}))})}),(i,f)=>(d(),p(l(H),null,{default:r(()=>[n(l(E),null,{default:r(()=>[n(l(F),{lines:"none"},{default:r(()=>[n(l(P),null,{default:r(()=>f[4]||(f[4]=[v(" Side effect suspected causes ")])),_:1,__:[4]})]),_:1}),_("div",null,[u.value.length===0?(d(),D("div",Ut,f[5]||(f[5]=[_("h1",{class:"ion-text-center"}," No previous dispensations found ",-1)]))):(d(),D("div",Wt,[n(W,{label:"Current Medication",modelValue:C.value,"onUpdate:modelValue":f[0]||(f[0]=x=>C.value=x),onOnChange:f[1]||(f[1]=()=>b.value=null),options:u.value},null,8,["modelValue","options"])]))]),_("div",null,[n(W,{label:"Previous Medication",modelValue:b.value,"onUpdate:modelValue":f[2]||(f[2]=x=>b.value=x),onOnChange:f[3]||(f[3]=()=>C.value=null),options:q.value},null,8,["modelValue","options"])]),n(l(Z),{disabled:!(C.value||b.value),class:"ion-padding",onClick:e},{default:r(()=>f[6]||(f[6]=[v(" Save ")])),_:1,__:[6]},8,["disabled"])]),_:1})]),_:1}))}}),Te=ee(Yt,[["__scopeId","data-v-7ee51920"]]),Xt={key:0},zt={key:0,style:{border:"1px dashed #ccc",padding:"20px"}},jt={key:0,style:{border:"1px dashed #ccc",padding:"20px"}},Qt={class:"ion-text-center"},Gt={key:0,class:"modern-table"},Kt={key:1,style:{border:"1px dashed #ccc",padding:"20px"}},Jt={style:{color:"red","font-weight":"bold","font-style":"italic"}},Zt=U({__name:"ARTConsultation",setup(y,{expose:T}){const C=Se(),{patient:b}=Ce(C),c=new ge,o=new ae(b.value.patientID,-1),O=new it(b.value.patientID,-1),u=M({}),q=M("labInvestigationForm"),e=M({labKey:1,isNonePatientVisit:!1,prevSideEffectsRows:[],canSubmit:!1,is_pregnant:"",is_breastfeeding:"",pregnant_breastfeeding:"",has_fp_methods:"",current_fp_methods:[],reason_for_no_fpm:"",specific_reason_for_no_fpm:"",offer_contraceptives:"",offered_intervention:"",offer_cxca:"",cxca_reminder:"",reason_for_no_cxca:"",previous_cxca_test_date:"",side_effects:[],other_side_effects:[],other_side_effect_specify:"",on_tb_treatment:"",tb_date_started_treatment_known:"",tb_start_date:"",tb_treatment_period:"",tb_side_effects:[],tb_screening_testing_methods:[],tb_screening_testing_results:[],tb_status:"",hasTbHistoryObs:!1,routine_tb_therapy:"",refer_to_clinician:"",chestXrayScreeningDone:"",molecularScreeningDone:"",chestXrayScreeningResult:"",molecularScreeningResult:"",isChildBearing:!1,hasPregnancyObsToday:!1,isPregnantObsStatus:!1,currentlyBreastfeeding:!1,onPermanentFpMethods:!1,patientHitMenopause:!1,cxcaEnabled:!1,CxCaMaxAge:-1,CxCaStartAge:-1,DueForCxCa:!1,clientHadAHysterectomy:!1,CxCaAppointDate:null,isWeightLossControlled:!1,hasTbTreatmentDate:!1,dateStartedTpt:"",tptDrugQuantities:[],transferFacility:"",arv_drugs:[],is_transfer_in:!0,date_art_started:"",date_last_received_arvs:"",selected_arvs:[],drug_interval:"",weightTrail:[],regimens:[],lostTenPercentBodyWeight:!1,tbTestOrderedForSuspectCase:!1}),i={isNonePatientVisit:{init:async()=>{e.value.isNonePatientVisit=await o.getClient()==="No",e.value.isNonePatientVisit||(e.value.isNonePatientVisit=await ut.isDrugRefillPatient(b.value.patientID))},onSubmit:async()=>(await o.createEncounter(),await o.saveObservationList([await o.buildValueCoded("Patient present","None")]),!0)},weightModel:{init:async()=>{e.value.weightTrail=await c.getWeightHistory(),e.value.weightLossPercentageNum=c.getWeightLossPercentageFromTrail(e.value.weightTrail),e.value.lostTenPercentBodyWeight=e.value.weightLossPercentageNum>=10},async showWeightlossConfirmation(){return await Oe("Recommendation","Patient's weight has dropped by ".concat(e.value.weightLossPercentageNum,"% , is this controlled weight loss??"),"Please verify",[{name:"Confirm weight loss",slot:"start",color:"success"},{name:"Confirm controlled",slot:"end",color:"primary"}])==="Confirm weight loss"?"Yes":"No"}},date_last_received_arvs:{label:"Last ARV Dispensation",required:()=>e.value.is_transfer_in===!0,init:async()=>{e.value.is_transfer_in=await i.date_last_received_arvs.getTransferInStatus(),e.value.date_art_started=await i.date_last_received_arvs.getDateStartedArt()},buildObs:()=>o.buildValueDate("Date drug received from previous facility",e.value.date_last_received_arvs),validation:()=>{const s=m("date_last_received_arvs");if(s){const t=A(e.value.date_last_received_arvs);return t.isBefore(A(e.value.date_art_started))?(u.value.date_last_received_arvs="Date last received ARVs cannot be before ART start date",!1):t.isAfter(A(o.getDate()))?(u.value.date_last_received_arvs="Date last received ARVs cannot be after today",!1):!0}return s},getDateStartedArt:async()=>{const s=await ae.getFirstValueDatetime(b.value.patientID,"Date ART started");return s?oe.toStandardHisFormat(s):""},getTransferInStatus:async()=>{const s=await ae.getFirstValueCoded(b.value.patientID,"Ever received ART"),t=await ae.getFirstObs(b.value.patientID,"Has transfer letter"),a=t?oe.toStandardHisFormat(t.obs_datetime):"";return s&&s.match(/yes/i)&&t&&"".concat(t.value_coded).match(/yes/i)&&a===o.getDate()}},selected_arvs:{label:"Last ARV drugs dispensed",init:async()=>{e.value.arv_drugs=(await O.getARVs()).map(s=>({drug:s,name:s.name,pill_brought:null,dispensed_quantity:null,dispensed_quantity_error_id:"dispensed_quantity_error_".concat(s.drug_id),pills_brought_error_id:"pills_brought_error_".concat(s.drug_id)}))},required:()=>e.value.is_transfer_in,buildObs:()=>e.value.selected_arvs.map(async s=>({...await o.buildObs("Drug received from previous facility",{value_drug:s.drug.drug_id,value_datetime:(O.setNextVisitInterval(e.value.drug_interval),O.calculateDateFromInterval()),value_numeric:s.dispensed_quantity}),child:[await o.buildObs("Number of tablets brought to clinic",{value_drug:s.drug.drug_id,value_numeric:s.pill_brought,value_datetime:e.value.date_last_received_arvs})]})),validation:()=>{const s=m("selected_arvs");let t=s;return s&&e.value.selected_arvs.forEach(a=>{u.value[a.dispensed_quantity_error_id]="",f(a.dispensed_quantity)||(u.value[a.dispensed_quantity_error_id]="A valid digit is required",t=!1),u.value[a.pills_brought_error_id]="",f(a.pill_brought)||(u.value[a.pills_brought_error_id]="A valid digit is required",t=!1)}),t}},drug_interval:{label:"Duration period for last received ARVs",required:()=>e.value.is_transfer_in,validation:()=>m("drug_interval"),options:()=>[{label:"2 weeks",value:14},{label:"1 month",value:28},{label:"2 months",value:56},{label:"3 months",value:84},{label:"4 months",value:112},{label:"5 months",value:140},{label:"6 months",value:168},{label:"7 months",value:196},{label:"8 months",value:224},{label:"9 months",value:252},{label:"10 months",value:280},{label:"11 months",value:308},{label:"12 months",value:336}]},pregnancyModel:{init:async()=>{c.isFemale()&&(e.value.patientHitMenopause=await o.patientHitMenopause(),!e.value.patientHitMenopause&&c.isChildBearing()&&(e.value.hasPregnancyObsToday=await c.hasPregnancyObsToday(),e.value.isPregnantObsStatus=await c.isPregnant(),e.value.currentlyBreastfeeding=await c.isBreastfeeding(),e.value.onPermanentFpMethods=await o.getTLObs()))},isPregnant(){return e.value.isPregnantObsStatus||e.value.is_pregnant==="Yes"},pregnancyEligible(){return c.isFemale()&&c.isChildBearing()&&!e.value.onPermanentFpMethods}},is_pregnant:{label:"Is patient pregnant?",required:()=>!e.value.hasPregnancyObsToday&&i.pregnancyModel.pregnancyEligible(),buildObs:()=>o.buildValueCoded("Is patient pregnant",e.value.is_pregnant),validation:()=>m("is_pregnant")},is_breastfeeding:{label:"Is patient breastfeeding?",required:()=>!e.value.hasPregnancyObsToday&&i.pregnancyModel.pregnancyEligible(),buildObs:()=>o.buildValueCoded("Is patient breast feeding",e.value.is_breastfeeding),validation:()=>m("is_breastfeeding")},current_fp_methods:{label:"What method are you currently on?",init:()=>{e.value.current_fp_methods=o.getFamilyPlanningMethods().map(s=>({label:s,value:s,checked:!1}))},onFormUpdate:(s,t)=>{if(s==="current_fp_methods")if(t.checked&&t.label==="NONE")e.value.current_fp_methods=e.value.current_fp_methods.map(a=>(a.label!="NONE"&&(a.checked=!1,a.disabled=!1),a));else if(t.label!="NONE"&&t.checked){t.label.match(/condom/gi)&&we("Combine with other modern methods of family planning");const a=K.findIndex(e.value.current_fp_methods,{label:"NONE"});e.value.current_fp_methods[a].checked=!1,e.value.current_fp_methods=o.familyPlanningMethods(t.label,e.value.current_fp_methods);const h=K.findIndex(e.value.current_fp_methods,{label:t.label});e.value.current_fp_methods[h].checked=!0}else e.value.current_fp_methods=e.value.current_fp_methods.map(a=>(a.disabled=!1,a))},required:()=>i.pregnancyModel.pregnancyEligible()&&!i.pregnancyModel.isPregnant()&&!e.value.patientHitMenopause,buildObs:()=>e.value.current_fp_methods.filter(s=>s.checked).map(s=>o.buildValueCoded("Family planning method",s.value)),validation:()=>{var t;const s=m("current_fp_methods");return s&&((t=e.value.current_fp_methods)!=null?t:[]).every(a=>!a.checked)?(u.value.current_fp_methods="Please select a family planning method",!1):s}},fp_methods:{label:"What method are you providing today?",init:()=>{e.value.fp_methods=o.getFamilyPlanningMethods().map(s=>({label:s,value:s,checked:!1}))},onFormUpdate:(s,t)=>{if(s==="fp_methods")if(t.checked&&t.label==="NONE")e.value.fp_methods=e.value.fp_methods.map(a=>(a.label!="NONE"&&(a.checked=!1,a.disabled=!1),a));else if(t.label!="NONE"&&t.checked){t.label.match(/condom/gi)&&we("Combine with other modern methods of family planning");const a=K.findIndex(e.value.fp_methods,{label:"NONE"});e.value.fp_methods[a].checked=!1,e.value.fp_methods=o.familyPlanningMethods(t.label,e.value.fp_methods);const h=K.findIndex(e.value.fp_methods,{label:t.label});e.value.fp_methods[h].checked=!0}else e.value.fp_methods=e.value.fp_methods.map(a=>(a.disabled=!1,a))},required:()=>i.pregnancyModel.pregnancyEligible()&&!i.pregnancyModel.isPregnant()&&!e.value.patientHitMenopause,buildObs:()=>e.value.fp_methods.filter(s=>s.checked).map(s=>o.buildValueCoded("Family planning, action to take",s.value)),validation:()=>{var t;const s=m("fp_methods");return s&&((t=e.value.fp_methods)!=null?t:[]).every(a=>!a.checked)?(u.value.fp_methods="Please select a family planning method",!1):s}},reason_for_no_fpm:{label:"Main reason for not using family planning methods",validation:()=>m("reason_for_no_fpm"),required:()=>{const s=i.fp_methods.required(),t=i.current_fp_methods.required(),a=h=>(h!=null?h:[]).some(R=>R.checked&&/none/i.test(R.value));return s&&t?a(e.value.fp_methods)&&a(e.value.current_fp_methods):!1},buildObs:()=>o.buildValueText("Why does the woman not use birth control",e.value.reason_for_no_fpm),options:()=>["Not Sexually active","Patient want to get pregnant","Not needed for medical reasons","At risk of unplanned pregnancy","Menopause"].map(s=>({label:s,value:s}))},specific_reason_for_no_fpm:{label:"Specific reason for not using family planning methods",validation:()=>m("specific_reason_for_no_fpm"),required:()=>i.reason_for_no_fpm.required()&&e.value.reason_for_no_fpm==="At risk of unplanned pregnancy",buildObs:()=>o.buildValueText("Reason for not using contraceptives",e.value.specific_reason_for_no_fpm),options:()=>["Following wishes of spouse","Religious reasons","Afraid of side effects","Never though about it","Indifferent (does not mind getting pregnant)"].map(s=>({label:s,value:s}))},offer_contraceptives:{label:"Offer contraceptives?",required:()=>i.reason_for_no_fpm.required()&&e.value.reason_for_no_fpm==="At risk of unplanned pregnancy",buildObs:()=>o.buildValueCoded("Family planning, action to take",e.value.offer_contraceptives),validation:()=>m("offer_contraceptives"),options:()=>[{label:"Accepted",value:"Yes"},{label:"Declined",value:"No"},{label:"Discuss with spouse",value:"Discuss with spouse"}]},offered_intervention:{label:"Offered intervention",init:()=>{e.value.offered_intervention=o.getFamilyPlanningMethods().map(s=>({label:s,value:s,checked:!1,disabled:/none/i.test(s)}))},required:()=>i.offer_contraceptives.required()&&e.value.offer_contraceptives==="Yes",buildObs:()=>e.value.offered_intervention.filter(s=>s.checked).map(s=>o.buildValueCoded(s.label,s.value)),validation:()=>{var t;const s=i.offered_intervention.required();return s&&((t=e.value.offered_intervention)!=null?t:[]).every(a=>!a.checked)?(u.value.offered_intervention="Please select an offered intervention",!1):s}},cxcaModel:{init:async()=>{if(!c.isFemale()||(e.value.cxcaEnabled=await be.cervicalCancerScreeningEnabled(),!e.value.cxcaEnabled))return;const{start:s,end:t}=await be.cervicalCancerScreeningAgeBounds();e.value.CxCaMaxAge=t,e.value.CxCaStartAge=s,e.value.DueForCxCa=await o.clientDueForCxCa(),e.value.clientHadAHysterectomy=await o.clientHasHadAHysterectomy();try{e.value.CxCaAppointDate=await c.nextAppointment(24)}catch(a){e.value.CxCaAppointDate=null}},isDueForAppointment(){return e.value.CxCaAppointDate?30>oe.dateDiffInDays(e.value.CxCaAppointDate,o.date):!1},canScreenCxCa(){const s=c.getAge();return c.isFemale()&&e.value.DueForCxCa&&e.value.cxcaEnabled&&s>=parseInt(e.value.CxCaStartAge)&&s<=parseInt(e.value.CxCaMaxAge)&&!e.value.clientHadAHysterectomy}},offer_cxca:{label:"Refer client for CxCa screening",required:()=>i.cxcaModel.canScreenCxCa()&&!i.pregnancyModel.isPregnant(),buildObs:()=>o.buildValueCoded("Offer CxCa",e.value.offer_cxca),validation:()=>m("offer_cxca")},reason_for_no_cxca:{label:"Reason for NOT offering CxCa",required:()=>i.offer_cxca.required()&&e.value.offer_cxca==="No",buildObs:()=>o.buildValueCoded("Reason for NOT offering CxCa",e.value.reason_for_no_cxca),validation:()=>m("reason_for_no_cxca"),options:()=>G.getConceptsByCategory("reason_for_no_cxca").map(s=>({label:s.name,value:s.name,other:{c:s}}))},previous_cxca_test_date:{label:"Previous CxCa test",required:()=>i.reason_for_no_cxca.required()&&e.value.reason_for_no_cxca==="Not due for screening",buildObs:()=>o.buildValueDate("CxCa test date",e.value.previous_cxca_test_date),validation:()=>{const s=m("previous_cxca_test_date");return s&&(A(e.value.previous_cxca_test_date).isBefore(A(c.getBirthdate()))?(u.value.previous_cxca_test_date="Date cannot be before Patient birthdate",!1):A(e.value.previous_cxca_test_date).isAfter(A(o.date))?(u.value.previous_cxca_test_date="Date cannot be in the future",!1):!0)}},side_effects:{required:()=>!0,label:"Contraindications / Side effects (select either 'Yes' or 'No')",init:async()=>{e.value.side_effects=G.getConceptsByCategory("contraindication",!0).map(t=>({id:"side_effect_".concat(t.name),concept_id:t.concept_id,label:t.name,value:"",contraIndication:{}})),e.value.side_effects=[...e.value.side_effects,{id:"side_effect_other",concept_id:0,label:"Other",value:""}];const s=await o.getDrugSideEffects();return e.value.prevSideEffectsRows=Object.keys(s).map(t=>Object.values(s[t]).filter(a=>!K.isEmpty(a.name)).map(a=>({date:t,condition:a.name,drug_induced:a.drug_induced?"Yes":"No",drug:a.drug_induced?a.drug:""})).reduce((a,h)=>a.concat(h),[])).flat(1),!0},buildObs:()=>{const s=e.value.side_effects.map(async a=>({...await o.buildValueCoded("Malawi ART side effects",a.label),child:[await o.buildValueCoded(a.label,a.value)]})),t=e.value.side_effects.filter(a=>{var h;return(h=a.contraIndication)==null?void 0:h.obs}).map(a=>a.contraIndication.obs);return[...s,...t]},onFormUpdate:(s,t)=>{s==="side_effects"&&t.value==="Yes"&&"contraIndication"in t.option&&J.show(Te,{contraIndicationConceptName:t.option.label,onReason:a=>{e.value.side_effects=e.value.side_effects.map(h=>(t.option.label===h.label&&(h.contraIndication=a),h)),J.hide()}}),s==="side_effects"&&t.value==="No"&&"contraIndication"in t.option&&(e.value.side_effects=e.value.side_effects.map(a=>(t.option.label===a.label&&(a.contraIndication={}),a)))},validation:()=>{if(m("side_effects")){let s=!0;return e.value.side_effects.forEach(t=>{u.value[t.id]="",t.value||(u.value[t.id]="Please select a value",s=!1)}),s}return!1}},other_side_effects:{label:"Other Contraindications / Side effects (select either 'Yes' or 'No')",init:async()=>{e.value.other_side_effects=G.getConceptsByCategory("side_effect",!0).map(s=>({id:"other_side_effect_".concat(s.name),concept_id:s.concept_id,label:s.name,value:"",contraIndication:{}})),e.value.other_side_effects=[...e.value.other_side_effects,{id:"other_side_effect_other",concept_id:0,label:"Other (Specify)",value:""}]},required:()=>i.side_effects.required()&&e.value.side_effects.some(s=>s.label==="Other"&&s.value==="Yes"),onFormUpdate:(s,t)=>{s==="other_side_effects"&&/malnutrition/i.test(t.label)&&t.value==="No"&&e.value.lostTenPercentBodyWeight&&i.weightModel.showWeightlossConfirmation().then(a=>{e.value.other_side_effects=e.value.other_side_effects.map(h=>(t.label===h.label&&(h.value=a),h))}),s==="other_side_effects"&&t.value==="Yes"&&"contraIndication"in t&&J.show(Te,{contraIndicationConceptName:t.label,onReason:a=>{e.value.other_side_effects=e.value.other_side_effects.map(h=>(t.label===h.label&&(h.contraIndication=a),h)),J.hide()}}),s==="other_side_effects"&&t.value==="No"&&"contraIndication"in t&&(e.value.other_side_effects=e.value.other_side_effects.map(a=>(t.label===a.label&&(a.contraIndication={}),a)))},buildObs:()=>{const s=e.value.other_side_effects.filter(a=>a.label!="Other (Specify)").map(async a=>({...await o.buildValueCoded("Other side effect",a.label),child:[await o.buildValueCoded(a.label,a.value)]})),t=e.value.other_side_effects.filter(a=>{var h;return(h=a.contraIndication)==null?void 0:h.obs}).map(a=>a.contraIndication.obs);return[...s,...t]},validation:()=>{const s=m("other_side_effects");if(s){let t=!0;return e.value.other_side_effects.forEach(a=>{u.value[a.id]="",a.value||(u.value[a.id]="Please select a value",t=!1)}),t}return s}},other_side_effect_specify:{label:"Other Contraindications / Side effects (specify)",required:()=>{var s;return i.other_side_effects.required()&&((s=e.value.other_side_effects)!=null?s:[]).some(t=>t.label==="Other (Specify)"&&t.value==="Yes")},buildObs:async()=>({...await o.buildValueCoded("Other side effect","Other (Specify)"),child:[await o.buildValueText("Other (Specify)",e.value.other_side_effect_specify)]}),validation:()=>m("other_side_effect_specify")},on_tb_treatment:{label:"On TB treatment?",required:()=>!0,buildObs:()=>o.buildValueCoded("TB treatment",e.value.on_tb_treatment),validation:()=>m("on_tb_treatment")},tb_date_started_treatment_known:{label:"Is Date started treatment known?",init:async()=>{e.value.hasTbTreatmentDate=!1;const s=await ae.getFirstValueDatetime(b.value.patientID,"TB treatment start date"),t=await ae.getFirstValueNumber(b.value.patientID,"TB treatment period");if(t&&s){const a=A(o.date).diff(s,"months");e.value.hasTbTreatmentDate=a<=t}},required:()=>i.on_tb_treatment.required()&&!e.value.hasTbTreatmentDate&&e.value.on_tb_treatment==="Yes",validation:()=>m("tb_date_started_treatment_known")},tb_start_date:{label:"Enter start date for treatment?",required:()=>i.on_tb_treatment.required()&&i.tb_date_started_treatment_known.required()&&e.value.on_tb_treatment==="Yes"&&e.value.tb_date_started_treatment_known==="Yes",buildObs:()=>o.buildValueDate("TB treatment start date",e.value.tb_start_date),validation:()=>{const s=m("tb_start_date");return s&&(A(e.value.tb_start_date).isBefore(A(c.getBirthdate()))?(u.value.tb_start_date="Date cannot be before Patient birthdate",!1):A(e.value.tb_start_date).isAfter(A(o.date))?(u.value.tb_start_date="Date cannot be in the future",!1):!0)}},tb_treatment_period:{label:"Enter Full TB Treatment Period (In Months)",required:()=>i.on_tb_treatment.required()&&i.tb_date_started_treatment_known.required()&&e.value.on_tb_treatment==="Yes"&&e.value.tb_date_started_treatment_known==="Yes",buildObs:()=>o.buildValueNumber("TB treatment period",e.value.tb_treatment_period),validation:()=>{const s=m("tb_treatment_period");return s&&(/^d+$/i.test(e.value.tb_treatment_period)?(u.value.tb_treatment_period="Treatment period must be a number",!1):Number(e.value.tb_treatment_period)<3?(u.value.tb_treatment_period="Treatment period cannot be less than 3 months",!1):Number(e.value.tb_treatment_period)>9?(u.value.tb_treatment_period="Treatment period cannot be greater than 9 months",!1):!0)}},tb_side_effects:{label:"TB Associated symptoms",required:()=>i.on_tb_treatment.required()&&"".concat(e.value.on_tb_treatment).match(/no/i),init:async()=>{const s=G.getConceptsByCategory("tb_symptom",!0).map(t=>t.name);e.value.tb_side_effects=s.map(t=>({id:"tb_side_effect_".concat(t),label:t,value:""}))},onFormUpdate:(s,t)=>{s==="tb_side_effects"&&/malnutrition/i.test(t.label)&&t.value==="No"&&e.value.lostTenPercentBodyWeight&&i.weightModel.showWeightlossConfirmation().then(a=>{e.value.tb_side_effects=e.value.tb_side_effects.map(h=>(t.label===h.label&&(h.value=a),h))})},buildObs:()=>e.value.tb_side_effects.map(async s=>({...await o.buildValueCoded("Routine TB Screening",s.label),child:[await o.buildValueCoded(s.label,s.value)]})),hasTbSymptoms:()=>e.value.tb_side_effects.some(s=>s.value==="Yes"),validation:()=>{if(m("tb_side_effects")){let s=!0;return e.value.tb_side_effects.forEach(t=>{u.value[t.id]="",t.value||(u.value[t.id]="Please select a value",s=!1)}),s}return!1}},chestXrayScreeningDone:{label:"Chest X-ray",required:()=>i.on_tb_treatment.required()&&"".concat(e.value.on_tb_treatment).match(/no/i),validation:()=>m("chestXrayScreeningDone")},molecularScreeningDone:{label:"Molecular Screening",required:()=>i.on_tb_treatment.required()&&e.value.on_tb_treatment&&"".concat(e.value.on_tb_treatment).match(/no/i),validation:()=>m("molecularScreeningDone")},chestXrayScreeningResult:{label:"Chest X-ray Screening Result",required:()=>i.chestXrayScreeningDone.required()&&e.value.chestXrayScreeningDone==="Yes",buildObs:async()=>({...await o.buildValueCoded("TB screening method used","chest x-ray"),child:[await o.buildValueCoded("chest x-ray",e.value.chestXrayScreeningResult)]}),validation:()=>m("chestXrayScreeningResult"),option:()=>[{label:"Abnormal",value:"Positive"},{label:"Normal",value:"Negative"}]},molecularScreeningResult:{label:"Molecular Screening Result",required:()=>i.molecularScreeningDone.required()&&e.value.molecularScreeningDone==="Yes",validation:()=>m("molecularScreeningResult"),buildObs:async()=>({...await o.buildValueCoded("TB screening method used","Molecular WHO Recommended Rapid Diagnostic test"),child:[await o.buildValueCoded("Molecular WHO Recommended Rapid Diagnostic test",e.value.molecularScreeningResult)]}),option:()=>[{label:"Positive",value:"Positive"},{label:"Negative",value:"Negative"}]},tbStatusValueModel:{required:()=>!0,buildObs:()=>i.on_tb_treatment.required()&&e.value.on_tb_treatment==="Yes"?o.buildValueCoded("TB Status","Confirmed TB on treatment"):i.tb_status.required()?o.buildValueCoded("TB Status",e.value.tb_status):i.tbScreeningTestResultModel.required()?i.tbScreeningTestResultModel.positiveViaRapidTest()?o.buildValueCoded("TB Status","TB Suspected"):o.buildValueCoded("TB Status","TB NOT suspected"):i.tb_side_effects.required()&&!i.tb_side_effects.hasTbSymptoms()?o.buildValueCoded("TB Status","TB NOT suspected"):{}},tbScreeningTestResultModel:{required:()=>i.chestXrayScreeningResult.required()||i.molecularScreeningResult.required(),positiveViaRapidTest:()=>{const s=i.molecularScreeningResult.required(),t=i.chestXrayScreeningResult.required();if(s||t){if(s&&e.value.molecularScreeningResult==="Negative")return!1;if(t&&e.value.chestXrayScreeningResult==="Positive"||s&&e.value.molecularScreeningResult==="Positive")return!0}return!1}},tb_status:{label:"TB Status",required:()=>!!(i.tbScreeningTestResultModel.required()&&i.tbScreeningTestResultModel.positiveViaRapidTest()||i.tb_side_effects.required()&&i.tb_side_effects.hasTbSymptoms()),onFormUpdate:(s,t)=>{s==="tb_status"&&/Yes|TB Suspected/i.test(t)&&!e.value.tbTestOrderedForSuspectCase&&Oe("Lab Order","The patient is a TB suspect. A lab order is required","Do you want to order test now?",[{name:"Cancel",slot:"start",color:"success"},{name:"Order Lab",slot:"end",color:"success"}]).then(a=>{a==="Order Lab"&&J.show(Pe,{patientID:b.value.patientID,testFilters:["TB Microscopic Exam","GeneXpert","Culture & Sensitivity","TB Tests"],onNewOrder:()=>{e.value.tbTestOrderedForSuspectCase=!0,e.value.labKey++,_e("Lab order created successfully")}})})},validation:()=>m("tb_status"),option:()=>[{label:"TB NOT suspected",value:"TB NOT suspected"},{label:"TB Suspected",value:"TB Suspected"},{label:"Confirmed TB Not on treatment",value:"Confirmed TB Not on treatment"}]},routine_tb_therapy:{label:"TB preventive therapy (TPT) history",init:async()=>{e.value.hasTbHistoryObs=!!await o.hasTreatmentHistoryObs()},required:()=>!e.value.hasTbHistoryObs,buildObs:()=>o.buildValueText("Previous TB treatment history",e.value.routine_tb_therapy),validation:()=>m("routine_tb_therapy"),onFormUpdate:(s,t)=>{s==="on_tb_treatment"&&t==="Yes"&&(e.value.routine_tb_therapy="")},option:()=>{let s=[];return/no/i.test(e.value.on_tb_treatment)&&(s=["Currently on IPT","Currently on 3HP (RFP + INH)","Currently on INH 300 / RFP 300 (3HP)"]),s=s.concat(["Complete course of 3HP in the past (3 months RFP+INH)","Complete course of IPT in the past (min. 6 months of INH)","Aborted course of 3HP (RFP + INH) in the past","Aborted course of INH 300 / RFP 300 (3HP) in the past","Aborted course of IPT in the past","Never taken IPT or 3HP"]),s.map(t=>({label:t,value:t}))}},refer_to_clinician:{label:"Refer to clinician",required:()=>nt.isNurse(),buildObs:()=>o.buildValueCoded("Refer to clinician",e.value.refer_to_clinician),validation:()=>m("refer_to_clinician")},dateStartedTpt:{label:"Date started TPT treatment",required:()=>i.routine_tb_therapy.required()&&"".concat(e.value.routine_tb_therapy).match(/currently/i),validation:()=>m("dateStartedTpt")?A(e.value.dateStartedTpt).isAfter(A(ge.getSessionDate()))?(u.value.dateStartedTpt="Date cannot be in the future",!1):A(e.value.dateStartedTpt).isBefore(A(c.getBirthdate()))?(u.value.dateStartedTpt="Date cannot be before birthdate",!1):!0:!1},transferFacility:{label:"Facility TPT last received from",required:()=>i.routine_tb_therapy.required()&&"".concat(e.value.routine_tb_therapy).match(/currently/i),buildObs:()=>o.buildValueText("Location TPT last received",e.value.transferFacility),validation:()=>m("transferFacility")},tptDrugQuantities:{label:"TPT Drug Quantities",required:()=>i.routine_tb_therapy.required()&&"".concat(e.value.routine_tb_therapy).match(/currently/i),onFormUpdate:async(s,t)=>{if(s==="routine_tb_therapy"&&t.match(/currently/i)){const a=(()=>{const R=[],Q=e.value.routine_tb_therapy;return Q.match(/ipt/i)?R.push("INH or H (Isoniazid 300mg tablet)"):Q.includes("3HP (RFP + INH)")?(R.push("INH or H (Isoniazid 300mg tablet)"),R.push("Rifapentine (150mg)")):Q.includes("INH 300 / RFP 300 (3HP)")&&R.push("INH 300 / RFP 300 (3HP)"),R})();K.isEmpty(e.value.regimens)&&(e.value.regimens=await st.getCustomIngridients());const h=e.value.regimens.filter(R=>a.includes(R.name));e.value.tptDrugQuantities=ot(h.map(R=>({drug:R,name:R.name,quantity:null})),"name")}},buildObs:()=>e.value.tptDrugQuantities.map(s=>o.buildObs("TPT Drugs Received",{value_drug:s.drug.drug_id,value_datetime:e.value.dateStartedTpt,value_numeric:s.quantity})),validation:()=>{if(m("tptDrugQuantities"))return e.value.tptDrugQuantities.every(t=>{var a;return((a=t.quantity)!=null?a:0)>0})?!0:(u.value.tptDrugQuantities="Please enter quantities for all drugs",!1)}}},f=s=>/^\d+$/i.test("".concat(s));function x(s){s.srcElement.tagName==="ION-ACCORDION-GROUP"&&(q.value=s.detail.value)}async function k(){e.value.canSubmit=!1,await Promise.all(Object.keys(i).filter(s=>typeof i[s].init=="function").map(s=>i[s].init())),e.value.canSubmit=!0}function $(s){return u.value[s]="",typeof i[s].validation=="function"?i[s].validation():!0}function B(){return Object.keys(i).reduce((s,t)=>{if(t in i&&typeof i[t].required=="function"&&i[t].required()&&typeof i[t].buildObs=="function"){const a=i[t].buildObs();return Array.isArray(a)?[...s,...a]:[...s,a]}return s},[])}function m(s){u.value[s]="";const t=i[s],a=typeof(t==null?void 0:t.required)=="function"?t.required():!1,h=typeof e.value[s]=="object"?K.isEmpty(e.value[s]):Array.isArray(e.value[s])?e.value[s].length===0:"".concat(e.value[s]).length===0;return a&&h?(u.value[s]="This field is required",!1):a}function N(){const s=Object.keys(i).filter(t=>typeof i[t].onSubmit=="function").map(t=>i[t].onSubmit&&i[t].onSubmit());return Promise.all(s)}function w(s,t){$(s),Object.keys(i).forEach(a=>{var h;return((h=i[a])==null?void 0:h.onFormUpdate)&&i[a].onFormUpdate(s,t)})}function Ve(){let s=!0;return Object.keys(i).forEach(t=>{typeof i[t].required=="function"&&i[t].required()&&!$(t)&&(s=!1)}),s}async function Re(){if(!e.value.canSubmit)return ne("Please wait for all data to load before submitting"),!1;if(e.value.isNonePatientVisit)return i.isNonePatientVisit.onSubmit();if(!Ve())return ne("Please review form for errors"),!1;try{if(await N(),!Ve())return ne("Please review form for errors"),!1;const s=(await Promise.all(B())).filter(t=>!K.isEmpty(t));return await o.createEncounter(),await o.saveObservationList(s),_e("Consultation data saved successfully"),!0}catch(s){return console.error(s),de("Error has occured while saving observations"),!1}}return me(()=>k()),T({onSubmit:Re}),(s,t)=>(d(),D(Y,null,[e.value.isNonePatientVisit?g("",!0):(d(),D("div",Xt,[n(kt,{patientID:Number(l(b).patientID)},null,8,["patientID"])])),e.value.isNonePatientVisit?(d(),p(l(H),{key:1,style:{height:"40vh"}},{default:r(()=>[n(l(E),null,{default:r(()=>t[56]||(t[56]=[_("div",{style:{"margin-top":"10%"},class:"ion-text-center"},[_("h1",null,[v("Consultation is not required for a "),_("b",null,"Guardian only"),v(" visit or "),_("b",null,"Emergency Supply Clients"),v(". ")]),_("h1",{class:"ion-padding"},[v("Press the "),_("span",{style:{color:"green","font-weight":"bold"}},"Save / Finish "),v("button to continue")])],-1)])),_:1,__:[56]})]),_:1})):(d(),p(l(Ze),{key:2,value:q.value,onIonChange:x},{default:r(()=>[n(l(X),{value:"labInvestigationForm"},{default:r(()=>[n(l(F),{slot:"header",color:"light"},{default:r(()=>[n(l(P),{class:"previousLabel"},{default:r(()=>t[57]||(t[57]=[v("Lab investigations")])),_:1,__:[57]})]),_:1}),n(l(H),{class:"ion-padding",slot:"content"},{default:r(()=>[n(l(E),null,{default:r(()=>[(d(),p(Et,{key:e.value.labKey,patientID:Number(l(b).patientID)},null,8,["patientID"]))]),_:1})]),_:1})]),_:1}),n(l(X),{value:"weightChart"},{default:r(()=>[n(l(F),{slot:"header",color:"light"},{default:r(()=>[n(l(P),{class:"previousLabel"},{default:r(()=>t[58]||(t[58]=[v("Weight Chart")])),_:1,__:[58]})]),_:1}),n(l(H),{class:"ion-padding",slot:"content"},{default:r(()=>[n(l(E),null,{default:r(()=>[n(Lt)]),_:1})]),_:1})]),_:1}),e.value.is_transfer_in?(d(),p(l(X),{key:0,value:"medicalTranserForm","toggle-icon-slot":"start"},{default:r(()=>[n(l(F),{slot:"header",color:"light"},{default:r(()=>[n(l(P),{class:"previousLabel"},{default:r(()=>t[59]||(t[59]=[v("Medication transfer-in")])),_:1,__:[59]})]),_:1}),n(l(H),{class:"ion-padding",slot:"content"},{default:r(()=>[n(l(E),null,{default:r(()=>[n(l(L),null,{default:r(()=>[n(l(I),null,{default:r(()=>[n(l(S),null,{default:r(()=>[n(ce,{required:"",label:i.date_last_received_arvs.label,"error-message":u.value.date_last_received_arvs,onOnChange:t[0]||(t[0]=a=>w("date_last_received_arvs",a.value.standardDate)),modelValue:e.value.date_last_received_arvs,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value.date_last_received_arvs=a)},null,8,["label","error-message","modelValue"])]),_:1})]),_:1}),n(l(I),null,{default:r(()=>[n(l(S),null,{default:r(()=>[n(xe,{required:"",multiple:"",label:i.selected_arvs.label,"error-message":u.value.selected_arvs,options:e.value.arv_drugs,modelValue:e.value.selected_arvs,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.selected_arvs=a),onOnChange:t[3]||(t[3]=a=>w("selected_arvs",a))},null,8,["label","error-message","options","modelValue"])]),_:1}),n(l(S),null,{default:r(()=>[n(xe,{required:"",label:i.drug_interval.label,"error-message":u.value.drug_interval,options:i.drug_interval.options(),modelValue:e.value.drug_interval,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.drug_interval=a),onOnChange:t[5]||(t[5]=a=>w("drug_interval",a))},null,8,["label","error-message","options","modelValue"])]),_:1})]),_:1}),e.value.selected_arvs.length?(d(),p(l(I),{key:0},{default:r(()=>[n(l(S),null,{default:r(()=>[(d(!0),D(Y,null,j(e.value.selected_arvs,a=>(d(),p(l(L),{key:a.drug.drug_id},{default:r(()=>[n(l(I),null,{default:r(()=>[n(l(S),null,{default:r(()=>[n(l(P),{class:"form-label"},{default:r(()=>[v(V(a.name)+" ",1),t[60]||(t[60]=_("span",{style:{color:"red"}},"*",-1))]),_:2,__:[60]},1024)]),_:2},1024)]),_:2},1024),n(l(I),null,{default:r(()=>[n(l(S),null,{default:r(()=>[n(se,{required:"",label:"Given Amount",modelValue:a.dispensed_quantity,"onUpdate:modelValue":h=>a.dispensed_quantity=h,"error-message":u.value[a.dispensed_quantity_error_id],options:e.value.arv_drugs,onOnChange:t[6]||(t[6]=h=>w("selected_arvs",h))},null,8,["modelValue","onUpdate:modelValue","error-message","options"])]),_:2},1024),n(l(S),null,{default:r(()=>[n(se,{required:"",label:"Pill brought",modelValue:a.pill_brought,"onUpdate:modelValue":h=>a.pill_brought=h,"error-message":u.value[a.pills_brought_error_id],options:e.value.arv_drugs,onOnChange:t[7]||(t[7]=h=>w("selected_arvs",h))},null,8,["modelValue","onUpdate:modelValue","error-message","options"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),i.is_pregnant.required()||i.is_breastfeeding.required()?(d(),p(l(X),{key:1,value:"pregnancyForm"},{default:r(()=>[n(l(F),{slot:"header",color:"light"},{default:r(()=>[n(l(P),{class:"previousLabel"},{default:r(()=>t[61]||(t[61]=[v("Pregnancy and Breastfeeding")])),_:1,__:[61]})]),_:1}),n(l(H),{class:"ion-padding",slot:"content"},{default:r(()=>[n(l(E),null,{default:r(()=>[n(l(L),null,{default:r(()=>[n(l(I),null,{default:r(()=>[i.is_pregnant.required()?(d(),p(l(S),{key:0},{default:r(()=>[n(z,{required:"",label:"Pregnant?",modelValue:e.value.is_pregnant,"onUpdate:modelValue":t[8]||(t[8]=a=>e.value.is_pregnant=a),onOnChange:t[9]||(t[9]=a=>w("is_pregnant",a)),"error-message":u.value.is_pregnant},null,8,["modelValue","error-message"])]),_:1})):g("",!0),i.is_breastfeeding.required()?(d(),p(l(S),{key:1},{default:r(()=>[n(z,{required:"",label:"Breastfeeding?",modelValue:e.value.is_breastfeeding,"onUpdate:modelValue":t[10]||(t[10]=a=>e.value.is_breastfeeding=a),onOnChange:t[11]||(t[11]=a=>w("is_breastfeeding",a)),"error-message":u.value.is_breastfeeding},null,8,["modelValue","error-message"])]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),i.current_fp_methods.required()||e.value.onPermanentFpMethods?(d(),p(l(X),{key:2,value:"familyPlanningForm"},{default:r(()=>[n(l(F),{slot:"header",color:"light"},{default:r(()=>[n(l(P),{class:"previousLabel"},{default:r(()=>t[62]||(t[62]=[v("Family Planning")])),_:1,__:[62]})]),_:1}),n(l(H),{class:"ion-padding",slot:"content"},{default:r(()=>[n(l(E),null,{default:r(()=>[e.value.onPermanentFpMethods?(d(),D("div",zt,t[63]||(t[63]=[_("h1",{class:"ion-text-center"}," Patient is on Tubal ligation method ",-1)]))):g("",!0),n(l(L),null,{default:r(()=>[i.current_fp_methods.required()||i.fp_methods.required()?(d(),p(l(I),{key:0},{default:r(()=>[i.current_fp_methods.required()?(d(),p(l(S),{key:0},{default:r(()=>[n(ve,{required:"",label:i.current_fp_methods.label,modelValue:e.value.current_fp_methods,"onUpdate:modelValue":t[12]||(t[12]=a=>e.value.current_fp_methods=a),onOnChange:t[13]||(t[13]=a=>w("current_fp_methods",a)),"error-message":u.value.current_fp_methods},null,8,["label","modelValue","error-message"])]),_:1})):g("",!0),i.fp_methods.required()?(d(),p(l(S),{key:1},{default:r(()=>[n(ve,{required:"",label:i.fp_methods.label,modelValue:e.value.fp_methods,"onUpdate:modelValue":t[14]||(t[14]=a=>e.value.fp_methods=a),onOnChange:t[15]||(t[15]=a=>w("fp_methods",a)),"error-message":u.value.fp_methods},null,8,["label","modelValue","error-message"])]),_:1})):g("",!0)]),_:1})):g("",!0),i.reason_for_no_fpm.required()?(d(),p(l(I),{key:1},{default:r(()=>[n(l(S),null,{default:r(()=>[n(W,{required:"",label:i.reason_for_no_fpm.label,modelValue:e.value.reason_for_no_fpm,"onUpdate:modelValue":t[16]||(t[16]=a=>e.value.reason_for_no_fpm=a),onOnChange:t[17]||(t[17]=a=>w("reason_for_no_fpm",a)),"error-message":u.value.reason_for_no_fpm,options:i.reason_for_no_fpm.options()},null,8,["label","modelValue","error-message","options"])]),_:1})]),_:1})):g("",!0),i.specific_reason_for_no_fpm.required()?(d(),p(l(I),{key:2},{default:r(()=>[n(l(S),null,{default:r(()=>[n(W,{required:"",label:i.specific_reason_for_no_fpm.label,modelValue:e.value.specific_reason_for_no_fpm,"onUpdate:modelValue":t[18]||(t[18]=a=>e.value.specific_reason_for_no_fpm=a),options:i.specific_reason_for_no_fpm.options(),onOnChange:t[19]||(t[19]=a=>w("specific_reason_for_no_fpm",a)),"error-message":u.value.specific_reason_for_no_fpm},null,8,["label","modelValue","options","error-message"])]),_:1})]),_:1})):g("",!0),i.offer_contraceptives.required()?(d(),p(l(I),{key:3},{default:r(()=>[n(l(S),null,{default:r(()=>[n(W,{required:"",label:i.offer_contraceptives.label,modelValue:e.value.offer_contraceptives,"onUpdate:modelValue":t[20]||(t[20]=a=>e.value.offer_contraceptives=a),onOnChange:t[21]||(t[21]=a=>w("offer_contraceptives",a)),"error-message":u.value.offer_contraceptives,options:i.offer_contraceptives.options()},null,8,["label","modelValue","error-message","options"])]),_:1})]),_:1})):g("",!0),i.offered_intervention.required()?(d(),p(l(I),{key:4},{default:r(()=>[n(l(S),null,{default:r(()=>[n(ve,{required:"",label:i.offered_intervention.label,modelValue:e.value.offered_intervention,"onUpdate:modelValue":t[22]||(t[22]=a=>e.value.offered_intervention=a),onOnChange:t[23]||(t[23]=a=>w("offered_intervention",a)),"error-message":u.value.offered_intervention},null,8,["label","modelValue","error-message"])]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),i.offer_cxca.required()||i.cxcaModel.isDueForAppointment()&&e.value.cxcaEnabled?(d(),p(l(X),{key:3,value:"cervicalCancerScreeningForm"},{default:r(()=>[n(l(F),{slot:"header",color:"light"},{default:r(()=>[n(l(P),{class:"previousLabel"},{default:r(()=>t[64]||(t[64]=[v("Cervical Cancer Screening")])),_:1,__:[64]})]),_:1}),n(l(H),{class:"ion-padding",slot:"content"},{default:r(()=>[n(l(E),null,{default:r(()=>[i.cxcaModel.isDueForAppointment()?(d(),D("div",jt,[_("h1",Qt," Patient is due for Cervical Cancer Screening on "+V(l(oe).toStandardHisDisplayFormat(e.value.CxCaAppointDate.appointment_date)),1)])):g("",!0),n(l(L),null,{default:r(()=>[i.offer_cxca.required()?(d(),p(l(I),{key:0},{default:r(()=>[n(l(S),null,{default:r(()=>[n(z,{required:"",label:i.offer_cxca.label,modelValue:e.value.offer_cxca,"onUpdate:modelValue":t[24]||(t[24]=a=>e.value.offer_cxca=a),onOnChange:t[25]||(t[25]=a=>w("offer_cxca",a)),"error-message":u.value.offer_cxca},null,8,["label","modelValue","error-message"])]),_:1})]),_:1})):g("",!0),i.reason_for_no_cxca.required()?(d(),p(l(I),{key:1},{default:r(()=>[n(l(S),null,{default:r(()=>[n(W,{required:"",label:i.reason_for_no_cxca.label,modelValue:e.value.reason_for_no_cxca,"onUpdate:modelValue":t[26]||(t[26]=a=>e.value.reason_for_no_cxca=a),onOnChange:t[27]||(t[27]=a=>w("reason_for_no_cxca",a)),"error-message":u.value.reason_for_no_cxca,options:i.reason_for_no_cxca.options()},null,8,["label","modelValue","error-message","options"])]),_:1})]),_:1})):g("",!0),i.previous_cxca_test_date.required()?(d(),p(l(I),{key:2},{default:r(()=>[n(l(S),null,{default:r(()=>[n(ce,{required:"",label:i.previous_cxca_test_date.label,modelValue:e.value.previous_cxca_test_date,"onUpdate:modelValue":t[28]||(t[28]=a=>e.value.previous_cxca_test_date=a),onOnChange:t[29]||(t[29]=a=>w("previous_cxca_test_date",a.value.standardDate)),"error-message":u.value.previous_cxca_test_date},null,8,["label","modelValue","error-message"])]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),n(l(X),{value:"sideEffectHistoryForm"},{default:r(()=>[n(l(F),{slot:"header",color:"light"},{default:r(()=>[n(l(P),{class:"previousLabel"},{default:r(()=>t[65]||(t[65]=[v("Side effects / Contraindications history")])),_:1,__:[65]})]),_:1}),n(l(H),{class:"ion-padding",slot:"content"},{default:r(()=>[n(l(E),null,{default:r(()=>[e.value.prevSideEffectsRows.length>0?(d(),D("table",Gt,[t[66]||(t[66]=_("thead",null,[_("tr",null,[_("th",null,"Date"),_("th",null,"Condition"),_("th",null,"Drug Induced"),_("th",null,"Drug")])],-1)),_("tbody",null,[(d(!0),D(Y,null,j(e.value.prevSideEffectsRows,a=>(d(),D("tr",{key:a},[_("td",null,V(a.date),1),_("td",null,V(a.condition),1),_("td",null,V(a.drug_induced?"Yes":"No"),1),_("td",null,V(a.drug),1)]))),128))])])):(d(),D("div",Kt,t[67]||(t[67]=[_("h1",{class:"ion-text-center"}," No previous side effects found ",-1)])))]),_:1})]),_:1})]),_:1}),i.side_effects.required()?(d(),p(l(X),{key:4,value:"sideEffectsForm"},{default:r(()=>[n(l(F),{slot:"header",color:"light"},{default:r(()=>[n(l(P),{class:"previousLabel"},{default:r(()=>[v(V(i.side_effects.label),1)]),_:1})]),_:1}),n(l(H),{class:"ion-padding",slot:"content"},{default:r(()=>[n(l(E),null,{default:r(()=>[n(l(L),null,{default:r(()=>[i.side_effects.required()?(d(),p(l(I),{key:0},{default:r(()=>[(d(!0),D(Y,null,j(e.value.side_effects,(a,h)=>(d(),p(l(S),{"size-md":"4","size-sm":"12",key:h},{default:r(()=>{var R,Q;return[n(z,{required:"","badge-text":(R=a.contraIndication)!=null&&R.type?"Cause: ".concat((Q=a.contraIndication)==null?void 0:Q.type):void 0,label:a.label,modelValue:a.value,"onUpdate:modelValue":te=>a.value=te,onOnChange:te=>w("side_effects",{value:te,option:a}),"error-message":u.value[a.id]},null,8,["badge-text","label","modelValue","onUpdate:modelValue","onOnChange","error-message"])]}),_:2},1024))),128))]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),i.other_side_effects.required()?(d(),p(l(X),{key:5,value:"otherSideEffectsForm"},{default:r(()=>[n(l(F),{slot:"header",color:"light"},{default:r(()=>[n(l(P),{class:"previousLabel"},{default:r(()=>[v(V(i.other_side_effects.label),1)]),_:1})]),_:1}),n(l(H),{class:"ion-padding",slot:"content"},{default:r(()=>[n(l(E),null,{default:r(()=>[n(l(L),null,{default:r(()=>[i.other_side_effects.required()?(d(),p(l(I),{key:0},{default:r(()=>[(d(!0),D(Y,null,j(e.value.other_side_effects,(a,h)=>(d(),p(l(S),{"size-md":"4","size-sm":"12",key:h},{default:r(()=>{var R,Q;return[n(z,{"badge-text":(R=a.contraIndication)!=null&&R.type?"Cause: ".concat((Q=a.contraIndication)==null?void 0:Q.type):void 0,required:"",label:a.label,modelValue:a.value,"onUpdate:modelValue":te=>a.value=te,onOnChange:te=>w("other_side_effects",{...a,value:te}),"error-message":u.value[a.id]},null,8,["badge-text","label","modelValue","onUpdate:modelValue","onOnChange","error-message"])]}),_:2},1024))),128))]),_:1})):g("",!0),i.other_side_effect_specify.required()?(d(),p(l(I),{key:1},{default:r(()=>[n(l(S),null,{default:r(()=>[n(se,{required:"",label:i.other_side_effect_specify.label,modelValue:e.value.other_side_effect_specify,"onUpdate:modelValue":t[30]||(t[30]=a=>e.value.other_side_effect_specify=a),onOnChange:t[31]||(t[31]=a=>w("other_side_effect_specify",a)),"error-message":u.value.other_side_effect_specify},null,8,["label","modelValue","error-message"])]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),i.on_tb_treatment.required()?(d(),p(l(X),{key:6,value:"tbTreatmentForm"},{default:r(()=>[n(l(F),{slot:"header",color:"light"},{default:r(()=>[n(l(P),{class:"previousLabel"},{default:r(()=>t[68]||(t[68]=[v("TB Treatment")])),_:1,__:[68]})]),_:1}),n(l(H),{class:"ion-padding",slot:"content"},{default:r(()=>[n(l(E),null,{default:r(()=>[n(l(L),null,{default:r(()=>[i.on_tb_treatment.required()?(d(),p(l(I),{key:0},{default:r(()=>[n(l(S),null,{default:r(()=>[n(z,{required:"",label:i.on_tb_treatment.label,modelValue:e.value.on_tb_treatment,"onUpdate:modelValue":t[32]||(t[32]=a=>e.value.on_tb_treatment=a),onOnChange:t[33]||(t[33]=a=>w("on_tb_treatment",a)),"error-message":u.value.on_tb_treatment},null,8,["label","modelValue","error-message"])]),_:1})]),_:1})):g("",!0),i.tb_date_started_treatment_known.required()?(d(),p(l(I),{key:1},{default:r(()=>[n(l(S),null,{default:r(()=>[n(z,{required:"",label:i.tb_date_started_treatment_known.label,modelValue:e.value.tb_date_started_treatment_known,"onUpdate:modelValue":t[34]||(t[34]=a=>e.value.tb_date_started_treatment_known=a),onOnChange:t[35]||(t[35]=a=>w("tb_date_started_treatment_known",a)),"error-message":u.value.tb_date_started_treatment_known},null,8,["label","modelValue","error-message"])]),_:1})]),_:1})):g("",!0),i.tb_start_date.required()||i.tb_treatment_period.required()?(d(),p(l(I),{key:2},{default:r(()=>[i.tb_start_date.required()?(d(),p(l(S),{key:0},{default:r(()=>[n(ce,{required:"",label:i.tb_start_date.label,modelValue:e.value.tb_start_date,"onUpdate:modelValue":t[36]||(t[36]=a=>e.value.tb_start_date=a),onOnChange:t[37]||(t[37]=a=>w("tb_start_date",a)),"error-message":u.value.tb_start_date},null,8,["label","modelValue","error-message"])]),_:1})):g("",!0),i.tb_treatment_period.required()?(d(),p(l(S),{key:1},{default:r(()=>[n(se,{required:"",label:i.tb_treatment_period.label,modelValue:e.value.tb_treatment_period,"onUpdate:modelValue":t[38]||(t[38]=a=>e.value.tb_treatment_period=a),onOnChange:t[39]||(t[39]=a=>w("tb_treatment_period",a)),"error-message":u.value.tb_treatment_period},null,8,["label","modelValue","error-message"])]),_:1})):g("",!0)]),_:1})):g("",!0),i.tb_side_effects.required()?(d(),p(l(I),{key:3},{default:r(()=>[n(l(S),{size:"12"},{default:r(()=>[n(l(F),null,{default:r(()=>[n(l(P),{style:{"font-weight":"bold","font-size":"1.3rem"}},{default:r(()=>t[69]||(t[69]=[v("TB associated symptoms")])),_:1,__:[69]})]),_:1})]),_:1}),(d(!0),D(Y,null,j(e.value.tb_side_effects,(a,h)=>(d(),p(l(S),{"size-md":"6","size-sm":"12",key:h},{default:r(()=>[n(z,{required:"",label:a.label,modelValue:a.value,"onUpdate:modelValue":R=>a.value=R,onOnChange:R=>w("tb_side_effects",{...a,value:R}),"error-message":u.value[a.id]},null,8,["label","modelValue","onUpdate:modelValue","onOnChange","error-message"])]),_:2},1024))),128))]),_:1})):g("",!0),i.chestXrayScreeningDone.required()||i.molecularScreeningDone.required()?(d(),p(l(I),{key:4},{default:r(()=>[n(l(S),{size:"12"},{default:r(()=>[n(l(F),null,{default:r(()=>[n(l(P),{style:{"font-weight":"bold","font-size":"1.3rem"}},{default:r(()=>t[70]||(t[70]=[v("TB Screening methods used")])),_:1,__:[70]})]),_:1})]),_:1}),i.chestXrayScreeningDone.required()?(d(),p(l(S),{key:0},{default:r(()=>[n(z,{required:"",label:i.chestXrayScreeningDone.label,modelValue:e.value.chestXrayScreeningDone,"onUpdate:modelValue":t[40]||(t[40]=a=>e.value.chestXrayScreeningDone=a),onOnChange:t[41]||(t[41]=a=>w("chestXrayScreeningDone",a)),"error-message":u.value.chestXrayScreeningDone},null,8,["label","modelValue","error-message"])]),_:1})):g("",!0),i.molecularScreeningDone.required()?(d(),p(l(S),{key:1},{default:r(()=>[n(z,{required:"",label:i.molecularScreeningDone.label,modelValue:e.value.molecularScreeningDone,"onUpdate:modelValue":t[42]||(t[42]=a=>e.value.molecularScreeningDone=a),onOnChange:t[43]||(t[43]=a=>w("molecularScreeningDone",a)),"error-message":u.value.molecularScreeningDone},null,8,["label","modelValue","error-message"])]),_:1})):g("",!0)]),_:1})):g("",!0),i.chestXrayScreeningResult.required()||i.molecularScreeningResult.required()?(d(),p(l(I),{key:5},{default:r(()=>[n(l(S),{size:"12"},{default:r(()=>[n(l(F),null,{default:r(()=>[n(l(P),{style:{"font-weight":"bold","font-size":"1.3rem"}},{default:r(()=>t[71]||(t[71]=[v("TB Screening results")])),_:1,__:[71]})]),_:1})]),_:1}),i.chestXrayScreeningResult.required()?(d(),p(l(S),{key:0},{default:r(()=>[n(W,{required:"",label:i.chestXrayScreeningResult.label,modelValue:e.value.chestXrayScreeningResult,"onUpdate:modelValue":t[44]||(t[44]=a=>e.value.chestXrayScreeningResult=a),onOnChange:t[45]||(t[45]=a=>w("chestXrayScreeningResult",a)),"error-message":u.value.chestXrayScreeningResult,options:i.chestXrayScreeningResult.option()},null,8,["label","modelValue","error-message","options"])]),_:1})):g("",!0),i.molecularScreeningResult.required()?(d(),p(l(S),{key:1},{default:r(()=>[n(W,{required:"",label:i.molecularScreeningResult.label,modelValue:e.value.molecularScreeningResult,"onUpdate:modelValue":t[46]||(t[46]=a=>e.value.molecularScreeningResult=a),onOnChange:t[47]||(t[47]=a=>w("molecularScreeningResult",a)),"error-message":u.value.molecularScreeningResult,options:i.molecularScreeningResult.option()},null,8,["label","modelValue","error-message","options"])]),_:1})):g("",!0)]),_:1})):g("",!0),n(l(I)),i.tb_status.required()?(d(),p(l(I),{key:6},{default:r(()=>[n(l(S),null,{default:r(()=>[n(W,{required:"",label:i.tb_status.label,modelValue:e.value.tb_status,"onUpdate:modelValue":t[48]||(t[48]=a=>e.value.tb_status=a),onOnChange:t[49]||(t[49]=a=>w("tb_status",a)),"error-message":u.value.tb_status,options:i.tb_status.option()},null,8,["label","modelValue","error-message","options"])]),_:1})]),_:1})):g("",!0)]),_:1}),n(l(L),null,{default:r(()=>[i.routine_tb_therapy.required()?(d(),p(l(I),{key:0},{default:r(()=>[n(l(S),null,{default:r(()=>[n(W,{required:"",label:i.routine_tb_therapy.label,modelValue:e.value.routine_tb_therapy,"onUpdate:modelValue":t[50]||(t[50]=a=>e.value.routine_tb_therapy=a),options:i.routine_tb_therapy.option(),onOnChange:t[51]||(t[51]=a=>w("routine_tb_therapy",a)),"error-message":u.value.routine_tb_therapy},null,8,["label","modelValue","options","error-message"])]),_:1})]),_:1})):g("",!0),i.dateStartedTpt.required()?(d(),p(l(I),{key:1},{default:r(()=>[i.dateStartedTpt.required()?(d(),p(l(S),{key:0},{default:r(()=>[n(ce,{required:"",label:i.dateStartedTpt.label,modelValue:e.value.dateStartedTpt,"onUpdate:modelValue":t[52]||(t[52]=a=>e.value.dateStartedTpt=a),onOnChange:t[53]||(t[53]=a=>w("dateStartedTpt",a)),"error-message":u.value.dateStartedTpt},null,8,["label","modelValue","error-message"])]),_:1})):g("",!0),i.transferFacility.required()?(d(),p(l(S),{key:1},{default:r(()=>[n(Nt,{required:"",label:i.transferFacility.label,modelValue:e.value.transferFacility,"onUpdate:modelValue":t[54]||(t[54]=a=>e.value.transferFacility=a),onOnChange:t[55]||(t[55]=a=>w("transferFacility",a)),"error-message":u.value.transferFacility},null,8,["label","modelValue","error-message"])]),_:1})):g("",!0)]),_:1})):g("",!0)]),_:1}),i.tptDrugQuantities.required()?(d(),p(l(L),{key:0},{default:r(()=>[n(l(I),null,{default:r(()=>[n(l(S),null,{default:r(()=>[n(l(F),null,{default:r(()=>[n(l(P),{style:{"font-weight":"bold","font-size":"1.3rem"}},{default:r(()=>t[72]||(t[72]=[v("TPT Dispensations")])),_:1,__:[72]})]),_:1})]),_:1})]),_:1}),(d(!0),D(Y,null,j(e.value.tptDrugQuantities,(a,h)=>(d(),p(l(I),{key:h},{default:r(()=>[n(l(S),null,{default:r(()=>[n(l(F),{lines:"none"},{default:r(()=>[n(l(P),null,{default:r(()=>[v(V(a.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),n(l(S),null,{default:r(()=>[n(se,{modelValue:a.quantity,"onUpdate:modelValue":R=>a.quantity=R,onOnChange:R=>w("tptDrugQuantities",{index:h,field:"quantity",value:R})},null,8,["modelValue","onUpdate:modelValue","onOnChange"])]),_:2},1024)]),_:2},1024))),128)),n(l(I),null,{default:r(()=>[n(l(S),null,{default:r(()=>[_("div",Jt,V(u.value.tptDrugQuantities),1)]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1},8,["value"]))],64))}}),ea=ee(Zt,[["__scopeId","data-v-9a76eca8"]]),_a=Object.freeze(Object.defineProperty({__proto__:null,default:ea},Symbol.toStringTag,{value:"Module"}));export{ea as A,Et as a,_a as b,ft as p};

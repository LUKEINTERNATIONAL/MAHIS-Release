System.register(["./vendor-legacy-qLaA4lfC.js","./index-legacy-Bh_KV0Am.js","./prescription_service-legacy-8EtjkBsd.js","./BasicYesNoSelect-legacy-Dpo4HUIl.js","./BasicRadioSelect-legacy-B6DIQpnb.js","./Arrays-legacy-BSC7onNe.js","./lodash-legacy-pOOc9Efu.js","./patient_type_service-legacy-F0JgV1Px.js","./app_encounter_service-legacy-DK_afvJ-.js","./SelectFacility-legacy-Dbv9Uepw.js","./patient_lab_service-legacy-oiI5gPVL.js","./apexcharts-legacy-DX-O3ogC.js"],function(e,t){"use strict";var a,l,n,r,o,i,s,d,u,c,_,f,v,p,m,b,g,h,y,C,V,x,w,S,q,O,k,D,T,P,I,N,R,F,M,B,A,U,H,E,L,Y,j,W,z,X,$,Q,G,K,J,Z,ee,te,ae,le,ne,re,oe,ie,se,de,ue,ce,_e,fe,ve,pe,me,be,ge,he,ye,Ce,Ve,xe,we,Se,qe,Oe,ke,De,Te,Pe,Ie;return{setters:[e=>{a=e.d,l=e.e,n=e.f,r=e.l,o=e.k,i=e.y,s=e.m,d=e.z,u=e.B,c=e.u,_=e.aY,f=e.A,v=e.D,p=e.d0,m=e.F,b=e.L,g=e.G,h=e.bJ,y=e.ac,C=e.a3,V=e.cu,x=e.ct,w=e.r,S=e.a,q=e.W,O=e.I,k=e.c5,D=e.O,T=e.bm,P=e.aa,I=e.ab,N=e.be,R=e.a8,F=e.bh,M=e.b2,B=e.c,A=e.w,U=e.b9,H=e.aL,E=e.cY,L=e.cX,Y=e.d4,j=e.i,W=e.v,z=e.$,X=e.dQ,$=e.dR,Q=e.dS,G=e.aZ,K=e.b0,J=e.J,Z=e.M},e=>{ee=e.b6,te=e._,ae=e.Y,le=e.a5,ne=e.t,re=e.be,oe=e.W,ie=e.s,se=e.ao,de=e.an,ue=e.j,ce=e.l,_e=e.u,fe=e.H,ve=e.S,pe=e.bf,me=e.a4,be=e.P,ge=e.U,he=e.b5,ye=e.bg},e=>{Ce=e.C,Ve=e.P,xe=e.R},e=>{we=e.B},e=>{Se=e.B},e=>{qe=e.u},e=>{Oe=e.l},e=>{ke=e.P},e=>{De=e.A},e=>{Te=e.S},e=>{Pe=e.P},e=>{Ie=e.m}],execute:function(){var t=document.createElement("style");async function Ne(e,t="action-sheet-modal"){const a=await ee("Are you sure you want to void record?","Please specify reason for voiding this record",["Mistake/ Wrong Entry","Duplicate","System Error"],[{name:"Cancel",slot:"start"},{name:"Void",color:"danger",slot:"end",role:"action"}],"",t);a.selection&&"Void"===a.action&&await e(a.selection)}t.textContent='ion-note[data-v-224c666e]{color:red;font-style:italic;font-weight:700}ion-note[data-v-b25669b7]{color:red;font-weight:700;font-style:italic}ion-note[data-v-284aefe8]{color:red;font-weight:700;font-style:italic}.info-container[data-v-4f22786e]{margin:0 auto}.info-card[data-v-4f22786e]{background:#fafafa;border:1px solid #ececec;border-radius:5px;padding:20px;margin-bottom:16px;position:relative}.close-button[data-v-4f22786e]{position:absolute;top:16px;right:16px;background:none;border:none;cursor:pointer;padding:4px;border-radius:4px;transition:color .2s ease}.close-icon[data-v-4f22786e]{width:20px;height:20px}.main-message[data-v-4f22786e]{display:flex;align-items:flex-start;margin-bottom:16px;padding-right:40px}.info-icon[data-v-4f22786e]{width:40px;height:40px;margin-right:16px;margin-top:4px;flex-shrink:0}.message-content h2[data-v-4f22786e]{color:#374151;font-size:1.3rem;font-weight:600;margin:0 0 12px}.info-list[data-v-4f22786e]{list-style:none;padding:0;margin:0}.info-list li[data-v-4f22786e]{color:#6b7280;font-size:.95rem;margin-bottom:8px;display:flex;align-items:center}.info-list li[data-v-4f22786e]:before{content:"âˆ’";color:#ececec;font-weight:700;margin-right:8px;font-size:1.2rem}.data-rows[data-v-4f22786e]{margin-top:0}.data-row[data-v-4f22786e]{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #ececec}.data-row[data-v-4f22786e]:last-child{border-bottom:none}.data-label[data-v-4f22786e]{color:#374151;font-weight:500;display:flex;align-items:center}.data-icon[data-v-4f22786e]{width:16px;height:16px;margin-right:8px}.data-value[data-v-4f22786e]{color:#111827;font-weight:600}.months-value[data-v-4f22786e]{color:#ef4444;font-size:1.2rem;font-weight:700}.na-value[data-v-4f22786e]{color:#6b7280;font-style:italic}.learn-more-section[data-v-4f22786e]{margin-top:16px}ion-note[data-v-f7a4b4f8]{color:red;font-weight:700;font-style:italic}.modern-table[data-v-1287381f]{width:100%;border-collapse:separate;border-spacing:0;border:1px solid #ddd;border-radius:8px;overflow:hidden;box-shadow:0 4px 6px rgba(0,0,0,.1)}.modern-table th[data-v-1287381f]{background-color:#f4f4f4;color:#333;font-weight:700;padding:12px;text-align:left;border-bottom:1px solid #ddd}.modern-table td[data-v-1287381f]{padding:12px;text-align:left;border-bottom:1px solid #ddd}.modern-table tr:last-child td[data-v-1287381f]{border-bottom:none}.modern-table tr[data-v-1287381f]:hover{background-color:#f9f9f9;transition:background-color .3s ease}ion-label[data-v-7ee51920]{font-size:1.3rem;font-weight:700}.modern-table[data-v-9a76eca8]{width:100%;border-collapse:separate;border-spacing:0;border:1px solid #ddd;border-radius:8px;overflow:hidden;box-shadow:0 4px 6px rgba(0,0,0,.1)}.modern-table th[data-v-9a76eca8]{background-color:#f4f4f4;color:#333;font-weight:700;padding:12px;text-align:left;border-bottom:1px solid #ddd}.modern-table td[data-v-9a76eca8]{padding:12px;text-align:left;border-bottom:1px solid #ddd}.modern-table tr:last-child td[data-v-9a76eca8]{border-bottom:none}.modern-table tr[data-v-9a76eca8]:hover{background-color:#f9f9f9;transition:background-color .3s ease}\n/*$vite$:1*/',document.head.appendChild(t),e("p",Ne);const Re={style:{border:"1px dotted #ccc","border-radius":"15px"},class:"ion-padding"},Fe={key:0,style:{color:"green","font-style":"italic"}},Me=a({__name:"BasicMultiSelect",props:{label:String,required:Boolean,errorMessage:String,modelValue:Object},emits:["update:modelValue","onChange"],setup(e,{emit:t}){const a=e,C=t;return(t,V)=>(n(),l("div",Re,[r(c(v),null,{default:d(()=>[o("b",null,u(e.label),1),e.required?(n(),i(c(_),{key:0,color:"danger"},{default:d(()=>V[0]||(V[0]=[f("*")])),_:1,__:[0]})):s("",!0)]),_:1}),V[1]||(V[1]=o("br",null,null,-1)),e.errorMessage?(n(),i(c(p),{key:0,color:"danger"},{default:d(()=>[f(u(e.errorMessage),1)]),_:1})):s("",!0),V[2]||(V[2]=o("p",null,null,-1)),r(c(y),null,{default:d(()=>[(n(!0),l(m,null,b(e.modelValue,(e,t)=>(n(),i(c(g),{key:t},{default:d(()=>[r(c(h),{disabled:e.disabled,checked:e.checked,slot:"start",onIonChange:t=>function(e,t){var l;const n=[...null!==(l=a.modelValue)&&void 0!==l?l:[]].map(a=>a.value===e.value?{...a,checked:t}:a),r={...e,checked:t};C("update:modelValue",n),C("onChange",r)}(e,t.detail.checked)},null,8,["disabled","checked","onIonChange"]),r(c(v),{style:{"margin-left":"10px"}},{default:d(()=>[f(u(e.label)+" ",1),e.status?(n(),l("p",Fe,u(e.status),1)):s("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1}),V[3]||(V[3]=o("p",null,null,-1)),e.errorMessage?(n(),i(c(p),{key:1,color:"danger"},{default:d(()=>[f(u(e.errorMessage),1)]),_:1})):s("",!0)]))}}),Be=te(Me,[["__scopeId","data-v-224c666e"]]),Ae={style:{border:"1px dotted #ccc","border-radius":"15px"},class:"ion-padding"},Ue=a({__name:"BasicInput",props:{label:String,modelValue:String,required:Boolean,disabled:Boolean,errorMessage:String,placeholder:String,inputType:Object,onChange:Object},emits:["update:modelValue","onChange"],setup(e,{emit:t}){const a=t;function m(e){const t=e.target.value;a("update:modelValue",t),a("onChange",t)}return(t,a)=>(n(),l("div",Ae,[r(c(v),null,{default:d(()=>[o("b",null,u(e.label),1),e.required?(n(),i(c(_),{key:0,color:"danger"},{default:d(()=>a[0]||(a[0]=[f("*")])),_:1,__:[0]})):s("",!0)]),_:1}),a[1]||(a[1]=o("p",null,null,-1)),r(c(C),{fill:"outline",value:e.modelValue,disabled:e.disabled,type:e.inputType,onIonInput:m,placeholder:e.placeholder},null,8,["value","disabled","type","placeholder"]),a[2]||(a[2]=o("p",null,null,-1)),e.errorMessage?(n(),i(c(p),{key:0,color:"danger"},{default:d(()=>[f(u(e.errorMessage),1)]),_:1})):s("",!0)]))}}),He=te(Ue,[["__scopeId","data-v-b25669b7"]]),Ee={style:{border:"1px dotted #ccc","border-radius":"15px"},class:"ion-padding"},Le={key:0,style:{color:"red"}},Ye=a({__name:"BasicSelect",props:{label:String,required:Boolean,multiple:Boolean,errorMessage:String,placeholder:String,options:Object,modelValue:Object},emits:["update:modelValue","onChange"],setup(e,{emit:t}){const a=t;return(t,_)=>{var g;return n(),l("div",Ee,[r(c(v),null,{default:d(()=>[o("b",null,u(e.label),1),e.required?(n(),l("span",Le,"*")):s("",!0)]),_:1}),r(c(x),{multiple:e.multiple,fill:"outline",onIonChange:_[0]||(_[0]=e=>{return t=e.detail.value,a("update:modelValue",t),void a("onChange",t);var t}),interface:"popover",placeholder:null!==(g=e.placeholder)&&void 0!==g?g:"Select an option"},{default:d(()=>[(n(!0),l(m,null,b(e.options,e=>(n(),i(c(V),{key:e.value,value:e},{default:d(()=>[f(u(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["multiple","placeholder"]),e.errorMessage?(n(),i(c(p),{key:0,color:"danger"},{default:d(()=>[f(u(e.errorMessage),1)]),_:1})):s("",!0)])}}}),je={style:{border:"1px dotted #ccc","border-radius":"15px"},class:"ion-padding"},We={key:0,style:{color:"red"}},ze=a({__name:"BasicDateInput",props:{label:String,modelValue:String,required:Boolean,errorMessage:String},emits:["update:modelValue","onChange"],setup(e,{emit:t}){const a=t;return(t,o)=>(n(),l("div",je,[r(c(v),{class:"form-label"},{default:d(()=>[f(u(e.label)+" ",1),e.required?(n(),l("span",We,"*")):s("",!0)]),_:1}),r(ae,{place_holder:"",date_prop:"",onDateUpDated:o[0]||(o[0]=e=>{var t;t=e.value.standardDate,a("update:modelValue",t),a("onChange",t)}),error:!1}),e.errorMessage?(n(),i(c(p),{key:0,color:"danger"},{default:d(()=>[f(u(e.errorMessage),1)]),_:1})):s("",!0)]))}}),Xe=te(ze,[["__scopeId","data-v-284aefe8"]]);class $e extends De{constructor(e,t){super(e,13,t)}async buildDefferedOrder(e){return[{concept_id:await De.getConceptID("HIV viral load"),value_text:"Wait till next milestone",value_coded:await De.getConceptID("Delayed milestones"),value_numeric:e}]}}const Qe={key:0},Ge={key:0,class:"info-container"},Ke={class:"info-card"},Je={class:"main-message"},Ze={class:"message-content"},et={class:"info-list"},tt=te(a({__name:"vl-info-alert",props:{patientID:{}},setup(e){const t=e,a=w(!0),_=w(null),p=w(!1),m=async()=>{if(await le("Are you sure you want to wait till next milestone?")){const e=new $e(t.patientID,-1),l=await e.createEncounter(),n=await e.buildDefferedOrder(null);if(!l)return ne("Unable to create encounter");const r=await e.saveObservationList(n);a.value=!r}},b=async()=>{await le("Are you sure you want to remind me later?")&&(a.value=!1)},h=async()=>{await le("Are you sure you want to close this milestone notification?")&&(a.value=!1)},y=e=>e?D(e).format("DD MMM, YYYY"):"N/A";return S(()=>{(async()=>{try{if(p.value=await re.VLEnabled(),!p.value)return;const e=await oe.getPatientVLInfo(t.patientID);_.value=e}catch(e){console.error("Error fetching VL data:",e)}})()}),(e,t)=>{var C,V;return p.value?(n(),l("div",Qe,[a.value&&null!==(C=_.value)&&void 0!==C&&C.eligibile&&!_.value.skip_milestone?(n(),l("div",Ge,[o("div",Ke,[o("button",{class:"close-button",onClick:h,"aria-label":"Close notification"},t[0]||(t[0]=[o("svg",{class:"close-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])),o("div",Je,[t[10]||(t[10]=o("svg",{class:"info-icon",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},[o("path",{fill:"currentColor",d:"M24.586 6.586A2 2 0 0 0 23.17 6H16V2h-2v4H6a2.003 2.003 0 0 0-2 2v6a2.003 2.003 0 0 0 2 2h8v14h2V16h7.171a2 2 0 0 0 1.415-.586L29 11ZM23.17 14H6V8h17.172l3 3Z"})],-1)),o("div",Ze,[t[9]||(t[9]=o("h2",null,"VL milestone has been reached",-1)),o("ul",et,[o("li",null,[t[1]||(t[1]=f("Patient has been on ART for ")),o("b",null,u(_.value.period_on_art),1),t[2]||(t[2]=f(" months"))]),o("li",null,[t[3]||(t[3]=f("Treatment started on ")),o("b",null,u(y(_.value.earliest_start_date)),1)]),o("li",null,[t[4]||(t[4]=f("Current regimen: ")),o("b",null,u(_.value.current_regimen.name),1),t[5]||(t[5]=f(" since ")),o("b",null,u(y(_.value.current_regimen.date_started)),1)]),o("li",null,[t[6]||(t[6]=f("Last VL order date: ")),o("b",null,u(y(null===(V=_.value)||void 0===V?void 0:V.last_order_date)),1)])]),o("div",null,[r(c(q),{class:"ion-padding",onClick:m,color:"primary",fill:"outline",size:"small"},{default:d(()=>t[7]||(t[7]=[f(" Wait till next milestone ")])),_:1,__:[7]}),r(c(q),{class:"ion-padding",onClick:b,color:"primary",fill:"outline",size:"small"},{default:d(()=>t[8]||(t[8]=[f(" Remind me later ")])),_:1,__:[8]})])])])])])):(n(),i(c(g),{key:1,lines:"none"},{default:d(()=>[r(c(O),{style:{"font-size":"1.3rem"},slot:"start",size:"large",icon:c(k)},null,8,["icon"]),r(c(v),{style:{"font-size":"1.2rem"},slot:"start"},{default:d(()=>{var e;return[f(u(null===(e=_.value)||void 0===e?void 0:e.message),1)]}),_:1})]),_:1}))])):s("",!0)}}}),[["__scopeId","data-v-4f22786e"]]),at={style:{border:"1px dotted #ccc","border-radius":"15px"},class:"ion-padding"},lt=a({__name:"BasicFacilitySelector",props:{label:String,modelValue:String,required:Boolean,disabled:Boolean,errorMessage:String,onChange:Object},emits:["update:modelValue","onChange"],setup(e,{emit:t}){const a=t;return(t,m)=>(n(),l("div",at,[r(c(v),null,{default:d(()=>[o("b",null,u(e.label),1),e.required?(n(),i(c(_),{key:0,style:{color:"red"}},{default:d(()=>m[1]||(m[1]=[f("*")])),_:1,__:[1]})):s("",!0),m[2]||(m[2]=o("br",null,null,-1)),e.errorMessage?(n(),i(c(p),{key:1},{default:d(()=>[f(u(e.errorMessage),1)]),_:1})):s("",!0)]),_:1,__:[2]}),r(Te,{show_error:!1,selected_district_ids:[],selected_location:null,onFacilitySelected:m[0]||(m[0]=e=>{var t;t=e.selected_location.name,a("update:modelValue",t),a("onChange",t)})})]))}}),nt=te(lt,[["__scopeId","data-v-f7a4b4f8"]]),rt={style:{border:"1px dotted #ccc","border-radius":"15px"},class:"ion-padding"},ot={key:0,style:{color:"red"}},it=a({__name:"BasicVueSelect",props:{label:String,required:Boolean,disabled:Boolean,placeholder:String,errorMessage:String,options:Object,modelValue:Object},emits:["update:modelValue","onChange"],setup(e,{emit:t}){const a=w(null),_=t;function m(e){_("update:modelValue",e),_("onChange",e)}return(t,_)=>{var b;return n(),l("div",rt,[r(c(v),null,{default:d(()=>[o("b",null,u(e.label),1),e.required?(n(),l("span",ot,"*")):s("",!0)]),_:1}),r(c(T),{modelValue:a.value,"onUpdate:modelValue":[_[0]||(_[0]=e=>a.value=e),m],teleport:"",multiple:!1,"hide-selected":!1,"close-on-select":!0,openDirection:"auto","tag-placeholder":"",placeholder:e.placeholder,selectLabel:"",label:"label",searchable:!0,"track-by":"label",options:e.options,disabled:null!==(b=e.disabled)&&void 0!==b&&b},null,8,["modelValue","placeholder","options","disabled"]),e.errorMessage?(n(),i(c(p),{key:0,color:"danger"},{default:d(()=>[f(u(e.errorMessage),1)]),_:1})):s("",!0)])}}}),st=a({__name:"NewOrder",props:{patientID:{type:Number,required:!0},onNewOrder:{type:Object,required:!1},canOrder:{type:Object,required:!1},testFilters:{type:Object,default:()=>[]}},emits:["onNewOrder"],setup(e,{emit:t}){const a=t,l=e,o=w({test_name:null,reason_for_test:"",specimen:null}),s=w([]),u=w([]),_=w(["Routine","Targeted","Confirmatory","Stat","Repeat / Missing"]),v=w({}),p={general:["Routine","Targeted","Confirmatory","Stat","Repeat / Missing"],"HIV viral load":["Routine","Targeted","Confirmatory","Stat","Repeat / Missing","Follow up after Low Level Viremia","Follow up after High Viral Load"]};function m(e){var t,a;o.value.specimen="",t=e,_.value=null!==(a=p[t])&&void 0!==a?a:p.general,async function(e){u.value=[],v.value[e]||(v.value[e]=await se.getSpecimens(e).then(e=>e.map(e=>({label:e.name,value:e.concept_id})))),u.value=v.value[e]}(e)}async function b(){if("function"==typeof l.canOrder&&!l.canOrder(o.value))return;const e=new Pe(l.patientID);try{const t=await e.placeOrder({target_lab:Pe.getLocationName(),reason_for_test_id:de.getCachedConceptID(o.value.reason_for_test,!0),specimen:{concept_id:o.value.specimen.value},tests:[{concept_id:o.value.test_name.value}],combine_tests:!0});t?(l.onNewOrder&&l.onNewOrder(t),a("onNewOrder",t),ue("Lab investigation saved successfully"),ie.hide()):ce("Failed to save lab investigation")}catch(t){ce(`Failed to save lab investigation: ${t}`)}}return se.getTestTypes().then(e=>{s.value=e.filter(e=>0===l.testFilters.length||l.testFilters.includes(e.name)).map(e=>({label:e.name,value:e.concept_id}))}),(e,t)=>(n(),i(c(F),null,{default:d(()=>[r(c(P),null,{default:d(()=>[r(c(I),null,{default:d(()=>[r(it,{modelValue:o.value.test_name,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value.test_name=e),required:"",label:"Select Test",onOnChange:t[1]||(t[1]=e=>m(e.label)),options:s.value},null,8,["modelValue","options"])]),_:1}),r(c(I),null,{default:d(()=>[r(it,{required:"",modelValue:o.value.specimen,"onUpdate:modelValue":t[2]||(t[2]=e=>o.value.specimen=e),label:"Select Specimen",options:u.value},null,8,["modelValue","options"])]),_:1})]),_:1}),r(c(P),null,{default:d(()=>[r(c(I),null,{default:d(()=>[r(Se,{modelValue:o.value.reason_for_test,"onUpdate:modelValue":t[3]||(t[3]=e=>o.value.reason_for_test=e),required:"",label:"Reason for Test",options:_.value.map(e=>({label:e,value:e}))},null,8,["modelValue","options"])]),_:1})]),_:1}),r(c(P),null,{default:d(()=>[r(c(I),null,{default:d(()=>[r(c(q),{disabled:!o.value.test_name||!o.value.specimen||!o.value.reason_for_test,onClick:b},{default:d(()=>[r(c(O),{icon:c(N),slot:"start"},null,8,["icon"]),t[4]||(t[4]=f(" Save "))]),_:1,__:[4]},8,["disabled"]),r(c(q),{fill:"clear",onClick:c(ie).hide},{default:d(()=>[r(c(O),{icon:c(R),slot:"start"},null,8,["icon"]),t[5]||(t[5]=f(" Cancel "))]),_:1,__:[5]},8,["onClick"])]),_:1}),r(c(I))]),_:1})]),_:1}))}}),dt={key:0,style:{border:"1px dashed #ccc",padding:"20px"}},ut={key:1,class:"modern-table"},ct=e("a",te(a({__name:"ArtLabOrders",setup(e){const t=_e(),{patient:a}=M(t),i=w(),s=w([]),_=B(()=>i.value?s.value.filter(e=>new RegExp(i.value,"i").test(JSON.stringify(e))):s.value);function v(e){return fe.toStandardHisDisplayFormat(e)}function p(){ie.show(st,{patientID:a.value.patientID,canOrder:e=>!s.value.filter(e=>v(e.ordered)===v(ve.getSessionDate())).some(t=>t.test_name===e.test_name.label)||(ne(`You have already ordered ${e.test_name} today`),!1),onNewOrder:e=>{s.value.push(...se.formatLabs(e))}})}return A(()=>a.value.patientID,e=>async function(e){const t=(await se.getOrders(e,{patientID:a.value.patientID})).map(async e=>{const t={...e,result_given:!1},a=e.tests.filter(e=>null!=e.result).map(e=>e.result).reduce((e,t)=>[...e,...t],[]).reduce((e,t)=>t.id,null);try{t.result_given=a?await(await me.get(a)).children.reduce(async(e,t)=>await de.getConceptID("Result Given to Client")===t.concept_id&&"Yes"===await de.getConceptName(t.value_coded)?"Yes":e,"No"):"N/A"}catch(l){console.error(l)}return t});s.value=se.formatLabs(await Promise.all(t))}(e),{immediate:!0}),(e,t)=>(n(),l("div",null,[r(c(g),{lines:"none"},{default:d(()=>[r(c(q),{onClick:p},{default:d(()=>[r(c(O),{icon:c(N),slot:"start"},null,8,["icon"]),t[1]||(t[1]=f(" Order Test "))]),_:1,__:[1]}),r(c(U),{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),color:"light",style:{width:"45%"},slot:"end"},null,8,["modelValue"])]),_:1}),0===s.value.length?(n(),l("div",dt,t[2]||(t[2]=[o("h1",{class:"ion-text-center"}," Lab orders not available at the moment ",-1)]))):(n(),l("table",ut,[t[6]||(t[6]=o("thead",null,[o("tr",null,[o("th",null,"Lab Test"),o("th",null,"Specimen"),o("th",null,"Accession Number"),o("th",null,"Order Date"),o("th",null,"Result"),o("th",null,"Action")])],-1)),o("tbody",null,[(n(!0),l(m,null,b(_.value,(e,i)=>(n(),l("tr",{key:i},[o("td",null,u(e.test_name),1),o("td",null,u(e.specimen),1),o("td",null,u(e.accession_number),1),o("td",null,u(v(e.ordered)),1),o("td",null,[(n(!0),l(m,null,b(e.result,(e,a)=>(n(),l("span",{key:a},[f(u(e)+" ",1),t[3]||(t[3]=o("br",null,null,-1))]))),128))]),o("td",null,[r(c(q),{onClick:t=>async function(e){return v(e.ordered)!=v(ve.getSessionDate())?ne(`Printing order #${e.accession_number} is restricted to today. Consider using BDE mode/set session date to the order date`):await le(`Do you want to print order with accession number ${e.accession_number}?`)?new pe(a.value.patientID).printLabOrderLbl(e.order_id):void 0}(e),color:"light"},{default:d(()=>[r(c(O),{color:"primary",icon:c(H),slot:"start"},null,8,["icon"]),t[4]||(t[4]=f(" Print "))]),_:2,__:[4]},1032,["onClick"]),r(c(q),{onClick:t=>function(e){Ne(async t=>{new Pe(-1).voidOrder(e.order_id,t).then(t=>{t?ce("An error has occured while voiding record"):(s.value=s.value.filter(t=>t.order_id!=e.order_id),ue("Record has been voided successfully!"))}).catch(e=>{ce(`An error has occured while deleting order: ${e}`)})})}(e),color:"light",class:"ion-margin-start"},{default:d(()=>[r(c(O),{style:{color:"red"},icon:c(E),slot:"start"},null,8,["icon"]),t[5]||(t[5]=f(" Void "))]),_:2,__:[5]},1032,["onClick"])])]))),128))])]))]))}}),[["__scopeId","data-v-1287381f"]])),_t={key:0,style:{border:"1px dashed #ccc",padding:"20px"}},ft=a({__name:"ArtWeightChart",setup(e){const t=new be,a=w([]),s=w(!1),_=L({prevWeight:"-",curWeight:"-",curWeightChange:"-",weightState:"",age:"-",bmi:{}}),p={chart:{id:"weight_chart"},title:{text:"Weight trail (2 year period)"},stroke:{curve:"smooth"},yaxis:{title:{text:"Weight Kg(s)"},min:0},xaxis:{categories:[]},dataLabels:{enabled:!0,textAnchor:"start",formatter:function(e,t){var a;const l=null===(a=t.w.config.series[0].data[t.dataPointIndex-1])||void 0===a?void 0:a.y;return l&&l>0?(e/l*100-100).toFixed(2)+" %":"0.0%"}}};return S(async()=>{const e=await t.getWeightHistory(),l=await t.getBMI(),n=e.map(e=>({x:D(e.date).format("DD/MMM/YYYY"),y:e.weight}));s.value=n.length>0,a.value=[{name:"Weight",data:n.sort((e,t)=>new Date(e.x)-new Date(t.x)).map(e=>{const[t,a]=e.x.split("/");return{x:`${t}.${a}`,y:e.y}})}],function(e){var t,a;const l=(null===(t=e.values[e.values.length-2])||void 0===t?void 0:t.y)||0,n=(null===(a=e.values[e.values.length-1])||void 0===a?void 0:a.y)||0;_.curWeight=n||"-",_.prevWeight=l||"-",_.age=e.age,_.bmi=e.bmi,n>0&&l>0&&(_.curWeightChange=Math.abs(n/l*100-100).toFixed(2)+" %",_.weightState=n>l?X:n<l?$:Q)}({bmi:l,age:t.getAge(),values:n})}),(e,t)=>s.value?(n(),i(c(F),{key:1},{default:d(()=>[r(c(P),null,{default:d(()=>[r(c(I),{"size-md":"8","size-sm":"12"},{default:d(()=>[r(c(Ie),{width:"100%",height:"560px",type:"area",options:p,series:a.value},null,8,["series"])]),_:1}),r(c(I),{"size-md":"4","size-sm":"12"},{default:d(()=>[r(c(y),null,{default:d(()=>[r(c(g),null,{default:d(()=>[r(c(v),{class:"title"},{default:d(()=>t[1]||(t[1]=[f("Previous weight")])),_:1,__:[1]}),r(c(Y),{slot:"end",color:"primary"},{default:d(()=>[f(u(_.prevWeight),1)]),_:1})]),_:1}),r(c(g),null,{default:d(()=>[r(c(v),{class:"title"},{default:d(()=>t[2]||(t[2]=[f("Latest weight")])),_:1,__:[2]}),r(c(Y),{slot:"end",color:"primary"},{default:d(()=>[f(u(_.curWeight),1)]),_:1})]),_:1}),r(c(g),null,{default:d(()=>[r(c(v),{class:"title"},{default:d(()=>t[3]||(t[3]=[f("Latest weight change")])),_:1,__:[3]}),j(r(c(O),{color:"primary",icon:_.weightState,width:"50"},null,8,["icon"]),[[W,_.weightState]]),r(c(Y),{slot:"end",color:"primary"},{default:d(()=>[f(u(_.curWeightChange),1)]),_:1})]),_:1}),r(c(g),null,{default:d(()=>[r(c(v),{class:"title"},{default:d(()=>t[4]||(t[4]=[f("Patient Age")])),_:1,__:[4]}),r(c(Y),{slot:"end",color:"primary"},{default:d(()=>[f(u(_.age),1)]),_:1})]),_:1}),r(c(g),null,{default:d(()=>[r(c(v),{class:"title"},{default:d(()=>t[5]||(t[5]=[f("Patient BMI")])),_:1,__:[5]}),r(c(Y),{slot:"end",color:"primary"},{default:d(()=>[f(u(_.bmi.index),1)]),_:1})]),_:1}),r(c(g),null,{default:d(()=>[r(c(v),{style:z({"background-color":_.bmi.color,color:"white",padding:"10px","text-align":"center"})},{default:d(()=>[f(u(_.bmi.result),1)]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(n(),l("div",_t,t[0]||(t[0]=[o("h1",{class:"ion-text-center"}," No weight data available for this patient ",-1)])))}}),vt={key:0,style:{border:"1px dashed #ccc",padding:"20px"}},pt={key:1},mt=te(a({__name:"SideEffectInput",props:{contraIndicationConceptName:{type:String,required:!0},onReason:{type:Object,required:!1}},setup(e){const t=e,a=w(null),s=w(null),u=_e(),{patient:_}=M(u),p=new Ce(_.value.patientID,-1),m=w([]),b=w([{label:"Other, not drug related",value:"Other, not drug related"},{label:"Drug side effect",value:"Drug side effect"}]);async function h(){if(t.onReason&&"function"==typeof t.onReason){var e,l;const n={type:a.value?"Drug induced":s.value,obs:{concept_id:null===(e=await de.getCachedConceptID("Drug induced",!0))||void 0===e||null===(e=e[0])||void 0===e?void 0:e.concept_id,value_coded:null===(l=await de.getCachedConceptID(t.contraIndicationConceptName,!0))||void 0===l||null===(l=l[0])||void 0===l?void 0:l.concept_id,value_text:s.value?"Past medication history":null,value_drug:a.value?a.value:null}};t.onReason(n)}}return S(()=>{p.getPreviousDrugs().then(e=>{m.value=Object.keys(e).map(t=>({label:e[t].drug.name,value:Number(t)}))})}),(e,t)=>(n(),i(c(K),null,{default:d(()=>[r(c(G),null,{default:d(()=>[r(c(g),{lines:"none"},{default:d(()=>[r(c(v),null,{default:d(()=>t[4]||(t[4]=[f(" Side effect suspected causes ")])),_:1,__:[4]})]),_:1}),o("div",null,[0===m.value.length?(n(),l("div",vt,t[5]||(t[5]=[o("h1",{class:"ion-text-center"}," No previous dispensations found ",-1)]))):(n(),l("div",pt,[r(Se,{label:"Current Medication",modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),onOnChange:t[1]||(t[1]=()=>s.value=null),options:m.value},null,8,["modelValue","options"])]))]),o("div",null,[r(Se,{label:"Previous Medication",modelValue:s.value,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value=e),onOnChange:t[3]||(t[3]=()=>a.value=null),options:b.value},null,8,["modelValue","options"])]),r(c(q),{disabled:!(a.value||s.value),class:"ion-padding",onClick:h},{default:d(()=>t[6]||(t[6]=[f(" Save ")])),_:1,__:[6]},8,["disabled"])]),_:1})]),_:1}))}}),[["__scopeId","data-v-7ee51920"]]),bt={key:0},gt={key:0,style:{border:"1px dashed #ccc",padding:"20px"}},ht={key:0,style:{border:"1px dashed #ccc",padding:"20px"}},yt={class:"ion-text-center"},Ct={key:0,class:"modern-table"},Vt={key:1,style:{border:"1px dashed #ccc",padding:"20px"}},xt={style:{color:"red","font-weight":"bold","font-style":"italic"}},wt=e("A",te(a({__name:"ARTConsultation",setup(e,{expose:t}){const a=_e(),{patient:_}=M(a),p=new be,h=new Ce(_.value.patientID,-1),y=new Ve(_.value.patientID,-1),C=w({}),V=w("labInvestigationForm"),x=w({labKey:1,isNonePatientVisit:!1,prevSideEffectsRows:[],canSubmit:!1,is_pregnant:"",is_breastfeeding:"",pregnant_breastfeeding:"",has_fp_methods:"",current_fp_methods:[],reason_for_no_fpm:"",specific_reason_for_no_fpm:"",offer_contraceptives:"",offered_intervention:"",offer_cxca:"",cxca_reminder:"",reason_for_no_cxca:"",previous_cxca_test_date:"",side_effects:[],other_side_effects:[],other_side_effect_specify:"",on_tb_treatment:"",tb_date_started_treatment_known:"",tb_start_date:"",tb_treatment_period:"",tb_side_effects:[],tb_screening_testing_methods:[],tb_screening_testing_results:[],tb_status:"",hasTbHistoryObs:!1,routine_tb_therapy:"",refer_to_clinician:"",chestXrayScreeningDone:"",molecularScreeningDone:"",chestXrayScreeningResult:"",molecularScreeningResult:"",isChildBearing:!1,hasPregnancyObsToday:!1,isPregnantObsStatus:!1,currentlyBreastfeeding:!1,onPermanentFpMethods:!1,patientHitMenopause:!1,cxcaEnabled:!1,CxCaMaxAge:-1,CxCaStartAge:-1,DueForCxCa:!1,clientHadAHysterectomy:!1,CxCaAppointDate:null,isWeightLossControlled:!1,hasTbTreatmentDate:!1,dateStartedTpt:"",tptDrugQuantities:[],transferFacility:"",arv_drugs:[],is_transfer_in:!0,date_art_started:"",date_last_received_arvs:"",selected_arvs:[],drug_interval:"",weightTrail:[],regimens:[],lostTenPercentBodyWeight:!1,tbTestOrderedForSuspectCase:!1}),q={isNonePatientVisit:{init:async()=>{x.value.isNonePatientVisit="No"===await h.getClient(),x.value.isNonePatientVisit||(x.value.isNonePatientVisit=await ke.isDrugRefillPatient(_.value.patientID))},onSubmit:async()=>(await h.createEncounter(),await h.saveObservationList([await h.buildValueCoded("Patient present","None")]),!0)},weightModel:{init:async()=>{x.value.weightTrail=await p.getWeightHistory(),x.value.weightLossPercentageNum=p.getWeightLossPercentageFromTrail(x.value.weightTrail),x.value.lostTenPercentBodyWeight=x.value.weightLossPercentageNum>=10},showWeightlossConfirmation:async()=>"Confirm weight loss"===await he("Recommendation",`Patient's weight has dropped by ${x.value.weightLossPercentageNum}% , is this controlled weight loss??`,"Please verify",[{name:"Confirm weight loss",slot:"start",color:"success"},{name:"Confirm controlled",slot:"end",color:"primary"}])?"Yes":"No"},date_last_received_arvs:{label:"Last ARV Dispensation",required:()=>!0===x.value.is_transfer_in,init:async()=>{x.value.is_transfer_in=await q.date_last_received_arvs.getTransferInStatus(),x.value.date_art_started=await q.date_last_received_arvs.getDateStartedArt()},buildObs:()=>h.buildValueDate("Date drug received from previous facility",x.value.date_last_received_arvs),validation:()=>{const e=N("date_last_received_arvs");if(e){const e=D(x.value.date_last_received_arvs);return e.isBefore(D(x.value.date_art_started))?(C.value.date_last_received_arvs="Date last received ARVs cannot be before ART start date",!1):!e.isAfter(D(h.getDate()))||(C.value.date_last_received_arvs="Date last received ARVs cannot be after today",!1)}return e},getDateStartedArt:async()=>{const e=await Ce.getFirstValueDatetime(_.value.patientID,"Date ART started");return e?fe.toStandardHisFormat(e):""},getTransferInStatus:async()=>{const e=await Ce.getFirstValueCoded(_.value.patientID,"Ever received ART"),t=await Ce.getFirstObs(_.value.patientID,"Has transfer letter"),a=t?fe.toStandardHisFormat(t.obs_datetime):"";return e&&e.match(/yes/i)&&t&&`${t.value_coded}`.match(/yes/i)&&a===h.getDate()}},selected_arvs:{label:"Last ARV drugs dispensed",init:async()=>{x.value.arv_drugs=(await y.getARVs()).map(e=>({drug:e,name:e.name,pill_brought:null,dispensed_quantity:null,dispensed_quantity_error_id:`dispensed_quantity_error_${e.drug_id}`,pills_brought_error_id:`pills_brought_error_${e.drug_id}`}))},required:()=>x.value.is_transfer_in,buildObs:()=>x.value.selected_arvs.map(async e=>({...await h.buildObs("Drug received from previous facility",{value_drug:e.drug.drug_id,value_datetime:(y.setNextVisitInterval(x.value.drug_interval),y.calculateDateFromInterval()),value_numeric:e.dispensed_quantity}),child:[await h.buildObs("Number of tablets brought to clinic",{value_drug:e.drug.drug_id,value_numeric:e.pill_brought,value_datetime:x.value.date_last_received_arvs})]})),validation:()=>{const e=N("selected_arvs");let t=e;return e&&x.value.selected_arvs.forEach(e=>{C.value[e.dispensed_quantity_error_id]="",O(e.dispensed_quantity)||(C.value[e.dispensed_quantity_error_id]="A valid digit is required",t=!1),C.value[e.pills_brought_error_id]="",O(e.pill_brought)||(C.value[e.pills_brought_error_id]="A valid digit is required",t=!1)}),t}},drug_interval:{label:"Duration period for last received ARVs",required:()=>x.value.is_transfer_in,validation:()=>N("drug_interval"),options:()=>[{label:"2 weeks",value:14},{label:"1 month",value:28},{label:"2 months",value:56},{label:"3 months",value:84},{label:"4 months",value:112},{label:"5 months",value:140},{label:"6 months",value:168},{label:"7 months",value:196},{label:"8 months",value:224},{label:"9 months",value:252},{label:"10 months",value:280},{label:"11 months",value:308},{label:"12 months",value:336}]},pregnancyModel:{init:async()=>{p.isFemale()&&(x.value.patientHitMenopause=await h.patientHitMenopause(),!x.value.patientHitMenopause&&p.isChildBearing()&&(x.value.hasPregnancyObsToday=await p.hasPregnancyObsToday(),x.value.isPregnantObsStatus=await p.isPregnant(),x.value.currentlyBreastfeeding=await p.isBreastfeeding(),x.value.onPermanentFpMethods=await h.getTLObs()))},isPregnant:()=>x.value.isPregnantObsStatus||"Yes"===x.value.is_pregnant,pregnancyEligible:()=>p.isFemale()&&p.isChildBearing()&&!x.value.onPermanentFpMethods},is_pregnant:{label:"Is patient pregnant?",required:()=>!x.value.hasPregnancyObsToday&&q.pregnancyModel.pregnancyEligible(),buildObs:()=>h.buildValueCoded("Is patient pregnant",x.value.is_pregnant),validation:()=>N("is_pregnant")},is_breastfeeding:{label:"Is patient breastfeeding?",required:()=>!x.value.hasPregnancyObsToday&&q.pregnancyModel.pregnancyEligible(),buildObs:()=>h.buildValueCoded("Is patient breast feeding",x.value.is_breastfeeding),validation:()=>N("is_breastfeeding")},current_fp_methods:{label:"What method are you currently on?",init:()=>{x.value.current_fp_methods=h.getFamilyPlanningMethods().map(e=>({label:e,value:e,checked:!1}))},onFormUpdate:(e,t)=>{if("current_fp_methods"===e)if(t.checked&&"NONE"===t.label)x.value.current_fp_methods=x.value.current_fp_methods.map(e=>("NONE"!=e.label&&(e.checked=!1,e.disabled=!1),e));else if("NONE"!=t.label&&t.checked){t.label.match(/condom/gi)&&ye("Combine with other modern methods of family planning");const e=Oe.findIndex(x.value.current_fp_methods,{label:"NONE"});x.value.current_fp_methods[e].checked=!1,x.value.current_fp_methods=h.familyPlanningMethods(t.label,x.value.current_fp_methods);const a=Oe.findIndex(x.value.current_fp_methods,{label:t.label});x.value.current_fp_methods[a].checked=!0}else x.value.current_fp_methods=x.value.current_fp_methods.map(e=>(e.disabled=!1,e))},required:()=>q.pregnancyModel.pregnancyEligible()&&!q.pregnancyModel.isPregnant()&&!x.value.patientHitMenopause,buildObs:()=>x.value.current_fp_methods.filter(e=>e.checked).map(e=>h.buildValueCoded("Family planning method",e.value)),validation:()=>{const e=N("current_fp_methods");var t;return e&&(null!==(t=x.value.current_fp_methods)&&void 0!==t?t:[]).every(e=>!e.checked)?(C.value.current_fp_methods="Please select a family planning method",!1):e}},fp_methods:{label:"What method are you providing today?",init:()=>{x.value.fp_methods=h.getFamilyPlanningMethods().map(e=>({label:e,value:e,checked:!1}))},onFormUpdate:(e,t)=>{if("fp_methods"===e)if(t.checked&&"NONE"===t.label)x.value.fp_methods=x.value.fp_methods.map(e=>("NONE"!=e.label&&(e.checked=!1,e.disabled=!1),e));else if("NONE"!=t.label&&t.checked){t.label.match(/condom/gi)&&ye("Combine with other modern methods of family planning");const e=Oe.findIndex(x.value.fp_methods,{label:"NONE"});x.value.fp_methods[e].checked=!1,x.value.fp_methods=h.familyPlanningMethods(t.label,x.value.fp_methods);const a=Oe.findIndex(x.value.fp_methods,{label:t.label});x.value.fp_methods[a].checked=!0}else x.value.fp_methods=x.value.fp_methods.map(e=>(e.disabled=!1,e))},required:()=>q.pregnancyModel.pregnancyEligible()&&!q.pregnancyModel.isPregnant()&&!x.value.patientHitMenopause,buildObs:()=>x.value.fp_methods.filter(e=>e.checked).map(e=>h.buildValueCoded("Family planning, action to take",e.value)),validation:()=>{const e=N("fp_methods");var t;return e&&(null!==(t=x.value.fp_methods)&&void 0!==t?t:[]).every(e=>!e.checked)?(C.value.fp_methods="Please select a family planning method",!1):e}},reason_for_no_fpm:{label:"Main reason for not using family planning methods",validation:()=>N("reason_for_no_fpm"),required:()=>{const e=q.fp_methods.required(),t=q.current_fp_methods.required(),a=e=>(null!=e?e:[]).some(e=>e.checked&&/none/i.test(e.value));return!(!e||!t)&&a(x.value.fp_methods)&&a(x.value.current_fp_methods)},buildObs:()=>h.buildValueText("Why does the woman not use birth control",x.value.reason_for_no_fpm),options:()=>["Not Sexually active","Patient want to get pregnant","Not needed for medical reasons","At risk of unplanned pregnancy","Menopause"].map(e=>({label:e,value:e}))},specific_reason_for_no_fpm:{label:"Specific reason for not using family planning methods",validation:()=>N("specific_reason_for_no_fpm"),required:()=>q.reason_for_no_fpm.required()&&"At risk of unplanned pregnancy"===x.value.reason_for_no_fpm,buildObs:()=>h.buildValueText("Reason for not using contraceptives",x.value.specific_reason_for_no_fpm),options:()=>["Following wishes of spouse","Religious reasons","Afraid of side effects","Never though about it","Indifferent (does not mind getting pregnant)"].map(e=>({label:e,value:e}))},offer_contraceptives:{label:"Offer contraceptives?",required:()=>q.reason_for_no_fpm.required()&&"At risk of unplanned pregnancy"===x.value.reason_for_no_fpm,buildObs:()=>h.buildValueCoded("Family planning, action to take",x.value.offer_contraceptives),validation:()=>N("offer_contraceptives"),options:()=>[{label:"Accepted",value:"Yes"},{label:"Declined",value:"No"},{label:"Discuss with spouse",value:"Discuss with spouse"}]},offered_intervention:{label:"Offered intervention",init:()=>{x.value.offered_intervention=h.getFamilyPlanningMethods().map(e=>({label:e,value:e,checked:!1,disabled:/none/i.test(e)}))},required:()=>q.offer_contraceptives.required()&&"Yes"===x.value.offer_contraceptives,buildObs:()=>x.value.offered_intervention.filter(e=>e.checked).map(e=>h.buildValueCoded(e.label,e.value)),validation:()=>{const e=q.offered_intervention.required();var t;return e&&(null!==(t=x.value.offered_intervention)&&void 0!==t?t:[]).every(e=>!e.checked)?(C.value.offered_intervention="Please select an offered intervention",!1):e}},cxcaModel:{init:async()=>{if(!p.isFemale())return;if(x.value.cxcaEnabled=await re.cervicalCancerScreeningEnabled(),!x.value.cxcaEnabled)return;const{start:e,end:t}=await re.cervicalCancerScreeningAgeBounds();x.value.CxCaMaxAge=t,x.value.CxCaStartAge=e,x.value.DueForCxCa=await h.clientDueForCxCa(),x.value.clientHadAHysterectomy=await h.clientHasHadAHysterectomy();try{x.value.CxCaAppointDate=await p.nextAppointment(24)}catch(a){x.value.CxCaAppointDate=null}},isDueForAppointment:()=>!!x.value.CxCaAppointDate&&30>fe.dateDiffInDays(x.value.CxCaAppointDate,h.date),canScreenCxCa(){const e=p.getAge();return p.isFemale()&&x.value.DueForCxCa&&x.value.cxcaEnabled&&e>=parseInt(x.value.CxCaStartAge)&&e<=parseInt(x.value.CxCaMaxAge)&&!x.value.clientHadAHysterectomy}},offer_cxca:{label:"Refer client for CxCa screening",required:()=>q.cxcaModel.canScreenCxCa()&&!q.pregnancyModel.isPregnant(),buildObs:()=>h.buildValueCoded("Offer CxCa",x.value.offer_cxca),validation:()=>N("offer_cxca")},reason_for_no_cxca:{label:"Reason for NOT offering CxCa",required:()=>q.offer_cxca.required()&&"No"===x.value.offer_cxca,buildObs:()=>h.buildValueCoded("Reason for NOT offering CxCa",x.value.reason_for_no_cxca),validation:()=>N("reason_for_no_cxca"),options:()=>de.getConceptsByCategory("reason_for_no_cxca").map(e=>({label:e.name,value:e.name,other:{c:e}}))},previous_cxca_test_date:{label:"Previous CxCa test",required:()=>q.reason_for_no_cxca.required()&&"Not due for screening"===x.value.reason_for_no_cxca,buildObs:()=>h.buildValueDate("CxCa test date",x.value.previous_cxca_test_date),validation:()=>{const e=N("previous_cxca_test_date");return e?D(x.value.previous_cxca_test_date).isBefore(D(p.getBirthdate()))?(C.value.previous_cxca_test_date="Date cannot be before Patient birthdate",!1):!D(x.value.previous_cxca_test_date).isAfter(D(h.date))||(C.value.previous_cxca_test_date="Date cannot be in the future",!1):e}},side_effects:{required:()=>!0,label:"Contraindications / Side effects (select either 'Yes' or 'No')",init:async()=>{x.value.side_effects=de.getConceptsByCategory("contraindication",!0).map(e=>({id:`side_effect_${e.name}`,concept_id:e.concept_id,label:e.name,value:"",contraIndication:{}})),x.value.side_effects=[...x.value.side_effects,{id:"side_effect_other",concept_id:0,label:"Other",value:""}];const e=await h.getDrugSideEffects();return x.value.prevSideEffectsRows=Object.keys(e).map(t=>Object.values(e[t]).filter(e=>!Oe.isEmpty(e.name)).map(e=>({date:t,condition:e.name,drug_induced:e.drug_induced?"Yes":"No",drug:e.drug_induced?e.drug:""})).reduce((e,t)=>e.concat(t),[])).flat(1),!0},buildObs:()=>[...x.value.side_effects.map(async e=>({...await h.buildValueCoded("Malawi ART side effects",e.label),child:[await h.buildValueCoded(e.label,e.value)]})),...x.value.side_effects.filter(e=>{var t;return null===(t=e.contraIndication)||void 0===t?void 0:t.obs}).map(e=>e.contraIndication.obs)],onFormUpdate:(e,t)=>{"side_effects"===e&&"Yes"===t.value&&"contraIndication"in t.option&&ie.show(mt,{contraIndicationConceptName:t.option.label,onReason:e=>{x.value.side_effects=x.value.side_effects.map(a=>(t.option.label===a.label&&(a.contraIndication=e),a)),ie.hide()}}),"side_effects"===e&&"No"===t.value&&"contraIndication"in t.option&&(x.value.side_effects=x.value.side_effects.map(e=>(t.option.label===e.label&&(e.contraIndication={}),e)))},validation:()=>{if(N("side_effects")){let e=!0;return x.value.side_effects.forEach(t=>{C.value[t.id]="",t.value||(C.value[t.id]="Please select a value",e=!1)}),e}return!1}},other_side_effects:{label:"Other Contraindications / Side effects (select either 'Yes' or 'No')",init:async()=>{x.value.other_side_effects=de.getConceptsByCategory("side_effect",!0).map(e=>({id:`other_side_effect_${e.name}`,concept_id:e.concept_id,label:e.name,value:"",contraIndication:{}})),x.value.other_side_effects=[...x.value.other_side_effects,{id:"other_side_effect_other",concept_id:0,label:"Other (Specify)",value:""}]},required:()=>q.side_effects.required()&&x.value.side_effects.some(e=>"Other"===e.label&&"Yes"===e.value),onFormUpdate:(e,t)=>{"other_side_effects"===e&&/malnutrition/i.test(t.label)&&"No"===t.value&&x.value.lostTenPercentBodyWeight&&q.weightModel.showWeightlossConfirmation().then(e=>{x.value.other_side_effects=x.value.other_side_effects.map(a=>(t.label===a.label&&(a.value=e),a))}),"other_side_effects"===e&&"Yes"===t.value&&"contraIndication"in t&&ie.show(mt,{contraIndicationConceptName:t.label,onReason:e=>{x.value.other_side_effects=x.value.other_side_effects.map(a=>(t.label===a.label&&(a.contraIndication=e),a)),ie.hide()}}),"other_side_effects"===e&&"No"===t.value&&"contraIndication"in t&&(x.value.other_side_effects=x.value.other_side_effects.map(e=>(t.label===e.label&&(e.contraIndication={}),e)))},buildObs:()=>[...x.value.other_side_effects.filter(e=>"Other (Specify)"!=e.label).map(async e=>({...await h.buildValueCoded("Other side effect",e.label),child:[await h.buildValueCoded(e.label,e.value)]})),...x.value.other_side_effects.filter(e=>{var t;return null===(t=e.contraIndication)||void 0===t?void 0:t.obs}).map(e=>e.contraIndication.obs)],validation:()=>{const e=N("other_side_effects");if(e){let e=!0;return x.value.other_side_effects.forEach(t=>{C.value[t.id]="",t.value||(C.value[t.id]="Please select a value",e=!1)}),e}return e}},other_side_effect_specify:{label:"Other Contraindications / Side effects (specify)",required:()=>{var e;return q.other_side_effects.required()&&(null!==(e=x.value.other_side_effects)&&void 0!==e?e:[]).some(e=>"Other (Specify)"===e.label&&"Yes"===e.value)},buildObs:async()=>({...await h.buildValueCoded("Other side effect","Other (Specify)"),child:[await h.buildValueText("Other (Specify)",x.value.other_side_effect_specify)]}),validation:()=>N("other_side_effect_specify")},on_tb_treatment:{label:"On TB treatment?",required:()=>!0,buildObs:()=>h.buildValueCoded("TB treatment",x.value.on_tb_treatment),validation:()=>N("on_tb_treatment")},tb_date_started_treatment_known:{label:"Is Date started treatment known?",init:async()=>{x.value.hasTbTreatmentDate=!1;const e=await Ce.getFirstValueDatetime(_.value.patientID,"TB treatment start date"),t=await Ce.getFirstValueNumber(_.value.patientID,"TB treatment period");if(t&&e){const a=D(h.date).diff(e,"months");x.value.hasTbTreatmentDate=a<=t}},required:()=>q.on_tb_treatment.required()&&!x.value.hasTbTreatmentDate&&"Yes"===x.value.on_tb_treatment,validation:()=>N("tb_date_started_treatment_known")},tb_start_date:{label:"Enter start date for treatment?",required:()=>q.on_tb_treatment.required()&&q.tb_date_started_treatment_known.required()&&"Yes"===x.value.on_tb_treatment&&"Yes"===x.value.tb_date_started_treatment_known,buildObs:()=>h.buildValueDate("TB treatment start date",x.value.tb_start_date),validation:()=>{const e=N("tb_start_date");return e?D(x.value.tb_start_date).isBefore(D(p.getBirthdate()))?(C.value.tb_start_date="Date cannot be before Patient birthdate",!1):!D(x.value.tb_start_date).isAfter(D(h.date))||(C.value.tb_start_date="Date cannot be in the future",!1):e}},tb_treatment_period:{label:"Enter Full TB Treatment Period (In Months)",required:()=>q.on_tb_treatment.required()&&q.tb_date_started_treatment_known.required()&&"Yes"===x.value.on_tb_treatment&&"Yes"===x.value.tb_date_started_treatment_known,buildObs:()=>h.buildValueNumber("TB treatment period",x.value.tb_treatment_period),validation:()=>{const e=N("tb_treatment_period");return e?/^d+$/i.test(x.value.tb_treatment_period)?(C.value.tb_treatment_period="Treatment period must be a number",!1):Number(x.value.tb_treatment_period)<3?(C.value.tb_treatment_period="Treatment period cannot be less than 3 months",!1):!(Number(x.value.tb_treatment_period)>9&&(C.value.tb_treatment_period="Treatment period cannot be greater than 9 months",1)):e}},tb_side_effects:{label:"TB Associated symptoms",required:()=>q.on_tb_treatment.required()&&`${x.value.on_tb_treatment}`.match(/no/i),init:async()=>{const e=de.getConceptsByCategory("tb_symptom",!0).map(e=>e.name);x.value.tb_side_effects=e.map(e=>({id:`tb_side_effect_${e}`,label:e,value:""}))},onFormUpdate:(e,t)=>{"tb_side_effects"===e&&/malnutrition/i.test(t.label)&&"No"===t.value&&x.value.lostTenPercentBodyWeight&&q.weightModel.showWeightlossConfirmation().then(e=>{x.value.tb_side_effects=x.value.tb_side_effects.map(a=>(t.label===a.label&&(a.value=e),a))})},buildObs:()=>x.value.tb_side_effects.map(async e=>({...await h.buildValueCoded("Routine TB Screening",e.label),child:[await h.buildValueCoded(e.label,e.value)]})),hasTbSymptoms:()=>x.value.tb_side_effects.some(e=>"Yes"===e.value),validation:()=>{if(N("tb_side_effects")){let e=!0;return x.value.tb_side_effects.forEach(t=>{C.value[t.id]="",t.value||(C.value[t.id]="Please select a value",e=!1)}),e}return!1}},chestXrayScreeningDone:{label:"Chest X-ray",required:()=>q.on_tb_treatment.required()&&`${x.value.on_tb_treatment}`.match(/no/i),validation:()=>N("chestXrayScreeningDone")},molecularScreeningDone:{label:"Molecular Screening",required:()=>q.on_tb_treatment.required()&&x.value.on_tb_treatment&&`${x.value.on_tb_treatment}`.match(/no/i),validation:()=>N("molecularScreeningDone")},chestXrayScreeningResult:{label:"Chest X-ray Screening Result",required:()=>q.chestXrayScreeningDone.required()&&"Yes"===x.value.chestXrayScreeningDone,buildObs:async()=>({...await h.buildValueCoded("TB screening method used","chest x-ray"),child:[await h.buildValueCoded("chest x-ray",x.value.chestXrayScreeningResult)]}),validation:()=>N("chestXrayScreeningResult"),option:()=>[{label:"Abnormal",value:"Positive"},{label:"Normal",value:"Negative"}]},molecularScreeningResult:{label:"Molecular Screening Result",required:()=>q.molecularScreeningDone.required()&&"Yes"===x.value.molecularScreeningDone,validation:()=>N("molecularScreeningResult"),buildObs:async()=>({...await h.buildValueCoded("TB screening method used","Molecular WHO Recommended Rapid Diagnostic test"),child:[await h.buildValueCoded("Molecular WHO Recommended Rapid Diagnostic test",x.value.molecularScreeningResult)]}),option:()=>[{label:"Positive",value:"Positive"},{label:"Negative",value:"Negative"}]},tbStatusValueModel:{required:()=>!0,buildObs:()=>q.on_tb_treatment.required()&&"Yes"===x.value.on_tb_treatment?h.buildValueCoded("TB Status","Confirmed TB on treatment"):q.tb_status.required()?h.buildValueCoded("TB Status",x.value.tb_status):q.tbScreeningTestResultModel.required()?q.tbScreeningTestResultModel.positiveViaRapidTest()?h.buildValueCoded("TB Status","TB Suspected"):h.buildValueCoded("TB Status","TB NOT suspected"):q.tb_side_effects.required()&&!q.tb_side_effects.hasTbSymptoms()?h.buildValueCoded("TB Status","TB NOT suspected"):{}},tbScreeningTestResultModel:{required:()=>q.chestXrayScreeningResult.required()||q.molecularScreeningResult.required(),positiveViaRapidTest:()=>{const e=q.molecularScreeningResult.required(),t=q.chestXrayScreeningResult.required();if(e||t){if(e&&"Negative"===x.value.molecularScreeningResult)return!1;if(t&&"Positive"===x.value.chestXrayScreeningResult||e&&"Positive"===x.value.molecularScreeningResult)return!0}return!1}},tb_status:{label:"TB Status",required:()=>!(!q.tbScreeningTestResultModel.required()||!q.tbScreeningTestResultModel.positiveViaRapidTest())||!(!q.tb_side_effects.required()||!q.tb_side_effects.hasTbSymptoms()),onFormUpdate:(e,t)=>{"tb_status"===e&&/Yes|TB Suspected/i.test(t)&&!x.value.tbTestOrderedForSuspectCase&&he("Lab Order","The patient is a TB suspect. A lab order is required","Do you want to order test now?",[{name:"Cancel",slot:"start",color:"success"},{name:"Order Lab",slot:"end",color:"success"}]).then(e=>{"Order Lab"===e&&ie.show(st,{patientID:_.value.patientID,testFilters:["TB Microscopic Exam","GeneXpert","Culture & Sensitivity","TB Tests"],onNewOrder:()=>{x.value.tbTestOrderedForSuspectCase=!0,x.value.labKey++,ue("Lab order created successfully")}})})},validation:()=>N("tb_status"),option:()=>[{label:"TB NOT suspected",value:"TB NOT suspected"},{label:"TB Suspected",value:"TB Suspected"},{label:"Confirmed TB Not on treatment",value:"Confirmed TB Not on treatment"}]},routine_tb_therapy:{label:"TB preventive therapy (TPT) history",init:async()=>{x.value.hasTbHistoryObs=!!(await h.hasTreatmentHistoryObs())},required:()=>!x.value.hasTbHistoryObs,buildObs:()=>h.buildValueText("Previous TB treatment history",x.value.routine_tb_therapy),validation:()=>N("routine_tb_therapy"),onFormUpdate:(e,t)=>{"on_tb_treatment"===e&&"Yes"===t&&(x.value.routine_tb_therapy="")},option:()=>{let e=[];return/no/i.test(x.value.on_tb_treatment)&&(e=["Currently on IPT","Currently on 3HP (RFP + INH)","Currently on INH 300 / RFP 300 (3HP)"]),e=e.concat(["Complete course of 3HP in the past (3 months RFP+INH)","Complete course of IPT in the past (min. 6 months of INH)","Aborted course of 3HP (RFP + INH) in the past","Aborted course of INH 300 / RFP 300 (3HP) in the past","Aborted course of IPT in the past","Never taken IPT or 3HP"]),e.map(e=>({label:e,value:e}))}},refer_to_clinician:{label:"Refer to clinician",required:()=>ge.isNurse(),buildObs:()=>h.buildValueCoded("Refer to clinician",x.value.refer_to_clinician),validation:()=>N("refer_to_clinician")},dateStartedTpt:{label:"Date started TPT treatment",required:()=>q.routine_tb_therapy.required()&&`${x.value.routine_tb_therapy}`.match(/currently/i),validation:()=>!(!N("dateStartedTpt")||(D(x.value.dateStartedTpt).isAfter(D(be.getSessionDate()))?(C.value.dateStartedTpt="Date cannot be in the future",1):D(x.value.dateStartedTpt).isBefore(D(p.getBirthdate()))&&(C.value.dateStartedTpt="Date cannot be before birthdate",1)))},transferFacility:{label:"Facility TPT last received from",required:()=>q.routine_tb_therapy.required()&&`${x.value.routine_tb_therapy}`.match(/currently/i),buildObs:()=>h.buildValueText("Location TPT last received",x.value.transferFacility),validation:()=>N("transferFacility")},tptDrugQuantities:{label:"TPT Drug Quantities",required:()=>q.routine_tb_therapy.required()&&`${x.value.routine_tb_therapy}`.match(/currently/i),onFormUpdate:async(e,t)=>{if("routine_tb_therapy"===e&&t.match(/currently/i)){const e=(()=>{const e=[],t=x.value.routine_tb_therapy;return t.match(/ipt/i)?e.push("INH or H (Isoniazid 300mg tablet)"):t.includes("3HP (RFP + INH)")?(e.push("INH or H (Isoniazid 300mg tablet)"),e.push("Rifapentine (150mg)")):t.includes("INH 300 / RFP 300 (3HP)")&&e.push("INH 300 / RFP 300 (3HP)"),e})();Oe.isEmpty(x.value.regimens)&&(x.value.regimens=await xe.getCustomIngridients());const t=x.value.regimens.filter(t=>e.includes(t.name));x.value.tptDrugQuantities=qe(t.map(e=>({drug:e,name:e.name,quantity:null})),"name")}},buildObs:()=>x.value.tptDrugQuantities.map(e=>h.buildObs("TPT Drugs Received",{value_drug:e.drug.drug_id,value_datetime:x.value.dateStartedTpt,value_numeric:e.quantity})),validation:()=>{if(N("tptDrugQuantities"))return!!x.value.tptDrugQuantities.every(e=>{var t;return(null!==(t=e.quantity)&&void 0!==t?t:0)>0})||(C.value.tptDrugQuantities="Please enter quantities for all drugs",!1)}}},O=e=>/^\d+$/i.test(`${e}`);function k(e){"ION-ACCORDION-GROUP"===e.srcElement.tagName&&(V.value=e.detail.value)}function T(e){return C.value[e]="","function"!=typeof q[e].validation||q[e].validation()}function N(e){C.value[e]="";const t=q[e],a="function"==typeof(null==t?void 0:t.required)&&t.required(),l="object"==typeof x.value[e]?Oe.isEmpty(x.value[e]):Array.isArray(x.value[e])?0===x.value[e].length:0===`${x.value[e]}`.length;return a&&l?(C.value[e]="This field is required",!1):a}function R(e,t){T(e),Object.keys(q).forEach(a=>{var l;return(null===(l=q[a])||void 0===l?void 0:l.onFormUpdate)&&q[a].onFormUpdate(e,t)})}function B(){let e=!0;return Object.keys(q).forEach(t=>{"function"==typeof q[t].required&&q[t].required()&&!T(t)&&(e=!1)}),e}return S(()=>async function(){x.value.canSubmit=!1,await Promise.all(Object.keys(q).filter(e=>"function"==typeof q[e].init).map(e=>q[e].init())),x.value.canSubmit=!0}()),t({onSubmit:async function(){if(!x.value.canSubmit)return ne("Please wait for all data to load before submitting"),!1;if(x.value.isNonePatientVisit)return q.isNonePatientVisit.onSubmit();if(!B())return ne("Please review form for errors"),!1;try{if(await function(){const e=Object.keys(q).filter(e=>"function"==typeof q[e].onSubmit).map(e=>q[e].onSubmit&&q[e].onSubmit());return Promise.all(e)}(),!B())return ne("Please review form for errors"),!1;const e=(await Promise.all(Object.keys(q).reduce((e,t)=>{if(t in q&&"function"==typeof q[t].required&&q[t].required()&&"function"==typeof q[t].buildObs){const a=q[t].buildObs();return Array.isArray(a)?[...e,...a]:[...e,a]}return e},[]))).filter(e=>!Oe.isEmpty(e));return await h.createEncounter(),await h.saveObservationList(e),ue("Consultation data saved successfully"),!0}catch(e){return console.error(e),ce("Error has occured while saving observations"),!1}}}),(e,t)=>(n(),l(m,null,[x.value.isNonePatientVisit?s("",!0):(n(),l("div",bt,[r(tt,{patientID:Number(c(_).patientID)},null,8,["patientID"])])),x.value.isNonePatientVisit?(n(),i(c(K),{key:1,style:{height:"40vh"}},{default:d(()=>[r(c(G),null,{default:d(()=>t[56]||(t[56]=[o("div",{style:{"margin-top":"10%"},class:"ion-text-center"},[o("h1",null,[f("Consultation is not required for a "),o("b",null,"Guardian only"),f(" visit or "),o("b",null,"Emergency Supply Clients"),f(". ")]),o("h1",{class:"ion-padding"},[f("Press the "),o("span",{style:{color:"green","font-weight":"bold"}},"Save / Finish "),f("button to continue")])],-1)])),_:1,__:[56]})]),_:1})):(n(),i(c(Z),{key:2,value:V.value,onIonChange:k},{default:d(()=>[r(c(J),{value:"labInvestigationForm"},{default:d(()=>[r(c(g),{slot:"header",color:"light"},{default:d(()=>[r(c(v),{class:"previousLabel"},{default:d(()=>t[57]||(t[57]=[f("Lab investigations")])),_:1,__:[57]})]),_:1}),r(c(K),{class:"ion-padding",slot:"content"},{default:d(()=>[r(c(G),null,{default:d(()=>[(n(),i(ct,{key:x.value.labKey,patientID:Number(c(_).patientID)},null,8,["patientID"]))]),_:1})]),_:1})]),_:1}),r(c(J),{value:"weightChart"},{default:d(()=>[r(c(g),{slot:"header",color:"light"},{default:d(()=>[r(c(v),{class:"previousLabel"},{default:d(()=>t[58]||(t[58]=[f("Weight Chart")])),_:1,__:[58]})]),_:1}),r(c(K),{class:"ion-padding",slot:"content"},{default:d(()=>[r(c(G),null,{default:d(()=>[r(ft)]),_:1})]),_:1})]),_:1}),x.value.is_transfer_in?(n(),i(c(J),{key:0,value:"medicalTranserForm","toggle-icon-slot":"start"},{default:d(()=>[r(c(g),{slot:"header",color:"light"},{default:d(()=>[r(c(v),{class:"previousLabel"},{default:d(()=>t[59]||(t[59]=[f("Medication transfer-in")])),_:1,__:[59]})]),_:1}),r(c(K),{class:"ion-padding",slot:"content"},{default:d(()=>[r(c(G),null,{default:d(()=>[r(c(F),null,{default:d(()=>[r(c(P),null,{default:d(()=>[r(c(I),null,{default:d(()=>[r(Xe,{required:"",label:q.date_last_received_arvs.label,"error-message":C.value.date_last_received_arvs,onOnChange:t[0]||(t[0]=e=>R("date_last_received_arvs",e.value.standardDate)),modelValue:x.value.date_last_received_arvs,"onUpdate:modelValue":t[1]||(t[1]=e=>x.value.date_last_received_arvs=e)},null,8,["label","error-message","modelValue"])]),_:1})]),_:1}),r(c(P),null,{default:d(()=>[r(c(I),null,{default:d(()=>[r(Ye,{required:"",multiple:"",label:q.selected_arvs.label,"error-message":C.value.selected_arvs,options:x.value.arv_drugs,modelValue:x.value.selected_arvs,"onUpdate:modelValue":t[2]||(t[2]=e=>x.value.selected_arvs=e),onOnChange:t[3]||(t[3]=e=>R("selected_arvs",e))},null,8,["label","error-message","options","modelValue"])]),_:1}),r(c(I),null,{default:d(()=>[r(Ye,{required:"",label:q.drug_interval.label,"error-message":C.value.drug_interval,options:q.drug_interval.options(),modelValue:x.value.drug_interval,"onUpdate:modelValue":t[4]||(t[4]=e=>x.value.drug_interval=e),onOnChange:t[5]||(t[5]=e=>R("drug_interval",e))},null,8,["label","error-message","options","modelValue"])]),_:1})]),_:1}),x.value.selected_arvs.length?(n(),i(c(P),{key:0},{default:d(()=>[r(c(I),null,{default:d(()=>[(n(!0),l(m,null,b(x.value.selected_arvs,e=>(n(),i(c(F),{key:e.drug.drug_id},{default:d(()=>[r(c(P),null,{default:d(()=>[r(c(I),null,{default:d(()=>[r(c(v),{class:"form-label"},{default:d(()=>[f(u(e.name)+" ",1),t[60]||(t[60]=o("span",{style:{color:"red"}},"*",-1))]),_:2,__:[60]},1024)]),_:2},1024)]),_:2},1024),r(c(P),null,{default:d(()=>[r(c(I),null,{default:d(()=>[r(He,{required:"",label:"Given Amount",modelValue:e.dispensed_quantity,"onUpdate:modelValue":t=>e.dispensed_quantity=t,"error-message":C.value[e.dispensed_quantity_error_id],options:x.value.arv_drugs,onOnChange:t[6]||(t[6]=e=>R("selected_arvs",e))},null,8,["modelValue","onUpdate:modelValue","error-message","options"])]),_:2},1024),r(c(I),null,{default:d(()=>[r(He,{required:"",label:"Pill brought",modelValue:e.pill_brought,"onUpdate:modelValue":t=>e.pill_brought=t,"error-message":C.value[e.pills_brought_error_id],options:x.value.arv_drugs,onOnChange:t[7]||(t[7]=e=>R("selected_arvs",e))},null,8,["modelValue","onUpdate:modelValue","error-message","options"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):s("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):s("",!0),q.is_pregnant.required()||q.is_breastfeeding.required()?(n(),i(c(J),{key:1,value:"pregnancyForm"},{default:d(()=>[r(c(g),{slot:"header",color:"light"},{default:d(()=>[r(c(v),{class:"previousLabel"},{default:d(()=>t[61]||(t[61]=[f("Pregnancy and Breastfeeding")])),_:1,__:[61]})]),_:1}),r(c(K),{class:"ion-padding",slot:"content"},{default:d(()=>[r(c(G),null,{default:d(()=>[r(c(F),null,{default:d(()=>[r(c(P),null,{default:d(()=>[q.is_pregnant.required()?(n(),i(c(I),{key:0},{default:d(()=>[r(we,{required:"",label:"Pregnant?",modelValue:x.value.is_pregnant,"onUpdate:modelValue":t[8]||(t[8]=e=>x.value.is_pregnant=e),onOnChange:t[9]||(t[9]=e=>R("is_pregnant",e)),"error-message":C.value.is_pregnant},null,8,["modelValue","error-message"])]),_:1})):s("",!0),q.is_breastfeeding.required()?(n(),i(c(I),{key:1},{default:d(()=>[r(we,{required:"",label:"Breastfeeding?",modelValue:x.value.is_breastfeeding,"onUpdate:modelValue":t[10]||(t[10]=e=>x.value.is_breastfeeding=e),onOnChange:t[11]||(t[11]=e=>R("is_breastfeeding",e)),"error-message":C.value.is_breastfeeding},null,8,["modelValue","error-message"])]),_:1})):s("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):s("",!0),q.current_fp_methods.required()||x.value.onPermanentFpMethods?(n(),i(c(J),{key:2,value:"familyPlanningForm"},{default:d(()=>[r(c(g),{slot:"header",color:"light"},{default:d(()=>[r(c(v),{class:"previousLabel"},{default:d(()=>t[62]||(t[62]=[f("Family Planning")])),_:1,__:[62]})]),_:1}),r(c(K),{class:"ion-padding",slot:"content"},{default:d(()=>[r(c(G),null,{default:d(()=>[x.value.onPermanentFpMethods?(n(),l("div",gt,t[63]||(t[63]=[o("h1",{class:"ion-text-center"}," Patient is on Tubal ligation method ",-1)]))):s("",!0),r(c(F),null,{default:d(()=>[q.current_fp_methods.required()||q.fp_methods.required()?(n(),i(c(P),{key:0},{default:d(()=>[q.current_fp_methods.required()?(n(),i(c(I),{key:0},{default:d(()=>[r(Be,{required:"",label:q.current_fp_methods.label,modelValue:x.value.current_fp_methods,"onUpdate:modelValue":t[12]||(t[12]=e=>x.value.current_fp_methods=e),onOnChange:t[13]||(t[13]=e=>R("current_fp_methods",e)),"error-message":C.value.current_fp_methods},null,8,["label","modelValue","error-message"])]),_:1})):s("",!0),q.fp_methods.required()?(n(),i(c(I),{key:1},{default:d(()=>[r(Be,{required:"",label:q.fp_methods.label,modelValue:x.value.fp_methods,"onUpdate:modelValue":t[14]||(t[14]=e=>x.value.fp_methods=e),onOnChange:t[15]||(t[15]=e=>R("fp_methods",e)),"error-message":C.value.fp_methods},null,8,["label","modelValue","error-message"])]),_:1})):s("",!0)]),_:1})):s("",!0),q.reason_for_no_fpm.required()?(n(),i(c(P),{key:1},{default:d(()=>[r(c(I),null,{default:d(()=>[r(Se,{required:"",label:q.reason_for_no_fpm.label,modelValue:x.value.reason_for_no_fpm,"onUpdate:modelValue":t[16]||(t[16]=e=>x.value.reason_for_no_fpm=e),onOnChange:t[17]||(t[17]=e=>R("reason_for_no_fpm",e)),"error-message":C.value.reason_for_no_fpm,options:q.reason_for_no_fpm.options()},null,8,["label","modelValue","error-message","options"])]),_:1})]),_:1})):s("",!0),q.specific_reason_for_no_fpm.required()?(n(),i(c(P),{key:2},{default:d(()=>[r(c(I),null,{default:d(()=>[r(Se,{required:"",label:q.specific_reason_for_no_fpm.label,modelValue:x.value.specific_reason_for_no_fpm,"onUpdate:modelValue":t[18]||(t[18]=e=>x.value.specific_reason_for_no_fpm=e),options:q.specific_reason_for_no_fpm.options(),onOnChange:t[19]||(t[19]=e=>R("specific_reason_for_no_fpm",e)),"error-message":C.value.specific_reason_for_no_fpm},null,8,["label","modelValue","options","error-message"])]),_:1})]),_:1})):s("",!0),q.offer_contraceptives.required()?(n(),i(c(P),{key:3},{default:d(()=>[r(c(I),null,{default:d(()=>[r(Se,{required:"",label:q.offer_contraceptives.label,modelValue:x.value.offer_contraceptives,"onUpdate:modelValue":t[20]||(t[20]=e=>x.value.offer_contraceptives=e),onOnChange:t[21]||(t[21]=e=>R("offer_contraceptives",e)),"error-message":C.value.offer_contraceptives,options:q.offer_contraceptives.options()},null,8,["label","modelValue","error-message","options"])]),_:1})]),_:1})):s("",!0),q.offered_intervention.required()?(n(),i(c(P),{key:4},{default:d(()=>[r(c(I),null,{default:d(()=>[r(Be,{required:"",label:q.offered_intervention.label,modelValue:x.value.offered_intervention,"onUpdate:modelValue":t[22]||(t[22]=e=>x.value.offered_intervention=e),onOnChange:t[23]||(t[23]=e=>R("offered_intervention",e)),"error-message":C.value.offered_intervention},null,8,["label","modelValue","error-message"])]),_:1})]),_:1})):s("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):s("",!0),q.offer_cxca.required()||q.cxcaModel.isDueForAppointment()&&x.value.cxcaEnabled?(n(),i(c(J),{key:3,value:"cervicalCancerScreeningForm"},{default:d(()=>[r(c(g),{slot:"header",color:"light"},{default:d(()=>[r(c(v),{class:"previousLabel"},{default:d(()=>t[64]||(t[64]=[f("Cervical Cancer Screening")])),_:1,__:[64]})]),_:1}),r(c(K),{class:"ion-padding",slot:"content"},{default:d(()=>[r(c(G),null,{default:d(()=>[q.cxcaModel.isDueForAppointment()?(n(),l("div",ht,[o("h1",yt," Patient is due for Cervical Cancer Screening on "+u(c(fe).toStandardHisDisplayFormat(x.value.CxCaAppointDate.appointment_date)),1)])):s("",!0),r(c(F),null,{default:d(()=>[q.offer_cxca.required()?(n(),i(c(P),{key:0},{default:d(()=>[r(c(I),null,{default:d(()=>[r(we,{required:"",label:q.offer_cxca.label,modelValue:x.value.offer_cxca,"onUpdate:modelValue":t[24]||(t[24]=e=>x.value.offer_cxca=e),onOnChange:t[25]||(t[25]=e=>R("offer_cxca",e)),"error-message":C.value.offer_cxca},null,8,["label","modelValue","error-message"])]),_:1})]),_:1})):s("",!0),q.reason_for_no_cxca.required()?(n(),i(c(P),{key:1},{default:d(()=>[r(c(I),null,{default:d(()=>[r(Se,{required:"",label:q.reason_for_no_cxca.label,modelValue:x.value.reason_for_no_cxca,"onUpdate:modelValue":t[26]||(t[26]=e=>x.value.reason_for_no_cxca=e),onOnChange:t[27]||(t[27]=e=>R("reason_for_no_cxca",e)),"error-message":C.value.reason_for_no_cxca,options:q.reason_for_no_cxca.options()},null,8,["label","modelValue","error-message","options"])]),_:1})]),_:1})):s("",!0),q.previous_cxca_test_date.required()?(n(),i(c(P),{key:2},{default:d(()=>[r(c(I),null,{default:d(()=>[r(Xe,{required:"",label:q.previous_cxca_test_date.label,modelValue:x.value.previous_cxca_test_date,"onUpdate:modelValue":t[28]||(t[28]=e=>x.value.previous_cxca_test_date=e),onOnChange:t[29]||(t[29]=e=>R("previous_cxca_test_date",e.value.standardDate)),"error-message":C.value.previous_cxca_test_date},null,8,["label","modelValue","error-message"])]),_:1})]),_:1})):s("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):s("",!0),r(c(J),{value:"sideEffectHistoryForm"},{default:d(()=>[r(c(g),{slot:"header",color:"light"},{default:d(()=>[r(c(v),{class:"previousLabel"},{default:d(()=>t[65]||(t[65]=[f("Side effects / Contraindications history")])),_:1,__:[65]})]),_:1}),r(c(K),{class:"ion-padding",slot:"content"},{default:d(()=>[r(c(G),null,{default:d(()=>[x.value.prevSideEffectsRows.length>0?(n(),l("table",Ct,[t[66]||(t[66]=o("thead",null,[o("tr",null,[o("th",null,"Date"),o("th",null,"Condition"),o("th",null,"Drug Induced"),o("th",null,"Drug")])],-1)),o("tbody",null,[(n(!0),l(m,null,b(x.value.prevSideEffectsRows,e=>(n(),l("tr",{key:e},[o("td",null,u(e.date),1),o("td",null,u(e.condition),1),o("td",null,u(e.drug_induced?"Yes":"No"),1),o("td",null,u(e.drug),1)]))),128))])])):(n(),l("div",Vt,t[67]||(t[67]=[o("h1",{class:"ion-text-center"}," No previous side effects found ",-1)])))]),_:1})]),_:1})]),_:1}),q.side_effects.required()?(n(),i(c(J),{key:4,value:"sideEffectsForm"},{default:d(()=>[r(c(g),{slot:"header",color:"light"},{default:d(()=>[r(c(v),{class:"previousLabel"},{default:d(()=>[f(u(q.side_effects.label),1)]),_:1})]),_:1}),r(c(K),{class:"ion-padding",slot:"content"},{default:d(()=>[r(c(G),null,{default:d(()=>[r(c(F),null,{default:d(()=>[q.side_effects.required()?(n(),i(c(P),{key:0},{default:d(()=>[(n(!0),l(m,null,b(x.value.side_effects,(e,t)=>(n(),i(c(I),{"size-md":"4","size-sm":"12",key:t},{default:d(()=>{var t,a;return[r(we,{required:"","badge-text":null!==(t=e.contraIndication)&&void 0!==t&&t.type?`Cause: ${null===(a=e.contraIndication)||void 0===a?void 0:a.type}`:void 0,label:e.label,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,onOnChange:t=>R("side_effects",{value:t,option:e}),"error-message":C.value[e.id]},null,8,["badge-text","label","modelValue","onUpdate:modelValue","onOnChange","error-message"])]}),_:2},1024))),128))]),_:1})):s("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):s("",!0),q.other_side_effects.required()?(n(),i(c(J),{key:5,value:"otherSideEffectsForm"},{default:d(()=>[r(c(g),{slot:"header",color:"light"},{default:d(()=>[r(c(v),{class:"previousLabel"},{default:d(()=>[f(u(q.other_side_effects.label),1)]),_:1})]),_:1}),r(c(K),{class:"ion-padding",slot:"content"},{default:d(()=>[r(c(G),null,{default:d(()=>[r(c(F),null,{default:d(()=>[q.other_side_effects.required()?(n(),i(c(P),{key:0},{default:d(()=>[(n(!0),l(m,null,b(x.value.other_side_effects,(e,t)=>(n(),i(c(I),{"size-md":"4","size-sm":"12",key:t},{default:d(()=>{var t,a;return[r(we,{"badge-text":null!==(t=e.contraIndication)&&void 0!==t&&t.type?`Cause: ${null===(a=e.contraIndication)||void 0===a?void 0:a.type}`:void 0,required:"",label:e.label,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,onOnChange:t=>R("other_side_effects",{...e,value:t}),"error-message":C.value[e.id]},null,8,["badge-text","label","modelValue","onUpdate:modelValue","onOnChange","error-message"])]}),_:2},1024))),128))]),_:1})):s("",!0),q.other_side_effect_specify.required()?(n(),i(c(P),{key:1},{default:d(()=>[r(c(I),null,{default:d(()=>[r(He,{required:"",label:q.other_side_effect_specify.label,modelValue:x.value.other_side_effect_specify,"onUpdate:modelValue":t[30]||(t[30]=e=>x.value.other_side_effect_specify=e),onOnChange:t[31]||(t[31]=e=>R("other_side_effect_specify",e)),"error-message":C.value.other_side_effect_specify},null,8,["label","modelValue","error-message"])]),_:1})]),_:1})):s("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):s("",!0),q.on_tb_treatment.required()?(n(),i(c(J),{key:6,value:"tbTreatmentForm"},{default:d(()=>[r(c(g),{slot:"header",color:"light"},{default:d(()=>[r(c(v),{class:"previousLabel"},{default:d(()=>t[68]||(t[68]=[f("TB Treatment")])),_:1,__:[68]})]),_:1}),r(c(K),{class:"ion-padding",slot:"content"},{default:d(()=>[r(c(G),null,{default:d(()=>[r(c(F),null,{default:d(()=>[q.on_tb_treatment.required()?(n(),i(c(P),{key:0},{default:d(()=>[r(c(I),null,{default:d(()=>[r(we,{required:"",label:q.on_tb_treatment.label,modelValue:x.value.on_tb_treatment,"onUpdate:modelValue":t[32]||(t[32]=e=>x.value.on_tb_treatment=e),onOnChange:t[33]||(t[33]=e=>R("on_tb_treatment",e)),"error-message":C.value.on_tb_treatment},null,8,["label","modelValue","error-message"])]),_:1})]),_:1})):s("",!0),q.tb_date_started_treatment_known.required()?(n(),i(c(P),{key:1},{default:d(()=>[r(c(I),null,{default:d(()=>[r(we,{required:"",label:q.tb_date_started_treatment_known.label,modelValue:x.value.tb_date_started_treatment_known,"onUpdate:modelValue":t[34]||(t[34]=e=>x.value.tb_date_started_treatment_known=e),onOnChange:t[35]||(t[35]=e=>R("tb_date_started_treatment_known",e)),"error-message":C.value.tb_date_started_treatment_known},null,8,["label","modelValue","error-message"])]),_:1})]),_:1})):s("",!0),q.tb_start_date.required()||q.tb_treatment_period.required()?(n(),i(c(P),{key:2},{default:d(()=>[q.tb_start_date.required()?(n(),i(c(I),{key:0},{default:d(()=>[r(Xe,{required:"",label:q.tb_start_date.label,modelValue:x.value.tb_start_date,"onUpdate:modelValue":t[36]||(t[36]=e=>x.value.tb_start_date=e),onOnChange:t[37]||(t[37]=e=>R("tb_start_date",e)),"error-message":C.value.tb_start_date},null,8,["label","modelValue","error-message"])]),_:1})):s("",!0),q.tb_treatment_period.required()?(n(),i(c(I),{key:1},{default:d(()=>[r(He,{required:"",label:q.tb_treatment_period.label,modelValue:x.value.tb_treatment_period,"onUpdate:modelValue":t[38]||(t[38]=e=>x.value.tb_treatment_period=e),onOnChange:t[39]||(t[39]=e=>R("tb_treatment_period",e)),"error-message":C.value.tb_treatment_period},null,8,["label","modelValue","error-message"])]),_:1})):s("",!0)]),_:1})):s("",!0),q.tb_side_effects.required()?(n(),i(c(P),{key:3},{default:d(()=>[r(c(I),{size:"12"},{default:d(()=>[r(c(g),null,{default:d(()=>[r(c(v),{style:{"font-weight":"bold","font-size":"1.3rem"}},{default:d(()=>t[69]||(t[69]=[f("TB associated symptoms")])),_:1,__:[69]})]),_:1})]),_:1}),(n(!0),l(m,null,b(x.value.tb_side_effects,(e,t)=>(n(),i(c(I),{"size-md":"6","size-sm":"12",key:t},{default:d(()=>[r(we,{required:"",label:e.label,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,onOnChange:t=>R("tb_side_effects",{...e,value:t}),"error-message":C.value[e.id]},null,8,["label","modelValue","onUpdate:modelValue","onOnChange","error-message"])]),_:2},1024))),128))]),_:1})):s("",!0),q.chestXrayScreeningDone.required()||q.molecularScreeningDone.required()?(n(),i(c(P),{key:4},{default:d(()=>[r(c(I),{size:"12"},{default:d(()=>[r(c(g),null,{default:d(()=>[r(c(v),{style:{"font-weight":"bold","font-size":"1.3rem"}},{default:d(()=>t[70]||(t[70]=[f("TB Screening methods used")])),_:1,__:[70]})]),_:1})]),_:1}),q.chestXrayScreeningDone.required()?(n(),i(c(I),{key:0},{default:d(()=>[r(we,{required:"",label:q.chestXrayScreeningDone.label,modelValue:x.value.chestXrayScreeningDone,"onUpdate:modelValue":t[40]||(t[40]=e=>x.value.chestXrayScreeningDone=e),onOnChange:t[41]||(t[41]=e=>R("chestXrayScreeningDone",e)),"error-message":C.value.chestXrayScreeningDone},null,8,["label","modelValue","error-message"])]),_:1})):s("",!0),q.molecularScreeningDone.required()?(n(),i(c(I),{key:1},{default:d(()=>[r(we,{required:"",label:q.molecularScreeningDone.label,modelValue:x.value.molecularScreeningDone,"onUpdate:modelValue":t[42]||(t[42]=e=>x.value.molecularScreeningDone=e),onOnChange:t[43]||(t[43]=e=>R("molecularScreeningDone",e)),"error-message":C.value.molecularScreeningDone},null,8,["label","modelValue","error-message"])]),_:1})):s("",!0)]),_:1})):s("",!0),q.chestXrayScreeningResult.required()||q.molecularScreeningResult.required()?(n(),i(c(P),{key:5},{default:d(()=>[r(c(I),{size:"12"},{default:d(()=>[r(c(g),null,{default:d(()=>[r(c(v),{style:{"font-weight":"bold","font-size":"1.3rem"}},{default:d(()=>t[71]||(t[71]=[f("TB Screening results")])),_:1,__:[71]})]),_:1})]),_:1}),q.chestXrayScreeningResult.required()?(n(),i(c(I),{key:0},{default:d(()=>[r(Se,{required:"",label:q.chestXrayScreeningResult.label,modelValue:x.value.chestXrayScreeningResult,"onUpdate:modelValue":t[44]||(t[44]=e=>x.value.chestXrayScreeningResult=e),onOnChange:t[45]||(t[45]=e=>R("chestXrayScreeningResult",e)),"error-message":C.value.chestXrayScreeningResult,options:q.chestXrayScreeningResult.option()},null,8,["label","modelValue","error-message","options"])]),_:1})):s("",!0),q.molecularScreeningResult.required()?(n(),i(c(I),{key:1},{default:d(()=>[r(Se,{required:"",label:q.molecularScreeningResult.label,modelValue:x.value.molecularScreeningResult,"onUpdate:modelValue":t[46]||(t[46]=e=>x.value.molecularScreeningResult=e),onOnChange:t[47]||(t[47]=e=>R("molecularScreeningResult",e)),"error-message":C.value.molecularScreeningResult,options:q.molecularScreeningResult.option()},null,8,["label","modelValue","error-message","options"])]),_:1})):s("",!0)]),_:1})):s("",!0),r(c(P)),q.tb_status.required()?(n(),i(c(P),{key:6},{default:d(()=>[r(c(I),null,{default:d(()=>[r(Se,{required:"",label:q.tb_status.label,modelValue:x.value.tb_status,"onUpdate:modelValue":t[48]||(t[48]=e=>x.value.tb_status=e),onOnChange:t[49]||(t[49]=e=>R("tb_status",e)),"error-message":C.value.tb_status,options:q.tb_status.option()},null,8,["label","modelValue","error-message","options"])]),_:1})]),_:1})):s("",!0)]),_:1}),r(c(F),null,{default:d(()=>[q.routine_tb_therapy.required()?(n(),i(c(P),{key:0},{default:d(()=>[r(c(I),null,{default:d(()=>[r(Se,{required:"",label:q.routine_tb_therapy.label,modelValue:x.value.routine_tb_therapy,"onUpdate:modelValue":t[50]||(t[50]=e=>x.value.routine_tb_therapy=e),options:q.routine_tb_therapy.option(),onOnChange:t[51]||(t[51]=e=>R("routine_tb_therapy",e)),"error-message":C.value.routine_tb_therapy},null,8,["label","modelValue","options","error-message"])]),_:1})]),_:1})):s("",!0),q.dateStartedTpt.required()?(n(),i(c(P),{key:1},{default:d(()=>[q.dateStartedTpt.required()?(n(),i(c(I),{key:0},{default:d(()=>[r(Xe,{required:"",label:q.dateStartedTpt.label,modelValue:x.value.dateStartedTpt,"onUpdate:modelValue":t[52]||(t[52]=e=>x.value.dateStartedTpt=e),onOnChange:t[53]||(t[53]=e=>R("dateStartedTpt",e)),"error-message":C.value.dateStartedTpt},null,8,["label","modelValue","error-message"])]),_:1})):s("",!0),q.transferFacility.required()?(n(),i(c(I),{key:1},{default:d(()=>[r(nt,{required:"",label:q.transferFacility.label,modelValue:x.value.transferFacility,"onUpdate:modelValue":t[54]||(t[54]=e=>x.value.transferFacility=e),onOnChange:t[55]||(t[55]=e=>R("transferFacility",e)),"error-message":C.value.transferFacility},null,8,["label","modelValue","error-message"])]),_:1})):s("",!0)]),_:1})):s("",!0)]),_:1}),q.tptDrugQuantities.required()?(n(),i(c(F),{key:0},{default:d(()=>[r(c(P),null,{default:d(()=>[r(c(I),null,{default:d(()=>[r(c(g),null,{default:d(()=>[r(c(v),{style:{"font-weight":"bold","font-size":"1.3rem"}},{default:d(()=>t[72]||(t[72]=[f("TPT Dispensations")])),_:1,__:[72]})]),_:1})]),_:1})]),_:1}),(n(!0),l(m,null,b(x.value.tptDrugQuantities,(e,t)=>(n(),i(c(P),{key:t},{default:d(()=>[r(c(I),null,{default:d(()=>[r(c(g),{lines:"none"},{default:d(()=>[r(c(v),null,{default:d(()=>[f(u(e.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),r(c(I),null,{default:d(()=>[r(He,{modelValue:e.quantity,"onUpdate:modelValue":t=>e.quantity=t,onOnChange:e=>R("tptDrugQuantities",{index:t,field:"quantity",value:e})},null,8,["modelValue","onUpdate:modelValue","onOnChange"])]),_:2},1024)]),_:2},1024))),128)),r(c(P),null,{default:d(()=>[r(c(I),null,{default:d(()=>[o("div",xt,u(C.value.tptDrugQuantities),1)]),_:1})]),_:1})]),_:1})):s("",!0)]),_:1})]),_:1})]),_:1})):s("",!0)]),_:1},8,["value"]))],64))}}),[["__scopeId","data-v-9a76eca8"]])),St=Object.freeze(Object.defineProperty({__proto__:null,default:wt},Symbol.toStringTag,{value:"Module"}));e("b",St)}}});

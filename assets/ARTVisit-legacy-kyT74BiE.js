System.register(["./vendor-legacy-BTbHWMAP.js","./index-legacy-D5NHGThA.js","./lodash-legacy-pOOc9Efu.js"],function(e,n){"use strict";var t,l,a,o,i,r,u,s,c,p,d,g,v,m,y,b,f,h,D,_,k,x,T,I,w,P,F,j,A,C,R,S,V,N,E,z,H,W,L,Y,$,B,M,Q,U,J,X,G,q;return{setters:[e=>{t=e.d,l=e.bY,a=e.aj,o=e.b1,i=e.r,r=e.w,u=e.y,s=e.f,c=e.z,p=e.l,d=e.u,g=e.ex,v=e.k,m=e.am,y=e.ao,b=e.e,f=e.an,h=e.F,D=e.L,_=e.G,k=e.I,x=e.ey,T=e.ez,I=e.et,w=e.B,P=e.cn,F=e.V,j=e.U,A=e.W,C=e.A,R=e.dQ,S=e.bP,V=e.ag,N=e.ad,E=e.ea,z=e.ct,H=e.dr,W=e.eA,L=e.m,Y=e.eB,$=e.au,B=e.bV,M=e.a6},e=>{Q=e.S,U=e.u,J=e.T,X=e.X,G=e.m,q=e._},null],execute:function(){var K=document.createElement("style");K.textContent="#main[data-v-c6bd1843]{height:calc(100vh - 69px);overflow-y:auto}.placeholder-content[data-v-c6bd1843]{padding:20px}\n/*$vite$:1*/",document.head.appendChild(K);class O extends Q{constructor(){super()}static nextTask(e){return super.getJson(`/workflows/${super.getProgramID()}/${e}`,{date:super.getSessionDate()})}static async getNextTaskParams(e,n=""){let t=n;try{if(!t){const{name:n}=await O.nextTask(e);t=n}}catch(l){t=""}return{name:t.toLowerCase(),params:{patient_id:e}}}}const Z={key:1,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},ee={class:"ion-page",id:"main"},ne={key:0,class:"placeholder-content"},te={style:{margin:"0px auto"},class:"ion-text-center"},le={key:1},ae={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}};e("default",q(t({__name:"ARTVisit",setup(e){const t=l(),q=U(),{patient:K}=a(q),oe=[{label:"Emergency Refill",enableForDebugging:!1,component:B(()=>M(()=>n.import("./EmergencyRefill-legacy-DDjPXgiN.js"),void 0,n.meta.url))},{encounterTypeID:5,userProp:"patient type",label:"Patient Type",enableForDebugging:!1,component:B(()=>M(()=>n.import("./ARTPatientType-legacy-Di4KkhT7.js"),void 0,n.meta.url))},{label:"Filing Number Management",enableForDebugging:!1,component:B(()=>M(()=>n.import("./FilingNumberManagement-legacy-BnQhpyAM.js"),void 0,n.meta.url))},{encounterTypeID:9,userProp:"HIV first visits",enableForDebugging:!1,label:"HIV Clinic Registration",component:B(()=>M(()=>n.import("./ArtClinicRegistration-legacy-xO1JNKRI.js"),void 0,n.meta.url))},{encounterTypeID:51,userProp:"HIV reception visits",label:"Reception",enableForDebugging:!1,component:B(()=>M(()=>n.import("./Reception-legacy-PePUzJeP.js"),void 0,n.meta.url))},{encounterTypeID:6,otherWorkflowNames:["htn_vitals"],userProp:"vitals",label:"Vitals",enableForDebugging:!1,component:B(()=>M(()=>n.import("./Vitals-legacy-BGNeCdWG.js"),void 0,n.meta.url))},{encounterTypeID:52,userProp:"HIV staging visits",label:"Staging",enableForDebugging:!1,component:B(()=>M(()=>n.import("./Staging-legacy-D_KuPsK3.js"),void 0,n.meta.url))},{encounterTypeID:53,userProp:"HIV clinic consultations",label:"Consultation",enableForDebugging:!1,component:B(()=>M(()=>n.import("./Consultation-legacy-CrKAWUcA.js"),void 0,n.meta.url))},{encounterTypeID:68,userProp:"ART adherence",label:"ART Adherence",enableForDebugging:!1,component:B(()=>M(()=>n.import("./ARTAdherence-legacy-BGYxPAaU.js"),void 0,n.meta.url))},{encounterTypeID:25,userProp:"Prescriptions",label:"Prescription",enableForDebugging:!1,component:B(()=>M(()=>n.import("./Prescription-legacy-BplmNpmB.js"),void 0,n.meta.url))},{encounterTypeID:54,userProp:"Drug Dispensations",label:"Dispense drugs",enableForDebugging:!1,component:B(()=>M(()=>n.import("./ArtDispensation-legacy-CROuVdrH.js"),void 0,n.meta.url))},{encounterTypeID:7,userProp:"Manage Appointments",label:"Appointment",enableForDebugging:!1,component:B(()=>M(()=>n.import("./ARTAppointment-legacy-DV4_ansD.js"),void 0,n.meta.url))}],ie=o(),re=i(-1),ue=i(null),se=i([]),ce=i([]),pe=i(!1),de=i(-1),ge=i(""),ve=i(""),me=i("");function ye(e){var n;return!!e.enableForDebugging||!!e&&(!pe.value&&de.value===(null==e?void 0:e.encounterTypeID)||(null!==(n=null==e?void 0:e.otherWorkflowNames)&&void 0!==n?n:[]).includes(ge.value))}function be(){if(0===se.value.length||re.value===se.value.length-1)return!1;const e=se.value[re.value];return e&&ye(e)}async function fe(){me.value="",pe.value=!0,ve.value="",ge.value="";try{var e;const n=await O.nextTask(K.value.patientID);if(!n)return ve.value="No workflows found. You may exit this page or refresh",pe.value=!1,void(re.value=-1);ge.value=n.name,de.value=null!==(e=null==n?void 0:n.encounter_type_id)&&void 0!==e?e:-1;const t=se.value.findIndex(e=>{var n;return(null==e?void 0:e.encounterTypeID)===de.value||(null!==(n=e.otherWorkflowNames)&&void 0!==n?n:[]).includes(ge.value)});if(-1!==t){me.value=n.description;const e=[...se.value.slice(t),...se.value.slice(0,t)];se.value=e,re.value=0}else ve.value="Error loading workflow task",re.value=t}catch(n){ve.value="An error has occured while loading next task: "+n,console.error(n)}finally{await async function(){const e=await X.getEncounters(K.value.patientID,{date:O.getSessionDate()});ce.value=e.map(e=>e.encounter_type)}(),pe.value=!1}}function he(){(ue.value&&"function"==typeof ue.value.onSubmit?ue.value.onSubmit():Promise.resolve(!0)).then(e=>e&&fe())}return r(()=>t.fullPath,()=>{(async function(){re.value=-1,se.value=[];const e=await Q.getJson("user_properties",{property:"activities"});try{if(!e.property_value)return void(se.value=oe);const n=e.property_value.split(",").map(e=>e.toLowerCase());se.value=oe.filter(e=>{var t;return e.enableForDebugging||n.includes(null===(t=e.userProp)||void 0===t?void 0:t.toLowerCase())})}catch(n){G("Unable to load activities"),console.error(n)}})().then(fe)},{immediate:!0,deep:!0}),(e,n)=>(s(),u(d($),null,{default:c(()=>[p(J),p(d(g),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:c(()=>{var e;return[p(d(m),{contentId:"main"},{default:c(()=>[p(d(y),null,{default:c(()=>[se.value.length>0?(s(),u(d(f),{key:0},{default:c(()=>[(s(!0),b(h,null,D(se.value,(e,n)=>(s(),u(d(_),{onClick:e=>function(e){if(e<0||e>=se.value.length)return;const n=se.value[e];n&&ye(n)&&(re.value=e)}(n),lines:"none",key:n,disabled:!ye(e),button:""},{default:c(()=>{return[(n=e,ce.value.includes(null!==(t=null==n?void 0:n.encounterTypeID)&&void 0!==t?t:0)?(s(),u(d(k),{key:0,icon:d(x),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):ye(e)?(s(),u(d(k),{key:2,icon:d(I),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(s(),u(d(k),{key:1,icon:d(T),style:{padding:"10px"},slot:"start"},null,8,["icon"]))),v("b",null,w(e.label),1)];var n,t}),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(s(),b("div",Z,[p(d(k),{style:{"font-size":"2rem"},icon:d(P)},null,8,["icon"]),n[2]||(n[2]=v("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),p(d(F),null,{default:c(()=>[p(d(j),{color:"light"},{default:c(()=>[p(d(A),{onClick:n[0]||(n[0]=e=>d(ie).back())},{default:c(()=>[p(d(k),{icon:d(R),slot:"start"},null,8,["icon"]),n[3]||(n[3]=C(" Back to dashboard "))]),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),v("div",ee,[pe.value?(s(),b("div",ne,[v("div",te,[p(d(S),{name:"bubbles"}),n[4]||(n[4]=v("p",null,[v("h1",null,"Please wait...")],-1))])])):null!==(e=se.value[re.value])&&void 0!==e&&e.component?(s(),b("div",le,[p(d(V),null,{default:c(()=>[p(d(N),null,{default:c(()=>{var e;return[(s(),u(E,null,[(s(),u(z(null===(e=se.value[re.value])||void 0===e?void 0:e.component),{ref_key:"formRef",ref:ue},null,512))],1024))]}),_:1})]),_:1})])):(s(),b("div",ae,[p(d(k),{style:{color:"green","font-size":"80px"},icon:d(H)},null,8,["icon"]),v("h2",null,w(ve.value),1),p(d(A),{size:"large",fill:"clear",onClick:n[1]||(n[1]=e=>d(ie).back())},{default:c(()=>[p(d(k),{slot:"start",icon:d(W)},null,8,["icon"]),n[5]||(n[5]=C(" Exit page "))]),_:1,__:[5]})])),p(d(F),null,{default:c(()=>[p(d(j),{color:"light"},{default:c(()=>[be()?(s(),u(d(A),{key:0,onClick:he,color:"primary",style:{padding:"4px"},slot:"end"},{default:c(()=>[n[6]||(n[6]=C(" Save and continue ")),p(d(k),{style:{padding:"4px"},icon:d(Y),slot:"end"},null,8,["icon"])]),_:1,__:[6]})):L("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),[["__scopeId","data-v-c6bd1843"]]))}}});

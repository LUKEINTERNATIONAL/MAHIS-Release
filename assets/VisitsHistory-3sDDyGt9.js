import{d as G,aR as x,ck as Q,r as c,c as h,w as P,a as X,H as B,e as m,f as l,l as w,J as f,k as n,F,P as N,O as b,m as Z,K as I,u as ee,b3 as te}from"./vendor-Cb0zIxoC.js";import{aF as ae,u as se,y as ne,M as H,cc as oe,bo as R,K as le,s as ie,af as re,H as U,P as $,k as ce,_ as ue}from"./index-BRZ2qO42.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-BmfflAd_.js";const ve={class:"visitContent"},de={class:"visitData"},pe={class:"table-header"},me={class:"encounter-title"},fe={class:"table-responsive"},ye={key:0,class:"loading-state"},_e={key:1,class:"empty-state"},ge=G({__name:"VisitsHistory",setup(he){const z=ae(),{investigations:A}=x(z),T=se(),{patient:L}=x(T),K=ne(),{activeProgram:we}=x(K),M=Q();c(ce);const y=c([]),D=c([]),o=c(""),_=c([]),g=c(),v=c([]),k=c(!1),S=h(()=>{const e=new Set;return D.value.filter(t=>{var a;return((a=t.type)==null?void 0:a.name)&&!e.has(t.type.name)&&e.add(t.type.name)}).map(t=>{const a=t.type.name;return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()})}),q=h(()=>({paging:!0,lengthChange:!1,searching:!1,ordering:!0,info:!0,autoWidth:!0,responsive:!0,pageLength:8})),J=h(()=>[{data:"observation",title:"Observation"},{data:"value",title:"Value"},{data:"date",title:"Date"}]);h(()=>{var e;return(e=A.value[0])==null?void 0:e.selectedData});const W=async e=>{o.value=e,await C()},Y=async()=>{oe(async e=>{var t;R.voidEncounter((t=g.value)==null?void 0:t.encounter_id,e).then(async()=>{await V(_.value),le("Encounter has been voided!",2e3)}).catch(a=>{ie("".concat(a),32e3)})})},C=async()=>{var e,t;if(!o.value){v.value=[];return}k.value=!0;try{if(g.value=D.value.find(i=>{var r,u,d,p;return((u=(r=i.type)==null?void 0:r.name)==null?void 0:u.charAt(0).toUpperCase())+((p=(d=i.type)==null?void 0:d.name)==null?void 0:p.slice(1).toLowerCase())===o.value}),!((e=g.value)!=null&&e.observations)){v.value=[];return}const a=await Promise.all((t=g.value)==null?void 0:t.observations.map(async i=>{var u,d,p;const s=((p=(d=(u=i.concept)==null?void 0:u.concept_names)==null?void 0:d.find(O=>O.concept_name_type==="FULLY_SPECIFIED"||O.concept_name_type==="SHORT"))==null?void 0:p.name)||"Unknown Observation";let r=await re.resolvePrimaryValue(i)||"";return{observation:s,value:r,date:U.toStandardHisDisplayFormat(i.obs_datetime)}}));v.value=a}catch(a){console.error("Error loading table data:",a),v.value=[]}finally{k.value=!1}},E=async()=>{const e=new $;y.value=await $.getPatientVisits(e.getID(),!1),y.value.length>0&&await V(y.value[0])},j=e=>U.toStandardHisDisplayFormat(e),V=async e=>{_.value=e,D.value=await R.getEncounters(L.value.patientID,{date:e}),S.value.length>0&&(o.value=S.value[0],await C())};return P(L,async()=>{await E()},{deep:!0}),P(M,async()=>{await E()},{deep:!0}),P(o,async()=>{await C()}),X(async()=>{await E()}),(e,t)=>{const a=B("ion-col"),i=B("ion-row");return l(),m("div",ve,[w(i,null,{default:f(()=>[w(a,{size:"1.6",style:{height:"62vh","overflow-y":"auto","padding-right":"0px","padding-left":"0px"}},{default:f(()=>[n("div",null,[(l(!0),m(F,null,N(y.value,(s,r)=>(l(),b(H,{class:"",style:{"margin-bottom":"5px",width:"96%",height:"45px"},onClick:u=>V(s),key:r,name:j(s),fill:_.value!=s?"outline":"solid",color:_.value==s?"success":""},null,8,["onClick","name","fill","color"]))),128))])]),_:1}),w(a,{size:"2.5"},{default:f(()=>[n("div",null,[(l(!0),m(F,null,N(S.value,(s,r)=>(l(),b(H,{class:"",style:{"margin-bottom":"5px",width:"96%",height:"45px"},onClick:u=>W(s),key:r,name:s,fill:o.value!=s?"outline":"solid",color:o.value==s?"success":""},null,8,["onClick","name","fill","color"]))),128))])]),_:1}),w(a,{offset:"0.1",size:"7.8"},{default:f(()=>[n("div",de,[n("div",pe,[n("h3",me,I(o.value)+" Observations",1),o.value?(l(),b(H,{key:0,name:"Void Encounter",fill:"solid",color:"danger",onClick:t[0]||(t[0]=s=>Y())})):Z("",!0)]),n("div",fe,[k.value?(l(),m("div",ye,[...t[1]||(t[1]=[n("p",null,"Loading observations...",-1)])])):v.value.length===0&&o.value?(l(),m("div",_e,[n("p",null,"No observations found for "+I(o.value),1)])):(l(),b(ee(te),{key:2,ref:"dataTable",class:"display nowrap modern-table",width:"100%",data:v.value,columns:J.value,options:q.value},{default:f(()=>[...t[2]||(t[2]=[n("thead",null,[n("tr",null,[n("th",null,"Observation"),n("th",null,"Value"),n("th",null,"Date")])],-1)])]),_:1},8,["data","columns","options"]))])])]),_:1})]),_:1})])}}}),Ce=ue(ge,[["__scopeId","data-v-2f074c77"]]);export{Ce as default};

System.register(["./vendor-legacy-DLfzekdP.js","./useFormWizard-legacy-BLOPBHZX.js","./index-legacy-DU3kXu_2.js","./DemographicBar-legacy-CF6ZMo9h.js","./OPDOutcome-legacy-BtlUTWqh.js","./NextAppointment-legacy-Dtrzb9zw.js","./OPDPrintingModal-legacy-Cudcwt2a.js","./lodash-legacy-pOOc9Efu.js","./usePatientProfile-legacy-Cc9PoK0v.js","./apexcharts-legacy-Enwv79Pl.js","./patient_complaints_service-legacy-DcAnD5ml.js","./DashBox-legacy-BwBRJgdE.js","./useExposeFromStandardForm-legacy-BuZrd92k.js","./BasicForm-legacy-Cct0iG5C.js","./DateInputField-legacy-B4zJYKNm.js","./formatServerData-legacy-C64aab_M.js","./drug_prescription_service-legacy-kDcvNwI_.js","./drug_service-legacy-DXBdK5F5.js","./Outcome-legacy-eP0ah-bK.js","./lab_order-legacy-cHSuwCqG.js","./group_validation-legacy-BpsrGs-x.js","./ncd_appointment_service-legacy-B1TSz9eZ.js","./Registration-legacy-Bi451bHy.js","./useLocation-legacy-DGqqo9Xz.js","./vaccines_service-legacy-Bng1VaTb.js","./sms_service-legacy-CLO0xPaU.js","./EIRreportsStore-legacy-wgZ9LSVj.js","./Export-legacy-CWdwEmrm.js"],function(e,a){"use strict";var t,n,l,i,s,o,r,c,u,d,v,m,g,p,y,f,h,b,w,_,x,P,D,j,O,A,I,C,S,T,k,N,F,E,R,L,B,z,H,M,$,G,J,U,V,W,Y,Z,K,Q,X,q,ee,ae,te,ne,le,ie,se,oe,re,ce,ue,de,ve;return{setters:[e=>{t=e.d,n=e.ar,l=e.cm,i=e.r,s=e.a$,o=e.c,r=e.a,c=e.w,u=e.y,d=e.f,v=e.z,m=e.l,g=e.e,p=e.m,y=e.k,f=e.u,h=e.bN,b=e.d6,w=e.ah,_=e.i,x=e.bG,P=e.v,D=e.an,j=e.dJ,O=e.bg},e=>{A=e.u,I=e._},e=>{C=e.u,S=e.aC,T=e.aQ,k=e.a3,N=e.c,F=e.aE,E=e.O,R=e.a4,L=e.aR,B=e.aS,z=e.aI,H=e.T,M=e.D,$=e.t,G=e.C,J=e.m,U=e.ab,V=e.E,W=e.H,Y=e.aF,Z=e.aA,K=e.aT,Q=e.S,X=e._},e=>{q=e.D},e=>{ee=e.C,ae=e.O,te=e.a,ne=e.b},e=>{le=e.I,ie=e.N,se=e.s,oe=e.a,re=e.d,ce=e.b},e=>{ue=e.O},e=>{de=e.l},e=>{ve=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".disabled[data-v-fe3a3a34]{color:red}.spinner-overlay[data-v-fe3a3a34]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-fe3a3a34]{width:80px;height:80px}.loading-text[data-v-fe3a3a34]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-fe3a3a34]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-fe3a3a34]{pointer-events:none}.back_profile[data-v-fe3a3a34]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(a);const me={key:0,class:"spinner-overlay"},ge={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},pe={class:"back_profile"};e("default",X(t({__name:"ConsultationPlan",setup(e){const{currentTabIndex:a}=A("Consultation Plan"),{printVisitSummary:t}=ve(),X=n(),ye=l(),fe=i(!1),he=i(!0),be=i(!1),we=i(!1),_e=i(!0),xe=i(!1),Pe=i(!1),De=i(!1),je=C(),Oe=S(),Ae=T(),Ie=k(),Ce=N(),Se=F(),Te=E(),ke=R(),Ne=L(),Fe=B(),{patient:Ee}=s(je),{investigations:Re}=s(Oe),{OPDdiagnosis:Le}=s(Ae),{selectedMedicalDrugsList:Be,nonPharmalogicalTherapyAndOtherNotes:ze}=s(Ie),{OPDActivities:He}=s(Ce),{outcomes:Me}=s(Se),{currentSelectedNextAppointmentDate:$e}=s(Ne),{presentingComplaints:Ge}=s(Fe),{vitals:Je}=s(ke),Ue=z(),Ve=o(()=>Ue.selectedMedicalAllergiesList),We=i(null),Ye=i(null),Ze=i(null),Ke=i(null),Qe=i(null),Xe=i(null),qe=i(null),ea=()=>He.value.map(e=>({title:e,icon:""})),aa=i(ea()),ta=i({}),na=async(e,t,n)=>{0===t&&await ua(),await oa()?(await ra(),e%1==0&&(a.value=e),qe.value&&n&&qe.value.changeTab(e)):$("Please add presenting complaints before proceeding.")},la=()=>{var e;if(!aa.value||0===aa.value.length)return null;const t=a.value>=0&&a.value<aa.value.length?a.value:0;switch(null===(e=aa.value[t])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(He.value.length>0)switch(He.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},ia=async()=>{we.value=!0,G("Printing consultation summary... Please wait.");try{await t(),G("Consultation summary printed successfully!"),setTimeout(()=>{X.push("home")},3500)}catch(e){J("Failed to print consultation summary.")}finally{we.value=!1}},sa=()=>{G("Patient has finished consultation!"),X.push("home")},oa=async()=>{const e=await U.getObsByEncounterIdAndDate(V.PRESENTING_COMPLAINTS);return!!(e&&e.length>0)},ra=async()=>{const e=W.sessionDate();for(let t=0;t<aa.value.length;t++)if(await oa()){he.value=!0,be.value=!1;const n=aa.value[t];if(ta.value={title:"Untitled"},"Clinical Assessment"===n.title){const a=Y("presentingComplaints");aa.value[t].icon=ca(e,a)?O:""}else if("Investigations"===n.title){var a;const n=null===(a=Ee.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,l=null==n?void 0:n.filter(a=>W.toStandardHisFormat(e)===W.toStandardHisFormat(a.order_date));aa.value[t].icon=(null==l?void 0:l.length)>0?O:""}else if("Diagnosis"===n.title){const a=Y("diagnosis");aa.value[t].icon=ca(e,a)?O:""}else if("Treatment Plan"===n.title){const e=Y("treatment");aa.value[t].icon=(null==e?void 0:e.length)>0?O:""}else if("Next Appointment"===n.title){const a=Y("appointments");aa.value[t].icon=ca(e,a)?O:""}else if("Outcome"===n.title){const e=Y("outcomes");aa.value[t].icon=(null==e?void 0:e.length)>0?O:""}}else he.value=!1,"Clinical Assessment"!==aa.value[t].title&&(aa.value[t].icon=j)},ca=(e,a)=>{if(!a)return!1;const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime||e.order_date);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},ua=async()=>{fe.value=!0;try{var e;await da(),await Promise.all([null===(e=We.value)||void 0===e?void 0:e.onSubmit()]),await Z(Ee.value),K()}catch(a){throw console.error("Error saving clinical assessment:",a),J("Failed to save clinical assessment"),a}finally{fe.value=!1}},da=async()=>{try{if(!de.isEmpty(Ve.value)){const e=va();await se(e)}}catch(e){console.error("Failed to save allergies:",e),$("Failed to save allergies")}},va=()=>Ve.value.map(e=>({concept_id:985,obs_datetime:Q.getSessionDate(),value_coded:e.concept_id,location_id:Te.facilityLocation.code})),ma=async()=>{try{var e;null!==(e=Ze.value)&&void 0!==e&&e.onSubmit(),await(async()=>{try{if(!de.isEmpty(ze.value)){const e=[{concept_id:2688,obs_datetime:localStorage.getItem("sessionDate"),value_text:ze.value,location_id:Te.facilityLocation.code}];await oe(e)}await re(),await ce().saveNonPharmaTherapyPatientData()}catch(e){console.error("Failed to save treatment plan:",e),$("Failed to save treatment plan")}})(),await Se.saveOutcomPatientData(),await K(),await Z(Ee.value);const a=localStorage.getItem("locationID"),t=localStorage.getItem("userRoles");if(!a)return void J("Location ID could not be found. Please check your settings.");(t?JSON.parse(t):[]).some(e=>"Lab"===e.role)}catch(a){console.error("Error saving consultation data:",a),J("Failed to save consultation data")}};return r(async()=>{0!==He.value.length?(aa.value=ea(),await ra(),(void 0===a.value||a.value<0)&&(a.value=0)):await X.push("home")}),c(Je,async()=>{await ra()},{deep:!0}),c(Ee,async()=>{await ra()},{deep:!0}),c(Re,async()=>{await ra()},{deep:!0}),c(Le,async()=>{await ra()},{deep:!0}),c(Be,async()=>{await ra()},{deep:!0}),c(Me,async()=>{await ra()},{deep:!0}),c($e,async()=>{await ra()}),c(Ge,async()=>{await ra()},{deep:!0}),c(ye,async()=>{_e.value=!1,setTimeout(()=>{a.value=0,_e.value=!0},0)},{deep:!0}),c(De,e=>{Pe.value=e,Pe.value&&setTimeout(()=>{Pe.value=!1},15e3)}),(e,a)=>(d(),u(f(D),null,{default:v(()=>[m(ue,{onYes:ia,onNo:sa,isOpen:xe.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),fe.value?(d(),g("div",me,[m(f(h),{name:"bubbles"}),a[2]||(a[2]=y("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),m(f(b),{"is-open":we.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),m(H),m(f(w),{fullscreen:!0},{default:v(()=>[m(q),y("div",ge,[_e.value?(d(),u(I,{key:0,ref_key:"wizard",ref:qe,"vertical-tabs":"","navigable-tabs":he.value,"scrollable-tabs":"",startIndex:0,doneButton:{text:"Finish",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},nextButton:{disabled:be.value},"custom-tabs":aa.value,tabs:aa.value,onChange:na,"onComplete:wizard":a[1]||(a[1]=e=>ma())},{default:v(()=>[y("div",null,[y("div",pe,[m(M,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:f(x),"font-weight":"600",onClick:a[0]||(a[0]=e=>{X.push("home")})},null,8,["icon"])])]),_(y("div",null,[m(ee,{ref_key:"clinicalAssessmentRef",ref:We},null,512)],512),[[P,"ClinicalAssessment"===la()]]),_(y("div",null,[m(le,{ref_key:"investigationsRef",ref:Ye},null,512)],512),[[P,"Investigations"===la()]]),_(y("div",null,[m(ae,{ref_key:"diagnosisRef",ref:Ze},null,512)],512),[[P,"OPDDiagnosis"===la()]]),_(y("div",null,[m(te,{ref_key:"treatmentPlanRef",ref:Ke},null,512)],512),[[P,"OPDTreatmentPlan"===la()]]),_(y("div",null,[m(ie,{ref_key:"nextAppointmentRef",ref:Qe},null,512)],512),[[P,"NextAppointment"===la()]]),_(y("div",null,[m(ne,{ref_key:"outcomeRef",ref:Xe},null,512)],512),[[P,"Outcome"===la()]])]),_:1},8,["navigable-tabs","nextButton","custom-tabs","tabs"])):p("",!0)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-fe3a3a34"]]))}}});

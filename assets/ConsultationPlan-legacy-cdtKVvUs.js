System.register(["./vendor-legacy-B0ctPPIE.js","./useFormWizard-legacy-IhU4oFLK.js","./index-legacy-C02G1k2R.js","./DemographicBar-legacy-find_u7y.js","./OPDOutcome-legacy-CdiYztcT.js","./NextAppointment-legacy-DIajYJVa.js","./OPDPrintingModal-legacy-Brn9MvEP.js","./lodash-legacy-pOOc9Efu.js","./usePatientProfile-legacy-B-crxeT8.js","./apexcharts-legacy-BwM20G2n.js","./patient_complaints_service-legacy-CUCczy_f.js","./DashBox-legacy-BWouHZRD.js","./useExposeFromStandardForm-legacy-Bmrh-G6J.js","./BasicForm-legacy-zQthsJ5A.js","./DateInputField-legacy-BxNxXqcE.js","./formatServerData-legacy-BlvsLowh.js","./drug_prescription_service-legacy-M1kUmj0I.js","./drug_service-legacy-CV5uvaeW.js","./Outcome-legacy-A-_-zswJ.js","./lab_order-legacy-DYA6Uwbk.js","./userService-legacy-uzxwJrPt.js","./group_validation-legacy-B46ZHf17.js","./ncd_appointment_service-legacy-C20vispM.js","./Registration-legacy-E9UC6ax0.js","./useLocation-legacy-kXtu_nTM.js","./vaccines_service-legacy-BEsvKi34.js","./sms_service-legacy-CeXUcIaq.js","./EIRreportsStore-legacy-BVtuVEy5.js","./Export-legacy-9x9ZATGi.js"],function(e,a){"use strict";var t,n,l,i,s,o,r,c,u,d,v,m,g,p,y,f,h,b,w,_,D,x,P,I,O,j,T,S,C,A,N,k,F,E,L,B,R,z,M,H,U,V,W,$,G,Y,Z,J,Q,q,K,X,ee,ae,te,ne,le,ie,se,oe,re,ce,ue,de,ve,me;return{setters:[e=>{t=e.d,n=e.ar,l=e.cl,i=e.r,s=e.a$,o=e.a,r=e.w,c=e.y,u=e.f,d=e.z,v=e.l,m=e.e,g=e.m,p=e.k,y=e.u,f=e.bM,h=e.d5,b=e.ah,w=e.i,_=e.bG,D=e.v,x=e.an,P=e.dI,I=e.bg},e=>{O=e.u,j=e._},e=>{T=e.u,S=e.az,C=e.aM,A=e.a1,N=e.c,k=e.aB,F=e.N,E=e.a2,L=e.aN,B=e.aO,R=e.T,z=e.D,M=e.t,H=e.z,U=e.n,V=e.a8,W=e.E,$=e.H,G=e.aC,Y=e.ax,Z=e.aP,J=e.S,Q=e.k,q=e.l,K=e._},e=>{X=e.D},e=>{ee=e.C,ae=e.O,te=e.a,ne=e.b},e=>{le=e.I,ie=e.N,se=e.T,oe=e.s,re=e.a,ce=e.d,ue=e.b},e=>{de=e.O},e=>{ve=e.l},e=>{me=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".disabled[data-v-e0a12cad]{color:red}.spinner-overlay[data-v-e0a12cad]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-e0a12cad]{width:80px;height:80px}.loading-text[data-v-e0a12cad]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-e0a12cad]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-e0a12cad]{pointer-events:none}.back_profile[data-v-e0a12cad]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(a);const ge={key:0,class:"spinner-overlay"},pe={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},ye={class:"back_profile"};e("default",K(t({__name:"ConsultationPlan",setup(e){const{onTabBeforeChange:a,onChangeCurrentTab:t,currentTabIndex:K}=O("Consultation Plan"),{printVisitSummary:fe}=me(),he=n(),be=l(),we=i(!1),_e=i(!0),De=i(!1),xe=i(!1),Pe=i(!0),Ie=i(!1),Oe=i(!1),je=i(!1),Te=T(),Se=S(),Ce=C(),Ae=A(),Ne=N(),ke=k(),Fe=F(),Ee=E(),Le=L(),Be=B(),{patient:Re}=s(Te),{investigations:ze}=s(Se),{OPDdiagnosis:Me}=s(Ce),{selectedMedicalDrugsList:He,nonPharmalogicalTherapyAndOtherNotes:Ue,selectedMedicalAllergiesList:Ve}=s(Ae),{OPDActivities:We}=s(Ne),{outcomes:$e}=s(ke),{currentSelectedNextAppointmentDate:Ge}=s(Le),{presentingComplaints:Ye}=s(Be),{vitals:Ze}=s(Ee),Je=i(null),Qe=i(null),qe=i(null),Ke=i(null),Xe=i(null),ea=i(null),aa=i(null),ta=()=>We.value.map(e=>({title:e,icon:""})),na=i(ta()),la=i({}),ia=async e=>{await va(),await ca()?(await ua(),e%1==0&&(K.value=e),aa.value&&aa.value.changeTab(e)):M("Please add presenting complaints before proceeding.")},sa=()=>{var e;if(!na.value||0===na.value.length)return null;const a=K.value>=0&&K.value<na.value.length?K.value:0;switch(null===(e=na.value[a])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(We.value.length>0)switch(We.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},oa=async()=>{xe.value=!0,H("Printing consultation summary... Please wait.");try{await fe(),H("Consultation summary printed successfully!"),setTimeout(()=>{he.push("home")},3500)}catch(e){U("Failed to print consultation summary.")}finally{xe.value=!1}},ra=()=>{H("Patient has finished consultation!"),he.push("home")},ca=async()=>(await V.getObsByEncounterIdAndDate(W.PRESENTING_COMPLAINTS)).length>0,ua=async()=>{const e=$.sessionDate();for(let t=0;t<na.value.length;t++)if(await ca()){_e.value=!0,De.value=!1;const n=na.value[t];if(la.value={title:"Untitled"},"Clinical Assessment"===n.title){const a=G("presentingComplaints");na.value[t].icon=da(e,a)?I:""}else if("Investigations"===n.title){var a;const n=null===(a=Re.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,l=null==n?void 0:n.filter(a=>$.toStandardHisFormat(e)===$.toStandardHisFormat(a.order_date));na.value[t].icon=(null==l?void 0:l.length)>0?I:""}else if("Diagnosis"===n.title){const a=G("diagnosis");na.value[t].icon=da(e,a)?I:""}else if("Treatment Plan"===n.title){const e=G("treatment");na.value[t].icon=(null==e?void 0:e.length)>0?I:""}else if("Next Appointment"===n.title){const a=G("appointments");na.value[t].icon=da(e,a)?I:""}else if("Outcome"===n.title){const e=G("outcomes");na.value[t].icon=(null==e?void 0:e.length)>0?I:""}}else _e.value=!1,"Clinical Assessment"!==na.value[t].title&&(na.value[t].icon=P)},da=(e,a)=>{if(!a)return!1;const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime||e.order_date);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},va=async()=>{we.value=!0;try{var e;await Promise.all([null===(e=Je.value)||void 0===e?void 0:e.onSubmit(),ma()]),await Y(Re.value),Z()}catch(a){throw console.error("Error saving clinical assessment:",a),U("Failed to save clinical assessment"),a}finally{we.value=!1}},ma=async()=>{try{const e=localStorage.getItem("userID"),a=Re.value.patientID;if(!ve.isEmpty(Ve.value)){const t=ga(),n=new se;await n.onSubmitAllergies(a,e,t),await oe(t)}}catch(e){console.error("Failed to save allergies:",e),M("Failed to save allergies")}},ga=()=>Ve.value.map(e=>({concept_id:985,obs_datetime:J.getSessionDate(),value_coded:e.concept_id,location_id:Fe.facilityLocation.code})),pa=async()=>{try{var e;null!==(e=qe.value)&&void 0!==e&&e.onSubmit(),await(async()=>{try{const e=localStorage.getItem("userID"),a=Re.value.patientID,t=new se;if(!ve.isEmpty(Ve.value)){const n=ga();await t.onSubmitAllergies(a,e,n)}if(!ve.isEmpty(Ue.value)){const e=[{concept_id:2688,obs_datetime:localStorage.getItem("sessionDate"),value_text:Ue.value,location_id:Fe.facilityLocation.code}];await re(e)}await ce(),await ue().saveNonPharmaTherapyPatientData()}catch(e){console.error("Failed to save treatment plan:",e),M("Failed to save treatment plan")}})(),await ke.saveOutcomPatientData(),await Z(),await Y(Re.value);const a=localStorage.getItem("locationID"),t=localStorage.getItem("userRoles");if(!a)return void U("Location ID could not be found. Please check your settings.");const n=t?JSON.parse(t):[];n.some(e=>"Lab"===e.role)?(await Q.movePatientToNextStage(Re.value.patientID,"LAB","CONSULTATION",a,Re.value.visitID||Re.value.visit_id),await q().refresh(a),await he.push("home"),H("Lab results submitted. Patient can return to consultation")):(await Q.movePatientToNextStage(Re.value.patientID,"CONSULTATION","DISPENSATION",a,Re.value.visitID||Re.value.visit_id),await q().refresh(a),await he.push("home"),H("Consultation patient saved successfully."))}catch(a){console.error("Error saving consultation data:",a),U("Failed to save consultation data")}};return o(async()=>{0!==We.value.length?(na.value=ta(),await ua(),(void 0===K.value||K.value<0)&&(K.value=0)):await he.push("home")}),r(Ze,async()=>{await ua()},{deep:!0}),r(Re,async()=>{await ua()},{deep:!0}),r(ze,async()=>{await ua()},{deep:!0}),r(Me,async()=>{await ua()},{deep:!0}),r(He,async()=>{await ua()},{deep:!0}),r($e,async()=>{await ua()},{deep:!0}),r(Ge,async()=>{await ua()}),r(Ye,async()=>{await ua()},{deep:!0}),r(be,async()=>{Pe.value=!1,setTimeout(()=>{K.value=0,Pe.value=!0},0)},{deep:!0}),r(je,e=>{Oe.value=e,Oe.value&&setTimeout(()=>{Oe.value=!1},15e3)}),(e,n)=>(u(),c(y(x),null,{default:d(()=>[v(de,{onYes:oa,onNo:ra,isOpen:Ie.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),we.value?(u(),m("div",ge,[v(y(f),{name:"bubbles"}),n[2]||(n[2]=p("div",{class:"loading-text"},"Please wait...",-1))])):g("",!0),v(y(h),{"is-open":xe.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),v(R),v(y(b),{fullscreen:!0},{default:d(()=>[v(X),p("div",pe,[Pe.value?(u(),c(j,{key:0,ref_key:"wizard",ref:aa,"vertical-tabs":"","navigable-tabs":_e.value,"scrollable-tabs":"",startIndex:0,doneButton:{text:"Finish",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},nextButton:{disabled:De.value},"custom-tabs":na.value,tabs:na.value,beforeChange:y(a),onChange:y(t),onOnValidateTabs:ia,"onComplete:wizard":n[1]||(n[1]=e=>pa())},{default:d(()=>[p("div",null,[p("div",ye,[v(z,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:y(_),"font-weight":"600",onClick:n[0]||(n[0]=e=>{he.push("home")})},null,8,["icon"])])]),w(p("div",null,[v(ee,{ref_key:"clinicalAssessmentRef",ref:Je},null,512)],512),[[D,"ClinicalAssessment"===sa()]]),w(p("div",null,[v(le,{ref_key:"investigationsRef",ref:Qe},null,512)],512),[[D,"Investigations"===sa()]]),w(p("div",null,[v(ae,{ref_key:"diagnosisRef",ref:qe},null,512)],512),[[D,"OPDDiagnosis"===sa()]]),w(p("div",null,[v(te,{ref_key:"treatmentPlanRef",ref:Ke},null,512)],512),[[D,"OPDTreatmentPlan"===sa()]]),w(p("div",null,[v(ie,{ref_key:"nextAppointmentRef",ref:Xe},null,512)],512),[[D,"NextAppointment"===sa()]]),w(p("div",null,[v(ne,{ref_key:"outcomeRef",ref:ea},null,512)],512),[[D,"Outcome"===sa()]])]),_:1},8,["navigable-tabs","nextButton","custom-tabs","tabs","beforeChange","onChange"])):g("",!0)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-e0a12cad"]]))}}});

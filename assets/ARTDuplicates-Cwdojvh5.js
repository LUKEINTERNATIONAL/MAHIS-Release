import{d as N,ar as A,y as D,f as u,z as e,l as a,u as t,U as O,T as U,A as c,B as f,aR as W,W as w,br as V,ai as B,aj as R,b0 as S,aZ as $,k as l,e as _,F as C,L as k,ah as F,X as L,r as v,a as j,w as H,a$ as K,a_ as X,m as Z,ak as q,G as J,D as Q,bw as Y,bx as ee,an as te}from"./vendor-CIsx_7JK.js";import{aK as le,u as ae,_ as P,I as z,az as y,ay as g,T as ne,bO as ie}from"./index-CbQ91zky.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-w2hOLJF3.js";const se={class:"appointments-table"},oe=N({__name:"DuplicateDetailsModal",props:{patients:{},identifierLabel:{}},setup(x){const h=A();function I(){L.dismiss()}async function p(o){await le(),await ae().setPatientRecord(o),h.replace({path:"/patientProfile"}),I()}return(o,r)=>(u(),D(t(F),null,{default:e(()=>[a(t(O),null,{default:e(()=>[a(t(U),null,{default:e(()=>[c("Duplicate Details for "+f(o.identifierLabel),1)]),_:1}),a(t(W),{slot:"end"},{default:e(()=>[a(t(w),{onClick:I},{default:e(()=>r[0]||(r[0]=[c("Close",-1)])),_:1,__:[0]})]),_:1})]),_:1}),a(t(V),null,{default:e(()=>[a(t(B),null,{default:e(()=>[a(t(R),{size:"12","size-md":"10","offset-md":"1"},{default:e(()=>[a(t(S),null,{default:e(()=>[a(t($),{class:"table-responsive"},{default:e(()=>[l("table",se,[r[2]||(r[2]=l("thead",null,[l("tr",null,[l("th",null,"Given Name"),l("th",null,"Family Name"),l("th",null,"Gender"),l("th",null,"Birth Date"),l("th",null,"Action")])],-1)),l("tbody",null,[(u(!0),_(C,null,k(o.patients,d=>(u(),_("tr",{key:d.person_id},[l("td",null,f(d.given_name),1),l("td",null,f(d.family_name),1),l("td",null,f(d.gender),1),l("td",null,f(d.birthdate),1),l("td",null,[a(t(w),{size:"small",fill:"clear",onClick:b=>p(d.patient)},{default:e(()=>r[1]||(r[1]=[c(" View Details ",-1)])),_:2,__:[1]},1032,["onClick"])])]))),128))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),re=P(oe,[["__scopeId","data-v-0a1b5e58"]]),ue={key:0,class:"table-responsive"},de={class:"appointments-table"},fe={key:1,class:"ion-text-center ion-padding"},ce=N({__name:"ARTDuplicates",setup(x){const h=A(),I=v("Duplicate Identifiers"),p=v([]),o=v(null),r=v([]),d=v(!1),b=v(new z);j(async()=>{await y.show();try{const i=await z.getIdentifierTypes();p.value=i.map(n=>({label:n.name,value:n.patient_identifier_type_id})),p.value.length>0&&(o.value=p.value[0].value)}catch(i){console.error("Error initializing:",i),g("Failed to load identifier types")}finally{await y.hide()}}),H(o,async i=>{i&&await E()});async function E(){if(o.value){await y.show();try{const i=p.value.find(s=>s.value===o.value);I.value=i?"".concat(i.label," Duplicates"):"Duplicate Identifiers",b.value.setIdentifierType(o.value);const n=await b.value.getDuplicateIndentifiers();r.value=Array.isArray(n)?n:[],d.value=!0}catch(i){console.error("Error fetching duplicates:",i),g("Failed to fetch duplicate identifiers"),r.value=[]}finally{await y.hide()}}}async function G(i){await y.show();try{const s=(await b.value.getPatientsByIdentifier(i)).map(m=>{try{return{person_id:m.patient_id,given_name:m.person.names[0].given_name,family_name:m.person.names[0].family_name,gender:m.person.gender,birthdate:ie(m.person.birthdate),patient:m}}catch(pe){return{person_id:0,given_name:"N/A",family_name:"N/A",gender:"N/A",birthdate:"N/A",patient:{}}}});await(await L.create({component:re,componentProps:{patients:s,identifierLabel:i},cssClass:"large-modal"})).present()}catch(n){console.error("Error viewing duplicate details:",n),g("Failed to load patient details")}finally{await y.hide()}}function M(i){h.push("/npid/duplicates/".concat(i))}return(i,n)=>(u(),D(t(te),null,{default:e(()=>[a(ne,{title:"Duplicate Identifiers"}),a(t(F),null,{default:e(()=>[a(t(V),null,{default:e(()=>[a(t(B),null,{default:e(()=>[a(t(R),{size:"12","size-md":"10","size-lg":"8","offset-md":"1","offset-lg":"2"},{default:e(()=>[a(t(S),null,{default:e(()=>[a(t(K),null,{default:e(()=>[a(t(X),null,{default:e(()=>[c(f(I.value),1)]),_:1})]),_:1}),a(t($),null,{default:e(()=>[a(t(q),null,{default:e(()=>[a(t(J),null,{default:e(()=>[a(t(Q),{position:"stacked"},{default:e(()=>n[1]||(n[1]=[c("Select Identifier Type",-1)])),_:1,__:[1]}),a(t(Y),{modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=s=>o.value=s)},{default:e(()=>[(u(!0),_(C,null,k(p.value,s=>(u(),D(t(ee),{key:s.value,value:s.value},{default:e(()=>[c(f(s.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),r.value.length>0?(u(),_("div",ue,[l("table",de,[n[4]||(n[4]=l("thead",null,[l("tr",null,[l("th",null,"Identifier"),l("th",null,"Count"),l("th",null,"View"),l("th",null,"Resolve")])],-1)),l("tbody",null,[(u(!0),_(C,null,k(r.value,s=>(u(),_("tr",{key:s.identifier},[l("td",null,f(s.identifier),1),l("td",null,f(s.count),1),l("td",null,[a(t(w),{size:"small",fill:"outline",onClick:T=>G(s.identifier)},{default:e(()=>n[2]||(n[2]=[c(" View ",-1)])),_:2,__:[2]},1032,["onClick"])]),l("td",null,[a(t(w),{size:"small",color:"danger",fill:"outline",onClick:T=>M(s.identifier),disabled:o.value!==3},{default:e(()=>n[3]||(n[3]=[c(" Resolve ",-1)])),_:2,__:[3]},1032,["onClick","disabled"])])]))),128))])])])):r.value.length===0&&d.value?(u(),_("div",fe,n[5]||(n[5]=[l("p",null,"No duplicate identifiers found",-1)]))):Z("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),Ie=P(ce,[["__scopeId","data-v-f930c1ab"]]);export{Ie as default};

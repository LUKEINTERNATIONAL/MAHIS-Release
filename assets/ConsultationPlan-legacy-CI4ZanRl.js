System.register(["./vendor-legacy-D91hwdTu.js","./index-legacy-B6UJZlMa.js","./DemographicBar-legacy-DqsqcqHy.js","./TreatmentPlan-legacy-D-enRsGw.js","./NextAppointment-legacy-D0t4r0Vq.js","./RiskAssessment.vue_vue_type_script_setup_true_lang-legacy-BDiFM2yB.js","./Vitals.vue_vue_type_script_setup_true_lang-legacy-BP2M-tDE.js","./useFormWizard-legacy-C1CNU7Tq.js","./lodash-legacy-C-x9g9Na.js","./formatServerData-legacy-D0rCxRDW.js","./Registration-legacy-DGNSTdJi.js","./usePatientProfile-legacy-BO_vs5nA.js","./apexcharts-legacy-CtmrvmGp.js","./DashBox-legacy-51--m1OT.js","./BasicForm-legacy-BTN1S8Dj.js","./DateInputField-legacy-i6aN-EVp.js","./previousDiagnosis-legacy-DRTz3cUW.js","./group_validation-legacy-CYKdDyQc.js","./LabOrdersList-legacy-BR3fnHLY.js","./drug_prescription_service-legacy-BfztBuNF.js","./ncd_appointment_service-legacy-CGWAfv0O.js","./useLocation-legacy-C015_KCy.js","./vaccines_service-legacy-DDH84xeD.js","./sms_service-legacy-zPu_ItF7.js","./EIRreportsStore-legacy-BF2Be4sz.js","./Export-legacy-bPBpIl_n.js","./Outcome-legacy-BMBV3_Sw.js"],(function(e,t){"use strict";var a,n,s,l,i,o,c,u,r,v,d,g,p,m,y,f,h,_,b,D,w,S,C,j,x,k,A,P,I,R,T,N,V,L,B,O,F,z,H,E,M,$,J,W,G,K,Q,U,Y,Z,q,X,ee,te,ae,ne,se,le,ie,oe,ce,ue,re,ve,de,ge;return{setters:[e=>{a=e.d,n=e.an,s=e.cC,l=e.r,i=e.c,o=e.aV,c=e.w,u=e.a,r=e.O,v=e.f,d=e.J,g=e.l,p=e.u,m=e.a3,y=e.k,f=e.m,h=e.i,_=e.bG,b=e.v,D=e.a6,w=e.b9},e=>{S=e.aG,C=e.u,j=e.aH,x=e.aI,k=e.aJ,A=e.aK,P=e.d,I=e.aL,R=e.g,T=e.$,N=e.e,V=e.T,L=e.K,B=e.Q,O=e.H,F=e.aM,z=e.aN,H=e.aO,E=e.aP,M=e.t,$=e.m,J=e.aQ,W=e.J,G=e.aR,K=e.a1,Q=e.S},e=>{U=e.D},e=>{Y=e.u,Z=e.D,q=e.C,X=e.T},e=>{ee=e.I,te=e.N,ae=e.s,ne=e.c,se=e.u},e=>{le=e._},e=>{ie=e._},e=>{oe=e.u,ce=e._},e=>{ue=e.l},e=>{re=e.a,ve=e.b},e=>{de=e.C},e=>{ge=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){const t={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},pe={class:"back_profile"};e("default",a({__name:"ConsultationPlan",setup(e,{expose:a}){const{onTabBeforeChange:me,currentTabIndex:ye}=oe("Consultation Plan"),{printVisitSummary:fe}=ge(),he=n(),_e=s();l([]),l([]),l(!1);const be=l(!0),De=l(!1),we=l(!1),Se=i((()=>({text:we.value?"Saving...":"Finish",icon:we.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:De.value||we.value}))),Ce=S(),je=C(),xe=j(),ke=x();k();const Ae=A(),Pe=P();I();const Ie=R(),Re=Y(),Te=T(),{patient:Ne}=o(je),{vitals:Ve}=o(Ce),{investigations:Le}=o(xe),{diagnosis:Be}=o(ke),{substance:Oe}=o(Ie),{selectedNCDMedicationList:Fe}=o(Ae),{FootScreening:ze,visualScreening:He,cvScreening:Ee}=o(Re),{sessionDate:Me}=o(Te),{apiStatus:$e}=o(N());c(Se,((e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:ye.value,tabsLength:Ke.value.length}),e.disabled!==(null==t?void 0:t.disabled)&&console.log("Done button "+(e.disabled?"disabled":"enabled")),e.text!==(null==t?void 0:t.text)&&console.log(`Done button text changed from "${null==t?void 0:t.text}" to "${e.text}"`)}),{deep:!0}),c(we,((e,t)=>{e!==t&&(console.log(`Saving state changed: ${t} -> ${e}`),e?console.log("Starting save process..."):console.log("Save process completed"))}));const Je=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},We=()=>{let e=!1;return tt(),we.value&&(e=!0),De.value=e,!e},Ge=()=>Pe.NCDActivities.map((e=>({title:e,icon:""}))),Ke=l(Ge()),Qe=l(null),Ue=l(null),Ye=l(null),Ze=l(null),qe=l(null),Xe=l(null),et=l(null),tt=()=>{var e;if(!Ke.value||0===Ke.value.length)return console.log("Tabs not yet initialized"),null;const t=ye.value>=0&&ye.value<Ke.value.length?ye.value:0;switch(null===(e=Ke.value[t])||void 0===e?void 0:e.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(Pe.NCDActivities.length>0)switch(Pe.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},at=()=>{be.value=!1,setTimeout((()=>{ye.value=0,be.value=!0}),0)},nt=()=>{const e=S();e.setVitals(e.getInitialVitals(Ne.value.ID))},st=async()=>{const e=B(Me.value,"sessionDate","value")||O.sessionDate(),t=F("vitals");for(let n=0;n<Ke.value.length;n++){const s=Ke.value[n];if("Vital Signs"===s.title)Ke.value[n].icon=lt(e,t)?w:"";else if("Risk Assessment"===s.title){const t=F("substanceAbuse");Ke.value[n].icon=lt(e,t)?w:""}else if("Investigations"===s.title){var a;const t=null==Ne||null===(a=Ne.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,s=null==t?void 0:t.filter((t=>O.toStandardHisFormat(e)===O.toStandardHisFormat(t.order_date)));Ke.value[n].icon=(null==s?void 0:s.length)>0?w:""}else if("Diagnosis"===s.title){const t=F("diagnosis");Ke.value[n].icon=lt(e,t)?w:""}else if("Complications Screening"===s.title){const t=F("screening");Ke.value[n].icon=lt(e,t)?w:""}else"Treatment Plan"===s.title&&(Fe.value.length>0?Ke.value[n].icon=z()?w:"":Ke.value[n].icon="")}We()},lt=(e,t)=>{const a=new Date(e);return a.setHours(0,0,0,0),t.some((e=>{const t=new Date(e.obs_datetime);return t.setHours(0,0,0,0),t.getTime()===a.getTime()}))},it=async(e,t)=>{var a;const n=null===(a=Ke.value[t])||void 0===a?void 0:a.title;var s,l;e%1==0&&(ye.value=e),"Vital Signs"==n&&(null===(s=Qe.value)||void 0===s||s.onSubmit()),"Risk Assessment"==n&&(null===(l=Ue.value)||void 0===l||l.onSubmit()),"Complications Screening"==n&&await(async()=>{const e=[],t=await re(He.value),a=await ve(ze.value),n=await re(Ee.value);var s,l,i,o;t.length>0&&e.push({concept_id:await J.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:J.getSessionDate(),child:t}),a.length>0&&e.push({concept_id:await J.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:J.getSessionDate(),child:a}),n.length>0&&e.push(...n),e.length>0?(null!==(l=(s=null!==(o=(i=Ne.value).screening)&&void 0!==o?o:i.screening={}).unsaved)&&void 0!==l||(s.unsaved=[]),Ne.value.screening.unsaved.push(...e),W("Complications saved successfully")):M("No complications data to save")})(),"Treatment Plan"==n&&await(async()=>{const e=G();if(!ue.isEmpty(e.selectedMedicalAllergiesList)){const t=K(),a=e.selectedMedicalAllergiesList.map((e=>({concept_id:e.concept_id,obs_datetime:Q.getSessionDate(),value_coded:e.concept_id,location_id:t.facilityLocation.code,value_text:e.name}))),n=await ae(a);Ne.value=Object.assign(Ne.value,n),console.log("Allergies staged successfully:",Ne.value),e.clearSelectedMedicalAllergiesList()}const t=await ne();Ne.value=Object.assign(Ne.value,t);const a=await se().saveNonPharmaTherapyPatientData();Ne.value=Object.assign(Ne.value,a)})(),await H(Ne.value)},ot=async()=>{we.value=!0;try{await E(),await H(Ne.value),await ct(),he.push("patientProfile")}catch(e){console.error("Error saving data:",e),M("Error occurred while saving data. Please try again.")}finally{we.value=!1}},ct=async()=>{"dismiss"!==await $(de,{class:"small-confirm-modal "})&&await fe()};return u((async()=>{0!==Pe.NCDActivities.length?(Y().resetScreening(),Ke.value=Ge(),await st(),(void 0===ye.value||ye.value<0)&&(ye.value=0,console.log("Setting initial tab index to 0")),De.value=!1,we.value=!1,We()):he.push("patientProfile")})),c(ye,(async()=>{await We()})),c(Ve,(async()=>{await st()}),{deep:!0}),c(Ne,(async()=>{Y().resetScreening(),await st()}),{deep:!0}),c(Me,(async()=>{await st()}),{deep:!0}),c(Le,(async()=>{await st()}),{deep:!0}),c(Be,(async()=>{await st()}),{deep:!0}),c(Oe,(async()=>{await st()}),{deep:!0}),c(Fe,(async()=>{await st()}),{deep:!0}),c(_e,(async e=>{at(),nt(),Ke.value=Ge()}),{deep:!0}),c(Ne,(async(e,t)=>{e.ID!=t.ID&&(at(),nt())}),{deep:!0}),a({saveData:ot,markWizard:st,refreshWizard:at,validateDoneButtonState:We}),(e,a)=>(v(),r(p(D),null,{default:d((()=>[g(V),g(p(m),{fullscreen:!0},{default:d((()=>[g(U),y("div",t,[be.value?(v(),r(ce,{key:0,ref:"wizard","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:Se.value,"custom-tabs":Ke.value,beforeChange:p(me),onChange:it,"onComplete:wizard":a[1]||(a[1]=e=>ot()),onDoneButtonChanged:Je},{default:d((()=>[y("div",null,[y("div",pe,[g(L,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:p(_),"font-weight":"600",onClick:a[0]||(a[0]=e=>{he.push("patientProfile")})},null,8,["icon"])])]),h(y("div",null,[g(ie,{ref_key:"vitalsRef",ref:Qe},null,512)],512),[[b,"Vitals"==tt()]]),h(y("div",null,[g(le,{ref_key:"riskAssessmentRef",ref:Ue},null,512)],512),[[b,"RiskAssessment"==tt()]]),h(y("div",null,[g(ee,{ref_key:"investigationsRef",ref:Ye},null,512)],512),[[b,"Investigations"==tt()]]),h(y("div",null,[g(Z,{ref_key:"diagnosisRef",ref:Ze},null,512)],512),[[b,"DiagnosisComponent"==tt()]]),h(y("div",null,[g(q,{ref_key:"complicationsRef",ref:qe},null,512)],512),[[b,"ComplicationsScreening"==tt()]]),h(y("div",null,[g(X,{ref_key:"treatmentPlanRef",ref:Xe},null,512)],512),[[b,"TreatmentPlan"==tt()]]),h(y("div",null,[g(te,{ref_key:"nextAppointmentRef",ref:et},null,512)],512),[[b,"NextAppointment"==tt()]])])),_:1},8,["doneButton","custom-tabs","beforeChange"])):f("",!0)])])),_:1})])),_:1}))}}))}}}));

System.register(["./vendor-legacy-MhhustNq.js","./useFormWizard-legacy-DDVh40px.js","./index-legacy-DaIXgwUz.js","./DemographicBar-legacy-DdbOD50r.js","./OPDOutcome-legacy-Bk4KE8fG.js","./NextAppointment-legacy-B6S6YWB2.js","./OPDPrintingModal-legacy-CFPCjHd-.js","./lodash-legacy-pOOc9Efu.js","./usePatientProfile-legacy-CreAKStN.js","./apexcharts-legacy-DQPiJy8y.js","./patient_complaints_service-legacy-6D4u4P7R.js","./DashBox-legacy-DuH3tG-0.js","./useExposeFromStandardForm-legacy-BzJHzelH.js","./BasicForm-legacy-DPe9MyYl.js","./DateInputField-legacy-qSbo14m9.js","./formatServerData-legacy-CHSBHa-w.js","./drug_prescription_service-legacy-CQ3lz8jb.js","./drug_service-legacy-BeR5mPYA.js","./Outcome-legacy-BfzStY8X.js","./lab_order-legacy-DIR8OTa1.js","./group_validation-legacy-Bfe_HOqC.js","./ncd_appointment_service-legacy-ChcCBbCn.js","./Registration-legacy-HtLQjrhB.js","./useLocation-legacy-CLUR_Je0.js","./vaccines_service-legacy-rly0WOco.js","./sms_service-legacy-BgSG3GuH.js","./EIRreportsStore-legacy-DowDZlL-.js","./Export-legacy-DTLEU9G3.js"],function(e,a){"use strict";var t,n,l,s,i,o,r,u,c,d,v,m,g,p,y,f,b,h,w,P,_,x,O,D,j,T,A,I,C,S,k,N,F,E,R,B,L,z,H,M,K,W,G,J,U,V,X,Y,Z,$,q,Q,ee,ae,te,ne,le,se,ie,oe,re,ue,ce,de,ve,me;return{setters:[e=>{t=e.d,n=e.ak,l=e.ck,s=e.r,i=e.aT,o=e.c,r=e.a,u=e.w,c=e.O,d=e.f,v=e.J,m=e.l,g=e.e,p=e.m,y=e.k,f=e.u,b=e.bK,h=e.d8,w=e.a8,P=e.i,_=e.bC,x=e.v,O=e.ae,D=e.dK,j=e.b7},e=>{T=e.u,A=e._},e=>{I=e.u,C=e.aC,S=e.aW,k=e.aE,N=e.c,F=e.aF,E=e.a0,R=e.aO,B=e.aX,L=e.aY,z=e.aK,H=e.T,M=e.M,K=e.t,W=e.K,G=e.s,J=e.af,U=e.aP,V=e.H,X=e.aG,Y=e.aI,Z=e.aZ,$=e.S,q=e.a_,Q=e.v,ee=e._},e=>{ae=e.D},e=>{te=e.C,ne=e.O,le=e.a,se=e.b},e=>{ie=e.I,oe=e.N,re=e.s,ue=e.b,ce=e.a},e=>{de=e.O},e=>{ve=e.l},e=>{me=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".disabled[data-v-4e7bb788]{color:red}.spinner-overlay[data-v-4e7bb788]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-4e7bb788]{width:80px;height:80px}.loading-text[data-v-4e7bb788]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-4e7bb788]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-4e7bb788]{pointer-events:none}.back_profile[data-v-4e7bb788]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(a);const ge={key:0,class:"spinner-overlay"},pe={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},ye={class:"back_profile"};e("default",ee(t({__name:"ConsultationPlan",setup(e){const{currentTabIndex:a}=T("Consultation Plan"),{printVisitSummary:t}=me(),ee=n(),fe=l(),be=s(!1),he=s(!0),we=s(!1),Pe=s(!1),_e=s(!0),xe=s(!1),Oe=s(!1),De=s(!1),je=I(),Te=C(),Ae=S(),Ie=k(),Ce=N(),Se=F(),ke=E(),Ne=R(),Fe=B(),Ee=L(),{patient:Re}=i(je),{investigations:Be}=i(Te),{OPDdiagnosis:Le}=i(Ae),{selectedMedicalDrugsList:ze,nonPharmalogicalTherapyAndOtherNotes:He}=i(Ie),{OPDActivities:Me}=i(Ce),{outcomes:Ke}=i(Se),{currentSelectedNextAppointmentDate:We}=i(Fe),{presentingComplaints:Ge}=i(Ee),{vitals:Je}=i(Ne),Ue=z(),Ve=o(()=>Ue.selectedMedicalAllergiesList),Xe=s(null),Ye=s(null),Ze=s(null),$e=s(null),qe=s(null),Qe=s(null),ea=s(null),aa=()=>Me.value.map(e=>({title:e,icon:""})),ta=s(),na=s({}),la=async(e,t,n)=>{0===t&&await da(),await ra()?(await ua(),e%1==0&&(a.value=e),ea.value&&n&&ea.value.changeTab(e)):K("Please add presenting complaints before proceeding.")},sa=()=>{var e;if(!ta.value||0===ta.value.length)return null;const t=a.value>=0&&a.value<ta.value.length?a.value:0;switch(null===(e=ta.value[t])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(Me.value.length>0)switch(Me.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},ia=async()=>{Pe.value=!0,W("Printing consultation summary... Please wait.");try{await t(),W("Consultation summary printed successfully!"),setTimeout(()=>{ee.push("home")},3500)}catch(e){G("Failed to print consultation summary.")}finally{Pe.value=!1}},oa=()=>{W("Patient has finished consultation!"),ee.push("home")},ra=async()=>{const e=await J.getObsByEncounterIdAndDate(U.PRESENTING_COMPLAINTS);return!!(e&&e.length>0)},ua=async()=>{const e=V.sessionDate();for(let t=0;t<ta.value.length;t++)if(await ra()){he.value=!0,we.value=!1;const n=ta.value[t];if(na.value={title:"Untitled"},"Clinical Assessment"===n.title){const a=X("presentingComplaints");ta.value[t].icon=ca(e,a)?j:""}else if("Investigations"===n.title){var a;const n=null===(a=Re.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,l=null==n?void 0:n.filter(a=>V.toStandardHisFormat(e)===V.toStandardHisFormat(a.order_date));ta.value[t].icon=(null==l?void 0:l.length)>0?j:""}else if("Diagnosis"===n.title){const a=X("diagnosis");ta.value[t].icon=ca(e,a)?j:""}else if("Treatment Plan"===n.title){const e=X("treatment");ta.value[t].icon=(null==e?void 0:e.length)>0?j:""}else if("Next Appointment"===n.title){const a=X("appointments");ta.value[t].icon=ca(e,a)?j:""}else if("Outcome"===n.title){const e=X("outcomes");ta.value[t].icon=(null==e?void 0:e.length)>0?j:""}}else he.value=!1,"Clinical Assessment"!==ta.value[t].title&&(ta.value[t].icon=D)},ca=(e,a)=>{if(!a)return!1;const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime||e.order_date);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},da=async()=>{be.value=!0;try{var e;await va(),await Promise.all([null===(e=Xe.value)||void 0===e?void 0:e.onSubmit()]),await Y(Re.value),Z()}catch(a){throw console.error("Error saving clinical assessment:",a),G("Failed to save clinical assessment"),a}finally{be.value=!1}},va=async()=>{try{if(!ve.isEmpty(Ve.value)){const e=ma(),a=await re(e);je.setPatientRecord(a)}}catch(e){console.error("Failed to save allergies:",e),K("Failed to save allergies")}},ma=()=>Ve.value.map(e=>({concept_id:e.concept_id,obs_datetime:$.getSessionDate(),value_coded:e.concept_id,location_id:ke.facilityLocation.code,value_text:e.name})),ga=async()=>{try{var e;null!==(e=Ze.value)&&void 0!==e&&e.onSubmit(),await(async()=>{try{const e=await ue();Re.value=Object.assign(Re.value,e);const a=await ce().saveNonPharmaTherapyPatientData();Re.value=Object.assign(Re.value,a)}catch(e){console.error("Failed to save treatment plan:",e),K("Failed to save treatment plan")}})(),await Se.saveOutcomPatientData(),await Z(),await Y(Re.value);const a=localStorage.getItem("locationID"),t=localStorage.getItem("userRoles");if(!a)return void G("Location ID could not be found. Please check your settings.");const n=t?JSON.parse(t):[];n.some(e=>"Lab"===e.role)?(await q.addPatientToStage(Re.value,"CONSULTATION"),await Q().refresh(a),await ee.push("home"),W("Lab results submitted. Patient can return to consultation")):(await q.addPatientToStage(Re.value,"DISPENSATION"),await Q().refresh(a),await ee.push("home"),W("Consultation patient saved successfully."))}catch(a){console.error("Error saving consultation data:",a),G("Failed to save consultation data")}};return r(async()=>{0!==Me.value.length?(ta.value=aa(),await ua(),(void 0===a.value||a.value<0)&&(a.value=0)):await ee.push("home")}),u(Je,async()=>{await ua()},{deep:!0}),u(Re,async()=>{await ua()},{deep:!0}),u(Be,async()=>{await ua()},{deep:!0}),u(Le,async()=>{await ua()},{deep:!0}),u(ze,async()=>{await ua()},{deep:!0}),u(Ke,async()=>{await ua()},{deep:!0}),u(We,async()=>{await ua()}),u(Ge,async()=>{await ua()},{deep:!0}),u(fe,async()=>{_e.value=!1,ta.value=aa(),setTimeout(()=>{a.value=0,_e.value=!0},0)},{deep:!0}),u(De,e=>{Oe.value=e,Oe.value&&setTimeout(()=>{Oe.value=!1},15e3)}),(e,a)=>(d(),c(f(O),null,{default:v(()=>[m(de,{onYes:ia,onNo:oa,isOpen:xe.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),be.value?(d(),g("div",ge,[m(f(b),{name:"bubbles"}),a[2]||(a[2]=y("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),m(f(h),{"is-open":Pe.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),m(H),m(f(w),{fullscreen:!0},{default:v(()=>[m(ae),y("div",pe,[_e.value?(d(),c(A,{key:0,ref_key:"wizard",ref:ea,"vertical-tabs":"","navigable-tabs":he.value,"scrollable-tabs":"",startIndex:0,doneButton:{text:"Finish",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},nextButton:{disabled:we.value},"custom-tabs":ta.value,tabs:ta.value,onChange:la,"onComplete:wizard":a[1]||(a[1]=e=>ga())},{default:v(()=>[y("div",null,[y("div",ye,[m(M,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:f(_),"font-weight":"600",onClick:a[0]||(a[0]=e=>{ee.push("home")})},null,8,["icon"])])]),P(y("div",null,[m(te,{ref_key:"clinicalAssessmentRef",ref:Xe},null,512)],512),[[x,"ClinicalAssessment"===sa()]]),P(y("div",null,[m(ie,{ref_key:"investigationsRef",ref:Ye},null,512)],512),[[x,"Investigations"===sa()]]),P(y("div",null,[m(ne,{ref_key:"diagnosisRef",ref:Ze},null,512)],512),[[x,"OPDDiagnosis"===sa()]]),P(y("div",null,[m(le,{ref_key:"treatmentPlanRef",ref:$e},null,512)],512),[[x,"OPDTreatmentPlan"===sa()]]),P(y("div",null,[m(oe,{ref_key:"nextAppointmentRef",ref:qe},null,512)],512),[[x,"NextAppointment"===sa()]]),P(y("div",null,[m(se,{ref_key:"outcomeRef",ref:Qe},null,512)],512),[[x,"Outcome"===sa()]])]),_:1},8,["navigable-tabs","nextButton","custom-tabs","tabs"])):p("",!0)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-4e7bb788"]]))}}});

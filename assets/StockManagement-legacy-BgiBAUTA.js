System.register(["./vendor-legacy-phTeNEOA.js","./index-legacy-41CLX9DW.js","./ImmunizationGroupGraph-legacy-umSsvF3I.js","./StockStore-legacy-qS1TwyN8.js","./BasicForm-legacy-DDqkmuHZ.js","./customDatePicker-legacy-DCExsfae.js","./group_validation-legacy-jeYnQFSq.js","./stock_service-legacy-JFselPQk.js","./drug_service-legacy-CNo40btO.js","./lodash-legacy-C-x9g9Na.js","./apexcharts-legacy-Daa5aA7l.js","./DateInputField-legacy-CEEmuE6F.js"],(function(e,t){"use strict";var a,n,i,o,s,d,c,l,r,u,p,h,g,m,f,x,v,y,_,b,w,k,D,S,B,I,C,z,P,T,M,j,N,q,V,F,A,E,H,O,L,U,R,G,$,Q,W,K,Y,J,X,Z,ee,te,ae,ne,ie,oe,se,de,ce,le,re,ue,pe,he,ge,me,fe,xe,ve,ye,_e,be,we,ke,De,Se,Be;return{setters:[e=>{a=e.d,n=e.ab,i=e.b0,o=e.G,s=e.E,d=e.ac,c=e.ad,l=e.a2,r=e.I,u=e.a7,p=e.R,h=e.ag,g=e.bd,m=e.aR,f=e.H,x=e.e,v=e.f,y=e.l,_=e.J,b=e.Q,w=e.K,k=e.k,D=e.F,S=e.D,B=e.b3,I=e.N,C=e.d9,z=e.da,P=e.db,T=e.L,M=e.aP,j=e.a9,N=e.a8,q=e.aa,V=e.cb,F=e.r,A=e.cN,E=e.cO,H=e.cP,O=e.cQ,L=e.cR,U=e.cS,R=e.cT,G=e.cU,$=e.cV,Q=e.cW,W=e.bD,K=e.O,Y=e.m,J=e.P,X=e.p},e=>{Z=e.J,ee=e.i,te=e.B,ae=e.K,ne=e.M,ie=e.H,oe=e.t,se=e.G,de=e.v,ce=e.u,le=e.k,re=e._,ue=e.N,pe=e.T,he=e.b,ge=e.l,me=e.n,fe=e.Q,xe=e.d},e=>{ve=e.I,ye=e.a},e=>{_e=e.u},e=>{be=e.B},e=>{we=e.c},e=>{ke=e.v},e=>{De=e.S},e=>{Se=e.D},e=>{Be=e.l},null,null],execute:function(){var t=L.createElement("style");t.textContent=".OtherVitalsTitle[data-v-88dde239]{font-style:normal;font-weight:600;font-size:20px;color:#00190e}.example-one .pagination-container[data-v-e74eed4d]{column-gap:10px}.example-one .paginate-buttons[data-v-e74eed4d]{height:40px;width:40px;border-radius:20px;cursor:pointer;background-color:#f2f2f2;border:1px solid rgb(217,217,217);color:#000}.example-one .paginate-buttons[data-v-e74eed4d]:hover{background-color:#d8d8d8}.example-one .active-page[data-v-e74eed4d]{background-color:#3498db;border:1px solid #3498db;color:#fff}.example-one .active-page[data-v-e74eed4d]:hover{background-color:#2988c8}.example-one .back-button[data-v-e74eed4d]:active,.example-one .next-button[data-v-e74eed4d]:active{background-color:#c4c4c4}.drug_container[data-v-e74eed4d]{justify-content:center;flex-wrap:wrap;gap:30px;margin:20px}ion-row[data-v-e74eed4d]{line-height:10px}.content[data-v-e74eed4d]{font-size:14px;color:#939393}.contentBold[data-v-e74eed4d]{font-weight:700;font-size:14px;color:gray;line-height:16px}.container[data-v-e74eed4d]{display:flex;align-content:center;align-items:center}.drug_content[data-v-e74eed4d]{padding-bottom:10px;margin-bottom:10px;border-bottom:1px solid #f2f2f2;position:relative;overflow:hidden}.watermark[data-v-e74eed4d]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-45deg);font-size:4em;color:rgba(255,110,110,.2);white-space:nowrap;pointer-events:none;z-index:0}.bigGroupButton[data-v-e74eed4d]{margin-top:10px}#container[data-v-e74eed4d]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container strong[data-v-e74eed4d]{font-size:20px;line-height:26px}#container p[data-v-e74eed4d]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container a[data-v-e74eed4d]{text-decoration:none}.centered-content[data-v-e74eed4d]{display:flex;justify-content:center;align-items:center}.graphBackground[data-v-e74eed4d]{position:absolute;width:100vw;height:62vh;left:0;top:23vh;background:linear-gradient(158.66deg,#d6d5d6 .36%,#f8f8f8 40.1%);border-radius:22px}.total[data-v-e74eed4d]{position:absolute;width:251px;height:128px;top:25px;left:50%;transform:translate(-50%,10%);text-align:center;background:rgba(237,235,238,.95);opacity:.8;border-radius:6px}.totalNumber[data-v-e74eed4d]{height:77px;font-style:normal;font-weight:700;font-size:60px;line-height:77px;color:#5d5d5d}.totalText[data-v-e74eed4d]{width:229px;height:48px;font-style:normal;font-weight:700;font-size:15px;line-height:150%;display:flex;align-items:center;text-align:center;color:#08475e}.dueMiss[data-v-e74eed4d]{display:flex;justify-content:space-around;margin-top:10px}.missed[data-v-e74eed4d],.due[data-v-e74eed4d]{width:187px;height:90px;left:14px;background:#fff;border-radius:6px;text-align:center}.dueMissText[data-v-e74eed4d]{font-style:normal;font-weight:700;font-size:14px;line-height:17px;display:flex;align-items:center;text-align:center;padding:7px;color:#004d4d}.dueNumber[data-v-e74eed4d]{font-style:normal;font-weight:700;font-size:36px;line-height:30px;margin-top:10px;color:#016302}.missedNumber[data-v-e74eed4d]{font-style:normal;font-weight:700;font-size:36px;line-height:30px;margin-top:10px;color:#b42318}.clientSeen[data-v-e74eed4d]{height:120px;margin-top:15px;background:#fff}.clientSeenTitle[data-v-e74eed4d]{padding-top:10px;margin-left:10px;font-style:normal;font-weight:400;font-size:16px;color:#2d3648}.clientSeenBoxChild[data-v-e74eed4d]{background:#2d3648!important}.clientSeenBoxMen[data-v-e74eed4d]{background:#004d4d!important}.clientSeenBoxWomen[data-v-e74eed4d]{background:#556080!important}.clientSeenBox[data-v-e74eed4d]{width:68px;height:68px;background:#006401;border-radius:7px;padding-top:8px}.clientSeenBoxes[data-v-e74eed4d]{display:flex;justify-content:space-around;margin-top:10px}.clientSeenBoxText[data-v-e74eed4d]{font-style:normal;font-weight:400;font-size:14px;line-height:150%;align-items:center;text-align:center;color:#fff}.clientSeenBoxNumber[data-v-e74eed4d]{font-style:normal;font-weight:700;font-size:24px;line-height:29px;text-align:center;color:#fff}.graphCard[data-v-e74eed4d]{width:98vw;margin:10px auto 0}.modal_wrapper[data-v-e74eed4d]{border-radius:8px}.bigButton[data-v-e74eed4d]{font-weight:500;height:180px}.centerBigBtnContain[data-v-e74eed4d]{align-items:center;align-content:center}.bigBtnHeader[data-v-e74eed4d]{font-weight:700;font-size:20px;margin-bottom:10px}ion-button[data-v-e74eed4d]{margin-right:10px}.addBtn[data-v-e74eed4d]{height:50px;align-items:center}.example-one .pagination-container[data-v-fa568cea]{column-gap:10px}.example-one .paginate-buttons[data-v-fa568cea]{height:40px;width:40px;border-radius:20px;cursor:pointer;background-color:#f2f2f2;border:1px solid rgb(217,217,217);color:#000}.example-one .paginate-buttons[data-v-fa568cea]:hover{background-color:#d8d8d8}.example-one .active-page[data-v-fa568cea]{background-color:#3498db;border:1px solid #3498db;color:#fff}.example-one .active-page[data-v-fa568cea]:hover{background-color:#2988c8}.example-one .back-button[data-v-fa568cea]:active,.example-one .next-button[data-v-fa568cea]:active{background-color:#c4c4c4}.drug_container[data-v-fa568cea]{justify-content:center;flex-wrap:wrap;gap:30px;margin:20px}ion-row[data-v-fa568cea]{line-height:10px}.content[data-v-fa568cea]{font-size:14px;color:#939393}.contentBold[data-v-fa568cea]{font-weight:700;font-size:14px;color:gray;line-height:16px}.container[data-v-fa568cea]{display:flex;align-content:center;align-items:center}.drug_content[data-v-fa568cea]{padding-bottom:10px;margin-bottom:10px;border-bottom:1px solid #f2f2f2}.bigGroupButton[data-v-fa568cea]{margin-top:10px}#container[data-v-fa568cea]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container strong[data-v-fa568cea]{font-size:20px;line-height:26px}#container p[data-v-fa568cea]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container a[data-v-fa568cea]{text-decoration:none}.centered-content[data-v-fa568cea]{display:flex;justify-content:center;align-items:center}.graphBackground[data-v-fa568cea]{position:absolute;width:100vw;height:62vh;left:0;top:23vh;background:linear-gradient(158.66deg,#d6d5d6 .36%,#f8f8f8 40.1%);border-radius:22px}.total[data-v-fa568cea]{position:absolute;width:251px;height:128px;top:25px;left:50%;transform:translate(-50%,10%);text-align:center;background:rgba(237,235,238,.95);opacity:.8;border-radius:6px}.totalNumber[data-v-fa568cea]{height:77px;font-style:normal;font-weight:700;font-size:60px;line-height:77px;color:#5d5d5d}.totalText[data-v-fa568cea]{width:229px;height:48px;font-style:normal;font-weight:700;font-size:15px;line-height:150%;display:flex;align-items:center;text-align:center;color:#08475e}.dueMiss[data-v-fa568cea]{display:flex;justify-content:space-around;margin-top:10px}.missed[data-v-fa568cea],.due[data-v-fa568cea]{width:187px;height:90px;left:14px;background:#fff;border-radius:6px;text-align:center}.dueMissText[data-v-fa568cea]{font-style:normal;font-weight:700;font-size:14px;line-height:17px;display:flex;align-items:center;text-align:center;padding:7px;color:#004d4d}.dueNumber[data-v-fa568cea]{font-style:normal;font-weight:700;font-size:36px;line-height:30px;margin-top:10px;color:#016302}.missedNumber[data-v-fa568cea]{font-style:normal;font-weight:700;font-size:36px;line-height:30px;margin-top:10px;color:#b42318}.clientSeen[data-v-fa568cea]{height:120px;margin-top:15px;background:#fff}.clientSeenTitle[data-v-fa568cea]{padding-top:10px;margin-left:10px;font-style:normal;font-weight:400;font-size:16px;color:#2d3648}.clientSeenBoxChild[data-v-fa568cea]{background:#2d3648!important}.clientSeenBoxMen[data-v-fa568cea]{background:#004d4d!important}.clientSeenBoxWomen[data-v-fa568cea]{background:#556080!important}.clientSeenBox[data-v-fa568cea]{width:68px;height:68px;background:#006401;border-radius:7px;padding-top:8px}.clientSeenBoxes[data-v-fa568cea]{display:flex;justify-content:space-around;margin-top:10px}.clientSeenBoxText[data-v-fa568cea]{font-style:normal;font-weight:400;font-size:14px;line-height:150%;align-items:center;text-align:center;color:#fff}.clientSeenBoxNumber[data-v-fa568cea]{font-style:normal;font-weight:700;font-size:24px;line-height:29px;text-align:center;color:#fff}.graphCard[data-v-fa568cea]{width:98vw;margin:10px auto 0}.modal_wrapper[data-v-fa568cea]{border-radius:8px}.bigButton[data-v-fa568cea]{font-weight:500;height:180px}.centerBigBtnContain[data-v-fa568cea]{align-items:center;align-content:center}.bigBtnHeader[data-v-fa568cea]{font-weight:700;font-size:20px;margin-bottom:10px}ion-button[data-v-fa568cea]{margin-right:10px}.addBtn[data-v-fa568cea]{height:50px;align-items:center}\n/*$vite$:1*/",L.head.appendChild(t);const Ie=a({components:{IonContent:u,IonHeader:r,IonItem:l,IonList:c,IonMenu:d,IonTitle:s,IonToolbar:o,IonInput:i,BasicInputField:te,BasicForm:be,PreviousVitals:ee,customDatePicker:we,DynamicButton:Z},data:()=>({iconsContent:le,BMI:{},BPStatus:{},vValidations:"",title:"",relationships:"",hasValidationErrors:[],vitalsInstance:{},validationStatus:{heightWeight:!1,bloodPressure:!1},showPD:!1,stockService:{}}),computed:{...n(ce,["patient"]),...n(_e,["stock"])},props:{data:{default:{}}},created(){this.stockService=new De},async mounted(){this.resetData(),this.data?(this.modifyFieldValue(),this.title="Edit Stock"):this.title="Add Stock",await this.getDrugs()},setup:()=>({checkmark:m,pulseOutline:g}),methods:{modifyFieldValue(){ae(this.stock,"product name","value",{id:"",name:this.data.drug_legacy_name}),ae(this.stock,"batch","value",this.data.batch_number),ae(this.stock,"manufacture","value",this.data.manufacture),ae(this.stock,"doses_wasted","value",this.data.doses_wasted),ae(this.stock,"expire date","value",this.data.expiry_date),ae(this.stock,"quantity","value",this.data.delivered_quantity),ae(this.stock,"delivery_date","value",this.data.delivery_date),ae(this.stock,"product name","disabled","true"),ae(this.stock,"batch","disabled","true"),ae(this.stock,"manufacture","disabled","true"),ae(this.stock,"expire date","disabled","true"),ae(this.stock,"quantity","disabled","true"),ae(this.stock,"delivery_date","disabled","true")},async handleBatch(){this.data?await this.updateBatch():await this.createBatch(),de().postData("SYNC_STOCK_RECORD")},async createBatch(){if(!ke(this.stock))return oe("Batch not save"),!1;{const e=ne(this.stock,"product name","value").drug_id,t=[{batch_number:ne(this.stock,"batch","value"),location_id:"",vvm_stage:"",items:[{barcode:"",drug_id:e,expiry_date:ne(this.stock,"expire date","value"),manufacture:ne(this.stock,"manufacture","value"),quantity:ne(this.stock,"quantity","value"),delivery_date:ne(this.stock,"delivery_date","value")||ie.sessionDate(),product_code:"",pack_size:""}]}],a=await this.stockService.postItems(t);await this.handleWaste(a[0].items[0].id),se("Batch save successfully"),p.dismiss("dismiss")}},async updateBatch(){const e=parseInt(ne(this.stock,"doses_wasted","value")),t=parseInt(ne(this.stock,"quantity","value"));if(this.data.current_quantity,t<this.data.dispensed_quantity+this.data.doses_wasted+e)return oe("Quantity delivered can not be greater than quantity wasted and dispensed"),!1;if(!ke(this.stock))return oe("Batch not save"),!1;{const t={doses_wasted:e,drug_id:ne(this.stock,"product name","value").drug_id,reallocation_code:"MA20",waste_reason:"Something wrong with the drug",date:ie.sessionDate(),reason:"Mistake Entirely"};try{await this.stockService.updateItem(this.data.id,t),se("Batch save successfully"),p.dismiss("dismiss")}catch(a){oe(a)}}},async handleWaste(e){const t=ne(this.stock,"doses_wasted","value");if(t){const a={reallocation_code:"MA20",quantity:t,date:ie.sessionDate(),reason:"Something wrong with the drug"};await this.stockService.disposeItems(e,a)}},navigationMenu(e){h.close(),this.$router.push(e)},resetData(){const e=_e();e.setStock(e.getInitialStock())},async getDrugs(e=""){const t=await Se.getDrugs({name:e,page:1,page_size:10,concept_set:"Immunizations"});ae(this.stock,"product name","multiSelectData",t)},async handleInputData(e){"Product Name *"==e.inputHeader&&await this.getDrugs("")},dismiss(){p.dismiss()}}}),Ce={class:"modal_wrapper"},ze={class:"ion-padding",slot:"content",style:{"padding-bottom":"200px"}},Pe=re(Ie,[["render",function(e,t,a,n,i,o){const s=f("ion-title"),d=f("ion-icon"),c=f("ion-header"),l=f("basic-form"),r=f("ion-content"),u=f("DynamicButton"),p=f("ion-col"),h=f("ion-row"),g=f("ion-footer");return v(),x(D,null,[y(c,{style:{display:"flex","justify-content":"space-between"}},{default:_((()=>[y(s,{class:"modalTitle"},{default:_((()=>[b(w(e.title),1)])),_:1}),y(d,{onClick:t[0]||(t[0]=t=>e.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:e.iconsContent.cancel},null,8,["icon"])])),_:1}),y(r,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:_((()=>[k("div",Ce,[k("div",ze,[k("div",null,[y(l,{contentData:e.stock,"onUpdate:inputValue":e.handleInputData,onSearchChange:e.getDrugs},null,8,["contentData","onUpdate:inputValue","onSearchChange"])])])])])),_:1}),y(g,{collapse:"fade",class:"ion-no-border"},{default:_((()=>[y(h,null,{default:_((()=>[y(p,null,{default:_((()=>[y(u,{onClick:t[1]||(t[1]=t=>e.handleBatch()),name:"Save",fill:"solid",style:{float:"right",margin:"2%",width:"130px"}})])),_:1})])),_:1})])),_:1})],64)}],["__scopeId","data-v-88dde239"]]),Te=[{data:{rowData:[{colData:[{inputHeader:"Search",icon:le.search,value:"",name:"search",eventType:"input",alertsErrorMassage:"",selectedID:""}]}]}}],Me=S("searchName",{state:()=>({searchName:[...Te]}),actions:{setsearchName(e){this.searchName=e},getInitialName:()=>[...Be.cloneDeep(Te)]}}),je=[{data:{rowData:[{colData:[{inputHeader:"Quantity*",icon:le.weight,valueType:"number",value:"",name:"quantity",eventType:"input",alertsErrorMassage:"",required:!0,validationFunctionName:"isNumber"}]}]}},{data:{rowData:[{colData:[{inputHeader:"Reason *",icon:le.search,valueType:"text",isSingleSelect:!0,popOver:!0,value:"",name:"reason",validationFunctionName:"required",trackBy:"id",multiSelectData:[],eventType:"input",required:!0,alertsErrorMassage:"",id:""}]}]}}],Ne=S("stockDiscard",{state:()=>({stockDiscard:[...je]}),actions:{setStockDiscard(e){this.stockDiscard=e},getInitialStockDiscard:()=>[...Be.cloneDeep(je)]},persist:!0}),qe=a({name:"StockManagementModal",mixins:[he],components:{IonContent:u,IonHeader:r,IonMenuButton:V,IonPage:q,IonTitle:s,IonToolbar:o,Toolbar:pe,ToolbarSearch:ue,IonRow:N,IonCol:j,ImmunizationTrendsGraph:ye,ImmunizationGroupGraph:ve,IonCard:M,DynamicButton:Z,BasicForm:be,IonIcon:T,IonFab:P,IonFabButton:z,IonFabList:C,IonButton:I,IonPopover:B},data:()=>({iconsContent:le,reportData:[],currentStock:[],stockData:[],allStock:[],outStock:[],filter:"",startDate:ie.sessionDate(),endDate:ie.sessionDate(),options:{responsive:!0,select:!0},selectedButton:"all",isLoading:!1,popoverOpen:!1,popoverName:"",event:null,stockService:{},disabled:!1,totalPages:0}),setup:()=>({currentPage:F(1),chevronBackOutline:W,checkmark:m,grid:Q,chevronDownCircle:$,chevronForwardCircle:G,chevronUpCircle:R,colorPalette:U,document:L,globe:O,medkit:H,add:E,person:A}),created(){this.stockService=new De},props:{data:{default:{}}},computed:{...n(_e,["stock"]),...n(Me,["searchName"]),...n(Ne,["stockDiscard"]),...n(xe,["apiStatus"])},$route:{async handler(){await this.buildTableData()},deep:!0},watch:{stock:{async handler(){},deep:!0}},async mounted(){await this.buildTableData()},methods:{checkExpired(e){const t=new Date(e.expiry_date);return!(new Date(ie.sessionDate())>=t)},async updateBatch(){const e=parseInt(ne(this.stockDiscard,"quantity","value")),t=ne(this.stockDiscard,"reason","value").name,a=parseInt(this.stockData.delivered_quantity);if(this.stockData.current_quantity,a<this.stockData.dispensed_quantity+this.stockData.doses_wasted+e)return oe("Quantity delivered can not be greater than quantity wasted and dispensed"),!1;if(!ke(this.stockDiscard))return oe("Failing to discard"),!1;{const a={doses_wasted:e,drug_id:this.stockData.drug_id,reallocation_code:"MA20",waste_reason:t,date:ie.sessionDate(),reason:t};try{await this.stockService.updateItem(this.stockData.id,a),se("Discard successfully"),await this.buildTableData(),this.closePopover()}catch(n){oe(n)}}},async adjustStock(){let e=parseInt(ne(this.stockDiscard,"quantity","value")),t=ne(this.stockDiscard,"reason","value").name;if("Negative Adjustment"==t||"Negative Mathematical Error"==t){if(e>this.stockData.current_quantity)return oe("Quantity Available can not be greater than adjustment quantity"),!1;e=-e}if(!ke(this.stockDiscard))return oe("Failing to adjust"),!1;{const n={adjust_stock:e,drug_id:this.stockData.drug_id,reallocation_code:"MA20",waste_reason:t,date:ie.sessionDate(),reason:t};try{await this.stockService.updateItem(this.stockData.id,n),se("Adjust successfully"),await this.buildTableData(),this.closePopover()}catch(a){oe(a)}}},whichPopover(e,t,a){this.popoverName=a,Ne().setStockDiscard(Ne().getInitialStockDiscard()),ae(this.stockDiscard,"reason","multiSelectData","adjust"==a?[{id:1,name:"Positive Adjustment"},{id:2,name:"Negative Adjustment"},{id:3,name:"Negative Mathematical Error"},{id:4,name:"Positive Mathematical Error"}]:[{id:1,name:"VVM stage > 2"},{id:2,name:"Frozen"},{id:3,name:"Damage"},{id:4,name:"Wastage"}]),this.openPopover(e,t)},openPopover(e,t){this.stockData=t,this.event=e,this.popoverOpen=!0},closePopover(){this.event=null,this.popoverOpen=!1},dismiss(){p.dismiss("dismiss")},async onClickHandler(e){await this.buildTableData(e)},formatDate:e=>ie.toStandardHisDisplayFormat(e),async handleInputData(e){"Search"==e.inputHeader&&(this.filter=e.value,await this.buildTableData())},async voidStock(e,t){if(await fe(`Do you want to void "${t.drug_legacy_name}", batch: ${t.batch_number} ?`,e,{confirmBtnLabel:"Void"})){const e=new De;await e.deleteItem(t.id,{reason:"voided"}),await this.buildTableData()}},async buildTableData(e=1){this.isLoading=!0,de().postData("SYNC_STOCK_RECORD");try{if(this.apiStatus){var t,a;const n=new De;this.reportData={records:await n.getItems({start_date:"2000-01-01",end_date:this.endDate,drug_name:this.data.drug_legacy_name,page:e,page_size:4})},null!==(t=this.reportData)&&void 0!==t&&t.records&&(this.totalPages=null===(a=this.reportData)||void 0===a||null===(a=a.records[0])||void 0===a?void 0:a.total_count)}else this.reportData=await me("stock",{selector:{drug_legacy_name:this.data.drug_legacy_name},currentPage:this.currentPage,itemsPerPage:4}),this.totalPages=this.reportData.totalCount}catch(n){oe("An error occurred while loading data.")}finally{this.isLoading=!1}},async selectButton(e){this.selectedButton=e,await this.buildTableData()},async openAddStockModal(e){"dismiss"==await ge(Pe,{class:"fullScreenModal"},!0,{data:e})&&await this.buildTableData()}}}),Ve={key:0,class:"spinner-overlay"},Fe={class:"container"},Ae={style:{width:"70vw",top:"-2px",position:"relative","margin-right":"10px"}},Ee={class:"drug_container"},He={key:0,class:"watermark"},Oe={key:1,class:"watermark"},Le={style:{"font-weight":"700","font-size":"16px",color:"#939393"}},Ue={key:2},Re={class:"example-one"},Ge={style:{"margin-bottom":"160px"}},$e={style:{display:"flex","justify-content":"space-between",padding:"10px"}},Qe=re(qe,[["render",function(e,t,a,n,i,o){const s=f("ion-spinner"),d=f("ion-title"),c=f("ion-icon"),l=f("ion-header"),r=f("basic-form"),u=f("ion-col"),p=f("ion-row"),h=f("ion-button"),g=f("vue-awesome-paginate"),m=f("ion-popover"),S=f("ion-content"),B=f("ion-page");return v(),K(B,{class:X({loading:e.isLoading})},{default:_((()=>[e.isLoading?(v(),x("div",Ve,[y(s,{name:"bubbles"}),t[6]||(t[6]=k("div",{class:"loading-text"},"Please wait...",-1))])):Y("",!0),y(l,{style:{display:"flex","justify-content":"space-between"}},{default:_((()=>[y(d,{class:"modalTitle"},{default:_((()=>t[7]||(t[7]=[b("Inventory Management ")]))),_:1,__:[7]}),y(c,{onClick:t[0]||(t[0]=t=>e.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:e.iconsContent.cancel},null,8,["icon"])])),_:1}),y(S,{style:{"--background":"#fff"}},{default:_((()=>[k("div",Fe,[k("div",Ae,[y(r,{contentData:e.searchName,"onUpdate:inputValue":e.handleInputData},null,8,["contentData","onUpdate:inputValue"])]),k("div",Ee,[(v(!0),x(D,null,J(e.reportData.records,((a,n)=>(v(),x("div",{class:"drug_content",key:n},[e.checkExpired(a)?Y("",!0):(v(),x("div",He,"EXPIRED")),a.current_quantity<=0?(v(),x("div",Oe,"Stock out")):Y("",!0),y(p,{class:"search_header"},{default:_((()=>[y(u,{class:""},{default:_((()=>[k("span",Le,w(a.drug_legacy_name),1)])),_:2},1024)])),_:2},1024),y(p,{class:"search_header"},{default:_((()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_((()=>t[8]||(t[8]=[b("Batch/Lot Number")]))),_:1,__:[8]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_((()=>[b(w(a.batch_number),1)])),_:2},1024)])),_:2},1024),y(p,{class:"search_header"},{default:_((()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_((()=>t[9]||(t[9]=[b("Manufacturer")]))),_:1,__:[9]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_((()=>[b(w(a.manufacture),1)])),_:2},1024)])),_:2},1024),y(p,{class:"search_header"},{default:_((()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_((()=>t[10]||(t[10]=[b("Expiration date ")]))),_:1,__:[10]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_((()=>[b(w(e.formatDate(a.expiry_date)),1)])),_:2},1024)])),_:2},1024),y(p,{class:"search_header"},{default:_((()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_((()=>t[11]||(t[11]=[b("Date received")]))),_:1,__:[11]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_((()=>[b(w(e.formatDate(a.delivery_date)),1)])),_:2},1024)])),_:2},1024),y(p,{class:"search_header"},{default:_((()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_((()=>t[12]||(t[12]=[b("Doses Received")]))),_:1,__:[12]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_((()=>[b(w(a.delivered_quantity),1)])),_:2},1024)])),_:2},1024),y(p,{class:"search_header"},{default:_((()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_((()=>t[13]||(t[13]=[b("Doses wasted")]))),_:1,__:[13]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_((()=>[b(w(a.doses_wasted),1)])),_:2},1024)])),_:2},1024),y(p,{class:"search_header"},{default:_((()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_((()=>t[14]||(t[14]=[b("Doses Issued")]))),_:1,__:[14]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_((()=>[b(w(a.dispensed_quantity),1)])),_:2},1024)])),_:2},1024),y(p,{class:"search_header"},{default:_((()=>[y(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_((()=>t[15]||(t[15]=[b("Doses Available")]))),_:1,__:[15]}),y(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_((()=>[b(w(a.current_quantity),1)])),_:2},1024)])),_:2},1024),e.apiStatus?(v(),x("div",Ue,[e.checkExpired(a)&&a.current_quantity>0?(v(),K(h,{key:0,size:"small",color:"danger",name:"Discard Stock",style:{"font-size":"12px"},onClick:t=>e.whichPopover(t,a,"discard")},{default:_((()=>t[16]||(t[16]=[b(" Discard Stock ")]))),_:2,__:[16]},1032,["onClick"])):(v(),K(h,{key:1,size:"small",color:"danger",name:"Discard Stock",style:{"font-size":"12px"},onClick:t=>e.voidStock(t,a)},{default:_((()=>t[17]||(t[17]=[b(" Void Stock ")]))),_:2,__:[17]},1032,["onClick"])),y(h,{color:"success",size:"small",name:"Update Stock",style:{"font-size":"12px"},onClick:t=>e.whichPopover(t,a,"adjust")},{default:_((()=>t[18]||(t[18]=[b("Adjust Stock")]))),_:2,__:[18]},1032,["onClick"])])):Y("",!0)])))),128))]),k("div",Re,[e.totalPages>0?(v(),K(g,{key:0,"total-items":e.totalPages,"items-per-page":4,"max-pages-shown":2,modelValue:e.currentPage,"onUpdate:modelValue":t[1]||(t[1]=t=>e.currentPage=t),onClick:e.onClickHandler},null,8,["total-items","modelValue","onClick"])):Y("",!0)])]),y(m,{style:{"--offset-x":"-10px"},"is-open":e.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!1,event:e.event,onDidDismiss:t[5]||(t[5]=t=>e.popoverOpen=!1)},{default:_((()=>[k("div",Ge,[y(r,{contentData:e.stockDiscard,"onUpdate:inputValue":e.handleInputData},null,8,["contentData","onUpdate:inputValue"])]),k("div",$e,[y(h,{size:"small",color:"danger",name:"Discard Stock",style:{"font-size":"14px"},onClick:t[2]||(t[2]=t=>e.closePopover())},{default:_((()=>t[19]||(t[19]=[b("Cancel")]))),_:1,__:[19]}),"adjust"==e.popoverName?(v(),K(h,{key:0,color:"success",size:"small",name:"Update Stock",style:{"font-size":"14px"},onClick:t[3]||(t[3]=t=>e.adjustStock())},{default:_((()=>t[20]||(t[20]=[b("Save")]))),_:1,__:[20]})):Y("",!0),"discard"==e.popoverName?(v(),K(h,{key:1,color:"success",size:"small",name:"Update Stock",style:{"font-size":"14px"},onClick:t[4]||(t[4]=t=>e.updateBatch())},{default:_((()=>t[21]||(t[21]=[b("Save")]))),_:1,__:[21]})):Y("",!0)])])),_:1},8,["is-open","event"])])),_:1})])),_:1},8,["class"])}],["__scopeId","data-v-e74eed4d"]]),We=a({name:"StockManagement",mixins:[he],components:{IonContent:u,IonHeader:r,IonMenuButton:V,IonPage:q,IonTitle:s,IonToolbar:o,Toolbar:pe,ToolbarSearch:ue,IonRow:N,IonCol:j,ImmunizationTrendsGraph:ye,ImmunizationGroupGraph:ve,IonCard:M,DynamicButton:Z,BasicForm:be,IonIcon:T,IonFab:P,IonFabButton:z,IonFabList:C,IonButton:I},data:()=>({reportData:[],currentStock:[],allStock:[],outStock:[],filter:"",startDate:ie.sessionDate(),endDate:ie.sessionDate(),options:{responsive:!0,select:!0},selectedButton:"all",isLoading:!1,combinedBatches:[],stockData:[],totalPages:0}),setup:()=>({currentPage:F(1),chevronBackOutline:W,checkmark:m,grid:Q,chevronDownCircle:$,chevronForwardCircle:G,chevronUpCircle:R,colorPalette:U,document:L,globe:O,medkit:H,add:E,person:A}),computed:{...n(_e,["stock"]),...n(de,["workerData"]),...n(Me,["searchName"]),...n(xe,["apiStatus"])},watch:{stock:{async handler(){},deep:!0},$route:{async handler(e){"stockManagement"==e.name&&await this.updateBuildStockData()},deep:!0}},async mounted(){await this.updateBuildStockData()},methods:{combineDrugBatches(e){const t=e.reduce(((e,t)=>{const a=t.drug_legacy_name;return e[a]||(e[a]=[]),e[a].push(t),e}),{});return this.combinedBatches=Object.keys(t).map((e=>{const a=t[e];return{drug_legacy_name:e,delivered_quantity:a.reduce(((e,t)=>e+t.delivered_quantity),0),current_quantity:a.reduce(((e,t)=>e+t.current_quantity),0),dispensed_quantity:a.reduce(((e,t)=>e+t.dispensed_quantity),0),doses_wasted:a.reduce(((e,t)=>e+t.doses_wasted),0)}})),this.combinedBatches},async onClickHandler(e){await this.buildTableData(e)},formatDate:e=>ie.toStandardHisDisplayFormat(e),async handleInputData(e){"Search"==e.inputHeader&&(this.filter=e.value,await this.buildTableData())},async discardStock(e,t){if(await fe(`Do you want to void "${t.drug_legacy_name}", batch: ${t.batch_number} ?`,e,{confirmBtnLabel:"Void"})){const e=new De;await e.deleteItem(t.id,{reason:"voided"}),await this.buildTableData()}},async updateBuildStockData(){de().postData("SYNC_STOCK_RECORD"),this.buildTableData()},async buildTableData(e=1){this.isLoading=!0;try{if(this.apiStatus){var t,a;const n=new De;this.reportData={items:await n.getItems({start_date:"2000-01-01",end_date:this.endDate,drug_name:this.filter,page:e,page_size:4,display_details:"true"})},null!==(t=this.reportData)&&void 0!==t&&t.items&&(this.totalPages=null===(a=this.reportData)||void 0===a||null===(a=a.items[0])||void 0===a?void 0:a.total_count)}else{var n;this.stockData=await me("stock"),this.reportData=this.paginateArray(this.combineDrugBatches(this.stockData),this.currentPage),this.totalPages=null===(n=this.combinedBatches)||void 0===n?void 0:n.length}}catch(i){oe("An error occurred while loading data.")}finally{this.isLoading=!1}},paginateArray(e,t){if(!Array.isArray(e))throw new Error("Input must be an array");const a=Math.max(1,Number(t)||1),n=4*(a-1),i=n+4,o=e.slice(n,i);return{currentPage:a,totalPages:Math.ceil(e.length/4),totalItems:e.length,items:o}},async selectButton(e){this.selectedButton=e,await this.buildTableData()},async openMoreDetailsModal(e){"dismiss"==await ge(Qe,{class:"fullScreenModal"},!0,{data:e})&&await this.buildTableData()},async openAddStockModal(e){"dismiss"==await ge(Pe,{class:"fullScreenModal"},!0,{data:e})&&await this.buildTableData()}}}),Ke={key:0,class:"spinner-overlay"},Ye={class:"container"},Je={style:{width:"80vw",top:"-10px",position:"relative","margin-right":"10px"}},Xe={class:"drug_container"},Ze={style:{"font-weight":"700","font-size":"16px",color:"#939393"}},et={class:"example-one"};e("default",re(We,[["render",function(e,t,a,n,i,o){const s=f("ion-spinner"),d=f("Toolbar"),c=f("basic-form"),l=f("ion-col"),r=f("ion-row"),u=f("ion-button"),p=f("vue-awesome-paginate"),h=f("ion-icon"),g=f("ion-fab-button"),m=f("ion-fab"),S=f("ion-content"),B=f("ion-page");return v(),K(B,{class:X({loading:e.isLoading}),"keep-alive":!1},{default:_((()=>[e.isLoading?(v(),x("div",Ke,[y(s,{name:"bubbles"}),t[2]||(t[2]=k("div",{class:"loading-text"},"Please wait...",-1))])):Y("",!0),y(d),y(S,{style:{"--background":"#fff"}},{default:_((()=>{var a;return[k("div",Ye,[t[8]||(t[8]=k("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Inventory Management",-1)),k("div",Je,[y(c,{contentData:e.searchName,"onUpdate:inputValue":e.handleInputData},null,8,["contentData","onUpdate:inputValue"])]),k("div",Xe,[(v(!0),x(D,null,J(null===(a=e.reportData)||void 0===a?void 0:a.items,((a,n)=>(v(),x("div",{class:"drug_content",key:n},[y(r,{class:"search_header"},{default:_((()=>[y(l,{class:""},{default:_((()=>[k("span",Ze,w(a.drug_legacy_name),1)])),_:2},1024)])),_:2},1024),y(r,{class:"search_header"},{default:_((()=>[y(l,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_((()=>t[3]||(t[3]=[b("Doses Received")]))),_:1,__:[3]}),y(l,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_((()=>[b(w(a.delivered_quantity),1)])),_:2},1024)])),_:2},1024),y(r,{class:"search_header"},{default:_((()=>[y(l,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_((()=>t[4]||(t[4]=[b("Doses wasted")]))),_:1,__:[4]}),y(l,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_((()=>[b(w(a.doses_wasted),1)])),_:2},1024)])),_:2},1024),y(r,{class:"search_header"},{default:_((()=>[y(l,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_((()=>t[5]||(t[5]=[b("Doses Issued")]))),_:1,__:[5]}),y(l,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_((()=>[b(w(a.dispensed_quantity),1)])),_:2},1024)])),_:2},1024),y(r,{class:"search_header"},{default:_((()=>[y(l,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:_((()=>t[6]||(t[6]=[b("Doses Available")]))),_:1,__:[6]}),y(l,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:_((()=>[b(w(a.current_quantity),1)])),_:2},1024)])),_:2},1024),k("div",null,[y(u,{color:"success",size:"small",name:"Update Stock",style:{"font-size":"12px"},onClick:t=>e.openMoreDetailsModal(a)},{default:_((()=>t[7]||(t[7]=[b(" More Stock Details ")]))),_:2,__:[7]},1032,["onClick"])])])))),128))]),k("div",et,[e.totalPages>0?(v(),K(p,{key:0,"total-items":e.totalPages,"items-per-page":4,"max-pages-shown":2,modelValue:e.currentPage,"onUpdate:modelValue":t[0]||(t[0]=t=>e.currentPage=t),onClick:e.onClickHandler},null,8,["total-items","modelValue","onClick"])):Y("",!0)])]),e.apiStatus?(v(),K(m,{key:0,slot:"fixed",vertical:"bottom",horizontal:"end",onClick:t[1]||(t[1]=t=>e.openAddStockModal(""))},{default:_((()=>[y(g,{color:"primary"},{default:_((()=>[y(h,{icon:e.add},null,8,["icon"])])),_:1})])),_:1})):Y("",!0)]})),_:1})])),_:1},8,["class"])}],["__scopeId","data-v-fa568cea"]]))}}}));

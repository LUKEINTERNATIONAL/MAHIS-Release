var Ot=Object.defineProperty;var Rt=(e,t,s)=>t in e?Ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var X=(e,t,s)=>Rt(e,typeof t!="symbol"?t+"":t,s);import{d as H,cH as Vt,ak as rt,r as V,c as Q,w as re,a as ge,e as g,f as l,k as n,m as A,p as te,K as _,l as a,u as S,a2 as dt,P,a0 as U,F as E,O as j,cI as Mt,b$ as Lt,ar as ct,bs as Bt,bf as xt,bS as ut,bY as Et,H as h,J as o,D as Ft,af as Y,cJ as pt,cK as mt,cL as ht,cM as me,cN as Ut,cO as gt,cP as Ht,cQ as zt,cR as Wt,cS as jt,cT as Jt,cU as Gt,cV as Kt,$ as Fe,bC as Qt,aj as Yt,n as ft,N as R,aO as Ke,aP as _t,aQ as vt,aR as Ne,aa as Oe,M as Ae,a9 as Re,G as de,ae as Ve,I as ae,a8 as se,bq as Ue,a6 as qt,cW as Zt,aA as Xt,cX as en,cY as tn,ck as nn,az as an,cr as yt,aI as ye,aT as Ie,Y as Pe,cZ as bt,aE as Dt,b8 as sn,c_ as on,ch as Te,z as ln,c$ as Qe,d0 as he,b1 as _e,d1 as Ct,b7 as rn,bj as dn,b4 as Me,bg as cn,E as be,ag as De,ab as ce,a1 as ue,Q as Le,_ as un,d2 as pn,d3 as mn,d4 as hn,d5 as gn,bo as Be,Z as $t,d6 as fn,bW as _n,co as Ye,cp as vn,bL as yn}from"./vendor-f_p5GZUu.js";import{S as z,u as ne,_ as W,H as k,A as bn,a as Dn,b as wt,c as He,P as Ce,d as St,e as Cn,f as $e,R as kt,p as $n,g as le,h as tt,i as wn,t as ze,r as Sn,O as kn,j as An,B as In,k as nt,l as qe,m as Pn,n as Tn,o as ke,q as Nn,s as We,v as je,w as Je,x as On,T as At,U as It,y as Rn,z as Vn,C as oe,D as at,E as st,F as Mn,G as ot,L as Ln}from"./index-x5m2Gizm.js";import{m as Ze}from"./apexcharts-Db13O_GS.js";import{A as Pt}from"./ncd_appointment_service-ZGntqdYJ.js";import{D as Xe}from"./DateInputField-B7A4j7Di.js";import{u as Bn,M as xn,_ as En}from"./ActionButtons.vue_vue_type_script_setup_true_lang-V1XI01yo.js";import{V as Fn}from"./ViewToggleComponent-BstkU2Lw.js";import{b as Un}from"./bottomNavBar-KQg369Kz.js";import{l as ve}from"./lodash-NJiRuGo9.js";import{B as we}from"./BasicForm-CG7fknkz.js";import{B as xe}from"./BasicCard-CKajH2tK.js";import{u as Hn}from"./AdministerOtherVaccinesStore-Cd3tBllQ.js";import{_ as zn}from"./customDatePicker.vue_vue_type_style_index_0_lang-C2xJo38B.js";import{s as Wn}from"./vaccines_service-1U80DyeD.js";import{g as jn}from"./dashboard_service-CSHr-3av.js";import{i as Jn}from"./Img-CJEgX1Vr.js";import"./sms_service-cXaPf07s.js";import"./EIRreportsStore-DefHbVI2.js";import"./Export--wOknBIO.js";const ee={VITALS:6,APPOINTMENT:7,HIV_CLINIC_REGISTRATION:9,TREATMENT:25,HIV_RECEPTION:51,HIV_STAGING:52,HIV_CLINIC_CONSULTATION:53,DISPENSING:54,ART_ADHERENCE:68};class it extends z{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(t){return await super.getJson("fhir/patient/".concat(t),{id:t})}static async getFhirObservations(t){return await super.getJson("fhir/patient/".concat(t,"/observations/"),{id:t})}}const Gn={class:"fhir-viewer"},Kn={class:"container"},Qn={key:0,class:"main-header"},Yn={class:"header-line"},qn={key:0,class:"last-updated-display"},Zn={key:1,class:"card initial-input-card"},Xn={class:"action-area-initial"},ea={key:0,class:"card patient-card"},ta={class:"card-title"},na={class:"patient-info-grid"},aa={class:"info-item"},sa={class:"info-value"},oa={class:"info-item"},ia={class:"info-value"},la={class:"info-item"},ra={class:"info-value"},da={class:"info-item"},ca={class:"info-value"},ua={class:"info-value"},pa={class:"info-value"},ma={class:"info-label"},ha={class:"info-value"},ga={key:2,class:"card observations-card"},fa={class:"card-title"},_a={class:"observations-grid"},va={class:"obs-header"},ya={class:"obs-title"},ba={class:"obs-details"},Da={class:"obs-detail obs-value-highlight"},Ca={class:"obs-value"},$a={class:"obs-detail"},wa={class:"obs-value"},Sa={key:0,class:"obs-detail"},ka={class:"obs-value"},Aa={key:3,class:"no-data-found"},Ia={key:4,class:"no-data-found"},Pa={key:5,class:"main-footer"},Ta=H({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(e){Vt({"person-circle-outline":Et,"clipboard-outline":ut,"search-outline":xt,"information-circle-outline":Bt,"alert-circle-outline":ct,"person-add-outline":Lt,"arrow-back-outline":Mt});const t=e,s=rt(),i=V(!1),r=V([]),y=V(),u=V(),c=V(null),p=V([]),d=Q(()=>r.value.some(D=>D.resourceType==="Bundle"&&D.entry&&D.entry.some(m=>m.resource&&m.resource.resourceType==="Patient"))),f=Q(()=>p.value.length>0),$=async()=>{if(r.value=[],u.value=null,c.value=null,p.value=[],!y.value){console.error("Please enter a Patient Identifier.");return}i.value=!0;try{const D=await it.getFhirPatient(y.value);if(D&&D.entry&&D.entry.length>0){const m=D.entry[0].resource,F=m.id,x=await it.getFhirObservations(F);r.value=[D],x&&(r.value.push(x),p.value=x.entry.filter(G=>G.resource&&G.resource.resourceType==="Observation").map(G=>{const N=G.resource;return{id:N.id,display:J(N),value:pe(N),date:N.effectiveDateTime,category:N.category&&N.category[0]&&N.category[0].coding&&N.category[0].coding[0]?N.category[0].coding[0].display||N.category[0].coding[0].code:"N/A"}}));const L=m.name&&m.name[0];c.value={personInformation:{given_name:L&&L.given?L.given.join(" "):"",middle_name:L&&L.middle?L.middle.join(" "):"",family_name:L&&L.family?L.family:"",gender:m.gender=="male"?"M":(m==null?void 0:m.gender)=="female"?"F":"",birthdate:m.birthDate||"",cell_phone_number:m.telecom&&m.telecom[0]?m.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:m.contact&&m.contact[0]&&m.contact[0].telecom?m.contact[0].telecom[0].value:""}]}};const I=[D,x].filter(Boolean).reduce((G,N)=>{if(N.meta&&N.meta.lastUpdated){const Z=new Date(N.meta.lastUpdated);return G===null||Z>G?Z:G}return G},null);I&&(u.value=T(I.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch(D){console.error("Error loading FHIR data:",D),r.value=[],u.value=null,c.value=null,p.value=[]}finally{i.value=!1}},C=D=>{if(D.name&&D.name[0]){const m=D.name[0],F=m.given?m.given.join(" "):"",x=m.family||"";return"".concat(F," ").concat(x).trim()||"N/A"}return"N/A"},v=D=>D.identifier&&D.identifier.length>0?D.identifier.map(m=>{let F="Unknown System";if(m.type&&m.type.coding&&m.type.coding[0]&&m.type.coding[0].display)F=m.type.coding[0].display;else if(m.system){const L=m.system.split("/");F=L[L.length-1]||m.system,m.system==="urn:oid:2.16.840.1.113883.4.6"&&(F="Social Security Number")}sessionStorage.setItem(F,m.value);let x=null;return m.assigner&&m.assigner.display?x=m.assigner.display:m.assigner&&m.assigner.reference&&(x=m.assigner.reference.split("/").pop()||m.assigner.reference),{value:m.value||"N/A",systemDisplay:F,periodStart:m.period?m.period.start:null,periodEnd:m.period?m.period.end:null,assignerDisplay:x}}):[],w=D=>D.telecom&&D.telecom.length>0?D.telecom.filter(m=>m.system==="phone"&&m.value):[],b=D=>{if(D.contact&&D.contact.length>0){const m=D.contact.filter(x=>{var L;return(L=x.relationship)==null?void 0:L.some(B=>{var I;return(I=B.coding)==null?void 0:I.some(G=>G.code==="GUARD")})}),F=[];return m.forEach(x=>{x.telecom&&x.telecom.length>0&&x.telecom.filter(L=>L.system==="phone"&&L.value).forEach(L=>F.push(L))}),F}return[]},M=D=>{if(!D)return"N/A";try{return new Date(D).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(m){return console.error("Invalid date string for formatDate:",D,m),"Invalid Date"}},T=D=>{if(!D)return"N/A";try{return new Date(D).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(m){return console.error("Invalid date time string for formatDateTime:",D,m),"Invalid Date/Time"}},O=D=>{if(!D)return"N/A";try{const m=new Date,F=new Date(D);let x=m.getFullYear()-F.getFullYear();const L=m.getMonth()-F.getMonth();return(L<0||L===0&&m.getDate()<F.getDate())&&x--,x}catch(m){return console.error("Invalid birth date string for calculateAge:",D,m),"N/A"}},K=D=>{if(D.meta&&D.meta.tag){const m=D.meta.tag.find(F=>F.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return m?m.code:"Unknown"}return"Unknown"},J=D=>D.code&&D.code.coding&&D.code.coding[0]&&(D.code.coding[0].display||D.code.coding[0].code)||"Unknown Observation",pe=D=>D.valueQuantity?"".concat(D.valueQuantity.value," ").concat(D.valueQuantity.unit||"").trim():D.valueString?D.valueString:D.valueBoolean!==void 0?D.valueBoolean?"True":"False":"N/A",q=()=>{ne().setRecord(c.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(p.value)),Nt("/registration/manual")},et=()=>{r.value=[],y.value="",u.value=null,c.value=null,p.value=[]},Nt=D=>{s.push({path:D})};return re(()=>s,async()=>{r.value=[],p.value=[]},{deep:!0}),ge(()=>{var D;if(t.initialData.length>0){r.value=t.initialData;const F=t.initialData.filter(Boolean).reduce((B,I)=>{if(I.meta&&I.meta.lastUpdated){const G=new Date(I.meta.lastUpdated);return B===null||G>B?G:B}return B},null);F&&(u.value=T(F.toISOString()));const x=t.initialData.find(B=>B.resourceType==="Bundle"&&B.entry&&B.entry.some(I=>I.resource&&I.resource.resourceType==="Patient"));if(x){const B=(D=x.entry.find(I=>I.resource&&I.resource.resourceType==="Patient"))==null?void 0:D.resource;if(B){const I=B.name&&B.name[0];c.value={personInformation:{given_name:I&&I.given?I.given.join(" "):"",middle_name:I&&I.middle?I.middle.join(" "):"",family_name:I&&I.family?I.family:"",gender:B.gender||"",birthdate:B.birthDate||""}}}}const L=t.initialData.find(B=>B.resourceType==="Bundle"&&B.entry&&B.entry.some(I=>I.resource&&I.resource.resourceType==="Observation"));L&&(p.value=L.entry.filter(B=>B.resource&&B.resource.resourceType==="Observation").map(B=>{const I=B.resource;return{id:I.id,display:J(I),value:pe(I),date:I.effectiveDateTime,category:I.category&&I.category[0]&&I.category[0].coding&&I.category[0].coding[0]?I.category[0].coding[0].display||I.category[0].coding[0].code:"N/A"}}))}}),(D,m)=>{var F,x,L,B,I,G;return l(),g("div",Gn,[n("div",Kn,[(F=r.value)!=null&&F.length?(l(),g("header",Qn,[n("div",Yn,[m[1]||(m[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:te(["last-updated-display","status-"+K(r.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+_(K(r.value[0].entry[0].resource)),3),u.value?(l(),g("span",qn,"Last Updated: "+_(u.value),1)):A("",!0)])])])):A("",!0),(x=r.value)!=null&&x.length?A("",!0):(l(),g("section",Zn,[a(S(dt),{modelValue:y.value,"onUpdate:modelValue":m[0]||(m[0]=N=>y.value=N),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",Xn,[n("button",{onClick:$,class:"load-data-btn"},[a(S(U),{name:"search-outline"}),m[2]||(m[2]=P(" Find Patient ",-1))])])])),(l(!0),g(E,null,j(r.value,N=>(l(),g("div",{key:N.id},[N.resourceType==="Bundle"&&N.entry&&N.entry[0]&&N.entry[0].resource.resourceType==="Patient"?(l(),g("section",ea,[n("h2",ta,[a(S(U),{name:"person-circle-outline"}),m[3]||(m[3]=P(" Patient Demographics",-1))]),n("div",na,[n("div",aa,[m[4]||(m[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",sa,_(C(N.entry[0].resource)),1)]),n("div",oa,[m[5]||(m[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",ia,_(N.entry[0].resource.gender||"Not specified"),1)]),n("div",la,[m[6]||(m[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",ra,_(M(N.entry[0].resource.birthDate)),1)]),n("div",da,[m[7]||(m[7]=n("span",{class:"info-label"},"Age",-1)),n("span",ca,_(O(N.entry[0].resource.birthDate))+" years",1)]),w(N.entry[0].resource).length?(l(!0),g(E,{key:0},j(w(N.entry[0].resource),(Z,fe)=>(l(),g("div",{key:"patient-phone-".concat(fe),class:"info-item"},[m[8]||(m[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",ua,_(Z.value),1)]))),128)):A("",!0),b(N.entry[0].resource).length?(l(!0),g(E,{key:1},j(b(N.entry[0].resource),(Z,fe)=>(l(),g("div",{key:"guardian-phone-".concat(fe),class:"info-item"},[m[9]||(m[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",pa,_(Z.value),1)]))),128)):A("",!0),(l(!0),g(E,null,j(v(N.entry[0].resource),(Z,fe)=>(l(),g("div",{key:Z.value||fe,class:"info-item"},[n("span",ma,_(Z.systemDisplay),1),n("span",ha,_(Z.value),1)]))),128))])])):A("",!0)]))),128)),((L=p.value)==null?void 0:L.length)>0?(l(),g("section",ga,[n("h2",fa,[a(S(U),{name:"clipboard-outline"}),m[10]||(m[10]=P(" Clinical Observations",-1))]),n("div",_a,[(l(!0),g(E,null,j(p.value,N=>(l(),g("div",{key:N.id,class:"observation-item"},[n("div",va,[n("h3",ya,_(N.display),1)]),n("div",ba,[n("div",Da,[m[11]||(m[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",Ca,_(N.value),1)]),n("div",$a,[m[12]||(m[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",wa,_(T(N.date)),1)]),N.category&&N.category!=="N/A"?(l(),g("div",Sa,[m[13]||(m[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",ka,_(N.category),1)])):A("",!0)])]))),128))])])):A("",!0),(B=r.value)!=null&&B.length&&!d.value?(l(),g("div",Aa,[n("p",null,[a(S(U),{name:"alert-circle-outline"}),m[14]||(m[14]=P(" No patient data found for the provided identifier. Please try again.",-1))])])):(I=r.value)!=null&&I.length&&d.value&&!f.value?(l(),g("div",Ia,[n("p",null,[a(S(U),{name:"information-circle-outline"}),m[15]||(m[15]=P(" No clinical observations found for this patient.",-1))])])):A("",!0),(G=r.value)!=null&&G.length?(l(),g("footer",Pa,[n("button",{onClick:et,class:"back-to-search-btn small-btn"},[a(S(U),{name:"arrow-back-outline"}),m[16]||(m[16]=P(" Back to Search ",-1))]),n("button",{onClick:q,class:"register-btn small-btn"},[a(S(U),{name:"person-add-outline"}),m[17]||(m[17]=P(" Register New Patient ",-1))])])):A("",!0)])])}}}),Na=W(Ta,[["__scopeId","data-v-0dc329ef"]]),Oa=H({name:"referrals",components:{ExternalReferrals:Na},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(e){this.segmentContent=e}}}),Ra={key:0},Va={style:{display:"flex","margin-top":"10px"}},Ma={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},La={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},Ba={key:1};function xa(e,t,s,i,r,y){const u=h("ion-label"),c=h("ion-segment-button"),p=h("ion-segment"),d=h("ExternalReferrals");return l(),g(E,null,[n("div",null,[a(p,{value:e.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:o(()=>[a(c,{value:"External referrals",onClick:t[0]||(t[0]=f=>e.setSegmentContent("External referrals"))},{default:o(()=>[a(u,null,{default:o(()=>t[2]||(t[2]=[P("External referrals",-1)])),_:1,__:[2]})]),_:1}),a(c,{value:"Internal referrals",onClick:t[1]||(t[1]=f=>e.setSegmentContent("Internal referrals"))},{default:o(()=>[a(u,null,{default:o(()=>t[3]||(t[3]=[P("Internal referrals",-1)])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),e.segmentContent=="Internal referrals"?(l(),g("div",Ra,[n("div",Va,[e.checkUnderFive?(l(),g("div",Ma)):A("",!0),t[4]||(t[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),e.checkUnderFive?A("",!0):(l(),g("div",La))])])):A("",!0),e.segmentContent=="External referrals"?(l(),g("div",Ba,[a(d)])):A("",!0)],64)}const Ea=W(Oa,[["render",xa],["__scopeId","data-v-e09d6a6b"]]),Ge=Ft("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(e){this.selectedItem=e},getSelectedItem(){return this.selectedItem}},persist:!0}),Fa=()=>{const e=V(null);return{activeIteminMixin:e,setActiveItem:s=>{e.value=s,console.log("lll: ",e.value)}}},Se=H({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:e,setActiveItem:t}=Fa();return{chevronBackOutline:Qt,checkmark:Fe,grid:Kt,chevronDownCircle:Gt,chevronForwardCircle:Jt,chevronUpCircle:jt,colorPalette:Wt,document:zt,globe:Ht,medkit:gt,add:Ut,person:me,people:ht,thermometer:mt,clipboard:pt,activeIteminMixin:e,setActiveItem:t}},async mounted(){await this.setAppointments()},computed:{...Y(ne,["patient"])},watch:{$route:{async handler(e){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await bn.getDailyAppointments(k.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((e,t)=>e.given_name.localeCompare(t.given_name)))},formatBirthdate(e){return k.getBirthdateAge(e)},setActiveItemRefFN(e){Ge().setSelectedItem(e)}}}),Ua=H({name:"NCDDashboard",mixins:[Se],components:{ApexChart:Ze},setup(){return{router:rt()}},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await ft(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){try{return z.getJson("programs/32/reports/ncd_dashboard",{start_date:k.toStandardHisFormat(k.sessionDate()),end_date:k.toStandardHisFormat(k.sessionDate())})}catch(e){return[]}},navigationMenu(e){try{Yt.close(),this.router.push(e).then(()=>{})}catch(t){console.error(t)}}}}),Ha={class:"cards-container"},za={class:"top-card-text"},Wa={class:"text-2xl font-bold"},ja={class:"top-card-text"},Ja={class:"text-2xl font-bold"},Ga={class:"top-card-text"},Ka={class:"text-2xl font-bold"},Qa={class:"top-card-text"},Ya={class:"text-2xl font-bold"},qa={class:"top-card-text"},Za={class:"text-2xl font-bold"},Xa={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},es={ref:"chartRef1"},ts={ref:"chartRef2"};function ns(e,t,s,i,r,y){const u=h("ion-card-content"),c=h("ion-card"),p=h("ApexChart");return l(),g(E,null,[n("div",Ha,[a(c,{class:"top-card action-card",onClick:t[0]||(t[0]=d=>e.setActiveItemRefFN("appointments"))},{default:o(()=>[a(u,null,{default:o(()=>[n("div",za,[n("div",Wa,_(e.appointments.length),1),t[2]||(t[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]),_:1})]),_:1}),a(c,{class:"top-card action-card"},{default:o(()=>[a(u,null,{default:o(()=>{var d;return[n("div",ja,[n("div",Ja,_((d=e.dashboardData)==null?void 0:d.total_pending_dispensations),1),t[3]||(t[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]}),_:1})]),_:1}),a(c,{class:"top-card action-card"},{default:o(()=>[a(u,null,{default:o(()=>{var d;return[n("div",Ga,[n("div",Ka,_((d=e.dashboardData)==null?void 0:d.total_defaulters),1),t[4]||(t[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]}),_:1})]),_:1}),a(c,{class:"top-card action-card"},{default:o(()=>[a(u,null,{default:o(()=>{var d;return[n("div",Qa,[n("div",Ya,_((d=e.dashboardData)==null?void 0:d.total_complications),1),t[5]||(t[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]}),_:1})]),_:1}),a(c,{class:"top-card action-card",onClick:t[1]||(t[1]=d=>e.navigationMenu("NCDActivePatients"))},{default:o(()=>[a(u,null,{default:o(()=>{var d;return[n("div",qa,[n("div",Za,_((d=e.dashboardData)==null?void 0:d.total_client_registered),1),t[6]||(t[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]}),_:1})]),_:1})]),n("div",Xa,[a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(u,null,{default:o(()=>[t[7]||(t[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",es,[e.isChartReady?(l(),R(p,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:e.barChartOptions,series:e.barChartSeries},null,8,["options","series"])):A("",!0)],512)]),_:1,__:[7]})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(u,null,{default:o(()=>[t[8]||(t[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",ts,[e.isChartReady?(l(),R(p,{key:0,style:{width:"100%",height:"500px"},type:"line",options:e.lineChartOptions,series:e.lineChartSeries},null,8,["options","series"])):A("",!0)],512)]),_:1,__:[8]})]),_:1})])],64)}const as=W(Ua,[["render",ns],["__scopeId","data-v-18251377"]]),ss=H({name:"Home",mixins:[wt,Se],components:{IonContent:se,IonHeader:ae,IonPage:Ve,IonToolbar:de,IonRow:Re,DateInputField:Xe,IonIcon:U,IonButton:Ae,IonCol:Oe,IonCard:Ne,IonCardHeader:vt,IonCardTitle:_t,IonCardContent:Ke,ViewToggleComponent:Fn,bottomNavBar:Un,HorizontalLine:Dn},data(){const e=localStorage.getItem("ncdStartDate"),t=localStorage.getItem("ncdEndDate"),s=V(e||k.sessionDate()),i=V(t||k.sessionDate()),r=V(k.sessionDate()),y=V(k.sessionDate()),u=V([]),c=Ue({page:1,itemsPerPage:10}),p=V(0),d=Bn(),f=V("list");return{minDate:r,startDate:s,endDate:i,people:u,calendarOutline:ye,openOutline:yt,maxDate:y,alertCircleOutline:ct,personOutline:an,idCardOutline:nn,manOutline:tn,womanOutline:en,locationOutline:Xt,timeOutline:Zt,todayOutline:qt,pagination:c,totalCount:p,actionButtonStore:d,currentToggleView:f}},computed:{...Y(He,["NCDAppointmentsTogglePreference"]),paginatedPeople(){const e=(this.pagination.page-1)*this.pagination.itemsPerPage,t=e+this.pagination.itemsPerPage;return this.people.slice(e,t)},groupedPaginatedPeople(){const e={};this.paginatedPeople.forEach(i=>{const r=i.appointmentDate;e[r]||(e[r]=[]),e[r].push(i)});const t=Object.keys(e).sort((i,r)=>new Date(i)-new Date(r)),s={};return t.forEach(i=>{s[i]=e[i]}),s}},$route:{async handler(){},deep:!0},watch:{NCDAppointmentsTogglePreference:{handler(e){e&&e.toggle_view&&(this.currentToggleView=e.toggle_view)},deep:!0,immediate:!0}},async mounted(){this.initTogglePreference(),this.getAppointments(),this.HideHomePageActionButton()},async unmounted(){this.actionButtonStore.resetShowActionButton()},methods:{formatBirthdate(e){return k.getBirthdateAge(e)},async getAppointments(e=!1){if(St().apiStatus){this.people=[],this.pagination.page=1;try{e==!0&&(this.startDate=k.sessionDate(),this.endDate=k.sessionDate(),this.getAppointmentsD1(this.startDate),this.getAppointmentsD2(this.endDate)),this.startDate>this.endDate&&(this.endDate=this.startDate),console.log(this.startDate,this.endDate),(await Pt.getAppointments(this.startDate,this.endDate,"")).forEach(i=>{const r=k.toStandardHisDisplayFormat(i.appointment_date);if(!this.people.some(u=>u.person_id===i.person_id&&u.appointmentDate===r)){const u={person_id:i.person_id,npid:i.npid,appointment_id:103,encounter_id:i.encounter_id,name:i.given_name.concat(" ",i.family_name),gender:i.gender,ageDob:this.formatBirthdate(i.birthdate),village:i.city_village,appointmentDate:r};this.people.push(u)}}),this.totalCount=this.people.length}catch(s){}}},async getAppointmentsD1(e){this.startDate=k.toStandardHisFormat(e),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(e){this.endDate=k.toStandardHisFormat(e),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(e){const t=await Ce.findByNpid(e);ne().setPatientRecord(t[0]),this.redirectUser()},handleViewChange(e){this.currentToggleView=e,this.initTogglePreference(e,!0)},initTogglePreference(e="list",t=!1){const s={toggle_view:e},i=He();Object.keys(this.NCDAppointmentsTogglePreference).length===0?(s.toggle_view="list",i.setNCDAppointmentsTogglePreference(s),this.currentToggleView="list"):t===!0?i.setNCDAppointmentsTogglePreference(s):this.currentToggleView=this.NCDAppointmentsTogglePreference.toggle_view||"list"},redirectUser(){const e=JSON.parse(localStorage.getItem("userRoles")),t=e||[];t.some(s=>t.some(i=>i.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")},handlePaginationUpdate({page:e,itemsPerPage:t}){if(t!==this.pagination.itemsPerPage){const s=(this.pagination.page-1)*this.pagination.itemsPerPage,i=Math.floor(s/t)+1,r=Math.ceil(this.totalCount/t);this.pagination.page=Math.min(i,r)||1,this.pagination.itemsPerPage=t}else this.pagination.page=e},HideHomePageActionButton(){this.actionButtonStore.setShowActionButton(!1)}}}),os={class:"appointments-container"},is={class:"date-filter"},ls={key:0,style:{margin:"20px"}},rs={key:1},ds={class:"appointments-table"},cs={key:2},us={class:"date-group-header"},ps={class:"date-header-title"},ms={class:"date-header-count"},hs={class:"cards-container"},gs={class:"card-details"},fs={class:"detail-item"},_s={class:"detail-value"},vs={class:"detail-item"},ys={class:"detail-value"},bs={class:"detail-item"},Ds={class:"detail-value"},Cs={class:"detail-item"},$s={class:"detail-value"};function ws(e,t,s,i,r,y){const u=h("DateInputField"),c=h("ion-col"),p=h("ion-icon"),d=h("ion-button"),f=h("ViewToggleComponent"),$=h("ion-row"),C=h("ion-card"),v=h("HorizontalLine"),w=h("ion-card-title"),b=h("ion-card-header"),M=h("ion-card-content"),T=h("ion-content"),O=h("bottomNavBar"),K=h("ion-footer");return l(),g("div",os,[n("div",is,[a($,null,{default:o(()=>[a(c,null,{default:o(()=>[a(u,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(c,null,{default:o(()=>[a(u,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1}),a(c,null,{default:o(()=>[a(d,{color:"primary",onClick:t[0]||(t[0]=J=>e.getAppointments(!0)),class:"apt-btn"},{default:o(()=>[a(p,{icon:e.todayOutline,slot:"start"},null,8,["icon"]),t[1]||(t[1]=n("span",{style:{margin:"5px"}}," Today ",-1))]),_:1,__:[1]})]),_:1}),a(c,null,{default:o(()=>[a(f,{"initial-view":e.currentToggleView,onViewChanged:e.handleViewChange},null,8,["initial-view","onViewChanged"])]),_:1})]),_:1})]),a(T,{class:"scrollable-content"},{default:o(()=>[e.people.length===0?(l(),g("div",ls,[a(p,{icon:e.alertCircleOutline,size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),t[2]||(t[2]=n("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Appointments for selected date range",-1))])):e.currentToggleView==="list"&&e.people.length>0?(l(),g("div",rs,[a(C,null,{default:o(()=>[n("table",ds,[t[3]||(t[3]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(l(!0),g(E,null,j(e.paginatedPeople,J=>(l(),g("tr",{key:J.npid},[n("td",null,[a($,null,{default:o(()=>[a(c,null,{default:o(()=>[P(_(J.name),1)]),_:2},1024),a(c,null,{default:o(()=>[a(d,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:pe=>e.openClientProfile(J.npid),color:"primary",fill:"clear",size:"small"},{default:o(()=>[a(p,{icon:e.openOutline,style:{"font-size":"28px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,_(J.npid),1),n("td",null,_(J.ageDob),1),n("td",null,_(J.gender),1),n("td",null,_(J.village),1),n("td",null,_(J.appointmentDate),1)]))),128))])])]),_:1})])):e.currentToggleView==="card"&&e.people.length>0?(l(),g("div",cs,[(l(!0),g(E,null,j(e.groupedPaginatedPeople,(J,pe)=>(l(),g("div",{key:pe,class:"date-group"},[n("div",us,[a(p,{icon:e.calendarOutline,class:"date-header-icon"},null,8,["icon"]),n("h2",ps,_(pe),1),n("div",ms,_(J.length)+" appointment"+_(J.length!==1?"s":""),1)]),a(v,{color:"#006401",thickness:1,spacing:"sm"}),n("div",hs,[(l(!0),g(E,null,j(J,q=>(l(),R(C,{key:q.npid,class:"appointment-card"},{default:o(()=>[a(b,null,{default:o(()=>[a($,{class:"ion-align-items-center"},{default:o(()=>[a(c,null,{default:o(()=>[a(w,{class:"card-name"},{default:o(()=>[a(p,{icon:e.personOutline,class:"name-icon"},null,8,["icon"]),P(" "+_(q.name),1)]),_:2},1024)]),_:2},1024),a(c,{size:"auto"},{default:o(()=>[a(d,{onClick:et=>e.openClientProfile(q.npid),color:"primary",fill:"clear",size:"small",class:"view-profile-btn"},{default:o(()=>[a(p,{icon:e.openOutline},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(M,null,{default:o(()=>[n("div",gs,[n("div",fs,[a(p,{icon:e.idCardOutline,class:"detail-icon"},null,8,["icon"]),t[4]||(t[4]=n("span",{class:"detail-label"},"NPID:",-1)),n("span",_s,_(q.npid),1)]),n("div",vs,[a(p,{icon:e.calendarOutline,class:"detail-icon"},null,8,["icon"]),t[5]||(t[5]=n("span",{class:"detail-label"},"Age/DOB:",-1)),n("span",ys,_(q.ageDob),1)]),n("div",bs,[a(p,{icon:q.gender==="Male"?e.manOutline:e.womanOutline,class:"detail-icon"},null,8,["icon"]),t[6]||(t[6]=n("span",{class:"detail-label"},"Gender:",-1)),n("span",Ds,_(q.gender),1)]),n("div",Cs,[a(p,{icon:e.locationOutline,class:"detail-icon"},null,8,["icon"]),t[7]||(t[7]=n("span",{class:"detail-label"},"Village:",-1)),n("span",$s,_(q.village),1)])])]),_:2},1024)]),_:2},1024))),128))])]))),128))])):A("",!0)]),_:1}),e.people.length>0?(l(),R(K,{key:0,class:"sticky-footer"},{default:o(()=>[a($,null,{default:o(()=>[a(c,{size:"12",style:{"max-width":"100%"}},{default:o(()=>[a(O,{totalItems:e.totalCount,currentPage:e.pagination.page,itemsPerPage:e.pagination.itemsPerPage,"onUpdate:pagination":e.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])]),_:1})]),_:1})]),_:1})):A("",!0)])}const Ss=W(ss,[["render",ws],["__scopeId","data-v-d02dae2c"]]),ks={key:0,class:"left_col"},As={class:"nav-menu"},Is=["onClick"],Ps={class:"ellipsis"},Ts={key:1,style:{"padding-left":"20px","padding-right":"20px"}},Ns=H({__name:"NCDDashboard",setup(e){const t=Ge(),s=Q(()=>t.selectedItem),{screenWidth:i}=Cn(),r=V([{id:"dashboard",label:"Dashboard",icon:bt},{id:"referrals",label:"Referrals",icon:Dt},{id:"appointments",label:"Appointments",icon:ye}]),y=V("dashboard"),u=$e(),{substance:c}=Ie(u);re(()=>c.value,(d,f)=>{d!==f&&console.log("Substance changed:",d)},{deep:!0,immediate:!0});const p=d=>{y.value=d,Ge().setSelectedItem(y.value)};return re(()=>s.value,d=>{console.log("Active item from mixin changed:",d),d&&d!=null&&p(d)},{immediate:!0}),(d,f)=>{const $=h("ion-segment-button"),C=h("ion-segment");return l(),g("div",{style:Pe(S(i)>940?"display: flex":"display: block")},[S(i)>940?(l(),g("div",ks,[n("nav",As,[n("ul",null,[(l(!0),g(E,null,j(r.value,v=>(l(),g("li",{key:v.id,class:te({active:y.value===v.id}),onClick:w=>p(v.id)},[a(S(U),{icon:v.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",Ps,_(v.label),1)],10,Is))),128))])])])):A("",!0),S(i)<=940?(l(),g("div",Ts,[a(C,{value:y.value,style:{"margin-top":"5px","justify-content":"left"}},{default:o(()=>[(l(!0),g(E,null,j(r.value,v=>(l(),R($,{value:v.id,key:v.id,class:te({active:y.value===v.id}),onClick:w=>p(v.id)},{default:o(()=>[a(S(U),{icon:v.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,_(v.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):A("",!0),n("div",{class:"right_col",style:Pe(S(i)>940?"width: 85%":"width: 100%")},[n("div",null,[y.value==="referrals"?(l(),R(Ea,{key:0})):A("",!0),y.value==="dashboard"?(l(),R(as,{key:1})):A("",!0),y.value==="appointments"?(l(),R(Ss,{key:2})):A("",!0)])],4)],4)}}}),Os=W(Ns,[["__scopeId","data-v-a1132315"]]),Rs={class:"dashboard"},Vs={class:"section"},Ms={class:"filter-bar"},Ls={class:"patient-table"},Bs={class:"details"},xs={class:"avatar"},Es={style:{display:"flex"}},Fs={class:"registration-status"},Us={class:"details"},Hs={class:"avatar"},zs={style:{display:"flex"}},Ws={class:"registration-status"},js={class:"details"},Js={class:"avatar"},Gs={style:{display:"flex"}},Ks={class:"registration-status red"},Qs=H({__name:"HTSDashboard",setup(e){return(t,s)=>(l(),g("div",Rs,[s[14]||(s[14]=sn('<div class="header" data-v-dc33afe7><div class="overlay" data-v-dc33afe7><h1 class="big-number" data-v-dc33afe7>6,788</h1><p class="header-text" data-v-dc33afe7> Total Number of Clients Tested<br data-v-dc33afe7> with Conclusive Results </p></div></div><div class="section" data-v-dc33afe7><div style="padding:10px;" data-v-dc33afe7><h2 class="section-title" data-v-dc33afe7>Clients seen today.</h2></div><div class="card" data-v-dc33afe7><div class="card-number" data-v-dc33afe7>67</div><div class="card-info" data-v-dc33afe7><p data-v-dc33afe7># of Clients Tested Today / Daily Average</p></div><div class="card-icon" data-v-dc33afe7>≡</div></div><div class="card" data-v-dc33afe7><div class="card-number" data-v-dc33afe7>3</div><div class="card-info" data-v-dc33afe7><p data-v-dc33afe7># of Clients Enrolled on ART Today / Daily Average</p></div><div class="card-icon" data-v-dc33afe7>≡</div></div><div class="card" data-v-dc33afe7><div class="card-number" data-v-dc33afe7>10</div><div class="card-info" data-v-dc33afe7><p data-v-dc33afe7># of Clients Tested Returning Today / Daily Average</p></div><div class="card-icon" data-v-dc33afe7>≡</div></div></div>',2)),n("div",Vs,[s[11]||(s[11]=n("h2",{class:"section-title"},"Patient Awaiting List",-1)),s[12]||(s[12]=n("div",{class:"total-box"},[n("span",{class:"total-number"},"252"),n("p",{style:{color:"#004d4d",width:"80%","font-size":"1.3em","font-weight":"bold"}}," Total (Registered + Returning + Referred (OPD, NCD, ART, etc)) ")],-1)),n("div",Ms,[a(S(U),{icon:S(on),style:{color:"#000","font-size":"40px"}},null,8,["icon"]),s[0]||(s[0]=n("input",{type:"text",placeholder:"Add filters"},null,-1))]),n("table",Ls,[s[10]||(s[10]=n("thead",null,[n("tr",null,[n("th",null,"Details"),n("th",null,"Statuses")])],-1)),n("tbody",null,[n("tr",null,[n("td",null,[n("div",Bs,[n("div",xs,[a(S(U),{icon:S(me),style:{color:"#fff","font-size":"100px"}},null,8,["icon"])]),s[1]||(s[1]=n("div",null,[n("strong",null,"Kalumphalinga Kachindamoto"),n("p",null,"Male • 37y")],-1))])]),n("td",Es,[s[3]||(s[3]=n("div",{class:"status-tags"},[n("span",{class:"tag active"},"Active"),n("span",{class:"tag yellow"},"Referred OPD")],-1)),n("div",Fs,[a(S(U),{icon:S(Fe),style:{color:"green","font-size":"20px"}},null,8,["icon"]),s[2]||(s[2]=n("span",{class:"tag-inscription"},"Registered Today",-1))])])]),n("tr",null,[n("td",null,[n("div",Us,[n("div",Hs,[a(S(U),{icon:S(me),style:{color:"#fff","font-size":"100px"}},null,8,["icon"])]),s[4]||(s[4]=n("div",null,[n("strong",null,"Kalumphalinga Kachindamoto"),n("p",null,"Female • 26y")],-1))])]),n("td",zs,[s[6]||(s[6]=n("div",{class:"status-tags"},[n("span",{class:"tag active"},"Active"),n("span",{class:"tag yellow"},"Returning Client")],-1)),n("div",Ws,[a(S(U),{icon:S(Fe),style:{color:"green","font-size":"20px"}},null,8,["icon"]),s[5]||(s[5]=n("span",{class:"tag-inscription"},"Registered Client",-1))])])]),n("tr",null,[n("td",null,[n("div",js,[n("div",Js,[a(S(U),{icon:S(me),style:{color:"#fff","font-size":"100px"}},null,8,["icon"])]),s[7]||(s[7]=n("div",null,[n("strong",null,"Kalumphalinga Kachindamoto"),n("p",null,"Female • 17y")],-1))])]),n("td",Gs,[s[9]||(s[9]=n("div",{class:"status-tags"},[n("span",{class:"tag red"},"Not Active"),n("span",{class:"tag yellow"},"Referred ART")],-1)),n("div",Ks,[a(S(U),{icon:S(me),style:{color:"#000","font-size":"10px"}},null,8,["icon"]),s[8]||(s[8]=n("span",{class:"tag-inscription"},"Registered Today",-1))])])])])]),s[13]||(s[13]=n("div",{class:"see-all"},[n("p",null,"See all")],-1))])]))}}),Ys=W(Qs,[["__scopeId","data-v-dc33afe7"]]),lt={"HIV clinic registration":ee.HIV_CLINIC_REGISTRATION,"HIV reception":ee.HIV_RECEPTION,Vitals:ee.VITALS,"HIV staging":ee.HIV_STAGING,"HIV clinic consultation":ee.HIV_CLINIC_CONSULTATION,"ART adherence":ee.ART_ADHERENCE,Prescription:ee.TREATMENT,Dispensing:ee.DISPENSING,Appointments:ee.APPOINTMENT};class qs extends kt{constructor(){super()}buildEncounters(t,s){return Object.entries(lt).map(([i,r])=>({encounter:i,female:t?t[r].F:0,male:t?t[r].M:0,me:s?s[r].F+s[r].M:0,facility:t?t[r].F+t[r].M:0}))}async getStats(){const t=Object.values(lt),s=$n("reports/encounters",this.buildParams()),i=await Te.postJson(s,{encounter_types:t}),r=await Te.postJson(s,{encounter_types:t,all:!0});return this.buildEncounters(i.data,r.data)}getEncounterStats(t){return z.postJson("reports/encounters?date=".concat(this.date,"&program_id=1"),t)}}class Zs extends kt{constructor(){super()}static getLocationName(){return sessionStorage.getItem("locationName")}getBookedAppointments(t){return Te.getJson("programs/".concat(le,"/scheduled_appointments"),{date:t})}getViralLoadResults(t){return this.getReport("/programs/".concat(le,"/reports/high_vl_patients"),{range:t})}getOtherOutcome(t){return this.getReport("patient_outcome_list",{outcome:t})}getPatientVisitTypes(){return this.getReport("patient_visit_types")}getClientsDueForVl(){return this.getReport("clients_due_vl")}getClientRentention(){return this.getReport("/programs/".concat(le,"/reports/retention"))}getExternalConsultationClients(){return this.getReport("".concat(le,"/external_consultation_clients"))}getMissedAppointments(){return this.getReport("missed_appointments")}getPregnantWomen(){return this.getReport("/programs/".concat(le,"/reports/pregnant_patients"))}getArchivingCandidates(){return Te.getJson("programs/".concat(le,"/reports/archiving_candidates"),{start_date:this.date})}getIncompleteVisits(){return this.getReport("incomplete_visits",{tool_name:"INCOMPLETE VISITS"})}getVisitStats(){return z.getJson("programs/".concat(le,"/reports/visits"),{name:"visits",start_date:this.startDate,end_date:this.endDate})}}const Xs={class:"dashboard-container"},eo={class:"main-section"},to={class:"chart-section"},no={class:"encounters-section"},ao={class:"his-sm-text"},so={key:0},oo={class:"encounter-td"},io={class:"other-td"},lo={class:"other-td"},ro={class:"other-td"},co={class:"other-td"},uo={key:1},po=H({__name:"ARTDashboard",setup(e){const t=V([]),s=Ue({options:{chart:{id:"vuechart-example"},xaxis:{categories:["","","","",""]},yaxis:{min:0,forceNiceScale:!0,title:{text:"Number of clients",align:"left"}}},series:[{name:"Total visits",data:[0,0,0,0,0],color:"#7cb5ec"},{name:"Total incomplete visits",data:[0,0,0,0,0],color:"#434348"}]}),i=Ue([{"HIV clinic registration":9},{"HIV reception":51},{Vitals:6},{"HIV staging":52},{"HIV clinic consultation":53},{"ART adherence":68},{Treatment:25},{Dispensing:54},{Appointments:7}]),r=()=>{t.value=i.map(c=>({encounter:Object.keys(c)[0],female:"",male:"",me:"",facility:""}))},y=async()=>{const c=new Zs,p=z.getSessionDate();c.setStartDate(k.subtract(p,"days",5).format(tt)),c.setEndDate(k.subtract(p,"days",1).format(tt));const d=await c.getVisitStats(),f=[],$=[],C=[];Object.entries(d).forEach(([v,{incomplete:w,complete:b}])=>{C.push(ln(v).format("dddd")),f.push(w),$.push(w+b)}),s.series[0].data=[...$],s.series[1].data=[...f],s.options={...s.options,xaxis:{categories:[...C]}}},u=async()=>{try{const c=new qs,p=i.map($=>Object.values($)[0]),d=await c.getEncounterStats({encounter_types:p}),f=await c.getEncounterStats({encounter_types:p,all:!0});t.value=i.map($=>{const[C,v]=Object.entries($)[0];return{encounter:C,female:f[v].F,male:f[v].M,me:d[v].F+d[v].M,facility:f[v].F+f[v].M}})}catch(c){console.error(c)}};return ge(()=>{r(),y(),u()}),(c,p)=>(l(),g("div",Xs,[n("div",eo,[n("div",to,[p[0]||(p[0]=n("h3",null,"Total visits/incomplete visits: last 5 days",-1)),a(S(Ze),{width:"100%",height:"390px",type:"bar",options:s.options,series:s.series},null,8,["options","series"])]),n("div",no,[p[3]||(p[3]=n("h3",null,"Encounters created today",-1)),n("table",ao,[p[2]||(p[2]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),t.value.length?(l(),g("tbody",so,[(l(!0),g(E,null,j(t.value,(d,f)=>(l(),g("tr",{key:f},[n("td",oo,_(d.encounter),1),n("td",io,_(d.female),1),n("td",lo,_(d.male),1),n("td",ro,_(d.me),1),n("td",co,_(d.facility),1)]))),128))])):(l(),g("tbody",uo,p[1]||(p[1]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])))])])])]))}});class Ee extends z{static getlogs(t,s){return this.getJson("notification/logs",{startDate:t,endDate:s})}static clear(t){return this.putJson("notifications/clear/".concat(t),{id:t})}static read(t){return this.putJson("notifications/update",{alerts:t})}static unread(){return this.getJson("notifications")}}const ie=V([]);function Tt(){const e=Q(()=>ie.value.filter(f=>!f.read)),t=Q(()=>ie.value.length>0),s=Q(()=>e.value.length>0),i=Q(()=>e.value.length),r=Q(()=>ie.value.sort((f,$)=>new Date(f.date)>new Date($.date)?-1:1));function y(f,$){wn("Are you sure you want to clear notification?").then(C=>{C&&Ee.clear(f).then(()=>{ie.value=ie.value.filter(v=>v.id!=f),$(f),c()}).catch(v=>{console.error(v),ze("Unable to clear notification")})})}function u(f){return k.toStandardHisDisplayFormat(f)}async function c(){ie.value=[];const f=await Ee.unread();if(!ve.isEmpty(f)){const $={highVL:[],normalVL:[],rejectedVL:[]};let C={};ie.value=f.map(v=>{let w="General";const b=v.text;let M=null;try{const T=JSON.parse(v.text);if(T.Type.match(/lims/i)){M=()=>Sn.push("/art/encounters/lab/".concat(T.PatientID)),w="".concat(T["Test type"]," results for ").concat(T["ARV-Number"]||T["Accession number"]);const O=kn.detectHighVl(T.Result[0].value,T.Result[0].value_modifier);C={handler:M,id:v.alert_id,arv:T["ARV-Number"],accession:T["Accession number"],order_date:u(T["Orde date"]),results:T.Result[0].value_modifier+" "+T.Result[0].value,results_date:u(T.Result[0].date)},O?$.highVL.push(C):T.rejection_reason?(C={handler:M,id:v.alert_id,arv:T.arv_number,accession:T.accession_number,order_date:u(T.order_date),rejection_reason:T.rejection_reason},$.rejectedVL.push(C)):O||$.normalVL.push(C)}}catch(T){console.warn(T)}return{handler:M,message:b,vlMessageObs:$,title:w,id:v.alert_id,date:u(v.date_created)}})}}async function p(f){Ee.read([f.id]).then(()=>f.read=!0)}function d(f){typeof f.handler=="function"&&(p(f),f.handler())}return{markAsRead:p,openNotification:d,loadNotifications:c,clearNotification:y,sortedNotifications:r,hasUnreadNotifications:s,notificationCount:i,hasNotifications:t,notificationData:ie}}const mo={class:"vl-alerts-container"},ho={class:"table-container"},go={class:"vl-table"},fo={key:0},_o={key:0},vo=["colspan"],yo={key:0},bo=H({__name:"ARTVlAlert",setup(e){const t=V("high_vl"),{notificationData:s,loadNotifications:i,clearNotification:r,openNotification:y}=Tt(),u=Q(()=>{var w,b;return s.value.length?(((b=(w=s.value[0])==null?void 0:w.vlMessageObs)==null?void 0:b.highVL)||[]).length:0}),c=Q(()=>{var w,b;return s.value.length?(((b=(w=s.value[0])==null?void 0:w.vlMessageObs)==null?void 0:b.rejectedVL)||[]).length:0}),p=Q(()=>{var w,b;return s.value.length?(((b=(w=s.value[0])==null?void 0:w.vlMessageObs)==null?void 0:b.normalVL)||[]).length:0}),d=Q(()=>{var w;if(!s.value.length)return[];const v=(w=s.value[0])==null?void 0:w.vlMessageObs;if(!v)return[];switch(t.value){case"high_vl":return v.highVL||[];case"rejected":return v.rejectedVL||[];case"normal":return v.normalVL||[];default:return[]}}),f=v=>y(v),$=v=>{v.id&&r(v.id,w=>{console.log("Cleared notification ".concat(w))})},C=()=>{switch(t.value){case"high_vl":return"No high viral load results found";case"rejected":return"No rejected samples found";case"normal":return"No normal results found";default:return"No results found"}};return ge(()=>{i()}),(v,w)=>(l(),g("div",mo,[a(S(Qe),{mode:"ios",modelValue:t.value,"onUpdate:modelValue":w[0]||(w[0]=b=>t.value=b),class:"category-segment"},{default:o(()=>[a(S(he),{value:"high_vl"},{default:o(()=>[a(S(_e),null,{default:o(()=>[P("High VL ("+_(u.value)+")",1)]),_:1})]),_:1}),a(S(he),{value:"rejected"},{default:o(()=>[a(S(_e),null,{default:o(()=>[P("Rejected ("+_(c.value)+")",1)]),_:1})]),_:1}),a(S(he),{value:"normal"},{default:o(()=>[a(S(_e),null,{default:o(()=>[P("Normal Results ("+_(p.value)+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",ho,[n("table",go,[n("thead",null,[n("tr",null,[w[1]||(w[1]=n("th",null,"ARV #",-1)),w[2]||(w[2]=n("th",null,"Accession #",-1)),w[3]||(w[3]=n("th",null,"Order Date",-1)),t.value==="rejected"?(l(),g("th",fo,"Rejection Reason")):A("",!0),w[4]||(w[4]=n("th",null,"View",-1)),w[5]||(w[5]=n("th",null,"Clear",-1))])]),n("tbody",null,[d.value.length===0?(l(),g("tr",_o,[n("td",{colspan:t.value==="rejected"?6:5,class:"empty-message"},_(C()),9,vo)])):A("",!0),(l(!0),g(E,null,j(d.value,b=>(l(),g("tr",{key:b.id},[n("td",null,_(b.arv||"-"),1),n("td",null,_(b.accession||"-"),1),n("td",null,_(b.order_date||"-"),1),t.value==="rejected"?(l(),g("td",yo,_(b.rejection_reason||"-"),1)):A("",!0),n("td",null,[a(S(Ae),{fill:"clear",size:"small",onClick:M=>f(b)},{default:o(()=>[a(S(U),{icon:S(Ct),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"])]),n("td",null,[a(S(Ae),{fill:"clear",size:"small",onClick:M=>$(b),color:"success"},{default:o(()=>[a(S(U),{icon:S(rn),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"])])]))),128))])])])]))}}),Do=W(bo,[["__scopeId","data-v-1aa5b6c6"]]),Co={class:"dashboard-container"},$o={class:"segment-content"},wo={key:0},So={key:1},ko=H({__name:"ARTHome",setup(e){const t=V("dashboard"),{notificationCount:s,loadNotifications:i}=Tt();return ge(()=>{i()}),(r,y)=>(l(),g("div",Co,[a(S(Qe),{modelValue:t.value,"onUpdate:modelValue":y[0]||(y[0]=u=>t.value=u)},{default:o(()=>[a(S(he),{value:"dashboard"},{default:o(()=>y[1]||(y[1]=[P(" Overview ",-1)])),_:1,__:[1]}),a(S(he),{value:"viralLoadAlerts"},{default:o(()=>[n("div",$o,[y[2]||(y[2]=P(" VL Alerts ",-1)),S(s)>0?(l(),R(S(dn),{key:0,color:"primary"},{default:o(()=>[P(_(S(s)),1)]),_:1})):A("",!0)])]),_:1})]),_:1},8,["modelValue"]),t.value==="dashboard"?(l(),g("div",wo,[a(po)])):A("",!0),t.value==="viralLoadAlerts"?(l(),g("div",So,[a(Do)])):A("",!0)]))}}),Ao=W(ko,[["__scopeId","data-v-907b1bb8"]]);class Io{constructor(){X(this,"socket",null);X(this,"channel","ImmunizationReportChannel");X(this,"isConnected",!1);X(this,"pendingFetch",null);X(this,"location_id");X(this,"initPromise");X(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});X(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});X(this,"onError",t=>{console.error("WebSocket error:",t),this.isConnected=!1});this.initPromise=this.init()}async init(){const t=localStorage.getItem("apiURL"),s=localStorage.getItem("apiPort"),i=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const r="".concat(i,"://").concat(t,"/api/v1/cable");this.socket=new WebSocket(r),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(r){console.error(r),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const t={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(t))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await z.getJson("immunization/stats",{start_date:k.getDateBeforeByDays(k.sessionDate(),365),end_date:k.sessionDate()})}async setMessageHandler(t){await this.initPromise,this.socket?this.socket.onmessage=s=>{t(s)}:console.error("WebSocket connection not established.")}}const Po=H({components:{IonContent:se,IonHeader:ae,IonItem:ue,IonList:ce,IonMenu:De,IonTitle:be,IonToolbar:de,IonInput:dt,BasicInputField:In,BasicForm:we,PreviousVitals:An,customDatePicker:zn,IonCol:Oe,IonRow:Re,VueMultiselect:cn,IonLabel:_e,DataTable:Me},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:qe,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:k.toStandardHisDisplayFormat(z.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...Y(Hn,["administerOtherVaccine"]),...Y(nt,["tempScannedBatchNumber"]),...Y(ne,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await jn(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:me,pulseOutline:un,clipboardOutline:ut}},methods:{formatBirthdate(e){return k.getBirthdateAge(e)},async openClientProfile(e){const t=await Ce.findByID(e);await ne().setPatientRecord(t),this.$router.push("patientProfile")},processData(){var t;return((t=this.data)==null?void 0:t.map(s=>{if(s.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let i=[];const r=y=>y.map(c=>{let p=0;return c.clients.map(d=>{(c.drug_name==this.drug_name&&(this.village==d.table.city_village||this.village=="All")||(c.drug_name==this.drug_name||this.village==d.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:d.table.given_name,family_name:d.table.family_name,patient_id:d.table.patient_id,birthdate:d.table.birthdate,city_village:d.table.city_village}),p++),this.villageList.push(d.table.city_village)}),[c.drug_name,p]}).filter(c=>c[1]!==0);return this.title=="Client due today"&&(i=r(s.value.due_today_antigens)),this.title=="Client due this week"&&(i=r(s.value.due_this_week_antigens)),this.title=="Client due this month"&&(i=r(s.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(i=r(s.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(i=r(s.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(y=>JSON.stringify(y)))].map(y=>JSON.parse(y)),this.villageList=[...new Set(this.villageList)],i}}))[0]},handleVillageClick(e){this.drug_name="",this.village=e,this.tableData=this.processData()},handleRowClick(e){var s;this.tableEvent=e.target;const t=this.tableEvent.closest("tr");if(t){const i=Array.from(((s=t.parentNode)==null?void 0:s.children)||[]).indexOf(t),r=this.tableData[i];this.drug_name=r[0],t.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(e){return k.calculateDisplayAge(e)},openPopover(e){this.event=e,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(e){var s;const t=e.target.value;this.batchNumber=t||((s=this.tempScannedBatchNumber)==null?void 0:s.text)||""},saveBatchWithTodayDate(){let e=z.getSessionDate();this.saveDta(e)},dismiss(){Le.dismiss()},saveBatch(){let e;ve.isEmpty(this.vaccineDate)==!0?e=z.getSessionDate():e=this.vaccineDate,this.saveDta(e)},validateVaccineName(){if(ve.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(ve.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(e){this.currentDrugOb=e},isAlphaNumeric(e){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(e)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(e){this.batchNumber=e},saveDta(e){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){ze("Enter batch number!");return}if(this.batchNumber==""){ze("Enter batch number!");return}const t={batch_number:this.batchNumber,date_administered:e,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},s=nt();s.setAdministeredVaccine(t),Wn(this.patient),this.dismiss(),s.setTempScannedBatchNumber(null)}}}),To={key:0,class:"spinner-overlay"},No={class:"header position_content"},Oo={style:{"font-size":"1.2em","font-weight":"700"}},Ro={class:"dueCardContent"},Vo=["onClick"],Mo={style:{"margin-right":"15px"}},Lo={style:{"align-items":"center",display:"flex"}},Bo={style:{"line-height":"1"}},xo={class:"client_name"},Eo={class:"name"},Fo={class:"demographicsOtherRow"},Uo={class:"demographicsText"};function Ho(e,t,s,i,r,y){const u=h("ion-spinner"),c=h("ion-icon"),p=h("ion-header"),d=h("ion-card-title"),f=h("ion-card-header"),$=h("DataTable"),C=h("ion-card-content"),v=h("ion-card"),w=h("ion-item"),b=h("ion-list"),M=h("ion-popover"),T=h("ion-content");return l(),g(E,null,[e.isLoading?(l(),g("div",To,[a(u,{name:"bubbles"}),t[3]||(t[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):A("",!0),a(p,null,{default:o(()=>[n("div",No,[n("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=O=>e.dismiss())},[a(c,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Oo,_(e.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:t[1]||(t[1]=O=>e.openPopover(O))},[a(c,{slot:"separator",size:"large",icon:e.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(T,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:o(()=>[n("div",null,[a(v,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:o(()=>[a(f,null,{default:o(()=>[a(d,{class:"sectionTitle"},{default:o(()=>t[4]||(t[4]=[P(" Summary of required doses ",-1)])),_:1,__:[4]})]),_:1}),a(C,null,{default:o(()=>[n("div",Ro,[a($,{options:e.options,data:e.tableData,class:"display nowrap",width:"100%",onClick:e.handleRowClick},{default:o(()=>t[5]||(t[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])),_:1,__:[5]},8,["options","data","onClick"])])]),_:1})]),_:1}),a(v,{class:"section",style:{"margin-inline":"0px"}},{default:o(()=>[a(f,null,{default:o(()=>[a(d,{class:"sectionTitle"},{default:o(()=>t[6]||(t[6]=[P("Client Details ",-1)])),_:1,__:[6]})]),_:1}),a(C,null,{default:o(()=>[(l(!0),g(E,null,j(e.clientDetails,(O,K)=>(l(),g("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:K,onClick:J=>e.openClientProfile(O.patient_id)},[n("div",Mo,[n("div",{class:te((O==null?void 0:O.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(c,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:e.person},null,8,["icon"])],2)]),n("div",Lo,[n("div",Bo,[n("div",xo,[n("div",Eo,_(O.given_name)+" "+_(O.family_name),1)]),n("div",Fo,[n("div",Uo,[P(_(O.gender=="M"?"Male":"Female")+" ",1),t[7]||(t[7]=n("span",{class:"dot"},".",-1)),P(_(e.formatBirthdate(O.birthdate)),1)])]),n("div",null,"Village: "+_(O.city_village),1)])])],8,Vo))),128))]),_:1})]),_:1})]),a(M,{style:{"--offset-x":"-10px"},"is-open":e.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:e.event,onDidDismiss:t[2]||(t[2]=O=>e.popoverOpen=!1)},{default:o(()=>[n("div",null,[t[8]||(t[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(l(!0),g(E,null,j(e.villageList,(O,K)=>(l(),R(b,{class:te(O==e.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:K},{default:o(()=>[a(w,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:J=>e.handleVillageClick(O)},{default:o(()=>[P(_(O),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const zo=W(Po,[["render",Ho],["__scopeId","data-v-2b76e9ce"]]),Wo=H({name:"Menu",mixins:[Se],components:{IonContent:se,IonHeader:ae,IonItem:ue,IonList:ce,IonMenu:De,IonTitle:be,IonToolbar:de,IonCheckbox:Be,BasicForm:we,BasicCard:xe,Carousel:gn,Slide:hn,Pagination:mn,Navigation:pn},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},computed:{...Y($e,["substance"]),backgroundStyle(){return{background:"linear-gradient(180deg, rgba(150, 152, 152, 0.7) 0%, rgba(255, 255, 255, 0.9) 100%), url(".concat(Jn("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",height:"22.8vh"}}},watch:{},async mounted(){new Io().setMessageHandler(this.onMessage)},methods:{async onMessage(e){var s,i,r;const t=JSON.parse(e.data);t.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=t.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((s=this.reportData)==null?void 0:s.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((i=this.reportData)==null?void 0:i.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((r=this.reportData)==null?void 0:r.total_male_vaccinated_this_year)||0}])},openDueModal(e){const t={title:e,dashBoardData:this.reportData};ke(zo,{class:"fullScreenModal"},!0,t)},async openClientProfile(e){const t=Pn(),s=async i=>{await ne().setPatientRecord(i),this.$router.push("patientProfile")};if(t==!1){const i=await Ce.findByNpid(e);await s(i[0])}if(t){const i=await Tn(e);s(i)}}}}),jo={class:"topStats"},Jo={class:"totalStats",style:{background:"linear-gradient(180deg, #20b2aa 0%, #40c0b0 50%, rgb(233, 233, 233) 100%)"}},Go={class:"statsValue",style:{"font-size":"1.4em"}},Ko={class:"statsText",style:{"font-size":"0.9em"}},Qo={class:"dueCardContent"},Yo={class:"statsValue"},qo={class:"statsValue"},Zo={class:"statsValue"},Xo={class:"overDueCardContent"},ei={class:"statsValue"},ti={class:"statsValue"},ni=["onClick"],ai={style:{"margin-right":"15px"}},si={style:{"align-items":"center",display:"flex"}},oi={style:{"line-height":"1"}},ii={class:"client_name"},li={class:"name"},ri={class:"demographicsOtherRow"},di={class:"demographicsText"};function ci(e,t,s,i,r,y){const u=h("Slide"),c=h("Pagination"),p=h("Carousel"),d=h("ion-card-title"),f=h("ion-card-header"),$=h("ion-card-content"),C=h("ion-card"),v=h("ion-icon"),w=h("ion-content");return l(),R(w,{class:"content"},{default:o(()=>[n("div",jo,[n("div",null,[n("div",{style:Pe(e.backgroundStyle)},[a(p,{autoplay:4e3,"wrap-around":!0,itemsToShow:1.2,transition:600,style:{"padding-top":"20px"}},{addons:o(()=>[a(c)]),default:o(()=>[(l(!0),g(E,null,j(e.totalStats,b=>(l(),R(u,{key:b},{default:o(()=>[n("div",Jo,[n("div",Go,_(b.value),1),n("div",Ko,_(b.name),1)])]),_:2},1024))),128))]),_:1})],4)]),a(C,{class:"section"},{default:o(()=>[a(f,null,{default:o(()=>[a(d,{class:"cardTitle"},{default:o(()=>t[5]||(t[5]=[P(" Clients due ",-1)])),_:1,__:[5]})]),_:1}),a($,null,{default:o(()=>{var b,M,T;return[n("div",Qo,[n("div",{class:"dueCard",onClick:t[0]||(t[0]=O=>e.openDueModal("Client due today")),style:{border:"1px solid rgb(158, 207, 136)"}},[n("div",Yo,_(((b=e.reportData)==null?void 0:b.due_today_count)||0),1),t[6]||(t[6]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(239, 221, 121)"},onClick:t[1]||(t[1]=O=>e.openDueModal("Client due this week"))},[n("div",qo,_(((M=e.reportData)==null?void 0:M.due_this_week_count)||0),1),t[7]||(t[7]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(241, 154, 154)"},onClick:t[2]||(t[2]=O=>e.openDueModal("Client due this month"))},[n("div",Zo,_(((T=e.reportData)==null?void 0:T.due_this_month_count)||0),1),t[8]||(t[8]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),a(C,{class:"section"},{default:o(()=>[a(f,null,{default:o(()=>[a(d,{class:"cardTitle"},{default:o(()=>t[9]||(t[9]=[P(" Clients overdue ",-1)])),_:1,__:[9]})]),_:1}),a($,null,{default:o(()=>{var b,M;return[n("div",Xo,[n("div",{class:"overDueCard",onClick:t[3]||(t[3]=T=>e.openDueModal("Client overdue under 5yrs"))},[n("div",ei,_(((b=e.reportData)==null?void 0:b.under_five_overdue)||0),1),t[10]||(t[10]=n("div",{class:"statsText"},"Under 5yrs",-1))]),n("div",{class:"overDueCard",onClick:t[4]||(t[4]=T=>e.openDueModal("Client overdue over 5yrs"))},[n("div",ti,_(((M=e.reportData)==null?void 0:M.over_five_overdue)||0),1),t[11]||(t[11]=n("div",{class:"statsText"},"Over 5yrs",-1))])])]}),_:1})]),_:1}),a(C,{class:"section"},{default:o(()=>[a(f,null,{default:o(()=>[a(d,{class:"cardTitle"},{default:o(()=>{var b;return[P("Today's appointments("+_((b=e.appointments)==null?void 0:b.length)+") ",1)]}),_:1})]),_:1}),a($,null,{default:o(()=>[(l(!0),g(E,null,j(e.appointments,(b,M)=>(l(),g("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:M,onClick:T=>e.openClientProfile(b.npid)},[n("div",ai,[n("div",{class:te(b.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(v,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:e.person},null,8,["icon"])],2)]),n("div",si,[n("div",oi,[n("div",ii,[n("div",li,_(b.given_name)+" "+_(b.family_name),1)]),n("div",ri,[n("div",di,[P(_(b.gender=="M"?"Male":"Female")+" ",1),t[12]||(t[12]=n("span",{class:"dot"},".",-1)),P(_(e.formatBirthdate(b.birthdate)),1)])]),n("div",null,"Village: "+_(b==null?void 0:b.city_village),1)])])],8,ni))),128))]),_:1})]),_:1})])]),_:1})}const ui=W(Wo,[["render",ci],["__scopeId","data-v-13cf6a75"]]),pi=H({components:{DataTable:Me},props:{title:{type:String,default:""},list:{type:String,default:""},buttonTitle:{type:String,default:""},buttonLink:{type:String,default:""}},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:(e,t)=>{if(!e)return"-";const s=new Date(e).getTime(),i=Date.now()-s,r=Math.floor(i/6e4),y=(()=>{if(r<1)return"Just now";if(r<60)return"".concat(r," min").concat(r>1?"s":""," ago");const u=Math.floor(r/60);if(u<24)return"".concat(u," hour").concat(u>1?"s":""," ago");const c=Math.floor(u/24);return"".concat(c," day").concat(c>1?"s":""," ago")})();return t==="display"?y:i},type:"num",width:"15%"},{title:"Actions",data:null,render:(e,t,s)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px";const r="  --padding-top: 4px;\n                                            --padding-bottom: 4px;\n                                            --padding-start: 8px;\n                                            --padding-end: 8px;\n                                            font-size: 0.8rem;\n                                            height: 28px;\n                                            min-width: 70px;\n                                            white-space: nowrap;\n                                            ",y=(u,c,p)=>{const d=document.createElement("ion-button");return d.innerText=u,d.size="small",d.fill="solid",d.color=c,d.style.cssText=r,d.addEventListener("click",p),d};return i.appendChild(y(this.buttonTitle,"primary",()=>this.navigateTo(s,this.buttonLink))),i.appendChild(y("Profile","warning",()=>this.navigateTo(s,"/patientProfile"))),i.appendChild(y("Abscond","danger",()=>this.handleAbscond(s.identifier))),i},orderable:!1,width:"25%"}],tableOptions:{order:[[1,"desc"]]}}},computed:{...Y(Je,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{patientsWaitingForConsultation:{handler(e){this.list==="CONSULTATION"&&(this.patients=e)},deep:!0},patientsWaitingForVitals:{handler(e){this.list==="VITALS"&&(this.patients=e)},deep:!0},patientsWaitingForLab:{handler(e){this.list==="LAB"&&(this.patients=e)},deep:!0},patientsWaitingForDispensation:{handler(e){this.list==="DISPENSATION"&&(this.patients=e)},deep:!0}},mounted(){this.setList()},methods:{setList(){const e={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation},t=this.list;this.patients=e[t]||[]},waitingTime(e){if(!e)return"-";const t=Date.now()-new Date(e).getTime(),s=Math.floor(t/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const i=Math.floor(s/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const r=Math.floor(i/24);return"".concat(r," day").concat(r>1?"s":""," ago")},async navigateTo(e,t){let s=[];if(z.getUseIndexDBStatus()||z.getModsStatus()?(s=await We("patientRecords",{whereClause:{ID:e.identifier}}),s=s[0]):s=await z.getJson("/patients/".concat(e.patient_id,"/get_patient_record")),!s||s.length===0){je("Patient not found in offline records.");return}const i=s;await ne().setPatientRecord(i),this.$router.push(t)},async handleAbscond(e){await Nn({ID:e})},dismiss(){Le.dismiss()}}}),mi={class:"modal-container"},hi={class:"dueCardContent"};function gi(e,t,s,i,r,y){const u=h("ion-button"),c=h("ion-card-title"),p=h("ion-card-header"),d=h("DataTable"),f=h("ion-card-content"),$=h("ion-card");return l(),g("div",mi,[a(u,{class:"close-button",fill:"clear",size:"large",onClick:e.dismiss},{default:o(()=>t[0]||(t[0]=[P(" Close ",-1)])),_:1,__:[0]},8,["onClick"]),a($,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:o(()=>[a(p,null,{default:o(()=>[a(c,{class:"sectionTitle"},{default:o(()=>[P(_(e.title),1)]),_:1})]),_:1}),a(f,null,{default:o(()=>[n("div",hi,[a(d,{data:e.patients,options:e.tableOptions,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const fi=W(pi,[["render",gi],["__scopeId","data-v-cba345be"]]),_i=H({components:{IonContent:se,IonHeader:ae,IonItem:ue,IonList:ce,IonIcon:U,IonCard:Ne,IonCardHeader:vt,IonCardTitle:_t,IonCardContent:Ke,IonPopover:$t,DataTable:Me},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:qe,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:e=>this.waitingTime(e),width:"20%"},{title:"Actions",data:null,render:(e,t,s)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px";const r="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",y=(u,c,p)=>{const d=document.createElement("ion-button");return d.innerText=u,d.size="small",d.fill="solid",d.color=c,d.style.cssText=r,d.addEventListener("click",p),d};return i.appendChild(y("Profile","warning",()=>this.navigateTo(s.patient_id,"/patientProfile"))),i},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const e=await On();console.log("🚀 ~ mounted ~ todayVisits:",e),this.patients=e.map(t=>({fullName:t.fullName||"",arrivalTime:t.startDate||"",patient_id:t.patientId||""}))},methods:{openPopover(e){this.event=e,this.popoverOpen=!0},dismiss(){Le.dismiss()},waitingTime(e){if(!e)return"-";const t=Date.now()-new Date(e).getTime(),s=Math.floor(t/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const i=Math.floor(s/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const r=Math.floor(i/24);return"".concat(r," day").concat(r>1?"s":""," ago")},async navigateTo(e,t){const s=await Ce.findByID(e);await ne().setPatientRecord(s),this.$router.push(t)}}}),vi={class:"modal-container"},yi={class:"dueCardContent"};function bi(e,t,s,i,r,y){const u=h("ion-button"),c=h("ion-card-title"),p=h("ion-card-header"),d=h("DataTable"),f=h("ion-card-content"),$=h("ion-card");return l(),g("div",vi,[a(u,{class:"close-button",fill:"clear",size:"large",onClick:e.dismiss},{default:o(()=>t[0]||(t[0]=[P(" Close ",-1)])),_:1,__:[0]},8,["onClick"]),a($,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:o(()=>[a(p,null,{default:o(()=>[a(c,{class:"sectionTitle"},{default:o(()=>[P(_(e.title),1)]),_:1})]),_:1}),a(f,null,{default:o(()=>[n("div",yi,[a(d,{data:e.patients,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})])}const Di=W(_i,[["render",bi],["__scopeId","data-v-7defd599"]]),Ci=H({name:"OPDAppointmentsModal",components:{IonPage:Ve,IonHeader:ae,IonContent:se,IonItem:ue,IonList:ce,IonIcon:U,IonCard:Ne,IonCardContent:Ke,IonPopover:$t,DataTable:Me,IonSegment:Qe,IonSegmentButton:he,IonLabel:_e,IonRow:Re,IonCol:Oe,DateInputField:Xe},props:{title:{type:String,default:"OPD Appointments"},programType:{type:String,required:!0},programId:{type:Number,required:!0}},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:qe,appointments:[],viewMode:"today",startDate:k.sessionDate(),endDate:k.sessionDate(),calendarOutline:ye,openOutline:yt,tableColumns:[{title:"Patient ID",data:"ID"},{title:"Name",data:"name"},{title:"Age/DOB",data:"ageDob"},{title:"Gender",data:"gender"},{title:"Village",data:"village"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(e,t,s)=>{const i=document.createElement("div"),r=document.createElement("ion-button");return r.innerText="Profile",r.size="small",r.style.color="#fff",r.style.padding="8px 12px",r.style.marginRight="8px",r.addEventListener("click",()=>this.openClientProfile(s.ID)),i.appendChild(r),i},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,order:[[5,"asc"]]}}},async mounted(){await this.loadAppointments()},methods:{async loadAppointments(){var e,t;this.isLoading=!0;try{const s=k.sessionDate(),i=this.viewMode==="today"?s:this.startDate,r=this.viewMode==="today"?s:this.endDate,y=localStorage.getItem("locationID"),u=await We("patientRecords"),c=[];for(const p of u)[...((e=p.appointments)==null?void 0:e.saved)||[],...((t=p.appointments)==null?void 0:t.unsaved)||[]].filter($=>{if($.concept_id!==5096||$.program_id!==14||$.location_id!==y)return!1;const C=$==null?void 0:$.value_datetime;if(!C)return!1;const v=k.toStandardHisFormat(C),w=k.toStandardHisFormat(i),b=k.toStandardHisFormat(r);return v>=w&&v<=b}).forEach($=>{var C,v,w,b,M;c.push({ID:p.ID,name:[(C=p.personInformation)==null?void 0:C.given_name,(v=p.personInformation)==null?void 0:v.family_name].filter(Boolean).join(" ")||"Unknown",ageDob:(w=p.personInformation)!=null&&w.birthdate?k.getBirthdateAge(p.personInformation.birthdate):"N/A",gender:((b=p.personInformation)==null?void 0:b.gender)||"Unknown",village:((M=p.personInformation)==null?void 0:M.home_village)||"Unknown",appointmentDate:k.toStandardHisDisplayFormat($==null?void 0:$.value_datetime),rawData:$})});this.appointments=c.sort((p,d)=>{var C,v;const f=(C=p.rawData)==null?void 0:C.value_datetime,$=(v=d.rawData)==null?void 0:v.value_datetime;return new Date(f).getTime()-new Date($).getTime()})}catch(s){console.error("Error loading appointments:",s),je("Failed to load appointments")}finally{this.isLoading=!1}},async getAppointmentsD1(e){this.startDate=k.toStandardHisFormat(e),await this.loadAppointments()},async getAppointmentsD2(e){this.endDate=k.toStandardHisFormat(e),await this.loadAppointments()},onViewModeChange(){this.viewMode==="today"&&(this.startDate=k.sessionDate(),this.endDate=k.sessionDate()),this.loadAppointments()},async openClientProfile(e){try{const t=await We("patientRecords",{whereClause:{ID:e}});await ne().setPatientRecord(t[0]),this.$router.push("patientProfile")}catch(t){console.error("Error opening profile:",t),je("Failed to open patient profile")}},openPopover(e){this.event=e,this.popoverOpen=!0},dismiss(){Le.dismiss()}}}),$i={class:"header position_content"},wi={style:{"font-size":"1.2em","font-weight":"700"}},Si={key:0,class:"date-filter"},ki={class:"dueCardContent"},Ai={key:1,class:"no-appointments"};function Ii(e,t,s,i,r,y){const u=h("ion-icon"),c=h("ion-header"),p=h("ion-label"),d=h("ion-segment-button"),f=h("ion-segment"),$=h("DateInputField"),C=h("ion-col"),v=h("ion-row"),w=h("DataTable"),b=h("ion-card-content"),M=h("ion-card"),T=h("ion-content"),O=h("ion-page");return l(),R(O,null,{default:o(()=>[a(c,null,{default:o(()=>[n("div",$i,[n("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=(...K)=>e.dismiss&&e.dismiss(...K))},[a(u,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",wi,_(e.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:t[1]||(t[1]=K=>e.openPopover(K))},[a(u,{slot:"separator",size:"large",icon:e.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(T,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:o(()=>[a(f,{modelValue:e.viewMode,"onUpdate:modelValue":t[2]||(t[2]=K=>e.viewMode=K),onIonChange:e.onViewModeChange},{default:o(()=>[a(d,{value:"today"},{default:o(()=>[a(p,null,{default:o(()=>t[3]||(t[3]=[P("Today's Appointments",-1)])),_:1,__:[3]})]),_:1}),a(d,{value:"range"},{default:o(()=>[a(p,null,{default:o(()=>t[4]||(t[4]=[P("Date Range",-1)])),_:1,__:[4]})]),_:1})]),_:1},8,["modelValue","onIonChange"]),e.viewMode==="range"?(l(),g("div",Si,[a(v,null,{default:o(()=>[a(C,null,{default:o(()=>[a($,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:e.endDate,disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1},null,8,["icon","inputValue","maxDate","onUpdate:rawDateValue"])]),_:1}),a(C,null,{default:o(()=>[a($,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):A("",!0),a(M,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:o(()=>[a(b,null,{default:o(()=>[n("div",ki,[e.appointments.length>0?(l(),R(w,{key:0,data:e.appointments,columns:e.tableColumns,options:e.tableOptions,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns","options"])):(l(),g("div",Ai," No appointments found for the selected "+_(e.viewMode==="today"?"day":"date range"),1))])]),_:1})]),_:1})]),_:1})]),_:1})}const Pi=W(Ci,[["render",Ii],["__scopeId","data-v-28c4e8ae"]]),Ti={class:"card-count"},Ni={class:"card-label"},Oi="#ffffff",Ri=H({__name:"DashboardCard",props:{icon:{},count:{},label:{},color:{}},emits:["cardClick"],setup(e,{emit:t}){const r={success:"#A5D6A7",info:"#81D4FA",warning:"#FFF59D",danger:"#EF9A9A"}[e.color||"info"]||"#E0E0E0";return(y,u)=>(l(),R(S(Ne),{class:"dashboard-card",style:Pe({borderColor:S(r),backgroundColor:Oi}),onClick:u[0]||(u[0]=c=>y.$emit("cardClick"))},{default:o(()=>[a(S(U),{icon:y.icon,class:"card-icon"},null,8,["icon"]),n("div",Ti,_(y.count),1),n("div",Ni,_(y.label),1)]),_:1},8,["style"]))}}),Vi=W(Ri,[["__scopeId","data-v-84ad3c1b"]]),Mi=H({name:"OPDDashboard",components:{DashboardCard:Vi},data(){return{totalPatientsToday:0,canViewVitals:!1,canViewConsultation:!1,canViewLab:!1,canViewDispensation:!1,canViewAppointments:!1,userRoles:[]}},computed:{...Y(Je,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","patientsVisits","todaysAppointmentsCount"])},watch:{$route:{async handler(){this.reloadRolePermissions(),await this.refreshDashboard()},deep:!0}},async mounted(){this.reloadRolePermissions(),await this.refreshDashboard()},methods:{medkit(){return gt},flask(){return _n},async refreshDashboard(){const e=z.getUserLocationId();e&&await Je().refresh(e)},clipboard(){return pt},thermometer(){return mt},calendar(){return fn},people(){return ht},reloadRolePermissions(){this.loadUserRoles(),this.updateCardVisibility()},loadUserRoles(){localStorage.getItem("userRoles");try{const e=localStorage.getItem("userRoles")||"[]",t=JSON.parse(e);this.userRoles=t.map(s=>typeof s=="string"?s:s.role||s.name||"")}catch(e){this.userRoles=[]}},hasAnyRole(e){const t=this.userRoles.map(s=>s.toLowerCase());return e.some(s=>t.includes(s.toLowerCase()))},updateCardVisibility(){this.canViewVitals=this.hasAnyRole(["Clinician","Nurse","Superuser"]),this.canViewConsultation=this.hasAnyRole(["Clinician","Superuser"]),this.canViewLab=this.hasAnyRole(["Lab"]),this.canViewDispensation=this.hasAnyRole(["Clinician","Pharmacist","Superuser"]),this.canViewAppointments=this.hasAnyRole(["Clinician","Nurse","Superuser"])},openAllModal(e,t,s){ke(Di,{class:"fullScreenModal"},!0,{title:e,buttonTitle:t,buttonLink:s})},openPatientsListModal(e,t,s,i){ke(fi,{class:"fullScreenModal"},!0,{title:e,list:t,buttonTitle:s,buttonLink:i})},openAppointmentsModal(e,t){ke(Pi,{class:"fullScreenModal"},!0,{title:e,programType:t,programId:14})}}}),Li={class:"dashboard-wrapper"};function Bi(e,t,s,i,r,y){const u=h("ion-icon"),c=h("ion-card-title"),p=h("ion-card-header"),d=h("DashboardCard"),f=h("ion-row"),$=h("ion-grid"),C=h("ion-card-content"),v=h("ion-card"),w=h("ion-content");return l(),R(w,{fullscreen:!0},{default:o(()=>[n("div",Li,[a(v,{class:"dashboard-card"},{default:o(()=>[a(p,{class:"dashboard-card-header"},{default:o(()=>[a(c,{class:"dashboard-title"},{default:o(()=>[a(u,{icon:e.people(),slot:"start",class:"dashboard-icon"},null,8,["icon"]),t[6]||(t[6]=P(" Today's Patients Overview ",-1))]),_:1,__:[6]})]),_:1}),a(C,null,{default:o(()=>[a($,{class:"centered-grid"},{default:o(()=>[a(f,{class:"centered-row"},{default:o(()=>{var b,M,T;return[a(d,{icon:e.people(),color:"primary",count:e.patientsVisits.length,label:"Total patients today",onCardClick:t[0]||(t[0]=O=>e.openAllModal("All patients today","View profile","/patientProfile"))},null,8,["icon","count"]),e.canViewAppointments?(l(),R(d,{key:0,icon:e.calendar(),color:"primary",count:((b=e.todaysAppointmentsCount)==null?void 0:b.length)||0,label:"Appointments",onCardClick:t[1]||(t[1]=O=>e.openAppointmentsModal("OPD Appointments","14"))},null,8,["icon","count"])):A("",!0),e.canViewVitals?(l(),R(d,{key:1,icon:e.thermometer(),color:"primary",count:(M=e.patientsWaitingForVitals)==null?void 0:M.length,label:"Waiting for vitals",onCardClick:t[2]||(t[2]=O=>e.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals"))},null,8,["icon","count"])):A("",!0),e.canViewConsultation?(l(),R(d,{key:2,icon:e.clipboard(),color:"primary",count:(T=e.patientsWaitingForConsultation)==null?void 0:T.length,label:"Waiting for consultation",onCardClick:t[3]||(t[3]=O=>e.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan"))},null,8,["icon","count"])):A("",!0),e.canViewLab?(l(),R(d,{key:3,icon:e.flask(),color:"primary",count:e.patientsWaitingForLab.length,label:"Waiting for lab",onCardClick:t[4]||(t[4]=O=>e.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan"))},null,8,["icon","count"])):A("",!0),e.canViewDispensation?(l(),R(d,{key:4,icon:e.medkit(),color:"primary",count:e.patientsWaitingForDispensation.length,label:"Waiting for dispensation",onCardClick:t[5]||(t[5]=O=>e.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations"))},null,8,["icon","count"])):A("",!0)]}),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})}const xi=W(Mi,[["render",Bi],["__scopeId","data-v-42ba9b2f"]]),Ei=H({name:"NCDDashboard",mixins:[Se],components:{ApexChart:Ze},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await ft(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return z.getJson("programs/32/reports/ncd_dashboard",{start_date:k.toStandardHisFormat(k.sessionDate()),end_date:k.toStandardHisFormat(k.sessionDate())})}}}),Fi={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},Ui={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},Hi={ref:"chartRef1"},zi={ref:"chartRef2"};function Wi(e,t,s,i,r,y){const u=h("ion-card-content"),c=h("ion-card"),p=h("ApexChart");return l(),g(E,null,[n("div",Fi,[a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(u,null,{default:o(()=>t[0]||(t[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])),_:1,__:[0]})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(u,null,{default:o(()=>t[1]||(t[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])),_:1,__:[1]})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(u,null,{default:o(()=>t[2]||(t[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])),_:1,__:[2]})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(u,null,{default:o(()=>t[3]||(t[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])),_:1,__:[3]})]),_:1})]),n("div",Ui,[a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(u,null,{default:o(()=>[t[4]||(t[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",Hi,[e.isChartReady?(l(),R(p,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:e.barChartOptions,series:e.barChartSeries},null,8,["options","series"])):A("",!0)],512)]),_:1,__:[4]})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(u,null,{default:o(()=>[t[5]||(t[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",zi,[e.isChartReady?(l(),R(p,{key:0,style:{width:"100%",height:"500px"},type:"line",options:e.lineChartOptions,series:e.lineChartSeries},null,8,["options","series"])):A("",!0)],512)]),_:1,__:[5]})]),_:1})])],64)}const ji=W(Ei,[["render",Wi],["__scopeId","data-v-58e2a3d8"]]),Ji=H({name:"Home",mixins:[wt,Se],components:{IonContent:se,IonHeader:ae,IonPage:Ve,IonToolbar:de,Toolbar:At,IonRow:Re,DateInputField:Xe,IonIcon:U,IonButton:Ae,IonCol:Oe},data(){const e=V(k.sessionDate()),t=V(k.sessionDate()),s=V(k.sessionDate()),i=V([]);return{segmentContent:"Today",minDate:s,startDate:e,endDate:t,people:i,calendarOutline:ye,eyeOutline:Ct}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(e){this.segmentContent=e},formatBirthdate(e){return k.getBirthdateAge(e)},async getAppointments(){this.people=[],(await Pt.getAppointments(this.startDate,this.endDate,"")).forEach(t=>{const s={person_id:t.person_id,npid:t.npid,appointment_id:103,encounter_id:t.encounter_id,name:t.given_name.concat(" ",t.family_name),gender:t.gender,ageDob:this.formatBirthdate(t.birthdate),village:t.city_village,appointmentDate:k.toStandardHisDisplayFormat(t.appointment_date)};this.people.push(s)})},async getAppointmentsD1(e){this.startDate=k.toStandardHisFormat(e),await this.getAppointments()},async getAppointmentsD2(e){this.endDate=k.toStandardHisFormat(e),await this.getAppointments()},async openClientProfile(e){await Ce.findByNpid(e),this.isPharmacist()},isPharmacist(){const e=JSON.parse(localStorage.getItem("userRoles")),t=e||[];t.some(s=>t.some(i=>i.role==="Pharmacist"))&&(this.$router.push("dispensation"),z.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),Gi={class:"appointments-container"},Ki={key:0,class:"date-filter"},Qi={class:"appointments-table"};function Yi(e,t,s,i,r,y){const u=h("ion-label"),c=h("ion-segment-button"),p=h("ion-segment"),d=h("DateInputField"),f=h("ion-col"),$=h("ion-row"),C=h("ion-icon"),v=h("ion-button"),w=h("ion-card");return l(),g("div",Gi,[n("div",null,[a(p,{value:e.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:o(()=>[a(c,{value:"Today",onClick:t[0]||(t[0]=b=>e.setSegmentContent("Today"))},{default:o(()=>[a(u,null,{default:o(()=>t[3]||(t[3]=[P("Today",-1)])),_:1,__:[3]})]),_:1}),a(c,{value:"Tomorrow",onClick:t[1]||(t[1]=b=>e.setSegmentContent("Tomorrow"))},{default:o(()=>[a(u,null,{default:o(()=>t[4]||(t[4]=[P("Tomorrow",-1)])),_:1,__:[4]})]),_:1}),a(c,{value:"Date range",onClick:t[2]||(t[2]=b=>e.setSegmentContent("Date range"))},{default:o(()=>[a(u,null,{default:o(()=>t[5]||(t[5]=[P("Date range",-1)])),_:1,__:[5]})]),_:1})]),_:1},8,["value"])]),e.segmentContent==="Date range"?(l(),g("div",Ki,[a($,null,{default:o(()=>[a(f,null,{default:o(()=>[a(d,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(f,null,{default:o(()=>[a(d,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):A("",!0),e.people.length>0?(l(),R(w,{key:1},{default:o(()=>[n("table",Qi,[t[6]||(t[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(l(!0),g(E,null,j(e.people,b=>(l(),g("tr",{key:b.npid},[n("td",null,[a($,null,{default:o(()=>[a(f,null,{default:o(()=>[P(_(b.name),1)]),_:2},1024),a(f,null,{default:o(()=>[a(v,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:M=>e.openClientProfile(b.npid),color:"primary",fill:"clear",size:"small"},{default:o(()=>[a(C,{icon:e.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,_(b.npid),1),n("td",null,_(b.ageDob),1),n("td",null,_(b.gender),1),n("td",null,_(b.village),1),n("td",null,_(b.appointmentDate),1)]))),128))])])]),_:1})):(l(),R(w,{key:2},{default:o(()=>t[7]||(t[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])),_:1,__:[7]}))])}const qi=W(Ji,[["render",Yi],["__scopeId","data-v-c47f7768"]]),Zi=H({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(e){}}}),Xi={key:0},el={style:{display:"flex","margin-top":"10px"}},tl={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},nl={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},al={key:1};function sl(e,t,s,i,r,y){const u=h("ion-label"),c=h("ion-segment-button"),p=h("ion-segment"),d=h("VisitsHistory");return l(),g(E,null,[n("div",null,[a(p,{value:e.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:o(()=>[a(c,{value:"Internal referrals",onClick:t[0]||(t[0]=f=>e.setSegmentContent("Internal referrals"))},{default:o(()=>[a(u,null,{default:o(()=>t[2]||(t[2]=[P("Internal referrals",-1)])),_:1,__:[2]})]),_:1}),a(c,{value:"External referrals",onClick:t[1]||(t[1]=f=>e.setSegmentContent("External referrals"))},{default:o(()=>[a(u,null,{default:o(()=>t[3]||(t[3]=[P("External referrals",-1)])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),e.segmentContent=="Internal referrals"?(l(),g("div",Xi,[n("div",el,[e.checkUnderFive?(l(),g("div",tl)):A("",!0),t[4]||(t[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),e.checkUnderFive?A("",!0):(l(),g("div",nl))])])):A("",!0),e.segmentContent=="External referrals"?(l(),g("div",al,[a(d)])):A("",!0)],64)}const ol=W(Zi,[["render",sl],["__scopeId","data-v-faad8f8b"]]),il=H({name:"Menu",components:{IonContent:se,IonHeader:ae,IonItem:ue,IonList:ce,IonMenu:De,IonTitle:be,IonToolbar:de,IonCheckbox:Be,IonIcon:U,BasicForm:we,BasicCard:xe,Referrals:ol,Dashboard:ji,ANCAppointments:qi},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:bt},{id:"referrals",label:"Referrals",icon:Dt},{id:"appointments",label:"Appointments",icon:ye}],activeItem:"dashboard"}},computed:{...Y($e,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),ll={style:{display:"flex"}},rl={class:"left_col"},dl={class:"nav-menu"},cl=["onClick"],ul={class:"right_col"};function pl(e,t,s,i,r,y){const u=h("ion-icon"),c=h("Dashboard"),p=h("ANCAppointments"),d=h("Referrals");return l(),g("div",ll,[n("div",rl,[n("nav",dl,[n("ul",null,[(l(!0),g(E,null,j(e.menuItems,f=>(l(),g("li",{key:f.id,class:te({active:e.activeItem===f.id}),onClick:$=>e.setActiveItem(f.id)},[a(u,{icon:f.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,_(f.label),1)],10,cl))),128))])])]),n("div",ul,[n("div",null,[e.activeItem==="dashboard"?(l(),R(c,{key:0})):A("",!0),e.activeItem==="appointments"?(l(),R(p,{key:1})):A("",!0),e.activeItem==="referrals"?(l(),R(d,{key:2})):A("",!0)])])])}const ml=W(il,[["render",pl],["__scopeId","data-v-7e786ea4"]]),hl=H({name:"Menu",components:{IonContent:se,IonHeader:ae,IonItem:ue,IonList:ce,IonMenu:De,IonTitle:be,IonToolbar:de,IonCheckbox:Be,BasicForm:we,BasicCard:xe},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Y($e,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),gl={class:"left_col"},fl={class:"nav-menu"},_l=["onClick"];function vl(e,t,s,i,r,y){return l(),g("div",null,[n("div",gl,[n("nav",fl,[n("ul",null,[(l(!0),g(E,null,j(e.menuItems,u=>(l(),g("li",{key:u.id,class:te({active:e.activeItem===u.id}),onClick:c=>e.setActiveItem(u.id)},_(u.label),11,_l))),128))])])]),t[0]||(t[0]=n("div",{class:"right_col"},null,-1))])}const yl=W(hl,[["render",vl],["__scopeId","data-v-32dd02d3"]]),bl=H({name:"Menu",components:{IonContent:se,IonHeader:ae,IonItem:ue,IonList:ce,IonMenu:De,IonTitle:be,IonToolbar:de,IonCheckbox:Be,BasicForm:we,BasicCard:xe},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Y($e,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),Dl={class:"left_col"},Cl={class:"nav-menu"},$l=["onClick"];function wl(e,t,s,i,r,y){return l(),g("div",null,[n("div",Dl,[n("nav",Cl,[n("ul",null,[(l(!0),g(E,null,j(e.menuItems,u=>(l(),g("li",{key:u.id,class:te({active:e.activeItem===u.id}),onClick:c=>e.setActiveItem(u.id)},_(u.label),11,$l))),128))])])]),t[0]||(t[0]=n("div",{class:"right_col"},null,-1))])}const Sl=W(bl,[["render",wl],["__scopeId","data-v-b49d8600"]]);function kl(){const e=Ye(),t=He(),s=V(!1),{OPDActivities:i,NCDActivities:r}=Ie(t),y=async c=>{var p;try{const d=z.getUserID(),f=await It.getJson("user_properties",{user_id:d,property:c});return f!=null&&f.property_value?(p=f==null?void 0:f.property_value)==null?void 0:p.split(","):[]}catch(d){return console.error("Error fetching user activities:",d),[]}},u=async()=>{try{s.value=!1;const[c,p]=await Promise.all([y("OPD_activities"),y("NCD_activities")]);c.length>0&&t.setOPDActivity(c),p.length>0&&t.setNCDActivity(p)}catch(c){console.error("Error updating activities:",c)}finally{s.value=!0}};return re(()=>e.path,async()=>{await u()},{immediate:!0,deep:!0}),{ready:s,OPDActivities:i,NCDActivities:r,getUserActivities:y,updateActivities:u}}function Al(){const e=Ye(),t=V(""),s=V(!1),i=V({}),r=()=>{const y=z.getUserRoles(),u=z.getProgramID(),c=z.getProgramName();t.value=y,s.value=!1,y==="Lab"&&u===14?i.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:u===14&&y!=="Lab"?i.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:u===12?i.value={url:"contact",btnName:"Back"}:c==="LABOUR AND DELIVERY PROGRAM"?i.value={url:"labour/labourHome",btnName:"Back to home"}:c==="PNC PROGRAM"?i.value={url:"pnc/home",btnName:"Back to home"}:i.value={url:"",btnName:""},s.value=!0};return re(()=>e.path,()=>{r()},{immediate:!0,deep:!0}),{userRole:t,ready:s,userRoleSettings:i,updateUserRoleSettings:r}}const Il={key:0,class:"spinner-overlay"},Ql=H({__name:"HomePage",setup(e){const t=V(!0),s=Ye(),i=Rn(),r=V(localStorage.getItem("sessionDate")||"");Al();const y=Vn(),{apiStatus:u}=Ie(St()),{activeProgram:c}=Ie(y),p=Q(()=>{switch(c.value.program_id){case oe.IMMUNIZATION_PROGRAM:return ui;case oe.OPD_PROGRAM:return xi;case oe.NCD_PROGRAM:return Os;case oe.HTC_PROGRAM:return Ys;case oe.ANC_PROGRAM:return ml;case oe.PNC_PROGRAM:return Sl;case oe.LABOUR_AND_DELIVERY_PROGRAM:return yl;case oe.HIV_PROGRAM:return Ao;default:return null}}),d=()=>{const C=localStorage.getItem("sessionDate");(!C||C.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),ot()),r.value=C||""};let f=null;ge(()=>{f=()=>d(),window.addEventListener("storage",f);const C=setInterval(d,1e3);vn(()=>{clearInterval(C),f&&window.removeEventListener("storage",f)}),d()}),re(r,(C,v)=>{(!C||C.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),ot())}),re(()=>s.name,async C=>{C==="Home"&&(at(),await st().loadGlobalProperty(),i.initWorker(),i.postData("SYNC_ALL_DATA"))},{immediate:!0,deep:!0});const $=async()=>{try{const C=z.getUserID(),v=await It.getUserByID(C);if(v.location_id!=null){const w=await Ln.getLocation(v.location_id);localStorage.setItem("locationData",JSON.stringify(w))}}catch(C){console.error("Failed to retrieve location data:",C)}};return u.value&&(kl(),$()),ge(async()=>{try{t.value=!0,i.terminate(),at(),await st().loadGlobalProperty(),ve.isEmpty(c.value)&&await Mn.show(xn,{},"module-picker-modal")}catch(C){console.error("Error initializing component:",C)}finally{t.value=!1}}),(C,v)=>{const w=h("ion-spinner"),b=h("ion-content");return l(),R(S(Ve),null,{default:o(()=>[t.value?(l(),g("div",Il,[a(w,{name:"bubbles"}),v[0]||(v[0]=n("div",{class:"loading-text"},"Please wait...",-1))])):A("",!0),a(At),a(En),p.value?(l(),R(yn(p.value),{key:1})):(l(),R(b,{key:2},{default:o(()=>v[1]||(v[1]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])),_:1,__:[1]}))]),_:1})}}});export{Ql as default};

import{d as J,r as i,ak as Y,c as Z,a as Q,H as X,N as ee,f as w,J as n,l as t,u as s,a8 as ae,k as l,aR as se,aO as te,e as P,m as q,dy as oe,E as le,P as p,K as L,a2 as f,b1 as m,cM as F,bu as ne,c9 as x,cs as S,M as B,bp as z,p as d,ae as re}from"./vendor-f_p5GZUu.js";import{y as M,a0 as O,t as N,U as ie,N as ue,a1 as R,v as g,a2 as de,a3 as ce,a4 as ve,$ as we,z as pe,a5 as fe,_ as me}from"./index-BrtFwA6C.js";import{i as ge}from"./Img-CJEgX1Vr.js";import{p as Pe,g as ye}from"./userService-DkGQ0LoP.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-Db13O_GS.js";const _e={class:"login-container"},Ce={key:0,style:{"justify-content":"center",display:"block"}},Ie={style:{"font-size":"15px"}},be={style:{"font-size":"12px",color:"#34af4d"}},ke={key:1},he={style:{"font-size":"15px"}},xe={key:0},Se={style:{"text-align":"left"}},Ne={class:"signup-link"},Ee={key:1},Ue={style:{"text-align":"left"}},qe={key:0,class:"password-requirements"},Le={class:"requirements-list"},ze={class:"signup-link"},$e=J({__name:"Login",setup(Ae){const y=i(""),_=i(""),E=i(""),C=i(!1),c=i(!1),U=i("test"),v=i(new fe),a=i({username:"",currentPassword:"",newPassword:"",confirmPassword:""}),I=i(!1),b=i(!1),k=i(!1),V=Y(),D=M(),$=Z(()=>a.value.username.trim()!==""&&a.value.currentPassword.trim()!==""&&a.value.newPassword.trim()!==""&&a.value.confirmPassword.trim()!==""&&O(a.value.newPassword)&&a.value.newPassword===a.value.confirmPassword&&a.value.newPassword!==a.value.currentPassword),H=async()=>{D.terminate(),await M().postData("SET_OFFLINE_PROGRAMS")},K=()=>{E.value=localStorage.getItem("core_version")||""},T=async()=>{const o=we(),e=await ye();e&&(o.setUserFacilityName(e.name),o.setFacilityLocation(e),localStorage.setItem("facility_code",e.code))},W=async()=>{const o=await v.value.checkUserPrograms(void 0);o!=null&&o.programs&&pe().setAuthorizedPrograms(o==null?void 0:o.programs)},h=()=>{c.value=!c.value,c.value&&(a.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""})},j=()=>{N("Help functionality to be implemented")},G=async()=>{if(!$.value){N("Please complete all fields correctly"),N("Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character.");return}try{const o=await v.value.requestLogin(a.value.currentPassword,a.value.username);if(o){const{authorization:e}=o,{token:u,user:r}=e;r&&(localStorage.setItem("apiKey",u),await ie.updateUser(r.user_id,{password:a.value.newPassword}),ue("Password changed successfully!"),await v.value.requestLogin(a.value.newPassword,a.value.username),a.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""},c.value=!1,localStorage.setItem("apiKey",""))}}catch(o){o instanceof R?g("Current password is incorrect"):g("Error changing password: ".concat(o))}},A=async()=>{if(y.value&&_.value){v.value.setUsername(y.value);try{await v.value.login(_.value),await T(),await W(),await de(),await Pe(),V.push("/home")}catch(o){o instanceof R&&g("Invalid username or password"),o instanceof ce&&(h(),g("Please change your password",5e4)),o instanceof ve?(h(),g("Your password has expired. Please change your password",5e4)):g("".concat(o),5e4)}}else N("Complete form to log in")};return Q(async()=>{localStorage.setItem("apiKey",""),await v.value.loadConfig(),K(),await H()}),(o,e)=>{const u=X("ion-icon");return w(),ee(s(re),null,{default:n(()=>[t(s(ae),{class:"ion-padding login-page"},{default:n(()=>[l("div",_e,[t(s(se),{style:{"background-color":"#fff"}},{default:n(()=>[t(s(te),null,{default:n(()=>[t(s(oe),{class:"login_img",src:s(ge)("mw.png"),id:"logo"},null,8,["src"]),t(s(le),{class:"login-title"},{default:n(()=>[U.value==="development"||U.value==="test"?(w(),P("span",Ce,[l("div",null,[e[10]||(e[10]=p(" MaHIS ",-1)),l("small",Ie,"(v"+L(E.value)+")",1)]),l("div",be,"("+L(U.value)+")",1)])):(w(),P("span",ke,[e[11]||(e[11]=p(" MaHIS ",-1)),l("small",he,"(v"+L(E.value)+")",1)]))]),_:1}),c.value?q("",!0):(w(),P("div",xe,[l("span",Se,[t(s(f),{value:y.value,onIonInput:e[0]||(e[0]=r=>y.value=r.target.value||""),type:"text",label:"Username",ref:"usernameRef","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:n(()=>[t(s(m),{slot:"end"},{default:n(()=>[t(u,{icon:s(F)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),t(s(f),{value:_.value,onIonInput:e[2]||(e[2]=r=>_.value=r.target.value||""),type:C.value?"text":"password",label:"Password",ref:"passwordRef","label-placement":"floating",fill:"outline",placeholder:"Enter Password",class:"input-fields",required:"",onKeydown:ne(A,["enter"])},{default:n(()=>[t(s(m),{slot:"end"},{default:n(()=>[t(u,{icon:C.value?s(x):s(S),onClick:e[1]||(e[1]=r=>C.value=!C.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"])]),t(s(B),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:A,class:"login-button"},{default:n(()=>e[12]||(e[12]=[p(" Login ",-1)])),_:1,__:[12]}),l("p",Ne,[e[13]||(e[13]=p(" For help click ",-1)),l("a",{href:"#",onClick:z(j,["prevent"])},"Here"),e[14]||(e[14]=p(" | ",-1)),l("a",{href:"#",onClick:z(h,["prevent"])},"Change Password")])])),c.value?(w(),P("div",Ee,[e[17]||(e[17]=l("h3",{style:{"text-align":"center","margin-bottom":"20px",color:"#34af4d"}},"Change Password",-1)),l("span",Ue,[t(s(f),{value:a.value.username,onIonInput:e[3]||(e[3]=r=>a.value.username=r.target.value||""),type:"text",label:"Username","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:n(()=>[t(s(m),{slot:"end"},{default:n(()=>[t(u,{icon:s(F)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),t(s(f),{value:a.value.currentPassword,onIonInput:e[5]||(e[5]=r=>a.value.currentPassword=r.target.value||""),type:I.value?"text":"password",label:"Current Password","label-placement":"floating",fill:"outline",placeholder:"Enter Current Password",class:"input-fields",required:""},{default:n(()=>[t(s(m),{slot:"end"},{default:n(()=>[t(u,{icon:I.value?s(x):s(S),onClick:e[4]||(e[4]=r=>I.value=!I.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"]),t(s(f),{value:a.value.newPassword,onIonInput:e[7]||(e[7]=r=>a.value.newPassword=r.target.value||""),type:b.value?"text":"password",label:"New Password","label-placement":"floating",fill:"outline",placeholder:"Enter New Password",class:d(["input-fields",{"invalid-input":a.value.newPassword&&!s(O)(a.value.newPassword)}]),required:""},{default:n(()=>[t(s(m),{slot:"end"},{default:n(()=>[t(u,{icon:b.value?s(x):s(S),onClick:e[6]||(e[6]=r=>b.value=!b.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"]),t(s(f),{value:a.value.confirmPassword,onIonInput:e[9]||(e[9]=r=>a.value.confirmPassword=r.target.value||""),type:k.value?"text":"password",label:"Confirm New Password","label-placement":"floating",fill:"outline",placeholder:"Confirm New Password",class:d(["input-fields",{"invalid-input":a.value.confirmPassword&&a.value.newPassword!==a.value.confirmPassword}]),required:""},{default:n(()=>[t(s(m),{slot:"end"},{default:n(()=>[t(u,{icon:k.value?s(x):s(S),onClick:e[8]||(e[8]=r=>k.value=!k.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"])]),a.value.newPassword?(w(),P("div",qe,[e[15]||(e[15]=l("p",{class:"requirements-title"},"Password Requirements:",-1)),l("ul",Le,[l("li",{class:d({valid:a.value.newPassword.length>=8})},"At least 8 characters",2),l("li",{class:d({valid:/[A-Z]/.test(a.value.newPassword)})},"One uppercase letter",2),l("li",{class:d({valid:/[0-9]/.test(a.value.newPassword)})},"One number",2),l("li",{class:d({valid:/[@#$%^&+=*!-]/.test(a.value.newPassword)})},"One special character (@#$%^&+=*!-)",2),l("li",{class:d({valid:a.value.newPassword!==a.value.currentPassword&&a.value.currentPassword!==""})},"Different from current password",2)])])):q("",!0),t(s(B),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:G,class:"login-button",disabled:!$.value},{default:n(()=>e[16]||(e[16]=[p(" Change Password ",-1)])),_:1,__:[16]},8,["disabled"]),l("p",ze,[l("a",{href:"#",onClick:z(h,["prevent"])},"Back to Login")])])):q("",!0)]),_:1})]),_:1})])]),_:1})]),_:1})}}}),De=me($e,[["__scopeId","data-v-55ce6322"]]);export{De as default};

var Rt=Object.defineProperty;var Vt=(e,t,s)=>t in e?Rt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var Z=(e,t,s)=>Vt(e,typeof t!="symbol"?t+"":t,s);import{d as H,cM as Mt,aO as ut,r as R,c as K,w as ce,a as ue,e as f,f as d,k as n,m as k,p as se,K as v,l as a,u as S,b2 as pt,Q as A,L as E,F,P as j,cN as xt,c5 as Bt,av as mt,bw as Lt,bj as Et,bX as ht,c3 as Ft,b6 as be,b5 as Ke,aP as Re,aQ as qe,aR as Ye,aS as De,aj as le,$ as re,I as te,a4 as ne,R as Ce,H as m,J as i,D as Ut,ah as q,cO as ft,cP as gt,ao as vt,cQ as he,cR as Ht,ca as _t,cS as zt,cT as Wt,cU as jt,cV as Gt,cW as Jt,cX as Qt,cY as Kt,aU as He,bG as qt,am as Yt,n as yt,O as V,a6 as Ve,N as Pe,a5 as Me,G as pe,a7 as xe,bu as ze,a2 as Xt,cZ as Zt,aE as en,c_ as tn,c$ as nn,cq as an,aD as sn,cx as bt,aM as $e,aV as Ne,W as Oe,d0 as Dt,aI as Ct,ba as on,d1 as ln,z as rn,d2 as Xe,d3 as de,X as ve,d4 as $t,b9 as dn,bo as cn,bl as un,E as we,ai as Se,bf as pn,d5 as mn,d6 as hn,d7 as fn,d8 as gn,bs as Be,d9 as vn,b$ as _n,cu as Ze,cv as yn,bQ as bn}from"./vendor-B45YKAfe.js";import{S as U,u as ee,_ as W,g as et,a as Le,P as fe,t as ye,b as wt,i as Ee,H as I,A as Dn,c as Cn,d as St,e as We,f as kt,h as $n,j as ke,R as wn,p as Sn,k as st,l as kn,r as In,O as An,m as Tn,B as Pn,n as ot,o as Te,q as Nn,s as je,v as Ge,w as Je,T as It,U as At,x as On,y as Rn,z as oe,C as it,D as lt,E as Vn,F as rt,L as Mn}from"./index-HINYBbFK.js";import{m as tt}from"./apexcharts-T5qsywHO.js";import{A as Tt}from"./ncd_appointment_service-D2bK3mLX.js";import{D as nt}from"./DateInputField-VFPPMSHk.js";import{u as xn,M as Bn,_ as Ln}from"./ActionButtons.vue_vue_type_script_setup_true_lang-CvlUHQcs.js";import{V as En}from"./ViewToggleComponent-a_boyqRx.js";import{B as Fn}from"./bottomNavBar-_OrN8vBX.js";import{P as Un}from"./patient_report_service-2btkVDrs.js";import{l as _e}from"./lodash-NJiRuGo9.js";import{B as Ie}from"./BasicForm-B05YL8Da.js";import{B as Fe}from"./BasicCard-Dr9oyGOT.js";import{u as Hn}from"./AdministerOtherVaccinesStore-CHjHstD7.js";import{c as zn}from"./customDatePicker-CPnqiwPH.js";import{s as Wn}from"./vaccines_service-B0WDfmGY.js";import{g as jn}from"./dashboard_service-BAHy3Tgf.js";import{i as Gn}from"./Img-CJEgX1Vr.js";import"./sms_service-Dioa1Zyt.js";import"./EIRreportsStore-DG7Fzi5G.js";import"./Export-DF7QJE9-.js";const ae={VITALS:6,APPOINTMENT:7,HIV_CLINIC_REGISTRATION:9,TREATMENT:25,HIV_RECEPTION:51,HIV_STAGING:52,HIV_CLINIC_CONSULTATION:53,DISPENSING:54,ART_ADHERENCE:68};class dt extends U{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(t){return await super.getJson("fhir/patient/".concat(t),{id:t})}static async getFhirObservations(t){return await super.getJson("fhir/patient/".concat(t,"/observations/"),{id:t})}}const Jn={class:"fhir-viewer"},Qn={class:"container"},Kn={key:0,class:"main-header"},qn={class:"header-line"},Yn={key:0,class:"last-updated-display"},Xn={key:1,class:"card initial-input-card"},Zn={class:"action-area-initial"},ea={key:0,class:"card patient-card"},ta={class:"card-title"},na={class:"patient-info-grid"},aa={class:"info-item"},sa={class:"info-value"},oa={class:"info-item"},ia={class:"info-value"},la={class:"info-item"},ra={class:"info-value"},da={class:"info-item"},ca={class:"info-value"},ua={class:"info-value"},pa={class:"info-value"},ma={class:"info-label"},ha={class:"info-value"},fa={key:2,class:"card observations-card"},ga={class:"card-title"},va={class:"observations-grid"},_a={class:"obs-header"},ya={class:"obs-title"},ba={class:"obs-details"},Da={class:"obs-detail obs-value-highlight"},Ca={class:"obs-value"},$a={class:"obs-detail"},wa={class:"obs-value"},Sa={key:0,class:"obs-detail"},ka={class:"obs-value"},Ia={key:3,class:"no-data-found"},Aa={key:4,class:"no-data-found"},Ta={key:5,class:"main-footer"},Pa=H({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(e){Mt({"person-circle-outline":Ft,"clipboard-outline":ht,"search-outline":Et,"information-circle-outline":Lt,"alert-circle-outline":mt,"person-add-outline":Bt,"arrow-back-outline":xt});const t=e,s=ut(),l=R(!1),o=R([]),y=R(),u=R(),c=R(null),p=R([]),r=K(()=>o.value.some(D=>D.resourceType==="Bundle"&&D.entry&&D.entry.some(h=>h.resource&&h.resource.resourceType==="Patient"))),g=K(()=>p.value.length>0),C=async()=>{if(o.value=[],u.value=null,c.value=null,p.value=[],!y.value){console.error("Please enter a Patient Identifier.");return}l.value=!0;try{const D=await dt.getFhirPatient(y.value);if(D&&D.entry&&D.entry.length>0){const h=D.entry[0].resource,z=h.id,L=await dt.getFhirObservations(z);o.value=[D],L&&(o.value.push(L),p.value=L.entry.filter(J=>J.resource&&J.resource.resourceType==="Observation").map(J=>{const N=J.resource;return{id:N.id,display:G(N),value:me(N),date:N.effectiveDateTime,category:N.category&&N.category[0]&&N.category[0].coding&&N.category[0].coding[0]?N.category[0].coding[0].display||N.category[0].coding[0].code:"N/A"}}));const x=h.name&&h.name[0];c.value={personInformation:{given_name:x&&x.given?x.given.join(" "):"",middle_name:x&&x.middle?x.middle.join(" "):"",family_name:x&&x.family?x.family:"",gender:h.gender=="male"?"M":(h==null?void 0:h.gender)=="female"?"F":"",birthdate:h.birthDate||"",cell_phone_number:h.telecom&&h.telecom[0]?h.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:h.contact&&h.contact[0]&&h.contact[0].telecom?h.contact[0].telecom[0].value:""}]}};const T=[D,L].filter(Boolean).reduce((J,N)=>{if(N.meta&&N.meta.lastUpdated){const X=new Date(N.meta.lastUpdated);return J===null||X>J?X:J}return J},null);T&&(u.value=P(T.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch(D){console.error("Error loading FHIR data:",D),o.value=[],u.value=null,c.value=null,p.value=[]}finally{l.value=!1}},$=D=>{if(D.name&&D.name[0]){const h=D.name[0],z=h.given?h.given.join(" "):"",L=h.family||"";return"".concat(z," ").concat(L).trim()||"N/A"}return"N/A"},_=D=>D.identifier&&D.identifier.length>0?D.identifier.map(h=>{let z="Unknown System";if(h.type&&h.type.coding&&h.type.coding[0]&&h.type.coding[0].display)z=h.type.coding[0].display;else if(h.system){const x=h.system.split("/");z=x[x.length-1]||h.system,h.system==="urn:oid:2.16.840.1.113883.4.6"&&(z="Social Security Number")}sessionStorage.setItem(z,h.value);let L=null;return h.assigner&&h.assigner.display?L=h.assigner.display:h.assigner&&h.assigner.reference&&(L=h.assigner.reference.split("/").pop()||h.assigner.reference),{value:h.value||"N/A",systemDisplay:z,periodStart:h.period?h.period.start:null,periodEnd:h.period?h.period.end:null,assignerDisplay:L}}):[],w=D=>D.telecom&&D.telecom.length>0?D.telecom.filter(h=>h.system==="phone"&&h.value):[],b=D=>{if(D.contact&&D.contact.length>0){const h=D.contact.filter(L=>{var x;return(x=L.relationship)==null?void 0:x.some(B=>{var T;return(T=B.coding)==null?void 0:T.some(J=>J.code==="GUARD")})}),z=[];return h.forEach(L=>{L.telecom&&L.telecom.length>0&&L.telecom.filter(x=>x.system==="phone"&&x.value).forEach(x=>z.push(x))}),z}return[]},M=D=>{if(!D)return"N/A";try{return new Date(D).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(h){return console.error("Invalid date string for formatDate:",D,h),"Invalid Date"}},P=D=>{if(!D)return"N/A";try{return new Date(D).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(h){return console.error("Invalid date time string for formatDateTime:",D,h),"Invalid Date/Time"}},O=D=>{if(!D)return"N/A";try{const h=new Date,z=new Date(D);let L=h.getFullYear()-z.getFullYear();const x=h.getMonth()-z.getMonth();return(x<0||x===0&&h.getDate()<z.getDate())&&L--,L}catch(h){return console.error("Invalid birth date string for calculateAge:",D,h),"N/A"}},Q=D=>{if(D.meta&&D.meta.tag){const h=D.meta.tag.find(z=>z.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return h?h.code:"Unknown"}return"Unknown"},G=D=>D.code&&D.code.coding&&D.code.coding[0]&&(D.code.coding[0].display||D.code.coding[0].code)||"Unknown Observation",me=D=>D.valueQuantity?"".concat(D.valueQuantity.value," ").concat(D.valueQuantity.unit||"").trim():D.valueString?D.valueString:D.valueBoolean!==void 0?D.valueBoolean?"True":"False":"N/A",Y=()=>{ee().setRecord(c.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(p.value)),Ot("/registration/manual")},at=()=>{o.value=[],y.value="",u.value=null,c.value=null,p.value=[]},Ot=D=>{s.push({path:D})};return ce(()=>s,async()=>{o.value=[],p.value=[]},{deep:!0}),ue(()=>{var D;if(t.initialData.length>0){o.value=t.initialData;const z=t.initialData.filter(Boolean).reduce((B,T)=>{if(T.meta&&T.meta.lastUpdated){const J=new Date(T.meta.lastUpdated);return B===null||J>B?J:B}return B},null);z&&(u.value=P(z.toISOString()));const L=t.initialData.find(B=>B.resourceType==="Bundle"&&B.entry&&B.entry.some(T=>T.resource&&T.resource.resourceType==="Patient"));if(L){const B=(D=L.entry.find(T=>T.resource&&T.resource.resourceType==="Patient"))==null?void 0:D.resource;if(B){const T=B.name&&B.name[0];c.value={personInformation:{given_name:T&&T.given?T.given.join(" "):"",middle_name:T&&T.middle?T.middle.join(" "):"",family_name:T&&T.family?T.family:"",gender:B.gender||"",birthdate:B.birthDate||""}}}}const x=t.initialData.find(B=>B.resourceType==="Bundle"&&B.entry&&B.entry.some(T=>T.resource&&T.resource.resourceType==="Observation"));x&&(p.value=x.entry.filter(B=>B.resource&&B.resource.resourceType==="Observation").map(B=>{const T=B.resource;return{id:T.id,display:G(T),value:me(T),date:T.effectiveDateTime,category:T.category&&T.category[0]&&T.category[0].coding&&T.category[0].coding[0]?T.category[0].coding[0].display||T.category[0].coding[0].code:"N/A"}}))}}),(D,h)=>{var z,L,x,B,T,J;return d(),f("div",Jn,[n("div",Qn,[(z=o.value)!=null&&z.length?(d(),f("header",Kn,[n("div",qn,[h[1]||(h[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:se(["last-updated-display","status-"+Q(o.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+v(Q(o.value[0].entry[0].resource)),3),u.value?(d(),f("span",Yn,"Last Updated: "+v(u.value),1)):k("",!0)])])])):k("",!0),(L=o.value)!=null&&L.length?k("",!0):(d(),f("section",Xn,[a(S(pt),{modelValue:y.value,"onUpdate:modelValue":h[0]||(h[0]=N=>y.value=N),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",Zn,[n("button",{onClick:C,class:"load-data-btn"},[a(S(E),{name:"search-outline"}),h[2]||(h[2]=A(" Find Patient ",-1))])])])),(d(!0),f(F,null,j(o.value,N=>(d(),f("div",{key:N.id},[N.resourceType==="Bundle"&&N.entry&&N.entry[0]&&N.entry[0].resource.resourceType==="Patient"?(d(),f("section",ea,[n("h2",ta,[a(S(E),{name:"person-circle-outline"}),h[3]||(h[3]=A(" Patient Demographics",-1))]),n("div",na,[n("div",aa,[h[4]||(h[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",sa,v($(N.entry[0].resource)),1)]),n("div",oa,[h[5]||(h[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",ia,v(N.entry[0].resource.gender||"Not specified"),1)]),n("div",la,[h[6]||(h[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",ra,v(M(N.entry[0].resource.birthDate)),1)]),n("div",da,[h[7]||(h[7]=n("span",{class:"info-label"},"Age",-1)),n("span",ca,v(O(N.entry[0].resource.birthDate))+" years",1)]),w(N.entry[0].resource).length?(d(!0),f(F,{key:0},j(w(N.entry[0].resource),(X,ge)=>(d(),f("div",{key:"patient-phone-".concat(ge),class:"info-item"},[h[8]||(h[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",ua,v(X.value),1)]))),128)):k("",!0),b(N.entry[0].resource).length?(d(!0),f(F,{key:1},j(b(N.entry[0].resource),(X,ge)=>(d(),f("div",{key:"guardian-phone-".concat(ge),class:"info-item"},[h[9]||(h[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",pa,v(X.value),1)]))),128)):k("",!0),(d(!0),f(F,null,j(_(N.entry[0].resource),(X,ge)=>(d(),f("div",{key:X.value||ge,class:"info-item"},[n("span",ma,v(X.systemDisplay),1),n("span",ha,v(X.value),1)]))),128))])])):k("",!0)]))),128)),((x=p.value)==null?void 0:x.length)>0?(d(),f("section",fa,[n("h2",ga,[a(S(E),{name:"clipboard-outline"}),h[10]||(h[10]=A(" Clinical Observations",-1))]),n("div",va,[(d(!0),f(F,null,j(p.value,N=>(d(),f("div",{key:N.id,class:"observation-item"},[n("div",_a,[n("h3",ya,v(N.display),1)]),n("div",ba,[n("div",Da,[h[11]||(h[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",Ca,v(N.value),1)]),n("div",$a,[h[12]||(h[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",wa,v(P(N.date)),1)]),N.category&&N.category!=="N/A"?(d(),f("div",Sa,[h[13]||(h[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",ka,v(N.category),1)])):k("",!0)])]))),128))])])):k("",!0),(B=o.value)!=null&&B.length&&!r.value?(d(),f("div",Ia,[n("p",null,[a(S(E),{name:"alert-circle-outline"}),h[14]||(h[14]=A(" No patient data found for the provided identifier. Please try again.",-1))])])):(T=o.value)!=null&&T.length&&r.value&&!g.value?(d(),f("div",Aa,[n("p",null,[a(S(E),{name:"information-circle-outline"}),h[15]||(h[15]=A(" No clinical observations found for this patient.",-1))])])):k("",!0),(J=o.value)!=null&&J.length?(d(),f("footer",Ta,[n("button",{onClick:at,class:"back-to-search-btn small-btn"},[a(S(E),{name:"arrow-back-outline"}),h[16]||(h[16]=A(" Back to Search ",-1))]),n("button",{onClick:Y,class:"register-btn small-btn"},[a(S(E),{name:"person-add-outline"}),h[17]||(h[17]=A(" Register New Patient ",-1))])])):k("",!0)])])}}}),Na=W(Pa,[["__scopeId","data-v-0dc329ef"]]),Oa=H({components:{IonContent:ne,IonHeader:te,IonItem:re,IonList:le,IonIcon:E,IonCard:De,IonCardHeader:Ye,IonCardTitle:qe,IonCardContent:Re,IonPopover:Ke,DataTable:be},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:Ee,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Referred From",data:"referredFrom "},{title:"Referred By",data:"referredBy"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(e,t,s)=>{const l=document.createElement("div");l.style.display="flex",l.style.gap="6px";const o="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",y=(u,c,p)=>{const r=document.createElement("ion-button");return r.innerText=u,r.size="small",r.fill="solid",r.color=c,r.style.cssText=o,r.addEventListener("click",p),r};return l.appendChild(y("Profile","primary",()=>this.navigateTo(s.patient_id,"/patientProfile"))),l},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const e=await wt();this.patients=e.map(t=>({fullName:t.fullName||"",arrivalTime:t.startDate||"",patient_id:t.patientId||""}))},methods:{openPopover(e){this.event=e,this.popoverOpen=!0},dismiss(){Ce.dismiss()},async navigateTo(e,t){console.log(e);let s;et()?s=await Le(e):s=await fe.findByID(e),s?(await ee().setPatientRecord(s),this.$router.push(t)):ye("Patient not found. Please try searching the patient by name.")}}}),Ra={class:"dueCardContent"};function Va(e,t,s,l,o,y){const u=m("DataTable"),c=m("ion-card-content"),p=m("ion-card");return d(),f("div",null,[a(p,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:i(()=>[a(c,null,{default:i(()=>[n("div",Ra,[a(u,{data:e.patients,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})])}const Pt=W(Oa,[["render",Va],["__scopeId","data-v-342f041f"]]),Ma=H({name:"referrals",components:{InternalReferrals:Pt,ExternalReferrals:Na},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(e){this.segmentContent=e}}}),xa={key:0},Ba={style:{display:"flex","margin-top":"10px"}},La={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},Ea={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},Fa={key:1},Ua={key:2};function Ha(e,t,s,l,o,y){const u=m("ion-label"),c=m("ion-segment-button"),p=m("ion-segment"),r=m("ExternalReferrals"),g=m("InternalReferrals");return d(),f(F,null,[n("div",null,[a(p,{value:e.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:i(()=>[a(c,{value:"External referrals",onClick:t[0]||(t[0]=C=>e.setSegmentContent("External referrals"))},{default:i(()=>[a(u,null,{default:i(()=>[...t[2]||(t[2]=[A("External referrals",-1)])]),_:1})]),_:1}),a(c,{value:"Internal referrals",onClick:t[1]||(t[1]=C=>e.setSegmentContent("Internal referrals"))},{default:i(()=>[a(u,null,{default:i(()=>[...t[3]||(t[3]=[A("Internal referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),e.segmentContent=="Internal referrals"?(d(),f("div",xa,[n("div",Ba,[e.checkUnderFive?(d(),f("div",La)):k("",!0),t[4]||(t[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),e.checkUnderFive?k("",!0):(d(),f("div",Ea))])])):k("",!0),e.segmentContent=="External referrals"?(d(),f("div",Fa,[a(r)])):k("",!0),e.segmentContent=="Internal referrals"?(d(),f("div",Ua,[a(g)])):k("",!0)],64)}const za=W(Ma,[["render",Ha],["__scopeId","data-v-8f0f935e"]]),Qe=Ut("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(e){this.selectedItem=e},getSelectedItem(){return this.selectedItem}},persist:!0}),Wa=()=>{const e=R(null);return{activeIteminMixin:e,setActiveItem:s=>{e.value=s,console.log("lll: ",e.value)}}},Ae=H({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:e,setActiveItem:t}=Wa();return{chevronBackOutline:qt,checkmark:He,grid:Kt,chevronDownCircle:Qt,chevronForwardCircle:Jt,chevronUpCircle:Gt,colorPalette:jt,document:Wt,globe:zt,medkit:_t,add:Ht,person:he,people:vt,thermometer:gt,clipboard:ft,activeIteminMixin:e,setActiveItem:t}},async mounted(){await this.setAppointments()},computed:{...q(ee,["patient"])},watch:{$route:{async handler(e){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await Dn.getDailyAppointments(I.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((e,t)=>e.given_name.localeCompare(t.given_name)))},formatBirthdate(e){return I.getBirthdateAge(e)},setActiveItemRefFN(e){Qe().setSelectedItem(e)}}}),ja=H({name:"NCDDashboard",mixins:[Ae],components:{ApexChart:tt},setup(){return{router:ut()}},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await yt(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){try{return U.getJson("programs/32/reports/ncd_dashboard",{start_date:I.toStandardHisFormat(I.sessionDate()),end_date:I.toStandardHisFormat(I.sessionDate())})}catch(e){return[]}},navigationMenu(e){try{Yt.close(),this.router.push(e).then(()=>{})}catch(t){console.error(t)}}}}),Ga={class:"cards-container"},Ja={class:"top-card-text"},Qa={class:"text-2xl font-bold"},Ka={class:"top-card-text"},qa={class:"text-2xl font-bold"},Ya={class:"top-card-text"},Xa={class:"text-2xl font-bold"},Za={class:"top-card-text"},es={class:"text-2xl font-bold"},ts={class:"top-card-text"},ns={class:"text-2xl font-bold"},as={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},ss={ref:"chartRef1"},os={ref:"chartRef2"};function is(e,t,s,l,o,y){const u=m("ion-card-content"),c=m("ion-card"),p=m("ApexChart");return d(),f(F,null,[n("div",Ga,[a(c,{class:"top-card action-card",onClick:t[0]||(t[0]=r=>e.setActiveItemRefFN("appointments"))},{default:i(()=>[a(u,null,{default:i(()=>[n("div",Ja,[n("div",Qa,v(e.appointments.length),1),t[2]||(t[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]),_:1})]),_:1}),a(c,{class:"top-card action-card"},{default:i(()=>[a(u,null,{default:i(()=>{var r;return[n("div",Ka,[n("div",qa,v((r=e.dashboardData)==null?void 0:r.total_pending_dispensations),1),t[3]||(t[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]}),_:1})]),_:1}),a(c,{class:"top-card action-card"},{default:i(()=>[a(u,null,{default:i(()=>{var r;return[n("div",Ya,[n("div",Xa,v((r=e.dashboardData)==null?void 0:r.total_defaulters),1),t[4]||(t[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]}),_:1})]),_:1}),a(c,{class:"top-card action-card"},{default:i(()=>[a(u,null,{default:i(()=>{var r;return[n("div",Za,[n("div",es,v((r=e.dashboardData)==null?void 0:r.total_complications),1),t[5]||(t[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]}),_:1})]),_:1}),a(c,{class:"top-card action-card",onClick:t[1]||(t[1]=r=>e.navigationMenu("NCDActivePatients"))},{default:i(()=>[a(u,null,{default:i(()=>{var r;return[n("div",ts,[n("div",ns,v((r=e.dashboardData)==null?void 0:r.total_client_registered),1),t[6]||(t[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]}),_:1})]),_:1})]),n("div",as,[a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:i(()=>[a(u,null,{default:i(()=>[t[7]||(t[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",ss,[e.isChartReady?(d(),V(p,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:e.barChartOptions,series:e.barChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:i(()=>[a(u,null,{default:i(()=>[t[8]||(t[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",os,[e.isChartReady?(d(),V(p,{key:0,style:{width:"100%",height:"500px"},type:"line",options:e.lineChartOptions,series:e.lineChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1})]),_:1})])],64)}const ls=W(ja,[["render",is],["__scopeId","data-v-18251377"]]),rs=H({name:"Home",mixins:[St,Ae],components:{IonContent:ne,IonHeader:te,IonPage:xe,IonToolbar:pe,IonRow:Me,DateInputField:nt,IonIcon:E,IonButton:Pe,IonCol:Ve,IonCard:De,IonCardHeader:Ye,IonCardTitle:qe,IonCardContent:Re,ViewToggleComponent:En,bottomNavBar:Fn,HorizontalLine:Cn},data(){const e=localStorage.getItem("ncdStartDate"),t=localStorage.getItem("ncdEndDate"),s=R(e||I.sessionDate()),l=R(t||I.sessionDate()),o=R(I.sessionDate()),y=R(I.sessionDate()),u=R([]),c=ze({page:1,itemsPerPage:10}),p=R(0),r=xn(),g=R("list");return{minDate:o,startDate:s,endDate:l,people:u,calendarOutline:$e,openOutline:bt,maxDate:y,alertCircleOutline:mt,personOutline:sn,idCardOutline:an,manOutline:nn,womanOutline:tn,locationOutline:en,timeOutline:Zt,todayOutline:Xt,pagination:c,totalCount:p,actionButtonStore:r,currentToggleView:g}},computed:{...q(We,["NCDAppointmentsTogglePreference"]),paginatedPeople(){const e=(this.pagination.page-1)*this.pagination.itemsPerPage,t=e+this.pagination.itemsPerPage;return this.people.slice(e,t)},groupedPaginatedPeople(){const e={};this.paginatedPeople.forEach(l=>{const o=l.appointmentDate;e[o]||(e[o]=[]),e[o].push(l)});const t=Object.keys(e).sort((l,o)=>new Date(l)-new Date(o)),s={};return t.forEach(l=>{s[l]=e[l]}),s}},$route:{async handler(){},deep:!0},watch:{NCDAppointmentsTogglePreference:{handler(e){e&&e.toggle_view&&(this.currentToggleView=e.toggle_view)},deep:!0,immediate:!0}},async mounted(){this.initTogglePreference(),this.getAppointments(),this.HideHomePageActionButton()},async unmounted(){this.actionButtonStore.resetShowActionButton()},methods:{formatBirthdate(e){return I.getBirthdateAge(e)},async getAppointments(e=!1){if(kt().apiStatus){this.people=[],this.pagination.page=1;try{e==!0&&(this.startDate=I.sessionDate(),this.endDate=I.sessionDate(),this.getAppointmentsD1(this.startDate),this.getAppointmentsD2(this.endDate)),this.startDate>this.endDate&&(this.endDate=this.startDate),console.log(this.startDate,this.endDate),(await Tt.getAppointments(this.startDate,this.endDate,"")).forEach(l=>{const o=I.toStandardHisDisplayFormat(l.appointment_date);if(!this.people.some(u=>u.person_id===l.person_id&&u.appointmentDate===o)){const u={person_id:l.person_id,npid:l.npid,appointment_id:103,encounter_id:l.encounter_id,name:l.given_name.concat(" ",l.family_name),gender:l.gender,ageDob:this.formatBirthdate(l.birthdate),village:l.city_village,appointmentDate:o};this.people.push(u)}}),this.totalCount=this.people.length}catch(s){}}},async getAppointmentsD1(e){this.startDate=I.toStandardHisFormat(e),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(e){this.endDate=I.toStandardHisFormat(e),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(e){const t=await fe.findByNpid(e);ee().setPatientRecord(t[0]),this.redirectUser()},handleViewChange(e){this.currentToggleView=e,this.initTogglePreference(e,!0)},initTogglePreference(e="list",t=!1){const s={toggle_view:e},l=We();Object.keys(this.NCDAppointmentsTogglePreference).length===0?(s.toggle_view="list",l.setNCDAppointmentsTogglePreference(s),this.currentToggleView="list"):t===!0?l.setNCDAppointmentsTogglePreference(s):this.currentToggleView=this.NCDAppointmentsTogglePreference.toggle_view||"list"},redirectUser(){const e=JSON.parse(localStorage.getItem("userRoles")),t=e||[];t.some(s=>t.some(l=>l.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")},handlePaginationUpdate({page:e,itemsPerPage:t}){if(t!==this.pagination.itemsPerPage){const s=(this.pagination.page-1)*this.pagination.itemsPerPage,l=Math.floor(s/t)+1,o=Math.ceil(this.totalCount/t);this.pagination.page=Math.min(l,o)||1,this.pagination.itemsPerPage=t}else this.pagination.page=e},HideHomePageActionButton(){this.actionButtonStore.setShowActionButton(!1)}}}),ds={class:"appointments-container"},cs={class:"date-filter"},us={key:0,style:{margin:"20px"}},ps={key:1},ms={class:"appointments-table"},hs={key:2},fs={class:"date-group-header"},gs={class:"date-header-title"},vs={class:"date-header-count"},_s={class:"cards-container"},ys={class:"card-details"},bs={class:"detail-item"},Ds={class:"detail-value"},Cs={class:"detail-item"},$s={class:"detail-value"},ws={class:"detail-item"},Ss={class:"detail-value"},ks={class:"detail-item"},Is={class:"detail-value"};function As(e,t,s,l,o,y){const u=m("DateInputField"),c=m("ion-col"),p=m("ion-icon"),r=m("ion-button"),g=m("ViewToggleComponent"),C=m("ion-row"),$=m("ion-card"),_=m("HorizontalLine"),w=m("ion-card-title"),b=m("ion-card-header"),M=m("ion-card-content"),P=m("ion-content"),O=m("bottomNavBar"),Q=m("ion-footer");return d(),f("div",ds,[n("div",cs,[a(C,null,{default:i(()=>[a(c,null,{default:i(()=>[a(u,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(c,null,{default:i(()=>[a(u,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1}),a(c,null,{default:i(()=>[a(r,{color:"primary",onClick:t[0]||(t[0]=G=>e.getAppointments(!0)),class:"apt-btn"},{default:i(()=>[a(p,{icon:e.todayOutline,slot:"start"},null,8,["icon"]),t[1]||(t[1]=n("span",{style:{margin:"5px"}}," Today ",-1))]),_:1})]),_:1}),a(c,null,{default:i(()=>[a(g,{"initial-view":e.currentToggleView,onViewChanged:e.handleViewChange},null,8,["initial-view","onViewChanged"])]),_:1})]),_:1})]),a(P,{class:"scrollable-content"},{default:i(()=>[e.people.length===0?(d(),f("div",us,[a(p,{icon:e.alertCircleOutline,size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),t[2]||(t[2]=n("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Appointments for selected date range",-1))])):e.currentToggleView==="list"&&e.people.length>0?(d(),f("div",ps,[a($,null,{default:i(()=>[n("table",ms,[t[3]||(t[3]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),f(F,null,j(e.paginatedPeople,G=>(d(),f("tr",{key:G.npid},[n("td",null,[a(C,null,{default:i(()=>[a(c,null,{default:i(()=>[A(v(G.name),1)]),_:2},1024),a(c,null,{default:i(()=>[a(r,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:me=>e.openClientProfile(G.npid),color:"primary",fill:"clear",size:"small"},{default:i(()=>[a(p,{icon:e.openOutline,style:{"font-size":"28px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,v(G.npid),1),n("td",null,v(G.ageDob),1),n("td",null,v(G.gender),1),n("td",null,v(G.village),1),n("td",null,v(G.appointmentDate),1)]))),128))])])]),_:1})])):e.currentToggleView==="card"&&e.people.length>0?(d(),f("div",hs,[(d(!0),f(F,null,j(e.groupedPaginatedPeople,(G,me)=>(d(),f("div",{key:me,class:"date-group"},[n("div",fs,[a(p,{icon:e.calendarOutline,class:"date-header-icon"},null,8,["icon"]),n("h2",gs,v(me),1),n("div",vs,v(G.length)+" appointment"+v(G.length!==1?"s":""),1)]),a(_,{color:"#006401",thickness:1,spacing:"sm"}),n("div",_s,[(d(!0),f(F,null,j(G,Y=>(d(),V($,{key:Y.npid,class:"appointment-card"},{default:i(()=>[a(b,null,{default:i(()=>[a(C,{class:"ion-align-items-center"},{default:i(()=>[a(c,null,{default:i(()=>[a(w,{class:"card-name"},{default:i(()=>[a(p,{icon:e.personOutline,class:"name-icon"},null,8,["icon"]),A(" "+v(Y.name),1)]),_:2},1024)]),_:2},1024),a(c,{size:"auto"},{default:i(()=>[a(r,{onClick:at=>e.openClientProfile(Y.npid),color:"primary",fill:"clear",size:"small",class:"view-profile-btn"},{default:i(()=>[a(p,{icon:e.openOutline},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(M,null,{default:i(()=>[n("div",ys,[n("div",bs,[a(p,{icon:e.idCardOutline,class:"detail-icon"},null,8,["icon"]),t[4]||(t[4]=n("span",{class:"detail-label"},"NPID:",-1)),n("span",Ds,v(Y.npid),1)]),n("div",Cs,[a(p,{icon:e.calendarOutline,class:"detail-icon"},null,8,["icon"]),t[5]||(t[5]=n("span",{class:"detail-label"},"Age/DOB:",-1)),n("span",$s,v(Y.ageDob),1)]),n("div",ws,[a(p,{icon:Y.gender==="Male"?e.manOutline:e.womanOutline,class:"detail-icon"},null,8,["icon"]),t[6]||(t[6]=n("span",{class:"detail-label"},"Gender:",-1)),n("span",Ss,v(Y.gender),1)]),n("div",ks,[a(p,{icon:e.locationOutline,class:"detail-icon"},null,8,["icon"]),t[7]||(t[7]=n("span",{class:"detail-label"},"Village:",-1)),n("span",Is,v(Y.village),1)])])]),_:2},1024)]),_:2},1024))),128))])]))),128))])):k("",!0)]),_:1}),e.people.length>0?(d(),V(Q,{key:0,class:"sticky-footer"},{default:i(()=>[a(C,null,{default:i(()=>[a(c,{size:"12",style:{"max-width":"100%"}},{default:i(()=>[a(O,{totalItems:e.totalCount,currentPage:e.pagination.page,itemsPerPage:e.pagination.itemsPerPage,"onUpdate:pagination":e.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])]),_:1})]),_:1})]),_:1})):k("",!0)])}const Ts=W(rs,[["render",As],["__scopeId","data-v-d02dae2c"]]),Ps={key:0,class:"left_col"},Ns={class:"nav-menu"},Os=["onClick"],Rs={class:"ellipsis"},Vs={key:1,style:{"padding-left":"20px","padding-right":"20px"}},Ms=H({__name:"NCDDashboard",setup(e){const t=Qe(),s=K(()=>t.selectedItem),{screenWidth:l}=$n(),o=R([{id:"dashboard",label:"Dashboard",icon:Dt},{id:"referrals",label:"Referrals",icon:Ct},{id:"appointments",label:"Appointments",icon:$e}]),y=R("dashboard"),u=ke(),{substance:c}=Ne(u);ce(()=>c.value,(r,g)=>{r!==g&&console.log("Substance changed:",r)},{deep:!0,immediate:!0});const p=r=>{y.value=r,Qe().setSelectedItem(y.value)};return ce(()=>s.value,r=>{console.log("Active item from mixin changed:",r),r&&r!=null&&p(r)},{immediate:!0}),(r,g)=>{const C=m("ion-segment-button"),$=m("ion-segment");return d(),f("div",{style:Oe(S(l)>940?"display: flex":"display: block")},[S(l)>940?(d(),f("div",Ps,[n("nav",Ns,[n("ul",null,[(d(!0),f(F,null,j(o.value,_=>(d(),f("li",{key:_.id,class:se({active:y.value===_.id}),onClick:w=>p(_.id)},[a(S(E),{icon:_.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",Rs,v(_.label),1)],10,Os))),128))])])])):k("",!0),S(l)<=940?(d(),f("div",Vs,[a($,{value:y.value,style:{"margin-top":"5px","justify-content":"left"}},{default:i(()=>[(d(!0),f(F,null,j(o.value,_=>(d(),V(C,{value:_.id,key:_.id,class:se({active:y.value===_.id}),onClick:w=>p(_.id)},{default:i(()=>[a(S(E),{icon:_.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,v(_.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):k("",!0),n("div",{class:"right_col",style:Oe(S(l)>940?"width: 85%":"width: 100%")},[n("div",null,[y.value==="referrals"?(d(),V(za,{key:0})):k("",!0),y.value==="dashboard"?(d(),V(ls,{key:1})):k("",!0),y.value==="appointments"?(d(),V(Ts,{key:2})):k("",!0)])],4)],4)}}}),xs=W(Ms,[["__scopeId","data-v-a1132315"]]);class Bs extends U{constructor(){super()}static async getHTCDashboardSummary(){return this.getJson("hts/reports")}}const Ls={class:"dashboard"},Es={class:"section"},Fs={class:"card"},Us={class:"card-number"},Hs={class:"section"},zs={class:"filter-bar"},Ws={class:"patient-table"},js={class:"details"},Gs={class:"avatar"},Js={style:{display:"flex"}},Qs={class:"registration-status"},Ks={class:"details"},qs={class:"avatar"},Ys={style:{display:"flex"}},Xs={class:"registration-status"},Zs={class:"details"},eo={class:"avatar"},to={style:{display:"flex"}},no={class:"registration-status red"},ao=H({__name:"HTSDashboard",setup(e){const t=R({clientsTestedToday:0,artEnrolledToday:0,followUpScheduledToday:0,totalNumberOfConclusiveResults:0,totalAwaitingList:0});ue(async()=>{await s()});async function s(){const l=await Bs.getHTCDashboardSummary();t.value.clientsTestedToday=l.total_patients_tested_today||0}return(l,o)=>(d(),f("div",Ls,[o[18]||(o[18]=n("div",{class:"header"},[n("div",{class:"overlay"},[n("h1",{class:"big-number"},"6,788"),n("p",{class:"header-text"},[A(" Total Number of Clients Tested"),n("br"),A(" with Conclusive Results ")])])],-1)),n("div",Es,[o[2]||(o[2]=n("div",{style:{padding:"10px"}},[n("h2",{class:"section-title"},"Clients seen today.")],-1)),n("div",Fs,[n("div",Us,v(t.value.clientsTestedToday),1),o[0]||(o[0]=n("div",{class:"card-info"},[n("p",null,"# of Clients Tested Today / Daily Average")],-1)),o[1]||(o[1]=n("div",{class:"card-icon"},"≡",-1))]),o[3]||(o[3]=on('<div class="card" data-v-b87ba0fd><div class="card-number" data-v-b87ba0fd>3</div><div class="card-info" data-v-b87ba0fd><p data-v-b87ba0fd># ART Enrolled Clients Referred from HTS Today</p></div><div class="card-icon" data-v-b87ba0fd>≡</div></div><div class="card" data-v-b87ba0fd><div class="card-number" data-v-b87ba0fd>10</div><div class="card-info" data-v-b87ba0fd><p data-v-b87ba0fd># of Clients with a Follow-up visit Scheduled Today</p></div><div class="card-icon" data-v-b87ba0fd>≡</div></div>',2))]),n("div",Hs,[o[15]||(o[15]=n("h2",{class:"section-title"},"Patient Awaiting List",-1)),o[16]||(o[16]=n("div",{class:"total-box"},[n("span",{class:"total-number"},"252"),n("p",{style:{color:"#004d4d",width:"80%","font-size":"1.3em","font-weight":"bold"}}," Total (Registered + Returning + Referred (OPD, NCD, ART, etc)) ")],-1)),n("div",zs,[a(S(E),{icon:S(ln),style:{color:"#000","font-size":"40px"}},null,8,["icon"]),o[4]||(o[4]=n("input",{type:"text",placeholder:"Add filters"},null,-1))]),n("table",Ws,[o[14]||(o[14]=n("thead",null,[n("tr",null,[n("th",null,"Details"),n("th",null,"Statuses")])],-1)),n("tbody",null,[n("tr",null,[n("td",null,[n("div",js,[n("div",Gs,[a(S(E),{icon:S(he),style:{color:"#fff","font-size":"100px"}},null,8,["icon"])]),o[5]||(o[5]=n("div",null,[n("strong",null,"Kalumphalinga Kachindamoto"),n("p",null,"Male • 37y")],-1))])]),n("td",Js,[o[7]||(o[7]=n("div",{class:"status-tags"},[n("span",{class:"tag active"},"Active"),n("span",{class:"tag yellow"},"Referred OPD")],-1)),n("div",Qs,[a(S(E),{icon:S(He),style:{color:"green","font-size":"20px"}},null,8,["icon"]),o[6]||(o[6]=n("span",{class:"tag-inscription"},"Registered Today",-1))])])]),n("tr",null,[n("td",null,[n("div",Ks,[n("div",qs,[a(S(E),{icon:S(he),style:{color:"#fff","font-size":"100px"}},null,8,["icon"])]),o[8]||(o[8]=n("div",null,[n("strong",null,"Kalumphalinga Kachindamoto"),n("p",null,"Female • 26y")],-1))])]),n("td",Ys,[o[10]||(o[10]=n("div",{class:"status-tags"},[n("span",{class:"tag active"},"Active"),n("span",{class:"tag yellow"},"Returning Client")],-1)),n("div",Xs,[a(S(E),{icon:S(He),style:{color:"green","font-size":"20px"}},null,8,["icon"]),o[9]||(o[9]=n("span",{class:"tag-inscription"},"Registered Client",-1))])])]),n("tr",null,[n("td",null,[n("div",Zs,[n("div",eo,[a(S(E),{icon:S(he),style:{color:"#fff","font-size":"100px"}},null,8,["icon"])]),o[11]||(o[11]=n("div",null,[n("strong",null,"Kalumphalinga Kachindamoto"),n("p",null,"Female • 17y")],-1))])]),n("td",to,[o[13]||(o[13]=n("div",{class:"status-tags"},[n("span",{class:"tag red"},"Not Active"),n("span",{class:"tag yellow"},"Referred ART")],-1)),n("div",no,[a(S(E),{icon:S(he),style:{color:"#000","font-size":"10px"}},null,8,["icon"]),o[12]||(o[12]=n("span",{class:"tag-inscription"},"Registered Today",-1))])])])])]),o[17]||(o[17]=n("div",{class:"see-all"},[n("p",null,"See all")],-1))])]))}}),so=W(ao,[["__scopeId","data-v-b87ba0fd"]]),ct={"HIV clinic registration":ae.HIV_CLINIC_REGISTRATION,"HIV reception":ae.HIV_RECEPTION,Vitals:ae.VITALS,"HIV staging":ae.HIV_STAGING,"HIV clinic consultation":ae.HIV_CLINIC_CONSULTATION,"ART adherence":ae.ART_ADHERENCE,Prescription:ae.TREATMENT,Dispensing:ae.DISPENSING,Appointments:ae.APPOINTMENT};class oo extends wn{constructor(){super()}buildEncounters(t,s){return Object.entries(ct).map(([l,o])=>({encounter:l,female:t?t[o].F:0,male:t?t[o].M:0,me:s?s[o].F+s[o].M:0,facility:t?t[o].F+t[o].M:0}))}async getStats(){const t=Object.values(ct),s=Sn("reports/encounters",this.buildParams()),l=await U.postJson(s,{encounter_types:t}),o=await U.postJson(s,{encounter_types:t,all:!0});return this.buildEncounters(l.data,o.data)}getEncounterStats(t){return U.postJson("reports/encounters?date=".concat(this.date,"&program_id=1"),t)}}const io={class:"dashboard-container"},lo={class:"main-section"},ro={class:"chart-section"},co={class:"encounters-section"},uo={class:"his-sm-text"},po={key:0},mo={class:"encounter-td"},ho={class:"other-td"},fo={class:"other-td"},go={class:"other-td"},vo={class:"other-td"},_o={key:1},yo=H({__name:"ARTDashboard",setup(e){const t=R([]),s=ze({options:{chart:{id:"vuechart-example"},xaxis:{categories:["","","","",""]},yaxis:{min:0,forceNiceScale:!0,title:{text:"Number of clients",align:"left"}}},series:[{name:"Total visits",data:[0,0,0,0,0],color:"#7cb5ec"},{name:"Total incomplete visits",data:[0,0,0,0,0],color:"#434348"}]}),l=ze([{"HIV clinic registration":9},{"HIV reception":51},{Vitals:6},{"HIV staging":52},{"HIV clinic consultation":53},{"ART adherence":68},{Treatment:25},{Dispensing:54},{Appointments:7}]),o=()=>{t.value=l.map(c=>({encounter:Object.keys(c)[0],female:"",male:"",me:"",facility:""}))},y=async()=>{const c=new Un,p=U.getSessionDate();c.setStartDate(I.subtract(p,"days",5).format(st)),c.setEndDate(I.subtract(p,"days",1).format(st));const r=await c.getVisitStats(),g=[],C=[],$=[];Object.entries(r).forEach(([_,{incomplete:w,complete:b}])=>{$.push(rn(_).format("dddd")),g.push(w),C.push(w+b)}),s.series[0].data=[...C],s.series[1].data=[...g],s.options={...s.options,xaxis:{categories:[...$]}}},u=async()=>{try{const c=new oo,p=l.map(C=>Object.values(C)[0]),r=await c.getEncounterStats({encounter_types:p}),g=await c.getEncounterStats({encounter_types:p,all:!0});t.value=l.map(C=>{const[$,_]=Object.entries(C)[0];return{encounter:$,female:g[_].F,male:g[_].M,me:r[_].F+r[_].M,facility:g[_].F+g[_].M}})}catch(c){console.error(c)}};return ue(()=>{o(),y(),u()}),(c,p)=>(d(),f("div",io,[n("div",lo,[n("div",ro,[p[0]||(p[0]=n("h3",null,"Total visits/incomplete visits: last 5 days",-1)),a(S(tt),{width:"100%",height:"390px",type:"bar",options:s.options,series:s.series},null,8,["options","series"])]),n("div",co,[p[3]||(p[3]=n("h3",null,"Encounters created today",-1)),n("table",uo,[p[2]||(p[2]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),t.value.length?(d(),f("tbody",po,[(d(!0),f(F,null,j(t.value,(r,g)=>(d(),f("tr",{key:g},[n("td",mo,v(r.encounter),1),n("td",ho,v(r.female),1),n("td",fo,v(r.male),1),n("td",go,v(r.me),1),n("td",vo,v(r.facility),1)]))),128))])):(d(),f("tbody",_o,[...p[1]||(p[1]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])]))])])])]))}}),bo=W(yo,[["__scopeId","data-v-9bb19378"]]);class Ue extends U{static getlogs(t,s){return this.getJson("notification/logs",{startDate:t,endDate:s})}static clear(t){return this.putJson("notifications/clear/".concat(t),{id:t})}static read(t){return this.putJson("notifications/update",{alerts:t})}static unread(){return this.getJson("notifications")}}const ie=R([]);function Nt(){const e=K(()=>ie.value.filter(g=>!g.read)),t=K(()=>ie.value.length>0),s=K(()=>e.value.length>0),l=K(()=>e.value.length),o=K(()=>ie.value.sort((g,C)=>new Date(g.date)>new Date(C.date)?-1:1));function y(g,C){kn("Are you sure you want to clear notification?").then($=>{$&&Ue.clear(g).then(()=>{ie.value=ie.value.filter(_=>_.id!=g),C(g),c()}).catch(_=>{console.error(_),ye("Unable to clear notification")})})}function u(g){return I.toStandardHisDisplayFormat(g)}async function c(){ie.value=[];const g=await Ue.unread();if(!_e.isEmpty(g)){const C={highVL:[],normalVL:[],rejectedVL:[]};let $={};ie.value=g.map(_=>{let w="General";const b=_.text;let M=null;try{const P=JSON.parse(_.text);if(P.Type.match(/lims/i)){M=()=>In.push("/art/encounters/lab/".concat(P.PatientID)),w="".concat(P["Test type"]," results for ").concat(P["ARV-Number"]||P["Accession number"]);const O=An.detectHighVl(P.Result[0].value,P.Result[0].value_modifier);$={handler:M,id:_.alert_id,arv:P["ARV-Number"],accession:P["Accession number"],order_date:u(P["Orde date"]),results:P.Result[0].value_modifier+" "+P.Result[0].value,results_date:u(P.Result[0].date)},O?C.highVL.push($):P.rejection_reason?($={handler:M,id:_.alert_id,arv:P.arv_number,accession:P.accession_number,order_date:u(P.order_date),rejection_reason:P.rejection_reason},C.rejectedVL.push($)):O||C.normalVL.push($)}}catch(P){console.warn(P)}return{handler:M,message:b,vlMessageObs:C,title:w,id:_.alert_id,date:u(_.date_created)}})}}async function p(g){Ue.read([g.id]).then(()=>g.read=!0)}function r(g){typeof g.handler=="function"&&(p(g),g.handler())}return{markAsRead:p,openNotification:r,loadNotifications:c,clearNotification:y,sortedNotifications:o,hasUnreadNotifications:s,notificationCount:l,hasNotifications:t,notificationData:ie}}const Do={class:"vl-alerts-container"},Co={class:"table-container"},$o={class:"vl-table"},wo={key:0},So={key:0},ko=["colspan"],Io={key:0},Ao=H({__name:"ARTVlAlert",setup(e){const t=R("high_vl"),{notificationData:s,loadNotifications:l,clearNotification:o,openNotification:y}=Nt(),u=K(()=>{var w,b;return s.value.length?(((b=(w=s.value[0])==null?void 0:w.vlMessageObs)==null?void 0:b.highVL)||[]).length:0}),c=K(()=>{var w,b;return s.value.length?(((b=(w=s.value[0])==null?void 0:w.vlMessageObs)==null?void 0:b.rejectedVL)||[]).length:0}),p=K(()=>{var w,b;return s.value.length?(((b=(w=s.value[0])==null?void 0:w.vlMessageObs)==null?void 0:b.normalVL)||[]).length:0}),r=K(()=>{var w;if(!s.value.length)return[];const _=(w=s.value[0])==null?void 0:w.vlMessageObs;if(!_)return[];switch(t.value){case"high_vl":return _.highVL||[];case"rejected":return _.rejectedVL||[];case"normal":return _.normalVL||[];default:return[]}}),g=_=>y(_),C=_=>{_.id&&o(_.id,w=>{console.log("Cleared notification ".concat(w))})},$=()=>{switch(t.value){case"high_vl":return"No high viral load results found";case"rejected":return"No rejected samples found";case"normal":return"No normal results found";default:return"No results found"}};return ue(()=>{l()}),(_,w)=>(d(),f("div",Do,[a(S(Xe),{mode:"ios",modelValue:t.value,"onUpdate:modelValue":w[0]||(w[0]=b=>t.value=b),class:"category-segment"},{default:i(()=>[a(S(de),{value:"high_vl"},{default:i(()=>[a(S(ve),null,{default:i(()=>[A("High VL ("+v(u.value)+")",1)]),_:1})]),_:1}),a(S(de),{value:"rejected"},{default:i(()=>[a(S(ve),null,{default:i(()=>[A("Rejected ("+v(c.value)+")",1)]),_:1})]),_:1}),a(S(de),{value:"normal"},{default:i(()=>[a(S(ve),null,{default:i(()=>[A("Normal Results ("+v(p.value)+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",Co,[n("table",$o,[n("thead",null,[n("tr",null,[w[1]||(w[1]=n("th",null,"ARV #",-1)),w[2]||(w[2]=n("th",null,"Accession #",-1)),w[3]||(w[3]=n("th",null,"Order Date",-1)),t.value==="rejected"?(d(),f("th",wo,"Rejection Reason")):k("",!0),w[4]||(w[4]=n("th",null,"View",-1)),w[5]||(w[5]=n("th",null,"Clear",-1))])]),n("tbody",null,[r.value.length===0?(d(),f("tr",So,[n("td",{colspan:t.value==="rejected"?6:5,class:"empty-message"},v($()),9,ko)])):k("",!0),(d(!0),f(F,null,j(r.value,b=>(d(),f("tr",{key:b.id},[n("td",null,v(b.arv||"-"),1),n("td",null,v(b.accession||"-"),1),n("td",null,v(b.order_date||"-"),1),t.value==="rejected"?(d(),f("td",Io,v(b.rejection_reason||"-"),1)):k("",!0),n("td",null,[a(S(Pe),{fill:"clear",size:"small",onClick:M=>g(b)},{default:i(()=>[a(S(E),{icon:S($t),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])]),n("td",null,[a(S(Pe),{fill:"clear",size:"small",onClick:M=>C(b),color:"success"},{default:i(()=>[a(S(E),{icon:S(dn),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])])]))),128))])])])]))}}),To=W(Ao,[["__scopeId","data-v-7b9c4735"]]),Po={class:"dashboard-container"},No={class:"segment-content"},Oo={key:0},Ro={key:1},Vo={key:2},Mo=H({__name:"ARTHome",setup(e){const t=R("dashboard"),{notificationCount:s,loadNotifications:l}=Nt();return ue(()=>{l()}),(o,y)=>(d(),f("div",Po,[a(S(Xe),{modelValue:t.value,"onUpdate:modelValue":y[0]||(y[0]=u=>t.value=u)},{default:i(()=>[a(S(de),{value:"dashboard"},{default:i(()=>[...y[1]||(y[1]=[A(" Overview ",-1)])]),_:1}),a(S(de),{value:"viralLoadAlerts"},{default:i(()=>[n("div",No,[y[2]||(y[2]=A(" VL Alerts ",-1)),S(s)>0?(d(),V(S(cn),{key:0,color:"primary"},{default:i(()=>[A(v(S(s)),1)]),_:1})):k("",!0)])]),_:1}),a(S(de),{value:"internalReferrals"},{default:i(()=>[...y[3]||(y[3]=[A(" Internal referrals ",-1)])]),_:1})]),_:1},8,["modelValue"]),t.value==="dashboard"?(d(),f("div",Oo,[a(bo)])):k("",!0),t.value==="viralLoadAlerts"?(d(),f("div",Ro,[a(To)])):k("",!0),t.value==="internalReferrals"?(d(),f("div",Vo,[a(Pt)])):k("",!0)]))}}),xo=W(Mo,[["__scopeId","data-v-d237cab2"]]);class Bo{constructor(){Z(this,"socket",null);Z(this,"channel","ImmunizationReportChannel");Z(this,"isConnected",!1);Z(this,"pendingFetch",null);Z(this,"location_id");Z(this,"initPromise");Z(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});Z(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});Z(this,"onError",t=>{console.error("WebSocket error:",t),this.isConnected=!1});this.initPromise=this.init()}async init(){const t=localStorage.getItem("apiURL"),s=localStorage.getItem("apiPort"),l=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const o="".concat(l,"://").concat(t,"/api/v1/cable");this.socket=new WebSocket(o),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(o){console.error(o),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const t={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(t))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await U.getJson("immunization/stats",{start_date:I.getDateBeforeByDays(I.sessionDate(),365),end_date:I.sessionDate()})}async setMessageHandler(t){await this.initPromise,this.socket?this.socket.onmessage=s=>{t(s)}:console.error("WebSocket connection not established.")}}const Lo=H({components:{IonContent:ne,IonHeader:te,IonItem:re,IonList:le,IonMenu:Se,IonTitle:we,IonToolbar:pe,IonInput:pt,BasicInputField:Pn,BasicForm:Ie,PreviousVitals:Tn,customDatePicker:zn,IonCol:Ve,IonRow:Me,VueMultiselect:un,IonLabel:ve,DataTable:be},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:Ee,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:I.toStandardHisDisplayFormat(U.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...q(Hn,["administerOtherVaccine"]),...q(ot,["tempScannedBatchNumber"]),...q(ee,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await jn(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:he,pulseOutline:pn,clipboardOutline:ht}},methods:{formatBirthdate(e){return I.getBirthdateAge(e)},async openClientProfile(e){const t=await fe.findByID(e);await ee().setPatientRecord(t),this.$router.push("patientProfile")},processData(){var t;return((t=this.data)==null?void 0:t.map(s=>{if(s.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let l=[];const o=y=>y.map(c=>{let p=0;return c.clients.map(r=>{(c.drug_name==this.drug_name&&(this.village==r.table.city_village||this.village=="All")||(c.drug_name==this.drug_name||this.village==r.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:r.table.given_name,family_name:r.table.family_name,patient_id:r.table.patient_id,birthdate:r.table.birthdate,city_village:r.table.city_village}),p++),this.villageList.push(r.table.city_village)}),[c.drug_name,p]}).filter(c=>c[1]!==0);return this.title=="Client due today"&&(l=o(s.value.due_today_antigens)),this.title=="Client due this week"&&(l=o(s.value.due_this_week_antigens)),this.title=="Client due this month"&&(l=o(s.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(l=o(s.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(l=o(s.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(y=>JSON.stringify(y)))].map(y=>JSON.parse(y)),this.villageList=[...new Set(this.villageList)],l}}))[0]},handleVillageClick(e){this.drug_name="",this.village=e,this.tableData=this.processData()},handleRowClick(e){var s;this.tableEvent=e.target;const t=this.tableEvent.closest("tr");if(t){const l=Array.from(((s=t.parentNode)==null?void 0:s.children)||[]).indexOf(t),o=this.tableData[l];this.drug_name=o[0],t.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(e){return I.calculateDisplayAge(e)},openPopover(e){this.event=e,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(e){var s;const t=e.target.value;this.batchNumber=t||((s=this.tempScannedBatchNumber)==null?void 0:s.text)||""},saveBatchWithTodayDate(){let e=U.getSessionDate();this.saveDta(e)},dismiss(){Ce.dismiss()},saveBatch(){let e;_e.isEmpty(this.vaccineDate)==!0?e=U.getSessionDate():e=this.vaccineDate,this.saveDta(e)},validateVaccineName(){if(_e.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(_e.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(e){this.currentDrugOb=e},isAlphaNumeric(e){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(e)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(e){this.batchNumber=e},saveDta(e){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){ye("Enter batch number!");return}if(this.batchNumber==""){ye("Enter batch number!");return}const t={batch_number:this.batchNumber,date_administered:e,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},s=ot();s.setAdministeredVaccine(t),Wn(this.patient),this.dismiss(),s.setTempScannedBatchNumber(null)}}}),Eo={key:0,class:"spinner-overlay"},Fo={class:"header position_content"},Uo={style:{"font-size":"1.2em","font-weight":"700"}},Ho={class:"dueCardContent"},zo=["onClick"],Wo={style:{"margin-right":"15px"}},jo={style:{"align-items":"center",display:"flex"}},Go={style:{"line-height":"1"}},Jo={class:"client_name"},Qo={class:"name"},Ko={class:"demographicsOtherRow"},qo={class:"demographicsText"};function Yo(e,t,s,l,o,y){const u=m("ion-spinner"),c=m("ion-icon"),p=m("ion-header"),r=m("ion-card-title"),g=m("ion-card-header"),C=m("DataTable"),$=m("ion-card-content"),_=m("ion-card"),w=m("ion-item"),b=m("ion-list"),M=m("ion-popover"),P=m("ion-content");return d(),f(F,null,[e.isLoading?(d(),f("div",Eo,[a(u,{name:"bubbles"}),t[3]||(t[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):k("",!0),a(p,null,{default:i(()=>[n("div",Fo,[n("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=O=>e.dismiss())},[a(c,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Uo,v(e.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:t[1]||(t[1]=O=>e.openPopover(O))},[a(c,{slot:"separator",size:"large",icon:e.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(P,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:i(()=>[n("div",null,[a(_,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:i(()=>[a(g,null,{default:i(()=>[a(r,{class:"sectionTitle"},{default:i(()=>[...t[4]||(t[4]=[A(" Summary of required doses ",-1)])]),_:1})]),_:1}),a($,null,{default:i(()=>[n("div",Ho,[a(C,{options:e.options,data:e.tableData,class:"display nowrap",width:"100%",onClick:e.handleRowClick},{default:i(()=>[...t[5]||(t[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])]),_:1},8,["options","data","onClick"])])]),_:1})]),_:1}),a(_,{class:"section",style:{"margin-inline":"0px"}},{default:i(()=>[a(g,null,{default:i(()=>[a(r,{class:"sectionTitle"},{default:i(()=>[...t[6]||(t[6]=[A("Client Details ",-1)])]),_:1})]),_:1}),a($,null,{default:i(()=>[(d(!0),f(F,null,j(e.clientDetails,(O,Q)=>(d(),f("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:Q,onClick:G=>e.openClientProfile(O.patient_id)},[n("div",Wo,[n("div",{class:se((O==null?void 0:O.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(c,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:e.person},null,8,["icon"])],2)]),n("div",jo,[n("div",Go,[n("div",Jo,[n("div",Qo,v(O.given_name)+" "+v(O.family_name),1)]),n("div",Ko,[n("div",qo,[A(v(O.gender=="M"?"Male":"Female")+" ",1),t[7]||(t[7]=n("span",{class:"dot"},".",-1)),A(v(e.formatBirthdate(O.birthdate)),1)])]),n("div",null,"Village: "+v(O.city_village),1)])])],8,zo))),128))]),_:1})]),_:1})]),a(M,{style:{"--offset-x":"-10px"},"is-open":e.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:e.event,onDidDismiss:t[2]||(t[2]=O=>e.popoverOpen=!1)},{default:i(()=>[n("div",null,[t[8]||(t[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(d(!0),f(F,null,j(e.villageList,(O,Q)=>(d(),V(b,{class:se(O==e.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:Q},{default:i(()=>[a(w,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:G=>e.handleVillageClick(O)},{default:i(()=>[A(v(O),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const Xo=W(Lo,[["render",Yo],["__scopeId","data-v-dfc02771"]]),Zo=H({name:"Menu",mixins:[Ae],components:{IonContent:ne,IonHeader:te,IonItem:re,IonList:le,IonMenu:Se,IonTitle:we,IonToolbar:pe,IonCheckbox:Be,BasicForm:Ie,BasicCard:Fe,Carousel:gn,Slide:fn,Pagination:hn,Navigation:mn},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},computed:{...q(ke,["substance"]),backgroundStyle(){return{background:"linear-gradient(180deg, rgba(150, 152, 152, 0.7) 0%, rgba(255, 255, 255, 0.9) 100%), url(".concat(Gn("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",height:"22.8vh"}}},watch:{},async mounted(){new Bo().setMessageHandler(this.onMessage)},methods:{async onMessage(e){var s,l,o;const t=JSON.parse(e.data);t.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=t.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((s=this.reportData)==null?void 0:s.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((l=this.reportData)==null?void 0:l.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((o=this.reportData)==null?void 0:o.total_male_vaccinated_this_year)||0}])},openDueModal(e){const t={title:e,dashBoardData:this.reportData};Te(Xo,{class:"fullScreenModal"},!0,t)},async openClientProfile(e){const t=et(),s=async l=>{await ee().setPatientRecord(l),this.$router.push("patientProfile")};if(t==!1){const l=await fe.findByNpid(e);await s(l[0])}if(t){const l=await Le(e);s(l)}}}}),ei={class:"topStats"},ti={class:"totalStats",style:{background:"linear-gradient(180deg, #20b2aa 0%, #40c0b0 50%, rgb(233, 233, 233) 100%)"}},ni={class:"statsValue",style:{"font-size":"1.4em"}},ai={class:"statsText",style:{"font-size":"0.9em"}},si={class:"dueCardContent"},oi={class:"statsValue"},ii={class:"statsValue"},li={class:"statsValue"},ri={class:"overDueCardContent"},di={class:"statsValue"},ci={class:"statsValue"},ui=["onClick"],pi={style:{"margin-right":"15px"}},mi={style:{"align-items":"center",display:"flex"}},hi={style:{"line-height":"1"}},fi={class:"client_name"},gi={class:"name"},vi={class:"demographicsOtherRow"},_i={class:"demographicsText"};function yi(e,t,s,l,o,y){const u=m("Slide"),c=m("Pagination"),p=m("Carousel"),r=m("ion-card-title"),g=m("ion-card-header"),C=m("ion-card-content"),$=m("ion-card"),_=m("ion-icon"),w=m("ion-content");return d(),V(w,{class:"content"},{default:i(()=>[n("div",ei,[n("div",null,[n("div",{style:Oe(e.backgroundStyle)},[a(p,{autoplay:4e3,"wrap-around":!0,itemsToShow:1.2,transition:600,style:{"padding-top":"20px"}},{addons:i(()=>[a(c)]),default:i(()=>[(d(!0),f(F,null,j(e.totalStats,b=>(d(),V(u,{key:b},{default:i(()=>[n("div",ti,[n("div",ni,v(b.value),1),n("div",ai,v(b.name),1)])]),_:2},1024))),128))]),_:1})],4)]),a($,{class:"section"},{default:i(()=>[a(g,null,{default:i(()=>[a(r,{class:"cardTitle"},{default:i(()=>[...t[5]||(t[5]=[A(" Clients due ",-1)])]),_:1})]),_:1}),a(C,null,{default:i(()=>{var b,M,P;return[n("div",si,[n("div",{class:"dueCard",onClick:t[0]||(t[0]=O=>e.openDueModal("Client due today")),style:{border:"1px solid rgb(158, 207, 136)"}},[n("div",oi,v(((b=e.reportData)==null?void 0:b.due_today_count)||0),1),t[6]||(t[6]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(239, 221, 121)"},onClick:t[1]||(t[1]=O=>e.openDueModal("Client due this week"))},[n("div",ii,v(((M=e.reportData)==null?void 0:M.due_this_week_count)||0),1),t[7]||(t[7]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(241, 154, 154)"},onClick:t[2]||(t[2]=O=>e.openDueModal("Client due this month"))},[n("div",li,v(((P=e.reportData)==null?void 0:P.due_this_month_count)||0),1),t[8]||(t[8]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),a($,{class:"section"},{default:i(()=>[a(g,null,{default:i(()=>[a(r,{class:"cardTitle"},{default:i(()=>[...t[9]||(t[9]=[A(" Clients overdue ",-1)])]),_:1})]),_:1}),a(C,null,{default:i(()=>{var b,M;return[n("div",ri,[n("div",{class:"overDueCard",onClick:t[3]||(t[3]=P=>e.openDueModal("Client overdue under 5yrs"))},[n("div",di,v(((b=e.reportData)==null?void 0:b.under_five_overdue)||0),1),t[10]||(t[10]=n("div",{class:"statsText"},"Under 5yrs",-1))]),n("div",{class:"overDueCard",onClick:t[4]||(t[4]=P=>e.openDueModal("Client overdue over 5yrs"))},[n("div",ci,v(((M=e.reportData)==null?void 0:M.over_five_overdue)||0),1),t[11]||(t[11]=n("div",{class:"statsText"},"Over 5yrs",-1))])])]}),_:1})]),_:1}),a($,{class:"section"},{default:i(()=>[a(g,null,{default:i(()=>[a(r,{class:"cardTitle"},{default:i(()=>{var b;return[A("Today's appointments("+v((b=e.appointments)==null?void 0:b.length)+") ",1)]}),_:1})]),_:1}),a(C,null,{default:i(()=>[(d(!0),f(F,null,j(e.appointments,(b,M)=>(d(),f("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:M,onClick:P=>e.openClientProfile(b.npid)},[n("div",pi,[n("div",{class:se(b.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(_,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:e.person},null,8,["icon"])],2)]),n("div",mi,[n("div",hi,[n("div",fi,[n("div",gi,v(b.given_name)+" "+v(b.family_name),1)]),n("div",vi,[n("div",_i,[A(v(b.gender=="M"?"Male":"Female")+" ",1),t[12]||(t[12]=n("span",{class:"dot"},".",-1)),A(v(e.formatBirthdate(b.birthdate)),1)])]),n("div",null,"Village: "+v(b==null?void 0:b.city_village),1)])])],8,ui))),128))]),_:1})]),_:1})])]),_:1})}const bi=W(Zo,[["render",yi],["__scopeId","data-v-13cf6a75"]]),Di=H({components:{DataTable:be},props:{title:{type:String,default:""},list:{type:String,default:""},buttonTitle:{type:String,default:""},buttonLink:{type:String,default:""}},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:(e,t)=>{if(!e)return"-";const s=new Date(e).getTime(),l=Date.now()-s,o=Math.floor(l/6e4),y=(()=>{if(o<1)return"Just now";if(o<60)return"".concat(o," min").concat(o>1?"s":""," ago");const u=Math.floor(o/60);if(u<24)return"".concat(u," hour").concat(u>1?"s":""," ago");const c=Math.floor(u/24);return"".concat(c," day").concat(c>1?"s":""," ago")})();return t==="display"?y:l},type:"num",width:"15%"},{title:"Actions",data:null,render:(e,t,s)=>{const l=document.createElement("div");l.style.display="flex",l.style.gap="6px";const o="  --padding-top: 4px;\n                                            --padding-bottom: 4px;\n                                            --padding-start: 8px;\n                                            --padding-end: 8px;\n                                            font-size: 0.8rem;\n                                            height: 28px;\n                                            min-width: 70px;\n                                            white-space: nowrap;\n                                            ",y=(u,c,p)=>{const r=document.createElement("ion-button");return r.innerText=u,r.size="small",r.fill="solid",r.color=c,r.style.cssText=o,r.addEventListener("click",p),r};return l.appendChild(y(this.buttonTitle,"primary",()=>this.navigateTo(s,this.buttonLink))),l.appendChild(y("Profile","warning",()=>this.navigateTo(s,"/patientProfile"))),l.appendChild(y("Abscond","danger",()=>this.handleAbscond(s.identifier))),l},orderable:!1,width:"25%"}],tableOptions:{order:[[1,"desc"]]}}},computed:{...q(Je,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{patientsWaitingForConsultation:{handler(e){this.list==="CONSULTATION"&&(this.patients=e)},deep:!0},patientsWaitingForVitals:{handler(e){this.list==="VITALS"&&(this.patients=e)},deep:!0},patientsWaitingForLab:{handler(e){this.list==="LAB"&&(this.patients=e)},deep:!0},patientsWaitingForDispensation:{handler(e){this.list==="DISPENSATION"&&(this.patients=e)},deep:!0}},mounted(){this.setList()},methods:{setList(){const e={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation},t=this.list;this.patients=e[t]||[]},waitingTime(e){if(!e)return"-";const t=Date.now()-new Date(e).getTime(),s=Math.floor(t/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const l=Math.floor(s/60);if(l<24)return"".concat(l," hour").concat(l>1?"s":""," ago");const o=Math.floor(l/24);return"".concat(o," day").concat(o>1?"s":""," ago")},async navigateTo(e,t){let s=[];if(U.getModsStatus()&&(s=await Le(e.identifier)),U.getUseIndexDBStatus()&&U.getModsStatus()===!1&&(s=await je("patientRecords",{whereClause:{ID:e.identifier}}),s=s[0]),s.length===0&&(s=await U.getJson("/patients/".concat(e.patient_id,"/get_patient_record"))),U.getModsStatus()==!1&&s.length===0){Ge("Patient not found in offline records.");return}const l=s;await ee().setPatientRecord(l),this.$router.push(t)},async handleAbscond(e){await Nn({ID:e})},dismiss(){Ce.dismiss()}}}),Ci={class:"modal-container"},$i={class:"dueCardContent"};function wi(e,t,s,l,o,y){const u=m("ion-button"),c=m("ion-card-title"),p=m("ion-card-header"),r=m("DataTable"),g=m("ion-card-content"),C=m("ion-card");return d(),f("div",Ci,[a(u,{class:"close-button",fill:"clear",size:"large",onClick:e.dismiss},{default:i(()=>[...t[0]||(t[0]=[A(" Close ",-1)])]),_:1},8,["onClick"]),a(C,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:i(()=>[a(p,null,{default:i(()=>[a(c,{class:"sectionTitle"},{default:i(()=>[A(v(e.title),1)]),_:1})]),_:1}),a(g,null,{default:i(()=>[n("div",$i,[a(r,{data:e.patients,options:e.tableOptions,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const Si=W(Di,[["render",wi],["__scopeId","data-v-6e84ce8a"]]),ki=H({components:{IonContent:ne,IonHeader:te,IonItem:re,IonList:le,IonIcon:E,IonCard:De,IonCardHeader:Ye,IonCardTitle:qe,IonCardContent:Re,IonPopover:Ke,DataTable:be},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:Ee,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:e=>this.waitingTime(e),width:"20%"},{title:"Actions",data:null,render:(e,t,s)=>{const l=document.createElement("div");l.style.display="flex",l.style.gap="6px";const o="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",y=(u,c,p)=>{const r=document.createElement("ion-button");return r.innerText=u,r.size="small",r.fill="solid",r.color=c,r.style.cssText=o,r.addEventListener("click",p),r};return l.appendChild(y("Profile","warning",()=>this.navigateTo(s.patient_id,"/patientProfile"))),l},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const e=await wt();this.patients=e.map(t=>({fullName:t.fullName||"",arrivalTime:t.startDate||"",patient_id:t.patientId||""}))},methods:{openPopover(e){this.event=e,this.popoverOpen=!0},dismiss(){Ce.dismiss()},waitingTime(e){if(!e)return"-";const t=Date.now()-new Date(e).getTime(),s=Math.floor(t/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const l=Math.floor(s/60);if(l<24)return"".concat(l," hour").concat(l>1?"s":""," ago");const o=Math.floor(l/24);return"".concat(o," day").concat(o>1?"s":""," ago")},async navigateTo(e,t){console.log(e);let s;et()?s=await Le(e):s=await fe.findByID(e),s?(await ee().setPatientRecord(s),this.$router.push(t)):ye("Patient not found. Please try searching the patient by name.")}}}),Ii={class:"modal-container"},Ai={class:"dueCardContent"};function Ti(e,t,s,l,o,y){const u=m("ion-button"),c=m("ion-card-title"),p=m("ion-card-header"),r=m("DataTable"),g=m("ion-card-content"),C=m("ion-card");return d(),f("div",Ii,[a(u,{class:"close-button",fill:"clear",size:"large",onClick:e.dismiss},{default:i(()=>[...t[0]||(t[0]=[A(" Close ",-1)])]),_:1},8,["onClick"]),a(C,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:i(()=>[a(p,null,{default:i(()=>[a(c,{class:"sectionTitle"},{default:i(()=>[A(v(e.title),1)]),_:1})]),_:1}),a(g,null,{default:i(()=>[n("div",Ai,[a(r,{data:e.patients,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})])}const Pi=W(ki,[["render",Ti],["__scopeId","data-v-87bf07df"]]),Ni=H({name:"OPDAppointmentsModal",components:{IonPage:xe,IonHeader:te,IonContent:ne,IonItem:re,IonList:le,IonIcon:E,IonCard:De,IonCardContent:Re,IonPopover:Ke,DataTable:be,IonSegment:Xe,IonSegmentButton:de,IonLabel:ve,IonRow:Me,IonCol:Ve,DateInputField:nt},props:{title:{type:String,default:"OPD Appointments"},programType:{type:String,required:!0},programId:{type:Number,required:!0}},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:Ee,appointments:[],viewMode:"today",startDate:I.sessionDate(),endDate:I.sessionDate(),calendarOutline:$e,openOutline:bt,tableColumns:[{title:"Patient ID",data:"ID"},{title:"Name",data:"name"},{title:"Age/DOB",data:"ageDob"},{title:"Gender",data:"gender"},{title:"Village",data:"village"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(e,t,s)=>{const l=document.createElement("div"),o=document.createElement("ion-button");return o.innerText="Profile",o.size="small",o.style.color="#fff",o.style.padding="8px 12px",o.style.marginRight="8px",o.addEventListener("click",()=>this.openClientProfile(s.ID)),l.appendChild(o),l},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,order:[[5,"asc"]]}}},async mounted(){await this.loadAppointments()},methods:{async loadAppointments(){var e,t;this.isLoading=!0;try{const s=I.sessionDate(),l=this.viewMode==="today"?s:this.startDate,o=this.viewMode==="today"?s:this.endDate,y=localStorage.getItem("locationID"),u=await je("patientRecords"),c=[];for(const p of u)[...((e=p.appointments)==null?void 0:e.saved)||[],...((t=p.appointments)==null?void 0:t.unsaved)||[]].filter(C=>{if(C.concept_id!==5096||C.program_id!==14||C.location_id!==y)return!1;const $=C==null?void 0:C.value_datetime;if(!$)return!1;const _=I.toStandardHisFormat($),w=I.toStandardHisFormat(l),b=I.toStandardHisFormat(o);return _>=w&&_<=b}).forEach(C=>{var $,_,w,b,M;c.push({ID:p.ID,name:[($=p.personInformation)==null?void 0:$.given_name,(_=p.personInformation)==null?void 0:_.family_name].filter(Boolean).join(" ")||"Unknown",ageDob:(w=p.personInformation)!=null&&w.birthdate?I.getBirthdateAge(p.personInformation.birthdate):"N/A",gender:((b=p.personInformation)==null?void 0:b.gender)||"Unknown",village:((M=p.personInformation)==null?void 0:M.home_village)||"Unknown",appointmentDate:I.toStandardHisDisplayFormat(C==null?void 0:C.value_datetime),rawData:C})});this.appointments=c.sort((p,r)=>{var $,_;const g=($=p.rawData)==null?void 0:$.value_datetime,C=(_=r.rawData)==null?void 0:_.value_datetime;return new Date(g).getTime()-new Date(C).getTime()})}catch(s){console.error("Error loading appointments:",s),Ge("Failed to load appointments")}finally{this.isLoading=!1}},async getAppointmentsD1(e){this.startDate=I.toStandardHisFormat(e),await this.loadAppointments()},async getAppointmentsD2(e){this.endDate=I.toStandardHisFormat(e),await this.loadAppointments()},onViewModeChange(){this.viewMode==="today"&&(this.startDate=I.sessionDate(),this.endDate=I.sessionDate()),this.loadAppointments()},async openClientProfile(e){try{const t=await je("patientRecords",{whereClause:{ID:e}});await ee().setPatientRecord(t[0]),this.$router.push("patientProfile")}catch(t){console.error("Error opening profile:",t),Ge("Failed to open patient profile")}},openPopover(e){this.event=e,this.popoverOpen=!0},dismiss(){Ce.dismiss()}}}),Oi={class:"header position_content"},Ri={style:{"font-size":"1.2em","font-weight":"700"}},Vi={key:0,class:"date-filter"},Mi={class:"dueCardContent"},xi={key:1,class:"no-appointments"};function Bi(e,t,s,l,o,y){const u=m("ion-icon"),c=m("ion-header"),p=m("ion-label"),r=m("ion-segment-button"),g=m("ion-segment"),C=m("DateInputField"),$=m("ion-col"),_=m("ion-row"),w=m("DataTable"),b=m("ion-card-content"),M=m("ion-card"),P=m("ion-content"),O=m("ion-page");return d(),V(O,null,{default:i(()=>[a(c,null,{default:i(()=>[n("div",Oi,[n("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=(...Q)=>e.dismiss&&e.dismiss(...Q))},[a(u,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Ri,v(e.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:t[1]||(t[1]=Q=>e.openPopover(Q))},[a(u,{slot:"separator",size:"large",icon:e.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(P,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:i(()=>[a(g,{modelValue:e.viewMode,"onUpdate:modelValue":t[2]||(t[2]=Q=>e.viewMode=Q),onIonChange:e.onViewModeChange},{default:i(()=>[a(r,{value:"today"},{default:i(()=>[a(p,null,{default:i(()=>[...t[3]||(t[3]=[A("Today's Appointments",-1)])]),_:1})]),_:1}),a(r,{value:"range"},{default:i(()=>[a(p,null,{default:i(()=>[...t[4]||(t[4]=[A("Date Range",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","onIonChange"]),e.viewMode==="range"?(d(),f("div",Vi,[a(_,null,{default:i(()=>[a($,null,{default:i(()=>[a(C,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:e.endDate,disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1},null,8,["icon","inputValue","maxDate","onUpdate:rawDateValue"])]),_:1}),a($,null,{default:i(()=>[a(C,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):k("",!0),a(M,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:i(()=>[a(b,null,{default:i(()=>[n("div",Mi,[e.appointments.length>0?(d(),V(w,{key:0,data:e.appointments,columns:e.tableColumns,options:e.tableOptions,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns","options"])):(d(),f("div",xi," No appointments found for the selected "+v(e.viewMode==="today"?"day":"date range"),1))])]),_:1})]),_:1})]),_:1})]),_:1})}const Li=W(Ni,[["render",Bi],["__scopeId","data-v-28c4e8ae"]]),Ei={class:"card-count"},Fi={class:"card-label"},Ui="#ffffff",Hi=H({__name:"DashboardCard",props:{icon:{},count:{},label:{},color:{}},emits:["cardClick"],setup(e,{emit:t}){const o={success:"#A5D6A7",info:"#81D4FA",warning:"#FFF59D",danger:"#EF9A9A"}[e.color||"info"]||"#E0E0E0";return(y,u)=>(d(),V(S(De),{class:"dashboard-card",style:Oe({borderColor:S(o),backgroundColor:Ui}),onClick:u[0]||(u[0]=c=>y.$emit("cardClick"))},{default:i(()=>[a(S(E),{icon:e.icon,class:"card-icon"},null,8,["icon"]),n("div",Ei,v(e.count),1),n("div",Fi,v(e.label),1)]),_:1},8,["style"]))}}),zi=W(Hi,[["__scopeId","data-v-84ad3c1b"]]),Wi=H({name:"OPDDashboard",components:{DashboardCard:zi},data(){return{totalPatientsToday:0,canViewVitals:!1,canViewConsultation:!1,canViewLab:!1,canViewDispensation:!1,canViewAppointments:!1,userRoles:[]}},computed:{...q(Je,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","patientsVisits","todaysAppointmentsCount"])},watch:{$route:{async handler(){this.reloadRolePermissions(),await this.refreshDashboard()},deep:!0}},async mounted(){this.reloadRolePermissions(),await this.refreshDashboard()},methods:{medkit(){return _t},flask(){return _n},async refreshDashboard(){const e=U.getUserLocationId();e&&await Je().refresh(e)},clipboard(){return ft},thermometer(){return gt},calendar(){return vn},people(){return vt},reloadRolePermissions(){this.loadUserRoles(),this.updateCardVisibility()},loadUserRoles(){localStorage.getItem("userRoles");try{const e=localStorage.getItem("userRoles")||"[]",t=JSON.parse(e);this.userRoles=t.map(s=>typeof s=="string"?s:s.role||s.name||"")}catch(e){this.userRoles=[]}},hasAnyRole(e){const t=this.userRoles.map(s=>s.toLowerCase());return e.some(s=>t.includes(s.toLowerCase()))},updateCardVisibility(){this.canViewVitals=this.hasAnyRole(["Clinician","Nurse","Superuser"]),this.canViewConsultation=this.hasAnyRole(["Clinician","Superuser"]),this.canViewLab=this.hasAnyRole(["Lab"]),this.canViewDispensation=this.hasAnyRole(["Clinician","Pharmacist","Superuser"]),this.canViewAppointments=this.hasAnyRole(["Clinician","Nurse","Superuser"])},openAllModal(e,t,s){Te(Pi,{class:"fullScreenModal"},!0,{title:e,buttonTitle:t,buttonLink:s})},openPatientsListModal(e,t,s,l){Te(Si,{class:"fullScreenModal"},!0,{title:e,list:t,buttonTitle:s,buttonLink:l})},openAppointmentsModal(e,t){Te(Li,{class:"fullScreenModal"},!0,{title:e,programType:t,programId:14})}}}),ji={class:"dashboard-wrapper"};function Gi(e,t,s,l,o,y){const u=m("ion-icon"),c=m("ion-card-title"),p=m("ion-card-header"),r=m("DashboardCard"),g=m("ion-row"),C=m("ion-grid"),$=m("ion-card-content"),_=m("ion-card"),w=m("ion-content");return d(),V(w,{fullscreen:!0},{default:i(()=>[n("div",ji,[a(_,{class:"dashboard-card"},{default:i(()=>[a(p,{class:"dashboard-card-header"},{default:i(()=>[a(c,{class:"dashboard-title"},{default:i(()=>[a(u,{icon:e.people(),slot:"start",class:"dashboard-icon"},null,8,["icon"]),t[6]||(t[6]=A(" Today's Patients Overview ",-1))]),_:1})]),_:1}),a($,null,{default:i(()=>[a(C,{class:"centered-grid"},{default:i(()=>[a(g,{class:"centered-row"},{default:i(()=>{var b,M,P;return[a(r,{icon:e.people(),color:"primary",count:e.patientsVisits.length,label:"Total patients today",onCardClick:t[0]||(t[0]=O=>e.openAllModal("All patients today","View profile","/patientProfile"))},null,8,["icon","count"]),e.canViewAppointments?(d(),V(r,{key:0,icon:e.calendar(),color:"primary",count:((b=e.todaysAppointmentsCount)==null?void 0:b.length)||0,label:"Appointments",onCardClick:t[1]||(t[1]=O=>e.openAppointmentsModal("OPD Appointments","14"))},null,8,["icon","count"])):k("",!0),e.canViewVitals?(d(),V(r,{key:1,icon:e.thermometer(),color:"primary",count:(M=e.patientsWaitingForVitals)==null?void 0:M.length,label:"Waiting for vitals",onCardClick:t[2]||(t[2]=O=>e.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals"))},null,8,["icon","count"])):k("",!0),e.canViewConsultation?(d(),V(r,{key:2,icon:e.clipboard(),color:"primary",count:(P=e.patientsWaitingForConsultation)==null?void 0:P.length,label:"Waiting for consultation",onCardClick:t[3]||(t[3]=O=>e.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan"))},null,8,["icon","count"])):k("",!0),e.canViewLab?(d(),V(r,{key:3,icon:e.flask(),color:"primary",count:e.patientsWaitingForLab.length,label:"Waiting for lab",onCardClick:t[4]||(t[4]=O=>e.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan"))},null,8,["icon","count"])):k("",!0),e.canViewDispensation?(d(),V(r,{key:4,icon:e.medkit(),color:"primary",count:e.patientsWaitingForDispensation.length,label:"Waiting for dispensation",onCardClick:t[5]||(t[5]=O=>e.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations"))},null,8,["icon","count"])):k("",!0)]}),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})}const Ji=W(Wi,[["render",Gi],["__scopeId","data-v-42ba9b2f"]]),Qi=H({name:"NCDDashboard",mixins:[Ae],components:{ApexChart:tt},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await yt(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return U.getJson("programs/32/reports/ncd_dashboard",{start_date:I.toStandardHisFormat(I.sessionDate()),end_date:I.toStandardHisFormat(I.sessionDate())})}}}),Ki={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},qi={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},Yi={ref:"chartRef1"},Xi={ref:"chartRef2"};function Zi(e,t,s,l,o,y){const u=m("ion-card-content"),c=m("ion-card"),p=m("ApexChart");return d(),f(F,null,[n("div",Ki,[a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:i(()=>[a(u,null,{default:i(()=>[...t[0]||(t[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:i(()=>[a(u,null,{default:i(()=>[...t[1]||(t[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:i(()=>[a(u,null,{default:i(()=>[...t[2]||(t[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:i(()=>[a(u,null,{default:i(()=>[...t[3]||(t[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])]),_:1})]),_:1})]),n("div",qi,[a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:i(()=>[a(u,null,{default:i(()=>[t[4]||(t[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",Yi,[e.isChartReady?(d(),V(p,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:e.barChartOptions,series:e.barChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:i(()=>[a(u,null,{default:i(()=>[t[5]||(t[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",Xi,[e.isChartReady?(d(),V(p,{key:0,style:{width:"100%",height:"500px"},type:"line",options:e.lineChartOptions,series:e.lineChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1})]),_:1})])],64)}const el=W(Qi,[["render",Zi],["__scopeId","data-v-58e2a3d8"]]),tl=H({name:"Home",mixins:[St,Ae],components:{IonContent:ne,IonHeader:te,IonPage:xe,IonToolbar:pe,Toolbar:It,IonRow:Me,DateInputField:nt,IonIcon:E,IonButton:Pe,IonCol:Ve},data(){const e=R(I.sessionDate()),t=R(I.sessionDate()),s=R(I.sessionDate()),l=R([]);return{segmentContent:"Today",minDate:s,startDate:e,endDate:t,people:l,calendarOutline:$e,eyeOutline:$t}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(e){this.segmentContent=e},formatBirthdate(e){return I.getBirthdateAge(e)},async getAppointments(){this.people=[],(await Tt.getAppointments(this.startDate,this.endDate,"")).forEach(t=>{const s={person_id:t.person_id,npid:t.npid,appointment_id:103,encounter_id:t.encounter_id,name:t.given_name.concat(" ",t.family_name),gender:t.gender,ageDob:this.formatBirthdate(t.birthdate),village:t.city_village,appointmentDate:I.toStandardHisDisplayFormat(t.appointment_date)};this.people.push(s)})},async getAppointmentsD1(e){this.startDate=I.toStandardHisFormat(e),await this.getAppointments()},async getAppointmentsD2(e){this.endDate=I.toStandardHisFormat(e),await this.getAppointments()},async openClientProfile(e){await fe.findByNpid(e),this.isPharmacist()},isPharmacist(){const e=JSON.parse(localStorage.getItem("userRoles")),t=e||[];t.some(s=>t.some(l=>l.role==="Pharmacist"))&&(this.$router.push("dispensation"),U.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),nl={class:"appointments-container"},al={key:0,class:"date-filter"},sl={class:"appointments-table"};function ol(e,t,s,l,o,y){const u=m("ion-label"),c=m("ion-segment-button"),p=m("ion-segment"),r=m("DateInputField"),g=m("ion-col"),C=m("ion-row"),$=m("ion-icon"),_=m("ion-button"),w=m("ion-card");return d(),f("div",nl,[n("div",null,[a(p,{value:e.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:i(()=>[a(c,{value:"Today",onClick:t[0]||(t[0]=b=>e.setSegmentContent("Today"))},{default:i(()=>[a(u,null,{default:i(()=>[...t[3]||(t[3]=[A("Today",-1)])]),_:1})]),_:1}),a(c,{value:"Tomorrow",onClick:t[1]||(t[1]=b=>e.setSegmentContent("Tomorrow"))},{default:i(()=>[a(u,null,{default:i(()=>[...t[4]||(t[4]=[A("Tomorrow",-1)])]),_:1})]),_:1}),a(c,{value:"Date range",onClick:t[2]||(t[2]=b=>e.setSegmentContent("Date range"))},{default:i(()=>[a(u,null,{default:i(()=>[...t[5]||(t[5]=[A("Date range",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),e.segmentContent==="Date range"?(d(),f("div",al,[a(C,null,{default:i(()=>[a(g,null,{default:i(()=>[a(r,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(g,null,{default:i(()=>[a(r,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):k("",!0),e.people.length>0?(d(),V(w,{key:1},{default:i(()=>[n("table",sl,[t[6]||(t[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),f(F,null,j(e.people,b=>(d(),f("tr",{key:b.npid},[n("td",null,[a(C,null,{default:i(()=>[a(g,null,{default:i(()=>[A(v(b.name),1)]),_:2},1024),a(g,null,{default:i(()=>[a(_,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:M=>e.openClientProfile(b.npid),color:"primary",fill:"clear",size:"small"},{default:i(()=>[a($,{icon:e.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,v(b.npid),1),n("td",null,v(b.ageDob),1),n("td",null,v(b.gender),1),n("td",null,v(b.village),1),n("td",null,v(b.appointmentDate),1)]))),128))])])]),_:1})):(d(),V(w,{key:2},{default:i(()=>[...t[7]||(t[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])]),_:1}))])}const il=W(tl,[["render",ol],["__scopeId","data-v-c47f7768"]]),ll=H({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(e){}}}),rl={key:0},dl={style:{display:"flex","margin-top":"10px"}},cl={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},ul={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},pl={key:1};function ml(e,t,s,l,o,y){const u=m("ion-label"),c=m("ion-segment-button"),p=m("ion-segment"),r=m("VisitsHistory");return d(),f(F,null,[n("div",null,[a(p,{value:e.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:i(()=>[a(c,{value:"Internal referrals",onClick:t[0]||(t[0]=g=>e.setSegmentContent("Internal referrals"))},{default:i(()=>[a(u,null,{default:i(()=>[...t[2]||(t[2]=[A("Internal referrals",-1)])]),_:1})]),_:1}),a(c,{value:"External referrals",onClick:t[1]||(t[1]=g=>e.setSegmentContent("External referrals"))},{default:i(()=>[a(u,null,{default:i(()=>[...t[3]||(t[3]=[A("External referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),e.segmentContent=="Internal referrals"?(d(),f("div",rl,[n("div",dl,[e.checkUnderFive?(d(),f("div",cl)):k("",!0),t[4]||(t[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),e.checkUnderFive?k("",!0):(d(),f("div",ul))])])):k("",!0),e.segmentContent=="External referrals"?(d(),f("div",pl,[a(r)])):k("",!0)],64)}const hl=W(ll,[["render",ml],["__scopeId","data-v-faad8f8b"]]),fl=H({name:"Menu",components:{IonContent:ne,IonHeader:te,IonItem:re,IonList:le,IonMenu:Se,IonTitle:we,IonToolbar:pe,IonCheckbox:Be,IonIcon:E,BasicForm:Ie,BasicCard:Fe,Referrals:hl,Dashboard:el,ANCAppointments:il},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:Dt},{id:"referrals",label:"Referrals",icon:Ct},{id:"appointments",label:"Appointments",icon:$e}],activeItem:"dashboard"}},computed:{...q(ke,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),gl={style:{display:"flex"}},vl={class:"left_col"},_l={class:"nav-menu"},yl=["onClick"],bl={class:"right_col"};function Dl(e,t,s,l,o,y){const u=m("ion-icon"),c=m("Dashboard"),p=m("ANCAppointments"),r=m("Referrals");return d(),f("div",gl,[n("div",vl,[n("nav",_l,[n("ul",null,[(d(!0),f(F,null,j(e.menuItems,g=>(d(),f("li",{key:g.id,class:se({active:e.activeItem===g.id}),onClick:C=>e.setActiveItem(g.id)},[a(u,{icon:g.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,v(g.label),1)],10,yl))),128))])])]),n("div",bl,[n("div",null,[e.activeItem==="dashboard"?(d(),V(c,{key:0})):k("",!0),e.activeItem==="appointments"?(d(),V(p,{key:1})):k("",!0),e.activeItem==="referrals"?(d(),V(r,{key:2})):k("",!0)])])])}const Cl=W(fl,[["render",Dl],["__scopeId","data-v-7e786ea4"]]),$l=H({name:"Menu",components:{IonContent:ne,IonHeader:te,IonItem:re,IonList:le,IonMenu:Se,IonTitle:we,IonToolbar:pe,IonCheckbox:Be,BasicForm:Ie,BasicCard:Fe},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...q(ke,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),wl={class:"left_col"},Sl={class:"nav-menu"},kl=["onClick"];function Il(e,t,s,l,o,y){return d(),f("div",null,[n("div",wl,[n("nav",Sl,[n("ul",null,[(d(!0),f(F,null,j(e.menuItems,u=>(d(),f("li",{key:u.id,class:se({active:e.activeItem===u.id}),onClick:c=>e.setActiveItem(u.id)},v(u.label),11,kl))),128))])])]),t[0]||(t[0]=n("div",{class:"right_col"},null,-1))])}const Al=W($l,[["render",Il],["__scopeId","data-v-32dd02d3"]]),Tl=H({name:"Menu",components:{IonContent:ne,IonHeader:te,IonItem:re,IonList:le,IonMenu:Se,IonTitle:we,IonToolbar:pe,IonCheckbox:Be,BasicForm:Ie,BasicCard:Fe},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...q(ke,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),Pl={class:"left_col"},Nl={class:"nav-menu"},Ol=["onClick"];function Rl(e,t,s,l,o,y){return d(),f("div",null,[n("div",Pl,[n("nav",Nl,[n("ul",null,[(d(!0),f(F,null,j(e.menuItems,u=>(d(),f("li",{key:u.id,class:se({active:e.activeItem===u.id}),onClick:c=>e.setActiveItem(u.id)},v(u.label),11,Ol))),128))])])]),t[0]||(t[0]=n("div",{class:"right_col"},null,-1))])}const Vl=W(Tl,[["render",Rl],["__scopeId","data-v-b49d8600"]]);function Ml(){const e=Ze(),t=We(),s=R(!1),{OPDActivities:l,NCDActivities:o}=Ne(t),y=async c=>{var p;try{const r=U.getUserID(),g=await At.getJson("user_properties",{user_id:r,property:c});return g!=null&&g.property_value?(p=g==null?void 0:g.property_value)==null?void 0:p.split(","):[]}catch(r){return console.error("Error fetching user activities:",r),[]}},u=async()=>{try{s.value=!1;const[c,p]=await Promise.all([y("OPD_activities"),y("NCD_activities")]);c.length>0&&t.setOPDActivity(c),p.length>0&&t.setNCDActivity(p)}catch(c){console.error("Error updating activities:",c)}finally{s.value=!0}};return ce(()=>e.path,async()=>{await u()},{immediate:!0,deep:!0}),{ready:s,OPDActivities:l,NCDActivities:o,getUserActivities:y,updateActivities:u}}function xl(){const e=Ze(),t=R(""),s=R(!1),l=R({}),o=()=>{const y=U.getUserRoles(),u=U.getProgramID(),c=U.getProgramName();t.value=y,s.value=!1,y==="Lab"&&u===14?l.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:u===14&&y!=="Lab"?l.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:u===12?l.value={url:"contact",btnName:"Back"}:c==="LABOUR AND DELIVERY PROGRAM"?l.value={url:"labour/labourHome",btnName:"Back to home"}:c==="PNC PROGRAM"?l.value={url:"pnc/home",btnName:"Back to home"}:l.value={url:"",btnName:""},s.value=!0};return ce(()=>e.path,()=>{o()},{immediate:!0,deep:!0}),{userRole:t,ready:s,userRoleSettings:l,updateUserRoleSettings:o}}const Bl={key:0,class:"spinner-overlay"},or=H({__name:"HomePage",setup(e){const t=R(!0),s=Ze(),l=On(),o=R(localStorage.getItem("sessionDate")||"");xl();const y=Rn(),{apiStatus:u}=Ne(kt()),{activeProgram:c}=Ne(y),p=K(()=>{switch(c.value.program_id){case oe.IMMUNIZATION_PROGRAM:return bi;case oe.OPD_PROGRAM:return Ji;case oe.NCD_PROGRAM:return xs;case oe.HTC_PROGRAM:return so;case oe.ANC_PROGRAM:return Cl;case oe.PNC_PROGRAM:return Vl;case oe.LABOUR_AND_DELIVERY_PROGRAM:return Al;case oe.HIV_PROGRAM:return xo;default:return null}}),r=()=>{const $=localStorage.getItem("sessionDate");(!$||$.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),rt()),o.value=$||""};let g=null;ue(()=>{g=()=>r(),window.addEventListener("storage",g);const $=setInterval(r,1e3);yn(()=>{clearInterval($),g&&window.removeEventListener("storage",g)}),r()}),ce(o,($,_)=>{(!$||$.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),rt())}),ce(()=>s.name,async $=>{$==="Home"&&(it(),await lt().loadGlobalProperty(),l.initWorker(),l.postData("SYNC_ALL_DATA"))},{immediate:!0,deep:!0});const C=async()=>{try{const $=U.getUserID(),_=await At.getUserByID($);if(_.location_id!=null){const w=await Mn.getLocation(_.location_id);localStorage.setItem("locationData",JSON.stringify(w))}}catch($){console.error("Failed to retrieve location data:",$)}};return u.value&&(Ml(),C()),ue(async()=>{try{t.value=!0,l.terminate(),it(),await lt().loadGlobalProperty(),_e.isEmpty(c.value)&&await Vn.show(Bn,{},"module-picker-modal")}catch($){console.error("Error initializing component:",$)}finally{t.value=!1}}),($,_)=>{const w=m("ion-spinner"),b=m("ion-content");return d(),V(S(xe),null,{default:i(()=>[t.value?(d(),f("div",Bl,[a(w,{name:"bubbles"}),_[0]||(_[0]=n("div",{class:"loading-text"},"Please wait...",-1))])):k("",!0),a(It),a(Ln),p.value?(d(),V(bn(p.value),{key:1})):(d(),V(b,{key:2},{default:i(()=>[..._[1]||(_[1]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])]),_:1}))]),_:1})}}});export{or as default};

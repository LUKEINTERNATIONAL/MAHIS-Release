var pe=Object.defineProperty;var _e=(i,e,t)=>e in i?pe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var j=(i,e,t)=>_e(i,typeof e!="symbol"?e+"":e,t);import{i as v,D as he,_ as X,ak as h,H as E,u as Z,S as C,z as O,aV as ge,m as ve,E as ye,f as K,P as fe,Q as A,l as be,a0 as De,j as Se,a3 as Fe,b as ee,L as G,G as Te}from"./index-kdr2EpoV.js";import{d as B,W as te,I as ne,G as ie,ac as ae,ab as oe,d2 as re,aa as se,dt as le,D as de,X as U,E as b,e as x,f as k,m as ce,l as c,k as f,z as m,A as T,F as J,c as I,b1 as we,a as Ce,w as W,y as H,u as $,B as F,L as ke,O as Ne,r as w,bV as Ie}from"./vendor-CKGLxZg5.js";import{_ as L}from"./StandardForm.vue_vue_type_script_setup_true_lang-CyskiRBJ.js";import{u as Y}from"./useExposeFromStandardForm-XnUzMZ5A.js";import{g as Be}from"./vaccines_service-CbixEgRR.js";import{R as Pe}from"./relations_service-DCqjFL58.js";const Me=B({components:{IonLabel:de,IonAvatar:le,IonRow:se,IonImg:re,IonCol:oe,IonList:ae,IonItem:ie,IonIcon:ne,IonButton:te,DynamicButton:he},data:()=>({selectedResult:{},iconsContent:v,isAnyAccordionOpen:!0,isLoading:!1}),methods:{dismiss(i){U.dismiss(i)}}}),Re={key:0,class:"spinner-overlay"};function Ee(i,e,t,n,a,s){const r=b("ion-spinner"),p=b("ion-title"),o=b("ion-icon"),l=b("ion-header"),D=b("center"),S=b("ion-content"),_=b("DynamicButton"),P=b("ion-col"),M=b("ion-row"),R=b("ion-footer");return k(),x(J,null,[i.isLoading?(k(),x("div",Re,[c(r,{name:"bubbles"}),e[3]||(e[3]=f("div",{class:"loading-text"},"Please wait...",-1))])):ce("",!0),c(l,{style:{display:"flex","justify-content":"space-between"}},{default:m(()=>[c(p,{class:"modalTitle"},{default:m(()=>e[4]||(e[4]=[T("Printer")])),_:1,__:[4]}),c(o,{onClick:e[0]||(e[0]=g=>i.dismiss("dismiss")),style:{"padding-top":"10px","padding-right":"10px"},icon:i.iconsContent.cancel},null,8,["icon"])]),_:1}),c(S,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:m(()=>[c(D,null,{default:m(()=>e[5]||(e[5]=[f("h3",{class:"ion-padding"},"Do you want to print a barcode?",-1)])),_:1,__:[5]})]),_:1}),c(R,null,{default:m(()=>[c(M,null,{default:m(()=>[c(P,null,{default:m(()=>[c(_,{color:"danger",onClick:e[1]||(e[1]=g=>i.dismiss("dismiss")),name:"No",fill:"solid",style:{float:"right","margin-right":"2%",width:"100px"}}),c(_,{onClick:e[2]||(e[2]=g=>i.dismiss("Yes")),name:"Yes",fill:"solid",style:{float:"right","margin-right":"2%",width:"100px"}})]),_:1})]),_:1})]),_:1})],64)}const Ae=X(Me,[["render",Ee]]),He=()=>{function i(t,n){const a=new Date(t);return a.setFullYear(a.getFullYear()-n),a.toISOString().split("T")[0]}return{personalInformation:I(()=>[{componentType:"Heading",name:"Personal Information",position:"center"},{componentType:"inputField",header:"National ID",name:"nationalID",placeholder:"__-__-__-__",icon:v.nationalID,validation:t=>h.isMWNationalID(t)},{componentType:"inputField",header:"First name",name:"firstname",icon:v.fullName,validation:t=>h.isName(t)},{componentType:"inputField",header:"Middle name",name:"middleName",icon:v.fullName,validation:t=>h.isNamesEmpty(t)},{componentType:"inputField",header:"Last name",name:"lastname",icon:v.fullName,validation:t=>h.isName(t)},{componentType:"radioButtonField",header:"Gender",name:"gender",type:"inline",validation:t=>h.required(t),options:[{label:"Male",value:"M"},{label:"Female",value:"F"}]},{componentType:"dateInputField",header:"Date of birth",name:"birthdate",icon:v.calenderPrimary,minDate:i(E.sessionDate(),110),validation:t=>h.required(t),condition:t=>!t.Estimate,disabled:t=>t.Estimate},{componentType:"inputField",header:"Estimated age",name:"estimation",icon:v.time,validation:t=>h.isEstimationDate(t),initialUnit:"Years",unitOptions:[{label:"Days",value:"Days"},{label:"Months",value:"Months"},{label:"Years",value:"Years"}],unitValidation:t=>!t||t===""?"Please select a unit.":null,condition:t=>t.Estimate},{componentType:"checkboxField",name:"Estimate",type:"single",label:"Estimate age"},{componentType:"phoneInputField",name:"Phone Number",header:"Phone Number",validation:t=>h.isMWPhoneNumber(t.phoneNumber)}])}},pt=B({__name:"PersonalInformation",setup(i,{expose:e}){const t=Z(),{patient:n}=we(t),{personalInformation:a}=He(),{formRef:s,exposeFormMethods:r}=Y();Ce(()=>{p(n.value.personInformation)}),W(()=>n.value.personInformation,o=>{p(o)});const p=o=>{var l,D,S,_;(l=s.value)==null||l.setFormValue("firstname",o==null?void 0:o.given_name),(D=s.value)==null||D.setFormValue("lastname",o==null?void 0:o.family_name),(S=s.value)==null||S.setFormValue("gender",(o==null?void 0:o.gender)=="male"?"M":(o==null?void 0:o.gender)=="female"?"F":""),(_=s.value)==null||_.setFormValue("birthdate",o!=null&&o.birthdate?E.toStandardHisDisplayFormat(o==null?void 0:o.birthdate):"")};return e(r()),(o,l)=>(k(),H(L,{formData:$(a),ref_key:"formRef",ref:s},null,8,["formData"]))}}),Oe=B({components:{IonLabel:de,IonAvatar:le,IonRow:se,IonImg:re,IonCol:oe,IonList:ae,IonItem:ie,IonIcon:ne,IonButton:te},data:()=>({selectedResult:{},iconsContent:v,isAnyAccordionOpen:!0,isLoading:!1}),methods:{updateAccordionState(i){const e=this.$refs.accordionGroup;this.isAnyAccordionOpen=e.value!==void 0},dismiss(i){U.dismiss(i)},async init(){this.setData(this.deduplicationData[0]||{})},async onSelect(){U.dismiss(this.selectedResult)},setData(i){this.selectedResult=i},dateFormat(i){return E.toStandardHisDisplayFormat(i)},probabilityToPercentage(i){return(i*100).toFixed(2)+"%"}},props:{deduplicationData:{default:[]},to_be_registered:{default:[]}},mounted(){this.init()},activated(){this.init()}}),$e={key:0,class:"spinner-overlay"},Le={class:"header position_content"},Ye={style:{"font-size":"1.2em","font-weight":"700"}},Ve={class:"due_date"},Ge={class:"ion-padding",slot:"content"},xe={style:{display:"flex","justify-content":"end",gap:"10px"}};function We(i,e,t,n,a,s){const r=b("ion-spinner"),p=b("ion-icon"),o=b("ion-header"),l=b("ion-label"),D=b("ion-item"),S=b("ion-col"),_=b("ion-row"),P=b("ion-accordion"),M=b("ion-accordion-group"),R=b("ion-content"),g=b("ion-button"),y=b("ion-footer");return k(),x(J,null,[i.isLoading?(k(),x("div",$e,[c(r,{name:"bubbles"}),e[3]||(e[3]=f("div",{class:"loading-text"},"Please wait...",-1))])):ce("",!0),c(o,null,{default:m(()=>[f("div",Le,[f("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=d=>i.dismiss("back"))},[c(p,{slot:"separator",size:"large",icon:i.iconsContent.arrowLeft},null,8,["icon"])]),f("div",Ye,"Matches found: ("+F(i.deduplicationData.length)+")",1)])]),_:1}),c(R,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:m(()=>[c(M,{ref:"accordionGroup",class:"previousView",value:"0",onIonChange:i.updateAccordionState},{default:m(()=>[(k(!0),x(J,null,ke(i.deduplicationData,(d,V)=>(k(),H(P,{style:{"margin-bottom":"15px"},value:V,"toggle-icon-slot":"start",class:"custom_card",button:"",key:V,detail:!0,color:d.value===i.selectedResult.value?"light":"",onClick:u=>i.setData(d)},{default:m(()=>[c(D,{slot:"header"},{default:m(()=>[c(l,{class:"previousLabel"},{default:m(()=>{var u,N;return[T(F((u=d==null?void 0:d.person)==null?void 0:u.given_name)+" "+F((N=d==null?void 0:d.person)==null?void 0:N.family_name),1)]}),_:2},1024),f("div",Ve,[e[4]||(e[4]=T(" Score: ")),f("b",null,F(i.probabilityToPercentage(d==null?void 0:d.score)||"-"),1)])]),_:2},1024),f("div",Ge,[c(_,null,{default:m(()=>[c(S,null,{default:m(()=>e[5]||(e[5]=[f("b",null,"To be Registered",-1)])),_:1,__:[5]}),c(S,null,{default:m(()=>e[6]||(e[6]=[f("b",null,"Already Registered",-1)])),_:1,__:[6]})]),_:1}),c(_,null,{default:m(()=>[c(S,null,{default:m(()=>[c(_,null,{default:m(()=>{var u,N;return[e[7]||(e[7]=T(" Name: ")),f("b",null,F((u=i.to_be_registered)==null?void 0:u.given_name)+" "+F((N=i.to_be_registered)==null?void 0:N.family_name),1)]}),_:1,__:[7]}),c(_,null,{default:m(()=>{var u;return[e[8]||(e[8]=T("Gender: ")),f("b",null,F((u=i.to_be_registered)==null?void 0:u.gender),1)]}),_:1,__:[8]}),c(_,null,{default:m(()=>{var u;return[e[9]||(e[9]=T("Birthdate: ")),f("b",null,F((u=i.to_be_registered)==null?void 0:u.birthdate),1)]}),_:1,__:[9]}),c(_,null,{default:m(()=>{var u;return[e[10]||(e[10]=T("Home District: ")),f("b",null,F((u=i.to_be_registered)==null?void 0:u.home_district),1)]}),_:1,__:[10]}),c(_,null,{default:m(()=>{var u;return[e[11]||(e[11]=T("Home TA: ")),f("b",null,F((u=i.to_be_registered)==null?void 0:u.home_traditional_authority),1)]}),_:1,__:[11]})]),_:1}),c(S,null,{default:m(()=>[c(_,null,{default:m(()=>{var u,N;return[e[12]||(e[12]=T(" Name: ")),f("b",null,F((u=d==null?void 0:d.person)==null?void 0:u.given_name)+" "+F((N=d==null?void 0:d.person)==null?void 0:N.family_name),1)]}),_:2,__:[12]},1024),c(_,null,{default:m(()=>{var u;return[e[13]||(e[13]=T("Gender: ")),f("b",null,F((u=d==null?void 0:d.person)==null?void 0:u.gender),1)]}),_:2,__:[13]},1024),c(_,null,{default:m(()=>{var u;return[e[14]||(e[14]=T("Birthdate: ")),f("b",null,F(i.dateFormat((u=d==null?void 0:d.person)==null?void 0:u.birthdate)),1)]}),_:2,__:[14]},1024),c(_,null,{default:m(()=>{var u;return[e[15]||(e[15]=T("Home District: ")),f("b",null,F((u=d==null?void 0:d.person)==null?void 0:u.home_district),1)]}),_:2,__:[15]},1024),c(_,null,{default:m(()=>{var u;return[e[16]||(e[16]=T("Home TA: ")),f("b",null,F((u=d==null?void 0:d.person)==null?void 0:u.home_traditional_authority),1)]}),_:2,__:[16]},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["value","color","onClick"]))),128))]),_:1},8,["onIonChange"])]),_:1}),c(y,{collapse:"fade",class:"ion-no-border"},{default:m(()=>[f("div",xe,[c(g,{fill:"solid",color:"secondary",onClick:e[1]||(e[1]=d=>i.dismiss("dismiss"))},{default:m(()=>e[17]||(e[17]=[T(" Not Duplicate ")])),_:1,__:[17]}),c(g,{onClick:e[2]||(e[2]=d=>i.onSelect()),fill:"solid",disabled:!i.isAnyAccordionOpen},{default:m(()=>e[18]||(e[18]=[T("Select ")])),_:1,__:[18]},8,["disabled"])])]),_:1})],64)}const qe=X(Oe,[["render",We],["__scopeId","data-v-ffb46cdd"]]),Ue=ve();class q{async getDDEIds(){const e=C.getUseIndexDBStatus(),t=C.getModsStatus(),n=C.getAPIStatus();if(e)return await O("dde");if(t){const a=await ge();return(a==null?void 0:a.npid)||[]}if(n)try{const a=await C.getJson("/dde/patients/sync_npids",{count:1,program_id:C.getProgramID()});return(a==null?void 0:a.npids)||[]}catch(a){return[]}return[]}async updateDDEIds(e){e=e.slice(1),Ue.postData("OVERRIDE_OBJECT_STORE",{storeName:"dde",data:e})}async possibleDuplicates(e){var t;try{const n=new ye,a=await n.checkPotentialDuplicates(e);if(a.length>0){const s=await K(qe,{class:"fullScreenModal"},!0,{to_be_registered:e,deduplicationData:a});if(s!="dismiss"&&s!="back"){const r=await n.importPatient((t=s==null?void 0:s.person)==null?void 0:t.id),p=await fe.findByID(r.patient_id);return await Z().setPatientRecord(p),!0}else if(s=="back")return!0;return!1}else return!1}catch(n){return!1}}}class Je{getRegion(e){return{1:"Central Region",2:"Northern Region",3:"Southern Region",4:"Foreign"}[e]}hasValidData(e,t=[]){return!e||typeof e!="object"?!1:t.length===0?Object.values(e).some(n=>n!=null&&n!==""):t.every(n=>e[n]!==null&&e[n]!==void 0&&e[n]!=="")}async buildObservation(e,t){if(!t)return null;const n=typeof t=="object"&&t.name?t.name:t;return await A.buildValueText(e,n)}buildGuardianInfo(e){const t={};return t.given_name=(e==null?void 0:e.guardianFirstname)||"",t.middle_name=(e==null?void 0:e.guardianMiddleName)||"",t.family_name=(e==null?void 0:e.guardianLastname)||"",t.cell_phone_number=(e==null?void 0:e.guardianPhoneNumber.phoneNumber)||"",t.national_id=(e==null?void 0:e.guardianNationalID)||"",t.gender="",t.birthdate="",t.birthdate_estimated="false",t.home_region="",t.home_district="",t.home_traditional_authority="",t.home_village="",t.current_region="",t.current_district="",t.current_traditional_authority="",t.current_village="",t.landmark="",{saved:[],unsaved:[t]}}async buildVitals(e){return e!=null&&e.Weight?{saved:[],unsaved:[await this.buildObservation("Weight",e.Weight)]}:null}async buildARTPatientType(e,t){const n=[];let a=[];return e&&n.push(await A.buildValueText("Art clinic location",e)),t&&n.push(await A.buildValueCoded("Type of patient",t)),n.length===0?[]:(a=[{encounter_type:"REGISTRATION",status:"unsaved",obs:n}],a)}async buildBirthRegistrationObservations(e){if(!this.hasValidData(e))return null;const n=(await Promise.all([this.buildObservation("How many doses of Tdv did the mother receive?",e["How many doses of Tdv did the mother receive?"]),this.buildObservation("Protected at birth",e["Protected at birth"]),this.buildObservation("HIV status",e["HIV status"])])).filter(a=>a!==null);return n.length>0?n:null}async buildPatientRecord(e,t){var D,S,_,P,M,R,g,y,d,V,u,N,z;const{personalInformation:n,currentLocation:a,homeLocation:s,birthRegistration:r,guardianInformation:p,socialHistory:o,patientType:l}=e;return{patientID:t,ID:t,NcdID:"",personInformation:{given_name:(n==null?void 0:n.firstname)||"",middle_name:(n==null?void 0:n.middleName)||"",family_name:(n==null?void 0:n.lastname)||"",gender:(n==null?void 0:n.gender)||"",birthdate:n!=null&&n.Estimate?new ue().calculateDoB(n==null?void 0:n.estimation,(n==null?void 0:n.estimation_unit)||"Years"):(n==null?void 0:n.birthdate)||"",birthdate_estimated:n!=null&&n.Estimate?"true":"false",home_region:this.getRegion((D=s==null?void 0:s.home_district)==null?void 0:D.region_id)||"",home_district:((S=s==null?void 0:s.home_district)==null?void 0:S.name)||"",home_traditional_authority:((_=s==null?void 0:s.home_traditional_authority)==null?void 0:_.name)||"",home_village:((P=s==null?void 0:s.home_village)==null?void 0:P.name)||"",current_region:this.getRegion((M=a==null?void 0:a.current_district)==null?void 0:M.region_id)||"",current_district:((R=a==null?void 0:a.current_district)==null?void 0:R.name)||"",current_traditional_authority:((g=a==null?void 0:a.current_traditional_authority)==null?void 0:g.name)||"",current_village:((y=a==null?void 0:a.current_village)==null?void 0:y.name)||"",country:(e==null?void 0:e.country.country.name)||"",landmark:((d=a==null?void 0:a.closestLandmark)==null?void 0:d.name)||"",cell_phone_number:((V=n["Phone Number"])==null?void 0:V.phoneNumber)||"",occupation:(o==null?void 0:o.occupation)||"",marital_status:(o==null?void 0:o.maritalStatus)||"",religion:((u=o==null?void 0:o.religion)==null?void 0:u.name)||"",education_level:(o==null?void 0:o.highestLevelOfEducation)||""},guardianInformation:this.buildGuardianInfo(p),birthRegistration:await this.buildBirthRegistrationObservations(r),otherPersonInformation:{nationalID:(n==null?void 0:n.nationalID)||"",ichisID:C.getIchisId()||"",TEI:C.getTEI()||"",birthID:r["Serial Number"]||"",relationshipID:((N=p==null?void 0:p.relationship)==null?void 0:N.id)||""},vitals:await this.buildVitals(r),vaccineSchedule:await Be(n==null?void 0:n.gender,n==null?void 0:n.birthdate),vaccineAdministration:{orders:[],obs:[],voided:[]},observations:await this.buildARTPatientType((z=l==null?void 0:l.facility)==null?void 0:z.name,l==null?void 0:l.patient_type),appointments:{saved:[],unsaved:[]},saveStatusPersonInformation:"pending",saveStatusGuardianInformation:"pending",saveStatusBirthRegistration:"pending",saveStatusVitals:"pending",date_created:"",creator:"",sync_status:"unsynced"}}}const ze=async i=>{const e=C.getIchisDiagnosis();if(e.length<=0)return;const t=await Promise.all(e.map(async n=>{var r,p,o;const a=((p=(r=n==null?void 0:n.value)==null?void 0:r.match(/[\d.]+/))==null?void 0:p[0])||"",s=n==null?void 0:n.date;if(n.display=="NCD_CV_D_Likelihood of Diabetes"){const l=(o=n==null?void 0:n.id)==null?void 0:o.split("-");return await A.buildValueNumber("Unspecified Diabetes",a,null,null,s,l[1])}if(n.display=="NCD_SHD_CV_Client waist circumference")return await A.buildValueNumber("Waist circumference",a,null,null,s);if(n.display=="NCD_SHD_CV_Client systolic blood pressure")return await A.buildValueNumber("Systolic blood pressure",a,null,null,s);if(n.display=="NCD_SHD_CV_Client diastolic blood pressure")return await A.buildValueNumber("Diastolic blood pressure",a,null,null,s)}));return i.observations.push({encounter_type:"VITALS",status:"unsaved",obs:t}),i};class ue extends C{constructor(){super();j(this,"patientRecordBuilder");this.patientRecordBuilder=new Je}async saveRegistrationData(t){var r;const n=await new q().getDDEIds();if(n.length<=0&&be("DDE IDs are not available."),n.length<=0&&!C.getAPIStatus())return!1;const a=await this.patientRecordBuilder.buildPatientRecord(t,(r=n[0])==null?void 0:r.npid);if(C.getAPIStatus()&&!C.getModsStatus()&&await new q().possibleDuplicates(a.personInformation))return!0;const s=await ze(a);return console.log("🚀 ~ RegistrationService ~ saveRegistrationData ~ patientRecordData:",s),await De(s)?(Se("Registration successful"),C.getUseIndexDBStatus()&&await new q().updateDDEIds(n),await this.printBarcode(),!0):!1}checkIfChild(t){if(!(t!=null&&t.estimation)&&!(t!=null&&t.birthdate))return{moreThanThirteenYears:!0,underNineMonths:!1,underFiveYears:!1};let n="";return t.estimation?n=this.calculateDoB(t.estimation,t.estimation_unit||"Years")||"":n=t.birthdate,{moreThanThirteenYears:E.getAgeInYears(n)>13,underNineMonths:E.ageInMonths(n)<9,underFiveYears:E.getAgeInYears(n)<5}}async printBarcode(){await K(Ae,{class:"small-confirm-modal "})!=="dismiss"&&new Fe().printData("barcode")}calculateDoB(t,n){try{let a=Ne(C.getSessionDate());if(n==="Years"&&t<0)a=a.add(Math.abs(t),"years");else switch(n){case"Days":a=a.subtract(t,"days");break;case"Months":a=a.subtract(t,"months");break;case"Years":a=a.subtract(t,"years");break;default:return null}return E.toStandardHisDisplayFormat(a.format("YYYY-MM-DD"))||""}catch(a){return console.error("Error calculating date:",a),null}}}function je(){const i=w([]),e=w([]),t=w([]),n=ee();Ie();const a=I(()=>n.apiStatus),s=p=>{var S;const o=["Brother","Father","Son","Grandfather","Grandson","Boyfriend","Stepfather","Stepson"],l=["Sister","Mother","Daughter","Grandmother","Granddaughter","Girlfriend","Stepmother","Stepdaughter"],D=["Spouse/Partner","Aunt/Uncle","Niece/Nephew","Doctor","Other","Patient","TB Contact Person","TB Patient","treatment suporter"];((S=e.value)==null?void 0:S.length)>0&&(t.value=e.value.filter(_=>p==="M"?o.includes(_.a_is_to_b)||D.includes(_.a_is_to_b):p==="F"?l.includes(_.a_is_to_b)||D.includes(_.a_is_to_b):!1))};return{relationships:i,relationshipsData:e,filteredRelationships:t,apiStatus:a,getRelationships:async p=>{var o;if(p)return e.value=await O("relationship"),a.value&&e.value.length!==((o=n.offlineRelationshipStatus)==null?void 0:o.total)&&(e.value=await Pe.getRelations()),s(p),i.value=i.value=t.value.map(l=>[{name:l.b_is_to_a,id:l.relationship_type_id,trackByID:l.relationship_type_id+l.b_is_to_a}]).reduce((l,D)=>l.concat(D),[]),i.value},filterRelationships:s}}const Qe=(i,e)=>{const t=I(()=>new ue().checkIfChild(i.value).moreThanThirteenYears),{getRelationships:n}=je(),a=w();return W(i,async r=>{r&&(a.value=await n(r.gender))}),{guardianInformation:I(()=>[{componentType:"Heading",name:"Guardian Information",position:"center"},{componentType:"inputField",header:"Guardian National ID",name:"guardianNationalID",placeholder:"__-__-__-__",icon:v.nationalID,validation:r=>h.isMWNationalID(r)},{componentType:"inputField",header:"First name",name:"guardianFirstname",icon:v.fullName,validation:r=>t.value?h.isNameEmpty(r):h.isName(r)},{componentType:"inputField",header:"Middle name",name:"guardianMiddleName",icon:v.fullName,validation:r=>h.isNameEmpty(r)},{componentType:"inputField",header:"Last name",name:"guardianLastname",icon:v.fullName,validation:r=>t.value?h.isNameEmpty(r):h.isName(r)},{componentType:"phoneInputField",name:"guardianPhoneNumber",header:"Phone Number",validation:r=>h.isMWPhoneNumber(r.phoneNumber)},{componentType:"multiSelectInputField",header:"Relationship to patient",name:"relationship",trackBy:"trackByID",icon:v.search,validation:r=>t.value?null:h.required(r==null?void 0:r.name),options:()=>a.value,disabled:()=>!a.value}])}},_t=B({__name:"GuardianInformation",props:{personalInformationFormValues:{}},setup(i,{expose:e}){const{formRef:t,exposeFormMethods:n}=Y(),a=i,s=I(()=>a.personalInformationFormValues),{guardianInformation:r}=Qe(s);return e(n()),(p,o)=>(k(),H(L,{formData:$(r),ref_key:"formRef",ref:t},null,8,["formData"]))}});function me(){const i=w([]),e=w([]),t=w([]),n=w([]),a=w([]),s=w([]),r=w(null),p=w(null),o=w(!1),l=ee(),D=I(()=>l.apiStatus);W(r,async g=>{if(g)try{e.value=await _(g)}catch(y){e.value=[]}else e.value=[]}),W(p,async g=>{if(g)try{t.value=await S(g)}catch(y){t.value=[]}else t.value=[]});const S=async g=>{try{const y=await O("villages",{whereClause:{traditional_authority_id:g}});return y.length>0?y:D.value?await G.getVillages(g):[]}catch(y){return console.error("Error getting villages:",y),[]}},_=async g=>{try{const y=await O("TAs",{whereClause:{district_id:g}});return y.length>0?y:D.value?await G.getTraditionalAuthorities(g):[]}catch(y){return console.error("Error getting TAs:",y),[]}};return{districtList:i,countriesList:n,locations:s,isLoading:o,selectedDistrictId:r,TAs:e,villages:t,selectedTraditionalAuthorityId:p,facilityList:a,apiStatus:D,getVillages:S,getTAs:_,getDistricts:async()=>{var g;o.value=!0;try{if(i.value=await O("districts"),D.value&&i.value.length!==((g=l.offlineDistrictStatus)==null?void 0:g.total))for(let y of[1,2,3]){const d=await G.getDistricts(y);i.value.push(...d)}return i.value}catch(y){console.error("Error loading location data:",y)}finally{o.value=!1}},getCountries:async()=>{var g;o.value=!0;try{return n.value=await O("countries"),D.value&&n.value.length!==((g=l.offlineCountriesStatus)==null?void 0:g.total)&&(n.value=await G.getDistricts(4)),n.value}catch(y){console.error("Error loading location data:",y)}finally{o.value=!1}},getFacilities:async()=>{a.value=await G.getAllFacilities()}}}const Xe=(i,e)=>{if(!(i!=null&&i.value)||!(e!=null&&e.value))return;const{current_district:t,current_traditional_authority:n,current_village:a}=i.value;e.value.setFormValue("home_district",t),e.value.setFormValue("home_traditional_authority",n),e.value.setFormValue("home_village",a)},Ze=i=>{i!=null&&i.value&&(i.value.setFormValue("home_district",[]),i.value.setFormValue("home_traditional_authority",[]),i.value.setFormValue("home_village",[]))},Ke=(i,e,t)=>{e.value=(i==null?void 0:i.district_id)||null,t!=null&&t.value&&(t.value.setFormValue("home_traditional_authority",[]),t.value.setFormValue("home_village",[]))},et=(i,e,t)=>{var n;e.value=(i==null?void 0:i.traditional_authority_id)||null,(n=t==null?void 0:t.value)==null||n.setFormValue("home_village",[])},Q=(i,e)=>i!=null&&i.same_as_current?!1:!(e!=null&&e.length),tt=(i,e)=>t=>{setTimeout(()=>{t?Xe(i,e):Ze(e)},0)},nt=(i,e)=>{const{getDistricts:t,districtList:n,selectedTraditionalAuthorityId:a,villages:s,selectedDistrictId:r,TAs:p}=me();return t(),{homeLocation:I(()=>[{componentType:"Heading",name:"Home Location",position:"center"},{componentType:"checkboxField",type:"single",name:"same_as_current",label:"Same as current",onChange:tt(i,e)},{componentType:"multiSelectInputField",header:"Home district",name:"home_district",trackBy:"district_id",icon:v.search,validation:h.required,options:n.value,onChange:l=>Ke(l,r,e)},{componentType:"multiSelectInputField",header:"Home traditional authority",name:"home_traditional_authority",trackBy:"traditional_authority_id",validation:h.required,icon:v.search,options:p.value,disabled:l=>Q(l,p.value),onChange:l=>et(l,a,e),openDirection:"auto"},{componentType:"multiSelectInputField",header:"Home village",name:"home_village",trackBy:"village_id",icon:v.search,validation:h.required,options:s.value,disabled:l=>Q(l,s.value),openDirection:"auto"}])}},ht=B({__name:"HomeLocation",props:{currentLocationFormValues:{}},setup(i,{expose:e}){const t=i,{formRef:n,exposeFormMethods:a}=Y(),s=I(()=>t.currentLocationFormValues),{homeLocation:r}=nt(s,n);return e(a()),(p,o)=>(k(),H(L,{formData:$(r),ref_key:"formRef",ref:n},null,8,["formData"]))}}),it=()=>{const i=w(!1),{getDistricts:e,districtList:t,selectedTraditionalAuthorityId:n,villages:a,selectedDistrictId:s,TAs:r}=me();return e(),{currentLocation:I(()=>[{componentType:"Heading",name:"Current Location",position:"center"},{componentType:"multiSelectInputField",header:"Current district",name:"current_district",trackBy:"district_id",validation:o=>h.required(o),icon:v.search,options:t.value,onChange:(o,l)=>{s.value=(o==null?void 0:o.district_id)||null}},{componentType:"multiSelectInputField",header:"Current traditional authority",name:"current_traditional_authority",trackBy:"traditional_authority_id",validation:o=>h.required(o),icon:v.search,options:r.value,disabled:o=>{var l;return!((l=r==null?void 0:r.value)!=null&&l.length)},onChange:(o,l)=>{n.value=(o==null?void 0:o.traditional_authority_id)||null}},{componentType:"multiSelectInputField",header:"Current village",name:"current_village",trackBy:"village_id",icon:v.search,validation:o=>h.required(o),options:a.value,disabled:o=>{var l;return!((l=a==null?void 0:a.value)!=null&&l.length)}},{componentType:"multiSelectInputField",header:"Closest landmark/Plot number",name:"closestLandmark",trackBy:"id",icon:v.search,options:[{id:1,name:"Church"},{id:2,name:"Mosque"},{id:3,name:"Primary School"},{id:4,name:"Borehole"},{id:5,name:"Secondary School"},{id:6,name:"College"},{id:7,name:"Market"},{id:8,name:"Football Ground"},{id:9,name:"Other"}]}]),TAs:r,isLoadingTAs:i,selectedDistrictId:s}},gt=B({__name:"CurrentLocation",setup(i,{expose:e}){const{currentLocation:t}=it(),{formRef:n,exposeFormMethods:a}=Y();return e(a()),(s,r)=>(k(),H(L,{formData:$(t),ref_key:"formRef",ref:n},null,8,["formData"]))}}),at=()=>{const i=w();return Te.isProp("military_site=true").then(t=>{i.value=t}),{socialHistory:I(()=>[{componentType:"Heading",name:"Social History",position:"center"},{componentType:"multiSelectInputField",header:"Religion",name:"religion",icon:v.search,trackBy:"id",options:[{id:1,name:"Christianity"},{id:2,name:"Islam"},{id:3,name:"Judaism"},{id:4,name:"Hinduism"},{id:5,name:"Buddhism"},{id:6,name:"Sikhism"},{id:7,name:"Jainism"},{id:8,name:"Bahá'í Faith"},{id:9,name:"Zoroastrianism"},{id:10,name:"Confucianism"},{id:11,name:"Taoism"},{id:12,name:"Shinto"},{id:13,name:"Baha'i Faith"},{id:14,name:"Juche"},{id:15,name:"Rastafari"}]},{componentType:"radioButtonField",header:"Occupation status",name:"occupation",type:"inline",validation:h.required,condition:()=>C.getProgramID()==1&&i.value,options:[{label:"Military",value:"Military"},{label:"Civilian",value:"Civilian"}]},{componentType:"radioButtonField",header:"Occupation status",name:"occupation",type:"inline",condition:t=>!i,options:[{label:"Employed",value:"employed"},{label:"Student",value:"Student"},{label:"Unemployed",value:"unemployed"},{label:"Other",value:"Other"}]},{componentType:"radioButtonField",header:"Marital status",name:"maritalStatus",type:"inline",options:[{label:"Single",value:"single"},{label:"Married",value:"married"},{label:"Widow",value:"widow"},{label:"Widower",value:"widower"},{label:"Divorced",value:"divorced"}]},{componentType:"radioButtonField",header:"Highest level of education",name:"highestLevelOfEducation",type:"inline",options:[{label:"No education",value:"No education"},{label:"Primary school",value:"primary school"},{label:"Secondary school",value:"secondary school"},{label:"Tertiary education",value:"tertiary education"}]}])}},vt=B({__name:"SocialHistory",setup(i,{expose:e}){const{socialHistory:t}=at(),{formRef:n,exposeFormMethods:a}=Y();return e(a()),(s,r)=>(k(),H(L,{formData:$(t),ref_key:"formRef",ref:n},null,8,["formData"]))}}),ot=i=>({birthRegistration:I(()=>[{componentType:"Heading",name:"Birth Registration",position:"center"},{componentType:"inputField",header:"Birth certificate number",name:"Serial Number",icon:v.nationalID,placeholder:"__-__-__-__"},{componentType:"inputField",header:"Birth Weight/First weight (kg)",name:"Weight",icon:v.weight,validation:t=>h.validateWeight(t)},{componentType:"multiSelectInputField",header:"How many doses of Tdv did the mother receive?",name:"How many doses of Tdv did the mother receive?",icon:v.search,options:[{concept_id:11997,name:"0-2 doses, less than two weeks before delivery"},{concept_id:11998,name:"2-5 doses more than two weeks of delivery"},{concept_id:1067,name:"Unknown"}],trackBy:"concept_id",validation:t=>h.required(t),onChange:t=>{const n=t==null?void 0:t.name;n=="Unknown"?i.value.setFormValue("Protected at birth",{concept_id:1067,name:"Don't know"}):n=="0-2 doses, less than two weeks before delivery"?i.value.setFormValue("Protected at birth",{concept_id:1066,name:"No"}):n=="2-5 doses more than two weeks of delivery"&&i.value.setFormValue("Protected at birth",{concept_id:1065,name:"Yes"})}},{componentType:"multiSelectInputField",header:"Protected at birth (PAB)",name:"Protected at birth",icon:v.search,trackBy:"concept_id",validation:t=>h.required(t),disabled:t=>!t["How many doses of Tdv did the mother receive?"]},{componentType:"multiSelectInputField",header:"HIV status of the Child's Mother",name:"HIV status",icon:v.search,options:[{id:703,name:"Positive"},{id:664,name:"Negative"},{id:1067,name:"Unknown"}],trackBy:"id",validation:t=>h.required(t)}])}),yt=B({__name:"BirthRegistration",setup(i,{expose:e}){const{formRef:t,exposeFormMethods:n}=Y(),{birthRegistration:a}=ot(t);return e(n()),(s,r)=>(k(),H(L,{formData:$(a),ref_key:"formRef",ref:t},null,8,["formData"]))}});export{Ae as C,ue as R,ht as _,gt as a,_t as b,pt as c,vt as d,yt as e,me as u};

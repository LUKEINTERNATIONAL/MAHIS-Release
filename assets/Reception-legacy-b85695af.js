!function(){function e(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var l=t.call(e,a||"default");if("object"!=typeof l)return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}System.register(["./vendor-legacy-b155b5ab.js","./index-legacy-d7d54202.js","./patient_type_service-legacy-b819f082.js","./lodash-legacy-78c9f2a0.js","./apexcharts-legacy-d546c9db.js","./chartjs-legacy-11371d29.js","./barcode-qrcode-reader-legacy-b9a6bf31.js"],(function(a,t){"use strict";var l,r,i,o,n,d,s,u,p,c,v,m,f,g,b,x,h,y,_,w,k,N,C,I,S,V,q,P,j,R,D,z,A,F,T,U,G,Y,$,O,E,L,M,H,J,B,Q,W,K,X,Z,ee,ae,te,le;return{setters:[e=>{l=e.d,r=e.aQ,i=e.r,o=e.c,n=e.w,d=e.E,s=e.e,u=e.y,p=e.z,c=e.l,v=e.x,m=e.U,f=e.R,g=e.S,b=e.A,x=e.V,h=e.aa,y=e.j,_=e.G,w=e.b7,k=e.I,N=e.cx,C=e.bb,I=e.ap,S=e.f,V=e.F,q=e.J,P=e.B,j=e.m,R=e.be,D=e.aL,z=e.aM,A=e.D,F=e.bj,T=e.p,U=e.bm,G=e.b0,Y=e.d1,$=e.d2,O=e.i,E=e.bc},e=>{L=e.A,M=e.f,H=e.u,J=e.B,B=e.d,Q=e.a,W=e.t,K=e.R,X=e.b,Z=e.g,ee=e._,ae=e.h,te=e.S},e=>{le=e.P},null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent='.search-loading[data-v-473b61c5]{padding:16px;text-align:center;color:#666}.search-results[data-v-473b61c5]{max-height:500px;overflow-y:auto;border:1px solid #e0e0e0;border-radius:8px;margin-top:8px;transition:all .3s ease}.no-results[data-v-473b61c5]{padding:16px;text-align:center;color:#666}.no-results-content[data-v-473b61c5]{display:flex;flex-direction:column;align-items:center;gap:8px}.pagination-button[data-v-473b61c5]{background:#f8f9fa;border:1px solid #ddd;border-radius:4px;padding:8px 16px;cursor:pointer;margin:0 8px}.pagination-button[data-v-473b61c5]:disabled{opacity:.5;cursor:not-allowed}.page-info[data-v-473b61c5]{font-size:.9rem;color:#555}.reception-form[data-v-473b61c5]{margin-bottom:7px}.form-section[data-v-473b61c5]{margin-bottom:20px}.form-row[data-v-473b61c5]{display:flex;flex-wrap:wrap;margin-bottom:15px;gap:20px}.form-group[data-v-473b61c5]{flex:1;min-width:200px}.form-group label[data-v-473b61c5]{display:block;margin-bottom:5px;font-weight:500;color:#333}.required[data-v-473b61c5]{color:red}ion-modal[data-v-473b61c5]{--width: 90%;--max-width: 700px;--height: 50%;--border-radius: 4px}.modal-title[data-v-473b61c5]{font-size:1.3rem;font-weight:500;padding-left:15px}.close-button[data-v-473b61c5]{--color: var(--ion-color-primary)}.modal-content[data-v-473b61c5]{padding:16px}.section-header ion-label[data-v-473b61c5]{font-size:1rem;font-weight:600;letter-spacing:.5px;color:var(--ion-color-primary);text-transform:uppercase}.save-button[data-v-473b61c5]{--padding-top: 16px;--padding-bottom: 16px;font-weight:500;width:20%;margin-top:100px}ion-input[data-v-473b61c5]::part(label),ion-select[data-v-473b61c5]::part(label){font-weight:600}.form-container[data-v-473b61c5]{background:white;border-radius:4px;padding:2px;height:100%}.form-grid[data-v-473b61c5]{padding:0}.form-row[data-v-473b61c5]{margin-bottom:10px}.form-column[data-v-473b61c5]{padding:0 5px}.input-container[data-v-473b61c5]{margin-bottom:16px}.save-button[data-v-473b61c5]{--border-radius: 3px;--padding-top: 12px;--padding-bottom: 12px;--background: #d4edda;margin-top:20px;margin-left:auto;font-weight:500;width:fit-content;display:block;color:#006400;height:40px}.search-section[data-v-473b61c5]{margin-bottom:20px;transition:all .3s ease}.search-results[data-v-473b61c5]{max-height:200px;overflow-y:auto;border:1px solid #e0e0e0;border-radius:8px;margin-top:8px;transition:all .3s ease}.search-item ion-button[data-v-473b61c5]{--padding-start: 8px;--padding-end: 8px;margin:0}.search-item ion-button ion-icon[data-v-473b61c5]{font-size:25px;margin:0 2px}.no-results[data-v-473b61c5]{display:flex;justify-content:center;align-items:center;padding:10px}.no-results-content[data-v-473b61c5]{display:flex;align-items:center;gap:8px}.no-results p[data-v-473b61c5]{margin:0;color:#666}.no-results ion-button[data-v-473b61c5]{--padding-start: 0;--padding-end: 0;margin:0}.result-item[data-v-473b61c5]{padding:12px;border-bottom:1px solid #eee;cursor:pointer;transition:background-color .2s}.result-item[data-v-473b61c5]:last-child{border-bottom:none}.create-form-section[data-v-473b61c5]{margin-top:20px;animation:fadeIn-473b61c5 .3s ease}@keyframes fadeIn-473b61c5{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.form-row[data-v-473b61c5]{margin-bottom:15px}ion-segment-button[data-v-473b61c5]{--color: #495057;--color-checked: #fff;--background-checked: #d4edda;--background: #f3f0f0;--indicator-color: transparent;--border-radius: 4px;--padding-top: 6px;--padding-bottom: 8px;--padding-right: 100px;--margin-start: 10px;--margin-end: 10px;min-width:50px;font-size:.7rem;font-weight:600;margin:0 2px}.required[data-v-473b61c5]{color:#dc3545}@media (max-width: 768px){.pagination[data-v-473b61c5]{display:flex;justify-content:center;align-items:center;gap:16px;margin-top:16px;padding:12px}.pagination-button[data-v-473b61c5]{background:#f8f9fa;border:1px solid #ddd;border-radius:4px;padding:8px 16px;cursor:pointer;transition:all .2s}.pagination-button[data-v-473b61c5]:hover:not(:disabled){background:#e9ecef}.pagination-button[data-v-473b61c5]:disabled{opacity:.5;cursor:not-allowed}.page-info[data-v-473b61c5]{font-size:.9rem;color:#555}}.error-label[data-v-473b61c5]{color:#b42318;text-transform:none;padding:1% 3%;margin-top:2px;display:flex;text-align:center}.new-tag[data-v-473b61c5]{color:#666;font-style:italic;font-size:.8em}.search-results[data-v-473b61c5]{max-height:300px;overflow-y:auto;border:1px solid #e0e0e0;border-radius:8px;margin-top:8px}.result-item[data-v-473b61c5]{padding:12px;border-bottom:1px solid #eee;cursor:pointer;transition:background-color .2s;display:flex;justify-content:space-between}.result-item[data-v-473b61c5]:hover{background-color:#f5f5f5}.pagination[data-v-473b61c5]{display:flex;justify-content:center;align-items:center;padding:12px;border-top:1px solid #eee}.reception-form[data-v-059adf22]{margin-bottom:7px}.form-section[data-v-059adf22]{margin-bottom:20px}.form-row[data-v-059adf22]{display:flex;flex-wrap:wrap;margin-bottom:15px;gap:20px}.form-group[data-v-059adf22]{flex:1;min-width:200px}.form-group label[data-v-059adf22]{display:block;margin-bottom:5px;font-weight:500;color:#333}.required[data-v-059adf22]{color:red}.form-control[data-v-059adf22]{width:100%;padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px}.input-group[data-v-059adf22]{display:flex;align-items:center}.input-group .form-control[data-v-059adf22]{border-top-right-radius:0;border-bottom-right-radius:0;flex:1}.input-group-text[data-v-059adf22]{padding:8px 12px;background-color:#f5f5f5;border:1px solid #ddd;border-left:none;border-top-right-radius:4px;border-bottom-right-radius:4px;color:#555}.form-footer[data-v-059adf22]{display:flex;justify-content:flex-start;margin-top:20px}ion-modal[data-v-059adf22]{--width: 90%;--max-width: 700px;--height: 50%;--border-radius: 4px}.section-header ion-label[data-v-059adf22]{font-size:1rem;font-weight:600;letter-spacing:.5px;color:var(--ion-color-primary);text-transform:uppercase}ion-input[data-v-059adf22]::part(label),ion-select[data-v-059adf22]::part(label){font-weight:600}.form-row[data-v-059adf22]{margin-bottom:10px}.no-results p[data-v-059adf22]{margin:0;color:#666}.no-results ion-button[data-v-059adf22]{--padding-start: 0;--padding-end: 0;margin:0}@keyframes fadeIn-059adf22{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.label-title[data-v-059adf22]{font-weight:700;font-size:1rem;color:#555}.form-row[data-v-059adf22]{margin-bottom:15px}.segment-group[data-v-059adf22]{display:flex;align-items:center;background-color:#f8f9fa;padding:12px 16px;border-radius:4px;gap:15px;position:relative}.segment-group[data-v-059adf22]:after{content:"";flex:0 0 30%;min-width:300px;visibility:hidden}.segment-label-container[data-v-059adf22]{min-width:300px;font-weight:800;flex:0 40% 0}ion-segment-button[data-v-059adf22]{--color: #495057;--color-checked: #fff;--background-checked: #d4edda;--background: #f3f0f0;--indicator-color: transparent;--border-radius: 4px;--padding-top: 6px;--padding-bottom: 8px;--padding-right: 100px;--margin-start: 10px;--margin-end: 10px;min-width:50px;font-size:.7rem;font-weight:600;margin:0 2px}.label-title[data-v-059adf22]{margin:0;color:gray;font-size:17px;font-weight:600}.required[data-v-059adf22]{color:#dc3545}@media (max-width: 576px){.segment-group[data-v-059adf22]{flex-direction:column;align-items:flex-start;gap:8px}.custom-segment[data-v-059adf22]{width:50%;height:20%;padding:0 4px}}.segment-group[data-v-059adf22]{display:flex;align-items:center;width:100%}.segment-label-container[data-v-059adf22]{width:40%;min-width:200px}.arv-input-container[data-v-059adf22]{width:100%}.arv-input-container .input-group[data-v-059adf22]{width:100%;height:45px}.arv-input-container .form-control[data-v-059adf22]{height:100%;border-radius:2px 0 0 2px}.arv-input-container .input-group-text[data-v-059adf22]{height:100%;border-radius:0 4px 4px 0;padding:0 16px}@media (max-width: 768px){.segment-group[data-v-059adf22]{flex-direction:column;align-items:flex-start}.segment-group[data-v-059adf22]:after{display:none}.segment-label-container[data-v-059adf22]{width:100%;margin-bottom:8px}.arv-input-container[data-v-059adf22]{margin-left:0;width:100%}}.error-label[data-v-059adf22]{color:#b42318;font-size:.875rem;margin-top:4px;display:block;font-weight:300!important}.arv-input-container[data-v-059adf22]{display:flex;align-items:center;gap:8px;width:100%}.arv-input-container .input-group-text[data-v-059adf22]{padding:0 12px;background-color:#f5f5f5;border:1px solid #ddd;border-radius:4px;color:#555;height:45px;display:flex;align-items:center}\n',document.head.appendChild(t);class re extends L{constructor(a,t,l){super(a,51,t,l),e(this,"sitePrefix",void 0),this.sitePrefix=""}getSitePrefix(){return this.sitePrefix}createArvNumber(e){return M.postJson("/patient_identifiers/",{patient_id:this.patientID,identifier_type:4,identifier:e})}buildArvNumber(e){return`${this.sitePrefix}-ARV-${e}`}}const ie={class:"form-container"},oe={class:"search-section"},ne={key:0,class:"search-results"},de={key:0,class:"search-loading"},se={key:1},ue=["onClick"],pe={class:"pagination"},ce=["disabled"],ve={class:"page-info"},me=["disabled"],fe={key:2,class:"no-results"},ge={key:0,class:"create-form-section"},be=l({__name:"ManageGuardian",props:{isOpen:{type:Boolean,required:!0}},emits:["close","whenSaved","guardianSelected"],setup(e,{emit:a}){const t=H(),{patient:l}=r(t),Y=a,$=i(""),O=i([]),E=i(!1),L=i(!1),M=i(1),ee=i([]),ae=i([]),te=i([]),le=i({firstName:"",lastName:"",phone:"",relationship:""}),re=i([]),be=i(null),xe=i(!1),he=i(!1),ye=i(!1),_e=i(!1),we=o((()=>Math.ceil(ee.value.length/10))),ke=o((()=>{const e=10*(M.value-1),a=e+10;return ee.value.slice(e,a)})),Ne=o((()=>""!==le.value.firstName.trim()&&""!==le.value.lastName.trim()&&le.value.relationship)),Ce=()=>{Ue(),Y("close")},Ie=()=>{clearTimeout(Se),Se=setTimeout((()=>{L.value=!1,Ve()}),300)};let Se;const Ve=async()=>{if(!$.value.trim())return ee.value=[],void(M.value=1);E.value=!0;try{const e=await Q.getJson(`people/${l.value.patientID}/relationships`);ae.value=e.map((e=>{var a,t,l,r;const i=(null===(a=e.relation)||void 0===a||null===(a=a.names)||void 0===a?void 0:a[0])||{};return{id:null===(t=e.relation)||void 0===t||null===(t=t.person_id)||void 0===t?void 0:t.toString(),firstName:i.given_name||"Unknown",lastName:i.family_name||"",phone:(null===(l=e.relation)||void 0===l||null===(l=l.person_attributes)||void 0===l||null===(l=l.find((e=>e.value)))||void 0===l?void 0:l.value)||"",relationship:(null===(r=e.type)||void 0===r?void 0:r.b_is_to_a)||"Other",source:"existing"}}));const a=$.value.split(" "),t={given_name:a[0],family_name:a.length>=2?a[1]:"",page:"1",per_page:"20",exclude_patient_id:l.value.patientID},r=await Q.search(t);te.value=r.map((e=>{var a;const t=e.person.names[0];return{id:e.person.person_id.toString(),firstName:t.given_name,lastName:t.family_name,phone:(null===(a=e.person.attributes)||void 0===a||null===(a=a.find((e=>"Cell Phone Number"===e.attribute_type)))||void 0===a?void 0:a.value)||"",relationship:"",source:"search"}})),ee.value=[...ae.value,...te.value.filter((e=>!ae.value.some((a=>a.id===e.id))))].sort(((e,a)=>{const t=`${e.firstName} ${e.lastName}`.toUpperCase(),l=`${a.firstName} ${a.lastName}`.toUpperCase();return t.localeCompare(l)})),M.value=1}catch(e){W("Failed to search guardians")}finally{E.value=!1}},qe=e=>{e?(be.value=e,le.value.relationship=e.value,xe.value=!1):(be.value=null,le.value.relationship=""),Te()},Pe=e=>{le.value.firstName=e.target.value,De()},je=e=>{le.value.lastName=e.target.value,ze()},Re=e=>{le.value.phone=e.target.value,Ae()},De=()=>{he.value=""===le.value.firstName.trim()},ze=()=>{ye.value=""===le.value.lastName.trim()},Ae=()=>{_e.value=""===le.value.phone.trim()},Fe=async()=>{try{if(De(),ze(),Te(),!Ne.value)return void W("Please fill all required fields");const e={given_name:le.value.firstName,family_name:le.value.lastName,gender:"",birthdate:"",birthdate_estimated:!0,attributes:{cell_phone_number:le.value.phone}},a=new Z;await a.registerGuardian(e);const t=a.getPersonID();if(!t)return void W("Failed to create guardian");const r=re.value.find((e=>e.value===le.value.relationship));r&&await K.createRelation(l.value.patientID,t,r.other.relationship_type_id);const i={id:t.toString(),firstName:le.value.firstName,lastName:le.value.lastName,phone:le.value.phone,relationship:le.value.relationship};Y("whenSaved",i),Ce(),X("Guardian created successfully")}catch(e){console.error("Error creating guardian:",e),W("Failed to create guardian")}},Te=()=>{xe.value=!le.value.relationship},Ue=()=>{le.value={firstName:"",lastName:"",phone:"",relationship:""},be.value=null,$.value="",O.value=[],L.value=!1,M.value=1,E.value=!1};return(async()=>{try{const e=await K.getRelations();re.value=e.map((e=>({label:e.b_is_to_a,value:e.b_is_to_a,other:e})))}catch(e){console.error("Failed to load relationships",e)}})(),n(L,(e=>{e?O.value=[]:$.value&&Ve()})),(a,t)=>{const r=d("ion-buttons");return s(),u(v(G),{"is-open":e.isOpen,onDidDismiss:Ce},{default:p((()=>[c(v(m),null,{default:p((()=>[c(v(f),null,{default:p((()=>[c(v(g),{class:"modal-title"},{default:p((()=>t[5]||(t[5]=[b("Search/Add Guardian")]))),_:1,__:[5]}),c(r,{slot:"end"},{default:p((()=>[c(v(x),{onClick:Ce,class:"close-button"},{default:p((()=>t[6]||(t[6]=[b("Close")]))),_:1,__:[6]})])),_:1})])),_:1})])),_:1}),c(v(h),{class:"ion-padding modal-content"},{default:p((()=>[y("div",ie,[y("div",oe,[c(v(_),{class:"search-item",lines:"full"},{default:p((()=>[c(v(w),{modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=e=>$.value=e),placeholder:"Search guardian by name",onIonInput:Ie,class:"search-input"},{default:p((()=>[c(v(k),{icon:v(N),slot:"start"},null,8,["icon"])])),_:1},8,["modelValue"]),c(v(x),{slot:"end",fill:"clear",onClick:t[1]||(t[1]=e=>L.value=!0),title:"Create new guardian"},{default:p((()=>[c(v(k),{icon:v(C)},null,8,["icon"]),c(v(k),{icon:v(I)},null,8,["icon"])])),_:1})])),_:1}),$.value&&!L.value?(s(),S("div",ne,[E.value?(s(),S("div",de," Searching... ")):ee.value.length>0?(s(),S("div",se,[(s(!0),S(V,null,q(ke.value,(e=>(s(),S("div",{key:e.id,class:"result-item",onClick:a=>(async e=>{try{const a=re.value.find((a=>a.value===(e.relationship||"Guardian")));a?(await K.createRelation(l.value.patientID,e.id,a.other.relationship_type_id),Y("guardianSelected",e),Ce(),X("Guardian relationship created successfully")):W("Could not determine relationship type")}catch(a){console.error("Error creating relationship:",a),W("Failed to create guardian relationship")}})(e)},P(e.firstName)+" "+P(e.lastName),9,ue)))),128)),y("div",pe,[y("button",{onClick:t[2]||(t[2]=e=>M.value=Math.max(1,M.value-1)),disabled:1===M.value,class:"pagination-button"}," < ",8,ce),y("span",ve,"page "+P(M.value)+" of "+P(we.value),1),y("button",{onClick:t[3]||(t[3]=e=>M.value=Math.min(we.value,M.value+1)),disabled:M.value===we.value,class:"pagination-button"}," > ",8,me)])])):(s(),S("div",fe,[y("p",null,'No guardians found matching "'+P($.value)+'"',1)]))])):j("",!0)]),L.value?(s(),S("div",ge,[c(v(R),{class:"form-grid"},{default:p((()=>[c(v(D),{class:"form-row"},{default:p((()=>[c(v(z),{class:"form-column"},{default:p((()=>[c(J,{inputHeader:"First name*",inputValue:le.value.firstName,"onUpdate:inputValue":Pe,inputType:"text",error:he.value},null,8,["inputValue","error"]),he.value?(s(),u(v(A),{key:0,class:"error-label"},{default:p((()=>t[7]||(t[7]=[b(" First name is required ")]))),_:1,__:[7]})):j("",!0)])),_:1}),c(v(z),{class:"form-column"},{default:p((()=>[c(J,{inputHeader:"Last name*",inputValue:le.value.lastName,"onUpdate:inputValue":je,inputType:"text",required:!0,error:ye.value},null,8,["inputValue","error"]),ye.value?(s(),u(v(A),{key:0,class:"error-label"},{default:p((()=>t[8]||(t[8]=[b(" Last name is required ")]))),_:1,__:[8]})):j("",!0)])),_:1})])),_:1}),c(v(D),{class:"form-row"},{default:p((()=>[c(v(z),{class:"form-column"},{default:p((()=>[c(B,{inputHeader:"Phone number",inputValue:le.value.phone,"onUpdate:inputValue":Re,inputType:"tel",required:!0},null,8,["inputValue"])])),_:1}),c(v(z),{class:"form-column"},{default:p((()=>[c(v(A),{position:"stacked",style:{"font-weight":"500"},class:"labl-cls"},{default:p((()=>t[9]||(t[9]=[b("Relationship"),y("span",{class:"required"}," *",-1)]))),_:1,__:[9]}),c(v(F),{modelValue:be.value,"onUpdate:modelValue":[t[4]||(t[4]=e=>be.value=e),qe],multiple:!1,taggable:!1,"hide-selected":!0,"close-on-select":!0,openDirection:"bottom",placeholder:"Select relationship",selectLabel:"",label:"label",searchable:!0,"track-by":"value",options:re.value,disabled:!1,class:T({"error-state":xe.value}),error:xe.value},null,8,["modelValue","options","class","error"]),xe.value?(s(),u(v(A),{key:0,class:"error-label"},{default:p((()=>t[10]||(t[10]=[b(" Relationship is required ")]))),_:1,__:[10]})):j("",!0)])),_:1})])),_:1})])),_:1})])):j("",!0),L.value?(s(),u(v(x),{key:1,expand:"block",onClick:Fe,class:"save-button"},{default:p((()=>[c(v(k),{icon:v(U),slot:"start"},null,8,["icon"]),t[11]||(t[11]=b(" Save "))])),_:1,__:[11]})):j("",!0)])])),_:1})])),_:1},8,["is-open"])}}}),xe=ee(be,[["__scopeId","data-v-473b61c5"]]),he={class:"reception-form"},ye={class:"form-section"},_e={class:"form-row"},we={class:"form-group segment-group"},ke={class:"segment-label-container"},Ne={class:"form-row"},Ce={class:"form-group segment-group"},Ie={class:"segment-label-container"},Se={key:0,class:"form-row"},Ve={class:"form-group segment-group"},qe={class:"segment-label-container"},Pe={key:1,class:"form-row"},je={class:"form-group segment-group"},Re={class:"segment-label-container"},De={class:"arv-input-container"},ze={class:"input-group"},Ae=["placeholder"],Fe={class:"input-group-text"},Te={class:"form-footer"};a("default",ee(l({__name:"Reception",setup(e){const a=H(),{patient:t}=r(a),l=ae(),d=i(""),m=i(""),f=i(""),g=i(!1),h=i(""),_=i(!0),w=i(""),k=i(""),N=i(""),C=i(null),I=i(!1),q=i(!1),R=i(!1),D=i(!1),z=i("");n(f,(e=>{"no"===e&&(h.value="",D.value=!1)})),n([d,m],(([e,a])=>{"no"===e&&"no"===a&&(m.value="yes")}));const F=o((()=>!_.value&&"New patient"===N.value)),T=()=>{g.value=!1,C.value||(m.value="")},U=e=>{C.value=e},G=e=>{C.value=e,m.value="yes"},L=()=>(D.value=!1,z.value="",h.value.trim()?/^\d+$/.test(h.value)?!(parseInt(h.value)<=0)||(D.value=!0,z.value="Number must be positive",!1):(D.value=!0,z.value="Only numbers are allowed",!1):(D.value=!0,z.value="ART number is required",!1));(async()=>{var e;await l.loadSitePrefix(),k.value=l.globalPropertyStore.sitePrefix||"MPC";const a=new le(J,B);await a.loadPatientType(),N.value=a.getType();const r=null===(e=t.value.identifiers)||void 0===e?void 0:e.some((e=>{var a;return 4===e.identifier_type&&""!==(null===(a=e.identifier)||void 0===a?void 0:a.trim())}));if(_.value=r,r||"New patient"!==N.value)w.value="";else{const e=await M.getNextSuggestedARVNumber();w.value=e.arv_number.replace(/^\D+|\s/g,"")}})();const J=t.value.patientID,B=te.getUserID()||-1,K=te.getUserLocation(),Z=new re(J,B,K),ee=async()=>{if((()=>{let e=!0;return d.value||(I.value=!0,e=!1),m.value||(q.value=!0,e=!1),F.value&&(f.value||(R.value=!0,e=!1),"yes"!==f.value||L()||(e=!1)),e})())try{if(!(await Z.createEncounter()))return void W("Failed to create encounter");const e=[],a=await Z.buildValueCoded("Patient present","yes"===d.value?"Yes":"No");e.push(a);const t=await Z.buildValueCoded("Guardian present","yes"===m.value?"Yes":"No");e.push(t);if(!(await Z.saveObservationList(e)))return void W("Failed to save observations");if("yes"===f.value){await Z.createArvNumber(h.value)||W("Failed to save ARV number")}X("Reception data saved successfully")}catch(e){W("Failed to save reception")}else W("Please correct the form errors")};return(e,a)=>(s(),S(V,null,[a[18]||(a[18]=y("div",{class:"section-header",style:{"margin-bottom":"10px"}},[y("h2",null,"HIV Reception"),y("hr",{style:{"border-top":"1px solid #0c0c0c","margin-top":"10px"}})],-1)),y("div",he,[y("div",ye,[y("div",_e,[y("div",we,[y("div",ke,[a[5]||(a[5]=y("label",{class:"label-title"},[b("Patient present? "),y("span",{class:"required"},"*")],-1)),I.value?(s(),u(v(A),{key:0,class:"error-label"},{default:p((()=>a[4]||(a[4]=[b(" Patient present is required ")]))),_:1,__:[4]})):j("",!0)]),c(v($),{value:d.value,onIonChange:a[0]||(a[0]=e=>{var a;void 0!==(a=e.detail.value)&&(d.value=a,I.value=!1,"no"===d.value&&"no"===m.value&&(d.value="yes"))}),class:"custom-segment"},{default:p((()=>[c(v(Y),{value:"yes"},{default:p((()=>[c(v(A),null,{default:p((()=>a[6]||(a[6]=[b("Yes")]))),_:1,__:[6]})])),_:1}),c(v(Y),{value:"no"},{default:p((()=>[c(v(A),null,{default:p((()=>a[7]||(a[7]=[b("No")]))),_:1,__:[7]})])),_:1})])),_:1},8,["value"])])]),y("div",Ne,[y("div",Ce,[y("div",Ie,[a[9]||(a[9]=y("label",{class:"label-title"},[b("Guardian present? "),y("span",{class:"required"},"*")],-1)),q.value?(s(),u(v(A),{key:0,class:"error-label"},{default:p((()=>a[8]||(a[8]=[b(" Guardian present is required ")]))),_:1,__:[8]})):j("",!0)]),c(v($),{value:m.value,onIonChange:a[1]||(a[1]=e=>(async e=>{if(void 0!==e&&(m.value=e,q.value=!1,"no"===d.value&&"no"===m.value&&(d.value="yes"),"yes"===m.value))try{const e=await Q.getJson(`people/${t.value.patientID}/relationships`);e.length>0?C.value=e[0].relation:g.value=!0}catch(a){console.error("Error checking relationships:",a),W("Failed to check existing guardians")}})(e.detail.value)),class:"custom-segment"},{default:p((()=>[c(v(Y),{value:"yes"},{default:p((()=>[c(v(A),null,{default:p((()=>a[10]||(a[10]=[b("Yes")]))),_:1,__:[10]})])),_:1}),c(v(Y),{value:"no"},{default:p((()=>[c(v(A),null,{default:p((()=>a[11]||(a[11]=[b("No")]))),_:1,__:[11]})])),_:1})])),_:1},8,["value"])])]),F.value?(s(),S("div",Se,[y("div",Ve,[y("div",qe,[a[13]||(a[13]=y("label",{class:"label-title"},[b("Capture ART number? "),y("span",{class:"required"},"*")],-1)),R.value?(s(),u(v(A),{key:0,class:"error-label"},{default:p((()=>a[12]||(a[12]=[b(" Capture ART number is required ")]))),_:1,__:[12]})):j("",!0)]),c(v($),{value:f.value,onIonChange:a[2]||(a[2]=e=>{var a;void 0!==(a=e.detail.value)&&(f.value=a,R.value=!1)}),class:"custom-segment"},{default:p((()=>[c(v(Y),{value:"yes"},{default:p((()=>[c(v(A),null,{default:p((()=>a[14]||(a[14]=[b("Yes")]))),_:1,__:[14]})])),_:1}),c(v(Y),{value:"no"},{default:p((()=>[c(v(A),null,{default:p((()=>a[15]||(a[15]=[b("No")]))),_:1,__:[15]})])),_:1})])),_:1},8,["value"])])])):j("",!0),"yes"!==f.value||_.value?j("",!0):(s(),S("div",Pe,[y("div",je,[y("div",Re,[a[16]||(a[16]=y("label",{class:"label-title"},[b("ART Number "),y("span",{class:"required"},"*")],-1)),D.value?(s(),u(v(A),{key:0,class:"error-label"},{default:p((()=>[b(P(z.value),1)])),_:1})):j("",!0)]),y("div",De,[y("div",ze,[O(y("input",{type:"text",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=e=>h.value=e),onInput:L,placeholder:w.value,required:""},null,40,Ae),[[E,h.value]]),y("span",Fe,P(k.value)+"-ARV",1)])])])])),y("div",Te,[c(v(x),{color:"primary",onClick:ee},{default:p((()=>a[17]||(a[17]=[b("Save")]))),_:1,__:[17]})])]),c(xe,{isOpen:g.value,patientID:v(t).patientID,onClose:T,onGuardianSelected:U,onWhenSaved:G},null,8,["isOpen","patientID"])])],64))}}),[["__scopeId","data-v-059adf22"]]))}}}))}();

import{d as N,c as D,y as h,f,u as a,af as j,z as i,l as o,U as G,k as l,T as K,A as w,S as Y,aa as M,ab as V,a9 as U,X as O,cl as X,r as b,n as Z,w as Q,a as q,e as S,cw as ee,m as x,bM as te,G as z,D as J,cY as ne,ac as ae,F as se,L as re,B as oe,W as R,p as ie}from"./vendor-Oa4k5SKv.js";import{i as $,ar as F,D as A,as as le,S as E,_ as B,g as de,k as W,m as C,at as ue,T as ce}from"./index-CLE2dth_.js";import{u as pe}from"./useExposeFromStandardForm-DyzqmNZh.js";import{u as me}from"./useLocation-BhZKw4EP.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-B1bBG-op.js";const fe={style:{display:"flex","justify-content":"space-between"}},_e={style:{"max-width":"500px",margin:"auto"}},ve=N({__name:"AddWebPrinter",setup(L){const{formRef:_}=pe(),{facilityList:y,getFacilities:v}=me();v();const m=D(()=>[{componentType:"inputField",header:"Print name",name:"printer_name",icon:$.print,validation:d=>F.required(d)},{componentType:"inputField",header:"Printer IP address",name:"ip_address",icon:$.networkBarDark,validation:d=>F.required(d)},{componentType:"multiSelectInputField",header:"Facility",name:"location_id",trackBy:"facility_id",openDirection:"auto",icon:$.search,validation:d=>F.required(d),options:y.value.facilities}]),P=()=>{O.dismiss()},u=()=>{var c;const d=(c=_.value)==null?void 0:c.getFormValues();d.location_id=d.location_id.code,E.postJson("/printer_configurations",d),O.dismiss()};return(d,c)=>(f(),h(a(j),null,{default:i(()=>[o(a(Y),null,{default:i(()=>[o(a(G),null,{default:i(()=>[l("div",fe,[o(a(K),null,{default:i(()=>c[2]||(c[2]=[w("Add Web Printer")])),_:1,__:[2]}),o(A,{name:"X",style:{"margin-right":"10px"},onClick:c[0]||(c[0]=I=>P())})])]),_:1})]),_:1}),o(a(U),{class:"ion-padding"},{default:i(()=>[l("div",_e,[o(a(M),null,{default:i(()=>[o(a(V),{size:"12"},{default:i(()=>[o(le,{formData:m.value,ref_key:"formRef",ref:_},null,8,["formData"])]),_:1})]),_:1}),o(a(M),{class:"ion-justify-content-end ion-margin-top"},{default:i(()=>[o(a(V),{size:"auto"},{default:i(()=>[o(A,{name:"Add printer",onClick:c[1]||(c[1]=I=>u())})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),ge=B(ve,[["__scopeId","data-v-bce6abd1"]]),ye={class:""},Pe={class:"table-header"},Ie={class:"table-responsive"},be={key:0,class:"loading-state"},ke={key:1,class:"empty-state"},he=N({__name:"ManageIPPrinters",setup(L){const _=X(),y=b([]),v=b(!1);b(null);const m=D(()=>({paging:!0,lengthChange:!1,searching:!1,ordering:!0,info:!0,autoWidth:!0,responsive:!0,pageLength:8,createdRow:(n,s,p)=>{Z(()=>{const g=n.lastElementChild;if(g){g.innerHTML="";const e=document.createElement("button");e.innerText="Test Print",e.className="test-print-button action-button",e.onclick=()=>c(s),g.appendChild(e);const t=document.createElement("button");t.innerText="Edit",t.className="edit-button action-button",t.onclick=()=>u(s),g.appendChild(t);const r=document.createElement("button");r.innerText="Delete",r.className="delete-button action-button",r.onclick=()=>d(s),g.appendChild(r)}})}})),P=D(()=>[{data:"printer_name",title:"Printer name"},{data:"ip_address",title:"Ip address"},{data:"location_id",title:"Location ID"},{data:"created_at",title:"Date"},{data:null,title:"Actions",orderable:!1,render:function(n,s,p){return""}}]),u=async(n=null)=>{de(ge,{class:"large-modal"},!0)},d=async n=>{if(confirm("Are you sure you want to delete printer: ".concat(n.printer_name,"?")))try{console.log("ðŸš€ ~ deletePrinter ~ printerData:",n),await E.delete("/printer_configurations/".concat(n._id),{id:n._id}),W("Printer ".concat(n.printer_name," deleted successfully! (Simulated)")),await I()}catch(s){console.error("Error deleting printer:",s),C("Failed to delete printer ".concat(n.printer_name,"."))}},c=async n=>{const s="^XA\n        ^FO50,50^A0N,60,60^FDTest Print from Vue App!^FS\n        ^FO50,150^A0N,30,30^FDPrinter: ".concat(n.printer_name,"^FS\n        ^FO50,200^A0N,30,30^FDIP Address: ").concat(n.ip_address,"^FS\n        ^XZ");try{const p=await fetch("http://".concat(n.ip_address,"/print"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({zpl:s})});if(p.ok)W("Test print sent successfully to ".concat(n.printer_name));else{const g=await p.json();C("Failed to send test print to ".concat(n.printer_name,". Error: ").concat(g.message||p.statusText))}}catch(p){console.error("Error sending test print:",p),C("Error sending test print to ".concat(n.printer_name,". Please check your network or server connection."))}},I=async()=>{v.value=!0;try{y.value=await E.getJson("/printer_configurations")}catch(n){console.error("Error loading printer configurations:",n),C("Failed to load printer configurations.")}finally{v.value=!1}};return Q(_,async()=>{await I()},{deep:!0}),q(async()=>{await I()}),(n,s)=>(f(),S("div",ye,[l("div",null,[l("div",Pe,[s[1]||(s[1]=l("h3",{class:"encounter-title"},"Manage web printers",-1)),o(A,{name:"Add printer",fill:"solid",onClick:s[0]||(s[0]=p=>u())})]),l("div",Ie,[v.value?(f(),S("div",be,s[2]||(s[2]=[l("p",null,"Loading observations...",-1)]))):y.value.length===0?(f(),S("div",ke,s[3]||(s[3]=[l("p",null,"No observations found for",-1)]))):(f(),h(a(ee),{key:2,ref:"dataTable",class:"display nowrap modern-table",width:"100%",data:y.value,columns:P.value,options:m.value},{default:i(()=>s[4]||(s[4]=[l("thead",null,[l("tr",null,[l("th",null,"Printer name"),l("th",null,"Ip address"),l("th",null,"Date"),l("th",null,"Actions")])],-1)])),_:1,__:[4]},8,["data","columns","options"]))])])]))}}),we=B(he,[["__scopeId","data-v-4d723828"]]),Se={key:0,class:"spinner-overlay"},Te={class:"container"},Ce=N({__name:"ManagePrinters",setup(L){X();const _=b(!1),y=b(Math.random()),v=b([]),m=b({}),P=new ue,u=b(!1);function d(){try{localStorage.setItem("isIpPrinters",JSON.stringify(u.value)),console.log("isIpPrinters state saved:",u.value)}catch(e){console.error("Error saving isIpPrinters state to localStorage:",e)}}function c(){try{const e=localStorage.getItem("isIpPrinters");e!==null&&(u.value=JSON.parse(e),console.log("isIpPrinters state loaded:",u.value))}catch(e){console.error("Error loading isIpPrinters state from localStorage:",e)}}async function I(){if(!_.value){_.value=!0;try{const e=await P.getAllPrinters();console.log("Discovered printers",JSON.stringify(e)),v.value=g(e)}catch(e){console.error("Error loading printers:",e)}finally{_.value=!1,y.value=Math.random()}}}function n(e,t){const r=e.name||"",k=t.name||"",T=e.address||"",H=t.address||"";return r!==k?r.localeCompare(k):T.localeCompare(H)}function s(e){P.setDefaultPrinter(e),m.value=e,y.value=Math.random(),I()}function p(e){return n(e,m.value)===0}function g(e){return e.sort((t,r)=>{const k=p(t),T=p(r);return k&&!T?-1:!k&&T?1:n(t,r)})}return q(async()=>{c(),m.value=await P.getDefaultPrinter()||{},m.value&&(m.value.name||m.value.address)&&(v.value.some(t=>n(t,m.value)===0)||v.value.push(m.value)),I()}),(e,t)=>(f(),h(a(j),{class:ie({loading:_.value})},{default:i(()=>[_.value?(f(),S("div",Se,[o(a(te),{name:"bubbles"}),t[1]||(t[1]=l("div",{class:"loading-text"},"Please wait...",-1))])):x("",!0),o(ce),o(a(U),null,{default:i(()=>[l("div",Te,[t[5]||(t[5]=l("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Printer Management",-1)),o(a(z),null,{default:i(()=>[o(a(J),null,{default:i(()=>t[2]||(t[2]=[w("Use IP Printers")])),_:1,__:[2]}),o(a(ne),{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=r=>u.value=r),onIonChange:d},null,8,["modelValue"])]),_:1}),u.value?x("",!0):(f(),h(a(ae),{key:0},{default:i(()=>[(f(!0),S(se,null,re(v.value,r=>(f(),h(a(z),{key:r.name||r.address||"unknown-printer"},{default:i(()=>[o(a(J),null,{default:i(()=>[w(oe(r.name||r.address||"Unnamed Printer"),1)]),_:2},1024),o(a(R),{size:"small",color:p(r)?"success":"primary",onClick:k=>s(r),disabled:p(r)},{default:i(()=>t[3]||(t[3]=[w(" Set as Default ")])),_:2,__:[3]},1032,["color","onClick","disabled"]),o(a(R),{onClick:k=>a(P).printTestLbl(r),size:"small"},{default:i(()=>t[4]||(t[4]=[w(" Test Print ")])),_:2,__:[4]},1032,["onClick"])]),_:2},1024))),128))]),_:1})),u.value?(f(),h(we,{key:1,style:{"margin-top":"10px"}})):x("",!0)])]),_:1})]),_:1},8,["class"]))}}),Ne=B(Ce,[["__scopeId","data-v-94d8d5a1"]]);export{Ne as default};

import{d as F,aT as A,r as c,c as R,a as V,H as r,e as p,f as m,k as o,l as a,J as s,u as C,a1 as x,P as B,F as _,O,K as H}from"./vendor-Bn90Jqlj.js";import{u as I,aw as M,t as P,ae as f,aO as v,N as $,aI as J,H as L,l as G}from"./index-DonUYVAT.js";const K={class:"card-container"},W={class:"custom-card"},j={class:"ion-padding",slot:"content"},q={class:"table-responsive"},Y=F({__name:"RiskAssessment",setup(z,{expose:b}){const g=I(),{patient:Q}=A(g),d=c([]),S=c(G),h=["Substance","Answer","Date","Action"],k={responsive:!0,select:!1,layout:{topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1},y=R(()=>[{componentType:"Heading",name:"Substance use / Consumption",position:"center"},{componentType:"radioButtonField",header:"Smoking",name:"Smoking history",grid:{s:"3"},obsValueType:"value_coded",options:[{label:"Smoking",value:"Smoking"},{label:"Never",value:"Never"},{label:"Stopped",value:"Stopped"}]},{grid:{s:"2"}},{componentType:"radioButtonField",header:"Drinking alcohol",name:"Does the patient drink alcohol?",grid:{s:"3"},obsValueType:"value_coded",options:[{label:"Drinking",value:"Drinking"},{label:"Never",value:"Never"},{label:"Stopped",value:"Stopped"}]}]),n=c(null),D=async()=>{if(!n.value){console.error("Form reference is not available");return}const e=n.value.getFormValues();if(!(e["Smoking history"]&&e["Does the patient drink alcohol?"])){P("Risk assessment not saved");return}await f.buildAddObsToEncounterPatient(e,v.ASSESSMENT),n.value.resetForm(),$("Risk assessment saved successful")},T=async()=>{const e=await f.getObsByEncounterId(v.ASSESSMENT);if(!e||e.length===0)return[];const i=await Promise.all(e.flatMap(l=>l.obs.map(async t=>[t.concept_name||"",await J.getConceptName(t.value_coded)||"",L.toStandardHisFormat(t.obs_datetime),'<button class="btn btn-outline-danger btn-sm delete-btn" data-id=\''.concat(JSON.stringify(t),"'>\n            ").concat(S.value.delete2,"</button>")])));d.value=i};return V(async()=>{await T()}),b({validateForm:()=>{var e;return(e=n.value)==null?void 0:e.validateForm()},onSubmit:D}),(e,i)=>{const l=r("ion-label"),t=r("DataTable"),w=r("ion-accordion"),N=r("ion-accordion-group"),E=r("ion-row");return m(),p(_,null,[o("div",K,[o("div",W,[a(M,{formData:y.value,ref_key:"formRef",ref:n},null,8,["formData"])])]),a(E,null,{default:s(()=>[a(N,{ref:"accordionGroup",class:"previousView"},{default:s(()=>[a(w,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:s(()=>[a(C(x),{slot:"header",color:"light"},{default:s(()=>[a(l,{class:"previousLabel"},{default:s(()=>i[0]||(i[0]=[B("Previous Visits",-1)])),_:1,__:[0]})]),_:1}),o("div",j,[o("div",q,[a(t,{ref:"dataTableRef",options:k,data:d.value,class:"display nowrap modern-table",width:"100%"},{default:s(()=>[o("thead",null,[o("tr",null,[(m(),p(_,null,O(h,u=>o("th",{key:u},H(u),1)),64))])])]),_:1},8,["data"])])])]),_:1})]),_:1},512)]),_:1})],64)}}});export{Y as _};

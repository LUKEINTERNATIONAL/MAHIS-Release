import{ae as G,cL as W,d as _,r as g,c as w,eB as J,y as B,f as d,u as c,aQ as K,z as b,l as D,aP as X,m as S,aO as Y,c9 as E,A as P,k as p,B as M,aN as Z,e as v,F,L as k,i as x,c$ as ee,cC as N,W as te,eC as ae,eD as le,j as re,eE as ne}from"./vendor-BEKTmkXc.js";import{g as H,a as q,D as oe}from"./report_service-BAC2IhjH.js";import{f as se,r as ie,u as ue,s as de,g as ce,h as pe,p as fe,e as ye,d as me,a as f,i as $,m as be,j as De,_ as ve}from"./index-BCcyz-uj.js";import{l as h}from"./lodash-Dt8AsbQm.js";function he(r="person_id",y=G()){return{label:"view client",icon:W,color:"light",action:async o=>{const t=await se.findByID(o[r]);return await ie(),await ue().setPatientRecord(t),y.replace({path:"/patientProfile"})}}}function Te(r,y={}){return Array.isArray(r)?r.map(o=>({label:o,path:o,drillable:!0,sortable:!0,...y})):Object.entries(r).map(([o,t])=>({path:o,label:t,drillable:!0,sortable:!1,...y}))}const ge={class:"filters-container"},we=["onUpdate:modelValue"],Be=["value"],Ce={class:"client-type-group"},Re={class:"table-container"},Se=_({__name:"ReportTable",props:{title:{type:String,default:"Report"},subtitle:{type:String,default:""},period:{type:String,default:""},date:{type:String,default:""},quarter:{type:Object,default:()=>({})},totalClients:{type:Array},columns:{type:Array,default:()=>[]},rows:{type:Array,default:()=>[]},asyncRows:{type:Function},actionButtons:{type:Array,default:()=>[]},rowActionButtons:{type:Array,default:()=>[]},canExportCsv:{type:Boolean,default:!0},canExportPDF:{type:Boolean,default:!0},useSecureExport:{type:Boolean,default:!1},showRefreshButton:{type:Boolean,default:!0},useDateRangeFilter:{type:Boolean,default:!1},useQuarterFilter:{type:Boolean,default:!1},useDateFilter:{type:Boolean,default:!1},customFilters:{type:Array,default:()=>[]},showIndices:{type:Boolean,default:!1},filename:{type:String,default:""},reportType:{type:String,default:""},drillTitle:{type:Function,default:()=>"Drill-down table"},customDrillColumns:{type:Array},drillRowParser:{type:Function},customDrillHandler:{type:Function},showDrillSelectButton:{type:Boolean,default:!0}},emits:["generate"],setup(r,{emit:y}){const o=y,t=r,s=g({}),m=g({}),C=g("all"),A=w(()=>de("\n  ".concat(t.reportType," \n  ").concat(ce().facilityName," \n  ").concat((t.filename||t.title).replace(t.reportType,"")," \n  ").concat(t.period?t.period:t.date,"\n"))),I=w(()=>{const e=[...t.customFilters];return t.useDateRangeFilter?(e.push({id:"startDate",label:"Start Date",type:"date",placeholder:"Start Date",slotName:"datePicker",value:t.period.split("-")[0]}),e.push({id:"endDate",label:"End Date",placeholder:"End Date",type:"date",slotName:"datePicker",value:t.period.split("-")[1]})):t.useQuarterFilter?e.push({id:"quarter",label:"Quarter:",type:"select",value:t.quarter,options:pe(10).map(l=>({label:l.name,value:l.name,other:l}))}):t.useDateFilter&&e.push({id:"date",label:"Date",type:"date",slotName:"datePicker",value:t.date}),e}),L=w(()=>{var l,a;const e=[...t.actionButtons];return t.canExportCsv&&e.push(H(A.value,(l=t.quarter)==null?void 0:l.label,t.period)),t.canExportPDF&&e.push(q(A.value,t.useSecureExport,(a=t.quarter)==null?void 0:a.label,t.period)),t.showRefreshButton&&e.push(U()),e}),j=w(()=>{var e;return(e=t.customDrillColumns)!=null?e:[{path:"identifier",label:"ARV Number",preSort:fe,initialSort:!0},{path:"birthdate",label:"Date of Birth",formatter:ye},{path:"gender",label:"Gender",formatter:me}]});function U(){return{label:"Refresh/Rebuild",icon:J,color:"primary",action:()=>{if(h.isEmpty(m.value))return f("Invalid filters");o("generate",m.value,!0)}}}function O(e){const l=I.value.filter(a=>a.required!==!1);return l.length===0?!0:l.every(a=>{const n=e[a.id];return a.required===!1?!0:h.isEmpty(n)?!1:typeof n=="object"&&n!==null?Object.values(n).every(Boolean):!0})}function T(e){if(e.occupation=C.value,s.value.date&&(e.date=s.value.date),"startDate"in e&&"endDate"in e){const{startDate:l,endDate:a}=s.value;if(!$(l,a))return f("Invalid date range");e.startDate=l,e.endDate=a,e.dateRange={startDate:l,endDate:a}}if("date"in e){if(h.isEmpty(s.value.date))return f("Invalid date");e.date=s.value.date}if(t.useDateRangeFilter){const l=s.value.startDate,a=s.value.endDate;if(!l||!a)return f("Please select both start and end dates");if(!$(l,a))return f("Invalid date range");e.startDate=l,e.endDate=a,e.dateRange={startDate:l,endDate:a}}if(O(e))return m.value=e,o("generate",e,!1);f("Invalid filters")}function Q(e){return e.preventDefault(),V({row:{clients:t.totalClients},column:{path:"clients",label:"Total Clients"}})}async function z(e,l){var a,n;if(typeof t.drillRowParser=="function")l.push(...await t.drillRowParser(e));else{const i=h.get(e.row,e.column.path,[]);for(const u of h.chunk(i,100)){const R=await ne.getAll(u);if(!R.ok)return f((a=R.errorMessage)!=null?a:"Unable to load patient data");l.push(...(n=R.data)!=null?n:[])}}}async function V(e){var n,i;if(typeof t.customDrillHandler=="function")return t.customDrillHandler(e);const l=t.drillTitle(e),a=g([]);return z(e,a.value),be.show(oe,{title:l,columns:j.value,rows:a.value,rowActionButtons:t.showDrillSelectButton?[he("person_id",De)]:[],actionButtons:[H(l,(n=t.quarter)==null?void 0:n.label,t.period),q(l,!1,(i=t.quarter)==null?void 0:i.label,t.period)]})}return(e,l)=>(d(),B(c(K),{class:"report-card"},{default:b(()=>[D(c(X),{class:"report-header"},{default:b(()=>{var a;return[D(c(Y),{innerHTML:r.title},null,8,["innerHTML"]),r.subtitle?(d(),B(c(E),{key:0,innerHTML:r.subtitle,class:"report-subtitle"},null,8,["innerHTML"])):S("",!0),(a=r.totalClients)!=null&&a.length?(d(),B(c(E),{key:1,class:"total-clients"},{default:b(()=>[l[2]||(l[2]=P(" Total Clients: ")),p("a",{href:"#",onClick:Q},M(r.totalClients.length),1)]),_:1,__:[2]})):S("",!0)]}),_:1}),D(c(Z),{class:"report-content"},{default:b(()=>[p("div",ge,[(d(!0),v(F,null,k(I.value,a=>{var n,i;return d(),v(F,{key:a.id},[a.type==="date"&&a.slotName==="datePicker"?(d(),B(c(ee),{key:0,modelValue:s.value[a.id],"onUpdate:modelValue":u=>s.value[a.id]=u,"enable-time-picker":!1,"model-type":"dd/MMM/yyyy",format:"dd/MMM/yyyy",placeholder:(i=(n=a.placeholder)!=null?n:a.label)!=null?i:"Select Date","auto-apply":"","text-input":"",class:"date-picker"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):a.type==="select"?x((d(),v("select",{key:1,"onUpdate:modelValue":u=>m.value[a.id]=u,class:"filter-select"},[(d(!0),v(F,null,k(a.options,u=>(d(),v("option",{key:u.value,value:u.value},M(u.label),9,Be))),128))],8,we)),[[N,m.value[a.id]]]):S("",!0)],64)}),128)),p("div",Ce,[l[4]||(l[4]=p("label",{for:"occupation",class:"client-type-label"},"Occupation:",-1)),x(p("select",{id:"occupation","onUpdate:modelValue":l[0]||(l[0]=a=>C.value=a),class:"filter-select"},l[3]||(l[3]=[p("option",{value:"All"},"All",-1),p("option",{value:"Military"},"Military",-1),p("option",{value:"Civilian"},"Civilian",-1)]),512),[[N,C.value]])]),D(c(te),{size:"small",onClick:l[1]||(l[1]=a=>T({...m.value})),class:"submit-btn"},{default:b(()=>l[5]||(l[5]=[P(" Submit ")])),_:1,__:[5]})]),p("div",Re,[D(c(ae),{rows:r.rows,"async-rows":r.asyncRows,columns:r.columns,"actions-buttons":L.value,"row-actions-buttons":r.rowActionButtons,"custom-filters":[],config:{showIndices:r.showIndices},onCustomFilter:T,onDrilldown:V,color:"light"},le({_:2},[k(e.$slots,(a,n)=>({name:n,fn:b(({filter:i})=>[re(e.$slots,n,{filter:{filter:i}},void 0,!0)])}))]),1032,["rows","async-rows","columns","actions-buttons","row-actions-buttons","config"])])]),_:3})]),_:3}))}}),Ve=ve(Se,[["__scopeId","data-v-8fabd17f"]]);export{Ve as R,he as g,Te as t};

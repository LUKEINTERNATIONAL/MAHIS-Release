System.register(["./vendor-legacy-CCRc-I5f.js","./index-legacy-CIih74IA.js","./lodash-legacy-pOOc9Efu.js"],function(e,n){"use strict";var t,l,a,o,i,r,u,s,c,p,d,v,g,m,y,b,f,h,D,_,k,T,x,I,w,P,F,j,A,R,C,V,S,N,E,W,z,H,L,Y,$,M,U,B,J,Q,G,X,q;return{setters:[e=>{t=e.d,l=e.bY,a=e.aj,o=e.b1,i=e.r,r=e.w,u=e.y,s=e.f,c=e.z,p=e.l,d=e.u,v=e.ev,g=e.k,m=e.am,y=e.ao,b=e.e,f=e.an,h=e.F,D=e.L,_=e.G,k=e.I,T=e.ew,x=e.ex,I=e.er,w=e.B,P=e.cn,F=e.V,j=e.U,A=e.W,R=e.A,C=e.dQ,V=e.bP,S=e.ag,N=e.ad,E=e.e7,W=e.ct,z=e.dr,H=e.ey,L=e.m,Y=e.ez,$=e.au,M=e.bV,U=e.a6},e=>{B=e.S,J=e.u,Q=e.T,G=e.W,X=e.m,q=e._},null],execute:function(){var K=document.createElement("style");K.textContent="#main[data-v-5180e530]{height:calc(100vh - 69px);overflow-y:auto}.placeholder-content[data-v-5180e530]{padding:20px}\n/*$vite$:1*/",document.head.appendChild(K);class O extends B{constructor(){super()}static nextTask(e){return super.getJson(`/workflows/${super.getProgramID()}/${e}`,{date:super.getSessionDate()})}static async getNextTaskParams(e,n=""){let t=n;try{if(!t){const{name:n}=await O.nextTask(e);t=n}}catch(l){t=""}return{name:t.toLowerCase(),params:{patient_id:e}}}}const Z={key:1,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},ee={class:"ion-page",id:"main"},ne={key:0,class:"placeholder-content"},te={style:{margin:"0px auto"},class:"ion-text-center"},le={key:1},ae={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}};e("default",q(t({__name:"ARTVisit",setup(e){const t=l(),q=J(),{patient:K}=a(q),oe=[{label:"Emergency Refill",enableForDebugging:!1,component:M(()=>U(()=>n.import("./EmergencyRefill-legacy-F332LQ5k.js"),void 0,n.meta.url))},{encounterTypeID:5,userProp:"patient type",label:"Patient Type",enableForDebugging:!1,component:M(()=>U(()=>n.import("./ARTPatientType-legacy-CUUWnqo_.js"),void 0,n.meta.url))},{label:"Filing Number Management",enableForDebugging:!1,component:M(()=>U(()=>n.import("./FilingNumberManagement-legacy-X5g32IR8.js"),void 0,n.meta.url))},{encounterTypeID:9,userProp:"HIV first visits",enableForDebugging:!1,label:"HIV Clinic Registration",component:M(()=>U(()=>n.import("./ArtClinicRegistration-legacy-DxR1Q2WS.js"),void 0,n.meta.url))},{encounterTypeID:51,userProp:"HIV reception visits",label:"Reception",enableForDebugging:!1,component:M(()=>U(()=>n.import("./Reception-legacy-BwQVOhvB.js"),void 0,n.meta.url))},{encounterTypeID:6,otherWorkflowNames:["htn_vitals"],userProp:"vitals",label:"Vitals",enableForDebugging:!1,component:M(()=>U(()=>n.import("./Vitals-legacy-C8Aj04aS.js"),void 0,n.meta.url))},{encounterTypeID:52,userProp:"HIV staging visits",label:"Staging",enableForDebugging:!1,component:M(()=>U(()=>n.import("./Staging-legacy-CIk--PmN.js"),void 0,n.meta.url))},{encounterTypeID:53,userProp:"HIV clinic consultations",label:"Consultation",enableForDebugging:!1,component:M(()=>U(()=>n.import("./ARTConsultation-legacy-CMmmLixX.js").then(e=>e.b),void 0,n.meta.url))},{encounterTypeID:68,userProp:"ART adherence",label:"ART Adherence",enableForDebugging:!1,component:M(()=>U(()=>n.import("./ARTAdherence-legacy-CSu2CFE4.js"),void 0,n.meta.url))},{encounterTypeID:25,userProp:"Prescriptions",label:"Prescription",enableForDebugging:!1,component:M(()=>U(()=>n.import("./Prescription-legacy-DqKV0XvN.js"),void 0,n.meta.url))},{encounterTypeID:54,userProp:"Drug Dispensations",label:"Dispense drugs",enableForDebugging:!1,component:M(()=>U(()=>n.import("./ArtDispensation-legacy-Du2OBj8j.js"),void 0,n.meta.url))},{encounterTypeID:7,userProp:"Manage Appointments",label:"Appointment",enableForDebugging:!1,component:M(()=>U(()=>n.import("./ARTAppointment-legacy-Chv9FMFB.js"),void 0,n.meta.url))}],ie=o(),re=i(-1),ue=i(null),se=i([]),ce=i([]),pe=i(!1),de=i(-1),ve=i(""),ge=i(""),me=i("");function ye(e){var n;return!!e.enableForDebugging||!!e&&(!pe.value&&de.value===(null==e?void 0:e.encounterTypeID)||(null!==(n=null==e?void 0:e.otherWorkflowNames)&&void 0!==n?n:[]).includes(ve.value))}function be(){if(0===se.value.length||re.value===se.value.length-1)return!1;const e=se.value[re.value];return e&&ye(e)}async function fe(){me.value="",pe.value=!0,ge.value="",ve.value="";try{var e;const n=await O.nextTask(K.value.patientID);if(!n)return ge.value="No workflows found. You may exit this page or refresh",pe.value=!1,void(re.value=-1);ve.value=n.name,de.value=null!==(e=null==n?void 0:n.encounter_type_id)&&void 0!==e?e:-1;const t=se.value.findIndex(e=>{var n;return(null==e?void 0:e.encounterTypeID)===de.value||(null!==(n=e.otherWorkflowNames)&&void 0!==n?n:[]).includes(ve.value)});if(-1!==t){me.value=n.description;const e=[...se.value.slice(t),...se.value.slice(0,t)];se.value=e,re.value=0}else ge.value="Error loading workflow task",re.value=t}catch(n){ge.value="An error has occured while loading next task: "+n,console.error(n)}finally{await async function(){const e=await G.getEncounters(K.value.patientID,{date:O.getSessionDate()});ce.value=e.map(e=>e.encounter_type)}(),pe.value=!1}}function he(){(ue.value&&"function"==typeof ue.value.onSubmit?ue.value.onSubmit():Promise.resolve(!0)).then(e=>e&&fe())}return r(()=>t.fullPath,()=>{(async function(){re.value=-1,se.value=[];const e=await B.getJson("user_properties",{property:"activities"});try{if(!e.property_value)return void(se.value=oe);const n=e.property_value.split(",").map(e=>e.toLowerCase());se.value=oe.filter(e=>{var t;return e.enableForDebugging||n.includes(null===(t=e.userProp)||void 0===t?void 0:t.toLowerCase())})}catch(n){X("Unable to load activities"),console.error(n)}})().then(fe)},{immediate:!0,deep:!0}),(e,n)=>(s(),u(d($),null,{default:c(()=>[p(Q),p(d(v),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:c(()=>{var e;return[p(d(m),{contentId:"main"},{default:c(()=>[p(d(y),null,{default:c(()=>[se.value.length>0?(s(),u(d(f),{key:0},{default:c(()=>[(s(!0),b(h,null,D(se.value,(e,n)=>(s(),u(d(_),{onClick:e=>function(e){if(e<0||e>=se.value.length)return;const n=se.value[e];n&&ye(n)&&(re.value=e)}(n),lines:"none",key:n,disabled:!ye(e),button:""},{default:c(()=>{return[(n=e,ce.value.includes(null!==(t=null==n?void 0:n.encounterTypeID)&&void 0!==t?t:0)?(s(),u(d(k),{key:0,icon:d(T),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):ye(e)?(s(),u(d(k),{key:2,icon:d(I),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(s(),u(d(k),{key:1,icon:d(x),style:{padding:"10px"},slot:"start"},null,8,["icon"]))),g("b",null,w(e.label),1)];var n,t}),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(s(),b("div",Z,[p(d(k),{style:{"font-size":"2rem"},icon:d(P)},null,8,["icon"]),n[2]||(n[2]=g("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),p(d(F),null,{default:c(()=>[p(d(j),{color:"light"},{default:c(()=>[p(d(A),{onClick:n[0]||(n[0]=e=>d(ie).back())},{default:c(()=>[p(d(k),{icon:d(C),slot:"start"},null,8,["icon"]),n[3]||(n[3]=R(" Back to dashboard "))]),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),g("div",ee,[pe.value?(s(),b("div",ne,[g("div",te,[p(d(V),{name:"bubbles"}),n[4]||(n[4]=g("p",null,[g("h1",null,"Please wait...")],-1))])])):null!==(e=se.value[re.value])&&void 0!==e&&e.component?(s(),b("div",le,[p(d(S),null,{default:c(()=>[p(d(N),null,{default:c(()=>{var e;return[(s(),u(E,null,[(s(),u(W(null===(e=se.value[re.value])||void 0===e?void 0:e.component),{ref_key:"formRef",ref:ue},null,512))],1024))]}),_:1})]),_:1})])):(s(),b("div",ae,[p(d(k),{style:{color:"green","font-size":"80px"},icon:d(z)},null,8,["icon"]),g("h2",null,w(ge.value),1),p(d(A),{size:"large",fill:"clear",onClick:n[1]||(n[1]=e=>d(ie).back())},{default:c(()=>[p(d(k),{slot:"start",icon:d(H)},null,8,["icon"]),n[5]||(n[5]=R(" Exit page "))]),_:1,__:[5]})])),p(d(F),null,{default:c(()=>[p(d(j),{color:"light"},{default:c(()=>[be()?(s(),u(d(A),{key:0,onClick:he,color:"primary",style:{padding:"4px"},slot:"end"},{default:c(()=>[n[6]||(n[6]=R(" Save and continue ")),p(d(k),{style:{padding:"4px"},icon:d(Y),slot:"end"},null,8,["icon"])]),_:1,__:[6]})):L("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),[["__scopeId","data-v-5180e530"]]))}}});

var m=Object.defineProperty;var u=(o,a,e)=>a in o?m(o,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[a]=e;var g=(o,a,e)=>u(o,typeof a!="symbol"?a+"":a,e);import{a as l}from"./regimens-C9nA2WnN.js";import{R as c}from"./index-B-oVUrjU.js";import{l as h}from"./lodash-Dt8AsbQm.js";class w extends c{constructor(){super();g(this,"type");this.type="pepfar"}setReportType(e){this.type=e}getTptNewInitiations(){return this.getReport("programs/".concat(this.programId,"/reports/tpt_newly_initiated"))}getRegimenFormulationReport(e,r){return this.getReport("programs/".concat(this.programId,"/reports/regimens_and_formulations"),{regimen:e,formulation:r})}async getRegimenReport(){const e=await this.getReport("regimen_report",{type:this.type});return this.regimenReportBuilder(e)}async getRegimenSwitchReport(){const e=await this.getReport("regimen_switch",{pepfar:this.isPepfar()});return this.regimenReportBuilder(e)}regimenReportBuilder(e){return Object.values(e!=null?e:{}).map(r=>{let i="";const s=r.medication.map(n=>(i=n.start_date,"".concat(n.medication," (").concat(n.quantity,")")));return{...r,dispensation_date:i,medications:s.join(", ")}})}regimenDistributionRowBuilder(e,r,i){const s={weight:e,gender:r,total:0};return[...l,"N/A"].reduce((n,t)=>{const p=i.find(d=>!h.isEmpty(d[t]));return p?(n[t]=p[t],n.total+=p[t]):n[t]=0,n},s)}async getRegimensByWeight(){const e=await this.getReport("programs/".concat(this.programId,"/reports/regimens_by_weight_and_gender")),r=[],i=[];return e==null||e.forEach(s=>{i.push(this.regimenDistributionRowBuilder(s.weight,"F",s.females)),r.push(this.regimenDistributionRowBuilder(s.weight,"M",s.males))}),[...i,...r]}getSCReport(){return this.getReport("sc_arvdisp",{pepfar:this.isPepfar()})}isPepfar(){return/pepfar/i.test(this.type)}async getRegimenDispensationReport(e){const r=[],i=await this.getReport("latest_regimen_dispensed",{rebuild_outcome:e});if(!i)return[];for(const s in i)for(const n in i[s]){const t=i[s][n];r.push({identifier:t.identifier,drugName:t.name,gender:t.gender,dob:t.birthdate,dispensationDate:t.dispensation_date,packSize:t.pack_sizes[0],packSizes:t.pack_sizes.length,quantity:t.quantity,vlResult:t.vl_latest_result,vlResultDate:t.vl_latest_result_date,vlOrderDate:t.vl_latest_order_date})}return r}}export{w as R};

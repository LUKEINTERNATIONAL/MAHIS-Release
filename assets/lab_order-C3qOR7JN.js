import{R as Z,d as I,ar as $,V as A,as as q,af as ee,D as te,dj as se,du as ne,ac as z,G as U,T as B,U as L,a9 as F,S as T,b8 as V,W,aU as x,X as G,E as o,y as k,f as w,z as a,l as n,k as f,B as S,A as b,e as ae,F as oe,L as re,a0 as de,a3 as ue,a1 as ce,a2 as pe,I as me,aa as _e,ab as fe,a8 as he}from"./vendor-nmnlhkKn.js";import{D as N,aN as ve,C as P,H as R,aw as ie,k as be,u as le,_ as M,i as H,S as E,aD as ge,B as ye,aE as De,x as _,ax as J,ay as C,bl as we,t as Se}from"./index-BtuSuMhC.js";import{B as j}from"./BasicForm-DlGZ-Wn6.js";import{D as Ie}from"./DashBox-BNRLGpDw.js";import{v as X}from"./group_validation-DJpcEEZX.js";const K=Z("labResultsStore",{state:()=>({labResults:[]}),actions:{setLabResults(e){this.labResults=e}},persist:!0}),Oe=I({components:{IonButtons:x,IonButton:W,IonModal:V,IonHeader:T,IonContent:F,IonToolbar:L,IonTitle:B,IonItem:U,IonList:z,IonAvatar:ne,IonImg:se,IonLabel:te,IonPage:ee,IonMenu:q,BasicForm:j,IonFooter:A,DynamicButton:N},data(){return{popoverStatus:null}},props:{keyboardClose:{type:Boolean,default:!1},keepContentsMounted:{type:Boolean,default:!1},content:{type:Object,default:{}},popoverOpen:{type:Boolean,default:!1},event:{type:Event,default:""},title:{type:String,default:""}},computed:{...$(le,["patient"]),...$(K,["labResults"])},mounted(){},methods:{dismiss(){G.dismiss()},async saveResults(){const e=await this.buildResults();this.patient.labOrders.results=[{encounter_id:"",date:R.sessionDate(),measures:e,test_id:this.labResults[0].id}];let t=!1;for(let s=0;s<this.patient.labOrders.unsaved.length;s++)if(this.patient.labOrders.unsaved[s].tests[0].id===this.labResults[0].id&&this.patient.labOrders.unsaved[s].tests&&this.patient.labOrders.unsaved[s].tests.length>0){this.patient.labOrders.unsaved[s].tests[0].result=e,t=!0;break}if(!t){for(let s=0;s<this.patient.labOrders.saved.length;s++)if(this.patient.labOrders.saved[s].tests[0].id===this.labResults[0].id&&this.patient.labOrders.saved[s].tests&&this.patient.labOrders.saved[s].tests.length>0){this.patient.labOrders.saved[s].tests[0].result=e;break}}await ie(this.patient),be("Saved successfully"),this.$emit("saved")},async buildResults(){let e=[];return await Promise.all(this.labResults[1].data.rowData[0].colData.map(async t=>{var i;const s=await P("testResultIndicators",{whereClause:{concept_id:t.id}});e.push({indicator:{name:(i=s[0])==null?void 0:i.name,concept_id:t.id},value:t.value.name||t.value||"not done",value_modifier:"",value_type:"text"})})),e},async nav(e,t){const s=K();t=="not_save"?(await ve(),s.setLabResults(!1)):s.setLabResults(!0),this.dismiss(),this.$router.push(e)}}}),Re={class:"modal_wrapper"},Ce={class:"center text_12"};function $e(e,t,s,i,g,c){const l=o("ion-title"),r=o("ion-button"),d=o("ion-buttons"),u=o("ion-toolbar"),h=o("ion-header"),p=o("basic-form"),v=o("ion-row"),y=o("ion-content"),D=o("DynamicButton"),m=o("ion-footer"),O=o("ion-modal");return w(),k(O,{"is-open":e.popoverOpen,"show-backdrop":!0,onDidDismiss:t[2]||(t[2]=Y=>e.$emit("closePopoover",!1)),"keyboard-close":e.keyboardClose},{default:a(()=>[n(h,null,{default:a(()=>[n(u,null,{default:a(()=>[n(l,null,{default:a(()=>[f("b",null,"Enter lab results for ("+S(e.labResults[0].name)+") test",1)]),_:1}),n(d,{slot:"end"},{default:a(()=>[n(r,{onClick:t[0]||(t[0]=Y=>e.$emit("closeModal"))},{default:a(()=>t[3]||(t[3]=[b("Close")])),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),n(y,{class:"ion-padding"},{default:a(()=>[f("div",Re,[f("div",Ce,[n(v,null,{default:a(()=>[n(p,{contentData:e.labResults},null,8,["contentData"])]),_:1})])])]),_:1}),n(m,{translucent:!0},{default:a(()=>[n(u,null,{default:a(()=>[n(D,{onClick:t[1]||(t[1]=Y=>e.saveResults()),name:"Save",fill:"clear",iconSlot:"icon-only",style:{float:"right"}})]),_:1})]),_:1})]),_:1},8,["is-open","keyboard-close"])}const Ge=M(Oe,[["render",$e],["__scopeId","data-v-52d5f2cf"]]),ke=I({components:{IonButtons:x,IonButton:W,IonModal:V,IonHeader:T,IonContent:F,IonToolbar:L,IonTitle:B,IonItem:U,IonList:z,IonAvatar:ne,IonImg:se,IonLabel:te,IonPage:ee,IonMenu:q,BasicForm:j,IonFooter:A,DynamicButton:N},data(){return{popoverStatus:null}},props:{keyboardClose:{type:Boolean,default:!1},keepContentsMounted:{type:Boolean,default:!1},content:{default:[]},popoverOpen:{type:Boolean,default:!1},event:{type:Event,default:""},title:{type:String,default:""}},methods:{dismiss(){G.dismiss()},nav(e,t){this.dismiss(),this.$router.push(e)}}}),Be={class:"modal_wrapper"},Le={class:"center text_12"};function Fe(e,t,s,i,g,c){const l=o("ion-title"),r=o("ion-button"),d=o("ion-buttons"),u=o("ion-toolbar"),h=o("ion-header"),p=o("ion-col"),v=o("ion-row"),y=o("ion-content"),D=o("ion-modal");return w(),k(D,{"is-open":e.popoverOpen,"show-backdrop":!0,onDidDismiss:t[1]||(t[1]=m=>e.$emit("closePopoover",!1)),"keyboard-close":e.keyboardClose},{default:a(()=>[n(h,null,{default:a(()=>[n(u,null,{default:a(()=>[n(l,null,{default:a(()=>[f("b",null,"Lab results for ("+S(e.content.name)+") test",1)]),_:1}),n(d,{slot:"end"},{default:a(()=>[n(r,{onClick:t[0]||(t[0]=m=>e.$emit("closeModal"))},{default:a(()=>t[2]||(t[2]=[b("Close")])),_:1,__:[2]})]),_:1})]),_:1})]),_:1}),n(y,{class:"ion-padding"},{default:a(()=>[f("div",Be,[f("div",Le,[n(v,null,{default:a(()=>[(w(!0),ae(oe,null,re(e.content.result,(m,O)=>(w(),k(p,{size:"4",key:O},{default:a(()=>[n(v,null,{default:a(()=>[n(p,{size:"8"},{default:a(()=>[b(S(m.indicator.name),1)]),_:2},1024),n(p,{class:"bold",size:"0.5"},{default:a(()=>t[3]||(t[3]=[b(":")])),_:1,__:[3]}),n(p,{class:"bold",size:"2"},{default:a(()=>[b(S(m.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),_:1})]),_:1},8,["is-open","keyboard-close"])}const je=M(ke,[["render",Fe],["__scopeId","data-v-5d6713fe"]]),Q=Z("investigationNCDStore",{state:()=>({investigations:[{db_data:[],isFinishBtn:!1,selectedData:[],displayData:[],data:{rowData:[{colData:[{inputHeader:"Test",icon:H.search,value:"",name:"test",popOver:!0,eventType:"input",required:!0,alertsErrorMassage:"",isSingleSelect:!0,trackBy:"concept_id",multiSelectData:[],id:"",idName:"test_id",validationFunctionName:"required"},{inputHeader:"Specimen",icon:H.search,value:"",name:"specimen",eventType:"input",required:!0,alertsErrorMassage:"",disabled:!0,isSingleSelect:!0,trackBy:"concept_id",multiSelectData:[],id:"",idName:"specimen_id",validationFunctionName:"required"}]}]}}]}),actions:{setInvestigations(e){this.investigations=e}}}),Te=I({data:()=>({userRole:"",ready:!1,userRoleSettings:{}}),watch:{$route:{async handler(e){this.userRole=E.getUserRoles();const t=E.getProgramID(),s=E.getProgramName();this.userRole=="Lab"&&t==14&&(this.userRoleSettings={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}),t==14&&this.userRole!="Lab"&&(this.userRoleSettings={url:"home",btnName:"Go to waiting list",stepperTitle:"Consultation Plan"}),t==12&&(this.userRoleSettings={url:"contact",btnName:"Back"}),s=="LABOUR AND DELIVERY PROGRAM"&&(this.userRoleSettings={url:"labour/labourHome",btnName:"Back to home"}),s=="PNC PROGRAM"&&(this.userRoleSettings={url:"pnc/home",btnName:"Back to home"})},immediate:!0,deep:!0}}}),Ne=I({name:"Menu",mixins:[Te],components:{IonContent:F,IonHeader:T,IonItem:U,IonList:z,IonMenu:q,IonTitle:B,IonToolbar:L,IonInput:ue,IonPopover:de,DashBox:Ie,SelectionPopover:De,BasicInputField:ye,BasicForm:j,List:ge,DynamicButton:N},data(){return{segmentContent:"Lab Investigations",iconsContent:H,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",testResult:"",test:"",labOrders:"",filteredSpecimen:"",testData:[],popoverOpen:!1,labOrderStatus:!1,event:"",specimen:"",radiologyOrdersStatus:!1,otherOrdersStatus:!1}},setup(){return{checkmark:pe,pulseOutline:ce}},computed:{...$(Q,["investigations"]),...$(le,["patient"]),inputFields(){return this.investigations[0].data.rowData[0].colData}},watch:{investigations:{handler(){this.setDashedBox()},deep:!0},patient:{async handler(){this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved]},deep:!0},$route:{async handler(){await this.getTests()},deep:!0}},async mounted(){await this.getTests(),this.updateInvestigationsStores(),this.setDashedBox(),this.updateInvestigationWizard()},methods:{dismiss(){G.dismiss()},setSegmentContent(e){this.segmentContent=e},async getTests(){const e=await P("testTypes");_(this.investigations,"test","multiSelectData",e)},toggleLabOrderStatus(){this.labOrderStatus=!this.labOrderStatus},async updateInvestigationWizard(){this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved];const e=await this.labOrders.filter(t=>R.toStandardHisFormat(R.sessionDate())===R.toStandardHisFormat(t.order_date));e.length>0?this.investigations[0].selectedData=e:this.investigations[0].selectedData=""},async updateInvestigationsStores(){await this.updateInvestigationWizard(),Q().setInvestigations(this.investigations)},displayInputFields(){this.testResult="",this.selectedText="",this.no_item=!1,this.addItemButton=!1,this.search_item=!0},async validateRowData(){return X(this.investigations)},async checkTest(){return await this.isNameInData(this.inputFields[0].value.name,await this.investigations[0].selectedData)?(_(this.investigations,"test","alertsErrorMassage","Lab order already selected"),!1):(_(this.investigations,"test","alertsErrorMassage",""),!0)},async addNewRow(){X(this.investigations)&&await this.checkTest()&&(await this.saveTest(),this.investigations[0].data.rowData[0].colData[0].value="",this.investigations[0].data.rowData[0].colData[1].value="",this.search_item=!1,this.display_item=!0,this.addItemButton=!0),this.updateInvestigationWizard(),this.dismiss()},isNameInData(e,t){for(let s of t)for(let i of s.tests)if(i.name===e)return!0;return!1},async saveTest(){var g,c,l,r,d,u;const e=[{concept_id:this.inputFields[0].value.concept_id,name:this.inputFields[0].value.name,specimen:this.inputFields[1].value.name,reason:"Routine",specimenConcept:await J.getConceptID(this.inputFields[1].value.name,!0)}];let s=(await C.buildLabOrders("",e))[0];s.order_date=s.date,s.specimen.name=this.inputFields[1].value.name,s.tests[0].name=this.inputFields[0].value.name;const i=JSON.parse(JSON.stringify(this.patient));(l=(c=(g=i.labOrders)!=null?g:i.labOrders={}).unsaved)!=null||(c.unsaved=[]),(u=(d=(r=i.labOrders)!=null?r:i.labOrders={}).saved)!=null||(d.saved=[]),i.labOrders.unsaved.push(s),await ie(i),_(this.investigations,"specimen","disabled",!0),this.labOrders=[...i.labOrders.saved,...i.labOrders.unsaved]},async handleInputData(e){if(e.inputHeader=="Test"&&this.checkTest(),_(this.investigations,"specimen","alertsErrorMassage",""),e.inputHeader=="Test"&&e.value){const t=await P("specimens");this.specimen=await J.getConceptSet(e.value.name,"",{names:t.map(s=>s.name)}),this.specimen.length==1?(_(this.investigations,"specimen","value",this.specimen[0]),_(this.investigations,"specimen","disabled",!0)):(_(this.investigations,"specimen","value",""),_(this.investigations,"specimen","disabled",!1)),_(this.investigations,"specimen","multiSelectData",this.specimen)}},async filterTest(e){return await this.labOrders.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()))},async filterSpecimen(e){var t;return(t=this.specimen[0])!=null&&t.name&&e?await this.specimen.filter(s=>s==null?void 0:s.name.toLowerCase().includes(e.toLowerCase())):[]},setTest(e){this.selectedText=e.name,this.inputFields[1].inputHeader=="Test"?this.investigations[0].data.rowData[0].colData[0].value=e.name:this.investigations[0].data.rowData[0].colData[1].value=e.name,this.updateInvestigationsStores()},setDashedBox(){(this.inputFields[1].value||this.inputFields[0].value)&&(this.addItemButton=!1,this.search_item=!0,this.no_item=!1),this.investigations[0].selectedData.length>0?(this.display_item=!0,this.no_item=!1):this.search_item||(this.no_item=!0)}}}),Me={class:"modal_wrapper"},Ee={class:""};function Pe(e,t,s,i,g,c){const l=o("ion-title"),r=o("ion-icon"),d=o("ion-header"),u=o("basic-form"),h=o("ion-content"),p=o("DynamicButton"),v=o("ion-col"),y=o("ion-row"),D=o("ion-footer");return w(),ae(oe,null,[n(d,{style:{display:"flex","justify-content":"space-between"}},{default:a(()=>[n(l,{class:"modalTitle"},{default:a(()=>t[2]||(t[2]=[b("Add Lab Test")])),_:1,__:[2]}),n(r,{onClick:t[0]||(t[0]=m=>e.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:e.iconsContent.cancel},null,8,["icon"])]),_:1}),n(h,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:a(()=>[f("div",Me,[f("div",Ee,[n(u,{contentData:e.investigations,"onUpdate:selected":e.handleInputData,"onUpdate:inputValue":e.handleInputData},null,8,["contentData","onUpdate:selected","onUpdate:inputValue"])])])]),_:1}),n(D,{collapse:"fade",class:"ion-no-border"},{default:a(()=>[n(y,null,{default:a(()=>[n(v,null,{default:a(()=>[n(p,{onClick:t[1]||(t[1]=m=>e.addNewRow()),name:"Save",fill:"solid",style:{float:"right",margin:"2%",width:"130px"}})]),_:1})]),_:1})]),_:1})],64)}const Ye=M(Ne,[["render",Pe],["__scopeId","data-v-97b2e51e"]]),He=I({name:"CheckInConfirmationModal",components:{IonCol:fe,IonRow:_e,IonFooter:A,DynamicButton:N,IonModal:V,IonHeader:T,IonToolbar:L,IonTitle:B,IonButtons:x,IonButton:W,IonContent:F,IonIcon:me},props:{isOpen:{type:Boolean,required:!0,default:!1},closeModalFunc:{type:Function,required:!0},onYes:{type:Function,required:!0},onNo:{type:Function,required:!0},title:{type:String,required:!0}},computed:{},methods:{closeOutline(){return he},closeModal(){this.closeModalFunc()},confirm(e){this.closeModal()}}}),Ae={style:{display:"flex"}};function qe(e,t,s,i,g,c){const l=o("ion-title"),r=o("ion-icon"),d=o("ion-button"),u=o("ion-buttons"),h=o("ion-col"),p=o("DynamicButton"),v=o("ion-row"),y=o("ion-footer"),D=o("ion-content"),m=o("ion-modal");return w(),k(m,{"is-open":e.isOpen,"show-backdrop":!0,onDidDismiss:e.closeModal},{default:a(()=>[n(u,{slot:"start"},{default:a(()=>[n(l,{style:{color:"#0c0c0c"}},{default:a(()=>[b(S(e.title),1)]),_:1}),n(d,{onClick:e.closeModal},{default:a(()=>[n(r,{slot:"icon-only",icon:e.closeOutline(),style:{color:"#b02a37"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:1}),n(D,null,{default:a(()=>[f("div",Ae,[n(y,{collapse:"fade",class:"ion-no-border"},{default:a(()=>[n(v,null,{default:a(()=>[n(h,null,{default:a(()=>[n(d,{id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"},onClick:e.onNo},{default:a(()=>t[1]||(t[1]=[b(" Cancel ")])),_:1,__:[1]},8,["onClick"])]),_:1}),n(h,null,{default:a(()=>[n(p,{name:"Send",onClick:t[0]||(t[0]=O=>e.onYes()),fill:"solid",style:{float:"right",margin:"2%",width:"130px"}})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1},8,["is-open","onDidDismiss"])}const Je=M(He,[["render",qe],["__scopeId","data-v-be6bf3e1"]]);class Xe extends C{constructor(){super()}async postActivities(t,s){const i=s.location_id,c=await new we(parseInt(t),-1,i).createEncounter();if(c){const l=await C.buildLabOrders(c,s.orders||s);if(!await C.saveOrdersArray(c.encounter_id,l))return Se("Unable to save lab orders")}}}export{Ye as E,je as L,Je as S,Te as _,Ge as a,Xe as b,K as u};

import{S as p,H as $,cC as L,cB as N,cp as O,m as A,cz as E,_ as H}from"./index-Cd6xOYoL.js";import{R as U,H as z,a as M,b as F}from"./ReportMixin.vue_vue_type_script_lang-nXp60ZJr.js";import{t as q,a as j}from"./Export-DSqnESOX.js";import{d as G,d0 as J,eg as K,ac as Q,ab as W,D as X,db as Y,V as Z,U as x,ao as ee,au as oe,S as te,bS as P,E as n,e as se,f as m,i as ae,y as d,m as g,v as ne,l as t,z as s,A as r,B as i,k as f,F as re}from"./vendor-DowD5zKn.js";const ie=G({components:{HisStandardForm:M,IonHeader:te,ReportTable:z,HisFooter:N,IonPage:oe,IonContent:ee,IonToolbar:x,Pagination:L,ReportFilter:U,IonFooter:Z,IonChip:Y,IonLabel:X,IonCol:W,IonRow:Q,IonThumbnail:K,IonImg:J},props:{title:{type:String,required:!0},customFilter:{type:Function},period:{type:String,default:""},encryptPDF:{type:Boolean,default:!1},config:{type:Object},fields:{type:Array,default:()=>[]},columns:{type:Array,required:!0},rows:{type:Array,required:!0},paginated:{type:Boolean,default:!1},customBtns:{type:Array,default:()=>[]},canExportPDf:{type:Boolean,default:!0},canExportCsv:{type:Boolean,default:!0},onReportConfiguration:{type:Function,required:!1},rowParser:{type:Function},showFilters:{type:Boolean,default:!1},showVLFilter:{type:Boolean,default:!1},rowsPerPage:{type:Number},asyncRows:{type:Function},footerColor:{type:String,default:"dark"},customFileName:{type:String,default:""},canExport:{type:Boolean,default:!0},showReportStamp:{type:Boolean,default:!0},customInfo:{type:Object},reportPrefix:{type:String,default:""}},data:()=>({formData:{},computeFormData:{},btns:[],isLoadingData:!1,showForm:!1,logo:"@/public/assets/images/login-logos/Malawi-Coat_of_arms_of_arms.png",isTableLoading:!1,searchFilter:"",itemsPerPage:50,itemsVLtype:"",currentPage:0,tableRows:[],totalPages:0,activeColumns:[],activeRows:[],date:$.toStandardHisDisplayFormat(p.getSessionDate()),apiVersion:p.getApiVersion(),coreVersion:p.getCoreVersion(),siteUUID:p.getSiteUUID(),tableCssTheme:"opd-report-theme"}),methods:{getFileName(){var e,o;return"".concat((e=this.reportPrefix)!=null?e:""," ").concat(p.getLocationName()," ").concat(E(this.title).replace(this.reportPrefix,"")," ").concat((o=this.period)!=null?o:this.date)},pdfEncryptionData(){const e=p.getUserName();return{encryption:{userPassword:e,ownerPassword:e,userPermissions:["print"]}}},async onFinish(e,o){this.formData=e,this.computeFormData=o,this.showForm=!1,await this.presentLoading();try{this.onReportConfiguration&&await this.onReportConfiguration(this.formData,this.computeFormData),P.dismiss()}catch(u){console.error(u),A("".concat(u)),P.dismiss()}},async reloadReport(){await this.onFinish(this.formData,this.computeFormData)},async presentLoading(){await(await P.create({message:"Please wait...",backdropDismiss:!1})).present()}},created(){this.showForm=!!this.fields.length,this.btns=this.customBtns,this.btns.push({name:"CSV",size:"large",slot:"start",color:"primary",visible:this.canExportCsv,onClick:async()=>{const{columns:e,rows:o}=F(this.columns,this.rows,"csvMode");q(e,[...o,["Date Created: ".concat(this.date)],["Period: ".concat(this.period)],["MaHIS Version: ".concat(this.coreVersion)],["API Version: ".concat(this.apiVersion)],["Site UUID: ".concat(this.siteUUID)]],this.getFileName())}},{name:"PDF",size:"large",slot:"start",color:"primary",visible:this.canExportPDf,onClick:async()=>{let e="pdfMode";this.encryptPDF&&(e=await O("Security warning","PDF may contain private data that will require a password to unlock","To access private data choose Secure PDF over Regular PDF",[{name:"Secure PDF",slot:"start",color:"success"},{name:"Regular PDF",slot:"start",color:"success"}],"his-danger-color")==="Secure PDF"?"pdfMode":"ignorePDFColumnexport");const{columns:o,rows:u}=F(this.activeColumns,this.activeRows,e);j(o,u,this.getFileName(),!1,this.encryptPDF&&e!="ignorePDFColumnexport"?this.pdfEncryptionData():{})}},{name:"Back",size:"large",slot:"end",color:"primary",visible:!0,onClick:()=>this.showForm=!0},{name:"Refresh",size:"large",slot:"end",color:"warning",visible:!0,onClick:()=>this.reloadReport()},{name:"Finish",size:"large",slot:"end",color:"success",visible:!0,onClick:()=>this.$router.push({path:"/"})})}}),le={class:"report-content"};function pe(e,o,u,y,ue,me){const b=n("his-standard-form"),C=n("ion-img"),D=n("ion-thumbnail"),l=n("ion-col"),v=n("pan"),w=n("ion-row"),R=n("report-filter"),c=n("ion-toolbar"),S=n("ion-header"),I=n("report-table"),V=n("ion-content"),k=n("pagination"),h=n("ion-chip"),B=n("ion-footer"),T=n("his-footer"),_=n("ion-page");return m(),se(re,null,[ae(t(b,{onOnFinish:e.onFinish,skipSummary:!0,fields:e.fields},null,8,["onOnFinish","fields"]),[[ne,e.showForm]]),e.showForm?g("",!0):(m(),d(_,{key:0},{default:s(()=>[t(S,null,{default:s(()=>[t(c,null,{default:s(()=>[t(w,null,{default:s(()=>[t(l,null,{default:s(()=>[t(D,{slot:"start"},{default:s(()=>[t(C,{src:e.logo},null,8,["src"]),o[9]||(o[9]=r(" dpbnbnbnbn "))]),_:1,__:[9]})]),_:1}),t(l,null,{default:s(()=>[t(w,{style:{width:"200%"}},{default:s(()=>[t(l,null,{default:s(()=>[r(" Title: "+i(e.title),1)]),_:1}),t(l,null,{default:s(()=>[r(" Period: "+i(e.period),1)]),_:1}),t(l,null,{default:s(()=>[e.customInfo?(m(),d(v,{key:0},{default:s(()=>[r(i(e.customInfo.label)+": "+i(e.customInfo.value),1)]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1}),t(l,null,{default:s(()=>[t(R,{slot:"end",showPerPageFilter:e.showFilters||e.paginated,disableSearchFilter:e.isTableLoading,disablePerPageFilter:e.isTableLoading,totalRowCount:e.tableRows.length,customFilter:e.customFilter,onOnItemsPerPage:o[0]||(o[0]=a=>e.itemsPerPage=a),onOnItemsVLtype:o[1]||(o[1]=a=>e.itemsVLtype=a),onOnSearchFilter:o[2]||(o[2]=a=>e.searchFilter=a)},null,8,["showPerPageFilter","disableSearchFilter","disablePerPageFilter","totalRowCount","customFilter"])]),_:1})]),_:1})]),_:1})]),_:1}),t(V,null,{default:s(()=>[f("div",le,[t(I,{rows:e.rows,paginated:e.paginated,asyncRows:e.asyncRows,rowParser:e.rowParser,config:{...e.config,tableCssTheme:e.tableCssTheme},columns:e.columns,showFilters:e.showFilters,newPage:e.currentPage,searchFilter:e.searchFilter,rowsPerPage:e.itemsPerPage,onOnIsLoading:o[3]||(o[3]=a=>e.isTableLoading=a),onOnTableRows:o[4]||(o[4]=a=>e.tableRows=a),onOnPagination:o[5]||(o[5]=a=>e.totalPages=a.length),onOnActiveColumns:o[6]||(o[6]=a=>e.activeColumns=a),onOnActiveRows:o[7]||(o[7]=a=>e.activeRows=a)},null,8,["rows","paginated","asyncRows","rowParser","config","columns","showFilters","newPage","searchFilter","rowsPerPage"])])]),_:1}),t(B,null,{default:s(()=>[!e.searchFilter&&e.paginated||!e.searchFilter&&e.totalPages>0&&e.paginated?(m(),d(c,{key:0},{default:s(()=>[t(k,{onClickPrevious:()=>{},onClickNext:()=>{},page:1,disableNext:!1,disablePrevious:!1,perPage:e.itemsPerPage,maxVisibleButtons:10,totalPages:e.totalPages,onOnChangePage:o[8]||(o[8]=a=>e.currentPage=a)},null,8,["perPage","totalPages"])]),_:1})):g("",!0),e.showReportStamp?(m(),d(c,{key:1},{default:s(()=>[t(h,{color:"primary"},{default:s(()=>[o[10]||(o[10]=r("Date Created: ")),f("b",null,i(e.date),1)]),_:1,__:[10]}),t(h,{color:"primary"},{default:s(()=>[o[11]||(o[11]=r("MaHIS Version: ")),f("b",null,i(e.coreVersion),1)]),_:1,__:[11]}),t(h,{color:"primary"},{default:s(()=>[o[12]||(o[12]=r("API Version: ")),f("b",null,i(e.apiVersion),1)]),_:1,__:[12]})]),_:1})):g("",!0)]),_:1}),t(T,{color:e.footerColor,btns:e.btns},null,8,["color","btns"])]),_:1}))],64)}const he=H(ie,[["render",pe],["__scopeId","data-v-83fac94b"]]);export{he as R};

!function(){function t(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}System.register(["./vendor-legacy-db6c81d0.js","./index-legacy-4bda190e.js","./lodash-legacy-78c9f2a0.js"],(function(e,n){"use strict";var r,a,s,i,o,u,l,c,d,f,p,m,h,g,b,y,D,w,v,$,P,M,Y,B,j,F,_,A,Q,q,I,S,V,x,O,C,R;return{setters:[t=>{r=t.dJ,a=t.r,s=t.c,i=t.eo,o=t.bT,u=t.bU,l=t.N,c=t.ep,d=t.dK,f=t.X,p=t.d,m=t.e,h=t.y,g=t.z,b=t.l,y=t.x,D=t.U,w=t.R,v=t.b1,$=t.V,P=t.I,M=t.aM,Y=t.S,B=t.A,j=t.B,F=t.a6,_=t.eq,A=t.b5,Q=t.er},t=>{q=t.c,I=t.A,S=t.a,V=t.b,x=t.u,O=t._,C=t.p},t=>{R=t.l}],execute:function(){var n=document.createElement("style");n.textContent=".close-button[data-v-dd3e8006]{float:right;margin-top:0;padding-top:0;font-size:x-large;cursor:pointer}\n",document.head.appendChild(n),e({a:function(t,e=3e3){return async function(t,e,n){const r=await d.create({message:t,position:"top",animated:!0,duration:n,color:e,cssClass:"his-md-text",keyboardClose:!0,buttons:[{side:"end",text:"x",role:"cancel"}]});return r.present()}(t,"warning",e)},b:at,c:function(t,e,n){return{label:"CSV",color:"primary",action:async(r,a,s,i)=>{et({rows:a,filters:s,columns:i,quarter:e,period:n,filename:t})}}},d:function(t,e,n,r){return{label:"PDF",color:"primary",action:async(a,s,l,c)=>{let d=e&&await S("PDF may contain private data that will require a password to unlock, To access private data choose Secure PDF over Regular PDF",{header:"Security warning",confirmBtnLabel:"Secure PDF",cancelBtnLabel:"Regular PDF"});!function(t){const{filename:e,canHorizontalPageBreak:n,columns:r,rows:a,filters:s,safeMode:l}=t,c=[X(r,l)],d=Z(r,i(a,(null==s?void 0:s.sort)||[]),l),f=l?function(){const t=V().getUser().username;return{encryption:{userPassword:t,ownerPassword:t,userPermissions:["print"]}}}():{},p=new o({...f}),m=p.splitTextToSize(U(e),180),h=m.length<=1?20:10*m.length;p.text(m,14,10);const g={startY:h,head:c,body:d};n&&(g.tableWidth="wrap",g.horizontalPageBreak=!0,g.horizontalPageBreakRepeat=0);u(p,g);const b=`${e}.pdf`;p.save(b)}({rows:s,filters:l,columns:c,quarter:n,period:r,filename:t,safeMode:d})}}},e:et,f:st,g:function(t=5){const e=[];let n=l();for(let r=0;r<t;r++)e.push({start:n.startOf("quarter").format("YYYY-MM-DD"),end:n.endOf("quarter").format("YYYY-MM-DD"),name:`Q${n.quarter()} ${n.year()}`}),n=n.subtract(1,"quarter");return e},h:function(t,e=l()){return e.diff(t,"years")},i:function(t,e){return l(t).isBefore(e)||l(t).isSame(e)},p:function(t){return parseInt(t.split("-")[2])||1/0},s:U,t:function(t){const e=`${t}`.toUpperCase();if("M"===e||"MALE"===e)return"Male";if("F"===e||"FEMALE"===e)return"Female";if(/fbf|fnp|fp/i.test(t))return e;return t}});e("l",{show:async t=>(await r.create({message:t||"Loading...",spinner:"crescent",translucent:!0})).present(),async hide(){r.getTop().then((t=>t?r.dismiss():null))}});function U(t){return t.replace(/<(?:.|\n)*?>/gm," ").replace(/(\r\n|\n|\r|\t|\s{2,}|[=,])/g," ").trim()}const k=a(""),E=a(""),L=a(""),T=s((()=>`${k.value||"-"} / ${E.value||"-"}`));function z(){k.value=`v${q.version}`,L.value=q.version}async function N(){const t=await I.get("version");let e=await t.json();E.value=e["System version"]||"-"}function H(){const[t,e,n]=L.value.split("."),[r,a,s]=E.value.split(".");return!((parseInt(r)||0)<(parseInt(t)||0))&&(!((parseInt(a)||0)<(parseInt(e)||0))&&!((parseInt(s)||0)<(parseInt(n)||0)))}const{appVersion:J,apiVersion:W}={appVersion:k,apiVersion:E,minApiVersion:L,fullVersion:T,loadAppVersions:z,loadApiVersion:N,isValidApiVersion:H},{facilityUUID:G}=x();function K(t,e){return e||!1!==t.exportable}function X(t,e=!1){return t.filter((t=>K(t,e))).map((t=>t.label))}function Z(t,e,n=!1){return e.map((e=>t.filter((t=>K(t,n))).map((t=>{let n=R.get(e,t.path,"");return"function"==typeof t.formatter&&n&&(n=t.formatter(n,e)),U(`${t.drillable&&Array.isArray(n)?n.length:n}`)}))))}function tt(t){const{columns:e,rows:n,quarter:r,period:a,filters:s,safeMode:o}=t,u=X(e,o),c=Z(e,i(n,(null==s?void 0:s.sort)||[]),o);let d=u.join(",")+"\n";return d+=c.map((t=>t.join(","))).join("\n"),d+=`\nDate Created:  ${l().format("DD/MMM/YYYY HH:MM:ss")}`,r&&(d+=`\nQuarter: ${r}`),a&&(d+=`\nQuarter: ${a}`),d+=`\ne-Mastercard Version : ${J.value}`,d+=`\nAPI Version ${W.value}`,d+=`\nSite UUID: ${G}`,d}function et(t){const e=new Blob([tt(t)],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.setAttribute("download",`${t.filename}.csv`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}l.extend(c);const nt="YYYY-MM-DD",rt="DD/MMM/YYYY";function at(t){return l(t).format(rt)}function st(t){return l(t).format(nt)}const it=e("m",{async show(t,e,n="custom-summary-modal",r=!0){const a=await f.create({component:t,cssClass:n,backdropDismiss:r,componentProps:e});a.present();const{data:s}=await a.onWillDismiss();if(s)return s},async hide(t){await f.dismiss(t)}});e("D",O(p({__name:"DrilldownTable",props:{title:{type:String,default:"Drill down table"},rows:{type:Array,required:!0},columns:{type:Array,required:!1},actionButtons:{type:Array},rowActionButtons:{type:Array},config:{type:Object,default:()=>({showSubmitButton:!1})}},setup:t=>(e,n)=>(m(),h(y(A),null,{default:g((()=>[b(y(D),null,{default:g((()=>[b(y(w),null,{default:g((()=>[b(y(v),{slot:"end"},{default:g((()=>[b(y($),{slot:"end",onClick:n[0]||(n[0]=t=>y(it).hide()),"icon-only":""},{default:g((()=>[b(y(P),{icon:y(M)},null,8,["icon"])])),_:1})])),_:1}),b(y(Y),null,{default:g((()=>[B(j(t.title),1)])),_:1})])),_:1})])),_:1}),b(y(F),null,{default:g((()=>[b(y(_),{rows:t.rows,columns:t.columns,config:t.config,"row-actions-buttons":t.rowActionButtons,"actions-buttons":t.actionButtons,color:"light"},null,8,["rows","columns","config","row-actions-buttons","actions-buttons"])])),_:1})])),_:1}))}),[["__scopeId","data-v-dd3e8006"]])),e("L",23);e("R",class{constructor(){t(this,"date",void 0),t(this,"startDate",void 0),t(this,"endDate",void 0),t(this,"programId",void 0),t(this,"useDefaultParams",void 0),this.programId=1,this.date=st(),this.endDate="",this.startDate="",this.useDefaultParams=!0}setDate(t){this.date=st(t)}setStartDate(t){this.startDate=st(t)}setEndDate(t){this.endDate=st(t)}getDateIntervalPeriod(){return this.startDate&&this.endDate?`${at(this.startDate)} - ${at(this.endDate)}`:"-"}buildParams(t){let e={};return this.useDefaultParams&&(e.date=this.date,e.program_id=this.programId),this.startDate&&(e.start_date=this.startDate),this.endDate&&(e.end_date=this.endDate),t&&(e={...e,...t}),e}async getReport(t,e){return(await I.get(C(t,this.buildParams(e)))).json()}static getReportQuarters(t=5){const e=[];let n=new Date,r=n.getFullYear();n=new Date(`${r}-${n.getMonth()+1}-${n.getDate()} 00:00`);let a=this.getQtrByDate(n).qtr,s=0;for(4===a&&e.push(this.buildQtrObj("Q1",r+1));s<t;)0===s&&a<4&&e.push(this.buildQtrObj(`Q${a+1}`,r)),e.push(this.buildQtrObj(`Q${a}`,r)),a=a>0?a-=1:a,r=0==a?r-1:r,a=0==a?a+=4:a,s++;return e}static getQtrByDate(t){const e=this.getQuarterBounds(t.getFullYear());for(const n in e){const{start:r,end:a}=e[n];if(t>=new Date(r)&&t<=new Date(a))return e[n]}return null}static buildQtrObj(t,e){const n=this.getQuarterBounds(e),{start:r,end:a}=n[t];return{start:r,end:a,name:`${t} ${e}`}}static getQuarterBounds(t){const e=e=>`${t}-${e}-01 00:00`,n=e=>`${t}-${e}-${(e=>l(`${t}-${e}-01`).daysInMonth())(e)} 00:00`;return{Q1:{qtr:1,start:e("01"),end:n("03")},Q2:{qtr:2,start:e("04"),end:n("06")},Q3:{qtr:3,start:e("07"),end:n("09")},Q4:{qtr:4,start:e("10"),end:n("12")}}}async getMaternalStatus(t,e="pepfar"){var n;if(R.isEmpty(t))return{FP:[],FBf:[]};const r=C("vl_maternal_status",this.buildParams({report_definition:e}));return null!==(n=(await Q.postJson(r,{patient_ids:t})).data)&&void 0!==n?n:{FP:[],FBf:[]}}async buildMaternityAgreggateRows(t,e="pepfar"){const n=R.uniq(Object.values(t).flat(1).map((t=>t instanceof Object?t.patient_id:t))),r=Object.keys(t),a=await this.getMaternalStatus(n,e),s=a.FBf.concat(a.FP);return["FP","FNP","FBf"].map((e=>r.reduce(((n,r)=>({[r]:t[r].filter((t=>{const n=t instanceof Object?t.patient_id:t;return"FNP"===e?!s.includes(n):a[e].includes(n)})),...n})),{ageGroup:"All",gender:e})))}})}}}))}();

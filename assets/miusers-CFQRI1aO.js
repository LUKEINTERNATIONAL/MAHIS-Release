import{dE as $e,dF as Me,d as te,r as b,w as B,a as ce,O as Q,f as U,u as a,bg as Ne,J as n,l as t,I as Fe,G as he,E as Ae,Q as T,K as M,aY as ye,N as G,L as N,a6 as Be,a7 as de,k as S,e as C,m as $,a2 as R,p as E,b0 as W,_ as J,a4 as Oe,a3 as _e,bn as Ue,F as Z,P as ue,bo as we,bq as Pe,M as Te,c as ae,aP as Re,aO as Ve,dA as De,aN as xe,cc as Le,cH as qe,d1 as Ie,bs as je,cq as ze,cp as He,aM as Ge,dG as Je,dH as Ke,dI as Ye,dJ as Qe,dK as Xe,dL as We,dM as Ze,dN as ea,ai as aa,ca as Y,U as ke,a9 as le,bx as ta,dO as sa,a8 as Se,cW as la,cX as re,cm as ra,aa as oa}from"./vendor-CJ0B1s-M.js";import{N as na}from"./NavigationMenu-BYQ8h-Q4.js";import{E as ia}from"./EIRreportsStore-D30G8noC.js";import{B as ua}from"./bottomNavBar-oPHQ4IEJ.js";import{au as Ce,av as P,a7 as ca,U as da,aw as ma,J as fa,H as va,s as oe,_ as me}from"./index-zYQGJmMg.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-CbO1ZLHp.js";function pa(){const _=()=>{const d="0123456789ABCDEF";let i="";for(let p=0;p<6;p++)i+=d[Math.floor(Math.random()*16)];return i};return{getAvatarUrl:(d,i=128)=>{const p="".concat(d),m=$e(Me,{seed:p,size:i,backgroundColor:[_()]}).toString(),v=unescape(encodeURIComponent(m));return"data:image/svg+xml;base64,".concat(btoa(v))}}}const ne="authToken",ie="authTokenExpiry",z=(()=>{async function _(m){try{const v=await fetch("http://localhost:4000/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});if(v!=null&&v.ok){const I=await v.json();localStorage.setItem(ne,I.access_token);const r=Date.now()+3600*1e3;return localStorage.setItem(ie,r.toString()),I}console.error("Login failed:",v==null?void 0:v.statusText);return}catch(v){console.error("Login error:",v);return}}function w(){localStorage.removeItem(ne),localStorage.removeItem(ie)}function d(){return localStorage.getItem(ne)}function i(){return!!d()}function p(){if(!d())return!1;const v=localStorage.getItem(ie);if(!v)return!1;const I=Date.now(),r=parseInt(v,10);return I<r}async function y(){const m={username:"admin",password:"admin123"};try{return!!await _(m)}catch(v){return console.error("Auto-login failed:",v),!1}}return{login:_,logout:w,getToken:d,isAuthenticated:i,isTokenValid:p,autoLogin:y}})(),ga=_=>{var q,j;const w={testingMode:(q=_==null?void 0:_.testingMode)!=null?q:!1,testingBaseUrl:(j=_==null?void 0:_.testingBaseUrl)!=null?j:"http://localhost:4000/api",..._};async function d(f,g,e){z.isTokenValid()==!1&&await z.autoLogin();const l=z.getToken(),c={"Content-Type":"application/json",...l&&{Authorization:"Bearer ".concat(l)}};if(w.testingMode){const H="".concat(w.testingBaseUrl,"/").concat(g),X={method:f.name.toUpperCase(),mode:"cors",headers:c,...e&&{body:JSON.stringify(e)}};try{return await fetch(H,X)}catch(ee){console.error("Testing mode API call failed:",ee);return}}else return e?await f(g,e,c):await f(g,c)}async function i(f,g){z.isTokenValid()==!1&&await z.autoLogin();const e=g?Ce.parameterizeUrl(f,g):f,l=z.getToken(),c={"Content-Type":"application/json",...l&&{Authorization:"Bearer ".concat(l)}};if(w.testingMode){const H=g?"".concat(w.testingBaseUrl,"/").concat(Ce.parameterizeUrl(f,g)):"".concat(w.testingBaseUrl,"/").concat(f);try{return await fetch(H,{method:"GET",mode:"cors",headers:c})}catch(X){console.error("Testing mode API call failed:",X);return}}else return await P.get(e,c)}async function p(f,g){z.isTokenValid()==!1&&await z.autoLogin();const e="".concat(f,"/").concat(g);return d(P.get,e)}async function y(f,g){return d(P.post,f,g)}async function m(f,g,e){const l="".concat(f,"/").concat(g);return d(P.put,l,e)}async function v(f,g){const e="".concat(f,"/").concat(g);return d(P.remove,e,{})}async function I(f,g){const e="".concat(f,"/bulk-delete");return d(P.remove,e,{ids:g})}async function r(f,g,e,l){const c={...l,search:g,...e&&{search_fields:e.join(",")}};return i(f,c)}async function u(f,g=1,e=20,l){const c={...l,page:g,per_page:e};return i(f,c)}async function F(f,g,e="asc",l){const c={...l,sort_by:g,sort_order:e};return i(f,c)}async function O(f,g,e){const l={...e,...g};return i(f,l)}async function x(f,g){try{const e=await p(f,g);return(e==null?void 0:e.ok)||!1}catch(e){return!1}}async function A(f,g){const e="".concat(f,"/count");return g?i("".concat(f,"/count"),g):d(P.get,e)}async function L(f,g,e="GET",l){const c="".concat(f,"/").concat(g);switch(e.toUpperCase()){case"GET":return d(P.get,c);case"POST":return d(P.post,c,l||{});case"PUT":return d(P.put,c,l||{});case"DELETE":return d(P.remove,c,l||{});default:throw new Error("Unsupported HTTP method: ".concat(e))}}function V(f){Object.assign(w,f)}function D(){return{...w}}return{getAll:i,getById:p,create:y,update:m,deleteById:v,bulkDelete:I,search:r,paginate:u,sort:F,filter:O,exists:x,count:A,customQuery:L,configure:V,getConfig:D}},ha=ga,fe=ha(),ya=()=>{const _="programs",w=fe;async function d(p){const y=await w.getAll(_,p);if(y!=null&&y.ok)return await y.json();throw new Error("Failed to retrieve programs.")}async function i(){const p=await ca.getAllPrograms(),y=[];return p.forEach(m=>{y.push({name:m.name,other:m,selected:!1})}),p}return{getPrograms:d,getEMRPrograms:i}},_a=ya(),Ua=()=>{const _="roles",w=fe;async function d(p){const y=await w.getAll(_,p);if(y!=null&&y.ok)return await y.json();throw new Error("Failed to retrieve user roles.")}async function i(){return await da.getAllRoles()}return{getUserRoles:d,getEMRUserRoles:i}},wa=Ua(),Ia={key:0,class:"error-message"},ka={key:1,class:"error-message"},Sa={key:2,class:"error-message"},Ca={key:4,class:"error-message"},ba={key:5,class:"error-message"},Ta={key:0,class:"error-message"},Ea={style:{display:"flex",gap:"20px","margin-top":"8px"}},$a={key:6,class:"error-message"},Ma={key:7,class:"error-message"},Na={key:8,class:"error-message"},Fa={class:"form_el"},Aa=te({__name:"UserFormModal",props:{isOpen:{type:Boolean},editingUser:{}},emits:["save","close"],setup(_,{emit:w}){const d=_,i=w,p=b(!1),y=b(null),m=b([]),v=b({}),I=b(),r=b({name:!1,firstName:!1,lastName:!1,email:!1,password:!1,dateOfBirth:!1,gender:!1,roles:!1,programs:!1}),u=b({name:"",firstName:"",lastName:"",email:"",password:"",gender:"",roles:[],programs:[]}),F=b([]),O=b([]);function x(e){const l=e.value.formattedDate;I.value=va.toStandardHisFormat(l),r.value.dateOfBirth=!1}function A(){y.value?p.value=!1:p.value=!0}const L=e=>{y.value=e.selected_location,A()},V=()=>{u.value={name:"",firstName:"",lastName:"",email:"",password:"",dateOfBirth:"",gender:"",facility:null,roles:[],programs:[]},I.value=null,y.value=null,v.value={},p.value=!1,Object.keys(r.value).forEach(e=>{r.value[e]=!1})},D=()=>{var l;Object.keys(r.value).forEach(c=>{r.value[c]=!1});let e=!0;return u.value.name.trim()||(r.value.name=!0,e=!1),u.value.firstName.trim()||(r.value.firstName=!0,e=!1),u.value.lastName.trim()||(r.value.lastName=!0,e=!1),u.value.email.trim()||(r.value.email=!0,e=!1),!d.editingUser&&!((l=u.value.password)!=null&&l.trim())&&(r.value.password=!0,e=!1),I.value||(r.value.dateOfBirth=!0,e=!1),u.value.gender||(r.value.gender=!0,e=!1),u.value.roles.length||(r.value.roles=!0,e=!1),u.value.programs.length||(r.value.programs=!0,e=!1),e},q=async()=>{try{const l=await _a.getEMRPrograms();F.value=l.map(c=>c.name)}catch(e){console.error("Failed to fetch programs:",e),oe("Failed to load programs.")}},j=async()=>{try{const l=await wa.getEMRUserRoles();O.value=l.map(c=>c.role)}catch(e){oe("Failed to load roles.")}};B(()=>u.value.name,()=>{u.value.name.trim()&&(r.value.name=!1)}),B(()=>u.value.firstName,()=>{u.value.firstName.trim()&&(r.value.firstName=!1)}),B(()=>u.value.lastName,()=>{u.value.lastName.trim()&&(r.value.lastName=!1)}),B(()=>u.value.email,()=>{u.value.email.trim()&&(r.value.email=!1)}),B(()=>u.value.password,()=>{var e;(e=u.value.password)!=null&&e.trim()&&(r.value.password=!1)}),B(()=>u.value.gender,()=>{u.value.gender&&(r.value.gender=!1)}),B(()=>u.value.roles,()=>{u.value.roles.length>0&&(r.value.roles=!1)}),B(()=>u.value.programs,()=>{u.value.programs.length>0&&(r.value.programs=!1)}),B(()=>d.editingUser,e=>{if(e){const l=e.name.split(" "),c=l[0]||"",H=l.length>1?l.slice(1).join(" "):"";u.value={name:e.name,firstName:c,lastName:H,email:e.email,dateOfBirth:e.dateOfBirth||"",gender:e.gender||"",facility:e.facility||null,roles:e.roles,programs:e.programs},e.dateOfBirth&&(I.value=e.dateOfBirth),e.facility&&(y.value=e.facility,v.value=e.facility)}else V()},{immediate:!0}),B(()=>d.isOpen,e=>{e&&V()});const f=async()=>{const e=D();if(A(),!e||p.value){oe("Please fill out all required fields.");return}const l={...u.value,dateOfBirth:I.value,facility:y.value};i("save",l)},g=()=>{i("close")};return ce(()=>{V(),q(),j()}),(e,l)=>(U(),Q(a(Ne),{"is-open":e.isOpen,onDidDismiss:g},{default:n(()=>[t(a(Fe),null,{default:n(()=>[t(a(he),null,{default:n(()=>[t(a(Ae),null,{default:n(()=>[T(M(e.editingUser?"Edit User":"Add New User"),1)]),_:1}),t(a(ye),{slot:"end"},{default:n(()=>[t(a(G),{onClick:g,fill:"clear"},{default:n(()=>[t(a(N),{style:{"font-size":"35px"},icon:a(Be)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),t(a(de),{class:"ion-padding"},{default:n(()=>[S("form",{id:"user-form",onSubmit:Pe(f,["prevent"])},[t(a(R),{class:E({"error-item":r.value.name})},{default:n(()=>[t(a(W),{modelValue:u.value.name,"onUpdate:modelValue":l[0]||(l[0]=c=>u.value.name=c),label:"Username","label-placement":"stacked",placeholder:"Enter username",required:"",class:E({"error-input":r.value.name})},null,8,["modelValue","class"])]),_:1},8,["class"]),r.value.name?(U(),C("div",Ia," Username is required ")):$("",!0),t(a(R),{class:E({"error-item":r.value.firstName})},{default:n(()=>[t(a(W),{modelValue:u.value.firstName,"onUpdate:modelValue":l[1]||(l[1]=c=>u.value.firstName=c),label:"First Name","label-placement":"stacked",placeholder:"Enter first name",required:"",class:E({"error-input":r.value.firstName})},null,8,["modelValue","class"])]),_:1},8,["class"]),r.value.firstName?(U(),C("div",ka," First name is required ")):$("",!0),t(a(R),{class:E({"error-item":r.value.lastName})},{default:n(()=>[t(a(W),{modelValue:u.value.lastName,"onUpdate:modelValue":l[2]||(l[2]=c=>u.value.lastName=c),label:"Last Name","label-placement":"stacked",placeholder:"Enter last name",required:"",class:E({"error-input":r.value.lastName})},null,8,["modelValue","class"])]),_:1},8,["class"]),r.value.lastName?(U(),C("div",Sa," Last name is required ")):$("",!0),e.editingUser?$("",!0):(U(),Q(a(R),{key:3,class:E({"error-item":r.value.password})},{default:n(()=>[t(a(W),{modelValue:u.value.password,"onUpdate:modelValue":l[3]||(l[3]=c=>u.value.password=c),label:"Password","label-placement":"stacked",placeholder:"Enter password",type:"password",required:"",class:E({"error-input":r.value.password})},null,8,["modelValue","class"])]),_:1},8,["class"])),r.value.password&&!e.editingUser?(U(),C("div",Ca," Password is required ")):$("",!0),t(a(R),{class:E({"error-item":r.value.email})},{default:n(()=>[t(a(W),{modelValue:u.value.email,"onUpdate:modelValue":l[4]||(l[4]=c=>u.value.email=c),label:"Email","label-placement":"stacked",placeholder:"Enter email address",type:"email",required:"",class:E({"error-input":r.value.email})},null,8,["modelValue","class"])]),_:1},8,["class"]),r.value.email?(U(),C("div",ba," Email is required ")):$("",!0),S("div",{class:E(["form_el",{"error-section":r.value.dateOfBirth}])},[S("h6",{style:{"font-size":"16px","font-weight":"400"},class:E({"error-label":r.value.dateOfBirth})}," Date Of Birth ",2),t(ma,{place_holder:"Date Of Birth",onDateUpDated:x,date_prop:""}),r.value.dateOfBirth?(U(),C("div",Ta," Date of birth is required ")):$("",!0)],2),t(a(R),{class:E({"error-item":r.value.gender})},{default:n(()=>[t(a(J),{position:"stacked",class:E({"error-label":r.value.gender})},{default:n(()=>[...l[8]||(l[8]=[T("Gender",-1)])]),_:1},8,["class"]),t(a(Oe),{modelValue:u.value.gender,"onUpdate:modelValue":l[5]||(l[5]=c=>u.value.gender=c)},{default:n(()=>[S("div",Ea,[t(a(R),{lines:"none",style:{"--padding-start":"0"}},{default:n(()=>[t(a(_e),{slot:"start",value:"male"}),t(a(J),null,{default:n(()=>[...l[9]||(l[9]=[T("Male",-1)])]),_:1})]),_:1}),t(a(R),{lines:"none",style:{"--padding-start":"0"}},{default:n(()=>[t(a(_e),{slot:"start",value:"female"}),t(a(J),null,{default:n(()=>[...l[10]||(l[10]=[T("Female",-1)])]),_:1})]),_:1})])]),_:1},8,["modelValue"])]),_:1},8,["class"]),r.value.gender?(U(),C("div",$a," Gender is required ")):$("",!0),t(a(R),{class:E({"error-item":r.value.roles})},{default:n(()=>[t(a(Ue),{modelValue:u.value.roles,"onUpdate:modelValue":l[6]||(l[6]=c=>u.value.roles=c),label:"Roles","label-placement":"stacked",placeholder:"Select roles",multiple:"",class:E({"error-input":r.value.roles})},{default:n(()=>[(U(!0),C(Z,null,ue(O.value,c=>(U(),Q(a(we),{key:c,value:c},{default:n(()=>[T(M(c),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","class"])]),_:1},8,["class"]),r.value.roles?(U(),C("div",Ma," At least one role is required ")):$("",!0),t(a(R),{class:E({"error-item":r.value.programs})},{default:n(()=>[t(a(Ue),{modelValue:u.value.programs,"onUpdate:modelValue":l[7]||(l[7]=c=>u.value.programs=c),label:"Programs","label-placement":"stacked",placeholder:"Select programs",multiple:"",class:E({"error-input":r.value.programs})},{default:n(()=>[(U(!0),C(Z,null,ue(F.value,c=>(U(),Q(a(we),{key:c,value:c},{default:n(()=>[T(M(c),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","class"])]),_:1},8,["class"]),r.value.programs?(U(),C("div",Na," At least one program is required ")):$("",!0),S("div",Fa,[l[11]||(l[11]=S("h6",{style:{"font-size":"16px","font-weight":"400"}},"Facility",-1)),t(fa,{show_error:p.value,onFacilitySelected:L,selected_district_ids:m.value,selected_location:v.value},null,8,["show_error","selected_district_ids","selected_location"])])],32)]),_:1}),t(a(Te),null,{default:n(()=>[t(a(he),null,{default:n(()=>[t(a(ye),{slot:"end"},{default:n(()=>[S("div",null,[t(a(G),{onClick:g,fill:"solid"},{default:n(()=>[...l[12]||(l[12]=[T(" Cancel ",-1)])]),_:1}),t(a(G),{onClick:f,fill:"solid",style:{"margin-left":"10px","margin-right":"10px"}},{default:n(()=>[T(M(e.editingUser?"Update":"Create")+" User ",1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"]))}}),Ba=me(Aa,[["__scopeId","data-v-1b8f3b47"]]),Oa=()=>{const _="users",w=fe;async function d(m){const v=await w.customQuery(_,"register","POST",m);if(v!=null&&v.ok)return await v.json();throw new Error("Failed to register user.")}async function i(m){const v=await w.getById(_,m);if(v!=null&&v.ok)return await v.json();throw new Error("User with ID ".concat(m," not found."))}async function p(m,v){const I=await w.update(_,m,v);if(!(I!=null&&I.ok))throw new Error("Failed to update password.")}async function y(){const m=await w.getAll(_);if(m!=null&&m.ok)return await m.json();throw new Error("Failed to fetch users.")}return{register:d,getUserById:i,updatePassword:p,getUsers:y}},be=Oa(),Pa={class:"users-grid"},Ra={class:"user-header"},Va=["src","alt"],Da={class:"user-info"},xa={key:0,class:"user-meta"},La={key:0,class:"meta-item"},qa={key:1,class:"meta-item"},ja={class:"user-details"},za={key:0,class:"detail-item"},Ha={key:1,class:"detail-item"},Ga={key:2,class:"detail-item"},Ja={class:"detail-item"},Ka={class:"detail-item"},Ya={class:"action-buttons"},Qa={key:0,class:"empty-state"},Xa=te({__name:"miUsersTemplate",props:{initialSearchTerm:{default:""},initialStatusFilter:{default:"all"},initialItemsPerPage:{default:6},enableSearch:{type:Boolean,default:!0},enableStatusFilter:{type:Boolean,default:!0},enablePagination:{type:Boolean,default:!0},searchPlaceholder:{default:"Search users..."},searchDebounceTime:{default:300}},emits:["search-changed","status-filter-changed","users-filtered","user-edited","user-deleted","user-status-changed","user-created"],setup(_,{expose:w,emit:d}){const i=_,p=d,y=b([]),m=b(i.initialSearchTerm),v=b(i.initialStatusFilter),I=b(1),r=b(i.initialItemsPerPage),u=b(!1),F=b(null);let O=null;const x=s=>{var o,k,K,ve,pe,ge;const{getAvatarUrl:h}=pa();return{id:s.id,name:s.username,email:s.username,dateOfBirth:(o=s.profile)==null?void 0:o.dateOfBirth,gender:(k=s.profile)==null?void 0:k.gender,facility:(ve=(K=s.facilities)==null?void 0:K[0])!=null&&ve.facility?{name:s.facilities[0].facility.facility_name,code:s.facilities[0].facility.facility_code}:null,roles:((pe=s.roles)==null?void 0:pe.map(se=>se.role.name))||[],programs:((ge=s.programs)==null?void 0:ge.map(se=>se.program.name))||[],status:"active",avatar:h(s.username),createdAt:new Date(s.createdAt),lastActive:new Date(s.updatedAt)}},A=ae(()=>{let s=y.value;if(i.enableSearch&&m.value){const h=m.value.toLowerCase();s=s.filter(o=>o.name.toLowerCase().includes(h)||o.email.toLowerCase().includes(h)||o.roles&&o.roles.some(k=>k.toLowerCase().includes(h))||o.programs&&o.programs.some(k=>k.toLowerCase().includes(h))||o.gender&&o.gender.toLowerCase().includes(h)||o.facility&&o.facility.name&&o.facility.name.toLowerCase().includes(h))}return i.enableStatusFilter&&v.value!=="all"&&(s=s.filter(h=>h.status===v.value)),s}),L=ae(()=>{if(!i.enablePagination)return A.value;const s=(I.value-1)*r.value,h=s+r.value;return A.value.slice(s,h)});B(()=>m.value,s=>{O&&clearTimeout(O),O=setTimeout(()=>{p("search-changed",s),I.value=1},i.searchDebounceTime)},{immediate:!1}),B(()=>v.value,s=>{p("status-filter-changed",s),I.value=1},{immediate:!1}),B(()=>A.value,s=>{p("users-filtered",s)},{deep:!0,immediate:!0});const V=s=>{I.value=s.page,r.value=s.itemsPerPage},D=s=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(s),q=s=>{const h=new Date,o=new Date(s);let k=h.getFullYear()-o.getFullYear();const K=h.getMonth()-o.getMonth();return(K<0||K===0&&h.getDate()<o.getDate())&&k--,k},j=s=>{F.value=s,u.value=!0},f=()=>{u.value=!1,F.value=null},g=async s=>{try{if(F.value){const h=y.value.findIndex(k=>k.id===F.value.id);if(h!==-1){const k={...y.value[h],...s};y.value[h]=k,p("user-edited",k)}(await Y.create({message:"User updated successfully",duration:2e3,color:"success"})).present()}else{const h=await e(s),o=await be.register(h),k=x(o);y.value.push(k),p("user-created",k),(await Y.create({message:"User created successfully",duration:2e3,color:"success"})).present()}f()}catch(h){(await Y.create({message:"Error saving user: ".concat(h.message),duration:2e3,color:"danger"})).present()}},e=async s=>{if(!s||!s.facility)throw new Error("Invalid user data. 'facility' is required.");return{username:s.name,password:s.password,roles:s.roles,programs:s.programs,facilities:[s.facility.code],profile:{firstName:s.firstName,lastName:s.lastName,gender:s.gender,dateOfBirth:"1990-01-01T00:00:00.000Z"}}},l=async s=>{(await ke.create({header:"Confirm Status Change",message:"Are you sure you want to ".concat(s.status==="active"?"deactivate":"activate"," ").concat(s.name,"?"),buttons:[{text:"Cancel",role:"cancel"},{text:"Confirm",handler:()=>{s.status=s.status==="active"?"inactive":"active",p("user-status-changed",s),Y.create({message:"User ".concat(s.status==="active"?"activated":"deactivated"," successfully"),duration:2e3,color:"success"}).then(o=>o.present())}}]})).present()},c=async s=>{(await ke.create({header:"Confirm Delete",message:"Are you sure you want to delete ".concat(s.name,"? This action cannot be undone."),buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",role:"destructive",handler:()=>{const o=y.value.findIndex(k=>k.id===s.id);o!==-1&&(y.value.splice(o,1),p("user-deleted",s.id),Y.create({message:"User deleted successfully",duration:2e3,color:"success"}).then(k=>k.present()))}}]})).present()},H=s=>{m.value=s},X=s=>{v.value=s},ee=async()=>{try{const s=await be.getUsers();y.value=s.map(x)}catch(s){console.error("Failed to fetch MIUM users:",s),Y.create({message:"Failed to load users.",duration:2e3,color:"danger"}).then(h=>h.present())}},Ee=()=>{F.value=null,u.value=!0};return ce(async()=>{await ee()}),w({setSearchTerm:H,setStatusFilter:X,refreshUsers:ee,cleanup:()=>{O&&clearTimeout(O)},openAddUserModal:Ee,users:y.value,filteredUsers:A,paginatedUsers:L}),(s,h)=>(U(),C(Z,null,[t(a(de),{class:"ion-padding",style:{height:"80vh"}},{default:n(()=>[S("div",Pa,[(U(!0),C(Z,null,ue(L.value,o=>(U(),Q(a(Re),{key:o.id,class:"user-card"},{default:n(()=>[t(a(Ve),null,{default:n(()=>[S("div",Ra,[t(a(De),null,{default:n(()=>[S("img",{src:o.avatar,alt:o.name},null,8,Va)]),_:2},1024),S("div",Da,[t(a(xe),null,{default:n(()=>[T(M(o.name),1)]),_:2},1024),t(a(Le),null,{default:n(()=>[T(M(o.email),1)]),_:2},1024),o.gender||o.dateOfBirth?(U(),C("div",xa,[o.gender?(U(),C("span",La,[t(a(N),{icon:a(qe),class:"meta-icon"},null,8,["icon"]),T(" "+M(o.gender),1)])):$("",!0),o.dateOfBirth?(U(),C("span",qa,[t(a(N),{icon:a(Ie),class:"meta-icon"},null,8,["icon"]),T(" "+M(q(o.dateOfBirth))+" years old ",1)])):$("",!0)])):$("",!0)]),t(a(je),{color:o.status==="active"?"success":"medium",class:"status-chip"},{default:n(()=>[t(a(N),{icon:o.status==="active"?a(ze):a(He),slot:"start"},null,8,["icon"]),t(a(J),null,{default:n(()=>[T(M(o.status),1)]),_:2},1024)]),_:2},1032,["color"])])]),_:2},1024),t(a(Ge),null,{default:n(()=>[S("div",ja,[o.roles&&o.roles.length?(U(),C("div",za,[t(a(N),{icon:a(Je),class:"detail-icon"},null,8,["icon"]),S("span",null,M(o.roles.join(", ")),1)])):$("",!0),o.programs&&o.programs.length?(U(),C("div",Ha,[t(a(N),{icon:a(Ke),class:"detail-icon"},null,8,["icon"]),S("span",null,M(o.programs.join(", ")),1)])):$("",!0),o.facility?(U(),C("div",Ga,[t(a(N),{icon:a(Ye),class:"detail-icon"},null,8,["icon"]),S("span",null,M(o.facility.name||"Assigned Facility"),1)])):$("",!0),S("div",Ja,[t(a(N),{icon:a(Ie),class:"detail-icon"},null,8,["icon"]),S("span",null,"Joined "+M(D(o.createdAt)),1)]),S("div",Ka,[t(a(N),{icon:a(Qe),class:"detail-icon"},null,8,["icon"]),S("span",null,"Last active "+M(D(o.lastActive)),1)])]),S("div",Ya,[t(a(G),{onClick:k=>j(o),fill:"outline",size:"small",color:"primary"},{default:n(()=>[t(a(N),{icon:a(Xe),slot:"start"},null,8,["icon"]),h[0]||(h[0]=T(" Edit ",-1))]),_:1},8,["onClick"]),t(a(G),{onClick:k=>l(o),fill:"outline",size:"small",color:o.status==="active"?"warning":"success"},{default:n(()=>[t(a(N),{icon:o.status==="active"?a(We):a(Ze),slot:"start"},null,8,["icon"]),T(" "+M(o.status==="active"?"Deactivate":"Activate"),1)]),_:2},1032,["onClick","color"]),t(a(G),{onClick:k=>c(o),fill:"outline",size:"small",color:"danger"},{default:n(()=>[t(a(N),{icon:a(ea),slot:"start"},null,8,["icon"]),h[1]||(h[1]=T(" Delete ",-1))]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),A.value.length===0?(U(),C("div",Qa,[t(a(N),{icon:a(aa),class:"empty-icon"},null,8,["icon"]),h[2]||(h[2]=S("h3",null,"No users found",-1)),h[3]||(h[3]=S("p",null,"Try adjusting your search or filter criteria",-1))])):$("",!0)]),_:1}),t(a(Te),null,{default:n(()=>[t(ua,{"total-items":A.value.length,"current-page":I.value,"items-per-page":r.value,"onUpdate:pagination":V},null,8,["total-items","current-page","items-per-page"])]),_:1}),t(Ba,{"is-open":u.value,"editing-user":F.value,onSave:g,onClose:f},null,8,["is-open","editing-user"])],64))}}),Wa=me(Xa,[["__scopeId","data-v-fcbcffb9"]]),Za=te({__name:"UserNav",props:{searchTerm:{type:String,required:!0},statusFilter:{type:String,required:!0}},emits:["update:searchTerm","update:statusFilter","openAddUserModal"],setup(_,{emit:w}){return(d,i)=>(U(),C(Z,null,[t(a(Se),{class:"ion-align-items-center"},{default:n(()=>[t(a(le),{size:"8"},{default:n(()=>[t(a(ta),{value:_.searchTerm,onIonInput:i[0]||(i[0]=p=>d.$emit("update:searchTerm",p.detail.value)),placeholder:"Search users...","show-clear-button":"focus",debounce:"300"},null,8,["value"])]),_:1}),t(a(le),{size:"4",class:"ion-text-right"},{default:n(()=>[t(a(G),{onClick:i[1]||(i[1]=p=>d.$emit("openAddUserModal")),fill:"solid"},{default:n(()=>[t(a(N),{icon:a(sa),slot:"start"},null,8,["icon"]),i[3]||(i[3]=T(" Add User ",-1))]),_:1})]),_:1})]),_:1}),t(a(Se),{class:"ion-padding-start ion-padding-end"},{default:n(()=>[t(a(le),{size:"12"},{default:n(()=>[t(a(la),{value:_.statusFilter,onIonChange:i[2]||(i[2]=p=>d.$emit("update:statusFilter",p.detail.value))},{default:n(()=>[t(a(re),{value:"all"},{default:n(()=>[t(a(J),null,{default:n(()=>[...i[4]||(i[4]=[T("All",-1)])]),_:1})]),_:1}),t(a(re),{value:"active"},{default:n(()=>[t(a(J),null,{default:n(()=>[...i[5]||(i[5]=[T("Active",-1)])]),_:1})]),_:1}),t(a(re),{value:"inactive"},{default:n(()=>[t(a(J),null,{default:n(()=>[...i[6]||(i[6]=[T("Inactive",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})],64))}}),et={class:"sticky-user-nav"},at=te({__name:"miusers",setup(_,{expose:w}){const d=b(""),i=b("all"),p=b([]),y=b(0),m=b();ae(()=>d.value),ae(()=>i.value);const v=e=>{d.value=e,console.log("Search term updated:",e)},I=e=>{i.value=e,console.log("Status filter updated:",e)},r=e=>{d.value!==e&&(d.value=e),console.log("Internal search changed:",e)},u=e=>{i.value!==e&&(i.value=e),console.log("Internal filter changed:",e)},F=e=>{y.value=e.length},O=e=>{console.log("User created:",e)},x=e=>{console.log("User edited:",e)},A=e=>{console.log("User deleted:",e)},L=e=>{console.log("User status changed:",e)},V=()=>{m.value?m.value.openAddUserModal():console.log("usersTemplateRef is not yet available.")},D=async()=>{try{console.log("Loading users...")}catch(e){console.error("Error loading users:",e)}},q=async()=>{ia().setNavigationPayload("Manage Integrated Users",!0,!1,"/","home","")},j=()=>{m.value&&m.value.refreshUsers(),D()},f=e=>{d.value=e,m.value&&m.value.setSearchTerm(e)},g=e=>{i.value=e,m.value&&m.value.setStatusFilter(e)};return ce(async()=>{await q(),await D()}),ra(()=>{m.value&&typeof m.value.cleanup=="function"&&m.value.cleanup()}),w({refreshUsers:j,setSearch:f,setFilter:g,searchTerm:d,statusFilter:i,usersList:p,filteredUsersCount:y}),(e,l)=>(U(),Q(a(oa),null,{default:n(()=>[t(na),t(a(de),{fullscreen:!0},{default:n(()=>[S("div",et,[t(Za,{fullscreen:!0,searchTerm:d.value,statusFilter:i.value,"onUpdate:searchTerm":v,"onUpdate:statusFilter":I,onOpenAddUserModal:V},null,8,["searchTerm","statusFilter"])]),t(Wa,{ref_key:"usersTemplateRef",ref:m,"initial-users":p.value,"initial-search-term":d.value,"initial-status-filter":i.value,"search-debounce-time":500,"enable-search":!0,"enable-status-filter":!0,"enable-pagination":!0,onSearchChanged:r,onStatusFilterChanged:u,onUsersFiltered:F,onUserCreated:O,onUserEdited:x,onUserDeleted:A,onUserStatusChanged:L},null,8,["initial-users","initial-search-term","initial-status-filter"])]),_:1})]),_:1}))}}),ct=me(at,[["__scopeId","data-v-5071b8a1"]]);export{ct as default};

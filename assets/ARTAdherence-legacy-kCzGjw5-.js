System.register(["./vendor-legacy-CCRc-I5f.js","./index-legacy-CPVrS3n3.js","./adherence_service-legacy-kuzN1QGx.js","./lodash-legacy-pOOc9Efu.js","./app_encounter_service-legacy-CplDL468.js"],function(e,t){"use strict";var a,n,o,i,r,d,l,s,c,u,p,b,g,h,f,m,v,y,x,w,C,A,I,_,D,E,R,k,q,M,O,B,j,P,T,S,$,G,L,V,W,U;return{setters:[e=>{a=e.R,n=e.d,o=e.W,i=e.e,r=e.f,d=e.k,l=e.F,s=e.L,c=e.B,u=e.p,p=e.I,b=e.aw,g=e.ax,h=e.ar,f=e.D,m=e.G,v=e.M,y=e.J,x=e.ad,w=e.ae,C=e.af,A=e.ag,I=e.ao,_=e.au,D=e.b1,E=e.r,R=e.a,k=e.dU,q=e.ck,M=e.E,O=e.l,B=e.z,j=e.A},e=>{P=e._,T=e.u,S=e.J,$=e.P,G=e.S,L=e.m,V=e.k},e=>{W=e.A},e=>{U=e.l},null],execute:function(){var t=document.createElement("style");t.textContent=".his-table[data-v-fe4ab68f]{width:100%}.his-table>tr>td[data-v-fe4ab68f],.his-table>tr>th[data-v-fe4ab68f]{text-align:left;padding:.5em}.his-table>tr[data-v-fe4ab68f]:nth-child(2n){background-color:#f8f8f8}.table-borders>tr>td[data-v-fe4ab68f],.table-borders tr>th[data-v-fe4ab68f]{border-collapse:collapse;border:1px solid #c5c5c5;text-align:left;padding:8px}.container[data-v-6f75b1b8]{display:flex;flex-direction:column;padding:20px;margin:0 auto}.back_profile[data-v-6f75b1b8]{display:flex;align-items:center;margin-bottom:20px;cursor:pointer}.back_profile ion-icon[data-v-6f75b1b8]{margin-right:5px;font-size:20px}.adherence-card[data-v-6f75b1b8]{width:100%;margin-bottom:20px}.medication-section[data-v-6f75b1b8]{margin-bottom:20px}.medication-header[data-v-6f75b1b8]{font-weight:700;margin-bottom:10px}.medication-inputs[data-v-6f75b1b8]{display:flex;flex-direction:column;gap:10px}.medication-row[data-v-6f75b1b8]{display:flex;justify-content:space-between;align-items:center}.medication-name[data-v-6f75b1b8]{flex:1}.pill-input[data-v-6f75b1b8]{width:100px;border:1px solid #ccc;border-radius:4px;--padding-start: 10px}.last-visit[data-v-6f75b1b8]{margin-bottom:20px;font-weight:700}.adherence-table[data-v-6f75b1b8]{width:100%;border-collapse:collapse;margin-bottom:20px}.table-header[data-v-6f75b1b8]{display:grid;grid-template-columns:1fr 1fr 1fr;background-color:#f0f0f0;font-weight:700;padding:10px 0}.header-cell[data-v-6f75b1b8]{padding:8px;text-align:center}.table-row[data-v-6f75b1b8]{display:grid;grid-template-columns:1fr 1fr 1fr;border-bottom:1px solid #eee}.header-row[data-v-6f75b1b8]{background-color:#f0f0f0;font-weight:700}.row-label[data-v-6f75b1b8]{padding:8px}.row-value[data-v-6f75b1b8]{padding:8px;text-align:center}.adherence-input[data-v-6f75b1b8]{width:80px;margin:0 auto;border:1px solid #ccc;border-radius:4px;--padding-start: 10px}.error-text[data-v-6f75b1b8]{color:red}.agree-section[data-v-6f75b1b8]{display:flex;align-items:center;margin-top:20px}.agree-label[data-v-6f75b1b8]{margin-right:20px}.required[data-v-6f75b1b8]{color:red}.radio-options[data-v-6f75b1b8]{display:flex}.radio-options ion-item[data-v-6f75b1b8]{--padding-start: 0;--inner-padding-end: 0;margin-right:20px}.save-button-container[data-v-6f75b1b8]{display:flex;justify-content:flex-start;margin-top:20px}.save-button[data-v-6f75b1b8]{--background: #006400;--color: white}\n/*$vite$:1*/",document.head.appendChild(t);const H=a("ARTAdherence",{state:()=>({lastVisitDate:"",daysElapsed:40,medications:[],agreeWithCalculation:!0}),actions:{processMedicationData(e){const t=e.getLastDrugs().map(e=>{const t=e.drug.name,a=e.barcodes.reduce((e,t)=>e+t.tabs,0),n=e.frequency||"",o=n.includes("ONCE A DAY")?"1 OOD":n,{expected:i,actual:r,dosesMissed:d,dosesConsumed:l,adherenceStatus:s}=this.calculateAdherence({tabsGiven:a,remaining:0,daysElapsed:this.daysElapsed,frequency:n});return{name:t,remaining:0,tabsGiven:a,tabsPer:o,expected:i,actual:r,dosesMissed:d,dosesConsumed:l,adherenceStatus:s,orderId:e.order.order_id,drugId:e.drug.drug_id,drug:e}});this.medications=t,this.lastVisitDate=e.getReceiptDate()},updateMedicationRemaining(e,t){e>=0&&e<this.medications.length&&(this.medications[e].remaining=t)},updateExpected(e,t){e>=0&&e<this.medications.length&&(this.medications[e].expected=t)},updateActual(e,t){e>=0&&e<this.medications.length&&(this.medications[e].actual=t)},setAgreeWithCalculation(e){this.agreeWithCalculation=e},calculateAdherence({tabsGiven:e,remaining:t,daysElapsed:a,frequency:n}){const o=a*(/once a day/i.test(n)?1:/twice a day/i.test(n)?2:/thrice a day/i.test(n)?3:1),i=e-t,r=Math.max(o-i,0),d=Math.min(i,o);let l="Good";const s=d/o*100;return s<95?l="Explore problem":s<100&&(l="Acceptable"),{expected:o,actual:i,dosesMissed:r,dosesConsumed:d,adherenceStatus:l}}}}),z=n({components:{IonButton:o},props:{styles:{type:Array},rowColors:{type:Array,default:()=>[]},cellColors:{type:Array,default:()=>[]},columns:{type:Object,required:!0},rows:{type:Object}},computed:{classStyles(){return`his-table ${this.styles?this.styles.join(" "):""}`}},methods:{isLink(e){try{return"object"==typeof e&&"link"===e.type}catch(t){return e}},isActionButton(e){try{return"object"==typeof e&&"button"===e.type}catch(t){return e}},getColorCodeClass(e,t){let a="";if(!U.isEmpty(this.rowColors)){const t=this.rowColors.filter(t=>t.indexes.includes(e));U.isEmpty(t)||(a+=" "+t[0].class)}if(!U.isEmpty(this.cellColors)){const n=this.cellColors.filter(a=>a.index===t&&a.row===e);U.isEmpty(n)||(a+=" "+n[0].class)}return a}}}),J=["innerHTML"],Q=n({name:"ARTAdherence",components:{ReportDataTable:P(z,[["render",function(e,t,a,n,o,p){return r(),i("table",{class:u(["his-md-text",e.classStyles])},[d("tr",null,[(r(!0),i(l,null,s(e.columns,(e,t)=>(r(),i("th",{key:t},c(e),1))),128))]),(r(!0),i(l,null,s(e.rows,(t,a)=>(r(),i("tr",{key:a},[(r(!0),i(l,null,s(t,(t,n)=>(r(),i("td",{class:u(e.getColorCodeClass(a,n)),key:n},[d("div",null,[d("span",{innerHTML:t},null,8,J)])],2))),128))]))),128))],2)}],["__scopeId","data-v-fe4ab68f"]]),IonPage:_,IonContent:I,IonCard:A,IonCardHeader:C,IonCardTitle:w,IonCardContent:x,IonAccordion:y,IonAccordionGroup:v,IonItem:m,IonLabel:f,IonInput:h,IonRadio:g,IonRadioGroup:b,IonButton:o,IonIcon:p},setup(){var e,t;const a=D(),n=H();T();const o=S(),i=new $,r=null!==(e=G.getUserID())&&void 0!==e?e:-1,d=(null===(t=o.getfacilityLocation())||void 0===t?void 0:t.code)||"",l=i.getID(),s=new W(l,r,d),c=E([]),u=E([]),p=E([]),b=E([]);function g(e){return s.calculateExpected(e.quantity,e.equivalent_daily_dose,e.order.start_date,h(e.frequency))}function h(e){return`${e}`.match(/qod/i)?"QOD":`${e}`.match(/weekly/i)?"QW":e}function f(){const e=n.medications.map(e=>({...e.drug,pillsBrought:e.remaining})),t=s.getReceiptDate(),a=s.calcTimeElapsed(t,"day"),o=[],i=[` Last visit: ${t} \n                (${a} Days Elapsed)`],r=[["Prescription"],["Tabs given"],["Tabs per"],["Tabs remaining"],["Expected"],["Actual (counted)"],["Adherence"],["Doses missed/ Unaccounted for"],["Doses consumed"],["Art Adherence"]];e.forEach((e,t)=>{const a=h(e.frequency),n=g(e),d=s.calculateAdherence(e.quantity,e.pillsBrought,n),l=s.isAdherenceGood(d)?"Good adherence":"Explore problem",c=s.calculateUnaccountedOrMissed(n,e.pillsBrought);i.push(e.drug.name),r[0].push(""),r[1].push(e.quantity),r[2].push(`${e.equivalent_daily_dose} <b>${a}</b>`),r[3].push(""),r[4].push(n<0?0:n),r[5].push(e.pillsBrought),r[6].push(""),r[7].push(c),r[8].push(`${d}%`),r[9].push(l),o.push({index:t+1,row:9,class:l.match(/good/i)?"adherence-txt-good":"adherence-txt-bad"})}),c.value=i,u.value=r,b.value=o,p.value=[{indexes:[0,3,6],class:"adherence-col-bg"}]}return R(async()=>{try{l&&(await s.loadPreviousDrugs(),s.receivedDrugsBefore()&&n.processMedicationData(s))}catch(e){console.error("Error initializing adherence data:",e)}}),{tableRows:u,tableHeaders:c,tableCellColors:b,tableRowColors:p,adherenceStore:n,chevronBackOutline:q,chevronDownOutline:k,buildAdherenceReport:f,goBackToProfile:()=>{a.push("/patientProfile")},updateRemaining:(e,t)=>{const a=t.detail.value?parseInt(t.detail.value):0;n.updateMedicationRemaining(e,a)},updateExpected:(e,t)=>{const a=t.detail.value?parseInt(t.detail.value):0;n.updateExpected(e,a)},updateActual:(e,t)=>{const a=t.detail.value?parseInt(t.detail.value):0;n.updateActual(e,a)},updateAgreeWithCalculation:e=>{n.setAgreeWithCalculation("yes"===e.detail.value)},onSubmit:async()=>{console.log(f());try{if(!i.getID())return L("Patient ID required"),console.error("Patient ID not found"),!1;const e=[];n.medications.forEach(async t=>{const{drug:a,order:n}=t.drug,o={...t.drug,pillsBrought:t.remaining},i=s.calculateAdherence(o.quantity,o.pillsBrought,g(o));e.push(s.buildAdherenceObs(n.order_id,a.drug_id,i)),e.push(s.buildPillCountObs(n.order_id,t.remaining))}),await s.createEncounter();const t=await Promise.all([...e]);if(await s.saveObservationList(t))return V("Adherence saved!"),!0}catch(e){console.error("Error saving adherence data:",e),L("An exception has occured")}return!1}}}}),F={class:"container"},N={class:"ion-padding",slot:"content"},Y={class:"medication-section"},K={class:"medication-inputs"},X={class:"medication-name"},Z={class:"ion-padding",slot:"content"};e("default",P(Q,[["render",function(e,t,a,n,o,u){const p=M("ion-label"),b=M("ion-item"),g=M("ion-input"),h=M("ion-accordion"),f=M("report-data-table"),m=M("ion-accordion-group"),v=M("ion-card-content"),y=M("ion-card");return r(),i("div",F,[O(y,{class:"adherence-card"},{default:B(()=>[O(v,null,{default:B(()=>[O(m,{onIonChange:e.buildAdherenceReport,value:"pills"},{default:B(()=>[O(h,{value:"pills","toggle-icon":e.chevronDownOutline},{default:B(()=>[O(b,{slot:"header",color:"light"},{default:B(()=>[O(p,null,{default:B(()=>t[0]||(t[0]=[j("Pills remaining (brought to clinic)")])),_:1,__:[0]})]),_:1}),d("div",N,[d("div",Y,[t[1]||(t[1]=d("div",{class:"medication-header"},"Medication (enter amount remaining for each drug)",-1)),d("div",K,[(r(!0),i(l,null,s(e.adherenceStore.medications,(t,a)=>(r(),i("div",{class:"medication-row",key:a},[d("div",X,c(t.name),1),O(g,{type:"number",placeholder:"0",class:"pill-input",modelValue:t.remaining,"onUpdate:modelValue":e=>t.remaining=e,onIonChange:t=>e.updateRemaining(a,t)},null,8,["modelValue","onUpdate:modelValue","onIonChange"])]))),128))])])])]),_:1},8,["toggle-icon"]),O(h,{value:"arv","toggle-icon":e.chevronDownOutline},{default:B(()=>[O(b,{slot:"header",color:"light"},{default:B(()=>[O(p,null,{default:B(()=>t[2]||(t[2]=[j("ARV adherence")])),_:1,__:[2]})]),_:1}),d("div",Z,[O(f,{columns:e.tableHeaders,rows:e.tableRows,cellColors:e.tableCellColors,rowColors:e.tableRowColors},null,8,["columns","rows","cellColors","rowColors"])])]),_:1},8,["toggle-icon"])]),_:1},8,["onIonChange"])]),_:1})]),_:1})])}],["__scopeId","data-v-6f75b1b8"]]))}}});

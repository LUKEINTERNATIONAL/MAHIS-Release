import{d as T,a9 as E,aa as F,ab as N,$ as A,m as M,am as P,an as O,ao as U,ap as j,aq as z,ar as v,b as Q,c as o,o as l,a0 as k,q as c,f as a,e as h,af as _,a1 as b,a2 as y,s as w,a3 as g,t as I,a4 as D}from"./index-35feeee1.js";import{H as R,k as W}from"./KbHandler-edda20d0.js";import Y from"./BaseTextInput-7c8dae9a.js";import{_ as G}from"./FieldMixin.vue_vue_type_script_lang-ddbef912.js";function J(e,t){return[...new Map(e.filter(Boolean).map(s=>[Array.isArray(t)?t.map(r=>s[r]).join("_"):s[t],s])).values()]}const X=T({name:"HisInfiniteScrollMultipleSelect",mixins:[G],components:{IonCheckbox:E,IonText:F,IonChip:N,ViewPort:A,HisTextInput:Y,IonContent:M,IonList:P,IonItem:O,IonLabel:U,HisKeyboard:R,IonInfiniteScroll:j,IonInfiniteScrollContent:z},data:()=>({showKeyboard:!1,keyboard:v,listData:[],checkedItems:[],disableScroll:!1,filter:"",selected:"",page:1,limit:10}),watch:{clear(){this.checkedItems=[],this.filter="",this.selected=""},checkedItems:{handler(e){this.listData.forEach(t=>{e.find(s=>s.value===t.value)?t.isChecked=!0:t.isChecked=!1}),this.$emit("onValue",e)},deep:!0,immediate:!0},filter:{async handler(){this.page=1,this.disableScroll=!1;const e=await this.getListData();[...this.checkedItems].forEach(t=>{const s=e.findIndex(n=>n.value===t.value);s===-1?e.push(t):e[s].isChecked=!0}),this.listData=e}}},mounted(){this.init()},activated(){this.init()},methods:{async init(){this.$emit("onFieldActivated",this),this.listData=await this.getListData()},async getListData(){return await this.options(this.fdata,this.filter,this.page,this.limit)},async keypress(e){this.filter||(this.selected=""),this.filter=W(e,this.selected),this.selected=this.filter},async onKBValue(e){!this.listData||this.selected===e||(this.filter=e,this.selected=this.filter)},async pushData(e){this.page++;const t=await this.getListData();t.length>0?this.listData=J([...this.listData,...t.filter(s=>!this.listData.find(n=>n.value===s.value))],"label"):this.disableScroll=!0,e.target.complete()},onSelect(e){this.$nextTick(async()=>{e.isChecked?this.checkedItems.findIndex(t=>t.value===e.value)===-1&&this.checkedItems.push(e):this.unCheck(e)})},unCheck(e){this.checkedItems=this.checkedItems.filter(t=>t.value!==e.value)}},created(){var e,t,s,n,r,p,u,f;this.showKeyboard=(t=(e=this.config)==null?void 0:e.showKeyboard)!=null?t:!1,this.keyboard=(n=(s=this.config)==null?void 0:s.keyboard)!=null?n:v,this.page=(p=(r=this.config)==null?void 0:r.page)!=null?p:1,this.limit=(f=(u=this.config)==null?void 0:u.limit)!=null?f:10}});function Z(e,t,s,n,r,p){const u=o("his-text-input"),f=o("ion-chip"),C=o("ion-text"),S=o("ion-label"),K=o("ion-checkbox"),V=o("ion-item"),$=o("ion-list"),B=o("ion-infinite-scroll-content"),x=o("ion-infinite-scroll"),L=o("ion-content"),H=o("view-port"),q=o("his-keyboard");return l(),k(b,null,[c(H,{showFull:!e.showKeyboard},{default:a(()=>[e.showKeyboard?(l(),h(u,{key:0,value:e.selected,onOnValue:e.onKBValue},null,8,["value","onOnValue"])):_("",!0),(l(!0),k(b,null,y(e.checkedItems,(i,m)=>(l(),h(f,{color:"danger",key:m,onClick:d=>e.unCheck(i)},{default:a(()=>[w(g(i.label),1)]),_:2},1032,["onClick"]))),128)),c(L,{style:{width:"100%"},class:"ion-padding-bottom"},{default:a(()=>[I("div",{class:D(["ion-content-scroll-host",{"ion-margin-bottom ion-padding-bottom":e.disableScroll}])},[c($,{class:D(["view-port-content",{"ion-margin-bottom":e.disableScroll}])},{default:a(()=>[(l(!0),k(b,null,y(e.listData,(i,m)=>(l(),h(V,{key:m,color:i.isChecked?"lightblue":"",lines:i.isChecked?"none":""},{default:a(()=>[c(S,null,{default:a(()=>{var d;return[c(C,{class:"his-md-text"},{default:a(()=>[w(g(i.label),1)]),_:2},1024),i.description&&i.isChecked?(l(),h(C,{key:0,color:(d=i.description)==null?void 0:d.color},{default:a(()=>[I("p",null,[I("i",null,g(i.description.text),1)])]),_:2},1032,["color"])):_("",!0)]}),_:2},1024),c(K,{slot:"start",modelValue:i.isChecked,"onUpdate:modelValue":d=>i.isChecked=d,onIonChange:d=>e.onSelect(i),disabled:i.disabled},null,8,["modelValue","onUpdate:modelValue","onIonChange","disabled"])]),_:2},1032,["color","lines"]))),128))]),_:1},8,["class"]),c(x,{onIonInfinite:t[0]||(t[0]=i=>e.pushData(i)),threshold:"100px",disabled:e.disableScroll},{default:a(()=>[c(B,{"loading-spinner":"crescent","loading-text":"Loading more data..."})]),_:1},8,["disabled"])],2)]),_:1})]),_:1},8,["showFull"]),e.showKeyboard?(l(),h(q,{key:0,kbConfig:e.keyboard,onKeyPress:e.keypress},null,8,["kbConfig","onKeyPress"])):_("",!0)],64)}const oe=Q(X,[["render",Z]]);export{oe as default};

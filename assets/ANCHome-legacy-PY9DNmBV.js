System.register(["./vendor-legacy-CJLpW7UD.js","./index-legacy-Cu2QP7ax.js","./DemographicBar-legacy-C6jPd-Wk.js","./NextAppointmentModal-legacy-D_2Dd_GA.js","./SaveProgressModal-legacy-Bvy2pV_G.js","./FeatusModal-legacy-CmFuldTy.js","./formatServerData-legacy-q-DQmXa9.js","./vaccines_service-legacy-DPIoapG5.js","./sms_service-legacy-BiU4HhS4.js","./relationship_service-legacy-DhqL6o7V.js","./BasicForm-legacy-DojBq7me.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-KZZvWaHO.js","./EIRreportsStore-legacy-tityPK17.js","./Export-legacy-C0dTQa4s.js","./DateInputField-legacy-DQcxfqHG.js"],function(t,e){"use strict";var n,a,o,i,l,s,c,r,p,d,u,m,g,f,h,y,v,x,b,w,D,_,A,M,S,k,I,N,C,O,$,F,j,T,z,B,R,J,H,P,U,E,V,Y,L,Z,K,G,Q,W,q,X,tt,et,nt,at,ot,it,lt,st,ct,rt,pt;return{setters:[t=>{n=t.d,a=t.r,o=t.a,i=t.e,l=t.f,s=t.l,c=t.N,r=t.m,p=t.J,d=t.u,u=t.aa,m=t.k,g=t.b1,f=t.P,h=t.K,y=t.a9,v=t.bj,x=t.M,b=t.F,w=t.Q,D=t.af,_=t.a7,A=t.ae,M=t.a8,S=t.bC,k=t.c9,I=t.d6,N=t._,C=t.$,O=t.H},t=>{$=t.aP,F=t.u,j=t.H,T=t.S,z=t.P,B=t.t,R=t.k,J=t.A,H=t.K,P=t.bu,U=t._,E=t.T,V=t.J,Y=t.o,L=t.N,Z=t.v,K=t.aM,G=t.ae},t=>{Q=t.D},t=>{W=t.N,q=t.u,X=t.a,tt=t.L},t=>{et=t.S},t=>{nt=t.F},t=>{at=t.a},t=>{ot=t.u,it=t.A,lt=t.a,st=t.v},t=>{ct=t.S},t=>{rt=t.R},t=>{pt=t.B},null,null,null,null,null],execute:function(){var e=document.createElement("style");e.textContent=".ilbl[data-v-f063c32f]{font-size:23px}.calender[data-v-f063c32f]{--dp-cell-padding: 30px;--dp-menu-padding: 20px 5px;--dp-font-size: 18px}.card_content[data-v-f063c32f]{width:100%}.dp__flex_display[data-v-f063c32f]{display:inherit}.toggle-green[data-v-f063c32f]{--toggle-bg-on: #006401;--toggle-border-on: #006401;--toggle-width: 6.3rem;--toggle-height: 1.9rem;--toggle-border: .525rem;--toggle-font-size: 1rem;margin-bottom:30px}.lbl-tl[data-v-f063c32f]{min-width:20px;color:#b3b3b3!important;white-space:nowrap}.lbl-ct[data-v-f063c32f]{white-space:nowrap;color:#08475e;font-size:14px}.btnText[data-v-f063c32f]{font-style:normal;font-weight:500;font-size:14px}.container[data-v-75067a76]{text-align:center;position:fixed;left:0;right:0;top:35%;transform:translateY(-50%)}.back_profile[data-v-75067a76]{display:flex;justify-content:space-between;align-items:center;width:100%;font-weight:400;font-size:14px;z-index:1000;padding-left:25%;padding-right:25%}.AppointmentDate[data-v-75067a76]{margin-right:5%}ion-card[data-v-75067a76]{width:300px;margin:8px}.button-container[data-v-75067a76]{display:block;justify-content:space-around;margin:10px 0}.dynamic-button[data-v-75067a76]{flex:1;margin:0 5px;min-width:120px}@media (max-width: 768px){.dynamic-button[data-v-75067a76]{margin:0 15px}.container[data-v-75067a76]{text-align:center;position:absolute;left:0;right:0;top:43%;transform:translateY(-50%)}ion-card[data-v-75067a76]{width:400px;margin:4px}.button-container[data-v-75067a76]{display:flex;justify-content:space-around;margin:5px;padding-left:1%;padding-right:1%}.back_profile[data-v-75067a76]{display:flex;justify-content:space-between;width:100%;font-weight:400;font-size:14px;z-index:1000;padding:0 5%;margin-bottom:10px}.AppointmentDate[data-v-75067a76]{margin-left:0}}hr[data-v-75067a76]{margin:20px 0;border:2px solid #ccc}\n/*$vite$:1*/",document.head.appendChild(e);class dt extends ${constructor(t,e){super(t,7,e)}}const ut={class:"lbl-ct"},mt={class:"lbl-ct"},gt={style:{"margin-right":"20px",color:"black"}},ft={style:{"font-size":"16px",color:"#666","margin-top":"5px"}},ht=n({watch:{},name:"xxxComponent",computed:{...D(q,["nextAppointmentDate"]),...D(F,["patient"])},methods:{handleInputData(t){P(this.nextAppointmentDate,W,t.name,t.value),this.handleDateOfScheduledAppointmentRange(t)},closeCircleOutline:()=>_,handleDateOfScheduledAppointmentRange(t){const e=new Date,n=new Date(e);n.setDate(n.getDate()+1);const a=n.toISOString().split("T")[0],o=new Date(e);o.setDate(o.getDate()+32);const i=o.toISOString().split("T")[0];H(this.nextAppointmentDate,"Appointment date","minDate",a),H(this.nextAppointmentDate,"Appointment date","maxDate",i)}}}),yt=n({...ht,props:{patient_Id:{},encounter_Id:{}},setup(t){const e=F(),n=F(),D=a(),_=a(),A=a(!1),M=a(!1),S=j.toStandardHisDisplayFormat(T.getSessionDate()),k=a(!1),I=a(),N=a(0),C=a([]),O=[],$=t;async function H(){await async function(){try{await st($.encounter_Id,"Rescheduled"),await st($.encounter_Id,"Rescheduled")}catch(t){}}(),await async function(){try{var t;const n=await rt.getRelationships(e.patient.patientID);if(n.length>0){const t=n[0].relation.person_attributes.find(t=>"Cell Phone Number"==t.type.name);t&&C.value.push(t.value)}null!==(t=e.patient)&&void 0!==t&&null!==(t=t.personInformation)&&void 0!==t&&t.cell_phone_number&&C.value.push(e.patient.patientID)}catch(n){}}();const t=$.patient_Id?new it($.patient_Id):new it,n=await t.createAppointment();!async function(){const t=R();t.setVaccineReload(!t.getVaccineReload())}(),async function(){const t=ot();t.setAppointmentsReload(!t.getAppointmentsReload())}(),U(),async function(t){if(0!=C.value.length){if(Array.isArray(t)&&t.length>0)if(M.value){const e=await w.create({component:lt,componentProps:{date:t[1],patient:t[0],modalaction:"saveAppointment"}});await e.present()}else await ct.appointment(t[0],t[1])}else B("No phone numbers available for sms reminder!")}(n)}function P(t,e){const n=t.getFullYear(),a=t.getMonth(),o=t.getDate(),i=e.getFullYear(),l=e.getMonth(),s=e.getDate();return n!==i?n>i:a!==l?a>l:o>s}function U(){w.dismiss()}function E(t){const e=t.match(/(\d+)\s*(week|month|year)s?/i);if(!e)return"Invalid input format";const n=parseInt(e[1]);switch(e[2].toLowerCase()){case"week":return 7*n;case"month":return 30*n;case"year":return 365*n;default:return"Invalid time unit"}}function V(t,e){let n;if(t instanceof Date)n=new Date(t);else{const[e,a]=t.split(" "),[o,i,l]=e.split("/"),[s,c,r]=a.split(":"),p={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};n=new Date(Number(l),p[i],Number(o),Number(s),Number(c),Number(r))}n.setDate(n.getDate()+e);const a=t=>String(t).padStart(2,"0"),o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n.getDay()],i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()],l=a(n.getDate()),s=n.getFullYear(),c=a(n.getHours()),r=a(n.getMinutes()),p=a(n.getSeconds()),d=-n.getTimezoneOffset(),u=Math.floor(Math.abs(d)/60),m=Math.abs(d)%60,g=`GMT${d>=0?"+":"-"}${a(u)}${a(m)}`,f=Intl.DateTimeFormat().resolvedOptions().timeZone;let h;try{const t=new Intl.DateTimeFormat("en",{timeZone:f,timeZoneName:"long"}).formatToParts(n).find(t=>"timeZoneName"===t.type);h=t?t.value:f}catch(y){console.error("Error getting localized time zone name:",y),h=f}return`Date ${o} ${i} ${l} ${s} ${c}:${r}:${p} ${g} (${h})`}return o(async()=>{ot().clearAppointmentMent(),await async function(){try{let t=await ct.getConfigurations();M.value=t.show_sms_popup}catch(t){}}(),await async function(){try{const t=new z,e=void 0!==$.patient_Id?$.patient_Id:t.getID(),a=await async function(){try{const t=n.vaccineSchedule;t.vaccine_schedule.forEach(t=>{t.antigens.forEach(e=>{"administered"==e.status&&O.push({age:t.age,vaccine:e})})});for(const e of t.vaccine_schedule){if("current"===e.milestone_status)return e;if("upcoming"===e.milestone_status)return e}return null}catch(t){return null}}();if(O.length>0){const t=O[O.length-1];console.log(t);const n=await async function(t,e){try{const n=await z.findByID(e),a=V(new Date(n.person.birthdate),E(t.age)),o=function(t){const e={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},n=t.split(/[:/ ]/),a=`${n[2]}-${e[n[1]]}-${n[0]}T${n[3]}:${n[4]}:${n[5]}`;return new Date(a)}(t.vaccine.date_administered),i=new Date(a);return console.log(P(o,i)),P(o,i)}catch(n){}}(t,e);0==n&&(D.value=V(t.vaccine.date_administered,E(a.age)),_.value=j.toStandardHisDisplayFormat(D.value),async function(t){const e=ot(),n={counter:1,date:t};e.setAppointmentMent(n),k.value=!1,await async function(t){try{const e=await J.getDailyAppointments(j.toStandardHisFormat(t),j.toStandardHisFormat(t));N.value=e.length+1}catch(e){}}(t),k.value=!0,I.value=j.toStandardHisDisplayFormat(t)}(D.value),function(t){const e=ot(),n=e.getAppointmentMents(),a=t=>{const e=new Date(t);return e.setHours(0,0,0,0),e.getTime()},o=a(new Date(t)),i=n.find(t=>a(new Date(t.date))===o);i&&i.counter}(D.value),A.value=!0)}}catch(t){}}()}),(t,e)=>(l(),i(b,null,[s(d(y),{style:{"margin-top":"10px"}},{default:p(()=>[s(d(u),{style:{"margin-left":"-3px"}},{default:p(()=>e[0]||(e[0]=[m("div",{class:"om",style:{"font-weight":"600",color:"#8d8686"}},"Set Next Appointment Date",-1)])),_:1,__:[0]}),s(d(u),{size:"6",style:{"text-align":"right"}},{default:p(()=>[s(d(g),{class:"lbl-tl",style:{"font-size":"13px"}},{default:p(()=>[e[1]||(e[1]=f(" Todays Date: ",-1)),m("span",ut,h(d(S)),1)]),_:1,__:[1]})]),_:1})]),_:1}),s(d(y),{style:{"margin-top":"10px"}},{default:p(()=>[s(d(u),{style:{"margin-left":"-3px"}},{default:p(()=>e[2]||(e[2]=[m("div",{class:"om"},null,-1)])),_:1,__:[2]}),k.value?(l(),c(d(u),{key:0,size:"10",style:{"text-align":"right"}},{default:p(()=>[s(d(g),{class:"lbl-tl",style:{"font-size":"16px","font-weight":"500"}},{default:p(()=>[e[3]||(e[3]=f(" Total Appointments ",-1)),m("span",mt,"("+h(I.value)+")",1),e[4]||(e[4]=f(": ",-1)),m("span",gt,[s(d(v),{color:"primary",style:{"margin-bottom":"-5px","font-size":"15px"}},{default:p(()=>[f(h(N.value),1)]),_:1})])]),_:1,__:[3,4]})]),_:1})):r("",!0)]),_:1}),s(d(y),{style:{"margin-top":"20px"}},{default:p(()=>[s(d(u),null,{default:p(()=>[s(pt,{contentData:t.nextAppointmentDate,"onUpdate:selected":t.handleInputData,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:selected","onUpdate:inputValue"])]),_:1})]),_:1}),A.value?(l(),c(d(y),{key:0,style:{"margin-top":"0px","margin-bottom":"0px"}},{default:p(()=>[s(d(u),{style:{"background-color":"#f0f0f0",padding:"15px","border-radius":"8px","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)"}},{default:p(()=>[e[5]||(e[5]=m("div",{style:{"font-size":"17px",color:"#333","font-weight":"bold"}},"Suggested Date:",-1)),m("div",ft,h(_.value),1)]),_:1,__:[5]})]),_:1})):r("",!0),s(d(y),{style:{"margin-top":"10px","margin-bottom":"10px"}},{default:p(()=>[s(d(u),null,{default:p(()=>[s(d(x),{onClick:U,id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"}},{default:p(()=>e[6]||(e[6]=[f(" Cancel ",-1)])),_:1,__:[6]})]),_:1}),s(d(u),{style:{"text-align":"right"}},{default:p(()=>[s(d(x),{onClick:H,class:"btnText",fill:"solid",style:{width:"130px"}},{default:p(()=>e[7]||(e[7]=[f(" save ",-1)])),_:1,__:[7]})]),_:1})]),_:1})],64))}}),vt=U(yt,[["__scopeId","data-v-f063c32f"]]),xt=n({name:"TB screening",components:{IonRow:y,IonButton:x,FeatusModal:nt,DynamicButton:V,IonContent:M,IonPage:A,Toolbar:E,DemographicBar:Q,LandingPage:tt,NextAppointmentModal:X},props:{backBtn:{type:String,default:"Back to profile"},backUrl:{type:String,default:""},contact:{type:String,default:""}},data:()=>({isModalOpen:!1,dateOfAppointment:""}),mounted(){this.handleAppointment()},setup:()=>({checkmark:C,pulseOutline:N}),computed:{...D(q,["nextAppointmentDate"]),...D(F,["patient"])},methods:{calendar:()=>I,eye:()=>k,chevronBackOutline:()=>S,openBackController(){this.backUrl?this.$router.push(this.backUrl):Y(et)},async handleAppointment(){const t=await G.getFirstObsValue(this.patient.patientID,"Appointment date","value_text");this.dateOfAppointment=t},async saveData(){const t=q();await t.validate()?(await this.saveDate(),this.closeAppointmentModal(),await this.$router.push("ANCHome"),await await K()):Z("Next appointment date has errors")},async saveDate(){if(this.nextAppointmentDate.length>=0){const t=T.getUserID(),e=new dt(this.patient.patientID,t);if(!(await e.createEncounter()))return B("Unable to create appointment date encounter");if(!(await e.saveObservationList(await this.buildNextAppointment())))return B("Unable to create date!");L("Client has been scheduled for next contact")}console.log(await this.buildNextAppointment())},openNextVaccineAppoinment(){Y(vt,{class:"otherVitalsModal"},!1)},async buildNextAppointment(){return[...await at(this.nextAppointmentDate)]},cancelModal(){this.closeAppointmentModal()},async nextAppointment(){this.toggleAppointmentModal()},toggleAppointmentModal(){this.isModalOpen=!this.isModalOpen},closeAppointmentModal(){this.isModalOpen=!1},previousContacts(){this.$router.push("/contacts")},navigateToContact(){this.$router.push("/contact")}}}),bt={class:"container"},wt={class:"back_profile"},Dt={class:"AppointmentDate"},_t={style:{color:"#0b5ed7"}},At={class:"button-container ion-justify-content-center ion-align-items-center"};t("default",U(xt,[["render",function(t,e,n,a,o,i){const r=O("Toolbar"),d=O("DemographicBar"),u=O("DynamicButton"),g=O("NextAppointmentModal"),f=O("LandingPage"),y=O("ion-content"),v=O("ion-page");return l(),c(v,null,{default:p(()=>[s(r),s(y,{fullscreen:!0},{default:p(()=>[s(d),m("div",bt,[m("div",wt,[s(u,{name:t.backBtn,iconSlot:"start",fill:"clear",icon:t.chevronBackOutline(),onClick:e[0]||(e[0]=e=>t.openBackController())},null,8,["name","icon"]),m("div",Dt,[e[1]||(e[1]=m("span",{style:{"font-size":"14px"}},"Appointment Date: ",-1)),m("b",_t,h(t.dateOfAppointment||"Not scheduled"),1)])]),m("div",At,[s(u,{style:{"padding-right":"1%"},name:"New ANC contact",iconSlot:"start",fill:"solid",icon:t.checkmark,onClick:t.navigateToContact},null,8,["icon","onClick"]),s(u,{style:{"padding-right":"1%"},name:"View ANC contacts",iconSlot:"start",fill:"solid",icon:t.eye(),onClick:t.previousContacts},null,8,["icon","onClick"]),s(u,{name:"Schedule next contact",iconSlot:"start",fill:"solid",icon:t.calendar(),onClick:t.nextAppointment},null,8,["icon","onClick"])]),s(g,{isOpen:t.isModalOpen,title:"",closeModalFunc:t.closeAppointmentModal,onYes:t.saveData,onNo:t.cancelModal},null,8,["isOpen","closeModalFunc","onYes","onNo"]),e[2]||(e[2]=m("hr",null,null,-1)),s(f)])]),_:1})]),_:1})}],["__scopeId","data-v-75067a76"]]))}}});

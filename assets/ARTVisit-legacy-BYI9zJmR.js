System.register(["./vendor-legacy-IknIjA4f.js","./index-legacy-M4KPA2Gn.js","./tasks-legacy-CvloBH41.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-BAwsNGQr.js"],function(e,l){"use strict";var n,t,a,o,u,i,r,s,c,d,v,f,p,y,g,m,k,h,_,x,w,b,I,D,T,C,P,S,j,N,$,z,A,E,R,W,B,L,M,U,V,Y,F,G,J,Z,q,H,K,O;return{setters:[e=>{n=e.d,t=e.cj,a=e.b2,o=e.au,u=e.r,i=e.w,r=e.y,s=e.f,c=e.z,d=e.l,v=e.u,f=e.es,p=e.k,y=e.as,g=e.a9,m=e.e,k=e.ac,h=e.F,_=e.L,x=e.G,w=e.I,b=e.et,I=e.eu,D=e.eo,T=e.B,C=e.bN,P=e.V,S=e.U,j=e.W,N=e.A,$=e.dP,z=e.bM,A=e.b0,E=e.aZ,R=e.e4,W=e.cT,B=e.dv,L=e.cz,M=e.m,U=e.ev,V=e.af},e=>{Y=e.S,F=e.u,G=e.T,J=e.a$,Z=e.ac,q=e.m,H=e._},e=>{K=e.i,O=e.a},null,null],execute:function(){var l=document.createElement("style");l.textContent="#main[data-v-5043e891]{height:calc(100vh - 69px);overflow-y:auto}.placeholder-content[data-v-5043e891]{padding:20px}\n/*$vite$:1*/",document.head.appendChild(l);class Q extends Y{constructor(){super()}static nextTask(e){return super.getJson(`/workflows/${super.getProgramID()}/${e}`,{date:super.getSessionDate()})}static async getNextTaskParams(e,l=""){let n=l;try{if(!n){const{name:l}=await Q.nextTask(e);n=l}}catch(t){n=""}return{name:n.toLowerCase(),params:{patient_id:e}}}}const X={key:1,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},ee={class:"ion-page",id:"main"},le={key:0,class:"placeholder-content"},ne={style:{margin:"0px auto"},class:"ion-text-center"},te={key:1},ae={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}},oe={style:{color:"black"}};e("default",H(n({__name:"ARTVisit",setup(e){const l=t(),n=F(),{patient:Y}=a(n),H=o(),ue=u(-1),ie=u(null),re=u([]),se=u([]),ce=u(!1),de=u(-1),ve=u(""),fe=u(""),pe=u("");function ye(e){var l;return!!e&&(!ce.value&&de.value===(null==e?void 0:e.encounterTypeID)||(null!==(l=null==e?void 0:e.otherWorkflowNames)&&void 0!==l?l:[]).includes(ve.value))}function ge(){if(0===re.value.length||ue.value===re.value.length-1)return!1;const e=re.value[ue.value];return e&&ye(e)}async function me(){pe.value="",ce.value=!0,fe.value="",ve.value="";try{var e;const l=await Q.nextTask(Y.value.patientID);if(!l)return fe.value="No workflows found. You may exit this page or refresh",ce.value=!1,void(ue.value=-1);ve.value=l.name,de.value=null!==(e=null==l?void 0:l.encounter_type_id)&&void 0!==e?e:-1;const n=re.value.findIndex(e=>{var l;return(null==e?void 0:e.encounterTypeID)===de.value||(null!==(l=e.otherWorkflowNames)&&void 0!==l?l:[]).includes(ve.value)});if(-1!==n){pe.value=l.description;const e=[...re.value.slice(n),...re.value.slice(0,n)];re.value=e,ue.value=0}else fe.value=ve.value?`"${ve.value}" is not available in the current workflow. Contact your administrator or update ART activity selection`:"No next task found",ue.value=n}catch(l){fe.value="An error has occured while loading next task: "+l,console.error(l)}finally{await async function(){const e=await J.getEncounters(Y.value.patientID,{date:Q.getSessionDate()});se.value=e.map(e=>e.encounter_type)}(),ce.value=!1}}function ke(){(ie.value&&"function"==typeof ie.value.onSubmit?ie.value.onSubmit():Promise.resolve(!0)).then(e=>e&&me())}return i(()=>l.fullPath,()=>{(async function(){ue.value=-1,re.value=[];try{const e=Z.map(async e=>{if(("function"!=typeof e.disabled||!e.disabled(Z))&&e.workflowID&&e.component&&await K(e.workflowID)&&await O(e.workflowID))return e});re.value=(await Promise.all(e)).filter(e=>void 0!==e)}catch(e){q("Unable to load activities"),console.error(e)}})().then(me)},{immediate:!0,deep:!0}),(e,l)=>(s(),r(v(V),null,{default:c(()=>[d(G),d(v(f),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:c(()=>{var e;return[d(v(y),{contentId:"main"},{default:c(()=>[d(v(g),null,{default:c(()=>[re.value.length>0?(s(),r(v(k),{key:0},{default:c(()=>[(s(!0),m(h,null,_(re.value,(e,l)=>(s(),r(v(x),{onClick:e=>function(e){if(e<0||e>=re.value.length)return;const l=re.value[e];l&&ye(l)&&(ue.value=e)}(l),lines:"none",key:l,disabled:!ye(e),button:""},{default:c(()=>{return[(l=e,se.value.includes(null!==(n=null==l?void 0:l.encounterTypeID)&&void 0!==n?n:0)?(s(),r(v(w),{key:0,icon:v(b),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):ye(e)?(s(),r(v(w),{key:2,icon:v(D),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(s(),r(v(w),{key:1,icon:v(I),style:{padding:"10px"},slot:"start"},null,8,["icon"]))),p("b",null,T(e.name),1)];var l,n}),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(s(),m("div",X,[d(v(w),{style:{"font-size":"2rem"},icon:v(C)},null,8,["icon"]),l[2]||(l[2]=p("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),d(v(P),null,{default:c(()=>[d(v(S),{color:"light"},{default:c(()=>[d(v(j),{onClick:l[0]||(l[0]=e=>v(H).back())},{default:c(()=>[d(v(w),{icon:v($),slot:"start"},null,8,["icon"]),l[3]||(l[3]=N(" Back to dashboard "))]),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),p("div",ee,[ce.value?(s(),m("div",le,[p("div",ne,[d(v(z),{name:"bubbles"}),l[4]||(l[4]=p("p",null,[p("h1",null,"Please wait...")],-1))])])):null!==(e=re.value[ue.value])&&void 0!==e&&e.component?(s(),m("div",te,[d(v(A),null,{default:c(()=>[d(v(E),null,{default:c(()=>{var e;return[(s(),r(R,null,[(s(),r(W(null===(e=re.value[ue.value])||void 0===e?void 0:e.component),{ref_key:"formRef",ref:ie},null,512))],1024))]}),_:1})]),_:1})])):(s(),m("div",ae,[d(v(w),{style:{color:"green","font-size":"80px"},icon:v(B)},null,8,["icon"]),p("h2",oe,T(fe.value),1),d(v(j),{size:"large",fill:"clear",onClick:l[1]||(l[1]=e=>v(H).back())},{default:c(()=>[d(v(w),{slot:"start",icon:v(L)},null,8,["icon"]),l[5]||(l[5]=N(" Exit page "))]),_:1,__:[5]})])),d(v(P),null,{default:c(()=>[d(v(S),{color:"light"},{default:c(()=>[ge()?(s(),r(v(j),{key:0,onClick:ke,color:"primary",style:{padding:"4px"},slot:"end"},{default:c(()=>[l[6]||(l[6]=N(" Save and continue ")),d(v(w),{style:{padding:"4px"},icon:v(U),slot:"end"},null,8,["icon"])]),_:1,__:[6]})):M("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),[["__scopeId","data-v-5043e891"]]))}}});

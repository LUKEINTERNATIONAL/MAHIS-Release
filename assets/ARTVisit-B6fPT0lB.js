import{d as Z,cq as j,aX as H,ak as ee,r as i,w as ne,N as u,f as o,J as l,l as a,u as n,eD as te,k as m,ag as ae,a8 as oe,e as w,ab as le,F as se,O as re,a1 as ie,a0 as p,eE as ue,dO as ce,ez as de,K as O,bV as fe,L,G as V,M as D,P as E,dY as pe,bN as ve,aV as me,aS as ye,m as $,ei as ge,bO as _e,bQ as be,cL as ke,eF as we,ae as Ie,Q as xe}from"./vendor-D6BsZkA2.js";import{S as z,u as Te,P as M,T as Ce,bM as he,v as B,bn as Se,al as W,Z as Ne,bN as Pe,o as De,bO as Ee,a7 as Be,_ as Fe}from"./index-CxCBwNwJ.js";import{i as Re,a as Ae}from"./tasks-DCBpcaI-.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-DvmkyR1f.js";class T extends z{constructor(){super()}static nextTask(y){return super.getJson("/workflows/".concat(super.getProgramID(),"/").concat(y),{date:super.getSessionDate()})}static async getNextTaskParams(y,C=""){let d=C;try{if(!d){const{name:_}=await T.nextTask(y);d=_}}catch(_){d=""}return{name:d.toLowerCase(),params:{patient_id:y}}}}const Oe={key:1,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},Le={class:"ion-page",id:"main"},Ve={key:0,class:"placeholder-content"},$e={style:{margin:"0px auto"},class:"ion-text-center"},Me={key:1},We={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}},ze={style:{color:"black"}},Ge=Z({__name:"ARTVisit",setup(Ye){const y=j(),C=Te(),{patient:d}=H(C),_=new M,F=ee(),f=i(-1),I=i(null),c=i([]),R=i([]),b=i(!1),h=i(-1),g=i(""),k=i(""),G=i(""),S=i(!1),x=i(null);function Y(t){var e;return R.value.includes((e=t==null?void 0:t.encounterTypeID)!=null?e:0)}function N(t){var e;return t?!b.value&&h.value===(t==null?void 0:t.encounterTypeID)||((e=t==null?void 0:t.otherWorkflowNames)!=null?e:[]).includes(g.value):!1}async function U(){const t=await Se.getEncounters(d.value.patientID,{date:T.getSessionDate()});R.value=t.map(e=>e.encounter_type)}async function A(){var t,e;S.value=(t=z.isBDE())!=null?t:!1,G.value="",b.value=!0,k.value="",g.value="";try{const r=await T.nextTask(d.value.patientID);if(!r){k.value="No workflows found. You may exit this page or refresh",b.value=!1,f.value=-1;return}g.value=r.name,h.value=(e=r==null?void 0:r.encounter_type_id)!=null?e:-1;const s=c.value.findIndex(v=>{var P;return(v==null?void 0:v.encounterTypeID)===h.value||((P=v.otherWorkflowNames)!=null?P:[]).includes(g.value)});s!==-1||(k.value=g.value?'"'.concat(g.value,'" is not available in the current workflow. Contact your administrator or update ART activity selection'):"No next task found"),f.value=s}catch(r){k.value="An error has occured while loading next task: "+r,console.error(r)}finally{await U(),b.value=!1}}async function J(){f.value=-1,c.value=[];try{const t=W.map(async e=>{if(!(typeof e.disabled=="function"&&e.disabled(W))){if(e.workflowID&&e.component){if(!await Re(e.workflowID)||!await Ae(e.workflowID))return}else return;return e}});c.value=(await Promise.all(t)).filter(e=>e!==void 0),K()}catch(t){B("Unable to load activities"),console.error(t)}}async function K(){if(await Ne.isProp("".concat(Pe.FILING_NUMBERS,"=true"))){if(_.patient=await M.findByID(d.value.patientID),!/n\/a/i.test(_.getFilingNumber()))return;De(Be,{},!1,{title:"New filing number assignment",useComponent:Ee,onClose:()=>{xe.dismiss()}})}}function Q(){if(S.value)if(x.value){if(!x.value.isProviderSelected()){B("Please select a provider"),x.value.openModal();return}}else{B("BDE Provider component is not available");return}return I.value&&typeof I.value.onSubmit=="function"?I.value.onSubmit():Promise.resolve(!0)}function q(){Q().then(t=>t&&A())}function X(t){if(t<0||t>=c.value.length)return;const e=c.value[t];e&&N(e)&&(f.value=t)}return ne(()=>y.fullPath,()=>{J().then(A)},{immediate:!0,deep:!0}),(t,e)=>(o(),u(n(Ie),null,{default:l(()=>[a(Ce),a(n(te),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:l(()=>{var r;return[a(n(ae),{contentId:"main"},{default:l(()=>[a(n(oe),null,{default:l(()=>[c.value.length>0?(o(),u(n(le),{key:0},{default:l(()=>[(o(!0),w(se,null,re(c.value,(s,v)=>(o(),u(n(ie),{onClick:P=>X(v),lines:"none",key:v,disabled:!N(s),button:""},{default:l(()=>[Y(s)?(o(),u(n(p),{key:0,icon:n(ue),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):N(s)?(o(),u(n(p),{key:2,icon:n(de),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(o(),u(n(p),{key:1,icon:n(ce),style:{padding:"10px"},slot:"start"},null,8,["icon"])),m("b",null,O(s.name),1)]),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(o(),w("div",Oe,[a(n(p),{style:{"font-size":"2rem"},icon:n(fe)},null,8,["icon"]),e[2]||(e[2]=m("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),a(n(L),null,{default:l(()=>[a(n(V),{color:"light"},{default:l(()=>[a(n(D),{onClick:e[0]||(e[0]=s=>n(F).back())},{default:l(()=>[a(n(p),{icon:n(pe),slot:"start"},null,8,["icon"]),e[3]||(e[3]=E(" Back to dashboard ",-1))]),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),m("div",Le,[b.value?(o(),w("div",Ve,[m("div",$e,[a(n(ve),{name:"bubbles"}),e[4]||(e[4]=m("p",null,[m("h1",null,"Please wait...")],-1))])])):(r=c.value[f.value])!=null&&r.component?(o(),w("div",Me,[a(n(me),null,{default:l(()=>[a(n(ye),null,{default:l(()=>{var s;return[S.value?(o(),u(he,{key:0,ref_key:"bdeProviderComponent",ref:x},null,512)):$("",!0),(o(),u(ge,null,[(o(),u(_e((s=c.value[f.value])==null?void 0:s.component),{ref_key:"formRef",ref:I},null,512))],1024))]}),_:1})]),_:1})])):(o(),w("div",We,[a(n(p),{style:{color:"green","font-size":"80px"},icon:n(be)},null,8,["icon"]),m("h2",ze,O(k.value),1),a(n(D),{size:"large",fill:"clear",onClick:e[1]||(e[1]=s=>n(F).back())},{default:l(()=>[a(n(p),{slot:"start",icon:n(ke)},null,8,["icon"]),e[5]||(e[5]=E(" Exit page ",-1))]),_:1,__:[5]})])),a(n(L),null,{default:l(()=>[a(n(V),{color:"light"},{default:l(()=>[f.value>=0?(o(),u(n(D),{key:0,onClick:q,color:"primary",style:{padding:"4px"},slot:"end"},{default:l(()=>[e[6]||(e[6]=E(" Save and continue ",-1)),a(n(p),{style:{padding:"4px"},icon:n(we),slot:"end"},null,8,["icon"])]),_:1,__:[6]})):$("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),Xe=Fe(Ge,[["__scopeId","data-v-70d01902"]]);export{Xe as default};

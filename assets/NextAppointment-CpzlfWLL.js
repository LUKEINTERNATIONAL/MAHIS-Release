var Me=Object.defineProperty;var Ie=(e,t,n)=>t in e?Me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var O=(e,t,n)=>Ie(e,typeof t!="symbol"?t+"":t,n);import{n as Ae,z as T,aP as ce,u as b,a8 as Z,S,bh as Oe,H as g,ay as de,aR as le,P as ue,a7 as we,t as k,ax as G,m as be,F as Pe,i as pe,_ as Q,aM as Le,bi as ke,bj as xe,ak as Fe,N as Ee,a1 as ee,D as $e,B as Be,aU as P,A as J,j as Ue,bk as He,d as Te,ap as X,s as Ve,aq as Re,p as ie}from"./index-w0bp8tHE.js";import{l as j}from"./lodash-Dt8AsbQm.js";import{g as ze,a as me,D as L}from"./drug_prescription_service-K8ylYuI9.js";import{R as te,r as w,b2 as q,d as V,I as he,D as ne,ab as qe,G as ae,E as I,e as $,f as M,L as ge,l,z as p,p as U,A as E,B as v,y as K,m as se,k as _,F as De,c as H,a as fe,u as N,b0 as Je,a$ as je,aB as We,aZ as Ge,a3 as Qe,W as Ke,w as Ye,bw as Ze,ar as W,br as Xe,a6 as et,U as tt,T as nt,as as at,ac as st,S as it,a9 as ot,aS as rt}from"./vendor-CDoWWVkO.js";import{A as ct}from"./ncd_appointment_service-DndrNu9z.js";import{D as dt}from"./DateInputField-Cv4kmZfO.js";import{D as _e}from"./drug_service-Dvgxgn_8.js";const Se=(e,t,n,s={})=>({drug_id:e,name:t,category:n,...s}),lt=te("OtherNCDMedicationsStore",{state:()=>({otherNCDMedications:[],selectedOtherNCDMedicationList:[]}),actions:{setSelectedNCDMedicationList(e){this.selectedOtherNCDMedicationList.push(e)},getSelectedNCDMedicationList(){return this.selectedOtherNCDMedicationList},addSearchedDrug(e){const t=Se(e.drug_id,e.name,"Other",e);if(t.units=e.units,!this.otherNCDMedications.some(s=>s.drug_id===t.drug_id)){this.otherNCDMedications.unshift(t);const s={dosage:{morning:null,afternoon:null,evening:null},duration:null,...t};this.setSelectedNCDMedicationList(s)}},clearOtherNCDMedications(){this.otherNCDMedications=[],this.selectedOtherNCDMedicationList=[]}},persist:!0}),A=te("NCDmedicationsStore",{state:()=>({medications:[],filteredMedications:[],selectedNCDMedicationList:[],frequency_selections:w({}),currentPatientID:""}),actions:{setMedications(e){this.medications=e,this.filteredMedications=e},setFilteredMedications(e){this.filteredMedications=e},initMedications(){},setSelectedNCDMedicationList(e){this.selectedNCDMedicationList.push(e)},getSelectedNCDMedicationList(){return this.selectedNCDMedicationList},clearMedicationDataStores(){this.medications=[],this.filteredMedications=[],this.selectedNCDMedicationList=[],this.frequency_selections=[]},setCurrentPatientID(e){this.currentPatientID=e}},persist:!0});function sn(){try{const e=A(),t=lt();e.medications=[...t.otherNCDMedications,...e.medications],e.medications=e.medications.reduce((n,s)=>(n.some(a=>a.drug_id===s.drug_id)||n.push(s),n),[]),e.selectedNCDMedicationList=[...t.selectedOtherNCDMedicationList,...e.selectedNCDMedicationList],e.filteredMedications=e.medications,T("Medication added successfully")}catch(e){}}const ut={name:"DiabetesMedication",ids:[337,336,280,410,729,263,812,265,264,240,266,726,728,223]},oe={name:"AntiHypertensivesMedication",ids:[]},pt={ids:[274,168,648,289,286,164,287,288,672,257,1233,671]},mt={ids:[559,1236,1234,558,1235,1211,276,277,278,279]},ht={ids:[556,653,557,652,943,1238,1240,1237,942,1239,946,1503,944,1504,945,1505]},gt={ids:[116,85,117,1232,936,1364,937,1365,1366]};async function ye(e){const t=A(),n=e.ids.map(async s=>{try{const a=await _e.getOfflineDrugById(s);if(a){const r=t.medications.findIndex(o=>o.drug_id===a.drug_id),i=Se(a.drug_id,a.name,e.name,a);r!==-1?t.medications[r]=i:t.medications.push(i)}}catch(a){console.error("Error fetching drug ID ".concat(s,":"),a)}});return t.filteredMedications=t.medications,Promise.all(n)}async function on(e){try{const t=await _e.getOfflineDrugById(e);return{drug_id:e,dosage:{morning:null,afternoon:null,evening:null},duration:null,...t}}catch(t){Ae("Error fetching drug details. Please try again."),console.error("Error fetching drug details:",t)}}function rn(){return ye(ut)}function cn(){return oe.ids=[...pt.ids,...mt.ids,...ht.ids,...gt.ids],ye(oe)}function Dt(){A().clearMedicationDataStores()}function ft(e){A().setCurrentPatientID(e)}function dn(e){A().currentPatientID!=e&&(Dt(),ft(e))}function ln(){return A().selectedNCDMedicationList.some(t=>{const{morning:n,afternoon:s,evening:a}=t.dosage,r=typeof n=="string"?Number(n):n,i=typeof s=="string"?Number(s):s,o=typeof a=="string"?Number(a):a;return typeof r=="number"&&r>0||typeof i=="number"&&i>0||typeof o=="number"&&o>0})}class _t extends ce{constructor(t,n){super(t,105,n)}}class St extends ce{constructor(t,n){super(t,25,n)}static async get_____(t="",n=1,s=10){}}async function un(e){var t,n,s;try{const a=b(),{patient:r}=q(a),i=JSON.parse(JSON.stringify(r.value));(s=(n=(t=i.allergies)!=null?t:i.allergies={}).unsaved)!=null||(n.unsaved=[]),i.allergies.unsaved.push(...e),await G(i),T("Allergies saved successfully")}catch(a){k("Unable to save Allegies!")}}class pn{async onSubmitNotes(t,n,s){const a=new _t(t,n);await a.createEncounter(),await a.saveObservationList(s)}async onSubmitAllergies(t,n,s){try{const a=new St(t,n);await a.createEncounter(),await a.saveObservationList(s),T("Allergies saved successfully")}catch(a){console.error("Error saving allergies:",a),k("Failed to save allergies")}}}class mn{constructor(){O(this,"programID");O(this,"providerID");O(this,"patientID");O(this,"date");O(this,"demographics");O(this,"previousDrugPrescriptions",[]);O(this,"previousClinicalNotes");O(this,"previousDrugAllergies");const t=b();this.demographics=t.patient,this.patientID=this.demographics.patientID,this.date=Z.getSessionDate(),this.providerID=S.getUserID(),this.programID=Z.getProgramID(),this.previousClinicalNotes={},this.previousDrugAllergies={}}async getPatientEncounters(){const t=await this.getPatientVisitDates(),n=t.map(async a=>{const r=a.value,i=await Oe.getEncounters(this.patientID,{date:r});await Promise.all(i.map(async o=>{var m;if(o.type.name=="NOTES"){const{observations:c}=o;j.isEmpty(c)||c.forEach(u=>{if(u.concept_id=="2688"){const d=g.toStandardHisDisplayFormat(u.obs_datetime);j.isEmpty(this.previousClinicalNotes.hasOwnProperty(d))&&(this.previousClinicalNotes[d]=[]),this.previousClinicalNotes[d].push({date:d,notes:u.value_text})}})}if(o.type.name=="TREATMENT"){const{observations:c}=o;if(!j.isEmpty(c))for(const u in c){let d="<UNKNOWN CONCEPT>";const D=c[u];try{(m=D==null?void 0:D.concept)!=null&&m.concept_names?d=D.concept.concept_names[0].name:d=await de.getConceptName(D.concept_id)}catch(Y){console.error(D,Y)}const B=await Z.resolvePrimaryValue(D),x=g.toStandardHisDisplayFormat(D.date_created);d=="Allergic"&&(this.previousDrugAllergies.hasOwnProperty(x)||(this.previousDrugAllergies[x]=[]),this.previousDrugAllergies[x].push({date:x,value:B}))}}}))});await Promise.all(n);const s=t.map(async a=>{const r=await le.getOrderByPatient(this.patientID,{start_date:a.value});if(!j.isEmpty(r)){const i=r.map(o=>({drugName:o.drug.name,value:g.toStandardHisTimeFormat(o.order.start_date),dose:o.dose,frequency:ze(o.frequency),prescription:g.toStandardHisFormat(o.order.auto_expire_date),duration:yt(o.order.instructions),other:o}));this.previousDrugPrescriptions.push({prescriptionDate:g.toStandardHisDisplayFormat(a.value),previousPrescriptions:i})}});return await Promise.all(s),{previousDrugPrescriptions:this.previousDrugPrescriptions,previousClinicalNotes:this.previousClinicalNotes,previousDrugAllergies:this.previousDrugAllergies}}async getPatientVisitDates(){return(await ue.getPatientVisits(this.patientID,!1)).map(t=>({label:g.toStandardHisDisplayFormat(t),value:t,other:{isActive:t===we.getSessionDate()}}))}}function yt(e){const t=/(\d+)\s+days/i,n=e.match(t);return n&&n.length>1?parseInt(n[1]):null}async function hn(){const e=b(),{patient:t}=q(e),n=t.value,s=[8809,903,6410,6409];let a;S.getModsStatus()||S.getUseIndexDBStatus()?a=await be("diagnosis",{likeClause:"",currentPage:1,itemsPerPage:2e3}).then(d=>d.records):a=await S.getJson("diagnosis",{id:7409,page_size:2e3});const r=a.filter(d=>s.includes(d.concept_id)),i=n.diagnosis.saved.map(d=>d.value_coded),o=n.diagnosis.unsaved.map(d=>d.value_coded),m=[...i,...o];return r.filter(d=>m.includes(d.concept_id)).map(d=>d.name)}const vt=V({created(){},components:{IonItem:ae,IonCol:qe,IonLabel:ne,IonIcon:he},data(){return{iconsContent:pe,localMedicalDrugsList:[...this.$props._selectedMedicalDrugsList]}},props:{_selectedMedicalDrugsList:{type:Array,default:[]},show_actions_buttons:{type:Boolean,default:!0},highLightBackground:{type:String,default:"item-native"}},watch:{},methods:{highlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#006401"),this.highlightActionBtns(e)},undoHighlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#636363"),this.undohighlightActionBtns(e)},highlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let n=0;n<t.length;n++)t[n].style.display="inline-block"},undohighlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let n=0;n<t.length;n++)t[n].style.display="none"},asignLblID(e){return e+"_lbl"},asignSpanLblID(e){return e+"_spanlbl"},async removeItemAtIndex(e,t){await Pe("Do you want to delete it?",t)&&this.$emit("remove-item",e)},editItemAtIndex(e){this.$emit("edit-item",e)},highLightBnd(e){if(e){if(e.highlightbackground!==void 0&&e.highlightbackground==!0)return this.$props.highLightBackground}else return!1}}}),Ct=["onMousemove","onMouseout"],Nt={class:"route-label"};function Mt(e,t,n,s,a,r){const i=I("ion-label"),o=I("ion-col"),m=I("ion-row"),c=I("ion-icon");return M(!0),$(De,null,ge(e.localMedicalDrugsList,(u,d)=>(M(),$("div",{id:"df",class:"medication-item",key:d,onMousemove:D=>e.highlightItem(d),onMouseout:D=>e.undoHighlightItem(d)},[l(m,{class:"medication-header"},{default:p(()=>[l(o,{class:U(["ion-text-wrap",e.highLightBnd(u)])},{default:p(()=>[l(i,{id:e.asignLblID(d),class:"medication-name"},{default:p(()=>[E(v(u.drugName),1)]),_:2},1032,["id"])]),_:2},1032,["class"])]),_:2},1024),l(m,{class:"medication-details"},{default:p(()=>[l(o,{size:"10",class:U(["ion-text-wrap details-col",e.highLightBnd(u)])},{default:p(()=>[l(i,{class:"details-text"},{default:p(()=>[E(v(u.dose)+" / "+v(u.frequency)+" / daily / "+v(u.duration)+" / until "+v(u.prescription)+" ",1),_("span",Nt,v(u.route_name),1)]),_:2},1024)]),_:2},1032,["class"]),e.show_actions_buttons?(M(),K(o,{key:0,class:U([e.highLightBnd(u),"actions-col"]),size:"2"},{default:p(()=>[l(i,{class:U(["action-button",e.asignSpanLblID(d)]),onClick:D=>e.editItemAtIndex(d)},{default:p(()=>[l(c,{icon:e.iconsContent.edit},null,8,["icon"])]),_:2},1032,["class","onClick"]),l(i,{class:U(["action-button",e.asignSpanLblID(d)]),onClick:D=>e.removeItemAtIndex(d,D)},{default:p(()=>[l(c,{icon:e.iconsContent.delete},null,8,["icon"])]),_:2},1032,["class","onClick"])]),_:2},1032,["class"])):se("",!0)]),_:2},1024)],40,Ct))),128)}const gn=Q(vt,[["render",Mt],["__scopeId","data-v-01c693a3"]]),It={key:0,class:"custom-allergy-container"},At=V({watch:{},name:"AllergiesComponent"}),Ot=V({...At,setup(e){const t=Le(),n=b(),s=H(()=>t.selectedMedicalAllergiesList),a=H(()=>n.patient),r=H(()=>t.medicalAllergiesList),i=w(Y(8,"item-")),o=w(),m=w(!1),c=[{multi_Selection:!0,show_list_label:!0,unqueId:i.value,name_of_list:"Add/Remove allergies",placeHolder:"Search for an allergy",items:[],listUpdatedFN:D,listFilteredFN:()=>{},searchTextFN:B,use_internal_filter:!0,show_error:w(!1),error_message:"please select a User",disabled:w(!1)}],u=w(!1);fe(async()=>{d()});const d=()=>{t.current_patient.ID!=a.value.ID&&(t.clearSelectedMedicalAllergiesList(),t.setCurrentPatient(a.value))};function D(y){y.forEach(h=>{h.selected==!0&&h.name==="Other"&&(m.value=h.name==="Other")}),t.setSelectedMedicalAllergiesList(y),x()}async function B(y){const h=y,f=await de.getConceptSet("OPD Medication",h);f.map(z=>({label:z.name,value:z.name,other:z}));const C=ke(h),R=xe(C,f).sort((z,Ne)=>z.name.localeCompare(Ne.name));t.setMedicalAllergiesList(R),x()}function x(){const y=r.value;s.value.forEach(f=>{let C=!1;y.forEach((F,R)=>{F.concept_id==f.concept_id&&f.selected===!0&&(y[R]=f,C=!0)}),!C&&f.selected===!0&&y.push(f)});const h=y.filter((f,C,F)=>C===F.findIndex(R=>R.concept_id===f.concept_id));t.setMedicalAllergiesList(h)}function Y(y=8,h=""){const f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let C=h;for(let F=0;F<y;F++)C+=f.charAt(Math.floor(Math.random()*f.length));return C+="-".concat(Date.now()),C}async function Ce(y){try{const h=y.trim();if(h){const f={name:h,selected:!0};t.setMedicalAllergiesList([...r.value,f]),t.setSelectedMedicalAllergiesList(f),m.value=!1,u.value=!0,o.value="";const C=t.findSelectedAllergyByName("Other");t.removeSelectedAllergy(C)}}catch(h){console.error(h)}}return(y,h)=>(M(),K(N(Je),null,{default:p(()=>[l(N(je),null,{default:p(()=>[l(N(ne),{class:"header-container"},{default:p(()=>[l(N(he),{icon:N(We),class:"allergy-icon"},null,8,["icon"]),h[2]||(h[2]=_("span",{style:{"font-size":"16px","font-weight":"600"}}," Allergies (Medication, Healthcare items, Environment and Food) ",-1))]),_:1,__:[2]})]),_:1}),l(N(Ge),null,{default:p(()=>[l(Fe,{multiSelection:c[0].multi_Selection,show_label:c[0].show_list_label,uniqueId:c[0].unqueId,name_of_list:c[0].name_of_list,choose_place_holder:c[0].placeHolder,"items_-list":r.value,use_internal_filter:c[0].use_internal_filter,disabled:c[0].disabled.value,onItemListUpDated:c[0].listUpdatedFN,onItemListFiltered:c[0].listFilteredFN,onItemSearchText:c[0].searchTextFN},null,8,["multiSelection","show_label","uniqueId","name_of_list","choose_place_holder","items_-list","use_internal_filter","disabled","onItemListUpDated","onItemListFiltered","onItemSearchText"]),m.value?(M(),$("div",It,[l(N(Qe),{modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=f=>o.value=f),placeholder:"Please specify the allergy",fill:"outline",class:"custom-input"},null,8,["modelValue"]),l(N(Ke),{onClick:h[1]||(h[1]=f=>Ce(o.value)),class:"addCustomAllergyBtn"},{default:p(()=>h[3]||(h[3]=[E(" Add Allergy ")])),_:1,__:[3]})])):se("",!0)]),_:1})]),_:1}))}}),Dn=Q(Ot,[["__scopeId","data-v-8aa98f55"]]),wt=te("nonPharmaTherapyStore",{state:()=>({items:[{id:"wound-dressing",label:"Wound dressing",checked:!1},{id:"patient-education",label:"Patient education",checked:!1},{id:"counseling",label:"Counseling",checked:!1},{id:"minor-surgery",label:"Minor Surgery",checked:!1}],current_patient:{}}),actions:{async saveNonPharmaTherapyPatientData(){const e=Ee(),t=[];this.items.forEach(n=>{n.checked==!0&&t.push({concept_id:11023,value_coded:2592,value_text:JSON.stringify(n),obs_datetime:g.toStandardHisFormat(S.getSessionDate()),location_id:e.facilityLocation.code})});try{t.length>0&&bt(t)}catch(n){k("Unable to update Non Pharma Therapy!")}this.clearSelectednonPharmaTherapyStore()},clearSelectednonPharmaTherapyStore(){this.items.forEach(e=>{e.checked=!1})},setCurrentPatient(e){this.current_patient=e}},persist:!0});async function bt(e){var t,n,s;try{const a=b(),{patient:r}=q(a),i=JSON.parse(JSON.stringify(r.value));(s=(n=(t=i.notes)!=null?t:i.notes={}).unsaved)!=null||(n.unsaved=[]),i.notes.unsaved.push(...e),await G(i),T("Non Pharma Therapy has been saved")}catch(a){k("Unable to create non pharmalogical notes!")}}const Pt={class:"checklist-container"},Lt=V({watch:{},name:"xxxComponent"}),kt=V({...Lt,setup(e){const t=b(),n=H(()=>t.patient),s=wt(),a=s.items;fe(async()=>{r()});const r=()=>{s.current_patient.ID!=n.value.ID&&(s.clearSelectednonPharmaTherapyStore(),s.setCurrentPatient(n.value))};return Ye(()=>n.value,async i=>{}),(i,o)=>(M(),$("div",Pt,[(M(!0),$(De,null,ge(N(a),m=>(M(),K(N(ae),{key:m.id,class:"no-border"},{default:p(()=>[l(N(Ze),{id:m.id,modelValue:m.checked,"onUpdate:modelValue":c=>m.checked=c,slot:"start"},null,8,["id","modelValue","onUpdate:modelValue"]),l(N(ne),{style:{"font-size":"16px","font-weight":"600"}},{default:p(()=>[E(v(m.label),1)]),_:2},1024)]),_:2},1024))),128))]))}}),fn=Q(kt,[["__scopeId","data-v-371e920f"]]);async function _n(){var e,t,n;try{const s=b(),{patient:a}=q(s),r=Ft(),i=JSON.parse(JSON.stringify(a.value));if(r.length>0){(n=(t=(e=i.MedicationOrder)!=null?e:i.MedicationOrder={}).unsaved)!=null||(t.unsaved=[]);const o=i.MedicationOrder.unsaved.findIndex(c=>c.NCD_Drug_Orders);if(o>=0)i.MedicationOrder.unsaved[o].NCD_Drug_Orders=[...i.MedicationOrder.unsaved[o].NCD_Drug_Orders,...r];else{const c={NCD_Drug_Orders:r};i.MedicationOrder.unsaved.push(c)}await G(i),A().clearMedicationDataStores(),T("Drug order(s) has been created")}else k("Unable to create drug orders!")}catch(s){k("Unable to create drug orders!")}}function re(){try{const e=new Date(S.getSessionDate()),n=ee().selectedMedicalDrugsList;let s=0;if(n.forEach(c=>{const u=parseInt(c.duration,10);!isNaN(u)&&u>s&&(s=u)}),s<=0)return{date:null,formattedDate:null};const a=new Date(e);a.setDate(e.getDate()+s);const r=String(a.getDate()).padStart(2,"0"),i=String(a.getMonth()+1).padStart(2,"0"),o=a.getFullYear(),m="".concat(r,"/").concat(i,"/").concat(o);return{date:a,formattedDate:m}}catch(e){return console.error("Error calculating OPD medication run out date:",e),{date:null,formattedDate:null}}}function xt(){try{const e=new Date(S.getSessionDate()),n=A().selectedNCDMedicationList;let s=0;if(n.forEach(c=>{const u=parseInt(c.duration,10);!isNaN(u)&&u>s&&(s=u)}),s<=0)return{date:null,formattedDate:null};const a=new Date(e);a.setDate(e.getDate()+s);const r=String(a.getDate()).padStart(2,"0"),i=String(a.getMonth()+1).padStart(2,"0"),o=a.getFullYear(),m="".concat(r,"/").concat(i,"/").concat(o);return{date:a,formattedDate:m}}catch(e){return console.error("Error calculating medication run out date:",e),{date:null,formattedDate:null}}}const Ft=()=>{const e=A();return e.selectedNCDMedicationList.map(t=>{t.frequency=e.frequency_selections[t.drug_id]||"",t.totalDosage=Object.values(t.dosage).reduce((a,r)=>a+Number(r),0);const n=me.getSessionDate(),s=Bt(t.drug_id);return{drug_inventory_id:t.drug_id,equivalent_daily_dose:t.totalDosage=="Unknown"?0:t.totalDosage*(s==null?void 0:s.value)||0,start_date:n,auto_expire_date:ve(n,t.duration),units:t.units,instructions:"".concat(t.name," ").concat(t.totalDosage," ").concat(t.units," ").concat((s==null?void 0:s.code)||""," for ").concat(t.duration," days"),dose:Et(t),frequency:(s==null?void 0:s.code)||""}})},Et=e=>e.dose_strength!=null&&e.dose_strength?Math.trunc(e.dose_strength):1;async function Sn(){var e,t,n;try{const s=b(),{patient:a}=q(s),r=$t(),i=JSON.parse(JSON.stringify(a.value));if(r.length>0){(n=(t=(e=i.MedicationOrder)!=null?e:i.MedicationOrder={}).unsaved)!=null||(t.unsaved=[]);const o=i.MedicationOrder.unsaved.findIndex(c=>c.NCD_Drug_Orders);if(o>=0)i.MedicationOrder.unsaved[o].NCD_Drug_Orders=[...i.MedicationOrder.unsaved[o].NCD_Drug_Orders,...r];else{const c={NCD_Drug_Orders:r};i.MedicationOrder.unsaved.push(c)}await G(i),ee().clearSelectedMedicalDrugsList(),T("Drug order(s) has been created")}else k("Unable to create drug orders!")}catch(s){k("Unable to create drug orders!")}}const $t=()=>ee().selectedMedicalDrugsList.map(t=>{const n=me.getSessionDate(),s=L.find(a=>a.label===t.frequency)||{};return{drug_inventory_id:t.drug_id,equivalent_daily_dose:t.dose=="Unknown"?0:t.dose*(s==null?void 0:s.value)||0,start_date:n,auto_expire_date:ve(n,t.duration),units:t.units,instructions:"".concat(t.drugName,": ").concat(t.dose," ").concat(t.units," ").concat((s==null?void 0:s.code)||""," for ").concat(t.duration," days"),dose:t.dose,frequency:(s==null?void 0:s.code)||""}}),Bt=e=>{const n=A().selectedNCDMedicationList.find(a=>a.drug_id===e);if(!n||!n.dosage)return null;switch(["morning","afternoon","evening"].reduce((a,r)=>a+(n.dosage[r]?1:0),0)){case 1:return n.dosage.morning?L.find(a=>a.code==="QAM"):n.dosage.afternoon?L.find(a=>a.code==="QNOON"):n.dosage.evening?L.find(a=>a.code==="QPM"):L.find(a=>a.code==="OD");case 2:return L.find(a=>a.code==="BD");case 3:return L.find(a=>a.code==="TDS");default:return L.find(a=>a.code==="Unknown")}},ve=(e,t)=>{const n=new Date(e);return n.setDate(n.getDate()+parseInt(t)),g.toStandardHisFormat(n)},Ut=V({components:{IonContent:ot,IonHeader:it,IonItem:ae,IonList:st,IonMenu:at,IonTitle:nt,IonToolbar:tt,BasicInputField:Be,IonDatetime:et,IonBadge:Xe,DateInputField:dt,DynamicButton:$e},setup(){const e=X(),t=w(0),n=H(()=>e.getDisabledDates()),s=H(()=>e.getAssignedAppointments()),a=w();return{disabledDates:n,datesCounts:s,appointment_count:t,calendarOutline:rt,inputPRDate:a}},data(){return P(),ie(),{iconsContent:pe,date:new Date(S.getSessionDate()),tomorrow:new Date(S.getSessionDate()).getDate()+1,appointment:"",drugRunoutDate:"",nextAppointmentDate:"",minDate:new Date(S.getSessionDate())}},computed:{...W(P,["nextAppointment","appointmentCountsCache","currentSelectedNextAppointmentDate"]),...W(X,["maximumNumberOfDaysForEachDay","assignedAppointmentsDates"]),...W(b,["patient"]),...W(ie,["activeProgram"]),calendarDate(){const e=P();return e.currentSelectedNextAppointmentDate?g.toStandardHisDisplayFormat(e.currentSelectedNextAppointmentDate):""},runOutDate(){var e;return((e=this.activeProgram)==null?void 0:e.program_id)===14?re():xt()}},watch:{calendarDate:{handler(){this.updateNextAppointment()},deep:!0},"$service.sessionDate":{handler(){this.updateMinDate()},immediate:!0},"patient.ID":{async handler(e,t){e!==t&&(this.cleanCurrentNextAppointmentDate(),this.checkIfSamePatientInContext())}}},async mounted(){this.checkIfSamePatientInContext(),await this.getAppointmentMents(this.runOutDate.date),await Ve().loadGlobalProperty(),this.validateAppointmentCountsCache(),await this.preloadAppointmentCounts(),Re();const e=S.getUserID(),t=new ue;this.appointment=new J(t.getID(),e),this.nextAppointmentDate=this.appointment.date,this.supposedRunOutDate(),window.addEventListener("storage",this.handleStorageChange),re()},beforeUnmount(){window.removeEventListener("storage",this.handleStorageChange)},methods:{handleStorageChange(e){e.key==="sessionDate"&&this.updateMinDate()},updateMinDate(){this.date=new Date(S.getSessionDate()),this.minDate=new Date(S.getSessionDate())},updateNextAppointment(){P().setNextAppointment(this.calendarDate)},async handleDateUpdate(e){e&&(X().setsssignedAppointmentsDates(e,!0),this.calendarDate=g.toStandardHisDisplayFormat(e),await this.save(),await this.getAppointmentMents(e),await this.updateAppointmentCache(e),P().setCurrentSelectedNextAppointmentDate(e,this.patient.ID))},async getAppointmentMents(e){if(Te().apiStatus)try{const n=await J.getDailiyAppointments(g.toStandardHisFormat(e),g.toStandardHisFormat(e));this.appointment_count=n.length}catch(n){}},getCounter(e){const t=g.toStandardHisFormat(e);return this.appointmentCountsCache[t]||""},async save(){if(this.assignedAppointmentsDates.length>0)try{const t=await new ct().createOfflineAppointment()}catch(e){}},async openCornfirmModal(e){this.calendarDate=g.toStandardHisDisplayFormat(e),await this.getAppointmentMents(e),Ue(He,{class:"otherVitalsModal"},!0,{message:"Are you sure you want to add this Appointment?"},{cancel:a=>{},confirm:async a=>{a.detail==!0&&await this.handleDateUpdate(e)}})},async handleInput(e){this.inputPRDate=g.toStandardHisDisplayFormat(e),await this.openCornfirmModal(e)},async supposedRunOutDate(){await le.getLastDrugsReceived(this.patient.patientID)},async preloadAppointmentCounts(){try{const e=new Date(S.getSessionDate());e.setDate(1);const t=new Date(S.getSessionDate());t.setMonth(t.getMonth()+2),t.setDate(0);try{const n=await J.getDailiyAppointments(g.toStandardHisFormat(e),g.toStandardHisFormat(t)),s=this.filterUniqueAppointments(n),a={};s.forEach(r=>{const i=new Date(r.appointment_date),o=g.toStandardHisFormat(i);a[o]||(a[o]=0),a[o]++}),Object.keys(a).forEach(r=>{this.appointmentCountsCache[r]=a[r]})}catch(n){console.error("Error fetching appointments for date range:",n)}}catch(e){console.error("Error in preload process:",e)}},filterUniqueAppointments(e){const t=new Map;return e.forEach(n=>{const s="".concat(n.given_name,"_").concat(n.family_name,"_").concat(n.birthdate,"_").concat(n.appointment_date);t.has(s)||t.set(s,n)}),Array.from(t.values())},async updateAppointmentCache(e){try{const t=g.toStandardHisFormat(e),n=await J.getDailiyAppointments(g.toStandardHisFormat(e),g.toStandardHisFormat(e));this.appointmentCountsCache[t]=n.length}catch(t){console.error("Error updating appointment cache:",t)}},validateAppointmentCountsCache(){P().checkCurrentLocationIfInContext()},isRunOutDate(e){return!this.runOutDate||!this.runOutDate.date?!1:g.toStandardHisFormat(e)===g.toStandardHisFormat(this.runOutDate.date)},cleanCurrentNextAppointmentDate(){P().cleanCurrentSelectedNextAppointmentDate()},checkIfSamePatientInContext(){const e=P();e.current_patient.ID!=this.patient.ID&&(this.cleanCurrentNextAppointmentDate(),e.setCurrentPatient(this.patient))}}}),Ht={class:"card_content"},Tt={class:"count-badge"},Vt={class:"dates_title"},Rt={class:"sub_data"},zt={class:"dates_title"},qt={class:"sub_data"},Jt={class:"dates_title"},jt={class:"sub_data"},Wt={class:"dates_title"},Gt={class:"sub_data"};function Qt(e,t,n,s,a,r){const i=I("VueDatePicker"),o=I("ion-col"),m=I("DynamicButton"),c=I("ion-item"),u=I("ion-row"),d=I("DateInputField");return M(),$("div",Ht,[l(u,null,{default:p(()=>[l(o,{"size-sm":"12","size-md":"12","size-lg":"12","size-xl":"8"},{default:p(()=>[l(i,{class:"calender",onDateUpdate:e.openCornfirmModal,inline:"","auto-apply":"","enable-time-picker":!1,"disabled-dates":e.disabledDates,"min-date":e.minDate,modelValue:e.runOutDate.date,"onUpdate:modelValue":t[0]||(t[0]=D=>e.runOutDate.date=D)},{day:p(({day:D,date:B})=>[(M(),$("p",{key:0,class:U({"run-out-date":e.isRunOutDate(B)}),style:{"font-weight":"600","font-size":"20px"}},[_("span",null,[E(v(D),1),_("sup",Tt,v(e.getCounter(B)),1)])],2))]),_:1},8,["onDateUpdate","disabled-dates","min-date","modelValue"])]),_:1}),l(o,null,{default:p(()=>[l(c,null,{default:p(()=>[_("div",Vt,[t[3]||(t[3]=_("div",null,[E("Suggested Next Appointment Date "),_("span",{style:{"font-size":"16px"}},"(Medication run out date)")],-1)),_("div",Rt,[E(v(e.runOutDate.formattedDate||"No run out date available")+" ",1),e.runOutDate.formattedDate?(M(),K(m,{key:0,onClick:t[1]||(t[1]=D=>e.handleDateUpdate(e.runOutDate.date)),name:"Set Next Appt.",fill:"solid",iconSlot:"icon-only",style:{float:"right"}})):se("",!0)])])]),_:1}),l(c,null,{default:p(()=>[_("div",zt,[t[4]||(t[4]=_("div",null,"User set appointment date",-1)),_("div",qt,v(e.calendarDate),1)])]),_:1}),l(c,null,{default:p(()=>[_("div",Jt,[t[5]||(t[5]=_("div",null,"Appointments",-1)),_("div",jt,v(e.appointment_count),1)])]),_:1}),l(c,null,{default:p(()=>[_("div",Wt,[t[6]||(t[6]=_("div",null,"Appointment limit (per/day)",-1)),_("div",Gt,v(e.appointment_count)+"/"+v(e.maximumNumberOfDaysForEachDay),1)])]),_:1})]),_:1})]),_:1}),l(u,null,{default:p(()=>[l(o,{size:"4"},{default:p(()=>[l(d,{inputHeader:"Preferred Next Appointment Date",bold:"600",fontSize:"17px",placeholderFontSize:"17px",placeholderFontWeight:"600",unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.inputPRDate,eventType:"",minDate:e.minDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t[2]||(t[2]=D=>e.handleInput(D))},null,8,["icon","inputValue","minDate"])]),_:1})]),_:1})])}const yn=Q(Ut,[["render",Qt],["__scopeId","data-v-2742dd5f"]]);export{Dn as A,gn as D,ln as M,yn as N,mn as P,pn as T,bt as a,wt as b,_n as c,Sn as d,dn as e,ft as f,hn as g,cn as h,rn as i,Dt as j,lt as k,on as l,sn as m,fn as n,un as s,A as u};

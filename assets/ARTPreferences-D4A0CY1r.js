import{d as T,r as H,a as z,w as j,e as C,f as p,k as S,F as D,L as R,l as m,z as v,A as N,B as h,u,ay as J,dh as X,cC as Y,eG as F,ej as K,em as W,eH as q,eI as Q,y as f,ao as Z,ag as B,ad as G,M as ee,J as ae,G as L,m as b,I as te,D as P,bP as le,an as se,cz as re,d7 as M,ar as ie,av as ne,au as ue}from"./vendor-DowD5zKn.js";import{_ as de,I as c,cw as o,T as oe}from"./index-Cd6xOYoL.js";import{g as ce}from"./LocationFieldOptions-ChZiqghB.js";import"./lodash-Dt8AsbQm.js";const me={class:"clinic-days-selector"},ve={class:"days-container"},ge=T({__name:"ClinicDaysSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(k,{emit:l}){const E=k,A=l,V=[{label:"Monday",value:"Monday"},{label:"Tuesday",value:"Tuesday"},{label:"Wednesday",value:"Wednesday"},{label:"Thursday",value:"Thursday"},{label:"Friday",value:"Friday"},{label:"Saturday",value:"Saturday"},{label:"Sunday",value:"Sunday"}],d=H([]);z(()=>{if(E.modelValue)try{try{const g=JSON.parse(E.modelValue);Array.isArray(g)?d.value=g:d.value=E.modelValue.split(",").map(_=>_.trim())}catch(g){d.value=E.modelValue.split(",").map(_=>_.trim())}}catch(g){console.error("Error parsing clinic days:",g),d.value=[]}});const y=g=>{const _=d.value.indexOf(g);_===-1?d.value.push(g):d.value.splice(_,1);const e=d.value.join(",");A("update:modelValue",e),A("change",e)};return j(()=>E.modelValue,g=>{if(g)try{try{const _=JSON.parse(g);Array.isArray(_)?d.value=_:d.value=g.split(",").map(e=>e.trim())}catch(_){d.value=g.split(",").map(e=>e.trim())}}catch(_){console.error("Error parsing clinic days:",_),d.value=[]}else d.value=[]}),(g,_)=>(p(),C("div",me,[S("div",ve,[(p(),C(D,null,R(V,e=>S("div",{key:e.value,class:"day-checkbox"},[m(u(J),{value:e.value,checked:d.value.includes(e.value),onIonChange:t=>y(e.value),labelPlacement:"end"},{default:v(()=>[N(h(e.label),1)]),_:2},1032,["value","checked","onIonChange"])])),64))])]))}}),pe=de(ge,[["__scopeId","data-v-95b0e034"]]),_e={class:"ion-padding",slot:"content"},ye={key:0},be={key:1},Ne={key:2},he={class:"ion-padding"},Ce={key:3},Ee={class:"ion-padding"},Le=T({__name:"ARTPreferences",setup(k){const l=H({}),E=H([]),A=H(!1),V=async(e="")=>{A.value=!0;try{const t=await ce(e);E.value=t}catch(t){}finally{A.value=!1}},d=async(e,t,a)=>{if(l.value[a]){const s=!!e;l.value[a].data[t]=s,l.value[a].isLoading=!0,l.value[a].statusMessage=void 0;try{await c.set(t,s?"true":"false"),console.log("Successfully saved ".concat(t," with value: ").concat(s))}catch(n){console.error("Error saving ".concat(t,":"),n),l.value[a].statusMessage="Failed to save: ".concat(n instanceof Error?n.message:"Unknown error")}finally{l.value[a].isLoading=!1}}},y=async(e,t,a,s=!1)=>{if(l.value[a]){l.value[a].data[t]=e,l.value[a].isLoading=!0,l.value[a].statusMessage=void 0;try{let n=e;if(e&&typeof e=="object"&&"value"in e&&(n=e.label),s&&typeof n=="string"){const I=Number(n);if(isNaN(I)){l.value[a].statusMessage="Please enter a valid number",l.value[a].isLoading=!1;return}}await c.set(t,n)}catch(n){console.error("Error saving ".concat(t,":"),n),l.value[a].statusMessage="Failed to save: ".concat(n instanceof Error?n.message:"Unknown error")}finally{l.value[a].isLoading=!1}}},g=[{icon:X,title:"Filing Numbers",options:[{id:o.FILING_NUMBERS,title:"Enabled Filing Number",type:"toggle",get:e=>c.isProp("".concat(e,"=true")),dataHandler:(e,t,a)=>d(e,t,a)},{id:o.FILING_NUMBER_LIMIT,title:"Filing Number Limit",type:"input",get:e=>c.get(e)||"",dataHandler:(e,t,a)=>{const s=Number(e);if(isNaN(s)){l.value[a].statusMessage="Please enter a valid number";return}if(s<1||s>1e3){l.value[a].statusMessage="Filing number limit should be between 1 and 1000";return}y(e,t,a,!0)}}]},{icon:Y,title:"Appointments",options:[{id:o.APPOINTMENT_LIMIT,title:"Appointment Limit",type:"input",get:e=>c.get(e)||"",dataHandler:(e,t,a)=>{const s=Number(e);if(isNaN(s)){l.value[a].statusMessage="Please enter a valid number";return}if(s<1||s>500){l.value[a].statusMessage="Appointment limit should be between 1 and 500";return}y(e,t,a,!0)}},{id:o.ADULT_CLINIC_DAYS,title:"Clinic days (adults: 18 yrs and over)",type:"clinic-days",get:e=>c.get(e)||"",dataHandler:(e,t,a)=>y(e,t,a,!1)},{id:o.PEADS_CLINIC_DAYS,title:"Clinic days (children: Under 18 yrs)",type:"clinic-days",get:e=>c.get(e)||"",dataHandler:(e,t,a)=>y(e,t,a,!1)}]},{icon:F,title:"Clinic Preferences",options:[{id:o.IS_DIC_SITE,title:"Is Military Site",type:"toggle",get:e=>c.isProp("".concat(e,"=true")),dataHandler:(e,t,a)=>d(e,t,a)}]},{icon:K,title:"Viral load Preferences",options:[{id:o.VL_ROUTINE_CHECK,title:"Activate VL routine check",type:"toggle",get:e=>c.isProp("".concat(e,"=true")),dataHandler:(e,t,a)=>d(e,t,a)},{id:o.CAN_SCAN_DBS_BARCODE,title:"Scan DBS barcode",type:"toggle",get:e=>c.isProp("".concat(e,"=true")),dataHandler:(e,t,a)=>d(e,t,a)}]},{icon:W,title:"Lab preferences",options:[{id:o.EXTENDED_LABS,title:"Activate Extended Labs",type:"toggle",get:e=>c.isProp("".concat(e,"=true")),dataHandler:(e,t,a)=>d(e,t,a)},{id:o.TARGET_LAB,title:"Target lab",type:"facility",get:e=>c.get(e)||"",dataHandler:(e,t,a)=>y(e,t,a,!1)},{id:o.LAB_ORDER_PRINT_COPIES,title:"Specify number of copies to print after an order",type:"input",get:e=>c.get(e)||"",dataHandler:(e,t,a)=>{const s=Number(e);if(isNaN(s)){l.value[a].statusMessage="Please enter a valid number";return}if(s<1||s>10){l.value[a].statusMessage="Number of copies should be between 1 and 10";return}y(e,t,a,!0)}}]},{icon:q,title:"Hypertension Preferences",options:[{id:o.HTN_ENHANCEMENT,title:"Activate Hypertension screening",type:"toggle",get:e=>c.isProp("".concat(e,"=true")),dataHandler:(e,t,a)=>d(e,t,a)},{id:o.HTN_DIASTOLIC_THRESHOLD,title:"Set diastolic blood pressure minimum threshold",type:"input",get:e=>c.get(e)||"",dataHandler:(e,t,a)=>{const s=Number(e);if(isNaN(s)){l.value[a].statusMessage="Please enter a valid number";return}if(s<40||s>120){l.value[a].statusMessage="Diastolic BP should be between 40 and 120 mmHg";return}y(e,t,a,!0)}},{id:o.HTN_SYSTOLIC_THRESHOLD,title:"Set systolic blood pressure minimum threshold",type:"input",get:e=>c.get(e)||"",dataHandler:(e,t,a)=>{const s=Number(e);if(isNaN(s)){l.value[a].statusMessage="Please enter a valid number";return}if(s<70||s>220){l.value[a].statusMessage="Systolic BP should be between 70 and 220 mmHg";return}y(e,t,a,!0)}},{id:o.HTN_SCREENING_AGE_THRESHOLD,title:"Set HTN Age",type:"input",get:e=>c.get(e)||"",dataHandler:(e,t,a)=>{const s=Number(e);if(isNaN(s)){l.value[a].statusMessage="Please enter a valid number";return}if(s<10||s>100){l.value[a].statusMessage="Age threshold should be between 10 and 100 years";return}y(e,t,a,!0)}}]},{icon:Q,title:"Cervical Cancer Preferences",onOpen:async()=>{var a;l.value["Cervical Cancer Preferences"].data={[o.CERVICAL_CANCER_AGE_BOUNDS]:await c.get(o.CERVICAL_CANCER_AGE_BOUNDS)||""};const[e,t]=((a=l.value["Cervical Cancer Preferences"].data[o.CERVICAL_CANCER_AGE_BOUNDS])!=null?a:"0:0").split(":").map(Number);l.value["Cervical Cancer Preferences"].data.min_cervical_age=e,l.value["Cervical Cancer Preferences"].data.max_cervical_age=t},options:[{id:o.CERVICAL_CANCER_SCREENING,title:"Activate Cervical Cancer Screening",type:"toggle",get:e=>c.isProp("".concat(e,"=true")),dataHandler:(e,t,a)=>d(e,t,a)},{id:"min_cervical_age",title:"Starting screening age",type:"input",get:()=>l.value["Cervical Cancer Preferences"].data.min_cervical_age||"",dataHandler:(e,t,a)=>{const s=Number(e);if(isNaN(s)){l.value[a].statusMessage="Please enter valid min age";return}if(s<10||s>100){l.value[a].statusMessage="Age bounds should be between 10 and 100 years, with the minimum age being less than the maximum age";return}const n=l.value[a].data.max_cervical_age;if(n&&s>=Number(n)){l.value[a].statusMessage="Minimum age should be less than the maximum age";return}y("".concat(s,":").concat(n),o.CERVICAL_CANCER_AGE_BOUNDS,a,!1)}},{id:"max_cervical_age",title:"Maximum screening age",type:"input",get:()=>l.value["Cervical Cancer Preferences"].data.max_cervical_age||"",dataHandler:(e,t,a)=>{const s=Number(e);if(isNaN(s)){l.value[a].statusMessage="Please enter valid max age";return}if(s<10||s>100){l.value[a].statusMessage="Age bounds should be between 10 and 100 years, with the minimum age being less than the maximum age";return}const n=l.value[a].data.min_cervical_age;if(n&&s<Number(n)){l.value[a].statusMessage="Maximum age should be less than the minimum age";return}y("".concat(n,":").concat(s),o.CERVICAL_CANCER_AGE_BOUNDS,a,!1)}}]},{icon:F,title:"Other Preferences",options:[{id:o.PILLS_REMAINING,title:"Ask pills remaining at home",type:"toggle",get:e=>c.isProp("".concat(e,"=true")),dataHandler:(e,t,a)=>d(e,t,a)},{id:o.FAST_TRACK,title:"Activate fast track",type:"toggle",get:e=>c.isProp("".concat(e,"=true")),dataHandler:(e,t,a)=>d(e,t,a)},{id:o.THREE_HP_AUTO_SELECT,title:"Activate 3HP auto select",type:"toggle",get:e=>c.isProp("".concat(e,"=true")),dataHandler:(e,t,a)=>d(e,t,a)},{id:o.EXCLUDE_EXTERNAL_AND_DRUG_REFILLS,title:"(DATA CLEANING) Exclude External and Emergency supply",type:"toggle",get:e=>c.isProp("".concat(e,"=true")),dataHandler:(e,t,a)=>d(e,t,a)},{id:o.NOTIFICATION_PERIOD,title:"Set Auto Cleaning Alert Days",type:"input",get:e=>c.get(e)||"",dataHandler:(e,t,a)=>{const s=Number(e);if(isNaN(s)){l.value[a].statusMessage="Please enter a valid number";return}if(s<1||s>365){l.value[a].statusMessage="Notification period should be between 1 and 365 days";return}y(e,t,a,!0)}}]}];async function _(e){const t=g.find(a=>a.title===e);if(t){l.value[t.title]||(l.value[t.title]={isLoading:!1,data:{},statusMessage:void 0}),l.value[t.title].isLoading=!0,t.onOpen&&await t.onOpen().catch(s=>{console.error("Error loading ".concat(t.title," settings:"),s),l.value[t.title].statusMessage="Failed to load settings: ".concat(s instanceof Error?s.message:"Unknown error")});const a=await Promise.all(t.options.map(async s=>({[s.id]:await s.get(s.id)})));l.value[t.title].data={...l.value[t.title].data,...a.reduce((s,n)=>({...s,...n}),{})},l.value[t.title].isLoading=!1}}return(e,t)=>(p(),f(u(ue),null,{default:v(()=>[m(oe),m(u(Z),{class:"ion-padding"},{default:v(()=>[m(u(B),{style:{margin:"0px auto",width:"70%"}},{default:v(()=>[m(u(G),null,{default:v(()=>[m(u(ee),{onIonChange:t[0]||(t[0]=a=>_(a.detail.value))},{default:v(()=>[(p(),C(D,null,R(g,(a,s)=>m(u(ae),{key:s,class:"ion-padding",value:a.title},{default:v(()=>[m(u(L),{slot:"header"},{default:v(()=>{var n,I,r;return[m(u(te),{size:"large",icon:a.icon},null,8,["icon"]),m(u(P),{style:{padding:"10px"}},{default:v(()=>[N(h(a.title),1)]),_:2},1024),(r=(I=(n=l.value)==null?void 0:n[a.title])==null?void 0:I.isLoading)!=null&&r?(p(),f(u(le),{key:0,name:"dots",size:"small",slot:"end"})):b("",!0)]}),_:2},1024),S("div",_e,[m(u(B),null,{default:v(()=>[m(u(G),null,{default:v(()=>{var n,I;return[(I=(n=l.value)==null?void 0:n[a.title])!=null&&I.data?(p(),f(u(se),{key:0,style:{background:"white"}},{default:v(()=>[(p(!0),C(D,null,R(a.options,r=>{var x,w,$,O;return p(),C("div",{key:r.id},[r.type==="toggle"?(p(),C("div",ye,[m(u(L),{color:"light"},{default:v(()=>[m(u(P),null,{default:v(()=>[N(h(r.title),1)]),_:2},1024),m(u(re),{"onUpdate:modelValue":[i=>r.dataHandler(i,r.id,a.title),i=>l.value[a.title].data[r.id]=i],modelValue:l.value[a.title].data[r.id],size:"large",slot:"end","enable-on-off-labels":!0},null,8,["onUpdate:modelValue","modelValue"])]),_:2},1024),(x=l.value[a.title])!=null&&x.statusMessage?(p(),f(u(M),{key:0,color:"danger"},{default:v(()=>{var i;return[N(h((i=l.value[a.title])==null?void 0:i.statusMessage),1)]}),_:2},1024)):b("",!0)])):b("",!0),r.type==="input"?(p(),C("div",be,[m(u(ie),{"label-placement":"stacked",onIonChange:i=>r.dataHandler(i.detail.value,r.id,a.title),modelValue:l.value[a.title].data[r.id],"onUpdate:modelValue":i=>l.value[a.title].data[r.id]=i,style:{"margin-top":"20px"},label:r.title,fill:"outline",placeholder:"Enter value",slot:"end"},null,8,["onIonChange","modelValue","onUpdate:modelValue","label"]),(w=l.value[a.title])!=null&&w.statusMessage?(p(),f(u(M),{key:0,color:"danger"},{default:v(()=>{var i;return[N(h((i=l.value[a.title])==null?void 0:i.statusMessage),1)]}),_:2},1024)):b("",!0)])):b("",!0),r.type==="clinic-days"?(p(),C("div",Ne,[m(u(L),{color:"light"},{default:v(()=>[m(u(P),null,{default:v(()=>[N(h(r.title),1)]),_:2},1024)]),_:2},1024),S("div",he,[m(pe,{modelValue:l.value[a.title].data[r.id],"onUpdate:modelValue":i=>l.value[a.title].data[r.id]=i,onChange:i=>r.dataHandler(i,r.id,a.title)},null,8,["modelValue","onUpdate:modelValue","onChange"]),($=l.value[a.title])!=null&&$.statusMessage?(p(),f(u(M),{key:0,color:"danger"},{default:v(()=>{var i;return[N(h((i=l.value[a.title])==null?void 0:i.statusMessage),1)]}),_:2},1024)):b("",!0)])])):b("",!0),r.type==="facility"?(p(),C("div",Ce,[m(u(L),{color:"light"},{default:v(()=>{var i,U;return[m(u(P),null,{default:v(()=>[N(h(r.title),1)]),_:2},1024),N(" "+h((U=(i=l.value[a.title].data[r.id])==null?void 0:i.label)!=null?U:l.value[a.title].data[r.id]),1)]}),_:2},1024),S("div",Ee,[m(u(ne),{modelValue:l.value[a.title].data[r.id],"onUpdate:modelValue":[i=>l.value[a.title].data[r.id]=i,i=>r.dataHandler(i,r.id,a.title)],multiple:!1,taggable:!1,"close-on-select":!0,openDirection:"bottom","tag-placeholder":"Find and select facility",placeholder:"Select target lab facility",selectLabel:"",label:"label",searchable:!0,loading:A.value,onSearchChange:V,"track-by":"label",options:E.value},null,8,["modelValue","onUpdate:modelValue","loading","options"]),(O=l.value[a.title])!=null&&O.statusMessage?(p(),f(u(M),{key:0,color:"danger"},{default:v(()=>{var i;return[N(h((i=l.value[a.title])==null?void 0:i.statusMessage),1)]}),_:2},1024)):b("",!0)])])):b("",!0)])}),128))]),_:2},1024)):b("",!0)]}),_:2},1024)]),_:2},1024)])]),_:2},1032,["value"])),64))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});export{Le as default};

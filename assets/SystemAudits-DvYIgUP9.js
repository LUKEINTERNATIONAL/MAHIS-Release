import{d as W,r,c as P,w as Z,a as q,N as A,f as i,J as l,l as s,u as n,a8 as N,bh as X,a9 as Y,aa as ee,k as e,aR as V,aQ as te,m as B,aP as ae,P as f,K as u,cb as le,aO as M,e as _,i as O,b6 as $,M as m,F as U,O as z,be as ne,I as se,G as oe,E as ue,aZ as re,ae as de}from"./vendor-f_p5GZUu.js";import{T as ie,ay as F,az as G,U as ce,H as ve,_ as pe}from"./index-BgG0uIos.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-Db13O_GS.js";const fe={class:"card-wrapper"},_e={class:"date-controls"},ge={class:"date-inputs"},me={class:"date-input-group"},be=["max"],ye={class:"date-input-group"},he=["min","max"],Ce={key:0,class:"table-responsive"},Ie={class:"audits-table"},De={key:0,class:"pagination-container"},ke={class:"page-info"},Se={key:1,class:"ion-text-center ion-padding"},we={key:2,class:"ion-text-center ion-padding"},xe={class:"table-responsive"},Te={class:"changes-table"},k=20,Pe=W({__name:"SystemAudits",setup(Ae){const H=r("System Audits"),g=r([]),h=r("");r(""),r("");const v=r(""),p=r(""),S=r(!1),c=r(1),C=r(!1),I=r(""),D=r([]),b=P(()=>Math.ceil(g.value.length/k)),E=P(()=>{const a=(c.value-1)*k,t=a+k;return g.value.slice(a,t)});Z([v,p],([a,t])=>{a&&t&&(h.value="".concat(x(a)," - ").concat(x(t)))}),q(()=>{const a=new Date;p.value=a.toISOString().split("T")[0],v.value=a.toISOString().split("T")[0]});const w=()=>new Date().toISOString().split("T")[0],x=a=>new Date(a).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),R=async()=>{if(!v.value||!p.value){F("Please select both start and end dates");return}await G.show();try{g.value=await ce.getAuditReports(v.value,p.value),S.value=!0,c.value=1}catch(a){console.error("Error generating audit report:",a),F("Failed to generate audit report"),g.value=[]}finally{await G.hide()}},L=a=>a?"".concat(a.username," (").concat(a.name,")"):"",j=a=>ve.toStandardHisDisplayFormat(a),J=async a=>{if(!a.changes||a.changes.length===0)return;const t=a.changes.map(o=>{const[d,y]=Object.entries(o)[0]||[];return d?/password/i.test(d)?{attribute:d,previous:"*******",current:"*******"}:{attribute:d,...y}:null}).filter(o=>o!==null);I.value="Changes made by ".concat(a.user.name," on ").concat(a.auditable_type),D.value=t,C.value=!0},T=()=>{C.value=!1,I.value="",D.value=[]},K=()=>{c.value<b.value&&c.value++},Q=()=>{c.value>1&&c.value--};return(a,t)=>(i(),A(n(de),null,{default:l(()=>[s(ie,{title:"System Audits"}),s(n(N),null,{default:l(()=>[s(n(X),null,{default:l(()=>[s(n(Y),null,{default:l(()=>[s(n(ee),{size:"12","size-md":"12","size-lg":"12"},{default:l(()=>[e("div",fe,[s(n(V),null,{default:l(()=>[s(n(te),null,{default:l(()=>[s(n(ae),null,{default:l(()=>[f(u(H.value),1)]),_:1}),h.value?(i(),A(n(le),{key:0},{default:l(()=>[f(u(h.value),1)]),_:1})):B("",!0)]),_:1}),s(n(M),null,{default:l(()=>[e("div",_e,[e("div",ge,[e("div",me,[t[2]||(t[2]=e("label",null,"Start Date:",-1)),O(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=o=>v.value=o),max:p.value||w(),class:"date-input"},null,8,be),[[$,v.value]])]),e("div",ye,[t[3]||(t[3]=e("label",null,"End Date:",-1)),O(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=o=>p.value=o),min:v.value,max:w(),class:"date-input"},null,8,he),[[$,p.value]])]),s(n(m),{fill:"solid",onClick:R,disabled:!v.value||!p.value},{default:l(()=>t[4]||(t[4]=[f(" Generate Report ",-1)])),_:1,__:[4]},8,["disabled"])])]),g.value.length>0?(i(),_("div",Ce,[e("table",Ie,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",null,"Encounter"),e("th",null,"Action Type"),e("th",null,"User"),e("th",null,"Timestamp"),e("th",null,"Changes")])],-1)),e("tbody",null,[(i(!0),_(U,null,z(E.value,o=>(i(),_("tr",{key:o.id},[e("td",null,u(o.auditable_type),1),e("td",null,u(o.action),1),e("td",null,u(L(o.user)),1),e("td",null,u(j(o.created_at)),1),e("td",null,[s(n(m),{size:"small",fill:"outline",onClick:d=>J(o),disabled:!o.changes||o.changes.length===0},{default:l(()=>{var d,y;return[f(u((y=(d=o.changes)==null?void 0:d.length)!=null?y:0)+" Changes ",1)]}),_:2},1032,["onClick","disabled"])])]))),128))])]),b.value>1?(i(),_("div",De,[s(n(m),{fill:"clear",onClick:Q,disabled:c.value===1},{default:l(()=>t[6]||(t[6]=[f(" Previous ",-1)])),_:1,__:[6]},8,["disabled"]),e("span",ke," Page "+u(c.value)+" of "+u(b.value),1),s(n(m),{fill:"clear",onClick:K,disabled:c.value===b.value},{default:l(()=>t[7]||(t[7]=[f(" Next ",-1)])),_:1,__:[7]},8,["disabled"])])):B("",!0)])):g.value.length===0&&S.value?(i(),_("div",Se,t[8]||(t[8]=[e("p",null,"No audit records found for the selected period",-1)]))):(i(),_("div",we,t[9]||(t[9]=[e("p",null,"Select date range and generate report to view audit data",-1)])))]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),s(n(ne),{"is-open":C.value,onDidDismiss:T},{default:l(()=>[s(n(se),null,{default:l(()=>[s(n(oe),null,{default:l(()=>[s(n(ue),null,{default:l(()=>[f(u(I.value),1)]),_:1}),s(n(re),{slot:"end"},{default:l(()=>[s(n(m),{onClick:T},{default:l(()=>t[10]||(t[10]=[f("Close",-1)])),_:1,__:[10]})]),_:1})]),_:1})]),_:1}),s(n(N),null,{default:l(()=>[s(n(V),null,{default:l(()=>[s(n(M),null,{default:l(()=>[e("div",xe,[e("table",Te,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"Attribute"),e("th",null,"Previous Value"),e("th",null,"Current Value")])],-1)),e("tbody",null,[(i(!0),_(U,null,z(D.value,(o,d)=>(i(),_("tr",{key:d},[e("td",null,u(o.attribute),1),e("td",null,u(o.previous||"N/A"),1),e("td",null,u(o.current||"N/A"),1)]))),128))])])])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])]),_:1}))}}),Oe=pe(Pe,[["__scopeId","data-v-bde1132c"]]);export{Oe as default};

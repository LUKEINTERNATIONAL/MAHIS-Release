System.register(["./index-legacy-D84VBdSl.js","./vendor-legacy-CFX0KWSj.js","./lodash-legacy-pOOc9Efu.js"],function(t,e){"use strict";var i,a,n,l,d,o,s,r,u,c,v,p,g,m,b,_,h,f,y,w,S,x,D,I,T,O,C,N,k,L,P,E,$,A,B,H,z;return{setters:[t=>{i=t.Y,a=t.P,n=t.a3,l=t.aO,d=t.aP,o=t.aQ,s=t.S,r=t.aR,u=t.aS,c=t.u,v=t.t,p=t._,g=t.aT},t=>{m=t.aU,b=t.r,_=t.X,h=t.d,f=t.c,y=t.a,w=t.e,S=t.f,x=t.k,D=t.j,I=t.m,T=t.d2,O=t.dE,C=t.dF,N=t.y,k=t.z,L=t.B,P=t.A,E=t.u,$=t.F,A=t.L,B=t.dG,H=t.dH},t=>{z=t.l}],execute:function(){var e=document.createElement("style");e.textContent=".label-canvas[data-v-d8afb20c]{position:absolute;left:-9999px;top:-9999px;font-family:Verdana,Geneva,Tahoma,sans-serif!important;overflow:hidden;max-width:4496px}#img-canvas[data-v-d8afb20c]{padding:0;margin:0 auto;overflow:hidden}svg[data-v-d8afb20c]{width:50%}#container[data-v-34a856c3]{width:1078px;font-size:58px;overflow:hidden}ul[data-v-34a856c3],ol[data-v-34a856c3]{list-style-type:none;padding-left:0;margin:0}#container[data-v-56ecfb68]{font-size:44px;overflow:hidden}.label[data-v-56ecfb68]{overflow:hidden}.row[data-v-56ecfb68]{display:flex;justify-content:space-between}#container[data-v-2829f777]{max-width:578px;max-height:316px;font-size:30px;font-weight:700;overflow:hidden}\n/*$vite$:1*/",document.head.appendChild(e),t({a:function(t){q(vt,{lblUrl:`programs/${a.getProgramID()}/patients/${t}/labels/patient_history`})},b:function(t,e=a.getSessionDate()){q(et,{copies:2})},c:q,p:async function(t,e=!1){return q(ht,{scaleHeight:280,useImage:!1,lblUrl:`patients/${t}/labels/national_health_id?qr_code=${e}`})}});const M=b(!1);async function j(t,e,n){if(!M.value){M.value=!0;try{const l=await async function(t){const e=t.visits.visitsDates.map(t=>new Date(t)),n=new Date(Math.max(...e)),l=n.toISOString().split("T")[0],d=`${t.personInformation.given_name} ${t.personInformation.family_name}`,o=[...t.vitals.saved||[],...t.vitals.unsaved||[]],s=[...t.diagnosis.saved||[],...t.diagnosis.unsaved||[]],r=[...t.MedicationOrder.saved||[],...t.MedicationOrder.unsaved||[]],u=[...t.labOrders.saved||[],...t.labOrders.unsaved||[]],c=o.filter(t=>new Date(t.obs_datetime).toDateString()===n.toDateString()),v=s.filter(t=>new Date(t.obs_datetime).toDateString()===n.toDateString()),p=r.filter(t=>new Date(t.encounter_date).toDateString()===n.toDateString()),g=u.filter(t=>new Date(t.order_date).toDateString()===n.toDateString()),m=g.length>0?g[0].requesting_clinician:void 0,b=t.appointments.saved.length>0?t.appointments.saved[0].value:void 0,_=await Promise.all(v.map(async t=>await i.getConceptName(t.value_coded))),h=o.filter(t=>"Height (cm)"===t.concept_name).sort((t,e)=>new Date(e.obs_datetime).getTime()-new Date(t.obs_datetime).getTime())[0],f=(t,e)=>{const i=c.find(e=>e.concept_name==t);return void 0!==(null==i?void 0:i.value_numeric)?`${i.value_numeric}${e}`:void 0};return{patientID:t.NcdID,patientName:d,latestVisitDate:l,gender:t.personInformation.gender,vitals:{height:"Ht:"+(null==h?void 0:h.value_numeric)+"cm",weight:"Wt"+f("Weight (kg)","kg"),bloodPressure:"Bp"+f("Systolic blood pressure","")+"/"+f("Diastolic blood pressure","")+"mmHg"},bloodGlucose:(()=>{const e=(new a).getBloodGlucose(t);if(e)return e.name+":"+e.value+e.unit})(),diagnoses:_.length>0?_:void 0,medications:p.length>0?p.map(t=>({name:t.drug_name,dose:t.dose?`${t.dose} ${t.units||""}`.trim():void 0,frequency:t.frequency,quantity:t.equivalent_daily_dose,duration:t.expire_date&&t.start_date?Math.ceil((Number(new Date(t.expire_date))-Number(new Date(t.start_date)))/864e5):void 0})):void 0,labOrders:g.length>0?g.map(t=>({test:t.tests&&t.tests.length>0?t.tests[0].name:void 0,orderDate:t.order_date?new Date(t.order_date).toISOString().split("T")[0]:void 0,accessionNumber:t.accession_number})):void 0,prescriber:m,nextAppointment:b}}(c().patient),d=await _.create({id:"printout",component:e,backdropDismiss:!1,cssClass:"visit-modal",componentProps:{patient:l,imageOut:async e=>{var i;console.log("ðŸš€ ~ imageOut: ~ images:",e);const a=null!==(i=n.copies)&&void 0!==i?i:1;for(let n=0;n<a;++n){const i=e.map(e=>{console.log("ðŸš€ ~ res ~ image:",e),m.printLabel({address:t.address,name:t.name,height:302,width:582,image:e})});await Promise.all(i)}setTimeout(()=>_.getTop().then(t=>t&&d.dismiss()),1e3),M.value=!1}}});await d.present()}catch(l){console.error(l),M.value=!1,_.getTop().then(t=>t?_.dismiss():null),v("An error occurred while generating label")}}}async function q(t,e){console.log("ðŸš€ ~ printLabel ~ labelComponent:",t);const i=await async function(){const t=new n;let e=await t.getDefaultPrinter();if(z.isEmpty(e)&&(e=await t.selectDefaultPrinter()),z.isEmpty(e))throw new Error("No printer device found");return e}();return/zebra/i.test(i.name)||/Browser/i.test(i.address)||"BT"===i.port?async function(t,e){const i=l.updateUrlParamString(e,{raw:!0});d.emit(o.SHOW_MODAL,"zebra-modal"),console.time(e);const a=await s.getText(i);if(!a)throw"Unable to print Label. Try again later";if("BT"===(null==t?void 0:t.port))return(new n).printToBluetoothDevice(t,a);m.printLabel({eplCommands:a,name:t.name,address:t.address,url:await r.expandPath(i)}),console.timeEnd(e),await u(2e3)}(i,e.lblUrl):await j(i,t,e)}const U=["id"],G={id:"img-canvas"},R={key:0,class:"print-section ion-text-center vertically-align"},V=["id"],F=p(h({__name:"PrintLabel",props:{id:String,width:Number,height:Number},emits:["labelOutput"],setup(t,{emit:e}){const i=e,a=t,n=b(!1),l=f(()=>`${a.id}${(new Date).toISOString()}`);return y(()=>setTimeout(()=>function(){const t=document.getElementById(l.value);t&&O(t,{scale:7,backgroundColor:"#ffffff"}).then(function(t){try{const e=t.toDataURL("image/png");document.getElementById(`${[l.value]}-image`).src=e,n.value=!0,i("labelOutput",e),u(50).then(()=>C.dismiss({generatedLabelImage:e},void 0,"printout"))}catch(e){console.error(e)}})}(),80)),(t,e)=>(S(),w("div",null,[x("div",{id:l.value,class:"label-canvas"},[D(t.$slots,"default",{},void 0,!0)],8,U),x("div",G,[n.value?I("",!0):(S(),w("div",R,e[0]||(e[0]=[T('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve" data-v-d8afb20c><metadata data-v-d8afb20c> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata><g data-v-d8afb20c><g transform="translate(0.000000,511.000000) scale(0.100000,-0.100000)" data-v-d8afb20c><path d="M2918.3,4119.3c-303-51.3-610.8-284.4-753-568.8c-102.6-212.1-125.9-359-125.9-822.9v-380h-533.8c-575.8,0-720.3-16.3-899.8-104.9c-237.8-116.6-454.6-410.3-491.9-669l-14-109.6l258.8-128.2l258.8-130.5H5000h4382.5l258.7,130.5l258.8,128.2l-14,109.6c-37.3,261.1-247.1,550.1-487.2,666.7c-184.2,90.9-324,107.2-904.5,107.2h-533.8v380c0,463.9-23.3,610.8-125.9,822.9c-142.2,286.7-435.9,508.2-757.6,568.8C6927.8,4147.2,3088.5,4147.2,2918.3,4119.3z M7158.6,3776.6c79.3-25.6,156.2-81.6,256.4-179.5c216.8-216.8,219.1-230.8,219.1-1102.6v-729.6H5000H2365.8v729.6c0,871.8,2.3,885.8,219.1,1102.6c233.1,230.8,51.3,214.5,2405.7,216.8C6850.9,3816.2,7053.7,3811.5,7158.6,3776.6z" data-v-d8afb20c></path><path d="M109.3-267.9l7-1382.3l74.6-153.8c90.9-184.2,258.7-349.7,445.2-435.9c130.5-60.6,146.9-62.9,692.3-74.6l559.5-11.7l14-338c11.7-275.1,23.3-361.3,65.3-466.2c163.2-401,484.9-671.4,909.1-757.6c146.9-32.6,452.2-35,2202.9-30.3c2030.4,7,2030.4,7,2184.3,58.3c363.7,123.5,643.4,396.3,773.9,752.9c37.3,95.6,51.3,209.8,60.6,454.6l14,326.4l559.5,11.7l561.8,11.7l153.9,76.9c191.2,93.2,366,277.4,442.9,466.2l53.6,132.9l7,1370.7l7,1370.7l-209.8-107.2l-212.1-104.9H5000H524.3l-212.1,104.9l-209.8,107.2L109.3-267.9z M1107,121.4c207.5-107.2,167.8-435.9-60.6-498.9c-104.9-28-186.5-7-263.4,69.9C701.4-225.9,678.1-121,720.1-20.8C785.4,137.7,955.5,200.7,1107,121.4z M7487.3-368.1c139.9-42,223.8-128.2,268.1-275.1c23.3-72.3,30.3-370.7,30.3-1181.9c0-1079.3,0-1084-53.6-1216.8c-76.9-188.8-251.8-373-442.9-466.2l-156.2-76.9H5000H2867l-156.2,76.9c-191.1,93.2-366,277.4-442.9,466.2c-53.6,130.6-53.6,149.2-60.6,1135.3c-7,1046.7,4.7,1244.8,88.6,1382.3c51.3,86.3,135.2,144.5,240.1,167.8c39.6,11.7,1144.6,18.7,2454.7,21C7053.7-333.2,7384.7-337.8,7487.3-368.1z M1125.7-766.7c65.3-44.3,121.2-151.5,121.2-230.8c0-79.3-55.9-186.5-121.2-230.8c-67.6-48.9-216.8-46.6-298.4,2.4c-172.5,100.2-167.8,368.3,4.7,466.2C906.6-720.1,1062.8-722.5,1125.7-766.7z" data-v-d8afb20c></path><path d="M3149.1-927.6c-60.6-62.9-67.6-130.5-18.7-195.8l44.3-60.6h1708.7h1708.7l44.3,60.6c48.9,65.3,42,132.9-18.7,195.8c-32.6,30.3-251.8,35-1734.4,35C3400.9-892.6,3181.7-897.3,3149.1-927.6z" data-v-d8afb20c></path><path d="M3149.1-1860c-60.6-62.9-67.6-130.5-18.7-195.8l44.3-60.6h1708.7h1708.7l44.3,60.6c48.9,65.3,42,132.9-18.7,195.8c-32.6,30.3-251.8,35-1734.4,35C3400.9-1825.1,3181.7-1829.7,3149.1-1860z" data-v-d8afb20c></path><path d="M3149.1-2792.5c-60.6-62.9-67.6-130.5-18.7-195.8l44.3-60.6h1708.7h1708.7l44.3,60.6c48.9,65.3,42,132.9-18.7,195.8c-32.6,30.3-251.8,35-1734.4,35C3400.9-2757.5,3181.7-2762.2,3149.1-2792.5z" data-v-d8afb20c></path></g></g></svg>',1)]))),x("img",{src:"",id:`${l.value}-image`},null,8,V)])]))}}),[["__scopeId","data-v-d8afb20c"]]),Q={id:"container"},W={style:{display:"flex","justify-content":"space-between",width:"100%"}},K={style:{background:"black","font-weight":"bold",color:"white",padding:"1.7px"}},X={style:{width:"100%"}},Y={style:{display:"flex","justify-content":"space-between",width:"100%"}},J={style:{display:"flex","justify-content":"space-between","border-bottom":"3px solid black",width:"100%"}},Z={style:{width:"100%","text-align":"center"}},tt={style:{"text-align":"right"}},et=p(h({__name:"ArtVisitLbl",props:{visit_by:{type:String},date:{type:String},arv_number:{type:String},patient_details:{type:String},height:{type:String},weight:{type:String},bmi:{type:String},viral_load:{type:String},outcome_date:{type:String},outcome:{type:String},next_appointment_date:{type:String},seen_by:{type:String},se:{type:String},tb_status:{type:String},adherence:{type:String},drugs:{type:Object}},emits:["label-out"],setup(t,{emit:e}){const i=e;return(e,a)=>(S(),N(F,{id:"visit-summary",onLabelOutput:a[0]||(a[0]=t=>i("label-out",t))},{default:k(()=>{var e,i;return[x("div",Q,[x("div",W,[x("span",null,[x("b",null,L(t.date),1)]),x("span",null,"("+L(null!==(e=t.visit_by)&&void 0!==e?e:"??")+")",1),x("span",K,L(t.arv_number),1)]),x("div",X,[x("span",null,[x("b",null,L(t.patient_details),1)]),a[1]||(a[1]=x("span",null,[x("b",null,"Â :Patient visit")],-1))]),x("div",Y,[x("span",null,L(t.weight)+"kg",1),x("span",null,L(t.height)+"cm",1),x("span",null,[a[2]||(a[2]=x("b",null,"BMI:",-1)),P(L(t.bmi),1)]),x("span",null,[a[3]||(a[3]=x("b",null,"VL:",-1)),P(L(t.viral_load),1)])]),x("div",J,[x("span",null,[a[4]||(a[4]=x("b",null,"OUTC:",-1)),P(L(t.outcome)+"Â ",1)]),x("span",null,L(E(g)(null!==(i=t.outcome_date)&&void 0!==i?i:"")),1)]),x("table",Z,[a[6]||(a[6]=x("thead",null,[x("tr",null,[x("th",null,"SE"),x("th",null,"TB"),x("th",null,"Adh"),x("th",null,"DRUG(S) Given")])],-1)),x("tbody",null,[x("tr",null,[a[5]||(a[5]=x("td",null,null,-1)),x("td",null,L(t.tb_status),1),x("td",null,L(t.adherence),1),x("td",null,[x("ul",null,[(S(!0),w($,null,A(t.drugs,(t,e)=>(S(),w("li",{key:e},L(t),1))),128))])])])])]),a[7]||(a[7]=x("p",null,null,-1)),x("div",tt,[x("div",null,[x("div",null,"Next: "+L(t.next_appointment_date),1),x("div",null,L(t.seen_by),1)])])])]}),_:1}))}}),[["__scopeId","data-v-34a856c3"]]),it={id:"container"},at={class:"label"},nt={style:{"font-weight":"600"},class:"row"},lt={style:{"margin-top":"2%"}},dt={style:{"max-height":"316px",overflow:"hidden"}},ot={class:"row"},st={class:"row"},rt={class:"row"},ut={class:"row"},ct={style:{"margin-top":"14px"}},vt=p(h({__name:"PatientDemographicLbl",props:{arv_number:{type:String},patient_details:{type:Object},art_initiation_status:{type:Object}},emits:["label-out"],setup(t,{emit:e}){const i=e;return(e,a)=>(S(),N(F,{id:"art_demographics",onLabelOutput:a[0]||(a[0]=t=>i("label-out",t))},{default:k(()=>{var e,i,n,l,d,o,s,r,u,c,v,p,g,m,b,_,h,f,y,w,S,D;return[x("div",it,[x("div",at,[x("div",nt,[a[1]||(a[1]=x("div",null,"PATIENT DETAILS",-1)),x("div",null,L(t.arv_number),1)]),x("div",null,[x("div",null,"Name: "+L(null===(e=t.patient_details)||void 0===e?void 0:e.name),1),x("div",null,"DOB: "+L(null===(i=t.patient_details)||void 0===i?void 0:i.dob),1),x("div",null,"Phone: "+L(null===(n=t.patient_details)||void 0===n?void 0:n.phone),1),x("div",null,"Addr: "+L(null===(l=t.patient_details)||void 0===l?void 0:l.address),1),x("div",null,"Guard: "+L(null===(d=t.patient_details)||void 0===d?void 0:d.guardian),1),x("div",lt,[x("div",null,"TI: "+L(null===(o=t.patient_details)||void 0===o?void 0:o.transfer_in),1),x("div",null,"FUP: "+L(null===(s=t.patient_details)||void 0===s?void 0:s.agrees_to_followup),1)])])]),a[13]||(a[13]=x("div",{style:{margin:"150px"}},null,-1)),x("div",dt,[x("div",ot,[a[2]||(a[2]=x("div",null,[x("b",null,"STATUS AT ART INITIATION")],-1)),x("div",null,"(DSA: "+L(null===(r=t.art_initiation_status)||void 0===r?void 0:r.art_start_date)+")",1),x("div",null,[x("b",null,L(t.arv_number),1)])]),x("div",st,[x("div",null,[a[3]||(a[3]=x("b",null,"RFS: ",-1)),P(L(null===(u=t.art_initiation_status)||void 0===u?void 0:u.reason_for_art_eligibility),1)]),x("div",null,[a[4]||(a[4]=x("b",null,"TB: ",-1)),P(L(null===(c=t.art_initiation_status)||void 0===c?void 0:c.tb_status),1)]),x("div",null,[a[5]||(a[5]=x("b",null,"HEIGHT: ",-1)),P(L(null===(v=t.art_initiation_status)||void 0===v?void 0:v.initial_height),1)])]),x("div",rt,[x("div",null,[a[6]||(a[6]=x("b",null,"KS: ",-1)),P(L(null===(p=t.art_initiation_status)||void 0===p?void 0:p.ks_status),1)]),x("div",null,[a[7]||(a[7]=x("b",null,"WEIGHT: ",-1)),P(L(null===(g=t.art_initiation_status)||void 0===g?void 0:g.initial_weight),1)])]),x("div",ut,[x("div",null,[a[8]||(a[8]=x("b",null,"1st + Test:",-1)),P(" "+L(null===(m=t.art_initiation_status)||void 0===m?void 0:m.hiv_test_date),1)]),x("div",null,[a[9]||(a[9]=x("b",null,"Preg: ",-1)),P(L(null===(b=t.art_initiation_status)||void 0===b?void 0:b.pregnant),1)]),x("div",null,[a[10]||(a[10]=x("b",null,"Init Age: ",-1)),P(L(null===(_=t.art_initiation_status)||void 0===_?void 0:_.age_at_initiation),1)])]),a[11]||(a[11]=x("div",{style:{"border-top":"3px solid black",width:"100%"}},null,-1)),a[12]||(a[12]=x("div",{style:{"font-weight":"bold",display:"flex","justify-content":"right"}}," STAGE DEFINING CONDITIONS ",-1)),x("div",ct,L([...null!==(h=null===(f=t.art_initiation_status)||void 0===f?void 0:f.first_line_drugs)&&void 0!==h?h:[],...null!==(y=null===(w=t.art_initiation_status)||void 0===w?void 0:w.alt_first_line_drugs)&&void 0!==y?y:[],...null!==(S=null===(D=t.art_initiation_status)||void 0===D?void 0:D.second_line_drugs)&&void 0!==S?S:[]].join(",")),1)])])]}),_:1}))}}),[["__scopeId","data-v-56ecfb68"]]),pt={id:"container"},gt={key:0},mt={key:1},bt={style:{display:"flex","align-items":"center"}},_t=h({__name:"NpidLbl",props:{name:{type:String,default:"??"},national_id:{type:String,required:!0,default:"??"},birthdate:{type:String,default:"??"},sex:{type:String,gender:"??"},address:{type:String,default:"??"},useQrCode:{type:Boolean},qr:{type:String}},emits:["label-out"],setup(t,{emit:e}){const i=e,a=t;return y(()=>{if(a.useQrCode){const t=document.getElementById("patient-qrcode");t&&a.qr&&H.toCanvas(t,a.qr,{width:160},t=>{t&&(console.log(t),v("Unable to generate QR code"))})}else B("#patient-barcode",a.national_id,{height:56,width:2,displayValue:!1,format:"CODE128"})}),(e,a)=>(S(),N(F,{id:"npid-label",onLabelOutput:a[0]||(a[0]=t=>i("label-out",t))},{default:k(()=>[x("div",pt,[t.useQrCode?(S(),w("div",mt,[x("div",null,[x("div",bt,[a[2]||(a[2]=x("div",null,[x("canvas",{id:"patient-qrcode"})],-1)),x("div",null,[x("div",null,L(t.name),1),x("div",null,L(t.national_id),1),x("div",null,L(t.birthdate),1),x("div",null,L(t.sex),1),x("div",null,L(t.address),1)])])])])):(S(),w("div",gt,[x("div",null,[x("div",null,[x("div",null,L(t.name),1),x("div",null,L(t.national_id)+" "+L(t.birthdate)+" "+L(t.sex),1),x("div",null,L(t.address),1)]),a[1]||(a[1]=x("svg",{id:"patient-barcode"},null,-1))])]))])]),_:1}))}}),ht=p(_t,[["__scopeId","data-v-2829f777"]])}}});

var V=Object.defineProperty;var q=(n,t,e)=>t in n?V(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var f=(n,t,e)=>q(n,typeof t!="symbol"?t+"":t,e);import{c as C,r as y,eF as A,bT as T,bU as O,O as F,d as k,y as E,f as U,z as h,l as p,u,S as Y,U as z,b3 as H,W as L,I as G,aR as N,T as W,A as J,B as K,ad as X,eC as Z,b8 as tt,eG as et}from"./vendor-BEKTmkXc.js";import{A as M,k as B,n as at,s as S,g as nt,o as st,m as rt,_ as ot,q as it,v as D,e as P,w as I}from"./index-DSKp8AKz.js";import{l as w}from"./lodash-Dt8AsbQm.js";const v=y(""),g=y(""),$=y(""),lt=C(()=>"".concat(v.value||"-"," / ").concat(g.value||"-"));function ct(){v.value="v".concat(B.version),$.value=B.version}async function ut(){let t=await(await M.get("version")).json();g.value=t["System version"]||"-"}function dt(){const[n,t,e]=$.value.split("."),[r,s,a]=g.value.split(".");return!((parseInt(r)||0)<(parseInt(n)||0)||(parseInt(s)||0)<(parseInt(t)||0)||(parseInt(a)||0)<(parseInt(e)||0))}function pt(){return{appVersion:v,apiVersion:g,minApiVersion:$,fullVersion:lt,loadAppVersions:ct,loadApiVersion:ut,isValidApiVersion:dt}}const{appVersion:ft,apiVersion:ht}=pt(),{facilityUUID:mt}=nt();function bt(){const n=st().getUser().username;return{encryption:{userPassword:n,ownerPassword:n,userPermissions:["print"]}}}function _(n,t){return t||n.exportable!==!1}function Q(n,t=!1){return n.filter(e=>_(e,t)).map(e=>e.label)}function x(n,t,e=!1){return t.map(r=>n.filter(s=>_(s,e)).map(s=>{let a=w.get(r,s.path,"");return typeof s.formatter=="function"&&a&&(a=s.formatter(a,r)),S("".concat(s.drillable&&Array.isArray(a)?a.length:a))}))}function gt(n){const{columns:t,rows:e,quarter:r,period:s,filters:a,safeMode:i}=n,o=Q(t,i),c=x(t,A(e,(a==null?void 0:a.sort)||[]),i);let l=o.join(",")+"\n";return l+=c.map(d=>d.join(",")).join("\n"),l+="\nDate Created:  ".concat(F().format("DD/MMM/YYYY HH:MM:ss")),r&&(l+="\nQuarter: ".concat(r)),s&&(l+="\nQuarter: ".concat(s)),l+="\ne-Mastercard Version : ".concat(ft.value),l+="\nAPI Version ".concat(ht.value),l+="\nSite UUID: ".concat(mt),l}function Dt(n){const t=new Blob([gt(n)],{type:"text/csv;charset=utf-8;"}),e=document.createElement("a");e.href=window.URL.createObjectURL(t),e.setAttribute("download","".concat(n.filename,".csv")),document.body.appendChild(e),e.click(),document.body.removeChild(e)}function wt(n){const{filename:t,canHorizontalPageBreak:e,columns:r,rows:s,filters:a,safeMode:i}=n,o=[Q(r,i)],c=x(r,A(s,(a==null?void 0:a.sort)||[]),i),l=i?bt():{},d=new T({...l}),m=d.splitTextToSize(S(t),180),R=m.length<=1?20:m.length*10;d.text(m,14,10);const b={startY:R,head:o,body:c};e&&(b.tableWidth="wrap",b.horizontalPageBreak=!0,b.horizontalPageBreakRepeat=0),O(d,b);const j="".concat(t,".pdf");d.save(j)}function At(n,t,e,r){return{label:"PDF",color:"primary",action:async(s,a,i,o)=>{let c=t&&await at("PDF may contain private data that will require a password to unlock, To access private data choose Secure PDF over Regular PDF",{header:"Security warning",confirmBtnLabel:"Secure PDF",cancelBtnLabel:"Regular PDF"});wt({rows:a,filters:i,columns:o,filename:n,safeMode:c})}}}function Ft(n,t,e){return{label:"CSV",color:"primary",action:async(r,s,a,i)=>{Dt({rows:s,filters:a,columns:i,quarter:t,period:e,filename:n})}}}const yt=k({__name:"DrilldownTable",props:{title:{type:String,default:"Drill down table"},rows:{type:Array,required:!0},columns:{type:Array,required:!1},actionButtons:{type:Array},rowActionButtons:{type:Array},config:{type:Object,default:()=>({showSubmitButton:!1})}},setup(n){return(t,e)=>(U(),E(u(tt),null,{default:h(()=>[p(u(Y),null,{default:h(()=>[p(u(z),null,{default:h(()=>[p(u(H),{slot:"end"},{default:h(()=>[p(u(L),{slot:"end",onClick:e[0]||(e[0]=r=>u(rt).hide()),"icon-only":""},{default:h(()=>[p(u(G),{icon:u(N)},null,8,["icon"])]),_:1})]),_:1}),p(u(W),null,{default:h(()=>[J(K(n.title),1)]),_:1})]),_:1})]),_:1}),p(u(X),null,{default:h(()=>[p(u(Z),{rows:n.rows,columns:n.columns,config:n.config,"row-actions-buttons":n.rowActionButtons,"actions-buttons":n.actionButtons,color:"light"},null,8,["rows","columns","config","row-actions-buttons","actions-buttons"])]),_:1})]),_:1}))}}),Mt=ot(yt,[["__scopeId","data-v-dd3e8006"]]),vt=1,St=23;class _t{constructor(){f(this,"date");f(this,"startDate");f(this,"endDate");f(this,"programId");f(this,"useDefaultParams");f(this,"occupation");this.programId=vt,this.date=it(),this.endDate="",this.startDate="",this.useDefaultParams=!0,this.occupation=""}setDate(t){this.date=D(t)}setStartDate(t){this.startDate=D(t)}setEndDate(t){this.endDate=D(t)}setOccupation(t){t==="All"?this.occupation="":this.occupation=t}getDateIntervalPeriod(){return this.startDate&&this.endDate?"".concat(P(this.startDate)," - ").concat(P(this.endDate)):"-"}buildParams(t){let e={};return this.useDefaultParams&&(e.date=this.date,e.program_id=this.programId),this.startDate&&(e.start_date=this.startDate),this.endDate&&(e.end_date=this.endDate),this.occupation&&(e.occupation=this.occupation),t&&(e={...e,...t}),e}async getReport(t,e){return(await M.get(I(t,this.buildParams(e)))).json()}static getReportQuarters(t=5){const e=[];let r=new Date,s=r.getFullYear();const a=s;r=new Date("".concat(a,"-").concat(r.getMonth()+1,"-").concat(r.getDate()," 00:00"));let o=this.getQtrByDate(r).qtr,c=0;for(o===4&&e.push(this.buildQtrObj("Q1",s+1));c<t;)c===0&&o<4&&e.push(this.buildQtrObj("Q".concat(o+1),s)),e.push(this.buildQtrObj("Q".concat(o),s)),o=o>0?o-=1:o,s=o==0?s-1:s,o=o==0?o+=4:o,c++;return e}static getQtrByDate(t){const e=this.getQuarterBounds(t.getFullYear());for(const r in e){const{start:s,end:a}=e[r];if(t>=new Date(s)&&t<=new Date(a))return e[r]}return null}static buildQtrObj(t,e){const r=this.getQuarterBounds(e),{start:s,end:a}=r[t];return{start:s,end:a,name:"".concat(t," ").concat(e)}}static getQuarterBounds(t){const e=a=>F("".concat(t,"-").concat(a,"-01")).daysInMonth(),r=a=>"".concat(t,"-").concat(a,"-01 00:00"),s=a=>"".concat(t,"-").concat(a,"-").concat(e(a)," 00:00");return{Q1:{qtr:1,start:r("01"),end:s("03")},Q2:{qtr:2,start:r("04"),end:s("06")},Q3:{qtr:3,start:r("07"),end:s("09")},Q4:{qtr:4,start:r("10"),end:s("12")}}}async getMaternalStatus(t,e="pepfar"){var a;if(w.isEmpty(t))return{FP:[],FBf:[]};const r=I("vl_maternal_status",this.buildParams({report_definition:e}));return(a=(await et.postJson(r,{patient_ids:t})).data)!=null?a:{FP:[],FBf:[]}}async buildMaternityAgreggateRows(t,e="pepfar"){const r=w.uniq(Object.values(t).flat(1).map(o=>o instanceof Object?o.patient_id:o)),s=Object.keys(t),a=await this.getMaternalStatus(r,e),i=a.FBf.concat(a.FP);return["FP","FNP","FBf"].map(o=>s.reduce((c,l)=>({[l]:t[l].filter(d=>{const m=d instanceof Object?d.patient_id:d;return o==="FNP"?!i.includes(m):a[o].includes(m)}),...c}),{ageGroup:"All",gender:o}))}}export{Mt as D,St as L,_t as R,At as a,Dt as e,Ft as g};

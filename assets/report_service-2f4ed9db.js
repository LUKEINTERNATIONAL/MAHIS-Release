var V=Object.defineProperty;var T=(a,t,e)=>t in a?V(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var D=(a,t,e)=>(T(a,typeof t!="symbol"?t+"":t,e),e);import{dJ as w,r as _,c as j,eo as F,bT as E,bU as O,N as f,ep as U,dK as k,X as v,d as L,e as z,y as N,z as m,l as p,x as c,U as H,R as G,b1 as W,V as J,I as K,aP as X,S as Z,A as tt,B as et,aa as at,eq as nt,b5 as rt,er as st}from"./vendor-9911d1c7.js";import{c as P,A as Y,a as ot,b as it,u as ut,_ as lt,p as I}from"./index-63fd3230.js";import{l as M}from"./lodash-7be49fbd.js";const xt={async show(a){return(await w.create({message:a||"Loading...",spinner:"crescent",translucent:!0})).present()},async hide(){w.getTop().then(a=>a?w.dismiss():null)}};function R(a){return a.replace(/<(?:.|\n)*?>/gm," ").replace(/(\r\n|\n|\r|\t|\s{2,}|[=,])/g," ").trim()}function Qt(a){return parseInt(a.split("-")[2])||1/0}function Ct(a){const t="".concat(a).toUpperCase();return t==="M"||t==="MALE"?"Male":t==="F"||t==="FEMALE"?"Female":/fbf|fnp|fp/i.test(a)?t:a}const A=_(""),y=_(""),$=_(""),ct=j(()=>"".concat(A.value||"-"," / ").concat(y.value||"-"));function dt(){A.value="v".concat(P.version),$.value=P.version}async function ft(){let t=await(await Y.get("version")).json();y.value=t["System version"]||"-"}function pt(){const[a,t,e]=$.value.split("."),[r,s,n]=y.value.split(".");return!((parseInt(r)||0)<(parseInt(a)||0)||(parseInt(s)||0)<(parseInt(t)||0)||(parseInt(n)||0)<(parseInt(e)||0))}function mt(){return{appVersion:A,apiVersion:y,minApiVersion:$,fullVersion:ct,loadAppVersions:dt,loadApiVersion:ft,isValidApiVersion:pt}}const{appVersion:ht,apiVersion:Dt}=mt(),{facilityUUID:gt}=ut();function bt(){const a=it().getUser().username;return{encryption:{userPassword:a,ownerPassword:a,userPermissions:["print"]}}}function S(a,t){return t||a.exportable!==!1}function x(a,t=!1){return a.filter(e=>S(e,t)).map(e=>e.label)}function Q(a,t,e=!1){return t.map(r=>a.filter(s=>S(s,e)).map(s=>{let n=M.get(r,s.path,"");return typeof s.formatter=="function"&&n&&(n=s.formatter(n,r)),R("".concat(s.drillable&&Array.isArray(n)?n.length:n))}))}function yt(a){const{columns:t,rows:e,quarter:r,period:s,filters:n,safeMode:i}=a,o=x(t,i),l=Q(t,F(e,(n==null?void 0:n.sort)||[]),i);let u=o.join(",")+"\n";return u+=l.map(d=>d.join(",")).join("\n"),u+="\nDate Created:  ".concat(f().format("DD/MMM/YYYY HH:MM:ss")),r&&(u+="\nQuarter: ".concat(r)),s&&(u+="\nQuarter: ".concat(s)),u+="\ne-Mastercard Version : ".concat(ht.value),u+="\nAPI Version ".concat(Dt.value),u+="\nSite UUID: ".concat(gt),u}function wt(a){const t=new Blob([yt(a)],{type:"text/csv;charset=utf-8;"}),e=document.createElement("a");e.href=window.URL.createObjectURL(t),e.setAttribute("download","".concat(a.filename,".csv")),document.body.appendChild(e),e.click(),document.body.removeChild(e)}function Mt(a){const{filename:t,canHorizontalPageBreak:e,columns:r,rows:s,filters:n,safeMode:i}=a,o=[x(r,i)],l=Q(r,F(s,(n==null?void 0:n.sort)||[]),i),u=i?bt():{},d=new E({...u}),h=d.splitTextToSize(R(t),180),C=h.length<=1?20:h.length*10;d.text(h,14,10);const g={startY:C,head:o,body:l};e&&(g.tableWidth="wrap",g.horizontalPageBreak=!0,g.horizontalPageBreakRepeat=0),O(d,g);const q="".concat(t,".pdf");d.save(q)}function qt(a,t,e,r){return{label:"PDF",color:"primary",action:async(s,n,i,o)=>{let l=t&&await ot("PDF may contain private data that will require a password to unlock, To access private data choose Secure PDF over Regular PDF",{header:"Security warning",confirmBtnLabel:"Secure PDF",cancelBtnLabel:"Regular PDF"});Mt({rows:n,filters:i,columns:o,quarter:e,period:r,filename:a,safeMode:l})}}}function Vt(a,t,e){return{label:"CSV",color:"primary",action:async(r,s,n,i)=>{wt({rows:s,filters:n,columns:i,quarter:t,period:e,filename:a})}}}f.extend(U);const _t="YYYY-MM-DD",At="DD/MMM/YYYY";function Tt(a,t){return f(a).isBefore(t)||f(a).isSame(t)}function B(a){return f(a).format(At)}function b(a){return f(a).format(_t)}function $t(){return b()}function jt(a,t=f()){return t.diff(a,"years")}function Et(a=5){const t=[];let e=f();for(let r=0;r<a;r++)t.push({start:e.startOf("quarter").format("YYYY-MM-DD"),end:e.endOf("quarter").format("YYYY-MM-DD"),name:"Q".concat(e.quarter()," ").concat(e.year())}),e=e.subtract(1,"quarter");return t}async function vt(a,t,e){return(await k.create({message:a,position:"top",animated:!0,duration:e,color:t,cssClass:"his-md-text",keyboardClose:!0,buttons:[{side:"end",text:"x",role:"cancel"}]})).present()}function Ot(a,t=3e3){return vt(a,"warning",t)}const Pt={async show(a,t,e="custom-summary-modal",r=!0){const s=await v.create({component:a,cssClass:e,backdropDismiss:r,componentProps:t});s.present();const{data:n}=await s.onWillDismiss();if(n)return n},async hide(a){await v.dismiss(a)}},It=L({__name:"DrilldownTable",props:{title:{type:String,default:"Drill down table"},rows:{type:Array,required:!0},columns:{type:Array,required:!1},actionButtons:{type:Array},rowActionButtons:{type:Array},config:{type:Object,default:()=>({showSubmitButton:!1})}},setup(a){return(t,e)=>(z(),N(c(rt),null,{default:m(()=>[p(c(H),null,{default:m(()=>[p(c(G),null,{default:m(()=>[p(c(W),{slot:"end"},{default:m(()=>[p(c(J),{slot:"end",onClick:e[0]||(e[0]=r=>c(Pt).hide()),"icon-only":""},{default:m(()=>[p(c(K),{icon:c(X)},null,8,["icon"])]),_:1})]),_:1}),p(c(Z),null,{default:m(()=>[tt(et(a.title),1)]),_:1})]),_:1})]),_:1}),p(c(at),null,{default:m(()=>[p(c(nt),{rows:a.rows,columns:a.columns,config:a.config,"row-actions-buttons":a.rowActionButtons,"actions-buttons":a.actionButtons,color:"light"},null,8,["rows","columns","config","row-actions-buttons","actions-buttons"])]),_:1})]),_:1}))}});const Ut=lt(It,[["__scopeId","data-v-dd3e8006"]]),Bt=1,kt=23;class Lt{constructor(){D(this,"date");D(this,"startDate");D(this,"endDate");D(this,"programId");D(this,"useDefaultParams");this.programId=Bt,this.date=$t(),this.endDate="",this.startDate="",this.useDefaultParams=!0}setDate(t){this.date=b(t)}setStartDate(t){this.startDate=b(t)}setEndDate(t){this.endDate=b(t)}getDateIntervalPeriod(){return this.startDate&&this.endDate?"".concat(B(this.startDate)," - ").concat(B(this.endDate)):"-"}buildParams(t){let e={};return this.useDefaultParams&&(e.date=this.date,e.program_id=this.programId),this.startDate&&(e.start_date=this.startDate),this.endDate&&(e.end_date=this.endDate),t&&(e={...e,...t}),e}async getReport(t,e){return(await Y.get(I(t,this.buildParams(e)))).json()}static getReportQuarters(t=5){const e=[];let r=new Date,s=r.getFullYear();const n=s;r=new Date("".concat(n,"-").concat(r.getMonth()+1,"-").concat(r.getDate()," 00:00"));let o=this.getQtrByDate(r).qtr,l=0;for(o===4&&e.push(this.buildQtrObj("Q1",s+1));l<t;)l===0&&o<4&&e.push(this.buildQtrObj("Q".concat(o+1),s)),e.push(this.buildQtrObj("Q".concat(o),s)),o=o>0?o-=1:o,s=o==0?s-1:s,o=o==0?o+=4:o,l++;return e}static getQtrByDate(t){const e=this.getQuarterBounds(t.getFullYear());for(const r in e){const{start:s,end:n}=e[r];if(t>=new Date(s)&&t<=new Date(n))return e[r]}return null}static buildQtrObj(t,e){const r=this.getQuarterBounds(e),{start:s,end:n}=r[t];return{start:s,end:n,name:"".concat(t," ").concat(e)}}static getQuarterBounds(t){const e=n=>f("".concat(t,"-").concat(n,"-01")).daysInMonth(),r=n=>"".concat(t,"-").concat(n,"-01 00:00"),s=n=>"".concat(t,"-").concat(n,"-").concat(e(n)," 00:00");return{Q1:{qtr:1,start:r("01"),end:s("03")},Q2:{qtr:2,start:r("04"),end:s("06")},Q3:{qtr:3,start:r("07"),end:s("09")},Q4:{qtr:4,start:r("10"),end:s("12")}}}async getMaternalStatus(t,e="pepfar"){var n;if(M.isEmpty(t))return{FP:[],FBf:[]};const r=I("vl_maternal_status",this.buildParams({report_definition:e}));return(n=(await st.postJson(r,{patient_ids:t})).data)!=null?n:{FP:[],FBf:[]}}async buildMaternityAgreggateRows(t,e="pepfar"){const r=M.uniq(Object.values(t).flat(1).map(o=>o instanceof Object?o.patient_id:o)),s=Object.keys(t),n=await this.getMaternalStatus(r,e),i=n.FBf.concat(n.FP);return["FP","FNP","FBf"].map(o=>s.reduce((l,u)=>({[u]:t[u].filter(d=>{const h=d instanceof Object?d.patient_id:d;return o==="FNP"?!i.includes(h):n[o].includes(h)}),...l}),{ageGroup:"All",gender:o}))}}export{Ut as D,kt as L,Lt as R,Ot as a,B as b,Vt as c,qt as d,wt as e,b as f,Et as g,jt as h,Tt as i,xt as l,Pt as m,Qt as p,R as s,Ct as t};

import{d as x,r as p,c_ as C,a as V,y as v,f as _,z as n,l as i,u as s,ad as b,bq as q,m as k,ac as P,ab as g,k as F,A as B,ag as N}from"./vendor-IHO26Iap.js";import{P as I,t as u,k as A,_ as R}from"./index-BUOqMZYn.js";import{l as h}from"./lodash-Dt8AsbQm.js";import{P as y}from"./patient_type_service-D-05ReYj.js";import{S as E}from"./SelectFacility-y3EC6Amq.js";import{B as L}from"./BasicRadioSelect-CTZ6UCTR.js";import"./app_encounter_service-RKYf1Er9.js";const M=x({__name:"ARTPatientType",setup(z,{expose:w}){const c=p(!1),d=p([]);p([]);const f=new I,r=new y(f.getID(),-1),o=p({}),e=C({patientType:null,prevType:null,transerFacility:null});function T(){return o.value={},e.patientType||(o.value.patientType="Patient type is required",u("Patient type is required")),!/new patient/i.test(e.patientType)&&e.patientType!==e.prevType&&!e.transerFacility&&(o.value.transerFacility="Facility is required",u("Facility is required")),h.isEmpty(o.value)}async function S(a=null){var l;if(e.patientType===e.prevType)return!0;if(!T())return!1;const t=new y(a!=null?a:f.getID(),-1);t.setPatientType(e.patientType),t.setLocationName(((l=e.transerFacility)==null?void 0:l.name)||"");try{return await t.save()?(A("Patient type saved successfully"),!0):(u("Failed to save patient type"),!1)}catch(m){return u("Failed to save patient type: ".concat(m)),!1}}return V(()=>{c.value=!0,d.value=y.getPatientTypes(),r.loadPatientType().then(()=>{const a=r.getType();a&&!/n\/a/i.test(a)&&(e.prevType=r.getType(),e.patientType=r.getType())}).finally(()=>{c.value=!1})}),w({validateAll:T,onSubmit:S}),(a,t)=>(_(),v(s(N),null,{default:n(()=>[i(s(b),null,{default:n(()=>[i(s(q),null,{default:n(()=>[i(s(P),null,{default:n(()=>[i(s(g),null,{default:n(()=>[i(L,{required:"",label:"Patient Type",modelValue:e.patientType,"onUpdate:modelValue":t[0]||(t[0]=l=>e.patientType=l),options:d.value},null,8,["modelValue","options"])]),_:1})]),_:1}),e.prevType!==e.patientType&&!/new patient/i.test(e.patientType)?(_(),v(s(P),{key:0},{default:n(()=>[i(s(g),null,{default:n(()=>[t[2]||(t[2]=F("h2",{style:{"font-weight":"bold",margin:"12px"}},[B("Facility "),F("span",{style:{color:"red"}},"*")],-1)),i(E,{show_error:!1,selected_district_ids:[],selected_location:null,onFacilitySelected:t[1]||(t[1]=l=>{e.transerFacility=l.selected_location})})]),_:1,__:[2]})]),_:1})):k("",!0)]),_:1})]),_:1})]),_:1}))}}),J=R(M,[["__scopeId","data-v-98d98bfd"]]);export{J as default};

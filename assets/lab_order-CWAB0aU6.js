var ut=Object.defineProperty;var ct=(t,e,s)=>e in t?ut(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var O=(t,e,s)=>ct(t,typeof e!="symbol"?e+"":e,s);import{R as Z,d as $,ar as T,V as tt,as as U,af as et,D as st,dr as at,dz as nt,ac as A,G as H,T as B,U as z,a9 as L,S as q,b8 as V,W,aU as ot,X as J,E as n,y as k,f as I,z as o,l as a,k as c,B as R,A as h,e as it,F as lt,L as pt,a0 as mt,a3 as _t,a1 as ht,a2 as ft,I as vt,a8 as bt,j as gt}from"./vendor-BBnHTtmR.js";import{aO as j,ay as v,D as F,aN as Dt,S as f,l as E,H as C,aw as rt,y as yt,u as dt,_ as M,i as P,aD as It,B as St,aE as wt,w as _,ax as x,bk as Ot,t as Rt}from"./index-53Jeodb6.js";import{B as G}from"./BasicForm-DbOjOBd7.js";import{D as $t}from"./DashBox-Ca0K8opj.js";import{v as X}from"./group_validation-XbkYdF_9.js";const K=Z("labResultsStore",{state:()=>({labResults:[]}),actions:{setLabResults(t){this.labResults=t}},persist:!0});class Ct extends j{constructor(s){super(s,32);O(this,"patientID");O(this,"testTypeID");O(this,"resultDate");O(this,"testID");this.patientID=s,this.testTypeID=-1,this.resultDate="",this.testID=-1}createLabResult(s){return j.postJson("lab/tests/".concat(this.testID,"/results"),{encounter_id:this.encounterID,date:this.resultDate,measures:s})}getTestID(){return this.testID}getTestTypeID(){return this.testTypeID}setTestTypeID(s){this.testTypeID=s}setResultDate(s){this.resultDate=s}setTestID(s){this.testID=s}getTestsWithoutResults(){return v.getOrders(this.patientID,{status:"drawn"})}getTestIndicators(){return v.getJson("lab/test_result_indicators",{test_type_id:this.testTypeID})}static getTestIndicatorsWithID(s){return v.getJson("lab/test_result_indicators",{test_type_id:s})}}const Tt=$({components:{IonButtons:ot,IonButton:W,IonModal:V,IonHeader:q,IonContent:L,IonToolbar:z,IonTitle:B,IonItem:H,IonList:A,IonAvatar:nt,IonImg:at,IonLabel:st,IonPage:et,IonMenu:U,BasicForm:G,IonFooter:tt,DynamicButton:F},data(){return{popoverStatus:null}},props:{keyboardClose:{type:Boolean,default:!1},keepContentsMounted:{type:Boolean,default:!1},content:{type:Object,default:{}},popoverOpen:{type:Boolean,default:!1},event:{type:Event,default:""},title:{type:String,default:""}},computed:{...T(dt,["patient"]),...T(K,["labResults"])},mounted(){},methods:{dismiss(){J.dismiss()},async saveResults(){const t=await this.buildResults();this.patient.labOrders.results=[{encounter_id:"",date:C.sessionDate(),measures:t,test_id:this.labResults[0].id}];let e=!1;for(let s=0;s<this.patient.labOrders.unsaved.length;s++)if(this.patient.labOrders.unsaved[s].tests[0].id===this.labResults[0].id&&this.patient.labOrders.unsaved[s].tests&&this.patient.labOrders.unsaved[s].tests.length>0){this.patient.labOrders.unsaved[s].tests[0].result=t,e=!0;break}if(!e){for(let s=0;s<this.patient.labOrders.saved.length;s++)if(this.patient.labOrders.saved[s].tests[0].id===this.labResults[0].id&&this.patient.labOrders.saved[s].tests&&this.patient.labOrders.saved[s].tests.length>0){this.patient.labOrders.saved[s].tests[0].result=t;break}}await rt(this.patient),yt("Saved successfully"),this.$emit("saved")},async buildResults(){let t=[];return await Promise.all(this.labResults[1].data.rowData[0].colData.map(async e=>{var i;let s;f.getUseIndexDBStatus()||f.getModsStatus()?s=await E("testResultIndicators",{whereClause:{test_type_id:e.id}}):s=await Ct.getTestIndicatorsWithID(e.id),t.push({indicator:{name:(i=s[0])==null?void 0:i.name,concept_id:e.id},value:e.value.name||e.value||"not done",value_modifier:"",value_type:"text"})})),t},async nav(t,e){const s=K();e=="not_save"?(await Dt(),s.setLabResults(!1)):s.setLabResults(!0),this.dismiss(),this.$router.push(t)}}}),kt={class:"modal_wrapper"},Bt={class:"center text_12"};function Lt(t,e,s,i,g,p){const l=n("ion-title"),r=n("ion-button"),d=n("ion-buttons"),u=n("ion-toolbar"),D=n("ion-header"),m=n("basic-form"),y=n("ion-row"),S=n("ion-content"),w=n("DynamicButton"),b=n("ion-footer"),N=n("ion-modal");return I(),k(N,{"is-open":t.popoverOpen,"show-backdrop":!0,onDidDismiss:e[2]||(e[2]=Y=>t.$emit("closePopoover",!1)),"keyboard-close":t.keyboardClose},{default:o(()=>[a(D,null,{default:o(()=>[a(u,null,{default:o(()=>[a(l,null,{default:o(()=>[c("b",null,"Enter lab results for ("+R(t.labResults[0].name)+") test",1)]),_:1}),a(d,{slot:"end"},{default:o(()=>[a(r,{onClick:e[0]||(e[0]=Y=>t.$emit("closeModal"))},{default:o(()=>e[3]||(e[3]=[h("Close")])),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),a(S,{class:"ion-padding"},{default:o(()=>[c("div",kt,[c("div",Bt,[a(y,null,{default:o(()=>[a(m,{contentData:t.labResults},null,8,["contentData"])]),_:1})])])]),_:1}),a(b,{translucent:!0},{default:o(()=>[a(u,null,{default:o(()=>[a(w,{onClick:e[1]||(e[1]=Y=>t.saveResults()),name:"Save",fill:"clear",iconSlot:"icon-only",style:{float:"right"}})]),_:1})]),_:1})]),_:1},8,["is-open","keyboard-close"])}const Zt=M(Tt,[["render",Lt],["__scopeId","data-v-a9001ab2"]]),Ft=$({components:{IonButtons:ot,IonButton:W,IonModal:V,IonHeader:q,IonContent:L,IonToolbar:z,IonTitle:B,IonItem:H,IonList:A,IonAvatar:nt,IonImg:at,IonLabel:st,IonPage:et,IonMenu:U,BasicForm:G,IonFooter:tt,DynamicButton:F},data(){return{popoverStatus:null}},props:{keyboardClose:{type:Boolean,default:!1},keepContentsMounted:{type:Boolean,default:!1},content:{default:[]},popoverOpen:{type:Boolean,default:!1},event:{type:Event,default:""},title:{type:String,default:""}},methods:{dismiss(){J.dismiss()},nav(t,e){this.dismiss(),this.$router.push(t)}}}),Mt={class:"modal_wrapper"},Nt={class:"center text_12"};function Et(t,e,s,i,g,p){const l=n("ion-title"),r=n("ion-button"),d=n("ion-buttons"),u=n("ion-toolbar"),D=n("ion-header"),m=n("ion-col"),y=n("ion-row"),S=n("ion-content"),w=n("ion-modal");return I(),k(w,{"is-open":t.popoverOpen,"show-backdrop":!0,onDidDismiss:e[1]||(e[1]=b=>t.$emit("closePopoover",!1)),"keyboard-close":t.keyboardClose},{default:o(()=>[a(D,null,{default:o(()=>[a(u,null,{default:o(()=>[a(l,null,{default:o(()=>[c("b",null,"Lab results for ("+R(t.content.name)+") test",1)]),_:1}),a(d,{slot:"end"},{default:o(()=>[a(r,{onClick:e[0]||(e[0]=b=>t.$emit("closeModal"))},{default:o(()=>e[2]||(e[2]=[h("Close")])),_:1,__:[2]})]),_:1})]),_:1})]),_:1}),a(S,{class:"ion-padding"},{default:o(()=>[c("div",Mt,[c("div",Nt,[a(y,null,{default:o(()=>[(I(!0),it(lt,null,pt(t.content.result,(b,N)=>(I(),k(m,{size:"4",key:N},{default:o(()=>[a(y,null,{default:o(()=>[a(m,{size:"8"},{default:o(()=>[h(R(b.indicator.name),1)]),_:2},1024),a(m,{class:"bold",size:"0.5"},{default:o(()=>e[3]||(e[3]=[h(":")])),_:1,__:[3]}),a(m,{class:"bold",size:"2"},{default:o(()=>[h(R(b.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),_:1})]),_:1},8,["is-open","keyboard-close"])}const te=M(Ft,[["render",Et],["__scopeId","data-v-5d6713fe"]]),Q=Z("investigationNCDStore",{state:()=>({investigations:[{db_data:[],isFinishBtn:!1,selectedData:[],displayData:[],data:{rowData:[{colData:[{inputHeader:"Test",icon:P.search,value:"",name:"test",popOver:!0,eventType:"input",required:!0,alertsErrorMassage:"",isSingleSelect:!0,trackBy:"concept_id",multiSelectData:[],id:"",idName:"test_id",validationFunctionName:"required"},{inputHeader:"Specimen",icon:P.search,value:"",name:"specimen",eventType:"input",required:!0,alertsErrorMassage:"",disabled:!0,isSingleSelect:!0,trackBy:"concept_id",multiSelectData:[],id:"",idName:"specimen_id",validationFunctionName:"required"}]}]}}]}),actions:{setInvestigations(t){this.investigations=t}}}),Pt=$({data:()=>({userRole:"",ready:!1,userRoleSettings:{}}),watch:{$route:{async handler(t){this.userRole=f.getUserRoles();const e=f.getProgramID(),s=f.getProgramName();this.userRole=="Lab"&&e==14&&(this.userRoleSettings={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}),e==14&&this.userRole!="Lab"&&(this.userRoleSettings={url:"home",btnName:"Go to waiting list",stepperTitle:"Consultation Plan"}),e==12&&(this.userRoleSettings={url:"contact",btnName:"Back"}),s=="LABOUR AND DELIVERY PROGRAM"&&(this.userRoleSettings={url:"labour/labourHome",btnName:"Back to home"}),s=="PNC PROGRAM"&&(this.userRoleSettings={url:"pnc/home",btnName:"Back to home"})},immediate:!0,deep:!0}}}),Ut=$({name:"Menu",mixins:[Pt],components:{IonContent:L,IonHeader:q,IonItem:H,IonList:A,IonMenu:U,IonTitle:B,IonToolbar:z,IonInput:_t,IonPopover:mt,DashBox:$t,SelectionPopover:wt,BasicInputField:St,BasicForm:G,List:It,DynamicButton:F},data(){return{segmentContent:"Lab Investigations",iconsContent:P,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",testResult:"",test:"",labOrders:"",filteredSpecimen:"",testData:[],popoverOpen:!1,labOrderStatus:!1,event:"",specimen:"",radiologyOrdersStatus:!1,otherOrdersStatus:!1}},setup(){return{checkmark:ft,pulseOutline:ht}},computed:{...T(Q,["investigations"]),...T(dt,["patient"]),inputFields(){return this.investigations[0].data.rowData[0].colData}},watch:{investigations:{handler(){this.setDashedBox()},deep:!0},patient:{async handler(){this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved]},deep:!0},$route:{async handler(){await this.getTests()},deep:!0}},async mounted(){await this.getTests(),this.updateInvestigationsStores(),this.setDashedBox(),this.updateInvestigationWizard()},methods:{dismiss(){J.dismiss()},setSegmentContent(t){this.segmentContent=t},async getTests(){let t;f.getUseIndexDBStatus()&&f.getModsStatus()?t=await E("testTypes"):t=await v.getTestTypes(),_(this.investigations,"test","multiSelectData",t)},toggleLabOrderStatus(){this.labOrderStatus=!this.labOrderStatus},async updateInvestigationWizard(){this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved];const t=await this.labOrders.filter(e=>C.toStandardHisFormat(C.sessionDate())===C.toStandardHisFormat(e.order_date));t.length>0?this.investigations[0].selectedData=t:this.investigations[0].selectedData=""},async updateInvestigationsStores(){await this.updateInvestigationWizard(),Q().setInvestigations(this.investigations)},displayInputFields(){this.testResult="",this.selectedText="",this.no_item=!1,this.addItemButton=!1,this.search_item=!0},async validateRowData(){return X(this.investigations)},async checkTest(){return await this.isNameInData(this.inputFields[0].value.name,await this.investigations[0].selectedData)?(_(this.investigations,"test","alertsErrorMassage","Lab order already selected"),!1):(_(this.investigations,"test","alertsErrorMassage",""),!0)},async addNewRow(){X(this.investigations)&&await this.checkTest()&&(await this.saveTest(),this.investigations[0].data.rowData[0].colData[0].value="",this.investigations[0].data.rowData[0].colData[1].value="",this.search_item=!1,this.display_item=!0,this.addItemButton=!0),this.updateInvestigationWizard(),this.dismiss()},isNameInData(t,e){for(let s of e)for(let i of s.tests)if(i.name===t)return!0;return!1},async saveTest(){var g,p,l,r,d,u;const t=[{concept_id:this.inputFields[0].value.concept_id,name:this.inputFields[0].value.name,specimen:this.inputFields[1].value.name,reason:"Routine",specimenConcept:await x.getConceptID(this.inputFields[1].value.name,!0)}];let s=(await v.buildLabOrders("",t))[0];s.order_date=s.date,s.specimen.name=this.inputFields[1].value.name,s.tests[0].name=this.inputFields[0].value.name;const i=JSON.parse(JSON.stringify(this.patient));(l=(p=(g=i.labOrders)!=null?g:i.labOrders={}).unsaved)!=null||(p.unsaved=[]),(u=(d=(r=i.labOrders)!=null?r:i.labOrders={}).saved)!=null||(d.saved=[]),i.labOrders.unsaved.push(s),await rt(i),_(this.investigations,"specimen","disabled",!0),this.labOrders=[...i.labOrders.saved,...i.labOrders.unsaved]},async handleInputData(t){if(t.inputHeader=="Test"&&this.checkTest(),_(this.investigations,"specimen","alertsErrorMassage",""),t.inputHeader=="Test"&&t.value){let e;f.getUseIndexDBStatus()&&f.getModsStatus()?e=await E("specimens"):e=await v.getSpecimens("",1e3),this.specimen=await x.getConceptSet(t.value.name,"",{names:e.map(s=>s.name)}),this.specimen.length==1?(_(this.investigations,"specimen","value",this.specimen[0]),_(this.investigations,"specimen","disabled",!0)):(_(this.investigations,"specimen","value",""),_(this.investigations,"specimen","disabled",!1)),_(this.investigations,"specimen","multiSelectData",this.specimen)}},async filterTest(t){return await this.labOrders.filter(e=>e.name.toLowerCase().includes(t.toLowerCase()))},async filterSpecimen(t){var e;return(e=this.specimen[0])!=null&&e.name&&t?await this.specimen.filter(s=>s==null?void 0:s.name.toLowerCase().includes(t.toLowerCase())):[]},setTest(t){this.selectedText=t.name,this.inputFields[1].inputHeader=="Test"?this.investigations[0].data.rowData[0].colData[0].value=t.name:this.investigations[0].data.rowData[0].colData[1].value=t.name,this.updateInvestigationsStores()},setDashedBox(){(this.inputFields[1].value||this.inputFields[0].value)&&(this.addItemButton=!1,this.search_item=!0,this.no_item=!1),this.investigations[0].selectedData.length>0?(this.display_item=!0,this.no_item=!1):this.search_item||(this.no_item=!0)}}}),At={class:"modal_wrapper"},Ht={class:""};function zt(t,e,s,i,g,p){const l=n("ion-title"),r=n("ion-icon"),d=n("ion-header"),u=n("basic-form"),D=n("ion-content"),m=n("DynamicButton"),y=n("ion-col"),S=n("ion-row"),w=n("ion-footer");return I(),it(lt,null,[a(d,{style:{display:"flex","justify-content":"space-between"}},{default:o(()=>[a(l,{class:"modalTitle"},{default:o(()=>e[2]||(e[2]=[h("Add Lab Test")])),_:1,__:[2]}),a(r,{onClick:e[0]||(e[0]=b=>t.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:t.iconsContent.cancel},null,8,["icon"])]),_:1}),a(D,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:o(()=>[c("div",At,[c("div",Ht,[a(u,{contentData:t.investigations,"onUpdate:selected":t.handleInputData,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:selected","onUpdate:inputValue"])])])]),_:1}),a(w,{collapse:"fade",class:"ion-no-border"},{default:o(()=>[a(S,null,{default:o(()=>[a(y,null,{default:o(()=>[a(m,{onClick:e[1]||(e[1]=b=>t.addNewRow()),name:"Save",fill:"solid",style:{float:"right",margin:"2%",width:"130px"}})]),_:1})]),_:1})]),_:1})],64)}const ee=M(Ut,[["render",zt],["__scopeId","data-v-bae5aa39"]]),qt=$({name:"CheckInConfirmationModal",components:{IonModal:V,IonTitle:B,IonButton:W,IonContent:L,IonIcon:vt,DynamicButton:F},props:{isOpen:{type:Boolean,required:!0,default:!1},closeModalFunc:{type:Function,required:!0},onYes:{type:Function,required:!0},onNo:{type:Function,required:!0},title:{type:String,required:!0}},methods:{closeOutline(){return bt},closeModal(){this.closeModalFunc()}}}),Vt={class:"modal-header"},Wt={class:"modal-body"},Jt={class:"modal-footer"};function Gt(t,e,s,i,g,p){const l=n("ion-title"),r=n("ion-icon"),d=n("ion-button"),u=n("DynamicButton"),D=n("ion-content"),m=n("ion-modal");return I(),k(m,{"is-open":t.isOpen,"show-backdrop":!0,onDidDismiss:t.closeModal},{default:o(()=>[a(D,{class:"modal-wrapper"},{default:o(()=>[c("div",Vt,[a(l,{class:"modal-title"},{default:o(()=>[h(R(t.title),1)]),_:1}),a(d,{fill:"clear",class:"close-btn",onClick:t.closeModal},{default:o(()=>[a(r,{icon:t.closeOutline()},null,8,["icon"])]),_:1},8,["onClick"])]),c("div",Wt,[gt(t.$slots,"default",{},()=>[e[0]||(e[0]=h(" Sending the patient to the lab will pause this consultation. You’ll return to the waiting list while waiting for lab results this patient. "))],!0)]),c("div",Jt,[a(d,{fill:"outline",color:"danger",class:"action-btn",onClick:t.onNo,style:{"--border-color":"#b42318"}},{default:o(()=>e[1]||(e[1]=[h(" Cancel ")])),_:1,__:[1]},8,["onClick"]),a(u,{name:"Confirm",color:"success",class:"action-btn confirm-btn",fill:"solid",onClick:t.onYes},null,8,["onClick"])])]),_:3})]),_:3},8,["is-open","onDidDismiss"])}const se=M(qt,[["render",Gt],["__scopeId","data-v-cd018740"]]);class ae extends v{constructor(){super()}async postActivities(e,s){const i=s.location_id,p=await new Ot(parseInt(e),-1,i).createEncounter();if(p){const l=await v.buildLabOrders(p,s.orders||s);if(!await v.saveOrdersArray(p.encounter_id,l))return Rt("Unable to save lab orders")}}}export{ee as E,te as L,Ct as P,se as S,Pt as _,Zt as a,ae as b,K as u};

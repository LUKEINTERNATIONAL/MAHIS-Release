!function(){function e(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var o=i.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}System.register(["./vendor-legacy-1abea43d.js","./index-legacy-e977a0fb.js","./LocationFieldOptions-legacy-8c4edbab.js","./lodash-legacy-78c9f2a0.js","./apexcharts-legacy-f287956f.js","./chartjs-legacy-ea69acb1.js","./barcode-qrcode-reader-legacy-b01db620.js"],(function(t,i){"use strict";var o,n,a,s,r,d,l,c,u,g,p,h,y,f,m,b,v,_,A,w,C,T,D,I,E,S,O,V,H,P,B,N,G,W,k,F,L,M,U,x,R,j,Y,q,$,z,Q,K;return{setters:[e=>{o=e.d,n=e.r,a=e.cG,s=e.w,r=e.a,d=e.e,l=e.y,c=e.z,u=e.l,g=e.x,p=e.aK,h=e.j,y=e.aL,f=e.f,m=e.bf,b=e.aM,v=e.aN,_=e.G,A=e.D,w=e.A,C=e.d3,T=e.d2,D=e.B,I=e.m,E=e.M,S=e.F,O=e.J,V=e.L,H=e.cZ,P=e.ab,B=e.bq,N=e.aO,G=e.b8,W=e.bk,k=e.V,F=e.aI,L=e.N},e=>{M=e.j,U=e.C,x=e.A,R=e.L,j=e.a,Y=e.c,q=e.t,$=e.b,z=e.k,Q=e._},e=>{K=e.g},null,null,null,null],execute:function(){var i=document.createElement("style");i.textContent=".section-header ion-label[data-v-719c0805]{font-size:1rem;font-weight:600;letter-spacing:.5px;color:var(--ion-color-primary);text-transform:uppercase}ion-checkbox[data-v-719c0805]{--size: 24px !important}ion-radio[data-v-719c0805]{--size: 27px !important}.error[data-v-719c0805]{color:red;font-weight:700;font-style:italic}\n",document.head.appendChild(i);const J="2016-04-30",Z={"Adults with stage 4 conditions":{concept:"WHO STAGE IV ADULT",priority:1,conditions:{stage:e=>4===e}},"Classify as stage 4 when reason for ART is WHO STAGE 4":{concept:"WHO STAGE IV ADULT",priority:2,conditions:{reasonForArt:e=>"WHO STAGE IV ADULT"===e}},"Adults with stage 3 conditions":{concept:"WHO STAGE III ADULT",priority:3,conditions:{stage:e=>3===e}},"Adults with stage 2 conditions":{concept:"WHO STAGE II ADULT",priority:4,conditions:{stage:e=>2===e}},"Adults with stage 1 conditions":{concept:"WHO STAGE I ADULT",priority:5,conditions:{stage:e=>1===e}}},X={"Children with stage 4 conditions":{concept:"WHO STAGE IV PEDS",priority:1,conditions:{stage:e=>4===e}},"Classify as stage 4 when reason for ART is WHO STAGE 4":{concept:"WHO STAGE IV PEDS",priority:2,conditions:{reasonForArt:e=>"WHO STAGE IV PEDS"===e}},"For children with stage 3 conditions":{concept:"WHO STAGE III PEDS",priority:3,conditions:{stage:e=>3===e}},"Children with stage 2 conditions":{concept:"WHO STAGE II PEDS",priority:4,conditions:{stage:e=>2===e}},"Children with stage 1 conditions":{concept:"WHO STAGE I PEDS",priority:5,conditions:{stage:e=>1===e}}},ee={"Warn if Severe weight loss is selected when actual patient BMI is acceptable":{priority:1,actions:{alert:async e=>await M(`Patient's BMI of ${e.bmi} greater than 18.5, do you wish to proceed?`,{confirmBtnLabel:"Yes, keep severe weightloss",cancelBtnLabel:"No, cancel"})},conditions:{selectedCondition:e=>"Severe weight loss >10% and/or BMI <18.5kg/m^2, unexplained"===e,bmi:e=>e>18.5}},"Warn for contradicting stage defining conditions":{priority:1,actions:{alert:async e=>!!(await M("CONTRADICTING STAGE DEFINING CONDITIONS",{confirmBtnLabel:"Keep Asymptomatic",cancelBtnLabel:"Keep other(s)"}))},conditions:{selectedCondition:e=>"Asymptomatic HIV infection"===e}}},te={"Enable TB staging condition if client is TB positive":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:()=>"Client registered as a TB Patient in the TB Module"},conditions:{tbPositive:e=>e,selectedCondition:e=>/\bTuberculosis \(PTB or EPTB\)|\bPulmonary tuberculosis/i.test(e)}},"Enable TB staging condition if client is EPTB positive":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:()=>"Client registered with EPTB in TB Module"},conditions:{eptbPositive:e=>e,selectedCondition:e=>/Extrapulmonary tuberculosis/i.test(e)}},"For children whose current weight percentile is less than 70":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:e=>`Child has a low weight percentile of ${e.weightPercentile}`},conditions:{selectedCondition:e=>"Severe unexplained wasting or malnutrition not responding to treatment (weight-for-height/ -age <70% or MUAC less than 11cm or oedema)"===e,weightPercentile:e=>e<70}},"Enable Moderate unexplained malnutrition for children whose weight for height is 70-79%":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:e=>`Child has weight percentile of ${e.weightPercentile}`},conditions:{selectedCondition:e=>"Moderate unexplained wasting/malnutrition not responding to treatment (weight-for-height/ -age 70-79% or muac 11-12 cm)"===e,weightPercentile:e=>e>=70&&e<=79}},"Disable moderate weight loss when Severe unexplained weight loss is chosen":{priority:2,actions:{isChecked:!1,disabled:!0},description:{color:"secondary",show:"always",info:()=>"Severe weight loss/manutrition was already selected"},conditions:{selectedCondition:e=>"Moderate unexplained wasting/malnutrition not responding to treatment (weight-for-height/ -age 70-79% or muac 11-12 cm)"===e,selectedConditions:e=>e.includes("Severe unexplained wasting or malnutrition not responding to treatment (weight-for-height/ -age <70% or MUAC less than 11cm or oedema)")}}},ie={"Enable TB staging condition if client is TB positive":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:()=>"Client registered Positive in TB Module"},conditions:{tbPositive:e=>e,selectedCondition:e=>/\bTuberculosis \(PTB or EPTB\)|\bPulmonary tuberculosis/i.test(e)}},"Enable TB staging condition if client is EPTB positive":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:()=>"Client registered with EPTB in TB Module"},conditions:{eptbPositive:e=>e,selectedCondition:e=>/Extrapulmonary tuberculosis/i.test(e)}},"Adults with a BMI less than 16":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:e=>`Adult has a low BMI of ${e.bmi}`},conditions:{selectedCondition:e=>"Severe weight loss >10% and/or BMI <18.5kg/m^2, unexplained"===e,bmi:e=>e<16}},"Adults whose BMI is between 16 and 18":{priority:3,actions:{isChecked:!0},description:{color:"warning",show:"onChecked",info:e=>`BMI of ${e.bmi} is between 16 and 18`},conditions:{selectedCondition:e=>"Moderate weight loss less than or equal to 10 percent, unexplained"===e,bmi:e=>e>=16&&e<=18.5}},"Disable Moderate weight loss if severe weightloss is selected":{priority:2,actions:{isChecked:!1,disabled:!0},description:{color:"secondary",show:"always",info:()=>"Severe weight loss was already selected"},conditions:{selectedCondition:e=>"Moderate weight loss less than or equal to 10 percent, unexplained"===e,selectedConditions:e=>e.includes("Severe weight loss >10% and/or BMI <18.5kg/m^2, unexplained")}}},oe={"Children under twelve months who tested positive on Rapid test and have presumed severe HIV":{concept:"PRESUMED SEVERE HIV",priority:1,conditions:{ageInMonths:e=>e<12,selectedConditions:e=>U.getConceptsByCategory("pshd_condition").some((t=>e.includes(t.name))),testType:e=>"HIV rapid test"===e}},"Has stage 4 conditions":{concept:"WHO STAGE IV PEDS",priority:2,conditions:{stage:e=>4===e}},"Has stage 3 conditions":{concept:"WHO STAGE III PEDS",priority:3,conditions:{stage:e=>3===e}},"Children under twelve who tested positive via HIV DNA Polymerase Chain Reaction test":{concept:"HIV DNA polymerase chain reaction",priority:4,conditions:{ageInMonths:e=>e<12,testType:e=>"HIV DNA polymerase chain reaction"===e}},"Children who are less than 24 months":{concept:"HIV infected",priority:5,conditions:{ageInMonths:e=>e<24}},"Children between 24 and 56 months who have stage 2 or 1 conditions":{concept:"CD4 COUNT LESS THAN OR EQUAL TO 750",priority:6,conditions:{ageInMonths:e=>e>=24&&e<=56,cd4Date:e=>new Date(e)<=new Date(J),cd4:e=>e<=750,cd4Modifier:e=>"<"===e||"="===e,stage:e=>e<=2}},"Children with CD4 count less than 500 and have stage 1 and stage 2 conditions":{concept:"CD4 COUNT LESS THAN OR EQUAL TO 500",priority:7,conditions:{cd4:e=>e<=500,cd4Date:e=>new Date(e)<=new Date(J),cd4Modifier:e=>"<"===e||"="===e,stage:e=>e<=2}},"Children who are more than five years old and have cd4 count less than 500":{concept:"CD4 COUNT LESS THAN OR EQUAL TO 500",priority:9,conditions:{cd4Date:e=>new Date(e)<=new Date(J),age:e=>e>5,cd4:e=>e<=500,cd4Modifier:e=>"<"===e||"="===e}},"Children over date 2014-04-01 and less than Five years old":{concept:"HIV infected",priority:10,conditions:{date:e=>e>="2014-04-01",age:e=>e<=5}},"Women who are breast feeding":{concept:"BREASTFEEDING",priority:11,conditions:{gender:e=>"F"===e,breastFeeding:e=>"Yes"===e,stage:e=>e<=2}},"Women who are pregnant":{concept:"PATIENT PREGNANT",priority:12,conditions:{gender:e=>"F"===e,pregnant:e=>"Yes"===e,stage:e=>e<=2}},"Asymptomatic patient with either stage one or stage two conditions":{concept:"Asymptomatic",priority:13,conditions:{stage:e=>e<=2}}},ne={"Has stage 4 conditions":{concept:"WHO STAGE IV ADULT",priority:1,conditions:{stage:e=>4===e}},"Has HIV wasting syndrome identified in stage 3":{concept:"WHO STAGE IV ADULT",priority:2,conditions:{selectedConditions:e=>U.getConceptsByCategory("severe_hiv_wasting_syndrome").reduce(((t,i)=>e.includes(i.name)?t+1:0),0)>=2}},"Has stage 3 conditions":{concept:"WHO STAGE III ADULT",priority:3,conditions:{stage:e=>3===e}},"CD4 less than 350 for adults before 2014":{concept:"cd4 less than or equal to 350",priority:4,conditions:{cd4Date:e=>new Date(e)<=new Date(J),cd4:e=>e<=350,cd4Modifier:e=>"<"===e||"="===e}},"CD4 less than 250 for adults after 2014":{concept:"cd4 less than or equal to 250",priority:4,conditions:{cd4Date:e=>new Date(e)<=new Date(J),cd4:e=>e<=250,cd4Modifier:e=>"<"===e||"="===e}},"CD4 less than 350 for adults after 2014":{concept:"cd4 less than or equal to 350",priority:5,conditions:{cd4Date:e=>new Date(e)<=new Date(J),cd4:e=>e<=350,cd4Modifier:e=>"<"===e||"="===e}},"CD4 less than 500 for adults after 2014":{concept:"cd4 less than or equal to 500",priority:6,conditions:{cd4Date:e=>new Date(e)<=new Date(J),cd4:e=>e<=500,cd4Modifier:e=>"<"===e||"="===e}},"Women who are breast feeding":{concept:"BREASTFEEDING",priority:8,conditions:{gender:e=>"F"===e,breastFeeding:e=>"Yes"===e,stage:e=>e<=2}},"Women who are pregnant":{concept:"PATIENT PREGNANT",priority:7,conditions:{gender:e=>"F"===e,pregnant:e=>"Yes"===e,stage:e=>e<=2}},"Asymptomatic patient with either stage one or stage two conditions":{concept:"Asymptomatic",priority:9,conditions:{stage:e=>e<=2}}};class ae extends x{constructor(t,i,o){super(t,52,o),e(this,"age",void 0),e(this,"confirmatoryTest",void 0),this.age=i,this.confirmatoryTest=null}isAdult(){return this.age>=15}isPedaid(){return this.age<=14}setAge(e){this.age=e}getFacilities(e=""){return R.getFacilities({name:e})}getConfirmatoryTestType(){return this.confirmatoryTest}cd4CountIsValid(e){try{return!!e.match(/^(=|<|>)([0-9]*)$/m)}catch(t){return!1}}getAlertGuidelines(){return ee}getWhoStageGuidelines(){return this.isAdult()?Z:X}getProgramEligibilityGuidelines(){return this.isAdult()?ne:oe}getRecommendedConditionGuidelines(){return this.isAdult()?ie:te}getStagingConditions(e){const t=this.getStagingCategoryByNum(e);return x.getConceptsByCategory(t)}buildWhoStageObs(e){return this.buildValueCoded("Who stage",e)}buildWhoCriteriaObs(e){return this.buildValueCoded("Who stages criteria present",e)}buildReasonForArtObs(e){return this.buildValueCoded("Reason for ART eligibility",e)}getStagingCategoryByNum(e){switch(e){case 1:return this.isAdult()?"stage_1_conditions_adults":"stage_1_conditions_pedaids";case 2:return this.isAdult()?"stage_2_conditions_adults":"stage_2_conditions_pedaids";case 3:return this.isAdult()?"stage_3_conditions_adults":"stage_3_conditions_pedaids";case 4:return this.isAdult()?"stage_4_conditions_adults":"stage_4_conditions_pedaids";default:return""}}async loadHivConfirmatoryTestType(){const e=await x.getFirstValueCoded(this.patientID,"Confirmatory hiv test type");e&&(this.confirmatoryTest=e)}}const se={key:0,style:{"border-bottom":"dashed #ccc"},class:"ion-padding"},re={class:"error"},de={class:"error"},le={class:"accordion_group"},ce={style:{"font-weight":"bold"}},ue={class:"error"},ge={class:"ion-padding",slot:"content"},pe={style:{"border-top":"dashed #ccc","border-bottom":"dashed #ccc"},class:"ion-padding"},he={class:"ion-padding"},ye={class:"error"},fe={key:0,class:"ion-padding"},me={class:"error"},be={class:"error"},ve={class:"error"},_e={class:"ion-padding",style:{"border-bottom":"dashed #ccc"}},Ae={key:1,class:"ion-padding"},we=o({__name:"Staging",props:{hideSubmit:{type:Boolean,default:!1},date:{default:ae.getSessionDate()}},setup(e,{expose:t}){const i=e,o=new j,M=n({}),x=new ae(o.getID(),o.getAge(),-1),R=a({stage_4_conditions:{title:"Stage 4 Conditions",options:[]},stage_3_conditions:{title:"Stage 3 Conditions",options:[]},stage_2_conditions:{title:"Stage 2 Conditions",options:[]},stage_1_conditions:{title:"Stage 1 Conditions",options:[]}}),Q=n([]),J=a({cd4:"",cd4Date:"",isChildBearing:!1,reasonForArt:"",pregnant:"",breastFeeding:"",cd4Available:"",cd4Location:"",whoStage:"",staging:[],confirmatoryTest:"",selectedFacilityObj:null}),Z={reasonForArt:{buildObs:()=>x.buildReasonForArtObs(J.reasonForArt),suggestAvalue:()=>({"PRESUMED SEVERE HIV":{priority:1,condition:()=>o.getAgeInMonths()<12&&"HIV rapid test"===J.confirmatoryTest&&U.getConceptsByCategory("pshd_condition").some((e=>Ce().includes(e.name)))},"WHO STAGE IV PEDS":{priority:2,condition:()=>x.isPedaid()&&X(["stage_4_conditions"])},"WHO STAGE III PEDS":{priority:3,condition:()=>x.isPedaid()&&X(["stage_3_conditions"])},"HIV DNA polymerase chain reaction":{priority:4,condition:()=>o.getAgeInMonths()<12&&"HIV DNA polymerase chain reaction"===J.confirmatoryTest},"CD4 COUNT LESS THAN OR EQUAL TO 750":{priority:5,condition:()=>ne(750)&&we()&&ee()&&o.ageInMonths()>=24&&o.ageInMonths()<=56},"CD4 COUNT LESS THAN OR EQUAL TO 500":{priority:6,condition:()=>x.isPedaid()&&ne(500)&&we()&&ee()},"HIV infected":{priority:7,condition:()=>o.getAgeInMonths()<24||o.getAge()<=5},"WHO STAGE IV ADULT":{priority:1,condition:()=>{const e=U.getConceptsByCategory("severe_hiv_wasting_syndrome");return x.isAdult()&&(X(["stage_4_conditions"])||e.filter((e=>Ce().includes(e.name))).length>=2)}},"WHO STAGE III ADULT":{priority:2,condition:()=>x.isAdult()&&X(["stage_3_conditions"])},"cd4 less than or equal to 350":{priority:3,condition:()=>x.isAdult()&&ne(350)&&ee()},"cd4 less than or equal to 250":{priority:4,condition:()=>x.isAdult()&&ne(250)&&ee()},"cd4 less than or equal to 500":{priority:4,condition:()=>x.isAdult()&&ne(500)&&ee()},BREASTFEEDING:{priority:5,condition:()=>x.isAdult()&&"Yes"===J.breastFeeding&&we()},"PATIENT PREGNANT":{priority:6,condition:()=>x.isAdult()&&"Yes"===J.pregnant&&we()},Asymptomatic:{priority:7,condition:()=>we()}})},whoStage:{buildObs:()=>x.buildWhoStageObs(J.whoStage),suggestAvalue:()=>({"WHO STAGE IV ADULT":{priority:1,condition:()=>x.isAdult()&&X(["stage_4_conditions"])},"WHO STAGE III ADULT":{priority:2,condition:()=>x.isAdult()&&X(["stage_3_conditions"])},"WHO STAGE II ADULT":{priority:3,condition:()=>x.isAdult()&&X(["stage_2_conditions"])},"WHO STAGE I ADULT":{priority:4,condition:()=>x.isAdult()&&X(["stage_1_conditions"])},"WHO STAGE IV PEDS":{priority:1,condition:()=>x.isPedaid()&&(X(["stage_4_conditions"])||"WHO STAGE IV PEDS"===J.reasonForArt)},"WHO STAGE III PEDS":{priority:2,condition:()=>x.isPedaid()&&X(["stage_3_conditions"])},"WHO STAGE II PEDS":{priority:3,condition:()=>x.isPedaid()&&X(["stage_2_conditions"])},"WHO STAGE I PEDS":{priority:4,condition:()=>x.isPedaid()&&X(["stage_1_conditions"])}})},cd4Available:{required:()=>!0,dataHandler:e=>{"Yes"!=e&&(J.cd4="",J.cd4Date=""),M.value.cd4="",M.value.cd4Date="",M.value.cd4Location=""}},pregnant:{required:()=>J.isChildBearing,buildObs:()=>x.buildValueCoded("Is patient pregnant?",J.pregnant)},breastFeeding:{required:()=>J.isChildBearing,buildObs:()=>x.buildValueCoded("Is patient breast feeding?",J.breastFeeding)},cd4:{required:()=>"Yes"===J.cd4Available,validation:()=>{oe()?ie()>1e4&&(M.value.cd4="CD4 value cannot exceed 10,000"):M.value.cd4="Invalid cd4 count format, expected e.g. <100 or >500 or =750"},buildObs:()=>x.buildValueNumber("CD4 count",ie(),te())},cd4Date:{required:()=>"Yes"===J.cd4Available,dataHandler:e=>{e&&(J.cd4Date=L(e).format("YYYY-MM-DD"))},validation:()=>{const e=new Date(J.cd4Date);if(isNaN(e.getTime()))return void(M.value.cd4Date="Invalid CD4 date");const t=new Date(o.getBirthdate());(e>new Date||e<t)&&(M.value.cd4Date="CD4 date must not exceed today or be earlier than birthdate")},buildObs:()=>x.buildValueDate("Cd4 count datetime",J.cd4Date)},cd4Location:{required:()=>"Yes"===J.cd4Available,dataHandler:e=>J.cd4Location=e.label,searchFacilities:e=>K(e).then((e=>Q.value=e)),buildObs:()=>x.buildValueText("Cd4 count location",J.cd4Location)},staging:{validation:()=>{if(Object.keys(R).every((e=>Ie(e)<=0)))return void(M.value.staging="Please select one or more staging conditions");const e=["stage_4_conditions","stage_3_conditions","stage_2_conditions"].some((e=>Ie(e)>0));R.stage_1_conditions.options.some((e=>/asymptomatic/i.test(e.name)&&e.checked))&&e&&(M.value.staging="Asymptomatic cannot be selected with other staging conditions")},buildObs:()=>Object.keys(R).reduce(((e,t)=>(R[t].options.forEach((t=>{t.checked&&e.push(t.name)})),e)),[]).map((e=>x.buildWhoCriteriaObs(e)))}};function X(e){return e.some((e=>Ie(e)>0))}function ee(){return new Date(J.cd4Date)<=new Date("2016-04-30")}function te(){var e,t,i;return null!==(e=null===(t=`${null!==(i=J.cd4)&&void 0!==i?i:""}`.match(/^([=><]{1})/))||void 0===t?void 0:t[0])&&void 0!==e?e:""}function ie(){var e,t;return parseInt(null!==(e=null===(t=`${J.cd4}`.match(/\d+$/))||void 0===t?void 0:t[0])&&void 0!==e?e:"0")}function oe(){return/^([=><]{1})(\d+)$/i.test(`${J.cd4}`)}function ne(e){if(!oe())return!1;const t=te(),i=ie();return"="===t&&e===i||("<"===t&&i<=e||">"===t&&i>=e)}function we(){return X(["stage_2_conditions","stage_1_conditions"])}function Ce(){return Object.keys(R).reduce(((e,t)=>(R[t].options.forEach((t=>t.checked&&e.push(t.name))),e)),[])}function Te(e){if(M.value[e]="","function"==typeof Z[e].required){if(Z[e].required()&&!J[e])return void(M.value[e]="This field is required")}J[e]&&"function"==typeof Z[e].validation&&Z[e].validation()}function De(){return Object.keys(J).reduce(((e,t)=>{if(t in Z&&J[t]&&"function"==typeof Z[t].buildObs){const i=Z[t].buildObs();return Array.isArray(i)?[...e,...i]:[...e,i]}return e}),[])}function Ie(e){return R[e].options.filter((e=>e.checked)).length}function Ee(e,t){e in Z&&"function"==typeof Z[e].dataHandler&&Z[e].dataHandler(t),Te(e),Object.keys(Z).forEach((e=>function(e){if(Z[e]&&"suggestAvalue"in Z[e]){var t,i;J[e]="";const o=Z[e].suggestAvalue(),n=Object.keys(o).reduce(((e,t)=>{const i=o[t];return"function"==typeof i.condition&&i.condition()?[...e,{value:t,priority:i.priority}]:e}),[]);J[e]=null!==(t=null===(i=n.sort(((e,t)=>e.priority-t.priority)))||void 0===i||null===(i=i[0])||void 0===i?void 0:i.value)&&void 0!==t?t:""}}(e)))}function Se(){Object.keys(R).forEach((e=>{var t,i;const o=Number(null!==(t=null===(i=e.match(/\d+/))||void 0===i?void 0:i[0])&&void 0!==t?t:0),n=x.getStagingConditions(o);R[e].options=n.map((e=>({checked:!1,name:e.name,concept_id:e.concept_id})))}))}function Oe(){return Object.keys(Z).forEach((e=>Te(e))),Object.keys(M.value).every((e=>`${M.value[e]}`.length<=0))}async function Ve(){if(!Oe())return q("Please review form for errors");const e=await Promise.all(De());x.createEncounter().then((()=>x.saveObservationList(e).then((()=>{$("Staging Observations saved!")})).catch((e=>{console.error(e),z("Error has occured while saving observations")})))).catch((()=>z("Unable to save data")))}return s((()=>i.date),(e=>{x.setDate(e),o.date=e,Object.keys(J).forEach((e=>{"boolean"==typeof J[e]?J[e]=!1:Array.isArray(J[e])?J[e]=[]:J[e]=""})),Object.keys(M.value).forEach((e=>M.value[e]="")),Se()})),r((async()=>{await async function(){await x.loadHivConfirmatoryTestType(),J.confirmatoryTest=x.getConfirmatoryTestType(),J.isChildBearing=o.isChildBearing()}(),Se()})),t({validateStagingForm:Oe,submitForm:Ve,buildPayload:De}),(e,t)=>(d(),l(g(F),null,{default:c((()=>[u(g(p),null,{default:c((()=>t[14]||(t[14]=[h("span",{class:"section-header ion-text-left",style:{"margin-bottom":"10px"}},[h("h2",{style:{color:"gray","font-size":"20px","font-weight":"600","margin-left":"10px"}},"HIV Staging"),h("hr",{style:{"border-top":"1px dashed #0c0c0c","margin-top":"10px"}})],-1)]))),_:1,__:[14]}),u(g(y),null,{default:c((()=>[J.isChildBearing?(d(),f("div",se,[u(g(m),null,{default:c((()=>[u(g(b),null,{default:c((()=>[u(g(v),null,{default:c((()=>[u(g(_),{color:"light"},{default:c((()=>[u(g(A),{slot:"start"},{default:c((()=>t[15]||(t[15]=[w("Pregnant?")]))),_:1,__:[15]}),u(g(C),{modelValue:J.pregnant,"onUpdate:modelValue":t[0]||(t[0]=e=>J.pregnant=e),onIonChange:t[1]||(t[1]=e=>Ee("pregnant",e.detail.value)),class:"custom-segment"},{default:c((()=>[u(g(T),{value:"Yes"},{default:c((()=>[u(g(A),null,{default:c((()=>t[16]||(t[16]=[w("Yes")]))),_:1,__:[16]})])),_:1}),u(g(T),{value:"No"},{default:c((()=>[u(g(A),null,{default:c((()=>t[17]||(t[17]=[w("No")]))),_:1,__:[17]})])),_:1})])),_:1},8,["modelValue"])])),_:1}),h("div",re,D(M.value.pregnant),1)])),_:1}),u(g(v),null,{default:c((()=>[u(g(_),{color:"light"},{default:c((()=>[u(g(A),{slot:"start"},{default:c((()=>t[18]||(t[18]=[w("Breastfeeding?")]))),_:1,__:[18]}),u(g(C),{modelValue:J.breastFeeding,"onUpdate:modelValue":t[2]||(t[2]=e=>J.breastFeeding=e),onIonChange:t[3]||(t[3]=e=>Ee("breastFeeding",e.detail.value)),class:"custom-segment"},{default:c((()=>[u(g(T),{value:"Yes"},{default:c((()=>[u(g(A),null,{default:c((()=>t[19]||(t[19]=[w("Yes")]))),_:1,__:[19]})])),_:1}),u(g(T),{value:"No"},{default:c((()=>[u(g(A),null,{default:c((()=>t[20]||(t[20]=[w("No")]))),_:1,__:[20]})])),_:1})])),_:1},8,["modelValue"])])),_:1}),h("div",de,D(M.value.breastFeeding),1)])),_:1})])),_:1})])),_:1})])):I("",!0),h("div",le,[u(g(E),{color:"light"},{default:c((()=>[(d(!0),f(S,null,O(R,((e,i)=>(d(),l(g(V),{key:i},{default:c((()=>[u(g(_),{color:"light",slot:"header"},{default:c((()=>[u(g(A),{style:{color:"grey","font-size":"17px"},class:"ion-padding"},{default:c((()=>[h("b",ce,[w(D(e.title)+" ",1),u(g(H),{color:Ie(`${i}`)>0?"primary":void 0},{default:c((()=>[w(" Selected: "+D(Ie(`${i}`)),1)])),_:2},1032,["color"])]),h("p",ue,D(M.value.staging),1)])),_:2},1024)])),_:2},1024),h("div",ge,[u(g(P),null,{default:c((()=>[(d(!0),f(S,null,O(e.options,((e,o)=>(d(),l(g(_),{key:o},{default:c((()=>[u(g(B),{modelValue:e.checked,"onUpdate:modelValue":t=>e.checked=t,onIonChange:t=>Ee("staging",{stage_type:i,raw:t,option:e})},null,8,["modelValue","onUpdate:modelValue","onIonChange"]),u(g(A),{style:{margin:"13px"}},{default:c((()=>[w(D(e.name),1)])),_:2},1024),t[21]||(t[21]=h("p",null,null,-1)),e.description?(d(),l(g(N),{key:0,color:e.color},{default:c((()=>[w(D(e.text),1)])),_:2},1032,["color"])):I("",!0)])),_:2,__:[21]},1024)))),128))])),_:2},1024)])])),_:2},1024)))),128))])),_:1})]),h("div",pe,[h("div",he,[u(g(_),{color:"light"},{default:c((()=>[u(g(A),{slot:"start"},{default:c((()=>t[22]||(t[22]=[w("Recent CD4 count results available?")]))),_:1,__:[22]}),u(g(C),{modelValue:J.cd4Available,"onUpdate:modelValue":t[4]||(t[4]=e=>J.cd4Available=e),onIonChange:t[5]||(t[5]=e=>Ee("cd4Available",e.detail.value)),class:"custom-segment"},{default:c((()=>[u(g(T),{value:"Yes"},{default:c((()=>[u(g(A),null,{default:c((()=>t[23]||(t[23]=[w("Yes")]))),_:1,__:[23]})])),_:1}),u(g(T),{value:"No"},{default:c((()=>[u(g(A),null,{default:c((()=>t[24]||(t[24]=[w("No")]))),_:1,__:[24]})])),_:1})])),_:1},8,["modelValue"])])),_:1}),h("div",ye,D(M.value.cd4Available),1)]),"Yes"===J.cd4Available?(d(),f("div",fe,[u(g(m),{class:"ion-padding"},{default:c((()=>[u(g(b),null,{default:c((()=>[u(g(v),null,{default:c((()=>[u(g(A),null,{default:c((()=>t[25]||(t[25]=[w(" CD4 Count Date ")]))),_:1,__:[25]}),u(Y,{place_holder:"Enter CD4 Date",onDateUpDated:t[6]||(t[6]=e=>Ee("cd4Date",`${e.value.year}-${e.value.month}-${e.value.day}`)),date_prop:""}),h("div",me,D(M.value.cd4Date),1)])),_:1})])),_:1}),u(g(b),{style:{"margin-top":"15px"}},{default:c((()=>[u(g(v),null,{default:c((()=>[u(g(G),{modelValue:J.cd4,"onUpdate:modelValue":t[7]||(t[7]=e=>J.cd4=e),onIonInput:t[8]||(t[8]=e=>Ee("cd4",e)),placeholder:"CD4 count e.g. <100 or >500","label-placement":"stacked",label:"CD4 Count",fill:"outline"},null,8,["modelValue"]),h("div",be,D(M.value.cd4),1)])),_:1}),u(g(v),null,{default:c((()=>[u(g(W),{modelValue:J.selectedFacilityObj,"onUpdate:modelValue":[t[9]||(t[9]=e=>J.selectedFacilityObj=e),t[10]||(t[10]=e=>Ee("cd4Location",e))],multiple:!1,taggable:!1,"close-on-select":!0,openDirection:"bottom","tag-placeholder":"Find and select facility",placeholder:"Select CD4 Count location",selectLabel:"",label:"label",searchable:!0,"track-by":"label",onSearchChange:t[11]||(t[11]=e=>Z.cd4Location.searchFacilities(e)),options:Q.value},null,8,["modelValue","options"]),h("div",ve,D(M.value.cd4Location),1)])),_:1})])),_:1})])),_:1})])):I("",!0)]),h("div",_e,[u(g(m),null,{default:c((()=>[u(g(b),null,{default:c((()=>[u(g(v),null,{default:c((()=>[u(g(G),{readonly:"",placeholder:"N/A",label:"REASON FOR ART:",modelValue:J.reasonForArt,"onUpdate:modelValue":t[12]||(t[12]=e=>J.reasonForArt=e)},null,8,["modelValue"])])),_:1}),u(g(v),null,{default:c((()=>[u(g(G),{readonly:"",placeholder:"N/A",label:"WHO STAGE:",modelValue:J.whoStage,"onUpdate:modelValue":t[13]||(t[13]=e=>J.whoStage=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})]),e.hideSubmit?I("",!0):(d(),f("div",Ae,[u(g(k),{color:"primary",onClick:Ve},{default:c((()=>t[26]||(t[26]=[w("Submit")]))),_:1,__:[26]})]))])),_:1})])),_:1}))}});t("default",Q(we,[["__scopeId","data-v-719c0805"]]))}}}))}();

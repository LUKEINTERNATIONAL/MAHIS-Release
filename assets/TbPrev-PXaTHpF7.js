import{p as f,d as c,e as g,l as h,a as P}from"./index-DSKp8AKz.js";import{R as v}from"./ReportTable-2qaPR3JH.js";import{A as w}from"./age_groups-BkW1n_F5.js";import{R as A}from"./report_service-BvnM7KJ8.js";import{l as m}from"./lodash-Dt8AsbQm.js";import{d as y,r as b,y as H,f as T}from"./vendor-BEKTmkXc.js";import"./apexcharts-BW0LSm5R.js";import"./chartjs-Cd7EKH6q.js";import"./barcode-qrcode-reader-o0mSiBQi.js";const u=["started_new_on_art","started_previously_on_art","completed_new_on_art","completed_previously_on_art"];class D extends A{constructor(){super()}getTBPrevReport(){return this.getReport("/programs/".concat(this.programId,"/reports/tb_prev2"))}buildReportData(r){const a=[];return["F","M"].forEach(l=>{w.forEach(p=>{const s={gender:l,ageGroup:p};u.forEach(i=>{s["3hp_".concat(i)]=m.get(r[p][l],"3HP.".concat(i),[]),s["6h_".concat(i)]=m.get(r[p][l],"6H.".concat(i),[])}),a.push(s)})}),a}aggregate(r,a,o,l){return Object.values(r).reduce((p,s)=>[...s[a][o][l],...p],[])}getAggregatedMaleData(r){const a={gender:"Male",ageGroup:"All"};for(const o of u)a["3hp_".concat(o)]=this.aggregate(r,"M","3HP",o),a["6h_".concat(o)]=this.aggregate(r,"M","6H",o);return a}async getAggregatedMaternalStatus(r){const a=u.reduce((t,e)=>[...t,{group:"3HP",indicator:e,data:this.aggregate(r,"F","3HP",e)},{group:"6H",indicator:e,data:this.aggregate(r,"F","6H",e)}],[]),o=m.uniq(a.reduce((t,e)=>[...t,...e.data],[]).map(t=>t.patient_id)),l=await this.getMaternalStatus(o),p=l.FBf.concat(l.FP),s=[],i=(t,e,n)=>a.reduce((d,_)=>_.indicator===t&&e===_.group?[...d,..._.data]:d,[]).filter(d=>n==="FNP"?!p.includes(d.patient_id):l[n].includes(d.patient_id));for(const t of["FP","FNP","FBf"]){const e={gender:t,ageGroup:"All"};for(const n of u)e["3hp_".concat(n)]=i(n,"3HP",t),e["6h_".concat(n)]=i(n,"6H",t);s.push(e)}return s}}const O=y({__name:"TbPrev",setup(R){const r=b("-"),a=b([]),o=[{path:"ageGroup",label:"Age group"},{path:"gender",label:"Gender",formatter:c},{path:"3hp_started_new_on_art",label:"3HP Started New on ART",drillable:!0},{path:"6h_started_new_on_art",label:"6H Started New on ART",drillable:!0},{path:"3hp_started_previously_on_art",label:"3HP Started Previously on ART",drillable:!0},{path:"6h_started_previously_on_art",label:"6H Started Previously on ART",drillable:!0},{path:"3hp_completed_new_on_art",label:"3HP Completed New on ART",drillable:!0},{path:"6h_completed_new_on_art",label:"6H Completed New on ART",drillable:!0},{path:"3hp_completed_previously_on_art",label:"3HP Completed Previously on ART",drillable:!0},{path:"6h_completed_previously_on_art",label:"6H Completed Previously on ART",drillable:!0}],l=[{path:"arv_number",label:"ARV Number",preSort:f,initialSort:!0},{path:"gender",label:"Gender",formatter:c},{path:"birthdate",label:"Date of Birth",formatter:g},{path:"art_start_date",label:"ART Start Date",formatter:g},{path:"tpt_initiation_date",label:"TPT Initiation Date",formatter:g},{path:"outcome",label:"Outcome"}];async function p(t){try{await h.show();const e=new D;e.setStartDate(t.dateRange.startDate),e.setEndDate(t.dateRange.endDate),e.setOccupation(t.occupation),r.value=e.getDateIntervalPeriod();const n=await e.getTBPrevReport();a.value=e.buildReportData(n),a.value.push(e.getAggregatedMaleData(n)),a.value.push(...await e.getAggregatedMaternalStatus(n))}catch(e){P("ERROR! Unable to load report data"),console.error(e)}await h.hide()}function s(t){return"".concat(t.column.label," | ").concat(t.row.ageGroup," | ").concat(c(t.row.gender),"s")}function i(t){return t.row[t.column.path].map(e=>({...e,person_id:e.patient_id}))}return(t,e)=>(T(),H(v,{title:"PEPFAR TB Prev Report","report-type":"PEPFAR",columns:o,rows:a.value,period:r.value,"custom-drill-columns":l,"drill-title":s,"drill-row-parser":i,useDateRangeFilter:"",showIndices:"",onGenerate:p},null,8,["rows","period"]))}});export{O as default};

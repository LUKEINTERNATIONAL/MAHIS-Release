!function(){function e(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}System.register(["./index-legacy-BydGqEaO.js","./lodash-legacy-pOOc9Efu.js","./vendor-legacy-DnHM1LDc.js","./sms_service-legacy-Cun7uMg1.js","./EIRreportsStore-legacy-ddwsfLU_.js","./Export-legacy-xubpsWCB.js"],function(t,n){"use strict";var a,i,o,s,r,l,c,d,u,p,m,g,f,v,h,_,y,b,w,D,x,S,A,M,I,$,F,N,J,P,E,k,T,z,O,C,V,j,R,H,L,U,Y,B,q;return{setters:[e=>{a=e.H,i=e.aP,o=e.u,s=e.S,r=e.aH,l=e.N,c=e._,d=e.P,u=e.t,p=e.o,m=e.k,g=e.A,f=e.$,v=e.s,h=e.d},e=>{_=e.l},e=>{y=e.D,b=e.d,w=e.aa,D=e.M,x=e.ab,S=e.a1,A=e.a9,M=e.Q,I=e.H,$=e.e,F=e.f,N=e.l,J=e.k,P=e.J,E=e.P,k=e.F,T=e.r,z=e.a,O=e.N,C=e.m,V=e.u,j=e.b1,R=e.K,H=e.bj},e=>{L=e.S},e=>{U=e.E},e=>{Y=e.u,B=e.F,q=e.e}],execute:function(){var n=document.createElement("style");n.textContent=".saveBtn[data-v-2bafd924]{display:flex;justify-content:space-between;margin:20px;align-items:center}ion-row.centered-content[data-v-2bafd924]{display:flex;justify-content:center;align-items:center;border-radius:10px}.text-container[data-v-2bafd924]{text-align:center;padding:20px}.text-container div[data-v-2bafd924]{margin-bottom:10px;font-family:Arial,sans-serif;color:#333}.text-container div[data-v-2bafd924]:last-child{margin-bottom:0}.ilbl[data-v-6ee82e0c]{font-size:23px}.calender[data-v-6ee82e0c]{--dp-cell-padding: 30px;--dp-menu-padding: 20px 5px;--dp-font-size: 18px}.card_content[data-v-6ee82e0c]{width:100%}.dp__flex_display[data-v-6ee82e0c]{display:inherit}.toggle-green[data-v-6ee82e0c]{--toggle-bg-on: #006401;--toggle-border-on: #006401;--toggle-width: 6.3rem;--toggle-height: 1.9rem;--toggle-border: .525rem;--toggle-font-size: 1rem;margin-bottom:30px}.lbl-tl[data-v-6ee82e0c]{min-width:20px;color:#b3b3b3!important;white-space:nowrap}.lbl-ct[data-v-6ee82e0c]{white-space:nowrap;color:#08475e;font-size:14px}.btnText[data-v-6ee82e0c]{font-style:normal;font-weight:500;font-size:14px}\n/*$vite$:1*/",document.head.appendChild(n),t({b:async function(){return await s.getJson("immunization/months_picker")},c:async function(){return await s.getJson("/immunization/vaccine_names")},d:async function(e,t){return await s.getJson("immunization/vaccines_administered",{start_date:e,end_date:t})},e:function(){try{const e=U(),t=f(),{activePlatformProfile:n}=Y();let a=function(e){let t="Category,Static <1y,Static >1y,Outreach <1y,Outreach >1y\n";for(const n of e){t+=[de(n.label),n.fixed.lessThan1y,n.fixed.moreThan1y,n.outreach.lessThan1y,n.outreach.moreThan1y].join(",")+"\n"}return t}(e.$state.immunizationMonthlyRepoartData);a+="\n",a+=function(e){let t="Cases,"+e.vaccines.map(e=>de(e.name)).join(",")+"\n";for(const n of e.categories){t+=de(n.name)+"\n";for(const e of n.cases){t+=[de(e.name),...e.data.map(e=>e.count)].join(",")+"\n"}}return t}(e.$state.AEFIReportData),a+="\n",a+=`\n        Date Created: ${(new Date).toISOString().split("T")[0]}\n        Report Period: ${e.$state.navigationPayload.subTxt}\n        Site: ${t.$state.userFacilityName}`;const i=new Blob([a],{type:"text/csv;charset=utf-8;"}),o=`${t.$state.userFacilityName}_${e.$state.navigationPayload.subTxt}_${e.$state.navigationPayload.title}`;if(n.value.fileExport===B.WEB){const e=document.createElement("a");e.href=window.URL.createObjectURL(i),e.setAttribute("download",`${o}.csv`),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}else n.value.fileExport===B.FILE_SYSTEM?q(`${o}.csv`,i,"blob"):u("Platform not supported")}catch(e){console.error("Error exporting CSV:",e)}},f:async function(){return await s.getJson("immunization/under_five_immunizations_drugs")},g:async function(e,t){const n=await async function(e){try{let t;if(t=s.getUseIndexDBStatus()&&s.getModsStatus()?await v("genericVaccineSchedule"):await s.getJson("eir/schedule/generic",{paginate:!1}),t.length>0){if("M"==e)return t[0].genericVaccineSchedule.male_schedule;if("F"==e)return t[0].genericVaccineSchedule.female_schedule}else if(h().apiStatus){if(t=await s.getJson("eir/schedule/generic",{paginate:!1}),"M"==e)return t.male_schedule;if("F"==e)return t.female_schedule}}catch(t){return console.error("Error getting offline generic vaccine schedule",t),[]}}(e);return await async function(e,t){const n=new Date;return t.forEach(t=>{const a=t.age.toLowerCase();let i=null;if("at birth"===a)i=new Date(e);else if(a.includes("weeks")){const t=parseInt(a.split(" ")[0],10);i=new Date(e),i.setDate(e.getDate()+7*t)}else if(a.includes("months")){const t=parseInt(a.split(" ")[0],10);i=new Date(e),i.setMonth(e.getMonth()+t)}else if(a.includes("years")){const t=parseInt(a.split(" ")[0],10);i=new Date(e),i.setFullYear(e.getFullYear()+t)}i?i>n?t.milestone_status="upcoming":i.toDateString()===n.toDateString()?t.milestone_status="current":t.milestone_status="passed":t.milestone_status="unknown"}),{vaccine_schedule:t}}(new Date(t),n)},h:async function(e,t){return await s.getJson("immunization/aefi_report",{start_date:e,end_date:t})},i:function(e){return 1==function(e){const t=["Vit","Albendazole"],n=e.toLowerCase().split(/[\s,()]+/);return t.some(e=>e.toLowerCase().split(/[\s,()]+/).some(e=>n.some(t=>t.includes(e)||e.includes(t))))}(e.drug_name)},j:async function(e,t,n){const a=JSON.parse(JSON.stringify(e));let i=null==a?void 0:a.vaccineAdministration;i.orders.some(e=>e.drug_name===t.drug.drug_name)?(i.orders=i.orders.filter(e=>e.drug_name!==t.drug.drug_name),i.obs=i.obs.filter(e=>e.value_text!==t.drug.drug_name)):i.voided=[...null==i?void 0:i.voided,{reason:n,order_id:t.drug.order_id,drug_name:t.drug.drug_name}];le(a,t.drug.drug_name,"pending",""),await r(a)},s:async function(e){const t=JSON.parse(JSON.stringify(e)),n=m();if(!_.isEmpty(n.getAdministeredVaccines())){var a,i;const e=function(){const e=m();return e.getAdministeredVaccines().map(e=>{var t,n;return{drug_name:(null==e||null===(t=e.drug_)||void 0===t||null===(t=t.drug)||void 0===t?void 0:t.drug_name)||(null==e||null===(n=e.drug_)||void 0===n?void 0:n.drug_name),drug_inventory_id:e.drug_id,equivalent_daily_dose:1,start_date:e.date_administered,auto_expire_date:ce(e.date_administered,1),units:"ml",instructions:"",dose:1,frequency:"Unknown",batch_number:e.batch_number||"Unknown",prn:0}})}(),o=await async function(){const e=m(),t=e.getAdministeredVaccines();return await Promise.all(t.map(async e=>{var t,n;return{concept_id:2876,value_text:(null==e||null===(t=e.drug_)||void 0===t||null===(t=t.drug)||void 0===t?void 0:t.drug_name)||(null==e||null===(n=e.drug_)||void 0===n?void 0:n.drug_name),obs_datetime:e.date_administered}}))}();let s=null==t?void 0:t.vaccineAdministration;s.orders=[...null==s?void 0:s.orders,...e],s.voided=s.voided.filter(t=>{var n;return t.drug_name!==(null===(n=e[0])||void 0===n?void 0:n.drug_name)}),s.obs=[...null==s?void 0:s.obs,...o],n.setVaccineReload(!n.getVaccineReload()),s.orders.length>0&&n.setLastVaccineAdminstredOnschedule(s.orders),le(t,null===(a=e[0])||void 0===a?void 0:a.drug_name,"administered",null===(i=o[0])||void 0===i?void 0:i.obs_datetime),await r(t),l("Saved successful"),await async function(e){const t=m(),n=t.getLastVaccineAdminstredOnschedule();var a;n.length>0&&(null==e||null===(a=e.vaccineSchedule)||void 0===a||null===(a=a.vaccine_schedule)||void 0===a||a.forEach(e=>{1==e.antigens.every(e=>"administered"===e.status)&&e.antigens.forEach(e=>{e.drug_id==n[0].drug_inventory_id&&p(re,{class:"otherVitalsModal"},!1)})}));t.setLastVaccineAdminstredOnschedule([])}(t)}},v:async function(e,t){return s.void(`/encounters/${e}`,{reason:t})}});const Z=t("u",y("immunizationAppointMentStore",{state:()=>({selectedAppointmentMent:[],selectedAppointmentMentForAppointmentsPage:"",AppointmentsReload:!1,startDate:a.sessionDate(),endDate:a.sessionDate()}),actions:{getAppointmentMents(){return this.selectedAppointmentMent},setAppointmentMent(e){this.selectedAppointmentMent.length=0,this.selectedAppointmentMent.push(e)},clearAppointmentMent(){this.selectedAppointmentMent.length=0},getSelectedAppointmentMentForAppointmentsPage(){return this.selectedAppointmentMentForAppointmentsPage},setSelectedAppointmentMentForAppointmentsPage(e){this.selectedAppointmentMentForAppointmentsPage=e},setAppointmentsReload(e){this.AppointmentsReload=e},getAppointmentsReload(){return this.AppointmentsReload},setStartEndDate(e,t){this.startDate=e,this.endDate=t},getStartEndDate(){return{startDate:this.startDate,endDate:this.endDate}}}}));class W extends i{constructor(t){const n=void 0!==t?t:W.getPatientID(),a=W.getProviderID();super(n,7,a),e(this,"patientID",void 0),e(this,"providerID",void 0),this.patientID=n,this.providerID=a}static getPatientID(){return o().patient.patientID}static getProviderID(){return s.getUserID()}async setPatientID(e){this.patientID=e}async createAppointment(e){var t;let n=JSON.parse(JSON.stringify(e));const i=[];Z().selectedAppointmentMent.forEach(e=>{const t=a.toStandardHisFormat(e.date);i.push(t)});const o=await this.buildValueDate("Appointment date",i[0]);return null==n||null===(t=n.appointments.unsaved)||void 0===t||t.push(o),await r(n),l("next Appointment Set Successfully"),i[0]}async getNextAppointment(){if(this.programID&&this.patientID)return i.getJson(`/programs/${this.programID}/patients/${this.patientID}/next_appointment_date`,{date:this.date})}async getDailyAppointments(e){const t=i.getProgramID();return i.getJson(`/programs/${t}/booked_appointments`,{date:e,paginate:!1})}}t("A",W);const G=b({components:{IonRow:A,IonItem:S,IonList:x,IonButton:D,IonCol:w},props:{date:{type:String,required:!0},patient:{type:Number,required:!0},modalaction:{type:String,required:!0}},data(){return{formattedDate:a.toStandardHisFormat(this.date)}},methods:{async dismissModal(){await M.dismiss()},async sendSMS(){await M.dismiss("send-SMS")}}}),K={class:"saveBtn"};const Q=t("a",c(G,[["render",function(e,t,n,a,i,o){const s=I("ion-row"),r=I("ion-button"),l=I("ion-col");return F(),$(k,null,[N(s,{class:"centered-content"},{default:P(()=>t[0]||(t[0]=[J("div",{class:"text-container"},[J("div",null,"Do you want to send SMS reminder?")],-1)])),_:1,__:[0]}),J("div",K,[N(s,null,{default:P(()=>[N(l,null,{default:P(()=>[N(r,{onClick:e.dismissModal,id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"}},{default:P(()=>t[1]||(t[1]=[E(" No ",-1)])),_:1,__:[1]},8,["onClick"])]),_:1}),N(l,null,{default:P(()=>[N(r,{onClick:e.sendSMS,class:"btnText",fill:"solid",style:{width:"130px","text-align":"right"}},{default:P(()=>t[2]||(t[2]=[E(" Yes ",-1)])),_:1,__:[2]},8,["onClick"])]),_:1})]),_:1})])],64)}],["__scopeId","data-v-2bafd924"]])),X={class:"lbl-ct"},ee={class:"lbl-ct"},te={style:{"margin-right":"20px",color:"black"}},ne={key:0},ae={style:{color:"#999"}},ie={style:{"font-size":"16px",color:"#666","margin-top":"5px"}},oe=b({watch:{},name:"xxxComponent"}),se=b({...oe,props:{patient_Id:{},encounter_Id:{}},setup(e){const t=o(),n=T(),i=T(),l=T(!1),c=T(!1),f=a.toStandardHisDisplayFormat(s.getSessionDate()),v=T(!1),h=T(),_=T(0),y=T([]),b=[];function x(e){const t=new Date(s.getSessionDate());return t.setHours(0,0,0,0),e<t}const S=e;async function U(){if(Z().selectedAppointmentMent.length>0)try{await async function(){var e,n;const a=JSON.parse(JSON.stringify(t.patient.guardianInformation)),i=[...null==a?void 0:a.unsaved,...null==a?void 0:a.saved];i.length>0&&null!==(e=i[0])&&void 0!==e&&e.cell_phone_number&&y.value.push(null===(n=i[0])||void 0===n?void 0:n.cell_phone_number);t.patient.personInformation.cell_phone_number&&y.value.push(t.patient.personInformation.cell_phone_number)}();const e=new W,n=await e.createAppointment(t.patient);await async function(){const e=m();e.setVaccineReload(!e.getVaccineReload())}(),await async function(){const e=Z();e.setAppointmentsReload(!e.getAppointmentsReload())}(),await B(),async function(e){if(0==y.value.length)return void u("No phone numbers available for sms reminder!");if(e){if("send-SMS"==await p(Q,{class:"nationalIDModal"})){const n=JSON.parse(JSON.stringify(t.patient));n.sms={appointment_date:e},await r(n)}}}(n)}catch(e){}else u("please select next appointment date on the calendar")}function Y(e,t){const n=e.getFullYear(),a=e.getMonth(),i=e.getDate(),o=t.getFullYear(),s=t.getMonth(),r=t.getDate();return n!==o?n>o:a!==s?a>s:i>r}async function B(){try{await M.dismiss()}catch(e){console.error("Modal dismissal error:",e)}}async function q(e){const t={counter:1,date:e};Z().setAppointmentMent(t),v.value=!1,await async function(e){try{const t=await g.getDailyAppointments(a.toStandardHisFormat(e),a.toStandardHisFormat(e));_.value=t.length}catch(t){}}(e),v.value=!0,h.value=a.toStandardHisDisplayFormat(e)}function G(e){const t=Z().getAppointmentMents(),n=e=>{const t=new Date(e);return t.setHours(0,0,0,0),t.getTime()},a=n(new Date(e)),i=t.find(e=>n(new Date(e.date))===a);return i?i.counter:null}function K(e){const t=e.match(/(\d+)\s*(week|month|year)s?/i);if(!t)return"Invalid input format";const n=parseInt(t[1]);switch(t[2].toLowerCase()){case"week":return 7*n;case"month":return 30*n;case"year":return 365*n;default:return"Invalid time unit"}}function oe(e,t){if("Invalid input format"==t)return"";let n;if(e instanceof Date)n=new Date(e);else{const[t,a]=e.split(" "),[i,o,s]=t.split("/"),[r,l,c]=a.split(":"),d={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};n=new Date(Number(s),d[o],Number(i),Number(r),Number(l),Number(c))}n.setDate(n.getDate()+t);const a=e=>String(e).padStart(2,"0"),i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n.getDay()],o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()],s=a(n.getDate()),r=n.getFullYear(),l=a(n.getHours()),c=a(n.getMinutes()),d=a(n.getSeconds()),u=-n.getTimezoneOffset(),p=Math.floor(Math.abs(u)/60),m=Math.abs(u)%60,g=`GMT${u>=0?"+":"-"}${a(p)}${a(m)}`,f=Intl.DateTimeFormat().resolvedOptions().timeZone;let v;try{const e=new Intl.DateTimeFormat("en",{timeZone:f,timeZoneName:"long"}).formatToParts(n).find(e=>"timeZoneName"===e.type);v=e?e.value:f}catch(h){console.error("Error getting localized time zone name:",h),v=f}return`Date ${i} ${o} ${s} ${r} ${l}:${c}:${d} ${g} (${v})`}return z(async()=>{Z().clearAppointmentMent(),await async function(){try{let e=await L.getConfigurations();c.value=e.show_sms_popup}catch(e){}}(),await async function(){try{const e=new d,o=(void 0!==S.patient_Id?S.patient_Id:e.getID(),await async function(){try{const e=t.patient.vaccineSchedule;e.vaccine_schedule.forEach(e=>{e.antigens.forEach(t=>{"administered"==t.status&&b.push({age:e.age,vaccine:t})})});for(const t of e.vaccine_schedule){if("current"===t.milestone_status)return t;if("upcoming"===t.milestone_status)return t}return null}catch(e){return null}}());if(b.length>0){const e=b[b.length-1];0==await async function(e){try{const n=oe(new Date(t.patient.personInformation.birthdate),K(e.age)),a=function(e){const t={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},n=e.split(/[:/ ]/),a=`${n[2]}-${t[n[1]]}-${n[0]}T${n[3]}:${n[4]}:${n[5]}`;return new Date(a)}(e.vaccine.date_administered),i=new Date(n);return console.log(Y(a,i)),Y(a,i)}catch(n){}}(e)&&(n.value=oe(e.vaccine.date_administered,K(o.age)),i.value=a.toStandardHisDisplayFormat(n.value),q(n.value),G(n.value),l.value=!0)}}catch(e){}}()}),(e,t)=>{const a=I("VueDatePicker");return F(),$(k,null,[N(V(A),{style:{"margin-top":"10px"}},{default:P(()=>[N(V(w),{style:{"margin-left":"-3px"}},{default:P(()=>t[1]||(t[1]=[J("div",{class:"om",style:{"font-weight":"600",color:"#8d8686"}},"Set Next Appointment Date",-1)])),_:1,__:[1]}),N(V(w),{size:"6",style:{"text-align":"right"}},{default:P(()=>[N(V(j),{class:"lbl-tl",style:{"font-size":"13"}},{default:P(()=>[t[2]||(t[2]=E(" Todays Date: ",-1)),J("span",X,R(V(f)),1)]),_:1,__:[2]})]),_:1})]),_:1}),N(V(A),{style:{"margin-top":"10px"}},{default:P(()=>[N(V(w),{style:{"margin-left":"-3px"}},{default:P(()=>t[3]||(t[3]=[J("div",{class:"om"},null,-1)])),_:1,__:[3]}),v.value?(F(),O(V(w),{key:0,size:"10",style:{"text-align":"right"}},{default:P(()=>[N(V(j),{class:"lbl-tl",style:{"font-size":"16","font-weight":"500"}},{default:P(()=>[t[4]||(t[4]=E(" Total Appointments ",-1)),J("span",ee,"("+R(h.value)+")",1),t[5]||(t[5]=E(": ",-1)),J("span",te,[N(V(H),{color:"primary",style:{"margin-bottom":"-5px","font-size":"15px"}},{default:P(()=>[E(R(_.value),1)]),_:1})])]),_:1,__:[4,5]})]),_:1})):C("",!0)]),_:1}),N(V(A),{style:{"margin-top":"20px"}},{default:P(()=>[N(V(w),null,{default:P(()=>[N(a,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),onDateUpdate:q,"enable-time-picker":!1,inline:"","auto-apply":"","disabled-dates":x},{day:P(({day:e,date:t})=>[(F(),$("p",ne,[E(R(e),1),J("sup",ae,R(G(t)),1)]))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l.value?(F(),O(V(A),{key:0,style:{"margin-top":"0px","margin-bottom":"0px"}},{default:P(()=>[N(V(w),{style:{"background-color":"#f0f0f0",padding:"15px","border-radius":"8px","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)"}},{default:P(()=>[t[6]||(t[6]=J("div",{style:{"font-size":"17px",color:"#333","font-weight":"bold"}},"Suggested Date:",-1)),J("div",ie,R(i.value),1)]),_:1,__:[6]})]),_:1})):C("",!0),N(V(A),{style:{"margin-top":"10px","margin-bottom":"10px"}},{default:P(()=>[N(V(w),null,{default:P(()=>[N(V(D),{onClick:B,id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"}},{default:P(()=>t[7]||(t[7]=[E(" Cancel ",-1)])),_:1,__:[7]})]),_:1}),N(V(w),{style:{"text-align":"right"}},{default:P(()=>[N(V(D),{onClick:U,class:"btnText",fill:"solid",style:{width:"130px"}},{default:P(()=>t[8]||(t[8]=[E(" save ",-1)])),_:1,__:[8]})]),_:1})]),_:1})],64)}}}),re=t("n",c(se,[["__scopeId","data-v-6ee82e0c"]]));function le(e,t,n,a){e.vaccineSchedule.vaccine_schedule.forEach(e=>{e.antigens.forEach(e=>{e.drug_name===t&&(e.status=n,e.date_administered=a)})})}function ce(e,t){const n=new Date(e);return n.setDate(n.getDate()+parseInt(t)),a.toStandardHisFormat(n)}function de(e){return/[,"\n]/.test(e)?`"${e.replace(/"/g,'""')}"`:e}}}})}();

System.register(["./vendor-legacy-D4us1wnI.js","./useFormWizard-legacy-Wy_ztH2C.js","./index-legacy-47dDaEp_.js","./DemographicBar-legacy-DtSNLnFP.js","./OPDOutcome-legacy-9o34VWDZ.js","./NextAppointment-legacy-BUZi8Kqw.js","./OPDPrintingModal-legacy-CY0g-2pA.js","./lodash-legacy-pOOc9Efu.js","./usePatientProfile-legacy-BjrkkVDX.js","./apexcharts-legacy-CYvvWelx.js","./patient_complaints_service-legacy-B0CI2dLM.js","./DashBox-legacy-BdNp5PVJ.js","./useExposeFromStandardForm-legacy-B49OVkOn.js","./BasicForm-legacy-CnVmo2n9.js","./DateInputField-legacy-BBBmGl_A.js","./formatServerData-legacy-CiZWZB6M.js","./drug_prescription_service-legacy-B6z3qQaZ.js","./drug_service-legacy-DGABtLx5.js","./Outcome-legacy-DSagrgPm.js","./lab_order-legacy-B8iBZt-l.js","./group_validation-legacy-BEz-Gzg8.js","./ncd_appointment_service-legacy-B3fAnd9e.js","./Registration-legacy-JvoV2V-s.js","./useLocation-legacy-Brxcf7RX.js","./vaccines_service-legacy-CZVmDkki.js","./sms_service-legacy-CiGVI79c.js","./EIRreportsStore-legacy-BJuBgieg.js","./Export-legacy-B-cdEUmJ.js"],function(e,a){"use strict";var t,n,l,i,s,o,u,r,c,d,v,m,g,p,f,y,h,b,w,P,x,D,_,O,j,I,A,S,T,N,C,k,F,E,L,R,B,z,H,M,U,$,G,J,V,W,Y,Z,K,Q,X,q,ee,ae,te,ne,le,ie,se,oe,ue,re,ce,de,ve;return{setters:[e=>{t=e.d,n=e.ar,l=e.cm,i=e.r,s=e.a$,o=e.c,u=e.a,r=e.w,c=e.y,d=e.f,v=e.z,m=e.l,g=e.e,p=e.m,f=e.k,y=e.u,h=e.bN,b=e.d6,w=e.ah,P=e.i,x=e.bG,D=e.v,_=e.an,O=e.dJ,j=e.bg},e=>{I=e.u,A=e._},e=>{S=e.u,T=e.aC,N=e.aP,C=e.a3,k=e.c,F=e.aE,E=e.O,L=e.a4,R=e.aQ,B=e.aR,z=e.aI,H=e.T,M=e.D,U=e.t,$=e.l,G=e.k,J=e.ab,V=e.E,W=e.H,Y=e.aF,Z=e.aA,K=e.aS,Q=e.p,X=e._},e=>{q=e.D},e=>{ee=e.C,ae=e.O,te=e.a,ne=e.b},e=>{le=e.I,ie=e.N,se=e.S,oe=e.a,ue=e.d,re=e.b},e=>{ce=e.O},e=>{de=e.l},e=>{ve=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".disabled[data-v-3ff27d7f]{color:red}.spinner-overlay[data-v-3ff27d7f]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-3ff27d7f]{width:80px;height:80px}.loading-text[data-v-3ff27d7f]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-3ff27d7f]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-3ff27d7f]{pointer-events:none}.back_profile[data-v-3ff27d7f]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(a);const me={key:0,class:"spinner-overlay"},ge={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},pe={class:"back_profile"};e("default",X(t({__name:"ConsultationPlan",setup(e){const{currentTabIndex:a}=I("Consultation Plan"),{printVisitSummary:t}=ve(),X=n(),fe=l(),ye=i(!1),he=i(!0),be=i(!1),we=i(!1),Pe=i(!0),xe=i(!1),De=i(!1),_e=i(!1),Oe=S(),je=T(),Ie=N(),Ae=C(),Se=k(),Te=F(),Ne=E(),Ce=L(),ke=R(),Fe=B(),{patient:Ee}=s(Oe),{investigations:Le}=s(je),{OPDdiagnosis:Re}=s(Ie),{selectedMedicalDrugsList:Be,nonPharmalogicalTherapyAndOtherNotes:ze}=s(Ae),{OPDActivities:He}=s(Se),{outcomes:Me}=s(Te),{currentSelectedNextAppointmentDate:Ue}=s(ke),{presentingComplaints:$e}=s(Fe),{vitals:Ge}=s(Ce),Je=z();o(()=>Je.selectedMedicalAllergiesList);const Ve=i(null),We=i(null),Ye=i(null),Ze=i(null),Ke=i(null),Qe=i(null),Xe=i(null),qe=i(),ea=i({}),aa=async(e,t,n)=>{0===t&&await ua(),await ia()?(await sa(),e%1==0&&(a.value=e),Xe.value&&n&&Xe.value.changeTab(e)):U("Please add presenting complaints before proceeding.")},ta=()=>{var e;if(!qe.value||0===qe.value.length)return null;const t=a.value>=0&&a.value<qe.value.length?a.value:0;switch(null===(e=qe.value[t])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(He.value.length>0)switch(He.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},na=async()=>{we.value=!0,$("Printing consultation summary... Please wait.");try{await t(),$("Consultation summary printed successfully!"),setTimeout(()=>{X.push("home")},3500)}catch(e){G("Failed to print consultation summary.")}finally{we.value=!1}},la=()=>{$("Patient has finished consultation!"),X.push("home")},ia=async()=>{const e=await J.getObsByEncounterIdAndDate(V.PRESENTING_COMPLAINTS);return!!(e&&e.length>0)},sa=async()=>{const e=W.sessionDate();for(let t=0;t<qe.value.length;t++)if(await ia()){he.value=!0,be.value=!1;const n=qe.value[t];if(ea.value={title:"Untitled"},"Clinical Assessment"===n.title){const a=Y("presentingComplaints");qe.value[t].icon=oa(e,a)?j:""}else if("Investigations"===n.title){var a;const n=null===(a=Ee.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,l=null==n?void 0:n.filter(a=>W.toStandardHisFormat(e)===W.toStandardHisFormat(a.order_date));qe.value[t].icon=(null==l?void 0:l.length)>0?j:""}else if("Diagnosis"===n.title){const a=Y("diagnosis");qe.value[t].icon=oa(e,a)?j:""}else if("Treatment Plan"===n.title){const e=Y("treatment");qe.value[t].icon=(null==e?void 0:e.length)>0?j:""}else if("Next Appointment"===n.title){const a=Y("appointments");qe.value[t].icon=oa(e,a)?j:""}else if("Outcome"===n.title){const e=Y("outcomes");qe.value[t].icon=(null==e?void 0:e.length)>0?j:""}}else he.value=!1,"Clinical Assessment"!==qe.value[t].title&&(qe.value[t].icon=O)},oa=(e,a)=>{if(!a)return!1;const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime||e.order_date);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},ua=async()=>{ye.value=!0;try{var e;await Promise.all([null===(e=Ve.value)||void 0===e?void 0:e.onSubmit()]),await Z(Ee.value),K()}catch(a){throw console.error("Error saving clinical assessment:",a),G("Failed to save clinical assessment"),a}finally{ye.value=!1}},ra=async()=>{try{var e;null!==(e=Ye.value)&&void 0!==e&&e.onSubmit(),await(async()=>{try{if(!de.isEmpty(ze.value)){const e=[{concept_id:2688,obs_datetime:localStorage.getItem("sessionDate"),value_text:ze.value,location_id:Ne.facilityLocation.code}];await oe(e)}await ue(),await re().saveNonPharmaTherapyPatientData()}catch(e){console.error("Failed to save treatment plan:",e),U("Failed to save treatment plan")}})(),await Te.saveOutcomPatientData(),await K(),await Z(Ee.value);const a=localStorage.getItem("locationID"),t=localStorage.getItem("userRoles");if(!a)return void G("Location ID could not be found. Please check your settings.");const n=t?JSON.parse(t):[];n.some(e=>"Lab"===e.role)?(await se.movePatientToNextStage(Ee.value.patientID,"LAB","CONSULTATION",a,Ee.value.visitID||Ee.value.visit_id),await Q().refresh(a),await X.push("home"),$("Lab results submitted. Patient can return to consultation")):(await se.movePatientToNextStage(Ee.value.patientID,"CONSULTATION","DISPENSATION",a,Ee.value.visitID||Ee.value.visit_id),await Q().refresh(a),await X.push("home"),$("Consultation patient saved successfully."))}catch(a){console.error("Error saving consultation data:",a),G("Failed to save consultation data")}};return u(async()=>{0!==He.value.length?(qe.value=He.value.map(e=>({title:e,icon:""})),await sa(),(void 0===a.value||a.value<0)&&(a.value=0)):await X.push("home")}),r(Ge,async()=>{await sa()},{deep:!0}),r(Ee,async()=>{await sa()},{deep:!0}),r(Le,async()=>{await sa()},{deep:!0}),r(Re,async()=>{await sa()},{deep:!0}),r(Be,async()=>{await sa()},{deep:!0}),r(Me,async()=>{await sa()},{deep:!0}),r(Ue,async()=>{await sa()}),r($e,async()=>{await sa()},{deep:!0}),r(fe,async()=>{Pe.value=!1,setTimeout(()=>{a.value=0,Pe.value=!0},0)},{deep:!0}),r(_e,e=>{De.value=e,De.value&&setTimeout(()=>{De.value=!1},15e3)}),(e,a)=>(d(),c(y(_),null,{default:v(()=>[m(ce,{onYes:na,onNo:la,isOpen:xe.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),ye.value?(d(),g("div",me,[m(y(h),{name:"bubbles"}),a[2]||(a[2]=f("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),m(y(b),{"is-open":we.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),m(H),m(y(w),{fullscreen:!0},{default:v(()=>[m(q),f("div",ge,[Pe.value?(d(),c(A,{key:0,ref_key:"wizard",ref:Xe,"vertical-tabs":"","navigable-tabs":he.value,"scrollable-tabs":"",startIndex:0,doneButton:{text:"Finish",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},nextButton:{disabled:be.value},"custom-tabs":qe.value,tabs:qe.value,onChange:aa,"onComplete:wizard":a[1]||(a[1]=e=>ra())},{default:v(()=>[f("div",null,[f("div",pe,[m(M,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:y(x),"font-weight":"600",onClick:a[0]||(a[0]=e=>{X.push("home")})},null,8,["icon"])])]),P(f("div",null,[m(ee,{ref_key:"clinicalAssessmentRef",ref:Ve},null,512)],512),[[D,"ClinicalAssessment"===ta()]]),P(f("div",null,[m(le,{ref_key:"investigationsRef",ref:We},null,512)],512),[[D,"Investigations"===ta()]]),P(f("div",null,[m(ae,{ref_key:"diagnosisRef",ref:Ye},null,512)],512),[[D,"OPDDiagnosis"===ta()]]),P(f("div",null,[m(te,{ref_key:"treatmentPlanRef",ref:Ze},null,512)],512),[[D,"OPDTreatmentPlan"===ta()]]),P(f("div",null,[m(ie,{ref_key:"nextAppointmentRef",ref:Ke},null,512)],512),[[D,"NextAppointment"===ta()]]),P(f("div",null,[m(ne,{ref_key:"outcomeRef",ref:Qe},null,512)],512),[[D,"Outcome"===ta()]])]),_:1},8,["navigable-tabs","nextButton","custom-tabs","tabs"])):p("",!0)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-3ff27d7f"]]))}}});

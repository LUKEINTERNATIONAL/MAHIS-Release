!function(){function t(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}System.register(["./vendor-legacy-1abea43d.js","./index-legacy-e977a0fb.js","./lodash-legacy-78c9f2a0.js"],(function(e,r){"use strict";var n,a,s,i,o,u,l,c,d,f,p,m,h,g,y,b,D,w,v,$,P,M,Y,B,j,F,Q,_,A,q,I,S,V,x,O,C,R;return{setters:[t=>{n=t.dK,a=t.r,s=t.c,i=t.eq,o=t.bU,u=t.bV,l=t.N,c=t.er,d=t.dL,f=t.X,p=t.d,m=t.e,h=t.y,g=t.z,y=t.l,b=t.x,D=t.U,w=t.R,v=t.b2,$=t.V,P=t.I,M=t.aQ,Y=t.S,B=t.A,j=t.B,F=t.aa,Q=t.es,_=t.b6,A=t.et},t=>{q=t.p,I=t.q,S=t.r,V=t.m,x=t.v,O=t._,C=t.w},t=>{R=t.l}],execute:function(){var r=document.createElement("style");r.textContent=".close-button[data-v-dd3e8006]{float:right;margin-top:0;padding-top:0;font-size:x-large;cursor:pointer}\n",document.head.appendChild(r),e({a:function(t,e=3e3){return async function(t,e,r){const n=await d.create({message:t,position:"top",animated:!0,duration:r,color:e,cssClass:"his-md-text",keyboardClose:!0,buttons:[{side:"end",text:"x",role:"cancel"}]});return n.present()}(t,"warning",e)},b:at,c:function(t,e,r){return{label:"CSV",color:"primary",action:async(n,a,s,i)=>{et({rows:a,filters:s,columns:i,quarter:e,period:r,filename:t})}}},d:function(t,e,r,n){return{label:"PDF",color:"primary",action:async(a,s,l,c)=>{let d=e&&await S("PDF may contain private data that will require a password to unlock, To access private data choose Secure PDF over Regular PDF",{header:"Security warning",confirmBtnLabel:"Secure PDF",cancelBtnLabel:"Regular PDF"});!function(t){const{filename:e,canHorizontalPageBreak:r,columns:n,rows:a,filters:s,safeMode:l}=t,c=[X(n,l)],d=Z(n,i(a,(null==s?void 0:s.sort)||[]),l),f=l?function(){const t=V().getUser().username;return{encryption:{userPassword:t,ownerPassword:t,userPermissions:["print"]}}}():{},p=new o({...f}),m=p.splitTextToSize(U(e),180),h=m.length<=1?20:10*m.length;p.text(m,14,10);const g={startY:h,head:c,body:d};r&&(g.tableWidth="wrap",g.horizontalPageBreak=!0,g.horizontalPageBreakRepeat=0);u(p,g);const y=`${e}.pdf`;p.save(y)}({rows:s,filters:l,columns:c,quarter:r,period:n,filename:t,safeMode:d})}}},e:et,f:st,g:function(t=5){const e=[];let r=l();for(let n=0;n<t;n++)e.push({start:r.startOf("quarter").format("YYYY-MM-DD"),end:r.endOf("quarter").format("YYYY-MM-DD"),name:`Q${r.quarter()} ${r.year()}`}),r=r.subtract(1,"quarter");return e},h:function(t,e=l()){return e.diff(t,"years")},i:function(t,e){return l(t).isBefore(e)||l(t).isSame(e)},p:function(t){return parseInt(t.split("-")[2])||1/0},s:U,t:function(t){const e=`${t}`.toUpperCase();if("M"===e||"MALE"===e)return"Male";if("F"===e||"FEMALE"===e)return"Female";if(/fbf|fnp|fp/i.test(t))return e;return t}});e("l",{show:async t=>(await n.create({message:t||"Loading...",spinner:"crescent",translucent:!0})).present(),async hide(){n.getTop().then((t=>t?n.dismiss():null))}});function U(t){return t.replace(/<(?:.|\n)*?>/gm," ").replace(/(\r\n|\n|\r|\t|\s{2,}|[=,])/g," ").trim()}const k=a(""),L=a(""),E=a(""),z=s((()=>`${k.value||"-"} / ${L.value||"-"}`));function T(){k.value=`v${q.version}`,E.value=q.version}async function N(){const t=await I.get("version");let e=await t.json();L.value=e["System version"]||"-"}function H(){const[t,e,r]=E.value.split("."),[n,a,s]=L.value.split(".");return!((parseInt(n)||0)<(parseInt(t)||0))&&(!((parseInt(a)||0)<(parseInt(e)||0))&&!((parseInt(s)||0)<(parseInt(r)||0)))}const{appVersion:W,apiVersion:G}={appVersion:k,apiVersion:L,minApiVersion:E,fullVersion:z,loadAppVersions:T,loadApiVersion:N,isValidApiVersion:H},{facilityUUID:J}=x();function K(t,e){return e||!1!==t.exportable}function X(t,e=!1){return t.filter((t=>K(t,e))).map((t=>t.label))}function Z(t,e,r=!1){return e.map((e=>t.filter((t=>K(t,r))).map((t=>{let r=R.get(e,t.path,"");return"function"==typeof t.formatter&&r&&(r=t.formatter(r,e)),U(`${t.drillable&&Array.isArray(r)?r.length:r}`)}))))}function tt(t){const{columns:e,rows:r,quarter:n,period:a,filters:s,safeMode:o}=t,u=X(e,o),c=Z(e,i(r,(null==s?void 0:s.sort)||[]),o);let d=u.join(",")+"\n";return d+=c.map((t=>t.join(","))).join("\n"),d+=`\nDate Created:  ${l().format("DD/MMM/YYYY HH:MM:ss")}`,n&&(d+=`\nQuarter: ${n}`),a&&(d+=`\nQuarter: ${a}`),d+=`\ne-Mastercard Version : ${W.value}`,d+=`\nAPI Version ${G.value}`,d+=`\nSite UUID: ${J}`,d}function et(t){const e=new Blob([tt(t)],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=window.URL.createObjectURL(e),r.setAttribute("download",`${t.filename}.csv`),document.body.appendChild(r),r.click(),document.body.removeChild(r)}l.extend(c);const rt="YYYY-MM-DD",nt="DD/MMM/YYYY";function at(t){return l(t).format(nt)}function st(t){return l(t).format(rt)}const it=e("m",{async show(t,e,r="custom-summary-modal",n=!0){const a=await f.create({component:t,cssClass:r,backdropDismiss:n,componentProps:e});a.present();const{data:s}=await a.onWillDismiss();if(s)return s},async hide(t){await f.dismiss(t)}});e("D",O(p({__name:"DrilldownTable",props:{title:{type:String,default:"Drill down table"},rows:{type:Array,required:!0},columns:{type:Array,required:!1},actionButtons:{type:Array},rowActionButtons:{type:Array},config:{type:Object,default:()=>({showSubmitButton:!1})}},setup:t=>(e,r)=>(m(),h(b(_),null,{default:g((()=>[y(b(D),null,{default:g((()=>[y(b(w),null,{default:g((()=>[y(b(v),{slot:"end"},{default:g((()=>[y(b($),{slot:"end",onClick:r[0]||(r[0]=t=>b(it).hide()),"icon-only":""},{default:g((()=>[y(b(P),{icon:b(M)},null,8,["icon"])])),_:1})])),_:1}),y(b(Y),null,{default:g((()=>[B(j(t.title),1)])),_:1})])),_:1})])),_:1}),y(b(F),null,{default:g((()=>[y(b(Q),{rows:t.rows,columns:t.columns,config:t.config,"row-actions-buttons":t.rowActionButtons,"actions-buttons":t.actionButtons,color:"light"},null,8,["rows","columns","config","row-actions-buttons","actions-buttons"])])),_:1})])),_:1}))}),[["__scopeId","data-v-dd3e8006"]])),e("L",23);e("R",class{constructor(){t(this,"date",void 0),t(this,"startDate",void 0),t(this,"endDate",void 0),t(this,"programId",void 0),t(this,"useDefaultParams",void 0),this.programId=1,this.date=st(),this.endDate="",this.startDate="",this.useDefaultParams=!0}setDate(t){this.date=st(t)}setStartDate(t){this.startDate=st(t)}setEndDate(t){this.endDate=st(t)}getDateIntervalPeriod(){return this.startDate&&this.endDate?`${at(this.startDate)} - ${at(this.endDate)}`:"-"}buildParams(t){let e={};return this.useDefaultParams&&(e.date=this.date,e.program_id=this.programId),this.startDate&&(e.start_date=this.startDate),this.endDate&&(e.end_date=this.endDate),t&&(e={...e,...t}),e}async getReport(t,e){return(await I.get(C(t,this.buildParams(e)))).json()}static getReportQuarters(t=5){const e=[];let r=new Date,n=r.getFullYear();r=new Date(`${n}-${r.getMonth()+1}-${r.getDate()} 00:00`);let a=this.getQtrByDate(r).qtr,s=0;for(4===a&&e.push(this.buildQtrObj("Q1",n+1));s<t;)0===s&&a<4&&e.push(this.buildQtrObj(`Q${a+1}`,n)),e.push(this.buildQtrObj(`Q${a}`,n)),a=a>0?a-=1:a,n=0==a?n-1:n,a=0==a?a+=4:a,s++;return e}static getQtrByDate(t){const e=this.getQuarterBounds(t.getFullYear());for(const r in e){const{start:n,end:a}=e[r];if(t>=new Date(n)&&t<=new Date(a))return e[r]}return null}static buildQtrObj(t,e){const r=this.getQuarterBounds(e),{start:n,end:a}=r[t];return{start:n,end:a,name:`${t} ${e}`}}static getQuarterBounds(t){const e=e=>`${t}-${e}-01 00:00`,r=e=>`${t}-${e}-${(e=>l(`${t}-${e}-01`).daysInMonth())(e)} 00:00`;return{Q1:{qtr:1,start:e("01"),end:r("03")},Q2:{qtr:2,start:e("04"),end:r("06")},Q3:{qtr:3,start:e("07"),end:r("09")},Q4:{qtr:4,start:e("10"),end:r("12")}}}async getMaternalStatus(t,e="pepfar"){var r;if(R.isEmpty(t))return{FP:[],FBf:[]};const n=C("vl_maternal_status",this.buildParams({report_definition:e}));return null!==(r=(await A.postJson(n,{patient_ids:t})).data)&&void 0!==r?r:{FP:[],FBf:[]}}async buildMaternityAgreggateRows(t,e="pepfar"){const r=R.uniq(Object.values(t).flat(1).map((t=>t instanceof Object?t.patient_id:t))),n=Object.keys(t),a=await this.getMaternalStatus(r,e),s=a.FBf.concat(a.FP);return["FP","FNP","FBf"].map((e=>n.reduce(((r,n)=>({[n]:t[n].filter((t=>{const r=t instanceof Object?t.patient_id:t;return"FNP"===e?!s.includes(r):a[e].includes(r)})),...r})),{ageGroup:"All",gender:e})))}})}}}))}();

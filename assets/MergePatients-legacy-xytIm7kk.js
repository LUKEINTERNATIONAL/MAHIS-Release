System.register(["./vendor-legacy-B9MYUwcF.js","./index-legacy-Cp841SSn.js","./ActionButtons.vue_vue_type_script_setup_true_lang-legacy-BQqpLG13.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-llOkIgnz.js"],function(e,a){"use strict";var t,r,i,n,o,l,d,s,c,f,u,p,m,v,b,g,h,y,x,w,_,k,z,D,I,P,C,V,A,S,j,N,R,$,q,B,E,G,L,M,O,U,F,K,T,H,W,Y,Q,X;return{setters:[e=>{t=e.d,r=e.cp,i=e.r,n=e.c,o=e.a,l=e.y,d=e.f,s=e.z,c=e.l,f=e.u,u=e.ah,p=e.k,m=e.I,v=e.dD,b=e.ai,g=e.aj,h=e.aG,y=e.bs,x=e.A,w=e.ab,_=e.bC,k=e.W,z=e.bQ,D=e.bn,I=e.b0,P=e.aZ,C=e.e,V=e.m,A=e.al,S=e.ak,j=e.F,N=e.L,R=e.G,$=e.p,q=e.dE,B=e.B,E=e.D,G=e.br,L=e.am,M=e.bT,O=e.bw,U=e.an},e=>{F=e.T,K=e.g,T=e.P,H=e.af,W=e.q,Y=e.u,Q=e._},e=>{X=e._},null,null],execute:function(){var Z=document.createElement("style");Z.textContent="ion-content[data-v-d7b1aff6],.main-content[data-v-d7b1aff6]{--background: #fff}.full-height-container[data-v-d7b1aff6]{height:100%;display:flex;align-items:center;justify-content:center;padding:1rem;min-height:calc(100vh - 120px)}.centered-content[data-v-d7b1aff6]{width:100%;max-width:1200px;display:flex;flex-direction:column;gap:1rem}.header-section[data-v-d7b1aff6]{text-align:center;margin-bottom:1rem}.header-section .title-container[data-v-d7b1aff6]{display:flex;align-items:center;justify-content:center;gap:.75rem;margin-bottom:.5rem}.header-section .title-icon[data-v-d7b1aff6]{font-size:1.75rem;color:var(--ion-color-primary)}.header-section .page-title[data-v-d7b1aff6]{font-size:2rem;font-weight:700;color:var(--ion-color-dark);margin:0;letter-spacing:-.02em}.header-section .page-subtitle[data-v-d7b1aff6]{font-size:1rem;color:var(--ion-color-dark);margin:0;font-weight:400}.search-card[data-v-d7b1aff6]{margin-bottom:1rem}.search-card .search-content[data-v-d7b1aff6]{padding:0}.search-row[data-v-d7b1aff6]{gap:1rem}.search-col[data-v-d7b1aff6]{padding:0}.patient-section[data-v-d7b1aff6]{height:100%;padding:1rem;border-radius:8px;border:1px solid transparent;transition:all .3s ease;background:#fff}.patient-section.primary-section[data-v-d7b1aff6]{border-color:rgba(76,175,80,.2)}.patient-section.secondary-section[data-v-d7b1aff6]{border-color:rgba(33,150,243,.2)}.patient-section[data-v-d7b1aff6]:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.12)}.section-header[data-v-d7b1aff6]{display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem;flex-wrap:wrap}.section-header .section-icon[data-v-d7b1aff6]{font-size:1.1rem}.section-header .section-icon.primary-icon[data-v-d7b1aff6]{color:var(--ion-color-primary)}.section-header .section-icon.secondary-icon[data-v-d7b1aff6]{color:var(--ion-color-secondary)}.section-header .section-title[data-v-d7b1aff6]{font-weight:600;font-size:1rem;color:var(--ion-color-dark)}.section-header .section-note[data-v-d7b1aff6]{font-size:.8rem;margin-left:auto}.input-group[data-v-d7b1aff6]{display:flex;gap:.75rem;align-items:flex-end;border:1px solid #efefef;border-radius:8px;padding-left:8px}.input-group .patient-input[data-v-d7b1aff6]{flex:1;--border-width: 2px;--highlight-color: var(--ion-color-primary)}.input-group .search-button[data-v-d7b1aff6]{--border-radius: 8px;height:56px;width:56px}.input-group .search-button[data-v-d7b1aff6]:hover{--box-shadow: 0 4px 12px rgba(0, 0, 0, .2)}.preview-card[data-v-d7b1aff6]{margin-bottom:1rem;border-radius:4px;border:1px solid #efefef}.preview-card .preview-content[data-v-d7b1aff6]{padding:1rem}.preview-header[data-v-d7b1aff6]{text-align:center;margin-bottom:1rem}.preview-header .preview-title[data-v-d7b1aff6]{font-size:1.25rem;font-weight:600;color:var(--ion-color-dark);margin:0 0 .5rem}.preview-header .preview-note[data-v-d7b1aff6]{font-size:.9rem}.preview-placeholder[data-v-d7b1aff6]{display:flex;justify-content:center;align-items:center;min-height:20rem;border-radius:12px}.preview-placeholder .placeholder-image[data-v-d7b1aff6]{max-width:100%;height:auto;opacity:.8;border-radius:8px;max-height:19rem}.action-section[data-v-d7b1aff6]{text-align:center}.action-section .merge-button[data-v-d7b1aff6]{--border-radius: 8px;font-weight:600;font-size:1.1rem;margin-bottom:.75rem}.action-section .merge-button[data-v-d7b1aff6]:not([disabled]):hover{transform:translateY(-1px)}.action-section .action-note[data-v-d7b1aff6]{font-size:.9rem;display:block}ion-header[data-v-d7b1aff6]{border-bottom:1px solid transparent}ion-header[data-v-d7b1aff6]:after{background-image:none}ion-card[data-v-d7b1aff6],ion-card-content[data-v-d7b1aff6]{box-shadow:none;--box-shadow: none}.results-container[data-v-d7b1aff6]{margin-top:1rem}.results-section[data-v-d7b1aff6]{margin-bottom:1.5rem}.results-title[data-v-d7b1aff6]{display:flex;align-items:center;margin-bottom:1rem;font-size:1.1rem;font-weight:600;color:var(--ion-color-dark)}.results-icon[data-v-d7b1aff6]{margin-right:.5rem;font-size:1.2rem}.primary-icon[data-v-d7b1aff6]{color:var(--ion-color-primary)}.secondary-icon[data-v-d7b1aff6]{color:var(--ion-color-secondary)}.patient-list[data-v-d7b1aff6]{background:transparent}.patient-item[data-v-d7b1aff6]{--padding-start: 1rem;--padding-end: 1rem;margin-bottom:.5rem;border-radius:8px;transition:all .2s ease;background:#fff}.patient-item.selected[data-v-d7b1aff6]{--background: var(--ion-color-light);border:2px solid var(--ion-color-primary)}.patient-avatar[data-v-d7b1aff6]{--size: 45px;margin-right:1rem}.avatar-placeholder[data-v-d7b1aff6]{border-radius:10px;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:var(--ion-color-primary);color:#fff;font-weight:700;font-size:1.2rem}.patient-name[data-v-d7b1aff6]{font-weight:600;color:var(--ion-color-dark);margin-bottom:.25rem}.patient-details[data-v-d7b1aff6]{display:flex;align-items:center;gap:.5rem;margin-bottom:.25rem;font-size:.9rem;color:var(--ion-color-dark)}.gender-badge[data-v-d7b1aff6]{font-size:.7rem;padding:.2rem .4rem}.patient-ids[data-v-d7b1aff6],.patient-location[data-v-d7b1aff6]{font-size:.8rem;color:var(--ion-color-dark-shade);margin-bottom:.1rem}.selected-icon[data-v-d7b1aff6]{font-size:1.5rem}.search-button[data-v-d7b1aff6]{min-width:44px}.search-button ion-spinner[data-v-d7b1aff6]{--color: white}.scrollable-list[data-v-d7b1aff6]{max-height:400px;overflow-y:auto;border:1px solid var(--ion-color-light-shade);border-radius:8px}.results-title[data-v-d7b1aff6]{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem;font-size:1.1rem;font-weight:600;color:var(--ion-color-dark)}.selection-count[data-v-d7b1aff6]{font-size:.7rem;padding:.3rem .6rem;margin-left:auto}.scrollable-list[data-v-d7b1aff6]{max-height:400px;overflow-y:auto;border:1px solid var(--ion-color-light-shade);border-radius:8px;background:transparent}.patient-item[data-v-d7b1aff6]{--padding-start: 1rem;--padding-end: 1rem;margin-bottom:.5rem;border-radius:8px;transition:all .2s ease}.patient-item.selected[data-v-d7b1aff6]{--background: var(--ion-color-light);border:2px solid var(--ion-color-secondary);transform:translate(4px)}.patient-item[data-v-d7b1aff6]:hover{--background: var(--ion-color-light-tint)}.merge-count[data-v-d7b1aff6]{margin-left:.5rem;font-size:.8rem;font-weight:600}.action-note[data-v-d7b1aff6]{font-size:.9rem;display:block;max-width:600px;margin:0 auto;line-height:1.4}.scrollable-list[data-v-d7b1aff6]::-webkit-scrollbar{width:6px}.scrollable-list[data-v-d7b1aff6]::-webkit-scrollbar-track{background:var(--ion-color-light);border-radius:3px}.scrollable-list[data-v-d7b1aff6]::-webkit-scrollbar-thumb{background:var(--ion-color-dark);border-radius:3px}.scrollable-list[data-v-d7b1aff6]::-webkit-scrollbar-thumb:hover{background:var(--ion-color-dark-shade)}.patient-item.selected .patient-name[data-v-d7b1aff6]{color:var(--ion-color-secondary);font-weight:700}.patient-item.selected .avatar-placeholder[data-v-d7b1aff6]{background:var(--ion-color-secondary)}.primary-results .patient-item.selected[data-v-d7b1aff6]{border-color:var(--ion-color-primary)}.primary-results .patient-item.selected .patient-name[data-v-d7b1aff6]{color:#10a200}.primary-results .patient-item.selected .avatar-placeholder[data-v-d7b1aff6]{background:#10a200}\n/*$vite$:1*/",document.head.appendChild(Z);const J=""+new URL("merge-patient-search-placeholder-grGtXK01.png",a.meta.url).href,ee={class:"full-height-container"},ae={class:"centered-content"},te={class:"header-section"},re={class:"title-container"},ie={class:"search-card",mode:"ios"},ne={class:"search-content"},oe={class:"patient-section primary-section"},le={class:"section-header"},de={class:"input-group"},se={class:"patient-section secondary-section"},ce={class:"section-header"},fe={class:"input-group"},ue={class:"preview-header"},pe={key:0,class:"results-container"},me={class:"results-section primary-results"},ve={class:"results-title"},be={class:"avatar-placeholder"},ge={class:"patient-name"},he={class:"patient-details"},ye={class:"patient-ids"},xe={class:"patient-location"},we={class:"results-section secondary-results"},_e={class:"results-title"},ke={class:"avatar-placeholder"},ze={class:"patient-name"},De={class:"patient-details"},Ie={class:"patient-ids"},Pe={class:"patient-location"},Ce={key:1,class:"preview-placeholder"},Ve={class:"action-section"};e("default",Q(t({__name:"MergePatients",setup(e){const a=r(),t=i(),Q=i(""),Z=i(!1),Ae=i(!1),Se=i(""),je=i([]),Ne=i([]),Re=i([]),$e=i(null),qe=n(()=>$e.value&&Re.value.length>0),Be=n(()=>je.value.length>0||Ne.value.length>0),Ee=async(e,a=!0)=>{if(!e.trim())return;const t=a?Z:Ae,r=a?je:Ne;t.value=!0,r.value=[];try{const[a,t]=e.trim().split(" "),i={...a&&{given_name:a},...t&&{family_name:t}},n=await T.search(i);r.value=await Promise.all(n.map(async(e,a)=>{const t=Y();await t.setPatientRecord(e);const r=new T;return{index:a,id:r.getID(),name:r.getFullName()||"Unknown",docID:r.getDocID()||"NA",birthdate:r.getBirthdate(),arvNum:r.getArvNumber(),npid:r.getNationalID(),gender:r.getGender(),homeDistrict:r.getHomeDistrict(),homeVillage:r.getHomeVillage(),currentDistrict:r.getCurrentDistrict(),currentVillage:r.getCurrentVillage(),isChecked:!1}}))}catch(i){console.error("Patient search failed:",i),r.value=[]}finally{t.value=!1}},Ge=()=>{Ee(Q.value,!0)},Le=()=>{Re.value=[],Ee(Se.value,!1)},Me=e=>Re.value.some(a=>a.id===e),Oe=e=>e?new Date(e).toLocaleDateString():"N/A",Ue=e=>"m"===e.toLowerCase()?"primary":"secondary",Fe=async()=>{if(qe.value&&await K(`Are you sure you want to merge selected ${Re.value.length} secondary patient(s) to merge with primary patient.`))try{const e=await T.mergePatients({primary:{patient_id:$e.value.id,doc_id:$e.value.docID},secondary:Re.value.map(e=>({patient_id:e.id,doc_id:e.docID}))});await H(e.patient_id),je.value=[],Ne.value=[],$e.value=[],Re.value=[],Q.value="",Se.value=""}catch(e){W(`${e}`)}};return o(()=>{(()=>{const e=a.query.q;e&&e.trim()&&(Q.value=e.trim(),Se.value=e.trim(),Ee(e.trim(),!0),Ee(e.trim(),!1))})(),!a.query.q&&t.value&&setTimeout(()=>{t.value.$el.setFocus()},200)}),(e,a)=>(d(),l(f(U),null,{default:s(()=>[c(F),c(X),c(f(u),{fullscreen:!0,class:"main-content"},{default:s(()=>[p("div",ee,[p("div",ae,[p("div",te,[p("div",re,[c(f(m),{icon:f(v),class:"title-icon"},null,8,["icon"]),a[3]||(a[3]=p("h1",{class:"page-title"},"Merge Clients",-1))]),a[4]||(a[4]=p("p",{class:"page-subtitle"},"Select primary and secondary patients to merge their records",-1))]),p("div",ie,[p("div",ne,[c(f(b),{class:"search-row"},{default:s(()=>[c(f(g),{class:"search-col"},{default:s(()=>[p("div",oe,[p("div",le,[c(f(m),{icon:f(h),class:"section-icon primary-icon"},null,8,["icon"]),a[6]||(a[6]=p("span",{class:"section-title"},"Primary Patient",-1)),c(f(y),{class:"section-note"},{default:s(()=>a[5]||(a[5]=[x("Main record",-1)])),_:1,__:[5]})]),p("div",de,[c(f(w),{ref_key:"primaryInputRef",ref:t,modelValue:Q.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Q.value=e),label:"Search primary patient","label-placement":"floating",fill:"outline",placeholder:"Enter patient name or ID",class:"patient-input",onKeyup:_(Ge,["enter"])},null,8,["modelValue"]),c(f(k),{fill:"solid",color:"primary",class:"search-button",disabled:Z.value||!Q.value.trim(),onClick:Ge},{default:s(()=>[Z.value?(d(),l(f(z),{key:0,name:"crescent"})):(d(),l(f(m),{key:1,icon:f(D)},null,8,["icon"]))]),_:1},8,["disabled"])])])]),_:1}),c(f(g),{class:"search-col"},{default:s(()=>[p("div",se,[p("div",ce,[c(f(m),{icon:f(h),class:"section-icon secondary-icon"},null,8,["icon"]),a[8]||(a[8]=p("span",{class:"section-title"},"Secondary Patient",-1)),c(f(y),{class:"section-note"},{default:s(()=>a[7]||(a[7]=[x("Will be merged into primary",-1)])),_:1,__:[7]})]),p("div",fe,[c(f(w),{modelValue:Se.value,"onUpdate:modelValue":a[1]||(a[1]=e=>Se.value=e),label:"Search secondary patient","label-placement":"floating",fill:"outline",placeholder:"Enter patient name or ID",class:"patient-input",onKeyup:_(Le,["enter"])},null,8,["modelValue"]),c(f(k),{fill:"solid",color:"secondary",class:"search-button",disabled:Ae.value||!Se.value.trim(),onClick:Le},{default:s(()=>[Ae.value?(d(),l(f(z),{key:0,name:"crescent"})):(d(),l(f(m),{key:1,icon:f(D)},null,8,["icon"]))]),_:1},8,["disabled"])])])]),_:1})]),_:1})])]),c(f(I),{class:"preview-card",mode:"ios"},{default:s(()=>[c(f(P),{class:"preview-content"},{default:s(()=>[p("div",ue,[a[10]||(a[10]=p("h2",{class:"preview-title"},"Patient Search Results",-1)),c(f(y),{class:"preview-note"},{default:s(()=>a[9]||(a[9]=[x("Select patients from search results to preview merge",-1)])),_:1,__:[9]})]),Be.value?(d(),C("div",pe,[c(f(b),null,{default:s(()=>[je.value.length>0?(d(),l(f(g),{key:0},{default:s(()=>{var e;return[p("div",me,[p("h3",ve,[c(f(m),{icon:f(h),class:"results-icon primary-icon"},null,8,["icon"]),a[11]||(a[11]=x(" Primary Patient Options ",-1))]),c(f(A),{value:null===(e=$e.value)||void 0===e?void 0:e.id,onIonChange:a[2]||(a[2]=e=>{return a=je.value.find(a=>a.id===e.detail.value),void($e.value=a);var a})},{default:s(()=>[c(f(S),{class:"patient-list scrollable-list ion-padding"},{default:s(()=>[(d(!0),C(j,null,N(je.value,e=>{var a;return d(),l(f(R),{key:e.id,class:$(["patient-item",{selected:(null===(a=$e.value)||void 0===a?void 0:a.id)===e.id}]),lines:"none"},{default:s(()=>[c(f(q),{class:"patient-avatar"},{default:s(()=>[p("div",be,B(e.name.charAt(0)),1)]),_:2},1024),c(f(E),null,{default:s(()=>[p("h3",ge,B(e.name),1),p("p",he,[c(f(G),{color:Ue(e.gender),class:"gender-badge"},{default:s(()=>[x(B(e.gender),1)]),_:2},1032,["color"]),x(" DOB: "+B(Oe(e.birthdate)),1)]),p("p",ye,"ID: "+B(e.id)+" | ARV: "+B(e.arvNum||"N/A"),1),p("p",xe,B(e.currentDistrict)+", "+B(e.currentVillage),1)]),_:2},1024),c(f(L),{value:e.id,color:"primary"},{default:s(()=>{var a;return[(null===(a=$e.value)||void 0===a?void 0:a.id)===e.id?(d(),l(f(m),{key:0,icon:f(M),color:"primary",class:"selected-icon"},null,8,["icon"])):V("",!0)]}),_:2},1032,["value"])]),_:2},1032,["class"])}),128))]),_:1})]),_:1},8,["value"])])]}),_:1})):V("",!0),Ne.value.length>0?(d(),l(f(g),{key:1},{default:s(()=>[p("div",we,[p("h3",_e,[c(f(m),{icon:f(h),class:"results-icon secondary-icon"},null,8,["icon"]),a[12]||(a[12]=x(" Secondary Patient Options ",-1)),Re.value.length>0?(d(),l(f(G),{key:0,color:"secondary",class:"selection-count"},{default:s(()=>[x(B(Re.value.length)+" selected ",1)]),_:1})):V("",!0)]),c(f(S),{class:"patient-list scrollable-list ion-padding"},{default:s(()=>[(d(!0),C(j,null,N(Ne.value,e=>(d(),l(f(R),{key:e.id,class:$(["patient-item",{selected:Me(e.id)}]),lines:"none"},{default:s(()=>[c(f(q),{class:"patient-avatar"},{default:s(()=>[p("div",ke,B(e.name.charAt(0)),1)]),_:2},1024),c(f(E),null,{default:s(()=>[p("h3",ze,B(e.name),1),p("p",De,[c(f(G),{color:Ue(e.gender),class:"gender-badge"},{default:s(()=>[x(B(e.gender),1)]),_:2},1032,["color"]),x(" DOB: "+B(Oe(e.birthdate)),1)]),p("p",Ie,"ID: "+B(e.id)+" | ARV: "+B(e.arvNum||"N/A"),1),p("p",Pe,B(e.currentDistrict)+", "+B(e.currentVillage),1)]),_:2},1024),c(f(O),{checked:Me(e.id),color:"secondary",onIonChange:a=>((e,a)=>{a?Re.value.find(a=>a.id===e.id)||Re.value.push(e):Re.value=Re.value.filter(a=>a.id!==e.id)})(e,a.detail.checked)},null,8,["checked","onIonChange"])]),_:2},1032,["class"]))),128))]),_:1})])]),_:1})):V("",!0)]),_:1})])):(d(),C("div",Ce,a[13]||(a[13]=[p("img",{src:J,alt:"Patient search placeholder",class:"placeholder-image"},null,-1)])))]),_:1})]),_:1}),p("div",Ve,[c(f(k),{expand:"block",size:"large",color:"success",class:"merge-button",disabled:!qe.value,onClick:Fe},{default:s(()=>[c(f(m),{icon:f(v)},null,8,["icon"]),a[14]||(a[14]=x(" Merge Selected Patients ",-1)),Re.value.length>1?(d(),l(f(G),{key:0,color:"light",class:"merge-count"},{default:s(()=>[x(" 1 → "+B(Re.value.length),1)]),_:1})):V("",!0)]),_:1,__:[14]},8,["disabled"]),c(f(y),{class:"action-note"},{default:s(()=>[x(B(qe.value?`Ready to merge ${Re.value.length} secondary patient(s) into primary patient`:"Select one primary patient and at least one secondary patient to enable merge"),1)]),_:1})])])])]),_:1})]),_:1}))}}),[["__scopeId","data-v-d7b1aff6"]]))}}});

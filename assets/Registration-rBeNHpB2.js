import{ah as O,_ as q,o as ot,x as H,y as a,u as V,i as rt,H as P,w as ht,aa as L,ai as mt,ab as ft,ad as yt,S as W,g as tt,a4 as gt,b as j,aj as vt,m as J,ak as _t,t as D,al as bt,am as It,A as St,F as Dt,E as Ct,P as Pt,C as kt,r as et,I as Lt,an as wt,s as Tt,p as Rt,n as $t}from"./index-Cu2JEMub.js";import{C as Nt}from"./ConfirmPrinting-Bc6UlRUh.js";import{d as z,al as k,U as st,T as X,am as lt,an as K,G as Q,S as Z,ao as x,E as d,y as g,f as c,W as Bt,I as ct,ab as Ht,d0 as Ot,ac as At,ds as Gt,D as Ft,X as it,e as _,m as h,l as i,k as o,z as r,B as y,F as nt,L as Mt,A as I,au as Ut,bj as Et,dv as Wt,dw as Vt,dx as F,O as qt,dy as zt,cj as Yt,dz as jt,p as T}from"./vendor-DowD5zKn.js";import{_ as dt,B as Jt,S as Xt,H as Kt,C as Qt,G as Zt,P as xt}from"./BirthRegistration-RdRx8nTP.js";import{B as ut,_ as te,u as at}from"./ncd_appointment_service-Dt0gCCXX.js";import{l as ee}from"./lodash-Dt8AsbQm.js";import{f as ie}from"./formatServerData-BkXd7Ika.js";import{v as A}from"./group_validation-BJZE-M8D.js";import{g as ne}from"./vaccines_service-6yOEotAP.js";import{A as ae}from"./app_encounter_service-DUFQOcer.js";import"./OutcomeModal-D1kYqMwG.js";import"./SetRelationship.vue_vue_type_script_lang-ZZLTGhiV.js";import"./relations_service-D3QJZ3Yb.js";import"./relationship_service-wV36x8Fu.js";import"./AddVillage-BUEBFDfQ.js";import"./DemographicBar-ysbb2FBV.js";import"./SaveProgressModal-jAWpIIiJ.js";import"./Stepper-D6pJ_4qK.js";import"./previousVitals-B5m9RS-E.js";import"./apexcharts-DlRg9dVi.js";import"./SvgDynamicColor-SqjviohE.js";import"./patient_complaints_service-DnsiMyiu.js";import"./lab_order-CrBDUar0.js";import"./UpcomingFeature-CvTKImeG.js";import"./DatePicker.vue_vue_type_script_setup_true_lang-B8H-baea.js";import"./vitals_service-CyGV0bwE.js";import"./drug_service-CqyaNFux.js";import"./drug_prescription_service-DYM43-cK.js";import"./appointment_service-gS0OmJln.js";import"./clinicalDaysStore-CfBpg_-z.js";import"./FeatusModal-BDdgKNXA.js";import"./diagnosis-C10lzk9Y.js";import"./NCDNumber-CXsEqEGO.js";import"./sms_service-BTPCQOSz.js";import"./EIRreportsStore-CKI_NPUw.js";import"./Export-C32oJASq.js";const oe=z({name:"Menu",components:{IonContent:x,IonHeader:Z,IonItem:Q,IonList:K,IonMenu:lt,IonTitle:X,IonToolbar:st,BasicCard:ut},data(){return{cardData:{},inputField:"",setName:""}},watch:{patientType:{handler(){this.buildCards()},deep:!0}},computed:{...k(O,["patientType"])},props:{editable:{default:!1}},mounted(){this.buildCards()},methods:{buildCards(){this.cardData={mainTitle:"Patient Information",cards:[{cardTitle:"Patient Type",content:this.patientType}]}}}});function re(t,e,n,u,f,p){const b=d("basic-card");return c(),g(b,{content:t.cardData,editable:t.editable},null,8,["content","editable"])}const se=q(oe,[["render",re],["__scopeId","data-v-f1fd3b4e"]]),le=z({name:"Menu",mixins:[dt],components:{IonContent:x,IonHeader:Z,IonItem:Q,IonList:K,IonMenu:lt,IonTitle:X,IonToolbar:st,BasicCard:ut},data(){return{cardData:{},inputField:"",setName:"",locationData:[]}},computed:{...k(O,["currentLocation","country"]),...k(V,["patient"]),selected_country(){var t;return(t=a(this.country,"country","value"))==null?void 0:t.name},current_district(){var t;return(t=a(this.currentLocation,"current_district","value"))==null?void 0:t.name},current_traditional_authority(){var t;return(t=a(this.currentLocation,"current_traditional_authority","value"))==null?void 0:t.name},current_village(){var t;return(t=a(this.currentLocation,"current_village","value"))==null?void 0:t.name},"Other (specify)"(){return a(this.currentLocation,"Other (specify)","value")}},watch:{currentLocation:{handler(){this.buildCards()},deep:!0},countriesList:{handler(){this.countriesList.length>0&&H(this.country,"country","multiSelectData",this.countriesList)},deep:!0},$route:{async handler(){await this.buildCards(),this.setData()}}},props:{editable:{default:!1}},async mounted(){await this.buildCards(),this.setData()},methods:{setData(){this.setSelectedCountry(),this.editable&&H(this.country,"country","value",{name:"Malawi",district_id:""})},setSelectedCountry(){if(ot().setRegSelectedCountry(this.selected_country),this.selected_country==="Malawi"){const t=O();t.setHomeLocation(t.getInitialHomeLocation()),t.setCurrentLocation(t.getInitialCurrentLocation())}},async buildCards(){this.cardData={mainTitle:"Demographics",cards:[{cardTitle:"Country",content:this.country}]}},async handleInputData(t){this.setSelectedCountry()}}});function ce(t,e,n,u,f,p){const b=d("basic-card");return c(),g(b,{content:t.cardData,editable:t.editable,"onUpdate:selected":t.handleInputData,"onUpdate:inputValue":t.handleInputData},null,8,["content","editable","onUpdate:selected","onUpdate:inputValue"])}const de=q(le,[["render",ce],["__scopeId","data-v-490af540"]]),ue=z({components:{IonLabel:Ft,IonAvatar:Gt,IonRow:At,IonImg:Ot,IonCol:Ht,IonList:K,IonItem:Q,IonIcon:ct,IonButton:Bt},data:()=>({selectedResult:{},iconsContent:rt,isAnyAccordionOpen:!0,isLoading:!1}),methods:{updateAccordionState(t){const e=this.$refs.accordionGroup;this.isAnyAccordionOpen=e.value!==void 0},dismiss(t){it.dismiss(t)},async init(){this.setData(this.deduplicationData[0]||{})},async onSelect(){it.dismiss(this.selectedResult)},setData(t){this.selectedResult=t},dateFormat(t){return P.toStandardHisDisplayFormat(t)},probabilityToPercentage(t){return(t*100).toFixed(2)+"%"}},props:{deduplicationData:{default:[]},to_be_registered:{default:[]}},mounted(){this.init()},activated(){this.init()}}),pe={key:0,class:"spinner-overlay"},he={class:"header position_content"},me={style:{"font-size":"1.2em","font-weight":"700"}},fe={class:"due_date"},ye={class:"ion-padding",slot:"content"},ge={style:{display:"flex","justify-content":"end",gap:"10px"}};function ve(t,e,n,u,f,p){const b=d("ion-spinner"),m=d("ion-icon"),R=d("ion-header"),$=d("ion-label"),N=d("ion-item"),B=d("ion-col"),v=d("ion-row"),M=d("ion-accordion"),U=d("ion-accordion-group"),E=d("ion-content"),G=d("ion-button"),Y=d("ion-footer");return c(),_(nt,null,[t.isLoading?(c(),_("div",pe,[i(b,{name:"bubbles"}),e[3]||(e[3]=o("div",{class:"loading-text"},"Please wait...",-1))])):h("",!0),i(R,null,{default:r(()=>[o("div",he,[o("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=s=>t.dismiss("back"))},[i(m,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeft},null,8,["icon"])]),o("div",me,"Matches found: ("+y(t.deduplicationData.length)+")",1)])]),_:1}),i(E,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:r(()=>[i(U,{ref:"accordionGroup",class:"previousView",value:"0",onIonChange:t.updateAccordionState},{default:r(()=>[(c(!0),_(nt,null,Mt(t.deduplicationData,(s,w)=>(c(),g(M,{style:{"margin-bottom":"15px"},value:w,"toggle-icon-slot":"start",class:"custom_card",button:"",key:w,detail:!0,color:s.value===t.selectedResult.value?"light":"",onClick:l=>t.setData(s)},{default:r(()=>[i(N,{slot:"header"},{default:r(()=>[i($,{class:"previousLabel"},{default:r(()=>{var l,C;return[I(y((l=s==null?void 0:s.person)==null?void 0:l.given_name)+" "+y((C=s==null?void 0:s.person)==null?void 0:C.family_name),1)]}),_:2},1024),o("div",fe,[e[4]||(e[4]=I(" Score: ")),o("b",null,y(t.probabilityToPercentage(s==null?void 0:s.score)||"-"),1)])]),_:2},1024),o("div",ye,[i(v,null,{default:r(()=>[i(B,null,{default:r(()=>e[5]||(e[5]=[o("b",null,"To be Registered",-1)])),_:1,__:[5]}),i(B,null,{default:r(()=>e[6]||(e[6]=[o("b",null,"Already Registered",-1)])),_:1,__:[6]})]),_:1}),i(v,null,{default:r(()=>[i(B,null,{default:r(()=>[i(v,null,{default:r(()=>{var l,C;return[e[7]||(e[7]=I(" Name: ")),o("b",null,y((l=t.to_be_registered)==null?void 0:l.given_name)+" "+y((C=t.to_be_registered)==null?void 0:C.family_name),1)]}),_:1,__:[7]}),i(v,null,{default:r(()=>{var l;return[e[8]||(e[8]=I("Gender: ")),o("b",null,y((l=t.to_be_registered)==null?void 0:l.gender),1)]}),_:1,__:[8]}),i(v,null,{default:r(()=>{var l;return[e[9]||(e[9]=I("Birthdate: ")),o("b",null,y((l=t.to_be_registered)==null?void 0:l.birthdate),1)]}),_:1,__:[9]}),i(v,null,{default:r(()=>{var l;return[e[10]||(e[10]=I("Home District: ")),o("b",null,y((l=t.to_be_registered)==null?void 0:l.home_district),1)]}),_:1,__:[10]}),i(v,null,{default:r(()=>{var l;return[e[11]||(e[11]=I("Home TA: ")),o("b",null,y((l=t.to_be_registered)==null?void 0:l.home_traditional_authority),1)]}),_:1,__:[11]})]),_:1}),i(B,null,{default:r(()=>[i(v,null,{default:r(()=>{var l,C;return[e[12]||(e[12]=I(" Name: ")),o("b",null,y((l=s==null?void 0:s.person)==null?void 0:l.given_name)+" "+y((C=s==null?void 0:s.person)==null?void 0:C.family_name),1)]}),_:2,__:[12]},1024),i(v,null,{default:r(()=>{var l;return[e[13]||(e[13]=I("Gender: ")),o("b",null,y((l=s==null?void 0:s.person)==null?void 0:l.gender),1)]}),_:2,__:[13]},1024),i(v,null,{default:r(()=>{var l;return[e[14]||(e[14]=I("Birthdate: ")),o("b",null,y(t.dateFormat((l=s==null?void 0:s.person)==null?void 0:l.birthdate)),1)]}),_:2,__:[14]},1024),i(v,null,{default:r(()=>{var l;return[e[15]||(e[15]=I("Home District: ")),o("b",null,y((l=s==null?void 0:s.person)==null?void 0:l.home_district),1)]}),_:2,__:[15]},1024),i(v,null,{default:r(()=>{var l;return[e[16]||(e[16]=I("Home TA: ")),o("b",null,y((l=s==null?void 0:s.person)==null?void 0:l.home_traditional_authority),1)]}),_:2,__:[16]},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["value","color","onClick"]))),128))]),_:1},8,["onIonChange"])]),_:1}),i(Y,{collapse:"fade",class:"ion-no-border"},{default:r(()=>[o("div",ge,[i(G,{fill:"solid",color:"secondary",onClick:e[1]||(e[1]=s=>t.dismiss("dismiss"))},{default:r(()=>e[17]||(e[17]=[I(" Not Duplicate ")])),_:1,__:[17]}),i(G,{onClick:e[2]||(e[2]=s=>t.onSelect()),fill:"solid",disabled:!t.isAnyAccordionOpen},{default:r(()=>e[18]||(e[18]=[I("Select ")])),_:1,__:[18]},8,["disabled"])])]),_:1})],64)}const _e=q(ue,[["render",ve],["__scopeId","data-v-ffb46cdd"]]),be=z({mixins:[te,dt],components:{PatientType:se,IonBreadcrumb:Vt,IonBreadcrumbs:Wt,IonIcon:ct,IonContent:x,IonHeader:Z,IonMenuButton:Et,IonPage:Ut,IonTitle:X,DynamicButton:ht,PersonalInformation:xt,GuardianInformation:Zt,CurrentLocation:Qt,Country:de,HomeLocation:Kt,SocialHistory:Xt,BirthRegistration:Jt},data(){return{isMilitarySite:!1,ddeId:null,iconListStatus:"active_icon",deduplicationData:"active_icon",iconGridStatus:"inactive_icon",iconsContent:rt,demographic:!0,currentStep:"Personal Information",scanner:!1,checkUnderOne:!1,isLoading:!1,checkUnderFourteen:!0,checkUnderNine:!1,checkUnderFive:!1,checkUnderSixWeeks:!1,steps:["Personal Information","Location","Patient Type","Social History","Guardian Information"],disableSaveBtn:!1,workerStore:$t()}},props:["registrationType"],computed:{...k(Rt,["activeProgram"]),...k(ot,["NCDUserActions","regSelectedCountry"]),...k(Tt,["globalPropertyStore"]),...k(O,["personInformation","socialHistory","currentLocation","homeLocation","guardianInformation","country","patientType"]),...k(at,["registrationDisplayType"]),...k(wt,["birthRegistration"]),...k(j,["apiStatus"]),isPatientTypeRequired(){return this.activeProgram.program_id===1},patientTypeIsset(){const t=L(this.patientType,"patientType");return"".concat(t!=null?t:"").length>=1},nationalID(){return a(this.personInformation,"nationalID","value")},birthID(){return a(this.birthRegistration,"Serial Number","value")},firstname(){return a(this.personInformation,"firstname","value")},lastname(){return a(this.personInformation,"lastname","value")},phoneNumber(){return a(this.personInformation,"phoneNumber","value")},gender(){return L(this.personInformation,"gender")},birthdate(){return P.toStandardHisFormat(a(this.personInformation,"birthdate","value"))},guardianFirstname(){return a(this.guardianInformation,"guardianFirstname","value")},guardianLastname(){return a(this.guardianInformation,"guardianLastname","value")},guardianMiddleName(){return a(this.guardianInformation,"guardianMiddleName","value")},guardianPhoneNumber(){return a(this.guardianInformation,"guardianPhoneNumber","value")},relationship(){return a(this.guardianInformation,"relationship","value")},current_district(){var t;return(t=a(this.currentLocation,"current_district","value"))==null?void 0:t.name},current_traditional_authority(){var t;return(t=a(this.currentLocation,"current_traditional_authority","value"))==null?void 0:t.name},current_village(){var t;return(t=a(this.currentLocation,"current_village","value"))==null?void 0:t.name},"Other (specify)"(){return a(this.currentLocation,"Other (specify)","value")}},async mounted(){et(),this.setIconClass(),this.disableNationalIDInput(),this.checkAge()},watch:{personInformation:{handler(){const t=O();t.setPersonalInformation(this.personInformation),t.setSocialHistory(this.socialHistory),t.setHomeLocation(this.homeLocation),t.setCurrentLocation(this.currentLocation),t.setGuardianInformation(this.guardianInformation),this.checkAge(),this.disableNationalIDInput();const e=O();this.programID()===1&&(t.clearSocialHistoryOccupations(),Lt.isProp("military_site=true").then(n=>{this.isMilitarySite=n,this.isMilitarySite?(e.setOccupationAsMandatory(),e.setSocialHistoryMilitaryOccupations()):(e.setOccupationNotMandatory(),e.setSocialHistoryOccupations())}))},deep:!0},$route:{async handler(t){this.currentStep="Personal Information",t.name.includes("registration")&&(et(),O().setGuardianInformation(this.guardianInformation)),await this.getLocationData(),H(this.country,"country","multiSelectData",this.countriesList),H(this.currentLocation,"current_district","multiSelectData",this.districtList),H(this.homeLocation,"home_district","multiSelectData",this.districtList)},deep:!0}},setup(){return{arrowForwardCircle:jt,grid:Yt,list:zt}},methods:{async cancel(t){await kt("Do you want to cancel registration?","",{confirmBtnLabel:"Yes",icon:"",showBackdrop:!0})&&this.nav("/home")},programID(){return W.getProgramID()},isEligibleForOccupation(){return qt(W.getSessionDate()).diff(this.birthdate,"years")>=18},async getRegion(t){if(t){let e=[];for(let n of[1,2,3]){if((n=1)&&(e=await this.getDistricts(n)),e.some(u=>u.name.trim()===t))return"Central Region";if((n=2)&&(e=await this.getDistricts(n)),e.some(u=>u.name.trim()===t))return"Northern Region";if((n=3)&&(e=await this.getDistricts(n)),e.some(u=>u.name.trim()===t))return"Southern Region";if((n=4)&&(e=await this.getDistricts(n)),e.some(u=>u.name.trim()===t))return"Foreign"}}},checkAge(){ee.isEmpty(this.birthdate)||(this.checkUnderFourteen=P.getAgeInYears(this.birthdate)>=14,this.checkUnderNine=P.ageInMonths(this.birthdate)<9,this.checkUnderFive=P.getAgeInYears(this.birthdate)<5,this.checkUnderSixWeeks=P.dateDiffInDays(P.sessionDate(),this.birthdate)<42)},disableNationalIDInput(){this.registrationType=="manual"?H(this.personInformation,"nationalID","displayNone",!0):H(this.personInformation,"nationalID","displayNone",!1)},setCurrentStep(t){this.currentStep=t},nav(t){this.$router.push(t)},async nextStep(){this.checkUnderFourteen||this.checkUnderFive?this.steps=["Personal Information","Location","Patient Type","Social History","Guardian Information"]:this.steps=["Personal Information","Location","Patient Type","Guardian Information"],this.steps=this.steps.reduce((e,n)=>n==="Patient Type"&&!this.isPatientTypeRequired?e:[...e,n],[]);const t=this.steps.indexOf(this.currentStep);if(t<this.steps.length-1)if(this.currentStep==="Personal Information"){const e=["nationalID","firstname","lastname","birthdate","gender"];await this.validations(this.personInformation,e)?this.currentStep=this.steps[t+1]:D("Please fill fileds correctly before you proceed!")}else if(this.currentStep==="Location"){const e=["current_district","current_traditional_authority","current_village"];await this.validations(this.currentLocation,e)&&await A(this.homeLocation)||this.regSelectedCountry!="Malawi"?this.currentStep=this.steps[t+1]:D("Please fill fileds correctly before you proceed!")}else if(this.currentStep==="Social History"&&this.isMilitarySite&&this.isEligibleForOccupation()){if(!L(this.socialHistory,"occupation"))return D("Occupation is required");this.currentStep=this.steps[t+1]}else if(this.currentStep==="Patient Type"&&this.isPatientTypeRequired){if(!this.patientTypeIsset)return D("Patient type is required!");this.currentStep=this.steps[t+1]}else this.currentStep==="Social History"&&(this.checkUnderFive||this.checkUnderOne?await A(this.birthRegistration)?this.currentStep=this.steps[t+1]:D("Please fill fileds correctly before you proceed!"):this.currentStep=this.steps[t+1])},previousStep(){const t=this.steps.indexOf(this.currentStep);t>0&&(this.currentStep=this.steps[t-1])},async findPatient(t){const e=await Pt.findByID(t);await V().setPatientRecord(e),this.setURLs(t)},validateGaudiarnInfo(){return this.checkUnderFourteen?!0:A(this.guardianInformation)},async validations(t,e){return e.every(n=>Ct(t,n,this[n]))},async validateLocation(){return this.regSelectedCountry=="Malawi"?!!(await A(this.homeLocation)&&await A(this.currentLocation)):!0},async possibleDuplicates(){var t;try{const e=new Dt;if(this.deduplicationData=await e.checkPotentialDuplicates(F(this.personInformation[0].selectedData)),this.deduplicationData.length>0){const n=await tt(_e,{class:"fullScreenModal"},!0,{to_be_registered:F(this.personInformation[0].selectedData),deduplicationData:this.deduplicationData});if(n!="dismiss"&&n!="back"){const u=await e.importPatient((t=n==null?void 0:n.person)==null?void 0:t.id);return await this.findPatient(u.patient_id),!0}else if(n=="back")return!0;return!1}else return!1}catch(e){return!1}},async createPatient(){var n,u;if(_t()===!0){const f=["nationalID","firstname","lastname","birthdate","gender"],p=a(this.currentLocation,"closestLandmark","value");if(p==null||p.name,this.isPatientTypeRequired&&!this.patientTypeIsset)return D("Please complete all required fields");if(!L(this.socialHistory,"occupation")&&this.isMilitarySite&&this.isEligibleForOccupation())return D("Occupation is required");if(await this.validations(this.personInformation,f)&&await this.validateLocation()&&await this.validateBirthData()&&this.validateGaudiarnInfo())try{const m=await bt();if(!m){if(await It()==!1)return;D("DDE IDs are not available in MODS. patient creation will procede without DDE ID."),await this.proceedWithPatientCreation(!0);return}this.ddeId=m.npid,await this.proceedWithPatientCreation(!0)}catch(m){J("DDE IDs are not available. Please connect to the server to sync the IDs.");return}else D("Please complete all required fields");return}const t=await St("dde").then(f=>f==null?void 0:f[0]);let e=!1;if((((n=t==null?void 0:t.ids)==null?void 0:n.length)>0||this.apiStatus)&&(this.ddeId=((u=t==null?void 0:t.ids[0])==null?void 0:u.npid)||"",e=!0),e){const f=["nationalID","firstname","lastname","birthdate","gender"],p=a(this.currentLocation,"closestLandmark","value");if(p==null||p.name,this.isPatientTypeRequired&&!this.patientTypeIsset)return D("Please complete all required fields");L(this.socialHistory,"occupation"),await this.validations(this.personInformation,f)&&await this.validateLocation()&&await this.validateBirthData()&&this.validateGaudiarnInfo()?await this.proceedWithPatientCreation(!1,t):D("Please complete all required fields")}else J("DDE IDs are not available. Please connect to the server to sync the IDs.")},async proceedWithPatientCreation(t=!1,e=null){var u,f;if(await this.buildPersonalInformation(),this.disableSaveBtn=!0,this.isLoading=!0,!t&&this.globalPropertyStore.dde_enabled==="true"&&this.apiStatus&&await this.possibleDuplicates()){this.disableSaveBtn=!1,this.isLoading=!1;return}if(Object.keys(this.personInformation[0].selectedData).length===0)return;const n=await this.buildPatientRecord();if(!t&&((u=e==null?void 0:e.ids)==null?void 0:u.length)>0&&(e.ids=e.ids.slice(1),this.workerStore.postData("OVERRIDE_OBJECT_STORE",{storeName:"dde",data:e})),!t&&(this.apiStatus&&this.programID()!=33&&this.programID()!=32||this.apiStatus&&!(e!=null&&e.ids))){this.workerStore.postData("SYNC_DDE");const p=await W.postJson("/save_patient_record",{record:n}),b=L(this.patientType,"patientType");if(b){const m=new ae(p.patientID,5,-1);await m.createEncounter(),await m.saveValueCodedObs("Type of patient",b)}await V().setPatientRecord(p),this.workerStore.postData("SYNC_ALL_DATA"),this.disableSaveBtn=!1,await this.printBarcode(),await this.setURLs(p.patientID)}else t||!t&&((f=e==null?void 0:e.ids)==null?void 0:f.length)>0?(j().syncingTotal=j().syncingTotal+1,V().setRecord(n),await this.workerStore.postData("ADD_OBJECT_STORE",{storeName:"patientRecords",data:n}),this.isLoading=!1,this.disableSaveBtn=!1,await this.printBarcode(),t&&(n.patientID==null&&vt({record:n}),this.workerStore.postData("SYNC_ALL_DATA")),this.programID()==32?this.$router.push("/NCDEnrollment"):this.$router.push("/patientProfile")):J("DDE IDs are not available. Please connect to the server to sync the IDs.")},async printBarcode(){await tt(Nt,{class:"small-confirm-modal "})!=="dismiss"&&new gt().printData("barcode")},async buildPatientRecord(){var p;const t=a(this.birthRegistration,"Weight","value");let e={saved:[],unsaved:[]};t&&(e.unsaved=[{concept_id:5089,obs_datetime:P.sessionDate(),value_numeric:t}]);const n=this.personInformation[0].selectedData.birthdate,u=this.personInformation[0].selectedData.gender;return{patientID:this.ddeId,ID:this.ddeId,NcdID:"",program_id:W.getProgramID()||null,location_id:localStorage.getItem("locationID"),provider_id:localStorage.getItem("userID"),encounter_datetime:new Date().toISOString(),personInformation:F(this.personInformation[0].selectedData),guardianInformation:{saved:[],unsaved:[F(this.guardianInformation[0].selectedData)]},birthRegistration:F(await ie(this.birthRegistration)),otherPersonInformation:{nationalID:this.validatedNationalID(),birthID:this.validatedBirthID(),relationshipID:(p=a(this.guardianInformation,"relationship","value"))==null?void 0:p.id},vitals:e,vaccineSchedule:await ne(u,n),vaccineAdministration:{orders:[],obs:[],voided:[]},appointments:{saved:[],unsaved:[]},saveStatusPersonInformation:"pending",saveStatusGuardianInformation:"pending",saveStatusBirthRegistration:"pending",saveStatusVitals:"pending",date_created:"",creator:"",sync_status:"unsynced"}},checkWeightForAge(t,e){let n=!1;return(t>=0&&t<1&&e>=.5&&e<=13.1||t>=1&&t<2&&e>13.1&&e<=15||t>=2&&t<3&&e>15&&e<=20.9||t>=3&&t<4&&e>20.9&&e<=24.1||t>=4&&t<5&&e>24.1&&e<=28)&&(n=!0),n},async validateBirthData(){return this.checkUnderNine?this.checkWeightForAge(P.getAgeInYears(this.birthdate),a(this.birthRegistration,"Weight","value"))?A(this.birthRegistration):!!await yt("Do you want to continue with this weight (".concat(a(this.birthRegistration,"Weight","value"),") for age (").concat(P.getAgeInYears(this.birthdate),")")):!0},validatedNationalID(){return this.nationalID!=""&&!a(this.personInformation,"nationalID","alertsErrorMassage")?this.nationalID:""},validatedBirthID(){return this.birthID!=""&&!a(this.birthRegistration,"Serial Number","alertsErrorMassage")?this.birthID:""},async setURLs(t=""){await mt(),this.isLoading=!1,this.disableSaveBtn=!1;let e="";this.programID()==32&&this.apiStatus?e=(await ft.userProgramData(t)).url:e="/patientProfile",this.$router.push(e)},patientIdentifier(t){const e=t.patient_identifiers.length-1;return e>=0?t.patient_identifiers[e].identifier:""},async buildPersonalInformation(){var u,f,p,b,m,R,$,N;const t=(u=a(this.currentLocation,"closestLandmark","value"))==null?void 0:u.name,e=a(this.currentLocation,"Other (specify)","value"),n=t==="Other"?e:t;this.personInformation[0].selectedData={given_name:a(this.personInformation,"firstname","value"),middle_name:a(this.personInformation,"middleName","value"),family_name:a(this.personInformation,"lastname","value"),gender:this.gender,birthdate:a(this.personInformation,"birthdate","value"),birthdate_estimated:"false",home_region:await this.getRegion((f=a(this.homeLocation,"home_district","value"))==null?void 0:f.name)||await this.getRegion((p=a(this.country,"country","value"))==null?void 0:p.name),home_district:(b=a(this.homeLocation,"home_district","value"))==null?void 0:b.name,home_traditional_authority:(m=a(this.homeLocation,"home_traditional_authority","value"))==null?void 0:m.name,home_village:(R=a(this.homeLocation,"home_village","value"))==null?void 0:R.name,current_region:await this.getRegion(this.current_district),current_district:this.current_district,current_traditional_authority:this.current_traditional_authority,current_village:this.current_village,country:($=a(this.country,"country","value"))==null?void 0:$.name,landmark:n,cell_phone_number:a(this.personInformation,"phoneNumber","value"),occupation:L(this.socialHistory,"occupation"),marital_status:L(this.socialHistory,"maritalStatus"),religion:(N=a(this.socialHistory,"religion","value"))==null?void 0:N.name,education_level:L(this.socialHistory,"highestLevelOfEducation")}},setDisplayType(t){at().setRegistrationDisplayType(t),this.setIconClass()},setIconClass(){this.iconListStatus="inactive_icon",this.iconGridStatus="inactive_icon",this.registrationDisplayType=="list"?this.iconListStatus="active_icon":this.registrationDisplayType=="grid"&&(this.iconGridStatus="active_icon")}}}),Ie={key:0,class:"spinner-overlay"},Se={class:"header position_content"},De={style:{display:"flex","align-items":"center"}},Ce={class:"container"},Pe={class:"title"},ke={class:"demographics_title"},Le={class:"icon_div displayNoneMobile"},we={key:0,class:"center_content"},Te={key:0,class:"flex-container"},Re={class:"flex-item"},$e={class:"flex-item"},Ne={class:"flex-item"},Be={key:1},He={key:0},Oe={key:1},Ae={style:{"justify-content":"center"}},Ge={key:0},Fe={key:1},Me={key:2},Ue={key:3},Ee={key:4},We={key:1,class:"footer2"},Ve={class:"footer position_content"};function qe(t,e,n,u,f,p){const b=d("ion-spinner"),m=d("ion-icon"),R=d("ion-header"),$=d("PersonalInformation"),N=d("Country"),B=d("CurrentLocation"),v=d("HomeLocation"),M=d("PatientType"),U=d("SocialHistory"),E=d("BirthRegistration"),G=d("GuardianInformation"),Y=d("ion-content"),s=d("DynamicButton"),w=d("ion-breadcrumb"),l=d("ion-breadcrumbs"),C=d("ion-footer"),pt=d("ion-page");return c(),g(pt,{class:T({loading:t.isLoading})},{default:r(()=>[t.isLoading?(c(),_("div",Ie,[i(b,{name:"bubbles"}),e[11]||(e[11]=o("div",{class:"loading-text"},"Please wait...",-1))])):h("",!0),i(R,null,{default:r(()=>[o("div",Se,[o("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=S=>t.nav("/home"))},[i(m,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeft},null,8,["icon"]),e[12]||(e[12]=o("span",{style:{"padding-left":"10px"}},"Go back",-1))]),e[14]||(e[14]=o("div",null,null,-1)),o("div",De,[i(m,{slot:"separator",size:"large",icon:t.iconsContent.help},null,8,["icon"]),e[13]||(e[13]=o("span",{style:{"padding-left":"10px"}}," Need any help?",-1))])])]),_:1}),i(Y,null,{default:r(()=>[o("div",Ce,[o("div",Pe,[o("div",ke,"New "+y(t.programID()!=33?"patient":"client")+" registration",1)]),o("div",Le,[i(m,{class:T(t.iconListStatus),icon:t.list,onClick:e[1]||(e[1]=S=>t.setDisplayType("list"))},null,8,["class","icon"]),i(m,{class:T(t.iconGridStatus),style:{"font-size":"21px","margin-top":"1.5px"},icon:t.grid,onClick:e[2]||(e[2]=S=>t.setDisplayType("grid"))},null,8,["class","icon"])])]),t.registrationDisplayType=="grid"&&t.screenWidth>991?(c(),_("div",we,[t.registrationDisplayType=="grid"?(c(),_("div",Te,[o("div",Re,[i($)]),o("div",$e,[i(N),t.regSelectedCountry=="Malawi"?(c(),g(B,{key:0})):h("",!0),t.regSelectedCountry=="Malawi"?(c(),g(v,{key:1})):h("",!0)]),o("div",Ne,[t.isPatientTypeRequired?(c(),g(M,{key:0})):h("",!0),t.checkUnderFourteen?(c(),g(U,{key:1})):h("",!0),t.checkUnderNine?(c(),g(E,{key:2})):h("",!0),i(G)])])):h("",!0)])):h("",!0),t.registrationDisplayType=="list"||t.screenWidth<=991?(c(),_("div",Be,[t.currentStep=="Personal Information"?(c(),_("div",He,[i($)])):h("",!0),t.currentStep=="Location"?(c(),_("div",Oe,[o("div",Ae,[o("div",null,[i(N)]),t.regSelectedCountry=="Malawi"?(c(),_("div",Ge,[i(B)])):h("",!0),t.regSelectedCountry=="Malawi"?(c(),_("div",Fe,[i(v)])):h("",!0)])])):h("",!0),t.currentStep=="Patient Type"&&t.isPatientTypeRequired?(c(),_("div",Me,[i(M)])):h("",!0),t.currentStep=="Social History"?(c(),_("div",Ue,[t.checkUnderFourteen?(c(),g(U,{key:0})):h("",!0),t.checkUnderFive?(c(),g(E,{key:1})):h("",!0)])):h("",!0),t.currentStep=="Guardian Information"?(c(),_("div",Ee,[i(G)])):h("",!0)])):h("",!0)]),_:1}),t.registrationDisplayType=="grid"&&t.screenWidth>991?(c(),_("div",We,[i(s,{name:"Save",iconSlot:"end",icon:t.iconsContent.saveWhite,disabledValue:t.disableSaveBtn,onClick:e[3]||(e[3]=S=>t.createPatient())},null,8,["icon","disabledValue"])])):h("",!0),t.registrationDisplayType=="list"||t.screenWidth<=991?(c(),g(C,{key:2},{default:r(()=>[o("div",Ve,[t.currentStep=="Personal Information"?(c(),g(s,{key:0,name:"Cancel",color:"danger",onClick:e[4]||(e[4]=S=>t.cancel(S))})):(c(),g(s,{key:1,name:"Previous",icon:t.iconsContent.arrowLeftWhite,color:"medium",onClick:t.previousStep},null,8,["icon","onClick"])),i(l,{class:"breadcrumbs displayNoneMobile"},{default:r(()=>[i(w,{onClick:e[5]||(e[5]=S=>t.setCurrentStep("Personal Information")),class:T({active:t.currentStep==="Personal Information"})},{separator:r(()=>[i(m,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:r(()=>[e[15]||(e[15]=o("span",{class:"breadcrumb-text"},"Personal Information",-1))]),_:1,__:[15]},8,["class"]),i(w,{onClick:e[6]||(e[6]=S=>t.setCurrentStep("Location")),class:T({active:t.currentStep==="Location"})},{separator:r(()=>[i(m,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:r(()=>[e[16]||(e[16]=o("span",{class:"breadcrumb-text"},"Location",-1))]),_:1,__:[16]},8,["class"]),t.isPatientTypeRequired?(c(),g(w,{key:0,onClick:e[7]||(e[7]=S=>t.setCurrentStep("Patient Type")),class:T({active:t.currentStep==="Patient Type"})},{separator:r(()=>[i(m,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:r(()=>[e[17]||(e[17]=o("span",{class:"breadcrumb-text"},"Patient Type",-1))]),_:1,__:[17]},8,["class"])):h("",!0),i(w,{onClick:e[8]||(e[8]=S=>t.setCurrentStep("Social History")),class:T({active:t.currentStep==="Social History"})},{separator:r(()=>[i(m,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:r(()=>[e[18]||(e[18]=o("span",{class:"breadcrumb-text"},"Social History",-1))]),_:1,__:[18]},8,["class"]),i(w,{onClick:e[9]||(e[9]=S=>t.setCurrentStep("Guardian Information")),class:T({active:t.currentStep==="Guardian Information"})},{separator:r(()=>[i(m,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:r(()=>[e[19]||(e[19]=o("span",{class:"breadcrumb-text"},"Guardian Information",-1))]),_:1,__:[19]},8,["class"])]),_:1}),t.currentStep=="Guardian Information"?(c(),g(s,{key:2,name:"Save",iconSlot:"end",icon:t.iconsContent.saveWhite,onClick:e[10]||(e[10]=S=>t.createPatient())},null,8,["icon"])):(c(),g(s,{key:3,name:"Next",disabledValue:!1,iconSlot:"end",icon:t.iconsContent.arrowRightWhite,onClick:t.nextStep},null,8,["icon","onClick"]))])]),_:1})):h("",!0)]),_:1},8,["class"])}const Li=q(be,[["render",qe],["__scopeId","data-v-3fc0b84a"]]);export{Li as default};

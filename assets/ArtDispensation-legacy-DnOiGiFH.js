!function(){function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}System.register(["./vendor-legacy-COMGl7lq.js","./app_encounter_service-legacy-CRpl_PwT.js","./index-legacy-D8VDxbcK.js","./lodash-legacy-C-x9g9Na.js"],(function(t,r){"use strict";var n,a,i,u,s,o,d,l,c,g,y,p,m,f,v,h,_,b,D,k,q,S,w,O,P,z,x,I,M,A,C,j;return{setters:[e=>{n=e.d,a=e.r,i=e.a,u=e.y,s=e.f,o=e.z,d=e.l,l=e.u,c=e.ad,g=e.e,y=e.bq,p=e.ac,m=e.ab,f=e.A,v=e.F,h=e.L,_=e.k,b=e.B,D=e.ar,k=e.m,q=e.aa,S=e.I,w=e.aR,O=e.ag},e=>{P=e.A},e=>{z=e.S,x=e.a5,I=e.P,M=e.t,A=e.m,C=e._},e=>{j=e.l}],execute:function(){var r=document.createElement("style");r.textContent="ion-col[data-v-438ac855]{border-right:1px dotted #ccc}\n/*$vite$:1*/",document.head.appendChild(r);class H extends z{constructor(){super()}static async fetchAvailableDrugStock(e){const t=await this.getJson("pharmacy/items",{drug_id:e});if(!j.isEmpty(t))return t.map((e=>({quantity:e.current_quantity,packSize:e.pack_size})))}}const E={11:[30],21:[25],22:[60],24:[30,60,90,100],30:[90],39:[60],73:[120],74:[60],76:[1e3],297:[30,60,90],576:[30,60,90],613:[60],731:[60],732:[60],733:[60],734:[30],735:[30],736:[60],738:[60],931:[12,30,60],932:[30],954:[60],963:[30,60,90],968:[60],969:[30],971:[30,60,90],976:[60],977:[30],982:[30],983:[30,90],1039:[30,60,90],1043:[60],1044:[30],1056:[24],1216:[3,6,8,12]};class B extends P{constructor(t,r){super(t,54,r),e(this,"drugHistory",void 0),e(this,"currentDrugOrder",void 0),e(this,"useDrugManagement",void 0),this.drugHistory=[],this.currentDrugOrder=[],this.useDrugManagement=!1}setIsDrugManagementEnabled(e){this.useDrugManagement=e}async loadDrugManagementEnabled(){this.useDrugManagement=!1}getDrugHistory(){return this.drugHistory}getCurrentOrder(){return this.currentDrugOrder}buildDispensations(e,t,r){const n=[];for(let a=0;a<r;a++)n.push({drug_order_id:e,date:this.date,quantity:t/r});return n}saveDispensations(e){return P.postJson("/dispensations",{dispensations:e,program_id:P.getProgramID()})}async voidOrder(e){return P.void(`/dispensations/${e}`,{})}async loadDrugHistory(){try{this.drugHistory=await x.getDrugOrderHistory(this.patientID)||[]}catch(e){console.warn(e)}}async loadCurrentDrugOrder(){if(this.currentDrugOrder=await x.getDrugOrders(this.patientID)||[],this.useDrugManagement)for(const e of this.currentDrugOrder){const t=await H.fetchAvailableDrugStock(e.drug.drug_id);e.stocks=this.groupByPackSize(t)}}groupByPackSize(e){const t=new Map;return null==e||e.forEach((({packSize:e,quantity:r})=>{var n,a;e&&(t.has(e)?t.set(e,{packSize:e,quantity:r+(null!==(n=null===(a=t.get(e))||void 0===a?void 0:a.quantity)&&void 0!==n?n:0)}):t.set(e,{quantity:r,packSize:e}))})),Array.from(t.values())}getDrugPackSizes(e){return e in E?E[e]:[30,60,90]}calcCompletePack(e,t){var r;const n=(null!==(r=e.barcodes)&&void 0!==r?r:[]).sort(((e,t)=>e.tabs-t.tabs));if(0==n.length||0==t)return t;for(const a in n){const{tabs:e}=n[a];if(parseInt(e)>=t)return e}return parseInt(n[n.length-1].tabs)}}const V={key:0},$={key:1},F={style:{"margin-top":"10%"},class:"ion-text-center"};t("default",C(n({__name:"ArtDispensation",setup(e,{expose:t}){const r=a([]),n=new I,P=new B(n.getID(),-1);function z(e){if(!e.quantity)return"";const t=parseInt(`${e.quantity}`)/e.amount_needed*100;return t>110?"You are dispensing over 110% of prescribed amount":t<100?"You are dispensing less than 100% of prescribed amount":void 0}return i((()=>{P.loadCurrentDrugOrder().then((()=>{r.value=P.getCurrentOrder().map((e=>{var t;return{name:e.drug.name,quantity:e.quantity,drug_id:e.drug.drug_id,order_id:e.order.order_id,amount_needed:(()=>{const t=parseFloat(e.amount_needed)-(e.quantity||0);return t<=0?0:P.calcCompletePack(e.order,t)})(),pack_sizes:P.getDrugPackSizes(e.drug.drug_id),disabled:(null!==(t=e.quantity)&&void 0!==t?t:0)>0}}))}))})),t({onSubmit:async function(){const e=r.value.filter((e=>e.quantity>=1&&!e.disabled)).map((e=>P.buildDispensations(e.order_id,parseInt(e.quantity),1)));return e.length<=0?(M("Please enter one or more drug quantities"),!1):!!(await Promise.all(e.map((e=>P.saveDispensations(e))))).every(Boolean)||(A("An error has occured"),!1)}}),(e,t)=>(s(),u(l(O),{style:{width:"90%",margin:"0px auto","min-height":"40vh"}},{default:o((()=>[d(l(c),null,{default:o((()=>[r.value.length?(s(),g("div",V,[d(l(y),null,{default:o((()=>[d(l(p),{style:{"font-weight":"bold"}},{default:o((()=>[d(l(m),null,{default:o((()=>t[0]||(t[0]=[f("Medication")]))),_:1,__:[0]}),d(l(m),{class:"ion-text-center"},{default:o((()=>t[1]||(t[1]=[f("Amount needed")]))),_:1,__:[1]}),d(l(m),null,{default:o((()=>t[2]||(t[2]=[f("Quantity")]))),_:1,__:[2]})])),_:1}),(s(!0),g(v,null,h(r.value,((e,t)=>(s(),u(l(p),{key:t},{default:o((()=>[d(l(m),null,{default:o((()=>[_("h3",null,b(e.name),1)])),_:2},1024),d(l(m),{class:"ion-text-center"},{default:o((()=>[d(l(D),{fill:"solid",readonly:"",value:e.amount_needed},null,8,["value"])])),_:2},1024),d(l(m),null,{default:o((()=>[d(l(D),{disabled:e.disabled,modelValue:e.quantity,"onUpdate:modelValue":t=>e.quantity=t,type:"number",fill:"outline"},null,8,["disabled","modelValue","onUpdate:modelValue"]),!e.disabled&&z(e)?(s(),u(l(q),{key:0,style:{color:"red"}},{default:o((()=>[f(b(z(e)),1)])),_:2},1024)):k("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])):(s(),g("div",$,[_("div",F,[d(l(S),{style:{"font-size":"5rem!important"},icon:l(w)},null,8,["icon"]),t[3]||(t[3]=_("h1",null,"No Dispensations needed at the moment",-1))])]))])),_:1})])),_:1}))}}),[["__scopeId","data-v-438ac855"]]))}}}))}();

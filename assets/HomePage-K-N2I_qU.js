var me=Object.defineProperty;var he=(t,e,i)=>e in t?me(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Q=(t,e,i)=>he(t,typeof e!="symbol"?e+"":e,i);import{d as M,cA as fe,au as Jt,r as R,c as bt,w as ot,a as Dt,e as h,f as r,k as n,m as k,p as X,B as g,l as a,u as G,a3 as It,A as O,I as J,F as x,L as z,cB as ge,b_ as _e,aB as ve,bA as ye,bn as be,bS as Pt,bX as De,E as u,z as s,R as Ce,ar as Y,cC as $e,cD as Se,cE as we,cF as At,bd as ke,cG as Ie,cH as Pe,cI as Ae,cJ as Te,cK as Oe,cL as Ne,cM as Re,cN as Be,a2 as xe,bG as Le,at as Ve,n as jt,y as V,ab as mt,W as Qt,aa as ht,U as K,af as Tt,S as Z,a9 as q,cO as Fe,aS as St,b2 as Ct,$ as tt,cP as Yt,aO as Zt,cw as Ot,D as qt,bo as Xt,T as rt,as as lt,ac as nt,G as at,X as Nt,a1 as Kt,cQ as Ue,cR as Ee,cS as Me,cT as We,bw as ft,bM as ze,a0 as He,aZ as Ge,a_ as Je,a$ as je,b0 as Qe,cU as Ye,cl as Rt,cm as Ze,bN as qe}from"./vendor-Oa4k5SKv.js";import{S as E,u as et,_ as H,H as P,A as Xe,a as te,P as it,b as ee,c as Ke,d as gt,E as Ut,e as ne,B as ae,t as Et,f as Mt,i as Bt,g as wt,h as xt,j as Lt,k as tn,l as $t,m as en,n as se,U as Vt,T as oe,o as nn,p as an,q as st,r as Wt,s as zt,v as sn,w as Ht,L as on}from"./index-O2bGotdG.js";import{m as ie}from"./apexcharts-B1bBG-op.js";import{A as re,B as _t}from"./ncd_appointment_service-C5w_Ot0k.js";import{D as le}from"./DateInputField-BOVSYCyK.js";import{C as rn}from"./chartjs-CU-OYbUw.js";import{B as dt}from"./BasicForm-BqczucN0.js";import{u as ln}from"./AdministerOtherVaccinesStore-BS5eCAMm.js";import{_ as de}from"./customDatePicker.vue_vue_type_style_index_0_lang-C-iwy6Ni.js";import{s as dn}from"./vaccines_service-DvJKzcK9.js";import{l as yt}from"./lodash-Dt8AsbQm.js";import{g as cn}from"./dashboard_service-DEfUYgFM.js";import{i as un}from"./Img-CJEgX1Vr.js";import pn from"./FacilityReports-DuSLzIgE.js";import{M as mn,_ as hn}from"./ActionButtons.vue_vue_type_script_setup_true_lang-C6CA0ygQ.js";import"./sms_service-AJyUxjd3.js";import"./EIRreportsStore-CLgfbiO8.js";import"./Export-hBIXTQto.js";class Gt extends E{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(e){return await super.getJson("fhir/patient/".concat(e),{id:e})}static async getFhirObservations(e){return await super.getJson("fhir/patient/".concat(e,"/observations/"),{id:e})}}const fn={class:"fhir-viewer"},gn={class:"container"},_n={key:0,class:"main-header"},vn={class:"header-line"},yn={key:0,class:"last-updated-display"},bn={key:1,class:"card initial-input-card"},Dn={class:"action-area-initial"},Cn={key:0,class:"card patient-card"},$n={class:"card-title"},Sn={class:"patient-info-grid"},wn={class:"info-item"},kn={class:"info-value"},In={class:"info-item"},Pn={class:"info-value"},An={class:"info-item"},Tn={class:"info-value"},On={class:"info-item"},Nn={class:"info-value"},Rn={class:"info-value"},Bn={class:"info-value"},xn={class:"info-label"},Ln={class:"info-value"},Vn={key:2,class:"card observations-card"},Fn={class:"card-title"},Un={class:"observations-grid"},En={class:"obs-header"},Mn={class:"obs-title"},Wn={class:"obs-details"},zn={class:"obs-detail obs-value-highlight"},Hn={class:"obs-value"},Gn={class:"obs-detail"},Jn={class:"obs-value"},jn={key:0,class:"obs-detail"},Qn={class:"obs-value"},Yn={key:3,class:"no-data-found"},Zn={key:4,class:"no-data-found"},qn={key:5,class:"main-footer"},Xn=M({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(t){fe({"person-circle-outline":De,"clipboard-outline":Pt,"search-outline":be,"information-circle-outline":ye,"alert-circle-outline":ve,"person-add-outline":_e,"arrow-back-outline":ge});const e=t,i=Jt(),c=R(!1),l=R([]),b=R(),d=R(),p=R(null),D=R([]),f=bt(()=>l.value.some(v=>v.resourceType==="Bundle"&&v.entry&&v.entry.some(o=>o.resource&&o.resource.resourceType==="Patient"))),m=bt(()=>D.value.length>0),$=async()=>{if(l.value=[],d.value=null,p.value=null,D.value=[],!b.value){console.error("Please enter a Patient Identifier.");return}c.value=!0;try{const v=await Gt.getFhirPatient(b.value);if(v&&v.entry&&v.entry.length>0){const o=v.entry[0].resource,B=o.id,N=await Gt.getFhirObservations(B);l.value=[v],N&&(l.value.push(N),D.value=N.entry.filter(W=>W.resource&&W.resource.resourceType==="Observation").map(W=>{const w=W.resource;return{id:w.id,display:vt(w),value:Ft(w),date:w.effectiveDateTime,category:w.category&&w.category[0]&&w.category[0].coding&&w.category[0].coding[0]?w.category[0].coding[0].display||w.category[0].coding[0].code:"N/A"}}));const A=o.name&&o.name[0];p.value={personInformation:{given_name:A&&A.given?A.given.join(" "):"",middle_name:A&&A.middle?A.middle.join(" "):"",family_name:A&&A.family?A.family:"",gender:o.gender=="male"?"M":(o==null?void 0:o.gender)=="female"?"F":"",birthdate:o.birthDate||"",cell_phone_number:o.telecom&&o.telecom[0]?o.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:o.contact&&o.contact[0]&&o.contact[0].telecom?o.contact[0].telecom[0].value:""}]}};const S=[v,N].filter(Boolean).reduce((W,w)=>{if(w.meta&&w.meta.lastUpdated){const j=new Date(w.meta.lastUpdated);return W===null||j>W?j:W}return W},null);S&&(d.value=U(S.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch(v){console.error("Error loading FHIR data:",v),l.value=[],d.value=null,p.value=null,D.value=[]}finally{c.value=!1}},_=v=>{if(v.name&&v.name[0]){const o=v.name[0],B=o.given?o.given.join(" "):"",N=o.family||"";return"".concat(B," ").concat(N).trim()||"N/A"}return"N/A"},C=v=>v.identifier&&v.identifier.length>0?v.identifier.map(o=>{let B="Unknown System";if(o.type&&o.type.coding&&o.type.coding[0]&&o.type.coding[0].display)B=o.type.coding[0].display;else if(o.system){const A=o.system.split("/");B=A[A.length-1]||o.system,o.system==="urn:oid:2.16.840.1.113883.4.6"&&(B="Social Security Number")}sessionStorage.setItem(B,o.value);let N=null;return o.assigner&&o.assigner.display?N=o.assigner.display:o.assigner&&o.assigner.reference&&(N=o.assigner.reference.split("/").pop()||o.assigner.reference),{value:o.value||"N/A",systemDisplay:B,periodStart:o.period?o.period.start:null,periodEnd:o.period?o.period.end:null,assignerDisplay:N}}):[],I=v=>v.telecom&&v.telecom.length>0?v.telecom.filter(o=>o.system==="phone"&&o.value):[],y=v=>{if(v.contact&&v.contact.length>0){const o=v.contact.filter(N=>{var A;return(A=N.relationship)==null?void 0:A.some(T=>{var S;return(S=T.coding)==null?void 0:S.some(W=>W.code==="GUARD")})}),B=[];return o.forEach(N=>{N.telecom&&N.telecom.length>0&&N.telecom.filter(A=>A.system==="phone"&&A.value).forEach(A=>B.push(A))}),B}return[]},F=v=>{if(!v)return"N/A";try{return new Date(v).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(o){return console.error("Invalid date string for formatDate:",v,o),"Invalid Date"}},U=v=>{if(!v)return"N/A";try{return new Date(v).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(o){return console.error("Invalid date time string for formatDateTime:",v,o),"Invalid Date/Time"}},L=v=>{if(!v)return"N/A";try{const o=new Date,B=new Date(v);let N=o.getFullYear()-B.getFullYear();const A=o.getMonth()-B.getMonth();return(A<0||A===0&&o.getDate()<B.getDate())&&N--,N}catch(o){return console.error("Invalid birth date string for calculateAge:",v,o),"N/A"}},ct=v=>{if(v.meta&&v.meta.tag){const o=v.meta.tag.find(B=>B.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return o?o.code:"Unknown"}return"Unknown"},vt=v=>v.code&&v.code.coding&&v.code.coding[0]&&(v.code.coding[0].display||v.code.coding[0].code)||"Unknown Observation",Ft=v=>v.valueQuantity?"".concat(v.valueQuantity.value," ").concat(v.valueQuantity.unit||"").trim():v.valueString?v.valueString:v.valueBoolean!==void 0?v.valueBoolean?"True":"False":"N/A",ce=()=>{et().setRecord(p.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(D.value)),pe("/registration/manual")},ue=()=>{l.value=[],b.value="",d.value=null,p.value=null,D.value=[]},pe=v=>{i.push({path:v})};return ot(()=>i,async()=>{l.value=[],D.value=[]},{deep:!0}),Dt(()=>{var v;if(e.initialData.length>0){l.value=e.initialData;const B=e.initialData.filter(Boolean).reduce((T,S)=>{if(S.meta&&S.meta.lastUpdated){const W=new Date(S.meta.lastUpdated);return T===null||W>T?W:T}return T},null);B&&(d.value=U(B.toISOString()));const N=e.initialData.find(T=>T.resourceType==="Bundle"&&T.entry&&T.entry.some(S=>S.resource&&S.resource.resourceType==="Patient"));if(N){const T=(v=N.entry.find(S=>S.resource&&S.resource.resourceType==="Patient"))==null?void 0:v.resource;if(T){const S=T.name&&T.name[0];p.value={personInformation:{given_name:S&&S.given?S.given.join(" "):"",middle_name:S&&S.middle?S.middle.join(" "):"",family_name:S&&S.family?S.family:"",gender:T.gender||"",birthdate:T.birthDate||""}}}}const A=e.initialData.find(T=>T.resourceType==="Bundle"&&T.entry&&T.entry.some(S=>S.resource&&S.resource.resourceType==="Observation"));A&&(D.value=A.entry.filter(T=>T.resource&&T.resource.resourceType==="Observation").map(T=>{const S=T.resource;return{id:S.id,display:vt(S),value:Ft(S),date:S.effectiveDateTime,category:S.category&&S.category[0]&&S.category[0].coding&&S.category[0].coding[0]?S.category[0].coding[0].display||S.category[0].coding[0].code:"N/A"}}))}}),(v,o)=>{var B,N,A,T,S,W;return r(),h("div",fn,[n("div",gn,[(B=l.value)!=null&&B.length?(r(),h("header",_n,[n("div",vn,[o[1]||(o[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:X(["last-updated-display","status-"+ct(l.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+g(ct(l.value[0].entry[0].resource)),3),d.value?(r(),h("span",yn,"Last Updated: "+g(d.value),1)):k("",!0)])])])):k("",!0),(N=l.value)!=null&&N.length?k("",!0):(r(),h("section",bn,[a(G(It),{modelValue:b.value,"onUpdate:modelValue":o[0]||(o[0]=w=>b.value=w),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",Dn,[n("button",{onClick:$,class:"load-data-btn"},[a(G(J),{name:"search-outline"}),o[2]||(o[2]=O(" Find Patient "))])])])),(r(!0),h(x,null,z(l.value,w=>(r(),h("div",{key:w.id},[w.resourceType==="Bundle"&&w.entry&&w.entry[0]&&w.entry[0].resource.resourceType==="Patient"?(r(),h("section",Cn,[n("h2",$n,[a(G(J),{name:"person-circle-outline"}),o[3]||(o[3]=O(" Patient Demographics"))]),n("div",Sn,[n("div",wn,[o[4]||(o[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",kn,g(_(w.entry[0].resource)),1)]),n("div",In,[o[5]||(o[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",Pn,g(w.entry[0].resource.gender||"Not specified"),1)]),n("div",An,[o[6]||(o[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",Tn,g(F(w.entry[0].resource.birthDate)),1)]),n("div",On,[o[7]||(o[7]=n("span",{class:"info-label"},"Age",-1)),n("span",Nn,g(L(w.entry[0].resource.birthDate))+" years",1)]),I(w.entry[0].resource).length?(r(!0),h(x,{key:0},z(I(w.entry[0].resource),(j,pt)=>(r(),h("div",{key:"patient-phone-".concat(pt),class:"info-item"},[o[8]||(o[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",Rn,g(j.value),1)]))),128)):k("",!0),y(w.entry[0].resource).length?(r(!0),h(x,{key:1},z(y(w.entry[0].resource),(j,pt)=>(r(),h("div",{key:"guardian-phone-".concat(pt),class:"info-item"},[o[9]||(o[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",Bn,g(j.value),1)]))),128)):k("",!0),(r(!0),h(x,null,z(C(w.entry[0].resource),(j,pt)=>(r(),h("div",{key:j.value||pt,class:"info-item"},[n("span",xn,g(j.systemDisplay),1),n("span",Ln,g(j.value),1)]))),128))])])):k("",!0)]))),128)),((A=D.value)==null?void 0:A.length)>0?(r(),h("section",Vn,[n("h2",Fn,[a(G(J),{name:"clipboard-outline"}),o[10]||(o[10]=O(" Clinical Observations"))]),n("div",Un,[(r(!0),h(x,null,z(D.value,w=>(r(),h("div",{key:w.id,class:"observation-item"},[n("div",En,[n("h3",Mn,g(w.display),1)]),n("div",Wn,[n("div",zn,[o[11]||(o[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",Hn,g(w.value),1)]),n("div",Gn,[o[12]||(o[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",Jn,g(U(w.date)),1)]),w.category&&w.category!=="N/A"?(r(),h("div",jn,[o[13]||(o[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",Qn,g(w.category),1)])):k("",!0)])]))),128))])])):k("",!0),(T=l.value)!=null&&T.length&&!f.value?(r(),h("div",Yn,[n("p",null,[a(G(J),{name:"alert-circle-outline"}),o[14]||(o[14]=O(" No patient data found for the provided identifier. Please try again."))])])):(S=l.value)!=null&&S.length&&f.value&&!m.value?(r(),h("div",Zn,[n("p",null,[a(G(J),{name:"information-circle-outline"}),o[15]||(o[15]=O(" No clinical observations found for this patient."))])])):k("",!0),(W=l.value)!=null&&W.length?(r(),h("footer",qn,[n("button",{onClick:ue,class:"back-to-search-btn small-btn"},[a(G(J),{name:"arrow-back-outline"}),o[16]||(o[16]=O(" Back to Search "))]),n("button",{onClick:ce,class:"register-btn small-btn"},[a(G(J),{name:"person-add-outline"}),o[17]||(o[17]=O(" Register New Patient "))])])):k("",!0)])])}}}),Kn=H(Xn,[["__scopeId","data-v-0dc329ef"]]),ta=M({name:"referrals",components:{ExternalReferrals:Kn},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){this.segmentContent=t}}}),ea={key:0},na={style:{display:"flex","margin-top":"10px"}},aa={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},sa={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},oa={key:1};function ia(t,e,i,c,l,b){const d=u("ion-label"),p=u("ion-segment-button"),D=u("ion-segment"),f=u("ExternalReferrals");return r(),h(x,null,[n("div",null,[a(D,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:s(()=>[a(p,{value:"External referrals",onClick:e[0]||(e[0]=m=>t.setSegmentContent("External referrals"))},{default:s(()=>[a(d,null,{default:s(()=>e[2]||(e[2]=[O("External referrals")])),_:1,__:[2]})]),_:1}),a(p,{value:"Internal referrals",onClick:e[1]||(e[1]=m=>t.setSegmentContent("Internal referrals"))},{default:s(()=>[a(d,null,{default:s(()=>e[3]||(e[3]=[O("Internal referrals")])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(r(),h("div",ea,[n("div",na,[t.checkUnderFive?(r(),h("div",aa)):k("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?k("",!0):(r(),h("div",sa))])])):k("",!0),t.segmentContent=="External referrals"?(r(),h("div",oa,[a(f)])):k("",!0)],64)}const ra=H(ta,[["render",ia],["__scopeId","data-v-e09d6a6b"]]),kt=Ce("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(t){this.selectedItem=t},getSelectedItem(){return this.selectedItem}},persist:!0}),la=()=>{const t=R(null);return{activeIteminMixin:t,setActiveItem:i=>{t.value=i,console.log("lll: ",t.value)}}},ut=M({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:t,setActiveItem:e}=la();return{chevronBackOutline:Le,checkmark:xe,grid:Be,chevronDownCircle:Re,chevronForwardCircle:Ne,chevronUpCircle:Oe,colorPalette:Te,document:Ae,globe:Pe,medkit:Ie,add:ke,person:At,people:we,thermometer:Se,clipboard:$e,activeIteminMixin:t,setActiveItem:e}},async mounted(){await this.setAppointments()},computed:{...Y(et,["patient"])},watch:{$route:{async handler(t){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await Xe.getDailiyAppointments(P.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((t,e)=>t.given_name.localeCompare(e.given_name)))},formatBirthdate(t){return P.getBirthdateAge(t)},setActiveItemRefFN(t){kt().setSelectedItem(t)}}}),da=M({name:"NCDDashboard",mixins:[ut],components:{ApexChart:ie},setup(){return{router:Jt()}},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await jt(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){try{return E.getJson("programs/32/reports/ncd_dashboard",{start_date:P.toStandardHisFormat(P.sessionDate()),end_date:P.toStandardHisFormat(P.sessionDate())})}catch(t){return[]}},navigationMenu(t){try{Ve.close(),this.router.push(t).then(()=>{})}catch(e){console.error(e)}}}}),ca={class:"cards-container"},ua={class:"top-card-text"},pa={class:"text-2xl font-bold"},ma={class:"top-card-text"},ha={class:"text-2xl font-bold"},fa={class:"top-card-text"},ga={class:"text-2xl font-bold"},_a={class:"top-card-text"},va={class:"text-2xl font-bold"},ya={class:"top-card-text"},ba={class:"text-2xl font-bold"},Da={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},Ca={ref:"chartRef1"},$a={ref:"chartRef2"};function Sa(t,e,i,c,l,b){const d=u("ion-card-content"),p=u("ion-card"),D=u("ApexChart");return r(),h(x,null,[n("div",ca,[a(p,{class:"top-card action-card",onClick:e[0]||(e[0]=f=>t.setActiveItemRefFN("appointments"))},{default:s(()=>[a(d,null,{default:s(()=>[n("div",ua,[n("div",pa,g(t.appointments.length),1),e[2]||(e[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]),_:1})]),_:1}),a(p,{class:"top-card action-card"},{default:s(()=>[a(d,null,{default:s(()=>{var f;return[n("div",ma,[n("div",ha,g((f=t.dashboardData)==null?void 0:f.total_pending_dispensations),1),e[3]||(e[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]}),_:1})]),_:1}),a(p,{class:"top-card action-card"},{default:s(()=>[a(d,null,{default:s(()=>{var f;return[n("div",fa,[n("div",ga,g((f=t.dashboardData)==null?void 0:f.total_defaulters),1),e[4]||(e[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]}),_:1})]),_:1}),a(p,{class:"top-card action-card"},{default:s(()=>[a(d,null,{default:s(()=>{var f;return[n("div",_a,[n("div",va,g((f=t.dashboardData)==null?void 0:f.total_complications),1),e[5]||(e[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]}),_:1})]),_:1}),a(p,{class:"top-card action-card",onClick:e[1]||(e[1]=f=>t.navigationMenu("NCDActivePatients"))},{default:s(()=>[a(d,null,{default:s(()=>{var f;return[n("div",ya,[n("div",ba,g((f=t.dashboardData)==null?void 0:f.total_client_registered),1),e[6]||(e[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]}),_:1})]),_:1})]),n("div",Da,[a(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(d,null,{default:s(()=>[e[7]||(e[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",Ca,[t.isChartReady?(r(),V(D,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1,__:[7]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(d,null,{default:s(()=>[e[8]||(e[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",$a,[t.isChartReady?(r(),V(D,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1,__:[8]})]),_:1})])],64)}const wa=H(da,[["render",Sa],["__scopeId","data-v-18251377"]]),ka=M({name:"Home",mixins:[te,ut],components:{IonContent:q,IonHeader:Z,IonPage:Tt,IonToolbar:K,IonRow:ht,DateInputField:le,IonIcon:J,IonButton:Qt,IonCol:mt},data(){const t=localStorage.getItem("ncdStartDate"),e=localStorage.getItem("ncdEndDate"),i=R(t||P.sessionDate()),c=R(e||P.sessionDate()),l=R(P.sessionDate()),b=R([]);return{minDate:l,startDate:i,endDate:c,people:b,calendarOutline:St,openOutline:Fe}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{formatBirthdate(t){return P.getBirthdateAge(t)},async getAppointments(){if(ee().apiStatus){this.people=[];try{(await re.getAppointments(this.startDate,this.endDate,"")).forEach(i=>{const c={person_id:i.person_id,npid:i.npid,appointment_id:103,encounter_id:i.encounter_id,name:i.given_name.concat(" ",i.family_name),gender:i.gender,ageDob:this.formatBirthdate(i.birthdate),village:i.city_village,appointmentDate:P.toStandardHisDisplayFormat(i.appointment_date)};this.people.push(c)})}catch(e){}}},async getAppointmentsD1(t){this.startDate=P.toStandardHisFormat(t),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=P.toStandardHisFormat(t),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(t){const e=await it.findByNpid(t);et().setPatientRecord(e[0]),this.redirectUser()},redirectUser(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(i=>e.some(c=>c.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")}}}),Ia={class:"appointments-container"},Pa={class:"date-filter"},Aa={class:"appointments-table"};function Ta(t,e,i,c,l,b){const d=u("DateInputField"),p=u("ion-col"),D=u("ion-row"),f=u("ion-icon"),m=u("ion-button"),$=u("ion-card");return r(),h("div",Ia,[n("div",Pa,[a(D,null,{default:s(()=>[a(p,null,{default:s(()=>[a(d,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(p,null,{default:s(()=>[a(d,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})]),t.people.length>0?(r(),V($,{key:0},{default:s(()=>[n("table",Aa,[e[0]||(e[0]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(r(!0),h(x,null,z(t.people,_=>(r(),h("tr",{key:_.npid},[n("td",null,[a(D,null,{default:s(()=>[a(p,null,{default:s(()=>[O(g(_.name),1)]),_:2},1024),a(p,null,{default:s(()=>[a(m,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:C=>t.openClientProfile(_.npid),color:"primary",fill:"clear",size:"small"},{default:s(()=>[a(f,{icon:t.openOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,g(_.npid),1),n("td",null,g(_.ageDob),1),n("td",null,g(_.gender),1),n("td",null,g(_.village),1),n("td",null,g(_.appointmentDate),1)]))),128))])])]),_:1})):(r(),V($,{key:1},{default:s(()=>e[1]||(e[1]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])),_:1,__:[1]}))])}const Oa=H(ka,[["render",Ta],["__scopeId","data-v-9dc99262"]]),Na={key:0,class:"left_col"},Ra={class:"nav-menu"},Ba=["onClick"],xa={class:"ellipsis"},La={key:1,style:{"padding-left":"20px","padding-right":"20px"}},Va=M({__name:"NCDDashboard",setup(t){const e=kt(),i=bt(()=>e.selectedItem),{screenWidth:c}=Ke(),l=R([{id:"dashboard",label:"Dashboard",icon:Yt},{id:"referrals",label:"Referrals",icon:Zt},{id:"appointments",label:"Appointments",icon:St}]),b=R("dashboard"),d=gt(),{substance:p}=Ct(d);ot(()=>p.value,(f,m)=>{f!==m&&console.log("Substance changed:",f)},{deep:!0,immediate:!0});const D=f=>{b.value=f,kt().setSelectedItem(b.value)};return ot(()=>i.value,f=>{console.log("Active item from mixin changed:",f),f&&f!=null&&D(f)},{immediate:!0}),(f,m)=>{const $=u("ion-segment-button"),_=u("ion-segment");return r(),h("div",{style:tt(G(c)>940?"display: flex":"display: block")},[G(c)>940?(r(),h("div",Na,[n("nav",Ra,[n("ul",null,[(r(!0),h(x,null,z(l.value,C=>(r(),h("li",{key:C.id,class:X({active:b.value===C.id}),onClick:I=>D(C.id)},[a(G(J),{icon:C.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",xa,g(C.label),1)],10,Ba))),128))])])])):k("",!0),G(c)<=940?(r(),h("div",La,[a(_,{value:b.value,style:{"margin-top":"5px","justify-content":"left"}},{default:s(()=>[(r(!0),h(x,null,z(l.value,C=>(r(),V($,{value:C.id,key:C.id,class:X({active:b.value===C.id}),onClick:I=>D(C.id)},{default:s(()=>[a(G(J),{icon:C.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,g(C.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):k("",!0),n("div",{class:"right_col",style:tt(G(c)>940?"width: 85%":"width: 100%")},[n("div",null,[b.value==="referrals"?(r(),V(ra,{key:0})):k("",!0),b.value==="dashboard"?(r(),V(wa,{key:1})):k("",!0),b.value==="appointments"?(r(),V(Oa,{key:2})):k("",!0)])],4)],4)}}}),Fa=H(Va,[["__scopeId","data-v-a1132315"]]),Ua=""+new URL("icon/checklist.svg",import.meta.url).href,Ea=""+new URL("icon/dashboard.svg",import.meta.url).href,Ma={name:"Dashboard",setup(){Dt(async()=>{i.value=await p(),await D();const m=await f(),{labels:$,totalVisits:_,incompleteVisits:C}=t(m);e($,_,C)});function t(m){if(!m)return{labels:[],totalVisits:[],incompleteVisits:[]};const $=[],_=[],C=[];return Object.entries(m).forEach(([I,y])=>{const U=new Date(I).toLocaleDateString("en-US",{weekday:"long"});$.push(U),_.push(y.complete),C.push(y.incomplete)}),{labels:$,totalVisits:_,incompleteVisits:C}}function e(m,$,_){const C=document.getElementById("myChart");new rn(C,{type:"bar",data:{labels:m,datasets:[{label:"Total visits",data:$,backgroundColor:"#5aa3b1"},{label:"Incomplete visits",data:_,backgroundColor:"#dba6a2"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}const i=R([]),c=R({}),l=m=>{const $=Object.entries(Ut).find(([_,C])=>C===m);return $?$[0]:"Unknown (".concat(m,")")},b=m=>Object.keys(m).map($=>{var F,U;const _=Number($),C=l(_),I=((F=m[_])==null?void 0:F.F)||0,y=((U=m[_])==null?void 0:U.M)||0;return{encounter:d(C),female:I,male:y,me:I+y,facility:I+y}}),d=m=>m.toLowerCase().replace(/_/g," ").replace(/\b\w/g,$=>$.toUpperCase()),p=async()=>{try{const m=Object.values(Ut).filter(y=>typeof y=="number"),[$,_]=await Promise.all([E.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:m}),E.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:[9,51,6,52,53,68,25,54,7],all:!0})]),C=b(_),I=b($);return C.map(y=>{const F=I.find(U=>U.encounter===y.encounter);return{...y,me:F?F.female+F.male:0}})}catch(m){return console.error("Error fetching dashboard stats:",m),[]}},D=async()=>{try{const $=new Date().toISOString().split("T")[0],_=await E.getJson("programs/1/dashboard",{date:$});c.value=_}catch(m){console.error("Error fetching visits stats:",m)}},f=async()=>{try{const m=new Date,$=new Date;$.setDate(m.getDate()-5);const _=C=>C.toISOString().split("T")[0];return await E.getJson("programs/1/reports/visits",{name:"visits",end_date:_(m),start_date:_($)})}catch(m){console.error("Error fetching visits stats:",m)}};return{checkListIcon:Ua,dashboardIcon:Ea,rows:i,dashboardScoreStats:c}}},Wa={class:"dashboard-container"},za={class:"summary-cards"},Ha={class:"card"},Ga={class:"card"},Ja={class:"card"},ja={class:"card"},Qa={class:"main-section"},Ya={class:"encounters-section"},Za={class:"his-sm-text"},qa={key:0},Xa={class:"encounter-td"},Ka={class:"other-td"},ts={class:"other-td"},es={class:"other-td"},ns={class:"other-td"},as={key:1};function ss(t,e,i,c,l,b){var d,p,D,f,m,$,_,C;return r(),h("div",Wa,[n("div",za,[n("div",Ha,[n("h2",null,g(((p=(d=c.dashboardScoreStats)==null?void 0:d.total_patients_today)!=null?p:[]).length||0),1),e[0]||(e[0]=n("p",null,"Total patients today",-1))]),n("div",Ga,[n("h2",null,g(((f=(D=c.dashboardScoreStats)==null?void 0:D.waiting_for_vitals)!=null?f:[]).length||0),1),e[1]||(e[1]=n("p",null,"Waiting for vitals",-1))]),n("div",Ja,[n("h2",null,g((($=(m=c.dashboardScoreStats)==null?void 0:m.waiting_for_consultation)!=null?$:[]).length||0),1),e[2]||(e[2]=n("p",null,"Waiting for consultation",-1))]),n("div",ja,[n("h2",null,g(((C=(_=c.dashboardScoreStats)==null?void 0:_.waiting_for_dispensation)!=null?C:[]).length||0),1),e[3]||(e[3]=n("p",null,"Waiting for dispensation",-1))])]),n("div",Qa,[e[7]||(e[7]=n("div",{class:"chart-section"},[n("h3",null,"Total visits/incomplete visits: last 5 days"),n("canvas",{id:"myChart"})],-1)),n("div",Ya,[e[6]||(e[6]=n("h3",null,"Encounters created today",-1)),n("table",Za,[e[5]||(e[5]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),c.rows.length?(r(),h("tbody",qa,[(r(!0),h(x,null,z(c.rows,(I,y)=>(r(),h("tr",{key:y},[n("td",Xa,g(I.encounter),1),n("td",Ka,g(I.female),1),n("td",ts,g(I.male),1),n("td",es,g(I.me),1),n("td",ns,g(I.facility),1)]))),128))])):(r(),h("tbody",as,e[4]||(e[4]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])))])])])])}const os=H(Ma,[["render",ss]]);class is{constructor(){Q(this,"socket",null);Q(this,"channel","ImmunizationReportChannel");Q(this,"isConnected",!1);Q(this,"pendingFetch",null);Q(this,"location_id");Q(this,"initPromise");Q(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});Q(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});Q(this,"onError",e=>{console.error("WebSocket error:",e),this.isConnected=!1});this.initPromise=this.init()}async init(){const e=localStorage.getItem("apiURL"),i=localStorage.getItem("apiPort"),c=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const l="".concat(c,"://").concat(e,"/api/v1/cable");this.socket=new WebSocket(l),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(l){console.error(l),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const e={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(e))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await E.getJson("immunization/stats",{start_date:P.getDateBeforeByDays(P.sessionDate(),365),end_date:P.sessionDate()})}async setMessageHandler(e){await this.initPromise,this.socket?this.socket.onmessage=i=>{e(i)}:console.error("WebSocket connection not established.")}}const rs=M({components:{IonContent:q,IonHeader:Z,IonItem:at,IonList:nt,IonMenu:lt,IonTitle:rt,IonToolbar:K,IonInput:It,BasicInputField:ae,BasicForm:dt,PreviousVitals:ne,customDatePicker:de,IonCol:mt,IonRow:ht,VueMultiselect:Xt,IonLabel:qt,DataTable:Ot},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:Bt,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:P.toStandardHisDisplayFormat(E.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...Y(ln,["administerOtherVaccine"]),...Y(Mt,["tempScannedBatchNumber"]),...Y(et,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await cn(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:At,pulseOutline:Kt,clipboardOutline:Pt}},methods:{formatBirthdate(t){return P.getBirthdateAge(t)},async openClientProfile(t){const e=await it.findByID(t);await et().setPatientRecord(e),this.$router.push("patientProfile")},processData(){var e;return((e=this.data)==null?void 0:e.map(i=>{if(i.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let c=[];const l=b=>b.map(p=>{let D=0;return p.clients.map(f=>{(p.drug_name==this.drug_name&&(this.village==f.table.city_village||this.village=="All")||(p.drug_name==this.drug_name||this.village==f.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:f.table.given_name,family_name:f.table.family_name,patient_id:f.table.patient_id,birthdate:f.table.birthdate,city_village:f.table.city_village}),D++),this.villageList.push(f.table.city_village)}),[p.drug_name,D]}).filter(p=>p[1]!==0);return this.title=="Client due today"&&(c=l(i.value.due_today_antigens)),this.title=="Client due this week"&&(c=l(i.value.due_this_week_antigens)),this.title=="Client due this month"&&(c=l(i.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(c=l(i.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(c=l(i.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(b=>JSON.stringify(b)))].map(b=>JSON.parse(b)),this.villageList=[...new Set(this.villageList)],c}}))[0]},handleVillageClick(t){this.drug_name="",this.village=t,this.tableData=this.processData()},handleRowClick(t){var i;this.tableEvent=t.target;const e=this.tableEvent.closest("tr");if(e){const c=Array.from(((i=e.parentNode)==null?void 0:i.children)||[]).indexOf(e),l=this.tableData[c];this.drug_name=l[0],e.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(t){return P.calculateDisplayAge(t)},openPopover(t){this.event=t,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(t){var i;const e=t.target.value;this.batchNumber=e||((i=this.tempScannedBatchNumber)==null?void 0:i.text)||""},saveBatchWithTodayDate(){let t=E.getSessionDate();this.saveDta(t)},dismiss(){Nt.dismiss()},saveBatch(){let t;yt.isEmpty(this.vaccineDate)==!0?t=E.getSessionDate():t=this.vaccineDate,this.saveDta(t)},validateVaccineName(){if(yt.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(yt.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(t){this.currentDrugOb=t},isAlphaNumeric(t){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(t)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(t){this.batchNumber=t},saveDta(t){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){Et("Enter batch number!");return}if(this.batchNumber==""){Et("Enter batch number!");return}const e={batch_number:this.batchNumber,date_administered:t,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},i=Mt();i.setAdministeredVaccine(e),dn(this.patient),this.dismiss(),i.setTempScannedBatchNumber(null)}}}),ls={key:0,class:"spinner-overlay"},ds={class:"header position_content"},cs={style:{"font-size":"1.2em","font-weight":"700"}},us={class:"dueCardContent"},ps=["onClick"],ms={style:{"margin-right":"15px"}},hs={style:{"align-items":"center",display:"flex"}},fs={style:{"line-height":"1"}},gs={class:"client_name"},_s={class:"name"},vs={class:"demographicsOtherRow"},ys={class:"demographicsText"};function bs(t,e,i,c,l,b){const d=u("ion-spinner"),p=u("ion-icon"),D=u("ion-header"),f=u("ion-card-title"),m=u("ion-card-header"),$=u("DataTable"),_=u("ion-card-content"),C=u("ion-card"),I=u("ion-item"),y=u("ion-list"),F=u("ion-popover"),U=u("ion-content");return r(),h(x,null,[t.isLoading?(r(),h("div",ls,[a(d,{name:"bubbles"}),e[3]||(e[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):k("",!0),a(D,null,{default:s(()=>[n("div",ds,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=L=>t.dismiss())},[a(p,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",cs,g(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=L=>t.openPopover(L))},[a(p,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(U,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:s(()=>[n("div",null,[a(C,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:s(()=>[a(m,null,{default:s(()=>[a(f,{class:"sectionTitle"},{default:s(()=>e[4]||(e[4]=[O(" Summary of required doses ")])),_:1,__:[4]})]),_:1}),a(_,null,{default:s(()=>[n("div",us,[a($,{options:t.options,data:t.tableData,class:"display nowrap",width:"100%",onClick:t.handleRowClick},{default:s(()=>e[5]||(e[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])),_:1,__:[5]},8,["options","data","onClick"])])]),_:1})]),_:1}),a(C,{class:"section",style:{"margin-inline":"0px"}},{default:s(()=>[a(m,null,{default:s(()=>[a(f,{class:"sectionTitle"},{default:s(()=>e[6]||(e[6]=[O("Client Details ")])),_:1,__:[6]})]),_:1}),a(_,null,{default:s(()=>[(r(!0),h(x,null,z(t.clientDetails,(L,ct)=>(r(),h("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:ct,onClick:vt=>t.openClientProfile(L.patient_id)},[n("div",ms,[n("div",{class:X((L==null?void 0:L.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(p,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),n("div",hs,[n("div",fs,[n("div",gs,[n("div",_s,g(L.given_name)+" "+g(L.family_name),1)]),n("div",vs,[n("div",ys,[O(g(L.gender=="M"?"Male":"Female")+" ",1),e[7]||(e[7]=n("span",{class:"dot"},".",-1)),O(g(t.formatBirthdate(L.birthdate)),1)])]),n("div",null,"Village: "+g(L.city_village),1)])])],8,ps))),128))]),_:1})]),_:1})]),a(F,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:t.event,onDidDismiss:e[2]||(e[2]=L=>t.popoverOpen=!1)},{default:s(()=>[n("div",null,[e[8]||(e[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(r(!0),h(x,null,z(t.villageList,(L,ct)=>(r(),V(y,{class:X(L==t.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:ct},{default:s(()=>[a(I,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:vt=>t.handleVillageClick(L)},{default:s(()=>[O(g(L),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const Ds=H(rs,[["render",bs],["__scopeId","data-v-2b76e9ce"]]),Cs=M({name:"Menu",mixins:[ut],components:{IonContent:q,IonHeader:Z,IonItem:at,IonList:nt,IonMenu:lt,IonTitle:rt,IonToolbar:K,IonCheckbox:ft,BasicForm:dt,BasicCard:_t,Carousel:We,Slide:Me,Pagination:Ee,Navigation:Ue},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},computed:{...Y(gt,["substance"]),backgroundStyle(){return{background:"linear-gradient(180deg, rgba(150, 152, 152, 0.7) 0%, rgba(255, 255, 255, 0.9) 100%), url(".concat(un("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",height:"22.8vh"}}},watch:{},async mounted(){new is().setMessageHandler(this.onMessage)},methods:{async onMessage(t){var i,c,l;const e=JSON.parse(t.data);e.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=e.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((i=this.reportData)==null?void 0:i.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((c=this.reportData)==null?void 0:c.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((l=this.reportData)==null?void 0:l.total_male_vaccinated_this_year)||0}])},openDueModal(t){const e={title:t,dashBoardData:this.reportData};wt(Ds,{class:"fullScreenModal"},!0,e)},async openClientProfile(t){const e=await it.findByNpid(t);await et().setPatientRecord(e[0]),this.$router.push("patientProfile")}}}),$s={class:"topStats"},Ss={class:"totalStats",style:{background:"linear-gradient(180deg, #20b2aa 0%, #40c0b0 50%, rgb(233, 233, 233) 100%)"}},ws={class:"statsValue",style:{"font-size":"1.4em"}},ks={class:"statsText",style:{"font-size":"0.9em"}},Is={class:"dueCardContent"},Ps={class:"statsValue"},As={class:"statsValue"},Ts={class:"statsValue"},Os={class:"overDueCardContent"},Ns={class:"statsValue"},Rs={class:"statsValue"},Bs=["onClick"],xs={style:{"margin-right":"15px"}},Ls={style:{"align-items":"center",display:"flex"}},Vs={style:{"line-height":"1"}},Fs={class:"client_name"},Us={class:"name"},Es={class:"demographicsOtherRow"},Ms={class:"demographicsText"};function Ws(t,e,i,c,l,b){const d=u("Slide"),p=u("Pagination"),D=u("Carousel"),f=u("ion-card-title"),m=u("ion-card-header"),$=u("ion-card-content"),_=u("ion-card"),C=u("ion-icon"),I=u("ion-content");return r(),V(I,{class:"content"},{default:s(()=>[n("div",$s,[n("div",null,[n("div",{style:tt(t.backgroundStyle)},[a(D,{autoplay:4e3,"wrap-around":!0,itemsToShow:1.2,transition:600,style:{"padding-top":"20px"}},{addons:s(()=>[a(p)]),default:s(()=>[(r(!0),h(x,null,z(t.totalStats,y=>(r(),V(d,{key:y},{default:s(()=>[n("div",Ss,[n("div",ws,g(y.value),1),n("div",ks,g(y.name),1)])]),_:2},1024))),128))]),_:1})],4)]),a(_,{class:"section"},{default:s(()=>[a(m,null,{default:s(()=>[a(f,{class:"cardTitle"},{default:s(()=>e[5]||(e[5]=[O(" Clients due ")])),_:1,__:[5]})]),_:1}),a($,null,{default:s(()=>{var y,F,U;return[n("div",Is,[n("div",{class:"dueCard",onClick:e[0]||(e[0]=L=>t.openDueModal("Client due today")),style:{border:"1px solid rgb(158, 207, 136)"}},[n("div",Ps,g(((y=t.reportData)==null?void 0:y.due_today_count)||0),1),e[6]||(e[6]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(239, 221, 121)"},onClick:e[1]||(e[1]=L=>t.openDueModal("Client due this week"))},[n("div",As,g(((F=t.reportData)==null?void 0:F.due_this_week_count)||0),1),e[7]||(e[7]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(241, 154, 154)"},onClick:e[2]||(e[2]=L=>t.openDueModal("Client due this month"))},[n("div",Ts,g(((U=t.reportData)==null?void 0:U.due_this_month_count)||0),1),e[8]||(e[8]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),a(_,{class:"section"},{default:s(()=>[a(m,null,{default:s(()=>[a(f,{class:"cardTitle"},{default:s(()=>e[9]||(e[9]=[O(" Clients overdue ")])),_:1,__:[9]})]),_:1}),a($,null,{default:s(()=>{var y,F;return[n("div",Os,[n("div",{class:"overDueCard",onClick:e[3]||(e[3]=U=>t.openDueModal("Client overdue under 5yrs"))},[n("div",Ns,g(((y=t.reportData)==null?void 0:y.under_five_overdue)||0),1),e[10]||(e[10]=n("div",{class:"statsText"},"Under 5yrs",-1))]),n("div",{class:"overDueCard",onClick:e[4]||(e[4]=U=>t.openDueModal("Client overdue over 5yrs"))},[n("div",Rs,g(((F=t.reportData)==null?void 0:F.over_five_overdue)||0),1),e[11]||(e[11]=n("div",{class:"statsText"},"Over 5yrs",-1))])])]}),_:1})]),_:1}),a(_,{class:"section"},{default:s(()=>[a(m,null,{default:s(()=>[a(f,{class:"cardTitle"},{default:s(()=>{var y;return[O("Today's appointments("+g((y=t.appointments)==null?void 0:y.length)+") ",1)]}),_:1})]),_:1}),a($,null,{default:s(()=>[(r(!0),h(x,null,z(t.appointments,(y,F)=>(r(),h("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:F,onClick:U=>t.openClientProfile(y.npid)},[n("div",xs,[n("div",{class:X(y.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(C,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),n("div",Ls,[n("div",Vs,[n("div",Fs,[n("div",Us,g(y.given_name)+" "+g(y.family_name),1)]),n("div",Es,[n("div",Ms,[O(g(y.gender=="M"?"Male":"Female")+" ",1),e[12]||(e[12]=n("span",{class:"dot"},".",-1)),O(g(t.formatBirthdate(y.birthdate)),1)])]),n("div",null,"Village: "+g(y==null?void 0:y.city_village),1)])])],8,Bs))),128))]),_:1})]),_:1})])]),_:1})}const zs=H(Cs,[["render",Ws],["__scopeId","data-v-a8eeb2dc"]]),Hs=M({components:{IonContent:q,IonHeader:Z,IonItem:at,IonList:nt,IonMenu:lt,IonTitle:rt,IonToolbar:K,IonInput:It,BasicInputField:ae,BasicForm:dt,PreviousVitals:ne,customDatePicker:de,IonCol:mt,IonRow:ht,VueMultiselect:Xt,IonLabel:qt,DataTable:Ot},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:Bt,showPD:!1,batchNumber:"",clientDetails:[],dueData:[],workerStore:se(),sessionDate:P.toStandardHisDisplayFormat(E.getSessionDate()),showDateBtns:!0,patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:t=>this.waitingTime(t)},{title:"Actions",data:null,render:(t,e,i)=>{const c=document.createElement("div"),l=document.createElement("ion-button");l.innerText=this.buttonTitle,l.size="small",l.classList.add("btn-edit"),l.style.color="#fff",l.style.marginRight="8px",l.addEventListener("click",()=>this.navigateTo(i.patient_id,this.buttonLink)),c.appendChild(l);const b=document.createElement("ion-button");b.innerText="Profile",b.size="small",b.classList.add("btn-edit"),b.style.color="#fd7e14",b.style.marginRight="8px",b.addEventListener("click",()=>this.navigateTo(i.patient_id,"/patientProfile")),c.appendChild(b);const d=document.createElement("ion-button");return d.innerText="Abscond",d.size="small",d.classList.add("btn-edit"),d.style.color="#dc3545",d.style.marginRight="8px",d.addEventListener("click",()=>this.handleAbscond(i)),c.appendChild(d),c},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]]}}},props:{title:{default:[]},list:{default:""},buttonTitle:{default:""},buttonLink:{default:""}},computed:{...Y($t,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","counter"])},async mounted(){this.setList()},watch:{patientsWaitingForConsultation:{handler(t){this.list==="CONSULTATION"&&(this.patients=t)},deep:!0},patientsWaitingForVitals:{handler(t){this.list==="VITALS"&&(this.patients=t)},deep:!0},patientsWaitingForLab:{handler(t){this.list==="LAB"&&(this.patients=t)},deep:!0},patientsWaitingForDispensation:{handler(t){this.list==="DISPENSATION"&&(this.patients=t)},deep:!0},counter:{handler(){this.setList()}}},setup(){return{person:At,pulseOutline:Kt,clipboardOutline:Pt}},methods:{openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Nt.dismiss()},async navigateTo(t,e){const i=await it.findByID(t);await et().setPatientRecord(i),this.$router.push(e)},async handleAbscond(t){try{const e=await xt(),i=e?e.code:null;await Lt.checkOutPatient(t.visit_id,P.todayDateFormatted()),this.patients=this.patients.filter(c=>c.patient_id!==t.patient_id),tn("Patient absconded successfully."),await $t().refresh(i)}catch(e){en("Failed to abscond patient.")}},setList(){const t={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation};this.patients=t[this.list]||[]},waitingTime(t){return P.calculateTimeDifference(t)}}}),Gs={key:0,class:"spinner-overlay"},Js={class:"header position_content"},js={style:{"font-size":"1.2em","font-weight":"700"}},Qs={class:"dueCardContent"};function Ys(t,e,i,c,l,b){const d=u("ion-spinner"),p=u("ion-icon"),D=u("ion-header"),f=u("ion-card-title"),m=u("ion-card-header"),$=u("DataTable"),_=u("ion-card-content"),C=u("ion-card"),I=u("ion-content");return r(),h(x,null,[e[3]||(e[3]=O(" Spinner ")),t.isLoading?(r(),h("div",Gs,[a(d,{name:"bubbles"}),e[2]||(e[2]=n("div",{class:"loading-text"},"Please wait...",-1))])):k("",!0),a(D,null,{default:s(()=>[n("div",Js,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=(...y)=>t.dismiss&&t.dismiss(...y))},[a(p,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",js,g(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=y=>t.openPopover(y))},[a(p,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(I,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:s(()=>[n("div",null,[a(C,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:s(()=>[a(m,null,{default:s(()=>[a(f,{class:"sectionTitle"})]),_:1}),a(_,null,{default:s(()=>[n("div",Qs,[a($,{data:t.patients,columns:t.tableColumns,options:t.tableOptions,class:"display nowrap",width:"100%"},null,8,["data","columns","options"])])]),_:1})]),_:1})])]),_:1})],64)}const Zs=H(Hs,[["render",Ys],["__scopeId","data-v-ec4c9422"]]),qs=M({components:{IonRow:ht,IonCol:mt,IonContent:q,IonHeader:Z,IonItem:at,IonList:nt,IonIcon:J,IonCard:Qe,IonCardHeader:je,IonCardTitle:Je,IonCardContent:Ge,IonPopover:He,DataTable:Ot,IonSpinner:ze},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:Bt,patientList:[],patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Service Time",data:"arrivalTime",render:t=>this.formatArrivalTime(t)},{title:"Actions",data:null,render:(t,e,i)=>{const c=document.createElement("div"),l=document.createElement("ion-button");return l.innerText="Profile",l.size="small",l.style.color="#fff",l.style.padding="8px 12px",l.style.marginRight="8px",l.addEventListener("click",()=>this.navigateTo(i.patient_id,"/patientProfile")),c.appendChild(l),c},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,dom:"Bfrtip",order:[[1,"asc"]]}}},props:{title:{default:"Patient List"}},async mounted(){this.isLoading=!0;try{const t=await xt(),e=t?t.code:null,c=(await Lt.getAllPatientsVisitsToday()).filter(l=>l.location_id===e);this.patients=await Promise.all(c.map(async l=>{const b=await it.findByID(l.patientId);if(b&&b.person){const d=b.person.names;return{fullName:d&&d.length>0?"".concat(d[0].given_name||""," ").concat(d[0].family_name||"").trim():"Unknown",arrivalTime:l.startDate,patient_id:l.patientId}}else return{fullName:"Unknown",arrivalTime:l.startDate,patient_id:l.patientId}}))}catch(t){console.error("Error fetching patients:",t)}finally{this.isLoading=!1}},methods:{openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Nt.dismiss()},async navigateTo(t,e){const i=await it.findByID(t);await et().setPatientRecord(i),this.$router.push(e)},formatArrivalTime(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}}}),Xs={class:"header position_content"},Ks={style:{"font-size":"1.2em","font-weight":"700"}},to={class:"dueCardContent"};function eo(t,e,i,c,l,b){const d=u("ion-icon"),p=u("ion-header"),D=u("DataTable"),f=u("ion-card-content"),m=u("ion-card"),$=u("ion-item"),_=u("ion-list"),C=u("ion-popover"),I=u("ion-content");return r(),h(x,null,[a(p,null,{default:s(()=>[n("div",Xs,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=(...y)=>t.dismiss&&t.dismiss(...y))},[a(d,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Ks,g(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=y=>t.openPopover(y))},[a(d,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(I,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:s(()=>[n("div",null,[a(m,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:s(()=>[a(f,null,{default:s(()=>[n("div",to,[a(D,{data:t.patients,columns:t.tableColumns,options:t.tableOptions,class:"display nowrap",width:"100%"},null,8,["data","columns","options"])])]),_:1})]),_:1})]),a(C,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:t.event,onDidDismiss:e[2]||(e[2]=y=>t.popoverOpen=!1)},{default:s(()=>[n("div",null,[a(_,{style:{"--ion-background-color":"#fff","--offset-x":"-30px"}},{default:s(()=>[a($,{button:!0,detail:!1,style:{cursor:"pointer"}})]),_:1})])]),_:1},8,["is-open","event"])]),_:1})],64)}const no=H(qs,[["render",eo],["__scopeId","data-v-79afebaf"]]),ao=M({name:"OPD Dashboard",mixins:[ut],components:{IonContent:q,IonHeader:Z,IonItem:at,IonList:nt,IonMenu:lt,IonTitle:rt,IonToolbar:K,IonCheckbox:ft,BasicForm:dt,BasicCard:_t,FacilityReports:pn},data(){return{totalPatientsToday:0,canViewVitals:!1,canViewConsultation:!1,canViewLab:!1,canViewDispensation:!1,userRoles:[],showReports:!1}},computed:{...Y($t,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{$route:{async handler(t){await this.fetchUserData()},deep:!0}},async mounted(){const t=await xt(),e=t?t.code:null;try{const c=(await Lt.getAllPatientsVisitsToday()).filter(l=>l.location_id===e);this.totalPatientsToday=c.length,await $t().refresh(e)}catch(i){}await this.fetchUserData()},methods:{toggleReports(){this.showReports=!this.showReports,this.showReports&&setTimeout(()=>{const t=document.getElementById("reports-section");t&&t.scrollIntoView({behavior:"smooth"})},100)},async fetchUserData(){const t=await Vt.getCurrentUser();t&&(this.userRoles=t.roles.map(e=>e.role),this.updateCardVisibility())},updateCardVisibility(){this.canViewVitals=this.isUserRole("Clinician")||this.isUserRole("Nurse")||this.isUserRole("Superuser"),this.canViewConsultation=this.isUserRole("Clinician")||this.isUserRole("Superuser"),this.canViewLab=this.isUserRole("Lab"),this.canViewDispensation=this.isUserRole("Clinician")||this.isUserRole("Pharmacist")||this.isUserRole("Superuser")},isUserRole(t){return this.userRoles.includes(t)},openAllModal(t,e,i){wt(no,{class:"fullScreenModal"},!0,{title:t,buttonLink:e,buttonTitle:i})},dueCardStyle(t){const e={success:"rgb(158, 207, 136)",warning:"rgb(239, 221, 121)",info:"rgb(144, 202, 249)",danger:"rgb(241, 154, 154)"};return{border:"1px solid ".concat(e[t]),padding:"20px",margin:"10px"}},openPatientsListModal(t,e,i,c){wt(Zs,{class:"fullScreenModal"},!0,{title:t,list:e,buttonTitle:i,buttonLink:c})}}}),so={id:"containertwo"},oo={class:"centered-content OPDDueCardWrapper"},io={class:"OPDDueCardContent"},ro={class:"OPDStatsValue"},lo={class:"OPDStatsValue"},co={class:"OPDStatsValue"},uo={class:"OPDStatsValue"},po={class:"OPDStatsValue"};function mo(t,e,i,c,l,b){const d=u("ion-card-title"),p=u("ion-card-header"),D=u("ion-icon"),f=u("ion-card-content"),m=u("ion-card"),$=u("ion-content");return r(),V($,{fullscreen:!0},{default:s(()=>[n("div",so,[n("div",oo,[a(m,{class:"section",style:{width:"80%"}},{default:s(()=>[a(p,null,{default:s(()=>[a(d,{class:"cardTitle"},{default:s(()=>e[5]||(e[5]=[O("Today's patients list")])),_:1,__:[5]})]),_:1}),a(f,null,{default:s(()=>[n("div",io,[n("div",{class:"OPDDueCard",onClick:e[0]||(e[0]=_=>t.openAllModal("All patients today","View profile","/patientProfile")),style:tt(t.dueCardStyle("success"))},[a(D,{icon:t.people,class:"dueCardIcon"},null,8,["icon"]),n("div",ro,g(t.totalPatientsToday),1),e[6]||(e[6]=n("div",{class:"OPDStatsText"},"Total patients today",-1))],4),t.canViewVitals?(r(),h("div",{key:0,class:"OPDDueCard",onClick:e[1]||(e[1]=_=>t.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals")),style:tt(t.dueCardStyle("success"))},[a(D,{icon:t.thermometer,class:"dueCardIcon"},null,8,["icon"]),n("div",lo,g(t.patientsWaitingForVitals.length),1),e[7]||(e[7]=n("div",{class:"OPDStatsText"},"Waiting for vitals",-1))],4)):k("",!0),t.canViewConsultation?(r(),h("div",{key:1,class:"OPDDueCard",onClick:e[2]||(e[2]=_=>t.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan")),style:tt(t.dueCardStyle("success"))},[a(D,{icon:t.clipboard,class:"dueCardIcon"},null,8,["icon"]),n("div",co,g(t.patientsWaitingForConsultation.length),1),e[8]||(e[8]=n("div",{class:"OPDStatsText"},"Waiting for consultation",-1))],4)):k("",!0),t.canViewLab?(r(),h("div",{key:2,class:"OPDDueCard",onClick:e[3]||(e[3]=_=>t.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan")),style:tt(t.dueCardStyle("success"))},[a(D,{icon:t.clipboard,class:"dueCardIcon"},null,8,["icon"]),n("div",uo,g(t.patientsWaitingForLab.length),1),e[9]||(e[9]=n("div",{class:"OPDStatsText"},"Waiting for lab",-1))],4)):k("",!0),t.canViewDispensation?(r(),h("div",{key:3,class:"OPDDueCard",onClick:e[4]||(e[4]=_=>t.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations")),style:tt(t.dueCardStyle("success"))},[a(D,{icon:t.medkit,class:"dueCardIcon"},null,8,["icon"]),n("div",po,g(t.patientsWaitingForDispensation.length),1),e[10]||(e[10]=n("div",{class:"OPDStatsText"},"Waiting for dispensation",-1))],4)):k("",!0)])]),_:1})]),_:1})])])]),_:1})}const ho=H(ao,[["render",mo],["__scopeId","data-v-08236ccc"]]),fo=M({name:"NCDDashboard",mixins:[ut],components:{ApexChart:ie},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await jt(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return E.getJson("programs/32/reports/ncd_dashboard",{start_date:P.toStandardHisFormat(P.sessionDate()),end_date:P.toStandardHisFormat(P.sessionDate())})}}}),go={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},_o={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},vo={ref:"chartRef1"},yo={ref:"chartRef2"};function bo(t,e,i,c,l,b){const d=u("ion-card-content"),p=u("ion-card"),D=u("ApexChart");return r(),h(x,null,[n("div",go,[a(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(d,null,{default:s(()=>e[0]||(e[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])),_:1,__:[0]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(d,null,{default:s(()=>e[1]||(e[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])),_:1,__:[1]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(d,null,{default:s(()=>e[2]||(e[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])),_:1,__:[2]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(d,null,{default:s(()=>e[3]||(e[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])),_:1,__:[3]})]),_:1})]),n("div",_o,[a(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(d,null,{default:s(()=>[e[4]||(e[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",vo,[t.isChartReady?(r(),V(D,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1,__:[4]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(d,null,{default:s(()=>[e[5]||(e[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",yo,[t.isChartReady?(r(),V(D,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1,__:[5]})]),_:1})])],64)}const Do=H(fo,[["render",bo],["__scopeId","data-v-58e2a3d8"]]),Co=M({name:"Home",mixins:[te,ut],components:{IonContent:q,IonHeader:Z,IonPage:Tt,IonToolbar:K,Toolbar:oe,IonRow:ht,DateInputField:le,IonIcon:J,IonButton:Qt,IonCol:mt},data(){const t=R(P.sessionDate()),e=R(P.sessionDate()),i=R(P.sessionDate()),c=R([]);return{segmentContent:"Today",minDate:i,startDate:t,endDate:e,people:c,calendarOutline:St,eyeOutline:Ye}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(t){this.segmentContent=t},formatBirthdate(t){return P.getBirthdateAge(t)},async getAppointments(){this.people=[],(await re.getAppointments(this.startDate,this.endDate,"")).forEach(e=>{const i={person_id:e.person_id,npid:e.npid,appointment_id:103,encounter_id:e.encounter_id,name:e.given_name.concat(" ",e.family_name),gender:e.gender,ageDob:this.formatBirthdate(e.birthdate),village:e.city_village,appointmentDate:P.toStandardHisDisplayFormat(e.appointment_date)};this.people.push(i)})},async getAppointmentsD1(t){this.startDate=P.toStandardHisFormat(t),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=P.toStandardHisFormat(t),await this.getAppointments()},async openClientProfile(t){await it.findByNpid(t),this.isPharmacist()},isPharmacist(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(i=>e.some(c=>c.role==="Pharmacist"))&&(this.$router.push("dispensation"),E.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),$o={class:"appointments-container"},So={key:0,class:"date-filter"},wo={class:"appointments-table"};function ko(t,e,i,c,l,b){const d=u("ion-label"),p=u("ion-segment-button"),D=u("ion-segment"),f=u("DateInputField"),m=u("ion-col"),$=u("ion-row"),_=u("ion-icon"),C=u("ion-button"),I=u("ion-card");return r(),h("div",$o,[n("div",null,[a(D,{value:t.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:s(()=>[a(p,{value:"Today",onClick:e[0]||(e[0]=y=>t.setSegmentContent("Today"))},{default:s(()=>[a(d,null,{default:s(()=>e[3]||(e[3]=[O("Today")])),_:1,__:[3]})]),_:1}),a(p,{value:"Tomorrow",onClick:e[1]||(e[1]=y=>t.setSegmentContent("Tomorrow"))},{default:s(()=>[a(d,null,{default:s(()=>e[4]||(e[4]=[O("Tomorrow")])),_:1,__:[4]})]),_:1}),a(p,{value:"Date range",onClick:e[2]||(e[2]=y=>t.setSegmentContent("Date range"))},{default:s(()=>[a(d,null,{default:s(()=>e[5]||(e[5]=[O("Date range")])),_:1,__:[5]})]),_:1})]),_:1},8,["value"])]),t.segmentContent==="Date range"?(r(),h("div",So,[a($,null,{default:s(()=>[a(m,null,{default:s(()=>[a(f,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(m,null,{default:s(()=>[a(f,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):k("",!0),t.people.length>0?(r(),V(I,{key:1},{default:s(()=>[n("table",wo,[e[6]||(e[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(r(!0),h(x,null,z(t.people,y=>(r(),h("tr",{key:y.npid},[n("td",null,[a($,null,{default:s(()=>[a(m,null,{default:s(()=>[O(g(y.name),1)]),_:2},1024),a(m,null,{default:s(()=>[a(C,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:F=>t.openClientProfile(y.npid),color:"primary",fill:"clear",size:"small"},{default:s(()=>[a(_,{icon:t.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,g(y.npid),1),n("td",null,g(y.ageDob),1),n("td",null,g(y.gender),1),n("td",null,g(y.village),1),n("td",null,g(y.appointmentDate),1)]))),128))])])]),_:1})):(r(),V(I,{key:2},{default:s(()=>e[7]||(e[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])),_:1,__:[7]}))])}const Io=H(Co,[["render",ko],["__scopeId","data-v-c47f7768"]]),Po=M({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){}}}),Ao={key:0},To={style:{display:"flex","margin-top":"10px"}},Oo={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},No={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},Ro={key:1};function Bo(t,e,i,c,l,b){const d=u("ion-label"),p=u("ion-segment-button"),D=u("ion-segment"),f=u("VisitsHistory");return r(),h(x,null,[n("div",null,[a(D,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:s(()=>[a(p,{value:"Internal referrals",onClick:e[0]||(e[0]=m=>t.setSegmentContent("Internal referrals"))},{default:s(()=>[a(d,null,{default:s(()=>e[2]||(e[2]=[O("Internal referrals")])),_:1,__:[2]})]),_:1}),a(p,{value:"External referrals",onClick:e[1]||(e[1]=m=>t.setSegmentContent("External referrals"))},{default:s(()=>[a(d,null,{default:s(()=>e[3]||(e[3]=[O("External referrals")])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(r(),h("div",Ao,[n("div",To,[t.checkUnderFive?(r(),h("div",Oo)):k("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?k("",!0):(r(),h("div",No))])])):k("",!0),t.segmentContent=="External referrals"?(r(),h("div",Ro,[a(f)])):k("",!0)],64)}const xo=H(Po,[["render",Bo],["__scopeId","data-v-faad8f8b"]]),Lo=M({name:"Menu",components:{IonContent:q,IonHeader:Z,IonItem:at,IonList:nt,IonMenu:lt,IonTitle:rt,IonToolbar:K,IonCheckbox:ft,IonIcon:J,BasicForm:dt,BasicCard:_t,Referrals:xo,Dashboard:Do,ANCAppointments:Io},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:Yt},{id:"referrals",label:"Referrals",icon:Zt},{id:"appointments",label:"Appointments",icon:St}],activeItem:"dashboard"}},computed:{...Y(gt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Vo={style:{display:"flex"}},Fo={class:"left_col"},Uo={class:"nav-menu"},Eo=["onClick"],Mo={class:"right_col"};function Wo(t,e,i,c,l,b){const d=u("ion-icon"),p=u("Dashboard"),D=u("ANCAppointments"),f=u("Referrals");return r(),h("div",Vo,[n("div",Fo,[n("nav",Uo,[n("ul",null,[(r(!0),h(x,null,z(t.menuItems,m=>(r(),h("li",{key:m.id,class:X({active:t.activeItem===m.id}),onClick:$=>t.setActiveItem(m.id)},[a(d,{icon:m.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,g(m.label),1)],10,Eo))),128))])])]),n("div",Mo,[n("div",null,[t.activeItem==="dashboard"?(r(),V(p,{key:0})):k("",!0),t.activeItem==="appointments"?(r(),V(D,{key:1})):k("",!0),t.activeItem==="referrals"?(r(),V(f,{key:2})):k("",!0)])])])}const zo=H(Lo,[["render",Wo],["__scopeId","data-v-7e786ea4"]]),Ho=M({name:"Menu",components:{IonContent:q,IonHeader:Z,IonItem:at,IonList:nt,IonMenu:lt,IonTitle:rt,IonToolbar:K,IonCheckbox:ft,BasicForm:dt,BasicCard:_t},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Y(gt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Go={class:"left_col"},Jo={class:"nav-menu"},jo=["onClick"];function Qo(t,e,i,c,l,b){return r(),h("div",null,[n("div",Go,[n("nav",Jo,[n("ul",null,[(r(!0),h(x,null,z(t.menuItems,d=>(r(),h("li",{key:d.id,class:X({active:t.activeItem===d.id}),onClick:p=>t.setActiveItem(d.id)},g(d.label),11,jo))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const Yo=H(Ho,[["render",Qo],["__scopeId","data-v-32dd02d3"]]),Zo=M({name:"Menu",components:{IonContent:q,IonHeader:Z,IonItem:at,IonList:nt,IonMenu:lt,IonTitle:rt,IonToolbar:K,IonCheckbox:ft,BasicForm:dt,BasicCard:_t},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Y(gt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),qo={class:"left_col"},Xo={class:"nav-menu"},Ko=["onClick"];function ti(t,e,i,c,l,b){return r(),h("div",null,[n("div",qo,[n("nav",Xo,[n("ul",null,[(r(!0),h(x,null,z(t.menuItems,d=>(r(),h("li",{key:d.id,class:X({active:t.activeItem===d.id}),onClick:p=>t.setActiveItem(d.id)},g(d.label),11,Ko))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const ei=H(Zo,[["render",ti],["__scopeId","data-v-b49d8600"]]);function ni(){const t=Rt(),e=nn(),i=R(!1),{OPDActivities:c,NCDActivities:l}=Ct(e),b=async p=>{var D;try{const f=E.getUserID(),m=await Vt.getJson("user_properties",{user_id:f,property:p});return m!=null&&m.property_value?(D=m==null?void 0:m.property_value)==null?void 0:D.split(","):[]}catch(f){return console.error("Error fetching user activities:",f),[]}},d=async()=>{try{i.value=!1;const[p,D]=await Promise.all([b("OPD_activities"),b("NCD_activities")]);p.length>0&&e.setOPDActivity(p),D.length>0&&e.setNCDActivity(D)}catch(p){console.error("Error updating activities:",p)}finally{i.value=!0}};return ot(()=>t.path,async()=>{await d()},{immediate:!0,deep:!0}),{ready:i,OPDActivities:c,NCDActivities:l,getUserActivities:b,updateActivities:d}}function ai(){const t=Rt(),e=R(""),i=R(!1),c=R({}),l=()=>{const b=E.getUserRoles(),d=E.getProgramID(),p=E.getProgramName();e.value=b,i.value=!1,b==="Lab"&&d===14?c.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:d===14&&b!=="Lab"?c.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:d===12?c.value={url:"contact",btnName:"Back"}:p==="LABOUR AND DELIVERY PROGRAM"?c.value={url:"labour/labourHome",btnName:"Back to home"}:p==="PNC PROGRAM"?c.value={url:"pnc/home",btnName:"Back to home"}:c.value={url:"",btnName:""},i.value=!0};return ot(()=>t.path,()=>{l()},{immediate:!0,deep:!0}),{userRole:e,ready:i,userRoleSettings:c,updateUserRoleSettings:l}}const si={key:0,class:"spinner-overlay"},Si=M({__name:"HomePage",setup(t){const e=R(!0),i=Rt(),c=se(),l=R(localStorage.getItem("sessionDate")||"");ai();const b=an(),{apiStatus:d}=Ct(ee()),{activeProgram:p}=Ct(b),D=bt(()=>{switch(p.value.program_id){case st.IMMUNIZATION_PROGRAM:return zs;case st.OPD_PROGRAM:return ho;case st.NCD_PROGRAM:return Fa;case st.ANC_PROGRAM:return zo;case st.PNC_PROGRAM:return ei;case st.LABOUR_AND_DELIVERY_PROGRAM:return Yo;case st.HIV_PROGRAM:return os;default:return null}}),f=()=>{const _=localStorage.getItem("sessionDate");(!_||_.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),Ht()),l.value=_||""};let m=null;Dt(()=>{m=()=>f(),window.addEventListener("storage",m);const _=setInterval(f,1e3);Ze(()=>{clearInterval(_),m&&window.removeEventListener("storage",m)}),f()}),ot(l,(_,C)=>{(!_||_.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),Ht())}),ot(()=>i.name,async _=>{_==="Home"&&(Wt(),await zt().loadGlobalProperty(),c.initWorker(),c.postData("SYNC_ALL_DATA"))},{immediate:!0,deep:!0});const $=async()=>{try{const _=E.getUserID(),C=await Vt.getUserByID(_);if(C.location_id!=null){const I=await on.getLocation(C.location_id);localStorage.setItem("locationData",JSON.stringify(I))}}catch(_){console.error("Failed to retrieve location data:",_)}};return d.value&&(ni(),$()),Dt(async()=>{try{e.value=!0,c.terminate(),Wt(),await zt().loadGlobalProperty(),yt.isEmpty(p.value)&&await sn.show(mn,{},"module-picker-modal")}catch(_){console.error("Error initializing component:",_)}finally{e.value=!1}}),(_,C)=>{const I=u("ion-spinner"),y=u("ion-content");return r(),V(G(Tt),null,{default:s(()=>[e.value?(r(),h("div",si,[a(I,{name:"bubbles"}),C[0]||(C[0]=n("div",{class:"loading-text"},"Please wait...",-1))])):k("",!0),a(oe),a(hn),D.value?(r(),V(qe(D.value),{key:1})):(r(),V(y,{key:2},{default:s(()=>C[1]||(C[1]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])),_:1,__:[1]}))]),_:1})}}});export{Si as default};

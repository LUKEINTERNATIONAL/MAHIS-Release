import{d as P,r as m,a as z,cw as S,cz as x,y as D,f as u,z as f,e as b,m as M,l as p,k as i,u as o,bN as j,ah as G,G as $,D as J,A as E,bu as U,F as W,L as q,bv as H,B as T,p as K,an as Q,n as R}from"./vendor-D_pL91wi.js";import{T as X,I as w,t as I,j as Y,_ as Z}from"./index-Bf-Si4LV.js";import{O as ee}from"./OfflineMoreDetailsModal-DRD-L0kX.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-f-yxlPgg.js";import"./SetRelationship.vue_vue_type_script_lang-CpiYn6ug.js";import"./BasicForm-VIY_Wl8C.js";import"./DateInputField-BInAqr25.js";import"./customDatePicker.vue_vue_type_style_index_0_lang-D9_BU6JM.js";const te={key:0,class:"spinner-overlay"},ae={class:"container"},ie={class:"select-group-wide"},ne={key:0,class:"content-area"},le={class:"table-section"},se={style:{width:"100%","text-align":"center","font-weight":"700",margin:"20px 0"}},oe={key:0,class:"table-responsive"},re={key:1,class:"placeholder-content"},de={style:{"text-align":"center",color:"#666","font-style":"italic"}},ce=P({__name:"MultipleIdentifiers",setup(ue){const v=m(!1),l=m(null),h=m([]),s=m([]),r=m(null),y=m(!1),A={responsive:!0,select:!1,layout:{topStart:null,topEnd:"search",bottomStart:"info",bottomEnd:"paging"}},C=async()=>{try{v.value=!0;const t=await w.getIdentifierTypes();h.value=t.map(e=>({id:e.patient_identifier_type_id||e.id,name:e.name}))}catch(t){console.error("Error loading identifier types:",t),I("Failed to load identifier types.")}finally{v.value=!1}},L=async t=>{l.value=t,await N(t)},N=async t=>{v.value=!0;try{const e=new w;e.setIdentifierType(t);const a=await e.getMultipleIdentifiers();a&&a.length>0?(s.value=a.map((n,d)=>[n.given_name||"N/A",n.family_name||"N/A",n.gender||"N/A",n.identifiers?n.identifiers.length.toString():"0",'<button class="btn btn-sm btn-primary view-btn" data-index="'.concat(d,"\" data-identifiers='").concat(JSON.stringify(n.identifiers||[]),"'>View</button>")]),y.value=!0):(s.value=[],y.value=!1),S.use(x),await R(),setTimeout(()=>{O()},100)}catch(e){console.error("Error building table data:",e),I("An error occurred while loading data."),y.value=!1,s.value=[]}finally{v.value=!1}},O=()=>{if(r.value&&y.value){const t=r.value.dt;t.columns.adjust().draw(),t.off("click",".view-btn"),t.on("click",".view-btn",e=>{const a=e.target,n=a.getAttribute("data-identifiers"),d=a.getAttribute("data-index");B(n,d)})}},k=()=>{const t=h.value.find(e=>e.id===l.value);return t?t.name:""},B=async(t,e)=>{if(!(!t||!e))try{const a=JSON.parse(t);await V(a,parseInt(e))}catch(a){console.error("Error parsing identifiers:",a),I("Error viewing identifier details")}},V=async(t,e)=>{new w().setIdentifierType(l.value||0),await Y(ee,{class:"fullScreenModal"},!0,{clientData:{title:"Identifiers belonging to client",identifiers:t,onVoidIdentifier:async(g,_)=>{await F(g,t,_,e)}}})==="dismiss"&&l.value&&await N(l.value)},F=async(t,e,a,n)=>{var d;if(confirm("Are you sure you want to void this identifier? Please provide a reason."))try{const g=prompt("Please provide a reason for voiding this identifier:")||"No reason provided",_=new w;if(_.setIdentifierType(l.value||0),await _.voidMultipleIdentifiers([t],g,((d=e[0])==null?void 0:d.identifier_type)||l.value),e.splice(a,1),e.length<=1){if(s.value.splice(n,1),r.value){const c=r.value.dt;c.clear(),c.rows.add(s.value),c.draw()}}else{if(s.value[n][3]=e.length.toString(),r.value){const c=r.value.dt;c.clear(),c.rows.add(s.value),c.draw()}await V(e,n)}}catch(g){console.error("Error voiding identifier:",g),I("Failed to void identifier")}};return z(async()=>{S.use(x),await C()}),(t,e)=>(u(),D(o(Q),{class:K({loading:v.value})},{default:f(()=>[v.value?(u(),b("div",te,[p(o(j),{name:"bubbles"}),e[2]||(e[2]=i("div",{class:"loading-text"},"Please wait...",-1))])):M("",!0),p(X),p(o(G),null,{default:f(()=>[i("div",ae,[e[5]||(e[5]=i("h4",{style:{"text-align":"center","font-weight":"bold","margin-bottom":"20px"}}," Select Identifier Type ",-1)),i("div",ie,[p(o($),null,{default:f(()=>[p(o(J),{position:"stacked"},{default:f(()=>e[3]||(e[3]=[E("Identifier Type",-1)])),_:1,__:[3]}),p(o(U),{interface:"popover",placeholder:"Select Identifier Type",modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value=a),onIonChange:e[1]||(e[1]=a=>L(a.detail.value)),class:"wide-select"},{default:f(()=>[(u(!0),b(W,null,q(h.value,a=>(u(),D(o(H),{key:a.id,value:a.id},{default:f(()=>[E(T(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),l.value?(u(),b("div",ne,[i("div",le,[i("h4",se," Multiple Identifier by "+T(k()),1),y.value?(u(),b("div",oe,[p(o(S),{ref_key:"dataTable",ref:r,options:A,data:s.value,class:"display nowrap",width:"100%"},{default:f(()=>e[4]||(e[4]=[i("thead",null,[i("tr",null,[i("th",null,"First Name"),i("th",null,"Last Name"),i("th",null,"Gender"),i("th",null,"Number of Identifiers"),i("th",null,"View")])],-1)])),_:1,__:[4]},8,["data"])])):(u(),b("div",re,[i("p",de,T(k())+" identifier functionality will be implemented here ",1)]))])])):M("",!0)])]),_:1})]),_:1},8,["class"]))}}),Ie=Z(ce,[["__scopeId","data-v-f704827c"]]);export{Ie as default};

import{o as tt,ai as A,x as H,y as a,u as q,_ as j,i as et,H as k,w as ut,ab as T,aj as dt,ac as pt,ae as ht,S as W,g as X,a4 as mt,m as V,b as Y,ak as ft,al as yt,t as D,am as gt,an as vt,ao as _t,A as bt,F as St,E as It,P as Dt,C as Ct,r as K,I as kt,ap as Pt,s as Lt,p as wt,n as Tt}from"./index-DuNDgd8X.js";import{C as Rt}from"./ConfirmPrinting-DTinlUr-.js";import{d as J,al as L,U as $t,T as it,am as Nt,an as nt,G as at,S as ot,ao as rt,E as u,y as g,f as c,W as Bt,I as st,ab as Ht,d0 as Ot,ac as At,dq as Gt,D as Ut,X as Q,e as _,m as p,l as i,k as o,z as r,B as y,F as Z,L as Ft,A as b,au as Mt,bj as Et,dt as Wt,du as Vt,dv as U,O as qt,dw as zt,cj as Yt,dx as jt,p as R}from"./vendor-Ddb6Z0_s.js";import{_ as lt,B as Jt,S as Xt,H as Kt,C as Qt,G as Zt,P as xt}from"./BirthRegistration-C2P0UL4t.js";import te from"./ARTPatientType-DajXfeDD.js";import{B as ee,_ as ie,u as x}from"./ncd_appointment_service-7PDIUHUo.js";import{l as ne}from"./lodash-Dt8AsbQm.js";import{f as ae}from"./SaveProgressModal-DcTn6LaL.js";import{v as O}from"./group_validation-BaON-FQw.js";import{g as oe}from"./vaccines_service-BCpDMBoI.js";import"./OutcomeModal-BTJPqPCv.js";import"./SetRelationship.vue_vue_type_script_lang-BsDmgWvg.js";import"./relations_service-CatLL-jM.js";import"./relationship_service-BtHfeVQD.js";import"./AddVillage-Cj2mv4Vs.js";import"./DemographicBar-DsvIDf9n.js";import"./Stepper-DcuULobQ.js";import"./app_encounter_service-Du7cx0ZT.js";import"./previousVitals-DP1BjEyb.js";import"./apexcharts-Duz_SJy9.js";import"./SvgDynamicColor-qIuj6E_F.js";import"./patient_complaints_service-FnxAxSpN.js";import"./lab_order-DbYZDq0j.js";import"./UpcomingFeature-TVAqBLgq.js";import"./DatePicker.vue_vue_type_script_setup_true_lang-kQ_i1dg4.js";import"./SelectFacility-BhdO2d25.js";import"./drug_service-Cfna1Tqo.js";import"./drug_prescription_service-B6EflI4N.js";import"./appointment_service-B2PcUM58.js";import"./clinicalDaysStore-CpgA8D-e.js";import"./FeatusModal-CEdof4EB.js";import"./vitals_service-RhK7nAlj.js";import"./diagnosis-BxxfyWqx.js";import"./NCDNumber-qG7XU4sg.js";import"./patient_type_service-DsV98BEB.js";import"./BasicRadioSelect-CBOV-WTP.js";import"./sms_service-CcQbaxK8.js";import"./EIRreportsStore-DqBGRUmh.js";import"./Export-qHxztBjt.js";const re=J({name:"Menu",mixins:[lt],components:{IonContent:rt,IonHeader:ot,IonItem:at,IonList:nt,IonMenu:Nt,IonTitle:it,IonToolbar:$t,BasicCard:ee},data(){return{cardData:{},inputField:"",setName:"",locationData:[]}},computed:{...L(A,["currentLocation","country"]),...L(q,["patient"]),selected_country(){var t;return(t=a(this.country,"country","value"))==null?void 0:t.name},current_district(){var t;return(t=a(this.currentLocation,"current_district","value"))==null?void 0:t.name},current_traditional_authority(){var t;return(t=a(this.currentLocation,"current_traditional_authority","value"))==null?void 0:t.name},current_village(){var t;return(t=a(this.currentLocation,"current_village","value"))==null?void 0:t.name},"Other (specify)"(){return a(this.currentLocation,"Other (specify)","value")}},watch:{currentLocation:{handler(){this.buildCards()},deep:!0},countriesList:{handler(){this.countriesList.length>0&&H(this.country,"country","multiSelectData",this.countriesList)},deep:!0},$route:{async handler(){await this.buildCards(),this.setData()}}},props:{editable:{default:!1}},async mounted(){await this.buildCards(),this.setData()},methods:{setData(){this.setSelectedCountry(),this.editable&&H(this.country,"country","value",{name:"Malawi",district_id:""})},setSelectedCountry(){if(tt().setRegSelectedCountry(this.selected_country),this.selected_country==="Malawi"){const t=A();t.setHomeLocation(t.getInitialHomeLocation()),t.setCurrentLocation(t.getInitialCurrentLocation())}},async buildCards(){this.cardData={mainTitle:"Demographics",cards:[{cardTitle:"Country",content:this.country}]}},async handleInputData(t){this.setSelectedCountry()}}});function se(t,e,n,d,f,h){const P=u("basic-card");return c(),g(P,{content:t.cardData,editable:t.editable,"onUpdate:selected":t.handleInputData,"onUpdate:inputValue":t.handleInputData},null,8,["content","editable","onUpdate:selected","onUpdate:inputValue"])}const le=j(re,[["render",se],["__scopeId","data-v-490af540"]]),ce=J({components:{IonLabel:Ut,IonAvatar:Gt,IonRow:At,IonImg:Ot,IonCol:Ht,IonList:nt,IonItem:at,IonIcon:st,IonButton:Bt},data:()=>({selectedResult:{},iconsContent:et,isAnyAccordionOpen:!0,isLoading:!1}),methods:{updateAccordionState(t){const e=this.$refs.accordionGroup;this.isAnyAccordionOpen=e.value!==void 0},dismiss(t){Q.dismiss(t)},async init(){this.setData(this.deduplicationData[0]||{})},async onSelect(){Q.dismiss(this.selectedResult)},setData(t){this.selectedResult=t},dateFormat(t){return k.toStandardHisDisplayFormat(t)},probabilityToPercentage(t){return(t*100).toFixed(2)+"%"}},props:{deduplicationData:{default:[]},to_be_registered:{default:[]}},mounted(){this.init()},activated(){this.init()}}),ue={key:0,class:"spinner-overlay"},de={class:"header position_content"},pe={style:{"font-size":"1.2em","font-weight":"700"}},he={class:"due_date"},me={class:"ion-padding",slot:"content"},fe={style:{display:"flex","justify-content":"end",gap:"10px"}};function ye(t,e,n,d,f,h){const P=u("ion-spinner"),m=u("ion-icon"),$=u("ion-header"),S=u("ion-label"),N=u("ion-item"),B=u("ion-col"),v=u("ion-row"),F=u("ion-accordion"),M=u("ion-accordion-group"),E=u("ion-content"),G=u("ion-button"),z=u("ion-footer");return c(),_(Z,null,[t.isLoading?(c(),_("div",ue,[i(P,{name:"bubbles"}),e[3]||(e[3]=o("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),i($,null,{default:r(()=>[o("div",de,[o("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=s=>t.dismiss("back"))},[i(m,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeft},null,8,["icon"])]),o("div",pe,"Matches found: ("+y(t.deduplicationData.length)+")",1)])]),_:1}),i(E,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:r(()=>[i(M,{ref:"accordionGroup",class:"previousView",value:"0",onIonChange:t.updateAccordionState},{default:r(()=>[(c(!0),_(Z,null,Ft(t.deduplicationData,(s,w)=>(c(),g(F,{style:{"margin-bottom":"15px"},value:w,"toggle-icon-slot":"start",class:"custom_card",button:"",key:w,detail:!0,color:s.value===t.selectedResult.value?"light":"",onClick:l=>t.setData(s)},{default:r(()=>[i(N,{slot:"header"},{default:r(()=>[i(S,{class:"previousLabel"},{default:r(()=>{var l,C;return[b(y((l=s==null?void 0:s.person)==null?void 0:l.given_name)+" "+y((C=s==null?void 0:s.person)==null?void 0:C.family_name),1)]}),_:2},1024),o("div",he,[e[4]||(e[4]=b(" Score: ")),o("b",null,y(t.probabilityToPercentage(s==null?void 0:s.score)||"-"),1)])]),_:2},1024),o("div",me,[i(v,null,{default:r(()=>[i(B,null,{default:r(()=>e[5]||(e[5]=[o("b",null,"To be Registered",-1)])),_:1,__:[5]}),i(B,null,{default:r(()=>e[6]||(e[6]=[o("b",null,"Already Registered",-1)])),_:1,__:[6]})]),_:1}),i(v,null,{default:r(()=>[i(B,null,{default:r(()=>[i(v,null,{default:r(()=>{var l,C;return[e[7]||(e[7]=b(" Name: ")),o("b",null,y((l=t.to_be_registered)==null?void 0:l.given_name)+" "+y((C=t.to_be_registered)==null?void 0:C.family_name),1)]}),_:1,__:[7]}),i(v,null,{default:r(()=>{var l;return[e[8]||(e[8]=b("Gender: ")),o("b",null,y((l=t.to_be_registered)==null?void 0:l.gender),1)]}),_:1,__:[8]}),i(v,null,{default:r(()=>{var l;return[e[9]||(e[9]=b("Birthdate: ")),o("b",null,y((l=t.to_be_registered)==null?void 0:l.birthdate),1)]}),_:1,__:[9]}),i(v,null,{default:r(()=>{var l;return[e[10]||(e[10]=b("Home District: ")),o("b",null,y((l=t.to_be_registered)==null?void 0:l.home_district),1)]}),_:1,__:[10]}),i(v,null,{default:r(()=>{var l;return[e[11]||(e[11]=b("Home TA: ")),o("b",null,y((l=t.to_be_registered)==null?void 0:l.home_traditional_authority),1)]}),_:1,__:[11]})]),_:1}),i(B,null,{default:r(()=>[i(v,null,{default:r(()=>{var l,C;return[e[12]||(e[12]=b(" Name: ")),o("b",null,y((l=s==null?void 0:s.person)==null?void 0:l.given_name)+" "+y((C=s==null?void 0:s.person)==null?void 0:C.family_name),1)]}),_:2,__:[12]},1024),i(v,null,{default:r(()=>{var l;return[e[13]||(e[13]=b("Gender: ")),o("b",null,y((l=s==null?void 0:s.person)==null?void 0:l.gender),1)]}),_:2,__:[13]},1024),i(v,null,{default:r(()=>{var l;return[e[14]||(e[14]=b("Birthdate: ")),o("b",null,y(t.dateFormat((l=s==null?void 0:s.person)==null?void 0:l.birthdate)),1)]}),_:2,__:[14]},1024),i(v,null,{default:r(()=>{var l;return[e[15]||(e[15]=b("Home District: ")),o("b",null,y((l=s==null?void 0:s.person)==null?void 0:l.home_district),1)]}),_:2,__:[15]},1024),i(v,null,{default:r(()=>{var l;return[e[16]||(e[16]=b("Home TA: ")),o("b",null,y((l=s==null?void 0:s.person)==null?void 0:l.home_traditional_authority),1)]}),_:2,__:[16]},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["value","color","onClick"]))),128))]),_:1},8,["onIonChange"])]),_:1}),i(z,{collapse:"fade",class:"ion-no-border"},{default:r(()=>[o("div",fe,[i(G,{fill:"solid",color:"secondary",onClick:e[1]||(e[1]=s=>t.dismiss("dismiss"))},{default:r(()=>e[17]||(e[17]=[b(" Not Duplicate ")])),_:1,__:[17]}),i(G,{onClick:e[2]||(e[2]=s=>t.onSelect()),fill:"solid",disabled:!t.isAnyAccordionOpen},{default:r(()=>e[18]||(e[18]=[b("Select ")])),_:1,__:[18]},8,["disabled"])])]),_:1})],64)}const ge=j(ce,[["render",ye],["__scopeId","data-v-ffb46cdd"]]),ve=J({mixins:[ie,lt],components:{PatientType:te,IonBreadcrumb:Vt,IonBreadcrumbs:Wt,IonIcon:st,IonContent:rt,IonHeader:ot,IonMenuButton:Et,IonPage:Mt,IonTitle:it,DynamicButton:ut,PersonalInformation:xt,GuardianInformation:Zt,CurrentLocation:Qt,Country:le,HomeLocation:Kt,SocialHistory:Xt,BirthRegistration:Jt},data(){return{patientTypeComponent:null,isMilitarySite:!1,ddeId:null,iconListStatus:"active_icon",deduplicationData:"active_icon",iconGridStatus:"inactive_icon",iconsContent:et,demographic:!0,currentStep:"Personal Information",scanner:!1,checkUnderOne:!1,isLoading:!1,checkUnderFourteen:!0,checkUnderNine:!1,checkUnderFive:!1,checkUnderSixWeeks:!1,steps:["Personal Information","Location","Patient Type","Social History","Guardian Information"],disableSaveBtn:!1,workerStore:Tt()}},props:["registrationType"],computed:{...L(wt,["activeProgram"]),...L(tt,["NCDUserActions","regSelectedCountry"]),...L(Lt,["globalPropertyStore"]),...L(A,["personInformation","socialHistory","currentLocation","homeLocation","guardianInformation","country","patientType"]),...L(x,["registrationDisplayType"]),...L(Pt,["birthRegistration"]),...L(Y,["apiStatus"]),isPatientTypeRequired(){return this.activeProgram.program_id===1},patientTypeIsset(){const t=T(this.patientType,"patientType");return"".concat(t!=null?t:"").length>=1},nationalID(){return a(this.personInformation,"nationalID","value")},birthID(){return a(this.birthRegistration,"Serial Number","value")},firstname(){return a(this.personInformation,"firstname","value")},lastname(){return a(this.personInformation,"lastname","value")},phoneNumber(){return a(this.personInformation,"phoneNumber","value")},gender(){return T(this.personInformation,"gender")},birthdate(){return k.toStandardHisFormat(a(this.personInformation,"birthdate","value"))},guardianFirstname(){return a(this.guardianInformation,"guardianFirstname","value")},guardianLastname(){return a(this.guardianInformation,"guardianLastname","value")},guardianMiddleName(){return a(this.guardianInformation,"guardianMiddleName","value")},guardianPhoneNumber(){return a(this.guardianInformation,"guardianPhoneNumber","value")},relationship(){return a(this.guardianInformation,"relationship","value")},current_district(){var t;return(t=a(this.currentLocation,"current_district","value"))==null?void 0:t.name},current_traditional_authority(){var t;return(t=a(this.currentLocation,"current_traditional_authority","value"))==null?void 0:t.name},current_village(){var t;return(t=a(this.currentLocation,"current_village","value"))==null?void 0:t.name},"Other (specify)"(){return a(this.currentLocation,"Other (specify)","value")}},async mounted(){K(),this.setIconClass(),this.disableNationalIDInput(),this.checkAge()},watch:{personInformation:{handler(){const t=A();t.setPersonalInformation(this.personInformation),t.setSocialHistory(this.socialHistory),t.setHomeLocation(this.homeLocation),t.setCurrentLocation(this.currentLocation),t.setGuardianInformation(this.guardianInformation),this.checkAge(),this.disableNationalIDInput();const e=A();this.programID()===1&&(t.clearSocialHistoryOccupations(),kt.isProp("military_site=true").then(n=>{this.isMilitarySite=n,this.isMilitarySite?(e.setOccupationAsMandatory(),e.setSocialHistoryMilitaryOccupations()):(e.setOccupationNotMandatory(),e.setSocialHistoryOccupations())}))},deep:!0},$route:{async handler(t){this.currentStep="Personal Information",t.name.includes("registration")&&(K(),A().setGuardianInformation(this.guardianInformation)),await this.getLocationData(),H(this.country,"country","multiSelectData",this.countriesList),H(this.currentLocation,"current_district","multiSelectData",this.districtList),H(this.homeLocation,"home_district","multiSelectData",this.districtList)},deep:!0}},setup(){return{arrowForwardCircle:jt,grid:Yt,list:zt}},methods:{async cancel(t){await Ct("Do you want to cancel registration?","",{confirmBtnLabel:"Yes",icon:"",showBackdrop:!0})&&this.nav("/home")},programID(){return W.getProgramID()},isEligibleForOccupation(){return qt(W.getSessionDate()).diff(this.birthdate,"years")>=18},async getRegion(t){if(t){let e=[];for(let n of[1,2,3]){if((n=1)&&(e=await this.getDistricts(n)),e.some(d=>d.name.trim()===t))return"Central Region";if((n=2)&&(e=await this.getDistricts(n)),e.some(d=>d.name.trim()===t))return"Northern Region";if((n=3)&&(e=await this.getDistricts(n)),e.some(d=>d.name.trim()===t))return"Southern Region";if((n=4)&&(e=await this.getDistricts(n)),e.some(d=>d.name.trim()===t))return"Foreign"}}},checkAge(){ne.isEmpty(this.birthdate)||(this.checkUnderFourteen=k.getAgeInYears(this.birthdate)>=14,this.checkUnderNine=k.ageInMonths(this.birthdate)<9,this.checkUnderFive=k.getAgeInYears(this.birthdate)<5,this.checkUnderSixWeeks=k.dateDiffInDays(k.sessionDate(),this.birthdate)<42)},disableNationalIDInput(){this.registrationType=="manual"?H(this.personInformation,"nationalID","displayNone",!0):H(this.personInformation,"nationalID","displayNone",!1)},setCurrentStep(t){this.currentStep=t},nav(t){this.$router.push(t)},async nextStep(){this.checkUnderFourteen||this.checkUnderFive?this.steps=["Personal Information","Location","Patient Type","Social History","Guardian Information"]:this.steps=["Personal Information","Location","Patient Type","Guardian Information"],this.steps=this.steps.reduce((e,n)=>n==="Patient Type"&&!this.isPatientTypeRequired?e:[...e,n],[]);const t=this.steps.indexOf(this.currentStep);if(t<this.steps.length-1)if(this.currentStep==="Personal Information"){const e=["nationalID","firstname","lastname","birthdate","gender"];await this.validations(this.personInformation,e)?this.currentStep=this.steps[t+1]:D("Please fill fileds correctly before you proceed!")}else if(this.currentStep==="Location"){const e=["current_district","current_traditional_authority","current_village"];await this.validations(this.currentLocation,e)&&await O(this.homeLocation)||this.regSelectedCountry!="Malawi"?this.currentStep=this.steps[t+1]:D("Please fill fileds correctly before you proceed!")}else if(this.currentStep==="Social History"&&this.isMilitarySite&&this.isEligibleForOccupation()){if(!T(this.socialHistory,"occupation"))return D("Occupation is required");this.currentStep=this.steps[t+1]}else if(this.currentStep==="Patient Type"&&this.isPatientTypeRequired){if(!this.patientTypeIsset)return D("Patient type is required!");this.currentStep=this.steps[t+1]}else this.currentStep==="Social History"&&(this.checkUnderFive||this.checkUnderOne?await O(this.birthRegistration)?this.currentStep=this.steps[t+1]:D("Please fill fileds correctly before you proceed!"):this.currentStep=this.steps[t+1])},previousStep(){const t=this.steps.indexOf(this.currentStep);t>0&&(this.currentStep=this.steps[t-1])},async findPatient(t){const e=await Dt.findByID(t);await q().setPatientRecord(e),this.setURLs(t)},validateGaudiarnInfo(){return this.checkUnderFourteen?!0:O(this.guardianInformation)},async validations(t,e){return e.every(n=>It(t,n,this[n]))},async validateLocation(){return this.regSelectedCountry=="Malawi"?!!(await O(this.homeLocation)&&await O(this.currentLocation)):!0},async possibleDuplicates(){var t;try{const e=new St;if(this.deduplicationData=await e.checkPotentialDuplicates(U(this.personInformation[0].selectedData)),this.deduplicationData.length>0){const n=await X(ge,{class:"fullScreenModal"},!0,{to_be_registered:U(this.personInformation[0].selectedData),deduplicationData:this.deduplicationData});if(n!="dismiss"&&n!="back"){const d=await e.importPatient((t=n==null?void 0:n.person)==null?void 0:t.id);return await this.findPatient(d.patient_id),!0}else if(n=="back")return!0;return!1}else return!1}catch(e){return!1}},patientTypeOk(){return this.isPatientTypeRequired?this.$refs.patientTypeComponent?this.$refs.patientTypeComponent.validateAll():(D("Patient type form not fully initialised, please try again"),!1):!0},async createPatient(){var n,d;if(yt()===!0){const f=["nationalID","firstname","lastname","birthdate","gender"],h=a(this.currentLocation,"closestLandmark","value");if(h==null||h.name,!this.patientTypeOk())return;if(!T(this.socialHistory,"occupation")&&this.isMilitarySite&&this.isEligibleForOccupation())return D("Occupation is required");if(await this.validations(this.personInformation,f)&&await this.validateLocation()&&await this.validateBirthData()&&this.validateGaudiarnInfo())try{const m=await gt();if(!m){if(await vt()==!1)return;D("DDE IDs are not available in MODS.");const S=await _t();if((S==null?void 0:S.status)=="Up"){D("Proceeding with MODS without DDE IDs."),await this.proceedWithPatientCreation(!0);return}return}this.ddeId=m.npid,await this.proceedWithPatientCreation(!0)}catch(m){V("DDE IDs are not available. Please connect to the server to sync the IDs.");return}else D("Please complete all required fields");return}const t=await bt("dde").then(f=>f==null?void 0:f[0]);let e=!1;if((((n=t==null?void 0:t.ids)==null?void 0:n.length)>0||this.apiStatus)&&(this.ddeId=((d=t==null?void 0:t.ids[0])==null?void 0:d.npid)||"",e=!0),e){const f=["nationalID","firstname","lastname","birthdate","gender"],h=a(this.currentLocation,"closestLandmark","value");if(h==null||h.name,T(this.socialHistory,"occupation"),!this.patientTypeOk())return;await this.validations(this.personInformation,f)&&await this.validateLocation()&&await this.validateBirthData()&&this.validateGaudiarnInfo()?await this.proceedWithPatientCreation(!1,t):D("Please complete all required fields")}else V("DDE IDs are not available. Please connect to the server to sync the IDs.")},async proceedWithPatientCreation(t=!1,e=null){var d,f;if(await this.buildPersonalInformation(),this.disableSaveBtn=!0,this.isLoading=!0,!t&&this.globalPropertyStore.dde_enabled==="true"&&this.apiStatus&&await this.possibleDuplicates()){this.disableSaveBtn=!1,this.isLoading=!1;return}if(Object.keys(this.personInformation[0].selectedData).length===0)return;const n=await this.buildPatientRecord();if(!t&&((d=e==null?void 0:e.ids)==null?void 0:d.length)>0&&(e.ids=e.ids.slice(1),this.workerStore.postData("OVERRIDE_OBJECT_STORE",{storeName:"dde",data:e})),!t&&(this.apiStatus&&this.programID()!=33&&this.programID()!=32||this.apiStatus&&!(e!=null&&e.ids))){this.workerStore.postData("SYNC_DDE");const h=await W.postJson("/save_patient_record",{record:n});await q().setPatientRecord(h),this.workerStore.postData("SYNC_ALL_DATA"),this.disableSaveBtn=!1,this.$refs.patientTypeComponent&&(await this.$refs.patientTypeComponent.onSubmit(h.patientID)||V("Unable to save patient type.. You can try saving manually in ART tasks")),await this.printBarcode(),await this.setURLs(h.patientID)}else t||!t&&((f=e==null?void 0:e.ids)==null?void 0:f.length)>0?(Y().syncingTotal=Y().syncingTotal+1,q().setRecord(n),await this.workerStore.postData("ADD_OBJECT_STORE",{storeName:"patientRecords",data:n}),this.isLoading=!1,this.disableSaveBtn=!1,await this.printBarcode(),t&&(n.patientID==null&&ft({record:n}),this.workerStore.postData("SYNC_ALL_DATA")),this.programID()==32?this.$router.push("/NCDEnrollment"):this.$router.push("/patientProfile")):V("DDE IDs are not available. Please connect to the server to sync the IDs.")},async printBarcode(){await X(Rt,{class:"small-confirm-modal "})!=="dismiss"&&new mt().printData("barcode")},async buildPatientRecord(){var h;const t=a(this.birthRegistration,"Weight","value");let e={saved:[],unsaved:[]};t&&(e.unsaved=[{concept_id:5089,obs_datetime:k.sessionDate(),value_numeric:t}]);const n=this.personInformation[0].selectedData.birthdate,d=this.personInformation[0].selectedData.gender;return{patientID:this.ddeId,ID:this.ddeId,NcdID:"",program_id:W.getProgramID()||null,location_id:localStorage.getItem("locationID"),provider_id:localStorage.getItem("userID"),encounter_datetime:new Date().toISOString(),personInformation:U(this.personInformation[0].selectedData),guardianInformation:{saved:[],unsaved:[U(this.guardianInformation[0].selectedData)]},birthRegistration:U(await ae(this.birthRegistration)),otherPersonInformation:{nationalID:this.validatedNationalID(),birthID:this.validatedBirthID(),relationshipID:(h=a(this.guardianInformation,"relationship","value"))==null?void 0:h.id},vitals:e,vaccineSchedule:await oe(d,n),vaccineAdministration:{orders:[],obs:[],voided:[]},appointments:{saved:[],unsaved:[]},saveStatusPersonInformation:"pending",saveStatusGuardianInformation:"pending",saveStatusBirthRegistration:"pending",saveStatusVitals:"pending",date_created:"",creator:"",sync_status:"unsynced"}},checkWeightForAge(t,e){let n=!1;return(t>=0&&t<1&&e>=.5&&e<=13.1||t>=1&&t<2&&e>13.1&&e<=15||t>=2&&t<3&&e>15&&e<=20.9||t>=3&&t<4&&e>20.9&&e<=24.1||t>=4&&t<5&&e>24.1&&e<=28)&&(n=!0),n},async validateBirthData(){return this.checkUnderNine?this.checkWeightForAge(k.getAgeInYears(this.birthdate),a(this.birthRegistration,"Weight","value"))?O(this.birthRegistration):!!await ht("Do you want to continue with this weight (".concat(a(this.birthRegistration,"Weight","value"),") for age (").concat(k.getAgeInYears(this.birthdate),")")):!0},validatedNationalID(){return this.nationalID!=""&&!a(this.personInformation,"nationalID","alertsErrorMassage")?this.nationalID:""},validatedBirthID(){return this.birthID!=""&&!a(this.birthRegistration,"Serial Number","alertsErrorMassage")?this.birthID:""},async setURLs(t=""){await dt(),this.isLoading=!1,this.disableSaveBtn=!1;let e="";this.programID()==32&&this.apiStatus?e=(await pt.userProgramData(t)).url:e="/patientProfile",this.$router.push(e)},patientIdentifier(t){const e=t.patient_identifiers.length-1;return e>=0?t.patient_identifiers[e].identifier:""},async buildPersonalInformation(){var d,f,h,P,m,$,S,N;const t=(d=a(this.currentLocation,"closestLandmark","value"))==null?void 0:d.name,e=a(this.currentLocation,"Other (specify)","value"),n=t==="Other"?e:t;this.personInformation[0].selectedData={given_name:a(this.personInformation,"firstname","value"),middle_name:a(this.personInformation,"middleName","value"),family_name:a(this.personInformation,"lastname","value"),gender:this.gender,birthdate:a(this.personInformation,"birthdate","value"),birthdate_estimated:"false",home_region:await this.getRegion((f=a(this.homeLocation,"home_district","value"))==null?void 0:f.name)||await this.getRegion((h=a(this.country,"country","value"))==null?void 0:h.name),home_district:(P=a(this.homeLocation,"home_district","value"))==null?void 0:P.name,home_traditional_authority:(m=a(this.homeLocation,"home_traditional_authority","value"))==null?void 0:m.name,home_village:($=a(this.homeLocation,"home_village","value"))==null?void 0:$.name,current_region:await this.getRegion(this.current_district),current_district:this.current_district,current_traditional_authority:this.current_traditional_authority,current_village:this.current_village,country:(S=a(this.country,"country","value"))==null?void 0:S.name,landmark:n,cell_phone_number:a(this.personInformation,"phoneNumber","value"),occupation:T(this.socialHistory,"occupation"),marital_status:T(this.socialHistory,"maritalStatus"),religion:(N=a(this.socialHistory,"religion","value"))==null?void 0:N.name,education_level:T(this.socialHistory,"highestLevelOfEducation")}},setDisplayType(t){x().setRegistrationDisplayType(t),this.setIconClass()},setIconClass(){this.iconListStatus="inactive_icon",this.iconGridStatus="inactive_icon",this.registrationDisplayType=="list"?this.iconListStatus="active_icon":this.registrationDisplayType=="grid"&&(this.iconGridStatus="active_icon")}}}),_e={key:0,class:"spinner-overlay"},be={class:"header position_content"},Se={style:{display:"flex","align-items":"center"}},Ie={class:"container"},De={class:"title"},Ce={class:"demographics_title"},ke={class:"icon_div displayNoneMobile"},Pe={key:0,class:"center_content"},Le={key:0,class:"flex-container"},we={class:"flex-item"},Te={class:"flex-item"},Re={class:"flex-item"},$e={key:1},Ne={key:0},Be={key:1},He={style:{"justify-content":"center"}},Oe={key:0},Ae={key:1},Ge={key:2},Ue={key:3},Fe={key:4},Me={key:1,class:"footer2"},Ee={class:"footer position_content"};function We(t,e,n,d,f,h){const P=u("ion-spinner"),m=u("ion-icon"),$=u("ion-header"),S=u("PersonalInformation"),N=u("Country"),B=u("CurrentLocation"),v=u("HomeLocation"),F=u("PatientType"),M=u("SocialHistory"),E=u("BirthRegistration"),G=u("GuardianInformation"),z=u("ion-content"),s=u("DynamicButton"),w=u("ion-breadcrumb"),l=u("ion-breadcrumbs"),C=u("ion-footer"),ct=u("ion-page");return c(),g(ct,{class:R({loading:t.isLoading})},{default:r(()=>[t.isLoading?(c(),_("div",_e,[i(P,{name:"bubbles"}),e[11]||(e[11]=o("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),i($,null,{default:r(()=>[o("div",be,[o("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=I=>t.nav("/home"))},[i(m,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeft},null,8,["icon"]),e[12]||(e[12]=o("span",{style:{"padding-left":"10px"}},"Go back",-1))]),e[14]||(e[14]=o("div",null,null,-1)),o("div",Se,[i(m,{slot:"separator",size:"large",icon:t.iconsContent.help},null,8,["icon"]),e[13]||(e[13]=o("span",{style:{"padding-left":"10px"}}," Need any help?",-1))])])]),_:1}),i(z,null,{default:r(()=>[o("div",Ie,[o("div",De,[o("div",Ce,"New "+y(t.programID()!=33?"patient":"client")+" registration ",1)]),o("div",ke,[i(m,{class:R(t.iconListStatus),icon:t.list,onClick:e[1]||(e[1]=I=>t.setDisplayType("list"))},null,8,["class","icon"]),i(m,{class:R(t.iconGridStatus),style:{"font-size":"21px","margin-top":"1.5px"},icon:t.grid,onClick:e[2]||(e[2]=I=>t.setDisplayType("grid"))},null,8,["class","icon"])])]),t.registrationDisplayType=="grid"&&t.screenWidth>991?(c(),_("div",Pe,[t.registrationDisplayType=="grid"?(c(),_("div",Le,[o("div",we,[i(S)]),o("div",Te,[i(N),t.regSelectedCountry=="Malawi"?(c(),g(B,{key:0})):p("",!0),t.regSelectedCountry=="Malawi"?(c(),g(v,{key:1})):p("",!0)]),o("div",Re,[t.isPatientTypeRequired?(c(),g(F,{key:0,ref:"patientTypeComponent"},null,512)):p("",!0),t.checkUnderFourteen?(c(),g(M,{key:1})):p("",!0),t.checkUnderNine?(c(),g(E,{key:2})):p("",!0),i(G)])])):p("",!0)])):p("",!0),t.registrationDisplayType=="list"||t.screenWidth<=991?(c(),_("div",$e,[t.currentStep=="Personal Information"?(c(),_("div",Ne,[i(S)])):p("",!0),t.currentStep=="Location"?(c(),_("div",Be,[o("div",He,[o("div",null,[i(N)]),t.regSelectedCountry=="Malawi"?(c(),_("div",Oe,[i(B)])):p("",!0),t.regSelectedCountry=="Malawi"?(c(),_("div",Ae,[i(v)])):p("",!0)])])):p("",!0),t.currentStep=="Patient Type"&&t.isPatientTypeRequired?(c(),_("div",Ge,[i(F,{ref:"patientTypeComponent"},null,512)])):p("",!0),t.currentStep=="Social History"?(c(),_("div",Ue,[t.checkUnderFourteen?(c(),g(M,{key:0})):p("",!0),t.checkUnderFive?(c(),g(E,{key:1})):p("",!0)])):p("",!0),t.currentStep=="Guardian Information"?(c(),_("div",Fe,[i(G)])):p("",!0)])):p("",!0)]),_:1}),t.registrationDisplayType=="grid"&&t.screenWidth>991?(c(),_("div",Me,[i(s,{name:"Save",iconSlot:"end",icon:t.iconsContent.saveWhite,disabledValue:t.disableSaveBtn,onClick:e[3]||(e[3]=I=>t.createPatient())},null,8,["icon","disabledValue"])])):p("",!0),t.registrationDisplayType=="list"||t.screenWidth<=991?(c(),g(C,{key:2},{default:r(()=>[o("div",Ee,[t.currentStep=="Personal Information"?(c(),g(s,{key:0,name:"Cancel",color:"danger",onClick:e[4]||(e[4]=I=>t.cancel(I))})):(c(),g(s,{key:1,name:"Previous",icon:t.iconsContent.arrowLeftWhite,color:"medium",onClick:t.previousStep},null,8,["icon","onClick"])),i(l,{class:"breadcrumbs displayNoneMobile"},{default:r(()=>[i(w,{onClick:e[5]||(e[5]=I=>t.setCurrentStep("Personal Information")),class:R({active:t.currentStep==="Personal Information"})},{separator:r(()=>[i(m,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:r(()=>[e[15]||(e[15]=o("span",{class:"breadcrumb-text"},"Personal Information",-1))]),_:1,__:[15]},8,["class"]),i(w,{onClick:e[6]||(e[6]=I=>t.setCurrentStep("Location")),class:R({active:t.currentStep==="Location"})},{separator:r(()=>[i(m,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:r(()=>[e[16]||(e[16]=o("span",{class:"breadcrumb-text"},"Location",-1))]),_:1,__:[16]},8,["class"]),t.isPatientTypeRequired?(c(),g(w,{key:0,onClick:e[7]||(e[7]=I=>t.setCurrentStep("Patient Type")),class:R({active:t.currentStep==="Patient Type"})},{separator:r(()=>[i(m,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:r(()=>[e[17]||(e[17]=o("span",{class:"breadcrumb-text"},"Patient Type",-1))]),_:1,__:[17]},8,["class"])):p("",!0),i(w,{onClick:e[8]||(e[8]=I=>t.setCurrentStep("Social History")),class:R({active:t.currentStep==="Social History"})},{separator:r(()=>[i(m,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:r(()=>[e[18]||(e[18]=o("span",{class:"breadcrumb-text"},"Social History",-1))]),_:1,__:[18]},8,["class"]),i(w,{onClick:e[9]||(e[9]=I=>t.setCurrentStep("Guardian Information")),class:R({active:t.currentStep==="Guardian Information"})},{separator:r(()=>[i(m,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:r(()=>[e[19]||(e[19]=o("span",{class:"breadcrumb-text"},"Guardian Information",-1))]),_:1,__:[19]},8,["class"])]),_:1}),t.currentStep=="Guardian Information"?(c(),g(s,{key:2,name:"Save",iconSlot:"end",icon:t.iconsContent.saveWhite,onClick:e[10]||(e[10]=I=>t.createPatient())},null,8,["icon"])):(c(),g(s,{key:3,name:"Next",disabledValue:!1,iconSlot:"end",icon:t.iconsContent.arrowRightWhite,onClick:t.nextStep},null,8,["icon","onClick"]))])]),_:1})):p("",!0)]),_:1},8,["class"])}const wi=j(ve,[["render",We],["__scopeId","data-v-a90896a5"]]);export{wi as default};

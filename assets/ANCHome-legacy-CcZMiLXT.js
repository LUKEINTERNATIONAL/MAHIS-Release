System.register(["./vendor-legacy-0npofEhZ.js","./index-legacy-D39L0j5y.js","./DemographicBar-legacy-Bo4ylHAL.js","./NextAppointmentModal-legacy-VxW5k64p.js","./SaveProgressModal-legacy-wstVke9Z.js","./FeatusModal-legacy-CFjmSUZj.js","./formatServerData-legacy-B23m4w_y.js","./vaccines_service-legacy-C1r2petT.js","./sms_service-legacy-CiQxinsv.js","./relationship_service-legacy-CKSavFw8.js","./BasicForm-legacy-CKcoXxsc.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-BWRlCn3l.js","./EIRreportsStore-legacy-C_2q1Cpc.js","./Export-legacy-CpccDaAq.js","./DateInputField-legacy-BXK21Ph_.js"],function(t,e){"use strict";var a,n,o,i,l,s,c,r,p,d,u,m,g,f,h,y,v,x,b,w,D,_,A,M,S,k,I,N,C,O,j,$,F,z,T,B,R,U,H,J,E,P,V,L,Y,Z,G,W,q,K,X,Q,tt,et,at,nt,ot,it,lt,st,ct,rt,pt;return{setters:[t=>{a=t.d,n=t.r,o=t.a,i=t.e,l=t.f,s=t.l,c=t.y,r=t.m,p=t.z,d=t.u,u=t.aj,m=t.k,g=t.D,f=t.A,h=t.B,y=t.ai,v=t.br,x=t.W,b=t.F,w=t.X,D=t.ao,_=t.ag,A=t.an,M=t.ah,S=t.bG,k=t.c9,I=t.c_,N=t.a9,C=t.aa,O=t.E},t=>{j=t.aL,$=t.u,F=t.H,z=t.S,T=t.P,B=t.t,R=t.h,U=t.A,H=t.z,J=t.bq,E=t._,P=t.T,V=t.D,L=t.j,Y=t.l,Z=t.k,G=t.aK,W=t.ab},t=>{q=t.D},t=>{K=t.N,X=t.u,Q=t.a,tt=t.L},t=>{et=t.S},t=>{at=t.F},t=>{nt=t.a},t=>{ot=t.u,it=t.A,lt=t.a,st=t.v},t=>{ct=t.S},t=>{rt=t.R},t=>{pt=t.B},null,null,null,null,null],execute:function(){var e=document.createElement("style");e.textContent=".ilbl[data-v-99caf421]{font-size:23px}.calender[data-v-99caf421]{--dp-cell-padding: 30px;--dp-menu-padding: 20px 5px;--dp-font-size: 18px}.card_content[data-v-99caf421]{width:100%}.dp__flex_display[data-v-99caf421]{display:inherit}.toggle-green[data-v-99caf421]{--toggle-bg-on: #006401;--toggle-border-on: #006401;--toggle-width: 6.3rem;--toggle-height: 1.9rem;--toggle-border: .525rem;--toggle-font-size: 1rem;margin-bottom:30px}.lbl-tl[data-v-99caf421]{min-width:20px;color:#b3b3b3!important;white-space:nowrap}.lbl-ct[data-v-99caf421]{white-space:nowrap;color:#08475e;font-size:14px}.btnText[data-v-99caf421]{font-style:normal;font-weight:500;font-size:14px}.container[data-v-75067a76]{text-align:center;position:fixed;left:0;right:0;top:35%;transform:translateY(-50%)}.back_profile[data-v-75067a76]{display:flex;justify-content:space-between;align-items:center;width:100%;font-weight:400;font-size:14px;z-index:1000;padding-left:25%;padding-right:25%}.AppointmentDate[data-v-75067a76]{margin-right:5%}ion-card[data-v-75067a76]{width:300px;margin:8px}.button-container[data-v-75067a76]{display:block;justify-content:space-around;margin:10px 0}.dynamic-button[data-v-75067a76]{flex:1;margin:0 5px;min-width:120px}@media (max-width: 768px){.dynamic-button[data-v-75067a76]{margin:0 15px}.container[data-v-75067a76]{text-align:center;position:absolute;left:0;right:0;top:43%;transform:translateY(-50%)}ion-card[data-v-75067a76]{width:400px;margin:4px}.button-container[data-v-75067a76]{display:flex;justify-content:space-around;margin:5px;padding-left:1%;padding-right:1%}.back_profile[data-v-75067a76]{display:flex;justify-content:space-between;width:100%;font-weight:400;font-size:14px;z-index:1000;padding:0 5%;margin-bottom:10px}.AppointmentDate[data-v-75067a76]{margin-left:0}}hr[data-v-75067a76]{margin:20px 0;border:2px solid #ccc}\n/*$vite$:1*/",document.head.appendChild(e);class dt extends j{constructor(t,e){super(t,7,e)}}const ut={class:"lbl-ct"},mt={class:"lbl-ct"},gt={style:{"margin-right":"20px",color:"black"}},ft={style:{"font-size":"16px",color:"#666","margin-top":"5px"}},ht=a({watch:{},name:"xxxComponent",computed:{...D(X,["nextAppointmentDate"]),...D($,["patient"])},methods:{handleInputData(t){J(this.nextAppointmentDate,K,t.name,t.value),this.handleDateOfScheduledAppointmentRange(t)},closeCircleOutline:()=>_,handleDateOfScheduledAppointmentRange(t){const e=new Date,a=new Date(e);a.setDate(a.getDate()+1);const n=a.toISOString().split("T")[0],o=new Date(e);o.setDate(o.getDate()+32);const i=o.toISOString().split("T")[0];H(this.nextAppointmentDate,"Appointment date","minDate",n),H(this.nextAppointmentDate,"Appointment date","maxDate",i)}}}),yt=a({...ht,props:{patient_Id:{},encounter_Id:{}},setup(t){const e=$(),a=$(),D=n(),_=n(),A=n(!1),M=n(!1),S=F.toStandardHisDisplayFormat(z.getSessionDate()),k=n(!1),I=n(),N=n(0),C=n([]),O=[],j=t;async function H(){await async function(){try{await st(j.encounter_Id,"Rescheduled"),await st(j.encounter_Id,"Rescheduled")}catch(t){}}(),await async function(){try{var t;const a=await rt.getRelationships(e.patient.patientID);if(a.length>0){const t=a[0].relation.person_attributes.find(t=>"Cell Phone Number"==t.type.name);t&&C.value.push(t.value)}null!==(t=e.patient)&&void 0!==t&&null!==(t=t.personInformation)&&void 0!==t&&t.cell_phone_number&&C.value.push(e.patient.patientID)}catch(a){}}();const t=j.patient_Id?new it(j.patient_Id):new it,a=await t.createAppointment();!async function(){const t=R();t.setVaccineReload(!t.getVaccineReload())}(),async function(){const t=ot();t.setAppointmentsReload(!t.getAppointmentsReload())}(),E(),async function(t){if(0!=C.value.length){if(Array.isArray(t)&&t.length>0)if(M.value){const e=await w.create({component:lt,componentProps:{date:t[1],patient:t[0],modalaction:"saveAppointment"}});await e.present()}else await ct.appointment(t[0],t[1])}else B("No phone numbers available for sms reminder!")}(a)}function J(t,e){const a=t.getFullYear(),n=t.getMonth(),o=t.getDate(),i=e.getFullYear(),l=e.getMonth(),s=e.getDate();return a!==i?a>i:n!==l?n>l:o>s}function E(){w.dismiss()}function P(t){const e=t.match(/(\d+)\s*(week|month|year)s?/i);if(!e)return"Invalid input format";const a=parseInt(e[1]);switch(e[2].toLowerCase()){case"week":return 7*a;case"month":return 30*a;case"year":return 365*a;default:return"Invalid time unit"}}function V(t,e){let a;if(t instanceof Date)a=new Date(t);else{const[e,n]=t.split(" "),[o,i,l]=e.split("/"),[s,c,r]=n.split(":"),p={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};a=new Date(Number(l),p[i],Number(o),Number(s),Number(c),Number(r))}a.setDate(a.getDate()+e);const n=t=>String(t).padStart(2,"0"),o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][a.getDay()],i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][a.getMonth()],l=n(a.getDate()),s=a.getFullYear(),c=n(a.getHours()),r=n(a.getMinutes()),p=n(a.getSeconds()),d=-a.getTimezoneOffset(),u=Math.floor(Math.abs(d)/60),m=Math.abs(d)%60,g=`GMT${d>=0?"+":"-"}${n(u)}${n(m)}`,f=Intl.DateTimeFormat().resolvedOptions().timeZone;let h;try{const t=new Intl.DateTimeFormat("en",{timeZone:f,timeZoneName:"long"}).formatToParts(a).find(t=>"timeZoneName"===t.type);h=t?t.value:f}catch(y){console.error("Error getting localized time zone name:",y),h=f}return`Date ${o} ${i} ${l} ${s} ${c}:${r}:${p} ${g} (${h})`}return o(async()=>{ot().clearAppointmentMent(),await async function(){try{let t=await ct.getConfigurations();M.value=t.show_sms_popup}catch(t){}}(),await async function(){try{const t=new T,e=void 0!==j.patient_Id?j.patient_Id:t.getID(),n=await async function(){try{const t=a.vaccineSchedule;t.vaccine_schedule.forEach(t=>{t.antigens.forEach(e=>{"administered"==e.status&&O.push({age:t.age,vaccine:e})})});for(const e of t.vaccine_schedule){if("current"===e.milestone_status)return e;if("upcoming"===e.milestone_status)return e}return null}catch(t){return null}}();if(O.length>0){const t=O[O.length-1];console.log(t);const a=await async function(t,e){try{const a=await T.findByID(e),n=V(new Date(a.person.birthdate),P(t.age)),o=function(t){const e={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},a=t.split(/[:/ ]/),n=`${a[2]}-${e[a[1]]}-${a[0]}T${a[3]}:${a[4]}:${a[5]}`;return new Date(n)}(t.vaccine.date_administered),i=new Date(n);return console.log(J(o,i)),J(o,i)}catch(a){}}(t,e);0==a&&(D.value=V(t.vaccine.date_administered,P(n.age)),_.value=F.toStandardHisDisplayFormat(D.value),async function(t){const e=ot(),a={counter:1,date:t};e.setAppointmentMent(a),k.value=!1,await async function(t){try{const e=await U.getDailiyAppointments(F.toStandardHisFormat(t),F.toStandardHisFormat(t));N.value=e.length+1}catch(e){}}(t),k.value=!0,I.value=F.toStandardHisDisplayFormat(t)}(D.value),function(t){const e=ot(),a=e.getAppointmentMents(),n=t=>{const e=new Date(t);return e.setHours(0,0,0,0),e.getTime()},o=n(new Date(t)),i=a.find(t=>n(new Date(t.date))===o);i&&i.counter}(D.value),A.value=!0)}}catch(t){}}()}),(t,e)=>(l(),i(b,null,[s(d(y),{style:{"margin-top":"10px"}},{default:p(()=>[s(d(u),{style:{"margin-left":"-3px"}},{default:p(()=>e[0]||(e[0]=[m("div",{class:"om",style:{"font-weight":"600",color:"#8d8686"}},"Set Next Appointment Date",-1)])),_:1,__:[0]}),s(d(u),{size:"6",style:{"text-align":"right"}},{default:p(()=>[s(d(g),{class:"lbl-tl",style:{"font-size":"13px"}},{default:p(()=>[e[1]||(e[1]=f(" Todays Date: ",-1)),m("span",ut,h(d(S)),1)]),_:1,__:[1]})]),_:1})]),_:1}),s(d(y),{style:{"margin-top":"10px"}},{default:p(()=>[s(d(u),{style:{"margin-left":"-3px"}},{default:p(()=>e[2]||(e[2]=[m("div",{class:"om"},null,-1)])),_:1,__:[2]}),k.value?(l(),c(d(u),{key:0,size:"10",style:{"text-align":"right"}},{default:p(()=>[s(d(g),{class:"lbl-tl",style:{"font-size":"16px","font-weight":"500"}},{default:p(()=>[e[3]||(e[3]=f(" Total Appointments ",-1)),m("span",mt,"("+h(I.value)+")",1),e[4]||(e[4]=f(": ",-1)),m("span",gt,[s(d(v),{color:"primary",style:{"margin-bottom":"-5px","font-size":"15px"}},{default:p(()=>[f(h(N.value),1)]),_:1})])]),_:1,__:[3,4]})]),_:1})):r("",!0)]),_:1}),s(d(y),{style:{"margin-top":"20px"}},{default:p(()=>[s(d(u),null,{default:p(()=>[s(pt,{contentData:t.nextAppointmentDate,"onUpdate:selected":t.handleInputData,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:selected","onUpdate:inputValue"])]),_:1})]),_:1}),A.value?(l(),c(d(y),{key:0,style:{"margin-top":"0px","margin-bottom":"0px"}},{default:p(()=>[s(d(u),{style:{"background-color":"#f0f0f0",padding:"15px","border-radius":"8px","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)"}},{default:p(()=>[e[5]||(e[5]=m("div",{style:{"font-size":"17px",color:"#333","font-weight":"bold"}},"Suggested Date:",-1)),m("div",ft,h(_.value),1)]),_:1,__:[5]})]),_:1})):r("",!0),s(d(y),{style:{"margin-top":"10px","margin-bottom":"10px"}},{default:p(()=>[s(d(u),null,{default:p(()=>[s(d(x),{onClick:E,id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"}},{default:p(()=>e[6]||(e[6]=[f(" Cancel ",-1)])),_:1,__:[6]})]),_:1}),s(d(u),{style:{"text-align":"right"}},{default:p(()=>[s(d(x),{onClick:H,class:"btnText",fill:"solid",style:{width:"130px"}},{default:p(()=>e[7]||(e[7]=[f(" save ",-1)])),_:1,__:[7]})]),_:1})]),_:1})],64))}}),vt=E(yt,[["__scopeId","data-v-99caf421"]]),xt=a({name:"TB screening",components:{IonRow:y,IonButton:x,FeatusModal:at,DynamicButton:V,IonContent:M,IonPage:A,Toolbar:P,DemographicBar:q,LandingPage:tt,NextAppointmentModal:Q},props:{backBtn:{type:String,default:"Back to profile"},backUrl:{type:String,default:""},contact:{type:String,default:""}},data:()=>({isModalOpen:!1,dateOfAppointment:""}),mounted(){this.handleAppointment()},setup:()=>({checkmark:C,pulseOutline:N}),computed:{...D(X,["nextAppointmentDate"]),...D($,["patient"])},methods:{calendar:()=>I,eye:()=>k,chevronBackOutline:()=>S,openBackController(){this.backUrl?this.$router.push(this.backUrl):L(et)},async handleAppointment(){const t=await W.getFirstObsValue(this.patient.patientID,"Appointment date","value_text");this.dateOfAppointment=t},async saveData(){const t=X();await t.validate()?(await this.saveDate(),this.closeAppointmentModal(),await this.$router.push("ANCHome"),await await G()):Z("Next appointment date has errors")},async saveDate(){if(this.nextAppointmentDate.length>=0){const t=z.getUserID(),e=new dt(this.patient.patientID,t);if(!(await e.createEncounter()))return B("Unable to create appointment date encounter");if(!(await e.saveObservationList(await this.buildNextAppointment())))return B("Unable to create date!");Y("Client has been scheduled for next contact")}console.log(await this.buildNextAppointment())},openNextVaccineAppoinment(){L(vt,{class:"otherVitalsModal"},!1)},async buildNextAppointment(){return[...await nt(this.nextAppointmentDate)]},cancelModal(){this.closeAppointmentModal()},async nextAppointment(){this.toggleAppointmentModal()},toggleAppointmentModal(){this.isModalOpen=!this.isModalOpen},closeAppointmentModal(){this.isModalOpen=!1},previousContacts(){this.$router.push("/contacts")},navigateToContact(){this.$router.push("/contact")}}}),bt={class:"container"},wt={class:"back_profile"},Dt={class:"AppointmentDate"},_t={style:{color:"#0b5ed7"}},At={class:"button-container ion-justify-content-center ion-align-items-center"};t("default",E(xt,[["render",function(t,e,a,n,o,i){const r=O("Toolbar"),d=O("DemographicBar"),u=O("DynamicButton"),g=O("NextAppointmentModal"),f=O("LandingPage"),y=O("ion-content"),v=O("ion-page");return l(),c(v,null,{default:p(()=>[s(r),s(y,{fullscreen:!0},{default:p(()=>[s(d),m("div",bt,[m("div",wt,[s(u,{name:t.backBtn,iconSlot:"start",fill:"clear",icon:t.chevronBackOutline(),onClick:e[0]||(e[0]=e=>t.openBackController())},null,8,["name","icon"]),m("div",Dt,[e[1]||(e[1]=m("span",{style:{"font-size":"14px"}},"Appointment Date: ",-1)),m("b",_t,h(t.dateOfAppointment||"Not scheduled"),1)])]),m("div",At,[s(u,{style:{"padding-right":"1%"},name:"New ANC contact",iconSlot:"start",fill:"solid",icon:t.checkmark,onClick:t.navigateToContact},null,8,["icon","onClick"]),s(u,{style:{"padding-right":"1%"},name:"View ANC contacts",iconSlot:"start",fill:"solid",icon:t.eye(),onClick:t.previousContacts},null,8,["icon","onClick"]),s(u,{name:"Schedule next contact",iconSlot:"start",fill:"solid",icon:t.calendar(),onClick:t.nextAppointment},null,8,["icon","onClick"])]),s(g,{isOpen:t.isModalOpen,title:"",closeModalFunc:t.closeAppointmentModal,onYes:t.saveData,onNo:t.cancelModal},null,8,["isOpen","closeModalFunc","onYes","onNo"]),e[2]||(e[2]=m("hr",null,null,-1)),s(f)])]),_:1})]),_:1})}],["__scopeId","data-v-75067a76"]]))}}});

import{d as fe,r as p,a as de,y as q,f as b,u as e,ag as Ie,z as a,l as t,k as n,ad as we,m as N,d9 as ga,bq as $e,ac as X,ab as H,D as M,A as u,B as A,d7 as xe,cu as Ke,e as E,L as ne,cv as et,F as J,ar as ze,O as le,c as Z,bg as bt,S as _a,U as pt,T as ba,bf as mt,W,I as Y,ah as tt,an as ya,G,aw as be,ax as Q,bP as Be,ay as Te,V as ha,ds as yt,w as ht,c_ as Ct,aj as wt,p as St,cZ as Ca,aA as wa,az as Sa,aa as ka,aK as Da,E as ae,bZ as Va,n as Ia,M as Ta,i as Ea,J as me,dZ as ge,v as Oa,d_ as gt,av as Fe,d$ as _e,dd as Pa,bn as Ma,c$ as Na,dl as xa,dm as _t,e0 as Fa,a$ as Ba}from"./vendor-Ddb6Z0_s.js";import{P as Ee,t as K,H as Oe,_ as ye,m as j,aB as He,k as Ae,A as Aa,J as lt,u as nt,Z as Ra,S as kt,ae as Je,cp as Ue,a3 as La,cq as Dt,e as Ha}from"./index-DuNDgd8X.js";import{C as ue,P as qa,R as $a}from"./prescription_service-8DxWUqWC.js";import{l as Vt}from"./lodash-Dt8AsbQm.js";import{_ as We}from"./DatePicker.vue_vue_type_script_setup_true_lang-kQ_i1dg4.js";import{a as za}from"./lab_order-DbYZDq0j.js";import{C as Ua}from"./chartjs-BwgACvHv.js";import{A as ee}from"./app_encounter_service-Du7cx0ZT.js";import{P as Wa}from"./patient_type_service-DsV98BEB.js";import{S as ja}from"./SelectFacility-BhdO2d25.js";import{u as Ya}from"./Arrays-CfBll-2n.js";const Ga=fe({__name:"ArtDrugTransferIn",emits:["canEnterTransferDrugs"],setup(r,{expose:c,emit:d}){const _=d,V=new Ee,m=p({}),f=V.getID(),y=new ue(V.getID(),-1),O=new qa(V.getID(),-1),w=p({isLoading:!1,canSubmit:!1,arv_drugs:[],is_transfer_in:!0,date_art_started:"",date_last_received_arvs:"",selected_arvs:[],drug_interval:""}),C={date_last_received_arvs:{label:"Last ARV Dispensation",required:()=>w.value.is_transfer_in,init:async()=>{w.value.is_transfer_in=await C.date_last_received_arvs.getTransferInStatus(),w.value.date_art_started=await C.date_last_received_arvs.getDateStartedArt(),_("canEnterTransferDrugs",w.value.is_transfer_in)},buildObs:()=>y.buildValueDate("Date drug received from previous facility",w.value.date_last_received_arvs),validation:()=>{const o=D("date_last_received_arvs");if(o){const s=le(w.value.date_last_received_arvs);return s.isBefore(le(w.value.date_art_started))?(m.value.date_last_received_arvs="Date last received ARVs cannot be before ART start date",!1):s.isAfter(le(y.getDate()))?(m.value.date_last_received_arvs="Date last received ARVs cannot be after today",!1):!0}return o},getDateStartedArt:async()=>{const o=await ue.getFirstValueDatetime(f,"Date ART started");return o?Oe.toStandardHisFormat(o):""},getTransferInStatus:async()=>{const o=await ue.getFirstValueCoded(f,"Ever received ART"),s=await ue.getFirstObs(f,"Has transfer letter"),i=s?Oe.toStandardHisFormat(s.obs_datetime):"";return o&&o.match(/yes/i)&&s&&"".concat(s.value_coded).match(/yes/i)&&i===y.getDate()}},selected_arvs:{label:"Last ARV drugs dispensed",init:async()=>{w.value.arv_drugs=(await O.getARVs()).map(o=>({drug:o,name:o.name,pill_brought:null,dispensed_quantity:null,dispensed_quantity_error_id:"dispensed_quantity_error_".concat(o.drug_id),pills_brought_error_id:"pills_brought_error_".concat(o.drug_id)}))},required:()=>w.value.is_transfer_in,buildObs:()=>w.value.selected_arvs.map(async o=>({...await y.buildObs("Drug received from previous facility",{value_drug:o.drug.drug_id,value_datetime:(O.setNextVisitInterval(w.value.drug_interval),O.calculateDateFromInterval()),value_numeric:o.dispensed_quantity}),child:[await y.buildObs("Number of tablets brought to clinic",{value_drug:o.drug.drug_id,value_numeric:o.pill_brought,value_datetime:w.value.date_last_received_arvs})]})),validation:()=>{const o=D("selected_arvs");let s=o;return o&&w.value.selected_arvs.forEach(i=>{m.value[i.dispensed_quantity_error_id]="",S(i.dispensed_quantity)||(m.value[i.dispensed_quantity_error_id]="A valid digit is required",s=!1),m.value[i.pills_brought_error_id]="",S(i.pill_brought)||(m.value[i.pills_brought_error_id]="A valid digit is required",s=!1)}),s}},drug_interval:{label:"Duration period for last received ARVs",required:()=>w.value.is_transfer_in,validation:()=>D("drug_interval"),options:()=>[{label:"2 weeks",value:14},{label:"1 month",value:28},{label:"2 months",value:56},{label:"3 months",value:84},{label:"4 months",value:112},{label:"5 months",value:140},{label:"6 months",value:168},{label:"7 months",value:196},{label:"8 months",value:224},{label:"9 months",value:252},{label:"10 months",value:280},{label:"11 months",value:308},{label:"12 months",value:336}]}};function S(o){return/^\d+$/i.test("".concat(o))}function D(o){m.value[o]="";const s=C[o],i=typeof(s==null?void 0:s.required)=="function"?s.required():!1,T=typeof w.value[o]=="object"?Vt.isEmpty(w.value[o]):Array.isArray(w.value[o])?w.value[o].length===0:"".concat(w.value[o]).length===0;return i&&T?(m.value[o]="This field is required",!1):i}function I(){return Object.keys(C).reduce((o,s)=>{if(s in C&&typeof C[s].required=="function"&&C[s].required()&&typeof C[s].buildObs=="function"){const i=C[s].buildObs();return Array.isArray(i)?[...o,...i]:[...o,i]}return o},[])}function g(){return w.value.canSubmit?Object.keys(C).every(o=>v(o)):(K("Please wait for all data to load before submitting"),!1)}function v(o){return m.value[o]="",typeof C[o].validation=="function"?C[o].validation():!0}function k(o,s){v(o),Object.keys(C).forEach(i=>{var T;return((T=C[i])==null?void 0:T.onFormUpdate)&&C[i].onFormUpdate(o,s)})}async function P(){w.value.isLoading=!0,w.value.canSubmit=!1,await Promise.all(Object.keys(C).filter(o=>typeof C[o].init=="function").map(o=>C[o].init())),w.value.isLoading=!1,w.value.canSubmit=!0}return de(()=>P()),c({buildObs:I,validateAll:g}),(o,s)=>w.value.is_transfer_in?(b(),q(e(Ie),{key:1},{default:a(()=>[w.value.isLoading?(b(),q(e(ga),{key:0,type:"indeterminate"})):N("",!0),t(e(we),null,{default:a(()=>[t(e($e),null,{default:a(()=>[t(e(X),null,{default:a(()=>[t(e(H),null,{default:a(()=>[t(e(M),{class:"form-label"},{default:a(()=>[u(A(C.date_last_received_arvs.label)+" ",1),s[6]||(s[6]=n("span",{style:{color:"red"}},"*",-1))]),_:1,__:[6]}),t(We,{place_holder:"",date_prop:"",onDateUpDated:s[0]||(s[0]=i=>{w.value.date_last_received_arvs=i.value.standardDate,k("date_last_received_arvs",i.value.standardDate)}),error:!!m.value.date_last_received_arvs},null,8,["error"]),m.value.date_last_received_arvs?(b(),q(e(xe),{key:0,color:"danger"},{default:a(()=>[u(A(m.value.date_last_received_arvs),1)]),_:1})):N("",!0)]),_:1})]),_:1}),t(e(X),null,{default:a(()=>[t(e(H),null,{default:a(()=>[t(e(M),{class:"form-label"},{default:a(()=>[u(A(C.selected_arvs.label)+" ",1),s[7]||(s[7]=n("span",{style:{color:"red"}},"*",-1))]),_:1,__:[7]}),t(e(Ke),{multiple:"",fill:"outline",modelValue:w.value.selected_arvs,"onUpdate:modelValue":s[1]||(s[1]=i=>w.value.selected_arvs=i),onIonChange:s[2]||(s[2]=i=>k("selected_arvs",i.detail.value)),interface:"popover",placeholder:"Select ARVs"},{default:a(()=>[(b(!0),E(J,null,ne(w.value.arv_drugs,i=>(b(),q(e(et),{key:i,value:i},{default:a(()=>[u(A(i.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),m.value.selected_arvs?(b(),q(e(xe),{key:0,class:"ion-text-center ion-padding",color:"danger"},{default:a(()=>[u(A(m.value.selected_arvs),1)]),_:1})):N("",!0)]),_:1}),t(e(H),null,{default:a(()=>[t(e(M),{class:"form-label"},{default:a(()=>[u(A(C.drug_interval.label)+" ",1),s[8]||(s[8]=n("span",{style:{color:"red"}},"*",-1))]),_:1,__:[8]}),t(e(Ke),{fill:"outline",modelValue:w.value.drug_interval,"onUpdate:modelValue":s[3]||(s[3]=i=>w.value.drug_interval=i),onIonChange:s[4]||(s[4]=i=>k("drug_interval",i.detail.value)),interface:"popover",placeholder:"Select duration"},{default:a(()=>[(b(!0),E(J,null,ne(C.drug_interval.options(),i=>(b(),q(e(et),{key:i.value,value:i.value},{default:a(()=>[u(A(i.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),m.value.drug_interval?(b(),q(e(xe),{key:0,color:"danger"},{default:a(()=>[u(A(m.value.drug_interval),1)]),_:1})):N("",!0)]),_:1})]),_:1})]),_:1}),w.value.selected_arvs.length?(b(),q(e(Ie),{key:0,class:"ion-padding"},{default:a(()=>[t(e(we),null,{default:a(()=>[(b(!0),E(J,null,ne(w.value.selected_arvs,i=>(b(),q(e($e),{key:i.drug.drug_id},{default:a(()=>[t(e(X),null,{default:a(()=>[t(e(H),null,{default:a(()=>[t(e(M),{class:"form-label"},{default:a(()=>[u(A(i.name)+" ",1),s[9]||(s[9]=n("span",{style:{color:"red"}},"*",-1))]),_:2,__:[9]},1024)]),_:2},1024)]),_:2},1024),t(e(X),null,{default:a(()=>[t(e(H),null,{default:a(()=>[t(e(M),{class:"form-label"},{default:a(()=>s[10]||(s[10]=[u(" Given Amount "),n("span",{style:{color:"red"}},"*",-1)])),_:1,__:[10]}),t(e(ze),{onIonInput:T=>k("selected_arvs",i),modelValue:i.dispensed_quantity,"onUpdate:modelValue":T=>i.dispensed_quantity=T,placeholder:"Enter amount",fill:"outline",type:"number"},null,8,["onIonInput","modelValue","onUpdate:modelValue"]),m.value[i.dispensed_quantity_error_id]?(b(),q(e(xe),{key:0,color:"danger"},{default:a(()=>[u(A(m.value[i.dispensed_quantity_error_id]),1)]),_:2},1024)):N("",!0)]),_:2},1024),t(e(H),null,{default:a(()=>[t(e(M),{class:"form-label"},{default:a(()=>s[11]||(s[11]=[u(" Pill brought "),n("span",{style:{color:"red"}},"*",-1)])),_:1,__:[11]}),t(e(ze),{onIonInput:T=>k("selected_arvs",i),modelValue:i.pill_brought,"onUpdate:modelValue":T=>i.pill_brought=T,placeholder:"Enter amount",type:"number",fill:"outline"},null,8,["onIonInput","modelValue","onUpdate:modelValue"]),m.value[i.pills_brought_error_id]?(b(),q(e(xe),{key:0,color:"danger"},{default:a(()=>[u(A(m.value[i.pills_brought_error_id]),1)]),_:2},1024)):N("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):N("",!0)]),_:1})]),_:1})):(b(),q(e(Ie),{key:0},{default:a(()=>[t(e(we),null,{default:a(()=>s[5]||(s[5]=[n("h1",{class:"ion-text-center ion-padding"},"Client is not a transfer in",-1)])),_:1,__:[5]})]),_:1}))}}),Qa=ye(Ga,[["__scopeId","data-v-ed3faab3"]]),Za=()=>{const r=p(2),c=p(null);let d=null;const _=p(!1),V=p([]);return window.addEventListener("resize",()=>{d&&c.value&&d.resize()}),{chartPeriod:r,weightChartCanvas:c,isLoadingWeightData:_,weightData:V,loadWeightHistory:async()=>{_.value=!0;try{const w=await new Ee().getWeightHistory();w&&w.length>0?(V.value=w.map(C=>({date:le(C.date).format("MM-DD"),weight:parseFloat(C.weight)})),V.value.sort((C,S)=>le(C.date,"MM-DD").valueOf()-le(S.date,"MM-DD").valueOf())):(K("No weight history found for this patient"),V.value=[],d&&(d.destroy(),d=null))}catch(O){console.error("Error loading weight history:",O),j("Failed to load weight history"),V.value=[],d&&(d.destroy(),d=null)}finally{_.value=!1}},initializeWeightChart:()=>{var g;if(!c.value||V.value.length===0)return;d&&(d.destroy(),d=null);const O=((g=c.value.parentElement)==null?void 0:g.clientWidth)||800;c.value.width=O,c.value.height=300;const w=c.value.getContext("2d");if(!w)return;const C=V.value.map(v=>v.date),S=V.value.map(v=>v.weight),D=V.value.findIndex(v=>v.height!==void 0),I=w.createLinearGradient(0,0,0,400);I.addColorStop(0,"rgba(75, 192, 75, 0.6)"),I.addColorStop(1,"rgba(75, 192, 75, 0.1)"),d=new Ua(w,{type:"line",data:{labels:C,datasets:[{label:"Weight",data:S,borderColor:"rgb(75, 192, 75)",backgroundColor:I,tension:.3,fill:!0,pointBackgroundColor:"rgb(75, 192, 75)",pointRadius:5}]},options:{responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:10,right:10,bottom:10,left:10}},scales:{y:{min:30,max:220,ticks:{stepSize:10},grid:{color:"rgba(200, 200, 200, 0.3)"}},x:{grid:{color:"rgba(200, 200, 200, 0.3)"}}},plugins:{tooltip:{callbacks:{afterLabel:v=>{if(v.dataIndex===D&&V.value[D].height)return"Height: ".concat(V.value[D].height,"cm")}}}}}})},cleanupChart:()=>{d&&(d.destroy(),d=null)}}},Xa=()=>{const r=p([]),c=p([]),d=p(["Routine","Targeted","Confirmatory","Stat","Repeat / Missing","Follow up after Low Level Viremia","Follow up after High Viral Load"]),_=p(null),V=p(null),m=p(null),f=p(""),y=p([]),O=p(null),w=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),C=async()=>{try{const o=await Aa("testTypes");if(Array.isArray(o)&&o.length>0)r.value=o.map(s=>({id:s.concept_id.toString(),name:s.name,assigned_id:s.concept_id.toString()}));else if(o&&"records"in o&&o.records.length>0)r.value=o.records.map(s=>({id:s.concept_id.toString(),name:s.name,assigned_id:s.concept_id.toString()}));else{const s=await He.getTestTypes();s&&s.length>0&&(r.value=s.map(i=>({id:i.concept_id.toString(),name:i.name,assigned_id:i.concept_id.toString()})))}}catch(o){console.error("Error loading test types:",o),j("Failed to load test types")}},S=async o=>{if(!o){c.value=[];return}try{const s=await He.getSpecimens(o);s&&s.length>0?(c.value=s.map(i=>({id:i.concept_id.toString(),name:i.name,assigned_id:i.concept_id.toString()})),s.length===1&&(V.value=c.value[0])):(c.value=[],K("No specimens found for the selected test"))}catch(s){console.error("Error loading specimens:",s),j("Failed to load specimens")}};return{testOptions:r,specimenOptions:c,testReasons:d,selectedTest:_,selectedSpecimen:V,selectedReason:m,selectedAccessionNumber:f,labInvestigations:y,editingInvestigationId:O,loadTestTypes:C,loadSpecimens:S,handleTestChange:o=>{o&&o.name?S(o.name):(c.value=[],V.value=null)},handleBarcodeScanned:async o=>{if(!o||o.trim().length===0)return K("Barcode is required"),!1;try{return await He.accessionNumExists(o)?(K("Barcode ".concat(o," was already used")),!1):(f.value=o,!0)}catch(s){return console.error("Error checking barcode:",s),j("Failed to confirm barcode ".concat(o,", Please try again later")),!1}},refreshTestTypes:async()=>{try{const o=await He.getTestTypesViaDirectAPICall();o&&o.length>0?(r.value=o.map(s=>({id:s.concept_id.toString(),name:s.name,assigned_id:s.concept_id.toString()})),Ae("Test types refreshed successfully")):K("No test types found")}catch(o){console.error("Error refreshing test types:",o),j("Failed to refresh test types")}},saveLabInvestigation:async()=>{if(_.value&&V.value&&m.value){if(y.value.some(s=>{var i,T;return s.test.id===((i=_.value)==null?void 0:i.id)&&s.specimen.id===((T=V.value)==null?void 0:T.id)&&s.id!==O.value})){K("This test and specimen combination has already been added");return}if(O.value){const s=y.value.findIndex(i=>i.id===O.value);s!==-1&&(y.value[s]={...y.value[s],test:_.value,specimen:V.value,reason:m.value,accessionNumber:f.value,isEditing:!1},O.value=null)}else{const s={id:w(),test:_.value,specimen:V.value,reason:m.value,accessionNumber:f.value,dateAdded:new Date().toISOString(),isEditing:!1};y.value.push(s)}_.value=null,V.value=null,m.value=null,f.value=""}else K("Please select test, specimen, and reason for testing")},editLabInvestigation:o=>{const s=y.value.find(i=>i.id===o);s&&(_.value=s.test,V.value=s.specimen,m.value=s.reason,f.value=String(s.accessionNumber),O.value=s.id)},cancelLabInvestigation:o=>{const s=y.value.findIndex(i=>i.id===o);s!==-1&&y.value.splice(s,1),O.value===o&&(_.value=null,V.value=null,O.value=null)}}},qe=[{category:"contraindication",concept_id:821,name:"Peripheral neuropathy"},{category:"contraindication",concept_id:215,name:"Jaundice"},{category:"contraindication",concept_id:2148,name:"Lipodystrophy"},{category:"contraindication",concept_id:9242,name:"Kidney Failure"},{category:"contraindication",concept_id:219,name:"Psychosis"},{category:"contraindication",concept_id:9440,name:"Gynaecomastia"},{category:"contraindication",concept_id:3,name:"Anemia"},{category:"contraindication",concept_id:512,name:"Skin rash"},{category:"contraindication",concept_id:867,name:"Insomnia"},{category:"side_effect",concept_id:6029,name:"Night sweats"},{category:"side_effect",concept_id:5945,name:"Fever"},{category:"side_effect",concept_id:5980,name:"Vomiting"},{category:"side_effect",concept_id:877,name:"Dizziness"},{category:"side_effect",concept_id:620,name:"Headache"},{category:"side_effect",concept_id:5978,name:"Nausea"},{category:"side_effect",concept_id:1458,name:"Lactic acidosis"},{category:"side_effect",concept_id:107,name:"Cough"},{category:"side_effect",concept_id:1773,name:"Heavy alcohol use"},{category:"side_effect",concept_id:8260,name:"Weight loss / Failure to thrive / malnutrition"}],Ja=(r="all")=>{const c=p([]),d=p({}),_=p(!1),V=p(null),m=p(null),f=Z(()=>r==="all"?qe:qe.filter(v=>v.category===r)),y=()=>{const v=f.value.map(k=>({id:"".concat(k.concept_id),label:k.name,value:!1,concept_id:k.concept_id}));c.value=v,v.forEach(k=>{d.value[k.id]={selected:k.value}})},O=()=>{c.value.forEach(v=>{d.value[v.id]={selected:!1}})},w=()=>Object.values(d.value).some(v=>v.selected===!0),C=()=>c.value.filter(v=>{var k;return(k=d.value[v.id])==null?void 0:k.selected}).map(v=>v.label),S=v=>{const k={...d.value};r=v,y(),c.value.forEach(P=>{k[P.id]!==void 0&&(d.value[P.id]=k[P.id])})},D=v=>v.map(k=>({label:k.label,value:k.id,isChecked:k.value}));de(()=>{y()});const I=async(v,k,P)=>{_.value=!0,m.value=null;try{const o=new ee(v,53,k,P),s=await o.createEncounter();if(!s)throw new Error("Failed to create encounter");V.value=s.encounter_id;const i={side_effect:"Malawi ART side effects",contraindication:"Other side effect",all:"Malawi ART Side Effects"},T=qe.filter(F=>F.category==="side_effect").map(F=>({id:"".concat(F.concept_id),label:F.name,value:!1,concept_id:F.concept_id})),x=qe.filter(F=>F.category==="contraindication").map(F=>({id:"".concat(F.concept_id),label:F.name,value:!1,concept_id:F.concept_id}));T.forEach(F=>{d.value[F.id]&&(F.value=d.value[F.id].selected)}),x.forEach(F=>{d.value[F.id]&&(F.value=d.value[F.id].selected)});const B=await o.buildOptionsGroupObs(i.side_effect,D(T)),R=await o.buildOptionsGroupObs(i.contraindication,D(x)),U=T.filter(F=>F.value&&F.reason).flatMap(F=>F.reason||[]),te=x.filter(F=>F.value&&F.reason).flatMap(F=>F.reason||[]);return{encounter_id:s.encounter_id,observations:[...B,...R,...U,...te]}}catch(o){return console.error("Error building side effects payload:",o),m.value="Failed to build side effects payload",null}finally{_.value=!1}};return{sideEffectOptions:c,sideEffects:d,resetSideEffects:O,hasSelectedSideEffects:w,getSelectedSideEffects:C,filterByCategory:S,isLoading:_,error:m,buildSideEffectsPayload:I,saveSideEffectsData:async(v,k,P)=>{_.value=!0,m.value=null;try{const o=await I(v,k,P);if(V.value=Number(o==null?void 0:o.encounter_id),!o)throw new Error("Failed to build payload");return await ee.saveObsArray(o.encounter_id,o.observations),Ae("Side effects saved successfully"),!0}catch(o){return console.error("Error saving side effects:",o),m.value="Failed to save side effects",j("Failed to save side effects"),!1}finally{_.value=!1}},encounterId:V}},Ka=()=>{const r=p([{id:"Weight loss / Failure to thrive / malnutrition",label:"Weight loss / failure to thrive / malnutrition",value:!1},{id:"Fever",label:"Fever",value:!1},{id:"Night sweats",label:"Night sweats",value:!1},{id:"Cough",label:"Cough",value:!1}]),c=p({});return r.value.forEach(m=>{c.value[m.id]=m.value}),{tbSymptomOptions:r,tbSymptoms:c,resetTBSymptoms:()=>{r.value.forEach(m=>{c.value[m.id]=!1})},hasSelectedTBSymptoms:()=>Object.values(c.value).some(m=>m===!0),getSelectedTBSymptoms:()=>r.value.filter(m=>c.value[m.id]).map(m=>m.label)}},el=()=>{const r=p([]),c=p(!1),d=p(null),_=async()=>{var V,m;c.value=!0,d.value=null;try{const f=lt(),O=(V=nt().patient)==null?void 0:V.patient_id,w=parseInt(f.getUserId()||"-1"),C=((m=f.getfacilityLocation())==null?void 0:m.code)||"";if(!C)throw new Error("Location ID not found");const D=await new ue(O,w,C).getCurrentMedications();if(D&&typeof D=="object"){const I=Object.values(D).map(g=>{const v=g;return{drug_id:v.drug_inventory_id,drug_name:v.dosage_struct.drug_name,dose:v.dose.source,units:v.units,frequency:v.frequency,start_date:v.order.start_date,end_date:v.order.auto_expire_date,quantity:v.quantity}});r.value=I}else r.value=[]}catch(f){console.error("Error loading current medications:",f),d.value=f instanceof Error?f.message:"Failed to load medications",j("Failed to load current medications")}finally{c.value=!1}};return de(()=>{_(),r.value.length===0&&(r.value=[{drug_id:1,drug_name:"Tenofovir 300mg",dose:"1 tablet",units:"tablet",frequency:"Once daily",start_date:"2023-01-01"},{drug_id:2,drug_name:"Lamivudine 150mg",dose:"1 tablet",units:"tablet",frequency:"Twice daily",start_date:"2023-01-01"},{drug_id:3,drug_name:"Efavirenz 600mg",dose:"1 tablet",units:"tablet",frequency:"Once daily",start_date:"2023-01-01"}])}),{medications:r,isLoading:c,error:d,loadCurrentMedications:_}},tl=fe({__name:"SideEffectModal",props:{isOpen:{type:Boolean},sideEffect:{},currentReason:{}},emits:["update","close"],setup(r,{emit:c}){const d=r,_=c,{medications:V,isLoading:m}=el(),f=p("no"),y=p([]),O=p(void 0);de(()=>{w()});const w=()=>{y.value=[],O.value=void 0,d.currentReason?typeof d.currentReason=="number"||d.currentReason==="drug_side_effect"||Array.isArray(d.currentReason)?(f.value="yes",Array.isArray(d.currentReason)&&d.currentReason.length>0?y.value=[...d.currentReason]:d.currentReason!=="drug_side_effect"&&(y.value=[d.currentReason])):(f.value="no",O.value=d.currentReason):(f.value="no",O.value="other_not_drug_related")},C=o=>{f.value=o.detail.value,f.value==="yes"?(y.value=[],O.value=void 0):(y.value=[],O.value="other_not_drug_related")},S=(o,s)=>{const i=s.detail.checked;i&&!y.value.includes(o)?y.value.push(o):i||(y.value=y.value.filter(T=>T!==o))},D=o=>{O.value=o},I=async(o,s)=>({concept_id:Ra.getCachedConceptID("Drug induced",!0),value_coded:o.concept_id,value_text:f.value=="no"?"Past medication history":null,value_drug:f.value=="yes"?s:null}),g=Z(()=>{let o=[];return y.value.length>0&&y.value.map(s=>{d.sideEffect&&o.push(I(d.sideEffect,Number(s)))}),o}),v=()=>{f.value="no",y.value=[],O.value="other_not_drug_related"},k=()=>{v(),_("close")},P=()=>{d.sideEffect&&(_("update",{id:d.sideEffect.id,reason:g.value}),k())};return(o,s)=>(b(),q(e(bt),{"is-open":o.isOpen,onDidDismiss:k},{default:a(()=>[t(e(_a),null,{default:a(()=>[t(e(pt),null,{default:a(()=>[s[4]||(s[4]=n("div",{slot:"start",class:"ion-padding"},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[n("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5"},[n("path",{d:"M6.01 16.607a3.495 3.495 0 1 0 0-6.99a3.495 3.495 0 0 0 0 6.99m5.242 6.616a5.243 5.243 0 0 0-10.485 0m20.968-7.821V3.751a2.996 2.996 0 1 0-5.991 0v11.651a4.493 4.493 0 1 0 5.991 0M18.74 5.249v11.983"}),n("path",{d:"M18.74 20.227a1.498 1.498 0 1 0 0-2.995a1.498 1.498 0 0 0 0 2.995M2.014 7.745a2.47 2.47 0 0 1 0-3.495a2.47 2.47 0 0 0 0-3.495m3.721 6.99a2.47 2.47 0 0 1 0-3.495a2.47 2.47 0 0 0 0-3.495m3.995 6.99a2.47 2.47 0 0 1 0-3.495a2.473 2.473 0 0 0 0-3.495"})])])],-1)),t(e(ba),null,{default:a(()=>{var i;return[u(A(((i=o.sideEffect)==null?void 0:i.label)||"Side Effect Details"),1)]}),_:1}),t(e(mt),{slot:"end"},{default:a(()=>[t(e(W),{onClick:s[0]||(s[0]=i=>_("close"))},{default:a(()=>[t(e(Y),{icon:e(tt)},null,8,["icon"])]),_:1})]),_:1})]),_:1,__:[4]})]),_:1}),t(e(we),{class:"ion-padding"},{default:a(()=>[t(e(ya),null,{default:a(()=>[t(e(G),null,{default:a(()=>[t(e(M),null,{default:a(()=>s[5]||(s[5]=[u("Is this drug-induced?")])),_:1,__:[5]})]),_:1}),t(e(be),{modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=i=>f.value=i),onIonChange:C},{default:a(()=>[t(e(G),null,{default:a(()=>[t(e(Q),{value:"yes"},{default:a(()=>s[6]||(s[6]=[u("Yes")])),_:1,__:[6]})]),_:1}),t(e(G),null,{default:a(()=>[t(e(Q),{value:"no"},{default:a(()=>s[7]||(s[7]=[u("No")])),_:1,__:[7]})]),_:1})]),_:1},8,["modelValue"]),f.value==="yes"?(b(),E(J,{key:0},[t(e(G),null,{default:a(()=>[t(e(M),null,{default:a(()=>s[8]||(s[8]=[u("Select medications:")])),_:1,__:[8]})]),_:1}),e(m)?(b(),q(e(Be),{key:0,name:"crescent"})):e(V).length===0?(b(),q(e(G),{key:1},{default:a(()=>[t(e(M),null,{default:a(()=>s[9]||(s[9]=[u("No medications found")])),_:1,__:[9]})]),_:1})):(b(!0),E(J,{key:2},ne(e(V),i=>(b(),q(e(G),{key:i.drug_id},{default:a(()=>[t(e(Te),{value:i.drug_id,checked:y.value.includes(i.drug_id),onIonChange:T=>S(i.drug_id,T)},null,8,["value","checked","onIonChange"]),t(e(M),{class:"ion-padding-start"},{default:a(()=>[u(A(i.drug_name),1)]),_:2},1024)]),_:2},1024))),128)),t(e(G),null,{default:a(()=>[t(e(Te),{value:"drug_side_effect",checked:y.value.includes("drug_side_effect"),onIonChange:s[2]||(s[2]=i=>S("drug_side_effect",i))},null,8,["checked"]),t(e(M),{class:"ion-padding-start"},{default:a(()=>s[10]||(s[10]=[u("Drug side effect (unspecified)")])),_:1,__:[10]})]),_:1})],64)):N("",!0),f.value==="no"?(b(),E(J,{key:1},[t(e(G),null,{default:a(()=>[t(e(M),null,{default:a(()=>s[11]||(s[11]=[u("Reason:")])),_:1,__:[11]})]),_:1}),t(e(G),null,{default:a(()=>[t(e(Q),{value:"other_not_drug_related",checked:O.value==="other_not_drug_related",onIonChange:s[3]||(s[3]=i=>D("other_not_drug_related"))},null,8,["checked"]),t(e(M),{class:"ion-padding-start"},{default:a(()=>s[12]||(s[12]=[u("Other not drug related")])),_:1,__:[12]})]),_:1})],64)):N("",!0)]),_:1})]),_:1}),t(e(ha),null,{default:a(()=>[t(e(pt),{color:"light"},{default:a(()=>[t(e(mt),{slot:"end"},{default:a(()=>[t(e(W),{onClick:P,color:"primary"},{default:a(()=>s[13]||(s[13]=[u("Save")])),_:1,__:[13]})]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"]))}}),al={class:"side-effects-grid"},ll={class:"checkbox-container"},nl={class:"checkbox-label"},sl={key:0,class:"reason-summary"},ol={class:"reason-label"},il={key:0,class:"drug-induced"},rl={key:1,class:"not-drug-induced"},ul=fe({__name:"SideEffectsCheckboxes",props:{modelValue:{},sideEffectOptions:{}},emits:["update:modelValue"],setup(r,{emit:c}){const d=r,_=c,V=p(!1),m=p(null),f=p(void 0),y=(D,I)=>{var k;const g=I.detail.checked,v={...d.modelValue};g?(v[D.id]={selected:!0,reason:"other_not_drug_related"},_("update:modelValue",v),w(D)):(v[D.id]={selected:!1,reason:(k=v[D.id])==null?void 0:k.reason},_("update:modelValue",v))},O=D=>{var g;const I=(g=d.modelValue[D])==null?void 0:g.reason;return typeof I=="number"||I==="drug_side_effect"||Array.isArray(I)&&I.length>0?"yes":"no"},w=D=>{var I;m.value=D,f.value=(I=d.modelValue[D.id])==null?void 0:I.reason,V.value=!0},C=()=>{V.value=!1,m.value=null},S=D=>{const I={...d.modelValue};I[D.id]&&(I[D.id]={...I[D.id],reason:D.reason},_("update:modelValue",I))};return(D,I)=>(b(),E(J,null,[n("div",al,[(b(!0),E(J,null,ne(D.sideEffectOptions,g=>{var v,k;return b(),E("div",{key:g.id,class:"side-effect-item"},[n("div",ll,[t(e(Te),{value:g.id,checked:(v=D.modelValue[g.id])==null?void 0:v.selected,onIonChange:P=>y(g,P)},null,8,["value","checked","onIonChange"]),n("span",nl,A(g.label),1)]),(k=D.modelValue[g.id])!=null&&k.selected?(b(),E("div",sl,[n("div",ol,[O(g.id)==="yes"?(b(),E("span",il,"Drug-induced")):(b(),E("span",rl,"Not drug-induced"))]),t(e(W),{fill:"clear",size:"small",class:"edit-button",onClick:P=>w(g)},{default:a(()=>[I[0]||(I[0]=u(" Edit ")),t(e(Y),{slot:"end",icon:e(yt)},null,8,["icon"])]),_:2,__:[0]},1032,["onClick"])])):N("",!0)])}),128))]),t(tl,{"is-open":V.value,"side-effect":m.value,"current-reason":f.value,onUpdate:S,onClose:C},null,8,["is-open","side-effect","current-reason"])],64))}}),dl=ye(ul,[["__scopeId","data-v-9c8f6d00"]]),cl={class:"tb-symptoms-grid"},vl={class:"checkbox-label"},fl=fe({__name:"TBSymptomsCheckboxes",props:{modelValue:{},tbSymptomOptions:{}},emits:["update:modelValue"],setup(r,{emit:c}){const d=r,_=c,V=()=>{_("update:modelValue",d.modelValue)};return(m,f)=>(b(),E("div",cl,[(b(!0),E(J,null,ne(m.tbSymptomOptions,y=>(b(),E("div",{key:y.id,class:"checkbox-option"},[t(e(Te),{modelValue:m.modelValue[y.id],"onUpdate:modelValue":[O=>m.modelValue[y.id]=O,V],value:y.label},null,8,["modelValue","onUpdate:modelValue","value"]),n("span",vl,A(y.label),1)]))),128))]))}}),pl=ye(fl,[["__scopeId","data-v-d67e9ce3"]]),at=(r,c)=>{const d=new Date;return{Months:()=>d.setMonth(d.getMonth()-r),Weeks:()=>d.setDate(d.getDate()-r*7),Days:()=>d.setDate(d.getDate()-r)}[c](),{day:d.getDate().toString().padStart(2,"0"),month:(d.getMonth()+1).toString().padStart(2,"0"),year:d.getFullYear().toString()}},ml=()=>{const r=p("Unknown"),c=p(),d=p("3"),_=p(!1),V=p(!1),m=p(["Months","Weeks","Days"]),f=p("0"),y=p({name:"Months"}),O=p([{label:"Yes",value:"Yes"},{label:"No",value:"No"},{label:"Unknown",value:"Unknown"}]),w=p(["TB NOT suspected","TB Suspected","Confirmed TB Not on treatment"]),C=Z(()=>{let i=[];return/no/i.test(r.value.toLowerCase())&&(i=["Currently on IPT","Currently on 3HP (RFP + INH)","Currently on INH 300 / RFP 300 (3HP)"]),i=i.concat(["Complete course of 3HP in the past (3 months RFP+INH)","Complete course of IPT in the past (min. 6 months of INH)","Aborted course of 3HP (RFP + INH) in the past","Aborted course of INH 300 / RFP 300 (3HP) in the past","Aborted course of IPT in the past","Never taken IPT or 3HP"]),i});ht([f,y],([i,T])=>{if(i||T){const x=at(Number(i),y.value.name);c.value=x}});const S=async i=>{var R,U,te;const T="".concat((R=c.value)==null?void 0:R.year,"-").concat((U=c.value)==null?void 0:U.month,"-").concat((te=c.value)==null?void 0:te.day),x=V.value?await i.buildValueDateEstimated("TB treatment start date",Oe.toStandardHisFormat(T)):await i.buildValueDate("TB treatment start date",Oe.toStandardHisFormat(T)),B=await i.buildValueNumber("TB treatment period",Number(d.value));return[x,B]},D=i=>{const T="Chest X-ray",x="Molecular WHO Recommended Rapid Diagnostic Test";return i[x].toLowerCase()==="normal"?!1:i[T].toLowerCase()==="abnormal"||i[x].toLowerCase()==="positive"},I=i=>Object.values(i).some(T=>T),g=(i,T)=>Object.values(i).every(x=>x.toLowerCase()==="unknown")?I(T):D(i),v=async(i,T)=>{const x=Object.entries(i).map(async([B,R])=>({...await T.buildValueCoded("Routine TB Screening",B),child:[await T.buildValueCoded(B,R?"Yes":"No")]}));return Promise.all(x)},k=async(i,T)=>{const x=Object.entries(i).map(async([B,R])=>({...await T.buildValueCoded("TB screening method used",B),child:[await T.buildValueCoded(B,R)]}));return Promise.all(x)},P=async(i,T,x,B)=>{let R="TB NOT suspected";return r.value==="Yes"?R="Confirmed TB on treatment":i&&i.trim()!==""?R=i:T&&Object.keys(T).length>0?D(T)&&(R="TB Suspected"):x&&Object.keys(x).length>0&&I(x)&&(R="TB Suspected"),B.buildValueCoded("TB Status",R)},o=(i,T)=>T.buildValueText("TB Treatment History",i);return{tbTherapyStatus:r,tbTreatmentStartDate:c,tbTreatmentPeriod:d,onTBTreatmentOptions:O,tbStatusOptions:w,tbEstimatePeriods:m,selectedEstimatePeriod:y,showEstimator:V,tbStartEstimate:f,startDateEstimator:at,showTBStatus:g,tptHistoryOptions:C,buildTBTreatmentPayload:async(i,T=53,x,B,R)=>{const U=new ee(i,T,x,B),te=await U.buildValueCoded("TB treatment",r.value);let F=null;R.history&&typeof R.history=="string"&&R.history.trim()!==""&&(F=await o(R.history,U));const Pe=await P(R.status,R.methods,R.symptoms,U),oe=[te,Pe];if(F&&oe.push(F),r.value==="Yes"){const $=await S(U);oe.push(...$)}else{const $=await Promise.all(await k(R.methods,U)),se=await Promise.all(await v(R.symptoms,U));oe.push(...$,...se)}return oe.filter($=>$&&Object.keys($).length>0)},submitTBTherapy:_}},gl=(r,c,d)=>{const _=Z(()=>({"weight-chart":r.value,"side-effects":c.value,"tb-therapy":d.value}));return{validate:async()=>{for(const m in _.value){const f=m;if(!_.value[f])return K("Please fill out ".concat(m.replaceAll("-"," ")," section")),!1}return!0},stepsMap:_}},_l=()=>{const r=Ct({isPregnant:null,isBreastFeeding:null}),c=p(!1),d=p(!1),_=p([]),V=()=>(_.value=[],r.isPregnant===null&&_.value.push("Pregnancy status is required."),r.isBreastFeeding===null&&_.value.push("Breastfeeding status is required."),_.value.length===0),m=async(y,O,w)=>{const C=new ee(y,53,O,w),S=[];if(r.isPregnant!==null){const D=await C.buildValueCoded("Is patient pregnant?",r.isPregnant==="yes"?"Yes":"No");S.push(D)}if(r.isBreastFeeding!==null){const D=await C.buildValueCoded("Is patient breast feeding?",r.isBreastFeeding==="yes"?"Yes":"No");S.push(D)}return S};return{pregnancyBreastFeedingData:r,isPregnancyBreastfeedingLoading:c,validationErrors:_,isPregnancyBreastfeedingSaved:d,validatePregnancyBreastFeeding:V,savePregnancyBreastFeeding:async(y,O,w)=>{if(!V())return console.error("Validation failed:",_.value),!1;c.value=!0;try{const C=await m(y,O,w);return C.length>0?(await new ee(y,53,O,w).saveObservationList(C),d.value=!0,Ae("Pregnancy or Breast Feeding data saved successfully"),!0):(console.warn("No observations to save"),!1)}catch(C){return console.error("Error saving data:",C),!1}},buildPregnancyBreastFeedingObs:m}},It=()=>{const r=Ct({selectedMethods:[],availableMethods:[]}),c=p(!1),d=p(!1),_=p([]),V=()=>{const D=new ue(0,0).getFamilyPlanningMethods();r.availableMethods=D.map(I=>({label:I,value:I,isChecked:!1,disabled:!1}))},m=()=>(_.value=[],r.selectedMethods.length===0&&_.value.push("At least one contraceptive method must be selected."),_.value.length===0),f=S=>{const D=new ue(0,0);if(S==="NONE")r.selectedMethods=["NONE"],r.availableMethods=r.availableMethods.map(I=>({...I,isChecked:I.value==="NONE",disabled:!1}));else{r.selectedMethods.includes("NONE")&&(r.selectedMethods=[]);const I=r.selectedMethods.indexOf(S);if(I>-1?r.selectedMethods.splice(I,1):r.selectedMethods.push(S),r.selectedMethods.length>0){const g=r.selectedMethods[0],v=D.familyPlanningMethods(g,r.availableMethods);r.availableMethods=v}else r.availableMethods=r.availableMethods.map(g=>({...g,disabled:!1}));r.availableMethods=r.availableMethods.map(g=>({...g,isChecked:r.selectedMethods.includes(g.value)}))}},y=async(S,D,I)=>{const g=new ee(S,53,D,I),v=[];for(const k of r.selectedMethods){const P=await g.buildValueCoded("Method of family planning",k);v.push(P)}return v},O=async(S,D,I)=>{if(!m())return console.error("Validation failed:",_.value),j("Please select at least one contraceptive method"),!1;c.value=!0;try{const g=await y(S,D,I);return g.length>0?(await new ee(S,53,D,I).saveObservationList(g),console.info("Contraceptive methods saved:",g),d.value=!0,!0):(console.warn("No contraceptive observations to save"),j("No contraceptive methods to save"),!1)}catch(g){return console.error("Error saving contraceptive data:",g),j("Failed to save contraceptive methods"),!1}finally{c.value=!1}},w=Z(()=>r.selectedMethods.length>0),C=Z(()=>r.selectedMethods.length===0?"None selected":r.selectedMethods.includes("NONE")?"None":r.selectedMethods.join(", "));return V(),{contraceptiveData:r,isContraceptivesLoading:c,isContraceptivesSaved:d,validationErrors:_,hasSelectedMethods:w,selectedMethodsText:C,validateContraceptives:m,toggleMethod:f,saveContraceptives:O,initializeContraceptiveMethods:V,buildContraceptiveObs:y}},bl={class:"contraceptives-section"},yl={key:0,class:"selected-methods"},hl={key:1,class:"selected-methods"},Cl={class:"method-tag none-tag"},wl={class:"methods-list"},Sl={key:2,class:"validation-errors"},kl={class:"action-buttons"},Dl=fe({__name:"ContraceptivesSection",props:{patientID:{default:0},providerID:{default:-1},locationID:{default:""}},emits:["onSuccess"],setup(r,{expose:c,emit:d}){const _=r,V=d,m=lt(),f=nt(),{patient:y}=wt(f),O=Z(()=>{var T;return _.patientID||((T=y.value)==null?void 0:T.patientID)||0}),w=Z(()=>{var T;return _.providerID!==-1?_.providerID:(T=kt.getUserID())!=null?T:-1}),C=Z(()=>{var T;return _.locationID||((T=m.getfacilityLocation())==null?void 0:T.code)||""}),{contraceptiveData:S,isContraceptivesLoading:D,isContraceptivesSaved:I,validationErrors:g,hasSelectedMethods:v,validateContraceptives:k,toggleMethod:P,saveContraceptives:o}=It(),s=()=>{S.selectedMethods=[],S.availableMethods=S.availableMethods.map(T=>({...T,isChecked:!1,disabled:!1}))},i=async()=>{await o(O.value,w.value,C.value)&&V("onSuccess",!0)};return c({saveContraceptives:i,validateContraceptives:k,isContraceptivesSaved:I}),(T,x)=>(b(),E("div",bl,[e(v)&&!e(S).selectedMethods.includes("NONE")?(b(),E("div",yl,[(b(!0),E(J,null,ne(e(S).selectedMethods,B=>(b(),E("div",{class:"method-tag",key:B},[u(A(B)+" ",1),t(e(Y),{icon:e(tt),onClick:R=>e(P)(B),class:"remove-icon"},null,8,["icon","onClick"])]))),128))])):N("",!0),e(S).selectedMethods.includes("NONE")?(b(),E("div",hl,[n("div",Cl,[x[1]||(x[1]=u(" NONE ")),t(e(Y),{icon:e(tt),onClick:x[0]||(x[0]=B=>e(P)("NONE")),class:"remove-icon"},null,8,["icon"])])])):N("",!0),n("div",wl,[(b(!0),E(J,null,ne(e(S).availableMethods,B=>(b(),E("div",{key:B.value,class:St(["method-item",{disabled:B.disabled}])},[t(e(Te),{checked:B.isChecked,disabled:B.disabled,onIonChange:R=>e(P)(B.value),labelPlacement:"end"},{default:a(()=>[u(A(B.label),1)]),_:2},1032,["checked","disabled","onIonChange"])],2))),128))]),e(g).length>0?(b(),E("div",Sl,[(b(!0),E(J,null,ne(e(g),B=>(b(),E("div",{key:B,class:"error-message"},A(B),1))),128))])):N("",!0),n("div",kl,[t(e(W),{color:"medium",fill:"outline",onClick:s,disabled:e(S).selectedMethods.length==0},{default:a(()=>x[2]||(x[2]=[u(" Clear ")])),_:1,__:[2]},8,["disabled"]),t(e(W),{color:"primary",onClick:i,disabled:e(D)||!e(v),loading:!0},{default:a(()=>x[3]||(x[3]=[u(" Save ")])),_:1,__:[3]},8,["disabled"])])]))}}),Vl=ye(Dl,[["__scopeId","data-v-9a45c4b4"]]);class Il extends ee{constructor(c,d){super(c,13,d)}async buildDefferedOrder(c){const d=await ee.getConceptID("HIV viral load"),_=await ee.getConceptID("Delayed milestones");return[{concept_id:d,value_text:"Wait till next milestone",value_coded:_,value_numeric:c}]}}const Tl={key:0},El={key:0,class:"info-container"},Ol={class:"info-card"},Pl={class:"main-message"},Ml={class:"message-content"},Nl={class:"info-list"},xl=fe({__name:"vl-info-alert",props:{patientID:{}},setup(r){const c=r,d=p(!0),_=p(null),V=p(!1),m=async()=>{if(await Je("Are you sure you want to wait till next milestone?")){const C=new Il(c.patientID,-1),S=await C.createEncounter(),D=await C.buildDefferedOrder(null);if(!S)return K("Unable to create encounter");const I=await C.saveObservationList(D);d.value=!I}},f=async()=>{await Je("Are you sure you want to remind me later?")&&(d.value=!1)},y=async()=>{await Je("Are you sure you want to close this milestone notification?")&&(d.value=!1)},O=async()=>{try{if(V.value=await Ue.VLEnabled(),!V.value)return;const C=await La.getPatientVLInfo(c.patientID);_.value=C}catch(C){console.error("Error fetching VL data:",C)}},w=C=>C?le(C).format("DD MMM, YYYY"):"N/A";return de(()=>{O()}),(C,S)=>{var D,I;return V.value?(b(),E("div",Tl,[d.value&&((D=_.value)!=null&&D.eligibile)&&!_.value.skip_milestone?(b(),E("div",El,[n("div",Ol,[n("button",{class:"close-button",onClick:y,"aria-label":"Close notification"},S[0]||(S[0]=[n("svg",{class:"close-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),n("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])),n("div",Pl,[S[10]||(S[10]=n("svg",{class:"info-icon",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},[n("path",{fill:"currentColor",d:"M24.586 6.586A2 2 0 0 0 23.17 6H16V2h-2v4H6a2.003 2.003 0 0 0-2 2v6a2.003 2.003 0 0 0 2 2h8v14h2V16h7.171a2 2 0 0 0 1.415-.586L29 11ZM23.17 14H6V8h17.172l3 3Z"})],-1)),n("div",Ml,[S[9]||(S[9]=n("h2",null,"VL milestone has been reached",-1)),n("ul",Nl,[n("li",null,[S[1]||(S[1]=u("Patient has been on ART for ")),n("b",null,A(_.value.period_on_art),1),S[2]||(S[2]=u(" months"))]),n("li",null,[S[3]||(S[3]=u("Treatment started on ")),n("b",null,A(w(_.value.earliest_start_date)),1)]),n("li",null,[S[4]||(S[4]=u("Current regimen: ")),n("b",null,A(_.value.current_regimen.name),1),S[5]||(S[5]=u(" since ")),n("b",null,A(w(_.value.current_regimen.date_started)),1)]),n("li",null,[S[6]||(S[6]=u("Last VL order date: ")),n("b",null,A(w((I=_.value)==null?void 0:I.last_order_date)),1)])]),n("div",null,[t(e(W),{class:"ion-padding",onClick:m,color:"primary",fill:"outline",size:"small"},{default:a(()=>S[7]||(S[7]=[u(" Wait till next milestone ")])),_:1,__:[7]}),t(e(W),{class:"ion-padding",onClick:f,color:"primary",fill:"outline",size:"small"},{default:a(()=>S[8]||(S[8]=[u(" Remind me later ")])),_:1,__:[8]})])])])])])):(b(),q(e(G),{key:1,lines:"none"},{default:a(()=>[t(e(Y),{style:{"font-size":"1.3rem"},slot:"end",size:"large",icon:e(Ca)},null,8,["icon"]),t(e(M),{style:{"font-size":"1.2rem"},slot:"end"},{default:a(()=>{var g;return[u(A((g=_.value)==null?void 0:g.message),1)]}),_:1})]),_:1}))])):N("",!0)}}}),Fl=ye(xl,[["__scopeId","data-v-c9803869"]]),Bl=fe({name:"CervicalCancerSection",components:{IonRow:X,IonCol:H,IonLabel:M,IonRadioGroup:be,IonRadio:Q,IonButton:W,IonSpinner:Be,IonSelect:Ke,IonSelectOption:et,IonText:ka,IonDatetimeButton:Sa,IonDatetime:wa,IonModal:bt,IonCheckbox:Te,DatePicker:We,BasicInputChangeUnits:Dt},props:{providerID:{type:Number,required:!0},locationID:{type:String,required:!0}},setup(r,{emit:c}){const d=p(!0),_=p(!1),V=p(""),m=p(""),f=p(""),y=p(!1),O=p(!0),w=p(!1),C=p(0),S=p(0),D=p(!1),I=p(!1),g=p(""),v=p(""),k=p(!1),P=new Ee,o=new ue(P.patient.patient_id,r.providerID,r.locationID),s=p({name:"Months"}),i=p(["Months","Weeks","Days"]),T=p(""),x=Z(()=>le().format("YYYY-MM-DD")),B=Z(()=>"1900-01-01"),R=p([{label:"Not due for screening",value:"Not due for screening"},{label:"Hysterectomy",value:"Hysterectomy"},{label:"Patient refused",value:"Patient refused"},{label:"Other",value:"Other"}]),U=Z(()=>!(V.value===""||V.value==="No"&&m.value===""||m.value==="Not due for screening"&&f.value==="")),te=$=>Oe.toStandardHisDisplayFormat($),F=async()=>{try{if(d.value=!0,P.patient.gender==="F"&&(w.value=await Ue.cervicalCancerScreeningEnabled(),w.value)){const{start:$,end:se}=await Ue.cervicalCancerScreeningAgeBounds();C.value=se,S.value=$,D.value=await o.clientDueForCxCa(),I.value=await o.clientHasHadAHysterectomy(),g.value=await P.patient.nextAppointment(24);const ie=30;k.value=ie>Oe.dateDiffInDays(g.value,o.date)}}catch($){console.error("Error initializing cervical cancer data:",$)}finally{d.value=!1}},Pe=async()=>{try{if(!U.value)return;const $=[];$.push(o.buildValueCoded("Offer CxCa",V.value)),V.value==="No"&&($.push(o.buildValueCoded("Reason for NOT offering CxCa",m.value)),m.value==="Not due for screening"&&f.value&&(y.value?$.push(o.buildValueDateEstimated("CxCa test date",f.value)):$.push(o.buildValueDate("CxCa test date",f.value)))),_.value=!0,c("onSuccess",{obs:$,isCxCaSaved:_.value})}catch($){console.error("Error saving cervical cancer data:",$)}};de(()=>{F()});function oe($,se,ie){return new Date(ie,se-1,$).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})}return ht([v,s],([$,se])=>{if($||se){const ie=at(Number($),s.value.name);T.value=ie,f.value=oe(Number(ie.day),Number(ie.month),Number(ie.year)),y.value=!0}}),{loading:d,isCxCaSaved:_,offerCxca:V,reasonForNoCxca:m,previousCxcaTestDate:f,isEstimated:y,showEstimateFields:O,reasonsForNoCxcaOptions:R,isFormValid:U,cxcaAppointDate:g,showReminder:k,maxDate:x,minDate:B,alertCircleOutline:Da,selectedEstimatePeriod:s,estimatePeriods:i,estimatedValue:v,dateProp:T,formatDate:te,saveCxcaData:Pe}}}),Al={class:"cervical-cancer-container"},Rl={key:0,class:"loading-container"},Ll={key:1},Hl={key:0,class:"reminder-banner"},ql={class:"radio-group"},$l={key:1},zl={key:0},Ul={class:"save-button-container"};function Wl(r,c,d,_,V,m){const f=ae("ion-spinner"),y=ae("ion-icon"),O=ae("ion-text"),w=ae("ion-label"),C=ae("ion-col"),S=ae("ion-radio"),D=ae("ion-radio-group"),I=ae("ion-row"),g=ae("ion-select-option"),v=ae("ion-select"),k=ae("DatePicker"),P=ae("BasicInputChangeUnits"),o=ae("ion-button");return b(),E("div",Al,[r.loading?(b(),E("div",Rl,[t(f,{name:"bubbles"}),c[6]||(c[6]=n("p",null,"Loading cervical cancer screening data...",-1))])):(b(),E("div",Ll,[r.showReminder?(b(),E("div",Hl,[t(O,{color:"warning"},{default:a(()=>[n("p",null,[t(y,{icon:r.alertCircleOutline},null,8,["icon"]),u(" Patient is due for Cervical Cancer Screening on "+A(r.formatDate(r.cxcaAppointDate)),1)])]),_:1})])):N("",!0),t(I,null,{default:a(()=>[t(C,null,{default:a(()=>[t(w,null,{default:a(()=>c[7]||(c[7]=[u("Offer Cervical Cancer Screening")])),_:1,__:[7]})]),_:1}),t(C,null,{default:a(()=>[n("div",ql,[t(D,{modelValue:r.offerCxca,"onUpdate:modelValue":c[0]||(c[0]=s=>r.offerCxca=s)},{default:a(()=>[t(S,{slot:"end",value:"Yes"},{default:a(()=>c[8]||(c[8]=[u("Yes")])),_:1,__:[8]}),t(S,{slot:"end",style:{"margin-left":"20px"},value:"No"},{default:a(()=>c[9]||(c[9]=[u("No")])),_:1,__:[9]})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),r.offerCxca==="No"?(b(),E("div",$l,[t(I,null,{default:a(()=>[t(C,null,{default:a(()=>[t(w,null,{default:a(()=>c[10]||(c[10]=[u("Reason for NOT offering CxCa")])),_:1,__:[10]})]),_:1}),t(C,null,{default:a(()=>[t(v,{modelValue:r.reasonForNoCxca,"onUpdate:modelValue":c[1]||(c[1]=s=>r.reasonForNoCxca=s),interface:"popover",placeholder:"Select reason"},{default:a(()=>[(b(!0),E(J,null,ne(r.reasonsForNoCxcaOptions,s=>(b(),q(g,{key:s.value,value:s.value},{default:a(()=>[u(A(s.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),r.reasonForNoCxca==="Not due for screening"?(b(),E("div",zl,[t(I,null,{default:a(()=>[t(C,null,{default:a(()=>[t(w,null,{default:a(()=>c[11]||(c[11]=[u("Previous CxCa test date")])),_:1,__:[11]})]),_:1}),t(C,null,{default:a(()=>[t(k,{place_holder:"enter data",onDateUpDated:[()=>{},c[2]||(c[2]=s=>{r.previousCxcaTestDate=s.formattedDate})],date_prop:r.dateProp},null,8,["date_prop"])]),_:1})]),_:1}),r.showEstimateFields?(b(),q(I,{key:0},{default:a(()=>[t(C,null,{default:a(()=>[t(w,null,{default:a(()=>c[12]||(c[12]=[u("Estimated?")])),_:1,__:[12]})]),_:1}),t(C,null,{default:a(()=>[t(P,{bold:"bold","input-header":"Estimate number of ".concat(r.selectedEstimatePeriod.name),"input-value":r.estimatedValue,"onUpdate:inputValue":[c[3]||(c[3]=s=>r.estimatedValue=s),c[4]||(c[4]=s=>r.estimatedValue=s.target.value)],showAsterisk:"",placeholder:"",unitsData:{isSingleSelect:!0,multiSelectData:r.estimatePeriods.map(s=>({name:s})),value:r.selectedEstimatePeriod,trackBy:"name"},"onUpdate:units":c[5]||(c[5]=s=>r.selectedEstimatePeriod=s)},null,8,["input-header","input-value","unitsData"])]),_:1})]),_:1})):N("",!0)])):N("",!0)])):N("",!0),n("div",Ul,[t(o,{onClick:r.saveCxcaData,disabled:!r.isFormValid},{default:a(()=>c[13]||(c[13]=[u(" Save and Continue ")])),_:1,__:[13]},8,["onClick","disabled"])])]))])}const jl=ye(Bl,[["render",Wl],["__scopeId","data-v-bee1d69f"]]),Yl={class:"error"},Gl={class:"error"},Ql={class:"error"},Zl=fe({__name:"TptTransferForm",props:{patientId:{type:Number,required:!0},drugNameFilters:{type:Object,default:()=>[]}},setup(r,{expose:c}){const d=r,_=p({}),V=new Ee,m=new ue(d.patientId,-1),f=p({canSubmit:!1,dateStartedTpt:"",tptDrugQuantities:[],transferFacility:""}),y={dateStartedTpt:{label:"Date started TPT treatment",required:()=>!0,validation:()=>O("dateStartedTpt")?le(f.value.dateStartedTpt).isAfter(le(Ee.getSessionDate()))?(_.value.dateStartedTpt="Date cannot be in the future",!1):le(f.value.dateStartedTpt).isBefore(le(V.getBirthdate()))?(_.value.dateStartedTpt="Date cannot be before birthdate",!1):!0:!1},transferFacility:{label:"Facility TPT last received from",required:()=>!0,buildObs:()=>m.buildValueText("Location TPT last received",f.value.transferFacility),validation:()=>O("transferFacility")},tptDrugQuantities:{label:"TPT Drug Quantities",required:()=>!0,init:async()=>{const g=["INH or H (Isoniazid 300mg tablet)","3HP (RFP + INH","Rifapentine (150mg)","INH 300 / RFP 300 (3HP)"],v=d.drugNameFilters.length>0?d.drugNameFilters:g,P=(await $a.getCustomIngridients()).filter(o=>v.includes(o.name));f.value.tptDrugQuantities=Ya(P.map(o=>({drug:o,name:o.name,quantity:null})),"name")},buildObs:()=>f.value.tptDrugQuantities.map(g=>m.buildObs("TPT Drugs Received",{value_drug:g.drug.drug_id,value_datetime:f.value.dateStartedTpt,value_numeric:g.quantity})),validation:()=>{if(O("tptDrugQuantities"))return f.value.tptDrugQuantities.every(v=>{var k;return((k=v.quantity)!=null?k:0)>0})?!0:(_.value.tptDrugQuantities="Please enter quantities for all drugs",!1)}}};function O(g){_.value[g]="";const v=y[g],k=typeof(v==null?void 0:v.required)=="function"?v.required():!1,P=typeof f.value[g]=="object"?Vt.isEmpty(f.value[g]):Array.isArray(f.value[g])?f.value[g].length===0:"".concat(f.value[g]).length===0;return k&&P?(_.value[g]="This field is required",!1):k}function w(){return Object.keys(y).reduce((g,v)=>{if(v in y&&typeof y[v].required=="function"&&y[v].required()&&typeof y[v].buildObs=="function"){const k=y[v].buildObs();return Array.isArray(k)?[...g,...k]:[...g,k]}return g},[])}function C(){return f.value.canSubmit?Object.keys(y).every(g=>S(g)):(K("Please wait for all data to load before submitting"),!1)}function S(g){return _.value[g]="",typeof y[g].validation=="function"?y[g].validation():!0}function D(g,v){S(g),Object.keys(y).forEach(k=>{var P;return((P=y[k])==null?void 0:P.onFormUpdate)&&y[k].onFormUpdate(g,v)})}async function I(){f.value.canSubmit=!1,await Promise.all(Object.keys(y).filter(g=>typeof y[g].init=="function").map(g=>y[g].init())),f.value.canSubmit=!0}return de(()=>I()),c({buildObs:w,validateAll:C}),(g,v)=>(b(),q(e($e),null,{default:a(()=>[t(e(X),null,{default:a(()=>[t(e(H),null,{default:a(()=>[t(e(M),null,{default:a(()=>v[2]||(v[2]=[u("Date started TPT treatment")])),_:1,__:[2]}),t(We,{place_holder:"Select date",onDateUpDated:v[0]||(v[0]=k=>{f.value.dateStartedTpt=k.value.standardDate,D("dateStartedTpt",k.value.standardDate)}),date_prop:""}),n("div",Yl,A(_.value.dateStartedTpt),1)]),_:1}),t(e(H),null,{default:a(()=>[t(e(M),null,{default:a(()=>v[3]||(v[3]=[u("Facility TPT last received from")])),_:1,__:[3]}),t(ja,{show_error:!1,selected_district_ids:[],selected_location:null,onFacilitySelected:v[1]||(v[1]=k=>{f.value.transferFacility=k.selected_location.name,D("transferFacility",k.selected_location.name)})}),n("div",Gl,A(_.value.transferFacility),1)]),_:1})]),_:1}),(b(!0),E(J,null,ne(f.value.tptDrugQuantities,(k,P)=>(b(),q(e(X),{key:P},{default:a(()=>[t(e(H),null,{default:a(()=>[t(e(G),{lines:"none"},{default:a(()=>[t(e(M),null,{default:a(()=>[u(A(k.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(e(H),null,{default:a(()=>[t(e(ze),{onIonInput:o=>D("tptDrugQuantities",{index:P,field:"quantity",value:o.detail.value}),placeholder:"Enter amount given",modelValue:k.quantity,"onUpdate:modelValue":o=>k.quantity=o,type:"number",fill:"outline"},null,8,["onIonInput","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),t(e(X),null,{default:a(()=>[t(e(H),null,{default:a(()=>[n("div",Ql,A(_.value.tptDrugQuantities),1)]),_:1})]),_:1})]),_:1}))}}),Xl=ye(Zl,[["__scopeId","data-v-136d27c5"]]),Jl={class:"accordion-title-container"},Kl={key:0,class:"completed-badge"},en={class:"ion-padding",style:{overflow:"visible !important"},slot:"content"},tn={class:"save-button-container"},an={class:"accordion-title-container"},ln={key:0,class:"completed-badge"},nn={class:"ion-padding",slot:"content",style:{overflow:"visible !important"}},sn={key:0,class:"lab-investigations-list"},on={class:"table-responsive"},rn={class:"lab-table"},un={class:"action-buttons"},dn={class:"save-button-container"},cn={class:"accordion-title-container"},vn={key:0,class:"completed-badge"},fn={slot:"content",class:"ion-padding"},pn={class:"chart-container"},mn={class:"chart-header"},gn={key:0,class:"loading-container"},_n={key:1,class:"empty-data-container"},bn={key:2,class:"save-button-container"},yn={class:"accordion-title-container"},hn={key:0,class:"completed-badge"},Cn={slot:"content",class:"ion-padding"},wn={class:"radio-group"},Sn={class:"radio-group"},kn={key:0,class:"save-button-container"},Dn={class:"accordion-title-container"},Vn={key:0,class:"completed-badge"},In={slot:"content",class:"ion-padding"},Tn={class:"accordion-title-container"},En={key:0,class:"completed-badge"},On={slot:"content",class:"ion-padding"},Pn={class:"accordion-title-container"},Mn={key:0,class:"completed-badge"},Nn={class:"ion-padding",slot:"content"},xn={class:"side-effects-container"},Fn={class:"radio-group"},Bn={key:0,class:"side-effects-options"},An={key:0,class:"loading-container"},Rn={class:"category-tabs"},Ln={class:"save-button-container"},Hn={class:"accordion-title-container"},qn={key:0,class:"completed-badge"},$n={class:"ion-padding",slot:"content"},zn={key:0,class:"loading-container"},Un={class:"tb-therapy-container"},Wn={class:"tb-treatment-section"},jn={class:"radio-group horizontal-radio-group"},Yn={class:"radio-option"},Gn={class:"radio-option"},Qn={key:0,class:"tb-treatment-section"},Zn={key:0,class:"estimator-container"},Xn={style:{"margin-top":"10px"}},Jn={key:1,class:"tb-treatment-section"},Kn={class:"tb-symptoms-section"},es={class:"screening-section"},ts={class:"radio-group horizontal-radio-group"},as={class:"radio-option"},ls={class:"radio-option"},ns={class:"radio-option"},ss={class:"radio-group horizontal-radio-group"},os={class:"radio-option"},is={class:"radio-option"},rs={class:"radio-option"},us={key:0,class:"tb-status-section"},ds={style:{"z-index":"99999"}},cs={key:2,class:"tb-history-section"},vs={key:0,class:"ion-padding"},fs={class:"save-button-container"},ps=fe({__name:"Consultation",setup(r,{expose:c}){var vt,ft;const d=lt(),_=nt(),{patient:V}=wt(_),m=p(null),f=p(["lab-investigation"]),y=p(null),O=p(!1),w=p([]),C=p([]),S=p(""),D=p("contraindication"),I=p(!1),g=p(!1),v=p(!1),k=p(!1),P=Z(()=>{var L;return(L=V.value)==null?void 0:L.patientID}),o=(vt=kt.getUserID())!=null?vt:-1,s=((ft=d.getfacilityLocation())==null?void 0:ft.code)||"",i=p(!1),T=new Ee,x=p(null),B=p(null),R=p(!1),U=p(!1),te=p(),F=Z(()=>{var L,l;return/currently/i.test((l=(L=Se.value)==null?void 0:L.name)!=null?l:"")}),Pe=Z(()=>{var h;const L=[],l=(h=Se.value)==null?void 0:h.name;return"".concat(l).match(/ipt/i)?L.push("INH or H (Isoniazid 300mg tablet)"):"".concat(l).includes("3HP (RFP + INH)")?(L.push("INH or H (Isoniazid 300mg tablet)"),L.push("Rifapentine (150mg)")):"".concat(l).includes("INH 300 / RFP 300 (3HP)")&&L.push("INH 300 / RFP 300 (3HP)"),console.log(L),L}),oe=new ue(T.getID(),-1,s),{sideEffectOptions:$,sideEffects:se,isLoading:ie,filterByCategory:st,hasSelectedSideEffects:ot,buildSideEffectsPayload:Tt,encounterId:it}=Ja("side_effect"),{tbTherapyStatus:re,tbTreatmentPeriod:Et,tbTreatmentStartDate:Ot,tbEstimatePeriods:Pt,selectedEstimatePeriod:je,showEstimator:rt,tbStartEstimate:Re,tbStatusOptions:Mt,showTBStatus:Nt,tptHistoryOptions:xt,buildTBTreatmentPayload:Ft,submitTBTherapy:Bt}=ml(),{tbSymptomOptions:At,tbSymptoms:Me}=Ka(),Ye=p(""),Ge=p(""),Qe=p(""),Se=p(""),ut=p(!1),{pregnancyBreastFeedingData:ke,isPregnancyBreastfeedingLoading:Rt,validatePregnancyBreastFeeding:Lt,buildPregnancyBreastFeedingObs:Ht}=_l(),{buildContraceptiveObs:qt}=It(),$t=L=>{const l=L.detail.value;D.value=l,st(l)},zt=L=>{x.value=L,L?f.value=["drug_transfer_in"]:f.value=["lab-investigation"]},Ut=async()=>{if(S.value==="yes"&&!ot()){j("Please select at least one side effect or contraindication");return}I.value=!0,m.value&&(f.value=[],f.value.push("tb-therapy"))},Wt=async()=>{var L;if(Le.value.length===0){j("Please add at least one lab investigation");return}try{if(!P.value){j("Patient ID not found");return}const l=new za,h=(L=d.getfacilityLocation())==null?void 0:L.code;if(!h){j("Location ID not found");return}const ce={location_id:h,orders:Le.value.map(ve=>({concept_id:ve.test.id,name:ve.test.name,specimen:ve.specimen.name,reason:ve.reason||"Routine",specimenConcept:ve.specimen.id,accessionNumber:ve.accessionNumber||null}))};await l.postActivities(P.value,ce),v.value=!0,m.value&&(f.value=[],f.value.push("weight-chart")),Ae("Lab investigations saved successfully")}catch(l){console.error("Error saving lab investigations:",l),j("Failed to save lab investigations")}},jt=()=>{var L;B.value&&(R.value=(L=B.value)==null?void 0:L.validateAll(),R.value&&m.value&&(f.value=["lab-investigation"]))},Yt=()=>{k.value=!0,m.value&&(f.value=[],f.value.push(T.isFemale()?"pregnancy-breastfeeding":"contraindications"))},Gt=()=>{m.value&&(f.value=[],f.value.push("cxca"))},Qt=L=>{O.value=L.isCxCaSaved,w.value=L.obs,m.value&&(f.value=[],f.value.push("contraindications"))},dt=Z(()=>({"Chest X-ray":Ye.value,"Molecular WHO Recommended Rapid Diagnostic Test":Ge.value})),Zt=async()=>{if(!Lt()){j("Please fill in all required pregnancy/breastfeeding fields");return}C.value=await Ht(P.value,o,s),m.value&&(f.value=[],f.value.push("contraceptives"),ut.value=!0)},Xt=async()=>{if(re.value==="Unknown"){K("Please select a TB Therapy Status");return}g.value=!0,m.value&&(f.value=[])},{testOptions:Jt,specimenOptions:Kt,testReasons:ea,selectedTest:De,selectedSpecimen:Ve,selectedReason:Ze,selectedAccessionNumber:Xe,labInvestigations:Le,editingInvestigationId:ta,loadTestTypes:aa,handleTestChange:la,refreshTestTypes:na,saveLabInvestigation:sa,editLabInvestigation:oa,cancelLabInvestigation:ia}=Xa(),{chartPeriod:ra,weightChartCanvas:ua,isLoadingWeightData:Ne,weightData:he,loadWeightHistory:ct,initializeWeightChart:da,cleanupChart:ca}=Za(),{validate:va}=gl(k,I,g);async function fa(){await oe.createEncounter(),await oe.saveValueCodedObs("None","None")}async function pa(){var L,l;try{const h=[];if(U.value)return await fa(),!0;if(F.value){if(!te.value)return j("The tpt transfer form is still initializing"),!1;if(!te.value.validateAll())return j("Please fix the validation errors before submitting"),!1;h.push(...await Promise.all(te.value.buildObs()))}if(!await va())return!1;if(x.value===null)return K("Please wait for drug transfer to load before submitting"),!1;if(x.value&&B.value){if(!((L=B.value)!=null&&L.validateAll()))return K("Please fix drug transfer errors before submitting"),!1;h.push(...await Promise.all((l=B.value)==null?void 0:l.buildObs()))}if(ot()&&it.value){const z=await Tt(P.value,o,s);z!=null&&z.observations&&h.push(...z.observations)}if(re.value){const z=new ee(P.value,53,o,s),Ce={history:Se.value,status:Qe.value,methods:dt.value,symptoms:Me.value,encounterService:z},pe=await Ft(P.value,53,o,s,Ce);pe&&pe.length>0&&h.push(...pe)}if(he.value&&he.value.length>0){const z=new ee(P.value,53,o,s),Ce=he.value[he.value.length-1];if(Ce!=null&&Ce.weight){const pe=await z.buildValueNumber("Weight",Ce.weight);h.push(pe)}}(ke.isPregnant!==null||ke.isBreastFeeding!==null)&&C.value&&C.value.length>0&&h.push(...C.value);try{const z=await qt(P.value,o,s);z&&z.length>0&&h.push(...z)}catch(z){console.error("No contraceptives selected or error building contraceptives payload:",z)}w.value&&w.value.length>0&&h.push(...w.value);const ve=h.filter(z=>z&&Object.keys(z).length>0);if(ve.length>0){let z=it.value;if(!z){const pe=await new ee(P.value,53,o,s).createEncounter();if(!pe)return j("Failed to create encounter"),!1;z=pe.encounter_id}await ee.saveObsArray(Number(z),ve),Ae("Consultation data saved successfully")}return!0}catch(h){return console.error("Error submitting consultation data:",h),j("Failed to save consultation data"),!1}}de(async()=>{await aa(),await ct(),setTimeout(()=>{he.value.length>0&&da()},500)}),Va(()=>{ca()}),c({onSubmit:pa});const ma=()=>{document.querySelectorAll(".multiselect").forEach(l=>{const h=l.querySelector(".multiselect__content-wrapper");if(h){const ce=l.clientWidth||"320";h.style.width=ce+"px"}})};return de(()=>{Ia(()=>{setTimeout(()=>{ma()},1e3)})}),de(async()=>{i.value=await Ue.cervicalCancerScreeningEnabled(),U.value=await oe.getClient()==="No",U.value||(U.value=!!await Wa.isDrugRefillPatient(P.value))}),(L,l)=>U.value?(b(),q(e(Ie),{key:0,style:{height:"40vh"}},{default:a(()=>[t(e(we),null,{default:a(()=>l[21]||(l[21]=[n("div",{style:{"margin-top":"10%"},class:"ion-text-center"},[n("h1",null,[u("Consultation is not required for a "),n("b",null,"Guardian only"),u(" visit or "),n("b",null,"Drug refills"),u(". ")]),n("h1",{class:"ion-padding"},[u("Press the "),n("span",{style:{color:"green","font-weight":"bold"}},"Save / Finish "),u("button to continue")])],-1)])),_:1,__:[21]})]),_:1})):(b(),q(e(Ie),{key:1},{default:a(()=>[t(e(we),null,{default:a(()=>[t(Fl,{patientID:Number(P.value)},null,8,["patientID"]),t(e(Ta),{ref_key:"accordionGroup",ref:m,value:f.value,multiple:!0},{default:a(()=>[Ea(t(e(me),{value:"drug_transfer_in"},{default:a(()=>[t(e(G),{slot:"header"},{default:a(()=>[n("div",Jl,[l[24]||(l[24]=n("div",{class:"section-icon"},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[n("g",{fill:"none",stroke:"currentColor","stroke-width":"1.5"},[n("path",{"stroke-linecap":"round",d:"M22 22H2"}),n("path",{d:"M17 22V6c0-1.886 0-2.828-.586-3.414S14.886 2 13 2h-2c-1.886 0-2.828 0-3.414.586S7 4.114 7 6v16m14 0V8.5c0-1.404 0-2.107-.337-2.611a2 2 0 0 0-.552-.552C19.607 5 18.904 5 17.5 5M3 22V8.5c0-1.404 0-2.107.337-2.611a2 2 0 0 1 .552-.552C4.393 5 5.096 5 6.5 5"}),n("path",{"stroke-linecap":"round",d:"M12 22v-3m-2-7h4m-8.5-1H7m-1.5 3H7m10-3h1.5M17 14h1.5m-13-6H7m10 0h1.5M10 15h4"}),n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9V5m2 2h-4"})])])],-1)),t(e(M),null,{default:a(()=>[l[23]||(l[23]=u(" Transfer-in drug documentation ")),R.value?(b(),E("span",Kl,[t(e(Y),{size:"small",icon:e(ge),style:{"margin-right":"3px"}},null,8,["icon"]),l[22]||(l[22]=u(" Completed "))])):N("",!0)]),_:1,__:[23]})])]),_:1}),n("div",en,[t(Qa,{ref_key:"drugTransferComponent",ref:B,onCanEnterTransferDrugs:l[0]||(l[0]=h=>zt(h))},null,512),n("div",tn,[t(e(W),{expand:"block",onClick:jt},{default:a(()=>l[25]||(l[25]=[u(" Save and Continue ")])),_:1,__:[25]})])])]),_:1},512),[[Oa,x.value]]),t(e(me),{style:{position:"relative !important",overflow:"visible !important"},value:"lab-investigation"},{default:a(()=>[t(e(G),{slot:"header"},{default:a(()=>[n("div",an,[l[28]||(l[28]=n("div",{class:"section-icon"},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 48 48"},[n("g",{fill:"none",stroke:"currentColor","stroke-width":"4"},[n("path",{"stroke-linecap":"round",d:"m29.003 18.373l1.105-1.105l.53-.53a5.5 5.5 0 0 0 0-7.778v0a5.5 5.5 0 0 0-7.778 0L9.172 22.648a.143.143 0 0 0 0 .202l6.97 6.97a1 1 0 0 0 1.414 0l3.713-3.713l1.105-1.105"}),n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m28.163 6.485l1.768-1.767a3.5 3.5 0 0 1 4.95 4.95l-1.768 1.767zM10.485 24.163l-4.242 4.243l4.95 4.95l4.242-4.243z"}),n("circle",{cx:"26.041",cy:"22.042",r:"4.5",transform:"rotate(45 26.041 22.042)"}),n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m6 20l12.728 12.728M10 44h32M31 22c4 0 8 4 8 10c0 6.4-5.167 9.833-8 12"})])])],-1)),t(e(M),null,{default:a(()=>[l[27]||(l[27]=u(" Lab investigation ")),v.value?(b(),E("span",ln,[t(e(Y),{size:"small",icon:e(ge),style:{"margin-right":"3px"}},null,8,["icon"]),l[26]||(l[26]=u(" Completed "))])):N("",!0)]),_:1,__:[27]})])]),_:1}),n("div",nn,[t(e($e),{class:"single-row-grid",style:{overflow:"visible !important"}},{default:a(()=>[t(e(X),{class:"align-items-center"},{default:a(()=>[t(e(H),{size:"auto"},{default:a(()=>[t(e(W),{fill:"clear",shape:"round",size:"small",onClick:e(na)},{default:a(()=>[t(e(Y),{icon:e(gt),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])]),_:1}),t(e(H),{size:"3"},{default:a(()=>[t(e(M),{class:"labl-cls"},{default:a(()=>l[29]||(l[29]=[u(" Test ")])),_:1,__:[29]}),t(e(Fe),{modelValue:e(De),"onUpdate:modelValue":[l[1]||(l[1]=h=>_e(De)?De.value=h:null),e(la)],teleport:"",multiple:!1,taggable:!1,"hide-selected":!0,"close-on-select":!0,openDirection:"auto","tag-placeholder":"",placeholder:"Select test",selectLabel:"",label:"name",searchable:!0,"track-by":"assigned_id",options:e(Jt),disabled:!1},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(e(H),{size:"3"},{default:a(()=>[t(e(M),{class:"labl-cls"},{default:a(()=>l[30]||(l[30]=[u(" Specimen ")])),_:1,__:[30]}),t(e(Fe),{modelValue:e(Ve),"onUpdate:modelValue":l[2]||(l[2]=h=>_e(Ve)?Ve.value=h:null),multiple:!1,taggable:!1,"hide-selected":!0,"close-on-select":!0,openDirection:"auto","tag-placeholder":"",placeholder:"Select specimen",selectLabel:"",label:"name",searchable:!0,"track-by":"assigned_id",options:e(Kt),disabled:!1,appendToBody:!0},null,8,["modelValue","options"])]),_:1}),t(e(H),{size:"3"},{default:a(()=>[t(e(M),{class:"labl-cls"},{default:a(()=>l[31]||(l[31]=[u(" Reason ")])),_:1,__:[31]}),t(e(Fe),{modelValue:e(Ze),"onUpdate:modelValue":l[3]||(l[3]=h=>_e(Ze)?Ze.value=h:null),multiple:!1,taggable:!1,"hide-selected":!0,"close-on-select":!0,openDirection:"auto","tag-placeholder":"",placeholder:"Select reason",selectLabel:"",searchable:!0,options:e(ea),disabled:!1,appendToBody:!0},null,8,["modelValue","options"])]),_:1}),e(De)&&e(De).name&&e(De).name.match(/HIV viral load/i)&&e(Ve)&&e(Ve).name&&e(Ve).name.match(/dbs|plasma/i)?(b(),q(e(H),{key:0,size:"auto"},{default:a(()=>[t(e(M),{class:"labl-cls"},{default:a(()=>l[32]||(l[32]=[u(" Barcode ID ")])),_:1,__:[32]}),t(e(ze),{placeholder:"Scan barcode",modelValue:e(Xe),"onUpdate:modelValue":l[4]||(l[4]=h=>_e(Xe)?Xe.value=h:null),class:"barcode-input"},{default:a(()=>[t(e(Y),{slot:"start",icon:e(Pa),"aria-hidden":"true"},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})):N("",!0)]),_:1}),t(e(H),{size:"auto"},{default:a(()=>[t(e(W),{fill:"clear",class:"ion-margin-top",onClick:e(sa)},{default:a(()=>[t(e(Y),{icon:e(Ma),slot:"start"},null,8,["icon"]),u(" "+A(e(ta)?"UPDATE ORDERS":"ADD TO ORDERS"),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),e(Le).length>0?(b(),E("div",sn,[n("div",on,[n("table",rn,[l[33]||(l[33]=n("thead",null,[n("tr",null,[n("th",null,"TEST"),n("th",null,"SPECIMEN"),n("th",null,"REASON"),n("th",null,"BARCODE"),n("th",null,"ACTIONS")])],-1)),n("tbody",null,[(b(!0),E(J,null,ne(e(Le),h=>(b(),E("tr",{key:h.id},[n("td",null,A(h.test.name),1),n("td",null,A(h.specimen.name),1),n("td",null,A(h.reason),1),n("td",null,A(h.accessionNumber||"N/A"),1),n("td",un,[t(e(W),{fill:"clear",size:"small",color:"nuetral",onClick:ce=>e(oa)(h.id)},{default:a(()=>[t(e(Y),{icon:e(yt),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"]),t(e(W),{fill:"clear",size:"small",color:"danger",onClick:ce=>e(ia)(h.id)},{default:a(()=>[t(e(Y),{icon:e(Na),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"])])]))),128))])])])])):N("",!0),n("div",dn,[t(e(W),{expand:"block",onClick:Wt},{default:a(()=>l[34]||(l[34]=[u(" Save and Continue ")])),_:1,__:[34]})])])]),_:1}),t(e(me),{value:"weight-chart"},{default:a(()=>[t(e(G),{slot:"header"},{default:a(()=>[n("div",cn,[l[37]||(l[37]=n("div",{class:"section-icon"},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",viewBox:"0 0 24 24"},[n("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",color:"currentColor"},[n("path",{d:"M19 15v3.889C19 21.114 18.264 22 15.889 22H8.11C5.886 22 5 21.264 5 18.889V15a7 7 0 1 1 14 0"}),n("path",{d:"M16 15a4 4 0 0 0-8 0m4 2l1-2m3.312-10H7.688c-.884 0-1.326 0-1.715-.152a2 2 0 0 1-.368-.187c-.35-.22-.595-.568-1.085-1.263c-.382-.541-.573-.812-.507-1.033a.5.5 0 0 1 .107-.19C4.28 2 4.624 2 5.313 2h13.376c.689 0 1.033 0 1.192.175q.075.084.107.19c.066.221-.125.492-.507 1.033c-.49.695-.735 1.042-1.085 1.263a2 2 0 0 1-.368.187C17.637 5 17.196 5 16.312 5M14 8V5m-4 3V5"})])])],-1)),t(e(M),null,{default:a(()=>[l[36]||(l[36]=u(" Patient weight chart ")),k.value?(b(),E("span",vn,[t(e(Y),{size:"small",icon:e(ge),style:{"margin-right":"3px"}},null,8,["icon"]),l[35]||(l[35]=u(" Completed "))])):N("",!0)]),_:1,__:[36]})])]),_:1}),n("div",fn,[n("div",pn,[n("div",mn,[t(e(M),null,{default:a(()=>[u("Weight trail ("+A(e(ra))+" year period)",1)]),_:1}),t(e(W),{fill:"clear",size:"small",onClick:e(ct),disabled:e(Ne)},{default:a(()=>[t(e(Y),{icon:e(gt),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick","disabled"])]),e(Ne)?(b(),E("div",gn,[t(e(Be),{name:"bubbles"}),l[38]||(l[38]=n("p",null,"Loading weight data...",-1))])):N("",!0),!e(Ne)&&e(he).length===0?(b(),E("div",_n,l[39]||(l[39]=[n("p",null,"No weight data available for this patient",-1)]))):N("",!0),n("div",{class:St(["chart-canvas-container",{hidden:e(Ne)||e(he).length===0}])},[n("canvas",{ref_key:"weightChartCanvas",ref:ua,id:"weight-chart-canvas"},null,512)],2),e(Ne)?N("",!0):(b(),E("div",bn,[t(e(W),{expand:"block",onClick:Yt},{default:a(()=>l[40]||(l[40]=[u(" Continue ")])),_:1,__:[40]})]))])])]),_:1}),e(T).isFemale()?(b(),q(e(me),{key:0,value:"pregnancy-breastfeeding"},{default:a(()=>[t(e(G),{slot:"header"},{default:a(()=>[n("div",yn,[l[43]||(l[43]=n("div",{class:"section-icon"},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},[n("g",{fill:"currentColor"},[n("path",{d:"M15.751 8.26c.2 0 .386.056.553.148c.398.14.706.485.797.913c.02.12-.08.23-.2.23h-.416h.346a.75.75 0 0 0-.05-.546a.78.78 0 0 0-.7-.434a.77.77 0 0 0-.74.98h.356h-.736c-.15 0-.27-.14-.22-.29q.013-.053.03-.103l-.03-.027a.368.368 0 0 1 .02-.57c.28-.19.64-.3.99-.3"}),n("path",{d:"m15.697 9.55l.004.01h.78l.004-.01a.444.444 0 0 0-.394-.64a.4.4 0 0 0-.168.035a.14.14 0 1 1-.21.184a.43.43 0 0 0-.062.222a.5.5 0 0 0 .046.2m4.594-1.301c.35 0 .71.11.99.3c.19.13.2.41.03.56l-.035.033q.021.057.035.117c.04.15-.08.29-.23.29h-.726l-.004.01h-.78l-.005-.01h-.415c-.12 0-.22-.11-.2-.23c.081-.412.369-.75.75-.898c.176-.106.375-.172.59-.172m.064 1.3h.346q.03-.105.03-.21a.77.77 0 0 0-.77-.77c-.43 0-.78.35-.78.77c0 .08.01.14.03.21h.355a.4.4 0 0 1-.045-.2c0-.083.024-.162.066-.229a.14.14 0 0 0 .254-.08a.14.14 0 0 0-.04-.1a.4.4 0 0 1 .16-.03a.444.444 0 0 1 .395.64m-2.345 2.409c-.45 0-.87-.11-1.23-.3c-.12-.06-.25.08-.18.2c.3.46.82.77 1.41.77s1.11-.3 1.41-.77c.07-.12-.05-.25-.18-.19c-.36.18-.78.29-1.23.29m-.76-1.39l.44-1.42c.1-.31.54-.31.63 0l.44 1.42c.09.29-.12.59-.43.59h-.65c-.3 0-.52-.3-.43-.59m-2.31-2.76a.22.22 0 0 1-.2-.12c-.07-.1-.03-.25.08-.31c.03-.02.78-.44 1.65-.28c.13.02.21.14.19.27c-.02.12-.15.21-.27.18c-.7-.13-1.33.23-1.33.23c-.04.03-.08.03-.12.03m6.02-.03q.06.03.12.03c.08 0 .16-.04.21-.12a.24.24 0 0 0-.112-.33c-.135-.068-.83-.416-1.628-.27a.23.23 0 0 0-.19.27c.02.13.15.21.27.19c.626-.117 1.203.168 1.312.222z"}),n("path",{d:"M24.251 10.63a2.86 2.86 0 0 0-.2-2.82c-.3-.46-.46-.99-.46-1.54v-.01a2.86 2.86 0 0 0-2.86-2.86c-.16 0-.3-.07-.39-.2c-.52-.73-1.37-1.2-2.33-1.2s-1.81.47-2.33 1.2c-.09.12-.24.2-.39.2a2.86 2.86 0 0 0-2.86 2.86v.01c0 .55-.16 1.08-.46 1.54a2.86 2.86 0 0 0-.2 2.82c.06.13.06.27 0 .4a2.79 2.79 0 0 0 2.437 4.01l-1.557 1.67c-.33.35-.53.82-.53 1.34c0 .5.19.96.49 1.3c.09.1.03.27-.1.29a6.385 6.385 0 0 0-5.308 6.168a1.66 1.66 0 0 0-1.198 1.444l-.001.014v.013c-.023.373.077.73.271 1.025a1.66 1.66 0 0 0 .423 1.337q.008.046.019.094l.002.01c.192.793.919 1.255 1.632 1.255h1.042c.036 0 .678.002 1.013-.054a13 13 0 0 0 .88-.162a19 19 0 0 0 2.68-.784h6.405c.96 0 1.74-.78 1.74-1.74V16.05c0-.36-.072-.702-.203-1.016a2.79 2.79 0 0 0 2.333-4.004a.5.5 0 0 1 .01-.4m-1.91-3.116a2 2 0 0 1 .04.386l-.005.125a1.4 1.4 0 0 1 1.133 1.373a1.4 1.4 0 0 1-1.257 1.392c-.227 2.284-2.049 3.79-4.24 3.79c-2.122 0-3.897-1.42-4.215-3.575q-.015-.107-.026-.216a1.399 1.399 0 0 1-.119-2.764l-.01-.265c.007-.635.3-.96.78-1.28c.267-.178.526-.364.73-.6l.005-.005q.11-.127.197-.277l.006-.01q.045-.081.081-.168l.07-.15c.07-.17.3-.2.4-.05a3.2 3.2 0 0 0 .465.545l.006.005c.605.565 1.414.89 2.26.89h2.76c.14 0 .77.061.938.854M8.93 26.74l-.3-.3a.66.66 0 0 1 0-.92c.25-.25.67-.25.92 0l.54.54c.2.2.49.28.77.21c1.24-.31 3.31-.99 4.91-2.38a7 7 0 0 0 1.154-1.275a8 8 0 0 0 .658-1.106c.25-.503.442-1.007.588-1.48v-.009h3.6q-.107.477-.266 1a13 13 0 0 1-.655 1.718a12 12 0 0 1-1.019 1.782a10.7 10.7 0 0 1-1.78 1.99c-3.166 2.74-7.354 3.38-7.78 3.445l-.03.005l-.036.005C9.95 30 9.44 30 9.391 30h-1.04c-.31 0-.59-.2-.66-.49a.67.67 0 0 1 .02-.37l-.057-.021a.645.645 0 0 1-.393-.6c0-.2.09-.38.23-.5a.64.64 0 0 1-.49-.68a.67.67 0 0 1 .67-.6z"})])])],-1)),t(e(M),null,{default:a(()=>[l[42]||(l[42]=u(" Pregnancy or Breast Feeding ")),ut.value?(b(),E("span",hn,[t(e(Y),{size:"small",icon:e(ge),style:{"margin-right":"3px"}},null,8,["icon"]),l[41]||(l[41]=u(" Completed "))])):N("",!0)]),_:1,__:[42]})])]),_:1}),n("div",Cn,[n("div",null,[t(e(X),null,{default:a(()=>[t(e(H),null,{default:a(()=>[t(e(M),null,{default:a(()=>l[44]||(l[44]=[u("Pregnant")])),_:1,__:[44]})]),_:1}),t(e(H),null,{default:a(()=>[n("div",wn,[t(e(be),{modelValue:e(ke).isPregnant,"onUpdate:modelValue":l[5]||(l[5]=h=>e(ke).isPregnant=h)},{default:a(()=>[t(e(Q),{slot:"end",value:"yes"},{default:a(()=>l[45]||(l[45]=[u("Yes")])),_:1,__:[45]}),t(e(Q),{slot:"end",style:{"margin-left":"20px"},value:"no"},{default:a(()=>l[46]||(l[46]=[u("No")])),_:1,__:[46]})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),t(e(X),null,{default:a(()=>[t(e(H),null,{default:a(()=>[t(e(M),null,{default:a(()=>l[47]||(l[47]=[u("Breastfeeding")])),_:1,__:[47]})]),_:1}),t(e(H),null,{default:a(()=>[n("div",Sn,[t(e(be),{modelValue:e(ke).isBreastFeeding,"onUpdate:modelValue":l[6]||(l[6]=h=>e(ke).isBreastFeeding=h)},{default:a(()=>[t(e(Q),{slot:"end",value:"yes"},{default:a(()=>l[48]||(l[48]=[u("Yes")])),_:1,__:[48]}),t(e(Q),{slot:"end",style:{"margin-left":"20px"},value:"no"},{default:a(()=>l[49]||(l[49]=[u("No")])),_:1,__:[49]})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),e(Rt)?N("",!0):(b(),E("div",kn,[t(e(W),{expand:"block",onClick:Zt},{default:a(()=>l[50]||(l[50]=[u(" Continue ")])),_:1,__:[50]})]))])])]),_:1})):N("",!0),e(T).isFemale()?(b(),q(e(me),{key:1,value:"contraceptives"},{default:a(()=>[t(e(G),{slot:"header"},{default:a(()=>[n("div",Dn,[l[53]||(l[53]=n("div",{class:"section-icon"},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 48 48"},[n("path",{fill:"currentColor","fill-rule":"evenodd",d:"M16 7.152a2 2 0 0 1 1.347-1.89l3.018-1.043A4 4 0 0 1 21.671 4h4.658a4 4 0 0 1 1.306.22l3.018 1.042A2 2 0 0 1 32 7.152V11h-1.09a1 1 0 0 1-.206.607l-1.51 1.978l5.362 1.756A5 5 0 0 1 38 20.092V39a5 5 0 0 1-5 5H15a5 5 0 0 1-5-5V20.092a5 5 0 0 1 3.444-4.751l5.362-1.756l-1.51-1.978a1 1 0 0 1-.205-.607H16zM19.349 11h9.302l-1.046 1.371a2 2 0 0 0 .967 3.114l5.362 1.756A3 3 0 0 1 36 20.092V39a3 3 0 0 1-3 3H15a3 3 0 0 1-3-3V20.092a3 3 0 0 1 2.066-2.85l5.362-1.757a2 2 0 0 0 .967-3.114zm10.97 21.906A8 8 0 0 0 19.095 21.68l4.113 4.112l-1.414 1.414l-4.113-4.113A8 8 0 0 0 28.906 34.32l-3.113-3.112l1.414-1.414zM24 38c5.523 0 10-4.477 10-10s-4.477-10-10-10s-10 4.477-10 10s4.477 10 10 10m.567-11.99c-.27-.783-.01-1.843.737-2.687c.991-1.122 2.465-1.44 3.292-.71s.694 2.233-.298 3.355c-.648.735-1.504 1.124-2.25 1.101l-.002.005c-.207.347-.302.762-.384 1.176l-.01.045c-.074.38-.18.884-.672 1.394c-.504.523-1.431.707-2.398.872c-.641.11-.973.213-1.135.281c-.133.056-.263.351-.442.756c-.292.662-.713 1.617-1.49 2.302c-.11-.993.203-2.722.38-3.655a1.7 1.7 0 0 1 .606-.753c.473-.338 1.175-.532 2.08-.686c.835-.142 1.06-.321 1.115-.378c.047-.05.086-.11.174-.553l.01-.047c.08-.406.198-1.005.586-1.656a4 4 0 0 1 .1-.161","clip-rule":"evenodd"})])],-1)),t(e(M),null,{default:a(()=>{var h;return[l[52]||(l[52]=u(" Contraceptives ")),(h=y.value)!=null&&h.isContraceptivesSaved?(b(),E("span",Vn,[t(e(Y),{size:"small",icon:e(ge),style:{"margin-right":"3px"}},null,8,["icon"]),l[51]||(l[51]=u(" Completed "))])):N("",!0)]}),_:1,__:[52]})])]),_:1}),n("div",In,[t(Vl,{"patient-i-d":Number(P.value),"provider-i-d":e(o),"location-i-d":e(s),ref_key:"contraceptivesRef",ref:y,onOnSuccess:Gt},null,8,["patient-i-d","provider-i-d","location-i-d"])])]),_:1})):N("",!0),e(T).isFemale()&&i.value?(b(),q(e(me),{key:2,value:"cxca"},{default:a(()=>[t(e(G),{slot:"header"},{default:a(()=>[n("div",Tn,[l[56]||(l[56]=n("div",{class:"section-icon"},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[n("g",{fill:"currentColor"},[n("path",{d:"M7.773 2.384L5.727 8.268a14.09 14.09 0 0 0 1.137 11.728l.504.864l-1.728 1.008l-.504-.864A16.09 16.09 0 0 1 3.838 7.61l2.046-5.884zm8.454 0l2.047 5.884a14.09 14.09 0 0 1-1.138 11.728l-.504.864l1.728 1.008l.504-.864A16.09 16.09 0 0 0 20.163 7.61l-2.047-5.884zM13 21v-5.086l3.207-3.207l-1.414-1.414L12 14.086l-2.793-2.793l-1.414 1.414L11 15.914V21z"}),n("path",{"fill-rule":"evenodd",d:"M11.633 3c-1.65 0-2.496 1.978-1.355 3.171l.684.715l-2.004 2.096l1.084 1.037L12 7.97l1.958 2.047l1.084-1.036l-2.004-2.096l.684-.715c1.14-1.193.296-3.17-1.355-3.17zm1.005 2.134L12 5.801l-.638-.667a.375.375 0 0 1 .27-.634h.735c.33 0 .5.396.271.634","clip-rule":"evenodd"})])])],-1)),t(e(M),null,{default:a(()=>[l[55]||(l[55]=u(" Cervical Cancer ")),O.value?(b(),E("span",En,[t(e(Y),{size:"small",icon:e(ge),style:{"margin-right":"3px"}},null,8,["icon"]),l[54]||(l[54]=u(" Completed "))])):N("",!0)]),_:1,__:[55]})])]),_:1}),n("div",On,[t(jl,{"patient-i-d":Number(P.value),"provider-i-d":e(o),"location-i-d":e(s),ref:"cxcaRef",onOnSuccess:Qt},null,8,["patient-i-d","provider-i-d","location-i-d"])])]),_:1})):N("",!0),t(e(me),{value:"contraindications"},{default:a(()=>[t(e(G),{slot:"header"},{default:a(()=>[n("div",Pn,[l[59]||(l[59]=n("div",{class:"section-icon"},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",viewBox:"0 0 16 16"},[n("path",{fill:"currentColor",d:"M3.001 3.999a1.001 1.001 0 0 1 1.836-.555a.5.5 0 1 0 .832-.555A2 2 0 0 0 2 3.999A2 2 0 0 0 4.078 6h3.259a5.5 5.5 0 0 1 3.151-1h-6.41l-.038.001L4.003 5A1 1 0 0 1 3 3.999m.495 3.003h2.76a5.5 5.5 0 0 0-.657 1H3.496a.5.5 0 1 1 0-1M2.501 9h2.706a5.5 5.5 0 0 0-.185 1h-2.52a.5.5 0 0 1 0-1m.995 2h1.526q.048.516.185 1H3.496a.5.5 0 0 1 0-1M7.5 3a.5.5 0 0 0 0 1h6a.5.5 0 1 0 0-1zm7.5 7.5a4.5 4.5 0 1 1-9 0a4.5 4.5 0 0 1 9 0m-4-2a.5.5 0 1 0-1 0V10H8.5a.5.5 0 0 0 0 1H10v1.5a.5.5 0 0 0 1 0V11h1.5a.5.5 0 1 0 0-1H11z"})])],-1)),t(e(M),null,{default:a(()=>[l[58]||(l[58]=u(" Contraindications/side effects ")),I.value?(b(),E("span",Mn,[t(e(Y),{size:"small",icon:e(ge),style:{"margin-right":"3px"}},null,8,["icon"]),l[57]||(l[57]=u(" Completed "))])):N("",!0)]),_:1,__:[58]})])]),_:1}),n("div",Nn,[n("div",xn,[t(e(X),null,{default:a(()=>[t(e(H),null,{default:a(()=>[t(e(M),null,{default:a(()=>l[60]||(l[60]=[u("Has side effects / contraindications")])),_:1,__:[60]})]),_:1}),t(e(H),null,{default:a(()=>[n("div",Fn,[t(e(be),{modelValue:S.value,"onUpdate:modelValue":l[7]||(l[7]=h=>S.value=h)},{default:a(()=>[t(e(Q),{slot:"end",value:"yes"},{default:a(()=>l[61]||(l[61]=[u("Yes")])),_:1,__:[61]}),t(e(Q),{slot:"end",style:{"margin-left":"20px"},value:"no"},{default:a(()=>l[62]||(l[62]=[u("No")])),_:1,__:[62]})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),S.value==="yes"?(b(),E("div",Bn,[e(ie)?(b(),E("div",An,[t(e(Be),{name:"bubbles"}),l[63]||(l[63]=n("p",null,"Loading side effects data...",-1))])):N("",!0),n("div",Rn,[t(e(xa),{modelValue:D.value,"onUpdate:modelValue":l[8]||(l[8]=h=>D.value=h),onIonChange:$t},{default:a(()=>[t(e(_t),{value:"contraindication"},{default:a(()=>[t(e(M),null,{default:a(()=>l[64]||(l[64]=[u("Side Effects/Contraindications")])),_:1,__:[64]})]),_:1}),t(e(_t),{value:"side_effect"},{default:a(()=>[t(e(M),null,{default:a(()=>l[65]||(l[65]=[u("Others")])),_:1,__:[65]})]),_:1})]),_:1},8,["modelValue"])]),t(dl,{modelValue:e(se),"onUpdate:modelValue":l[9]||(l[9]=h=>_e(se)?se.value=h:null),"side-effect-options":e($)},null,8,["modelValue","side-effect-options"])])):N("",!0),n("div",Ln,[t(e(W),{expand:"block",onClick:Ut},{default:a(()=>l[66]||(l[66]=[u(" Save and Continue ")])),_:1,__:[66]})])])])]),_:1}),t(e(me),{value:"tb-therapy"},{default:a(()=>[t(e(G),{slot:"header"},{default:a(()=>[n("div",Hn,[l[69]||(l[69]=n("div",{class:"section-icon"},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 48 48"},[n("g",{fill:"currentColor","fill-rule":"evenodd","clip-rule":"evenodd"},[n("path",{d:"M35 30.5a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0m-2 0a.5.5 0 1 1-1 0a.5.5 0 0 1 1 0"}),n("path",{d:"M23 20.5V6h2v14.5c0 1.398.564 1.942 1.004 2.199q.073.042.148.078l-.004-.377c-.038-3.528-.112-10.4 5.327-10.4c4.126 0 7.599 7.974 9.335 15.542c.11.263.175.55.188.849c1.232 5.783 1.415 11.14.057 12.27c-3.193 2.653-9.58 1.06-12.773-2.124c-2.578-2.57-2.355-8.578-2.195-12.891v-.002q.016-.393.028-.767a4.3 4.3 0 0 1-1.119-.45a3.8 3.8 0 0 1-.996-.835c-.297.352-.64.626-.996.834c-.4.234-.794.37-1.12.451l.029.769c.16 4.313.383 10.32-2.195 12.891c-3.193 3.185-9.58 4.777-12.773 2.123S9.075 12 16.525 12c5.439 0 5.365 6.872 5.327 10.4v.002l-.004.375q.075-.036.148-.078c.44-.257 1.004-.801 1.004-2.199m15.327 5.36l.038.144a2.5 2.5 0 1 0 1.065 4.817c.27 1.566.449 3.05.526 4.36c.079 1.332.049 2.413-.068 3.188a3.7 3.7 0 0 1-.206.828c-.96.73-2.598 1.022-4.633.628c-2.058-.4-4.076-1.43-5.355-2.704c-.443-.442-.84-1.172-1.137-2.261c-.293-1.076-.45-2.361-.517-3.761c-.066-1.393-.04-2.833.004-4.208l.04-1.126v-.003q.019-.472.034-.927A3.001 3.001 0 0 0 34 24a3 3 0 0 0-5.847-.95q0-.344-.005-.719c-.015-1.648-.034-3.691.411-5.466c.254-1.014.616-1.732 1.05-2.178c.375-.386.912-.687 1.866-.687c.319 0 .777.134 1.395.654c.412.346.846.824 1.289 1.434A2.503 2.503 0 0 0 31 18.5a2.5 2.5 0 0 0 4.917.642c.927 1.962 1.748 4.292 2.41 6.719m.666 2.723l-.08-.366a.5.5 0 1 0 .08.366M16.525 14c.954 0 1.49.3 1.866.687c.434.446.796 1.164 1.05 2.178c.445 1.775.426 3.817.41 5.465l-.004.816c0 .76.033 1.67.069 2.616l.04 1.129c.044 1.375.07 2.815.004 4.208c-.067 1.4-.224 2.685-.517 3.76c-.297 1.09-.694 1.82-1.137 2.262c-1.279 1.275-3.297 2.304-5.355 2.704c-2.035.394-3.673.102-4.633-.628l-.016-.04a3.7 3.7 0 0 1-.19-.788c-.117-.775-.147-1.856-.068-3.188c.157-2.65.727-6.012 1.63-9.32c.905-3.321 2.109-6.46 3.474-8.722c.683-1.133 1.357-1.96 1.982-2.485c.618-.52 1.076-.654 1.395-.654M33.5 19a.5.5 0 1 0 0-1a.5.5 0 0 0 0 1M32 24a1 1 0 1 1-2 0a1 1 0 0 1 2 0"})])])],-1)),t(e(M),null,{default:a(()=>[l[68]||(l[68]=u(" TB Preventive Therapy ")),g.value?(b(),E("span",qn,[t(e(Y),{size:"small",icon:e(ge),style:{"margin-right":"3px"}},null,8,["icon"]),l[67]||(l[67]=u(" Completed "))])):N("",!0)]),_:1,__:[68]})])]),_:1}),n("div",$n,[e(Bt)?(b(),E("div",zn,[t(e(Be),{name:"bubbles"}),l[70]||(l[70]=n("p",null,"Loading side effects data...",-1))])):N("",!0),n("div",Un,[n("div",Wn,[l[73]||(l[73]=n("label",{class:"form-label required"},"On TB treatment?",-1)),n("div",jn,[t(e(be),{modelValue:e(re),"onUpdate:modelValue":l[10]||(l[10]=h=>_e(re)?re.value=h:null)},{default:a(()=>[n("div",Yn,[t(e(Q),{value:"Yes"}),t(e(M),null,{default:a(()=>l[71]||(l[71]=[u("Yes")])),_:1,__:[71]})]),n("div",Gn,[t(e(Q),{value:"No"}),t(e(M),null,{default:a(()=>l[72]||(l[72]=[u("No")])),_:1,__:[72]})])]),_:1},8,["modelValue"])])]),e(re).toLowerCase()==="yes"&&e(re).toLowerCase()!=="unknown"?(b(),E("div",Qn,[l[76]||(l[76]=n("label",{class:"form-label required"},"TB Treatment Start Date",-1)),t(e(X),null,{default:a(()=>[t(e(H),{size:"10"},{default:a(()=>[t(We,{place_holder:"enter data",onDateUpDated:[()=>{},l[11]||(l[11]=h=>{Ot.value={day:h.value.day,month:h.value.month,year:h.value.year}})],date_prop:""})]),_:1}),t(e(H),{size:"2"},{default:a(()=>[t(e(W),{fill:"clear","start-icon":e(Fa),onClick:l[12]||(l[12]=h=>rt.value=!0)},{default:a(()=>l[74]||(l[74]=[u("Estimate")])),_:1,__:[74]},8,["start-icon"])]),_:1})]),_:1}),e(rt)?(b(),E("div",Zn,[t(Dt,{bold:"bold","input-header":"Estimate number of ".concat(e(je).name),"input-value":e(Re),"onUpdate:inputValue":[l[13]||(l[13]=h=>_e(Re)?Re.value=h:null),l[14]||(l[14]=h=>Re.value=h.target.value)],showAsterisk:"",placeholder:"",unitsData:{isSingleSelect:!0,multiSelectData:e(Pt).map(h=>({name:h})),value:e(je),trackBy:"name"},"onUpdate:units":l[15]||(l[15]=h=>je.value=h)},null,8,["input-header","input-value","unitsData"])])):N("",!0),n("div",Xn,[l[75]||(l[75]=n("label",{position:"stacked",class:"form-label required"},"Treatment Period",-1)),t(Ha,{placeholder:"",inputValue:e(Et),unit:"Months",icon:e(Ba),type:"number"},null,8,["inputValue","icon"])])])):e(re).toLowerCase()==="no"&&e(re).toLowerCase()!=="unknown"?(b(),E("div",Jn,[n("div",Kn,[l[77]||(l[77]=n("h4",null,"TB Associated Symptoms",-1)),t(pl,{modelValue:e(Me),"onUpdate:modelValue":l[16]||(l[16]=h=>_e(Me)?Me.value=h:null),"tb-symptom-options":e(At)},null,8,["modelValue","tb-symptom-options"])]),n("div",es,[t(e(X),null,{default:a(()=>[t(e(H),null,{default:a(()=>l[78]||(l[78]=[n("label",{class:"form-label required"},"CXR (Chest X-ray) Screening Method Result",-1)])),_:1,__:[78]}),t(e(H),null,{default:a(()=>[n("div",ts,[t(e(be),{modelValue:Ye.value,"onUpdate:modelValue":l[17]||(l[17]=h=>Ye.value=h)},{default:a(()=>[n("div",as,[t(e(Q),{value:"normal"}),t(e(M),null,{default:a(()=>l[79]||(l[79]=[u("Normal")])),_:1,__:[79]})]),n("div",ls,[t(e(Q),{value:"abnormal"}),t(e(M),null,{default:a(()=>l[80]||(l[80]=[u("Abnormal")])),_:1,__:[80]})]),n("div",ns,[t(e(Q),{value:"unknown"}),t(e(M),null,{default:a(()=>l[81]||(l[81]=[u("Unknown/Not Done")])),_:1,__:[81]})])]),_:1},8,["modelValue"])])]),_:1})]),_:1}),t(e(X),null,{default:a(()=>[t(e(H),null,{default:a(()=>l[82]||(l[82]=[n("label",{class:"form-label required"},"mWRD (Molecular WHO Recommended Rapid Diagnostic Test) Screening Method Result",-1)])),_:1,__:[82]}),t(e(H),null,{default:a(()=>[n("div",ss,[t(e(be),{modelValue:Ge.value,"onUpdate:modelValue":l[18]||(l[18]=h=>Ge.value=h)},{default:a(()=>[n("div",os,[t(e(Q),{value:"negative"}),t(e(M),null,{default:a(()=>l[83]||(l[83]=[u("Negative")])),_:1,__:[83]})]),n("div",is,[t(e(Q),{value:"positive"}),t(e(M),null,{default:a(()=>l[84]||(l[84]=[u("Positive")])),_:1,__:[84]})]),n("div",rs,[t(e(Q),{value:"unknown"}),t(e(M),null,{default:a(()=>l[85]||(l[85]=[u("Unknown/Not Done")])),_:1,__:[85]})])]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),e(Nt)(dt.value,e(Me))?(b(),E("div",us,[n("div",null,[l[86]||(l[86]=n("label",{class:"form-label"},"TB Status",-1)),n("div",ds,[t(e(Fe),{modelValue:Qe.value,"onUpdate:modelValue":l[19]||(l[19]=h=>Qe.value=h),multiple:!1,taggable:!1,"hide-selected":!1,"close-on-select":!0,openDirection:"bottom","tag-placeholder":"",placeholder:"Select TB status",selectLabel:"",label:"name",searchable:!0,"track-by":"assigned_id",options:e(Mt).map(h=>({name:h,assigned_id:h})),disabled:!1},null,8,["modelValue","options"])])])])):N("",!0)])):N("",!0),e(re).toLowerCase()!=="unknown"?(b(),E("div",cs,[l[87]||(l[87]=n("label",{class:"form-label required"},"TB preventive therapy (TPT) history",-1)),n("div",null,[t(e(Fe),{modelValue:Se.value,"onUpdate:modelValue":l[20]||(l[20]=h=>Se.value=h),multiple:!1,taggable:!1,"hide-selected":!0,"close-on-select":!0,openDirection:"bottom","tag-placeholder":"",placeholder:"Select option",selectLabel:"",label:"name",searchable:!0,"track-by":"assigned_id",options:e(xt).map(h=>({name:h,assigned_id:h})),disabled:!1},null,8,["modelValue","options"])]),F.value?(b(),E("div",vs,[t(e(Ie),null,{default:a(()=>[t(e(we),null,{default:a(()=>{var h,ce;return[(b(),q(Xl,{ref_key:"tptTransferForm",ref:te,drugNameFilters:Pe.value,key:(ce=(h=Se.value)==null?void 0:h.name)!=null?ce:"",patientId:P.value},null,8,["drugNameFilters","patientId"]))]}),_:1})]),_:1})])):N("",!0)])):N("",!0),n("div",fs,[t(e(W),{expand:"block",onClick:Xt},{default:a(()=>l[88]||(l[88]=[u(" Save and Continue ")])),_:1,__:[88]})])])])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}))}}),Vs=ye(ps,[["__scopeId","data-v-cdd3625b"]]);export{Vs as default};

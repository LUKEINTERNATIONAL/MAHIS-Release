import{d as W,I as j,L as X,ev as Y,ew as Z,ex as x,b4 as ee,cd as ne,bn as oe,dE as te,a0 as ae,M as le,bs as se,aS as ie,aT as re,ae as de,aU as ce,aV as ue,b2 as _e,a1 as me,ab as pe,aa as fe,a9 as ge,bl as ye,a8 as ve,r as g,c as Ce,bK as he,bJ as Ie,ey as be,ez as Pe,eA as De,d7 as we,en as ke,eB as Ne,eC as ze,H as t,N as U,f as v,J as n,l as e,e as w,F as E,O as G,k as C,m as L,p as Se,K as s,P as m}from"./vendor-D6BsZkA2.js";import{N as Be}from"./NavigationMenu-ChiR3mjP.js";import{b as Ve}from"./bottomNavBar-DqY7yKk6.js";import{P as O,N as Ue,t as $e,_ as Me}from"./index-CxCBwNwJ.js";import{E as Ee}from"./EIRreportsStore-CUJL7MMM.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-DvmkyR1f.js";const Ge=W({name:"ClientDeduplication",components:{IonContent:ve,IonGrid:ye,IonRow:ge,IonCol:fe,IonList:pe,IonItem:me,IonLabel:_e,IonCard:ue,IonCardHeader:ce,IonPage:de,IonCardTitle:re,IonCardContent:ie,IonCheckbox:se,IonButton:le,IonIcon:ae,IonAvatar:te,IonBadge:oe,NavigationMenu:Be,IonCardSubtitle:ne,IonSearchbar:ee,IonItemSliding:x,IonItemOption:Z,IonItemOptions:Y,IonFooter:X,bottomNavBar:Ve,IonHeader:j},setup(){const o=g([]),i=g([]),h=g(null),k=g(33),D=g(""),N=g(0),b=g(1),P=g(10),p=Ce(()=>!0),y=async({page:a,itemsPerPage:d})=>{b.value=a,P.value=d,await u()},z=a=>{h.value===a?h.value=null:h.value=a},f=a=>a.duplicates.some(d=>d.selected),S=async a=>{const d=a.duplicates.filter(c=>c.selected),_={primary:{patient_id:a.primary_patient_id},secondary:d.map(c=>({patient_id:c.secondary_patient_id})),program_id:k.value};try{console.log("Merge Payload:",_),await O.mergePatients(_),h.value=null,Ue("Clients merged successfully"),await u()}catch(c){console.error("Error merging clients:",c),$e("Failed to merge clients. Please try again.")}},u=async()=>{try{Ee().setNavigationPayload("Client De-Duplication",!0,!1,"/","home","");const d=await O.getCachedClientProfileDuplicates(b.value,P.value);o.value=d.results,N.value=d.count,i.value=o.value}catch(a){console.error("Error fetching duplicate clients:",a)}};return{clients:o,filteredClients:i,selectedPrimaryClient:h,toggleClientDetails:z,hasSelectedDuplicates:f,mergeSelected:S,programId:k,initNavData:u,getGenderIcon:a=>a.toUpperCase()==="M"?Ne:ze,searchQuery:D,filterClients:()=>{D.value?i.value=o.value.filter(a=>{const d="".concat(a.primary_given_name," ").concat(a.primary_family_name).toLowerCase(),_=D.value.toLowerCase(),c=String(a.primary_patient_id);return d.includes(_)||c.includes(_)}):i.value=o.value},viewDetails:a=>{console.log("View details for:",a)},personCircle:ke,calendar:we,fingerPrint:De,location:Pe,linkOutline:be,chevronDown:Ie,chevronUp:he,showNavBar:p,totalCount:N,currentPage:b,itemsPer_Page:P,handlePaginationUpdate:y}},watch:{$route:{handler(o){o.name==="Deduplicateclients"&&this.initNavData()},immediate:!0}},mounted(){this.initNavData()}}),Le={class:"sticky-header"},Oe={key:0,class:"client-details"};function Ae(o,i,h,k,D,N){const b=t("NavigationMenu"),P=t("ion-searchbar"),p=t("ion-col"),y=t("ion-row"),z=t("ion-header"),f=t("ion-icon"),S=t("ion-avatar"),u=t("ion-label"),B=t("ion-badge"),I=t("ion-item"),V=t("ion-card-subtitle"),a=t("ion-card-header"),d=t("ion-grid"),_=t("ion-card-content"),c=t("ion-card"),A=t("ion-checkbox"),F=t("ion-item-option"),H=t("ion-item-options"),Q=t("ion-item-sliding"),$=t("ion-list"),T=t("ion-button"),J=t("ion-content"),K=t("bottomNavBar"),R=t("ion-footer"),q=t("ion-page");return v(),U(q,null,{default:n(()=>[e(b),e(z,{style:{"background-color":"transparent"},class:"ion-no-border"},{default:n(()=>[e(y,null,{default:n(()=>[e(p,{size:"12","size-md":"10","size-lg":"8","offset-md":"1","offset-lg":"2"},{default:n(()=>[e(P,{placeholder:"Search clients",modelValue:o.searchQuery,"onUpdate:modelValue":i[0]||(i[0]=l=>o.searchQuery=l),onIonInput:o.filterClients},null,8,["modelValue","onIonInput"])]),_:1})]),_:1})]),_:1}),e(J,null,{default:n(()=>[e(d,null,{default:n(()=>[e(y,null,{default:n(()=>[e(p,{size:"12","size-md":"10","size-lg":"8","offset-md":"1","offset-lg":"2"},{default:n(()=>[e(c,null,{default:n(()=>[e(_,null,{default:n(()=>[e($,null,{default:n(()=>[(v(!0),w(E,null,G(o.filteredClients,l=>(v(),w("div",{key:l.primary_patient_id,class:"client-container"},[C("div",Le,[e(I,{button:"",onClick:r=>o.toggleClientDetails(l),class:Se({"selected-client":o.selectedPrimaryClient===l})},{default:n(()=>[e(S,{slot:"start"},{default:n(()=>[e(f,{icon:o.personCircle,size:"large",color:o.selectedPrimaryClient===l?"primary":"medium"},null,8,["icon","color"])]),_:2},1024),e(u,null,{default:n(()=>[C("h2",null,s(l.primary_given_name)+" "+s(l.primary_family_name),1),C("p",null,"ID: "+s(l.primary_patient_id),1)]),_:2},1024),e(B,{color:"warning",slot:"end"},{default:n(()=>[m(s(l.duplicates.length),1)]),_:2},1024),e(f,{icon:o.selectedPrimaryClient===l?o.chevronUp:o.chevronDown,slot:"end"},null,8,["icon"])]),_:2},1032,["onClick","class"])]),o.selectedPrimaryClient===l?(v(),w("div",Oe,[e(c,{style:{"margin-bottom":"10px","margin-top":"5px"}},{default:n(()=>[e(a,{color:"light"},{default:n(()=>[e(V,null,{default:n(()=>i[1]||(i[1]=[m("Primary Client Details",-1)])),_:1,__:[1]})]),_:1}),e(_,null,{default:n(()=>[e(d,null,{default:n(()=>[e(y,null,{default:n(()=>[e(p,{size:"12","size-md":"6"},{default:n(()=>[e(I,{lines:"none"},{default:n(()=>[e(f,{icon:o.calendar,slot:"start",color:"primary"},null,8,["icon"]),e(u,null,{default:n(()=>[m("Birth Date: "+s(l.primary_birthdate),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(p,{size:"12","size-md":"6"},{default:n(()=>[e(I,{lines:"none"},{default:n(()=>[e(f,{icon:o.getGenderIcon(l.primary_gender),slot:"start",color:"primary"},null,8,["icon"]),e(u,null,{default:n(()=>[m("Gender: "+s(l.primary_gender),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(y,null,{default:n(()=>[e(p,{size:"12"},{default:n(()=>[e(I,{lines:"none"},{default:n(()=>[e(f,{icon:o.location,slot:"start",color:"primary"},null,8,["icon"]),e(u,{class:"ion-text-wrap"},{default:n(()=>[m(" Address: "+s(l.primary_home_village)+", "+s(l.primary_home_ta)+", "+s(l.primary_home_district),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(c,null,{default:n(()=>[e(a,{color:"light"},{default:n(()=>[e(V,null,{default:n(()=>i[2]||(i[2]=[m("Potential Duplicates",-1)])),_:1,__:[2]})]),_:1}),e(_,null,{default:n(()=>[e($,null,{default:n(()=>[(v(!0),w(E,null,G(l.duplicates,r=>(v(),U(Q,{key:r.secondary_patient_id},{default:n(()=>[e(I,null,{default:n(()=>[e(A,{slot:"start",modelValue:r.selected,"onUpdate:modelValue":M=>r.selected=M},null,8,["modelValue","onUpdate:modelValue"]),e(u,null,{default:n(()=>[C("h2",null,s(r.secondary_given_name)+" "+s(r.secondary_family_name),1),e(B,{color:"primary"},{default:n(()=>[m("Match: "+s(r.match_percentage)+"%",1)]),_:2},1024),C("p",null,"ID: "+s(r.secondary_patient_id),1),C("p",null," Birth Date: "+s(r.secondary_birthdate)+" | Gender: "+s(r.secondary_gender),1),C("p",null," Address: "+s(r.secondary_home_village)+", "+s(r.secondary_home_ta)+", "+s(r.secondary_home_district),1)]),_:2},1024)]),_:2},1024),e(H,{side:"end"},{default:n(()=>[e(F,{color:"primary",onClick:M=>o.viewDetails(r)},{default:n(()=>i[3]||(i[3]=[m("View",-1)])),_:2,__:[3]},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(T,{expand:"block",onClick:r=>o.mergeSelected(l),disabled:!o.hasSelectedDuplicates(l),class:"ion-margin-top"},{default:n(()=>[e(f,{icon:o.linkOutline,slot:"start"},null,8,["icon"]),i[4]||(i[4]=m(" Merge Selected ",-1))]),_:2,__:[4]},1032,["onClick","disabled"])])):L("",!0)]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(R,{class:"sticky-footer"},{default:n(()=>[e(y,null,{default:n(()=>[e(p,{size:"12",style:{"max-width":"100%"}},{default:n(()=>[o.showNavBar?(v(),U(K,{key:0,totalItems:o.totalCount,currentPage:o.currentPage,itemsPerPage:o.itemsPer_Page,"onUpdate:pagination":o.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}const qe=Me(Ge,[["render",Ae],["__scopeId","data-v-4495dd33"]]);export{qe as default};

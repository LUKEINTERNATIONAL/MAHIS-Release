import{d as R,a as P,r as d,E as h,e as L,f as S,k as s,l as r,z as p,A as V,X as W,bY as Y,w as $,c4 as M,c7 as G,n as K,y as Q,m as Z,u as y,ao as tt,p as at,au as et}from"./vendor-DowD5zKn.js";import{x as k,B as X,y as q,S as F,n as E,k as st,t as J,_ as j,H as O,i as N,w as it,g as x,C as nt,A as T,T as ct}from"./index-53w8xEQj.js";import{u as ot}from"./StockStore-CAh7tGza.js";import{u as lt}from"./StartEndDate-4sEZHDYm.js";import{A as ut,a as _t}from"./AddVillage-AzXy9Nkc.js";import{v as rt}from"./group_validation-G-dyjwF5.js";import"./lodash-Dt8AsbQm.js";const pt={class:"pim-cls-1 modal_wrapper"},gt={class:"center text_12"},vt={class:"btnContent"},ft={class:"saveBtn"},mt=R({__name:"UpdateVillage",props:{villageData:Object},setup(A){P(async()=>{await b()});const c=A,b=async()=>{k(l.value,"Village","value",c.villageData.name)},g=()=>{W.dismiss()},u=async()=>{if(await rt(l.value)){const v=q(l.value,"Village","value"),n=await F.putJson("villages/".concat(c.villageData.village_id),{id:c.villageData.village_id,name:v,ta_id:c.villageData.traditional_authority_id});n&&(E().postData("UPDATE_RECORD",{storeName:"villages",data:n.data,whereClause:{village_id:c.villageData.village_id}}),st("Village updated successfully")),g()}else J("Please fill all the required field")},l=d([{data:{rowData:[{colData:[{inputHeader:"Village*",value:"",name:"Village",eventType:"input",alertsErrorMassage:"",validate:!1,required:!0}]}]}}]);return(v,n)=>{const _=h("ion-row"),f=h("ion-button");return S(),L("div",pt,[n[3]||(n[3]=s("div",{class:"OtherVitalsHeading"},[s("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add TA")],-1)),s("div",null,[s("div",gt,[r(_,null,{default:p(()=>[r(X,{contentData:l.value},null,8,["contentData"])]),_:1})])]),s("div",vt,[s("div",ft,[r(f,{class:"btnText",color:"danger",fill:"solid",onClick:n[0]||(n[0]=C=>g()),style:{"margin-right":"8px"}},{default:p(()=>n[1]||(n[1]=[V(" Cancel ")])),_:1,__:[1]}),r(f,{class:"btnText",fill:"solid",onClick:u},{default:p(()=>n[2]||(n[2]=[V(" Save ")])),_:1,__:[2]})])])])}}}),yt=j(mt,[["__scopeId","data-v-76d4cdfb"]]),ht={key:0,class:"spinner-overlay"},wt={class:"container"},bt={style:{"margin-top":"25px"}},Dt={class:"table-responsive"},Tt=R({__name:"ManageVillageModal",props:{taData:Object},setup(A){const c=ot(),b=E();lt();const g=Y(),u=d(null),l=d(!1);d("all"),d(O.sessionDate()),d(O.sessionDate());const v=A,n=d({responsive:!0,select:!1,processing:!0,serverSide:!0,pageLength:10,searching:!0,ajax:async function(e,i){var t,a;try{l.value=!0;let m={currentPage:Math.floor(e.start/e.length)+1,itemsPerPage:e.length,likeClause:"",whereClause:{traditional_authority_id:v.taData.traditional_authority_id}};(t=e.search)!=null&&t.value&&(m.likeClause={name:"%"+((a=e.search)==null?void 0:a.value)+"%"||""});const w=await T("villages",m),z=await Promise.all(w.records.map(async D=>({name:D.name,actions:'\n                            <button class="btn btn-sm btn-primary edit-btn" data-id=\''.concat(JSON.stringify(D),"'>Edit</button>\n                            <button class=\"btn btn-sm btn-danger delete-btn\" data-id='").concat(JSON.stringify(D),"'>Delete</button>\n                        ")})));i({draw:e.draw,recordsTotal:w.totalCount,recordsFiltered:w.totalCount,data:z})}catch(o){console.error("Error fetching data:",o),J("An error occurred while loading data."),i({draw:e.draw,recordsTotal:0,recordsFiltered:0,data:[]})}finally{l.value=!1}},columns:[{data:"name"},{data:"actions"}],language:{processing:"Loading...",emptyTable:"No data available",info:"Showing _START_ to _END_ of _TOTAL_ entries",infoEmpty:"Showing 0 to 0 of 0 entries",lengthMenu:"Show _MENU_ entries",loadingRecords:"Loading...",search:"Search:",zeroRecords:"No matching records found"}});function _(){W.dismiss("dismiss")}const f=(e=!0)=>{u.value.dt.ajax.reload(null,e)},C=async()=>{const e=JSON.parse(JSON.stringify(v.taData));await x(ut,{class:"fullScreenModal"},!0,{taData:e}),f(!1)},B=async(e,i)=>{await nt("Do you want to delete village ".concat(e.name," ?"),i)&&H(e)},H=async e=>{const i=await F.delete("villages/".concat(e.village_id),{id:e.village_id});(i==null?void 0:i.message)=="Village successfully deleted"&&await b.postData("DELETE_RECORD",{storeName:"villages",whereClause:{village_id:e.village_id}}),f(!1)};$(()=>c.stock,async()=>{const e=u.value.dt;e==null||e.ajax.reload()},{deep:!0}),$(()=>g,async()=>{const e=u.value.dt;e==null||e.ajax.reload()},{deep:!0});const I=async e=>{await x(yt,{class:"fullScreenModal"},!0,{villageData:e}),f(!1)},U=()=>{const e=u.value.dt;e.on("click",".edit-btn",i=>{const t=i.target.getAttribute("data-id");t&&I(JSON.parse(t))}),e.on("click",".delete-btn",i=>{const t=i.target.getAttribute("data-id");t&&B(JSON.parse(t),i)})};return P(()=>{M.use(G),K(()=>{U()})}),(e,i)=>{const t=h("ion-spinner"),a=h("ion-title"),o=h("ion-icon"),m=h("ion-header");return S(),Q(y(et),{class:at({loading:l.value})},{default:p(()=>[l.value?(S(),L("div",ht,[r(t,{name:"bubbles"}),i[2]||(i[2]=s("div",{class:"loading-text"},"Please wait...",-1))])):Z("",!0),r(m,{style:{display:"flex","justify-content":"space-between"}},{default:p(()=>[r(a,{class:"modalTitle"},{default:p(()=>i[3]||(i[3]=[V("Village Management")])),_:1,__:[3]}),r(o,{onClick:i[0]||(i[0]=w=>_()),style:{"padding-top":"10px","padding-right":"10px"},icon:y(N).cancel},null,8,["icon"])]),_:1}),r(y(tt),{style:{"--background":"#fff"}},{default:p(()=>[s("div",wt,[s("div",bt,[r(it,{style:{height:"45px"},name:" Add Village",size:"small",iconSlot:"start",icon:y(N).plusWhite,onClick:i[1]||(i[1]=w=>C())},null,8,["icon"])]),s("div",Dt,[r(y(M),{ref_key:"dataTableRef",ref:u,options:n.value,class:"display nowrap",width:"100%"},{default:p(()=>i[4]||(i[4]=[s("thead",null,[s("tr",null,[s("th",null,"Villages"),s("th",null,"Action")])],-1)])),_:1,__:[4]},8,["options"])])])]),_:1})]),_:1},8,["class"])}}}),At=j(Tt,[["__scopeId","data-v-bc5c8a47"]]),St={class:"pim-cls-1 modal_wrapper"},Ct={class:"center text_12"},xt={class:"btnContent"},Vt={class:"saveBtn"},Et=R({__name:"UpdateTA",props:{taData:Object},setup(A){P(async()=>{await b()});const c=A,b=async()=>{const v=await T("districts",{whereClause:{district_id:c.taData.district_id}});k(l.value,"TA_district","multiSelectData",await T("districts")),k(l.value,"TA_district","value",v[0]),k(l.value,"TA","value",c.taData.name)},g=()=>{W.dismiss()},u=async()=>{if(await rt(l.value)){const v=q(l.value,"TA","value"),n=q(l.value,"TA_district","value").district_id,_=await F.putJson("traditional_authorities/".concat(c.taData.traditional_authority_id),{id:c.taData.traditional_authority_id,name:v,district_id:n});_&&(E().postData("UPDATE_RECORD",{storeName:"TAs",data:_.data,whereClause:{traditional_authority_id:c.taData.traditional_authority_id}}),st("TA updated successfully")),g()}else J("Please fill all the required field")},l=d([{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"District*",icon:N.search,value:"",name:"TA_district",setName:"TALocation",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,popOver:!0,trackBy:"district_id",multiSelectData:[],id:"",idName:"district_id",validationFunctionName:"required"}]}]}},{data:{rowData:[{colData:[{inputHeader:"TA*",value:"",name:"TA",eventType:"input",alertsErrorMassage:"",validationFunctionName:"required"}]}]}}]);return(v,n)=>{const _=h("ion-row"),f=h("ion-button");return S(),L("div",St,[n[3]||(n[3]=s("div",{class:"OtherVitalsHeading"},[s("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add TA")],-1)),s("div",null,[s("div",Ct,[r(_,null,{default:p(()=>[r(X,{contentData:l.value},null,8,["contentData"])]),_:1})])]),s("div",xt,[s("div",Vt,[r(f,{class:"btnText",color:"danger",fill:"solid",onClick:n[0]||(n[0]=C=>g()),style:{"margin-right":"8px"}},{default:p(()=>n[1]||(n[1]=[V(" Cancel ")])),_:1,__:[1]}),r(f,{class:"btnText",fill:"solid",onClick:u},{default:p(()=>n[2]||(n[2]=[V(" Save ")])),_:1,__:[2]})])])])}}}),Nt=j(Et,[["__scopeId","data-v-ffada563"]]),kt={key:0,class:"spinner-overlay"},$t={class:"container"},Mt={style:{display:"flex","justify-content":"space-between"}},Ot={style:{width:"50%","max-width":"350px"}},Rt={style:{"margin-top":"25px"}},Pt={class:"table-responsive"},Lt=R({__name:"LocationsManagement",setup(A){const c=ot();lt();const b=Y(),g=d(null),u=d(!1);d("all"),d(O.sessionDate()),d(O.sessionDate());const l=d(""),v=d([]),n=async t=>Promise.all(t.map(async a=>{const o=await T("districts",{whereClause:{district_id:a.district_id}}),m=await T("villages",{whereClause:{traditional_authority_id:a.traditional_authority_id}});return{ta_id:a.traditional_authority_id,name:a.name,district:o[0].name,villages:'<button class="btn btn-sm btn-primary view-btn" data-id=\''.concat(JSON.stringify(a),"'> View ").concat(m.length,"   </button>"),actions:'\n                    <button class="btn btn-sm btn-primary edit-btn" data-id=\''.concat(JSON.stringify(a),"'>Edit</button>\n                    <button class=\"btn btn-sm btn-danger delete-btn\" data-id='").concat(JSON.stringify(a),"'>Delete</button>\n                ")}})),_=(t=!0)=>{g.value.dt.ajax.reload(null,t)},f=d({responsive:!0,select:!1,processing:!0,serverSide:!0,pageLength:10,searching:!0,ajax:async function(t,a){var o,m;try{u.value=!0;let z={currentPage:Math.floor(t.start/t.length)+1,itemsPerPage:t.length,likeClause:(o=t.search)!=null&&o.value?{name:"%"+((m=t.search)==null?void 0:m.value)+"%"}:"",whereClause:l.value?{district_id:l.value}:""};const D=await T("TAs",z),dt=await n(D.records);a({draw:t.draw,recordsTotal:D.totalCount,recordsFiltered:D.totalCount,data:dt})}catch(w){console.error("Error fetching data:",w),J("An error occurred while loading data."),a({draw:t.draw,recordsTotal:0,recordsFiltered:0,data:[]})}finally{u.value=!1}},columns:[{data:"ta_id"},{data:"name"},{data:"district"},{data:"villages"},{data:"actions"}],language:{processing:"Loading...",emptyTable:"No data available",info:"Showing _START_ to _END_ of _TOTAL_ entries",infoEmpty:"Showing 0 to 0 of 0 entries",lengthMenu:"Show _MENU_ entries",loadingRecords:"Loading...",search:"Search:",zeroRecords:"No matching records found"}}),C=async t=>{await x(At,{class:"fullScreenModal"},!0,{taData:t})==="dismiss"&&_(!1)},B=async t=>{var a;l.value=(a=t==null?void 0:t.value)==null?void 0:a.district_id,_()},H=async(t,a)=>{const o=JSON.parse(t);await nt("Do you want to delete TA ".concat(o.name," ?"),a)&&I(o)},I=async t=>{const a=await F.delete("traditional_authorities/".concat(t.traditional_authority_id),{id:t.traditional_authority_id});(a==null?void 0:a.message)=="Traditional Authority and associated villages successfully deleted"&&(E().postData("DELETE_RECORD",{storeName:"TAs",whereClause:{traditional_authority_id:t.traditional_authority_id}}),E().postData("DELETE_RECORD",{storeName:"villages",whereClause:{traditional_authority_id:t.traditional_authority_id}})),_(!1)},U=async()=>{await x(_t,{class:"otherVitalsModal"}),_(!1)},e=async t=>{await x(Nt,{class:"otherVitalsModal"},!0,{taData:t}),_(!1)};$(()=>c.stock,async()=>{const t=g.value.dt;t==null||t.ajax.reload()},{deep:!0}),$(()=>b,async t=>{if(t.name=="LocationsManagement"){const a=g.value.dt;a==null||a.ajax.reload()}},{deep:!0});const i=()=>{const t=g.value.dt;t.on("click",".edit-btn",a=>{const o=a.target.getAttribute("data-id");o&&e(JSON.parse(o))}),t.on("click",".delete-btn",a=>{const o=a.target.getAttribute("data-id");o&&H(o,a)}),t.on("click",".view-btn",a=>{const o=a.target.getAttribute("data-id");o&&C(JSON.parse(o))})};return P(async()=>{v.value=[{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"Filter by districts",popOver:!0,icon:N.search,value:"",name:"filter_district",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,trackBy:"district_id",multiSelectData:await T("districts"),id:"",idName:"district_id"}]}]}}],M.use(G),K(()=>{i()})}),(t,a)=>{const o=h("ion-spinner");return S(),Q(y(et),{class:at({loading:u.value})},{default:p(()=>[u.value?(S(),L("div",kt,[r(o,{name:"bubbles"}),a[1]||(a[1]=s("div",{class:"loading-text"},"Please wait...",-1))])):Z("",!0),r(ct),r(y(tt),null,{default:p(()=>[s("div",$t,[a[3]||(a[3]=s("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"TA Management",-1)),s("div",Mt,[s("div",Ot,[r(X,{contentData:v.value,"onUpdate:inputValue":B},null,8,["contentData"])]),s("div",Rt,[r(it,{style:{height:"45px"},name:" Add TA",size:"small",iconSlot:"start",icon:y(N).plusWhite,onClick:a[0]||(a[0]=m=>U())},null,8,["icon"])])]),s("div",Pt,[r(y(M),{ref_key:"dataTableRef",ref:g,options:f.value,class:"display nowrap",width:"100%"},{default:p(()=>a[2]||(a[2]=[s("thead",null,[s("tr",null,[s("th",null,"ID"),s("th",null,"TA"),s("th",null,"District"),s("th",null,"Villages"),s("th",null,"Action")])],-1)])),_:1,__:[2]},8,["options"])])])]),_:1})]),_:1},8,["class"])}}}),zt=j(Lt,[["__scopeId","data-v-51d9b423"]]);export{zt as default};

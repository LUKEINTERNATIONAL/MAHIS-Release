!function(){function e(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}System.register(["./vendor-legacy-Bsps4SCm.js","../index-legacy-Dy33dl04.js","./Img-legacy-BNmikZ_d.js","./userService-legacy-DCU_soC6.js","./useNetworkConfig-legacy-BnhxyayJ.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-DDz6mLj4.js"],function(t,a){"use strict";var n,l,o,i,r,s,u,c,d,f,p,v,g,m,w,h,y,b,P,x,k,A,_,I,S,C,z,M,U,E,N,q,L,j,R,D,F,H,O,$,T,K,B,G,J,Q,W,Y,Z,V,X,ee,te;return{setters:[e=>{n=e.D,l=e.d,o=e.r,i=e.ao,r=e.c,s=e.a,u=e.H,c=e.O,d=e.f,f=e.J,p=e.l,v=e.u,g=e.a3,m=e.k,w=e.bq,h=e.aU,y=e.e,b=e.m,P=e.dn,x=e.E,k=e.Q,A=e.K,_=e.b2,I=e.W,S=e.c$,C=e.bF,z=e.c6,M=e.c5,U=e.N,E=e.bs,N=e.p,q=e.a6},e=>{L=e.a1,j=e.y,R=e.G,D=e.S,F=e.v,H=e.a0,O=e.a2,$=e.t,T=e.U,K=e.a3,B=e.s,G=e.a4,J=e.a5,Q=e.a6,W=e.a,Y=e.a7,Z=e._},e=>{V=e.i},e=>{X=e.p,ee=e.g},e=>{te=e.u},null,null],execute:function(){var a=document.createElement("style");a.textContent='.login-page[data-v-414576a7]{background-color:#fff}.login-container[data-v-414576a7]{display:flex;justify-content:center;align-items:center;text-align:center;height:90vh}.login-title[data-v-414576a7]{font-size:24px;margin-bottom:30px;font-weight:700;margin-top:20px}.input-fields[data-v-414576a7]{margin-bottom:35px}.invalid-input[data-v-414576a7]{--border-color: #ff4444 !important;--color: #ff4444 !important}.password-requirements[data-v-414576a7]{text-align:left;margin-bottom:20px;padding:15px;background-color:#f8f9fa;border-radius:8px;border-left:4px solid #34af4d}.requirements-title[data-v-414576a7]{margin:0 0 10px;font-weight:600;color:#333;font-size:14px}.requirements-list[data-v-414576a7]{margin:0;padding-left:20px;list-style:none}.requirements-list li[data-v-414576a7]{margin-bottom:5px;font-size:13px;color:#666;position:relative}.requirements-list li[data-v-414576a7]:before{content:"✗";color:#f44;font-weight:700;position:absolute;left:-20px}.requirements-list li.valid[data-v-414576a7]:before{content:"✓";color:#34af4d}.requirements-list li.valid[data-v-414576a7]{color:#34af4d}.password-toggle[data-v-414576a7]{cursor:pointer;position:absolute;margin-top:-73px;margin-left:130px;z-index:1000}.login-button[data-v-414576a7]{color:#fff;margin-top:30px}.login-button[data-v-414576a7]:disabled{opacity:.5;cursor:not-allowed}.signup-link[data-v-414576a7]{margin-top:50px}.signup-link a[data-v-414576a7]{text-decoration:underline;color:#34af4d;cursor:pointer}.signup-link a[data-v-414576a7]:hover{color:#2d8f3f}.password-toggle[data-v-414576a7]{font-size:20px}.login_img[data-v-414576a7]{width:90px;margin:auto}ion-card[data-v-414576a7]{min-width:330px}@media(max-width:902px){.login-page[data-v-414576a7]{--ion-background-color: #ffffff}ion-card[data-v-414576a7]{box-shadow:unset}}\n/*$vite$:1*/',document.head.appendChild(a);const ae=n("authStatusStore",{state:()=>({emrAuthenticated:!1,miumAuthenticated:!1,lastLoginAttempt:null,loginTimestamp:null,username:""}),getters:{isPartiallyAuthenticated:e=>e.emrAuthenticated||e.miumAuthenticated,isFullyAuthenticated:e=>e.emrAuthenticated&&e.miumAuthenticated,authenticationStatus:e=>e.emrAuthenticated&&e.miumAuthenticated?"full":e.emrAuthenticated||e.miumAuthenticated?"partial":"none",authenticatedSystems:e=>{const t=[];return e.emrAuthenticated&&t.push("EMR"),e.miumAuthenticated&&t.push("MIUM"),t},failedSystems:e=>{const t=[];return e.emrAuthenticated||t.push("EMR"),e.miumAuthenticated||t.push("MIUM"),t}},actions:{setEMRAuthenticated(e){this.emrAuthenticated=e,e&&(this.loginTimestamp=new Date)},setMIUMAuthenticated(e){this.miumAuthenticated=e},setUsername(e){this.username=e},recordLoginAttempt(){this.lastLoginAttempt=new Date},clearAuthStatus(){this.emrAuthenticated=!1,this.miumAuthenticated=!1,this.loginTimestamp=null,this.lastLoginAttempt=null,this.username=""},hasSystemAccess(e){return"EMR"===e?this.emrAuthenticated:this.miumAuthenticated}},persist:!0});class ne{static async initialize(){if(this.initialized)return!0;try{const e=te(),t=L();j();if(t.isConfigured)return console.log("Network configuration already in store"),this.initialized=!0,!0;if(t.loadFromLocalStorage())return console.log("Network configuration loaded from localStorage to store"),this.initialized=!0,!0;console.log("No local config found, attempting auto-discovery...");const a=await e.autoDiscoverConfig();return a.success&&a.config?(console.log(`Network configuration loaded from ${a.source}`),this.applyConfiguration(a.config),"global_property"===a.source&&R("Network settings loaded automatically from facility configuration",4e3),this.initialized=!0,!0):(console.log("No facility network configuration found, user needs to configure manually"),this.initialized=!0,!1)}catch(e){return console.error("Error during network auto-configuration:",e),this.initialized=!0,!1}}static applyConfiguration(e){L().setConfig({couchdbUsername:e.couchdbUsername,couchdbPassword:e.couchdbPassword,couchdbHost:e.couchdbHost,couchdbPort:e.couchdbPort||"",couchdbProtocol:e.couchdbProtocol,locationId:e.locationId||D.getUserLocationId(),facilityName:e.facilityName||"",configuredBy:e.configuredBy||"",configuredAt:e.configuredAt||(new Date).toISOString(),configSource:"global_property"}),console.log("Network configuration applied to store and localStorage")}static reset(){this.initialized=!1}static isInitialized(){return this.initialized}static async forceRefresh(){return this.reset(),await this.initialize()}static clearConfiguration(){L().clearConfig(),this.reset(),console.log("Network configuration cleared")}}e(ne,"initialized",!1);const le={class:"login-container"},oe={key:0,style:{"justify-content":"center",display:"block"}},ie={style:{"font-size":"15px"}},re={style:{"font-size":"12px",color:"#34af4d"}},se={key:1},ue={style:{"font-size":"15px"}},ce={key:0},de={style:{"text-align":"left"}},fe={class:"signup-link"},pe={style:{display:"flex","justify-content":"center","align-items":"center"}},ve={key:1},ge={style:{"text-align":"left"}},me={key:0,class:"password-requirements"},we={class:"requirements-list"},he={class:"signup-link"};t("default",Z(l({__name:"Login",setup(e){const t=o(""),a=o(""),n=o(""),l=o(!1),L=o(!1),Z=o("test"),te=o(new Y),ye=o({username:"",currentPassword:"",newPassword:"",confirmPassword:""}),be=o(!1),Pe=o(!1),xe=o(!1),ke=i(),Ae=F(),_e=H(),Ie=j(),Se=r(()=>""!==ye.value.username.trim()&&""!==ye.value.currentPassword.trim()&&""!==ye.value.newPassword.trim()&&""!==ye.value.confirmPassword.trim()&&O(ye.value.newPassword)&&ye.value.newPassword===ye.value.confirmPassword&&ye.value.newPassword!==ye.value.currentPassword),Ce=()=>{L.value=!L.value,L.value&&(ye.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""})},ze=()=>{$("Help functionality to be implemented")},Me=async()=>{if(!Se.value)return $("Please complete all fields correctly"),void $("Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character.");try{const e=await te.value.requestLogin(ye.value.currentPassword,ye.value.username);if(e){const{authorization:t}=e,{token:a,user:n}=t;n&&(localStorage.setItem("apiKey",a),await T.updateUser(n.user_id,{password:ye.value.newPassword}),R("Password changed successfully!"),await te.value.requestLogin(ye.value.newPassword,ye.value.username),ye.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""},L.value=!1,localStorage.setItem("apiKey",""))}}catch(e){B(e instanceof K?"Current password is incorrect":`Error changing password: ${e}`)}},Ue=async()=>{const e=ae();if(!t.value||!a.value)return{success:!1,error:null,validationError:!0};te.value.setUsername(t.value),e.setUsername(t.value);try{return await te.value.login(a.value),await(async()=>{const e=H(),t=await ee();t&&(e.setUserFacilityName(t.name),e.setFacilityLocation(t),localStorage.setItem("facility_code",t.code))})(),await(async()=>{const e=await te.value.checkUserPrograms(void 0);null!=e&&e.programs&&W().setAuthorizedPrograms(null==e?void 0:e.programs)})(),await Q(),await X(),e.setEMRAuthenticated(!0),_e.setLoginStatus(!0),{success:!0,error:null}}catch(n){return e.setEMRAuthenticated(!1),_e.setLoginStatus(!1),{success:!1,error:n}}},Ee=async()=>{if(D.getLanConnectionStatus()||D.getPouchDbStatus())return{success:!0,error:null};const e=ae();if(!t.value||!a.value)return{success:!1,error:null,validationError:!0};te.value.setUsername(t.value);try{return await te.value.loginToMIUM(a.value),e.setMIUMAuthenticated(!0),{success:!0,error:null}}catch(n){return e.setMIUMAuthenticated(!1),{success:!1,error:n}}},Ne=async()=>{const e=ae();if(!t.value||!a.value)return void $("Complete form to log in");e.recordLoginAttempt();const[n,l]=await Promise.allSettled([Ue(),Ee()]),o="fulfilled"===n.status&&n.value.success,i="fulfilled"===l.status&&l.value.success;if(o)await(async()=>{try{await Ie.loadGlobalProperty(),await ne.initialize()?console.log("Network auto-configuration completed successfully"):console.log("No facility network configuration found, user will need to configure manually")}catch(e){console.error("Error during post-login initialization:",e)}})(),ke.push("/home");else if(o||i)!o&&i&&("fulfilled"===n.status?n.value.error:n.reason);else{const e="fulfilled"===n.status?n.value.error:n.reason;e instanceof K?B("Invalid username or password"):e instanceof G?(Ce(),B("Please change your password",5e4)):e instanceof J?(Ce(),B("Your password has expired. Please change your password",5e4)):B(`${e}`,5e4)}};return s(async()=>{_e.checkLoginStatus()&&ke.push("/home"),_e.setLoginStatus(!1),await te.value.loadConfig(),n.value=localStorage.getItem("core_version")||"",await(async()=>{Ae.terminate(),await F().postData("SET_OFFLINE_PROGRAMS")})()}),(e,o)=>{const i=u("ion-icon");return d(),c(v(q),null,{default:f(()=>[p(v(g),{class:"ion-padding login-page"},{default:f(()=>[m("div",le,[p(v(w),{style:{"background-color":"#fff"}},{default:f(()=>[p(v(h),null,{default:f(()=>[p(v(P),{class:"login_img",src:v(V)("mw.png"),id:"logo"},null,8,["src"]),p(v(x),{class:"login-title"},{default:f(()=>["development"===Z.value||"test"===Z.value?(d(),y("span",oe,[m("div",null,[o[11]||(o[11]=k(" MaHIS ",-1)),m("small",ie,"(v"+A(n.value)+")",1)]),m("div",re,"("+A(Z.value)+")",1)])):(d(),y("span",se,[o[12]||(o[12]=k(" MaHIS ",-1)),m("small",ue,"(v"+A(n.value)+")",1)]))]),_:1}),L.value?b("",!0):(d(),y("div",ce,[m("span",de,[p(v(_),{value:t.value,onIonInput:o[0]||(o[0]=e=>t.value=e.target.value||""),type:"text",label:"Username",ref:"usernameRef","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:f(()=>[p(v(I),{slot:"end"},{default:f(()=>[p(i,{icon:v(S)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),p(v(_),{value:a.value,onIonInput:o[2]||(o[2]=e=>a.value=e.target.value||""),type:l.value?"text":"password",label:"Password",ref:"passwordRef","label-placement":"floating",fill:"outline",placeholder:"Enter Password",class:"input-fields",required:"",onKeydown:C(Ne,["enter"])},{default:f(()=>[p(v(I),{slot:"end"},{default:f(()=>[p(i,{icon:l.value?v(z):v(M),onClick:o[1]||(o[1]=e=>l.value=!l.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"])]),p(v(U),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:Ne,class:"login-button"},{default:f(()=>[...o[13]||(o[13]=[k(" Login ",-1)])]),_:1}),m("p",fe,[o[17]||(o[17]=k(" For help click ",-1)),m("a",{href:"#",onClick:E(ze,["prevent"])},"Here"),o[18]||(o[18]=k()),o[19]||(o[19]=m("br",null,null,-1)),m("div",pe,[p(v(U),{fill:"clear",size:"small",onClick:Ce,style:{display:"inline","--padding-start":"2px","--padding-end":"2px"}},{default:f(()=>[...o[14]||(o[14]=[m("span",{style:{"text-decoration":"underline",color:"#34af4d",cursor:"pointer"}}," Change Password ",-1)])]),_:1}),o[16]||(o[16]=k(" | ",-1)),p(v(U),{fill:"clear",size:"small",onClick:o[3]||(o[3]=e=>{return t="/downloads",void ke.push(t);var t}),style:{display:"inline","--padding-start":"2px","--padding-end":"2px"}},{default:f(()=>[...o[15]||(o[15]=[m("span",{style:{"text-decoration":"underline",color:"#34af4d",cursor:"pointer"}}," Download MaHIS ",-1)])]),_:1})])])])),L.value?(d(),y("div",ve,[o[22]||(o[22]=m("h3",{style:{"text-align":"center","margin-bottom":"20px",color:"#34af4d"}},"Change Password",-1)),m("span",ge,[p(v(_),{value:ye.value.username,onIonInput:o[4]||(o[4]=e=>ye.value.username=e.target.value||""),type:"text",label:"Username","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:f(()=>[p(v(I),{slot:"end"},{default:f(()=>[p(i,{icon:v(S)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),p(v(_),{value:ye.value.currentPassword,onIonInput:o[6]||(o[6]=e=>ye.value.currentPassword=e.target.value||""),type:be.value?"text":"password",label:"Current Password","label-placement":"floating",fill:"outline",placeholder:"Enter Current Password",class:"input-fields",required:""},{default:f(()=>[p(v(I),{slot:"end"},{default:f(()=>[p(i,{icon:be.value?v(z):v(M),onClick:o[5]||(o[5]=e=>be.value=!be.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"]),p(v(_),{value:ye.value.newPassword,onIonInput:o[8]||(o[8]=e=>ye.value.newPassword=e.target.value||""),type:Pe.value?"text":"password",label:"New Password","label-placement":"floating",fill:"outline",placeholder:"Enter New Password",class:N(["input-fields",{"invalid-input":ye.value.newPassword&&!v(O)(ye.value.newPassword)}]),required:""},{default:f(()=>[p(v(I),{slot:"end"},{default:f(()=>[p(i,{icon:Pe.value?v(z):v(M),onClick:o[7]||(o[7]=e=>Pe.value=!Pe.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"]),p(v(_),{value:ye.value.confirmPassword,onIonInput:o[10]||(o[10]=e=>ye.value.confirmPassword=e.target.value||""),type:xe.value?"text":"password",label:"Confirm New Password","label-placement":"floating",fill:"outline",placeholder:"Confirm New Password",class:N(["input-fields",{"invalid-input":ye.value.confirmPassword&&ye.value.newPassword!==ye.value.confirmPassword}]),required:""},{default:f(()=>[p(v(I),{slot:"end"},{default:f(()=>[p(i,{icon:xe.value?v(z):v(M),onClick:o[9]||(o[9]=e=>xe.value=!xe.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"])]),ye.value.newPassword?(d(),y("div",me,[o[20]||(o[20]=m("p",{class:"requirements-title"},"Password Requirements:",-1)),m("ul",we,[m("li",{class:N({valid:ye.value.newPassword.length>=8})},"At least 8 characters",2),m("li",{class:N({valid:/[A-Z]/.test(ye.value.newPassword)})},"One uppercase letter",2),m("li",{class:N({valid:/[0-9]/.test(ye.value.newPassword)})},"One number",2),m("li",{class:N({valid:/[@#$%^&+=*!-]/.test(ye.value.newPassword)})}," One special character (@#$%^&+=*!-) ",2),m("li",{class:N({valid:ye.value.newPassword!==ye.value.currentPassword&&""!==ye.value.currentPassword})}," Different from current password ",2)])])):b("",!0),p(v(U),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:Me,class:"login-button",disabled:!Se.value},{default:f(()=>[...o[21]||(o[21]=[k(" Change Password ",-1)])]),_:1},8,["disabled"]),m("p",he,[m("a",{href:"#",onClick:E(Ce,["prevent"])},"Back to Login")])])):b("",!0)]),_:1})]),_:1})])]),_:1})]),_:1})}}}),[["__scopeId","data-v-414576a7"]]))}}})}();

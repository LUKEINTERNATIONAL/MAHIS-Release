var O=Object.defineProperty;var V=(r,l,t)=>l in r?O(r,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[l]=t;var m=(r,l,t)=>V(r,typeof l!="symbol"?l+"":l,t);import{d as H,r as f,aF as z,bh as A,a as J,G as K,e as W,f as q,F as G,l as s,u as a,K as U,H as o,ay as S,az as y,k as u,I as $,b8 as R,P as B,J as j,L as Y,b9 as Q,bE as X,M as Z}from"./vendor-CJ2tyHrn.js";import{aY as x,O as g,u as ee,n as w,C as te,S as L,g as se,aq as ae,bq as k,G as ne,_ as oe}from"../index-CPIhguZJ.js";class le extends x{constructor(t){super(t,32);m(this,"patientID");m(this,"testTypeID");m(this,"resultDate");m(this,"testID");this.patientID=t,this.testTypeID=-1,this.resultDate="",this.testID=-1}createLabResult(t){return x.postJson("lab/tests/".concat(this.testID,"/results"),{encounter_id:this.encounterID,date:this.resultDate,measures:t})}getTestID(){return this.testID}getTestTypeID(){return this.testTypeID}setTestTypeID(t){this.testTypeID=t}setResultDate(t){this.resultDate=t}setTestID(t){this.testID=t}getTestsWithoutResults(){return g.getOrders(this.patientID,{status:"drawn"})}getTestIndicators(){return g.getJson("lab/test_result_indicators",{test_type_id:this.testTypeID})}static getTestIndicatorsWithID(t){return g.getJson("lab/test_result_indicators",{test_type_id:t})}}const ie={style:{display:"flex","align-items":"center"}},re={style:{"margin-left":"6px"}},de={style:{"font-weight":"400","font-size":"19px"}},ue={style:{display:"flex","align-items":"center"}},ce={style:{"font-weight":"400","font-size":"20px"}},me={style:{display:"flex","align-items":"center"}},pe=H({__name:"EnterLabResultsModal",props:{keyboardClose:{type:Boolean,default:!1},keepContentsMounted:{type:Boolean,default:!1},content:{default:()=>({})},popoverOpen:{type:Boolean,default:!1},event:{default:""},title:{default:""},test_data:{}},emits:["closePopoover","closeModal","saved"],setup(r,{emit:l}){var h,b;const t=r;let I=f([]);z();const F=ee(),{patient:P}=A(F),D=f(null),_=f(((h=t.test_data)==null?void 0:h.tests[0])||{}),N=f(((b=_.value)==null?void 0:b.name)||""),v=()=>{Z.dismiss()},E=async c=>{let n;L.getPouchDbStatus()||L.getLanConnectionStatus()?n=await se("test_result_indicators",{selector:{concept_id:c.concept_id}}):n=await le.getTestIndicatorsWithID(c.concept_id),n.forEach(e=>{let d={componentType:"inputField",name:e.name,header:e.name,grid:{s:"3"}};if((e.name=="RBS"||e.name=="FBS")&&(d={...d,unit:"mg/dl"}),e.name=="MRDT"||e.name=="Tuberculosis program"||e.name=="Vdrl"||e.name=="Hepatitis B"||e.name=="Lam"||e.name=="CrAg"||e.name=="CD4 count"||e.name=="Leukocytes"||e.name=="Protein"||e.name=="Nitrite"||e.name=="Urine Ketones"||e.name=="HIV test"){let i=[];(e.name=="MRDT"||e.name=="Vdrl"||e.name=="Hepatitis B"||e.name=="CrAg"||e.name=="Lam")&&(i=[{id:"1",name:"Positive"},{id:"2",name:"Negative"},{id:"3",name:"Invalid"}]),e.name=="Tuberculosis program"&&(i=[{id:"1",name:"Scanty"},{id:"2",name:"Negative"},{id:"3",name:"1+"},{id:"4",name:"2+"},{id:"5",name:"3+"}]),e.name=="CD4 count"&&(i=[{id:"1",name:"below reference line"},{id:"2",name:"above reference line"}]),(e.name=="Leukocytes"||e.name=="Protein"||e.name=="Nitrite"||e.name=="Ketones"||e.name=="Urine Ketones")&&(i=[{id:"2",name:"Negative"},{id:"1",name:"Trace"},{id:"3",name:"1+"},{id:"4",name:"2+"},{id:"5",name:"3+"},{id:"6",name:"4+"}]),e.name=="HIV test"&&(i=[{id:"2",name:"Positive"},{id:"1",name:"Negative"},{id:"3",name:"Invalid"}]),d={componentType:"multiSelectInputField",header:e.name,name:e.name,trackBy:"id",icon:w.search,options:i}}I.value.push(d)})},M=async()=>{var d,i,T;const c=(d=D.value)==null?void 0:d.getFormValues(),n=await Promise.all(Object.entries(c).map(async([C,p])=>({name:C,concept_id:await ae.getConceptID(C,!0),value:(p==null?void 0:p.name)||p}))),e=await k.buildResults(n);await k.saveResults(P.value,e,(i=_.value)==null?void 0:i.id,(T=t.test_data)==null?void 0:T.offline_id),ne("Lab results saved successfully"),v()};return J(async()=>{await E(_.value)}),(c,n)=>{const e=K("ion-icon");return q(),W(G,null,[s(a(U),null,{default:o(()=>[s(a(S),null,{default:o(()=>[s(a(y),null,{default:o(()=>[u("div",ie,[s(e,{icon:a(w).saveWhite,class:"sub-menu-icon",style:{"font-size":"1.6rem"}},null,8,["icon"]),u("b",re,"Enter lab results for "+$(N.value),1)])]),_:1}),s(a(R),{slot:"end"},{default:o(()=>[s(a(y),null,{default:o(()=>[s(a(B),{onClick:n[0]||(n[0]=d=>v()),fill:"solid"},{default:o(()=>[u("span",de,[u("div",ue,[s(e,{icon:a(j),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),n[1]||(n[1]=u("span",{style:{"margin-left":"6px"}},"Close",-1))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(a(Y),{class:"ion-padding"},{default:o(()=>[s(te,{formData:a(I),ref_key:"formRef",ref:D},null,8,["formData"])]),_:1}),s(a(Q),null,{default:o(()=>[s(a(S),null,{default:o(()=>[s(a(R),{slot:"end"},{default:o(()=>[s(a(y),null,{default:o(()=>[s(a(B),{onClick:M,color:"primary",fill:"solid"},{default:o(()=>[u("span",ce,[u("div",me,[s(e,{icon:a(X),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),n[2]||(n[2]=u("span",{style:{"margin-left":"6px"}},"Save",-1))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})],64)}}}),ge=oe(pe,[["__scopeId","data-v-9a2f68e9"]]);export{ge as E};

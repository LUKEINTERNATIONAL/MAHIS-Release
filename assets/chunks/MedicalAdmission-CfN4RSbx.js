import{d as Ie,ao as Re,cp as Me,r as S,c as Ae,aV as D,w as f,a as Te,H as g,O as U,f as j,J as B,l as o,u as w,a3 as ke,k as r,m as Fe,i as v,bM as Be,v as d,a6 as Ne,b9 as _}from"./vendor-BolvhNQv.js";import{aI as G,u as Ee,aJ as Ve,aK as Le,aL as $e,aM as ze,d as We,aN as Ue,g as je,$ as Ge,e as Je,T as Ke,J as Qe,N as qe,H as N,aO as C,aP as Xe,aQ as J,aR as Ye,t as K,aT as x,G as Ze,aU as Oe,a1 as et,S as tt}from"../index-BOg8gPmV.js";import{D as at}from"./DemographicBar-k5auJVs7.js";import{u as st,_ as nt,s as it,c as ot,a as lt}from"./nonPharmaTherapyStore-Ca5ihT7Z.js";import{u as E}from"./ComplicationsStore-CNie8nQr.js";import{l as rt}from"./lodash-NJiRuGo9.js";import{a as Q,b as ct}from"./formatServerData-CNbKo3Xr.js";import{u as ut}from"./usePatientProfile-CTNLwVc_.js";import"./apexcharts-Go-aTq24.js";import"./drug_prescription_service-CtSNlkd9.js";import"./patient_diagnosis_service-CN3oxQGJ.js";import"./Registration-D8rgBDan.js";import"./useLocation-sOL6C9o2.js";import"./vaccines_service-Vtpnf427.js";import"./sms_service-Bgob-zBe.js";import"./EIRreportsStore-hgF2UhSl.js";import"./Export-WoHD7StR.js";import"./user_role_management-BwcDZMKD.js";import"./useNeonatalEnrollmentStore-DndLv6lC.js";import"./enrollment-DU-PLRUa.js";import"./Outcome-DXwFLWGB.js";const mt={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},gt={class:"back_profile"},Nt=Ie({__name:"MedicalAdmission",setup(vt,{expose:q}){const{onTabBeforeChange:X,currentTabIndex:y}=st();ut();const I=Re(),Y=Me();S([]),S([]),S(!1);const R=S(!0),M=S(!1),h=S(!1),V=Ae(()=>({text:h.value?"Saving...":"Finish",icon:h.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:M.value||h.value})),Z=G(),O=Ee(),ee=Ve(),te=Le();$e();const ae=ze(),A=We();Ue();const se=je(),ne=E(),ie=Ge(),{patient:l}=D(O),{vitals:oe}=D(Z),{investigations:le}=D(ee),{diagnosis:re}=D(te),{substance:ce}=D(se),{selectedNCDMedicationList:L}=D(ae),{FootScreening:ue,visualScreening:me,cvScreening:ge}=D(ne),{sessionDate:$}=D(ie),{apiStatus:dt}=D(Je());f(V,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:y.value,tabsLength:n.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),f(h,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const ve=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},P=()=>{let e=!1;return u(),h.value&&(e=!0),M.value=e,!e},de=()=>{I.push("/patientProfile")},T=()=>[{title:"Presenting Complaints",icon:""},{title:"Drug History",icon:""},{title:"Past Medical History",icon:""},{title:"Past Surgical History",icon:""},{title:"Allergy",icon:""},{title:"Intoxication",icon:""},{title:"Social History",icon:""},{title:"Family History",icon:""},{title:"Review of Systems",icon:""},{title:"Physical Examination",icon:""},{title:"Summary",icon:""},{title:"Differential Diagnosis",icon:""},{title:"Investigation",icon:""},{title:"Management Plan",icon:""}],n=S(T()),fe=S(null),ye=S(null),u=()=>{var s;if(!n.value||n.value.length===0)return console.log("Tabs not yet initialized"),null;const e=y.value>=0&&y.value<n.value.length?y.value:0;switch((s=n.value[e])==null?void 0:s.title){case"Presenting Complaints":return"Presenting Complaints";case"Drug History":return"DrugHistory";case"Past Medical History":return"PastMedicalHistory";case"Past Surgical History":return"PastSurgicalHistory";case"Allergy":return"Allergy";case"Intoxication":return"Intoxication";case"Social History":return"SocialHistory";case"Family History":return"FamilyHistory";case"Review of Systems":return"ReviewOfSystems";case"Physical Examination":return"PhysicalExamination";case"Summary":return"Summary";case"Differential Diagnosis":return"DifferentialDiagnosis";case"Investigation":return"Investigation";case"Management Plan":return"ManagementPlan";default:if(A.NCDActivities.length>0)switch(A.NCDActivities[0]){case"Presenting Complaints":return"PresentingComplaints";case"Drug History":return"DrugHistory";case"Past Medical History":return"PastMedicalHistory";case"Past Surgical History":return"PastSurgicalHistory";case"Allergy":return"Allergy";case"Intoxication":return"Intoxication";case"Social History":return"SocialHistory";case"Family History":return"FamilyHistory";case"Review of Systems":return"ReviewOfSystems";case"Physical Examination":return"PhysicalExamination";case"Summary":return"Summary";case"Differential Diagnosis":return"DifferentialDiagnosis";case"Investigation":return"Investigation";case"Management Plan":return"ManagementPlan"}return null}},k=()=>{R.value=!1,setTimeout(()=>{y.value=0,R.value=!0},0)},z=()=>{const e=G();e.setVitals(e.getInitialVitals(l.value.ID))},p=async()=>{var s,m;const e=qe($.value,"sessionDate","value")||N.sessionDate(),t=C("vitals");for(let a=0;a<n.value.length;a++){const c=n.value[a];if(c.title==="Vital Signs")n.value[a].icon=H(e,t)?_:"";else if(c.title==="Risk Assessment"){const i=C("substanceAbuse");n.value[a].icon=H(e,i)?_:""}else if(c.title==="Investigations"){const i=(m=(s=l==null?void 0:l.value)==null?void 0:s.labOrders)==null?void 0:m.saved,b=i==null?void 0:i.filter(F=>N.toStandardHisFormat(e)===N.toStandardHisFormat(F.order_date));n.value[a].icon=(b==null?void 0:b.length)>0?_:""}else if(c.title==="Diagnosis"){const i=C("diagnosis");n.value[a].icon=H(e,i)?_:""}else if(c.title==="Complications Screening"){const i=C("screening");n.value[a].icon=H(e,i)?_:""}else c.title==="Treatment Plan"&&(L.value.length>0?n.value[a].icon=Xe()?_:"":n.value[a].icon="")}P()},H=(e,t)=>{const s=new Date(e);return s.setHours(0,0,0,0),t.some(m=>{const a=new Date(m.obs_datetime);return a.setHours(0,0,0,0),a.getTime()===s.getTime()})},pe=async()=>{var a,c,i,b;const e=[],t=await Q(me.value),s=await ct(ue.value),m=await Q(ge.value);t.length>0&&e.push({concept_id:await x.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:x.getSessionDate(),child:t}),s.length>0&&e.push({concept_id:await x.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:x.getSessionDate(),child:s}),m.length>0&&e.push(...m),e.length>0?((b=(i=(c=(a=l.value).screening)!=null?c:a.screening={}).unsaved)!=null||(i.unsaved=[]),l.value.screening.unsaved.push(...e),Ze("Complications saved successfully")):K("No complications data to save")},Se=async()=>{const e=Oe();if(!rt.isEmpty(e.selectedMedicalAllergiesList)){const m=et(),a=e.selectedMedicalAllergiesList.map(i=>({concept_id:i.concept_id,obs_datetime:tt.getSessionDate(),value_coded:i.concept_id,location_id:m.facilityLocation.code,value_text:i.name})),c=await it(a);l.value=Object.assign(l.value,c),console.log("Allergies staged successfully:",l.value),e.clearSelectedMedicalAllergiesList()}const t=await ot();l.value=Object.assign(l.value,t);const s=await lt().saveNonPharmaTherapyPatientData();l.value=Object.assign(l.value,s)},De=async(e,t)=>{var m,a,c;const s=(m=n.value[t])==null?void 0:m.title;e%1===0&&(y.value=e),s=="Vital Signs"&&((a=fe.value)==null||a.onSubmit()),s=="Risk Assessment"&&((c=ye.value)==null||c.onSubmit()),s=="Complications Screening"&&await pe(),s=="Treatment Plan"&&await Se(),await J(l.value)},W=async()=>{h.value=!0;try{await Ye(),await J(l.value),I.push("/triageList")}catch(e){console.error("Error saving data:",e),K("Error occurred while saving data. Please try again.")}finally{h.value=!1}};return Te(async()=>{if(A.NCDActivities.length===0){I.push("patientProfile");return}E().resetScreening(),n.value=T(),await p(),(y.value===void 0||y.value<0)&&(y.value=0,console.log("Setting initial tab index to 0")),M.value=!1,h.value=!1,P()}),f(y,async()=>{await P()}),f(oe,async()=>{await p()},{deep:!0}),f(l,async()=>{E().resetScreening(),await p()},{deep:!0}),f($,async()=>{await p()},{deep:!0}),f(le,async()=>{await p()},{deep:!0}),f(re,async()=>{await p()},{deep:!0}),f(ce,async()=>{await p()},{deep:!0}),f(L,async()=>{await p()},{deep:!0}),f(Y,async e=>{k(),z(),n.value=T()},{deep:!0}),f(l,async(e,t)=>{e.ID!=t.ID&&(k(),z())},{deep:!0}),q({saveData:W,markWizard:p,refreshWizard:k,validateDoneButtonState:P}),(e,t)=>{const s=g("PresentingComplaints"),m=g("DrugHistory"),a=g("PastMedicalHistory"),c=g("PastSurgicalHistory"),i=g("Allergy"),b=g("Intoxication"),F=g("SocialHistory"),he=g("FamilyHistory"),be=g("ReviewOfSystems"),_e=g("PhysicalExamination"),Pe=g("Summary"),He=g("DifferentialDiagnosis"),we=g("Investigation"),Ce=g("ManagementPlan");return j(),U(w(Ne),null,{default:B(()=>[o(Ke),o(w(ke),{fullscreen:!0},{default:B(()=>[o(at),r("div",mt,[R.value?(j(),U(nt,{key:0,ref:"wizard",headingTitle:"Medical Inpatient Admission Sheet","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:V.value,"custom-tabs":n.value,beforeChange:w(X),onChange:De,"onComplete:wizard":t[1]||(t[1]=xe=>W()),onDoneButtonChanged:ve},{default:B(()=>[r("div",null,[r("div",gt,[o(Qe,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:w(Be),"font-weight":"600",onClick:t[0]||(t[0]=xe=>de())},null,8,["icon"])])]),v(r("div",null,[o(s,{ref:"presentingComplaintsRef"},null,512)],512),[[d,u()=="PresentingComplaints"]]),v(r("div",null,[o(m,{ref:"drugHistoryRef"},null,512)],512),[[d,u()=="DrugHistory"]]),v(r("div",null,[o(a,{ref:"pastMedicalHistoryRef"},null,512)],512),[[d,u()=="PastMedicalHistory"]]),v(r("div",null,[o(c,{ref:"pastSurgicalHistoryRef"},null,512)],512),[[d,u()=="PastSurgicalHistory"]]),v(r("div",null,[o(i,{ref:"allergyRef"},null,512)],512),[[d,u()=="Allergy"]]),v(r("div",null,[o(b,{ref:"IntoxicationRef"},null,512)],512),[[d,u()=="Intoxication"]]),v(r("div",null,[o(F,{ref:"socialHistoryRef"},null,512)],512),[[d,u()=="SocialHistory"]]),v(r("div",null,[o(he,{ref:"familyHistoryRef"},null,512)],512),[[d,u()=="FamilyHistory"]]),v(r("div",null,[o(be,{ref:"reviewOfSystemsRef"},null,512)],512),[[d,u()=="ReviewOfSystems"]]),v(r("div",null,[o(_e,{ref:"physicalExaminationRef"},null,512)],512),[[d,u()=="PhysicalExamination"]]),v(r("div",null,[o(Pe,{ref:"summaryRef"},null,512)],512),[[d,u()=="Summary"]]),v(r("div",null,[o(He,{ref:"differentialDiagnosisRef"},null,512)],512),[[d,u()=="DifferentialDiagnosis"]]),v(r("div",null,[o(we,{ref:"investigationRef"},null,512)],512),[[d,u()=="Investigation"]]),v(r("div",null,[o(Ce,{ref:"managementPlanRef"},null,512)],512),[[d,u()=="ManagementPlan"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Fe("",!0)])]),_:1})]),_:1})}}});export{Nt as default};

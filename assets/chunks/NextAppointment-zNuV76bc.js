import{d as H,aV as It,r as F,a as nt,H as b,O as U,f as r,J as i,l as s,k as l,e as f,P as st,F as X,m as k,u as g,ah as G,b5 as St,b2 as ut,G as pt,E as mt,ai as ht,aj as gt,_ as j,I as ft,a3 as _t,bf as At,aU as bt,Q as x,L as tt,W as at,a5 as Ct,p as q,K as L,c as z,aS as wt,aR as Lt,aw as Et,aP as kt,N as it,a2 as Ot,w as Bt,bv as Nt,bo as $t,bP as Pt,aN as Rt}from"./vendor-yRLTeOJQ.js";import{O as K,bm as Mt,t as Ft,S as w,l as J,_ as W,J as vt,b5 as xt,B as yt,bd as Tt,M as R,o as ot,aQ as et,aH as lt,H as A,u as Q,V as Ht,aR as Vt,bn as Ut,bo as zt,aq as qt,bp as M,A as Y,bq as Gt,m as Wt,b8 as Kt,e as Yt,ay as Z,y as Xt,az as jt,P as Jt,a as rt}from"../index-DZfKDOkt.js";import{D as Qt}from"./DashBox-CCObOZCR.js";import{B as T}from"./BasicForm-BdUUZra0.js";import Zt from"./LabOrdersList-CjDWeSBB.js";import{v as dt}from"./group_validation-BB0xGjs8.js";import{u as te}from"./RadiologyStore-js1wSYQn.js";import{b as ee,d as ct}from"./useFormWizard-BhVOnad0.js";import{A as ne}from"./ncd_appointment_service-jBw6PamT.js";import{D as se}from"./DateInputField-VS-nohsY.js";class ae extends K{constructor(){super()}async postActivities(e,n){const h=n.location_id,y=await new Mt(parseInt(e),-1,h).createEncounter();if(y){const _=await K.buildLabOrders(y,n.orders||n);if(!await K.saveOrdersArray(y.encounter_id,_))return Ft("Unable to save lab orders")}}}const ie=H({data:()=>({userRole:"",ready:!1,userRoleSettings:{}}),watch:{$route:{async handler(t){this.userRole=w.getUserRoles();const e=w.getProgramID(),n=w.getProgramName();this.userRole=="Lab"&&e==14&&(this.userRoleSettings={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}),e==14&&this.userRole!="Lab"&&(this.userRoleSettings={url:"home",btnName:"Go to waiting list",stepperTitle:"Consultation Plan"}),e==12&&(this.userRoleSettings={url:"contact",btnName:"Back"}),n=="LABOUR AND DELIVERY PROGRAM"&&(this.userRoleSettings={url:"labour/labourHome",btnName:"Back to home"}),n=="PNC PROGRAM"&&(this.userRoleSettings={url:"pnc/home",btnName:"Back to home"})},immediate:!0,deep:!0}}}),oe=["innerHTML"],le={class:"scrollable-container"},re={key:0,class:"form-section"},de={key:1,class:"form-section"},ce={key:2,class:"form-section"},ue={key:3,class:"form-section"},pe={key:4,class:"form-section"},me={key:5,class:"form-section"},he={key:6,class:"form-section"},ge={key:7,class:"form-section"},fe=H({__name:"RadiologyInvestigation",setup(t){const e=te(),{head:n,neck:h,chest:v,abdomen:y,upper_extremity:_,spine:c,pelvis:D,lower_extremity:m}=It(e),I=F(J),S=F([]),u=(E,d,O)=>{document.querySelectorAll("#".concat(E," path")).forEach(a=>{a.classList.toggle("white-fill")}),document.querySelectorAll("#".concat(d," line")).forEach(a=>{a.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(d," rect")).forEach(a=>{a.classList.toggle("bright-green-fill"),a.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(d," path")).forEach(a=>{a.classList.toggle("dark-green-fill")}),document.querySelectorAll("#".concat(d," circle")).forEach(a=>{a.classList.toggle("bright-green-fill")});const B=S.value.findIndex(a=>a.id===O);B>=0?S.value.splice(B,1):S.value.unshift({id:O,active:!0})},V=()=>{const E=document.getElementById("SPINE");E.style.display==="none"||E.style.display==""?E.style.display="block":E.style.display="none",u("SPINE","SPINE_LABEL-2","spine")};return nt(()=>{const E=document.getElementById("HEAD");E&&E.addEventListener("click",()=>{u("HEAD","LABEL-6","head")});const d=document.getElementById("NECK");d&&d.addEventListener("click",()=>{u("NECK","LABEL-5","neck")});const O=document.getElementById("CHEST");O&&O.addEventListener("click",()=>{u("CHEST","LABEL-4","chest")});const B=document.getElementById("ABDOMEN_LABEL");B&&B.addEventListener("click",()=>{const P=document.getElementById("ABDOMEN-2");P.style.display==="none"||P.style.display==""?P.style.display="block":P.style.display="none",u("ABDOMEN","ABDOMEN_LABEL-2","abdomen")});const a=document.getElementById("UPPER_EXTRMITY");a&&a.addEventListener("click",()=>{u("UPPER_EXTRMITY","LABEL-3","upper_extremity")});const o=document.getElementById("SPINE"),p=document.getElementById("SPINE_LABEL"),C=document.getElementById("LOWER_SPINE_INACTIVE");o&&o.addEventListener("click",()=>{V()}),p&&p.addEventListener("click",()=>{V()}),C&&C.addEventListener("click",()=>{V()});const N=document.getElementById("PELVIS");N&&N.addEventListener("click",()=>{u("PELVIS","LABEL-2","pelvis")});const $=document.getElementById("LOWER_EXTREMITY");$&&$.addEventListener("click",()=>{u("LOWER_EXTREMITY","LABEL","lower_extremity")})}),(E,d)=>{const O=b("ion-col"),B=b("ion-row");return r(),U(B,null,{default:i(()=>[s(O,{size:"7"},{default:i(()=>[l("div",{innerHTML:I.value.full_body_sk},null,8,oe)]),_:1}),s(O,{size:"5",class:"form-column"},{default:i(()=>[l("div",le,[(r(!0),f(X,null,st(S.value,a=>(r(),f(X,null,[a.id==="head"?(r(),f("div",re,[d[0]||(d[0]=l("h6",null,"Body Part: Head",-1)),s(T,{contentData:g(n)},null,8,["contentData"])])):a.id==="neck"?(r(),f("div",de,[d[1]||(d[1]=l("h6",null,"Body Part: Neck",-1)),s(T,{contentData:g(h)},null,8,["contentData"])])):a.id==="chest"?(r(),f("div",ce,[d[2]||(d[2]=l("h6",null,"Body Part: Chest",-1)),s(T,{contentData:g(v)},null,8,["contentData"])])):a.id==="abdomen"?(r(),f("div",ue,[d[3]||(d[3]=l("h6",null,"Body Part: Abdomen",-1)),s(T,{contentData:g(y)},null,8,["contentData"])])):a.id==="upper_extremity"?(r(),f("div",pe,[d[4]||(d[4]=l("h6",null,"Body Part: Upper Extremity",-1)),s(T,{contentData:g(_)},null,8,["contentData"])])):a.id==="spine"?(r(),f("div",me,[d[5]||(d[5]=l("h6",null,"Body Part: Spine",-1)),s(T,{contentData:g(c)},null,8,["contentData"])])):a.id==="pelvis"?(r(),f("div",he,[d[6]||(d[6]=l("h6",null,"Body Part: Pelvis",-1)),s(T,{contentData:g(D)},null,8,["contentData"])])):a.id==="lower_extremity"?(r(),f("div",ge,[d[7]||(d[7]=l("h6",null,"Body Part: Lower Extremity",-1)),s(T,{contentData:g(m)},null,8,["contentData"])])):k("",!0)],64))),256))])]),_:1})]),_:1})}}}),_e=W(fe,[["__scopeId","data-v-5ab54fe8"]]),ve=H({name:"Menu",mixins:[ie],components:{IonContent:_t,IonHeader:ft,IonItem:j,IonList:gt,IonMenu:ht,IonTitle:mt,IonToolbar:pt,IonInput:ut,IonPopover:St,DashBox:Qt,SelectionPopover:Tt,BasicInputField:yt,BasicForm:T,List:xt,DynamicButton:vt,LabOrdersList:Zt,RadiologyInvestigation:_e},data(){return{segmentContent:"Lab Investigations",iconsContent:J,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",testResult:"",test:"",labOrders:"",filteredSpecimen:"",testData:[],popoverOpen:!1,labOrderStatus:!1,event:"",specimen:"",radiologyOrdersStatus:!1,otherOrdersStatus:!1}},setup(){return{checkmark:bt,pulseOutline:At}},computed:{...G(lt,["investigations"]),...G(Q,["patient"]),inputFields(){return this.investigations[0].data.rowData[0].colData}},watch:{investigations:{handler(){this.setDashedBox()},deep:!0},patient:{async handler(){var t;(t=this.patient)!=null&&t.labOrders&&(this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved])},deep:!0},$route:{async handler(){await this.getTests()},deep:!0}},async mounted(){await this.getTests(),this.updateInvestigationsStores(),this.setDashedBox(),this.updateInvestigationWizard()},methods:{setSegmentContent(t){this.segmentContent=t},async getTests(){let t;w.getPouchDbStatus()&&w.getLanConnectionStatus()?t=await ot("test_types"):t=await K.getTestTypes(),R(this.investigations,"test","multiSelectData",t)},toggleLabOrderStatus(){this.labOrderStatus=!this.labOrderStatus},async updateInvestigationWizard(){var e;if(!((e=this.patient)!=null&&e.labOrders))return;this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved];const t=await this.labOrders.filter(n=>A.toStandardHisFormat(A.sessionDate())===A.toStandardHisFormat(n.order_date));t.length>0?this.investigations[0].selectedData=t:this.investigations[0].selectedData=""},async updateInvestigationsStores(){await this.updateInvestigationWizard(),lt().setInvestigations(this.investigations)},displayInputFields(){this.testResult="",this.selectedText="",this.no_item=!1,this.addItemButton=!1,this.search_item=!0},async validateRowData(){return dt(this.investigations)},async checkTest(){return await this.isNameInData(this.inputFields[0].value.name,await this.investigations[0].selectedData)?(R(this.investigations,"test","alertsErrorMassage","Lab order already selected"),!1):(R(this.investigations,"test","alertsErrorMassage",""),!0)},async addNewRow(){dt(this.investigations)&&await this.checkTest()&&(await this.saveTest(),this.investigations[0].data.rowData[0].colData[0].value="",this.investigations[0].data.rowData[0].colData[1].value="",this.search_item=!1,this.display_item=!0,this.addItemButton=!0),this.updateInvestigationWizard()},isNameInData(t,e){for(let n of e)for(let h of n.tests)if(h.name===t)return!0;return!1},async saveTest(){await new ae().postActivities(this.patient.patientID,[{concept_id:this.inputFields[0].value.concept_id,name:this.inputFields[0].value.name,specimen:this.inputFields[1].value.name,reason:"Routine",specimenConcept:await et.getConceptID(this.inputFields[1].value.name,!0)}]),R(this.investigations,"specimen","disabled",!0),this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved]},async handleInputData(t){if(t.inputHeader=="Test"&&this.checkTest(),R(this.investigations,"specimen","alertsErrorMassage",""),t.inputHeader=="Test"&&t.value){let e;w.getPouchDbStatus()&&w.getLanConnectionStatus()?e=await ot("specimens"):e=await K.getSpecimens("",1e3),this.specimen=await et.getConceptSet(t.value.name,"",{names:e.map(n=>n.name)}),this.specimen.length==1?(R(this.investigations,"specimen","value",this.specimen[0]),R(this.investigations,"specimen","disabled",!0)):(R(this.investigations,"specimen","value",""),R(this.investigations,"specimen","disabled",!1)),R(this.investigations,"specimen","multiSelectData",this.specimen)}},async filterTest(t){return await this.labOrders.filter(e=>e.name.toLowerCase().includes(t.toLowerCase()))},async filterSpecimen(t){var e;return(e=this.specimen[0])!=null&&e.name&&t?await this.specimen.filter(n=>n==null?void 0:n.name.toLowerCase().includes(t.toLowerCase())):[]},setTest(t){this.selectedText=t.name,this.inputFields[1].inputHeader=="Test"?this.investigations[0].data.rowData[0].colData[0].value=t.name:this.investigations[0].data.rowData[0].colData[1].value=t.name,this.updateInvestigationsStores()},setDashedBox(){(this.inputFields[1].value||this.inputFields[0].value)&&(this.addItemButton=!1,this.search_item=!0,this.no_item=!1),this.investigations[0].selectedData.length>0?(this.display_item=!0,this.no_item=!1):this.search_item||(this.no_item=!0)}}}),ye={class:"background"},De={key:0},Ie={key:1},Se={key:2},Ae={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},be={key:3},Ce={class:"ion-padding",slot:"content"},we={key:4};function Le(t,e,n,h,v,y){const _=b("ion-label"),c=b("ion-segment-button"),D=b("ion-segment"),m=b("VisitsHistory"),I=b("LabOrdersList"),S=b("RadiologyInvestigation");return r(),f("div",ye,[s(D,{value:t.segmentContent,style:{"margin-top":"5px"}},{default:i(()=>[s(c,{value:"Lab Investigations",onClick:e[0]||(e[0]=u=>t.setSegmentContent("Lab Investigations"))},{default:i(()=>[s(_,null,{default:i(()=>[...e[3]||(e[3]=[x("Lab Investigations",-1)])]),_:1})]),_:1}),s(c,{value:"Radiology Investigation",onClick:e[1]||(e[1]=u=>t.setSegmentContent("Radiology Investigation"))},{default:i(()=>[s(_,null,{default:i(()=>[...e[4]||(e[4]=[x("Radiology Investigation",-1)])]),_:1})]),_:1}),s(c,{value:"Other Investigation",onClick:e[2]||(e[2]=u=>t.setSegmentContent("Other Investigation"))},{default:i(()=>[s(_,null,{default:i(()=>[...e[5]||(e[5]=[x("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),t.segmentContent=="Radiology Investigation"?(r(),f("div",De,[s(m)])):k("",!0),t.segmentContent=="Other Investigation"?(r(),f("div",Ie)):k("",!0),t.segmentContent=="Lab Investigations"?(r(),f("div",Se,[l("div",Ae,[l("span",null,[s(I,{propOrders:t.labOrders},null,8,["propOrders"])])])])):k("",!0),t.segmentContent=="Radiology Investigation"?(r(),f("div",be,[l("div",Ce,[s(S)])])):k("",!0),t.segmentContent=="Other Investigation"?(r(),f("div",we)):k("",!0)])}const rn=W(ve,[["render",Le],["__scopeId","data-v-0803dcda"]]),Ee=H({created(){},components:{IonItem:j,IonCol:Ct,IonLabel:at,IonIcon:tt},data(){return{iconsContent:J,localMedicalDrugsList:[...this.$props._selectedMedicalDrugsList]}},props:{_selectedMedicalDrugsList:{type:Array,default:[]},show_actions_buttons:{type:Boolean,default:!0},highLightBackground:{type:String,default:"item-native"}},watch:{},methods:{highlightItem(t){const e=document.getElementById(t+"_lbl");e&&(e.style.color="#006401"),this.highlightActionBtns(t)},undoHighlightItem(t){const e=document.getElementById(t+"_lbl");e&&(e.style.color="#636363"),this.undohighlightActionBtns(t)},highlightActionBtns(t){const e=document.getElementsByClassName(t+"_spanlbl");for(let n=0;n<e.length;n++)e[n].style.display="inline-block"},undohighlightActionBtns(t){const e=document.getElementsByClassName(t+"_spanlbl");for(let n=0;n<e.length;n++)e[n].style.display="none"},asignLblID(t){return t+"_lbl"},asignSpanLblID(t){return t+"_spanlbl"},async removeItemAtIndex(t,e){await Ht("Do you want to delete it?",e)&&this.$emit("remove-item",t)},editItemAtIndex(t){this.$emit("edit-item",t)},highLightBnd(t){if(t){if(t.highlightbackground!==void 0&&t.highlightbackground==!0)return this.$props.highLightBackground}else return!1}}}),ke=["onMousemove","onMouseout"],Oe={class:"route-label"};function Be(t,e,n,h,v,y){const _=b("ion-label"),c=b("ion-col"),D=b("ion-row"),m=b("ion-icon");return r(!0),f(X,null,st(t.localMedicalDrugsList,(I,S)=>(r(),f("div",{id:"df",class:"medication-item",key:S,onMousemove:u=>t.highlightItem(S),onMouseout:u=>t.undoHighlightItem(S)},[s(D,{class:"medication-header"},{default:i(()=>[s(c,{class:q(["ion-text-wrap",t.highLightBnd(I)])},{default:i(()=>[s(_,{id:t.asignLblID(S),class:"medication-name"},{default:i(()=>[x(L(I.drugName),1)]),_:2},1032,["id"])]),_:2},1032,["class"])]),_:2},1024),s(D,{class:"medication-details"},{default:i(()=>[s(c,{size:"10",class:q(["ion-text-wrap details-col",t.highLightBnd(I)])},{default:i(()=>[s(_,{class:"details-text"},{default:i(()=>[x(L(I.dose)+" / "+L(I.frequency)+" / daily / "+L(I.duration)+" / until "+L(I.prescription)+" ",1),l("span",Oe,L(I.route_name),1)]),_:2},1024)]),_:2},1032,["class"]),t.show_actions_buttons?(r(),U(c,{key:0,class:q([t.highLightBnd(I),"actions-col"]),size:"2"},{default:i(()=>[s(_,{class:q(["action-button",t.asignSpanLblID(S)]),onClick:u=>t.editItemAtIndex(S)},{default:i(()=>[s(m,{icon:t.iconsContent.edit},null,8,["icon"])]),_:1},8,["class","onClick"]),s(_,{class:q(["action-button",t.asignSpanLblID(S)]),onClick:u=>t.removeItemAtIndex(S,u)},{default:i(()=>[s(m,{icon:t.iconsContent.delete},null,8,["icon"])]),_:1},8,["class","onClick"])]),_:2},1032,["class"])):k("",!0)]),_:2},1024)],40,ke))),128)}const dn=W(Ee,[["render",Be],["__scopeId","data-v-01c693a3"]]),Ne={key:0,class:"custom-allergy-container"},$e={class:"button-group"},Pe=H({watch:{},name:"AllergiesComponent"}),Re=H({...Pe,setup(t){const e=Vt(),n=Q(),h=z(()=>e.selectedMedicalAllergiesList),v=z(()=>n.patient),y=z(()=>e.medicalAllergiesList),_=F(d(8,"item-")),c=F(""),D=F(!1),m=[{multi_Selection:!0,show_list_label:!0,unqueId:_.value,name_of_list:"Add/Remove allergies",placeHolder:"Search for an allergy",items:[],listUpdatedFN:u,listFilteredFN:()=>{},searchTextFN:V,use_internal_filter:!0,show_error:F(!1),error_message:"please select a User",disabled:F(!1)}],I=F(!1);nt(async()=>{S()});const S=()=>{e.current_patient.ID!=v.value.ID&&(e.clearSelectedMedicalAllergiesList(),e.setCurrentPatient(v.value))};function u(a){a.forEach(o=>{o.selected==!0&&o.name==="Other"&&(D.value=o.name==="Other"),o.selected==!1&&o.name==="Other"&&B()}),e.setSelectedMedicalAllergiesList(a),E()}async function V(a){const o=a,p=await et.getConceptSet("OPD Medication",o);p.map(P=>({label:P.name,value:P.name,other:P}));const C=Ut(o),$=zt(C,p).sort((P,Dt)=>P.name.localeCompare(Dt.name));e.setMedicalAllergiesList($),E()}function E(){const a=y.value;h.value.forEach(p=>{let C=!1;a.forEach((N,$)=>{N.concept_id==p.concept_id&&p.selected===!0&&(a[$]=p,C=!0)}),!C&&p.selected===!0&&a.push(p)});const o=a.filter((p,C,N)=>C===N.findIndex($=>($==null?void 0:$.concept_id)===(p==null?void 0:p.concept_id)));e.setMedicalAllergiesList(o)}function d(a=8,o=""){const p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let C=o;for(let N=0;N<a;N++)C+=p.charAt(Math.floor(Math.random()*p.length));return C+="-".concat(Date.now()),C}async function O(a){try{const o=a.trim();if(o){const p={name:o,selected:!0,concept_id:d(8,"12"),concept_name_id:d(8,"34")};e.setMedicalAllergiesList([...y.value,p]),e.setSelectedMedicalAllergiesList(p),D.value=!1,I.value=!0,c.value="";const C=e.findSelectedAllergyByName("Other");e.unselectOther(C)}}catch(o){console.error(o)}}const B=()=>{D.value=!1,c.value="",I.value=!1;const a=e.findSelectedAllergyByName("Other");a&&e.unselectOther(a)};return(a,o)=>(r(),U(g(wt),null,{default:i(()=>[s(g(Lt),null,{default:i(()=>[s(g(at),{class:"header-container"},{default:i(()=>[s(g(tt),{icon:g(Et),class:"allergy-icon"},null,8,["icon"]),o[3]||(o[3]=l("span",{style:{"font-size":"16px","font-weight":"600"}}," Allergies (Medication, Healthcare items, Environment and Food) ",-1))]),_:1})]),_:1}),s(g(kt),null,{default:i(()=>[s(qt,{multiSelection:m[0].multi_Selection,show_label:m[0].show_list_label,uniqueId:m[0].unqueId,name_of_list:m[0].name_of_list,choose_place_holder:m[0].placeHolder,"items_-list":y.value,use_internal_filter:m[0].use_internal_filter,disabled:m[0].disabled.value,onItemListUpDated:m[0].listUpdatedFN,onItemListFiltered:m[0].listFilteredFN,onItemSearchText:m[0].searchTextFN},null,8,["multiSelection","show_label","uniqueId","name_of_list","choose_place_holder","items_-list","use_internal_filter","disabled","onItemListUpDated","onItemListFiltered","onItemSearchText"]),D.value?(r(),f("div",Ne,[s(g(ut),{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=p=>c.value=p),placeholder:"Please specify the allergy",fill:"outline",class:"custom-input"},null,8,["modelValue"]),l("div",$e,[s(g(it),{onClick:o[1]||(o[1]=p=>O(c.value)),class:"addCustomAllergyBtn"},{default:i(()=>[...o[4]||(o[4]=[x(" Add Allergy ",-1)])]),_:1}),s(g(it),{onClick:o[2]||(o[2]=p=>B()),fill:"clear",class:"cancelBtn"},{default:i(()=>[s(g(tt),{icon:g(Ot),slot:"icon-only"},null,8,["icon"])]),_:1})])])):k("",!0)]),_:1})]),_:1}))}}),cn=W(Re,[["__scopeId","data-v-4de36202"]]),Me={class:"checklist-container"},Fe=H({watch:{},name:"xxxComponent"}),xe=H({...Fe,setup(t){const e=Q(),n=z(()=>e.patient),h=ee(),v=h.items;nt(async()=>{y()});const y=()=>{h.current_patient.ID!=n.value.ID&&(h.clearSelectednonPharmaTherapyStore(),h.setCurrentPatient(n.value))};return Bt(()=>n.value,async _=>{}),(_,c)=>(r(),f("div",Me,[(r(!0),f(X,null,st(g(v),D=>(r(),U(g(j),{key:D.id,class:"no-border"},{default:i(()=>[s(g(Nt),{id:D.id,modelValue:D.checked,"onUpdate:modelValue":m=>D.checked=m,slot:"start"},null,8,["id","modelValue","onUpdate:modelValue"]),s(g(at),{style:{"font-size":"16px","font-weight":"600"}},{default:i(()=>[x(L(D.label),1)]),_:2},1024)]),_:2},1024))),128))]))}}),un=W(xe,[["__scopeId","data-v-371e920f"]]),Te=H({components:{IonContent:_t,IonHeader:ft,IonItem:j,IonList:gt,IonMenu:ht,IonTitle:mt,IonToolbar:pt,BasicInputField:yt,IonDatetime:Pt,IonBadge:$t,DateInputField:se,DynamicButton:vt},props:{showPeripheral:{type:Boolean,default:!0}},setup(t){const e=Z(),n=F(0),h=z(()=>e.getDisabledDates()),v=z(()=>e.getAssignedAppointments()),y=F(),_=z(()=>t.showPeripheral);return{disabledDates:h,datesCounts:v,appointment_count:n,calendarOutline:Rt,inputPRDate:y,show_peripheral:_}},data(){return M(),rt(),{iconsContent:J,date:new Date(w.getSessionDate()),tomorrow:new Date(w.getSessionDate()).getDate()+1,appointment:"",drugRunoutDate:"",nextAppointmentDate:"",minDate:new Date(w.getSessionDate())}},computed:{...G(M,["nextAppointment","appointmentCountsCache","currentSelectedNextAppointmentDate"]),...G(Z,["maximumNumberOfDaysForEachDay","assignedAppointmentsDates"]),...G(Q,["patient"]),...G(rt,["activeProgram"]),calendarDate(){const t=M();return t.currentSelectedNextAppointmentDate?A.toStandardHisDisplayFormat(t.currentSelectedNextAppointmentDate):""},runOutDate(){var e;const t=M();return((e=this.activeProgram)==null?void 0:e.program_id)===14?ct():t.getAppointmentMedicationRunOutDate()}},watch:{calendarDate:{handler(){this.updateNextAppointment()},deep:!0},"$service.sessionDate":{handler(){this.updateMinDate()},immediate:!0},"patient.ID":{async handler(t,e){t!==e&&(this.cleanCurrentNextAppointmentDate(),this.checkIfSamePatientInContext(),this.clearNextAppointment())}}},async mounted(){this.checkIfSamePatientInContext(),await this.getAppointmentMents(this.runOutDate.date),await Xt().loadGlobalProperty(),this.validateAppointmentCountsCache(),await this.preloadAppointmentCounts(),jt();const t=w.getUserID(),e=new Jt;this.appointment=new Y(e.getID(),t),this.nextAppointmentDate=this.appointment.date,this.supposedRunOutDate(),window.addEventListener("storage",this.handleStorageChange),ct()},beforeUnmount(){window.removeEventListener("storage",this.handleStorageChange)},methods:{handleStorageChange(t){t.key==="sessionDate"&&this.updateMinDate()},updateMinDate(){this.date=new Date(w.getSessionDate()),this.minDate=new Date(w.getSessionDate())},updateNextAppointment(){M().setNextAppointment(this.calendarDate)},async handleDateUpdate(t){t&&(Z().setAssignedAppointmentsDates(t,!0),this.calendarDate=A.toStandardHisDisplayFormat(t),await this.save(),await this.getAppointmentMents(t),await this.updateAppointmentCache(t),M().setCurrentSelectedNextAppointmentDate(t,this.patient.ID))},async getAppointmentMents(t){if(Yt().apiStatus)try{const n=await Y.getDailyAppointments(A.toStandardHisFormat(t),A.toStandardHisFormat(t));this.appointment_count=n.length}catch(n){}},getCounter(t){const e=A.toStandardHisFormat(t);return this.appointmentCountsCache[e]||""},async save(){if(this.assignedAppointmentsDates.length>0)try{const e=await new ne().createOfflineAppointment()}catch(t){}},async openCornfirmModal(t){this.calendarDate=A.toStandardHisDisplayFormat(t),await this.getAppointmentMents(t),Wt(Kt,{class:"otherVitalsModal"},!0,{message:"Are you sure you want to add this Appointment?"},{cancel:v=>{},confirm:async v=>{v.detail==!0&&await this.handleDateUpdate(t)}})},async handleInput(t){this.inputPRDate=A.toStandardHisDisplayFormat(t),await this.openCornfirmModal(t)},async supposedRunOutDate(){await Gt.getLastDrugsReceived(this.patient.patientID)},async preloadAppointmentCounts(){try{const t=new Date(w.getSessionDate());t.setDate(1);const e=new Date(w.getSessionDate());e.setMonth(e.getMonth()+2),e.setDate(0);try{const n=await Y.getDailyAppointments(A.toStandardHisFormat(t),A.toStandardHisFormat(e)),h=this.filterUniqueAppointments(n),v={};h.forEach(y=>{const _=new Date(y.appointment_date),c=A.toStandardHisFormat(_);v[c]||(v[c]=0),v[c]++}),Object.keys(v).forEach(y=>{this.appointmentCountsCache[y]=v[y]})}catch(n){console.error("Error fetching appointments for date range:",n)}}catch(t){console.error("Error in preload process:",t)}},filterUniqueAppointments(t){const e=new Map;return t.forEach(n=>{const h="".concat(n.given_name,"_").concat(n.family_name,"_").concat(n.birthdate,"_").concat(n.appointment_date);e.has(h)||e.set(h,n)}),Array.from(e.values())},async updateAppointmentCache(t){try{const e=A.toStandardHisFormat(t),n=await Y.getDailyAppointments(A.toStandardHisFormat(t),A.toStandardHisFormat(t));this.appointmentCountsCache[e]=n.length}catch(e){console.error("Error updating appointment cache:",e)}},validateAppointmentCountsCache(){M().checkCurrentLocationIfInContext()},isRunOutDate(t){return!this.runOutDate||!this.runOutDate.date?!1:A.toStandardHisFormat(t)===A.toStandardHisFormat(this.runOutDate.date)},cleanCurrentNextAppointmentDate(){M().cleanCurrentSelectedNextAppointmentDate()},checkIfSamePatientInContext(){const t=M();t.current_patient.ID!=this.patient.ID&&(this.cleanCurrentNextAppointmentDate(),t.setCurrentPatient(this.patient))},clearNextAppointment(){M().clearAppointmentMedicationRunOutDate()}}}),He={class:"card_content"},Ve={class:"count-badge"},Ue={class:"dates_title"},ze={class:"sub_data"},qe={class:"dates_title"},Ge={class:"sub_data"},We={class:"dates_title"},Ke={class:"sub_data"},Ye={class:"dates_title"},Xe={class:"sub_data"};function je(t,e,n,h,v,y){const _=b("VueDatePicker"),c=b("ion-col"),D=b("DynamicButton"),m=b("ion-item"),I=b("ion-row"),S=b("DateInputField");return r(),f("div",He,[s(I,null,{default:i(()=>[s(c,{"size-sm":"12","size-md":"12","size-lg":"12","size-xl":"8"},{default:i(()=>[s(_,{class:"calender",onDateUpdate:t.openCornfirmModal,inline:"","auto-apply":"","enable-time-picker":!1,"disabled-dates":t.disabledDates,"min-date":t.minDate,modelValue:t.runOutDate.date,"onUpdate:modelValue":e[0]||(e[0]=u=>t.runOutDate.date=u)},{day:i(({day:u,date:V})=>[(r(),f("p",{key:0,class:q({"run-out-date":t.isRunOutDate(V)}),style:{"font-weight":"600","font-size":"20px"}},[l("span",null,[x(L(u),1),l("sup",Ve,L(t.getCounter(V)),1)])],2))]),_:1},8,["onDateUpdate","disabled-dates","min-date","modelValue"])]),_:1}),t.show_peripheral?(r(),U(c,{key:0},{default:i(()=>[s(m,null,{default:i(()=>[l("div",Ue,[e[3]||(e[3]=l("div",null,[x("Suggested Next Appointment Date "),l("span",{style:{"font-size":"16px"}},"(Medication run out date)")],-1)),l("div",ze,[x(L(t.runOutDate.formattedDate||"No run out date available")+" ",1),t.runOutDate.formattedDate?(r(),U(D,{key:0,onClick:e[1]||(e[1]=u=>t.handleDateUpdate(t.runOutDate.date)),name:"Set Next Appt.",fill:"solid",iconSlot:"icon-only",style:{float:"right"}})):k("",!0)])])]),_:1}),s(m,null,{default:i(()=>[l("div",qe,[e[4]||(e[4]=l("div",null,"User set appointment date",-1)),l("div",Ge,L(t.calendarDate),1)])]),_:1}),s(m,null,{default:i(()=>[l("div",We,[e[5]||(e[5]=l("div",null,"Appointments",-1)),l("div",Ke,L(t.appointment_count),1)])]),_:1}),s(m,null,{default:i(()=>[l("div",Ye,[e[6]||(e[6]=l("div",null,"Appointment limit (per/day)",-1)),l("div",Xe,L(t.appointment_count)+"/"+L(t.maximumNumberOfDaysForEachDay),1)])]),_:1})]),_:1})):k("",!0)]),_:1}),t.show_peripheral?(r(),U(I,{key:0},{default:i(()=>[s(c,{size:"4"},{default:i(()=>[s(S,{inputHeader:"Preferred Next Appointment Date",bold:"600",fontSize:"17px",placeholderFontSize:"17px",placeholderFontWeight:"600",unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.inputPRDate,eventType:"",minDate:t.minDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e[2]||(e[2]=u=>t.handleInput(u))},null,8,["icon","inputValue","minDate"])]),_:1})]),_:1})):k("",!0)])}const pn=W(Te,[["render",je],["__scopeId","data-v-5d96ce77"]]);export{cn as A,dn as D,rn as I,ae as L,pn as N,_e as R,ie as _,un as a};

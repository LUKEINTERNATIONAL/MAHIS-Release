import{d as Ie,ap as Re,cr as Ae,r as S,c as Me,b2 as D,w as f,a as Te,H as g,O as U,f as j,J as B,l as o,u as w,a4 as ke,k as r,m as Fe,i as v,bT as Be,v as d,a7 as Ee,ba as _}from"./vendor-BataJFSH.js";import{b7 as G,u as Ne,b8 as Ve,b9 as $e,a_ as ze,ba as Le,e as We,a$ as Ue,i as je,a1 as Ge,f as Je,T as Ke,M as qe,V as Qe,H as E,b1 as C,bb as Xe,aU as J,bc as Ye,t as K,ah as x,K as Ze,bd as Oe,a3 as et,S as tt}from"../index-CYcjB3lE.js";import{D as at}from"./DemographicBar-BmFdNEyR.js";import{u as st,_ as it}from"./useFormWizard-WA0BdVFf.js";import{u as N}from"./ComplicationsStore-BbalwQUK.js";import{s as nt,c as ot,u as lt}from"./nonPharmaTherapyStore-BeLj4Wxw.js";import{l as rt}from"./lodash-NJiRuGo9.js";import{a as q,b as ct}from"./formatServerData-CrPFhp8u.js";import{u as ut}from"./usePatientProfile-BH-LjvQ2.js";import"./apexcharts-BVd6_RNM.js";import"./drug_prescription_service-CAmeZFJa.js";import"./patient_diagnosis_service-Dw0KiIvk.js";import"./Registration-DEByNCkM.js";import"./useLocation-Bl6i7Nj8.js";import"./vaccines_service-jL4y0Qg3.js";import"./sms_service-CfLPAmD3.js";import"./EIRreportsStore-DPBsJTJR.js";import"./Export-kNnnCNnD.js";import"./user_role_management-BpRRS3k4.js";import"./useNeonatalEnrollmentStore-eD5cG8pe.js";import"./enrollment-DU-PLRUa.js";import"./Outcome-T6JLQrwS.js";import"./wardsStore-CIkFtO0D.js";const mt={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},gt={class:"back_profile"},Vt=Ie({__name:"MedicalAdmission",setup(vt,{expose:Q}){const{onTabBeforeChange:X,currentTabIndex:y}=st();ut();const I=Re(),Y=Ae();S([]),S([]),S(!1);const R=S(!0),A=S(!1),h=S(!1),V=Me(()=>({text:h.value?"Saving...":"Finish",icon:h.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:A.value||h.value})),Z=G(),O=Ne(),ee=Ve(),te=$e();ze();const ae=Le(),M=We();Ue();const se=je(),ie=N(),ne=Ge(),{patient:l}=D(O),{vitals:oe}=D(Z),{investigations:le}=D(ee),{diagnosis:re}=D(te),{substance:ce}=D(se),{selectedNCDMedicationList:$}=D(ae),{FootScreening:ue,visualScreening:me,cvScreening:ge}=D(ie),{sessionDate:z}=D(ne),{apiStatus:dt}=D(Je());f(V,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:y.value,tabsLength:i.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),f(h,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const ve=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},P=()=>{let e=!1;return u(),h.value&&(e=!0),A.value=e,!e},de=()=>{I.push("/patientProfile")},T=()=>[{title:"Presenting Complaints",icon:""},{title:"Drug History",icon:""},{title:"Past Medical History",icon:""},{title:"Past Surgical History",icon:""},{title:"Allergy",icon:""},{title:"Intoxication",icon:""},{title:"Social History",icon:""},{title:"Family History",icon:""},{title:"Review of Systems",icon:""},{title:"Physical Examination",icon:""},{title:"Summary",icon:""},{title:"Differential Diagnosis",icon:""},{title:"Investigation",icon:""},{title:"Management Plan",icon:""}],i=S(T()),fe=S(null),ye=S(null),u=()=>{var s;if(!i.value||i.value.length===0)return console.log("Tabs not yet initialized"),null;const e=y.value>=0&&y.value<i.value.length?y.value:0;switch((s=i.value[e])==null?void 0:s.title){case"Presenting Complaints":return"Presenting Complaints";case"Drug History":return"DrugHistory";case"Past Medical History":return"PastMedicalHistory";case"Past Surgical History":return"PastSurgicalHistory";case"Allergy":return"Allergy";case"Intoxication":return"Intoxication";case"Social History":return"SocialHistory";case"Family History":return"FamilyHistory";case"Review of Systems":return"ReviewOfSystems";case"Physical Examination":return"PhysicalExamination";case"Summary":return"Summary";case"Differential Diagnosis":return"DifferentialDiagnosis";case"Investigation":return"Investigation";case"Management Plan":return"ManagementPlan";default:if(M.NCDActivities.length>0)switch(M.NCDActivities[0]){case"Presenting Complaints":return"PresentingComplaints";case"Drug History":return"DrugHistory";case"Past Medical History":return"PastMedicalHistory";case"Past Surgical History":return"PastSurgicalHistory";case"Allergy":return"Allergy";case"Intoxication":return"Intoxication";case"Social History":return"SocialHistory";case"Family History":return"FamilyHistory";case"Review of Systems":return"ReviewOfSystems";case"Physical Examination":return"PhysicalExamination";case"Summary":return"Summary";case"Differential Diagnosis":return"DifferentialDiagnosis";case"Investigation":return"Investigation";case"Management Plan":return"ManagementPlan"}return null}},k=()=>{R.value=!1,setTimeout(()=>{y.value=0,R.value=!0},0)},L=()=>{const e=G();e.setVitals(e.getInitialVitals(l.value.ID))},p=async()=>{var s,m;const e=Qe(z.value,"sessionDate","value")||E.sessionDate(),t=C("vitals");for(let a=0;a<i.value.length;a++){const c=i.value[a];if(c.title==="Vital Signs")i.value[a].icon=H(e,t)?_:"";else if(c.title==="Risk Assessment"){const n=C("substanceAbuse");i.value[a].icon=H(e,n)?_:""}else if(c.title==="Investigations"){const n=(m=(s=l==null?void 0:l.value)==null?void 0:s.labOrders)==null?void 0:m.saved,b=n==null?void 0:n.filter(F=>E.toStandardHisFormat(e)===E.toStandardHisFormat(F.order_date));i.value[a].icon=(b==null?void 0:b.length)>0?_:""}else if(c.title==="Diagnosis"){const n=C("diagnosis");i.value[a].icon=H(e,n)?_:""}else if(c.title==="Complications Screening"){const n=C("screening");i.value[a].icon=H(e,n)?_:""}else c.title==="Treatment Plan"&&($.value.length>0?i.value[a].icon=Xe()?_:"":i.value[a].icon="")}P()},H=(e,t)=>{const s=new Date(e);return s.setHours(0,0,0,0),t.some(m=>{const a=new Date(m.obs_datetime);return a.setHours(0,0,0,0),a.getTime()===s.getTime()})},pe=async()=>{var a,c,n,b;const e=[],t=await q(me.value),s=await ct(ue.value),m=await q(ge.value);t.length>0&&e.push({concept_id:await x.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:x.getSessionDate(),child:t}),s.length>0&&e.push({concept_id:await x.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:x.getSessionDate(),child:s}),m.length>0&&e.push(...m),e.length>0?((b=(n=(c=(a=l.value).screening)!=null?c:a.screening={}).unsaved)!=null||(n.unsaved=[]),l.value.screening.unsaved.push(...e),Ze("Complications saved successfully")):K("No complications data to save")},Se=async()=>{const e=Oe();if(!rt.isEmpty(e.selectedMedicalAllergiesList)){const m=et(),a=e.selectedMedicalAllergiesList.map(n=>({concept_id:n.concept_id,obs_datetime:tt.getSessionDate(),value_coded:n.concept_id,location_id:m.facilityLocation.code,value_text:n.name})),c=await nt(a);l.value=Object.assign(l.value,c),console.log("Allergies staged successfully:",l.value),e.clearSelectedMedicalAllergiesList()}const t=await ot();l.value=Object.assign(l.value,t);const s=await lt().saveNonPharmaTherapyPatientData();l.value=Object.assign(l.value,s)},De=async(e,t)=>{var m,a,c;const s=(m=i.value[t])==null?void 0:m.title;e%1===0&&(y.value=e),s=="Vital Signs"&&((a=fe.value)==null||a.onSubmit()),s=="Risk Assessment"&&((c=ye.value)==null||c.onSubmit()),s=="Complications Screening"&&await pe(),s=="Treatment Plan"&&await Se(),await J(l.value)},W=async()=>{h.value=!0;try{await Ye(),await J(l.value),I.push("/triageList")}catch(e){console.error("Error saving data:",e),K("Error occurred while saving data. Please try again.")}finally{h.value=!1}};return Te(async()=>{if(M.NCDActivities.length===0){I.push("patientProfile");return}N().resetScreening(),i.value=T(),await p(),(y.value===void 0||y.value<0)&&(y.value=0,console.log("Setting initial tab index to 0")),A.value=!1,h.value=!1,P()}),f(y,async()=>{await P()}),f(oe,async()=>{await p()},{deep:!0}),f(l,async()=>{N().resetScreening(),await p()},{deep:!0}),f(z,async()=>{await p()},{deep:!0}),f(le,async()=>{await p()},{deep:!0}),f(re,async()=>{await p()},{deep:!0}),f(ce,async()=>{await p()},{deep:!0}),f($,async()=>{await p()},{deep:!0}),f(Y,async e=>{k(),L(),i.value=T()},{deep:!0}),f(l,async(e,t)=>{e.ID!=t.ID&&(k(),L())},{deep:!0}),Q({saveData:W,markWizard:p,refreshWizard:k,validateDoneButtonState:P}),(e,t)=>{const s=g("PresentingComplaints"),m=g("DrugHistory"),a=g("PastMedicalHistory"),c=g("PastSurgicalHistory"),n=g("Allergy"),b=g("Intoxication"),F=g("SocialHistory"),he=g("FamilyHistory"),be=g("ReviewOfSystems"),_e=g("PhysicalExamination"),Pe=g("Summary"),He=g("DifferentialDiagnosis"),we=g("Investigation"),Ce=g("ManagementPlan");return j(),U(w(Ee),null,{default:B(()=>[o(Ke),o(w(ke),{fullscreen:!0},{default:B(()=>[o(at),r("div",mt,[R.value?(j(),U(it,{key:0,ref:"wizard",headingTitle:"Medical Inpatient Admission Sheet","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:V.value,"custom-tabs":i.value,beforeChange:w(X),onChange:De,"onComplete:wizard":t[1]||(t[1]=xe=>W()),onDoneButtonChanged:ve},{default:B(()=>[r("div",null,[r("div",gt,[o(qe,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:w(Be),"font-weight":"600",onClick:t[0]||(t[0]=xe=>de())},null,8,["icon"])])]),v(r("div",null,[o(s,{ref:"presentingComplaintsRef"},null,512)],512),[[d,u()=="PresentingComplaints"]]),v(r("div",null,[o(m,{ref:"drugHistoryRef"},null,512)],512),[[d,u()=="DrugHistory"]]),v(r("div",null,[o(a,{ref:"pastMedicalHistoryRef"},null,512)],512),[[d,u()=="PastMedicalHistory"]]),v(r("div",null,[o(c,{ref:"pastSurgicalHistoryRef"},null,512)],512),[[d,u()=="PastSurgicalHistory"]]),v(r("div",null,[o(n,{ref:"allergyRef"},null,512)],512),[[d,u()=="Allergy"]]),v(r("div",null,[o(b,{ref:"IntoxicationRef"},null,512)],512),[[d,u()=="Intoxication"]]),v(r("div",null,[o(F,{ref:"socialHistoryRef"},null,512)],512),[[d,u()=="SocialHistory"]]),v(r("div",null,[o(he,{ref:"familyHistoryRef"},null,512)],512),[[d,u()=="FamilyHistory"]]),v(r("div",null,[o(be,{ref:"reviewOfSystemsRef"},null,512)],512),[[d,u()=="ReviewOfSystems"]]),v(r("div",null,[o(_e,{ref:"physicalExaminationRef"},null,512)],512),[[d,u()=="PhysicalExamination"]]),v(r("div",null,[o(Pe,{ref:"summaryRef"},null,512)],512),[[d,u()=="Summary"]]),v(r("div",null,[o(He,{ref:"differentialDiagnosisRef"},null,512)],512),[[d,u()=="DifferentialDiagnosis"]]),v(r("div",null,[o(we,{ref:"investigationRef"},null,512)],512),[[d,u()=="Investigation"]]),v(r("div",null,[o(Ce,{ref:"managementPlanRef"},null,512)],512),[[d,u()=="ManagementPlan"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Fe("",!0)])]),_:1})]),_:1})}}});export{Vt as default};

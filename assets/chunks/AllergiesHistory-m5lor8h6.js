import{d as S,bh as A,cr as D,r as n,w as u,e as i,f as c,l as E,H as k,k as p,F as x,T as H,I as T,u as B,bl as _,cY as N}from"./vendor-CJ2tyHrn.js";import{u as F,K as I,H as O,_ as V}from"../index-CPIhguZJ.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-BtvCa6MI.js";const q={class:"table-responsive"},C=S({__name:"AllergiesHistory",setup(R){const f=F(),{patient:b}=A(f),y=D(),v=n(null),r=n([]),g=n(["Allergy","Date","Status"]),m=n({responsive:!0,select:!1,layout:{topStart:"",topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1}),h=s=>{const a=new Map;return s.forEach(t=>{const e="".concat(t.value_coded,"_").concat(t.value_text);if(!a.has(e))a.set(e,t);else{const o=a.get(e);t.obs_id&&o.obs_id?t.obs_id>o.obs_id&&a.set(e,t):t.obs_datetime&&o.obs_datetime&&new Date(t.obs_datetime)>new Date(o.obs_datetime)&&a.set(e,t)}}),Array.from(a.values())},d=async()=>{try{r.value=[];const s=await I.getObsByEncounterId(30);if(s&&Array.isArray(s)){let a=[];s.forEach(e=>{if(e.obs&&Array.isArray(e.obs)){const o=e.obs.map(l=>({...l,encounterStatus:e.status}));a=a.concat(o)}}),h(a).forEach(e=>{const o=e.value_text||"Unknown Allergy",l=e.obs_datetime?O.toStandardHisDisplayFormat(e.obs_datetime):"N/A",w=e.encounterStatus==="saved"||e.obs_id!==void 0&&e.obs_id!==null?'<span style="color: #046c04; font-weight: bold;">Saved</span>':'<span style="color: #ff9800; font-weight: bold;">Unsaved</span>';r.value.push([o,l,w])})}}catch(s){console.error("Error updating allergy data:",s),r.value=[]}_.use(N)};return u(()=>y,async()=>{await d()},{deep:!0}),u(b,async()=>{await d()},{deep:!0,immediate:!0}),(s,a)=>(c(),i("div",q,[E(B(_),{ref_key:"dataTable",ref:v,options:m.value,data:r.value,class:"display nowrap modern-table",width:"100%"},{default:k(()=>[p("thead",null,[p("tr",null,[(c(!0),i(x,null,H(g.value,t=>(c(),i("th",{key:t},T(t),1))),128))])])]),_:1},8,["options","data"])]))}}),W=V(C,[["__scopeId","data-v-d41a33e8"]]);export{W as default};

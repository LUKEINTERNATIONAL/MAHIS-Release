import{d as S,r as g,eT as x,w as v,e as A,f as O,l as f,u as l,a as j,J as I,k as N,L as V,aH as k,N as B,Q as J,D as U,a3 as H,a6 as W,ao as E,aV as G,eU as L,H as D,O as M}from"./vendor-hvlGrBh_.js";import{aC as y,_ as F,a0 as K,H as z,T as Q,u as q,t as C,G as X,s as Y}from"../index-rqBQVC3E.js";import{m as d,o as P,p as Z,N as ee}from"./NeonatalStepper-Bor2kG1e.js";import{N as te}from"./neonatal_service-BraZwFaC.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-BtPTSgal.js";import"./SaveProgressModal-BSlCW3to.js";import"./images-DJIykHYW.js";import"./enrollment-DU-PLRUa.js";const se={class:"admission-outcome-wrapper"},oe=S({__name:"AdmissionOutcomeSection",setup(o,{expose:u}){const s=g(null),n=d[0],m=n.formData,p=n.subtitle,r=x(P),i=t=>{r&&(r.admissionOutcome=t.admissionOutcome||"")};return v(()=>{var t;return(t=s.value)==null?void 0:t.formValues},t=>{t&&i(t)},{deep:!0}),v(()=>s.value,t=>{t!=null&&t.getFormValues&&i(t.getFormValues())},{immediate:!0}),u({getFormRef:()=>s.value,validateForm:()=>{var t,e;return((e=(t=s.value)==null?void 0:t.validateForm)==null?void 0:e.call(t))||null},getFormValues:()=>{var t,e;return((e=(t=s.value)==null?void 0:t.getFormValues)==null?void 0:e.call(t))||{}}}),(t,e)=>(O(),A("div",se,[f(y,{formData:l(m),subtitle:l(p),ref_key:"formRef",ref:s,class:"main-form"},null,8,["formData","subtitle"])]))}}),R=F(oe,[["__scopeId","data-v-b2ea5105"]]),ae={class:"safeguard-concerns-wrapper"},ne=S({__name:"SafeguardConcernsSection",setup(o,{expose:u}){const s=g(null),n=d[1],m=n.formData,p=n.subtitle;return u({getFormRef:()=>s.value,validateForm:()=>null,getFormValues:()=>({})}),(r,i)=>(O(),A("div",ae,[f(y,{formData:l(m),subtitle:l(p),ref_key:"formRef",ref:s,class:"main-form"},null,8,["formData","subtitle"])]))}}),w=F(ne,[["__scopeId","data-v-2dda68fa"]]),ie={class:"admission-signoff-wrapper"},re=S({__name:"AdmissionSignOffSection",setup(o,{expose:u}){const s=g(null),n=d[2],m=n.formData,p=n.subtitle,r=x(P),i=K();j(()=>{if(s.value&&i.user){const e=s.value.getFormValues();e.healthcareWorkerId=i.user.username||"";const _=[i.user.given_name,i.user.family_name].filter(Boolean).join(" ")||i.user.username||"";e.electronicSignature=_,e.userRole=i.user.user_type||"Medical Doctor",e.signOffDate=z.currentDate()}});const t=e=>{r&&(r.healthcareWorkerId=e.healthcareWorkerId||"",r.electronicSignature=e.electronicSignature||"",r.userRole=e.userRole||"",r.signOffDate=e.signOffDate||"")};return v(()=>{var e;return(e=s.value)==null?void 0:e.formValues},e=>{e&&t(e)},{deep:!0}),v(()=>s.value,e=>{e!=null&&e.getFormValues&&t(e.getFormValues())},{immediate:!0}),u({getFormRef:()=>s.value,validateForm:()=>{var e,_;return((_=(e=s.value)==null?void 0:e.validateForm)==null?void 0:_.call(e))||null},getFormValues:()=>{var e,_;return((_=(e=s.value)==null?void 0:e.getFormValues)==null?void 0:_.call(e))||{}}}),(e,_)=>(O(),A("div",ie,[f(y,{formData:l(m),subtitle:l(p),ref_key:"formRef",ref:s,class:"main-form"},null,8,["formData","subtitle"])]))}}),T=F(re,[["__scopeId","data-v-086b4bcc"]]),ce={class:"print-summary-wrapper"},me={class:"print-content"},ue={class:"print-icon-container"},le={class:"print-actions"},de=S({__name:"PrintSummarySection",setup(o,{expose:u}){const s=g(null),n=d[3],m=n.formData,p=n.subtitle,r=()=>{window.print()};return u({getFormRef:()=>s.value,validateForm:()=>null,getFormValues:()=>({})}),(i,t)=>(O(),A("div",ce,[f(y,{formData:l(m),subtitle:l(p),ref_key:"formRef",ref:s,class:"main-form"},{printSection:I(()=>[N("div",me,[N("div",ue,[f(l(V),{icon:l(k),class:"print-icon"},null,8,["icon"])]),N("div",le,[f(l(B),{expand:"block",color:"primary",onClick:r,class:"print-button"},{default:I(()=>[f(l(V),{icon:l(k),slot:"start"},null,8,["icon"]),t[0]||(t[0]=J(" Print Admission Summary ",-1))]),_:1})])])]),_:1},8,["formData","subtitle"])]))}}),$=F(de,[["__scopeId","data-v-f2afb3bb"]]),b=()=>JSON.parse(JSON.stringify(Z)),pe=U("neonatalAdmissionOutcomesStore",{state:()=>({activePatientId:null,admissionOutcomesForm:b(),admissionOutcomesFormCache:{}}),getters:{getActivePatientId(){return this.activePatientId}},actions:{initializeAdmissionOutcomesForm(o){if(o==null){this.activePatientId=null,Object.assign(this.admissionOutcomesForm,b());return}this.activePatientId=o;const u=this.admissionOutcomesFormCache[String(o)];u?Object.assign(this.admissionOutcomesForm,u):Object.assign(this.admissionOutcomesForm,b()),this.saveAdmissionOutcomesSnapshot()},saveAdmissionOutcomesSnapshot(){this.activePatientId!=null&&(this.admissionOutcomesFormCache[String(this.activePatientId)]=JSON.parse(JSON.stringify(this.admissionOutcomesForm)))},resetAdmissionOutcomesForm(){Object.assign(this.admissionOutcomesForm,b()),this.saveAdmissionOutcomesSnapshot()},clearAdmissionOutcomesForm(o){delete this.admissionOutcomesFormCache[String(o)],this.activePatientId===o&&this.resetAdmissionOutcomesForm()}},persist:{paths:["activePatientId","admissionOutcomesForm","admissionOutcomesFormCache"]}}),fe=S({name:"NeonatalAdmissionOutcomes",components:{IonPage:W,IonContent:H,Toolbar:Q,NeonatalStepper:ee,AdmissionOutcomeSection:R,SafeguardConcernsSection:w,AdmissionSignOffSection:T,PrintSummarySection:$},setup(){const o=E(),u=q(),{patient:s}=G(u),n=g(!1),m=pe(),p=c=>{const a=Number(c);return Number.isFinite(a)?a:null},r=()=>{var a;const c=p((a=s.value)==null?void 0:a.patientID);m.initializeAdmissionOutcomesForm(c)};r(),v(()=>{var c;return(c=s.value)==null?void 0:c.patientID},()=>r());const i=m.admissionOutcomesForm;L(P,i),v(()=>m.admissionOutcomesForm,()=>m.saveAdmissionOutcomesSnapshot(),{deep:!0});const t=g(d.map((c,a)=>({title:c.title,number:a+1,checked:!1,class:a===0?"open_step common_step":"common_step",last_step:a===d.length-1?"last_step":""}))),e=[{title:d[0].title,value:"1",component:R,configIndex:0},{title:d[1].title,value:"2",component:w,configIndex:1},{title:d[2].title,value:"3",component:T,configIndex:2,buttonText:"SIGN"},{title:d[3].title,value:"4",component:$,configIndex:3}];return{router:o,patient:s,admissionOutcomesFormData:i,stepperTitle:"Admission Outcomes",currentOpenStepper:"1",wizardData:t,stepperData:e,updateStatus:c=>{c&&c.value&&t.value.forEach((a,h)=>{c.value===(h+1).toString()?(a.class="open_step common_step",a.checked=!1):h<parseInt(c.value)-1?(a.class="common_step color_white",a.checked=!0):(a.class="common_step",a.checked=!1)})},getSaveFunction:c=>c===e.length-1?async()=>{var a;if(!((a=s.value)!=null&&a.patientID)){C("No patient selected");return}if(!n.value)try{if(n.value=!0,!i.admissionOutcome){C("Please select an admission outcome"),n.value=!1;return}await te.saveAdmissionOutcomes(s.value.patientID,i,z.sessionDate()),X("Admission outcomes saved successfully"),m.clearAdmissionOutcomesForm(s.value.patientID),o.push({name:"neonatalPatientProfile"})}catch(h){console.error("Failed to save admission outcomes",h),Y("Failed to save admission outcomes. Please try again."),n.value=!1}}:null,isSaving:n,neonatalAdmissionOutcomesSections:d}}});function _e(o,u,s,n,m,p){const r=D("Toolbar"),i=D("NeonatalStepper"),t=D("ion-content"),e=D("ion-page");return O(),M(e,{class:"neonatal-admission-outcomes-page"},{default:I(()=>[f(r),f(t,{fullscreen:!0},{default:I(()=>[f(i,{wizardData:o.wizardData,StepperData:o.stepperData,stepperTitle:o.stepperTitle,openStepper:o.currentOpenStepper,backUrl:"/patientProfile",getSaveFunction:o.getSaveFunction,flowType:"admissionOutcomes",sectionsConfig:o.neonatalAdmissionOutcomesSections,useSkipLogic:!0,onUpdateStatus:o.updateStatus},null,8,["wizardData","StepperData","stepperTitle","openStepper","getSaveFunction","sectionsConfig","onUpdateStatus"])]),_:1})]),_:1})}const ye=F(fe,[["render",_e],["__scopeId","data-v-780323dd"]]);export{ye as default};

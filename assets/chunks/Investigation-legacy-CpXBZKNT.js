System.register(["./vendor-legacy-h4cyiMXU.js","../index-legacy-DA1Px0Bm.js","./NeonatalStepper-legacy-CgeF0YY_.js","./EnterLabResultsModal-legacy-DJRm_aj9.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-CRcfwVwU.js","./SaveProgressModal-legacy-B28PSln9.js","./images-legacy-CpQcoUy5.js","./enrollment-legacy-BWFKsMdA.js"],function(e,a){"use strict";var t,l,s,n,i,o,r,d,c,u,v,p,g,m,f,b,_,h,x,y,w,k,S,z,D,C,I,T,O,j,L,N,$,F,R,A,P,M,E,J,W,q,G,U,V,B,H,K,Q;return{setters:[e=>{t=e.d,l=e.b2,s=e.am,n=e.r,i=e.c,o=e.w,r=e.a,d=e.e,c=e.f,u=e.k,v=e.l,p=e.m,g=e.J,m=e.u,f=e.ad,b=e.Q,_=e.ac,h=e.F,x=e.P,y=e.O,w=e.K,k=e.N,S=e.L,z=e.dh,D=e.I,C=e.G,I=e.E,T=e.aW,O=e.ab,j=e.bo,L=e.p,N=e.da,$=e.ae},e=>{F=e.u,R=e.n,A=e.x,P=e.S,M=e.g,E=e.O,J=e.z,W=e.ao,q=e.o,G=e.I,U=e.t,V=e._,B=e.T},e=>{H=e.y,K=e.N},e=>{Q=e.E},null,null,null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".lab-orders[data-v-8cc78aa7]{background:#fff}.lab-orders__header[data-v-8cc78aa7]{padding:15px 10px;height:51px;background:#fedf89;color:#000;font-size:18px;font-weight:600;margin-top:10px}.lab-orders__section[data-v-8cc78aa7]{margin-bottom:2rem}.section-title[data-v-8cc78aa7]{font-weight:700;color:#000;margin-bottom:1rem}.table-header[data-v-8cc78aa7]{font-weight:700;border-bottom:2px solid #e0e0e0;padding-bottom:.5rem;margin-bottom:.5rem}.table-row[data-v-8cc78aa7]{padding:8px;border-radius:5px;margin-bottom:.5rem}.table-row--completed[data-v-8cc78aa7]{background-color:#bbddbc}.result-text-value[data-v-8cc78aa7]{font-weight:600;color:#2e7d32;padding:8px 0}.view-results-btn[data-v-8cc78aa7]{--color: #3880ff;font-weight:600;--padding-start: 0}.see-more-container[data-v-8cc78aa7]{text-align:center;margin-top:10px}.report-content[data-v-8cc78aa7]{--background: #f4f5f8}.report-card[data-v-8cc78aa7]{background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.05)}.report-header[data-v-8cc78aa7]{padding:20px;border-bottom:1px solid #eee}.report-title-row[data-v-8cc78aa7]{display:flex;justify-content:space-between;align-items:center}.status-badge[data-v-8cc78aa7]{background:#e8f5e9;color:#2e7d32;padding:4px 12px;border-radius:16px;font-size:.75rem;font-weight:600}.results-table[data-v-8cc78aa7]{padding:10px 20px 20px}.results-table-header[data-v-8cc78aa7]{display:flex;padding:12px 0;border-bottom:2px solid #f0f0f0;font-weight:700;color:#999}.results-table-row[data-v-8cc78aa7]{display:flex;padding:16px 0;border-bottom:1px solid #f9f9f9}.col-indicator[data-v-8cc78aa7],.indicator-name[data-v-8cc78aa7]{flex:1.5}.col-value[data-v-8cc78aa7],.indicator-value[data-v-8cc78aa7]{flex:1;font-weight:600}.form-actions[data-v-8cc78aa7]{margin-top:50px}.custom_card[data-v-5b0664b2]{background:#fff;border-radius:12px;padding:16px;margin:12px;box-shadow:0 2px 8px rgba(0,0,0,.05);border:1px solid #f0f0f0}.section-title[data-v-5b0664b2]{font-size:.9rem;font-weight:700;color:#666;text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px}.investigation-list[data-v-5b0664b2]{display:flex;flex-direction:column;gap:12px}.investigation-item[data-v-5b0664b2]{padding-bottom:10px;border-bottom:1px solid #f9f9f9}.investigation-item[data-v-5b0664b2]:last-child{border-bottom:none}.item-main[data-v-5b0664b2]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.test-name[data-v-5b0664b2]{font-weight:600;color:#333}.test-date[data-v-5b0664b2]{font-size:.75rem;color:#999}.result-badge[data-v-5b0664b2]{display:inline-block;padding:2px 8px;border-radius:4px;font-size:.75rem;font-weight:700;text-transform:capitalize}.result-pos[data-v-5b0664b2]{background:#fee2e2;color:#b91c1c}.result-neg[data-v-5b0664b2]{background:#dcfce7;color:#15803d}.result-neutral[data-v-5b0664b2]{background:#f3f4f6;color:#374151}.more-results[data-v-5b0664b2]{font-size:.7rem;color:#3880ff;margin-left:8px;font-style:italic}.waiting-grid[data-v-5b0664b2]{display:flex;flex-wrap:wrap;gap:8px}.waiting-item[data-v-5b0664b2]{display:flex;align-items:center;background:#fffbeb;border:1px solid #fef3c7;padding:6px 12px;border-radius:20px;gap:6px}.pending-icon[data-v-5b0664b2]{color:#d97706;font-size:1rem}.waiting-test-name[data-v-5b0664b2]{font-size:.85rem;font-weight:600;color:#92400e}\n/*$vite$:1*/",document.head.appendChild(a);const Y={class:"lab-orders"},X={class:"ion-padding"},Z={key:0,class:"lab-orders__section"},ee={key:0},ae={key:1,class:"result-text-value"},te={key:0,class:"see-more-container"},le={key:1,class:"lab-orders__section"},se={key:0,class:"see-more-container"},ne={class:"lab-orders__section"},ie={key:0,class:"report-card"},oe={class:"report-header"},re={class:"report-title-row"},de={class:"report-meta"},ce={key:0},ue={class:"results-table"},ve={class:"indicator-name"},pe={class:"indicator-value"},ge=V(t({__name:"Investigation",setup(e){const a=F(),{patient:t}=l(a),L=s(),N=n([]),$=n(),V=n([]),B=n([]),H=n(""),K=n(!1),ge=n(!1),me=n(null),fe=n(null),be=n({}),_e=n(!1),he=n(!1),xe=i(()=>N.value?N.value.filter(e=>{var a;return null===(a=e.tests)||void 0===a?void 0:a.some(e=>e.result&&e.result.length>0)}):[]),ye=i(()=>N.value?N.value.filter(e=>{var a;return null===(a=e.tests)||void 0===a?void 0:a.every(e=>!e.result||0===e.result.length)}):[]),we=i(()=>_e.value?xe.value:xe.value.slice(0,3)),ke=i(()=>he.value?ye.value:ye.value.slice(0,3)),Se=i(()=>[{componentType:"multiSelectInputField",name:"test",header:"Test",options:V.value,grid:{s:"6"},openDirection:"top",validation:A.required,icon:R.search,onChange:e=>H.value=(null==e?void 0:e.name)||""},{componentType:"multiSelectInputField",name:"specimen",header:"Specimen",obsValueType:"value_text",grid:{s:"6"},icon:R.search,openDirection:"top",validation:A.required,value:1===B.value.length?B.value[0]:"",options:B.value.length>1?B.value:[]}]);function ze(e){if(!e)return"N/A";const a=new Date(e);return`${String(a.getDate()).padStart(2,"0")}/${String(a.getMonth()+1).padStart(2,"0")}/${String(a.getFullYear()).slice(-2)} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`}function De(){ge.value=!1,me.value=null,fe.value=null}const Ce=async()=>{if(!$.value||$.value.validateForm())return;const e=$.value.getFormValues(),a=[{concept_id:e.test.concept_id,name:e.test.name,specimen:e.specimen.name,reason:"Routine",specimenConcept:await W.getConceptID(e.specimen.name,!0)}];await Ie(a)},Ie=async e=>{try{var a,l,s,n,i;K.value=!0;const o=await E.buildLabOrders("",e);console.log("ðŸš€ ~ saveTest ~ patient.value:",t.value);const r=JSON.parse(JSON.stringify(t.value));null!==(l=(a=null!==(s=r.labOrders)&&void 0!==s?s:r.labOrders={}).unsaved)&&void 0!==l||(a.unsaved=[]),r.labOrders.unsaved.push(...o),console.log("ðŸš€ ~ saveTest ~ patientData.labOrders.unsaved:",r.labOrders.unsaved),await G(r),await Te(),await L.push("/neonatal/checkpoint"),$.value&&(null===(n=(i=$.value).resetForm)||void 0===n||n.call(i))}catch(o){console.log("ðŸš€ ~ saveTest ~ error:",o),U("Failed to save test")}finally{K.value=!1}};async function Te(){const e=t.value;N.value=null!=e&&e.labOrders?[...e.labOrders.saved||[],...e.labOrders.unsaved||[]]:[]}return o(H,async e=>{B.value=e?await async function(e){const a=P.getPouchDbStatus()||P.getLanConnectionStatus()?await M("specimens"):await E.getSpecimens("",1e3);return await W.getConceptSet(e,"",{names:a.map(e=>e.name)})}(e):[]}),o(()=>t,async()=>{await Te()},{deep:!0}),r(async()=>{const e=P.getPouchDbStatus()||P.getLanConnectionStatus();V.value=e?await M("test_types"):await E.getTestTypes(),await Te()}),(e,a)=>(c(),d("div",Y,[a[21]||(a[21]=u("header",{class:"lab-orders__header"},"Lab Orders",-1)),u("div",X,[xe.value&&xe.value.length>0?(c(),d("section",Z,[a[6]||(a[6]=u("h6",{class:"section-title"},"Past Investigations",-1)),v(m(_),{class:"table-header"},{default:g(()=>[v(m(f),{size:"3"},{default:g(()=>[...a[2]||(a[2]=[b("Date",-1)])]),_:1}),v(m(f),{size:"3"},{default:g(()=>[...a[3]||(a[3]=[b("Test",-1)])]),_:1}),v(m(f),{size:"3"},{default:g(()=>[...a[4]||(a[4]=[b("Specimen",-1)])]),_:1}),v(m(f),{size:"3"},{default:g(()=>[...a[5]||(a[5]=[b("Result",-1)])]),_:1})]),_:1}),(c(!0),d(h,null,x(we.value,e=>(c(),y(m(_),{key:`past-${e.order_id}`,class:"table-row table-row--completed"},{default:g(()=>[v(m(f),{size:"3"},{default:g(()=>[b(w(ze(e.order_date)),1)]),_:2},1024),v(m(f),{size:"3"},{default:g(()=>[(c(!0),d(h,null,x(e.tests,e=>(c(),d("div",{key:e.id,class:"test-item"},w(e.name),1))),128))]),_:2},1024),v(m(f),{size:"3"},{default:g(()=>{var a;return[b(w((null===(a=e.specimen)||void 0===a?void 0:a.name)||"N/A"),1)]}),_:2},1024),v(m(f),{size:"3"},{default:g(()=>[(c(!0),d(h,null,x(e.tests,a=>(c(),d("div",{key:a.id},[a.result&&a.result.length>0?(c(),d("div",ee,[a.result.length>1?(c(),y(m(k),{key:0,fill:"clear",size:"small",onClick:t=>async function(e,a){if(me.value=e,fe.value=a,ge.value=!0,a.result)for(const t of a.result){const e=t.indicator.concept_id;if(!be.value[e]){const a=await W.getConceptName(e);be.value[e]="object"==typeof a?a.name||a.display:a}}}(e,a),class:"view-results-btn"},{default:g(()=>[v(m(S),{icon:m(z),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])):(c(),d("div",ae,w(a.result[0].value),1))])):p("",!0)]))),128))]),_:2},1024)]),_:2},1024))),128)),xe.value.length>3?(c(),d("div",te,[v(m(k),{fill:"clear",size:"small",onClick:a[0]||(a[0]=e=>_e.value=!_e.value)},{default:g(()=>[b(w(_e.value?"See Less":"See More"),1)]),_:1})])):p("",!0)])):p("",!0),ye.value&&ye.value.length>0?(c(),d("section",le,[a[13]||(a[13]=u("h6",{class:"section-title"},"Investigations Waiting Results",-1)),v(m(_),{class:"table-header"},{default:g(()=>[v(m(f),{size:"2.4"},{default:g(()=>[...a[7]||(a[7]=[b("Date",-1)])]),_:1}),v(m(f),{size:"2.4"},{default:g(()=>[...a[8]||(a[8]=[b("Test",-1)])]),_:1}),v(m(f),{size:"2.4"},{default:g(()=>[...a[9]||(a[9]=[b("Specimen",-1)])]),_:1}),v(m(f),{size:"2.4"},{default:g(()=>[...a[10]||(a[10]=[b("Accession #",-1)])]),_:1}),v(m(f),{size:"2.4"},{default:g(()=>[...a[11]||(a[11]=[b("Action",-1)])]),_:1})]),_:1}),(c(!0),d(h,null,x(ke.value,e=>(c(),y(m(_),{key:`pending-${e.order_id}`,class:"table-row"},{default:g(()=>[v(m(f),{size:"2.4"},{default:g(()=>[b(w(ze(e.order_date)),1)]),_:2},1024),v(m(f),{size:"2.4"},{default:g(()=>[(c(!0),d(h,null,x(e.tests,e=>(c(),d("div",{key:e.id,class:"test-item"},w(e.name),1))),128))]),_:2},1024),v(m(f),{size:"2.4"},{default:g(()=>{var a;return[b(w((null===(a=e.specimen)||void 0===a?void 0:a.name)||"N/A"),1)]}),_:2},1024),v(m(f),{size:"2.4"},{default:g(()=>[b(w(e.accession_number),1)]),_:2},1024),v(m(f),{size:"2.4"},{default:g(()=>[v(m(k),{size:"small",onClick:a=>(async e=>{await q(Q,{class:"large-modal-x10"},!0,{test_data:e})})(e)},{default:g(()=>[...a[12]||(a[12]=[b(" Add Results ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),ye.value.length>3?(c(),d("div",se,[v(m(k),{fill:"clear",size:"small",onClick:a[1]||(a[1]=e=>he.value=!he.value)},{default:g(()=>[b(w(he.value?"See Less":"See More"),1)]),_:1})])):p("",!0)])):p("",!0),u("section",ne,[a[14]||(a[14]=u("h6",{class:"section-title"},"Current Investigations",-1)),v(m(_),{class:"form-row"},{default:g(()=>[v(m(f),{size:"12","size-md":"9"},{default:g(()=>[v(J,{formData:Se.value,ref_key:"formRef",ref:$},null,8,["formData"])]),_:1}),v(m(f),{size:"12","size-md":"3",class:"form-actions"},{default:g(()=>[v(m(k),{expand:"block",onClick:Ce,disabled:K.value},{default:g(()=>[b(w(K.value?"Sending...":"Send Test"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})])]),v(m(j),{"is-open":ge.value,onDidDismiss:De,class:"medium-modal"},{default:g(()=>[v(m(D),null,{default:g(()=>[v(m(C),{color:"light"},{default:g(()=>[v(m(I),null,{default:g(()=>[...a[15]||(a[15]=[b("Laboratory Report",-1)])]),_:1}),v(m(T),{slot:"end"},{default:g(()=>[v(m(k),{onClick:De},{default:g(()=>[...a[16]||(a[16]=[b("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),v(m(O),{class:"ion-padding report-content"},{default:g(()=>{var e;return[me.value&&fe.value?(c(),d("div",ie,[u("div",oe,[u("div",re,[u("h3",null,w(fe.value.name),1)]),u("div",de,[u("p",null,[a[17]||(a[17]=u("strong",null,"Date:",-1)),b(" "+w(ze(me.value.order_date)),1)]),u("p",null,[a[18]||(a[18]=u("strong",null,"Specimen:",-1)),b(" "+w((null===(e=me.value.specimen)||void 0===e?void 0:e.name)||"N/A"),1)]),me.value.accession_number?(c(),d("p",ce,[a[19]||(a[19]=u("strong",null,"Accession #:",-1)),b(" "+w(me.value.accession_number),1)])):p("",!0)])]),u("div",ue,[a[20]||(a[20]=u("div",{class:"results-table-header"},[u("span",{class:"col-indicator"},"Indicator"),u("span",{class:"col-value"},"Result")],-1)),(c(!0),d(h,null,x(fe.value.result,e=>(c(),d("div",{key:e.id,class:"results-table-row"},[u("span",ve,w(be.value[e.indicator.concept_id]||"Loading..."),1),u("span",pe,w(e.value),1)]))),128))])])):p("",!0)]}),_:1})]),_:1},8,["is-open"])]))}}),[["__scopeId","data-v-8cc78aa7"]]),me={key:0,class:"custom_card summary-card"},fe={class:"investigation-list"},be={class:"item-main"},_e={class:"test-name"},he={class:"test-date"},xe={class:"item-results"},ye={key:0},we={key:0,class:"more-results"},ke={key:1,class:"custom_card waiting-card"},Se={class:"waiting-grid"},ze={class:"waiting-test-name"},De=V(t({__name:"InvestigationSummary",setup(e){const a=F(),{patient:t}=l(a),s=i(()=>{var e;return null!==(e=t.value)&&void 0!==e&&e.labOrders?[...t.value.labOrders.saved||[],...t.value.labOrders.unsaved||[]]:[]}),n=i(()=>s.value.filter(e=>{var a;return null===(a=e.tests)||void 0===a?void 0:a.some(e=>e.result&&e.result.length>0)})),o=i(()=>s.value.filter(e=>{var a;return null===(a=e.tests)||void 0===a?void 0:a.every(e=>!e.result||0===e.result.length)})),r=i(()=>n.value.sort((e,a)=>new Date(a.order_date).getTime()-new Date(e.order_date).getTime()).slice(0,5));function g(e){const a=e.toLowerCase();return a.includes("pos")||a.includes("+")?"result-pos":a.includes("neg")||a.includes("-")?"result-neg":"result-neutral"}return(e,a)=>(c(),d(h,null,[r.value.length>0?(c(),d("div",me,[a[0]||(a[0]=u("h6",{class:"section-title"},"Past 5 Investigations",-1)),u("div",fe,[(c(!0),d(h,null,x(r.value,e=>{var a,t;return c(),d("div",{key:e.order_id,class:"investigation-item"},[u("div",be,[u("span",_e,w(null===(a=e.tests[0])||void 0===a?void 0:a.name),1),u("span",he,w((t=e.order_date,new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}))),1)]),u("div",xe,[(c(!0),d(h,null,x(e.tests,e=>(c(),d("div",{key:e.id},[e.result&&e.result.length>0?(c(),d("div",ye,[u("span",{class:L(["result-badge",g(e.result[0].value)])},w(e.result[0].value),3),e.result.length>1?(c(),d("span",we," +"+w(e.result.length-1)+" more ",1)):p("",!0)])):p("",!0)]))),128))])])}),128))])])):p("",!0),o.value.length>0?(c(),d("div",ke,[a[1]||(a[1]=u("h6",{class:"section-title"},"Investigations Waiting Results",-1)),u("div",Se,[(c(!0),d(h,null,x(o.value,e=>{var a;return c(),d("div",{key:e.order_id,class:"waiting-item"},[v(m(S),{icon:m(N),class:"pending-icon"},null,8,["icon"]),u("span",ze,w(null===(a=e.tests[0])||void 0===a?void 0:a.name),1)])}),128))])])):p("",!0)],64))}}),[["__scopeId","data-v-5b0664b2"]]);e("default",t({__name:"Investigation",setup(e){const a=n("1"),t=s(),l=n(H.map((e,a)=>({title:e.title,number:a+1,checked:!1,class:0===a?"open_step common_step":"common_step",last_step:a===H.length-1?"last_step":""}))),i=[ge,De],o=H.map((e,a)=>({title:e.title,subtitle:e.subtitle,value:(a+1).toString(),component:i[a]||ge,configIndex:a})),r=e=>{e&&e.value&&l.value.forEach((a,t)=>{e.value===(t+1).toString()?(a.class="open_step common_step",a.checked=!1):t<parseInt(e.value)-1?(a.class="common_step color_white",a.checked=!0):(a.class="common_step",a.checked=!1)})},d=e=>e===o.length-1?async()=>{t.push("/neonatal/checkpoint")}:()=>Promise.resolve();return(e,t)=>(c(),y(m($),{class:"neonatal-enrollment-page"},{default:g(()=>[v(B),v(m(O),{fullscreen:!0},{default:g(()=>[v(K,{wizardData:l.value,StepperData:m(o),stepperTitle:"Investigations",openStepper:a.value,backUrl:"/patientProfile",getSaveFunction:d,sectionsConfig:m(H),flowType:"investigation","show-componet-title":!0,onUpdateStatus:r},null,8,["wizardData","StepperData","openStepper","sectionsConfig"])]),_:1})]),_:1}))}}))}}});

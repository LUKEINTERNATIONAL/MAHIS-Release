import{d as C,a as O,r as g,H as y,e as M,f as S,k as e,l,J as _,Q as b,u as T,N as K,R as F,cG as Y,w as L,b5 as H,cU as Z,n as tt,O as at,m as et,a3 as st,p as it,a6 as nt}from"./vendor-BpjEhVym.js";import{N as $,L as lt,v as x,G as j,t as k,_ as E,M as P,S as I,l as N,J as ot,m as R,V as rt,o as A,H as X,T as ut}from"../index-CiSAd7V7.js";import{u as dt}from"./StockStore-Dz8l43uv.js";import{u as _t}from"./StartEndDate-qpOM743-.js";import{B as J}from"./BasicForm-C9nvD55q.js";import{v as q}from"./group_validation-CLIPvBLt.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-DMAoEdNS.js";import"./DateInputField-BX75OEyG.js";const pt={class:"pim-cls-1 modal_wrapper"},vt={class:"center text_12"},gt={class:"btnContent"},mt={class:"saveBtn"},ft=C({__name:"AddVillage",props:{taData:Object},setup(h){O(async()=>{});const p=h,f=()=>{F.dismiss()},v=async()=>{if(await q(d.value)){const o=$(d.value,"Village","value").split(","),s=await lt.createAddress({address_type:"Village",addresses:o,parent_location:p.taData.traditional_authority_id});s&&(Promise.all(s.village_data.map(i=>x().postData("ADD_OBJECT_STORE",{storeName:"villages",data:i}))),j("Location added successfully")),f()}else k("Please fill all the required field")},d=g([{data:{rowData:[{colData:[{inputHeader:"Village*",value:"",name:"Village",eventType:"input",alertsErrorMassage:"",validate:!1,required:!0}]}]}}]);return(o,s)=>{const i=y("ion-row");return S(),M("div",pt,[s[3]||(s[3]=e("div",{class:"OtherVitalsHeading"},[e("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add Village")],-1)),e("div",null,[e("div",vt,[l(i,null,{default:_(()=>[l(J,{contentData:d.value},null,8,["contentData"])]),_:1})])]),e("div",gt,[e("div",mt,[l(T(K),{class:"btnText",color:"danger",fill:"solid",onClick:s[0]||(s[0]=u=>f()),style:{"margin-right":"8px"}},{default:_(()=>[...s[1]||(s[1]=[b(" Cancel ",-1)])]),_:1}),l(T(K),{class:"btnText",fill:"solid",onClick:v},{default:_(()=>[...s[2]||(s[2]=[b(" Save ",-1)])]),_:1})])])])}}}),yt=E(ft,[["__scopeId","data-v-c1130c39"]]),Dt={class:"pim-cls-1 modal_wrapper"},Tt={class:"center text_12"},ht={class:"btnContent"},wt={class:"saveBtn"},bt=C({__name:"UpdateVillage",props:{villageData:Object},setup(h){O(async()=>{await f()});const p=h,f=async()=>{P(o.value,"Village","value",p.villageData.name)},v=()=>{F.dismiss()},d=async()=>{if(await q(o.value)){const s=$(o.value,"Village","value"),i=await I.putJson("villages/".concat(p.villageData.village_id),{id:p.villageData.village_id,name:s,ta_id:p.villageData.traditional_authority_id});i&&(x().postData("UPDATE_RECORD",{storeName:"villages",data:i.data,whereClause:{village_id:p.villageData.village_id}}),j("Village updated successfully")),v()}else k("Please fill all the required field")},o=g([{data:{rowData:[{colData:[{inputHeader:"Village*",value:"",name:"Village",eventType:"input",alertsErrorMassage:"",validate:!1,required:!0}]}]}}]);return(s,i)=>{const u=y("ion-row"),m=y("ion-button");return S(),M("div",Dt,[i[3]||(i[3]=e("div",{class:"OtherVitalsHeading"},[e("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add TA")],-1)),e("div",null,[e("div",Tt,[l(u,null,{default:_(()=>[l(J,{contentData:o.value},null,8,["contentData"])]),_:1})])]),e("div",ht,[e("div",wt,[l(m,{class:"btnText",color:"danger",fill:"solid",onClick:i[0]||(i[0]=B=>v()),style:{"margin-right":"8px"}},{default:_(()=>[...i[1]||(i[1]=[b(" Cancel ",-1)])]),_:1}),l(m,{class:"btnText",fill:"solid",onClick:d},{default:_(()=>[...i[2]||(i[2]=[b(" Save ",-1)])]),_:1})])])])}}}),At=E(bt,[["__scopeId","data-v-d790b7fc"]]),St={key:0,class:"spinner-overlay"},xt={class:"container"},Vt={style:{"margin-top":"25px"}},$t={class:"table-responsive"},Nt=C({__name:"ManageVillageModal",props:{taData:Object},setup(h){const p=dt(),f=x(),v=Y(),d=g(null),o=g(!1),s=h,i=g({responsive:!0,select:!1,processing:!0,serverSide:!0,pageLength:10,searching:!0,ajax:async function(n,r){var t;try{o.value=!0;const a=Math.floor(n.start/n.length)+1;let c={traditional_authority_id:s.taData.traditional_authority_id};(t=n.search)!=null&&t.value&&(c.name={$regex:new RegExp(n.search.value,"i")});const D={currentPage:a,itemsPerPage:n.length,selector:c},w=await A("villages",D),Q=await Promise.all(w.records.map(async V=>({name:V.name,actions:'\n                            <button class="btn btn-sm btn-primary edit-btn" data-id=\''.concat(JSON.stringify(V),"'>Edit</button>\n                            <button class=\"btn btn-sm btn-danger delete-btn\" data-id='").concat(JSON.stringify(V),"'>Delete</button>\n                        ")})));r({draw:n.draw,recordsTotal:w.totalCount,recordsFiltered:w.totalCount,data:Q})}catch(a){console.error("Error fetching data:",a),k("An error occurred while loading data."),r({draw:n.draw,recordsTotal:0,recordsFiltered:0,data:[]})}finally{o.value=!1}},columns:[{data:"name"},{data:"actions"}],language:{processing:"Loading...",emptyTable:"No data available",info:"Showing _START_ to _END_ of _TOTAL_ entries",infoEmpty:"Showing 0 to 0 of 0 entries",lengthMenu:"Show _MENU_ entries",loadingRecords:"Loading...",search:"Search:",zeroRecords:"No matching records found"}});function u(){F.dismiss("dismiss")}const m=(n=!0)=>{d.value.dt.ajax.reload(null,n)},B=async()=>{const n=JSON.parse(JSON.stringify(s.taData));await R(yt,{class:"fullScreenModal"},!0,{taData:n}),m(!1)},U=async(n,r)=>{await rt("Do you want to delete village ".concat(n.name," ?"),r)&&z(n)},z=async n=>{const r=await I.delete("villages/".concat(n.village_id),{id:n.village_id});(r==null?void 0:r.message)=="Village successfully deleted"&&await f.postData({command:"deleteData",storeName:"villages",data:{village_id:n.village_id}}),m(!1)};L(()=>p.stock,async()=>{const n=d.value.dt;n==null||n.ajax.reload()},{deep:!0}),L(()=>v,async()=>{const n=d.value.dt;n==null||n.ajax.reload()},{deep:!0});const W=async n=>{await R(At,{class:"fullScreenModal"},!0,{villageData:n}),m(!1)},G=()=>{const n=d.value.dt;n.on("click",".edit-btn",r=>{const t=r.target.getAttribute("data-id");t&&W(JSON.parse(t))}),n.on("click",".delete-btn",r=>{const t=r.target.getAttribute("data-id");t&&U(JSON.parse(t),r)})};return O(()=>{H.use(Z),tt(()=>{G()})}),(n,r)=>{const t=y("ion-spinner"),a=y("ion-title"),c=y("ion-icon"),D=y("ion-header");return S(),at(T(nt),{class:it({loading:o.value})},{default:_(()=>[o.value?(S(),M("div",St,[l(t,{name:"bubbles"}),r[2]||(r[2]=e("div",{class:"loading-text"},"Please wait...",-1))])):et("",!0),l(D,{style:{display:"flex","justify-content":"space-between"}},{default:_(()=>[l(a,{class:"modalTitle"},{default:_(()=>[...r[3]||(r[3]=[b("Village Management",-1)])]),_:1}),l(c,{onClick:r[0]||(r[0]=w=>u()),style:{"padding-top":"10px","padding-right":"10px"},icon:T(N).cancel},null,8,["icon"])]),_:1}),l(T(st),{style:{"--background":"#fff"}},{default:_(()=>[e("div",xt,[e("div",Vt,[l(ot,{style:{height:"45px"},name:" Add Village",size:"small",iconSlot:"start",icon:T(N).plusWhite,onClick:r[1]||(r[1]=w=>B())},null,8,["icon"])]),e("div",$t,[l(T(H),{ref_key:"dataTableRef",ref:d,options:i.value,class:"display nowrap",width:"100%"},{default:_(()=>[...r[4]||(r[4]=[e("thead",null,[e("tr",null,[e("th",null,"Villages"),e("th",null,"Action")])],-1)])]),_:1},8,["options"])])])]),_:1})]),_:1},8,["class"])}}}),Ct=E(Nt,[["__scopeId","data-v-0609d13b"]]),Ot={class:"pim-cls-1 modal_wrapper"},Mt={class:"center text_12"},kt={class:"btnContent"},Et={class:"saveBtn"},Bt=C({__name:"AddTA",setup(h){O(async()=>{await p()});const p=async()=>{P(d.value,"TA_district","multiSelectData",await A("districts",{selector:{region_id:{$ne:4}}}))},f=()=>{F.dismiss()},v=async()=>{if(await q(d.value)){const o=$(d.value,"TA","value"),s=$(d.value,"Village","value").split(","),i=$(d.value,"TA_district","value").district_id,u=await lt.createAddress({address_type:"Village",addresses:s,parent_location:i,ta_name:o});u&&(x().postData("ADD_OBJECT_STORE",{storeName:"TAs",data:u.ta_data}),Promise.all(u.village_data.map(m=>x().postData("ADD_OBJECT_STORE",{storeName:"villages",data:m}))),j("Location added successfully")),f()}else k("Please fill all the required field")},d=g([{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"District*",icon:N.search,value:"",name:"TA_district",setName:"TALocation",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,popOver:!0,trackBy:"district_id",multiSelectData:[],id:"",idName:"district_id",validationFunctionName:"required"}]}]}},{data:{rowData:[{colData:[{inputHeader:"TA*",value:"",name:"TA",eventType:"input",alertsErrorMassage:"",validationFunctionName:"required"}]}]}},{data:{rowData:[{colData:[{inputHeader:"Village*",value:"",name:"Village",eventType:"input",alertsErrorMassage:"",validate:!1,validationFunctionName:"required"}]}]}}]);return(o,s)=>{const i=y("ion-row"),u=y("ion-button");return S(),M("div",Ot,[s[3]||(s[3]=e("div",{class:"OtherVitalsHeading"},[e("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add TA")],-1)),e("div",null,[e("div",Mt,[l(i,null,{default:_(()=>[l(J,{contentData:d.value},null,8,["contentData"])]),_:1})])]),e("div",kt,[e("div",Et,[l(u,{class:"btnText",color:"danger",fill:"solid",onClick:s[0]||(s[0]=m=>f()),style:{"margin-right":"8px"}},{default:_(()=>[...s[1]||(s[1]=[b(" Cancel ",-1)])]),_:1}),l(u,{class:"btnText",fill:"solid",onClick:v},{default:_(()=>[...s[2]||(s[2]=[b(" Save ",-1)])]),_:1})])])])}}}),Pt=E(Bt,[["__scopeId","data-v-8d012880"]]),Rt={class:"pim-cls-1 modal_wrapper"},Ft={class:"center text_12"},Jt={class:"btnContent"},Lt={class:"saveBtn"},Ht=C({__name:"UpdateTA",props:{taData:Object},setup(h){O(async()=>{await f()});const p=h,f=async()=>{const s=await A("districts",{selector:{district_id:p.taData.district_id}});P(o.value,"TA_district","multiSelectData",await A("districts",{selector:{region_id:{$ne:4}}})),P(o.value,"TA_district","value",s[0]),P(o.value,"TA","value",p.taData.name)},v=()=>{F.dismiss()},d=async()=>{if(await q(o.value)){const s=$(o.value,"TA","value"),i=$(o.value,"TA_district","value").district_id,u=await I.putJson("traditional_authorities/".concat(p.taData.traditional_authority_id),{id:p.taData.traditional_authority_id,name:s,district_id:i});u&&(x().postData("UPDATE_RECORD",{storeName:"TAs",data:u.data,whereClause:{traditional_authority_id:p.taData.traditional_authority_id}}),j("TA updated successfully")),v()}else k("Please fill all the required field")},o=g([{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"District*",icon:N.search,value:"",name:"TA_district",setName:"TALocation",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,popOver:!0,trackBy:"district_id",multiSelectData:[],id:"",idName:"district_id",validationFunctionName:"required"}]}]}},{data:{rowData:[{colData:[{inputHeader:"TA*",value:"",name:"TA",eventType:"input",alertsErrorMassage:"",validationFunctionName:"required"}]}]}}]);return(s,i)=>{const u=y("ion-row"),m=y("ion-button");return S(),M("div",Rt,[i[3]||(i[3]=e("div",{class:"OtherVitalsHeading"},[e("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add TA")],-1)),e("div",null,[e("div",Ft,[l(u,null,{default:_(()=>[l(J,{contentData:o.value},null,8,["contentData"])]),_:1})])]),e("div",Jt,[e("div",Lt,[l(m,{class:"btnText",color:"danger",fill:"solid",onClick:i[0]||(i[0]=B=>v()),style:{"margin-right":"8px"}},{default:_(()=>[...i[1]||(i[1]=[b(" Cancel ",-1)])]),_:1}),l(m,{class:"btnText",fill:"solid",onClick:d},{default:_(()=>[...i[2]||(i[2]=[b(" Save ",-1)])]),_:1})])])])}}}),jt=E(Ht,[["__scopeId","data-v-88377a51"]]),It={key:0,class:"spinner-overlay"},qt={class:"container"},Ut={style:{display:"flex","justify-content":"space-between"}},zt={style:{width:"50%","max-width":"350px"}},Wt={style:{"margin-top":"25px"}},Gt={class:"table-responsive"},Qt=C({__name:"LocationsManagement",setup(h){const p=dt();_t();const f=Y(),v=g(null),d=g(!1);g("all"),g(X.sessionDate()),g(X.sessionDate());const o=g(""),s=g([]),i=async t=>Promise.all(t.map(async a=>{const c=await A("districts",{selector:{district_id:a.district_id}}),D=await A("villages",{selector:{traditional_authority_id:a.traditional_authority_id}});return{ta_id:a.traditional_authority_id,name:a.name,district:c[0].name,villages:'<button class="btn btn-sm btn-primary view-btn" data-id=\''.concat(JSON.stringify(a),"'> View ").concat(D.length,"   </button>"),actions:'\n                    <button class="btn btn-sm btn-primary edit-btn" data-id=\''.concat(JSON.stringify(a),"'>Edit</button>\n                    <button class=\"btn btn-sm btn-danger delete-btn\" data-id='").concat(JSON.stringify(a),"'>Delete</button>\n                ")}})),u=(t=!0)=>{v.value.dt.ajax.reload(null,t)},m=g({responsive:!0,select:!1,processing:!0,serverSide:!0,pageLength:10,searching:!0,ajax:async function(t,a){var c;try{d.value=!0;const D=Math.floor(t.start/t.length)+1;let w={};o.value&&(w.district_id=o.value),(c=t.search)!=null&&c.value&&(w.name={$regex:new RegExp(t.search.value,"i")});const Q={currentPage:D,itemsPerPage:t.length,selector:w},V=await A("traditional_authorities",Q),ct=await i(V.records);a({draw:t.draw,recordsTotal:V.totalCount,recordsFiltered:V.totalCount,data:ct})}catch(D){console.error("Error fetching data:",D),k("An error occurred while loading data."),a({draw:t.draw,recordsTotal:0,recordsFiltered:0,data:[]})}finally{d.value=!1}},columns:[{data:"ta_id"},{data:"name"},{data:"district"},{data:"villages"},{data:"actions"}],language:{processing:"Loading...",emptyTable:"No data available",info:"Showing _START_ to _END_ of _TOTAL_ entries",infoEmpty:"Showing 0 to 0 of 0 entries",lengthMenu:"Show _MENU_ entries",loadingRecords:"Loading...",search:"Search:",zeroRecords:"No matching records found"}}),B=async t=>{await R(Ct,{class:"fullScreenModal"},!0,{taData:t})==="dismiss"&&u(!1)},U=async t=>{var a;o.value=(a=t==null?void 0:t.value)==null?void 0:a.district_id,u()},z=async(t,a)=>{const c=JSON.parse(t);await rt("Do you want to delete TA ".concat(c.name," ?"),a)&&W(c)},W=async t=>{const a=await I.delete("traditional_authorities/".concat(t.traditional_authority_id),{id:t.traditional_authority_id});(a==null?void 0:a.message)=="Traditional Authority and associated villages successfully deleted"&&(x().postData({command:"deleteData",storeName:"traditional_authorities",data:{traditional_authority_id:t.traditional_authority_id}}),x().postData({command:"deleteData",storeName:"villages",data:{traditional_authority_id:t.traditional_authority_id}})),u(!1)},G=async()=>{await R(Pt,{class:"otherVitalsModal"}),u(!1)},n=async t=>{await R(jt,{class:"otherVitalsModal"},!0,{taData:t}),u(!1)};L(()=>p.stock,async()=>{const t=v.value.dt;t==null||t.ajax.reload()},{deep:!0}),L(()=>f,async t=>{if(t.name=="LocationsManagement"){const a=v.value.dt;a==null||a.ajax.reload()}},{deep:!0});const r=()=>{const t=v.value.dt;t.on("click",".edit-btn",a=>{const c=a.target.getAttribute("data-id");c&&n(JSON.parse(c))}),t.on("click",".delete-btn",a=>{const c=a.target.getAttribute("data-id");c&&z(c,a)}),t.on("click",".view-btn",a=>{const c=a.target.getAttribute("data-id");c&&B(JSON.parse(c))})};return O(async()=>{s.value=[{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"Filter by districts",popOver:!0,icon:N.search,value:"",name:"filter_district",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,trackBy:"district_id",multiSelectData:await A("districts",{selector:{region_id:{$ne:4}}}),id:"",idName:"district_id"}]}]}}],H.use(Z),tt(()=>{r()})}),(t,a)=>{const c=y("ion-spinner");return S(),at(T(nt),{class:it({loading:d.value})},{default:_(()=>[d.value?(S(),M("div",It,[l(c,{name:"bubbles"}),a[1]||(a[1]=e("div",{class:"loading-text"},"Please wait...",-1))])):et("",!0),l(ut),l(T(st),null,{default:_(()=>[e("div",qt,[a[3]||(a[3]=e("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"TA Management",-1)),e("div",Ut,[e("div",zt,[l(J,{contentData:s.value,"onUpdate:inputValue":U},null,8,["contentData"])]),e("div",Wt,[l(ot,{style:{height:"45px"},name:" Add TA",size:"small",iconSlot:"start",icon:T(N).plusWhite,onClick:a[0]||(a[0]=D=>G())},null,8,["icon"])])]),e("div",Gt,[l(T(H),{ref_key:"dataTableRef",ref:v,options:m.value,class:"display nowrap",width:"100%"},{default:_(()=>[...a[2]||(a[2]=[e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"TA"),e("th",null,"District"),e("th",null,"Villages"),e("th",null,"Action")])],-1)])]),_:1},8,["options"])])])]),_:1})]),_:1},8,["class"])}}}),na=E(Qt,[["__scopeId","data-v-a96719ae"]]);export{na as default};

!function(){function e(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}System.register(["./vendor-legacy-3W6n1FJZ.js","../index-legacy-TZgRpR8-.js","./useLocation-legacy-DCVC0cUV.js","./vaccines_service-legacy-Db1SbmqL.js","./useNeonatalEnrollmentStore-legacy-Bq6TKv22.js"],function(t,a){"use strict";var n,i,o,l,r,d,u,s,c,m,v,p,h,f,g,y,_,b,I,D,w,F,x,k,T,P,R,S,V,N,C,B,L,M,E,H,A,O,Y,j,q,G,U,W,$,z,J,K,Q,X,Z,ee,te,ae,ne,ie,oe,le,re,de,ue,se,ce,me,ve,pe,he,fe,ge,ye;return{setters:[e=>{n=e.d,i=e.N,o=e.L,l=e._,r=e.aj,d=e.a5,u=e.dn,s=e.a4,c=e.dX,m=e.W,v=e.R,p=e.H,h=e.e,f=e.f,g=e.m,y=e.l,_=e.k,b=e.J,I=e.Q,D=e.F,w=e.r,F=e.c,x=e.O,k=e.u,T=e.K,P=e.P,R=e.z,S=e.cp,V=e.w,N=e.aV,C=e.a,B=e.br,L=e.ao,M=e.a6,E=e.p,H=e.bx,A=e.I,O=e.a3,Y=e.i,j=e.v,q=e.M},e=>{G=e.l,U=e.J,W=e._,$=e.aB,z=e.aA,J=e.aC,K=e.H,Q=e.S,X=e.o,Z=e.v,ee=e.Y,te=e.m,ae=e.P,ne=e.u,ie=e.af,oe=e.b2,le=e.s,re=e.aP,de=e.G,ue=e.aD,se=e.e,ce=e.b3,me=e.$,ve=e.t,pe=e.bc,he=e.V},e=>{fe=e.u},e=>{ge=e.g},e=>{ye=e.u}],execute:function(){var a=document.createElement("style");a.textContent=".large-card[data-v-ffb46cdd]{padding:5%;border-radius:15px;border:1px solid #ccc;height:82vh;background-color:#fff;overflow-y:auto;-webkit-box-shadow:0px -2px 19px -2px rgba(196,190,196,1);-moz-box-shadow:0px -2px 19px -2px rgba(196,190,196,1);box-shadow:0 -2px 19px -2px #c4bec4}.header[data-v-ffb46cdd]{display:flex;gap:20px;padding:10px 20px}.position_content[data-v-ffb46cdd]{max-width:100vw}.accordion-expanded[data-v-ffb46cdd]{background-color:#ded}button[aria-expanded=false][data-v-ffb46cdd]{background:rgba(var(--ion-color-rose-rgb),.25)}ion-accordion.accordion-expanding ion-item[slot=header][data-v-ffb46cdd],ion-accordion.accordion-expanded ion-item[slot=header][data-v-ffb46cdd]{--background: #ddeedd}.spinner-overlay[data-v-612f8ee5]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:1000}.spinner-overlay ion-spinner[data-v-612f8ee5]{width:50px;height:50px;color:#fff}.spinner-overlay .loading-text[data-v-612f8ee5]{color:#fff;margin-top:10px;font-size:1.1em}.header-title[data-v-612f8ee5]{text-align:center;font-weight:700;font-size:18px;width:100%;padding:14px;background-color:#f8f8f8;color:#333;box-shadow:0 2px 4px rgba(0,0,0,.1)}.masonry-grid[data-v-612f8ee5]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;padding:16px}@media(max-width:575px){.masonry-grid[data-v-612f8ee5]{grid-template-columns:1fr}}@media(min-width:576px)and (max-width:767px){.masonry-grid[data-v-612f8ee5]{grid-template-columns:repeat(2,1fr)}}@media(min-width:768px)and (max-width:991px){.masonry-grid[data-v-612f8ee5]{grid-template-columns:repeat(3,1fr)}}@media(min-width:992px){.masonry-grid[data-v-612f8ee5]{grid-template-columns:repeat(4,1fr)}}@media(min-width:1500px){.masonry-grid[data-v-612f8ee5]{margin-left:100px;margin-right:100px}}.custom-card[data-v-612f8ee5]{background:#fff;border-radius:5px;padding:5px 15px 15px;transition:transform .2s ease-in-out}.footer-content[data-v-612f8ee5]{display:flex;justify-content:space-between;width:100%;padding:10px;align-items:center;background-color:#f8f8f8;box-shadow:0 -2px 4px rgba(0,0,0,.1)}.footer-buttons-left[data-v-612f8ee5],.footer-buttons-right[data-v-612f8ee5]{display:flex;gap:10px}.pagination-dots[data-v-612f8ee5]{display:flex;gap:8px;justify-content:center;align-items:center}.dot[data-v-612f8ee5]{width:10px;height:10px;background-color:#ccc;border-radius:50%;cursor:pointer;transition:background-color .3s ease,transform .3s ease}.dot.active[data-v-612f8ee5]{background-color:#28a745;transform:scale(1.2)}.dot[data-v-612f8ee5]:hover{background-color:#218838}\n/*$vite$:1*/",document.head.appendChild(a);const _e=n({components:{IonLabel:m,IonAvatar:c,IonRow:s,IonImg:u,IonCol:d,IonList:r,IonItem:l,IonIcon:o,IonButton:i,DynamicButton:U},data:()=>({selectedResult:{},iconsContent:G,isAnyAccordionOpen:!0,isLoading:!1}),methods:{dismiss(e){v.dismiss(e)}}}),be={key:0,class:"spinner-overlay"};const Ie=t("C",W(_e,[["render",function(e,t,a,n,i,o){const l=p("ion-spinner"),r=p("ion-title"),d=p("ion-icon"),u=p("ion-header"),s=p("center"),c=p("ion-content"),m=p("DynamicButton"),v=p("ion-col"),w=p("ion-row"),F=p("ion-footer");return f(),h(D,null,[e.isLoading?(f(),h("div",be,[y(l,{name:"bubbles"}),t[3]||(t[3]=_("div",{class:"loading-text"},"Please wait...",-1))])):g("",!0),y(u,{style:{display:"flex","justify-content":"space-between"}},{default:b(()=>[y(r,{class:"modalTitle"},{default:b(()=>[...t[4]||(t[4]=[I("Printer",-1)])]),_:1}),y(d,{onClick:t[0]||(t[0]=t=>e.dismiss("dismiss")),style:{"padding-top":"10px","padding-right":"10px"},icon:e.iconsContent.cancel},null,8,["icon"])]),_:1}),y(c,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:b(()=>[y(s,null,{default:b(()=>[...t[5]||(t[5]=[_("h3",{class:"ion-padding"},"Do you want to print a barcode?",-1)])]),_:1})]),_:1}),y(F,null,{default:b(()=>[y(w,null,{default:b(()=>[y(v,null,{default:b(()=>[y(m,{color:"danger",onClick:t[1]||(t[1]=t=>e.dismiss("dismiss")),name:"No",fill:"solid",style:{float:"right","margin-right":"2%",width:"100px"}}),y(m,{onClick:t[2]||(t[2]=t=>e.dismiss("Yes")),name:"Yes",fill:"solid",style:{float:"right","margin-right":"2%",width:"100px"}})]),_:1})]),_:1})]),_:1})],64)}]])),De=t("a",n({__name:"CurrentLocation",setup(e,{expose:t}){const{formRef:a,exposeFormMethods:n}=z(),{currentLocation:i}=(e=>{const t=w(!1),{getDistricts:a,districtList:n,selectedTraditionalAuthorityId:i,villages:o,selectedDistrictId:l,TAs:r}=fe();return a(),{currentLocation:F(()=>[{componentType:"Heading",name:"Current Location",position:"center"},{componentType:"multiSelectInputField",header:"Current district",name:"current_district",trackBy:"district_id",validation:e=>$.required(e),icon:G.search,options:n.value,onChange:(t,a)=>{null!=e&&e.value&&(e.value.setFormValue("current_traditional_authority",[]),e.value.setFormValue("current_village",[])),l.value=(null==t?void 0:t.district_id)||null}},{componentType:"multiSelectInputField",header:"Current traditional authority",name:"current_traditional_authority",trackBy:"traditional_authority_id",validation:e=>$.required(e),icon:G.search,options:r.value,disabled:e=>{var t;return!(null!=r&&null!==(t=r.value)&&void 0!==t&&t.length)},onChange:(t,a)=>{var n;null!=e&&e.value&&(null==e||null===(n=e.value)||void 0===n||n.setFormValue("current_village",[])),i.value=(null==t?void 0:t.traditional_authority_id)||null}},{componentType:"multiSelectInputField",header:"Current village",name:"current_village",trackBy:"village_id",icon:G.search,validation:e=>$.required(e),options:o.value,disabled:e=>{var t;return!(null!=o&&null!==(t=o.value)&&void 0!==t&&t.length)}},{componentType:"multiSelectInputField",header:"Closest landmark/Plot number",name:"closestLandmark",trackBy:"id",icon:G.search,options:[{id:1,name:"Church"},{id:2,name:"Mosque"},{id:3,name:"Primary School"},{id:4,name:"Borehole"},{id:5,name:"Secondary School"},{id:6,name:"College"},{id:7,name:"Market"},{id:8,name:"Football Ground"},{id:9,name:"Other"}]}]),TAs:r,isLoadingTAs:t,selectedDistrictId:l}})(a);return t(n()),(e,t)=>(f(),x(J,{formData:k(i),ref_key:"formRef",ref:a},null,8,["formData"]))}})),we=(e,t)=>(null==e||!e.same_as_current)&&!(null!=t&&t.length),Fe=(e,t)=>a=>{setTimeout(()=>{a?((e,t)=>{if(null==e||!e.value||null==t||!t.value)return;const{current_district:a,current_traditional_authority:n,current_village:i}=e.value;t.value.setFormValue("home_district",a),t.value.setFormValue("home_traditional_authority",n),t.value.setFormValue("home_village",i)})(e,t):(e=>{null!=e&&e.value&&(e.value.setFormValue("home_district",[]),e.value.setFormValue("home_traditional_authority",[]),e.value.setFormValue("home_village",[]))})(t)},0)},xe=t("_",n({__name:"HomeLocation",props:{currentLocationFormValues:{}},setup(e,{expose:t}){const a=e,{formRef:n,exposeFormMethods:i}=z(),o=F(()=>a.currentLocationFormValues),{homeLocation:l}=((e,t)=>{const{getDistricts:a,districtList:n,selectedTraditionalAuthorityId:i,villages:o,selectedDistrictId:l,TAs:r}=fe();a();const d=F(()=>[{componentType:"Heading",name:"Home Location",position:"center"},{componentType:"checkboxField",type:"single",name:"same_as_current",label:"Same as current",onChange:Fe(e,t)},{componentType:"multiSelectInputField",header:"Home district",name:"home_district",trackBy:"district_id",icon:G.search,validation:$.required,options:n.value,onChange:e=>((e,t,a)=>{t.value=(null==e?void 0:e.district_id)||null,null!=a&&a.value&&(a.value.setFormValue("home_traditional_authority",[]),a.value.setFormValue("home_village",[]))})(e,l,t)},{componentType:"multiSelectInputField",header:"Home traditional authority",name:"home_traditional_authority",trackBy:"traditional_authority_id",validation:$.required,icon:G.search,options:r.value,disabled:e=>we(e,r.value),onChange:e=>((e,t,a)=>{var n;t.value=(null==e?void 0:e.traditional_authority_id)||null,null==a||null===(n=a.value)||void 0===n||n.setFormValue("home_village",[])})(e,i,t),openDirection:"auto"},{componentType:"multiSelectInputField",header:"Home village",name:"home_village",trackBy:"village_id",icon:G.search,validation:$.required,options:o.value,disabled:e=>we(e,o.value),openDirection:"auto"}]);return{homeLocation:d}})(o,n);return t(i()),(e,t)=>(f(),x(J,{formData:k(l),ref_key:"formRef",ref:n},null,8,["formData"]))}})),ke=n({__name:"Country",setup(e,{expose:t}){const{country:a}=(()=>{const{countriesList:e,getCountries:t}=fe();return t(),{country:F(()=>[{componentType:"Heading",name:"Country",position:"center"},{componentType:"multiSelectInputField",header:"Country",name:"country",trackBy:"district_id",openDirection:"auto",icon:G.search,validation:e=>$.required(e),options:e.value}])}})(),{formRef:n,exposeFormMethods:i}=z();return t(i()),(e,t)=>(f(),x(J,{formData:k(a),ref_key:"formRef",ref:n},null,8,["formData"]))}}),Te=t("c",n({__name:"PersonalInformation",setup(e,{expose:t}){const{personalInformation:a}=(()=>{function e(e,t){const a=new Date(e);return a.setFullYear(a.getFullYear()-t),a.toISOString().split("T")[0]}return{personalInformation:F(()=>[{componentType:"Heading",name:"Personal Information",position:"center"},{componentType:"inputField",header:"National ID",name:"nationalID",placeholder:"__-__-__-__",icon:G.nationalID,validation:e=>$.isMWNationalID(e)},{componentType:"inputField",header:"First name",name:"firstname",icon:G.fullName,validation:e=>$.isName(e)},{componentType:"inputField",header:"Middle name",name:"middleName",icon:G.fullName,validation:e=>$.isNamesEmpty(e)},{componentType:"inputField",header:"Last name",name:"lastname",icon:G.fullName,validation:e=>$.isName(e)},{componentType:"radioButtonField",header:"Gender",name:"gender",type:"inline",validation:e=>$.required(e),options:[{label:"Male",value:"M"},{label:"Female",value:"F"},{label:"Undetermined",value:"Undetermined"}]},{componentType:"dateInputField",header:"Date of birth",name:"birthdate",icon:G.calenderPrimary,minDate:e(K.sessionDate(),110),validation:e=>$.required(e),condition:e=>!e.Estimate,disabled:e=>e.Estimate},{componentType:"inputField",header:"Estimated age",name:"estimation",icon:G.time,validation:e=>$.isEstimationDate(e),initialUnit:"Years",unitOptions:[{label:"Days",value:"Days"},{label:"Weeks",value:"Weeks"},{label:"Months",value:"Months"},{label:"Years",value:"Years"}],unitValidation:e=>e&&""!==e?null:"Please select a unit.",condition:e=>e.Estimate},{componentType:"checkboxField",name:"Estimate",type:"single",label:"Estimate age"},{componentType:"phoneInputField",name:"Phone Number",header:"Phone Number",validation:e=>$.isMWPhoneNumber(e.phoneNumber)}])}})(),{formRef:n,exposeFormMethods:i}=z();return t(i()),(e,t)=>(f(),x(J,{formData:k(a),ref_key:"formRef",ref:n},null,8,["formData"]))}})),Pe=n({components:{IonLabel:m,IonAvatar:c,IonRow:s,IonImg:u,IonCol:d,IonList:r,IonItem:l,IonIcon:o,IonButton:i},data:()=>({selectedResult:{},iconsContent:G,isAnyAccordionOpen:!0,isLoading:!1}),methods:{updateAccordionState(e){const t=this.$refs.accordionGroup;this.isAnyAccordionOpen=void 0!==t.value},dismiss(e){v.dismiss(e)},async init(){this.setData(this.deduplicationData[0]||{})},async onSelect(){v.dismiss(this.selectedResult)},setData(e){this.selectedResult=e},dateFormat:e=>K.toStandardHisDisplayFormat(e),probabilityToPercentage:e=>(100*e).toFixed(2)+"%"},props:{deduplicationData:{default:[]},to_be_registered:{default:[]}},mounted(){this.init()},activated(){this.init()}}),Re={key:0,class:"spinner-overlay"},Se={class:"header position_content"},Ve={style:{"font-size":"1.2em","font-weight":"700"}},Ne={class:"due_date"},Ce={class:"ion-padding",slot:"content"},Be={style:{display:"flex","justify-content":"end",gap:"10px"}};const Le=W(Pe,[["render",function(e,t,a,n,i,o){const l=p("ion-spinner"),r=p("ion-icon"),d=p("ion-header"),u=p("ion-label"),s=p("ion-item"),c=p("ion-col"),m=p("ion-row"),v=p("ion-accordion"),w=p("ion-accordion-group"),F=p("ion-content"),k=p("ion-button"),R=p("ion-footer");return f(),h(D,null,[e.isLoading?(f(),h("div",Re,[y(l,{name:"bubbles"}),t[3]||(t[3]=_("div",{class:"loading-text"},"Please wait...",-1))])):g("",!0),y(d,null,{default:b(()=>[_("div",Se,[_("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=t=>e.dismiss("back"))},[y(r,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeft},null,8,["icon"])]),_("div",Ve,"Matches found: ("+T(e.deduplicationData.length)+")",1)])]),_:1}),y(F,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:b(()=>[y(w,{ref:"accordionGroup",class:"previousView",value:"0",onIonChange:e.updateAccordionState},{default:b(()=>[(f(!0),h(D,null,P(e.deduplicationData,(a,n)=>(f(),x(v,{style:{"margin-bottom":"15px"},value:n,"toggle-icon-slot":"start",class:"custom_card",button:"",key:n,detail:!0,color:a.value===e.selectedResult.value?"light":"",onClick:t=>e.setData(a)},{default:b(()=>[y(s,{slot:"header"},{default:b(()=>[y(u,{class:"previousLabel"},{default:b(()=>{var e,t;return[I(T(null==a||null===(e=a.person)||void 0===e?void 0:e.given_name)+" "+T(null==a||null===(t=a.person)||void 0===t?void 0:t.family_name),1)]}),_:2},1024),_("div",Ne,[t[4]||(t[4]=I(" Score: ",-1)),_("b",null,T(e.probabilityToPercentage(null==a?void 0:a.score)||"-"),1)])]),_:2},1024),_("div",Ce,[y(m,null,{default:b(()=>[y(c,null,{default:b(()=>[...t[5]||(t[5]=[_("b",null,"To be Registered",-1)])]),_:1}),y(c,null,{default:b(()=>[...t[6]||(t[6]=[_("b",null,"Already Registered",-1)])]),_:1})]),_:1}),y(m,null,{default:b(()=>[y(c,null,{default:b(()=>[y(m,null,{default:b(()=>{var a,n;return[t[7]||(t[7]=I(" Name: ",-1)),_("b",null,T(null===(a=e.to_be_registered)||void 0===a?void 0:a.given_name)+" "+T(null===(n=e.to_be_registered)||void 0===n?void 0:n.family_name),1)]}),_:1}),y(m,null,{default:b(()=>{var a;return[t[8]||(t[8]=I("Gender: ",-1)),_("b",null,T(null===(a=e.to_be_registered)||void 0===a?void 0:a.gender),1)]}),_:1}),y(m,null,{default:b(()=>{var a;return[t[9]||(t[9]=I("Birthdate: ",-1)),_("b",null,T(null===(a=e.to_be_registered)||void 0===a?void 0:a.birthdate),1)]}),_:1}),y(m,null,{default:b(()=>{var a;return[t[10]||(t[10]=I("Home District: ",-1)),_("b",null,T(null===(a=e.to_be_registered)||void 0===a?void 0:a.home_district),1)]}),_:1}),y(m,null,{default:b(()=>{var a;return[t[11]||(t[11]=I("Home TA: ",-1)),_("b",null,T(null===(a=e.to_be_registered)||void 0===a?void 0:a.home_traditional_authority),1)]}),_:1})]),_:1}),y(c,null,{default:b(()=>[y(m,null,{default:b(()=>{var e,n;return[t[12]||(t[12]=I(" Name: ",-1)),_("b",null,T(null==a||null===(e=a.person)||void 0===e?void 0:e.given_name)+" "+T(null==a||null===(n=a.person)||void 0===n?void 0:n.family_name),1)]}),_:2},1024),y(m,null,{default:b(()=>{var e;return[t[13]||(t[13]=I("Gender: ",-1)),_("b",null,T(null==a||null===(e=a.person)||void 0===e?void 0:e.gender),1)]}),_:2},1024),y(m,null,{default:b(()=>{var n;return[t[14]||(t[14]=I("Birthdate: ",-1)),_("b",null,T(e.dateFormat(null==a||null===(n=a.person)||void 0===n?void 0:n.birthdate)),1)]}),_:2},1024),y(m,null,{default:b(()=>{var e;return[t[15]||(t[15]=I("Home District: ",-1)),_("b",null,T(null==a||null===(e=a.person)||void 0===e?void 0:e.home_district),1)]}),_:2},1024),y(m,null,{default:b(()=>{var e;return[t[16]||(t[16]=I("Home TA: ",-1)),_("b",null,T(null==a||null===(e=a.person)||void 0===e?void 0:e.home_traditional_authority),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["value","color","onClick"]))),128))]),_:1},8,["onIonChange"])]),_:1}),y(R,{collapse:"fade",class:"ion-no-border"},{default:b(()=>[_("div",Be,[y(k,{fill:"solid",color:"secondary",onClick:t[1]||(t[1]=t=>e.dismiss("dismiss"))},{default:b(()=>[...t[17]||(t[17]=[I(" Not Duplicate ",-1)])]),_:1}),y(k,{onClick:t[2]||(t[2]=t=>e.onSelect()),fill:"solid",disabled:!e.isAnyAccordionOpen},{default:b(()=>[...t[18]||(t[18]=[I("Select ",-1)])]),_:1},8,["disabled"])])]),_:1})],64)}],["__scopeId","data-v-ffb46cdd"]]),Me=Z();class Ee{async getDDEIds(){const e=Q.getPouchDbStatus(),t=Q.getLanConnectionStatus(),a=Q.getAPIStatus();if(t){const e=await this.getAndUpdateAvailableDdeId();return null!=e&&e.success?e.ddeId:void 0}if(e&&!t){var n,i;const e=await X("dde");if(null!==(n=e[0])&&void 0!==n&&n.npid)return(null===(i=e[0])||void 0===i?void 0:i.npid)||""}if(a)try{var o;const e=await Q.getJson("/dde/patients/sync_npids",{count:1,program_id:Q.getProgramID()});return(null==e||null===(o=e.npids[0])||void 0===o?void 0:o.npid)||""}catch(l){return""}return""}async deleteDDEId(e){Me.postData({command:"deleteData",storeName:"dde",data:{npid:e}})}async possibleDuplicates(e){if(Q.getAPIStatus())try{const a=new ee,n=await a.checkPotentialDuplicates(e);if(n.length>0){const i=await te(Le,{class:"fullScreenModal"},!0,{to_be_registered:e,deduplicationData:n});if("dismiss"!=i&&"back"!=i){var t;const e=await a.importPatient(null==i||null===(t=i.person)||void 0===t?void 0:t.id),n=await ae.findByID(e.patient_id);return await ne().setPatientRecord(n),!0}return"back"==i}return!1}catch(a){return!1}return!1}async getAndUpdateAvailableDdeId(){try{const{couchdbUsername:e,couchdbPassword:t,couchdbPort:a,couchdbHost:n,couchdbProtocol:i}=Q.getCouchdbConfig(),o=`${i}://${n}:${a}/dde`,l="Basic "+btoa(`${e}:${t}`),r={selector:{type:"dde_id",$or:[{status:{$exists:!1}},{status:{$ne:"used"}}]},limit:1},d=await fetch(`${o}/_find`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l},body:JSON.stringify(r)});if(!d.ok)throw new Error(`Failed to query documents: ${d.statusText}`);const u=await d.json();if(console.log("ðŸš€ ~ DDEService ~ getAndUpdateAvailableDdeId ~ findResult:",u),!u.docs||0===u.docs.length)return{success:!1,error:"No available DDE IDs found"};const s=u.docs[0],c=s.dde_id;s.status="used",s.assignedAt=(new Date).toISOString();const m=await fetch(`${o}/${s._id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:l},body:JSON.stringify(s)});if(!m.ok)throw new Error(`Failed to update document: ${m.statusText}`);return console.log("ðŸš€ ~ DDEService ~ getAndUpdateAvailableDdeId ~ ddeId:",c),{success:!0,ddeId:c}}catch(e){return console.error("Error getting and updating DDE ID:",e),null}}}class He{getRegion(e){return{1:"Central Region",2:"Northern Region",3:"Southern Region",4:"Foreign"}[e]}hasValidData(e,t=[]){return!(!e||"object"!=typeof e)&&(0===t.length?Object.values(e).some(e=>null!=e&&""!==e):t.every(t=>null!==e[t]&&void 0!==e[t]&&""!==e[t]))}async buildObservation(e,t){if(!t)return null;const a="object"==typeof t&&t.name?t.name:t;return await ie.buildValueText(e,a)}buildGuardianInfo(e){const t={};return t.given_name=(null==e?void 0:e.guardianFirstname)||"",t.middle_name=(null==e?void 0:e.guardianMiddleName)||"",t.family_name=(null==e?void 0:e.guardianLastname)||"",t.cell_phone_number=(null==e?void 0:e.guardianPhoneNumber.phoneNumber)||"",t.national_id=(null==e?void 0:e.guardianNationalID)||"",t.gender="",t.birthdate="",t.birthdate_estimated="false",t.home_region="",t.home_district="",t.home_traditional_authority="",t.home_village="",t.current_region="",t.current_district="",t.current_traditional_authority="",t.current_village="",t.landmark="",{saved:[],unsaved:[t]}}async buildVitals(e){return null!=e&&e.Weight?{saved:[],unsaved:[await this.buildObservation("Weight",e.Weight)]}:null}async buildARTPatientType(e,t){const a=[];let n=[];return e&&a.push(await ie.buildValueText("Art clinic location",e)),t&&a.push(await ie.buildValueCoded("Type of patient",t)),0===a.length?[]:(n=[{encounter_type:oe.REGISTRATION,status:"unsaved",obs:a}],n)}async buildBirthRegistrationObservations(e){if(!this.hasValidData(e))return null;const t=(await Promise.all([this.buildObservation("How many doses of Tdv did the mother receive?",e["How many doses of Tdv did the mother receive?"]),this.buildObservation("Protected at birth",e["Protected at birth"]),this.buildObservation("HIV status",e["HIV status"])])).filter(e=>null!==e);return t.length>0?t:null}async buildPatientRecord(e,t,a=""){var n,i,o,l,r,d,u,s,c,m,v,p,h;const{personalInformation:f,currentLocation:g,homeLocation:y,birthRegistration:_,guardianInformation:b,socialHistory:I,patientType:D}=e;return{patientID:a||t||"",ID:t||"",NcdID:"",personInformation:{given_name:(null==f?void 0:f.firstname)||"",middle_name:(null==f?void 0:f.middleName)||"",family_name:(null==f?void 0:f.lastname)||"",gender:(null==f?void 0:f.gender)||"",birthdate:null!=f&&f.Estimate?(new Ae).calculateDoB(null==f?void 0:f.estimation,(null==f?void 0:f.estimation_unit)||"Years"):(null==f?void 0:f.birthdate)||"",birthdate_estimated:null!=f&&f.Estimate?"true":"false",home_region:this.getRegion(null==y||null===(n=y.home_district)||void 0===n?void 0:n.region_id)||"",home_district:(null==y||null===(i=y.home_district)||void 0===i?void 0:i.name)||"",home_traditional_authority:(null==y||null===(o=y.home_traditional_authority)||void 0===o?void 0:o.name)||"",home_village:(null==y||null===(l=y.home_village)||void 0===l?void 0:l.name)||"",current_region:this.getRegion(null==g||null===(r=g.current_district)||void 0===r?void 0:r.region_id)||"",current_district:(null==g||null===(d=g.current_district)||void 0===d?void 0:d.name)||"",current_traditional_authority:(null==g||null===(u=g.current_traditional_authority)||void 0===u?void 0:u.name)||"",current_village:(null==g||null===(s=g.current_village)||void 0===s?void 0:s.name)||"",country:(null==e?void 0:e.country.country.name)||"",landmark:(null==g||null===(c=g.closestLandmark)||void 0===c?void 0:c.name)||"",cell_phone_number:(null===(m=f["Phone Number"])||void 0===m?void 0:m.phoneNumber)||"",occupation:(null==I?void 0:I.occupation)||"",marital_status:(null==I?void 0:I.maritalStatus)||"",religion:(null==I||null===(v=I.religion)||void 0===v?void 0:v.name)||"",education_level:(null==I?void 0:I.highestLevelOfEducation)||""},guardianInformation:this.buildGuardianInfo(b),birthRegistration:await this.buildBirthRegistrationObservations(_),otherPersonInformation:{nationalID:(null==f?void 0:f.nationalID)||"",ichisID:Q.getIchisId()||"",TEI:Q.getTEI()||"",birthID:_["Serial Number"]||"",relationshipID:(null==b||null===(p=b.relationship)||void 0===p?void 0:p.id)||""},vitals:await this.buildVitals(_),vaccineSchedule:await ge(null==f?void 0:f.gender,null==f?void 0:f.birthdate),vaccineAdministration:{orders:[],obs:[],voided:[]},observations:await this.buildARTPatientType(null==D||null===(h=D.facility)||void 0===h?void 0:h.name,null==D?void 0:D.patient_type),appointments:{saved:[],unsaved:[]},saveStatusPersonInformation:"pending",saveStatusGuardianInformation:"pending",saveStatusBirthRegistration:"pending",saveStatusVitals:"pending",date_created:"",creator:"",sync_status:"unsynced"}}}class Ae extends Q{constructor(){super(),e(this,"patientRecordBuilder",void 0),this.patientRecordBuilder=new He}async saveRegistrationData(e){const t=await(new Ee).getDDEIds();if(!t&&(le("DDE IDs are not available."),Q.getLanConnectionStatus()||Q.getPouchDbStatus()))return!1;let a=await this.patientRecordBuilder.buildPatientRecord(e,t);return 32==Q.getProgramID()&&(a=await(async e=>{const t=Q.getIchisDiagnosis();if(t.length<=0)return e;const a=await Promise.all(t.map(async e=>{var t;const a=(null==e||null===(t=e.value)||void 0===t||null===(t=t.match(/[\d.]+/))||void 0===t?void 0:t[0])||"",n=null==e?void 0:e.date;if("NCD_CV_D_Likelihood of Diabetes"==e.display){var i;const t=null==e||null===(i=e.id)||void 0===i?void 0:i.split("-");return await ie.buildValueNumber("Unspecified Diabetes",a,null,null,n,t[1])}return"NCD_SHD_CV_Client waist circumference"==e.display?await ie.buildValueNumber("Waist circumference",a,null,null,n):"NCD_SHD_CV_Client systolic blood pressure"==e.display?await ie.buildValueNumber("Systolic",a,null,null,n):"NCD_SHD_CV_Client diastolic blood pressure"==e.display?await ie.buildValueNumber("Diastolic",a,null,null,n):void 0}));return e.observations.push({encounter_type:"VITALS",status:"unsaved",obs:a}),e})(a)),!!(await(new Ee).possibleDuplicates(a.personInformation))||!!(await re(a))&&(de("Registration successful"),sessionStorage.setItem("ichis_diagnosis",JSON.stringify([])),Q.getPouchDbStatus()&&await(new Ee).deleteDDEId(t),await this.printBarcode(),!0)}async updateDemographics(e){let t=await this.patientRecordBuilder.buildPatientRecord(e,Q.getNationalID(),Q.getPatientID());return t.saveStatusPersonInformation="edit",t.saveStatusGuardianInformation="edit",t.saveStatusBirthRegistration="edit",t.saveStatusVitals="edit",!!(await re(t))&&(de("Updated successful"),!0)}checkIfChild(e){if(!(null!=e&&e.estimation||null!=e&&e.birthdate))return{moreThanThirteenYears:!0,underNineMonths:!1,underFiveYears:!1};let t="";return t=e.estimation?this.calculateDoB(e.estimation,e.estimation_unit||"Years")||"":e.birthdate,{moreThanThirteenYears:K.getAgeInYears(t)>13,underNineMonths:K.ageInMonths(t)<9,underFiveYears:K.getAgeInYears(t)<5}}async printBarcode(){"dismiss"!==await te(Ie,{class:"small-confirm-modal "})&&(new ue).printData("barcode")}calculateDoB(e,t){try{let a=R(Q.getSessionDate());if("Years"===t&&e<0)a=a.add(Math.abs(e),"years");else switch(t){case"Days":a=a.subtract(e,"days");break;case"Months":a=a.subtract(e,"months");break;case"Years":a=a.subtract(e,"years");break;default:return null}return K.toStandardHisDisplayFormat(a.format("YYYY-MM-DD"))||""}catch(a){return console.error("Error calculating date:",a),null}}}const Oe=(e,t)=>{const a=F(()=>(new Ae).checkIfChild(e.value).moreThanThirteenYears),{getRelationships:n}=function(){const e=w([]),t=w([]),a=w([]),n=se();S();const i=F(()=>n.apiStatus),o=e=>{var n;const i=["Brother","Father","Son","Grandfather","Grandson","Boyfriend","Stepfather","Stepson"],o=["Sister","Mother","Daughter","Grandmother","Granddaughter","Girlfriend","Stepmother","Stepdaughter"],l=["Spouse/Partner","Aunt/Uncle","Niece/Nephew","Doctor","Other","Patient","TB Contact Person","TB Patient","treatment suporter"];(null===(n=t.value)||void 0===n?void 0:n.length)>0&&(a.value=t.value.filter(t=>"M"===e?i.includes(t.a_is_to_b)||l.includes(t.a_is_to_b):"F"===e&&o.includes(t.a_is_to_b)||l.includes(t.a_is_to_b)))};return{relationships:e,relationshipsData:t,filteredRelationships:a,apiStatus:i,getRelationships:async n=>n?(Q.getPouchDbStatus()&&Q.getLanConnectionStatus()?t.value=await X("relationship"):t.value=await ce.getRelations(),o(n),e.value=e.value=a.value.map(e=>[{name:e.b_is_to_a,id:e.relationship_type_id,trackByID:e.relationship_type_id+e.b_is_to_a}]).reduce((e,t)=>e.concat(t),[]),e.value):(o(n),e.value=a.value.map(e=>[{name:e.b_is_to_a,id:e.relationship_type_id,trackByID:e.relationship_type_id+e.b_is_to_a}]).reduce((e,t)=>e.concat(t),[]),e.value),filterRelationships:o}}(),i=w();V(e,async e=>{e&&(i.value=await n(e.gender))});return{guardianInformation:F(()=>[{componentType:"Heading",name:"Guardian Information",position:"center"},{componentType:"inputField",header:"Guardian National ID",name:"guardianNationalID",placeholder:"__-__-__-__",icon:G.nationalID,validation:e=>$.isMWNationalID(e)},{componentType:"inputField",header:"First name",name:"guardianFirstname",icon:G.fullName,validation:e=>a.value?$.isNameEmpty(e):$.isName(e)},{componentType:"inputField",header:"Middle name",name:"guardianMiddleName",icon:G.fullName,validation:e=>$.isNameEmpty(e)},{componentType:"inputField",header:"Last name",name:"guardianLastname",icon:G.fullName,validation:e=>a.value?$.isNameEmpty(e):$.isName(e)},{componentType:"phoneInputField",name:"guardianPhoneNumber",header:"Phone Number",validation:e=>$.isMWPhoneNumber(e.phoneNumber)},{componentType:"multiSelectInputField",header:"Relationship to patient",name:"relationship",trackBy:"trackByID",icon:G.search,validation:e=>a.value?null:$.required(null==e?void 0:e.name),options:()=>i.value,disabled:()=>!i.value}])}},Ye=t("b",n({__name:"GuardianInformation",props:{personalInformationFormValues:{}},setup(e,{expose:t}){const{formRef:a,exposeFormMethods:n}=z(),i=e,o=F(()=>i.personalInformationFormValues),{guardianInformation:l}=Oe(o);return t(n()),(e,t)=>(f(),x(J,{formData:k(l),ref_key:"formRef",ref:a},null,8,["formData"]))}})),je=t("d",n({__name:"SocialHistory",setup(e,{expose:t}){const{socialHistory:a}=(()=>{const e=w();return me.isProp("military_site=true").then(t=>{e.value=t}),{socialHistory:F(()=>[{componentType:"Heading",name:"Social History",position:"center"},{componentType:"multiSelectInputField",header:"Religion",name:"religion",icon:G.search,trackBy:"id",options:[{id:1,name:"Christianity"},{id:2,name:"Islam"},{id:3,name:"Judaism"},{id:4,name:"Hinduism"},{id:5,name:"Buddhism"},{id:6,name:"Sikhism"},{id:7,name:"Jainism"},{id:8,name:"BahÃ¡'Ã­ Faith"},{id:9,name:"Zoroastrianism"},{id:10,name:"Confucianism"},{id:11,name:"Taoism"},{id:12,name:"Shinto"},{id:13,name:"Baha'i Faith"},{id:14,name:"Juche"},{id:15,name:"Rastafari"}]},{componentType:"radioButtonField",header:"Occupation status",name:"occupation",type:"inline",validation:$.required,condition:()=>1==Q.getProgramID()&&e.value,options:[{label:"Military",value:"Military"},{label:"Civilian",value:"Civilian"}]},{componentType:"radioButtonField",header:"Occupation status",name:"occupation",type:"inline",condition:t=>!e,options:[{label:"Employed",value:"employed"},{label:"Student",value:"Student"},{label:"Unemployed",value:"unemployed"},{label:"Other",value:"Other"}]},{componentType:"radioButtonField",header:"Marital status",name:"maritalStatus",type:"inline",options:[{label:"Single",value:"single"},{label:"Married",value:"married"},{label:"Widow",value:"widow"},{label:"Widower",value:"widower"},{label:"Divorced",value:"divorced"}]},{componentType:"radioButtonField",header:"Highest level of education",name:"highestLevelOfEducation",type:"inline",options:[{label:"No education",value:"No education"},{label:"Primary school",value:"primary school"},{label:"Secondary school",value:"secondary school"},{label:"Tertiary education",value:"tertiary education"}]}])}})(),{formRef:n,exposeFormMethods:i}=z();return t(i()),(e,t)=>(f(),x(J,{formData:k(a),ref_key:"formRef",ref:n},null,8,["formData"]))}})),qe=n({__name:"PatientType",setup(e,{expose:t}){const{patientType:a}=(()=>{const{facilityList:e,getFacilities:t}=fe();return t(),{patientType:F(()=>[{componentType:"Heading",name:"Patient Type",position:"center"},{componentType:"radioButtonField",header:"Patient Type",name:"patient_type",type:"inline",validation:$.required,options:[{label:"New patient",value:"New patient"},{label:"Emergency supply",value:"Emergency supply"},{label:"External consultation",value:"External consultation"}]},{componentType:"multiSelectInputField",header:"Facility",name:"facility",trackBy:"facility_id",openDirection:"auto",icon:G.search,validation:e=>$.required(e),options:e.value.facilities||e.value,condition:e=>"Emergency supply"==(null==e?void 0:e.patient_type)||"External consultation"==(null==e?void 0:e.patient_type)}])}})(),{formRef:n,exposeFormMethods:i}=z();return t(i()),(e,t)=>(f(),x(J,{formData:k(a),ref_key:"formRef",ref:n},null,8,["formData"]))}}),Ge=n({__name:"BirthRegistration",setup(e,{expose:t}){const{formRef:a,exposeFormMethods:n}=z(),{birthRegistration:i}=(e=>({birthRegistration:F(()=>[{componentType:"Heading",name:"Birth Registration",position:"center"},{componentType:"inputField",header:"Birth certificate number",name:"Serial Number",icon:G.nationalID,placeholder:"__-__-__-__"},{componentType:"inputField",header:"Birth Weight/First weight (kg)",name:"Weight",icon:G.weight,validation:e=>$.validateWeight(e)},{componentType:"multiSelectInputField",header:"How many doses of Tdv did the mother receive?",name:"How many doses of Tdv did the mother receive?",icon:G.search,options:[{concept_id:11997,name:"0-2 doses, less than two weeks before delivery"},{concept_id:11998,name:"2-5 doses more than two weeks of delivery"},{concept_id:1067,name:"Unknown"}],trackBy:"concept_id",validation:e=>$.required(e),onChange:t=>{const a=null==t?void 0:t.name;"Unknown"==a?e.value.setFormValue("Protected at birth",{concept_id:1067,name:"Don't know"}):"0-2 doses, less than two weeks before delivery"==a?e.value.setFormValue("Protected at birth",{concept_id:1066,name:"No"}):"2-5 doses more than two weeks of delivery"==a&&e.value.setFormValue("Protected at birth",{concept_id:1065,name:"Yes"})}},{componentType:"multiSelectInputField",header:"Protected at birth (PAB)",name:"Protected at birth",icon:G.search,trackBy:"concept_id",validation:e=>$.required(e),disabled:e=>!e["How many doses of Tdv did the mother receive?"]},{componentType:"multiSelectInputField",header:"HIV status of the Child's Mother",name:"HIV status",icon:G.search,options:[{id:703,name:"Positive"},{id:664,name:"Negative"},{id:1067,name:"Unknown"}],trackBy:"id",validation:e=>$.required(e)}])}))(a);return t(n()),(e,t)=>(f(),x(J,{formData:k(i),ref_key:"formRef",ref:a},null,8,["formData"]))}});function Ue(){const e=w(1),t=w(4),a=ne(),{patient:n}=N(a),i=F(()=>0===t.value?4:Math.ceil(4/t.value)),o=F(()=>i.value>1),l=F(()=>o.value&&e.value>1),r=F(()=>o.value&&e.value<i.value),d=()=>{t.value=(()=>{const e=window.innerWidth;return e>=992?4:e>=768?3:e>=576?2:1})(),e.value>i.value&&(e.value=i.value),0===e.value&&i.value>0&&(e.value=1)};return C(()=>{window.addEventListener("resize",d),d()}),B(()=>{window.removeEventListener("resize",d)}),{currentPage:e,columnsPerRow:t,totalPages:i,showPaginationButtons:o,showPreviousButton:l,showNextButton:r,nextPage:()=>{e.value<i.value&&e.value++},prevPage:()=>{e.value>1&&e.value--},goToPage:t=>{t>=1&&t<=i.value&&(e.value=t)},handleResize:d,isCardVisible:a=>{if(1===i.value)return!0;const n=(e.value-1)*t.value,o=n+t.value-1;return a>=n&&a<=o}}}const We={key:0,class:"spinner-overlay"},$e={class:"header-title"},ze={class:"masonry-grid"},Je={class:"card-container"},Ke={class:"custom-card"},Qe={class:"card-container"},Xe={key:0,class:"custom-card"},Ze={key:1,class:"custom-card"},et={class:"custom-card card-margin-top"},tt={key:0,class:"card-container"},at={class:"custom-card"},nt={class:"custom-card card-margin-top"},it={class:"card-container"},ot={class:"custom-card"},lt={key:0,class:"custom-card card-margin-top"},rt={class:"footer-content"},dt={class:"footer-buttons-left"},ut={key:0,class:"pagination-dots"},st=["onClick","aria-label"],ct={class:"footer-buttons-right"},mt=n({__name:"Registration",props:{editMode:{type:Boolean,default:!1}},setup(e){const t=w(!1),a=L(),n=S(),o=ye(),l=w(null),r=w(null),d=w(null),u=w(null),s=w(null),c=w(null),m=w(null),p=w(null),R=w({personalInformationRef:l,birthRegistrationRef:r,socialHistoryRef:d,countryRef:u,currentLocationRef:s,homeLocationRef:c,guardianInformationRef:m,patientTypeRef:p}),B=F(()=>{var e;return(null===(e=l.value)||void 0===e?void 0:e.currentFormValues)||{}}),G=F(()=>{var e;return(null===(e=r.value)||void 0===e?void 0:e.currentFormValues)||{}}),U=F(()=>{var e;return(null===(e=d.value)||void 0===e?void 0:e.currentFormValues)||{}}),W=F(()=>{var e;return(null===(e=u.value)||void 0===e?void 0:e.currentFormValues)||{}}),$=F(()=>{var e;return(null===(e=s.value)||void 0===e?void 0:e.currentFormValues)||{}}),z=F(()=>{var e;return(null===(e=c.value)||void 0===e?void 0:e.currentFormValues)||{}}),J=F(()=>{var e;return(null===(e=m.value)||void 0===e?void 0:e.currentFormValues)||{}}),X=F(()=>{var e;return(null===(e=p.value)||void 0===e?void 0:e.currentFormValues)||{}}),Z=F(()=>({personalInformation:B.value,birthRegistration:G.value,socialHistory:U.value,country:W.value,currentLocation:$.value,homeLocation:z.value,guardianInformation:J.value,patientType:X.value})),ee=()=>{const e=Object.values(R.value);return e.forEach(e=>null==e?void 0:e.validateForm()),e.every(e=>null==(null==e?void 0:e.validateForm()))},te=()=>{Object.values(R.value).forEach(e=>null==e?void 0:e.resetForm())},ae=F(()=>(new Ae).checkIfChild(B.value)),{nextPage:ie,prevPage:oe,goToPage:le,isCardVisible:re,showPreviousButton:de,showPaginationButtons:ue,totalPages:se,currentPage:ce,showNextButton:me}=Ue(),{setFormValues:fe}=function(){const e=ne(),{patient:t}=N(e),a=e=>{var a,n;const i=null==t||null===(a=t.value)||void 0===a||null===(a=a.guardianInformation)||void 0===a?void 0:a.saved[0],o=null!=i&&null!==(n=i.relationship_type)&&void 0!==n&&n.b_is_to_a?{name:i.relationship_type.b_is_to_a,id:i.relationship_type.relationship_type_id,trackByID:i.relationship_type.relationship_type_id+i.relationship_type.b_is_to_a}:"";null==e||e.setFormValue("guardianNationalID",(null==i?void 0:i.national_id)||""),null==e||e.setFormValue("guardianFirstname",(null==i?void 0:i.given_name)||""),null==e||e.setFormValue("guardianMiddleName",(null==i?void 0:i.middle_name)||""),null==e||e.setFormValue("guardianLastname",(null==i?void 0:i.family_name)||""),null==e||e.setFormValue("guardianPhoneNumber",null!=i&&i.cell_phone_number?null==i?void 0:i.cell_phone_number:""),null==e||e.setFormValue("relationship",o||"")};return{setFormValues:e=>{var n,i;const{personalInformationRef:o,socialHistoryRef:l,countryRef:r,currentLocationRef:d,homeLocationRef:u,guardianInformationRef:s}=e.value,c=null==t||null===(n=t.value)||void 0===n?void 0:n.personInformation;null==o||o.setFormValue("nationalID",null==t||null===(i=t.value)||void 0===i||null===(i=i.otherPersonInformation)||void 0===i?void 0:i.nationalID),null==o||o.setFormValue("firstname",null==c?void 0:c.given_name),null==o||o.setFormValue("middleName",null==c?void 0:c.middle_name),null==o||o.setFormValue("lastname",null==c?void 0:c.family_name),null==o||o.setFormValue("gender",null==c?void 0:c.gender),null==o||o.setFormValue("birthdate",null!=c&&c.birthdate?K.toStandardHisDisplayFormat(null==c?void 0:c.birthdate):""),null==o||o.setFormValue("Phone Number",null!=c&&c.cell_phone_number?null==c?void 0:c.cell_phone_number:""),null==u||u.setFormValue("home_district",{name:null==c?void 0:c.home_district}),null==u||u.setFormValue("home_traditional_authority",{name:null==c?void 0:c.home_traditional_authority}),null==u||u.setFormValue("home_village",{name:null==c?void 0:c.home_village}),null==d||d.setFormValue("current_district",{name:null==c?void 0:c.current_district}),null==d||d.setFormValue("current_traditional_authority",{name:null==c?void 0:c.current_traditional_authority}),null==d||d.setFormValue("current_village",{name:null==c?void 0:c.current_village}),null==d||d.setFormValue("closestLandmark",{name:null==c?void 0:c.landmark}),null==r||r.setFormValue("country",null!=c&&c.country?{name:null==c?void 0:c.country}:{name:"Malawi"}),null==l||l.setFormValue("religion",{name:null==c?void 0:c.religion}),null==l||l.setFormValue("occupation",null==c?void 0:c.occupation),null==l||l.setFormValue("maritalStatus",null==c?void 0:c.marital_status),null==l||l.setFormValue("highestLevelOfEducation",null==c?void 0:c.education_level),a(s)}}}(),ge=async()=>{if(!ee())return void ve("Please fill in all required fields");if(await(new Ae).saveRegistrationData(Z.value)){te();const e=n.query.context,t=n.query.returnTo;if("neonatal-mother"===e&&"/neonatal/enrollment"===t){const e=Q.getUserID();return e&&o.setCreatedMother(e),void setTimeout(()=>{a.replace({path:t})},50)}32==Q.getProgramID()?!function(){const e=JSON.parse(localStorage.getItem("userRoles"))||[];return!(!e.some(t=>"General Registration Clerk"===t.role||e.some(t=>"Vitals Clerk"===t.role||e.some(e=>"Registration Clerk"===e.role)))||32!=Q.getProgramID())}()?_e("/NCDEnrollment"):_e("/home"):_e("/patientProfile")}},_e=e=>{a.push({path:e})};return V(n,async e=>{console.log("ðŸš€ ~ newRoute:",e),fe(R)},{deep:!0}),C(async()=>{fe(R)}),(w,F)=>(f(),x(k(M),{class:E({loading:t.value})},{default:b(()=>[t.value?(f(),h("div",We,[y(k(H),{name:"bubbles"}),F[4]||(F[4]=_("div",{class:"loading-text"},"Please wait...",-1))])):g("",!0),y(k(A),null,{default:b(()=>[_("div",$e,T(e.editMode?"Edit Patient Demographic":"New Patient Registration"),1)]),_:1}),y(k(O),null,{default:b(()=>{var t,a;return[_("div",ze,[Y(_("div",Je,[_("div",Ke,[y(Te,{ref_key:"personalInformationRef",ref:l},null,512)])],512),[[j,k(re)(0)]]),Y(_("div",Qe,[ae.value.underNineMonths&&!e.editMode?(f(),h("div",Xe,[ae.value.underNineMonths?(f(),x(Ge,{key:0,ref_key:"birthRegistrationRef",ref:r},null,512)):g("",!0)])):g("",!0),ae.value.moreThanThirteenYears?(f(),h("div",Ze,[y(je,{ref_key:"socialHistoryRef",ref:d},null,512)])):g("",!0),_("div",et,[y(ke,{ref_key:"countryRef",ref:u},null,512)])],512),[[j,k(re)(1)]]),null!==(t=W.value)&&void 0!==t&&null!==(t=t.country)&&void 0!==t&&t.name&&"Malawi"!==(null===(a=W.value)||void 0===a||null===(a=a.country)||void 0===a?void 0:a.name)?g("",!0):Y((f(),h("div",tt,[_("div",at,[y(De,{ref_key:"currentLocationRef",ref:s},null,512)]),_("div",nt,[y(xe,{currentLocationFormValues:$.value,ref_key:"homeLocationRef",ref:c},null,8,["currentLocationFormValues"])])],512)),[[j,k(re)(2)]]),Y(_("div",it,[_("div",ot,[y(Ye,{personalInformationFormValues:B.value,ref_key:"guardianInformationRef",ref:m},null,8,["personalInformationFormValues"])]),1==k(Q).getProgramID()?(f(),h("div",lt,[y(qe,{ref_key:"patientTypeRef",ref:p},null,512)])):g("",!0)],512),[[j,k(re)(3)]])])]}),_:1}),y(k(q),null,{default:b(()=>[_("div",rt,[_("div",dt,[y(k(i),{color:"danger","aria-label":"Cancel registration",onClick:F[0]||(F[0]=t=>e.editMode?(async()=>{await he("Do you want to cancel editing of demographics?","",{confirmBtnLabel:"Yes",icon:"",showBackdrop:!0})&&v.dismiss()})():(async()=>{if(await pe("Do you want to cancel registration?")){const e=n.query.context,t=n.query.returnTo;if(te(),"neonatal-mother"===e&&"/neonatal/enrollment"===t)return o.clearEnrollmentContext(),void setTimeout(()=>{a.replace({path:t})},50);a.replace({path:"/home"})}})())},{default:b(()=>[...F[5]||(F[5]=[I("Cancel",-1)])]),_:1}),Y(y(k(i),{onClick:F[1]||(F[1]=e=>k(oe)()),"aria-label":"Go to previous page"},{default:b(()=>[...F[6]||(F[6]=[I("Previous",-1)])]),_:1},512),[[j,k(de)]])]),k(ue)?(f(),h("div",ut,[(f(!0),h(D,null,P(k(se),e=>(f(),h("span",{key:e,class:E({dot:!0,active:e===k(ce)}),onClick:t=>k(le)(e),"aria-label":`Go to page ${e}`,role:"button"},null,10,st))),128))])):g("",!0),_("div",ct,[Y(y(k(i),{name:"Save",onClick:F[2]||(F[2]=t=>e.editMode?(async()=>{ee()?await(new Ae).updateDemographics(Z.value)&&v.dismiss():ve("Please fill in all required fields")})():ge()),"aria-label":"Save patient data"},{default:b(()=>[I(T(e.editMode?"Update":"Save"),1)]),_:1},512),[[j,k(ce)===k(se)]]),Y(y(k(i),{onClick:F[3]||(F[3]=e=>k(ie)()),"aria-label":"Go to next page"},{default:b(()=>[...F[7]||(F[7]=[I("Next",-1)])]),_:1},512),[[j,k(me)]])])])]),_:1})]),_:1},8,["class"]))}}),vt=t("R",W(mt,[["__scopeId","data-v-612f8ee5"]])),pt=Object.freeze(Object.defineProperty({__proto__:null,default:vt},Symbol.toStringTag,{value:"Module"}));t("e",pt)}}})}();

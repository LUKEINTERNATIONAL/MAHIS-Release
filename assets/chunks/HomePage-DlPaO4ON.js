var Ee=Object.defineProperty;var Fe=(t,e,s)=>e in t?Ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var nt=(t,e,s)=>Fe(t,typeof e!="symbol"?e+"":e,s);import{d as H,cZ as Be,ap as Ct,r as E,c as Q,w as dt,a as ct,e as v,f as d,k as n,m as A,p as st,K as _,l as a,u as k,b3 as re,Q as N,L as J,F as x,P as q,c_ as xe,cb as He,ay as le,bD as Ue,bp as We,c6 as qt,be as de,b7 as $t,H as g,O as V,J as l,D as ce,ai as Z,c$ as ue,d0 as pe,ar as me,d1 as he,d2 as ze,cg as ge,d3 as je,d4 as Ge,d5 as Je,d6 as qe,d7 as Qe,d8 as Ye,d9 as Xe,aU as Ze,bT as fe,an as Ke,n as Lt,aV as Qt,aR as _e,aS as ve,bw as Vt,a6 as Mt,N as Ot,a5 as Et,G as ut,a7 as wt,I as it,a4 as tt,bE as zt,a2 as tn,da as en,aH as nn,db as an,dc as sn,cG as on,aG as rn,cL as ye,aP as gt,b2 as jt,W as Rt,dd as be,aL as Yt,cr as De,aF as ln,i as dn,b9 as cn,de as un,z as pn,df as Xt,dg as lt,X as vt,dh as Ce,ba as mn,bu as hn,br as gn,E as kt,aj as St,ak as pt,$ as mt,R as Ft,bb as fn,di as _n,dj as vn,dk as yn,dl as bn,bC as Bt,b6 as $e,dm as Dn,ca as Cn,dn as $n,dp as wn,bx as kn,b$ as Sn}from"./vendor-BataJFSH.js";import{S as W,u as K,_ as z,P as ft,t as bt,a as we,E as In,H as S,A as An,g as Dt,b as ke,c as Pn,d as Se,e as te,f as Ie,h as Tn,i as It,R as Nn,p as On,j as ee,k as Rn,O as Ln,l as Vn,B as Mn,m as ne,n as xt,o as Nt,q as En,r as Ae,s as Gt,v as Fn,w as ae,T as Pe,x as Bn,y as at,z as se,C as xn,D as Hn,U as Un,L as Wn,F as zn}from"../index-CYcjB3lE.js";import{m as Zt}from"./apexcharts-BVd6_RNM.js";import{A as Te}from"./ncd_appointment_service-i5Ey5kTC.js";import{D as Kt}from"./DateInputField-CuXM8Muc.js";import{u as jn,_ as Gn,M as Jn}from"./ActionButtons.vue_vue_type_script_setup_true_lang-CVsOH8xx.js";import{V as qn}from"./ViewToggleComponent-DVvWRvOk.js";import{B as Qn}from"./bottomNavBar-C8qBtJ4G.js";import{P as Yn}from"./patient_report_service-BIEyl5gt.js";import{l as yt}from"./lodash-NJiRuGo9.js";import{B as At}from"./BasicForm-BGQiOLaa.js";import{B as Ht}from"./BasicCard-DGVeOuOR.js";import{u as Xn}from"./AdministerOtherVaccinesStore-DKL9kpHC.js";import{c as Zn}from"./customDatePicker-BNK8L6Gt.js";import{s as Kn}from"./vaccines_service-jL4y0Qg3.js";import{g as ta}from"./dashboard_service-8Y7CAfk6.js";import{i as ea}from"./Img-CJEgX1Vr.js";import{u as Ne}from"./useUserActivities-BZ8hCdUF.js";import na from"./NeonatalHome-DR0O9srZ.js";import{u as aa}from"./useUserRole-thYYYNYs.js";import"./sms_service-CfLPAmD3.js";import"./EIRreportsStore-DPBsJTJR.js";import"./Export-kNnnCNnD.js";import"./neonatal_service-BxMlGviG.js";import"./images-Zb0Yk5XL.js";const ot={VITALS:6,APPOINTMENT:7,HIV_CLINIC_REGISTRATION:9,TREATMENT:25,HIV_RECEPTION:51,HIV_STAGING:52,HIV_CLINIC_CONSULTATION:53,DISPENSING:54,ART_ADHERENCE:68};class oe extends W{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(e){return await super.getJson("fhir/patient/".concat(e),{id:e})}static async getFhirObservations(e){return await super.getJson("fhir/patient/".concat(e,"/observations/"),{id:e})}}const sa={class:"fhir-viewer"},oa={class:"container"},ia={key:0,class:"main-header"},ra={class:"header-line"},la={key:0,class:"last-updated-display"},da={key:1,class:"card initial-input-card"},ca={class:"action-area-initial"},ua={key:0,class:"card patient-card"},pa={class:"card-title"},ma={class:"patient-info-grid"},ha={class:"info-item"},ga={class:"info-value"},fa={class:"info-item"},_a={class:"info-value"},va={class:"info-item"},ya={class:"info-value"},ba={class:"info-item"},Da={class:"info-value"},Ca={class:"info-value"},$a={class:"info-value"},wa={class:"info-label"},ka={class:"info-value"},Sa={key:2,class:"card observations-card"},Ia={class:"card-title"},Aa={class:"observations-grid"},Pa={class:"obs-header"},Ta={class:"obs-title"},Na={class:"obs-details"},Oa={class:"obs-detail obs-value-highlight"},Ra={class:"obs-value"},La={class:"obs-detail"},Va={class:"obs-value"},Ma={key:0,class:"obs-detail"},Ea={class:"obs-value"},Fa={key:3,class:"no-data-found"},Ba={key:4,class:"no-data-found"},xa={key:5,class:"main-footer"},Ha=H({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(t){Be({"person-circle-outline":de,"clipboard-outline":qt,"search-outline":We,"information-circle-outline":Ue,"alert-circle-outline":le,"person-add-outline":He,"arrow-back-outline":xe});const e=t,s=Ct(),i=E(!1),r=E([]),c=E(),o=E(),u=E(null),m=E([]),h=Q(()=>r.value.some(w=>w.resourceType==="Bundle"&&w.entry&&w.entry.some(f=>f.resource&&f.resource.resourceType==="Patient"))),p=Q(()=>m.value.length>0),D=async()=>{if(r.value=[],o.value=null,u.value=null,m.value=[],!c.value){console.error("Please enter a Patient Identifier.");return}i.value=!0;try{const w=await oe.getFhirPatient(c.value);if(w&&w.entry&&w.entry.length>0){const f=w.entry[0].resource,G=f.id,U=await oe.getFhirObservations(G);r.value=[w],U&&(r.value.push(U),m.value=U.entry.filter(Y=>Y.resource&&Y.resource.resourceType==="Observation").map(Y=>{const L=Y.resource;return{id:L.id,display:M(L),value:j(L),date:L.effectiveDateTime,category:L.category&&L.category[0]&&L.category[0].coding&&L.category[0].coding[0]?L.category[0].coding[0].display||L.category[0].coding[0].code:"N/A"}}));const F=f.name&&f.name[0];u.value={personInformation:{given_name:F&&F.given?F.given.join(" "):"",middle_name:F&&F.middle?F.middle.join(" "):"",family_name:F&&F.family?F.family:"",gender:f.gender=="male"?"M":(f==null?void 0:f.gender)=="female"?"F":"",birthdate:f.birthDate||"",cell_phone_number:f.telecom&&f.telecom[0]?f.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:f.contact&&f.contact[0]&&f.contact[0].telecom?f.contact[0].telecom[0].value:""}]}};const R=[w,U].filter(Boolean).reduce((Y,L)=>{if(L.meta&&L.meta.lastUpdated){const et=new Date(L.meta.lastUpdated);return Y===null||et>Y?et:Y}return Y},null);R&&(o.value=I(R.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch(w){console.error("Error loading FHIR data:",w),r.value=[],o.value=null,u.value=null,m.value=[]}finally{i.value=!1}},$=w=>{if(w.name&&w.name[0]){const f=w.name[0],G=f.given?f.given.join(" "):"",U=f.family||"";return"".concat(G," ").concat(U).trim()||"N/A"}return"N/A"},C=w=>w.identifier&&w.identifier.length>0?w.identifier.map(f=>{let G="Unknown System";if(f.type&&f.type.coding&&f.type.coding[0]&&f.type.coding[0].display)G=f.type.coding[0].display;else if(f.system){const F=f.system.split("/");G=F[F.length-1]||f.system,f.system==="urn:oid:2.16.840.1.113883.4.6"&&(G="Social Security Number")}sessionStorage.setItem(G,f.value);let U=null;return f.assigner&&f.assigner.display?U=f.assigner.display:f.assigner&&f.assigner.reference&&(U=f.assigner.reference.split("/").pop()||f.assigner.reference),{value:f.value||"N/A",systemDisplay:G,periodStart:f.period?f.period.start:null,periodEnd:f.period?f.period.end:null,assignerDisplay:U}}):[],y=w=>w.telecom&&w.telecom.length>0?w.telecom.filter(f=>f.system==="phone"&&f.value):[],b=w=>{if(w.contact&&w.contact.length>0){const f=w.contact.filter(U=>{var F;return(F=U.relationship)==null?void 0:F.some(B=>{var R;return(R=B.coding)==null?void 0:R.some(Y=>Y.code==="GUARD")})}),G=[];return f.forEach(U=>{U.telecom&&U.telecom.length>0&&U.telecom.filter(F=>F.system==="phone"&&F.value).forEach(F=>G.push(F))}),G}return[]},P=w=>{if(!w)return"N/A";try{return new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(f){return console.error("Invalid date string for formatDate:",w,f),"Invalid Date"}},I=w=>{if(!w)return"N/A";try{return new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(f){return console.error("Invalid date time string for formatDateTime:",w,f),"Invalid Date/Time"}},T=w=>{if(!w)return"N/A";try{const f=new Date,G=new Date(w);let U=f.getFullYear()-G.getFullYear();const F=f.getMonth()-G.getMonth();return(F<0||F===0&&f.getDate()<G.getDate())&&U--,U}catch(f){return console.error("Invalid birth date string for calculateAge:",w,f),"N/A"}},O=w=>{if(w.meta&&w.meta.tag){const f=w.meta.tag.find(G=>G.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return f?f.code:"Unknown"}return"Unknown"},M=w=>w.code&&w.code.coding&&w.code.coding[0]&&(w.code.coding[0].display||w.code.coding[0].code)||"Unknown Observation",j=w=>w.valueQuantity?"".concat(w.valueQuantity.value," ").concat(w.valueQuantity.unit||"").trim():w.valueString?w.valueString:w.valueBoolean!==void 0?w.valueBoolean?"True":"False":"N/A",X=()=>{K().setRecord(u.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(m.value)),Tt("/registration/manual")},ht=()=>{r.value=[],c.value="",o.value=null,u.value=null,m.value=[]},Tt=w=>{s.push({path:w})};return dt(()=>s,async()=>{r.value=[],m.value=[]},{deep:!0}),ct(()=>{var w;if(e.initialData.length>0){r.value=e.initialData;const G=e.initialData.filter(Boolean).reduce((B,R)=>{if(R.meta&&R.meta.lastUpdated){const Y=new Date(R.meta.lastUpdated);return B===null||Y>B?Y:B}return B},null);G&&(o.value=I(G.toISOString()));const U=e.initialData.find(B=>B.resourceType==="Bundle"&&B.entry&&B.entry.some(R=>R.resource&&R.resource.resourceType==="Patient"));if(U){const B=(w=U.entry.find(R=>R.resource&&R.resource.resourceType==="Patient"))==null?void 0:w.resource;if(B){const R=B.name&&B.name[0];u.value={personInformation:{given_name:R&&R.given?R.given.join(" "):"",middle_name:R&&R.middle?R.middle.join(" "):"",family_name:R&&R.family?R.family:"",gender:B.gender||"",birthdate:B.birthDate||""}}}}const F=e.initialData.find(B=>B.resourceType==="Bundle"&&B.entry&&B.entry.some(R=>R.resource&&R.resource.resourceType==="Observation"));F&&(m.value=F.entry.filter(B=>B.resource&&B.resource.resourceType==="Observation").map(B=>{const R=B.resource;return{id:R.id,display:M(R),value:j(R),date:R.effectiveDateTime,category:R.category&&R.category[0]&&R.category[0].coding&&R.category[0].coding[0]?R.category[0].coding[0].display||R.category[0].coding[0].code:"N/A"}}))}}),(w,f)=>{var G,U,F,B,R,Y;return d(),v("div",sa,[n("div",oa,[(G=r.value)!=null&&G.length?(d(),v("header",ia,[n("div",ra,[f[1]||(f[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:st(["last-updated-display","status-"+O(r.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+_(O(r.value[0].entry[0].resource)),3),o.value?(d(),v("span",la,"Last Updated: "+_(o.value),1)):A("",!0)])])])):A("",!0),(U=r.value)!=null&&U.length?A("",!0):(d(),v("section",da,[a(k(re),{modelValue:c.value,"onUpdate:modelValue":f[0]||(f[0]=L=>c.value=L),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",ca,[n("button",{onClick:D,class:"load-data-btn"},[a(k(J),{name:"search-outline"}),f[2]||(f[2]=N(" Find Patient ",-1))])])])),(d(!0),v(x,null,q(r.value,L=>(d(),v("div",{key:L.id},[L.resourceType==="Bundle"&&L.entry&&L.entry[0]&&L.entry[0].resource.resourceType==="Patient"?(d(),v("section",ua,[n("h2",pa,[a(k(J),{name:"person-circle-outline"}),f[3]||(f[3]=N(" Patient Demographics",-1))]),n("div",ma,[n("div",ha,[f[4]||(f[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",ga,_($(L.entry[0].resource)),1)]),n("div",fa,[f[5]||(f[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",_a,_(L.entry[0].resource.gender||"Not specified"),1)]),n("div",va,[f[6]||(f[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",ya,_(P(L.entry[0].resource.birthDate)),1)]),n("div",ba,[f[7]||(f[7]=n("span",{class:"info-label"},"Age",-1)),n("span",Da,_(T(L.entry[0].resource.birthDate))+" years",1)]),y(L.entry[0].resource).length?(d(!0),v(x,{key:0},q(y(L.entry[0].resource),(et,_t)=>(d(),v("div",{key:"patient-phone-".concat(_t),class:"info-item"},[f[8]||(f[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",Ca,_(et.value),1)]))),128)):A("",!0),b(L.entry[0].resource).length?(d(!0),v(x,{key:1},q(b(L.entry[0].resource),(et,_t)=>(d(),v("div",{key:"guardian-phone-".concat(_t),class:"info-item"},[f[9]||(f[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",$a,_(et.value),1)]))),128)):A("",!0),(d(!0),v(x,null,q(C(L.entry[0].resource),(et,_t)=>(d(),v("div",{key:et.value||_t,class:"info-item"},[n("span",wa,_(et.systemDisplay),1),n("span",ka,_(et.value),1)]))),128))])])):A("",!0)]))),128)),((F=m.value)==null?void 0:F.length)>0?(d(),v("section",Sa,[n("h2",Ia,[a(k(J),{name:"clipboard-outline"}),f[10]||(f[10]=N(" Clinical Observations",-1))]),n("div",Aa,[(d(!0),v(x,null,q(m.value,L=>(d(),v("div",{key:L.id,class:"observation-item"},[n("div",Pa,[n("h3",Ta,_(L.display),1)]),n("div",Na,[n("div",Oa,[f[11]||(f[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",Ra,_(L.value),1)]),n("div",La,[f[12]||(f[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",Va,_(I(L.date)),1)]),L.category&&L.category!=="N/A"?(d(),v("div",Ma,[f[13]||(f[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",Ea,_(L.category),1)])):A("",!0)])]))),128))])])):A("",!0),(B=r.value)!=null&&B.length&&!h.value?(d(),v("div",Fa,[n("p",null,[a(k(J),{name:"alert-circle-outline"}),f[14]||(f[14]=N(" No patient data found for the provided identifier. Please try again.",-1))])])):(R=r.value)!=null&&R.length&&h.value&&!p.value?(d(),v("div",Ba,[n("p",null,[a(k(J),{name:"information-circle-outline"}),f[15]||(f[15]=N(" No clinical observations found for this patient.",-1))])])):A("",!0),(Y=r.value)!=null&&Y.length?(d(),v("footer",xa,[n("button",{onClick:ht,class:"back-to-search-btn small-btn"},[a(k(J),{name:"arrow-back-outline"}),f[16]||(f[16]=N(" Back to Search ",-1))]),n("button",{onClick:X,class:"register-btn small-btn"},[a(k(J),{name:"person-add-outline"}),f[17]||(f[17]=N(" Register New Patient ",-1))])])):A("",!0)])])}}}),Ua=z(Ha,[["__scopeId","data-v-0dc329ef"]]),Wa=H({components:{DataTable:$t},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Referred From",data:"referredFrom"},{title:"Referred By",data:"referredBy"},{title:"Clinic Date",data:"appointmentDate"},{title:"Actions",data:null,render:(t,e,s)=>'<ion-button size="small" fill="solid" color="primary" onclick="window.navigatePatient(\''.concat(s.patient_id,"')\">Profile</ion-button>"),orderable:!1,width:"20%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No referrals found."}}}},async mounted(){var r;const e=(r=we().activeProgram)==null?void 0:r.program_id,s=String(localStorage.getItem("locationID")),i=await In.getAllEncounters({encounter_type_id:114});console.log("Encounters fetched for Internal Referrals:",i),this.patients=i.reduce((c,o)=>{var $,C,y,b,P,I,T,O;if(String(o==null?void 0:o.location_id)!==s||!(($=o==null?void 0:o.observations)==null?void 0:$.find(M=>(M==null?void 0:M.concept_id)===2227&&(M==null?void 0:M.value_numeric)===e)))return c;const m=(b=(y=(C=o==null?void 0:o.patient)==null?void 0:C.person)==null?void 0:y.names)!=null&&b[0]?"".concat(o.patient.person.names[0].given_name||""," ").concat(o.patient.person.names[0].family_name||""):"Unknown";let h=((P=o==null?void 0:o.program)==null?void 0:P.name)||"Unknown Program";h=h.replace(/program/i,"").trim();const p=(T=(I=o==null?void 0:o.provider)==null?void 0:I.names)!=null&&T[0]?"".concat(o.provider.names[0].given_name||""," ").concat(o.provider.names[0].family_name||""):"Unknown",D=(O=o==null?void 0:o.observations)==null?void 0:O.find(M=>{var j,X;return(X=(j=M==null?void 0:M.concept)==null?void 0:j.concept_names)==null?void 0:X.some(ht=>{var Tt;return(Tt=ht==null?void 0:ht.name)==null?void 0:Tt.toLowerCase().includes("date of referral")})});return c.push({patient_id:o.patient_id,fullName:m,referredFrom:h,referredBy:p,appointmentDate:(D==null?void 0:D.value_text)||"N/A"}),c},[]),window.navigatePatient=this.navigateTo},methods:{async navigateTo(t){let e=await ft.findByID(t);e?(await K().setPatientRecord(e),this.$router.push("/patientProfile")):bt("Patient not found. Please try searching by name.")}}}),za={class:"dueCardContent"};function ja(t,e,s,i,r,c){const o=g("DataTable"),u=g("ion-card-content"),m=g("ion-card");return d(),V(m,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:l(()=>[a(u,null,{default:l(()=>[n("div",za,[a(o,{data:t.patients,columns:t.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})}const Oe=z(Wa,[["render",ja],["__scopeId","data-v-a95ef46a"]]),Ga=H({name:"referrals",components:{InternalReferrals:Oe,ExternalReferrals:Ua},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){this.segmentContent=t}}}),Ja={key:0},qa={style:{display:"flex","margin-top":"10px"}},Qa={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},Ya={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},Xa={key:1},Za={key:2};function Ka(t,e,s,i,r,c){const o=g("ion-label"),u=g("ion-segment-button"),m=g("ion-segment"),h=g("ExternalReferrals"),p=g("InternalReferrals");return d(),v(x,null,[n("div",null,[a(m,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:l(()=>[a(u,{value:"External referrals",onClick:e[0]||(e[0]=D=>t.setSegmentContent("External referrals"))},{default:l(()=>[a(o,null,{default:l(()=>[...e[2]||(e[2]=[N("External referrals",-1)])]),_:1})]),_:1}),a(u,{value:"Internal referrals",onClick:e[1]||(e[1]=D=>t.setSegmentContent("Internal referrals"))},{default:l(()=>[a(o,null,{default:l(()=>[...e[3]||(e[3]=[N("Internal referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(d(),v("div",Ja,[n("div",qa,[t.checkUnderFive?(d(),v("div",Qa)):A("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?A("",!0):(d(),v("div",Ya))])])):A("",!0),t.segmentContent=="External referrals"?(d(),v("div",Xa,[a(h)])):A("",!0),t.segmentContent=="Internal referrals"?(d(),v("div",Za,[a(p)])):A("",!0)],64)}const ts=z(Ga,[["render",Ka],["__scopeId","data-v-8f0f935e"]]),Jt=ce("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(t){this.selectedItem=t},getSelectedItem(){return this.selectedItem}},persist:!0}),es=()=>{const t=E(null);return{activeIteminMixin:t,setActiveItem:s=>{t.value=s,console.log("lll: ",t.value)}}},Pt=H({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:t,setActiveItem:e}=es();return{chevronBackOutline:fe,checkmark:Ze,grid:Xe,chevronDownCircle:Ye,chevronForwardCircle:Qe,chevronUpCircle:qe,colorPalette:Je,document:Ge,globe:je,medkit:ge,add:ze,person:he,people:me,thermometer:pe,clipboard:ue,activeIteminMixin:t,setActiveItem:e}},async mounted(){await this.setAppointments()},computed:{...Z(K,["patient"])},watch:{$route:{async handler(t){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await An.getDailyAppointments(S.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((t,e)=>t.given_name.localeCompare(e.given_name)))},formatBirthdate(t){return S.getBirthdateAge(t)},setActiveItemRefFN(t){Jt().setSelectedItem(t)}}}),ns=ce("ncdDashboardStore",{state:()=>({dashboardData:null,appointments:[],isLoading:!1,error:null,lastFetchDate:null,programId:32}),getters:{appointmentsCount:t=>t.appointments.length,pendingDispensationsCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_pending_dispensations)||0},defaultersCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_defaulters)||0},complicationsCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_complications)||0},activeClientsCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_client_registered)||0},genderChartData:t=>{var e;return(e=t.dashboardData)!=null&&e.gender_data?{categories:t.dashboardData.gender_data.categories,series:[{name:"Male",data:t.dashboardData.gender_data.maleSeries},{name:"Female",data:t.dashboardData.gender_data.femaleSeries}]}:{categories:[],series:[{name:"Male",data:[]},{name:"Female",data:[]}]}},diagnosisChartData:t=>{var e;return(e=t.dashboardData)!=null&&e.diagnosis_data?{categories:t.dashboardData.diagnosis_data.categories,series:[{name:"Type 1 Diabetes",data:t.dashboardData.diagnosis_data.typeOneSeries},{name:"Type 2 Diabetes",data:t.dashboardData.diagnosis_data.typeTwoSeries},{name:"Hypertention",data:t.dashboardData.diagnosis_data.hypertentionSeries}]}:{categories:[],series:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},hasData:t=>t.dashboardData!==null,isDataStale:t=>{if(!t.lastFetchDate)return!0;const e=S.toStandardHisFormat(S.sessionDate());return t.lastFetchDate!==e}},actions:{async fetchDashboardData(t,e){this.isLoading=!0,this.error=null;try{const s=t||S.toStandardHisFormat(S.sessionDate()),i=e||S.toStandardHisFormat(S.sessionDate()),r="programs/".concat(this.programId,"/reports/ncd_dashboard"),c=await W.getJson(r,{start_date:s,end_date:i});this.setDashboardData(c),this.lastFetchDate=s}catch(s){this.error=s.message||"Failed to fetch dashboard data",console.error("Error fetching NCD dashboard data:",s)}finally{this.isLoading=!1}},setDashboardData(t){this.dashboardData=t},setAppointments(t){this.appointments=t},addAppointment(t){this.appointments.push(t)},removeAppointment(t){this.appointments=this.appointments.filter(e=>e.id!==t)},updateAppointment(t,e){const s=this.appointments.findIndex(i=>i.id===t);s!==-1&&(this.appointments[s]={...this.appointments[s],...e})},setProgramId(t){this.programId=t},clearDashboardData(){this.dashboardData=null,this.appointments=[],this.error=null,this.lastFetchDate=null},async refreshDashboardData(){await this.fetchDashboardData()},async ensureFreshData(){(this.isDataStale||!this.hasData)&&await this.fetchDashboardData()}},persist:{key:"ncd-dashboard-store",storage:localStorage,paths:["dashboardData","appointments","lastFetchDate","programId"]}});async function as(){const t=localStorage.getItem("locationID"),e=32,i=(await Dt("patients_records",{selector:{location_id:t}})).filter($=>($.activePrograms||[]).some(y=>y.program_id===e)),r=i.length,c=i.filter($=>{var C;return((C=$.personInformation)==null?void 0:C.gender)==="M"}).length,o=i.filter($=>{var C;return((C=$.personInformation)==null?void 0:C.gender)==="F"}).length,u=ss(i),m=os(i),h=is(i),p=rs(i),D=ls(i);return{total_client_registered:r,total_male_registered:c,total_female_registered:o,total_complications:u,total_defaulters:m,total_pending_dispensations:h,gender_data:{categories:p.categories,series:[{name:"Male",data:p.male,group:"apexcharts-axis-0"},{name:"Female",data:p.female,group:"apexcharts-axis-0"}]},diagnosis_data:{categories:D.categories,series:[{name:"Type 1 Diabetes",data:D.type_one,group:"apexcharts-axis-0"},{name:"Type 2 Diabetes",data:D.type_two,group:"apexcharts-axis-0"},{name:"Hypertension",data:D.hypertension,group:"apexcharts-axis-0"}]}}}function ss(t){let e=0;return t.forEach(s=>{(s.observations||[]).some(c=>{var o;return c.encounter_type===ke.COMPLICATIONS&&c.status==="saved"&&((o=c.obs)==null?void 0:o.length)>0})&&e++}),e}function os(t){const e=new Date,s=new Date(e);s.setDate(s.getDate()-60);const i=new Date(e);i.setDate(i.getDate()-120);let r=0;return t.forEach(c=>{var h;const o=((h=c.MedicationOrder)==null?void 0:h.saved)||[];if(o.length===0)return;const u=o.filter(p=>p.quantity>0).sort((p,D)=>new Date(D.start_date).getTime()-new Date(p.start_date).getTime())[0];if(!u)return;const m=new Date(u.start_date);m>=i&&m<=s&&(o.some(D=>new Date(D.start_date)>s)||r++)}),r}function is(t){let e=0;return t.forEach(s=>{var c;(((c=s.MedicationOrder)==null?void 0:c.saved)||[]).some(o=>o.quantity<=0)&&e++}),e}function rs(t){const e={};let s=new Date;for(let c=0;c<4;c++){const o=Re(s),u=Le(o);e[u]={male:new Set,female:new Set},t.forEach(m=>{var C;const h=m.patientID,p=(C=m.personInformation)==null?void 0:C.gender,D=m.observations||[];let $=!1;D.forEach(y=>{var b;y.status==="saved"&&((b=y.obs)==null||b.forEach(P=>{const I=P.obs_datetime?new Date(P.obs_datetime):null;I&&I>=o&&I<=s&&($=!0)}))}),$&&(p==="M"?e[u].male.add(h):p==="F"&&e[u].female.add(h))}),s=new Date(o),s.setDate(s.getDate()-1)}const i={};Object.entries(e).forEach(([c,o])=>{i[c]={male:o.male.size,female:o.female.size}});const r=Ve(i);return{categories:Object.keys(r),male:Object.values(r).map(c=>c.male),female:Object.values(r).map(c=>c.female)}}function ls(t){const e={};let s=new Date;for(let c=0;c<4;c++){const o=Re(s),u=Le(o);e[u]={type_one:new Set,type_two:new Set,hypertension:new Set},t.forEach(m=>{const h=m.patientID,p=m.observations||[];let D=null;p.forEach($=>{var C;$.encounter_type===ke.DIAGNOSIS&&((C=$.obs)==null||C.forEach(y=>{const b=y.obs_datetime?new Date(y.obs_datetime):null;b&&b>=o&&b<=s&&y.concept_id===6542&&(D=y.value_coded)}))}),D===6409?e[u].type_one.add(h):D===6410?e[u].type_two.add(h):(D===8809||D===903)&&e[u].hypertension.add(h)}),s=new Date(o),s.setDate(s.getDate()-1)}const i={};Object.entries(e).forEach(([c,o])=>{i[c]={type_one:o.type_one.size,type_two:o.type_two.size,hypertension:o.hypertension.size}});const r=Ve(i);return{categories:Object.keys(r),type_one:Object.values(r).map(c=>c.type_one),type_two:Object.values(r).map(c=>c.type_two),hypertension:Object.values(r).map(c=>c.hypertension)}}function Re(t){const e=t.getMonth(),s=Math.floor(e/3)*3;return new Date(t.getFullYear(),s,1)}function Le(t){const e=Math.floor(t.getMonth()/3)+1;return"Q".concat(e," ").concat(t.getFullYear())}function Ve(t){return Object.fromEntries(Object.entries(t).reverse())}const ds=H({name:"NCDDashboard",mixins:[Pt],components:{ApexChart:Zt},setup(){const t=Ct(),e=ns();return{router:t,dashboardStore:e}},data(){return{isChartReady:!1,dashboardData:{}}},computed:{lineChartOptions(){return{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:this.dashboardData.gender_data.categories},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}}},barChartOptions(){return{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:this.dashboardData.diagnosis_data.categories},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}}}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){if(W.getLanConnectionStatus()||W.getPouchDbStatus())this.dashboardData=await as();else{const t=S.toStandardHisFormat(S.sessionDate()),e=S.toStandardHisFormat(S.sessionDate()),s="programs/".concat(W.getProgramID(),"/reports/ncd_dashboard");this.dashboardData=await W.getJson(s,{start_date:t,end_date:e})}await Lt(),setTimeout(()=>{this.isChartReady=!0},100)},navigationMenu(t){try{Ke.close(),this.router.push(t).then(()=>{})}catch(e){console.error(e)}}}}),cs={class:"cards-container"},us={class:"top-card-text"},ps={class:"text-2xl font-bold"},ms={class:"top-card-text"},hs={class:"text-2xl font-bold"},gs={class:"top-card-text"},fs={class:"text-2xl font-bold"},_s={class:"top-card-text"},vs={class:"text-2xl font-bold"},ys={class:"top-card-text"},bs={class:"text-2xl font-bold"},Ds={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},Cs={ref:"chartRef1"},$s={key:1,class:"loading-state"},ws={ref:"chartRef2"},ks={key:1,class:"loading-state"};function Ss(t,e,s,i,r,c){const o=g("ion-card-content"),u=g("ion-card"),m=g("ApexChart");return d(),v(x,null,[n("div",cs,[a(u,{class:"top-card action-card",onClick:e[0]||(e[0]=h=>t.setActiveItemRefFN("appointments"))},{default:l(()=>[a(o,null,{default:l(()=>{var h;return[n("div",us,[n("div",ps,_(((h=t.appointments)==null?void 0:h.length)||0),1),e[2]||(e[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]}),_:1})]),_:1}),a(u,{class:"top-card action-card"},{default:l(()=>[a(o,null,{default:l(()=>[n("div",ms,[n("div",hs,_(t.dashboardData.total_pending_dispensations),1),e[3]||(e[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]),_:1})]),_:1}),a(u,{class:"top-card action-card"},{default:l(()=>[a(o,null,{default:l(()=>[n("div",gs,[n("div",fs,_(t.dashboardData.total_defaulters),1),e[4]||(e[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]),_:1})]),_:1}),a(u,{class:"top-card action-card"},{default:l(()=>[a(o,null,{default:l(()=>[n("div",_s,[n("div",vs,_(t.dashboardData.total_complications),1),e[5]||(e[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]),_:1})]),_:1}),a(u,{class:"top-card action-card",onClick:e[1]||(e[1]=h=>t.navigationMenu("NCDActivePatients"))},{default:l(()=>[a(o,null,{default:l(()=>[n("div",ys,[n("div",bs,_(t.dashboardData.total_client_registered),1),e[6]||(e[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]),_:1})]),_:1})]),n("div",Ds,[a(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[a(o,null,{default:l(()=>[e[7]||(e[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",Cs,[t.isChartReady?(d(),V(m,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.dashboardData.diagnosis_data.series},null,8,["options","series"])):A("",!0),t.dashboardData.isLoading?(d(),v("div",$s,"Loading...")):A("",!0)],512)]),_:1})]),_:1}),a(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[a(o,null,{default:l(()=>[e[8]||(e[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",ws,[t.isChartReady?(d(),V(m,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.dashboardData.gender_data.series},null,8,["options","series"])):A("",!0),t.dashboardData.isLoading?(d(),v("div",ks,"Loading...")):A("",!0)],512)]),_:1})]),_:1})])],64)}const Is=z(ds,[["render",Ss],["__scopeId","data-v-98002d9b"]]),As=H({name:"Home",mixins:[Se,Pt],components:{IonContent:tt,IonHeader:it,IonPage:wt,IonToolbar:ut,IonRow:Et,DateInputField:Kt,IonIcon:J,IonButton:Ot,IonCol:Mt,IonCard:Vt,IonCardHeader:ve,IonCardTitle:_e,IonCardContent:Qt,ViewToggleComponent:qn,bottomNavBar:Qn,HorizontalLine:Pn},data(){const t=localStorage.getItem("ncdStartDate"),e=localStorage.getItem("ncdEndDate"),s=E(t||S.sessionDate()),i=E(e||S.sessionDate()),r=E(S.sessionDate()),c=E(S.sessionDate()),o=E([]),u=zt({page:1,itemsPerPage:10}),m=E(0),h=jn(),p=E("list");return{minDate:r,startDate:s,endDate:i,people:o,calendarOutline:gt,openOutline:ye,maxDate:c,alertCircleOutline:le,personOutline:rn,idCardOutline:on,manOutline:sn,womanOutline:an,locationOutline:nn,timeOutline:en,todayOutline:tn,pagination:u,totalCount:m,actionButtonStore:h,currentToggleView:p}},computed:{...Z(te,["NCDAppointmentsTogglePreference"]),paginatedPeople(){const t=(this.pagination.page-1)*this.pagination.itemsPerPage,e=t+this.pagination.itemsPerPage;return this.people.slice(t,e)},groupedPaginatedPeople(){const t={};this.paginatedPeople.forEach(i=>{const r=i.appointmentDate;t[r]||(t[r]=[]),t[r].push(i)});const e=Object.keys(t).sort((i,r)=>new Date(i)-new Date(r)),s={};return e.forEach(i=>{s[i]=t[i]}),s}},$route:{async handler(){},deep:!0},watch:{NCDAppointmentsTogglePreference:{handler(t){t&&t.toggle_view&&(this.currentToggleView=t.toggle_view)},deep:!0,immediate:!0}},async mounted(){this.initTogglePreference(),this.getAppointments(),this.HideHomePageActionButton()},async unmounted(){this.actionButtonStore.resetShowActionButton()},methods:{formatBirthdate(t){return S.getBirthdateAge(t)},async getAppointments(t=!1){if(Ie().apiStatus){this.people=[],this.pagination.page=1;try{t==!0&&(this.startDate=S.sessionDate(),this.endDate=S.sessionDate(),this.getAppointmentsD1(this.startDate),this.getAppointmentsD2(this.endDate)),this.startDate>this.endDate&&(this.endDate=this.startDate),console.log(this.startDate,this.endDate),(await Te.getAppointments(this.startDate,this.endDate,"")).forEach(i=>{const r=S.toStandardHisDisplayFormat(i.appointment_date);if(!this.people.some(o=>o.person_id===i.person_id&&o.appointmentDate===r)){const o={person_id:i.person_id,npid:i.npid,appointment_id:103,encounter_id:i.encounter_id,name:i.given_name.concat(" ",i.family_name),gender:i.gender,ageDob:this.formatBirthdate(i.birthdate),village:i.city_village,appointmentDate:r};this.people.push(o)}}),this.totalCount=this.people.length}catch(s){}}},async getAppointmentsD1(t){this.startDate=S.toStandardHisFormat(t),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=S.toStandardHisFormat(t),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(t){const e=await ft.findByNpid(t);K().setPatientRecord(e[0]),this.redirectUser()},handleViewChange(t){this.currentToggleView=t,this.initTogglePreference(t,!0)},initTogglePreference(t="list",e=!1){const s={toggle_view:t},i=te();Object.keys(this.NCDAppointmentsTogglePreference).length===0?(s.toggle_view="list",i.setNCDAppointmentsTogglePreference(s),this.currentToggleView="list"):e===!0?i.setNCDAppointmentsTogglePreference(s):this.currentToggleView=this.NCDAppointmentsTogglePreference.toggle_view||"list"},redirectUser(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(s=>e.some(i=>i.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")},handlePaginationUpdate({page:t,itemsPerPage:e}){if(e!==this.pagination.itemsPerPage){const s=(this.pagination.page-1)*this.pagination.itemsPerPage,i=Math.floor(s/e)+1,r=Math.ceil(this.totalCount/e);this.pagination.page=Math.min(i,r)||1,this.pagination.itemsPerPage=e}else this.pagination.page=t},HideHomePageActionButton(){this.actionButtonStore.setShowActionButton(!1)}}}),Ps={class:"appointments-container"},Ts={class:"date-filter"},Ns={key:0,style:{margin:"20px"}},Os={key:1},Rs={class:"appointments-table"},Ls={key:2},Vs={class:"date-group-header"},Ms={class:"date-header-title"},Es={class:"date-header-count"},Fs={class:"cards-container"},Bs={class:"card-details"},xs={class:"detail-item"},Hs={class:"detail-value"},Us={class:"detail-item"},Ws={class:"detail-value"},zs={class:"detail-item"},js={class:"detail-value"},Gs={class:"detail-item"},Js={class:"detail-value"};function qs(t,e,s,i,r,c){const o=g("DateInputField"),u=g("ion-col"),m=g("ion-icon"),h=g("ion-button"),p=g("ViewToggleComponent"),D=g("ion-row"),$=g("ion-card"),C=g("HorizontalLine"),y=g("ion-card-title"),b=g("ion-card-header"),P=g("ion-card-content"),I=g("ion-content"),T=g("bottomNavBar"),O=g("ion-footer");return d(),v("div",Ps,[n("div",Ts,[a(D,null,{default:l(()=>[a(u,null,{default:l(()=>[a(o,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(u,null,{default:l(()=>[a(o,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1}),a(u,null,{default:l(()=>[a(h,{color:"primary",onClick:e[0]||(e[0]=M=>t.getAppointments(!0)),class:"apt-btn"},{default:l(()=>[a(m,{icon:t.todayOutline,slot:"start"},null,8,["icon"]),e[1]||(e[1]=n("span",{style:{margin:"5px"}}," Today ",-1))]),_:1})]),_:1}),a(u,null,{default:l(()=>[a(p,{"initial-view":t.currentToggleView,onViewChanged:t.handleViewChange},null,8,["initial-view","onViewChanged"])]),_:1})]),_:1})]),a(I,{class:"scrollable-content"},{default:l(()=>[t.people.length===0?(d(),v("div",Ns,[a(m,{icon:t.alertCircleOutline,size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),e[2]||(e[2]=n("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Appointments for selected date range",-1))])):t.currentToggleView==="list"&&t.people.length>0?(d(),v("div",Os,[a($,null,{default:l(()=>[n("table",Rs,[e[3]||(e[3]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),v(x,null,q(t.paginatedPeople,M=>(d(),v("tr",{key:M.npid},[n("td",null,[a(D,null,{default:l(()=>[a(u,null,{default:l(()=>[N(_(M.name),1)]),_:2},1024),a(u,null,{default:l(()=>[a(h,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:j=>t.openClientProfile(M.npid),color:"primary",fill:"clear",size:"small"},{default:l(()=>[a(m,{icon:t.openOutline,style:{"font-size":"28px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,_(M.npid),1),n("td",null,_(M.ageDob),1),n("td",null,_(M.gender),1),n("td",null,_(M.village),1),n("td",null,_(M.appointmentDate),1)]))),128))])])]),_:1})])):t.currentToggleView==="card"&&t.people.length>0?(d(),v("div",Ls,[(d(!0),v(x,null,q(t.groupedPaginatedPeople,(M,j)=>(d(),v("div",{key:j,class:"date-group"},[n("div",Vs,[a(m,{icon:t.calendarOutline,class:"date-header-icon"},null,8,["icon"]),n("h2",Ms,_(j),1),n("div",Es,_(M.length)+" appointment"+_(M.length!==1?"s":""),1)]),a(C,{color:"#006401",thickness:1,spacing:"sm"}),n("div",Fs,[(d(!0),v(x,null,q(M,X=>(d(),V($,{key:X.npid,class:"appointment-card"},{default:l(()=>[a(b,null,{default:l(()=>[a(D,{class:"ion-align-items-center"},{default:l(()=>[a(u,null,{default:l(()=>[a(y,{class:"card-name"},{default:l(()=>[a(m,{icon:t.personOutline,class:"name-icon"},null,8,["icon"]),N(" "+_(X.name),1)]),_:2},1024)]),_:2},1024),a(u,{size:"auto"},{default:l(()=>[a(h,{onClick:ht=>t.openClientProfile(X.npid),color:"primary",fill:"clear",size:"small",class:"view-profile-btn"},{default:l(()=>[a(m,{icon:t.openOutline},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(P,null,{default:l(()=>[n("div",Bs,[n("div",xs,[a(m,{icon:t.idCardOutline,class:"detail-icon"},null,8,["icon"]),e[4]||(e[4]=n("span",{class:"detail-label"},"NPID:",-1)),n("span",Hs,_(X.npid),1)]),n("div",Us,[a(m,{icon:t.calendarOutline,class:"detail-icon"},null,8,["icon"]),e[5]||(e[5]=n("span",{class:"detail-label"},"Age/DOB:",-1)),n("span",Ws,_(X.ageDob),1)]),n("div",zs,[a(m,{icon:X.gender==="Male"?t.manOutline:t.womanOutline,class:"detail-icon"},null,8,["icon"]),e[6]||(e[6]=n("span",{class:"detail-label"},"Gender:",-1)),n("span",js,_(X.gender),1)]),n("div",Gs,[a(m,{icon:t.locationOutline,class:"detail-icon"},null,8,["icon"]),e[7]||(e[7]=n("span",{class:"detail-label"},"Village:",-1)),n("span",Js,_(X.village),1)])])]),_:2},1024)]),_:2},1024))),128))])]))),128))])):A("",!0)]),_:1}),t.people.length>0?(d(),V(O,{key:0,class:"sticky-footer"},{default:l(()=>[a(D,null,{default:l(()=>[a(u,{size:"12",style:{"max-width":"100%"}},{default:l(()=>[a(T,{totalItems:t.totalCount,currentPage:t.pagination.page,itemsPerPage:t.pagination.itemsPerPage,"onUpdate:pagination":t.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])]),_:1})]),_:1})]),_:1})):A("",!0)])}const Qs=z(As,[["render",qs],["__scopeId","data-v-d02dae2c"]]),Ys={key:0,class:"left_col"},Xs={class:"nav-menu"},Zs=["onClick"],Ks={class:"ellipsis"},to={key:1,style:{"padding-left":"20px","padding-right":"20px"}},eo=H({__name:"NCDDashboard",setup(t){const e=Jt(),s=Q(()=>e.selectedItem),{screenWidth:i}=Tn(),r=E([{id:"dashboard",label:"Dashboard",icon:be},{id:"referrals",label:"Referrals",icon:Yt},{id:"appointments",label:"Appointments",icon:gt}]),c=E("dashboard"),o=It(),{substance:u}=jt(o);dt(()=>u.value,(h,p)=>{h!==p&&console.log("Substance changed:",h)},{deep:!0,immediate:!0});const m=h=>{c.value=h,Jt().setSelectedItem(c.value)};return dt(()=>s.value,h=>{console.log("Active item from mixin changed:",h),h&&h!=null&&m(h)},{immediate:!0}),(h,p)=>{const D=g("ion-segment-button"),$=g("ion-segment");return d(),v("div",{style:Rt(k(i)>940?"display: flex":"display: block")},[k(i)>940?(d(),v("div",Ys,[n("nav",Xs,[n("ul",null,[(d(!0),v(x,null,q(r.value,C=>(d(),v("li",{key:C.id,class:st({active:c.value===C.id}),onClick:y=>m(C.id)},[a(k(J),{icon:C.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",Ks,_(C.label),1)],10,Zs))),128))])])])):A("",!0),k(i)<=940?(d(),v("div",to,[a($,{value:c.value,style:{"margin-top":"5px","justify-content":"left"}},{default:l(()=>[(d(!0),v(x,null,q(r.value,C=>(d(),V(D,{value:C.id,key:C.id,class:st({active:c.value===C.id}),onClick:y=>m(C.id)},{default:l(()=>[a(k(J),{icon:C.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,_(C.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):A("",!0),n("div",{class:"right_col",style:Rt(k(i)>940?"width: 85%":"width: 100%")},[n("div",null,[c.value==="referrals"?(d(),V(ts,{key:0})):A("",!0),c.value==="dashboard"?(d(),V(Is,{key:1})):A("",!0),c.value==="appointments"?(d(),V(Qs,{key:2})):A("",!0)])],4)],4)}}}),no=z(eo,[["__scopeId","data-v-a1132315"]]);class ao extends W{constructor(){super()}static async getHTCDashboardSummary(e={}){return this.getJson("hts_stats",e)}}const so={class:"content-wrapper dashboard"},oo={class:"header"},io={class:"overlay"},ro={class:"big-number"},lo={class:""},co={class:"cards"},uo={class:"card"},po={class:"card-info"},mo={class:"card-number"},ho={class:"card"},go={class:"card-info"},fo={class:"card-number"},_o={class:"card"},vo={class:"card-info"},yo={class:"card-number"},bo={class:"card"},Do={class:"card-info"},Co={class:"card-number"},$o={class:"section-title"},wo={class:"section"},ko={class:"filter-bar"},So={class:"patient-list"},Io=["onClick"],Ao={class:"status-tags"},Po={class:st(["tag","yellow"])},To={class:"pagination"},No=["disabled"],Oo={class:"pagination-info"},Ro={class:"showing-info"},Lo=["disabled"],Ut=5,Vo=H({__name:"HTSDashboard",setup(t){const e=Ct(),s=De(),i=K(),r=E({clients_with_conclusive_results:0,total_clients:0,clients_tested_today:0,clients_referred_to_ART:0,visit_scheduled_today:0,patient_data:[]}),c=E(""),o=E(1),u=Q(()=>C.value.length),m=Q(()=>Math.ceil(u.value/Ut)),h=Q(()=>(o.value-1)*Ut),p=Q(()=>Math.min(h.value+Ut,u.value)),D=Q(()=>C.value.slice(h.value,p.value)),$=T=>T.toLowerCase().trim().replace(/\s+/g," "),C=Q(()=>{if(!c.value.trim())return r.value.patient_data;const T=$(c.value);return r.value.patient_data.filter(O=>$(O.patient_name||"").includes(T)||$(O.patient_gender||"").includes(T)||$(O.program_names||"").includes(T)||String(O.patient_age).includes(T))});function y(){o.value<m.value&&o.value++}function b(){o.value>1&&o.value--}const P=async T=>{await i.setPatientRecord({patient_id:T.patient_id}),e.push("/patientProfile")};dt(c,()=>{o.value=1}),dt(s,async()=>{s.name=="Home"&&await I()}),ct(async()=>{await I()});async function I(){r.value=await ao.getHTCDashboardSummary()}return(T,O)=>(d(),V(k(tt),{class:"content"},{default:l(()=>{var M;return[n("div",so,[n("div",oo,[n("div",io,[n("h1",ro,_((M=r.value)==null?void 0:M.clients_with_conclusive_results),1),O[1]||(O[1]=n("p",{class:"header-text"},[N(" Total Number of Clients Tested"),n("br"),N(" with Conclusive Results ")],-1))])]),n("div",lo,[O[8]||(O[8]=n("h2",{class:"section-title"},"Today's Stats",-1)),n("div",co,[n("div",uo,[n("div",po,[a(k(J),{icon:k(Yt),class:"card-icon"},null,8,["icon"])]),O[2]||(O[2]=n("div",{class:"card-info"},[n("p",null,"Total Clients")],-1)),n("div",mo,_(r.value.total_clients),1)]),n("div",ho,[n("div",go,[a(k(J),{icon:k(qt),class:"card-icon"},null,8,["icon"])]),O[3]||(O[3]=n("div",{class:"card-info"},[n("p",null,"Clients Tested Today")],-1)),n("div",fo,_(r.value.clients_tested_today),1)]),n("div",_o,[n("div",vo,[a(k(J),{icon:k(ln),class:"card-icon"},null,8,["icon"])]),O[4]||(O[4]=n("div",{class:"card-info"},[n("p",null,"Clients Referred To ART")],-1)),n("div",yo,_(r.value.clients_referred_to_ART),1)]),n("div",bo,[n("div",Do,[a(k(J),{icon:k(gt),class:"card-icon"},null,8,["icon"])]),O[5]||(O[5]=n("div",{class:"card-info"},[n("p",null,"Visit Scheduled Today")],-1)),n("div",Co,_(r.value.visit_scheduled_today),1)])]),n("h2",$o,"Patient Awaiting List ("+_(u.value)+")",1),n("div",wo,[n("div",ko,[dn(n("input",{class:"search-input",type:"text",placeholder:"Search Patient","onUpdate:modelValue":O[0]||(O[0]=j=>c.value=j)},null,512),[[cn,c.value]])]),n("div",So,[(d(!0),v(x,null,q(D.value,j=>(d(),v("div",{class:"patient-item",key:j.id,onClick:X=>P(j)},[n("div",null,[n("strong",null,_(j.patient_name),1),n("p",null,_(j.patient_gender=="M"?"Male":"Female")+" â€¢ "+_(j.patient_age)+"y",1)]),n("div",Ao,[n("span",Po,_(j.program_names),1)])],8,Io))),128))]),n("div",To,[n("button",{onClick:b,disabled:o.value===1,class:"pagination-btn"},[a(k(J),{icon:k(fe)},null,8,["icon"]),O[6]||(O[6]=N(" Previous ",-1))],8,No),n("div",Oo,[N(" Page "+_(o.value)+" of "+_(m.value)+" ",1),n("span",Ro,"(Showing "+_(h.value+1)+"-"+_(p.value)+" of "+_(u.value)+")",1)]),n("button",{onClick:y,disabled:o.value===m.value,class:"pagination-btn"},[O[7]||(O[7]=N(" Next ",-1)),a(k(J),{icon:k(un)},null,8,["icon"])],8,Lo)])])])])]}),_:1}))}}),Mo=z(Vo,[["__scopeId","data-v-dde1df6c"]]),ie={"HIV clinic registration":ot.HIV_CLINIC_REGISTRATION,"HIV reception":ot.HIV_RECEPTION,Vitals:ot.VITALS,"HIV staging":ot.HIV_STAGING,"HIV clinic consultation":ot.HIV_CLINIC_CONSULTATION,"ART adherence":ot.ART_ADHERENCE,Prescription:ot.TREATMENT,Dispensing:ot.DISPENSING,Appointments:ot.APPOINTMENT};class Eo extends Nn{constructor(){super()}buildEncounters(e,s){return Object.entries(ie).map(([i,r])=>({encounter:i,female:e?e[r].F:0,male:e?e[r].M:0,me:s?s[r].F+s[r].M:0,facility:e?e[r].F+e[r].M:0}))}async getStats(){const e=Object.values(ie),s=On("reports/encounters",this.buildParams()),i=await W.postJson(s,{encounter_types:e}),r=await W.postJson(s,{encounter_types:e,all:!0});return this.buildEncounters(i.data,r.data)}getEncounterStats(e){return W.postJson("reports/encounters?date=".concat(this.date,"&program_id=1"),e)}}const Fo={class:"dashboard-container"},Bo={class:"main-section"},xo={class:"chart-section"},Ho={class:"encounters-section"},Uo={class:"his-sm-text"},Wo={key:0},zo={class:"encounter-td"},jo={class:"other-td"},Go={class:"other-td"},Jo={class:"other-td"},qo={class:"other-td"},Qo={key:1},Yo=H({__name:"ARTDashboard",setup(t){const e=E([]),s=zt({options:{chart:{id:"vuechart-example"},xaxis:{categories:["","","","",""]},yaxis:{min:0,forceNiceScale:!0,title:{text:"Number of clients",align:"left"}}},series:[{name:"Total visits",data:[0,0,0,0,0],color:"#7cb5ec"},{name:"Total incomplete visits",data:[0,0,0,0,0],color:"#434348"}]}),i=zt([{"HIV clinic registration":9},{"HIV reception":51},{Vitals:6},{"HIV staging":52},{"HIV clinic consultation":53},{"ART adherence":68},{Treatment:25},{Dispensing:54},{Appointments:7}]),r=()=>{e.value=i.map(u=>({encounter:Object.keys(u)[0],female:"",male:"",me:"",facility:""}))},c=async()=>{const u=new Yn,m=W.getSessionDate();u.setStartDate(S.subtract(m,"days",5).format(ee)),u.setEndDate(S.subtract(m,"days",1).format(ee));const h=await u.getVisitStats(),p=[],D=[],$=[];Object.entries(h).forEach(([C,{incomplete:y,complete:b}])=>{$.push(pn(C).format("dddd")),p.push(y),D.push(y+b)}),s.series[0].data=[...D],s.series[1].data=[...p],s.options={...s.options,xaxis:{categories:[...$]}}},o=async()=>{try{const u=new Eo,m=i.map(D=>Object.values(D)[0]),h=await u.getEncounterStats({encounter_types:m}),p=await u.getEncounterStats({encounter_types:m,all:!0});e.value=i.map(D=>{const[$,C]=Object.entries(D)[0];return{encounter:$,female:p[C].F,male:p[C].M,me:h[C].F+h[C].M,facility:p[C].F+p[C].M}})}catch(u){console.error(u)}};return ct(()=>{r(),c(),o()}),(u,m)=>(d(),v("div",Fo,[n("div",Bo,[n("div",xo,[m[0]||(m[0]=n("h3",null,"Total visits/incomplete visits: last 5 days",-1)),a(k(Zt),{width:"100%",height:"390px",type:"bar",options:s.options,series:s.series},null,8,["options","series"])]),n("div",Ho,[m[3]||(m[3]=n("h3",null,"Encounters created today",-1)),n("table",Uo,[m[2]||(m[2]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),e.value.length?(d(),v("tbody",Wo,[(d(!0),v(x,null,q(e.value,(h,p)=>(d(),v("tr",{key:p},[n("td",zo,_(h.encounter),1),n("td",jo,_(h.female),1),n("td",Go,_(h.male),1),n("td",Jo,_(h.me),1),n("td",qo,_(h.facility),1)]))),128))])):(d(),v("tbody",Qo,[...m[1]||(m[1]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])]))])])])]))}}),Xo=z(Yo,[["__scopeId","data-v-9bb19378"]]);class Wt extends W{static getlogs(e,s){return this.getJson("notification/logs",{startDate:e,endDate:s})}static clear(e){return this.putJson("notifications/clear/".concat(e),{id:e})}static read(e){return this.putJson("notifications/update",{alerts:e})}static unread(){return this.getJson("notifications")}}const rt=E([]),Zo=Ct();function Me(){const t=Q(()=>rt.value.filter(p=>!p.read)),e=Q(()=>rt.value.length>0),s=Q(()=>t.value.length>0),i=Q(()=>t.value.length),r=Q(()=>rt.value.sort((p,D)=>new Date(p.date)>new Date(D.date)?-1:1));function c(p,D){Rn("Are you sure you want to clear notification?").then($=>{$&&Wt.clear(p).then(()=>{rt.value=rt.value.filter(C=>C.id!=p),D(p),u()}).catch(C=>{console.error(C),bt("Unable to clear notification")})})}function o(p){return S.toStandardHisDisplayFormat(p)}async function u(){rt.value=[];const p=await Wt.unread();if(!yt.isEmpty(p)){const D={highVL:[],normalVL:[],rejectedVL:[]};let $={};rt.value=p.map(C=>{let y="General";const b=C.text;let P=null;try{const I=JSON.parse(C.text);if(I.Type.match(/lims/i)){P=()=>Zo.push("/art/encounters/lab/".concat(I.PatientID)),y="".concat(I["Test type"]," results for ").concat(I["ARV-Number"]||I["Accession number"]);const T=Ln.detectHighVl(I.Result[0].value,I.Result[0].value_modifier);$={handler:P,id:C.alert_id,arv:I["ARV-Number"],accession:I["Accession number"],order_date:o(I["Orde date"]),results:I.Result[0].value_modifier+" "+I.Result[0].value,results_date:o(I.Result[0].date)},T?D.highVL.push($):I.rejection_reason?($={handler:P,id:C.alert_id,arv:I.arv_number,accession:I.accession_number,order_date:o(I.order_date),rejection_reason:I.rejection_reason},D.rejectedVL.push($)):T||D.normalVL.push($)}}catch(I){console.warn(I)}return{handler:P,message:b,vlMessageObs:D,title:y,id:C.alert_id,date:o(C.date_created)}})}}async function m(p){Wt.read([p.id]).then(()=>p.read=!0)}function h(p){typeof p.handler=="function"&&(m(p),p.handler())}return{markAsRead:m,openNotification:h,loadNotifications:u,clearNotification:c,sortedNotifications:r,hasUnreadNotifications:s,notificationCount:i,hasNotifications:e,notificationData:rt}}const Ko={class:"vl-alerts-container"},ti={class:"table-container"},ei={class:"vl-table"},ni={key:0},ai={key:0},si=["colspan"],oi={key:0},ii=H({__name:"ARTVlAlert",setup(t){const e=E("high_vl"),{notificationData:s,loadNotifications:i,clearNotification:r,openNotification:c}=Me(),o=Q(()=>{var y,b;return s.value.length?(((b=(y=s.value[0])==null?void 0:y.vlMessageObs)==null?void 0:b.highVL)||[]).length:0}),u=Q(()=>{var y,b;return s.value.length?(((b=(y=s.value[0])==null?void 0:y.vlMessageObs)==null?void 0:b.rejectedVL)||[]).length:0}),m=Q(()=>{var y,b;return s.value.length?(((b=(y=s.value[0])==null?void 0:y.vlMessageObs)==null?void 0:b.normalVL)||[]).length:0}),h=Q(()=>{var y;if(!s.value.length)return[];const C=(y=s.value[0])==null?void 0:y.vlMessageObs;if(!C)return[];switch(e.value){case"high_vl":return C.highVL||[];case"rejected":return C.rejectedVL||[];case"normal":return C.normalVL||[];default:return[]}}),p=C=>c(C),D=C=>{C.id&&r(C.id,y=>{console.log("Cleared notification ".concat(y))})},$=()=>{switch(e.value){case"high_vl":return"No high viral load results found";case"rejected":return"No rejected samples found";case"normal":return"No normal results found";default:return"No results found"}};return ct(()=>{i()}),(C,y)=>(d(),v("div",Ko,[a(k(Xt),{mode:"ios",modelValue:e.value,"onUpdate:modelValue":y[0]||(y[0]=b=>e.value=b),class:"category-segment"},{default:l(()=>[a(k(lt),{value:"high_vl"},{default:l(()=>[a(k(vt),null,{default:l(()=>[N("High VL ("+_(o.value)+")",1)]),_:1})]),_:1}),a(k(lt),{value:"rejected"},{default:l(()=>[a(k(vt),null,{default:l(()=>[N("Rejected ("+_(u.value)+")",1)]),_:1})]),_:1}),a(k(lt),{value:"normal"},{default:l(()=>[a(k(vt),null,{default:l(()=>[N("Normal Results ("+_(m.value)+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",ti,[n("table",ei,[n("thead",null,[n("tr",null,[y[1]||(y[1]=n("th",null,"ARV #",-1)),y[2]||(y[2]=n("th",null,"Accession #",-1)),y[3]||(y[3]=n("th",null,"Order Date",-1)),e.value==="rejected"?(d(),v("th",ni,"Rejection Reason")):A("",!0),y[4]||(y[4]=n("th",null,"View",-1)),y[5]||(y[5]=n("th",null,"Clear",-1))])]),n("tbody",null,[h.value.length===0?(d(),v("tr",ai,[n("td",{colspan:e.value==="rejected"?6:5,class:"empty-message"},_($()),9,si)])):A("",!0),(d(!0),v(x,null,q(h.value,b=>(d(),v("tr",{key:b.id},[n("td",null,_(b.arv||"-"),1),n("td",null,_(b.accession||"-"),1),n("td",null,_(b.order_date||"-"),1),e.value==="rejected"?(d(),v("td",oi,_(b.rejection_reason||"-"),1)):A("",!0),n("td",null,[a(k(Ot),{fill:"clear",size:"small",onClick:P=>p(b)},{default:l(()=>[a(k(J),{icon:k(Ce),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])]),n("td",null,[a(k(Ot),{fill:"clear",size:"small",onClick:P=>D(b),color:"success"},{default:l(()=>[a(k(J),{icon:k(mn),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])])]))),128))])])])]))}}),ri=z(ii,[["__scopeId","data-v-7b9c4735"]]),li={class:"dashboard-container"},di={class:"segment-content"},ci={key:0},ui={key:1},pi={key:2},mi=H({__name:"ARTHome",setup(t){const e=E("dashboard"),{notificationCount:s,loadNotifications:i}=Me();return ct(()=>{i()}),(r,c)=>(d(),v("div",li,[a(k(Xt),{modelValue:e.value,"onUpdate:modelValue":c[0]||(c[0]=o=>e.value=o)},{default:l(()=>[a(k(lt),{value:"dashboard"},{default:l(()=>[...c[1]||(c[1]=[N(" Overview ",-1)])]),_:1}),a(k(lt),{value:"viralLoadAlerts"},{default:l(()=>[n("div",di,[c[2]||(c[2]=N(" VL Alerts ",-1)),k(s)>0?(d(),V(k(hn),{key:0,color:"primary"},{default:l(()=>[N(_(k(s)),1)]),_:1})):A("",!0)])]),_:1}),a(k(lt),{value:"internalReferrals"},{default:l(()=>[...c[3]||(c[3]=[N(" Internal referrals ",-1)])]),_:1})]),_:1},8,["modelValue"]),e.value==="dashboard"?(d(),v("div",ci,[a(Xo)])):A("",!0),e.value==="viralLoadAlerts"?(d(),v("div",ui,[a(ri)])):A("",!0),e.value==="internalReferrals"?(d(),v("div",pi,[a(Oe)])):A("",!0)]))}}),hi=z(mi,[["__scopeId","data-v-d237cab2"]]);class gi{constructor(){nt(this,"socket",null);nt(this,"channel","ImmunizationReportChannel");nt(this,"isConnected",!1);nt(this,"pendingFetch",null);nt(this,"location_id");nt(this,"initPromise");nt(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});nt(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});nt(this,"onError",e=>{console.error("WebSocket error:",e),this.isConnected=!1});this.initPromise=this.init()}async init(){const e=localStorage.getItem("apiURL"),s=localStorage.getItem("apiPort"),i=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const r="".concat(i,"://").concat(e,"/api/v1/cable");this.socket=new WebSocket(r),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(r){console.error(r),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const e={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(e))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await W.getJson("immunization/stats",{start_date:S.getDateBeforeByDays(S.sessionDate(),365),end_date:S.sessionDate()})}async setMessageHandler(e){await this.initPromise,this.socket?this.socket.onmessage=s=>{e(s)}:console.error("WebSocket connection not established.")}}const fi=H({components:{IonContent:tt,IonHeader:it,IonItem:mt,IonList:pt,IonMenu:St,IonTitle:kt,IonToolbar:ut,IonInput:re,BasicInputField:Mn,BasicForm:At,PreviousVitals:Vn,customDatePicker:Zn,IonCol:Mt,IonRow:Et,VueMultiselect:gn,IonLabel:vt,DataTable:$t},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:xt,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:S.toStandardHisDisplayFormat(W.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...Z(Xn,["administerOtherVaccine"]),...Z(ne,["tempScannedBatchNumber"]),...Z(K,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await ta(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:he,pulseOutline:fn,clipboardOutline:qt}},methods:{formatBirthdate(t){return S.getBirthdateAge(t)},async openClientProfile(t){const e=await ft.findByID(t);await K().setPatientRecord(e),this.$router.push("patientProfile")},processData(){var e;return((e=this.data)==null?void 0:e.map(s=>{if(s.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let i=[];const r=c=>c.map(u=>{let m=0;return u.clients.map(h=>{(u.drug_name==this.drug_name&&(this.village==h.table.city_village||this.village=="All")||(u.drug_name==this.drug_name||this.village==h.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:h.table.given_name,family_name:h.table.family_name,patient_id:h.table.patient_id,birthdate:h.table.birthdate,city_village:h.table.city_village}),m++),this.villageList.push(h.table.city_village)}),[u.drug_name,m]}).filter(u=>u[1]!==0);return this.title=="Client due today"&&(i=r(s.value.due_today_antigens)),this.title=="Client due this week"&&(i=r(s.value.due_this_week_antigens)),this.title=="Client due this month"&&(i=r(s.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(i=r(s.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(i=r(s.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(c=>JSON.stringify(c)))].map(c=>JSON.parse(c)),this.villageList=[...new Set(this.villageList)],i}}))[0]},handleVillageClick(t){this.drug_name="",this.village=t,this.tableData=this.processData()},handleRowClick(t){var s;this.tableEvent=t.target;const e=this.tableEvent.closest("tr");if(e){const i=Array.from(((s=e.parentNode)==null?void 0:s.children)||[]).indexOf(e),r=this.tableData[i];this.drug_name=r[0],e.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(t){return S.calculateDisplayAge(t)},openPopover(t){this.event=t,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(t){var s;const e=t.target.value;this.batchNumber=e||((s=this.tempScannedBatchNumber)==null?void 0:s.text)||""},saveBatchWithTodayDate(){let t=W.getSessionDate();this.saveDta(t)},dismiss(){Ft.dismiss()},saveBatch(){let t;yt.isEmpty(this.vaccineDate)==!0?t=W.getSessionDate():t=this.vaccineDate,this.saveDta(t)},validateVaccineName(){if(yt.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(yt.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(t){this.currentDrugOb=t},isAlphaNumeric(t){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(t)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(t){this.batchNumber=t},saveDta(t){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){bt("Enter batch number!");return}if(this.batchNumber==""){bt("Enter batch number!");return}const e={batch_number:this.batchNumber,date_administered:t,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},s=ne();s.setAdministeredVaccine(e),Kn(this.patient),this.dismiss(),s.setTempScannedBatchNumber(null)}}}),_i={key:0,class:"spinner-overlay"},vi={class:"header position_content"},yi={style:{"font-size":"1.2em","font-weight":"700"}},bi={class:"dueCardContent"},Di=["onClick"],Ci={style:{"margin-right":"15px"}},$i={style:{"align-items":"center",display:"flex"}},wi={style:{"line-height":"1"}},ki={class:"client_name"},Si={class:"name"},Ii={class:"demographicsOtherRow"},Ai={class:"demographicsText"};function Pi(t,e,s,i,r,c){const o=g("ion-spinner"),u=g("ion-icon"),m=g("ion-header"),h=g("ion-card-title"),p=g("ion-card-header"),D=g("DataTable"),$=g("ion-card-content"),C=g("ion-card"),y=g("ion-item"),b=g("ion-list"),P=g("ion-popover"),I=g("ion-content");return d(),v(x,null,[t.isLoading?(d(),v("div",_i,[a(o,{name:"bubbles"}),e[3]||(e[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):A("",!0),a(m,null,{default:l(()=>[n("div",vi,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=T=>t.dismiss())},[a(u,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",yi,_(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=T=>t.openPopover(T))},[a(u,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(I,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:l(()=>[n("div",null,[a(C,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:l(()=>[a(p,null,{default:l(()=>[a(h,{class:"sectionTitle"},{default:l(()=>[...e[4]||(e[4]=[N(" Summary of required doses ",-1)])]),_:1})]),_:1}),a($,null,{default:l(()=>[n("div",bi,[a(D,{options:t.options,data:t.tableData,class:"display nowrap",width:"100%",onClick:t.handleRowClick},{default:l(()=>[...e[5]||(e[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])]),_:1},8,["options","data","onClick"])])]),_:1})]),_:1}),a(C,{class:"section",style:{"margin-inline":"0px"}},{default:l(()=>[a(p,null,{default:l(()=>[a(h,{class:"sectionTitle"},{default:l(()=>[...e[6]||(e[6]=[N("Client Details ",-1)])]),_:1})]),_:1}),a($,null,{default:l(()=>[(d(!0),v(x,null,q(t.clientDetails,(T,O)=>(d(),v("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:O,onClick:M=>t.openClientProfile(T.patient_id)},[n("div",Ci,[n("div",{class:st((T==null?void 0:T.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(u,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),n("div",$i,[n("div",wi,[n("div",ki,[n("div",Si,_(T.given_name)+" "+_(T.family_name),1)]),n("div",Ii,[n("div",Ai,[N(_(T.gender=="M"?"Male":"Female")+" ",1),e[7]||(e[7]=n("span",{class:"dot"},".",-1)),N(_(t.formatBirthdate(T.birthdate)),1)])]),n("div",null,"Village: "+_(T.city_village),1)])])],8,Di))),128))]),_:1})]),_:1})]),a(P,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:t.event,onDidDismiss:e[2]||(e[2]=T=>t.popoverOpen=!1)},{default:l(()=>[n("div",null,[e[8]||(e[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(d(!0),v(x,null,q(t.villageList,(T,O)=>(d(),V(b,{class:st(T==t.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:O},{default:l(()=>[a(y,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:M=>t.handleVillageClick(T)},{default:l(()=>[N(_(T),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const Ti=z(fi,[["render",Pi],["__scopeId","data-v-dfc02771"]]),Ni=H({name:"Menu",mixins:[Pt],components:{IonContent:tt,IonHeader:it,IonItem:mt,IonList:pt,IonMenu:St,IonTitle:kt,IonToolbar:ut,IonCheckbox:Bt,BasicForm:At,BasicCard:Ht,Carousel:bn,Slide:yn,Pagination:vn,Navigation:_n},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},setup(){return{personCircleOutline:de}},computed:{...Z(It,["substance"]),backgroundStyle(){return{background:"linear-gradient(135deg, rgba(32, 178, 170, 0.95) 0%, rgba(64, 192, 176, 0.9) 50%, rgba(150, 220, 200, 0.85) 100%), url(".concat(ea("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",minHeight:"240px"}}},watch:{},async mounted(){new gi().setMessageHandler(this.onMessage)},methods:{async onMessage(t){var s,i,r;const e=JSON.parse(t.data);e.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=e.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((s=this.reportData)==null?void 0:s.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((i=this.reportData)==null?void 0:i.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((r=this.reportData)==null?void 0:r.total_male_vaccinated_this_year)||0}])},openDueModal(t){const e={title:t,dashBoardData:this.reportData};Nt(Ti,{class:"fullScreenModal"},!0,e)},async openClientProfile(t){const e=await ft.findByNpid(t);await K().setPatientRecord(e[0]),this.$router.push("patientProfile")}}}),Oi={class:"topStats"},Ri={class:"hero-section"},Li={class:"totalStats"},Vi={class:"statsValue"},Mi={class:"statsText"},Ei={class:"dueCardContent"},Fi={class:"statsValue"},Bi={class:"statsValue"},xi={class:"statsValue"},Hi={class:"overDueCardContent"},Ui={class:"statsValue"},Wi={class:"statsValue"},zi={class:"appointment-count"},ji={key:0,class:"appointments-list"},Gi=["onClick"],Ji={class:"avatar-container"},qi={class:"appointment-details"},Qi={class:"client-name"},Yi={class:"client-info"},Xi={class:"info-badge"},Zi={class:"client-location"},Ki={key:1,class:"empty-state"};function tr(t,e,s,i,r,c){const o=g("Slide"),u=g("Pagination"),m=g("Carousel"),h=g("ion-card-title"),p=g("ion-card-header"),D=g("ion-card-content"),$=g("ion-card"),C=g("ion-icon"),y=g("ion-content");return d(),V(y,{class:"content"},{default:l(()=>[n("div",Oi,[n("div",Ri,[n("div",{style:Rt(t.backgroundStyle)},[a(m,{autoplay:4e3,"wrap-around":!0,itemsToShow:1,transition:600,class:"stats-carousel"},{addons:l(()=>[a(u)]),default:l(()=>[(d(!0),v(x,null,q(t.totalStats,b=>(d(),V(o,{key:b},{default:l(()=>[n("div",Li,[e[5]||(e[5]=n("div",{class:"stats-icon"},"ðŸ“Š",-1)),n("div",Vi,_(b.value),1),n("div",Mi,_(b.name),1)])]),_:2},1024))),128))]),_:1})],4)]),a($,{class:"section modern-card"},{default:l(()=>[a(p,null,{default:l(()=>[a(h,{class:"cardTitle"},{default:l(()=>[...e[6]||(e[6]=[n("span",{class:"title-icon"},"ðŸ“…",-1),N(" Clients Due ",-1)])]),_:1})]),_:1}),a(D,null,{default:l(()=>{var b,P,I;return[n("div",Ei,[n("div",{class:"dueCard today-card",onClick:e[0]||(e[0]=T=>t.openDueModal("Client due today"))},[e[7]||(e[7]=n("div",{class:"card-badge success"},"Today",-1)),n("div",Fi,_(((b=t.reportData)==null?void 0:b.due_today_count)||0),1),e[8]||(e[8]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard week-card",onClick:e[1]||(e[1]=T=>t.openDueModal("Client due this week"))},[e[9]||(e[9]=n("div",{class:"card-badge warning"},"Week",-1)),n("div",Bi,_(((P=t.reportData)==null?void 0:P.due_this_week_count)||0),1),e[10]||(e[10]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard month-card",onClick:e[2]||(e[2]=T=>t.openDueModal("Client due this month"))},[e[11]||(e[11]=n("div",{class:"card-badge danger"},"Month",-1)),n("div",xi,_(((I=t.reportData)==null?void 0:I.due_this_month_count)||0),1),e[12]||(e[12]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),a($,{class:"section modern-card"},{default:l(()=>[a(p,null,{default:l(()=>[a(h,{class:"cardTitle"},{default:l(()=>[...e[13]||(e[13]=[n("span",{class:"title-icon"},"âš ï¸",-1),N(" Clients Overdue ",-1)])]),_:1})]),_:1}),a(D,null,{default:l(()=>{var b,P;return[n("div",Hi,[n("div",{class:"overDueCard",onClick:e[3]||(e[3]=I=>t.openDueModal("Client overdue under 5yrs"))},[e[14]||(e[14]=n("div",{class:"overdue-icon"},"ðŸ‘¶",-1)),n("div",Ui,_(((b=t.reportData)==null?void 0:b.under_five_overdue)||0),1),e[15]||(e[15]=n("div",{class:"statsText"},"Under 5 years",-1))]),n("div",{class:"overDueCard",onClick:e[4]||(e[4]=I=>t.openDueModal("Client overdue over 5yrs"))},[e[16]||(e[16]=n("div",{class:"overdue-icon"},"ðŸ§’",-1)),n("div",Wi,_(((P=t.reportData)==null?void 0:P.over_five_overdue)||0),1),e[17]||(e[17]=n("div",{class:"statsText"},"Over 5 years",-1))])])]}),_:1})]),_:1}),a($,{class:"section modern-card appointments-card"},{default:l(()=>[a(p,null,{default:l(()=>[a(h,{class:"cardTitle"},{default:l(()=>{var b;return[e[18]||(e[18]=n("span",{class:"title-icon"},"ðŸ—“ï¸",-1)),e[19]||(e[19]=N(" Today's Appointments ",-1)),n("span",zi,_(((b=t.appointments)==null?void 0:b.length)||0),1)]}),_:1})]),_:1}),a(D,null,{default:l(()=>{var b;return[((b=t.appointments)==null?void 0:b.length)>0?(d(),v("div",ji,[(d(!0),v(x,null,q(t.appointments,(P,I)=>(d(),v("div",{class:"appointment-item",key:I,onClick:T=>t.openClientProfile(P.npid)},[n("div",Ji,[n("div",{class:st(P.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(C,{class:"person-icon",icon:t.personCircleOutline},null,8,["icon"])],2)]),n("div",qi,[n("div",Qi,_(P.given_name)+" "+_(P.family_name),1),n("div",Yi,[n("span",Xi,_(P.gender=="M"?"Male":"Female"),1),e[20]||(e[20]=n("span",{class:"dot"},"â€¢",-1)),n("span",null,_(t.formatBirthdate(P.birthdate)),1)]),n("div",Zi,[e[21]||(e[21]=n("span",{class:"location-icon"},"ðŸ“",-1)),N(" "+_(P==null?void 0:P.city_village),1)])]),e[22]||(e[22]=n("div",{class:"appointment-arrow"},"â€º",-1))],8,Gi))),128))])):(d(),v("div",Ki,[...e[23]||(e[23]=[n("div",{class:"empty-icon"},"ðŸ“‹",-1),n("p",null,"No appointments scheduled for today",-1)])]))]}),_:1})]),_:1})])]),_:1})}const er=z(Ni,[["render",tr],["__scopeId","data-v-c322c517"]]),nr=H({components:{DataTable:$t},props:{title:{type:String,default:""},list:{type:String,default:""},buttonTitle:{type:String,default:""},buttonLink:{type:String,default:""}},data(){return{patients:[],loadingStates:{},tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:(t,e)=>{if(!t)return"-";const s=new Date(t).getTime(),i=Date.now()-s,r=Math.floor(i/6e4),c=(()=>{if(r<1)return"Just now";if(r<60)return"".concat(r," min").concat(r>1?"s":""," ago");const o=Math.floor(r/60);if(o<24)return"".concat(o," hour").concat(o>1?"s":""," ago");const u=Math.floor(o/24);return"".concat(u," day").concat(u>1?"s":""," ago")})();return e==="display"?c:i},type:"num",width:"15%"},{title:"Actions",data:null,render:(t,e,s)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px",i.setAttribute("data-patient-id",s.identifier);const r="  --padding-top: 4px;\n                                            --padding-bottom: 4px;\n                                            --padding-start: 8px;\n                                            --padding-end: 8px;\n                                            font-size: 0.8rem;\n                                            height: 28px;\n                                            min-width: 70px;\n                                            white-space: nowrap;\n                                            ",c=(o,u,m,h)=>{const p=document.createElement("ion-button");p.setAttribute("data-button-type",h),p.size="small",p.fill="solid",p.color=u,p.style.cssText=r;const D=document.createElement("span");D.className="button-text",D.innerText=o;const $=document.createElement("ion-spinner");return $.name="crescent",$.className="button-spinner",$.style.display="none",$.style.width="16px",$.style.height="16px",p.appendChild(D),p.appendChild($),p.addEventListener("click",m),p};return i.appendChild(c(this.buttonTitle,"primary",()=>this.navigateTo(s,this.buttonLink),"primary")),i.appendChild(c("Profile","warning",()=>this.navigateTo(s,"/patientProfile"),"profile")),i.appendChild(c("Abscond","danger",()=>this.handleAbscond(s.identifier),"abscond")),i},orderable:!1,width:"25%"}],tableOptions:{order:[[1,"desc"]]}}},computed:{...Z(Gt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{patientsWaitingForConsultation:{handler(t){this.list==="CONSULTATION"&&(this.patients=t)},deep:!0},patientsWaitingForVitals:{handler(t){this.list==="VITALS"&&(this.patients=t)},deep:!0},patientsWaitingForLab:{handler(t){this.list==="LAB"&&(this.patients=t)},deep:!0},patientsWaitingForDispensation:{handler(t){this.list==="DISPENSATION"&&(this.patients=t)},deep:!0}},mounted(){this.setList()},methods:{setList(){const t={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation},e=this.list;this.patients=t[e]||[]},setButtonLoading(t,e,s){const i=document.querySelector('[data-patient-id="'.concat(t,'"]'));if(!i)return;const r=i.querySelector('[data-button-type="'.concat(e,'"]'));if(!r)return;const c=r.querySelector(".button-text"),o=r.querySelector(".button-spinner");s?(r.setAttribute("disabled","true"),c&&(c.style.display="none"),o&&(o.style.display="inline-block")):(r.removeAttribute("disabled"),c&&(c.style.display="inline"),o&&(o.style.display="none"))},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),s=Math.floor(e/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const i=Math.floor(s/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const r=Math.floor(i/24);return"".concat(r," day").concat(r>1?"s":""," ago")},async navigateTo(t,e){const s=e===this.buttonLink?"primary":"profile";this.setButtonLoading(t.identifier,s,!0);try{let i=[],r=null;W.getPouchDbStatus()||W.getLanConnectionStatus()?(i=await Dt("patients_records",{selector:{ID:t.identifier}}),r=i[0]):r||(r=await W.getJson("/patients/".concat(t.patient_id,"/get_patient_record")));const c=r;if(await K().setPatientRecord(c),await Lt(),Ae()){this.$router.push("/deathPatientProfile");return}this.$router.push(e)}catch(i){console.error("Error navigating:",i)}finally{this.setButtonLoading(t.identifier,s,!1)}},async handleAbscond(t){this.setButtonLoading(t,"abscond",!0);try{await En({ID:t})}catch(e){console.error("Error closing visit:",e)}finally{this.setButtonLoading(t,"abscond",!1)}},dismiss(){Ft.dismiss()}}}),ar={class:"modal-container"},sr={class:"dueCardContent"};function or(t,e,s,i,r,c){const o=g("ion-button"),u=g("ion-card-title"),m=g("ion-card-header"),h=g("DataTable"),p=g("ion-card-content"),D=g("ion-card");return d(),v("div",ar,[a(o,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:l(()=>[...e[0]||(e[0]=[N(" Close ",-1)])]),_:1},8,["onClick"]),a(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:l(()=>[a(m,null,{default:l(()=>[a(u,{class:"sectionTitle"},{default:l(()=>[N(_(t.title),1)]),_:1})]),_:1}),a(p,null,{default:l(()=>[n("div",sr,[a(h,{data:t.patients,options:t.tableOptions,columns:t.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const ir=z(nr,[["render",or],["__scopeId","data-v-ab268e6c"]]),rr=H({components:{IonContent:tt,IonHeader:it,IonItem:mt,IonList:pt,IonIcon:J,IonCard:Vt,IonCardHeader:ve,IonCardTitle:_e,IonCardContent:Qt,IonPopover:$e,DataTable:$t},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:xt,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:t=>this.waitingTime(t),width:"20%"},{title:"Actions",data:null,render:(t,e,s)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px",i.setAttribute("data-patient-id",s.identifier);const r="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",c=(o,u,m,h)=>{const p=document.createElement("ion-button");p.setAttribute("data-button-type",h),p.size="small",p.fill="solid",p.color=u,p.style.cssText=r;const D=document.createElement("span");D.className="button-text",D.innerText=o;const $=document.createElement("ion-spinner");return $.name="crescent",$.className="button-spinner",$.style.display="none",$.style.width="16px",$.style.height="16px",p.appendChild(D),p.appendChild($),p.addEventListener("click",m),p};return i.appendChild(c("Profile","warning",()=>this.navigateTo(t,"/patientProfile"),"profile")),i},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[1,"desc"],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const t=await Fn();this.patients=t.map(e=>({fullName:e.fullName||"",arrivalTime:e.startDate||"",patient_id:e.patientId||"",identifier:e.identifier||""}))},methods:{setButtonLoading(t,e,s){const i=document.querySelector('[data-patient-id="'.concat(t,'"]'));if(!i)return;const r=i.querySelector('[data-button-type="'.concat(e,'"]'));if(!r)return;const c=r.querySelector(".button-text"),o=r.querySelector(".button-spinner");s?(r.setAttribute("disabled","true"),c&&(c.style.display="none"),o&&(o.style.display="inline-block")):(r.removeAttribute("disabled"),c&&(c.style.display="inline"),o&&(o.style.display="none"))},openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Ft.dismiss()},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),s=Math.floor(e/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const i=Math.floor(s/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const r=Math.floor(i/24);return"".concat(r," day").concat(r>1?"s":""," ago")},async navigateTo(t,e){this.setButtonLoading(t.identifier,"profile",!0);try{let s;(W.getPouchDbStatus()||W.getLanConnectionStatus())&&(s=await Dt("patients_records",{selector:{ID:t.identifier}}),s=s[0]),s||(s=await ft.findByID(t.patient_id)),s?(await K().setPatientRecord(s),await Lt(),Ae()?this.$router.push("/deathPatientProfile"):this.$router.push(e)):(bt("Patient not found. Please try searching the patient by name."),this.setButtonLoading(t.identifier,"profile",!1))}catch(s){console.error("Error navigating to profile:",s),this.setButtonLoading(t.identifier,"profile",!1)}}}}),lr={class:"modal-container"},dr={class:"dueCardContent"};function cr(t,e,s,i,r,c){const o=g("ion-button"),u=g("ion-card-title"),m=g("ion-card-header"),h=g("DataTable"),p=g("ion-card-content"),D=g("ion-card");return d(),v("div",lr,[a(o,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:l(()=>[...e[0]||(e[0]=[N(" Close ",-1)])]),_:1},8,["onClick"]),a(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:l(()=>[a(m,null,{default:l(()=>[a(u,{class:"sectionTitle"},{default:l(()=>[N(_(t.title),1)]),_:1})]),_:1}),a(p,null,{default:l(()=>[n("div",dr,[a(h,{data:t.patients,options:t.tableOptions,columns:t.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const ur=z(rr,[["render",cr],["__scopeId","data-v-5866989b"]]),pr=H({name:"OPDAppointmentsModal",components:{IonPage:wt,IonHeader:it,IonContent:tt,IonItem:mt,IonList:pt,IonIcon:J,IonCard:Vt,IonCardContent:Qt,IonPopover:$e,DataTable:$t,IonSegment:Xt,IonSegmentButton:lt,IonLabel:vt,IonRow:Et,IonCol:Mt,DateInputField:Kt},props:{title:{type:String,default:"OPD Appointments"},programType:{type:String,required:!0},programId:{type:Number,required:!0}},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:xt,appointments:[],viewMode:"today",startDate:S.sessionDate(),endDate:S.sessionDate(),calendarOutline:gt,openOutline:ye,tableColumns:[{title:"Patient ID",data:"ID"},{title:"Name",data:"name"},{title:"Age/DOB",data:"ageDob"},{title:"Gender",data:"gender"},{title:"Village",data:"village"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(t,e,s)=>{const i=document.createElement("div"),r=document.createElement("ion-button");return r.innerText="Profile",r.size="small",r.style.color="#fff",r.style.padding="8px 12px",r.style.marginRight="8px",r.addEventListener("click",()=>this.openClientProfile(s.ID)),i.appendChild(r),i},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,order:[[5,"asc"]]}}},async mounted(){await this.loadAppointments()},methods:{async loadAppointments(){this.isLoading=!0;try{const t=S.sessionDate(),e=this.viewMode==="today"?t:this.startDate,s=this.viewMode==="today"?t:this.endDate,i=localStorage.getItem("locationID"),r=typeof e=="string"?e:S.toStandardHisFormat(e),c=typeof s=="string"?s:S.toStandardHisFormat(s),u=(await Dt("patients_records")).flatMap(m=>{var p,D;return[...((p=m.appointments)==null?void 0:p.saved)||[],...((D=m.appointments)==null?void 0:D.unsaved)||[]].filter($=>{if(!($!=null&&$.value_datetime)||$.location_id&&$.location_id!==i)return!1;const C=S.toStandardHisFormat($.value_datetime);return C>=r&&C<=c}).map($=>{var C,y,b,P,I;return{ID:m.ID,name:[(C=m.personInformation)==null?void 0:C.given_name,(y=m.personInformation)==null?void 0:y.family_name].filter(Boolean).join(" ")||"Unknown",ageDob:(b=m.personInformation)!=null&&b.birthdate?S.getBirthdateAge(m.personInformation.birthdate):"N/A",gender:((P=m.personInformation)==null?void 0:P.gender)||"Unknown",village:((I=m.personInformation)==null?void 0:I.home_village)||"Unknown",appointmentDate:S.toStandardHisDisplayFormat($.value_datetime),appointmentDateTime:$.value_datetime,rawData:$}})}).sort((m,h)=>new Date(m.appointmentDateTime).getTime()-new Date(h.appointmentDateTime).getTime());this.appointments=u,console.log("Found ".concat(u.length," appointments"))}catch(t){console.error("Error loading appointments:",t),ae("Failed to load appointments")}finally{this.isLoading=!1}},async getAppointmentsD1(t){this.startDate=S.toStandardHisFormat(t),await this.loadAppointments()},async getAppointmentsD2(t){this.endDate=S.toStandardHisFormat(t),await this.loadAppointments()},onViewModeChange(){this.viewMode==="today"&&(this.startDate=S.sessionDate(),this.endDate=S.sessionDate()),this.loadAppointments()},async openClientProfile(t){try{const e=await Dt("patients_records",{selector:{ID:t}});await K().setPatientRecord(e[0]),this.$router.push("patientProfile")}catch(e){console.error("Error opening profile:",e),ae("Failed to open patient profile")}},openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Ft.dismiss()}}}),mr={class:"header position_content"},hr={style:{"font-size":"1.2em","font-weight":"700"}},gr={key:0,class:"date-filter"},fr={class:"dueCardContent"},_r={key:1,class:"no-appointments"};function vr(t,e,s,i,r,c){const o=g("ion-icon"),u=g("ion-header"),m=g("ion-label"),h=g("ion-segment-button"),p=g("ion-segment"),D=g("DateInputField"),$=g("ion-col"),C=g("ion-row"),y=g("DataTable"),b=g("ion-card-content"),P=g("ion-card"),I=g("ion-content"),T=g("ion-page");return d(),V(T,null,{default:l(()=>[a(u,null,{default:l(()=>[n("div",mr,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=(...O)=>t.dismiss&&t.dismiss(...O))},[a(o,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",hr,_(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=O=>t.openPopover(O))},[a(o,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(I,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:l(()=>[a(p,{modelValue:t.viewMode,"onUpdate:modelValue":e[2]||(e[2]=O=>t.viewMode=O),onIonChange:t.onViewModeChange},{default:l(()=>[a(h,{value:"today"},{default:l(()=>[a(m,null,{default:l(()=>[...e[3]||(e[3]=[N("Today's Appointments",-1)])]),_:1})]),_:1}),a(h,{value:"range"},{default:l(()=>[a(m,null,{default:l(()=>[...e[4]||(e[4]=[N("Date Range",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","onIonChange"]),t.viewMode==="range"?(d(),v("div",gr,[a(C,null,{default:l(()=>[a($,null,{default:l(()=>[a(D,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:t.endDate,disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","maxDate","onUpdate:rawDateValue"])]),_:1}),a($,null,{default:l(()=>[a(D,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):A("",!0),a(P,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:l(()=>[a(b,null,{default:l(()=>[n("div",fr,[t.appointments.length>0?(d(),V(y,{key:0,data:t.appointments,columns:t.tableColumns,options:t.tableOptions,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns","options"])):(d(),v("div",_r," No appointments found for the selected "+_(t.viewMode==="today"?"day":"date range"),1))])]),_:1})]),_:1})]),_:1})]),_:1})}const yr=z(pr,[["render",vr],["__scopeId","data-v-e54f2168"]]),br={class:"card-count"},Dr={class:"card-label"},Cr="#ffffff",$r=H({__name:"DashboardCard",props:{icon:{},count:{},label:{},color:{}},emits:["cardClick"],setup(t,{emit:e}){const r={success:"#A5D6A7",info:"#81D4FA",warning:"#FFF59D",danger:"#EF9A9A"}[t.color||"info"]||"#E0E0E0";return(c,o)=>(d(),V(k(Vt),{class:"dashboard-card",style:Rt({borderColor:k(r),backgroundColor:Cr}),onClick:o[0]||(o[0]=u=>c.$emit("cardClick"))},{default:l(()=>[a(k(J),{icon:t.icon,class:"card-icon"},null,8,["icon"]),n("div",br,_(t.count),1),n("div",Dr,_(t.label),1)]),_:1},8,["style"]))}}),wr=z($r,[["__scopeId","data-v-84ad3c1b"]]),kr=H({name:"OPDDashboard",components:{DashboardCard:wr},setup(){const{ready:t,OPDWaitingLists:e,hasWaitingList:s,refreshUserData:i}=Ne();return{ready:t,OPDWaitingLists:e,hasWaitingList:s,refreshUserData:i}},data(){return{totalPatientsToday:0,isRefreshing:!1}},computed:{...Z(Gt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","patientsVisits","todaysAppointmentsCount"])},async mounted(){await this.refreshDashboard()},methods:{lockClosed(){return wn},refresh(){return $n},medkit(){return ge},flask(){return Cn},async refreshDashboard(){if(!this.isRefreshing){this.isRefreshing=!0;try{const t=W.getUserLocationId();if(!t)return;await Promise.all([Gt().refresh(t),this.refreshUserData()])}finally{this.isRefreshing=!1}}},clipboard(){return ue},thermometer(){return pe},calendar(){return Dn},people(){return me},openAllModal(t,e,s){Nt(ur,{class:"fullScreenModal"},!0,{title:t,buttonTitle:e,buttonLink:s})},openPatientsListModal(t,e,s,i){Nt(ir,{class:"fullScreenModal"},!0,{title:t,list:e,buttonTitle:s,buttonLink:i})},openAppointmentsModal(t,e){Nt(yr,{class:"fullScreenModal"},!0,{title:t,programType:e,programId:14})}}}),Sr={class:"dashboard-wrapper"},Ir={key:0,class:"loading-container"},Ar={key:1,class:"no-access-container"};function Pr(t,e,s,i,r,c){const o=g("ion-icon"),u=g("ion-card-title"),m=g("ion-card-header"),h=g("ion-spinner"),p=g("ion-button"),D=g("DashboardCard"),$=g("ion-row"),C=g("ion-grid"),y=g("ion-card-content"),b=g("ion-card"),P=g("ion-content");return d(),V(P,{fullscreen:!0},{default:l(()=>[n("div",Sr,[a(b,{class:"dashboard-card"},{default:l(()=>[a(m,{class:"dashboard-card-header"},{default:l(()=>[a(u,{class:"dashboard-title"},{default:l(()=>[a(o,{icon:t.people(),slot:"start",class:"dashboard-icon"},null,8,["icon"]),e[6]||(e[6]=N(" Today's Patients Overview ",-1))]),_:1})]),_:1}),a(y,null,{default:l(()=>[t.ready?t.OPDWaitingLists.length===0?(d(),v("div",Ar,[a(o,{icon:t.lockClosed(),class:"no-access-icon"},null,8,["icon"]),e[9]||(e[9]=n("h2",{class:"no-access-title"},"No Waiting Lists Assigned",-1)),e[10]||(e[10]=n("p",{class:"no-access-message"}," You currently don't have access to any waiting lists. Please contact your system administrator or supervisor to request access. ",-1)),a(p,{color:"primary",fill:"outline",onClick:t.refreshDashboard,class:"refresh-button"},{default:l(()=>[a(o,{icon:t.refresh(),slot:"start"},null,8,["icon"]),e[8]||(e[8]=N(" Refresh ",-1))]),_:1},8,["onClick"])])):(d(),V(C,{key:2,class:"centered-grid"},{default:l(()=>[a($,{class:"centered-row"},{default:l(()=>{var I,T,O,M;return[t.hasWaitingList("Total Patients Today")?(d(),V(D,{key:0,icon:t.people(),color:"primary",count:t.patientsVisits.length,label:"Total patients today",onCardClick:e[0]||(e[0]=j=>t.openAllModal("All patients today","View profile","/patientProfile"))},null,8,["icon","count"])):A("",!0),t.hasWaitingList("Appointments Today")?(d(),V(D,{key:1,icon:t.calendar(),color:"primary",count:((I=t.todaysAppointmentsCount)==null?void 0:I.length)||0,label:"Appointments",onCardClick:e[1]||(e[1]=j=>t.openAppointmentsModal("OPD Appointments","14"))},null,8,["icon","count"])):A("",!0),t.hasWaitingList("Waiting for Vitals")?(d(),V(D,{key:2,icon:t.thermometer(),color:"primary",count:(T=t.patientsWaitingForVitals)==null?void 0:T.length,label:"Waiting for vitals",onCardClick:e[2]||(e[2]=j=>t.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals"))},null,8,["icon","count"])):A("",!0),t.hasWaitingList("Waiting for Consultation")?(d(),V(D,{key:3,icon:t.clipboard(),color:"primary",count:(O=t.patientsWaitingForConsultation)==null?void 0:O.length,label:"Waiting for consultation",onCardClick:e[3]||(e[3]=j=>t.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan"))},null,8,["icon","count"])):A("",!0),t.hasWaitingList("Waiting for Laboratory")?(d(),V(D,{key:4,icon:t.flask(),color:"primary",count:t.patientsWaitingForLab.length,label:"Waiting for lab",onCardClick:e[4]||(e[4]=j=>t.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan"))},null,8,["icon","count"])):A("",!0),t.hasWaitingList("Waiting for Dispensation")?(d(),V(D,{key:5,icon:t.medkit(),color:"primary",count:(M=t.patientsWaitingForDispensation)==null?void 0:M.length,label:"Waiting for dispensation",onCardClick:e[5]||(e[5]=j=>t.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations"))},null,8,["icon","count"])):A("",!0)]}),_:1})]),_:1})):(d(),v("div",Ir,[a(h,{name:"crescent"}),e[7]||(e[7]=n("p",{class:"loading-text"},"Loading dashboard...",-1))]))]),_:1})]),_:1})])]),_:1})}const Tr=z(kr,[["render",Pr],["__scopeId","data-v-0c821bbd"]]),Nr={class:"icon-container"},Or=["src","alt"],Rr={class:"card-title"},Lr=H({__name:"DashboardCard",props:{icon:{},title:{}},emits:["click"],setup(t,{emit:e}){const s=t,i=e,r=Q(()=>xt[s.icon]||"");return(c,o)=>(d(),v("div",{class:"card",onClick:o[0]||(o[0]=u=>i("click"))},[n("div",Nr,[n("img",{src:r.value,alt:t.title},null,8,Or)]),n("div",Rr,_(t.title),1)]))}}),Vr=z(Lr,[["__scopeId","data-v-334cd0db"]]),Mr={class:"dashboard-container"},Er={class:"dashboard-grid"},Fr=H({__name:"AETCDashboard",setup(t){E("");const e=Ct(),s=E([{id:"patientArrival",icon:"plus_dashboard",title:"Patient Arrival"},{id:"screeningList",icon:"checklist",title:"Awaiting Screening List"},{id:"registrationList",icon:"checklist",title:"Awaiting Registration List"},{id:"triageList",icon:"checklist",title:"Awaiting Triage List"},{id:"assessmentList",icon:"checklist",title:"Awaiting Assessment List"},{id:"testResultsList",icon:"checklist",title:"Awaiting Test Results List"},{id:"specialtyList",icon:"checklist",title:"Awaiting Specialty List"},{id:"dispositionList",icon:"checklist",title:"Disposition List"},{id:"broughtDead",icon:"document",title:"Brought In Dead"},{id:"reports",icon:"chart",title:"Reports"}]),i=r=>{e.push({name:r})};return(r,c)=>(d(),V(k(wt),null,{default:l(()=>[a(k(tt),{fullscreen:!0},{default:l(()=>[n("div",Mr,[n("div",Er,[(d(!0),v(x,null,q(s.value,o=>(d(),V(Vr,{key:o.id,icon:o.icon,title:o.title,onClick:u=>i(o.id)},null,8,["icon","title","onClick"]))),128))])])]),_:1})]),_:1}))}}),Br=z(Fr,[["__scopeId","data-v-bcce1a76"]]),xr=H({name:"NCDDashboard",mixins:[Pt],components:{ApexChart:Zt},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await Lt(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return W.getJson("programs/32/reports/ncd_dashboard",{start_date:S.toStandardHisFormat(S.sessionDate()),end_date:S.toStandardHisFormat(S.sessionDate())})}}}),Hr={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},Ur={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},Wr={ref:"chartRef1"},zr={ref:"chartRef2"};function jr(t,e,s,i,r,c){const o=g("ion-card-content"),u=g("ion-card"),m=g("ApexChart");return d(),v(x,null,[n("div",Hr,[a(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[a(o,null,{default:l(()=>[...e[0]||(e[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])]),_:1})]),_:1}),a(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[a(o,null,{default:l(()=>[...e[1]||(e[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])]),_:1})]),_:1}),a(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[a(o,null,{default:l(()=>[...e[2]||(e[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])]),_:1})]),_:1}),a(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[a(o,null,{default:l(()=>[...e[3]||(e[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])]),_:1})]),_:1})]),n("div",Ur,[a(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[a(o,null,{default:l(()=>[e[4]||(e[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",Wr,[t.isChartReady?(d(),V(m,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):A("",!0)],512)]),_:1})]),_:1}),a(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[a(o,null,{default:l(()=>[e[5]||(e[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",zr,[t.isChartReady?(d(),V(m,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):A("",!0)],512)]),_:1})]),_:1})])],64)}const Gr=z(xr,[["render",jr],["__scopeId","data-v-58e2a3d8"]]),Jr=H({name:"Home",mixins:[Se,Pt],components:{IonContent:tt,IonHeader:it,IonPage:wt,IonToolbar:ut,Toolbar:Pe,IonRow:Et,DateInputField:Kt,IonIcon:J,IonButton:Ot,IonCol:Mt},data(){const t=E(S.sessionDate()),e=E(S.sessionDate()),s=E(S.sessionDate()),i=E([]);return{segmentContent:"Today",minDate:s,startDate:t,endDate:e,people:i,calendarOutline:gt,eyeOutline:Ce}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(t){this.segmentContent=t},formatBirthdate(t){return S.getBirthdateAge(t)},async getAppointments(){this.people=[],(await Te.getAppointments(this.startDate,this.endDate,"")).forEach(e=>{const s={person_id:e.person_id,npid:e.npid,appointment_id:103,encounter_id:e.encounter_id,name:e.given_name.concat(" ",e.family_name),gender:e.gender,ageDob:this.formatBirthdate(e.birthdate),village:e.city_village,appointmentDate:S.toStandardHisDisplayFormat(e.appointment_date)};this.people.push(s)})},async getAppointmentsD1(t){this.startDate=S.toStandardHisFormat(t),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=S.toStandardHisFormat(t),await this.getAppointments()},async openClientProfile(t){await ft.findByNpid(t),this.isPharmacist()},isPharmacist(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(s=>e.some(i=>i.role==="Pharmacist"))&&(this.$router.push("dispensation"),W.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),qr={class:"appointments-container"},Qr={key:0,class:"date-filter"},Yr={class:"appointments-table"};function Xr(t,e,s,i,r,c){const o=g("ion-label"),u=g("ion-segment-button"),m=g("ion-segment"),h=g("DateInputField"),p=g("ion-col"),D=g("ion-row"),$=g("ion-icon"),C=g("ion-button"),y=g("ion-card");return d(),v("div",qr,[n("div",null,[a(m,{value:t.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:l(()=>[a(u,{value:"Today",onClick:e[0]||(e[0]=b=>t.setSegmentContent("Today"))},{default:l(()=>[a(o,null,{default:l(()=>[...e[3]||(e[3]=[N("Today",-1)])]),_:1})]),_:1}),a(u,{value:"Tomorrow",onClick:e[1]||(e[1]=b=>t.setSegmentContent("Tomorrow"))},{default:l(()=>[a(o,null,{default:l(()=>[...e[4]||(e[4]=[N("Tomorrow",-1)])]),_:1})]),_:1}),a(u,{value:"Date range",onClick:e[2]||(e[2]=b=>t.setSegmentContent("Date range"))},{default:l(()=>[a(o,null,{default:l(()=>[...e[5]||(e[5]=[N("Date range",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),t.segmentContent==="Date range"?(d(),v("div",Qr,[a(D,null,{default:l(()=>[a(p,null,{default:l(()=>[a(h,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(p,null,{default:l(()=>[a(h,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):A("",!0),t.people.length>0?(d(),V(y,{key:1},{default:l(()=>[n("table",Yr,[e[6]||(e[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),v(x,null,q(t.people,b=>(d(),v("tr",{key:b.npid},[n("td",null,[a(D,null,{default:l(()=>[a(p,null,{default:l(()=>[N(_(b.name),1)]),_:2},1024),a(p,null,{default:l(()=>[a(C,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:P=>t.openClientProfile(b.npid),color:"primary",fill:"clear",size:"small"},{default:l(()=>[a($,{icon:t.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,_(b.npid),1),n("td",null,_(b.ageDob),1),n("td",null,_(b.gender),1),n("td",null,_(b.village),1),n("td",null,_(b.appointmentDate),1)]))),128))])])]),_:1})):(d(),V(y,{key:2},{default:l(()=>[...e[7]||(e[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])]),_:1}))])}const Zr=z(Jr,[["render",Xr],["__scopeId","data-v-c47f7768"]]),Kr=H({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){}}}),tl={key:0},el={style:{display:"flex","margin-top":"10px"}},nl={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},al={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},sl={key:1};function ol(t,e,s,i,r,c){const o=g("ion-label"),u=g("ion-segment-button"),m=g("ion-segment"),h=g("VisitsHistory");return d(),v(x,null,[n("div",null,[a(m,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:l(()=>[a(u,{value:"Internal referrals",onClick:e[0]||(e[0]=p=>t.setSegmentContent("Internal referrals"))},{default:l(()=>[a(o,null,{default:l(()=>[...e[2]||(e[2]=[N("Internal referrals",-1)])]),_:1})]),_:1}),a(u,{value:"External referrals",onClick:e[1]||(e[1]=p=>t.setSegmentContent("External referrals"))},{default:l(()=>[a(o,null,{default:l(()=>[...e[3]||(e[3]=[N("External referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(d(),v("div",tl,[n("div",el,[t.checkUnderFive?(d(),v("div",nl)):A("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?A("",!0):(d(),v("div",al))])])):A("",!0),t.segmentContent=="External referrals"?(d(),v("div",sl,[a(h)])):A("",!0)],64)}const il=z(Kr,[["render",ol],["__scopeId","data-v-faad8f8b"]]),rl=H({name:"Menu",components:{IonContent:tt,IonHeader:it,IonItem:mt,IonList:pt,IonMenu:St,IonTitle:kt,IonToolbar:ut,IonCheckbox:Bt,IonIcon:J,BasicForm:At,BasicCard:Ht,Referrals:il,Dashboard:Gr,ANCAppointments:Zr},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:be},{id:"referrals",label:"Referrals",icon:Yt},{id:"appointments",label:"Appointments",icon:gt}],activeItem:"dashboard"}},computed:{...Z(It,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),ll={style:{display:"flex"}},dl={class:"left_col"},cl={class:"nav-menu"},ul=["onClick"],pl={class:"right_col"};function ml(t,e,s,i,r,c){const o=g("ion-icon"),u=g("Dashboard"),m=g("ANCAppointments"),h=g("Referrals");return d(),v("div",ll,[n("div",dl,[n("nav",cl,[n("ul",null,[(d(!0),v(x,null,q(t.menuItems,p=>(d(),v("li",{key:p.id,class:st({active:t.activeItem===p.id}),onClick:D=>t.setActiveItem(p.id)},[a(o,{icon:p.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,_(p.label),1)],10,ul))),128))])])]),n("div",pl,[n("div",null,[t.activeItem==="dashboard"?(d(),V(u,{key:0})):A("",!0),t.activeItem==="appointments"?(d(),V(m,{key:1})):A("",!0),t.activeItem==="referrals"?(d(),V(h,{key:2})):A("",!0)])])])}const hl=z(rl,[["render",ml],["__scopeId","data-v-7e786ea4"]]),gl=H({name:"Menu",components:{IonContent:tt,IonHeader:it,IonItem:mt,IonList:pt,IonMenu:St,IonTitle:kt,IonToolbar:ut,IonCheckbox:Bt,BasicForm:At,BasicCard:Ht},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Z(It,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),fl={class:"left_col"},_l={class:"nav-menu"},vl=["onClick"];function yl(t,e,s,i,r,c){return d(),v("div",null,[n("div",fl,[n("nav",_l,[n("ul",null,[(d(!0),v(x,null,q(t.menuItems,o=>(d(),v("li",{key:o.id,class:st({active:t.activeItem===o.id}),onClick:u=>t.setActiveItem(o.id)},_(o.label),11,vl))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const bl=z(gl,[["render",yl],["__scopeId","data-v-32dd02d3"]]),Dl=H({name:"Menu",components:{IonContent:tt,IonHeader:it,IonItem:mt,IonList:pt,IonMenu:St,IonTitle:kt,IonToolbar:ut,IonCheckbox:Bt,BasicForm:At,BasicCard:Ht},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Z(It,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Cl={class:"left_col"},$l={class:"nav-menu"},wl=["onClick"];function kl(t,e,s,i,r,c){return d(),v("div",null,[n("div",Cl,[n("nav",$l,[n("ul",null,[(d(!0),v(x,null,q(t.menuItems,o=>(d(),v("li",{key:o.id,class:st({active:t.activeItem===o.id}),onClick:u=>t.setActiveItem(o.id)},_(o.label),11,wl))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const Sl=z(Dl,[["render",kl],["__scopeId","data-v-b49d8600"]]),Kl=H({__name:"HomePage",setup(t){const e=E(!0),s=De(),i=Bn(),r=E(localStorage.getItem("sessionDate")||"");aa();const c=we(),{apiStatus:o}=jt(Ie()),{activeProgram:u}=jt(c),m=Q(()=>{var y;switch(console.log("ðŸš€ ~ activeDashboard ~ activeProgram:",u.value.program_id),(y=u.value)==null?void 0:y.program_id){case at.IMMUNIZATION_PROGRAM:return er;case at.OPD_PROGRAM:return Tr;case at.NCD_PROGRAM:return no;case at.AETC_PROGRAM:return Br;case at.HTS_PROGRAM:return Mo;case at.ANC_PROGRAM:return hl;case at.PNC_PROGRAM:return Sl;case at.LABOUR_AND_DELIVERY_PROGRAM:return bl;case at.HIV_PROGRAM:return hi;case at.NEONATAL_PROGRAM:return na;default:return null}}),h=()=>{const y=localStorage.getItem("sessionDate");(!y||y.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),se()),r.value=y||""};let p=null;ct(()=>{p=()=>h(),window.addEventListener("storage",p);const y=setInterval(h,1e3);kn(()=>{clearInterval(y),p&&window.removeEventListener("storage",p)}),h()}),dt(r,(y,b)=>{(!y||y.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),se())});const D=async()=>{yt.isEmpty(u.value)&&await zn.show(Jn,{},"module-picker-modal")},$=async(y=[])=>{try{e.value=!0,xn(),await Hn().loadGlobalProperty(),i.postData({command:"ping"});for(const b of y)typeof b=="function"?await b():console.warn("Non-function item found in extraFns array:",b)}catch(b){console.error("Error initializing component:",b)}finally{e.value=!1}};dt(()=>s.name,async y=>{y==="Home"&&await $([D])},{immediate:!0,deep:!0});const C=async()=>{try{const y=W.getUserID(),b=await Un.getUserByID(y);if(b.location_id!=null){const P=await Wn.getLocation(b.location_id);localStorage.setItem("locationData",JSON.stringify(P))}}catch(y){console.error("Failed to retrieve location data:",y)}};return o.value&&(Ne(),C()),ct(async()=>{try{await $()}catch(y){console.error("Error initializing component:",y)}finally{e.value=!1}}),(y,b)=>{const P=g("ion-content");return d(),V(k(wt),null,{default:l(()=>[a(Pe),a(Gn),m.value?(d(),V(Sn(m.value),{key:0})):(d(),V(P,{key:1},{default:l(()=>[...b[0]||(b[0]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])]),_:1}))]),_:1})}}});export{Kl as default};

var Ot=Object.defineProperty;var Vt=(e,t,s)=>t in e?Ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var ee=(e,t,s)=>Vt(e,typeof t!="symbol"?t+"":t,s);import{d as x,cT as Lt,an as Ve,r as O,c as K,w as de,a as ce,e as f,f as d,k as n,m as k,p as te,K as g,l as a,u as S,b2 as ct,Q as A,L as G,F,P as J,cU as Mt,c7 as Bt,aw as ut,bB as Et,bj as Ft,bZ as Ke,c5 as xt,b6 as De,H as m,O as L,J as o,D as Ut,ah as Z,cV as pt,cW as mt,ap as ht,cX as gt,cY as Ht,cc as ft,cZ as Wt,c_ as zt,c$ as jt,d0 as Gt,d1 as Jt,d2 as Kt,d3 as Qt,aU as qt,bK as _t,am as Yt,n as vt,aP as Qe,aQ as yt,aR as bt,aS as Le,a5 as Me,N as Te,a4 as Be,G as ue,a6 as Ce,I as ie,a3 as ae,bx as ze,a1 as Zt,d4 as Xt,aF as en,d5 as tn,d6 as nn,cA as an,aE as sn,cF as Dt,aN as ge,aV as Ne,V as Re,d7 as Ct,aJ as qe,aD as on,i as rn,b8 as ln,d8 as dn,z as cn,d9 as Ye,da as le,W as ve,db as $t,b9 as un,bo as pn,bl as mn,E as $e,ai as we,aj as pe,_ as me,R as Ee,bf as hn,dc as gn,dd as fn,de as _n,df as vn,bv as Fe,b5 as wt,dg as yn,c1 as bn,cE as Ze,bq as Dn,bS as Cn}from"./vendor-CWILCKEU.js";import{S as H,u as ne,_ as W,P as fe,t as be,a as St,E as $n,H as I,A as wn,b as Sn,c as kt,d as je,e as It,f as kn,g as Se,R as In,p as An,h as tt,i as Pn,O as Tn,j as Nn,B as Rn,k as nt,l as xe,m as Pe,n as On,o as Oe,q as Ge,r as Vn,s as at,T as At,U as Pt,v as Ln,w as Y,x as st,y as ot,z as Mn,C as it,L as Bn}from"../index-CARU1uIL.js";import{m as Xe}from"./apexcharts-MUkJV7jj.js";import{A as Tt}from"./ncd_appointment_service-B7HGhHdh.js";import{D as et}from"./DateInputField-DIL2zSXz.js";import{u as En,M as Fn,_ as xn}from"./ActionButtons.vue_vue_type_script_setup_true_lang-BGAMj6L3.js";import{V as Un}from"./ViewToggleComponent-BrIWnC4D.js";import{B as Hn}from"./bottomNavBar-5Z1nwqPv.js";import{P as Wn}from"./patient_report_service-Csxti9qS.js";import{l as ye}from"./lodash-NJiRuGo9.js";import{B as ke}from"./BasicForm-DRmKWHe6.js";import{B as Ue}from"./BasicCard-gMhdbiwD.js";import{u as zn}from"./AdministerOtherVaccinesStore-DVpLi9J4.js";import{c as jn}from"./customDatePicker-vyoGJIRK.js";import{s as Gn}from"./vaccines_service-Dg94UWS5.js";import{g as Jn}from"./dashboard_service-DkC6Amtd.js";import{i as Kn}from"./Img-CJEgX1Vr.js";import rt from"./NeonatalHome-vK7zz0Ys.js";import"./sms_service-DNUCBC-J.js";import"./EIRreportsStore-Dt8rZt23.js";import"./Export-BJvuCMef.js";import"./neonatal_service-BSGyAaZK.js";import"./images-2ueq4-v2.js";const oe={VITALS:6,APPOINTMENT:7,HIV_CLINIC_REGISTRATION:9,TREATMENT:25,HIV_RECEPTION:51,HIV_STAGING:52,HIV_CLINIC_CONSULTATION:53,DISPENSING:54,ART_ADHERENCE:68};class lt extends H{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(t){return await super.getJson("fhir/patient/".concat(t),{id:t})}static async getFhirObservations(t){return await super.getJson("fhir/patient/".concat(t,"/observations/"),{id:t})}}const Qn={class:"fhir-viewer"},qn={class:"container"},Yn={key:0,class:"main-header"},Zn={class:"header-line"},Xn={key:0,class:"last-updated-display"},ea={key:1,class:"card initial-input-card"},ta={class:"action-area-initial"},na={key:0,class:"card patient-card"},aa={class:"card-title"},sa={class:"patient-info-grid"},oa={class:"info-item"},ia={class:"info-value"},ra={class:"info-item"},la={class:"info-value"},da={class:"info-item"},ca={class:"info-value"},ua={class:"info-item"},pa={class:"info-value"},ma={class:"info-value"},ha={class:"info-value"},ga={class:"info-label"},fa={class:"info-value"},_a={key:2,class:"card observations-card"},va={class:"card-title"},ya={class:"observations-grid"},ba={class:"obs-header"},Da={class:"obs-title"},Ca={class:"obs-details"},$a={class:"obs-detail obs-value-highlight"},wa={class:"obs-value"},Sa={class:"obs-detail"},ka={class:"obs-value"},Ia={key:0,class:"obs-detail"},Aa={class:"obs-value"},Pa={key:3,class:"no-data-found"},Ta={key:4,class:"no-data-found"},Na={key:5,class:"main-footer"},Ra=x({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(e){Lt({"person-circle-outline":xt,"clipboard-outline":Ke,"search-outline":Ft,"information-circle-outline":Et,"alert-circle-outline":ut,"person-add-outline":Bt,"arrow-back-outline":Mt});const t=e,s=Ve(),i=O(!1),l=O([]),v=O(),r=O(),u=O(null),p=O([]),c=K(()=>l.value.some($=>$.resourceType==="Bundle"&&$.entry&&$.entry.some(h=>h.resource&&h.resource.resourceType==="Patient"))),_=K(()=>p.value.length>0),w=async()=>{if(l.value=[],r.value=null,u.value=null,p.value=[],!v.value){console.error("Please enter a Patient Identifier.");return}i.value=!0;try{const $=await lt.getFhirPatient(v.value);if($&&$.entry&&$.entry.length>0){const h=$.entry[0].resource,z=h.id,U=await lt.getFhirObservations(z);l.value=[$],U&&(l.value.push(U),p.value=U.entry.filter(Q=>Q.resource&&Q.resource.resourceType==="Observation").map(Q=>{const R=Q.resource;return{id:R.id,display:M(R),value:se(R),date:R.effectiveDateTime,category:R.category&&R.category[0]&&R.category[0].coding&&R.category[0].coding[0]?R.category[0].coding[0].display||R.category[0].coding[0].code:"N/A"}}));const B=h.name&&h.name[0];u.value={personInformation:{given_name:B&&B.given?B.given.join(" "):"",middle_name:B&&B.middle?B.middle.join(" "):"",family_name:B&&B.family?B.family:"",gender:h.gender=="male"?"M":(h==null?void 0:h.gender)=="female"?"F":"",birthdate:h.birthDate||"",cell_phone_number:h.telecom&&h.telecom[0]?h.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:h.contact&&h.contact[0]&&h.contact[0].telecom?h.contact[0].telecom[0].value:""}]}};const T=[$,U].filter(Boolean).reduce((Q,R)=>{if(R.meta&&R.meta.lastUpdated){const X=new Date(R.meta.lastUpdated);return Q===null||X>Q?X:Q}return Q},null);T&&(r.value=P(T.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch($){console.error("Error loading FHIR data:",$),l.value=[],r.value=null,u.value=null,p.value=[]}finally{i.value=!1}},C=$=>{if($.name&&$.name[0]){const h=$.name[0],z=h.given?h.given.join(" "):"",U=h.family||"";return"".concat(z," ").concat(U).trim()||"N/A"}return"N/A"},b=$=>$.identifier&&$.identifier.length>0?$.identifier.map(h=>{let z="Unknown System";if(h.type&&h.type.coding&&h.type.coding[0]&&h.type.coding[0].display)z=h.type.coding[0].display;else if(h.system){const B=h.system.split("/");z=B[B.length-1]||h.system,h.system==="urn:oid:2.16.840.1.113883.4.6"&&(z="Social Security Number")}sessionStorage.setItem(z,h.value);let U=null;return h.assigner&&h.assigner.display?U=h.assigner.display:h.assigner&&h.assigner.reference&&(U=h.assigner.reference.split("/").pop()||h.assigner.reference),{value:h.value||"N/A",systemDisplay:z,periodStart:h.period?h.period.start:null,periodEnd:h.period?h.period.end:null,assignerDisplay:U}}):[],y=$=>$.telecom&&$.telecom.length>0?$.telecom.filter(h=>h.system==="phone"&&h.value):[],D=$=>{if($.contact&&$.contact.length>0){const h=$.contact.filter(U=>{var B;return(B=U.relationship)==null?void 0:B.some(E=>{var T;return(T=E.coding)==null?void 0:T.some(Q=>Q.code==="GUARD")})}),z=[];return h.forEach(U=>{U.telecom&&U.telecom.length>0&&U.telecom.filter(B=>B.system==="phone"&&B.value).forEach(B=>z.push(B))}),z}return[]},N=$=>{if(!$)return"N/A";try{return new Date($).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(h){return console.error("Invalid date string for formatDate:",$,h),"Invalid Date"}},P=$=>{if(!$)return"N/A";try{return new Date($).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(h){return console.error("Invalid date time string for formatDateTime:",$,h),"Invalid Date/Time"}},V=$=>{if(!$)return"N/A";try{const h=new Date,z=new Date($);let U=h.getFullYear()-z.getFullYear();const B=h.getMonth()-z.getMonth();return(B<0||B===0&&h.getDate()<z.getDate())&&U--,U}catch(h){return console.error("Invalid birth date string for calculateAge:",$,h),"N/A"}},j=$=>{if($.meta&&$.meta.tag){const h=$.meta.tag.find(z=>z.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return h?h.code:"Unknown"}return"Unknown"},M=$=>$.code&&$.code.coding&&$.code.coding[0]&&($.code.coding[0].display||$.code.coding[0].code)||"Unknown Observation",se=$=>$.valueQuantity?"".concat($.valueQuantity.value," ").concat($.valueQuantity.unit||"").trim():$.valueString?$.valueString:$.valueBoolean!==void 0?$.valueBoolean?"True":"False":"N/A",q=()=>{ne().setRecord(u.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(p.value)),Ae("/registration/manual")},he=()=>{l.value=[],v.value="",r.value=null,u.value=null,p.value=[]},Ae=$=>{s.push({path:$})};return de(()=>s,async()=>{l.value=[],p.value=[]},{deep:!0}),ce(()=>{var $;if(t.initialData.length>0){l.value=t.initialData;const z=t.initialData.filter(Boolean).reduce((E,T)=>{if(T.meta&&T.meta.lastUpdated){const Q=new Date(T.meta.lastUpdated);return E===null||Q>E?Q:E}return E},null);z&&(r.value=P(z.toISOString()));const U=t.initialData.find(E=>E.resourceType==="Bundle"&&E.entry&&E.entry.some(T=>T.resource&&T.resource.resourceType==="Patient"));if(U){const E=($=U.entry.find(T=>T.resource&&T.resource.resourceType==="Patient"))==null?void 0:$.resource;if(E){const T=E.name&&E.name[0];u.value={personInformation:{given_name:T&&T.given?T.given.join(" "):"",middle_name:T&&T.middle?T.middle.join(" "):"",family_name:T&&T.family?T.family:"",gender:E.gender||"",birthdate:E.birthDate||""}}}}const B=t.initialData.find(E=>E.resourceType==="Bundle"&&E.entry&&E.entry.some(T=>T.resource&&T.resource.resourceType==="Observation"));B&&(p.value=B.entry.filter(E=>E.resource&&E.resource.resourceType==="Observation").map(E=>{const T=E.resource;return{id:T.id,display:M(T),value:se(T),date:T.effectiveDateTime,category:T.category&&T.category[0]&&T.category[0].coding&&T.category[0].coding[0]?T.category[0].coding[0].display||T.category[0].coding[0].code:"N/A"}}))}}),($,h)=>{var z,U,B,E,T,Q;return d(),f("div",Qn,[n("div",qn,[(z=l.value)!=null&&z.length?(d(),f("header",Yn,[n("div",Zn,[h[1]||(h[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:te(["last-updated-display","status-"+j(l.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+g(j(l.value[0].entry[0].resource)),3),r.value?(d(),f("span",Xn,"Last Updated: "+g(r.value),1)):k("",!0)])])])):k("",!0),(U=l.value)!=null&&U.length?k("",!0):(d(),f("section",ea,[a(S(ct),{modelValue:v.value,"onUpdate:modelValue":h[0]||(h[0]=R=>v.value=R),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",ta,[n("button",{onClick:w,class:"load-data-btn"},[a(S(G),{name:"search-outline"}),h[2]||(h[2]=A(" Find Patient ",-1))])])])),(d(!0),f(F,null,J(l.value,R=>(d(),f("div",{key:R.id},[R.resourceType==="Bundle"&&R.entry&&R.entry[0]&&R.entry[0].resource.resourceType==="Patient"?(d(),f("section",na,[n("h2",aa,[a(S(G),{name:"person-circle-outline"}),h[3]||(h[3]=A(" Patient Demographics",-1))]),n("div",sa,[n("div",oa,[h[4]||(h[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",ia,g(C(R.entry[0].resource)),1)]),n("div",ra,[h[5]||(h[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",la,g(R.entry[0].resource.gender||"Not specified"),1)]),n("div",da,[h[6]||(h[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",ca,g(N(R.entry[0].resource.birthDate)),1)]),n("div",ua,[h[7]||(h[7]=n("span",{class:"info-label"},"Age",-1)),n("span",pa,g(V(R.entry[0].resource.birthDate))+" years",1)]),y(R.entry[0].resource).length?(d(!0),f(F,{key:0},J(y(R.entry[0].resource),(X,_e)=>(d(),f("div",{key:"patient-phone-".concat(_e),class:"info-item"},[h[8]||(h[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",ma,g(X.value),1)]))),128)):k("",!0),D(R.entry[0].resource).length?(d(!0),f(F,{key:1},J(D(R.entry[0].resource),(X,_e)=>(d(),f("div",{key:"guardian-phone-".concat(_e),class:"info-item"},[h[9]||(h[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",ha,g(X.value),1)]))),128)):k("",!0),(d(!0),f(F,null,J(b(R.entry[0].resource),(X,_e)=>(d(),f("div",{key:X.value||_e,class:"info-item"},[n("span",ga,g(X.systemDisplay),1),n("span",fa,g(X.value),1)]))),128))])])):k("",!0)]))),128)),((B=p.value)==null?void 0:B.length)>0?(d(),f("section",_a,[n("h2",va,[a(S(G),{name:"clipboard-outline"}),h[10]||(h[10]=A(" Clinical Observations",-1))]),n("div",ya,[(d(!0),f(F,null,J(p.value,R=>(d(),f("div",{key:R.id,class:"observation-item"},[n("div",ba,[n("h3",Da,g(R.display),1)]),n("div",Ca,[n("div",$a,[h[11]||(h[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",wa,g(R.value),1)]),n("div",Sa,[h[12]||(h[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",ka,g(P(R.date)),1)]),R.category&&R.category!=="N/A"?(d(),f("div",Ia,[h[13]||(h[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",Aa,g(R.category),1)])):k("",!0)])]))),128))])])):k("",!0),(E=l.value)!=null&&E.length&&!c.value?(d(),f("div",Pa,[n("p",null,[a(S(G),{name:"alert-circle-outline"}),h[14]||(h[14]=A(" No patient data found for the provided identifier. Please try again.",-1))])])):(T=l.value)!=null&&T.length&&c.value&&!_.value?(d(),f("div",Ta,[n("p",null,[a(S(G),{name:"information-circle-outline"}),h[15]||(h[15]=A(" No clinical observations found for this patient.",-1))])])):k("",!0),(Q=l.value)!=null&&Q.length?(d(),f("footer",Na,[n("button",{onClick:he,class:"back-to-search-btn small-btn"},[a(S(G),{name:"arrow-back-outline"}),h[16]||(h[16]=A(" Back to Search ",-1))]),n("button",{onClick:q,class:"register-btn small-btn"},[a(S(G),{name:"person-add-outline"}),h[17]||(h[17]=A(" Register New Patient ",-1))])])):k("",!0)])])}}}),Oa=W(Ra,[["__scopeId","data-v-0dc329ef"]]),Va=x({components:{DataTable:De},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Referred From",data:"referredFrom"},{title:"Referred By",data:"referredBy"},{title:"Clinic Date",data:"appointmentDate"},{title:"Actions",data:null,render:(e,t,s)=>'<ion-button size="small" fill="solid" color="primary" onclick="window.navigatePatient(\''.concat(s.patient_id,"')\">Profile</ion-button>"),orderable:!1,width:"20%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No referrals found."}}}},async mounted(){var l;const t=(l=St().activeProgram)==null?void 0:l.program_id,s=String(localStorage.getItem("locationID")),i=await $n.getAllEncounters({encounter_type_id:114});console.log("Encounters fetched for Internal Referrals:",i),this.patients=i.reduce((v,r)=>{var C,b,y,D,N,P,V,j;if(String(r==null?void 0:r.location_id)!==s||!((C=r==null?void 0:r.observations)==null?void 0:C.find(M=>(M==null?void 0:M.concept_id)===2227&&(M==null?void 0:M.value_numeric)===t)))return v;const p=(D=(y=(b=r==null?void 0:r.patient)==null?void 0:b.person)==null?void 0:y.names)!=null&&D[0]?"".concat(r.patient.person.names[0].given_name||""," ").concat(r.patient.person.names[0].family_name||""):"Unknown";let c=((N=r==null?void 0:r.program)==null?void 0:N.name)||"Unknown Program";c=c.replace(/program/i,"").trim();const _=(V=(P=r==null?void 0:r.provider)==null?void 0:P.names)!=null&&V[0]?"".concat(r.provider.names[0].given_name||""," ").concat(r.provider.names[0].family_name||""):"Unknown",w=(j=r==null?void 0:r.observations)==null?void 0:j.find(M=>{var se,q;return(q=(se=M==null?void 0:M.concept)==null?void 0:se.concept_names)==null?void 0:q.some(he=>{var Ae;return(Ae=he==null?void 0:he.name)==null?void 0:Ae.toLowerCase().includes("date of referral")})});return v.push({patient_id:r.patient_id,fullName:p,referredFrom:c,referredBy:_,appointmentDate:(w==null?void 0:w.value_text)||"N/A"}),v},[]),window.navigatePatient=this.navigateTo},methods:{async navigateTo(e){let t=await fe.findByID(e);t?(await ne().setPatientRecord(t),this.$router.push("/patientProfile")):be("Patient not found. Please try searching by name.")}}}),La={class:"dueCardContent"};function Ma(e,t,s,i,l,v){const r=m("DataTable"),u=m("ion-card-content"),p=m("ion-card");return d(),L(p,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:o(()=>[a(u,null,{default:o(()=>[n("div",La,[a(r,{data:e.patients,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})}const Nt=W(Va,[["render",Ma],["__scopeId","data-v-a95ef46a"]]),Ba=x({name:"referrals",components:{InternalReferrals:Nt,ExternalReferrals:Oa},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(e){this.segmentContent=e}}}),Ea={key:0},Fa={style:{display:"flex","margin-top":"10px"}},xa={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},Ua={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},Ha={key:1},Wa={key:2};function za(e,t,s,i,l,v){const r=m("ion-label"),u=m("ion-segment-button"),p=m("ion-segment"),c=m("ExternalReferrals"),_=m("InternalReferrals");return d(),f(F,null,[n("div",null,[a(p,{value:e.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:o(()=>[a(u,{value:"External referrals",onClick:t[0]||(t[0]=w=>e.setSegmentContent("External referrals"))},{default:o(()=>[a(r,null,{default:o(()=>[...t[2]||(t[2]=[A("External referrals",-1)])]),_:1})]),_:1}),a(u,{value:"Internal referrals",onClick:t[1]||(t[1]=w=>e.setSegmentContent("Internal referrals"))},{default:o(()=>[a(r,null,{default:o(()=>[...t[3]||(t[3]=[A("Internal referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),e.segmentContent=="Internal referrals"?(d(),f("div",Ea,[n("div",Fa,[e.checkUnderFive?(d(),f("div",xa)):k("",!0),t[4]||(t[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),e.checkUnderFive?k("",!0):(d(),f("div",Ua))])])):k("",!0),e.segmentContent=="External referrals"?(d(),f("div",Ha,[a(c)])):k("",!0),e.segmentContent=="Internal referrals"?(d(),f("div",Wa,[a(_)])):k("",!0)],64)}const ja=W(Ba,[["render",za],["__scopeId","data-v-8f0f935e"]]),Je=Ut("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(e){this.selectedItem=e},getSelectedItem(){return this.selectedItem}},persist:!0}),Ga=()=>{const e=O(null);return{activeIteminMixin:e,setActiveItem:s=>{e.value=s,console.log("lll: ",e.value)}}},Ie=x({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:e,setActiveItem:t}=Ga();return{chevronBackOutline:_t,checkmark:qt,grid:Qt,chevronDownCircle:Kt,chevronForwardCircle:Jt,chevronUpCircle:Gt,colorPalette:jt,document:zt,globe:Wt,medkit:ft,add:Ht,person:gt,people:ht,thermometer:mt,clipboard:pt,activeIteminMixin:e,setActiveItem:t}},async mounted(){await this.setAppointments()},computed:{...Z(ne,["patient"])},watch:{$route:{async handler(e){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await wn.getDailyAppointments(I.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((e,t)=>e.given_name.localeCompare(t.given_name)))},formatBirthdate(e){return I.getBirthdateAge(e)},setActiveItemRefFN(e){Je().setSelectedItem(e)}}}),Ja=x({name:"NCDDashboard",mixins:[Ie],components:{ApexChart:Xe},setup(){return{router:Ve()}},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await vt(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){try{return H.getJson("programs/32/reports/ncd_dashboard",{start_date:I.toStandardHisFormat(I.sessionDate()),end_date:I.toStandardHisFormat(I.sessionDate())})}catch(e){return[]}},navigationMenu(e){try{Yt.close(),this.router.push(e).then(()=>{})}catch(t){console.error(t)}}}}),Ka={class:"cards-container"},Qa={class:"top-card-text"},qa={class:"text-2xl font-bold"},Ya={class:"top-card-text"},Za={class:"text-2xl font-bold"},Xa={class:"top-card-text"},es={class:"text-2xl font-bold"},ts={class:"top-card-text"},ns={class:"text-2xl font-bold"},as={class:"top-card-text"},ss={class:"text-2xl font-bold"},os={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},is={ref:"chartRef1"},rs={ref:"chartRef2"};function ls(e,t,s,i,l,v){const r=m("ion-card-content"),u=m("ion-card"),p=m("ApexChart");return d(),f(F,null,[n("div",Ka,[a(u,{class:"top-card action-card",onClick:t[0]||(t[0]=c=>e.setActiveItemRefFN("appointments"))},{default:o(()=>[a(r,null,{default:o(()=>[n("div",Qa,[n("div",qa,g(e.appointments.length),1),t[2]||(t[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]),_:1})]),_:1}),a(u,{class:"top-card action-card"},{default:o(()=>[a(r,null,{default:o(()=>{var c;return[n("div",Ya,[n("div",Za,g((c=e.dashboardData)==null?void 0:c.total_pending_dispensations),1),t[3]||(t[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]}),_:1})]),_:1}),a(u,{class:"top-card action-card"},{default:o(()=>[a(r,null,{default:o(()=>{var c;return[n("div",Xa,[n("div",es,g((c=e.dashboardData)==null?void 0:c.total_defaulters),1),t[4]||(t[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]}),_:1})]),_:1}),a(u,{class:"top-card action-card"},{default:o(()=>[a(r,null,{default:o(()=>{var c;return[n("div",ts,[n("div",ns,g((c=e.dashboardData)==null?void 0:c.total_complications),1),t[5]||(t[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]}),_:1})]),_:1}),a(u,{class:"top-card action-card",onClick:t[1]||(t[1]=c=>e.navigationMenu("NCDActivePatients"))},{default:o(()=>[a(r,null,{default:o(()=>{var c;return[n("div",as,[n("div",ss,g((c=e.dashboardData)==null?void 0:c.total_client_registered),1),t[6]||(t[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]}),_:1})]),_:1})]),n("div",os,[a(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[t[7]||(t[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",is,[e.isChartReady?(d(),L(p,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:e.barChartOptions,series:e.barChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1})]),_:1}),a(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[t[8]||(t[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",rs,[e.isChartReady?(d(),L(p,{key:0,style:{width:"100%",height:"500px"},type:"line",options:e.lineChartOptions,series:e.lineChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1})]),_:1})])],64)}const ds=W(Ja,[["render",ls],["__scopeId","data-v-18251377"]]),cs=x({name:"Home",mixins:[kt,Ie],components:{IonContent:ae,IonHeader:ie,IonPage:Ce,IonToolbar:ue,IonRow:Be,DateInputField:et,IonIcon:G,IonButton:Te,IonCol:Me,IonCard:Le,IonCardHeader:bt,IonCardTitle:yt,IonCardContent:Qe,ViewToggleComponent:Un,bottomNavBar:Hn,HorizontalLine:Sn},data(){const e=localStorage.getItem("ncdStartDate"),t=localStorage.getItem("ncdEndDate"),s=O(e||I.sessionDate()),i=O(t||I.sessionDate()),l=O(I.sessionDate()),v=O(I.sessionDate()),r=O([]),u=ze({page:1,itemsPerPage:10}),p=O(0),c=En(),_=O("list");return{minDate:l,startDate:s,endDate:i,people:r,calendarOutline:ge,openOutline:Dt,maxDate:v,alertCircleOutline:ut,personOutline:sn,idCardOutline:an,manOutline:nn,womanOutline:tn,locationOutline:en,timeOutline:Xt,todayOutline:Zt,pagination:u,totalCount:p,actionButtonStore:c,currentToggleView:_}},computed:{...Z(je,["NCDAppointmentsTogglePreference"]),paginatedPeople(){const e=(this.pagination.page-1)*this.pagination.itemsPerPage,t=e+this.pagination.itemsPerPage;return this.people.slice(e,t)},groupedPaginatedPeople(){const e={};this.paginatedPeople.forEach(i=>{const l=i.appointmentDate;e[l]||(e[l]=[]),e[l].push(i)});const t=Object.keys(e).sort((i,l)=>new Date(i)-new Date(l)),s={};return t.forEach(i=>{s[i]=e[i]}),s}},$route:{async handler(){},deep:!0},watch:{NCDAppointmentsTogglePreference:{handler(e){e&&e.toggle_view&&(this.currentToggleView=e.toggle_view)},deep:!0,immediate:!0}},async mounted(){this.initTogglePreference(),this.getAppointments(),this.HideHomePageActionButton()},async unmounted(){this.actionButtonStore.resetShowActionButton()},methods:{formatBirthdate(e){return I.getBirthdateAge(e)},async getAppointments(e=!1){if(It().apiStatus){this.people=[],this.pagination.page=1;try{e==!0&&(this.startDate=I.sessionDate(),this.endDate=I.sessionDate(),this.getAppointmentsD1(this.startDate),this.getAppointmentsD2(this.endDate)),this.startDate>this.endDate&&(this.endDate=this.startDate),console.log(this.startDate,this.endDate),(await Tt.getAppointments(this.startDate,this.endDate,"")).forEach(i=>{const l=I.toStandardHisDisplayFormat(i.appointment_date);if(!this.people.some(r=>r.person_id===i.person_id&&r.appointmentDate===l)){const r={person_id:i.person_id,npid:i.npid,appointment_id:103,encounter_id:i.encounter_id,name:i.given_name.concat(" ",i.family_name),gender:i.gender,ageDob:this.formatBirthdate(i.birthdate),village:i.city_village,appointmentDate:l};this.people.push(r)}}),this.totalCount=this.people.length}catch(s){}}},async getAppointmentsD1(e){this.startDate=I.toStandardHisFormat(e),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(e){this.endDate=I.toStandardHisFormat(e),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(e){const t=await fe.findByNpid(e);ne().setPatientRecord(t[0]),this.redirectUser()},handleViewChange(e){this.currentToggleView=e,this.initTogglePreference(e,!0)},initTogglePreference(e="list",t=!1){const s={toggle_view:e},i=je();Object.keys(this.NCDAppointmentsTogglePreference).length===0?(s.toggle_view="list",i.setNCDAppointmentsTogglePreference(s),this.currentToggleView="list"):t===!0?i.setNCDAppointmentsTogglePreference(s):this.currentToggleView=this.NCDAppointmentsTogglePreference.toggle_view||"list"},redirectUser(){const e=JSON.parse(localStorage.getItem("userRoles")),t=e||[];t.some(s=>t.some(i=>i.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")},handlePaginationUpdate({page:e,itemsPerPage:t}){if(t!==this.pagination.itemsPerPage){const s=(this.pagination.page-1)*this.pagination.itemsPerPage,i=Math.floor(s/t)+1,l=Math.ceil(this.totalCount/t);this.pagination.page=Math.min(i,l)||1,this.pagination.itemsPerPage=t}else this.pagination.page=e},HideHomePageActionButton(){this.actionButtonStore.setShowActionButton(!1)}}}),us={class:"appointments-container"},ps={class:"date-filter"},ms={key:0,style:{margin:"20px"}},hs={key:1},gs={class:"appointments-table"},fs={key:2},_s={class:"date-group-header"},vs={class:"date-header-title"},ys={class:"date-header-count"},bs={class:"cards-container"},Ds={class:"card-details"},Cs={class:"detail-item"},$s={class:"detail-value"},ws={class:"detail-item"},Ss={class:"detail-value"},ks={class:"detail-item"},Is={class:"detail-value"},As={class:"detail-item"},Ps={class:"detail-value"};function Ts(e,t,s,i,l,v){const r=m("DateInputField"),u=m("ion-col"),p=m("ion-icon"),c=m("ion-button"),_=m("ViewToggleComponent"),w=m("ion-row"),C=m("ion-card"),b=m("HorizontalLine"),y=m("ion-card-title"),D=m("ion-card-header"),N=m("ion-card-content"),P=m("ion-content"),V=m("bottomNavBar"),j=m("ion-footer");return d(),f("div",us,[n("div",ps,[a(w,null,{default:o(()=>[a(u,null,{default:o(()=>[a(r,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(u,null,{default:o(()=>[a(r,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1}),a(u,null,{default:o(()=>[a(c,{color:"primary",onClick:t[0]||(t[0]=M=>e.getAppointments(!0)),class:"apt-btn"},{default:o(()=>[a(p,{icon:e.todayOutline,slot:"start"},null,8,["icon"]),t[1]||(t[1]=n("span",{style:{margin:"5px"}}," Today ",-1))]),_:1})]),_:1}),a(u,null,{default:o(()=>[a(_,{"initial-view":e.currentToggleView,onViewChanged:e.handleViewChange},null,8,["initial-view","onViewChanged"])]),_:1})]),_:1})]),a(P,{class:"scrollable-content"},{default:o(()=>[e.people.length===0?(d(),f("div",ms,[a(p,{icon:e.alertCircleOutline,size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),t[2]||(t[2]=n("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Appointments for selected date range",-1))])):e.currentToggleView==="list"&&e.people.length>0?(d(),f("div",hs,[a(C,null,{default:o(()=>[n("table",gs,[t[3]||(t[3]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),f(F,null,J(e.paginatedPeople,M=>(d(),f("tr",{key:M.npid},[n("td",null,[a(w,null,{default:o(()=>[a(u,null,{default:o(()=>[A(g(M.name),1)]),_:2},1024),a(u,null,{default:o(()=>[a(c,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:se=>e.openClientProfile(M.npid),color:"primary",fill:"clear",size:"small"},{default:o(()=>[a(p,{icon:e.openOutline,style:{"font-size":"28px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,g(M.npid),1),n("td",null,g(M.ageDob),1),n("td",null,g(M.gender),1),n("td",null,g(M.village),1),n("td",null,g(M.appointmentDate),1)]))),128))])])]),_:1})])):e.currentToggleView==="card"&&e.people.length>0?(d(),f("div",fs,[(d(!0),f(F,null,J(e.groupedPaginatedPeople,(M,se)=>(d(),f("div",{key:se,class:"date-group"},[n("div",_s,[a(p,{icon:e.calendarOutline,class:"date-header-icon"},null,8,["icon"]),n("h2",vs,g(se),1),n("div",ys,g(M.length)+" appointment"+g(M.length!==1?"s":""),1)]),a(b,{color:"#006401",thickness:1,spacing:"sm"}),n("div",bs,[(d(!0),f(F,null,J(M,q=>(d(),L(C,{key:q.npid,class:"appointment-card"},{default:o(()=>[a(D,null,{default:o(()=>[a(w,{class:"ion-align-items-center"},{default:o(()=>[a(u,null,{default:o(()=>[a(y,{class:"card-name"},{default:o(()=>[a(p,{icon:e.personOutline,class:"name-icon"},null,8,["icon"]),A(" "+g(q.name),1)]),_:2},1024)]),_:2},1024),a(u,{size:"auto"},{default:o(()=>[a(c,{onClick:he=>e.openClientProfile(q.npid),color:"primary",fill:"clear",size:"small",class:"view-profile-btn"},{default:o(()=>[a(p,{icon:e.openOutline},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(N,null,{default:o(()=>[n("div",Ds,[n("div",Cs,[a(p,{icon:e.idCardOutline,class:"detail-icon"},null,8,["icon"]),t[4]||(t[4]=n("span",{class:"detail-label"},"NPID:",-1)),n("span",$s,g(q.npid),1)]),n("div",ws,[a(p,{icon:e.calendarOutline,class:"detail-icon"},null,8,["icon"]),t[5]||(t[5]=n("span",{class:"detail-label"},"Age/DOB:",-1)),n("span",Ss,g(q.ageDob),1)]),n("div",ks,[a(p,{icon:q.gender==="Male"?e.manOutline:e.womanOutline,class:"detail-icon"},null,8,["icon"]),t[6]||(t[6]=n("span",{class:"detail-label"},"Gender:",-1)),n("span",Is,g(q.gender),1)]),n("div",As,[a(p,{icon:e.locationOutline,class:"detail-icon"},null,8,["icon"]),t[7]||(t[7]=n("span",{class:"detail-label"},"Village:",-1)),n("span",Ps,g(q.village),1)])])]),_:2},1024)]),_:2},1024))),128))])]))),128))])):k("",!0)]),_:1}),e.people.length>0?(d(),L(j,{key:0,class:"sticky-footer"},{default:o(()=>[a(w,null,{default:o(()=>[a(u,{size:"12",style:{"max-width":"100%"}},{default:o(()=>[a(V,{totalItems:e.totalCount,currentPage:e.pagination.page,itemsPerPage:e.pagination.itemsPerPage,"onUpdate:pagination":e.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])]),_:1})]),_:1})]),_:1})):k("",!0)])}const Ns=W(cs,[["render",Ts],["__scopeId","data-v-d02dae2c"]]),Rs={key:0,class:"left_col"},Os={class:"nav-menu"},Vs=["onClick"],Ls={class:"ellipsis"},Ms={key:1,style:{"padding-left":"20px","padding-right":"20px"}},Bs=x({__name:"NCDDashboard",setup(e){const t=Je(),s=K(()=>t.selectedItem),{screenWidth:i}=kn(),l=O([{id:"dashboard",label:"Dashboard",icon:Ct},{id:"referrals",label:"Referrals",icon:qe},{id:"appointments",label:"Appointments",icon:ge}]),v=O("dashboard"),r=Se(),{substance:u}=Ne(r);de(()=>u.value,(c,_)=>{c!==_&&console.log("Substance changed:",c)},{deep:!0,immediate:!0});const p=c=>{v.value=c,Je().setSelectedItem(v.value)};return de(()=>s.value,c=>{console.log("Active item from mixin changed:",c),c&&c!=null&&p(c)},{immediate:!0}),(c,_)=>{const w=m("ion-segment-button"),C=m("ion-segment");return d(),f("div",{style:Re(S(i)>940?"display: flex":"display: block")},[S(i)>940?(d(),f("div",Rs,[n("nav",Os,[n("ul",null,[(d(!0),f(F,null,J(l.value,b=>(d(),f("li",{key:b.id,class:te({active:v.value===b.id}),onClick:y=>p(b.id)},[a(S(G),{icon:b.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",Ls,g(b.label),1)],10,Vs))),128))])])])):k("",!0),S(i)<=940?(d(),f("div",Ms,[a(C,{value:v.value,style:{"margin-top":"5px","justify-content":"left"}},{default:o(()=>[(d(!0),f(F,null,J(l.value,b=>(d(),L(w,{value:b.id,key:b.id,class:te({active:v.value===b.id}),onClick:y=>p(b.id)},{default:o(()=>[a(S(G),{icon:b.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,g(b.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):k("",!0),n("div",{class:"right_col",style:Re(S(i)>940?"width: 85%":"width: 100%")},[n("div",null,[v.value==="referrals"?(d(),L(ja,{key:0})):k("",!0),v.value==="dashboard"?(d(),L(ds,{key:1})):k("",!0),v.value==="appointments"?(d(),L(Ns,{key:2})):k("",!0)])],4)],4)}}}),Es=W(Bs,[["__scopeId","data-v-a1132315"]]);class Fs extends H{constructor(){super()}static async getHTCDashboardSummary(){return this.getJson("hts_stats")}}const xs={class:"content-wrapper dashboard"},Us={class:"header"},Hs={class:"overlay"},Ws={class:"big-number"},zs={class:""},js={class:"cards"},Gs={class:"card"},Js={class:"card-info"},Ks={class:"card-number"},Qs={class:"card"},qs={class:"card-info"},Ys={class:"card-number"},Zs={class:"card"},Xs={class:"card-info"},eo={class:"card-number"},to={class:"card"},no={class:"card-info"},ao={class:"section-title"},so={class:"section"},oo={class:"filter-bar"},io={class:"patient-list"},ro={class:"status-tags"},lo={class:"pagination"},co=["disabled"],uo={class:"pagination-info"},po={class:"showing-info"},mo=["disabled"],He=5,ho=x({__name:"HTSDashboard",setup(e){const t=O({clients_with_conclusive_results:0,total_clients:0,clients_tested_today:0,clients_referred_to_ART:0}),s=O(""),i=O(1),l=O([{id:1,name:"Kalumphalinga Kachindamoto",gender:"Male",age:37,status:"Referred OPD",statusClass:"yellow"},{id:2,name:"Kalumphalinga Kachindamoto",gender:"Female",age:26,status:"Returning Client",statusClass:"yellow"},{id:3,name:"Kalumphalinga Kachindamoto",gender:"Female",age:17,status:"Referred ART",statusClass:"yellow"},{id:4,name:"John Banda",gender:"Male",age:45,status:"Referred OPD",statusClass:"yellow"},{id:5,name:"Mary Phiri",gender:"Female",age:32,status:"Returning Client",statusClass:"yellow"},{id:6,name:"Peter Mwale",gender:"Male",age:28,status:"Referred ART",statusClass:"yellow"},{id:7,name:"Grace Lungu",gender:"Female",age:41,status:"Referred OPD",statusClass:"yellow"},{id:8,name:"Joseph Tembo",gender:"Male",age:55,status:"Returning Client",statusClass:"yellow"}]),v=K(()=>l.value.length),r=K(()=>Math.ceil(v.value/He)),u=K(()=>(i.value-1)*He),p=K(()=>Math.min(u.value+He,v.value)),c=K(()=>l.value.slice(u.value,p.value));function _(){i.value<r.value&&i.value++}function w(){i.value>1&&i.value--}ce(async()=>{await C()});async function C(){t.value=await Fs.getHTCDashboardSummary()}return(b,y)=>{var D;return d(),f("div",xs,[n("div",Us,[n("div",Hs,[n("h1",Ws,g((D=t.value)==null?void 0:D.clients_with_conclusive_results),1),y[1]||(y[1]=n("p",{class:"header-text"},[A(" Total Number of Clients Tested"),n("br"),A(" with Conclusive Results ")],-1))])]),n("div",zs,[y[9]||(y[9]=n("h2",{class:"section-title"},"Today's Stats",-1)),n("div",js,[n("div",Gs,[n("div",Js,[a(S(G),{icon:S(qe),class:"card-icon"},null,8,["icon"])]),y[2]||(y[2]=n("div",{class:"card-info"},[n("p",null,"Total Clients")],-1)),n("div",Ks,g(t.value.total_clients),1)]),n("div",Qs,[n("div",qs,[a(S(G),{icon:S(Ke),class:"card-icon"},null,8,["icon"])]),y[3]||(y[3]=n("div",{class:"card-info"},[n("p",null,"Clients Tested Today")],-1)),n("div",Ys,g(t.value.clients_tested_today),1)]),n("div",Zs,[n("div",Xs,[a(S(G),{icon:S(on),class:"card-icon"},null,8,["icon"])]),y[4]||(y[4]=n("div",{class:"card-info"},[n("p",null,"Clients Referred To ART")],-1)),n("div",eo,g(t.value.clients_referred_to_ART),1)]),n("div",to,[n("div",no,[a(S(G),{icon:S(ge),class:"card-icon"},null,8,["icon"])]),y[5]||(y[5]=n("div",{class:"card-info"},[n("p",null,"Visit Scheduled Today")],-1)),y[6]||(y[6]=n("div",{class:"card-number"},"10",-1))])]),n("h2",ao,"Patient Awaiting List ("+g(v.value)+")",1),n("div",so,[n("div",oo,[rn(n("input",{class:"search-input",type:"text",placeholder:"Search Patient","onUpdate:modelValue":y[0]||(y[0]=N=>s.value=N)},null,512),[[ln,s.value]])]),n("div",io,[(d(!0),f(F,null,J(c.value,N=>(d(),f("div",{class:"patient-item",key:N.id},[n("div",null,[n("strong",null,g(N.name),1),n("p",null,g(N.gender)+" â€¢ "+g(N.age)+"y",1)]),n("div",ro,[n("span",{class:te(["tag",N.statusClass])},g(N.status),3)])]))),128))]),n("div",lo,[n("button",{onClick:w,disabled:i.value===1,class:"pagination-btn"},[a(S(G),{icon:S(_t)},null,8,["icon"]),y[7]||(y[7]=A(" Previous ",-1))],8,co),n("div",uo,[A(" Page "+g(i.value)+" of "+g(r.value)+" ",1),n("span",po,"(Showing "+g(u.value+1)+"-"+g(p.value)+" of "+g(v.value)+")",1)]),n("button",{onClick:_,disabled:i.value===r.value,class:"pagination-btn"},[y[8]||(y[8]=A(" Next ",-1)),a(S(G),{icon:S(dn)},null,8,["icon"])],8,mo)])])])])}}}),go=W(ho,[["__scopeId","data-v-c7b78569"]]),dt={"HIV clinic registration":oe.HIV_CLINIC_REGISTRATION,"HIV reception":oe.HIV_RECEPTION,Vitals:oe.VITALS,"HIV staging":oe.HIV_STAGING,"HIV clinic consultation":oe.HIV_CLINIC_CONSULTATION,"ART adherence":oe.ART_ADHERENCE,Prescription:oe.TREATMENT,Dispensing:oe.DISPENSING,Appointments:oe.APPOINTMENT};class fo extends In{constructor(){super()}buildEncounters(t,s){return Object.entries(dt).map(([i,l])=>({encounter:i,female:t?t[l].F:0,male:t?t[l].M:0,me:s?s[l].F+s[l].M:0,facility:t?t[l].F+t[l].M:0}))}async getStats(){const t=Object.values(dt),s=An("reports/encounters",this.buildParams()),i=await H.postJson(s,{encounter_types:t}),l=await H.postJson(s,{encounter_types:t,all:!0});return this.buildEncounters(i.data,l.data)}getEncounterStats(t){return H.postJson("reports/encounters?date=".concat(this.date,"&program_id=1"),t)}}const _o={class:"dashboard-container"},vo={class:"main-section"},yo={class:"chart-section"},bo={class:"encounters-section"},Do={class:"his-sm-text"},Co={key:0},$o={class:"encounter-td"},wo={class:"other-td"},So={class:"other-td"},ko={class:"other-td"},Io={class:"other-td"},Ao={key:1},Po=x({__name:"ARTDashboard",setup(e){const t=O([]),s=ze({options:{chart:{id:"vuechart-example"},xaxis:{categories:["","","","",""]},yaxis:{min:0,forceNiceScale:!0,title:{text:"Number of clients",align:"left"}}},series:[{name:"Total visits",data:[0,0,0,0,0],color:"#7cb5ec"},{name:"Total incomplete visits",data:[0,0,0,0,0],color:"#434348"}]}),i=ze([{"HIV clinic registration":9},{"HIV reception":51},{Vitals:6},{"HIV staging":52},{"HIV clinic consultation":53},{"ART adherence":68},{Treatment:25},{Dispensing:54},{Appointments:7}]),l=()=>{t.value=i.map(u=>({encounter:Object.keys(u)[0],female:"",male:"",me:"",facility:""}))},v=async()=>{const u=new Wn,p=H.getSessionDate();u.setStartDate(I.subtract(p,"days",5).format(tt)),u.setEndDate(I.subtract(p,"days",1).format(tt));const c=await u.getVisitStats(),_=[],w=[],C=[];Object.entries(c).forEach(([b,{incomplete:y,complete:D}])=>{C.push(cn(b).format("dddd")),_.push(y),w.push(y+D)}),s.series[0].data=[...w],s.series[1].data=[..._],s.options={...s.options,xaxis:{categories:[...C]}}},r=async()=>{try{const u=new fo,p=i.map(w=>Object.values(w)[0]),c=await u.getEncounterStats({encounter_types:p}),_=await u.getEncounterStats({encounter_types:p,all:!0});t.value=i.map(w=>{const[C,b]=Object.entries(w)[0];return{encounter:C,female:_[b].F,male:_[b].M,me:c[b].F+c[b].M,facility:_[b].F+_[b].M}})}catch(u){console.error(u)}};return ce(()=>{l(),v(),r()}),(u,p)=>(d(),f("div",_o,[n("div",vo,[n("div",yo,[p[0]||(p[0]=n("h3",null,"Total visits/incomplete visits: last 5 days",-1)),a(S(Xe),{width:"100%",height:"390px",type:"bar",options:s.options,series:s.series},null,8,["options","series"])]),n("div",bo,[p[3]||(p[3]=n("h3",null,"Encounters created today",-1)),n("table",Do,[p[2]||(p[2]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),t.value.length?(d(),f("tbody",Co,[(d(!0),f(F,null,J(t.value,(c,_)=>(d(),f("tr",{key:_},[n("td",$o,g(c.encounter),1),n("td",wo,g(c.female),1),n("td",So,g(c.male),1),n("td",ko,g(c.me),1),n("td",Io,g(c.facility),1)]))),128))])):(d(),f("tbody",Ao,[...p[1]||(p[1]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])]))])])])]))}}),To=W(Po,[["__scopeId","data-v-9bb19378"]]);class We extends H{static getlogs(t,s){return this.getJson("notification/logs",{startDate:t,endDate:s})}static clear(t){return this.putJson("notifications/clear/".concat(t),{id:t})}static read(t){return this.putJson("notifications/update",{alerts:t})}static unread(){return this.getJson("notifications")}}const re=O([]),No=Ve();function Rt(){const e=K(()=>re.value.filter(_=>!_.read)),t=K(()=>re.value.length>0),s=K(()=>e.value.length>0),i=K(()=>e.value.length),l=K(()=>re.value.sort((_,w)=>new Date(_.date)>new Date(w.date)?-1:1));function v(_,w){Pn("Are you sure you want to clear notification?").then(C=>{C&&We.clear(_).then(()=>{re.value=re.value.filter(b=>b.id!=_),w(_),u()}).catch(b=>{console.error(b),be("Unable to clear notification")})})}function r(_){return I.toStandardHisDisplayFormat(_)}async function u(){re.value=[];const _=await We.unread();if(!ye.isEmpty(_)){const w={highVL:[],normalVL:[],rejectedVL:[]};let C={};re.value=_.map(b=>{let y="General";const D=b.text;let N=null;try{const P=JSON.parse(b.text);if(P.Type.match(/lims/i)){N=()=>No.push("/art/encounters/lab/".concat(P.PatientID)),y="".concat(P["Test type"]," results for ").concat(P["ARV-Number"]||P["Accession number"]);const V=Tn.detectHighVl(P.Result[0].value,P.Result[0].value_modifier);C={handler:N,id:b.alert_id,arv:P["ARV-Number"],accession:P["Accession number"],order_date:r(P["Orde date"]),results:P.Result[0].value_modifier+" "+P.Result[0].value,results_date:r(P.Result[0].date)},V?w.highVL.push(C):P.rejection_reason?(C={handler:N,id:b.alert_id,arv:P.arv_number,accession:P.accession_number,order_date:r(P.order_date),rejection_reason:P.rejection_reason},w.rejectedVL.push(C)):V||w.normalVL.push(C)}}catch(P){console.warn(P)}return{handler:N,message:D,vlMessageObs:w,title:y,id:b.alert_id,date:r(b.date_created)}})}}async function p(_){We.read([_.id]).then(()=>_.read=!0)}function c(_){typeof _.handler=="function"&&(p(_),_.handler())}return{markAsRead:p,openNotification:c,loadNotifications:u,clearNotification:v,sortedNotifications:l,hasUnreadNotifications:s,notificationCount:i,hasNotifications:t,notificationData:re}}const Ro={class:"vl-alerts-container"},Oo={class:"table-container"},Vo={class:"vl-table"},Lo={key:0},Mo={key:0},Bo=["colspan"],Eo={key:0},Fo=x({__name:"ARTVlAlert",setup(e){const t=O("high_vl"),{notificationData:s,loadNotifications:i,clearNotification:l,openNotification:v}=Rt(),r=K(()=>{var y,D;return s.value.length?(((D=(y=s.value[0])==null?void 0:y.vlMessageObs)==null?void 0:D.highVL)||[]).length:0}),u=K(()=>{var y,D;return s.value.length?(((D=(y=s.value[0])==null?void 0:y.vlMessageObs)==null?void 0:D.rejectedVL)||[]).length:0}),p=K(()=>{var y,D;return s.value.length?(((D=(y=s.value[0])==null?void 0:y.vlMessageObs)==null?void 0:D.normalVL)||[]).length:0}),c=K(()=>{var y;if(!s.value.length)return[];const b=(y=s.value[0])==null?void 0:y.vlMessageObs;if(!b)return[];switch(t.value){case"high_vl":return b.highVL||[];case"rejected":return b.rejectedVL||[];case"normal":return b.normalVL||[];default:return[]}}),_=b=>v(b),w=b=>{b.id&&l(b.id,y=>{console.log("Cleared notification ".concat(y))})},C=()=>{switch(t.value){case"high_vl":return"No high viral load results found";case"rejected":return"No rejected samples found";case"normal":return"No normal results found";default:return"No results found"}};return ce(()=>{i()}),(b,y)=>(d(),f("div",Ro,[a(S(Ye),{mode:"ios",modelValue:t.value,"onUpdate:modelValue":y[0]||(y[0]=D=>t.value=D),class:"category-segment"},{default:o(()=>[a(S(le),{value:"high_vl"},{default:o(()=>[a(S(ve),null,{default:o(()=>[A("High VL ("+g(r.value)+")",1)]),_:1})]),_:1}),a(S(le),{value:"rejected"},{default:o(()=>[a(S(ve),null,{default:o(()=>[A("Rejected ("+g(u.value)+")",1)]),_:1})]),_:1}),a(S(le),{value:"normal"},{default:o(()=>[a(S(ve),null,{default:o(()=>[A("Normal Results ("+g(p.value)+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",Oo,[n("table",Vo,[n("thead",null,[n("tr",null,[y[1]||(y[1]=n("th",null,"ARV #",-1)),y[2]||(y[2]=n("th",null,"Accession #",-1)),y[3]||(y[3]=n("th",null,"Order Date",-1)),t.value==="rejected"?(d(),f("th",Lo,"Rejection Reason")):k("",!0),y[4]||(y[4]=n("th",null,"View",-1)),y[5]||(y[5]=n("th",null,"Clear",-1))])]),n("tbody",null,[c.value.length===0?(d(),f("tr",Mo,[n("td",{colspan:t.value==="rejected"?6:5,class:"empty-message"},g(C()),9,Bo)])):k("",!0),(d(!0),f(F,null,J(c.value,D=>(d(),f("tr",{key:D.id},[n("td",null,g(D.arv||"-"),1),n("td",null,g(D.accession||"-"),1),n("td",null,g(D.order_date||"-"),1),t.value==="rejected"?(d(),f("td",Eo,g(D.rejection_reason||"-"),1)):k("",!0),n("td",null,[a(S(Te),{fill:"clear",size:"small",onClick:N=>_(D)},{default:o(()=>[a(S(G),{icon:S($t),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])]),n("td",null,[a(S(Te),{fill:"clear",size:"small",onClick:N=>w(D),color:"success"},{default:o(()=>[a(S(G),{icon:S(un),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])])]))),128))])])])]))}}),xo=W(Fo,[["__scopeId","data-v-7b9c4735"]]),Uo={class:"dashboard-container"},Ho={class:"segment-content"},Wo={key:0},zo={key:1},jo={key:2},Go=x({__name:"ARTHome",setup(e){const t=O("dashboard"),{notificationCount:s,loadNotifications:i}=Rt();return ce(()=>{i()}),(l,v)=>(d(),f("div",Uo,[a(S(Ye),{modelValue:t.value,"onUpdate:modelValue":v[0]||(v[0]=r=>t.value=r)},{default:o(()=>[a(S(le),{value:"dashboard"},{default:o(()=>[...v[1]||(v[1]=[A(" Overview ",-1)])]),_:1}),a(S(le),{value:"viralLoadAlerts"},{default:o(()=>[n("div",Ho,[v[2]||(v[2]=A(" VL Alerts ",-1)),S(s)>0?(d(),L(S(pn),{key:0,color:"primary"},{default:o(()=>[A(g(S(s)),1)]),_:1})):k("",!0)])]),_:1}),a(S(le),{value:"internalReferrals"},{default:o(()=>[...v[3]||(v[3]=[A(" Internal referrals ",-1)])]),_:1})]),_:1},8,["modelValue"]),t.value==="dashboard"?(d(),f("div",Wo,[a(To)])):k("",!0),t.value==="viralLoadAlerts"?(d(),f("div",zo,[a(xo)])):k("",!0),t.value==="internalReferrals"?(d(),f("div",jo,[a(Nt)])):k("",!0)]))}}),Jo=W(Go,[["__scopeId","data-v-d237cab2"]]);class Ko{constructor(){ee(this,"socket",null);ee(this,"channel","ImmunizationReportChannel");ee(this,"isConnected",!1);ee(this,"pendingFetch",null);ee(this,"location_id");ee(this,"initPromise");ee(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});ee(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});ee(this,"onError",t=>{console.error("WebSocket error:",t),this.isConnected=!1});this.initPromise=this.init()}async init(){const t=localStorage.getItem("apiURL"),s=localStorage.getItem("apiPort"),i=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const l="".concat(i,"://").concat(t,"/api/v1/cable");this.socket=new WebSocket(l),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(l){console.error(l),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const t={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(t))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await H.getJson("immunization/stats",{start_date:I.getDateBeforeByDays(I.sessionDate(),365),end_date:I.sessionDate()})}async setMessageHandler(t){await this.initPromise,this.socket?this.socket.onmessage=s=>{t(s)}:console.error("WebSocket connection not established.")}}const Qo=x({components:{IonContent:ae,IonHeader:ie,IonItem:me,IonList:pe,IonMenu:we,IonTitle:$e,IonToolbar:ue,IonInput:ct,BasicInputField:Rn,BasicForm:ke,PreviousVitals:Nn,customDatePicker:jn,IonCol:Me,IonRow:Be,VueMultiselect:mn,IonLabel:ve,DataTable:De},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:xe,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:I.toStandardHisDisplayFormat(H.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...Z(zn,["administerOtherVaccine"]),...Z(nt,["tempScannedBatchNumber"]),...Z(ne,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await Jn(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:gt,pulseOutline:hn,clipboardOutline:Ke}},methods:{formatBirthdate(e){return I.getBirthdateAge(e)},async openClientProfile(e){const t=await fe.findByID(e);await ne().setPatientRecord(t),this.$router.push("patientProfile")},processData(){var t;return((t=this.data)==null?void 0:t.map(s=>{if(s.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let i=[];const l=v=>v.map(u=>{let p=0;return u.clients.map(c=>{(u.drug_name==this.drug_name&&(this.village==c.table.city_village||this.village=="All")||(u.drug_name==this.drug_name||this.village==c.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:c.table.given_name,family_name:c.table.family_name,patient_id:c.table.patient_id,birthdate:c.table.birthdate,city_village:c.table.city_village}),p++),this.villageList.push(c.table.city_village)}),[u.drug_name,p]}).filter(u=>u[1]!==0);return this.title=="Client due today"&&(i=l(s.value.due_today_antigens)),this.title=="Client due this week"&&(i=l(s.value.due_this_week_antigens)),this.title=="Client due this month"&&(i=l(s.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(i=l(s.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(i=l(s.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(v=>JSON.stringify(v)))].map(v=>JSON.parse(v)),this.villageList=[...new Set(this.villageList)],i}}))[0]},handleVillageClick(e){this.drug_name="",this.village=e,this.tableData=this.processData()},handleRowClick(e){var s;this.tableEvent=e.target;const t=this.tableEvent.closest("tr");if(t){const i=Array.from(((s=t.parentNode)==null?void 0:s.children)||[]).indexOf(t),l=this.tableData[i];this.drug_name=l[0],t.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(e){return I.calculateDisplayAge(e)},openPopover(e){this.event=e,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(e){var s;const t=e.target.value;this.batchNumber=t||((s=this.tempScannedBatchNumber)==null?void 0:s.text)||""},saveBatchWithTodayDate(){let e=H.getSessionDate();this.saveDta(e)},dismiss(){Ee.dismiss()},saveBatch(){let e;ye.isEmpty(this.vaccineDate)==!0?e=H.getSessionDate():e=this.vaccineDate,this.saveDta(e)},validateVaccineName(){if(ye.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(ye.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(e){this.currentDrugOb=e},isAlphaNumeric(e){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(e)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(e){this.batchNumber=e},saveDta(e){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){be("Enter batch number!");return}if(this.batchNumber==""){be("Enter batch number!");return}const t={batch_number:this.batchNumber,date_administered:e,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},s=nt();s.setAdministeredVaccine(t),Gn(this.patient),this.dismiss(),s.setTempScannedBatchNumber(null)}}}),qo={key:0,class:"spinner-overlay"},Yo={class:"header position_content"},Zo={style:{"font-size":"1.2em","font-weight":"700"}},Xo={class:"dueCardContent"},ei=["onClick"],ti={style:{"margin-right":"15px"}},ni={style:{"align-items":"center",display:"flex"}},ai={style:{"line-height":"1"}},si={class:"client_name"},oi={class:"name"},ii={class:"demographicsOtherRow"},ri={class:"demographicsText"};function li(e,t,s,i,l,v){const r=m("ion-spinner"),u=m("ion-icon"),p=m("ion-header"),c=m("ion-card-title"),_=m("ion-card-header"),w=m("DataTable"),C=m("ion-card-content"),b=m("ion-card"),y=m("ion-item"),D=m("ion-list"),N=m("ion-popover"),P=m("ion-content");return d(),f(F,null,[e.isLoading?(d(),f("div",qo,[a(r,{name:"bubbles"}),t[3]||(t[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):k("",!0),a(p,null,{default:o(()=>[n("div",Yo,[n("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=V=>e.dismiss())},[a(u,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Zo,g(e.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:t[1]||(t[1]=V=>e.openPopover(V))},[a(u,{slot:"separator",size:"large",icon:e.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(P,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:o(()=>[n("div",null,[a(b,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:o(()=>[a(_,null,{default:o(()=>[a(c,{class:"sectionTitle"},{default:o(()=>[...t[4]||(t[4]=[A(" Summary of required doses ",-1)])]),_:1})]),_:1}),a(C,null,{default:o(()=>[n("div",Xo,[a(w,{options:e.options,data:e.tableData,class:"display nowrap",width:"100%",onClick:e.handleRowClick},{default:o(()=>[...t[5]||(t[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])]),_:1},8,["options","data","onClick"])])]),_:1})]),_:1}),a(b,{class:"section",style:{"margin-inline":"0px"}},{default:o(()=>[a(_,null,{default:o(()=>[a(c,{class:"sectionTitle"},{default:o(()=>[...t[6]||(t[6]=[A("Client Details ",-1)])]),_:1})]),_:1}),a(C,null,{default:o(()=>[(d(!0),f(F,null,J(e.clientDetails,(V,j)=>(d(),f("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:j,onClick:M=>e.openClientProfile(V.patient_id)},[n("div",ti,[n("div",{class:te((V==null?void 0:V.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(u,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:e.person},null,8,["icon"])],2)]),n("div",ni,[n("div",ai,[n("div",si,[n("div",oi,g(V.given_name)+" "+g(V.family_name),1)]),n("div",ii,[n("div",ri,[A(g(V.gender=="M"?"Male":"Female")+" ",1),t[7]||(t[7]=n("span",{class:"dot"},".",-1)),A(g(e.formatBirthdate(V.birthdate)),1)])]),n("div",null,"Village: "+g(V.city_village),1)])])],8,ei))),128))]),_:1})]),_:1})]),a(N,{style:{"--offset-x":"-10px"},"is-open":e.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:e.event,onDidDismiss:t[2]||(t[2]=V=>e.popoverOpen=!1)},{default:o(()=>[n("div",null,[t[8]||(t[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(d(!0),f(F,null,J(e.villageList,(V,j)=>(d(),L(D,{class:te(V==e.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:j},{default:o(()=>[a(y,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:M=>e.handleVillageClick(V)},{default:o(()=>[A(g(V),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const di=W(Qo,[["render",li],["__scopeId","data-v-dfc02771"]]),ci=x({name:"Menu",mixins:[Ie],components:{IonContent:ae,IonHeader:ie,IonItem:me,IonList:pe,IonMenu:we,IonTitle:$e,IonToolbar:ue,IonCheckbox:Fe,BasicForm:ke,BasicCard:Ue,Carousel:vn,Slide:_n,Pagination:fn,Navigation:gn},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},computed:{...Z(Se,["substance"]),backgroundStyle(){return{background:"linear-gradient(180deg, rgba(150, 152, 152, 0.7) 0%, rgba(255, 255, 255, 0.9) 100%), url(".concat(Kn("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",height:"22.8vh"}}},watch:{},async mounted(){new Ko().setMessageHandler(this.onMessage)},methods:{async onMessage(e){var s,i,l;const t=JSON.parse(e.data);t.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=t.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((s=this.reportData)==null?void 0:s.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((i=this.reportData)==null?void 0:i.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((l=this.reportData)==null?void 0:l.total_male_vaccinated_this_year)||0}])},openDueModal(e){const t={title:e,dashBoardData:this.reportData};Pe(di,{class:"fullScreenModal"},!0,t)},async openClientProfile(e){const t=await fe.findByNpid(e);await ne().setPatientRecord(t[0])}}}),ui={class:"topStats"},pi={class:"totalStats",style:{background:"linear-gradient(180deg, #20b2aa 0%, #40c0b0 50%, rgb(233, 233, 233) 100%)"}},mi={class:"statsValue",style:{"font-size":"1.4em"}},hi={class:"statsText",style:{"font-size":"0.9em"}},gi={class:"dueCardContent"},fi={class:"statsValue"},_i={class:"statsValue"},vi={class:"statsValue"},yi={class:"overDueCardContent"},bi={class:"statsValue"},Di={class:"statsValue"},Ci=["onClick"],$i={style:{"margin-right":"15px"}},wi={style:{"align-items":"center",display:"flex"}},Si={style:{"line-height":"1"}},ki={class:"client_name"},Ii={class:"name"},Ai={class:"demographicsOtherRow"},Pi={class:"demographicsText"};function Ti(e,t,s,i,l,v){const r=m("Slide"),u=m("Pagination"),p=m("Carousel"),c=m("ion-card-title"),_=m("ion-card-header"),w=m("ion-card-content"),C=m("ion-card"),b=m("ion-icon"),y=m("ion-content");return d(),L(y,{class:"content"},{default:o(()=>[n("div",ui,[n("div",null,[n("div",{style:Re(e.backgroundStyle)},[a(p,{autoplay:4e3,"wrap-around":!0,itemsToShow:1.2,transition:600,style:{"padding-top":"20px"}},{addons:o(()=>[a(u)]),default:o(()=>[(d(!0),f(F,null,J(e.totalStats,D=>(d(),L(r,{key:D},{default:o(()=>[n("div",pi,[n("div",mi,g(D.value),1),n("div",hi,g(D.name),1)])]),_:2},1024))),128))]),_:1})],4)]),a(C,{class:"section"},{default:o(()=>[a(_,null,{default:o(()=>[a(c,{class:"cardTitle"},{default:o(()=>[...t[5]||(t[5]=[A(" Clients due ",-1)])]),_:1})]),_:1}),a(w,null,{default:o(()=>{var D,N,P;return[n("div",gi,[n("div",{class:"dueCard",onClick:t[0]||(t[0]=V=>e.openDueModal("Client due today")),style:{border:"1px solid rgb(158, 207, 136)"}},[n("div",fi,g(((D=e.reportData)==null?void 0:D.due_today_count)||0),1),t[6]||(t[6]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(239, 221, 121)"},onClick:t[1]||(t[1]=V=>e.openDueModal("Client due this week"))},[n("div",_i,g(((N=e.reportData)==null?void 0:N.due_this_week_count)||0),1),t[7]||(t[7]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(241, 154, 154)"},onClick:t[2]||(t[2]=V=>e.openDueModal("Client due this month"))},[n("div",vi,g(((P=e.reportData)==null?void 0:P.due_this_month_count)||0),1),t[8]||(t[8]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),a(C,{class:"section"},{default:o(()=>[a(_,null,{default:o(()=>[a(c,{class:"cardTitle"},{default:o(()=>[...t[9]||(t[9]=[A(" Clients overdue ",-1)])]),_:1})]),_:1}),a(w,null,{default:o(()=>{var D,N;return[n("div",yi,[n("div",{class:"overDueCard",onClick:t[3]||(t[3]=P=>e.openDueModal("Client overdue under 5yrs"))},[n("div",bi,g(((D=e.reportData)==null?void 0:D.under_five_overdue)||0),1),t[10]||(t[10]=n("div",{class:"statsText"},"Under 5yrs",-1))]),n("div",{class:"overDueCard",onClick:t[4]||(t[4]=P=>e.openDueModal("Client overdue over 5yrs"))},[n("div",Di,g(((N=e.reportData)==null?void 0:N.over_five_overdue)||0),1),t[11]||(t[11]=n("div",{class:"statsText"},"Over 5yrs",-1))])])]}),_:1})]),_:1}),a(C,{class:"section"},{default:o(()=>[a(_,null,{default:o(()=>[a(c,{class:"cardTitle"},{default:o(()=>{var D;return[A("Today's appointments("+g((D=e.appointments)==null?void 0:D.length)+") ",1)]}),_:1})]),_:1}),a(w,null,{default:o(()=>[(d(!0),f(F,null,J(e.appointments,(D,N)=>(d(),f("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:N,onClick:P=>e.openClientProfile(D.npid)},[n("div",$i,[n("div",{class:te(D.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(b,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:e.person},null,8,["icon"])],2)]),n("div",wi,[n("div",Si,[n("div",ki,[n("div",Ii,g(D.given_name)+" "+g(D.family_name),1)]),n("div",Ai,[n("div",Pi,[A(g(D.gender=="M"?"Male":"Female")+" ",1),t[12]||(t[12]=n("span",{class:"dot"},".",-1)),A(g(e.formatBirthdate(D.birthdate)),1)])]),n("div",null,"Village: "+g(D==null?void 0:D.city_village),1)])])],8,Ci))),128))]),_:1})]),_:1})])]),_:1})}const Ni=W(ci,[["render",Ti],["__scopeId","data-v-8f784320"]]),Ri=x({components:{DataTable:De},props:{title:{type:String,default:""},list:{type:String,default:""},buttonTitle:{type:String,default:""},buttonLink:{type:String,default:""}},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:(e,t)=>{if(!e)return"-";const s=new Date(e).getTime(),i=Date.now()-s,l=Math.floor(i/6e4),v=(()=>{if(l<1)return"Just now";if(l<60)return"".concat(l," min").concat(l>1?"s":""," ago");const r=Math.floor(l/60);if(r<24)return"".concat(r," hour").concat(r>1?"s":""," ago");const u=Math.floor(r/24);return"".concat(u," day").concat(u>1?"s":""," ago")})();return t==="display"?v:i},type:"num",width:"15%"},{title:"Actions",data:null,render:(e,t,s)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px";const l="  --padding-top: 4px;\n                                            --padding-bottom: 4px;\n                                            --padding-start: 8px;\n                                            --padding-end: 8px;\n                                            font-size: 0.8rem;\n                                            height: 28px;\n                                            min-width: 70px;\n                                            white-space: nowrap;\n                                            ",v=(r,u,p)=>{const c=document.createElement("ion-button");return c.innerText=r,c.size="small",c.fill="solid",c.color=u,c.style.cssText=l,c.addEventListener("click",p),c};return i.appendChild(v(this.buttonTitle,"primary",()=>this.navigateTo(s,this.buttonLink))),i.appendChild(v("Profile","warning",()=>this.navigateTo(s,"/patientProfile"))),i.appendChild(v("Abscond","danger",()=>this.handleAbscond(s.identifier))),i},orderable:!1,width:"25%"}],tableOptions:{order:[[1,"desc"]]}}},computed:{...Z(Ge,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{patientsWaitingForConsultation:{handler(e){this.list==="CONSULTATION"&&(this.patients=e)},deep:!0},patientsWaitingForVitals:{handler(e){this.list==="VITALS"&&(this.patients=e)},deep:!0},patientsWaitingForLab:{handler(e){this.list==="LAB"&&(this.patients=e)},deep:!0},patientsWaitingForDispensation:{handler(e){this.list==="DISPENSATION"&&(this.patients=e)},deep:!0}},mounted(){this.setList()},methods:{setList(){const e={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation},t=this.list;this.patients=e[t]||[]},waitingTime(e){if(!e)return"-";const t=Date.now()-new Date(e).getTime(),s=Math.floor(t/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const i=Math.floor(s/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const l=Math.floor(i/24);return"".concat(l," day").concat(l>1?"s":""," ago")},async navigateTo(e,t){let s=[],i=null;H.getPouchDbStatus()||H.getLanConnectionStatus()?(s=await Oe("patients_records",{selector:{ID:e.identifier}}),i=s[0]):i||(i=await H.getJson("/patients/".concat(e.patient_id,"/get_patient_record"))),console.log("ðŸš€ ~ patientRecord:",i);const l=i;await ne().setPatientRecord(l),this.$router.push(t)},async handleAbscond(e){await On({ID:e})},dismiss(){Ee.dismiss()}}}),Oi={class:"modal-container"},Vi={class:"dueCardContent"};function Li(e,t,s,i,l,v){const r=m("ion-button"),u=m("ion-card-title"),p=m("ion-card-header"),c=m("DataTable"),_=m("ion-card-content"),w=m("ion-card");return d(),f("div",Oi,[a(r,{class:"close-button",fill:"clear",size:"large",onClick:e.dismiss},{default:o(()=>[...t[0]||(t[0]=[A(" Close ",-1)])]),_:1},8,["onClick"]),a(w,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:o(()=>[a(p,null,{default:o(()=>[a(u,{class:"sectionTitle"},{default:o(()=>[A(g(e.title),1)]),_:1})]),_:1}),a(_,null,{default:o(()=>[n("div",Vi,[a(c,{data:e.patients,options:e.tableOptions,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const Mi=W(Ri,[["render",Li],["__scopeId","data-v-110bf012"]]),Bi=x({components:{IonContent:ae,IonHeader:ie,IonItem:me,IonList:pe,IonIcon:G,IonCard:Le,IonCardHeader:bt,IonCardTitle:yt,IonCardContent:Qe,IonPopover:wt,DataTable:De},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:xe,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:e=>this.waitingTime(e),width:"20%"},{title:"Actions",data:null,render:(e,t,s)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px";const l="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",v=(r,u,p)=>{const c=document.createElement("ion-button");return c.innerText=r,c.size="small",c.fill="solid",c.color=u,c.style.cssText=l,c.addEventListener("click",p),c};return i.appendChild(v("Profile","warning",()=>this.navigateTo(e,"/patientProfile"))),i},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const e=await Vn();this.patients=e.map(t=>({fullName:t.fullName||"",arrivalTime:t.startDate||"",patient_id:t.patientId||"",identifier:t.identifier||""}))},methods:{openPopover(e){this.event=e,this.popoverOpen=!0},dismiss(){Ee.dismiss()},waitingTime(e){if(!e)return"-";const t=Date.now()-new Date(e).getTime(),s=Math.floor(t/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const i=Math.floor(s/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const l=Math.floor(i/24);return"".concat(l," day").concat(l>1?"s":""," ago")},async navigateTo(e,t){let s;(H.getPouchDbStatus()||H.getLanConnectionStatus())&&(s=await Oe("patients_records",{selector:{ID:e.identifier}}),s=s[0]),s||(s=await fe.findByID(e.patient_id)),s?(await ne().setPatientRecord(s),this.$router.push(t)):be("Patient not found. Please try searching the patient by name.")}}}),Ei={class:"modal-container"},Fi={class:"dueCardContent"};function xi(e,t,s,i,l,v){const r=m("ion-button"),u=m("ion-card-title"),p=m("ion-card-header"),c=m("DataTable"),_=m("ion-card-content"),w=m("ion-card");return d(),f("div",Ei,[a(r,{class:"close-button",fill:"clear",size:"large",onClick:e.dismiss},{default:o(()=>[...t[0]||(t[0]=[A(" Close ",-1)])]),_:1},8,["onClick"]),a(w,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:o(()=>[a(p,null,{default:o(()=>[a(u,{class:"sectionTitle"},{default:o(()=>[A(g(e.title),1)]),_:1})]),_:1}),a(_,null,{default:o(()=>[n("div",Fi,[a(c,{data:e.patients,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})])}const Ui=W(Bi,[["render",xi],["__scopeId","data-v-0d3bb4d1"]]),Hi=x({name:"OPDAppointmentsModal",components:{IonPage:Ce,IonHeader:ie,IonContent:ae,IonItem:me,IonList:pe,IonIcon:G,IonCard:Le,IonCardContent:Qe,IonPopover:wt,DataTable:De,IonSegment:Ye,IonSegmentButton:le,IonLabel:ve,IonRow:Be,IonCol:Me,DateInputField:et},props:{title:{type:String,default:"OPD Appointments"},programType:{type:String,required:!0},programId:{type:Number,required:!0}},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:xe,appointments:[],viewMode:"today",startDate:I.sessionDate(),endDate:I.sessionDate(),calendarOutline:ge,openOutline:Dt,tableColumns:[{title:"Patient ID",data:"ID"},{title:"Name",data:"name"},{title:"Age/DOB",data:"ageDob"},{title:"Gender",data:"gender"},{title:"Village",data:"village"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(e,t,s)=>{const i=document.createElement("div"),l=document.createElement("ion-button");return l.innerText="Profile",l.size="small",l.style.color="#fff",l.style.padding="8px 12px",l.style.marginRight="8px",l.addEventListener("click",()=>this.openClientProfile(s.ID)),i.appendChild(l),i},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,order:[[5,"asc"]]}}},async mounted(){await this.loadAppointments()},methods:{async loadAppointments(){this.isLoading=!0;try{const e=I.sessionDate(),t=this.viewMode==="today"?e:this.startDate,s=this.viewMode==="today"?e:this.endDate,i=localStorage.getItem("locationID"),l=typeof t=="string"?t:I.toStandardHisFormat(t),v=typeof s=="string"?s:I.toStandardHisFormat(s),u=(await Oe("patients_records")).flatMap(p=>{var _,w;return[...((_=p.appointments)==null?void 0:_.saved)||[],...((w=p.appointments)==null?void 0:w.unsaved)||[]].filter(C=>{if(!(C!=null&&C.value_datetime)||C.location_id&&C.location_id!==i)return!1;const b=I.toStandardHisFormat(C.value_datetime);return b>=l&&b<=v}).map(C=>{var b,y,D,N,P;return{ID:p.ID,name:[(b=p.personInformation)==null?void 0:b.given_name,(y=p.personInformation)==null?void 0:y.family_name].filter(Boolean).join(" ")||"Unknown",ageDob:(D=p.personInformation)!=null&&D.birthdate?I.getBirthdateAge(p.personInformation.birthdate):"N/A",gender:((N=p.personInformation)==null?void 0:N.gender)||"Unknown",village:((P=p.personInformation)==null?void 0:P.home_village)||"Unknown",appointmentDate:I.toStandardHisDisplayFormat(C.value_datetime),appointmentDateTime:C.value_datetime,rawData:C}})}).sort((p,c)=>new Date(p.appointmentDateTime).getTime()-new Date(c.appointmentDateTime).getTime());this.appointments=u,console.log("Found ".concat(u.length," appointments"))}catch(e){console.error("Error loading appointments:",e),at("Failed to load appointments")}finally{this.isLoading=!1}},async getAppointmentsD1(e){this.startDate=I.toStandardHisFormat(e),await this.loadAppointments()},async getAppointmentsD2(e){this.endDate=I.toStandardHisFormat(e),await this.loadAppointments()},onViewModeChange(){this.viewMode==="today"&&(this.startDate=I.sessionDate(),this.endDate=I.sessionDate()),this.loadAppointments()},async openClientProfile(e){try{const t=await Oe("patients_records",{selector:{ID:e}});await ne().setPatientRecord(t[0]),this.$router.push("patientProfile")}catch(t){console.error("Error opening profile:",t),at("Failed to open patient profile")}},openPopover(e){this.event=e,this.popoverOpen=!0},dismiss(){Ee.dismiss()}}}),Wi={class:"header position_content"},zi={style:{"font-size":"1.2em","font-weight":"700"}},ji={key:0,class:"date-filter"},Gi={class:"dueCardContent"},Ji={key:1,class:"no-appointments"};function Ki(e,t,s,i,l,v){const r=m("ion-icon"),u=m("ion-header"),p=m("ion-label"),c=m("ion-segment-button"),_=m("ion-segment"),w=m("DateInputField"),C=m("ion-col"),b=m("ion-row"),y=m("DataTable"),D=m("ion-card-content"),N=m("ion-card"),P=m("ion-content"),V=m("ion-page");return d(),L(V,null,{default:o(()=>[a(u,null,{default:o(()=>[n("div",Wi,[n("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=(...j)=>e.dismiss&&e.dismiss(...j))},[a(r,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",zi,g(e.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:t[1]||(t[1]=j=>e.openPopover(j))},[a(r,{slot:"separator",size:"large",icon:e.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(P,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:o(()=>[a(_,{modelValue:e.viewMode,"onUpdate:modelValue":t[2]||(t[2]=j=>e.viewMode=j),onIonChange:e.onViewModeChange},{default:o(()=>[a(c,{value:"today"},{default:o(()=>[a(p,null,{default:o(()=>[...t[3]||(t[3]=[A("Today's Appointments",-1)])]),_:1})]),_:1}),a(c,{value:"range"},{default:o(()=>[a(p,null,{default:o(()=>[...t[4]||(t[4]=[A("Date Range",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","onIonChange"]),e.viewMode==="range"?(d(),f("div",ji,[a(b,null,{default:o(()=>[a(C,null,{default:o(()=>[a(w,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:e.endDate,disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1},null,8,["icon","inputValue","maxDate","onUpdate:rawDateValue"])]),_:1}),a(C,null,{default:o(()=>[a(w,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):k("",!0),a(N,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:o(()=>[a(D,null,{default:o(()=>[n("div",Gi,[e.appointments.length>0?(d(),L(y,{key:0,data:e.appointments,columns:e.tableColumns,options:e.tableOptions,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns","options"])):(d(),f("div",Ji," No appointments found for the selected "+g(e.viewMode==="today"?"day":"date range"),1))])]),_:1})]),_:1})]),_:1})]),_:1})}const Qi=W(Hi,[["render",Ki],["__scopeId","data-v-e54f2168"]]),qi={class:"card-count"},Yi={class:"card-label"},Zi="#ffffff",Xi=x({__name:"DashboardCard",props:{icon:{},count:{},label:{},color:{}},emits:["cardClick"],setup(e,{emit:t}){const l={success:"#A5D6A7",info:"#81D4FA",warning:"#FFF59D",danger:"#EF9A9A"}[e.color||"info"]||"#E0E0E0";return(v,r)=>(d(),L(S(Le),{class:"dashboard-card",style:Re({borderColor:S(l),backgroundColor:Zi}),onClick:r[0]||(r[0]=u=>v.$emit("cardClick"))},{default:o(()=>[a(S(G),{icon:e.icon,class:"card-icon"},null,8,["icon"]),n("div",qi,g(e.count),1),n("div",Yi,g(e.label),1)]),_:1},8,["style"]))}}),er=W(Xi,[["__scopeId","data-v-84ad3c1b"]]),tr=x({name:"OPDDashboard",components:{DashboardCard:er},data(){return{totalPatientsToday:0,canViewVitals:!1,canViewConsultation:!1,canViewLab:!1,canViewDispensation:!1,canViewAppointments:!1,userRoles:[]}},computed:{...Z(Ge,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","patientsVisits","todaysAppointmentsCount"])},watch:{$route:{async handler(){this.reloadRolePermissions(),await this.refreshDashboard()},deep:!0}},async mounted(){this.reloadRolePermissions(),await this.refreshDashboard()},methods:{medkit(){return ft},flask(){return bn},async refreshDashboard(){const e=H.getUserLocationId();e&&await Ge().refresh(e)},clipboard(){return pt},thermometer(){return mt},calendar(){return yn},people(){return ht},reloadRolePermissions(){this.loadUserRoles(),this.updateCardVisibility()},loadUserRoles(){localStorage.getItem("userRoles");try{const e=localStorage.getItem("userRoles")||"[]",t=JSON.parse(e);this.userRoles=t.map(s=>typeof s=="string"?s:s.role||s.name||"")}catch(e){this.userRoles=[]}},hasAnyRole(e){const t=this.userRoles.map(s=>s.toLowerCase());return e.some(s=>t.includes(s.toLowerCase()))},updateCardVisibility(){this.canViewVitals=this.hasAnyRole(["Clinician","Nurse","Superuser"]),this.canViewConsultation=this.hasAnyRole(["Clinician","Superuser"]),this.canViewLab=this.hasAnyRole(["Lab"]),this.canViewDispensation=this.hasAnyRole(["Clinician","Pharmacist","Superuser"]),this.canViewAppointments=this.hasAnyRole(["Clinician","Nurse","Superuser"])},openAllModal(e,t,s){Pe(Ui,{class:"fullScreenModal"},!0,{title:e,buttonTitle:t,buttonLink:s})},openPatientsListModal(e,t,s,i){Pe(Mi,{class:"fullScreenModal"},!0,{title:e,list:t,buttonTitle:s,buttonLink:i})},openAppointmentsModal(e,t){Pe(Qi,{class:"fullScreenModal"},!0,{title:e,programType:t,programId:14})}}}),nr={class:"dashboard-wrapper"};function ar(e,t,s,i,l,v){const r=m("ion-icon"),u=m("ion-card-title"),p=m("ion-card-header"),c=m("DashboardCard"),_=m("ion-row"),w=m("ion-grid"),C=m("ion-card-content"),b=m("ion-card"),y=m("ion-content");return d(),L(y,{fullscreen:!0},{default:o(()=>[n("div",nr,[a(b,{class:"dashboard-card"},{default:o(()=>[a(p,{class:"dashboard-card-header"},{default:o(()=>[a(u,{class:"dashboard-title"},{default:o(()=>[a(r,{icon:e.people(),slot:"start",class:"dashboard-icon"},null,8,["icon"]),t[6]||(t[6]=A(" Today's Patients Overview ",-1))]),_:1})]),_:1}),a(C,null,{default:o(()=>[a(w,{class:"centered-grid"},{default:o(()=>[a(_,{class:"centered-row"},{default:o(()=>{var D,N,P,V;return[a(c,{icon:e.people(),color:"primary",count:e.patientsVisits.length,label:"Total patients today",onCardClick:t[0]||(t[0]=j=>e.openAllModal("All patients today","View profile","/patientProfile"))},null,8,["icon","count"]),e.canViewAppointments?(d(),L(c,{key:0,icon:e.calendar(),color:"primary",count:((D=e.todaysAppointmentsCount)==null?void 0:D.length)||0,label:"Appointments",onCardClick:t[1]||(t[1]=j=>e.openAppointmentsModal("OPD Appointments","14"))},null,8,["icon","count"])):k("",!0),e.canViewVitals?(d(),L(c,{key:1,icon:e.thermometer(),color:"primary",count:(N=e.patientsWaitingForVitals)==null?void 0:N.length,label:"Waiting for vitals",onCardClick:t[2]||(t[2]=j=>e.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals"))},null,8,["icon","count"])):k("",!0),e.canViewConsultation?(d(),L(c,{key:2,icon:e.clipboard(),color:"primary",count:(P=e.patientsWaitingForConsultation)==null?void 0:P.length,label:"Waiting for consultation",onCardClick:t[3]||(t[3]=j=>e.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan"))},null,8,["icon","count"])):k("",!0),e.canViewLab?(d(),L(c,{key:3,icon:e.flask(),color:"primary",count:e.patientsWaitingForLab.length,label:"Waiting for lab",onCardClick:t[4]||(t[4]=j=>e.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan"))},null,8,["icon","count"])):k("",!0),e.canViewDispensation?(d(),L(c,{key:4,icon:e.medkit(),color:"primary",count:(V=e.patientsWaitingForDispensation)==null?void 0:V.length,label:"Waiting for dispensation",onCardClick:t[5]||(t[5]=j=>e.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations"))},null,8,["icon","count"])):k("",!0)]}),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})}const sr=W(tr,[["render",ar],["__scopeId","data-v-f34e8dd2"]]),or={class:"icon-container"},ir=["src","alt"],rr={class:"card-title"},lr=x({__name:"DashboardCard",props:{icon:{},title:{}},emits:["click"],setup(e,{emit:t}){const s=e,i=t,l=K(()=>xe[s.icon]||"");return(v,r)=>(d(),f("div",{class:"card",onClick:r[0]||(r[0]=u=>i("click"))},[n("div",or,[n("img",{src:l.value,alt:e.title},null,8,ir)]),n("div",rr,g(e.title),1)]))}}),dr=W(lr,[["__scopeId","data-v-334cd0db"]]),cr={class:"dashboard-container"},ur={class:"dashboard-grid"},pr=x({__name:"AETCDashboard",setup(e){O("");const t=Ve(),s=O([{id:"patientArrival",icon:"plus_dashboard",title:"Patient Arrival"},{id:"screeningList",icon:"checklist",title:"Awaiting Screening List"},{id:"registrationList",icon:"checklist",title:"Awaiting Registration List"},{id:"triageList",icon:"checklist",title:"Awaiting Triage List"},{id:"assessmentList",icon:"checklist",title:"Awaiting Assessment List"},{id:"testResultsList",icon:"checklist",title:"Awaiting Test Results List"},{id:"specialtyList",icon:"checklist",title:"Awaiting Specialty List"},{id:"dispositionList",icon:"checklist",title:"Disposition List"},{id:"broughtDead",icon:"document",title:"Brought In Dead"},{id:"reports",icon:"chart",title:"Reports"}]),i=l=>{t.push({name:l})};return(l,v)=>(d(),L(S(Ce),null,{default:o(()=>[a(S(ae),{fullscreen:!0},{default:o(()=>[n("div",cr,[n("div",ur,[(d(!0),f(F,null,J(s.value,r=>(d(),L(dr,{key:r.id,icon:r.icon,title:r.title,onClick:u=>i(r.id)},null,8,["icon","title","onClick"]))),128))])])]),_:1})]),_:1}))}}),mr=W(pr,[["__scopeId","data-v-bcce1a76"]]),hr=x({name:"NCDDashboard",mixins:[Ie],components:{ApexChart:Xe},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await vt(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return H.getJson("programs/32/reports/ncd_dashboard",{start_date:I.toStandardHisFormat(I.sessionDate()),end_date:I.toStandardHisFormat(I.sessionDate())})}}}),gr={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},fr={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},_r={ref:"chartRef1"},vr={ref:"chartRef2"};function yr(e,t,s,i,l,v){const r=m("ion-card-content"),u=m("ion-card"),p=m("ApexChart");return d(),f(F,null,[n("div",gr,[a(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[...t[0]||(t[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])]),_:1})]),_:1}),a(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[...t[1]||(t[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])]),_:1})]),_:1}),a(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[...t[2]||(t[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])]),_:1})]),_:1}),a(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[...t[3]||(t[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])]),_:1})]),_:1})]),n("div",fr,[a(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[t[4]||(t[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",_r,[e.isChartReady?(d(),L(p,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:e.barChartOptions,series:e.barChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1})]),_:1}),a(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[t[5]||(t[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",vr,[e.isChartReady?(d(),L(p,{key:0,style:{width:"100%",height:"500px"},type:"line",options:e.lineChartOptions,series:e.lineChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1})]),_:1})])],64)}const br=W(hr,[["render",yr],["__scopeId","data-v-58e2a3d8"]]),Dr=x({name:"Home",mixins:[kt,Ie],components:{IonContent:ae,IonHeader:ie,IonPage:Ce,IonToolbar:ue,Toolbar:At,IonRow:Be,DateInputField:et,IonIcon:G,IonButton:Te,IonCol:Me},data(){const e=O(I.sessionDate()),t=O(I.sessionDate()),s=O(I.sessionDate()),i=O([]);return{segmentContent:"Today",minDate:s,startDate:e,endDate:t,people:i,calendarOutline:ge,eyeOutline:$t}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(e){this.segmentContent=e},formatBirthdate(e){return I.getBirthdateAge(e)},async getAppointments(){this.people=[],(await Tt.getAppointments(this.startDate,this.endDate,"")).forEach(t=>{const s={person_id:t.person_id,npid:t.npid,appointment_id:103,encounter_id:t.encounter_id,name:t.given_name.concat(" ",t.family_name),gender:t.gender,ageDob:this.formatBirthdate(t.birthdate),village:t.city_village,appointmentDate:I.toStandardHisDisplayFormat(t.appointment_date)};this.people.push(s)})},async getAppointmentsD1(e){this.startDate=I.toStandardHisFormat(e),await this.getAppointments()},async getAppointmentsD2(e){this.endDate=I.toStandardHisFormat(e),await this.getAppointments()},async openClientProfile(e){await fe.findByNpid(e),this.isPharmacist()},isPharmacist(){const e=JSON.parse(localStorage.getItem("userRoles")),t=e||[];t.some(s=>t.some(i=>i.role==="Pharmacist"))&&(this.$router.push("dispensation"),H.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),Cr={class:"appointments-container"},$r={key:0,class:"date-filter"},wr={class:"appointments-table"};function Sr(e,t,s,i,l,v){const r=m("ion-label"),u=m("ion-segment-button"),p=m("ion-segment"),c=m("DateInputField"),_=m("ion-col"),w=m("ion-row"),C=m("ion-icon"),b=m("ion-button"),y=m("ion-card");return d(),f("div",Cr,[n("div",null,[a(p,{value:e.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:o(()=>[a(u,{value:"Today",onClick:t[0]||(t[0]=D=>e.setSegmentContent("Today"))},{default:o(()=>[a(r,null,{default:o(()=>[...t[3]||(t[3]=[A("Today",-1)])]),_:1})]),_:1}),a(u,{value:"Tomorrow",onClick:t[1]||(t[1]=D=>e.setSegmentContent("Tomorrow"))},{default:o(()=>[a(r,null,{default:o(()=>[...t[4]||(t[4]=[A("Tomorrow",-1)])]),_:1})]),_:1}),a(u,{value:"Date range",onClick:t[2]||(t[2]=D=>e.setSegmentContent("Date range"))},{default:o(()=>[a(r,null,{default:o(()=>[...t[5]||(t[5]=[A("Date range",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),e.segmentContent==="Date range"?(d(),f("div",$r,[a(w,null,{default:o(()=>[a(_,null,{default:o(()=>[a(c,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(_,null,{default:o(()=>[a(c,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):k("",!0),e.people.length>0?(d(),L(y,{key:1},{default:o(()=>[n("table",wr,[t[6]||(t[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),f(F,null,J(e.people,D=>(d(),f("tr",{key:D.npid},[n("td",null,[a(w,null,{default:o(()=>[a(_,null,{default:o(()=>[A(g(D.name),1)]),_:2},1024),a(_,null,{default:o(()=>[a(b,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:N=>e.openClientProfile(D.npid),color:"primary",fill:"clear",size:"small"},{default:o(()=>[a(C,{icon:e.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,g(D.npid),1),n("td",null,g(D.ageDob),1),n("td",null,g(D.gender),1),n("td",null,g(D.village),1),n("td",null,g(D.appointmentDate),1)]))),128))])])]),_:1})):(d(),L(y,{key:2},{default:o(()=>[...t[7]||(t[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])]),_:1}))])}const kr=W(Dr,[["render",Sr],["__scopeId","data-v-c47f7768"]]),Ir=x({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(e){}}}),Ar={key:0},Pr={style:{display:"flex","margin-top":"10px"}},Tr={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},Nr={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},Rr={key:1};function Or(e,t,s,i,l,v){const r=m("ion-label"),u=m("ion-segment-button"),p=m("ion-segment"),c=m("VisitsHistory");return d(),f(F,null,[n("div",null,[a(p,{value:e.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:o(()=>[a(u,{value:"Internal referrals",onClick:t[0]||(t[0]=_=>e.setSegmentContent("Internal referrals"))},{default:o(()=>[a(r,null,{default:o(()=>[...t[2]||(t[2]=[A("Internal referrals",-1)])]),_:1})]),_:1}),a(u,{value:"External referrals",onClick:t[1]||(t[1]=_=>e.setSegmentContent("External referrals"))},{default:o(()=>[a(r,null,{default:o(()=>[...t[3]||(t[3]=[A("External referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),e.segmentContent=="Internal referrals"?(d(),f("div",Ar,[n("div",Pr,[e.checkUnderFive?(d(),f("div",Tr)):k("",!0),t[4]||(t[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),e.checkUnderFive?k("",!0):(d(),f("div",Nr))])])):k("",!0),e.segmentContent=="External referrals"?(d(),f("div",Rr,[a(c)])):k("",!0)],64)}const Vr=W(Ir,[["render",Or],["__scopeId","data-v-faad8f8b"]]),Lr=x({name:"Menu",components:{IonContent:ae,IonHeader:ie,IonItem:me,IonList:pe,IonMenu:we,IonTitle:$e,IonToolbar:ue,IonCheckbox:Fe,IonIcon:G,BasicForm:ke,BasicCard:Ue,Referrals:Vr,Dashboard:br,ANCAppointments:kr},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:Ct},{id:"referrals",label:"Referrals",icon:qe},{id:"appointments",label:"Appointments",icon:ge}],activeItem:"dashboard"}},computed:{...Z(Se,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),Mr={style:{display:"flex"}},Br={class:"left_col"},Er={class:"nav-menu"},Fr=["onClick"],xr={class:"right_col"};function Ur(e,t,s,i,l,v){const r=m("ion-icon"),u=m("Dashboard"),p=m("ANCAppointments"),c=m("Referrals");return d(),f("div",Mr,[n("div",Br,[n("nav",Er,[n("ul",null,[(d(!0),f(F,null,J(e.menuItems,_=>(d(),f("li",{key:_.id,class:te({active:e.activeItem===_.id}),onClick:w=>e.setActiveItem(_.id)},[a(r,{icon:_.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,g(_.label),1)],10,Fr))),128))])])]),n("div",xr,[n("div",null,[e.activeItem==="dashboard"?(d(),L(u,{key:0})):k("",!0),e.activeItem==="appointments"?(d(),L(p,{key:1})):k("",!0),e.activeItem==="referrals"?(d(),L(c,{key:2})):k("",!0)])])])}const Hr=W(Lr,[["render",Ur],["__scopeId","data-v-7e786ea4"]]),Wr=x({name:"Menu",components:{IonContent:ae,IonHeader:ie,IonItem:me,IonList:pe,IonMenu:we,IonTitle:$e,IonToolbar:ue,IonCheckbox:Fe,BasicForm:ke,BasicCard:Ue},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Z(Se,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),zr={class:"left_col"},jr={class:"nav-menu"},Gr=["onClick"];function Jr(e,t,s,i,l,v){return d(),f("div",null,[n("div",zr,[n("nav",jr,[n("ul",null,[(d(!0),f(F,null,J(e.menuItems,r=>(d(),f("li",{key:r.id,class:te({active:e.activeItem===r.id}),onClick:u=>e.setActiveItem(r.id)},g(r.label),11,Gr))),128))])])]),t[0]||(t[0]=n("div",{class:"right_col"},null,-1))])}const Kr=W(Wr,[["render",Jr],["__scopeId","data-v-32dd02d3"]]),Qr=x({name:"Menu",components:{IonContent:ae,IonHeader:ie,IonItem:me,IonList:pe,IonMenu:we,IonTitle:$e,IonToolbar:ue,IonCheckbox:Fe,BasicForm:ke,BasicCard:Ue},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Z(Se,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),qr={class:"left_col"},Yr={class:"nav-menu"},Zr=["onClick"];function Xr(e,t,s,i,l,v){return d(),f("div",null,[n("div",qr,[n("nav",Yr,[n("ul",null,[(d(!0),f(F,null,J(e.menuItems,r=>(d(),f("li",{key:r.id,class:te({active:e.activeItem===r.id}),onClick:u=>e.setActiveItem(r.id)},g(r.label),11,Zr))),128))])])]),t[0]||(t[0]=n("div",{class:"right_col"},null,-1))])}const el=W(Qr,[["render",Xr],["__scopeId","data-v-b49d8600"]]);function tl(){const e=Ze(),t=je(),s=O(!1),{OPDActivities:i,NCDActivities:l}=Ne(t),v=async u=>{var p;try{const c=H.getUserID(),_=await Pt.getJson("user_properties",{user_id:c,property:u});return _!=null&&_.property_value?(p=_==null?void 0:_.property_value)==null?void 0:p.split(","):[]}catch(c){return console.error("Error fetching user activities:",c),[]}},r=async()=>{try{s.value=!1;const[u,p]=await Promise.all([v("OPD_activities"),v("NCD_activities")]);u.length>0&&t.setOPDActivity(u),p.length>0&&t.setNCDActivity(p)}catch(u){console.error("Error updating activities:",u)}finally{s.value=!0}};return de(()=>e.path,async()=>{await r()},{immediate:!0,deep:!0}),{ready:s,OPDActivities:i,NCDActivities:l,getUserActivities:v,updateActivities:r}}function nl(){const e=Ze(),t=O(""),s=O(!1),i=O({}),l=()=>{const v=H.getUserRoles(),r=H.getProgramID(),u=H.getProgramName();t.value=v,s.value=!1,v==="Lab"&&r===14?i.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:r===14&&v!=="Lab"?i.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:r===12?i.value={url:"contact",btnName:"Back"}:u==="LABOUR AND DELIVERY PROGRAM"?i.value={url:"labour/labourHome",btnName:"Back to home"}:u==="PNC PROGRAM"?i.value={url:"pnc/home",btnName:"Back to home"}:i.value={url:"",btnName:""},s.value=!0};return de(()=>e.path,()=>{l()},{immediate:!0,deep:!0}),{userRole:t,ready:s,userRoleSettings:i,updateUserRoleSettings:l}}const al={key:0,class:"spinner-overlay"},Al=x({__name:"HomePage",setup(e){const t=O(!0),s=Ze(),i=Ln(),l=O(localStorage.getItem("sessionDate")||"");nl();const v=St(),{apiStatus:r}=Ne(It()),{activeProgram:u}=Ne(v),p=K(()=>{switch(u.value.program_id){case Y.IMMUNIZATION_PROGRAM:return Ni;case Y.OPD_PROGRAM:return sr;case Y.NCD_PROGRAM:return Es;case Y.AETC_PROGRAM:return mr;case Y.HTS_PROGRAM:return go;case Y.ANC_PROGRAM:return Hr;case Y.PNC_PROGRAM:return el;case Y.LABOUR_AND_DELIVERY_PROGRAM:return Kr;case Y.HIV_PROGRAM:return Jo;case Y.NEONATAL_PROGRAM:return rt;case Y.HTC_PROGRAM:return rt;default:return null}}),c=()=>{const C=localStorage.getItem("sessionDate");(!C||C.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),it()),l.value=C||""};let _=null;ce(()=>{_=()=>c(),window.addEventListener("storage",_);const C=setInterval(c,1e3);Dn(()=>{clearInterval(C),_&&window.removeEventListener("storage",_)}),c()}),de(l,(C,b)=>{(!C||C.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),it())}),de(()=>s.name,async C=>{C==="Home"&&(st(),await ot().loadGlobalProperty(),i.postData({command:"ping"}))},{immediate:!0,deep:!0});const w=async()=>{try{const C=H.getUserID(),b=await Pt.getUserByID(C);if(b.location_id!=null){const y=await Bn.getLocation(b.location_id);localStorage.setItem("locationData",JSON.stringify(y))}}catch(C){console.error("Failed to retrieve location data:",C)}};return r.value&&(tl(),w()),ce(async()=>{try{t.value=!0,st(),await ot().loadGlobalProperty(),ye.isEmpty(u.value)&&await Mn.show(Fn,{},"module-picker-modal")}catch(C){console.error("Error initializing component:",C)}finally{t.value=!1}}),(C,b)=>{const y=m("ion-spinner"),D=m("ion-content");return d(),L(S(Ce),null,{default:o(()=>[t.value?(d(),f("div",al,[a(y,{name:"bubbles"}),b[0]||(b[0]=n("div",{class:"loading-text"},"Please wait...",-1))])):k("",!0),a(At),a(xn),p.value?(d(),L(Cn(p.value),{key:1})):(d(),L(D,{key:2},{default:o(()=>[...b[1]||(b[1]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])]),_:1}))]),_:1})}}});export{Al as default};

System.register(["./vendor-legacy-DiKnuFk3.js","../index-legacy-NWMtb-qG.js","./DemographicBar-legacy-4Tu-1__B.js","./TreatmentPlan-legacy-B5kU9g3z.js","./NextAppointment-legacy-5Z0DeSz1.js","./RiskAssessment.vue_vue_type_script_setup_true_lang-legacy-CnVCp67H.js","./Vitals-legacy-EDD5a2Tj.js","./nonPharmaTherapyStore-legacy-CPSW5CO1.js","./ComplicationsStore-legacy-DlHVl64s.js","./lodash-legacy-pOOc9Efu.js","./formatServerData-legacy-DiWUX1yL.js","./Registration-legacy-Cm8iHxVB.js","./usePatientProfile-legacy-DpJZa2Lp.js","./ClientUtils-legacy-DbE17RFK.js","./apexcharts-legacy-OrDB9Kfl.js","./patient_diagnosis_service-legacy-D5tshEDR.js","./DashBox-legacy-DBBGniqq.js","./BasicForm-legacy-DXAsOeD5.js","./DateInputField-legacy-DnvTsfTL.js","./group_validation-legacy-DOdM82Yv.js","./LabOrdersList-legacy-Br6-IQ1Y.js","./useUserActivities-legacy-kzSktx4Z.js","./RadiologyStore-legacy-BqICcFpX.js","./previousComplaints-legacy-Dz34fdp0.js","./patient_complaints_service-legacy-B2xUzg8D.js","./user_role_management-legacy-DHWkUJcx.js","./ncd_appointment_service-legacy-Bd7IvaKo.js","./drug_prescription_service-legacy-BbiYPycQ.js","./useLocation-legacy-mQMrF1Vb.js","./vaccines_service-legacy-DvWfW2jf.js","./sms_service-legacy-Cdtvehft.js","./EIRreportsStore-legacy-BXKNwSb9.js","./Export-legacy-D_Eiouf6.js","./useNeonatalEnrollmentStore-legacy-BYCoHHOa.js","./enrollment-legacy-BWFKsMdA.js","./Outcome-legacy-CknDX5Tc.js","./wardsStore-legacy-J3OYMBRy.js"],function(e,a){"use strict";var t,n,l,s,i,o,c,r,u,v,d,g,p,m,y,f,h,b,_,S,w,D,j,C,x,A,k,I,P,T,R,N,V,L,O,E,M,B,F,H,z,$,U,J,W,Y,G,Q,X,K,Z,q,ee,ae,te,ne,le,se,ie,oe,ce,re,ue,ve,de,ge,pe,me,ye,fe,he,be;return{setters:[e=>{t=e.d,n=e.ap,l=e.cp,s=e.r,i=e.c,o=e.b2,c=e.w,r=e.a,u=e.O,v=e.f,d=e.J,g=e.l,p=e.u,m=e.a4,y=e.k,f=e.m,h=e.i,b=e.bM,_=e.v,S=e.a7,w=e.ba},e=>{D=e.aJ,j=e.u,C=e.aK,x=e.aL,A=e.aM,k=e.aN,I=e.d,P=e.aO,T=e.g,R=e.$,N=e.e,V=e.T,L=e.J,O=e.N,E=e.H,M=e.aP,B=e.aQ,F=e.m,H=e.aR,z=e.aS,$=e.t,U=e.aT,J=e.af,W=e.ag,Y=e.aU,G=e.G,Q=e.aV,X=e.a1,K=e.S},e=>{Z=e.D},e=>{q=e.D,ee=e.C,ae=e.T},e=>{te=e.I,ne=e.N,le=e._,se=e.i},e=>{ie=e._},e=>{oe=e.V},e=>{ce=e.u,re=e._,ue=e.s,ve=e.c,de=e.a},e=>{ge=e.u},e=>{pe=e.l},e=>{me=e.a,ye=e.b},e=>{fe=e.C},e=>{he=e.u},e=>{be=e.p},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){const a={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},_e={class:"back_profile"};e("default",t({__name:"ConsultationPlan",setup(e,{expose:t}){const{onTabBeforeChange:Se,currentTabIndex:we}=ce(),{printVisitSummary:De}=he(),je=n(),Ce=l();s([]),s([]),s(!1);const xe=s(!0),Ae=s(!1),ke=s(!1),Ie=i(()=>({text:ke.value?"Saving...":"Finish",icon:ke.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:Ae.value||ke.value})),Pe=D(),Te=j(),Re=C(),Ne=x();A();const Ve=k(),Le=I();P();const Oe=T(),Ee=ge(),Me=R(),{patient:Be}=o(Te),{vitals:Fe}=o(Pe),{investigations:He}=o(Re),{diagnosis:ze}=o(Ne),{substance:$e}=o(Oe),{selectedNCDMedicationList:Ue}=o(Ve),{FootScreening:Je,visualScreening:We,cvScreening:Ye}=o(Ee),{sessionDate:Ge}=o(Me),{apiStatus:Qe}=o(N());s(!1),c(Ie,(e,a)=>{console.log("Done button options changed:",{from:a,to:e,currentStep:we.value,tabsLength:qe.value.length}),e.disabled!==(null==a?void 0:a.disabled)&&console.log("Done button "+(e.disabled?"disabled":"enabled")),e.text!==(null==a?void 0:a.text)&&console.log(`Done button text changed from "${null==a?void 0:a.text}" to "${e.text}"`)},{deep:!0}),c(ke,(e,a)=>{e!==a&&(console.log(`Saving state changed: ${a} -> ${e}`),e?console.log("Starting save process..."):console.log("Save process completed"))});const Xe=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},Ke=()=>{let e=!1;return oa(),ke.value&&(e=!0),Ae.value=e,!e},Ze=()=>Le.NCDActivities.map(e=>({title:e,icon:""})),qe=s(Ze()),ea=s(null),aa=s(null),ta=s(null),na=s(null),la=s(null),sa=s(null),ia=s(null),oa=()=>{var e;if(!qe.value||0===qe.value.length)return console.log("Tabs not yet initialized"),null;const a=we.value>=0&&we.value<qe.value.length?we.value:0;switch(null===(e=qe.value[a])||void 0===e?void 0:e.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(Le.NCDActivities.length>0)switch(Le.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},ca=()=>{xe.value=!1,setTimeout(()=>{we.value=0,xe.value=!0},0)},ra=()=>{const e=D();e.setVitals(e.getInitialVitals(Be.value.ID))},ua=async()=>{const e=O(Ge.value,"sessionDate","value")||E.sessionDate(),a=M("vitals");for(let n=0;n<qe.value.length;n++){const l=qe.value[n];if("Vital Signs"===l.title)qe.value[n].icon=va(e,a)?w:"";else if("Risk Assessment"===l.title){const a=M("substanceAbuse");qe.value[n].icon=va(e,a)?w:""}else if("Investigations"===l.title){var t;const a=null==Be||null===(t=Be.value)||void 0===t||null===(t=t.labOrders)||void 0===t?void 0:t.saved,l=null==a?void 0:a.filter(a=>E.toStandardHisFormat(e)===E.toStandardHisFormat(a.order_date));qe.value[n].icon=(null==l?void 0:l.length)>0?w:""}else if("Diagnosis"===l.title){const a=M("diagnosis");qe.value[n].icon=va(e,a)?w:""}else if("Complications Screening"===l.title){const a=M("screening");qe.value[n].icon=va(e,a)?w:""}else"Treatment Plan"===l.title&&(Ue.value.length>0?qe.value[n].icon=B()?w:"":qe.value[n].icon="")}Ke()},va=(e,a)=>{const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},da=async(e,a)=>{var t,n;const l=null===(t=qe.value[e])||void 0===t?void 0:t.title,s=null===(n=qe.value[a])||void 0===n?void 0:n.title;var i,o;e%1==0&&(we.value=e),"Vital Signs"==s&&(null===(i=ea.value)||void 0===i||i.onSubmit()),"Risk Assessment"==s&&(null===(o=aa.value)||void 0===o||o.onSubmit()),"Complications Screening"==s&&await(async()=>{const e=[],a=await me(We.value),t=await ye(Je.value),n=await me(Ye.value);var l,s,i,o;a.length>0&&e.push({concept_id:await J.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:J.getSessionDate(),child:a}),t.length>0&&e.push({concept_id:await J.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:J.getSessionDate(),child:t}),n.length>0&&e.push(...n),e.length>0?(null!==(s=(l=null!==(o=(i=Be.value).screening)&&void 0!==o?o:i.screening={}).unsaved)&&void 0!==s||(l.unsaved=[]),await W.addObsToEncounterPatient(e,Y.SCREENING),G("Complications saved successfully")):$("No complications data to save")})(),"Treatment Plan"==s&&await(async()=>{const e=Q();if(!pe.isEmpty(e.selectedMedicalAllergiesList)){const a=X(),t=e.selectedMedicalAllergiesList.map(e=>({concept_id:e.concept_id,obs_datetime:K.getSessionDate(),value_coded:e.concept_id,location_id:a.facilityLocation.code,value_text:e.name})),n=await ue(t);Be.value=Object.assign(Be.value,n),console.log("Allergies staged successfully:",Be.value),e.clearSelectedMedicalAllergiesList()}const a=await ve();Be.value=Object.assign(Be.value,a);const t=await de().saveNonPharmaTherapyPatientData();Be.value=Object.assign(Be.value,t)})(),"Investigations"==l&&1==await(async()=>{let e=!1;const a=a=>{e=!1},t=async a=>{1==a.detail&&(e=!0)};if(1==await se()){const e={message:"You can screen the patient for AHD, do you want to proceed?"};await F(U,{class:"otherVitalsModal"},!0,e,{cancel:a,confirm:t})}else e=!1;return e})()&&await F(le,{class:"fullScreenModal"},!0,{closeModalOnFinish:!0}),await H(Be.value)},ga=async()=>{ke.value=!0;try{await z(),await H(Be.value),await pa(),je.push("patientProfile")}catch(e){console.error("Error saving data:",e),$("Error occurred while saving data. Please try again.")}finally{ke.value=!1}},pa=async()=>{"dismiss"!==await F(fe,{class:"small-confirm-modal "})&&await De()};return r(async()=>{try{var e;if(0===Le.NCDActivities.length)return void je.push("patientProfile");ge().resetScreening(),qe.value=Ze(),be.setCurrentPatientID(null===(e=Be.value)||void 0===e?void 0:e.patientID),await ua(),(void 0===we.value||we.value<0)&&(we.value=0,console.log("Setting initial tab index to 0")),Ae.value=!1,ke.value=!1,Ke()}catch(a){console.error("Error: ",a)}}),c(we,async()=>{await Ke()}),c(Fe,async()=>{await ua()},{deep:!0}),c(Be,async()=>{try{var e;ge().resetScreening(),be.setCurrentPatientID(null===(e=Be.value)||void 0===e?void 0:e.patientID),await ua()}catch(a){console.error("Error updating patient data: ",a)}},{deep:!0}),c(Ge,async()=>{await ua()},{deep:!0}),c(He,async()=>{await ua()},{deep:!0}),c(ze,async()=>{await ua()},{deep:!0}),c($e,async()=>{await ua()},{deep:!0}),c(Ue,async()=>{await ua()},{deep:!0}),c(Ce,async e=>{ca(),ra(),qe.value=Ze()},{deep:!0}),c(Be,async(e,a)=>{e.ID!=a.ID&&(ca(),ra())},{deep:!0}),t({saveData:ga,markWizard:ua,refreshWizard:ca,validateDoneButtonState:Ke}),(e,t)=>(v(),u(p(S),null,{default:d(()=>[g(V),g(p(m),{fullscreen:!0},{default:d(()=>[g(Z),y("div",a,[xe.value?(v(),u(re,{key:0,ref:"wizard",headingTitle:"Consultation Plan","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:Ie.value,"custom-tabs":qe.value,beforeChange:p(Se),onChange:da,"onComplete:wizard":t[1]||(t[1]=e=>ga()),onDoneButtonChanged:Xe},{default:d(()=>[y("div",null,[y("div",_e,[g(L,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:p(b),"font-weight":"600",onClick:t[0]||(t[0]=e=>{je.push("patientProfile")})},null,8,["icon"])])]),h(y("div",null,[g(oe,{ref_key:"vitalsRef",ref:ea},null,512)],512),[[_,"Vitals"==oa()]]),h(y("div",null,[g(ie,{ref_key:"riskAssessmentRef",ref:aa},null,512)],512),[[_,"RiskAssessment"==oa()]]),h(y("div",null,[g(te,{ref_key:"investigationsRef",ref:ta},null,512)],512),[[_,"Investigations"==oa()]]),h(y("div",null,[g(q,{ref_key:"diagnosisRef",ref:na},null,512)],512),[[_,"DiagnosisComponent"==oa()]]),h(y("div",null,[g(ee,{ref_key:"complicationsRef",ref:la},null,512)],512),[[_,"ComplicationsScreening"==oa()]]),h(y("div",null,[g(ae,{ref_key:"treatmentPlanRef",ref:sa},null,512)],512),[[_,"TreatmentPlan"==oa()]]),h(y("div",null,[g(ne,{ref_key:"nextAppointmentRef",ref:ia},null,512)],512),[[_,"NextAppointment"==oa()]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):f("",!0)])]),_:1})]),_:1}))}}))}}});

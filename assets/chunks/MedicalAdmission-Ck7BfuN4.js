import{d as Ie,am as Re,cr as Ae,r as S,c as Me,b2 as D,w as d,a as Te,H as g,O as j,f as U,J as B,l as o,u as w,ab as ke,k as r,m as Fe,i as v,bT as Be,v as f,ae as Ee,ba as _}from"./vendor-BTebhqHt.js";import{b9 as G,u as Ne,ba as Ve,bb as ze,b1 as Le,bc as $e,e as We,b2 as je,i as Ue,a8 as Ge,f as Je,T as qe,D as Ke,a1 as Qe,H as E,b4 as C,bd as Xe,I as J,be as Ye,t as q,ao as x,F as Ze,bf as Oe,aa as et,S as tt}from"../index-DBQF-8Xn.js";import{D as at}from"./DemographicBar-CPy0fs0J.js";import{u as st,_ as it}from"./useFormWizard-Ccxlnnh2.js";import{u as N}from"./ComplicationsStore-r8tmvgC8.js";import{s as nt,c as ot,u as lt}from"./nonPharmaTherapyStore-Di9r8tlh.js";import{l as rt}from"./lodash-NJiRuGo9.js";import{f as K,a as ct}from"./formatServerData-DRULdCzT.js";import{u as ut}from"./usePatientProfile-AYXZSB7D.js";import"./apexcharts-no8IW45T.js";import"./drug_prescription_service-nTQSIINm.js";import"./patient_diagnosis_service-BkQO5DWD.js";import"./Registration-Bw_Ielpx.js";import"./useSetRegistrationValues-D_O_P88p.js";import"./useLocation-DWKEe-Fi.js";import"./vaccines_service-CPD8V9uh.js";import"./sms_service-BnFxTj4j.js";import"./EIRreportsStore-xF8KfXWW.js";import"./Export-JdaAXeIZ.js";import"./user_role_management-CBMMR3Y4.js";import"./useNeonatalEnrollmentStore-CfCsBxiA.js";import"./enrollment-DU-PLRUa.js";import"./Outcome-Byh15Hmo.js";import"./wardsStore-DgQn54tV.js";const mt={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},gt={class:"back_profile"},zt=Ie({__name:"MedicalAdmission",setup(vt,{expose:Q}){const{onTabBeforeChange:X,currentTabIndex:y}=st();ut();const I=Re(),Y=Ae();S([]),S([]),S(!1);const R=S(!0),A=S(!1),h=S(!1),V=Me(()=>({text:h.value?"Saving...":"Finish",icon:h.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:A.value||h.value})),Z=G(),O=Ne(),ee=Ve(),te=ze();Le();const ae=$e(),M=We();je();const se=Ue(),ie=N(),ne=Ge(),{patient:l}=D(O),{vitals:oe}=D(Z),{investigations:le}=D(ee),{diagnosis:re}=D(te),{substance:ce}=D(se),{selectedNCDMedicationList:z}=D(ae),{FootScreening:ue,visualScreening:me,cvScreening:ge}=D(ie),{sessionDate:L}=D(ne),{apiStatus:ft}=D(Je());d(V,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:y.value,tabsLength:i.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),d(h,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const ve=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},P=()=>{let e=!1;return u(),h.value&&(e=!0),A.value=e,!e},fe=()=>{I.push("/patientProfile")},T=()=>[{title:"Presenting Complaints",icon:""},{title:"Drug History",icon:""},{title:"Past Medical History",icon:""},{title:"Past Surgical History",icon:""},{title:"Allergy",icon:""},{title:"Intoxication",icon:""},{title:"Social History",icon:""},{title:"Family History",icon:""},{title:"Review of Systems",icon:""},{title:"Physical Examination",icon:""},{title:"Summary",icon:""},{title:"Differential Diagnosis",icon:""},{title:"Investigation",icon:""},{title:"Management Plan",icon:""}],i=S(T()),de=S(null),ye=S(null),u=()=>{var s;if(!i.value||i.value.length===0)return console.log("Tabs not yet initialized"),null;const e=y.value>=0&&y.value<i.value.length?y.value:0;switch((s=i.value[e])==null?void 0:s.title){case"Presenting Complaints":return"Presenting Complaints";case"Drug History":return"DrugHistory";case"Past Medical History":return"PastMedicalHistory";case"Past Surgical History":return"PastSurgicalHistory";case"Allergy":return"Allergy";case"Intoxication":return"Intoxication";case"Social History":return"SocialHistory";case"Family History":return"FamilyHistory";case"Review of Systems":return"ReviewOfSystems";case"Physical Examination":return"PhysicalExamination";case"Summary":return"Summary";case"Differential Diagnosis":return"DifferentialDiagnosis";case"Investigation":return"Investigation";case"Management Plan":return"ManagementPlan";default:if(M.NCDActivities.length>0)switch(M.NCDActivities[0]){case"Presenting Complaints":return"PresentingComplaints";case"Drug History":return"DrugHistory";case"Past Medical History":return"PastMedicalHistory";case"Past Surgical History":return"PastSurgicalHistory";case"Allergy":return"Allergy";case"Intoxication":return"Intoxication";case"Social History":return"SocialHistory";case"Family History":return"FamilyHistory";case"Review of Systems":return"ReviewOfSystems";case"Physical Examination":return"PhysicalExamination";case"Summary":return"Summary";case"Differential Diagnosis":return"DifferentialDiagnosis";case"Investigation":return"Investigation";case"Management Plan":return"ManagementPlan"}return null}},k=()=>{R.value=!1,setTimeout(()=>{y.value=0,R.value=!0},0)},$=()=>{const e=G();e.setVitals(e.getInitialVitals(l.value.ID))},p=async()=>{var s,m;const e=Qe(L.value,"sessionDate","value")||E.sessionDate(),t=C("vitals");for(let a=0;a<i.value.length;a++){const c=i.value[a];if(c.title==="Vital Signs")i.value[a].icon=H(e,t)?_:"";else if(c.title==="Risk Assessment"){const n=C("substanceAbuse");i.value[a].icon=H(e,n)?_:""}else if(c.title==="Investigations"){const n=(m=(s=l==null?void 0:l.value)==null?void 0:s.labOrders)==null?void 0:m.saved,b=n==null?void 0:n.filter(F=>E.toStandardHisFormat(e)===E.toStandardHisFormat(F.order_date));i.value[a].icon=(b==null?void 0:b.length)>0?_:""}else if(c.title==="Diagnosis"){const n=C("diagnosis");i.value[a].icon=H(e,n)?_:""}else if(c.title==="Complications Screening"){const n=C("screening");i.value[a].icon=H(e,n)?_:""}else c.title==="Treatment Plan"&&(z.value.length>0?i.value[a].icon=Xe()?_:"":i.value[a].icon="")}P()},H=(e,t)=>{const s=new Date(e);return s.setHours(0,0,0,0),t.some(m=>{const a=new Date(m.obs_datetime);return a.setHours(0,0,0,0),a.getTime()===s.getTime()})},pe=async()=>{var a,c,n,b;const e=[],t=await K(me.value),s=await ct(ue.value),m=await K(ge.value);t.length>0&&e.push({concept_id:await x.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:x.getSessionDate(),child:t}),s.length>0&&e.push({concept_id:await x.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:x.getSessionDate(),child:s}),m.length>0&&e.push(...m),e.length>0?((b=(n=(c=(a=l.value).screening)!=null?c:a.screening={}).unsaved)!=null||(n.unsaved=[]),l.value.screening.unsaved.push(...e),Ze("Complications saved successfully")):q("No complications data to save")},Se=async()=>{const e=Oe();if(!rt.isEmpty(e.selectedMedicalAllergiesList)){const m=et(),a=e.selectedMedicalAllergiesList.map(n=>({concept_id:n.concept_id,obs_datetime:tt.getSessionDate(),value_coded:n.concept_id,location_id:m.facilityLocation.code,value_text:n.name})),c=await nt(a);l.value=Object.assign(l.value,c),console.log("Allergies staged successfully:",l.value),e.clearSelectedMedicalAllergiesList()}const t=await ot();l.value=Object.assign(l.value,t);const s=await lt().saveNonPharmaTherapyPatientData();l.value=Object.assign(l.value,s)},De=async(e,t)=>{var m,a,c;const s=(m=i.value[t])==null?void 0:m.title;e%1===0&&(y.value=e),s=="Vital Signs"&&((a=de.value)==null||a.onSubmit()),s=="Risk Assessment"&&((c=ye.value)==null||c.onSubmit()),s=="Complications Screening"&&await pe(),s=="Treatment Plan"&&await Se(),await J(l.value)},W=async()=>{h.value=!0;try{await Ye(),await J(l.value),I.push("/triageList")}catch(e){console.error("Error saving data:",e),q("Error occurred while saving data. Please try again.")}finally{h.value=!1}};return Te(async()=>{if(M.NCDActivities.length===0){I.push("patientProfile");return}N().resetScreening(),i.value=T(),await p(),(y.value===void 0||y.value<0)&&(y.value=0,console.log("Setting initial tab index to 0")),A.value=!1,h.value=!1,P()}),d(y,async()=>{await P()}),d(oe,async()=>{await p()},{deep:!0}),d(l,async()=>{N().resetScreening(),await p()},{deep:!0}),d(L,async()=>{await p()},{deep:!0}),d(le,async()=>{await p()},{deep:!0}),d(re,async()=>{await p()},{deep:!0}),d(ce,async()=>{await p()},{deep:!0}),d(z,async()=>{await p()},{deep:!0}),d(Y,async e=>{k(),$(),i.value=T()},{deep:!0}),d(l,async(e,t)=>{e.ID!=t.ID&&(k(),$())},{deep:!0}),Q({saveData:W,markWizard:p,refreshWizard:k,validateDoneButtonState:P}),(e,t)=>{const s=g("PresentingComplaints"),m=g("DrugHistory"),a=g("PastMedicalHistory"),c=g("PastSurgicalHistory"),n=g("Allergy"),b=g("Intoxication"),F=g("SocialHistory"),he=g("FamilyHistory"),be=g("ReviewOfSystems"),_e=g("PhysicalExamination"),Pe=g("Summary"),He=g("DifferentialDiagnosis"),we=g("Investigation"),Ce=g("ManagementPlan");return U(),j(w(Ee),null,{default:B(()=>[o(qe),o(w(ke),{fullscreen:!0},{default:B(()=>[o(at),r("div",mt,[R.value?(U(),j(it,{key:0,ref:"wizard",headingTitle:"Medical Inpatient Admission Sheet","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:V.value,"custom-tabs":i.value,beforeChange:w(X),onChange:De,"onComplete:wizard":t[1]||(t[1]=xe=>W()),onDoneButtonChanged:ve},{default:B(()=>[r("div",null,[r("div",gt,[o(Ke,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:w(Be),"font-weight":"600",onClick:t[0]||(t[0]=xe=>fe())},null,8,["icon"])])]),v(r("div",null,[o(s,{ref:"presentingComplaintsRef"},null,512)],512),[[f,u()=="PresentingComplaints"]]),v(r("div",null,[o(m,{ref:"drugHistoryRef"},null,512)],512),[[f,u()=="DrugHistory"]]),v(r("div",null,[o(a,{ref:"pastMedicalHistoryRef"},null,512)],512),[[f,u()=="PastMedicalHistory"]]),v(r("div",null,[o(c,{ref:"pastSurgicalHistoryRef"},null,512)],512),[[f,u()=="PastSurgicalHistory"]]),v(r("div",null,[o(n,{ref:"allergyRef"},null,512)],512),[[f,u()=="Allergy"]]),v(r("div",null,[o(b,{ref:"IntoxicationRef"},null,512)],512),[[f,u()=="Intoxication"]]),v(r("div",null,[o(F,{ref:"socialHistoryRef"},null,512)],512),[[f,u()=="SocialHistory"]]),v(r("div",null,[o(he,{ref:"familyHistoryRef"},null,512)],512),[[f,u()=="FamilyHistory"]]),v(r("div",null,[o(be,{ref:"reviewOfSystemsRef"},null,512)],512),[[f,u()=="ReviewOfSystems"]]),v(r("div",null,[o(_e,{ref:"physicalExaminationRef"},null,512)],512),[[f,u()=="PhysicalExamination"]]),v(r("div",null,[o(Pe,{ref:"summaryRef"},null,512)],512),[[f,u()=="Summary"]]),v(r("div",null,[o(He,{ref:"differentialDiagnosisRef"},null,512)],512),[[f,u()=="DifferentialDiagnosis"]]),v(r("div",null,[o(we,{ref:"investigationRef"},null,512)],512),[[f,u()=="Investigation"]]),v(r("div",null,[o(Ce,{ref:"managementPlanRef"},null,512)],512),[[f,u()=="ManagementPlan"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Fe("",!0)])]),_:1})]),_:1})}}});export{zt as default};

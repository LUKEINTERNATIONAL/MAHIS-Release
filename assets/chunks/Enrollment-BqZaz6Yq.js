import{d as K,eO as q,r as D,c as ae,w as V,e as b,m as Y,f as v,k as r,l as f,u as d,aR as De,J as T,L as x,bj as oe,cv as we,Q as $,aQ as Te,aP as Ie,Y as ke,bF as Be,N as Q,aZ as Ce,F as ne,P as re,K as S,cG as Ve,a as ue,O as Z,an as Re,f7 as Me,bk as Ye,f8 as He,bK as xe,d8 as Ee,a3 as Ge,a6 as Le,aV as Ue,by as We,eP as qe,H as te}from"./vendor-BthE7zCk.js";import{l as k,u as me,P as Ae,_ as ie,L as $e,aC as j,T as Ke,b4 as ve,H as ze,ab as Qe,G as je,t as Je}from"../index-DWFSpzOY.js";import{N as Ze}from"./neonatal_service-dio4C_eg.js";import{D as Xe}from"./DemographicBar-DOcg-yqe.js";import{N as et}from"./NeonatalStepper-Cd4wQ2P-.js";import{I as de}from"./images-DFClaPJu.js";import{u as tt}from"./NeonatalEnrollmentStore-BRALa6tn.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-DxvGX8bh.js";import"./SaveProgressModal-Ae1xFUiF.js";const M=e=>e.map(h=>({value:h,label:h})),se=(e,h)=>Array.from({length:h-e+1},(n,p)=>{const a=(e+p).toString();return{value:a,label:a}}),at=["Stimulation","Suctioning","Oxygen","Bag Valve Mask Ventilation (BVM)","Cardio Pulmonary Resuscitation (CPR)","Unknown","None"],O=[{title:"Birth details",subtitle:"Capture the initial arrival information",formData:[{componentType:"radioButtonField",header:"Does the baby have a twin?",name:"hasTwin",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify whether the neonate has a twin"},{componentType:"multiSelectInputField",header:"Place of Birth",name:"placeOfBirth",placeholder:"Select type",icon:k.search,options:M(["Hospital","Health Center","Home","Other"]),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select the place of birth"},{componentType:"multiSelectInputField",header:"Name of Birth Facility",name:"birthFacility",placeholder:"Select facility",icon:k.search,options:[],trackBy:"name",searchable:!0,validation:e=>e!=null&&e.name||e?null:"Select a facility"},{componentType:"multiSelectInputField",header:"Type of Birth",name:"typeOfBirth",placeholder:"Select type",icon:k.search,options:M(["Singleton","Twin","Triplet"]),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select the type of birth"},{componentType:"inputField",header:"Birth weight (grams)",name:"birthWeight",type:"number",placeholder:"Enter weight",validation:e=>Number(e)>0?null:"Provide the birth weight"},{componentType:"timeInputField",header:"Time of birth",name:"birthTime",placeholder:"HH:mm",validation:e=>e?null:"Capture the time of birth"}]},{title:"Referral information",subtitle:"Document how the neonate arrived",description:"Required when the baby was referred from another facility.",formData:[{componentType:"radioButtonField",header:"Is the baby referred from another facility?",name:"referredFromAnotherFacility",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Indicate whether the neonate was referred"},{componentType:"multiSelectInputField",header:"Referred from",name:"referredFrom",placeholder:"Select referee type",icon:k.search,options:M(["District Hospital","Health Center","Private Clinic","Other"]),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select the referral source",condition:e=>e.referredFromAnotherFacility==="Yes"},{componentType:"multiSelectInputField",header:"Name of facility",name:"referringFacilityName",placeholder:"Search and select facility",icon:k.search,options:[],trackBy:"name",searchable:!0,validation:(e,h)=>(h==null?void 0:h.referredFromAnotherFacility)!=="Yes"||e!=null&&e.name||e?null:"Select the referring facility",condition:e=>e.referredFromAnotherFacility==="Yes"},{componentType:"multiSelectInputField",header:"Mode of transport",name:"modeOfTransport",placeholder:"Select mode",icon:k.search,options:M(["Ambulance","Private vehicle","Bicycle","Other"]),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select how the neonate arrived",condition:e=>e.referredFromAnotherFacility==="Yes"},{componentType:"multiSelectInputField",header:"Admitted from",name:"admittedFrom",placeholder:"Select origin",icon:k.search,options:M(["Clinic","Home","Maternity Ward","Other"]),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select where the baby was admitted from",condition:e=>e.referredFromAnotherFacility==="Yes"}]},{title:"Birth assessment",subtitle:"Capture the immediate clinical state",formData:[{componentType:"radioButtonField",header:"Did the baby cry straight after birth?",name:"criedAfterBirth",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Indicate whether the baby cried"},{componentType:"multiSelectInputField",header:"Apgar score at 1 minute",name:"apgar1",placeholder:"Select",icon:k.search,options:se(0,10),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select the Apgar score at 1 min"},{componentType:"multiSelectInputField",header:"Apgar score at 5 minutes",name:"apgar5",placeholder:"Select",icon:k.search,options:se(0,10),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select the Apgar score at 5 min"},{componentType:"multiSelectInputField",header:"Apgar score at 10 minutes",name:"apgar10",placeholder:"Select",icon:k.search,options:se(0,10),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select the Apgar score at 10 min"},{componentType:"multiSelectInputField",header:"Was resuscitation needed at birth?",name:"resuscitationMethods",placeholder:"Select the methods",icon:k.search,options:M(at),trackBy:"value",isMultiple:!0,closeOnSelect:!1,validation:e=>e&&e.length?null:"Select at least one method"}]},{title:"Mother's Information",subtitle:"Search and link the mother's record",description:"Find the mother's existing record or register a new mother if not found.",formData:[]},{title:"Pregnancy",subtitle:"Pregnancy and delivery history",formData:[{componentType:"inputField",header:"Gestation in weeks",name:"gestationWeeks",type:"number",placeholder:"Weeks",validation:e=>{const h=Number(e);return h>0&&h<=45?null:"Enter valid gestation weeks (1-45)"}},{componentType:"radioButtonField",header:"Were steroids given?",name:"steroidsGiven",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify whether steroids were given"},{componentType:"multiSelectInputField",header:"Gestation method assessment",name:"gestationMethodAssessment",placeholder:"Select method",icon:k.search,options:M(["LMP","Ultrasound","Clinical Assessment","Ballard Score"]),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select gestation assessment method"},{componentType:"radioButtonField",header:"Ultra sound scanning - USS",name:"ultraSoundScanning",options:[{label:"Early",value:"Early"},{label:"Late",value:"Late"}],validation:e=>e?null:"Select ultrasound timing"},{componentType:"timeInputField",header:"Onset of labor",name:"onsetOfLabor",placeholder:"HH:mm",validation:e=>e?null:"Enter onset of labor time"},{componentType:"radioButtonField",header:"Rupture of membranes?",name:"ruptureOfMembranes",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify rupture of membranes status"},{componentType:"radioButtonField",header:"Duration of Rupture of Membranes",name:"durationOfRuptureMembranes",options:[{label:"< 18 hours",value:"< 18 hours"},{label:"18 hours >",value:"18 hours >"}],validation:e=>e?null:"Select duration",condition:e=>e.ruptureOfMembranes==="Yes"},{componentType:"radioButtonField",header:"Offensive Liquor?",name:"offensiveLiquor",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify offensive liquor status"},{componentType:"multiSelectInputField",header:"Mode of Delivery",name:"modeOfDelivery",placeholder:"Select mode",icon:k.search,options:M(["Spontaneous Vaginal Delivery","Caesarean Section","Vacuum Extraction","Forceps Delivery","Breech Delivery"]),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select mode of delivery"},{componentType:"radioButtonField",header:"Meconium present?",name:"meconiumPresent",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify meconium presence"},{componentType:"radioButtonField",header:"Maternal Analgesia?",name:"maternalAnalgesia",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify maternal analgesia status"},{componentType:"multiSelectInputField",header:"Analgesia Drug",name:"analgesiasDrug",placeholder:"Select drug",icon:k.search,options:M(["Paracetamol","Pethidine","Morphine","Epidural","Other"]),trackBy:"value",validation:(e,h)=>(h==null?void 0:h.maternalAnalgesia)!=="Yes"||e!=null&&e.value||e?null:"Select analgesia drug",condition:e=>e.maternalAnalgesia==="Yes"},{componentType:"radioButtonField",header:"Anesthesia used?",name:"anesthesiaUsed",options:[{label:"General",value:"General"},{label:"Spinal",value:"Spinal"},{label:"No",value:"No"}],validation:e=>e?null:"Specify anesthesia used"},{componentType:"radioButtonField",header:"TEO?",name:"teo",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify TEO status"},{componentType:"radioButtonField",header:"Chlorohexidine of cord care?",name:"chlorohexidineCordCare",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify chlorohexidine cord care"},{componentType:"radioButtonField",header:"Vitamin K given?",name:"vitaminKGiven",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify Vitamin K status"},{componentType:"radioButtonField",header:"Dextrose 10% given?",name:"dextroseGiven",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify Dextrose 10% status"}]},{title:"Mother's enrollment details",subtitle:"HIV, VDRL, and Hepatitis status",formData:[{componentType:"radioButtonField",header:"Mother's status",name:"motherStatus",options:[{label:"Alive",value:"Alive"},{label:"Died",value:"Died"}],validation:e=>e?null:"Select mother's status"},{componentType:"multiSelectInputField",header:"HIV Status",name:"motherHivStatus",placeholder:"Select status",icon:k.search,options:M(["Reactive","Non-Reactive","Unknown"]),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select HIV status"},{componentType:"dateInputField",header:"Last HIV Test Date",name:"lastHivTestDate",placeholder:"Select date",validation:e=>e?null:"Select the last HIV test date"},{componentType:"radioButtonField",header:"Do a HIV re-test?",name:"doHivRetest",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify whether to do HIV re-test"},{componentType:"radioButtonField",header:"Who baby given NVP?",name:"babyGivenNvp",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify whether baby was given NVP"},{componentType:"multiSelectInputField",header:"Mother's VDRL/Syphilis result",name:"motherVdrlResult",placeholder:"Select result",icon:k.search,options:M(["Positive","Negative","Unknown"]),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select VDRL/Syphilis result"},{componentType:"radioButtonField",header:"Who mother treated for VDRL/Syphilis?",name:"motherTreatedForVdrl",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify whether mother was treated"},{componentType:"radioButtonField",header:"Was the baby tested for Hepatitis?",name:"babyTestedForHepatitis",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify whether baby was tested"},{componentType:"radioButtonField",header:"Were all 3 doses of the treatment completed?",name:"allThreeDosesCompleted",options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],validation:e=>e?null:"Specify whether all doses were completed"},{componentType:"multiSelectInputField",header:"Mother's Hepatitis result",name:"motherHepatitisResult",placeholder:"Select result",icon:k.search,options:M(["Positive","Negative","Unknown"]),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select Hepatitis result"}]},{title:"Known Medical Conditions",subtitle:"Tetanus vaccination history",formData:[{componentType:"multiSelectInputField",header:"Tetanus Diphtheria",name:"tetanusDiphtheria",placeholder:"Search and select",icon:k.search,options:M(["Td1","Td2","Td3","Td4","Td5","Unknown","None"]),trackBy:"value",validation:e=>e!=null&&e.value||e?null:"Select Tetanus Diphtheria status"}]}],ot={motherPatientId:void 0,motherName:void 0,motherNationalId:void 0,hasTwin:"",twinPatientId:void 0,twinName:void 0,placeOfBirth:"",nameOfBirthFacility:"",typeOfBirth:"",birthWeight:"",timeOfBirth:"",referredFromOtherFacility:"",referredFrom:"",referringFacilityName:"",modeOfTransport:"",admittedFrom:"",criedAfterBirth:"",apgarScoreAt1:"",apgarScoreAt5:"",apgarScoreAt10:"",resuscitationMethods:[],gestationWeeks:"",steroidsGiven:"",gestationMethodAssessment:"",ultraSoundScanning:"",onsetOfLabor:"",ruptureOfMembranes:"",durationOfRuptureMembranes:"",offensiveLiquor:"",modeOfDelivery:"",meconiumPresent:"",maternalAnalgesia:"",analgesiasDrug:"",anesthesiaUsed:"",teo:"",chlorohexidineCordCare:"",vitaminKGiven:"",dextroseGiven:"",motherStatus:"",motherHivStatus:"",lastHivTestDate:"",doHivRetest:"",babyGivenNvp:"",motherVdrlResult:"",motherTreatedForVdrl:"",babyTestedForHepatitis:"",allThreeDosesCompleted:"",motherHepatitisResult:"",tetanusDiphtheria:[]},z=Symbol("neonatal-enrollment-form"),nt={key:0,class:"twin-search-container"},rt={style:{border:"1px dotted #ececec","border-radius":"8px"}},it={class:"header-with-icon"},lt={class:"icon-wrapper"},st=["src"],ct={class:"search-with-button"},dt={class:"search-wrapper"},ut={key:0,class:"search-results"},mt={key:0,class:"search-loading"},pt={key:1,class:"results-list"},ht=["onClick"],ft={class:"result-header"},vt={class:"twin-name"},yt={class:"twin-mrn"},gt={class:"twin-dob"},_t={class:"result-details"},bt={key:0,class:"twin-gender"},St={key:2,class:"no-results"},Ft={key:1,class:"selected-twin"},Nt={class:"selected-card"},Dt={class:"selected-card-header"},wt={class:"header-content"},Tt={class:"selected-icon-wrapper"},It=["src"],kt={class:"selected-card-content"},Bt={class:"patient-info-grid"},Vt={class:"info-row"},Rt={class:"info-value"},At={class:"info-row"},$t={class:"info-value"},Ot={key:0,class:"info-row"},Pt={class:"info-value"},Ct={key:1,class:"info-row"},Mt={class:"info-value"},Yt=K({__name:"TwinSearch",setup(e,{expose:h}){const n=q(z),p=me(),a=D(""),y=D(!1),t=D([]),l=D(null),o=D(!1),i=ae(()=>(n==null?void 0:n.hasTwin)==="Yes"),F=async()=>{if(!a.value||a.value.trim().length<2){t.value=[];return}y.value=!0;try{const g=a.value.trim();if(/^\d+$/.test(g))try{const u=await p.getPatientData(Number(g));if(u&&u.personInformation){const _=u.personInformation;t.value=[{patientID:_.person_id,firstName:_.given_name||"",middleName:_.middle_name||"",lastName:_.family_name||"",gender:_.gender,birthdate:_.birthdate}]}else t.value=[]}catch(u){console.error("Error searching by MRN:",u),t.value=[]}else{const u=g.split(" "),_={given_name:u[0],family_name:u[1]||"",page:"1",per_page:"20"},P=await Ae.search(_);t.value=Array.isArray(P)?P.filter(R=>{const I=R.person;if(!I.birthdate)return!1;const W=new Date(I.birthdate);return Math.floor((Date.now()-W.getTime())/(1e3*60*60*24))<=7}).map(R=>{var c;const I=R.person,W=((c=I.names)==null?void 0:c[0])||{};return{patientID:I.person_id,firstName:W.given_name||"",middleName:W.middle_name||"",lastName:W.family_name||"",gender:I.gender,birthdate:I.birthdate}}):[]}}catch(g){console.error("Error searching for twin:",g),t.value=[]}finally{y.value=!1}},U=g=>{l.value=g,a.value="",o.value=!1,n&&(n.twinPatientId=g.patientID,n.twinName="".concat(g.firstName," ").concat(g.middleName||""," ").concat(g.lastName).trim())},C=()=>{l.value=null,o.value=!1,n&&(n.twinPatientId=void 0,n.twinName=void 0)},s=()=>{o.value=!0,l.value=null,a.value="",n&&(n.twinPatientId=void 0,n.twinName=void 0)};V(()=>n==null?void 0:n.hasTwin,g=>{g!=="Yes"&&(C(),o.value=!1)});const w=g=>"".concat(g.firstName," ").concat(g.middleName||""," ").concat(g.lastName).trim(),H=g=>g?new Date(g).toLocaleDateString():"";return h({validateForm:()=>(n==null?void 0:n.hasTwin)==="Yes"&&!l.value&&!o.value?{twinSelection:"Select the twin record or tap Skip if the twin is not yet registered"}:null,getFormValues:()=>l.value?{twinPatientId:l.value.patientID,twinName:w(l.value)}:{}}),(g,u)=>i.value?(v(),b("div",nt,[r("div",rt,[f(d(De),null,{default:T(()=>[r("div",it,[r("div",lt,[r("img",{src:d(de).icons.twins,alt:"Twin",class:"header-icon"},null,8,st),f(d(x),{icon:d(oe),class:"search-badge-icon"},null,8,["icon"])]),r("div",null,[f(d(we),null,{default:T(()=>[...u[1]||(u[1]=[$("Twin Information",-1)])]),_:1}),f(d(Te),null,{default:T(()=>[...u[2]||(u[2]=[$("Search for twin sibling",-1)])]),_:1})])])]),_:1}),f(d(Ie),null,{default:T(()=>[f(d(ke),{class:"info-note"},{default:T(()=>[...u[3]||(u[3]=[$(" This baby has a twin. Please search for the twin's record or register if not found. ",-1)])]),_:1}),r("div",ct,[r("div",dt,[f(d(Be),{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=_=>a.value=_),placeholder:"Search for twin's MRN or scan barcode",onIonInput:F,debounce:300,"show-clear-button":"focus",class:"search-input"},null,8,["modelValue"])]),f(d(Q),{color:"primary",onClick:s,class:"skip-btn"},{default:T(()=>[u[4]||(u[4]=$(" Skip ",-1)),f(d(x),{size:"small",icon:d(Ce),slot:"end"},null,8,["icon"])]),_:1})]),a.value&&a.value.length>0&&!l.value?(v(),b("div",ut,[y.value?(v(),b("div",mt,[(v(),b(ne,null,re(3,_=>r("div",{key:"skeleton-".concat(_),class:"result-item-skeleton"},[...u[5]||(u[5]=[r("div",{class:"skeleton-header"},[r("div",{class:"skeleton-name"}),r("div",{class:"skeleton-dob"})],-1)])])),64))])):t.value.length>0?(v(),b("div",pt,[(v(!0),b(ne,null,re(t.value,(_,P)=>(v(),b("div",{key:_.patientID||P,class:"result-item",onClick:R=>U(_)},[r("div",ft,[r("span",vt,S(w(_)),1),r("span",yt,"MRN: "+S(_.patientID),1),r("span",gt,"DOB: "+S(H(_.birthdate)),1)]),r("div",_t,[_.gender?(v(),b("p",bt,[u[6]||(u[6]=r("strong",null,"Gender:",-1)),$(" "+S(_.gender),1)])):Y("",!0)])],8,ht))),128))])):(v(),b("div",St,[f(d(x),{icon:d(oe),class:"no-results-icon"},null,8,["icon"]),r("p",null,'No patients found matching "'+S(a.value)+'"',1),u[7]||(u[7]=r("p",{class:"info-text"},"The twin may not be registered yet. You can skip this step and register the twin later.",-1))]))])):Y("",!0),l.value?(v(),b("div",Ft,[r("div",Nt,[r("div",Dt,[r("div",wt,[r("div",Tt,[r("img",{src:d(de).icons.twins,alt:"Twin",class:"selected-header-icon"},null,8,It)]),u[8]||(u[8]=r("div",{class:"header-separator"},null,-1)),u[9]||(u[9]=r("span",{class:"selected-subtitle"},"Twin Selected",-1))]),f(d(Q),{fill:"clear",size:"small",onClick:C,class:"clear-selection-btn"},{default:T(()=>[f(d(x),{icon:d(Ve)},null,8,["icon"])]),_:1})]),r("div",kt,[r("div",Bt,[r("div",Vt,[u[10]||(u[10]=r("span",{class:"info-label"},"Full Name",-1)),r("span",Rt,S(w(l.value)),1)]),r("div",At,[u[11]||(u[11]=r("span",{class:"info-label"},"MRN",-1)),r("span",$t,S(l.value.patientID),1)]),l.value.birthdate?(v(),b("div",Ot,[u[12]||(u[12]=r("span",{class:"info-label"},"Date of Birth",-1)),r("span",Pt,S(H(l.value.birthdate)),1)])):Y("",!0),l.value.gender?(v(),b("div",Ct,[u[13]||(u[13]=r("span",{class:"info-label"},"Gender",-1)),r("span",Mt,S(l.value.gender),1)])):Y("",!0)])])])])):Y("",!0)]),_:1})])])):Y("",!0)}}),Ht=ie(Yt,[["__scopeId","data-v-9ecea754"]]),B=e=>{var h,n,p;if(!(e==null||e==="")){if(typeof e=="string"||typeof e=="number")return e.toString();if(typeof e=="object"){const a=(p=(n=(h=e.label)!=null?h:e.value)!=null?n:e.name)!=null?p:e.title;if(a!=null&&a!=="")return a.toString()}}},Oe=e=>{if(!e)return[];if(Array.isArray(e))return e.map(n=>B(n)).filter(n=>!!n);const h=B(e);return h?[h]:[]},J=e=>e==null?"":e.toString(),xt={class:"birth-details-wrapper"},Et=K({__name:"BirthDetails",setup(e,{expose:h}){const n=D(null),p=D(null),a=D(null),y=O[0].formData,t=y.slice(0,1),l=y.slice(1),o=q(z),i=D([]);ue(async()=>{try{const s=await $e.getAllFacilities();Array.isArray(s)?i.value=s:s!=null&&s.facilities&&Array.isArray(s.facilities)?i.value=s.facilities:s!=null&&s.records&&Array.isArray(s.records)?i.value=s.records:i.value=[]}catch(s){console.error("Error loading facilities:",s),i.value=[]}});const F=ae(()=>l.map(s=>s.name==="birthFacility"?{...s,options:i.value.map(w=>{const H=w.name||w.facility_name||"Unknown";return{name:H,label:H,value:w.id||w.facility_id||H,code:w.code||w.facility_code,district:w.district||w.district_name}})}:s)),U=s=>{o&&(o.hasTwin=s.hasTwin||"")},C=s=>{o&&(o.placeOfBirth=B(s.placeOfBirth)||"",o.nameOfBirthFacility=B(s.birthFacility)||"",o.typeOfBirth=B(s.typeOfBirth)||"",o.birthWeight=J(s.birthWeight||""),o.timeOfBirth=J(s.birthTime||""))};return V(()=>{var s;return(s=p.value)==null?void 0:s.formValues},s=>{s&&C(s)},{deep:!0}),V(()=>p.value,s=>{s!=null&&s.getFormValues&&C(s.getFormValues())},{immediate:!0}),V(()=>{var s;return(s=n.value)==null?void 0:s.formValues},s=>{s&&U(s)},{deep:!0}),V(()=>n.value,s=>{s!=null&&s.getFormValues&&U(s.getFormValues())},{immediate:!0}),h({getFormRef:()=>p.value,getTwinQuestionFormRef:()=>n.value,validateForm:()=>{var u,_,P,R,I,W;const s=((_=(u=n.value)==null?void 0:u.validateForm)==null?void 0:_.call(u))||null,w=((R=(P=p.value)==null?void 0:P.validateForm)==null?void 0:R.call(P))||null,H=((W=(I=a.value)==null?void 0:I.validateForm)==null?void 0:W.call(I))||null,g=[s,w,H].filter(Boolean);return g.length?g.reduce((c,m)=>({...c,...m}),{}):null},getFormValues:()=>{var g,u,_,P,R,I;const s=((u=(g=n.value)==null?void 0:g.getFormValues)==null?void 0:u.call(g))||{},w=((P=(_=p.value)==null?void 0:_.getFormValues)==null?void 0:P.call(_))||{},H=((I=(R=a.value)==null?void 0:R.getFormValues)==null?void 0:I.call(R))||{};return{...s,...w,...H}}}),(s,w)=>(v(),b("div",xt,[f(j,{formData:d(t),ref_key:"twinQuestionFormRef",ref:n,class:"twin-question-form"},null,8,["formData"]),f(Ht,{ref_key:"twinSearchRef",ref:a},null,512),f(j,{formData:F.value,ref_key:"formRef",ref:p,class:"main-form"},null,8,["formData"])]))}}),ye=ie(Et,[["__scopeId","data-v-9a714757"]]),ge=K({__name:"ReferralInformation",setup(e,{expose:h}){const n=D(null),p=O[1].formData,a=q(z),y=D([]);ue(async()=>{try{const o=await $e.getAllFacilities();Array.isArray(o)?y.value=o:o!=null&&o.facilities&&Array.isArray(o.facilities)?y.value=o.facilities:o!=null&&o.records&&Array.isArray(o.records)?y.value=o.records:y.value=[]}catch(o){console.error("Error loading facilities:",o),y.value=[]}});const t=ae(()=>p.map(o=>o.name==="referringFacilityName"?{...o,options:y.value.map(i=>({name:i.name||i.facility_name||"Unknown",code:i.code||i.facility_code,district:i.district}))}:o)),l=o=>{if(!a)return;a.referredFromOtherFacility=o.referredFromAnotherFacility||"",a.referredFrom=B(o.referredFrom)||"";const i=o.referringFacilityName;a.referringFacilityName=(i==null?void 0:i.name)||J(i||""),a.modeOfTransport=B(o.modeOfTransport)||"",a.admittedFrom=B(o.admittedFrom)||""};return V(()=>{var o;return(o=n.value)==null?void 0:o.formValues},o=>{o&&l(o)},{deep:!0}),V(()=>n.value,o=>{o!=null&&o.getFormValues&&l(o.getFormValues())},{immediate:!0}),h({getFormRef:()=>n.value,validateForm:()=>{var o,i;return((i=(o=n.value)==null?void 0:o.validateForm)==null?void 0:i.call(o))||null},getFormValues:()=>{var o,i;return((i=(o=n.value)==null?void 0:o.getFormValues)==null?void 0:i.call(o))||{}}}),(o,i)=>(v(),Z(j,{formData:t.value,ref_key:"formRef",ref:n},null,8,["formData"]))}}),_e=K({__name:"BirthAssessment",setup(e,{expose:h}){const n=D(null),p=O[2].formData,a=q(z),y=t=>{a&&(a.criedAfterBirth=t.criedAfterBirth||"",a.apgarScoreAt1=B(t.apgar1)||"",a.apgarScoreAt5=B(t.apgar5)||"",a.apgarScoreAt10=B(t.apgar10)||"",a.resuscitationMethods=Oe(t.resuscitationMethods))};return V(()=>{var t;return(t=n.value)==null?void 0:t.formValues},t=>{t&&y(t)},{deep:!0}),V(()=>n.value,t=>{t!=null&&t.getFormValues&&y(t.getFormValues())},{immediate:!0}),h({getFormRef:()=>n.value,validateForm:()=>{var t,l;return((l=(t=n.value)==null?void 0:t.validateForm)==null?void 0:l.call(t))||null},getFormValues:()=>{var t,l;return((l=(t=n.value)==null?void 0:t.getFormValues)==null?void 0:l.call(t))||{}}}),(t,l)=>(v(),Z(j,{formData:d(p),ref_key:"formRef",ref:n},null,8,["formData"]))}}),Gt={class:"mother-search-container"},Lt={style:{border:"1px dotted #ececec","border-radius":"8px"}},Ut={class:"header-with-icon"},Wt={class:"icon-wrapper"},qt=["src"],Kt={class:"search-with-button"},zt={class:"search-wrapper"},Qt={class:"barcode-btn","aria-label":"Scan MRN"},jt={key:0,class:"search-results"},Jt={key:0,class:"search-loading"},Zt={key:1,class:"results-list"},Xt=["onClick"],ea={class:"result-header"},ta={class:"mother-name"},aa={class:"mother-dob"},oa={class:"mother-gender"},na={class:"result-details"},ra={key:0,class:"mother-address"},ia={key:1,class:"mother-phone"},la={key:0,class:"pagination"},sa={class:"page-info"},ca={key:2,class:"no-results"},da={key:1,class:"selected-mother"},ua={class:"selected-card"},ma={class:"selected-card-header"},pa={class:"selected-header-with-button"},ha={class:"selected-card-content"},fa={class:"selected-info"},va={key:0},ya={key:1},ce=10,ga=K({__name:"MotherSearch",setup(e,{expose:h}){const n=Re(),p=q(z),a=tt(),y=me(),t=D(""),l=D(!1),o=D([]),i=D(null),F=D(1);ue(async()=>{const c=a.getMotherPatientId;c&&a.shouldReturnToEnrollment&&(await U(c),a.clearEnrollmentContext())}),V(i,c=>{c&&p&&(p.motherPatientId=c.patientID,p.motherName="".concat(c.firstName," ").concat(c.middleName||""," ").concat(c.lastName).trim(),p.motherNationalId=c.nationalId||"")});const U=async c=>{var m,N;try{l.value=!0;const E=await y.getPatientData(c);if(E&&E.personInformation){const A=E.personInformation,G=((m=A.addresses)==null?void 0:m[0])||{},L=(N=A.person_attributes)==null?void 0:N.find(X=>{var ee;return((ee=X.person_attribute_type)==null?void 0:ee.name)==="Cell Phone Number"}),le={patientID:A.person_id||c,firstName:A.given_name||"",middleName:A.middle_name||"",lastName:A.family_name||"",gender:A.gender,birthdate:A.birthdate,nationalId:E.national_id||"",address:G,phone:(L==null?void 0:L.value)||""};i.value=le}}catch(E){console.error("Error fetching mother data:",E)}finally{l.value=!1}},C=ae(()=>Math.ceil(o.value.length/ce)),s=ae(()=>{const c=(F.value-1)*ce,m=c+ce;return o.value.slice(c,m)}),w=async()=>{if(!t.value||t.value.trim().length<2){o.value=[];return}l.value=!0,F.value=1;try{const m=t.value.trim().split(" "),N={given_name:m[0],family_name:m[1]||"",page:"1",per_page:"50"},E=await Ae.search(N);o.value=Array.isArray(E)?E.filter(A=>{var L;const G=((L=A.person)==null?void 0:L.gender)||A.gender;return G==="F"||G==="Female"}).map(A=>{var ee,pe,he;const G=A.person,L=((ee=G.names)==null?void 0:ee[0])||{},le=((pe=G.addresses)==null?void 0:pe[0])||{},X=(he=G.person_attributes)==null?void 0:he.find(Pe=>{var fe;return((fe=Pe.person_attribute_type)==null?void 0:fe.name)==="Cell Phone Number"});return{patientID:G.person_id,firstName:L.given_name||"",middleName:L.middle_name||"",lastName:L.family_name||"",gender:G.gender,birthdate:G.birthdate,nationalId:A.national_id||"",address:le,phone:(X==null?void 0:X.value)||""}}):[]}catch(c){console.error("Error searching for mothers:",c),o.value=[]}finally{l.value=!1}},H=c=>{i.value=c,t.value="",p&&(p.motherPatientId=c.patientID,p.motherName="".concat(c.firstName," ").concat(c.middleName||""," ").concat(c.lastName).trim(),p.motherNationalId=c.nationalId||"")},g=()=>{i.value=null,p&&(p.motherPatientId=void 0,p.motherName=void 0,p.motherNationalId=void 0)},u=()=>{var m;const c=q("patient");c&&((m=c.value)!=null&&m.patientID)&&a.setMotherCreationContext(c.value.patientID,4),n.push({path:"/registration/manual",query:{returnTo:"/neonatal/enrollment",context:"neonatal-mother"}})},_=()=>{F.value<C.value&&F.value++},P=()=>{F.value>1&&F.value--},R=c=>c?new Date(c).toLocaleDateString():"",I=c=>{if(!c)return"";if(typeof c=="string")return c;const m=[];return c.city_village&&m.push(c.city_village),c.township_division&&m.push(c.township_division),c.state_province&&m.push(c.state_province),m.join(", ")};return h({getFormRef:()=>({validate:()=>i.value!==null,getFormData:()=>{var c,m;return{motherPatientId:(c=i.value)==null?void 0:c.patientID,motherName:i.value?"".concat(i.value.firstName," ").concat(i.value.middleName||""," ").concat(i.value.lastName).trim():void 0,motherNationalId:(m=i.value)==null?void 0:m.nationalId}}}),validateForm:()=>i.value?null:{motherSelection:"Please select a mother or register a new one"},getFormValues:()=>i.value?{motherPatientId:i.value.patientID,motherName:"".concat(i.value.firstName," ").concat(i.value.middleName||""," ").concat(i.value.lastName).trim(),motherNationalId:i.value.nationalId}:{}}),(c,m)=>(v(),b("div",Gt,[r("div",Lt,[f(d(De),null,{default:T(()=>[r("div",Ut,[r("div",Wt,[r("img",{src:d(de).icons.care,alt:"Care",class:"header-icon"},null,8,qt),f(d(x),{icon:d(oe),class:"search-badge-icon"},null,8,["icon"])]),r("div",null,[f(d(we),null,{default:T(()=>[...m[1]||(m[1]=[$("Search for Mother",-1)])]),_:1}),f(d(Te),null,{default:T(()=>[...m[2]||(m[2]=[$("Find mother's existing record",-1)])]),_:1})])])]),_:1}),f(d(Ie),null,{default:T(()=>[f(d(ke),{class:"info-note"},{default:T(()=>[...m[3]||(m[3]=[$(" We now need to link this neonate's record to it's mother, please search and find the mother or register if mother not found. ",-1)])]),_:1}),r("div",Kt,[r("div",zt,[f(d(Be),{modelValue:t.value,"onUpdate:modelValue":m[0]||(m[0]=N=>t.value=N),placeholder:"Search for mother's Name or scan MRN",onIonInput:w,debounce:300,"show-clear-button":"focus",class:"search-input"},null,8,["modelValue"]),r("div",Qt,[f(d(x),{color:"primary",size:"small",icon:d(Me),slot:"icon-only"},null,8,["icon"])])]),f(d(Q),{color:"success",onClick:u,class:"new-registration-btn"},{default:T(()=>[f(d(x),{icon:d(Ye),slot:"icon-only"},null,8,["icon"]),m[4]||(m[4]=$("New Registration ",-1))]),_:1})]),t.value&&t.value.length>0&&!i.value?(v(),b("div",jt,[l.value?(v(),b("div",Jt,[(v(),b(ne,null,re(3,N=>r("div",{key:"skeleton-".concat(N),class:"result-item-skeleton"},[...m[5]||(m[5]=[r("div",{class:"skeleton-header"},[r("div",{class:"skeleton-name"}),r("div",{class:"skeleton-dob"}),r("div",{class:"skeleton-gender"})],-1),r("div",{class:"skeleton-details"},[r("div",{class:"skeleton-address"}),r("div",{class:"skeleton-phone"})],-1)])])),64))])):o.value.length>0?(v(),b("div",Zt,[(v(!0),b(ne,null,re(s.value,(N,E)=>(v(),b("div",{key:N.patientID||E,class:"result-item",onClick:A=>H(N)},[r("div",ea,[r("span",ta,S(N.firstName)+" "+S(N.middleName?N.middleName+" ":"")+S(N.lastName),1),r("span",aa,"DOB "+S(R(N.birthdate)),1),r("span",oa,S(N.gender==="F"?"Female":N.gender),1)]),r("div",na,[N.address?(v(),b("p",ra,[m[6]||(m[6]=r("strong",null,"Current Address:",-1)),$(" "+S(I(N.address)),1)])):Y("",!0),N.phone?(v(),b("p",ia,[f(d(x),{icon:d(He)},null,8,["icon"]),$(" "+S(N.phone),1)])):Y("",!0)])],8,Xt))),128)),C.value>1?(v(),b("div",la,[f(d(Q),{fill:"outline",size:"small",onClick:P,disabled:F.value===1},{default:T(()=>[f(d(x),{icon:d(xe)},null,8,["icon"])]),_:1},8,["disabled"]),r("span",sa,"Page "+S(F.value)+" of "+S(C.value),1),f(d(Q),{fill:"outline",size:"small",onClick:_,disabled:F.value===C.value},{default:T(()=>[f(d(x),{icon:d(Ee)},null,8,["icon"])]),_:1},8,["disabled"])])):Y("",!0)])):(v(),b("div",ca,[f(d(x),{icon:d(oe),class:"no-results-icon"},null,8,["icon"]),r("p",null,'No mothers found matching "'+S(t.value)+'"',1),f(d(Q),{expand:"block",onClick:u},{default:T(()=>[...m[7]||(m[7]=[$("Register new mother",-1)])]),_:1})]))])):Y("",!0),i.value?(v(),b("div",da,[r("div",ua,[r("div",ma,[r("div",pa,[m[8]||(m[8]=r("span",{class:"selected-subtitle"},"Selected Mother",-1)),f(d(Q),{fill:"clear",size:"small",color:"danger",onClick:g,class:"clear-selection-btn"},{default:T(()=>[f(d(x),{icon:d(Ve),slot:"icon-only"},null,8,["icon"])]),_:1})])]),r("div",ha,[r("div",fa,[r("h3",null,S(i.value.firstName)+" "+S(i.value.middleName?i.value.middleName+" ":"")+S(i.value.lastName),1),r("p",null,[m[9]||(m[9]=r("strong",null,"MRN:",-1)),$(" "+S(i.value.patientID),1)]),i.value.birthdate?(v(),b("p",va,[m[10]||(m[10]=r("strong",null,"DOB:",-1)),$(" "+S(R(i.value.birthdate)),1)])):Y("",!0),i.value.address?(v(),b("p",ya,[m[11]||(m[11]=r("strong",null,"Address:",-1)),$(" "+S(I(i.value.address)),1)])):Y("",!0)])])])])):Y("",!0)]),_:1})])]))}}),be=ie(ga,[["__scopeId","data-v-0beac54f"]]),Se=K({__name:"Pregnancy",setup(e,{expose:h}){const n=D(null),p=O[4].formData,a=q(z),y=t=>{a&&(a.gestationWeeks=J(t.gestationWeeks||""),a.steroidsGiven=t.steroidsGiven||"",a.gestationMethodAssessment=B(t.gestationMethodAssessment)||"",a.ultraSoundScanning=t.ultraSoundScanning||"",a.onsetOfLabor=J(t.onsetOfLabor||""),a.ruptureOfMembranes=t.ruptureOfMembranes||"",a.durationOfRuptureMembranes=B(t.durationOfRuptureMembranes)||"",a.offensiveLiquor=t.offensiveLiquor||"",a.modeOfDelivery=B(t.modeOfDelivery)||"",a.meconiumPresent=t.meconiumPresent||"",a.maternalAnalgesia=t.maternalAnalgesia||"",a.analgesiasDrug=B(t.analgesiasDrug)||"",a.anesthesiaUsed=t.anesthesiaUsed||"",a.teo=t.teo||"",a.chlorohexidineCordCare=t.chlorohexidineCordCare||"",a.vitaminKGiven=t.vitaminKGiven||"",a.dextroseGiven=t.dextroseGiven||"")};return V(()=>{var t;return(t=n.value)==null?void 0:t.formValues},t=>{t&&y(t)},{deep:!0}),V(()=>n.value,t=>{t!=null&&t.getFormValues&&y(t.getFormValues())},{immediate:!0}),h({getFormRef:()=>n.value,validateForm:()=>{var t,l;return((l=(t=n.value)==null?void 0:t.validateForm)==null?void 0:l.call(t))||null},getFormValues:()=>{var t,l;return((l=(t=n.value)==null?void 0:t.getFormValues)==null?void 0:l.call(t))||{}}}),(t,l)=>(v(),Z(j,{formData:d(p),ref_key:"formRef",ref:n},null,8,["formData"]))}}),Fe=K({__name:"MotherEnrollmentDetails",setup(e,{expose:h}){const n=D(null),p=O[5].formData,a=q(z),y=t=>{a&&(a.motherStatus=t.motherStatus||"",a.motherHivStatus=B(t.motherHivStatus)||"",a.lastHivTestDate=J(t.lastHivTestDate||""),a.doHivRetest=t.doHivRetest||"",a.babyGivenNvp=t.babyGivenNvp||"",a.motherVdrlResult=B(t.motherVdrlResult)||"",a.motherTreatedForVdrl=t.motherTreatedForVdrl||"",a.babyTestedForHepatitis=t.babyTestedForHepatitis||"",a.allThreeDosesCompleted=t.allThreeDosesCompleted||"",a.motherHepatitisResult=B(t.motherHepatitisResult)||"")};return V(()=>{var t;return(t=n.value)==null?void 0:t.formValues},t=>{t&&y(t)},{deep:!0}),V(()=>n.value,t=>{t!=null&&t.getFormValues&&y(t.getFormValues())},{immediate:!0}),h({getFormRef:()=>n.value,validateForm:()=>{var t,l;return((l=(t=n.value)==null?void 0:t.validateForm)==null?void 0:l.call(t))||null},getFormValues:()=>{var t,l;return((l=(t=n.value)==null?void 0:t.getFormValues)==null?void 0:l.call(t))||{}}}),(t,l)=>(v(),Z(j,{formData:d(p),ref_key:"formRef",ref:n},null,8,["formData"]))}}),Ne=K({__name:"KnownMedicalConditions",setup(e,{expose:h}){const n=D(null),p=O[6].formData,a=q(z),y=t=>{a&&(a.tetanusDiphtheria=Oe(t.tetanusDiphtheria))};return V(()=>{var t;return(t=n.value)==null?void 0:t.formValues},t=>{t&&y(t)},{deep:!0}),V(()=>n.value,t=>{t!=null&&t.getFormValues&&y(t.getFormValues())},{immediate:!0}),h({getFormRef:()=>n.value,validateForm:()=>{var t,l;return((l=(t=n.value)==null?void 0:t.validateForm)==null?void 0:l.call(t))||null},getFormValues:()=>{var t,l;return((l=(t=n.value)==null?void 0:t.getFormValues)==null?void 0:l.call(t))||{}}}),(t,l)=>(v(),Z(j,{formData:d(p),ref_key:"formRef",ref:n},null,8,["formData"]))}}),_a=K({name:"NeonatalEnrollment",components:{IonPage:Le,IonContent:Ge,Toolbar:Ke,DemographicBar:Xe,NeonatalStepper:et,BirthDetails:ye,ReferralInformation:ge,BirthAssessment:_e,MotherSearch:be,Pregnancy:Se,MotherEnrollmentDetails:Fe,KnownMedicalConditions:Ne},setup(){const e=Re(),h=me(),{patient:n}=Ue(h),p=We({...ot});qe(z,p);const a=D(O.map((o,i)=>({title:o.title,number:i+1,checked:!1,class:i===0?"open_step common_step":"common_step",last_step:i===O.length-1?"last_step":""}))),y=[{title:O[0].title,value:"1",component:ye},{title:O[1].title,value:"2",component:ge},{title:O[2].title,value:"3",component:_e},{title:O[3].title,value:"4",component:be},{title:O[4].title,value:"5",component:Se},{title:O[5].title,value:"6",component:Fe},{title:O[6].title,value:"7",component:Ne}];return{router:e,patient:n,enrollmentFormData:p,stepperTitle:"Neonatal enrollment",currentOpenStepper:"1",wizardData:a,stepperData:y,updateStatus:o=>{o&&o.value&&a.value.forEach((i,F)=>{o.value===(F+1).toString()?(i.class="open_step common_step",i.checked=!1):F<parseInt(o.value)-1?(i.class="common_step color_white",i.checked=!0):(i.class="common_step",i.checked=!1)})},getSaveFunction:o=>o===y.length-1?async()=>{var i;if((i=n.value)!=null&&i.patientID)try{if(p.motherPatientId)try{const U=(await ve.getRelations()).find(C=>C.b_is_to_a==="Mother"||C.b_is_to_a==="Parent");U&&await ve.createRelation(n.value.patientID,p.motherPatientId,U.relationship_type_id)}catch(F){console.error("Failed to create mother-baby relationship",F)}await Ze.enrollNeonate(n.value.patientID,p,ze.sessionDate()),await Qe.userProgramData(n.value.patientID),je("Neonate enrolled successfully"),e.push("/neonatal/triage")}catch(F){console.error("Neonatal enrollment failed",F),Je("Unable to enroll neonate at this time")}}:()=>{}}}});function ba(e,h,n,p,a,y){const t=te("Toolbar"),l=te("DemographicBar"),o=te("NeonatalStepper"),i=te("ion-content"),F=te("ion-page");return v(),Z(F,{class:"neonatal-enrollment-page"},{default:T(()=>[f(t),f(i,{fullscreen:!0},{default:T(()=>[f(l),f(o,{wizardData:e.wizardData,StepperData:e.stepperData,stepperTitle:e.stepperTitle,openStepper:e.currentOpenStepper,backUrl:"/patientProfile",getSaveFunction:e.getSaveFunction,onUpdateStatus:e.updateStatus},null,8,["wizardData","StepperData","stepperTitle","openStepper","getSaveFunction","onUpdateStatus"])]),_:1})]),_:1})}const Ra=ie(_a,[["render",ba],["__scopeId","data-v-1e8dda56"]]);export{Ra as default};

System.register(["./vendor-legacy-Bsps4SCm.js","../index-legacy-ClOtzPja.js","./useNetworkConfig-legacy-CiWb3UOh.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-DDz6mLj4.js"],function(e,a){"use strict";var o,t,n,r,i,l,c,s,d,u,f,g,p,v,b,m,h,x,y,w,C,k,_,S,P,z,T,D,F,N,U,$,j,A,I,B,O,q,E;return{setters:[e=>{o=e.d,t=e.aV,n=e.c,r=e.r,i=e.a,l=e.O,c=e.f,s=e.J,d=e.e,u=e.m,f=e.l,g=e.k,p=e.u,v=e.bx,b=e.a3,m=e.bq,h=e.p,x=e.L,y=e.cl,w=e.K,C=e.cj,k=e.a4,_=e.a5,S=e.Q,P=e.ck,z=e.N,T=e.ed,D=e.a6,F=e.U},e=>{N=e.a1,U=e.aB,$=e.aC,j=e.T,A=e.aD,I=e.G,B=e.s,O=e.S,q=e._},e=>{E=e.u},null,null],execute:function(){var a=document.createElement("style");a.textContent=".spinner-overlay[data-v-5ac84414]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999}.loading-text[data-v-5ac84414]{color:#fff;margin-top:16px;font-size:1.1rem}.positionCenter[data-v-5ac84414]{width:100%;margin-top:20px;display:flex;justify-content:center;align-items:center}.registration_ion_card[data-v-5ac84414]{width:100%;max-width:1000px}.card_content[data-v-5ac84414]{padding:0}.card_header_main[data-v-5ac84414]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;flex-wrap:wrap;gap:12px}.card_hearder[data-v-5ac84414]{font-weight:700;font-size:24px;margin:0 0 12px;color:#2c3e50}.config-source-badge[data-v-5ac84414]{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:20px;font-size:.85rem;font-weight:600}.config-source-badge.source-global[data-v-5ac84414]{background:#e3f2fd;color:#1976d2}.config-source-badge.source-local[data-v-5ac84414]{background:#fff3e0;color:#f57c00}.super-user-badge[data-v-5ac84414]{display:flex;align-items:center;gap:6px;padding:8px 16px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:20px;font-weight:600;font-size:.9rem}.info-banner[data-v-5ac84414]{display:flex;align-items:flex-start;gap:12px;padding:16px;border-radius:12px;margin-bottom:20px}.info-banner.success[data-v-5ac84414]{background:#e8f5e8;color:#2e7d32;border-left:4px solid #4caf50}.info-banner.warning[data-v-5ac84414]{background:#fff3e0;color:#ef6c00;border-left:4px solid #ff9800}.info-banner ion-icon[data-v-5ac84414]{font-size:1.5rem;flex-shrink:0;margin-top:2px}.info-banner strong[data-v-5ac84414]{display:block;margin-bottom:4px;font-size:1rem}.info-banner p[data-v-5ac84414]{margin:0;font-size:.9rem;line-height:1.5}.card-header[data-v-5ac84414]{margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid #f5f5f5}.card-header p[data-v-5ac84414]{margin:0;color:#6c757d;font-size:.95rem}.connection-status-section[data-v-5ac84414]{margin:20px 0}.connection-result[data-v-5ac84414]{padding:16px;border-radius:8px;border:1px solid}.connection-result.available[data-v-5ac84414]{background:#e8f5e8;border-color:#4caf50;color:#2e7d32}.connection-result.error[data-v-5ac84414]{background:#ffebee;border-color:#f44336;color:#c62828}.status-indicator[data-v-5ac84414]{display:flex;align-items:center;gap:8px;font-weight:600;margin-bottom:4px}.status-indicator ion-icon[data-v-5ac84414]{font-size:1.2rem}.timestamp[data-v-5ac84414]{font-size:.9rem;color:#6c757d;font-weight:500}.action-buttons[data-v-5ac84414]{display:flex;flex-direction:column;gap:12px;margin-top:24px}.action-buttons ion-button[data-v-5ac84414]{height:48px;font-weight:600;text-transform:none}.primary-btn[data-v-5ac84414]{--background: #42b983}.secondary-btn[data-v-5ac84414]{--border-color: #42b983;--color: #42b983}.super-user-btn[data-v-5ac84414]{--background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)}.help-text[data-v-5ac84414]{display:flex;align-items:flex-start;gap:10px;margin-top:16px;padding:12px;background:#f8f9fa;border-radius:8px;border-left:3px solid #667eea}.help-text ion-icon[data-v-5ac84414]{color:#667eea;font-size:1.2rem;flex-shrink:0;margin-top:2px}.help-text p[data-v-5ac84414]{margin:0;font-size:.9rem;color:#495057;line-height:1.5}@media(max-width:768px){.action-buttons[data-v-5ac84414]{flex-direction:column}.card_content[data-v-5ac84414]{padding:10px}.card_header_main[data-v-5ac84414]{flex-direction:column;align-items:flex-start}}\n/*$vite$:1*/",document.head.appendChild(a);const H={key:0,class:"spinner-overlay"},L={class:"positionCenter"},J={class:"card_content"},G={class:"card_header_main"},R={key:0,class:"connection-status-section"},V={class:"status-indicator"},K={key:0,class:"timestamp"},Q={class:"action-buttons"},W={key:0,style:{"font-size":"0.8rem","margin-left":"8px"}},Y={class:"help-text"},M="network_last_test_result";e("default",q(o({__name:"OfflineNetworkConfigurations",setup(e){const a=N(),{config:o,isConfigured:q}=t(a),X=n(()=>o.value.configSource),Z=r(!1),ee=r(!1),ae=r(null),oe=r(null);r(!0);const te=r(null),ne=r("none"),re=E(),{formRef:ie,getFormValues:le}=U();n(()=>a.config);const ce=n(()=>[{componentType:"inputField",header:"Username",name:"couchdbUsername",value:o.value.couchdbUsername,validation:$.required,grid:{s:"6"}},{componentType:"inputField",header:"Password",name:"couchdbPassword",type:"password",value:o.value.couchdbPassword,validation:$.required,grid:{s:"6"}},{componentType:"inputField",header:"IP Address",name:"couchdbHost",value:o.value.couchdbHost,validation:$.required,grid:{s:"6"}},{componentType:"inputField",header:"Port Number",name:"couchdbPort",value:o.value.couchdbPort,validation:$.required,grid:{s:"6"}},{componentType:"Heading",name:"Protocol",grid:{s:"4"}},{componentType:"radioButtonField",name:"couchdbProtocol",validation:$.required,type:"inline",grid:{s:"6"},value:o.value.couchdbProtocol,options:[{label:"https",value:"https"},{label:"http",value:"http"}]}]),se=n(()=>{const e=X.value||ne.value;return"global_property"===e?"source-global":"local_storage"===e?"source-local":""}),de=n(()=>{const e=X.value||ne.value;return"global_property"===e?"Using Facility Default Configuration":"local_storage"===e?"Using Local Configuration":"No Configuration"}),ue=n(()=>te.value?te.value.success?"global_property"===te.value.source?"Configuration loaded from facility settings. You can use these settings or modify them.":"Configuration loaded from your local storage.":"Please configure your network settings below.":""),fe=async()=>{ee.value=!0,ae.value=null,oe.value=null;try{const e=le(),{couchdbUsername:a,couchdbPassword:o,couchdbHost:t,couchdbPort:n,couchdbProtocol:r}=e;if(!(a&&o&&t&&r))throw new Error("Please fill in all required fields");const i=a.trim(),l=o.trim(),c=t.trim(),s=r.trim(),d=btoa(`${i}:${l}`),u=`${s}://${c}${n?`:${n}`:""}`;console.log("Testing connection to:",u);const f=await fetch(`${u}/`,{method:"GET",headers:{Authorization:`Basic ${d}`,"Content-Type":"application/json"},signal:AbortSignal.timeout(1e4)});if(!f.ok){let e="Connection failed";switch(f.status){case 401:e="Authentication failed - Invalid username or password";break;case 403:e="Access forbidden - Check user permissions";break;case 404:e="CouchDB server not found at this address";break;case 500:e="CouchDB server error";break;default:e=`Connection failed with status: ${f.status}`}throw new Error(e)}{const e=await f.json();if("Welcome"!==e.couchdb)throw new Error("Server responded but is not CouchDB");ae.value="available",oe.value=(new Date).toLocaleString(),localStorage.setItem(M,JSON.stringify({status:"available",timestamp:oe.value,version:e.version})),I(`Connected successfully! CouchDB version: ${e.version}`,3e3)}}catch(e){console.error("Connection test failed:",e),ae.value="error",oe.value=(new Date).toLocaleString(),localStorage.setItem(M,JSON.stringify({status:"error",timestamp:oe.value,error:e.message})),"AbortError"===e.name||"TimeoutError"===e.name?B("Connection timeout - Check your network and server address",5e3):e.message.includes("fetch")?B("Network error - Cannot reach the server",5e3):B(e.message,5e3)}finally{ee.value=!1}},ge=async()=>{const e=await F.create({header:"Save as Facility Default",message:"This will save the configuration for all users at this facility. Other users will automatically use these settings when they log in. Continue?",buttons:[{text:"Cancel",role:"cancel"},{text:"Save for All Users",handler:async()=>{Z.value=!0;try{const e=le(),o={couchdbUsername:e.couchdbUsername,couchdbPassword:e.couchdbPassword,couchdbHost:e.couchdbHost,couchdbPort:e.couchdbPort||"",couchdbProtocol:e.couchdbProtocol,locationId:O.getUserLocationId(),facilityName:"",configuredBy:O.getUserName(),configuredAt:(new Date).toISOString(),configSource:"global_property"};await re.saveAsGlobalProperty(o)&&(a.setConfig(o),ne.value="global_property")}catch(e){console.error("Save error:",e),B("Failed to save facility configuration",3e3)}finally{Z.value=!1}}}]});await e.present()};return i(async()=>{if((()=>{const e=localStorage.getItem(M);if(e)try{const a=JSON.parse(e);ae.value=a.status,oe.value=a.timestamp}catch(a){console.error("Failed to parse last test result:",a)}})(),a.isConfigured)return console.log("Configuration already in store"),ne.value=X.value||"local_storage",void(te.value={success:!0,source:X.value});const e=await re.autoDiscoverConfig();te.value=e,e.success&&e.config?(a.setConfig({...e.config,configSource:e.source}),ne.value=e.source):ne.value=re.getConfigSource()}),(e,a)=>(c(),l(p(D),{class:h({loading:Z.value})},{default:s(()=>[Z.value?(c(),d("div",H,[f(p(v),{name:"bubbles"}),a[0]||(a[0]=g("div",{class:"loading-text"},"Please wait...",-1))])):u("",!0),f(j),f(p(b),{fullscreen:!0},{default:s(()=>[g("div",L,[f(p(m),{class:"registration_ion_card"},{default:s(()=>[g("div",J,[g("div",G,[g("div",null,[a[1]||(a[1]=g("h2",{class:"card_hearder"},"Set Offline Network Configurations",-1)),"none"!==ne.value?(c(),d("div",{key:0,class:h(["config-source-badge",se.value])},[f(p(x),{icon:p(y)},null,8,["icon"]),g("span",null,w(de.value),1)],2)):u("",!0)])]),te.value?(c(),d("div",{key:0,class:h(["info-banner",te.value.success?"success":"warning"])},[f(p(x),{icon:te.value.success?p(C):p(y)},null,8,["icon"]),g("div",null,[g("strong",null,w(te.value.success?"Configuration Found!":"No Configuration Found"),1),g("p",null,w(ue.value),1)])],2)):u("",!0),f(p(k),null,{default:s(()=>[f(p(_),{size:"12"},{default:s(()=>[g("div",null,[f(A,{formData:ce.value,ref_key:"formRef",ref:ie},null,8,["formData"]),ae.value?(c(),d("div",R,[g("div",{class:h(["connection-result",ae.value])},[g("div",V,[f(p(x),{icon:"available"===ae.value?p(C):p(P)},null,8,["icon"]),S(" "+w("available"===ae.value?"Connection Successful":"Connection Failed"),1)]),oe.value?(c(),d("div",K,w(oe.value),1)):u("",!0)],2)])):u("",!0),g("div",Q,[f(p(z),{onClick:fe,disabled:ee.value,class:"primary-btn",expand:"block",fill:"solid"},{default:s(()=>[S(w(ee.value?"Testing Connection...":"Test Connection"),1)]),_:1},8,["disabled"]),f(p(z),{onClick:ge,class:"super-user-btn",expand:"block",fill:"solid",disabled:"available"!==ae.value},{default:s(()=>[f(p(x),{icon:p(T),slot:"start"},null,8,["icon"]),a[2]||(a[2]=S(" Save as Facility Default ",-1)),"available"!==ae.value?(c(),d("span",W," (Test connection first) ")):u("",!0)]),_:1},8,["disabled"])]),g("div",Y,[f(p(x),{icon:p(y)},null,8,["icon"]),a[3]||(a[3]=g("p",null," Save this configuration as the facility default for other users to automatically use these settings when they log in. ",-1))])])]),_:1})]),_:1})])]),_:1})])]),_:1})]),_:1},8,["class"]))}}),[["__scopeId","data-v-5ac84414"]]))}}});

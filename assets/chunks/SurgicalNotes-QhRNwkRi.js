import{d as Se,am as De,cr as Ae,r as v,c as ye,b2 as d,w as c,a as we,O as H,f as W,J as N,l as g,u as _,ab as _e,k as p,m as Ce,i as D,bT as xe,v as A,ae as Be,ba as S}from"./vendor-BTebhqHt.js";import{b9 as j,u as Te,ba as ke,bb as Ie,b1 as Pe,bc as Re,e as Ne,b2 as $e,i as Ee,a8 as Fe,f as Ve,T as ze,D as Le,a1 as Me,H as $,b4 as C,bd as He,I as U,be as We,t as G,ao as x,F as je,bf as Ue,aa as Ge,S as Je}from"../index-DBQF-8Xn.js";import{D as qe}from"./DemographicBar-CPy0fs0J.js";import{u as Ke,_ as Qe}from"./useFormWizard-Ccxlnnh2.js";import{u as E}from"./ComplicationsStore-r8tmvgC8.js";import{s as Xe,c as Ye,u as Ze}from"./nonPharmaTherapyStore-Di9r8tlh.js";import{l as Oe}from"./lodash-NJiRuGo9.js";import{f as J,a as et}from"./formatServerData-DRULdCzT.js";import{u as tt}from"./usePatientProfile-AYXZSB7D.js";import{_ as st,B as at,a as nt,b as it,c as ot}from"./ExposureAssessment.vue_vue_type_script_setup_true_lang-BIdWd3JJ.js";import"./apexcharts-no8IW45T.js";import"./drug_prescription_service-nTQSIINm.js";import"./patient_diagnosis_service-BkQO5DWD.js";import"./Registration-Bw_Ielpx.js";import"./useSetRegistrationValues-D_O_P88p.js";import"./useLocation-DWKEe-Fi.js";import"./vaccines_service-CPD8V9uh.js";import"./sms_service-BnFxTj4j.js";import"./EIRreportsStore-xF8KfXWW.js";import"./Export-JdaAXeIZ.js";import"./user_role_management-CBMMR3Y4.js";import"./useNeonatalEnrollmentStore-CfCsBxiA.js";import"./enrollment-DU-PLRUa.js";import"./Outcome-Byh15Hmo.js";import"./wardsStore-DgQn54tV.js";import"./DisplaySelectedBodyParts.vue_vue_type_script_setup_true_lang-Bc3TBuZ2.js";import"./ReusableDataTable-B-85zsJZ.js";const rt={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},lt={class:"back_profile"},zt=Se({__name:"SurgicalNotes",setup(ct,{expose:q}){const{onTabBeforeChange:K,currentTabIndex:u}=Ke();tt();const B=De(),Q=Ae();v([]),v([]),v(!1);const T=v(!0),k=v(!1),f=v(!1),F=ye(()=>({text:f.value?"Saving...":"Finish",icon:f.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:k.value||f.value})),X=j(),Y=Te(),Z=ke(),O=Ie();Pe();const ee=Re(),I=Ne();$e();const te=Ee(),se=E(),ae=Fe(),{patient:i}=d(Y),{vitals:ne}=d(X),{investigations:ie}=d(Z),{diagnosis:oe}=d(O),{substance:re}=d(te),{selectedNCDMedicationList:V}=d(ee),{FootScreening:le,visualScreening:ce,cvScreening:ue}=d(se),{sessionDate:z}=d(ae),{apiStatus:ut}=d(Ve());c(F,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:u.value,tabsLength:n.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),c(f,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const me=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},y=()=>{let e=!1;return b(),f.value&&(e=!0),k.value=e,!e},ve=()=>{B.push("/patientProfile")},P=()=>[{title:"Airway Assessment",icon:""},{title:"Breathing Assessment",icon:""},{title:"Circulation Assessment",icon:""},{title:"Disability Assessment",icon:""},{title:"Exposure Assessment",icon:""}],n=v(P()),de=v(null),ge=v(null),b=()=>{var a;if(!n.value||n.value.length===0)return console.log("Tabs not yet initialized"),null;const e=u.value>=0&&u.value<n.value.length?u.value:0;switch((a=n.value[e])==null?void 0:a.title){case"Airway Assessment":return"AirwayAssessment";case"Breathing Assessment":return"BreathingAssessment";case"Circulation Assessment":return"CirculationAssessment";case"Disability Assessment":return"DisabilityAssessment";case"Exposure Assessment":return"ExposureAssessment";default:if(I.NCDActivities.length>0)switch(I.NCDActivities[0]){case"Airway Assessment":return"AirwayAssessment";case"Breathing Assessment":return"BreathingAssessment";case"Circulation Assessment":return"CirculationAssessment";case"Disability Assessment":return"DisabilityAssessment";case"Exposure Assessment":return"ExposureAssessment"}return null}},R=()=>{T.value=!1,setTimeout(()=>{u.value=0,T.value=!0},0)},L=()=>{const e=j();e.setVitals(e.getInitialVitals(i.value.ID))},m=async()=>{var a,l;const e=Me(z.value,"sessionDate","value")||$.sessionDate(),t=C("vitals");for(let s=0;s<n.value.length;s++){const r=n.value[s];if(r.title==="Vital Signs")n.value[s].icon=w(e,t)?S:"";else if(r.title==="Risk Assessment"){const o=C("substanceAbuse");n.value[s].icon=w(e,o)?S:""}else if(r.title==="Investigations"){const o=(l=(a=i==null?void 0:i.value)==null?void 0:a.labOrders)==null?void 0:l.saved,h=o==null?void 0:o.filter(he=>$.toStandardHisFormat(e)===$.toStandardHisFormat(he.order_date));n.value[s].icon=(h==null?void 0:h.length)>0?S:""}else if(r.title==="Diagnosis"){const o=C("diagnosis");n.value[s].icon=w(e,o)?S:""}else if(r.title==="Complications Screening"){const o=C("screening");n.value[s].icon=w(e,o)?S:""}else r.title==="Treatment Plan"&&(V.value.length>0?n.value[s].icon=He()?S:"":n.value[s].icon="")}y()},w=(e,t)=>{const a=new Date(e);return a.setHours(0,0,0,0),t.some(l=>{const s=new Date(l.obs_datetime);return s.setHours(0,0,0,0),s.getTime()===a.getTime()})},fe=async()=>{var s,r,o,h;const e=[],t=await J(ce.value),a=await et(le.value),l=await J(ue.value);t.length>0&&e.push({concept_id:await x.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:x.getSessionDate(),child:t}),a.length>0&&e.push({concept_id:await x.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:x.getSessionDate(),child:a}),l.length>0&&e.push(...l),e.length>0?((h=(o=(r=(s=i.value).screening)!=null?r:s.screening={}).unsaved)!=null||(o.unsaved=[]),i.value.screening.unsaved.push(...e),je("Complications saved successfully")):G("No complications data to save")},pe=async()=>{const e=Ue();if(!Oe.isEmpty(e.selectedMedicalAllergiesList)){const l=Ge(),s=e.selectedMedicalAllergiesList.map(o=>({concept_id:o.concept_id,obs_datetime:Je.getSessionDate(),value_coded:o.concept_id,location_id:l.facilityLocation.code,value_text:o.name})),r=await Xe(s);i.value=Object.assign(i.value,r),console.log("Allergies staged successfully:",i.value),e.clearSelectedMedicalAllergiesList()}const t=await Ye();i.value=Object.assign(i.value,t);const a=await Ze().saveNonPharmaTherapyPatientData();i.value=Object.assign(i.value,a)},be=async(e,t)=>{var l,s,r;const a=(l=n.value[t])==null?void 0:l.title;e%1===0&&(u.value=e),a=="Vital Signs"&&((s=de.value)==null||s.onSubmit()),a=="Risk Assessment"&&((r=ge.value)==null||r.onSubmit()),a=="Complications Screening"&&await fe(),a=="Treatment Plan"&&await pe(),await U(i.value)},M=async()=>{f.value=!0;try{await We(),await U(i.value),B.push("/triageList")}catch(e){console.error("Error saving data:",e),G("Error occurred while saving data. Please try again.")}finally{f.value=!1}};return we(async()=>{if(I.NCDActivities.length===0){B.push("patientProfile");return}E().resetScreening(),n.value=P(),await m(),(u.value===void 0||u.value<0)&&(u.value=0,console.log("Setting initial tab index to 0")),k.value=!1,f.value=!1,y()}),c(u,async()=>{await y()}),c(ne,async()=>{await m()},{deep:!0}),c(i,async()=>{E().resetScreening(),await m()},{deep:!0}),c(z,async()=>{await m()},{deep:!0}),c(ie,async()=>{await m()},{deep:!0}),c(oe,async()=>{await m()},{deep:!0}),c(re,async()=>{await m()},{deep:!0}),c(V,async()=>{await m()},{deep:!0}),c(Q,async e=>{R(),L(),n.value=P()},{deep:!0}),c(i,async(e,t)=>{e.ID!=t.ID&&(R(),L())},{deep:!0}),q({saveData:M,markWizard:m,refreshWizard:R,validateDoneButtonState:y}),(e,t)=>(W(),H(_(Be),null,{default:N(()=>[g(ze),g(_(_e),{fullscreen:!0},{default:N(()=>[g(qe),p("div",rt,[T.value?(W(),H(Qe,{key:0,ref:"wizard",headingTitle:"Primary Survey","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:F.value,"custom-tabs":n.value,beforeChange:_(K),onChange:be,"onComplete:wizard":t[1]||(t[1]=a=>M()),onDoneButtonChanged:me},{default:N(()=>[p("div",null,[p("div",lt,[g(Le,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:_(xe),"font-weight":"600",onClick:t[0]||(t[0]=a=>ve())},null,8,["icon"])])]),D(p("div",null,[g(st,{ref:"airwayAssessmentRef"},null,512)],512),[[A,b()=="AirwayAssessment"]]),D(p("div",null,[g(at,{ref:"breathingAssessmentRef"},null,512)],512),[[A,b()=="BreathingAssessment"]]),D(p("div",null,[g(nt,{ref:"circulationAssessmentRef"},null,512)],512),[[A,b()=="CirculationAssessment"]]),D(p("div",null,[g(it,{ref:"disabilityAssessmentRef"},null,512)],512),[[A,b()=="DisabilityAssessment"]]),D(p("div",null,[g(ot,{ref:"exposureAssessmentRef"},null,512)],512),[[A,b()=="ExposureAssessment"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Ce("",!0)])]),_:1})]),_:1}))}});export{zt as default};

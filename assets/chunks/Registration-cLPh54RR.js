import{r as c,cr as ie,c as u,w as J,d as le,O as K,f as _,u as n,am as De,a as Ne,ae as Se,p as oe,J as T,e as g,m as k,l,k as f,a0 as Pe,I as Ve,K as we,ab as Ce,i as D,v as N,M as Te,aa as xe,N as Be,Q as Me,F as Le,P as $e,dn as Ee,R as re}from"./vendor-BTebhqHt.js";import{R as q,u as Ge,a as qe,_ as Oe,b as Ae,c as He,d as je,e as ze,f as Ue,g as We}from"./useSetRegistrationValues-DwhXFnqq.js";import{f as Ye,S as B,g as Je,a5 as Ke,n as x,x as R,y as Qe,z as Xe,D as Y,t as se,G as Ze,a3 as et,_ as tt}from"../index-CDqf5wLI.js";import{i as at}from"./user_role_management-C_jaAvQO.js";import{u as nt}from"./useNeonatalEnrollmentStore-CfCsBxiA.js";function ot(){const r=c([]),p=c([]),i=c([]),d=Ye();ie();const v=u(()=>d.apiStatus),m=t=>{var S;const o=["Brother","Father","Son","Grandfather","Grandson","Boyfriend","Stepfather","Stepson"],h=["Sister","Mother","Daughter","Grandmother","Granddaughter","Girlfriend","Stepmother","Stepdaughter"],F=["Spouse/Partner","Aunt/Uncle","Niece/Nephew","Doctor","Other","Patient","TB Contact Person","TB Patient","treatment suporter"];((S=p.value)==null?void 0:S.length)>0&&(i.value=p.value.filter(y=>t==="M"?o.includes(y.a_is_to_b)||F.includes(y.a_is_to_b):t==="F"&&h.includes(y.a_is_to_b)||F.includes(y.a_is_to_b)))};return{relationships:r,relationshipsData:p,filteredRelationships:i,apiStatus:v,getRelationships:async t=>t?(B.getPouchDbStatus()&&B.getLanConnectionStatus()?p.value=await Je("relationship"):p.value=await Ke.getRelations(),m(t),r.value=r.value=i.value.map(o=>[{name:o.b_is_to_a,id:o.relationship_type_id,trackByID:o.relationship_type_id+o.b_is_to_a}]).reduce((o,h)=>o.concat(h),[]),r.value):(m(t),r.value=i.value.map(o=>[{name:o.b_is_to_a,id:o.relationship_type_id,trackByID:o.relationship_type_id+o.b_is_to_a}]).reduce((o,h)=>o.concat(h),[]),r.value),filterRelationships:m}}const rt=(r,p,i)=>{const d=u(()=>new q().checkIfChild(r.value).moreThanThirteenYears),{getRelationships:v}=ot(),m=c();return J(r,async t=>{t&&(m.value=await v(t.gender))}),J(i,async t=>{m.value=t}),{guardianInformation:u(()=>[{componentType:"Heading",name:"Guardian Information",position:"center"},{componentType:"inputField",header:"Guardian National ID",name:"guardianNationalID",placeholder:"__-__-__-__",icon:x.nationalID,validation:t=>R.isMWNationalID(t)},{componentType:"inputField",header:"First name",name:"guardianFirstname",icon:x.fullName,validation:t=>d.value?R.isNameEmpty(t):R.isName(t)},{componentType:"inputField",header:"Middle name",name:"guardianMiddleName",icon:x.fullName,validation:t=>R.isNameEmpty(t)},{componentType:"inputField",header:"Last name",name:"guardianLastname",icon:x.fullName,validation:t=>d.value?R.isNameEmpty(t):R.isName(t)},{componentType:"phoneInputField",name:"guardianPhoneNumber",header:"Phone Number",validation:t=>R.isMWPhoneNumber(t.phoneNumber)},{componentType:"multiSelectInputField",header:"Relationship to patient",name:"relationship",trackBy:"trackByID",icon:x.search,validation:t=>d.value?null:R.required(t==null?void 0:t.name),options:()=>m.value,disabled:()=>!m.value}])}},st=le({__name:"GuardianInformation",props:{personalInformationFormValues:{},relationshipsData:{}},setup(r,{expose:p}){const{formRef:i,exposeFormMethods:d}=Qe(),v=r,m=u(()=>v.personalInformationFormValues),I=u(()=>v.relationshipsData),{guardianInformation:t}=rt(m,i,I);return p(d()),(o,h)=>(_(),K(Xe,{formData:n(t),ref_key:"formRef",ref:i},null,8,["formData"]))}}),it={key:0,class:"spinner-overlay"},lt={class:"header-title"},ct={class:"masonry-grid"},ut={class:"card-container"},dt={class:"custom-card"},mt={class:"card-container"},ft={key:0,class:"custom-card"},pt={key:1,class:"custom-card"},_t={class:"custom-card card-margin-top"},ht={key:0,class:"card-container"},vt={class:"custom-card"},yt={class:"custom-card card-margin-top"},gt={class:"card-container"},Rt={class:"custom-card"},It={key:0,class:"custom-card card-margin-top"},Ft={class:"footer-content"},bt={class:"footer-buttons-left"},kt={key:0,class:"pagination-dots"},Dt=["onClick","aria-label"],Nt={class:"footer-buttons-right"},St=le({__name:"Registration",props:{editMode:{type:Boolean,default:!1}},setup(r){const p=c(!1),i=De(),d=ie(),v=nt(),m=c(null),I=c(null),t=c(null),o=c(null),h=c(null),F=c(null),S=c(null),y=c(null),V=c(!1),M=c({personalInformationRef:m,birthRegistrationRef:I,socialHistoryRef:t,countryRef:o,currentLocationRef:h,homeLocationRef:F,guardianInformationRef:S,patientTypeRef:y}),L=u(()=>{var e;return((e=m.value)==null?void 0:e.currentFormValues)||{}}),ce=u(()=>{var e;return((e=I.value)==null?void 0:e.currentFormValues)||{}}),ue=u(()=>{var e;return((e=t.value)==null?void 0:e.currentFormValues)||{}}),O=u(()=>{var e;return((e=o.value)==null?void 0:e.currentFormValues)||{}}),A=u(()=>{var e;return((e=h.value)==null?void 0:e.currentFormValues)||{}}),Q=u(()=>{var e;return((e=F.value)==null?void 0:e.currentFormValues)||{}}),de=u(()=>{var e;return((e=S.value)==null?void 0:e.currentFormValues)||{}}),me=u(()=>{var e;return((e=y.value)==null?void 0:e.currentFormValues)||{}}),X=u(()=>({personalInformation:L.value,birthRegistration:ce.value,socialHistory:ue.value,country:O.value,currentLocation:A.value,homeLocation:Q.value,guardianInformation:de.value,patientType:me.value})),Z=()=>{const e=Object.values(M.value);return e.forEach(a=>a==null?void 0:a.validateForm()),e.every(a=>(a==null?void 0:a.validateForm())==null)},$=()=>{Object.values(M.value).forEach(e=>e==null?void 0:e.resetForm())},H=u(()=>new q().checkIfChild(L.value)),{nextPage:fe,prevPage:pe,goToPage:_e,isCardVisible:E,showPreviousButton:he,showPaginationButtons:ve,totalPages:ee,currentPage:te,showNextButton:ye}=Ge(),{setFormValues:ae}=qe(),ge=async()=>{var e,a,s,P,w,C;try{if(V.value=!0,!Z()){se("Please fill in all required fields");return}if(await new q().saveRegistrationData(X.value)){const be=d.query.context,z=d.query.returnTo;if(be==="neonatal-mother"&&z==="/neonatal/enrollment"){const G=B.getUserID();if(G){const b=L.value,U=Q.value,W=A.value,ke={patientID:G,firstName:b.firstname||"",middleName:b.middleName||"",lastName:b.lastname||"",gender:b.gender||"F",birthdate:b.birthdate||"",nationalId:b.nationalID||"",phone:b["Phone Number"]||"",address:{city_village:((e=U.home_village)==null?void 0:e.name)||((a=W.current_village)==null?void 0:a.name)||"",township_division:((s=U.home_traditional_authority)==null?void 0:s.name)||((P=W.current_traditional_authority)==null?void 0:P.name)||"",state_province:((w=U.home_district)==null?void 0:w.name)||((C=W.current_district)==null?void 0:C.name)||""}};v.setCreatedMother(G,ke),$(),setTimeout(()=>{i.replace({path:z,query:{motherAdded:G.toString(),timestamp:Date.now().toString()}})},100)}else $(),setTimeout(()=>{i.replace({path:z})},100);return}$(),B.getProgramID()==32?at()?j("/home"):j("/NCDEnrollment"):j("/patientProfile")}}catch(ne){console.error(ne)}finally{V.value=!1}},Re=async()=>{try{if(V.value=!0,!Z()){se("Please fill in all required fields");return}await new q().updateDemographics(X.value)&&re.dismiss()}catch(e){console.error(e)}finally{V.value=!1}},Ie=async()=>{if(await Ze("Do you want to cancel registration?")){const a=d.query.context,s=d.query.returnTo;if($(),a==="neonatal-mother"&&s==="/neonatal/enrollment"){v.clearEnrollmentContext(),setTimeout(()=>{i.replace({path:s})},50);return}i.replace({path:"/home"})}},Fe=async()=>{await et("Do you want to cancel editing of demographics?","",{confirmBtnLabel:"Yes",icon:"",showBackdrop:!0})&&re.dismiss()},j=e=>{i.push({path:e})};return J(d,async e=>{e.query.context!=="neonatal-mother"&&ae(M)},{deep:!0}),Ne(async()=>{d.query.context!=="neonatal-mother"&&ae(M)}),(e,a)=>(_(),K(n(Se),{class:oe({loading:p.value})},{default:T(()=>[p.value?(_(),g("div",it,[l(n(Pe),{name:"bubbles"}),a[4]||(a[4]=f("div",{class:"loading-text"},"Please wait...",-1))])):k("",!0),l(n(Ve),null,{default:T(()=>[f("div",lt,we(r.editMode?"Edit Patient Demographic":"New Patient Registration"),1)]),_:1}),l(n(Ce),null,{default:T(()=>{var s,P,w,C;return[f("div",ct,[D(f("div",ut,[f("div",dt,[l(Oe,{ref_key:"personalInformationRef",ref:m},null,512)])],512),[[N,n(E)(0)]]),D(f("div",mt,[H.value.underNineMonths&&!r.editMode?(_(),g("div",ft,[H.value.underNineMonths?(_(),K(Ae,{key:0,ref_key:"birthRegistrationRef",ref:I},null,512)):k("",!0)])):k("",!0),H.value.moreThanThirteenYears?(_(),g("div",pt,[l(He,{ref_key:"socialHistoryRef",ref:t},null,512)])):k("",!0),f("div",_t,[l(je,{ref_key:"countryRef",ref:o},null,512)])],512),[[N,n(E)(1)]]),!((P=(s=O.value)==null?void 0:s.country)!=null&&P.name)||((C=(w=O.value)==null?void 0:w.country)==null?void 0:C.name)==="Malawi"?D((_(),g("div",ht,[f("div",vt,[l(ze,{ref_key:"currentLocationRef",ref:h},null,512)]),f("div",yt,[l(Ue,{currentLocationFormValues:A.value,ref_key:"homeLocationRef",ref:F},null,8,["currentLocationFormValues"])])],512)),[[N,n(E)(2)]]):k("",!0),D(f("div",gt,[f("div",Rt,[l(st,{personalInformationFormValues:L.value,ref_key:"guardianInformationRef",ref:S},null,8,["personalInformationFormValues"])]),n(B).getProgramID()==1?(_(),g("div",It,[l(We,{ref_key:"patientTypeRef",ref:y},null,512)])):k("",!0)],512),[[N,n(E)(3)]])])]}),_:1}),l(n(Te),null,{default:T(()=>[f("div",Ft,[f("div",bt,[l(Y,{name:"Cancel",color:"danger",icon:n(xe),"onClicked:btn":a[0]||(a[0]=s=>r.editMode?Fe():Ie())},null,8,["icon"]),D(l(n(Be),{onClick:a[1]||(a[1]=s=>n(pe)()),"aria-label":"Go to previous page"},{default:T(()=>[...a[5]||(a[5]=[Me("Previous",-1)])]),_:1},512),[[N,n(he)]])]),n(ve)?(_(),g("div",kt,[(_(!0),g(Le,null,$e(n(ee),s=>(_(),g("span",{key:s,class:oe({dot:!0,active:s===n(te)}),onClick:P=>n(_e)(s),"aria-label":"Go to page ".concat(s),role:"button"},null,10,Dt))),128))])):k("",!0),f("div",Nt,[D(l(Y,{name:r.editMode?"Update":"Save",loading:V.value,fill:"solid",color:"primary",icon:n(Ee),"onClicked:btn":a[2]||(a[2]=s=>r.editMode?Re():ge())},null,8,["name","loading","icon"]),[[N,n(te)===n(ee)]]),D(l(Y,{name:"Next","onClicked:btn":a[3]||(a[3]=s=>n(fe)())},null,512),[[N,n(ye)]])])])]),_:1})]),_:1},8,["class"]))}}),Pt=tt(St,[["__scopeId","data-v-6acca109"]]),Bt=Object.freeze(Object.defineProperty({__proto__:null,default:Pt},Symbol.toStringTag,{value:"Module"}));export{Pt as R,st as _,Bt as a,ot as u};

!function(){function e(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}System.register(["../index-legacy-CPN3hcLt.js","./useLocation-legacy-DYREuazP.js","./vendor-legacy-IGuUoRYO.js","./vaccines_service-legacy-Bs1jd4gJ.js"],function(t,n){"use strict";var a,i,o,l,r,d,u,s,c,m,v,p,h,_,y,g,f,b,D,I,w,F,T,S,P,k,V,R,x,C,N,B,H,L,A,E,M,O,Y,q,$,U,j,G,W,z,J,K,Q,Z,X,ee,te;return{setters:[e=>{a=e.n,i=e.y,o=e.z,l=e.C,r=e.H,d=e._,u=e.S,s=e.g,c=e.L,m=e.a8,v=e.o,p=e.P,h=e.u,_=e.K,y=e.b,g=e.x,f=e.J,b=e.G,D=e.k,I=e.aM,w=e.aa},e=>{F=e.u},e=>{T=e.r,S=e.c,P=e.d,k=e.Q,V=e.f,R=e.u,x=e.P,C=e.N,N=e.al,B=e.ak,H=e.av,L=e.dt,A=e.ad,E=e.e1,M=e.a5,O=e.M,Y=e.G,q=e.e,$=e.m,U=e.l,j=e.k,G=e.H,W=e.I,z=e.F,J=e.T,K=e.a3,Q=e.z,Z=e.bh,X=e.a,ee=e.a2},e=>{te=e.g}],execute:function(){var n=document.createElement("style");n.textContent=".large-card[data-v-ffb46cdd]{padding:5%;border-radius:15px;border:1px solid #ccc;height:82vh;background-color:#fff;overflow-y:auto;-webkit-box-shadow:0px -2px 19px -2px rgba(196,190,196,1);-moz-box-shadow:0px -2px 19px -2px rgba(196,190,196,1);box-shadow:0 -2px 19px -2px #c4bec4}.header[data-v-ffb46cdd]{display:flex;gap:20px;padding:10px 20px}.position_content[data-v-ffb46cdd]{max-width:100vw}.accordion-expanded[data-v-ffb46cdd]{background-color:#ded}button[aria-expanded=false][data-v-ffb46cdd]{background:rgba(var(--ion-color-rose-rgb),.25)}ion-accordion.accordion-expanding ion-item[slot=header][data-v-ffb46cdd],ion-accordion.accordion-expanded ion-item[slot=header][data-v-ffb46cdd]{--background: #ddeedd}\n/*$vite$:1*/",document.head.appendChild(n),t({a:function(){const e=h(),{patient:t}=Z(e),n=e=>{var n,a;const i=null==t||null===(n=t.value)||void 0===n||null===(n=n.guardianInformation)||void 0===n?void 0:n.saved[0],o=null!=i&&null!==(a=i.relationship_type)&&void 0!==a&&a.b_is_to_a?{name:i.relationship_type.b_is_to_a,id:i.relationship_type.relationship_type_id,trackByID:i.relationship_type.relationship_type_id+i.relationship_type.b_is_to_a}:"";null==e||e.setFormValue("guardianNationalID",(null==i?void 0:i.national_id)||""),null==e||e.setFormValue("guardianFirstname",(null==i?void 0:i.given_name)||""),null==e||e.setFormValue("guardianMiddleName",(null==i?void 0:i.middle_name)||""),null==e||e.setFormValue("guardianLastname",(null==i?void 0:i.family_name)||""),null==e||e.setFormValue("guardianPhoneNumber",null!=i&&i.cell_phone_number?null==i?void 0:i.cell_phone_number:""),null==e||e.setFormValue("relationship",o||"")};return{setFormValues:e=>{var a,i;const{personalInformationRef:o,socialHistoryRef:l,countryRef:d,currentLocationRef:u,homeLocationRef:s,guardianInformationRef:c}=e.value,m=null==t||null===(a=t.value)||void 0===a?void 0:a.personInformation;null==o||o.setFormValue("nationalID",null==t||null===(i=t.value)||void 0===i||null===(i=i.otherPersonInformation)||void 0===i?void 0:i.nationalID),null==o||o.setFormValue("firstname",null==m?void 0:m.given_name),null==o||o.setFormValue("middleName",null==m?void 0:m.middle_name),null==o||o.setFormValue("lastname",null==m?void 0:m.family_name),null==o||o.setFormValue("gender",null==m?void 0:m.gender),null==o||o.setFormValue("birthdate",null!=m&&m.birthdate?r.toStandardHisDisplayFormat(null==m?void 0:m.birthdate):""),null==o||o.setFormValue("Phone Number",null!=m&&m.cell_phone_number?null==m?void 0:m.cell_phone_number:""),null==s||s.setFormValue("home_district",{name:null==m?void 0:m.home_district}),null==s||s.setFormValue("home_traditional_authority",{name:null==m?void 0:m.home_traditional_authority}),null==s||s.setFormValue("home_village",{name:null==m?void 0:m.home_village}),null==u||u.setFormValue("current_district",{name:null==m?void 0:m.current_district}),null==u||u.setFormValue("current_traditional_authority",{name:null==m?void 0:m.current_traditional_authority}),null==u||u.setFormValue("current_village",{name:null==m?void 0:m.current_village}),null==u||u.setFormValue("closestLandmark",{name:null==m?void 0:m.landmark}),null==d||d.setFormValue("country",null!=m&&m.country?{name:null==m?void 0:m.country}:{name:"Malawi"}),null==l||l.setFormValue("religion",{name:null==m?void 0:m.religion}),null==l||l.setFormValue("occupation",null==m?void 0:m.occupation),null==l||l.setFormValue("maritalStatus",null==m?void 0:m.marital_status),null==l||l.setFormValue("highestLevelOfEducation",null==m?void 0:m.education_level),n(c)},setGuardianInformation:n}},u:function(){const e=T(1),t=T(4),n=h(),{patient:a}=Z(n),i=S(()=>0===t.value?4:Math.ceil(4/t.value)),o=S(()=>i.value>1),l=S(()=>o.value&&e.value>1),r=S(()=>o.value&&e.value<i.value),d=()=>{t.value=(()=>{const e=window.innerWidth;return e>=992?4:e>=768?3:e>=576?2:1})(),e.value>i.value&&(e.value=i.value),0===e.value&&i.value>0&&(e.value=1)};return X(()=>{window.addEventListener("resize",d),d()}),ee(()=>{window.removeEventListener("resize",d)}),{currentPage:e,columnsPerRow:t,totalPages:i,showPaginationButtons:o,showPreviousButton:l,showNextButton:r,nextPage:()=>{e.value<i.value&&e.value++},prevPage:()=>{e.value>1&&e.value--},goToPage:t=>{t>=1&&t<=i.value&&(e.value=t)},handleResize:d,isCardVisible:n=>{if(1===i.value)return!0;const a=(e.value-1)*t.value,o=a+t.value-1;return n>=a&&n<=o}}}});t("e",P({__name:"CurrentLocation",setup(e,{expose:t}){const{formRef:n,exposeFormMethods:r}=o(),{currentLocation:d}=(e=>{const t=T(!1),{getDistricts:n,districtList:o,selectedTraditionalAuthorityId:l,villages:r,selectedDistrictId:d,TAs:u}=F();return n(),{currentLocation:S(()=>[{componentType:"Heading",name:"Current Location",position:"center"},{componentType:"multiSelectInputField",header:"Current district",name:"current_district",trackBy:"district_id",validation:e=>i.required(e),icon:a.search,options:o.value,onChange:(t,n)=>{null!=e&&e.value&&(e.value.setFormValue("current_traditional_authority",[]),e.value.setFormValue("current_village",[])),d.value=(null==t?void 0:t.district_id)||null}},{componentType:"multiSelectInputField",header:"Current traditional authority",name:"current_traditional_authority",trackBy:"traditional_authority_id",validation:e=>i.required(e),icon:a.search,options:u.value,disabled:e=>{var t;return!(null!=u&&null!==(t=u.value)&&void 0!==t&&t.length)},onChange:(t,n)=>{var a;null!=e&&e.value&&(null==e||null===(a=e.value)||void 0===a||a.setFormValue("current_village",[])),l.value=(null==t?void 0:t.traditional_authority_id)||null}},{componentType:"multiSelectInputField",header:"Current village",name:"current_village",trackBy:"village_id",icon:a.search,validation:e=>i.required(e),options:r.value,disabled:e=>{var t;return!(null!=r&&null!==(t=r.value)&&void 0!==t&&t.length)}},{componentType:"multiSelectInputField",header:"Closest landmark/Plot number",name:"closestLandmark",trackBy:"id",icon:a.search,options:[{id:1,name:"Church"},{id:2,name:"Mosque"},{id:3,name:"Primary School"},{id:4,name:"Borehole"},{id:5,name:"Secondary School"},{id:6,name:"College"},{id:7,name:"Market"},{id:8,name:"Football Ground"},{id:9,name:"Other"}]}]),TAs:u,isLoadingTAs:t,selectedDistrictId:d}})(n);return t(r()),(e,t)=>(V(),k(l,{formData:R(d),ref_key:"formRef",ref:n},null,8,["formData"]))}}));const ne=(e,t)=>(null==e||!e.same_as_current)&&!(null!=t&&t.length),ae=(e,t)=>n=>{setTimeout(()=>{n?((e,t)=>{if(null==e||!e.value||null==t||!t.value)return;const{current_district:n,current_traditional_authority:a,current_village:i}=e.value;t.value.setFormValue("home_district",n),t.value.setFormValue("home_traditional_authority",a),t.value.setFormValue("home_village",i)})(e,t):(e=>{null!=e&&e.value&&(e.value.setFormValue("home_district",[]),e.value.setFormValue("home_traditional_authority",[]),e.value.setFormValue("home_village",[]))})(t)},0)},ie=(t("f",P({__name:"HomeLocation",props:{currentLocationFormValues:{}},setup(e,{expose:t}){const n=e,{formRef:r,exposeFormMethods:d}=o(),u=S(()=>n.currentLocationFormValues),{homeLocation:s}=((e,t)=>{const{getDistricts:n,districtList:o,selectedTraditionalAuthorityId:l,villages:r,selectedDistrictId:d,TAs:u}=F();n();const s=S(()=>[{componentType:"Heading",name:"Home Location",position:"center"},{componentType:"checkboxField",type:"single",name:"same_as_current",label:"Same as current",onChange:ae(e,t)},{componentType:"multiSelectInputField",header:"Home district",name:"home_district",trackBy:"district_id",icon:a.search,validation:i.required,options:o.value,onChange:e=>((e,t,n)=>{t.value=(null==e?void 0:e.district_id)||null,null!=n&&n.value&&(n.value.setFormValue("home_traditional_authority",[]),n.value.setFormValue("home_village",[]))})(e,d,t)},{componentType:"multiSelectInputField",header:"Home traditional authority",name:"home_traditional_authority",trackBy:"traditional_authority_id",validation:i.required,icon:a.search,options:u.value,disabled:e=>ne(e,u.value),onChange:e=>((e,t,n)=>{var a;t.value=(null==e?void 0:e.traditional_authority_id)||null,null==n||null===(a=n.value)||void 0===a||a.setFormValue("home_village",[])})(e,l,t),openDirection:"auto"},{componentType:"multiSelectInputField",header:"Home village",name:"home_village",trackBy:"village_id",icon:a.search,validation:i.required,options:r.value,disabled:e=>ne(e,r.value),openDirection:"auto"}]);return{homeLocation:s}})(u,r);return t(d()),(e,t)=>(V(),k(l,{formData:R(s),ref_key:"formRef",ref:r},null,8,["formData"]))}})),t("d",P({__name:"Country",setup(e,{expose:t}){const{country:n}=(()=>{const{countriesList:e,getCountries:t}=F();return t(),{country:S(()=>[{componentType:"Heading",name:"Country",position:"center"},{componentType:"multiSelectInputField",header:"Country",name:"country",trackBy:"district_id",openDirection:"auto",icon:a.search,validation:e=>i.required(e),options:e.value}])}})(),{formRef:r,exposeFormMethods:d}=o();return t(d()),(e,t)=>(V(),k(l,{formData:R(n),ref_key:"formRef",ref:r},null,8,["formData"]))}})),t("_",P({__name:"PersonalInformation",setup(e,{expose:t}){const{personalInformation:n}=(()=>{function e(e,t){const n=new Date(e);return n.setFullYear(n.getFullYear()-t),n.toISOString().split("T")[0]}return{personalInformation:S(()=>[{componentType:"Heading",name:"Personal Information",position:"center"},{componentType:"inputField",header:"National ID",name:"nationalID",placeholder:"__-__-__-__",icon:a.nationalID,validation:e=>i.isMWNationalID(e)},{componentType:"inputField",header:"First name",name:"firstname",icon:a.fullName,validation:e=>i.isName(e)},{componentType:"inputField",header:"Middle name",name:"middleName",icon:a.fullName,validation:e=>i.isNamesEmpty(e)},{componentType:"inputField",header:"Last name",name:"lastname",icon:a.fullName,validation:e=>i.isName(e)},{componentType:"radioButtonField",header:"Gender",name:"gender",type:"inline",validation:e=>i.required(e),options:[{label:"Male",value:"M"},{label:"Female",value:"F"},{label:"Undetermined",value:"Undetermined"}]},{componentType:"dateInputField",header:"Date of birth",name:"birthdate",icon:a.calenderPrimary,minDate:e(r.sessionDate(),110),validation:e=>i.required(e),condition:e=>!e.Estimate,disabled:e=>e.Estimate},{componentType:"inputField",header:"Estimated age",name:"estimation",icon:a.time,validation:e=>i.isEstimationDate(e),initialUnit:"Years",unitOptions:[{label:"Days",value:"Days"},{label:"Weeks",value:"Weeks"},{label:"Months",value:"Months"},{label:"Years",value:"Years"}],unitValidation:e=>e&&""!==e?null:"Please select a unit.",condition:e=>e.Estimate},{componentType:"checkboxField",name:"Estimate",type:"single",label:"Estimate age"},{componentType:"phoneInputField",name:"Phone Number",header:"Phone Number",validation:e=>i.isMWPhoneNumber(e.phoneNumber)}])}})(),{formRef:d,exposeFormMethods:u}=o();return t(u()),(e,t)=>(V(),k(l,{formData:R(n),ref_key:"formRef",ref:d},null,8,["formData"]))}})),P({components:{IonLabel:M,IonAvatar:E,IonRow:A,IonImg:L,IonCol:H,IonList:B,IonItem:N,IonIcon:C,IonButton:x},data:()=>({selectedResult:{},iconsContent:a,isAnyAccordionOpen:!0,isLoading:!1}),methods:{updateAccordionState(e){const t=this.$refs.accordionGroup;this.isAnyAccordionOpen=void 0!==t.value},dismiss(e){O.dismiss(e)},async init(){this.setData(this.deduplicationData[0]||{})},async onSelect(){O.dismiss(this.selectedResult)},setData(e){this.selectedResult=e},dateFormat:e=>r.toStandardHisDisplayFormat(e),probabilityToPercentage:e=>(100*e).toFixed(2)+"%"},props:{deduplicationData:{default:[]},to_be_registered:{default:[]}},mounted(){this.init()},activated(){this.init()}})),oe={key:0,class:"spinner-overlay"},le={class:"header position_content"},re={style:{"font-size":"1.2em","font-weight":"700"}},de={class:"due_date"},ue={class:"ion-padding",slot:"content"},se={style:{display:"flex","justify-content":"end",gap:"10px"}};const ce=d(ie,[["render",function(e,t,n,a,i,o){const l=Y("ion-spinner"),r=Y("ion-icon"),d=Y("ion-header"),u=Y("ion-label"),s=Y("ion-item"),c=Y("ion-col"),m=Y("ion-row"),v=Y("ion-accordion"),p=Y("ion-accordion-group"),h=Y("ion-content"),_=Y("ion-button"),y=Y("ion-footer");return V(),q(z,null,[e.isLoading?(V(),q("div",oe,[U(l,{name:"bubbles"}),t[3]||(t[3]=j("div",{class:"loading-text"},"Please wait...",-1))])):$("",!0),U(d,null,{default:G(()=>[j("div",le,[j("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=t=>e.dismiss("back"))},[U(r,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeft},null,8,["icon"])]),j("div",re,"Matches found: ("+W(e.deduplicationData.length)+")",1)])]),_:1}),U(h,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:G(()=>[U(p,{ref:"accordionGroup",class:"previousView",value:"0",onIonChange:e.updateAccordionState},{default:G(()=>[(V(!0),q(z,null,J(e.deduplicationData,(n,a)=>(V(),k(v,{style:{"margin-bottom":"15px"},value:a,"toggle-icon-slot":"start",class:"custom_card",button:"",key:a,detail:!0,color:n.value===e.selectedResult.value?"light":"",onClick:t=>e.setData(n)},{default:G(()=>[U(s,{slot:"header"},{default:G(()=>[U(u,{class:"previousLabel"},{default:G(()=>{var e,t;return[K(W(null==n||null===(e=n.person)||void 0===e?void 0:e.given_name)+" "+W(null==n||null===(t=n.person)||void 0===t?void 0:t.family_name),1)]}),_:2},1024),j("div",de,[t[4]||(t[4]=K(" Score: ",-1)),j("b",null,W(e.probabilityToPercentage(null==n?void 0:n.score)||"-"),1)])]),_:2},1024),j("div",ue,[U(m,null,{default:G(()=>[U(c,null,{default:G(()=>[...t[5]||(t[5]=[j("b",null,"To be Registered",-1)])]),_:1}),U(c,null,{default:G(()=>[...t[6]||(t[6]=[j("b",null,"Already Registered",-1)])]),_:1})]),_:1}),U(m,null,{default:G(()=>[U(c,null,{default:G(()=>[U(m,null,{default:G(()=>{var n,a;return[t[7]||(t[7]=K(" Name: ",-1)),j("b",null,W(null===(n=e.to_be_registered)||void 0===n?void 0:n.given_name)+" "+W(null===(a=e.to_be_registered)||void 0===a?void 0:a.family_name),1)]}),_:1}),U(m,null,{default:G(()=>{var n;return[t[8]||(t[8]=K("Gender: ",-1)),j("b",null,W(null===(n=e.to_be_registered)||void 0===n?void 0:n.gender),1)]}),_:1}),U(m,null,{default:G(()=>{var n;return[t[9]||(t[9]=K("Birthdate: ",-1)),j("b",null,W(null===(n=e.to_be_registered)||void 0===n?void 0:n.birthdate),1)]}),_:1}),U(m,null,{default:G(()=>{var n;return[t[10]||(t[10]=K("Home District: ",-1)),j("b",null,W(null===(n=e.to_be_registered)||void 0===n?void 0:n.home_district),1)]}),_:1}),U(m,null,{default:G(()=>{var n;return[t[11]||(t[11]=K("Home TA: ",-1)),j("b",null,W(null===(n=e.to_be_registered)||void 0===n?void 0:n.home_traditional_authority),1)]}),_:1})]),_:1}),U(c,null,{default:G(()=>[U(m,null,{default:G(()=>{var e,a;return[t[12]||(t[12]=K(" Name: ",-1)),j("b",null,W(null==n||null===(e=n.person)||void 0===e?void 0:e.given_name)+" "+W(null==n||null===(a=n.person)||void 0===a?void 0:a.family_name),1)]}),_:2},1024),U(m,null,{default:G(()=>{var e;return[t[13]||(t[13]=K("Gender: ",-1)),j("b",null,W(null==n||null===(e=n.person)||void 0===e?void 0:e.gender),1)]}),_:2},1024),U(m,null,{default:G(()=>{var a;return[t[14]||(t[14]=K("Birthdate: ",-1)),j("b",null,W(e.dateFormat(null==n||null===(a=n.person)||void 0===a?void 0:a.birthdate)),1)]}),_:2},1024),U(m,null,{default:G(()=>{var e;return[t[15]||(t[15]=K("Home District: ",-1)),j("b",null,W(null==n||null===(e=n.person)||void 0===e?void 0:e.home_district),1)]}),_:2},1024),U(m,null,{default:G(()=>{var e;return[t[16]||(t[16]=K("Home TA: ",-1)),j("b",null,W(null==n||null===(e=n.person)||void 0===e?void 0:e.home_traditional_authority),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["value","color","onClick"]))),128))]),_:1},8,["onIonChange"])]),_:1}),U(y,{collapse:"fade",class:"ion-no-border"},{default:G(()=>[j("div",se,[U(_,{fill:"solid",color:"secondary",onClick:t[1]||(t[1]=t=>e.dismiss("dismiss"))},{default:G(()=>[...t[17]||(t[17]=[K(" Not Duplicate ",-1)])]),_:1}),U(_,{onClick:t[2]||(t[2]=t=>e.onSelect()),fill:"solid",disabled:!e.isAnyAccordionOpen},{default:G(()=>[...t[18]||(t[18]=[K("Select ",-1)])]),_:1},8,["disabled"])])]),_:1})],64)}],["__scopeId","data-v-ffb46cdd"]]),me=c();class ve{async getDDEIds(){const e=u.getPouchDbStatus(),t=u.getLanConnectionStatus(),n=u.getAPIStatus();if(t){const e=await this.getAndUpdateAvailableDdeId();return null!=e&&e.success?e.ddeId:void 0}if(e&&!t){var a,i;const e=await s("dde");if(null!==(a=e[0])&&void 0!==a&&a.npid)return(null===(i=e[0])||void 0===i?void 0:i.npid)||""}if(n)try{var o;const e=await u.getJson("/dde/patients/sync_npids",{count:1,program_id:u.getProgramID()});return(null==e||null===(o=e.npids[0])||void 0===o?void 0:o.npid)||""}catch(l){return""}return""}async deleteDDEId(e){me.postData({command:"deleteData",storeName:"dde",data:{npid:e}})}async possibleDuplicates(e){if(u.getAPIStatus())try{const n=new m,a=await n.checkPotentialDuplicates(e);if(a.length>0){const i=await v(ce,{class:"fullScreenModal"},!0,{to_be_registered:e,deduplicationData:a});if("dismiss"!=i&&"back"!=i){var t;const e=await n.importPatient(null==i||null===(t=i.person)||void 0===t?void 0:t.id),a=await p.findByID(e.patient_id);return await h().setPatientRecord(a),!0}return"back"==i}return!1}catch(n){return!1}return!1}async getAndUpdateAvailableDdeId(){try{const{couchdbUsername:e,couchdbPassword:t,couchdbPort:n,couchdbHost:a,couchdbProtocol:i}=u.getCouchdbConfig(),o=`${i}://${a}:${n}/dde`,l="Basic "+btoa(`${e}:${t}`),r={selector:{type:"dde_id",$or:[{status:{$exists:!1}},{status:{$ne:"used"}}]},limit:1},d=await fetch(`${o}/_find`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l},body:JSON.stringify(r)});if(!d.ok)throw new Error(`Failed to query documents: ${d.statusText}`);const s=await d.json();if(console.log("ðŸš€ ~ DDEService ~ getAndUpdateAvailableDdeId ~ findResult:",s),!s.docs||0===s.docs.length)return{success:!1,error:"No available DDE IDs found"};const c=s.docs[0],m=c.dde_id;c.status="used",c.assignedAt=(new Date).toISOString();const v=await fetch(`${o}/${c._id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:l},body:JSON.stringify(c)});if(!v.ok)throw new Error(`Failed to update document: ${v.statusText}`);return console.log("ðŸš€ ~ DDEService ~ getAndUpdateAvailableDdeId ~ ddeId:",m),{success:!0,ddeId:m}}catch(e){return console.error("Error getting and updating DDE ID:",e),null}}}class pe{getRegion(e){return{1:"Central Region",2:"Northern Region",3:"Southern Region",4:"Foreign"}[e]}hasValidData(e,t=[]){return!(!e||"object"!=typeof e)&&(0===t.length?Object.values(e).some(e=>null!=e&&""!==e):t.every(t=>null!==e[t]&&void 0!==e[t]&&""!==e[t]))}async buildObservation(e,t){if(!t)return null;const n="object"==typeof t&&t.name?t.name:t;return await _.buildValueText(e,n)}buildGuardianInfo(e){const t={};return t.given_name=(null==e?void 0:e.guardianFirstname)||"",t.middle_name=(null==e?void 0:e.guardianMiddleName)||"",t.family_name=(null==e?void 0:e.guardianLastname)||"",t.cell_phone_number=(null==e?void 0:e.guardianPhoneNumber.phoneNumber)||"",t.national_id=(null==e?void 0:e.guardianNationalID)||"",t.gender="",t.birthdate="",t.birthdate_estimated="false",t.home_region="",t.home_district="",t.home_traditional_authority="",t.home_village="",t.current_region="",t.current_district="",t.current_traditional_authority="",t.current_village="",t.landmark="",{saved:[],unsaved:[t]}}async buildVitals(e){return null!=e&&e.Weight?{saved:[],unsaved:[await this.buildObservation("Weight",e.Weight)]}:null}async buildARTPatientType(e,t){const n=[];let a=[];return e&&n.push(await _.buildValueText("Art clinic location",e)),t&&n.push(await _.buildValueCoded("Type of patient",t)),0===n.length?[]:(a=[{encounter_type:y.REGISTRATION,status:"unsaved",obs:n}],a)}async buildBirthRegistrationObservations(e){if(!this.hasValidData(e))return null;const t=(await Promise.all([this.buildObservation("How many doses of Tdv did the mother receive?",e["How many doses of Tdv did the mother receive?"]),this.buildObservation("Protected at birth",e["Protected at birth"]),this.buildObservation("HIV status",e["HIV status"])])).filter(e=>null!==e);return t.length>0?t:null}async buildPatientRecord(e,t,n=""){var a,i,o,l,r,d,s,c,m,v,p,h,_;const{personalInformation:y,currentLocation:g,homeLocation:f,birthRegistration:b,guardianInformation:D,socialHistory:I,patientType:w}=e;return{patientID:n||t||"",ID:t||"",NcdID:"",personInformation:{given_name:(null==y?void 0:y.firstname)||"",middle_name:(null==y?void 0:y.middleName)||"",family_name:(null==y?void 0:y.lastname)||"",gender:(null==y?void 0:y.gender)||"",birthdate:null!=y&&y.Estimate?(new he).calculateDoB(null==y?void 0:y.estimation,(null==y?void 0:y.estimation_unit)||"Years"):(null==y?void 0:y.birthdate)||"",birthdate_estimated:null!=y&&y.Estimate?"true":"false",home_region:this.getRegion(null==f||null===(a=f.home_district)||void 0===a?void 0:a.region_id)||"",home_district:(null==f||null===(i=f.home_district)||void 0===i?void 0:i.name)||"",home_traditional_authority:(null==f||null===(o=f.home_traditional_authority)||void 0===o?void 0:o.name)||"",home_village:(null==f||null===(l=f.home_village)||void 0===l?void 0:l.name)||"",current_region:this.getRegion(null==g||null===(r=g.current_district)||void 0===r?void 0:r.region_id)||"",current_district:(null==g||null===(d=g.current_district)||void 0===d?void 0:d.name)||"",current_traditional_authority:(null==g||null===(s=g.current_traditional_authority)||void 0===s?void 0:s.name)||"",current_village:(null==g||null===(c=g.current_village)||void 0===c?void 0:c.name)||"",country:(null==e?void 0:e.country.country.name)||"",landmark:(null==g||null===(m=g.closestLandmark)||void 0===m?void 0:m.name)||"",cell_phone_number:(null===(v=y["Phone Number"])||void 0===v?void 0:v.phoneNumber)||"",occupation:(null==I?void 0:I.occupation)||"",marital_status:(null==I?void 0:I.maritalStatus)||"",religion:(null==I||null===(p=I.religion)||void 0===p?void 0:p.name)||"",education_level:(null==I?void 0:I.highestLevelOfEducation)||""},guardianInformation:this.buildGuardianInfo(D),birthRegistration:await this.buildBirthRegistrationObservations(b),otherPersonInformation:{nationalID:(null==y?void 0:y.nationalID)||"",ichisID:u.getIchisId()||"",TEI:u.getTEI()||"",birthID:b["Serial Number"]||"",relationshipID:(null==D||null===(h=D.relationship)||void 0===h?void 0:h.id)||""},vitals:await this.buildVitals(b),vaccineSchedule:await te(null==y?void 0:y.gender,null==y?void 0:y.birthdate),vaccineAdministration:{orders:[],obs:[],voided:[]},observations:await this.buildARTPatientType(null==w||null===(_=w.facility)||void 0===_?void 0:_.name,null==w?void 0:w.patient_type),appointments:{saved:[],unsaved:[]},saveStatusPersonInformation:"pending",saveStatusGuardianInformation:"pending",saveStatusBirthRegistration:"pending",saveStatusVitals:"pending",date_created:"",creator:"",sync_status:"unsynced"}}}class he extends u{constructor(){super(),e(this,"patientRecordBuilder",void 0),this.patientRecordBuilder=new pe}async saveRegistrationData(e){const t=await(new ve).getDDEIds();if(!t&&(g("DDE IDs are not available."),u.getLanConnectionStatus()||u.getPouchDbStatus()))return!1;let n=await this.patientRecordBuilder.buildPatientRecord(e,t);return 32==u.getProgramID()&&(n=await(async e=>{const t=u.getIchisDiagnosis();if(t.length<=0)return e;const n=await Promise.all(t.map(async e=>{var t;const n=(null==e||null===(t=e.value)||void 0===t||null===(t=t.match(/[\d.]+/))||void 0===t?void 0:t[0])||"",a=null==e?void 0:e.date;if("NCD_CV_D_Likelihood of Diabetes"==e.display){var i;const t=null==e||null===(i=e.id)||void 0===i?void 0:i.split("-");return await _.buildValueNumber("Unspecified Diabetes",n,null,null,a,t[1])}return"NCD_SHD_CV_Client waist circumference"==e.display?await _.buildValueNumber("Waist circumference",n,null,null,a):"NCD_SHD_CV_Client systolic blood pressure"==e.display?await _.buildValueNumber("Systolic",n,null,null,a):"NCD_SHD_CV_Client diastolic blood pressure"==e.display?await _.buildValueNumber("Diastolic",n,null,null,a):void 0}));return e.observations.push({encounter_type:"VITALS",status:"unsaved",obs:n}),e})(n)),!!(await(new ve).possibleDuplicates(n.personInformation))||!!(await f(n))&&(b("Registration successful"),sessionStorage.setItem("ichis_diagnosis",JSON.stringify([])),u.getPouchDbStatus()&&await(new ve).deleteDDEId(t),await this.printBarcode(),!0)}async updateDemographics(e){let t=await this.patientRecordBuilder.buildPatientRecord(e,u.getNationalID(),u.getPatientID());return t.saveStatusPersonInformation="edit",t.saveStatusGuardianInformation="edit",t.saveStatusBirthRegistration="edit",t.saveStatusVitals="edit",!!(await f(t))&&(b("Updated successful"),!0)}checkIfChild(e){if(!(null!=e&&e.estimation||null!=e&&e.birthdate))return{moreThanThirteenYears:!0,underNineMonths:!1,underFiveYears:!1};let t="";return t=e.estimation?this.calculateDoB(e.estimation,e.estimation_unit||"Years")||"":e.birthdate,{moreThanThirteenYears:r.getAgeInYears(t)>13,underNineMonths:r.ageInMonths(t)<9,underFiveYears:r.getAgeInYears(t)<5}}async printBarcode(){"Confirm"===await D("Do you want to print a barcode?",{header:"Printer"})&&await(new I).printData("barcode")}calculateDoB(e,t){try{let n=Q(u.getSessionDate());if("Years"===t&&e<0)n=n.add(Math.abs(e),"years");else switch(t){case"Days":n=n.subtract(e,"days");break;case"Months":n=n.subtract(e,"months");break;case"Years":n=n.subtract(e,"years");break;default:return null}return r.toStandardHisDisplayFormat(n.format("YYYY-MM-DD"))||""}catch(n){return console.error("Error calculating date:",n),null}}}t("R",he);t("c",P({__name:"SocialHistory",setup(e,{expose:t}){const{socialHistory:n}=(()=>{const e=T();return w.isProp("military_site=true").then(t=>{e.value=t}),{socialHistory:S(()=>[{componentType:"Heading",name:"Social History",position:"center"},{componentType:"multiSelectInputField",header:"Religion",name:"religion",icon:a.search,trackBy:"id",options:[{id:1,name:"Christianity"},{id:2,name:"Islam"},{id:3,name:"Judaism"},{id:4,name:"Hinduism"},{id:5,name:"Buddhism"},{id:6,name:"Sikhism"},{id:7,name:"Jainism"},{id:8,name:"BahÃ¡'Ã­ Faith"},{id:9,name:"Zoroastrianism"},{id:10,name:"Confucianism"},{id:11,name:"Taoism"},{id:12,name:"Shinto"},{id:13,name:"Baha'i Faith"},{id:14,name:"Juche"},{id:15,name:"Rastafari"}]},{componentType:"radioButtonField",header:"Occupation status",name:"occupation",type:"inline",validation:i.required,condition:()=>1==u.getProgramID()&&e.value,options:[{label:"Military",value:"Military"},{label:"Civilian",value:"Civilian"}]},{componentType:"radioButtonField",header:"Occupation status",name:"occupation",type:"inline",condition:t=>!e,options:[{label:"Employed",value:"employed"},{label:"Student",value:"Student"},{label:"Unemployed",value:"unemployed"},{label:"Other",value:"Other"}]},{componentType:"radioButtonField",header:"Marital status",name:"maritalStatus",type:"inline",options:[{label:"Single",value:"single"},{label:"Married",value:"married"},{label:"Widow",value:"widow"},{label:"Widower",value:"widower"},{label:"Divorced",value:"divorced"}]},{componentType:"radioButtonField",header:"Highest level of education",name:"highestLevelOfEducation",type:"inline",options:[{label:"No education",value:"No education"},{label:"Primary school",value:"primary school"},{label:"Secondary school",value:"secondary school"},{label:"Tertiary education",value:"tertiary education"}]}])}})(),{formRef:r,exposeFormMethods:d}=o();return t(d()),(e,t)=>(V(),k(l,{formData:R(n),ref_key:"formRef",ref:r},null,8,["formData"]))}})),t("g",P({__name:"PatientType",setup(e,{expose:t}){const{patientType:n}=(()=>{const{facilityList:e,getFacilities:t}=F();return t(),{patientType:S(()=>[{componentType:"Heading",name:"Patient Type",position:"center"},{componentType:"radioButtonField",header:"Patient Type",name:"patient_type",type:"inline",validation:i.required,options:[{label:"New patient",value:"New patient"},{label:"Emergency supply",value:"Emergency supply"},{label:"External consultation",value:"External consultation"}]},{componentType:"multiSelectInputField",header:"Facility",name:"facility",trackBy:"facility_id",openDirection:"auto",icon:a.search,validation:e=>i.required(e),options:e.value.facilities||e.value,condition:e=>"Emergency supply"==(null==e?void 0:e.patient_type)||"External consultation"==(null==e?void 0:e.patient_type)}])}})(),{formRef:r,exposeFormMethods:d}=o();return t(d()),(e,t)=>(V(),k(l,{formData:R(n),ref_key:"formRef",ref:r},null,8,["formData"]))}})),t("b",P({__name:"BirthRegistration",setup(e,{expose:t}){const{formRef:n,exposeFormMethods:r}=o(),{birthRegistration:d}=(e=>({birthRegistration:S(()=>[{componentType:"Heading",name:"Birth Registration",position:"center"},{componentType:"inputField",header:"Birth certificate number",name:"Serial Number",icon:a.nationalID,placeholder:"__-__-__-__"},{componentType:"inputField",header:"Birth Weight/First weight (kg)",name:"Weight",icon:a.weight,validation:e=>i.validateWeight(e)},{componentType:"multiSelectInputField",header:"How many doses of Tdv did the mother receive?",name:"How many doses of Tdv did the mother receive?",icon:a.search,options:[{concept_id:11997,name:"0-2 doses, less than two weeks before delivery"},{concept_id:11998,name:"2-5 doses more than two weeks of delivery"},{concept_id:1067,name:"Unknown"}],trackBy:"concept_id",validation:e=>i.required(e),onChange:t=>{const n=null==t?void 0:t.name;"Unknown"==n?e.value.setFormValue("Protected at birth",{concept_id:1067,name:"Don't know"}):"0-2 doses, less than two weeks before delivery"==n?e.value.setFormValue("Protected at birth",{concept_id:1066,name:"No"}):"2-5 doses more than two weeks of delivery"==n&&e.value.setFormValue("Protected at birth",{concept_id:1065,name:"Yes"})}},{componentType:"multiSelectInputField",header:"Protected at birth (PAB)",name:"Protected at birth",icon:a.search,trackBy:"concept_id",validation:e=>i.required(e),disabled:e=>!e["How many doses of Tdv did the mother receive?"]},{componentType:"multiSelectInputField",header:"HIV status of the Child's Mother",name:"HIV status",icon:a.search,options:[{id:703,name:"Positive"},{id:664,name:"Negative"},{id:1067,name:"Unknown"}],trackBy:"id",validation:e=>i.required(e)}])}))(n);return t(r()),(e,t)=>(V(),k(l,{formData:R(d),ref_key:"formRef",ref:n},null,8,["formData"]))}}))}}})}();

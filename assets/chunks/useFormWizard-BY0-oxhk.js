var ne=Object.defineProperty;var oe=(a,e,n)=>e in a?ne(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n;var y=(a,e,n)=>oe(a,typeof e!="symbol"?e+"":e,n);import{D as K,aV as k,d as U,c as m,H as re,e as f,f as h,m as x,k as b,p as P,j as v,l as E,K as F,r as G,w as R,a as ie,F as ce,P as de,O as le,u as ue,J,n as X}from"./vendor-D6KKOjhr.js";import{l as O}from"./lodash-NJiRuGo9.js";import{b2 as Z,u as I,af as z,S as w,E as pe,H as N,aQ as ge,bq as he,P as fe,a7 as ve,G as M,t as T,aJ as A,aK as V,a0 as me}from"../index-BVTwk_Db.js";import{g as De,D as ee,a as _}from"./drug_prescription_service-BTwoZdoj.js";import{P as be}from"./patient_diagnosis_service-eSSVayGJ.js";const Y=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"Visual acuity test",data:{rowData:[{colData:[{inputHeader:"Left Eye",value:"",name:"Left eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"},{inputHeader:"Right Eye",value:"",name:"Right eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"}]}]}}],W=[{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Peripheral neuropathy"},data:[{name:"Neuropathy/PVO",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Deformity"},data:[{name:"Deformities",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Ulcers"},data:[{name:"Ulcers",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}}],Q=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"CV Risk %",data:{rowData:[{colData:[{inputHeader:"",value:"",name:"CVD",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,valueType:"text",validationFunctionName:"isNumber"}]}]}}],Ze=K("complicationsStore",{state:()=>({visualScreening:[...Y],FootScreening:[...W],cvScreening:[...Q]}),actions:{setCvScreening(a){this.cvScreening=a},setVisualScreening(a){this.visualScreening=a},setFootScreening(a){this.FootScreening=a},getInitialCvScreening(){return[...O.cloneDeep(Q)]},getInitialVisualScreening(){return[...O.cloneDeep(Y)]},getInitialFootScreening(){return[...O.cloneDeep(W)]},resetScreening(){this.setCvScreening(this.getInitialCvScreening()),this.setFootScreening(this.getInitialFootScreening()),this.setVisualScreening(this.getInitialVisualScreening())}},persist:!0});class ye extends Z{constructor(e,n){super(e,105,n)}}class Se extends Z{constructor(e,n){super(e,25,n)}static async get_____(e="",n=1,s=10){}}async function et(a){var e,n,s;try{const t=I(),{patient:o}=k(t),r=JSON.parse(JSON.stringify(o.value));return(s=(n=(e=r.allergies)!=null?e:r.allergies={}).unsaved)!=null||(n.unsaved=[]),r.allergies.unsaved.push(...a),M("Allergies appended to patient record successfully"),r}catch(t){T("Unable to save Allegies!")}}class tt{async onSubmitNotes(e,n,s){const t=new ye(e,n);await t.createEncounter(),await t.saveObservationList(s)}async onSubmitAllergies(e,n,s){try{const t=new Se(e,n);await t.createEncounter(),await t.saveObservationList(s),M("Allergies saved successfully")}catch(t){console.error("Error saving allergies:",t),T("Failed to save allergies")}}}class at{constructor(){y(this,"programID");y(this,"providerID");y(this,"patientID");y(this,"date");y(this,"demographics");y(this,"previousDrugPrescriptions",[]);y(this,"previousClinicalNotes");y(this,"previousDrugAllergies");const e=I();this.demographics=e.patient,this.patientID=this.demographics.patientID,this.date=z.getSessionDate(),this.providerID=w.getUserID(),this.programID=z.getProgramID(),this.previousClinicalNotes={},this.previousDrugAllergies={}}async getPatientEncounters(){const e=await this.getPatientVisitDates(),n=e.map(async t=>{const o=t.value,r=await pe.getEncounters(this.patientID,{date:o});await Promise.all(r.map(async i=>{var g;if(i.type.name=="NOTES"){const{observations:d}=i;O.isEmpty(d)||d.forEach(u=>{if(u.concept_id=="2688"){const D=N.toStandardHisDisplayFormat(u.obs_datetime);O.isEmpty(this.previousClinicalNotes.hasOwnProperty(D))&&(this.previousClinicalNotes[D]=[]),this.previousClinicalNotes[D].push({date:D,notes:u.value_text})}})}if(i.type.name=="TREATMENT"){const{observations:d}=i;if(!O.isEmpty(d))for(const u in d){let D="<UNKNOWN CONCEPT>";const l=d[u];try{(g=l==null?void 0:l.concept)!=null&&g.concept_names?D=l.concept.concept_names[0].name:D=await ge.getConceptName(l.concept_id)}catch(B){console.error(l,B)}const L=await z.resolvePrimaryValue(l),C=N.toStandardHisDisplayFormat(l.date_created);D=="Allergic"&&(this.previousDrugAllergies.hasOwnProperty(C)||(this.previousDrugAllergies[C]=[]),this.previousDrugAllergies[C].push({date:C,value:L}))}}}))});await Promise.all(n);const s=e.map(async t=>{const o=await he.getOrderByPatient(this.patientID,{start_date:t.value});if(!O.isEmpty(o)){const r=o.map(i=>({drugName:i.drug.name,value:N.toStandardHisTimeFormat(i.order.start_date),dose:i.dose,frequency:De(i.frequency),prescription:N.toStandardHisFormat(i.order.auto_expire_date),duration:_e(i.order.instructions),other:i}));this.previousDrugPrescriptions.push({prescriptionDate:N.toStandardHisDisplayFormat(t.value),previousPrescriptions:r})}});return await Promise.all(s),{previousDrugPrescriptions:this.previousDrugPrescriptions,previousClinicalNotes:this.previousClinicalNotes,previousDrugAllergies:this.previousDrugAllergies}}async getPatientVisitDates(){return(await fe.getPatientVisits(this.patientID,!1)).map(e=>({label:N.toStandardHisDisplayFormat(e),value:e,other:{isActive:e===ve.getSessionDate()}}))}}function _e(a){const e=/(\d+)\s+days/i,n=a.match(e);return n&&n.length>1?parseInt(n[1]):null}async function st(){const a=I(),{patient:e}=k(a),n=e.value,s=[8809,903,6410,6409],t="";let o;w.getLanConnectionStatus()||w.getPouchDbStatus()?o=await be.getDiagnosis(t,1,15):o=await w.getJson("diagnosis",{id:7409,page_size:2e3});const r=o.filter(l=>s.includes(l.concept_id));r.push({concept_id:8809,concept_name_id:926,concept_name_type:"FULLY_SPECIFIED",creator:1,date_created:"2004-06-25T00:00:00.000+02:00",date_voided:null,id:72,locale:"en",locale_preferred:0,name:"Hypertension",uuid:"b99faa1e-8d80-11d8-abbb-0024217bb78e",void_reason:null,voided:0,voided_by:null});const i=n.diagnosis.saved.map(l=>l.value_coded),g=n.diagnosis.unsaved.map(l=>l.value_coded),d=[...i,...g];return r.filter(l=>d.includes(l.concept_id)).map(l=>l.name)}async function nt(){var a,e,n;try{const s=I(),{patient:t}=k(s),o=we(),r=JSON.parse(JSON.stringify(t.value));if(o.length>0){(n=(e=(a=r.MedicationOrder)!=null?a:r.MedicationOrder={}).unsaved)!=null||(e.unsaved=[]);const i=r.MedicationOrder.unsaved.findIndex(d=>d.NCD_Drug_Orders);if(i>=0)r.MedicationOrder.unsaved[i].NCD_Drug_Orders=[...r.MedicationOrder.unsaved[i].NCD_Drug_Orders,...o];else{const d={NCD_Drug_Orders:o};r.MedicationOrder.unsaved.push(d)}const g=V();return g.setMedicationRunOutDate(Ne()),g.clearMedicationDataStores(),M("Drug order(s) has been created"),r}else T("Unable to create drug orders!")}catch(s){T("Unable to create drug orders!")}}function ot(){try{const a=new Date(w.getSessionDate()),n=A().selectedMedicalDrugsList;let s=0;if(n.forEach(d=>{const u=parseInt(d.duration,10);!isNaN(u)&&u>s&&(s=u)}),s<=0)return{date:null,formattedDate:null};const t=new Date(a);t.setDate(a.getDate()+s);const o=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),i=t.getFullYear(),g="".concat(o,"/").concat(r,"/").concat(i);return{date:t,formattedDate:g}}catch(a){return console.error("Error calculating OPD medication run out date:",a),{date:null,formattedDate:null}}}function Ne(){try{const a=new Date(w.getSessionDate()),n=V().selectedNCDMedicationList;let s=0;if(n.forEach(d=>{const u=parseInt(d.duration,10);!isNaN(u)&&u>s&&(s=u)}),s<=0)return{date:null,formattedDate:null};const t=new Date(a);t.setDate(a.getDate()+s);const o=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),i=t.getFullYear(),g="".concat(o,"/").concat(r,"/").concat(i);return{date:t,formattedDate:g}}catch(a){return console.error("Error calculating medication run out date:",a),{date:null,formattedDate:null}}}const we=()=>{const a=V();return a.selectedNCDMedicationList.map(e=>{e.frequency=a.frequency_selections[e.drug_id]||"",e.totalDosage=Object.values(e.dosage).reduce((t,o)=>t+Number(o),0);const n=ee.getSessionDate(),s=Te(e.drug_id);return{drug_inventory_id:e.drug_id,equivalent_daily_dose:e.totalDosage=="Unknown"?0:e.totalDosage*(s==null?void 0:s.value)||0,start_date:n,auto_expire_date:te(n,e.duration),units:e.units,instructions:"".concat(e.name," ").concat(e.totalDosage," ").concat(e.units," ").concat((s==null?void 0:s.code)||""," for ").concat(e.duration," days"),dose:Ce(e),frequency:(s==null?void 0:s.code)||""}})},Ce=a=>a.dose_strength!=null&&a.dose_strength?Math.trunc(a.dose_strength):1;async function rt(){var a,e,n;try{const s=I(),{patient:t}=k(s),o=Oe(),r=JSON.parse(JSON.stringify(t.value));if(o.length>0){(n=(e=(a=r.MedicationOrder)!=null?a:r.MedicationOrder={}).unsaved)!=null||(e.unsaved=[]);const i=r.MedicationOrder.unsaved.findIndex(d=>d.NCD_Drug_Orders);if(i>=0)r.MedicationOrder.unsaved[i].NCD_Drug_Orders=[...r.MedicationOrder.unsaved[i].NCD_Drug_Orders,...o];else{const d={NCD_Drug_Orders:o};r.MedicationOrder.unsaved.push(d)}return A().clearSelectedMedicalDrugsList(),M("Drug order(s) has been created"),r}}catch(s){T("Unable to create drug orders!")}}const Oe=()=>A().selectedMedicalDrugsList.map(e=>{const n=ee.getSessionDate(),s=_.find(t=>t.label===e.frequency)||{};return{drug_inventory_id:e.drug_id,equivalent_daily_dose:e.dose=="Unknown"?0:e.dose*(s==null?void 0:s.value)||0,start_date:n,auto_expire_date:te(n,e.duration),units:e.units,instructions:"".concat(e.drugName,": ").concat(e.dose," ").concat(e.units," ").concat((s==null?void 0:s.code)||""," for ").concat(e.duration," days"),dose:e.dose,frequency:(s==null?void 0:s.code)||""}}),Te=a=>{const n=V().selectedNCDMedicationList.find(t=>t.drug_id===a);if(!n||!n.dosage)return null;switch(["morning","afternoon","evening"].reduce((t,o)=>t+(n.dosage[o]?1:0),0)){case 1:return n.dosage.morning?_.find(t=>t.code==="QAM"):n.dosage.afternoon?_.find(t=>t.code==="QNOON"):n.dosage.evening?_.find(t=>t.code==="QPM"):_.find(t=>t.code==="OD");case 2:return _.find(t=>t.code==="BD");case 3:return _.find(t=>t.code==="TDS");default:return _.find(t=>t.code==="Unknown")}},te=(a,e)=>{const n=new Date(a);return n.setDate(n.getDate()+parseInt(e)),N.toStandardHisFormat(n)},Pe=()=>A().nonPharmalogicalTherapyAndOtherNotes,it=K("nonPharmaTherapyStore",{state:()=>({items:[{id:"wound-dressing",label:"Wound dressing",checked:!1},{id:"patient-education",label:"Patient education",checked:!1},{id:"counseling",label:"Counseling",checked:!1},{id:"minor-surgery",label:"Minor Surgery",checked:!1}],current_patient:{}}),actions:{async saveNonPharmaTherapyPatientData(){const a=me(),e=[];this.items.forEach(s=>{s.checked==!0&&e.push({concept_id:11023,value_text:s.label,obs_datetime:N.toStandardHisFormat(w.getSessionDate()),location_id:a.facilityLocation.code})});const n=Pe();n&&e.push({concept_id:2592,obs_datetime:w.getSessionDate(),value_text:n,location_id:a.facilityLocation.code});try{if(e.length>0)return this.clearSelectednonPharmaTherapyStore(),M("Non Pharma Therapy staged successfully!"),await Ie(e)}catch(s){T("Unable to update Non Pharma Therapy!")}},clearSelectednonPharmaTherapyStore(){this.items.forEach(a=>{a.checked=!1})},setCurrentPatient(a){this.current_patient=a}},persist:!0});async function Ie(a){var e,n,s;try{const t=I(),{patient:o}=k(t),r=JSON.parse(JSON.stringify(o.value));return(s=(n=(e=r.notes)!=null?e:r.notes={}).unsaved)!=null||(n.unsaved=[]),r.notes.unsaved.push(...a),r}catch(t){T("Unable to create non pharmalogical notes!")}}const xe={class:"fw-list-wrapper"},ke=["id"],Me={class:"fw-step-container"},Be={key:0},$e={key:1},Ee=U({__name:"WizardStep",props:{tab:{type:Object,default:()=>{}},index:{type:Number,default:0},currentIndex:{type:Number,default:0},squaredTab:{type:Boolean,default:!1},showProgress:{type:Boolean,default:!0}},setup(a){const e=a,n=m(()=>e.currentIndex>e.index);m(()=>"pi pi-".concat(e.tab.icon));const s=m(()=>["fw-list-wrapper-icon",{"fw-step-active":e.tab.active,"fw-step-checked":e.tab.checked,"fw-squared-tab":e.squaredTab}]);return(t,o)=>{const r=re("ion-icon");return h(),f("li",null,[a.showProgress?(h(),f("div",{key:0,class:P(["fw-list-progress",{"fw-list-progress-active":n.value}])},null,2)):x("",!0),b("div",xe,[b("div",{id:"step-".concat(a.tab.id),role:"tab",class:P(s.value)},[b("div",Me,[v(t.$slots,"active-step",{},()=>[a.tab.icon?(h(),f("i",Be,[E(r,{icon:a.tab.icon,style:{"font-size":"16px"}},null,8,["icon"])])):(h(),f("i",$e,F(a.index+1),1))])])],10,ke),v(t.$slots,"title",{},()=>[b("span",{class:P(["fw-step-title",{active:a.tab.active}])},F(a.tab.title),3)])])])}}}),Fe=["disabled"],Ae={key:0},H=U({__name:"Button",props:{options:{type:Object,default:function(){return{}}}},setup(a){const e=a,n=t=>"pi pi-".concat(t),s=m(()=>["fw-btn",{"fw-btn-disabled":e.options.disabled}]);return(t,o)=>(h(),f("button",{class:P(s.value),disabled:a.options.disabled},[a.options.hideText?x("",!0):(h(),f("span",Ae,F(a.options.text),1)),a.options.hideIcon?x("",!0):(h(),f("i",{key:1,class:P(n(a.options.icon))},null,2))],10,Fe))}}),Ve=["id"],Le={class:"fw-body-list",role:"tablist"},je={class:"fw-body"},ze={class:"fw-body-content"},He={class:"fw-body-container"},Ue={key:0,class:"fw-footer"},qe={class:"fw-footer-left"},Re={class:"fw-footer-right"},ct=U({__name:"Wizard",props:{id:{type:String,default:"fw-"+new Date().valueOf()},headingTitle:{type:String,default:""},customTabs:{type:Array,default:()=>[{id:0,title:"Step 1",icon:"map"},{id:1,title:"Step 2",icon:"check"},{id:2,title:"Step 3",icon:"pencil"}]},nextButton:{type:Object,default:function(){return{}}},backButton:{type:Object,default:function(){return{}}},doneButton:{type:Object,default:function(){return{}}},hideButtons:{type:Boolean,default:!1},startIndex:{type:Number,default:0,validator:a=>a>=0},verticalTabs:{type:Boolean,default:!1},beforeChange:{type:Function,default:()=>{}},beforeMount:{type:Function,default:()=>{}},navigableTabs:{type:Boolean,default:!1},scrollableTabs:{type:Boolean,default:!1},cardBackground:{type:Boolean,default:!1},squaredTabs:{type:Boolean,default:!1},showProgress:{type:Boolean,default:!0}},emits:["change","complete:wizard","updated:tabs","onValidateTabs","done-button-changed"],setup(a,{expose:e,emit:n}){const s=n,t=a;let o=G(0);const r=m(()=>[...t.customTabs].map((p,S)=>({...p,checked:S<o.value,active:S===o.value}))),i=m(()=>r.value.length-1),g=m(()=>Object.assign({text:"Back",icon:"arrow-left",hideText:!1,hideIcon:!1,disabled:!1},t.backButton)),d=m(()=>Object.assign({text:"Next",icon:"arrow-right",hideText:!1,hideIcon:!1,disabled:!1},t.nextButton)),u=m(()=>Object.assign({text:"Done",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},t.doneButton));R(()=>t.doneButton,(c,p)=>{s("done-button-changed",{newOptions:u.value,oldOptions:p?Object.assign({text:"Done",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},p):null,currentTabIndex:o.value,isLastStep:l.value})},{deep:!0,immediate:!1}),R(u,(c,p)=>{console.log("Done button options changed:",{new:c,old:p,currentStep:o.value})},{deep:!0}),ie(()=>{o.value=t.startIndex,C(),s("change",o.value)});const D=m(()=>o.value!==0),l=m(()=>o.value===i.value),L=m(()=>["form-wizard-vue",{"fw-vertical":t.verticalTabs},{"fw-overflow-scroll":t.scrollableTabs},{"fw-card":t.cardBackground}]),C=()=>{s("updated:tabs",r.value,o.value)},B=async()=>{if(o.value===i.value){u.value.disabled||se();return}if(d.value.disabled)return;const c=o.value+1,p=o.value;if(!t.navigableTabs){s("change",c,p,!0);return}s("change",c,p),await t.beforeChange(),$(c)},ae=async()=>{if(o.value===0||g.value.disabled)return;const c=o.value-1,p=o.value;s("change",c,p),await t.beforeChange(),$(c)},se=()=>{const c=o.value,p=o.value-1;s("complete:wizard",c,p)},q=async c=>{if(!t.navigableTabs)return;const p=c,S=o.value;s("change",p,S),await t.beforeChange(),$(p)},$=async c=>{o.value=c,C(),await X(),await t.beforeMount()};return e({changeTab:$}),(c,p)=>(h(),f("div",{id:a.id,class:P(L.value)},[b("ul",Le,[b("h4",null,F(a.headingTitle),1),(h(!0),f(ce,null,de(r.value,(S,j)=>v(c.$slots,"wizard-step",{tab:S,index:j,navigateToTab:q},()=>[(h(),le(Ee,{key:S.id,tab:S,index:j,currentIndex:ue(o),squaredTab:a.squaredTabs,showProgress:a.showProgress,onClick:Je=>q(j)},{"active-step":J(()=>[v(c.$slots,"active-step")]),title:J(()=>[v(c.$slots,"title")]),_:3},8,["tab","index","currentIndex","squaredTab","showProgress","onClick"]))])),256))]),b("div",je,[b("div",ze,[b("div",He,[v(c.$slots,"default")])]),a.hideButtons?x("",!0):(h(),f("div",Ue,[v(c.$slots,"footer",{},()=>[b("div",qe,[D.value?(h(),f("span",{key:0,role:"button",onClick:ae},[v(c.$slots,"back",{},()=>[E(H,{options:g.value},null,8,["options"])])])):x("",!0),v(c.$slots,"custom-buttons-left")]),b("div",Re,[v(c.$slots,"custom-buttons-right"),l.value?(h(),f("span",{key:0,role:"button",onClick:B},[v(c.$slots,"done",{},()=>[E(H,{options:u.value},null,8,["options"])])])):(h(),f("div",{key:1,role:"button",onClick:B},[v(c.$slots,"next",{},()=>[E(H,{options:d.value},null,8,["options"])])]))])])]))])],10,Ve))}}),dt=()=>{const a=G(""),e=t=>{t%1===0&&(a.value=t)};return{currentTabIndex:a,onChangeCurrentTab:e,onTabBeforeChange:t=>{a.value===0&&console.log("First Tab"),e(t)},changeBtnIconPosition:()=>{X(()=>{const t=document.querySelector(".fw-footer-left .fw-btn");if(!t)return;const o=t.querySelector("span"),r=t.querySelector("i");!o||!r||(t.removeChild(o),t.removeChild(r),t.appendChild(r),t.appendChild(o))})}}};export{at as P,tt as T,ct as _,Ze as a,it as b,nt as c,ot as d,rt as e,st as g,et as s,dt as u};

System.register(["./vendor-legacy-3R-c_Jgf.js","../index-legacy-uEvp0NYz.js","./ActionButtons.vue_vue_type_script_setup_true_lang-legacy-DWelSMZa.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-_Zoq6ohi.js"],function(e,a){"use strict";var t,r,i,n,o,l,d,s,c,f,u,p,m,v,b,g,h,y,x,w,k,_,z,D,P,I,V,C,j,A,N,S,$,R,q,F,O,W,B,K,M,U,E,L,Y,G,H,T,X,J;return{setters:[e=>{t=e.d,r=e.cp,i=e.r,n=e.c,o=e.a,l=e.O,d=e.f,s=e.J,c=e.l,f=e.u,u=e.a3,p=e.k,m=e.L,v=e.dW,b=e.a4,g=e.a5,h=e.aF,y=e.Y,x=e.Q,w=e.b2,k=e.bF,_=e.N,z=e.bx,D=e.bj,P=e.bq,I=e.aU,V=e.e,C=e.m,j=e.a0,A=e.aj,N=e.F,S=e.P,$=e._,R=e.p,q=e.dX,F=e.K,O=e.W,W=e.bo,B=e.$,K=e.bW,M=e.bw,U=e.a6},e=>{E=e.T,L=e.i,Y=e.P,G=e.ag,H=e.s,T=e.u,X=e._},e=>{J=e._},null,null],execute:function(){var a=document.createElement("style");a.textContent="ion-content[data-v-d7b1aff6],.main-content[data-v-d7b1aff6]{--background: #fff}.full-height-container[data-v-d7b1aff6]{height:100%;display:flex;align-items:center;justify-content:center;padding:1rem;min-height:calc(100vh - 120px)}.centered-content[data-v-d7b1aff6]{width:100%;max-width:1200px;display:flex;flex-direction:column;gap:1rem}.header-section[data-v-d7b1aff6]{text-align:center;margin-bottom:1rem}.header-section .title-container[data-v-d7b1aff6]{display:flex;align-items:center;justify-content:center;gap:.75rem;margin-bottom:.5rem}.header-section .title-icon[data-v-d7b1aff6]{font-size:1.75rem;color:var(--ion-color-primary)}.header-section .page-title[data-v-d7b1aff6]{font-size:2rem;font-weight:700;color:var(--ion-color-dark);margin:0;letter-spacing:-.02em}.header-section .page-subtitle[data-v-d7b1aff6]{font-size:1rem;color:var(--ion-color-dark);margin:0;font-weight:400}.search-card[data-v-d7b1aff6]{margin-bottom:1rem}.search-card .search-content[data-v-d7b1aff6]{padding:0}.search-row[data-v-d7b1aff6]{gap:1rem}.search-col[data-v-d7b1aff6]{padding:0}.patient-section[data-v-d7b1aff6]{height:100%;padding:1rem;border-radius:8px;border:1px solid transparent;transition:all .3s ease;background:#fff}.patient-section.primary-section[data-v-d7b1aff6]{border-color:rgba(76,175,80,.2)}.patient-section.secondary-section[data-v-d7b1aff6]{border-color:rgba(33,150,243,.2)}.patient-section[data-v-d7b1aff6]:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.12)}.section-header[data-v-d7b1aff6]{display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem;flex-wrap:wrap}.section-header .section-icon[data-v-d7b1aff6]{font-size:1.1rem}.section-header .section-icon.primary-icon[data-v-d7b1aff6]{color:var(--ion-color-primary)}.section-header .section-icon.secondary-icon[data-v-d7b1aff6]{color:var(--ion-color-secondary)}.section-header .section-title[data-v-d7b1aff6]{font-weight:600;font-size:1rem;color:var(--ion-color-dark)}.section-header .section-note[data-v-d7b1aff6]{font-size:.8rem;margin-left:auto}.input-group[data-v-d7b1aff6]{display:flex;gap:.75rem;align-items:flex-end;border:1px solid #efefef;border-radius:8px;padding-left:8px}.input-group .patient-input[data-v-d7b1aff6]{flex:1;--border-width: 2px;--highlight-color: var(--ion-color-primary)}.input-group .search-button[data-v-d7b1aff6]{--border-radius: 8px;height:56px;width:56px}.input-group .search-button[data-v-d7b1aff6]:hover{--box-shadow: 0 4px 12px rgba(0, 0, 0, .2)}.preview-card[data-v-d7b1aff6]{margin-bottom:1rem;border-radius:4px;border:1px solid #efefef}.preview-card .preview-content[data-v-d7b1aff6]{padding:1rem}.preview-header[data-v-d7b1aff6]{text-align:center;margin-bottom:1rem}.preview-header .preview-title[data-v-d7b1aff6]{font-size:1.25rem;font-weight:600;color:var(--ion-color-dark);margin:0 0 .5rem}.preview-header .preview-note[data-v-d7b1aff6]{font-size:.9rem}.preview-placeholder[data-v-d7b1aff6]{display:flex;justify-content:center;align-items:center;min-height:20rem;border-radius:12px}.preview-placeholder .placeholder-image[data-v-d7b1aff6]{max-width:100%;height:auto;opacity:.8;border-radius:8px;max-height:19rem}.action-section[data-v-d7b1aff6]{text-align:center}.action-section .merge-button[data-v-d7b1aff6]{--border-radius: 8px;font-weight:600;font-size:1.1rem;margin-bottom:.75rem}.action-section .merge-button[data-v-d7b1aff6]:not([disabled]):hover{transform:translateY(-1px)}.action-section .action-note[data-v-d7b1aff6]{font-size:.9rem;display:block}ion-header[data-v-d7b1aff6]{border-bottom:1px solid transparent}ion-header[data-v-d7b1aff6]:after{background-image:none}ion-card[data-v-d7b1aff6],ion-card-content[data-v-d7b1aff6]{box-shadow:none;--box-shadow: none}.results-container[data-v-d7b1aff6]{margin-top:1rem}.results-section[data-v-d7b1aff6]{margin-bottom:1.5rem}.results-title[data-v-d7b1aff6]{display:flex;align-items:center;margin-bottom:1rem;font-size:1.1rem;font-weight:600;color:var(--ion-color-dark)}.results-icon[data-v-d7b1aff6]{margin-right:.5rem;font-size:1.2rem}.primary-icon[data-v-d7b1aff6]{color:var(--ion-color-primary)}.secondary-icon[data-v-d7b1aff6]{color:var(--ion-color-secondary)}.patient-list[data-v-d7b1aff6]{background:transparent}.patient-item[data-v-d7b1aff6]{--padding-start: 1rem;--padding-end: 1rem;margin-bottom:.5rem;border-radius:8px;transition:all .2s ease;background:#fff}.patient-item.selected[data-v-d7b1aff6]{--background: var(--ion-color-light);border:2px solid var(--ion-color-primary)}.patient-avatar[data-v-d7b1aff6]{--size: 45px;margin-right:1rem}.avatar-placeholder[data-v-d7b1aff6]{border-radius:10px;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:var(--ion-color-primary);color:#fff;font-weight:700;font-size:1.2rem}.patient-name[data-v-d7b1aff6]{font-weight:600;color:var(--ion-color-dark);margin-bottom:.25rem}.patient-details[data-v-d7b1aff6]{display:flex;align-items:center;gap:.5rem;margin-bottom:.25rem;font-size:.9rem;color:var(--ion-color-dark)}.gender-badge[data-v-d7b1aff6]{font-size:.7rem;padding:.2rem .4rem}.patient-ids[data-v-d7b1aff6],.patient-location[data-v-d7b1aff6]{font-size:.8rem;color:var(--ion-color-dark-shade);margin-bottom:.1rem}.selected-icon[data-v-d7b1aff6]{font-size:1.5rem}.search-button[data-v-d7b1aff6]{min-width:44px}.search-button ion-spinner[data-v-d7b1aff6]{--color: white}.scrollable-list[data-v-d7b1aff6]{max-height:400px;overflow-y:auto;border:1px solid var(--ion-color-light-shade);border-radius:8px}.results-title[data-v-d7b1aff6]{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem;font-size:1.1rem;font-weight:600;color:var(--ion-color-dark)}.selection-count[data-v-d7b1aff6]{font-size:.7rem;padding:.3rem .6rem;margin-left:auto}.scrollable-list[data-v-d7b1aff6]{max-height:400px;overflow-y:auto;border:1px solid var(--ion-color-light-shade);border-radius:8px;background:transparent}.patient-item[data-v-d7b1aff6]{--padding-start: 1rem;--padding-end: 1rem;margin-bottom:.5rem;border-radius:8px;transition:all .2s ease}.patient-item.selected[data-v-d7b1aff6]{--background: var(--ion-color-light);border:2px solid var(--ion-color-secondary);transform:translate(4px)}.patient-item[data-v-d7b1aff6]:hover{--background: var(--ion-color-light-tint)}.merge-count[data-v-d7b1aff6]{margin-left:.5rem;font-size:.8rem;font-weight:600}.action-note[data-v-d7b1aff6]{font-size:.9rem;display:block;max-width:600px;margin:0 auto;line-height:1.4}.scrollable-list[data-v-d7b1aff6]::-webkit-scrollbar{width:6px}.scrollable-list[data-v-d7b1aff6]::-webkit-scrollbar-track{background:var(--ion-color-light);border-radius:3px}.scrollable-list[data-v-d7b1aff6]::-webkit-scrollbar-thumb{background:var(--ion-color-dark);border-radius:3px}.scrollable-list[data-v-d7b1aff6]::-webkit-scrollbar-thumb:hover{background:var(--ion-color-dark-shade)}.patient-item.selected .patient-name[data-v-d7b1aff6]{color:var(--ion-color-secondary);font-weight:700}.patient-item.selected .avatar-placeholder[data-v-d7b1aff6]{background:var(--ion-color-secondary)}.primary-results .patient-item.selected[data-v-d7b1aff6]{border-color:var(--ion-color-primary)}.primary-results .patient-item.selected .patient-name[data-v-d7b1aff6]{color:#10a200}.primary-results .patient-item.selected .avatar-placeholder[data-v-d7b1aff6]{background:#10a200}\n/*$vite$:1*/",document.head.appendChild(a);const Q={class:"full-height-container"},Z={class:"centered-content"},ee={class:"header-section"},ae={class:"title-container"},te={class:"search-card",mode:"ios"},re={class:"search-content"},ie={class:"patient-section primary-section"},ne={class:"section-header"},oe={class:"input-group"},le={class:"patient-section secondary-section"},de={class:"section-header"},se={class:"input-group"},ce={class:"preview-header"},fe={key:0,class:"results-container"},ue={class:"results-section primary-results"},pe={class:"results-title"},me={class:"avatar-placeholder"},ve={class:"patient-name"},be={class:"patient-details"},ge={class:"patient-ids"},he={class:"patient-location"},ye={class:"results-section secondary-results"},xe={class:"results-title"},we={class:"avatar-placeholder"},ke={class:"patient-name"},_e={class:"patient-details"},ze={class:"patient-ids"},De={class:"patient-location"},Pe={key:1,class:"preview-placeholder"},Ie={class:"action-section"};e("default",X(t({__name:"MergePatients",setup(e){const a=r(),t=i(),X=i(""),Ve=i(!1),Ce=i(!1),je=i(""),Ae=i([]),Ne=i([]),Se=i([]),$e=i(null),Re=n(()=>$e.value&&Se.value.length>0),qe=n(()=>Ae.value.length>0||Ne.value.length>0),Fe=async(e,a=!0)=>{if(!e.trim())return;const t=a?Ve:Ce,r=a?Ae:Ne;t.value=!0,r.value=[];try{const[a,t]=e.trim().split(" "),i={...a&&{given_name:a},...t&&{family_name:t}},n=await Y.search(i);r.value=await Promise.all(n.map(async(e,a)=>{const t=T();await t.setPatientRecord(e);const r=new Y;return{index:a,id:r.getID(),name:r.getFullName()||"Unknown",docID:r.getDocID()||"NA",birthdate:r.getBirthdate(),arvNum:r.getArvNumber(),npid:r.getNationalID(),gender:r.getGender(),homeDistrict:r.getHomeDistrict(),homeVillage:r.getHomeVillage(),currentDistrict:r.getCurrentDistrict(),currentVillage:r.getCurrentVillage(),isChecked:!1}}))}catch(i){console.error("Patient search failed:",i),r.value=[]}finally{t.value=!1}},Oe=()=>{Fe(X.value,!0)},We=()=>{Se.value=[],Fe(je.value,!1)},Be=e=>Se.value.some(a=>a.id===e),Ke=e=>e?new Date(e).toLocaleDateString():"N/A",Me=e=>"m"===e.toLowerCase()?"primary":"secondary",Ue=async()=>{if(Re.value&&await L(`Are you sure you want to merge selected ${Se.value.length} secondary patient(s) to merge with primary patient.`))try{const e=await Y.mergePatients({primary:{patient_id:$e.value.id,doc_id:$e.value.docID},secondary:Se.value.map(e=>({patient_id:e.id,doc_id:e.docID}))});await G(e.patient_id),Ae.value=[],Ne.value=[],$e.value=[],Se.value=[],X.value="",je.value=""}catch(e){H(`${e}`)}};return o(()=>{(()=>{const e=a.query.q;e&&e.trim()&&(X.value=e.trim(),je.value=e.trim(),Fe(e.trim(),!0),Fe(e.trim(),!1))})(),!a.query.q&&t.value&&setTimeout(()=>{t.value.$el.setFocus()},200)}),(e,a)=>(d(),l(f(U),null,{default:s(()=>[c(E),c(J),c(f(u),{fullscreen:!0,class:"main-content"},{default:s(()=>[p("div",Q,[p("div",Z,[p("div",ee,[p("div",ae,[c(f(m),{icon:f(v),class:"title-icon"},null,8,["icon"]),a[3]||(a[3]=p("h1",{class:"page-title"},"Merge Clients",-1))]),a[4]||(a[4]=p("p",{class:"page-subtitle"},"Select primary and secondary patients to merge their records",-1))]),p("div",te,[p("div",re,[c(f(b),{class:"search-row"},{default:s(()=>[c(f(g),{class:"search-col"},{default:s(()=>[p("div",ie,[p("div",ne,[c(f(m),{icon:f(h),class:"section-icon primary-icon"},null,8,["icon"]),a[6]||(a[6]=p("span",{class:"section-title"},"Primary Patient",-1)),c(f(y),{class:"section-note"},{default:s(()=>[...a[5]||(a[5]=[x("Main record",-1)])]),_:1})]),p("div",oe,[c(f(w),{ref_key:"primaryInputRef",ref:t,modelValue:X.value,"onUpdate:modelValue":a[0]||(a[0]=e=>X.value=e),label:"Search primary patient","label-placement":"floating",fill:"outline",placeholder:"Enter patient name or ID",class:"patient-input",onKeyup:k(Oe,["enter"])},null,8,["modelValue"]),c(f(_),{fill:"solid",color:"primary",class:"search-button",disabled:Ve.value||!X.value.trim(),onClick:Oe},{default:s(()=>[Ve.value?(d(),l(f(z),{key:0,name:"crescent"})):(d(),l(f(m),{key:1,icon:f(D)},null,8,["icon"]))]),_:1},8,["disabled"])])])]),_:1}),c(f(g),{class:"search-col"},{default:s(()=>[p("div",le,[p("div",de,[c(f(m),{icon:f(h),class:"section-icon secondary-icon"},null,8,["icon"]),a[8]||(a[8]=p("span",{class:"section-title"},"Secondary Patient",-1)),c(f(y),{class:"section-note"},{default:s(()=>[...a[7]||(a[7]=[x("Will be merged into primary",-1)])]),_:1})]),p("div",se,[c(f(w),{modelValue:je.value,"onUpdate:modelValue":a[1]||(a[1]=e=>je.value=e),label:"Search secondary patient","label-placement":"floating",fill:"outline",placeholder:"Enter patient name or ID",class:"patient-input",onKeyup:k(We,["enter"])},null,8,["modelValue"]),c(f(_),{fill:"solid",color:"secondary",class:"search-button",disabled:Ce.value||!je.value.trim(),onClick:We},{default:s(()=>[Ce.value?(d(),l(f(z),{key:0,name:"crescent"})):(d(),l(f(m),{key:1,icon:f(D)},null,8,["icon"]))]),_:1},8,["disabled"])])])]),_:1})]),_:1})])]),c(f(P),{class:"preview-card",mode:"ios"},{default:s(()=>[c(f(I),{class:"preview-content"},{default:s(()=>[p("div",ce,[a[10]||(a[10]=p("h2",{class:"preview-title"},"Patient Search Results",-1)),c(f(y),{class:"preview-note"},{default:s(()=>[...a[9]||(a[9]=[x("Select patients from search results to preview merge",-1)])]),_:1})]),qe.value?(d(),V("div",fe,[c(f(b),null,{default:s(()=>[Ae.value.length>0?(d(),l(f(g),{key:0},{default:s(()=>{var e;return[p("div",ue,[p("h3",pe,[c(f(m),{icon:f(h),class:"results-icon primary-icon"},null,8,["icon"]),a[11]||(a[11]=x(" Primary Patient Options ",-1))]),c(f(j),{value:null===(e=$e.value)||void 0===e?void 0:e.id,onIonChange:a[2]||(a[2]=e=>{return a=Ae.value.find(a=>a.id===e.detail.value),void($e.value=a);var a})},{default:s(()=>[c(f(A),{class:"patient-list scrollable-list ion-padding"},{default:s(()=>[(d(!0),V(N,null,S(Ae.value,e=>{var a;return d(),l(f($),{key:e.id,class:R(["patient-item",{selected:(null===(a=$e.value)||void 0===a?void 0:a.id)===e.id}]),lines:"none"},{default:s(()=>[c(f(q),{class:"patient-avatar"},{default:s(()=>[p("div",me,F(e.name.charAt(0)),1)]),_:2},1024),c(f(O),null,{default:s(()=>[p("h3",ve,F(e.name),1),p("p",be,[c(f(W),{color:Me(e.gender),class:"gender-badge"},{default:s(()=>[x(F(e.gender),1)]),_:2},1032,["color"]),x(" DOB: "+F(Ke(e.birthdate)),1)]),p("p",ge,"ID: "+F(e.id)+" | ARV: "+F(e.arvNum||"N/A"),1),p("p",he,F(e.currentDistrict)+", "+F(e.currentVillage),1)]),_:2},1024),c(f(B),{value:e.id,color:"primary"},{default:s(()=>{var a;return[(null===(a=$e.value)||void 0===a?void 0:a.id)===e.id?(d(),l(f(m),{key:0,icon:f(K),color:"primary",class:"selected-icon"},null,8,["icon"])):C("",!0)]}),_:2},1032,["value"])]),_:2},1032,["class"])}),128))]),_:1})]),_:1},8,["value"])])]}),_:1})):C("",!0),Ne.value.length>0?(d(),l(f(g),{key:1},{default:s(()=>[p("div",ye,[p("h3",xe,[c(f(m),{icon:f(h),class:"results-icon secondary-icon"},null,8,["icon"]),a[12]||(a[12]=x(" Secondary Patient Options ",-1)),Se.value.length>0?(d(),l(f(W),{key:0,color:"secondary",class:"selection-count"},{default:s(()=>[x(F(Se.value.length)+" selected ",1)]),_:1})):C("",!0)]),c(f(A),{class:"patient-list scrollable-list ion-padding"},{default:s(()=>[(d(!0),V(N,null,S(Ne.value,e=>(d(),l(f($),{key:e.id,class:R(["patient-item",{selected:Be(e.id)}]),lines:"none"},{default:s(()=>[c(f(q),{class:"patient-avatar"},{default:s(()=>[p("div",we,F(e.name.charAt(0)),1)]),_:2},1024),c(f(O),null,{default:s(()=>[p("h3",ke,F(e.name),1),p("p",_e,[c(f(W),{color:Me(e.gender),class:"gender-badge"},{default:s(()=>[x(F(e.gender),1)]),_:2},1032,["color"]),x(" DOB: "+F(Ke(e.birthdate)),1)]),p("p",ze,"ID: "+F(e.id)+" | ARV: "+F(e.arvNum||"N/A"),1),p("p",De,F(e.currentDistrict)+", "+F(e.currentVillage),1)]),_:2},1024),c(f(M),{checked:Be(e.id),color:"secondary",onIonChange:a=>((e,a)=>{a?Se.value.find(a=>a.id===e.id)||Se.value.push(e):Se.value=Se.value.filter(a=>a.id!==e.id)})(e,a.detail.checked)},null,8,["checked","onIonChange"])]),_:2},1032,["class"]))),128))]),_:1})])]),_:1})):C("",!0)]),_:1})])):(d(),V("div",Pe,[...a[13]||(a[13]=[p("img",{src:"/assets/merge-patient-search-placeholder.grGtXK01.png",alt:"Patient search placeholder",class:"placeholder-image"},null,-1)])]))]),_:1})]),_:1}),p("div",Ie,[c(f(_),{expand:"block",size:"large",color:"success",class:"merge-button",disabled:!Re.value,onClick:Ue},{default:s(()=>[c(f(m),{icon:f(v)},null,8,["icon"]),a[14]||(a[14]=x(" Merge Selected Patients ",-1)),Se.value.length>1?(d(),l(f(W),{key:0,color:"light",class:"merge-count"},{default:s(()=>[x(" 1 â†’ "+F(Se.value.length),1)]),_:1})):C("",!0)]),_:1},8,["disabled"]),c(f(y),{class:"action-note"},{default:s(()=>[x(F(Re.value?`Ready to merge ${Se.value.length} secondary patient(s) into primary patient`:"Select one primary patient and at least one secondary patient to enable merge"),1)]),_:1})])])])]),_:1})]),_:1}))}}),[["__scopeId","data-v-d7b1aff6"]]))}}});

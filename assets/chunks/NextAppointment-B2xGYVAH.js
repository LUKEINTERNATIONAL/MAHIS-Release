var Dt=Object.defineProperty;var bt=(e,a,t)=>a in e?Dt(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t;var Ne=(e,a,t)=>bt(e,typeof a!="symbol"?a+"":a,t);import{O as re,bq as qe,t as pe,b as te,n as ee,_ as oe,br as Ct,aV as be,a1 as B,aX as Me,K as J,G as Pe,S as U,F as Le,a_ as Ze,B as et,bh as It,g as ke,aq as $,bb as ze,H as z,u as _e,y as we,z as St,C as At,aY as Re,W as wt,bs as Et,bt as Ot,bu as Tt,bv as Lt,bw as kt,bx as Ht,by as Bt,P as tt,bz as Ve,bA as Pt,bB as Nt,bC as Mt,bD as Rt,x as Vt,e as xt,a9 as $t,q as Ft,a2 as zt,b5 as Ut,k as Gt,o as at,J as Wt,a4 as qt,bg as Yt,ab as jt,bE as Qt,bF as Kt,aC as Xt,bG as se,A as Ee,bH as Jt,b9 as Zt,f as ea,aK as xe,U as ta,aL as aa,a as Ye}from"../index-CPIhguZJ.js";import{d as K,bh as me,r as w,a as ue,G as M,Q,f as _,H as r,l as i,k as b,e as L,F as ge,T as Se,m as F,u as h,D as na,w as Z,ax as fe,bk as sa,a4 as He,ay as nt,az as st,aA as it,ak as Ge,al as he,K as ot,L as lt,bo as ia,b6 as oa,a3 as Y,c as ae,aj as je,bH as rt,au as $e,ad as Ce,av as le,aC as la,aB as ra,a5 as Ae,I as q,bL as da,ac as dt,bu as ca,b7 as ct,z as Ie,aF as ut,cr as pt,i as Oe,v as Te,M as ua,N as Ue,p as ve,b5 as pa,S as ma,P as Qe,J as ga,bF as ha,b_ as va,b2 as fa}from"./vendor-CJ2tyHrn.js";import mt from"./LabOrdersList-DT-nxfOM.js";import{v as Be}from"./group_validation-Crr58cZF.js";import{u as _a}from"./RadiologyStore-BdyLHyrH.js";import{B as ie}from"./BasicForm-BEa7BD3q.js";import{l as gt}from"./lodash-NJiRuGo9.js";import{b as ya,c as Da,f as ba}from"./formatServerData-C4-2caW3.js";import{D as ht}from"./DashBox-6RT18Q5Q.js";import{u as Ca,p as Ia}from"./previousComplaints-yArM2eha.js";import{P as Sa}from"./patient_complaints_service-4HB_6iqv.js";import{u as Aa,_ as wa}from"./useFormWizard-CAiBa2il.js";import{a as Ke}from"./user_role_management-C_d1iPJp.js";import{u as Ea}from"./useUserActivities-DlNwy1Si.js";import{u as Oa,a as Xe}from"./nonPharmaTherapyStore-CAVSqzBF.js";import{A as Ta}from"./ncd_appointment_service-BMjAPhMQ.js";import{D as La}from"./DateInputField-BPowwEHU.js";class vt extends re{constructor(){super()}async postActivities(a,t){const l=t.location_id,d=await new qe(parseInt(a),-1,l).createEncounter();if(d){const v=await re.buildLabOrders(d,t.orders||t);if(!await re.saveOrdersArray(d.encounter_id,v))return pe("Unable to save lab orders")}}async postAHDActivities(a,t){const l=t.location_id,d=await new qe(parseInt(a),-1,l).createEncounter(te.AHD_LAB_ORDERS);if(d){const v=await re.buildLabOrders(d,t.orders||t);if(!await re.saveOrdersArray(d.encounter_id,v))return pe("Unable to save lab orders")}}}const ka=["innerHTML"],Ha={class:"scrollable-container"},Ba={key:0,class:"form-section"},Pa={key:1,class:"form-section"},Na={key:2,class:"form-section"},Ma={key:3,class:"form-section"},Ra={key:4,class:"form-section"},Va={key:5,class:"form-section"},xa={key:6,class:"form-section"},$a={key:7,class:"form-section"},Fa=K({__name:"RadiologyInvestigation",setup(e){const a=_a(),{head:t,neck:l,chest:u,abdomen:d,upper_extremity:v,spine:s,pelvis:T,lower_extremity:S}=me(a),f=w(ee),A=w([]),E=(O,y,P)=>{document.querySelectorAll("#".concat(O," path")).forEach(D=>{D.classList.toggle("white-fill")}),document.querySelectorAll("#".concat(y," line")).forEach(D=>{D.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(y," rect")).forEach(D=>{D.classList.toggle("bright-green-fill"),D.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(y," path")).forEach(D=>{D.classList.toggle("dark-green-fill")}),document.querySelectorAll("#".concat(y," circle")).forEach(D=>{D.classList.toggle("bright-green-fill")});const G=A.value.findIndex(D=>D.id===P);G>=0?A.value.splice(G,1):A.value.unshift({id:P,active:!0})},R=()=>{const O=document.getElementById("SPINE");O.style.display==="none"||O.style.display==""?O.style.display="block":O.style.display="none",E("SPINE","SPINE_LABEL-2","spine")};return ue(()=>{const O=document.getElementById("HEAD");O&&O.addEventListener("click",()=>{E("HEAD","LABEL-6","head")});const y=document.getElementById("NECK");y&&y.addEventListener("click",()=>{E("NECK","LABEL-5","neck")});const P=document.getElementById("CHEST");P&&P.addEventListener("click",()=>{E("CHEST","LABEL-4","chest")});const G=document.getElementById("ABDOMEN_LABEL");G&&G.addEventListener("click",()=>{const I=document.getElementById("ABDOMEN-2");I.style.display==="none"||I.style.display==""?I.style.display="block":I.style.display="none",E("ABDOMEN","ABDOMEN_LABEL-2","abdomen")});const D=document.getElementById("UPPER_EXTRMITY");D&&D.addEventListener("click",()=>{E("UPPER_EXTRMITY","LABEL-3","upper_extremity")});const W=document.getElementById("SPINE"),H=document.getElementById("SPINE_LABEL"),g=document.getElementById("LOWER_SPINE_INACTIVE");W&&W.addEventListener("click",()=>{R()}),H&&H.addEventListener("click",()=>{R()}),g&&g.addEventListener("click",()=>{R()});const m=document.getElementById("PELVIS");m&&m.addEventListener("click",()=>{E("PELVIS","LABEL-2","pelvis")});const c=document.getElementById("LOWER_EXTREMITY");c&&c.addEventListener("click",()=>{E("LOWER_EXTREMITY","LABEL","lower_extremity")})}),(O,y)=>{const P=M("ion-col"),G=M("ion-row");return _(),Q(G,null,{default:r(()=>[i(P,{size:"7"},{default:r(()=>[b("div",{innerHTML:f.value.full_body_sk},null,8,ka)]),_:1}),i(P,{size:"5",class:"form-column"},{default:r(()=>[b("div",Ha,[(_(!0),L(ge,null,Se(A.value,D=>(_(),L(ge,null,[D.id==="head"?(_(),L("div",Ba,[y[0]||(y[0]=b("h6",null,"Body Part: Head",-1)),i(ie,{contentData:h(t)},null,8,["contentData"])])):D.id==="neck"?(_(),L("div",Pa,[y[1]||(y[1]=b("h6",null,"Body Part: Neck",-1)),i(ie,{contentData:h(l)},null,8,["contentData"])])):D.id==="chest"?(_(),L("div",Na,[y[2]||(y[2]=b("h6",null,"Body Part: Chest",-1)),i(ie,{contentData:h(u)},null,8,["contentData"])])):D.id==="abdomen"?(_(),L("div",Ma,[y[3]||(y[3]=b("h6",null,"Body Part: Abdomen",-1)),i(ie,{contentData:h(d)},null,8,["contentData"])])):D.id==="upper_extremity"?(_(),L("div",Ra,[y[4]||(y[4]=b("h6",null,"Body Part: Upper Extremity",-1)),i(ie,{contentData:h(v)},null,8,["contentData"])])):D.id==="spine"?(_(),L("div",Va,[y[5]||(y[5]=b("h6",null,"Body Part: Spine",-1)),i(ie,{contentData:h(s)},null,8,["contentData"])])):D.id==="pelvis"?(_(),L("div",xa,[y[6]||(y[6]=b("h6",null,"Body Part: Pelvis",-1)),i(ie,{contentData:h(T)},null,8,["contentData"])])):D.id==="lower_extremity"?(_(),L("div",$a,[y[7]||(y[7]=b("h6",null,"Body Part: Lower Extremity",-1)),i(ie,{contentData:h(S)},null,8,["contentData"])])):F("",!0)],64))),256))])]),_:1})]),_:1})}}}),ft=oe(Fa,[["__scopeId","data-v-5ab54fe8"]]),Je=[{selectedData:[],initial:[],isFinishBtn:!1,classDash:"dashed_bottom_border",checkboxBtnContent:{header:{title:"Existing Chronic Health Conditions",class:"bold",selectedValue:"",name:"Chronic disease"},data:[{name:"TB",value:"TB",checked:!1}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"TB",radioBtnContent:{header:{title:"On TB medication",name:"TB treatment",selectedValue:"",displayNext:"Yes",displayNone:!0,class:"bold"},data:[{name:"Yes",value:"Yes",colSize:3},{name:"No",value:"No",colSize:3}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"TB treatment",data:{rowData:[{colData:[{displayNone:!0,inputHeader:"Select medication",class:"bold",icon:ee.search,popOver:!0,value:"",valueType:"text",name:"TB drugs",eventType:"input",required:!0,alertsErrorMassage:"",popOverData:{filterData:!0,data:[]},id:"",idName:"medication"},{inputHeader:"Start date",class:"bold",icon:ee.calendar,popOver:!0,value:"",valueType:"text",name:"TB drug start date",eventType:"input",required:!0,alertsErrorMassage:"",id:"",idName:"startDate",placeholder:"Pick the date",isDatePopover:!0}]}]}},{selectedData:[],isFinishBtn:!1,classDash:"dashed_bottom_border",checkboxBtnContent:{header:{title:"",selectedValue:"",name:"Chronic disease"},data:[{name:"Chronic Obstructive Pulmonary Disease (COPD)",value:"Chronic obstructive pulmonary disease",checked:!1}]}},{selectedData:[],classDash:"dashed_bottom_border",checkboxBtnContent:{header:{title:"",selectedValue:"",name:"Chronic disease"},data:[{name:"Asthma",value:"Asthma",checked:!1}]}},{selectedData:[],classDash:"dashed_bottom_border",checkboxBtnContent:{header:{title:"",selectedValue:"",name:"Chronic disease"},data:[{name:"Epilepsy",value:"Epilepsy",checked:!1}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"Previous stroke",value:"Stroke",checked:!1}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"Peptic Ulcer Disease (PUD)",value:"Peptic ulcer disease",checked:!1}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"Mental disorder",value:"Mental disorders",checked:!1}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{colSize:4.8,name:"Bleeding disorders",value:"Bleeding disorders",checked:!1}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"Hypertension",value:"Hypertension",checked:!1}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"Hypertension",radioBtnContent:{header:{title:"On medication",name:"Hypertension medication",class:"bold",selectedValue:"",displayNext:"Yes",displayNone:!0},data:[{name:"Yes",value:"Yes",colSize:3},{name:"No",value:"No",colSize:3}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"Hypertension medication",data:{rowData:[{colData:[{inputHeader:"Select medication",icon:ee.search,class:"bold",popOver:!0,displayNone:!0,value:"",valueType:"text",name:"Current hypertension treatment regimen",eventType:"input",required:!0,alertsErrorMassage:"",popOverData:{filterData:!1,data:[]},id:"",idName:"medication"}]}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"HIV Positive",value:"HIV pos",checked:!1}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"HIV Positive",radioBtnContent:{header:{title:"Is the patient on ART",name:"HIV status",selectedValue:"",class:"bold",displayNone:!0,displayNext:"Yes"},data:[{name:"Yes",value:"Yes",colSize:3},{name:"No",value:"No",colSize:3}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"HIV status",data:{rowData:[{colData:[{class:"bold",inputHeader:"Enter ARV start date",icon:ee.calendar,popOver:!0,displayNone:!0,value:"",valueType:"text",name:"ARV start date",eventType:"input",required:!0,alertsErrorMassage:"",idName:"medication",placeholder:"Pick the date",isDatePopover:!0}]}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"Diabetes Mellitus",value:"Diabetes Mellitus",checked:!1}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"Diabetes Mellitus",radioBtnContent:{header:{class:"bold",title:"Type",name:"Diabetes",selectedValue:"",displayNone:!0},data:[{name:"Type I",value:"Type 1 diabetes",colSize:4},{name:"Type II",value:"Type 2 diabetes",colSize:4},{name:"Unsure",value:"Unknown",colSize:4}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"Diabetes Mellitus",radioBtnContent:{header:{class:"bold",title:"Controlled by",name:"Controlled by",selectedValue:"",displayNone:!0},data:[{name:"Diet",value:"Diet",colSize:4},{name:"Tablets",value:"Tablets",colSize:4},{name:"Insulin",value:"Insulin",colSize:4}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"None",value:"None"}]}}],za=na("pastMedicalHistoryStore",{state:()=>({pastMedicalHistory:[...Je]}),actions:{setPastMedicalHistory(e){this.pastMedicalHistory=e},getInitial(){return[...gt.cloneDeep(Je)]}},persist:!0}),Ua={class:"modal_wrapper"},Ga={class:"uniform_columns"},Wa=K({__name:"AHDPastMedicalHistory",setup(e,{expose:a}){const t=za(),{pastMedicalHistory:l}=me(t),u=w([]);ue(()=>{u.value=t.getInitial(),d()}),Z(l,()=>{d()},{deep:!0});const d=()=>{var f;const S=["TB","Chronic Obstructive Pulmonary Disease (COPD)","Asthma","Epilepsy","Previous stroke","Peptic Ulcer Disease (PUD)","Mental disorder","Bleeding disorders","Hypertension","HIV Positive","Diabetes Mellitus"];(f=Ct(l.value,"None"))!=null&&f.checked?S.forEach(A=>{be(l.value,"TB treatment","displayNone",!0),B(l.value,"TB drugs","displayNone",!0),B(l.value,"TB drug start date","displayNone",!0),be(l.value,"Hypertension medication","displayNone",!0),B(l.value,"Current hypertension treatment regimen","displayNone",!0),be(l.value,"HIV status","displayNone",!0),B(l.value,"ARV start date","displayNone",!0),be(l.value,"Diabetes","displayNone",!0),be(l.value,"Controlled by","displayNone",!0),Me(l.value,A,"checked",!1),Me(l.value,A,"disabled",!0)}):S.forEach(A=>{Me(l.value,A,"disabled",!1)})},v=S=>{B(l.value,"TB drugs","popOverData",{filterData:!0,data:[{name:"Auramine 'O' (C.I. 41000) 50g"},{name:"Bedaquilline 100mg"},{name:"Clofazimine 100mg"},{name:"Clofazimine 50mg"},{name:"Cycloserine 125mg"},{name:"Cycloserine 250mg"},{name:"Delamanid 50mg"},{name:"Ethambutol 100mg"},{name:"Ethambutol 400mg"},{name:"Ethionamide 250mg"},{name:"Isoniazid 100mg "},{name:"Isoniazid 300mg"},{name:"Isoniazid / Rifapentine 300mg / 300mg"},{name:"Levofloxacin 100mg"},{name:"Levofloxacin 250mg"},{name:"Linezolid 600mg"},{name:"Moxifloxacin 400mg"},{name:"Pyrazinamide 400mg"},{name:"Rifabutin 150mg Capsules"},{name:"Rifampicin 150mg/isoniazid 75mg"},{name:"Rifampicin 75mg+INH 50mg dispersible"},{name:"Rifampicin 75mg+INH 50mg+Pyrazinamide 150mg dispersible"},{name:"Rifampicin150mg/Isoniazid75mg/Pyrazinamide 400mg/Ethambutol"}]}),B(l.value,"Current hypertension treatment regimen","popOverData",{filterData:!0,data:[{name:"Captopril 12.5mg"},{name:"Aspirin 75mg"},{name:"Hydrochlorothiazide 25mg"},{name:"Enalapril Meleate 5mg"},{name:"Enalapril Maleate 10mg"}]})},s=async()=>[...await ya(l.value),...await Da(l.value),...await ba(l.value)];return a({onSubmit:async()=>{const S=await s();if(S.length===0){pe("No past medical history data to save");return}await J.addObsToEncounterPatient(S,te.AHD_PAST_MEDICAL_HISTORY),Pe("Past medical history saved successful")}}),(S,f)=>(_(),L("div",Ua,[b("div",Ga,[i(ie,{contentData:h(l),initialData:u.value,"onUpdate:inputValue":v,"onUpdate:selected":v},null,8,["contentData","initialData"])])]))}}),qa=oe(Wa,[["__scopeId","data-v-e5153372"]]),Ya=K({data:()=>({userRole:"",ready:!1,userRoleSettings:{}}),watch:{$route:{async handler(e){this.userRole=U.getUserRoles();const a=U.getProgramID(),t=U.getProgramName();this.userRole=="Lab"&&a==14&&(this.userRoleSettings={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}),a==14&&this.userRole!="Lab"&&(this.userRoleSettings={url:"home",btnName:"Go to waiting list",stepperTitle:"Consultation Plan"}),a==12&&(this.userRoleSettings={url:"contact",btnName:"Back"}),t=="LABOUR AND DELIVERY PROGRAM"&&(this.userRoleSettings={url:"labour/labourHome",btnName:"Back to home"}),t=="PNC PROGRAM"&&(this.userRoleSettings={url:"pnc/home",btnName:"Back to home"})},immediate:!0,deep:!0}}}),ja=K({name:"Menu",mixins:[Ya],components:{IonContent:lt,IonHeader:ot,IonItem:he,IonList:Ge,IonMenu:it,IonTitle:st,IonToolbar:nt,IonInput:He,IonPopover:sa,DashBox:ht,SelectionPopover:It,BasicInputField:et,BasicForm:ie,List:Ze,DynamicButton:Le,LabOrdersList:mt,RadiologyInvestigation:ft},data(){return{segmentContent:"Lab Investigations",iconsContent:ee,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",testResult:"",test:"",labOrders:"",filteredSpecimen:"",testData:[],popoverOpen:!1,labOrderStatus:!1,event:"",specimen:"",radiologyOrdersStatus:!1,otherOrdersStatus:!1}},setup(){return{checkmark:oa,pulseOutline:ia}},computed:{...fe(ze,["investigations"]),...fe(_e,["patient"]),inputFields(){return this.investigations[0].data.rowData[0].colData}},watch:{investigations:{handler(){this.setDashedBox()},deep:!0},patient:{async handler(){var e;(e=this.patient)!=null&&e.labOrders&&(this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved])},deep:!0},$route:{async handler(){await this.getTests()},deep:!0}},async mounted(){await this.getTests(),this.updateInvestigationsStores(),this.setDashedBox(),this.updateInvestigationWizard()},methods:{setSegmentContent(e){this.segmentContent=e},async getTests(){let e;U.getPouchDbStatus()&&U.getLanConnectionStatus()?e=await ke("test_types"):e=await re.getTestTypes(),B(this.investigations,"test","multiSelectData",e)},toggleLabOrderStatus(){this.labOrderStatus=!this.labOrderStatus},async updateInvestigationWizard(){var a;if(!((a=this.patient)!=null&&a.labOrders))return;this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved];const e=await this.labOrders.filter(t=>z.toStandardHisFormat(z.sessionDate())===z.toStandardHisFormat(t.order_date));e.length>0?this.investigations[0].selectedData=e:this.investigations[0].selectedData=""},async updateInvestigationsStores(){await this.updateInvestigationWizard(),ze().setInvestigations(this.investigations)},displayInputFields(){this.testResult="",this.selectedText="",this.no_item=!1,this.addItemButton=!1,this.search_item=!0},async validateRowData(){return Be(this.investigations)},async checkTest(){return await this.isNameInData(this.inputFields[0].value.name,await this.investigations[0].selectedData)?(B(this.investigations,"test","alertsErrorMassage","Lab order already selected"),!1):(B(this.investigations,"test","alertsErrorMassage",""),!0)},async addNewRow(){Be(this.investigations)&&await this.checkTest()&&(await this.saveTest(),this.investigations[0].data.rowData[0].colData[0].value="",this.investigations[0].data.rowData[0].colData[1].value="",this.search_item=!1,this.display_item=!0,this.addItemButton=!0),this.updateInvestigationWizard()},isNameInData(e,a){for(let t of a)for(let l of t.tests)if(l.name===e)return!0;return!1},async saveTest(){await new vt().postAHDActivities(this.patient.patientID,[{concept_id:this.inputFields[0].value.concept_id,name:this.inputFields[0].value.name,specimen:this.inputFields[1].value.name,reason:"Routine",specimenConcept:await $.getConceptID(this.inputFields[1].value.name,!0)}]),B(this.investigations,"specimen","disabled",!0),this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved]},async handleInputData(e){if(e.inputHeader=="Test"&&this.checkTest(),B(this.investigations,"specimen","alertsErrorMassage",""),e.inputHeader=="Test"&&e.value){let a;U.getPouchDbStatus()&&U.getLanConnectionStatus()?a=await ke("specimens"):a=await re.getSpecimens("",1e3),this.specimen=await $.getConceptSet(e.value.name,"",{names:a.map(t=>t.name)}),this.specimen.length==1?(B(this.investigations,"specimen","value",this.specimen[0]),B(this.investigations,"specimen","disabled",!0)):(B(this.investigations,"specimen","value",""),B(this.investigations,"specimen","disabled",!1)),B(this.investigations,"specimen","multiSelectData",this.specimen)}},async filterTest(e){return await this.labOrders.filter(a=>a.name.toLowerCase().includes(e.toLowerCase()))},async filterSpecimen(e){var a;return(a=this.specimen[0])!=null&&a.name&&e?await this.specimen.filter(t=>t==null?void 0:t.name.toLowerCase().includes(e.toLowerCase())):[]},setTest(e){this.selectedText=e.name,this.inputFields[1].inputHeader=="Test"?this.investigations[0].data.rowData[0].colData[0].value=e.name:this.investigations[0].data.rowData[0].colData[1].value=e.name,this.updateInvestigationsStores()},setDashedBox(){(this.inputFields[1].value||this.inputFields[0].value)&&(this.addItemButton=!1,this.search_item=!0,this.no_item=!1),this.investigations[0].selectedData.length>0?(this.display_item=!0,this.no_item=!1):this.search_item||(this.no_item=!0)}}}),Qa={class:"background"},Ka={key:0},Xa={key:1},Ja={key:2},Za={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},en={key:3},tn={class:"ion-padding",slot:"content"},an={key:4};function nn(e,a,t,l,u,d){const v=M("ion-label"),s=M("ion-segment-button"),T=M("ion-segment"),S=M("VisitsHistory"),f=M("LabOrdersList"),A=M("RadiologyInvestigation");return _(),L("div",Qa,[i(T,{value:e.segmentContent,style:{"margin-top":"5px"}},{default:r(()=>[i(s,{value:"Lab Investigations",onClick:a[0]||(a[0]=E=>e.setSegmentContent("Lab Investigations"))},{default:r(()=>[i(v,null,{default:r(()=>[...a[3]||(a[3]=[Y("Lab Investigations",-1)])]),_:1})]),_:1}),i(s,{value:"Radiology Investigation",onClick:a[1]||(a[1]=E=>e.setSegmentContent("Radiology Investigation"))},{default:r(()=>[i(v,null,{default:r(()=>[...a[4]||(a[4]=[Y("Radiology Investigation",-1)])]),_:1})]),_:1}),i(s,{value:"Other Investigation",onClick:a[2]||(a[2]=E=>e.setSegmentContent("Other Investigation"))},{default:r(()=>[i(v,null,{default:r(()=>[...a[5]||(a[5]=[Y("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),e.segmentContent=="Radiology Investigation"?(_(),L("div",Ka,[i(S)])):F("",!0),e.segmentContent=="Other Investigation"?(_(),L("div",Xa)):F("",!0),e.segmentContent=="Lab Investigations"?(_(),L("div",Ja,[b("div",Za,[b("span",null,[i(f,{propOrders:e.labOrders},null,8,["propOrders"])])])])):F("",!0),e.segmentContent=="Radiology Investigation"?(_(),L("div",en,[b("div",tn,[i(A)])])):F("",!0),e.segmentContent=="Other Investigation"?(_(),L("div",an)):F("",!0)])}const sn=oe(ja,[["render",nn],["__scopeId","data-v-67ff1a61"]]),on={key:0},ln={style:{"align-content":"center"}},rn={class:"ion-padding",slot:"content"},dn=K({__name:"AHDPresentingComplaints",setup(e,{expose:a}){const t=Ca(),{presentingComplaints:l}=me(t),u=w(ee),d=w(!0),v=w(!1),s=w(!0),T=w(!1),S=w([]),f=w([]),A=w(),E=ae(()=>[{componentType:"multiSelectInputField",header:"Presenting Complaints",name:"PresentingComplaints",trackBy:"concept_id",icon:ee.search,hideSelected:!0,validation:g=>D(g==null?void 0:g.name,S.value)?"Presenting complaint already added":we.required(g),options:f.value,grid:{s:"6"}},{componentType:"inputField",header:"Duration",name:"duration",icon:ee.time,validation:g=>we.isNotEmptyandNumber(g),grid:{s:"6"},unitOptions:[{label:"Hours",value:"Hours"},{label:"Days",value:"Days"},{label:"Weeks",value:"Weeks"},{label:"Months",value:"Months"},{label:"Years",value:"Years"}],unitValidation:g=>!g||g===""?"Please select a unit.":null},{componentType:"inputField",header:"Specify the presenting complaint(s)",name:"Other (specify)",icon:ee.editPen,validation:g=>D(g,S.value)?"Presenting complaint already added":we.required(g),condition:g=>{var m;return((m=g==null?void 0:g.PresentingComplaints)==null?void 0:m.name)==="Other"}},{componentType:"Alert",condition:g=>{var m;return we.required((m=g==null?void 0:g.PresentingComplaints)==null?void 0:m.name)!=null},backgroundColor:"lightyellow",textColor:"black",value:"Please search thoroughly for the complaint. If it is not listed, search and select the 'Other' option to specify the complaint.",name:"noMatchAlert"}]),{formRef:R}=St(),O=async()=>{f.value=await Sa.getComplaintsList("Presenting complaint"),B(l.value,"PresentingComplaints","multiSelectData",f.value)},y=()=>{d.value=!1,s.value=!1,v.value=!0},P=async()=>{var c,I;const g=(c=R.value)==null?void 0:c.getFormValues();((I=R.value)==null?void 0:I.validateForm())==null&&(G(g),v.value=!1,s.value=!0)},G=g=>{var V;const m=g.duration+" "+g.duration_unit,c=g.PresentingComplaints,I=c.name==="Other"?g["Other (specify)"]:c.name;S.value.push({actionBtn:!0,btn:["delete"],name:I,concept_id:c.concept_id,duration:c.duration,durationUnits:c.duration_unit,display:[I,m],data:[{concept_id:8578,value_coded:c.concept_id,obs_datetime:U.getSessionDate(),child:[{concept_id:c.concept_id,value_text:m,obs_datetime:U.getSessionDate()}]}]}),(V=R.value)==null||V.resetForm(),T.value=!0},D=(g,m)=>m.some(c=>c.name===g),W=g=>{S.value=S.value.filter(m=>m.display[0]!==g.name)},H=async()=>{const g=S.value.flatMap(m=>m.data);if(g.length<=0)return pe("Presenting complaints is required");g.length<=0||(await J.addObsToEncounterPatient(g,te.AHD_PRESENTING_COMPLAINTS),Pe("Presenting complaints saved successful"),S.value=[])};return ue(async()=>{await O()}),a({onSubmit:H}),(g,m)=>{const c=M("ion-row"),I=M("ion-label"),V=M("ion-accordion"),C=M("ion-accordion-group");return _(),L(ge,null,[i(ht,{status:d.value,content:"No presenting complaints added"},null,8,["status"]),T.value?(_(),L("span",on,[i(Ze,{listData:S.value,"onClicked:delete":W},null,8,["listData"])])):F("",!0),v.value?(_(),Q(c,{key:1},{default:r(()=>[i(At,{formData:E.value,ref_key:"formRef",ref:R},null,8,["formData"]),b("div",ln,[i(Le,{fill:"clear",icon:u.value.plus,iconSlot:"icon-only","onClicked:btn":m[0]||(m[0]=n=>P()),name:"Save"},null,8,["icon"])])]),_:1})):F("",!0),s.value?(_(),Q(c,{key:2,style:{"margin-top":"10px"}},{default:r(()=>[i(Le,{fill:"clear",icon:u.value.plus,iconSlot:"icon-only","onClicked:btn":m[1]||(m[1]=n=>y()),name:"Add new presenting complaints"},null,8,["icon"])]),_:1})):F("",!0),i(c,null,{default:r(()=>[i(C,{ref_key:"accordionGroup",ref:A,class:"previousView"},{default:r(()=>[i(V,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:r(()=>[i(h(he),{slot:"header",color:"light"},{default:r(()=>[i(I,{class:"previousLabel"},{default:r(()=>[...m[2]||(m[2]=[Y("Previous presenting complaints",-1)])]),_:1})]),_:1}),b("div",rn,[i(Ia)])]),_:1})]),_:1},512)]),_:1})],64)}}}),cn=oe(dn,[["__scopeId","data-v-04755951"]]);class Fe extends Re{constructor(t,l,u){super(t,te.AHD_HIV_STAGING,u);Ne(this,"age");Ne(this,"confirmatoryTest");this.age=l,this.confirmatoryTest=null}isAdult(){return this.age>=15}isPedaid(){return this.age<=14}setAge(t){this.age=t}getFacilities(t=""){return wt.getFacilities({name:t})}getConfirmatoryTestType(){return this.confirmatoryTest}cd4CountIsValid(t){try{return!!t.match(/^(=|<|>)([0-9]*)$/m)}catch(l){return!1}}getAlertGuidelines(){return Et}getWhoStageGuidelines(){return this.isAdult()?Ot:Tt}getProgramEligibilityGuidelines(){return this.isAdult()?Lt:kt}getRecommendedConditionGuidelines(){return this.isAdult()?Ht:Bt}getStagingConditions(t){const l=this.getStagingCategoryByNum(t);return Re.getConceptsByCategory(l)}buildWhoStageObs(t){return this.buildValueCoded("Who stage",t)}buildWhoCriteriaObs(t){return this.buildValueCoded("Who stages criteria present",t)}buildReasonForArtObs(t){return this.buildValueCoded("Reason for ART eligibility",t)}getStagingCategoryByNum(t){switch(t){case 1:return this.isAdult()?"stage_1_conditions_adults":"stage_1_conditions_pedaids";case 2:return this.isAdult()?"stage_2_conditions_adults":"stage_2_conditions_pedaids";case 3:return this.isAdult()?"stage_3_conditions_adults":"stage_3_conditions_pedaids";case 4:return this.isAdult()?"stage_4_conditions_adults":"stage_4_conditions_pedaids";default:return""}}async loadHivConfirmatoryTestType(){const t=await Re.getFirstValueCoded(this.patientID,"Confirmatory hiv test type");t&&(this.confirmatoryTest=t)}}const un={key:0,class:"ion-padding"},pn={class:"accordion_group ion-padding"},mn={style:{"font-weight":"bold"}},gn={class:"error"},hn={class:"ion-padding",slot:"content"},vn={class:"ion-padding"},fn={class:"ion-padding"},_n={key:0,class:"ion-padding"},yn={class:"ion-padding",style:{"border-bottom":"dashed #ccc"}},Dn=K({__name:"AHDStaging",props:{hideSubmit:{type:Boolean,default:!1},date:{default:Fe.getSessionDate()}},setup(e,{expose:a}){const t=e,l=new tt,u=w({}),d=new Fe(l.getID(),l.getAge(),-1);Z(()=>t.date,n=>{var x;const o=(x=n==null?void 0:n.standardDate)!=null?x:Fe.getSessionDate(),p=Ie(o).diff(l.getBirthdate(),"years");d.setAge(p),d.setDate(o)},{deep:!0,immediate:!0});const v=je({stage_4_conditions:{title:"Stage 4 Conditions",options:[]},stage_3_conditions:{title:"Stage 3 Conditions",options:[]},stage_2_conditions:{title:"Stage 2 Conditions",options:[]},stage_1_conditions:{title:"Stage 1 Conditions",options:[]}}),s=je({cd4:"",cd4Date:"",isChildBearing:!1,reasonForArt:"",pregnant:"",breastFeeding:"",cd4Available:"",cd4Modifier:"",cd4Location:"",whoStage:"",staging:[],confirmatoryTest:""}),T={reasonForArt:{buildObs:()=>d.buildReasonForArtObs(s.reasonForArt),suggestAvalue:()=>({"PRESUMED SEVERE HIV":{priority:1,condition:()=>l.getAgeInMonths()<12&&s.confirmatoryTest==="HIV rapid test"&&$.getConceptsByCategory("pshd_condition").some(n=>G().includes(n.name))},"WHO STAGE IV PEDS":{priority:2,condition:()=>d.isPedaid()&&f(["stage_4_conditions"])},"WHO STAGE III PEDS":{priority:3,condition:()=>d.isPedaid()&&f(["stage_3_conditions"])},"HIV DNA polymerase chain reaction":{priority:4,condition:()=>l.getAgeInMonths()<12&&s.confirmatoryTest==="HIV DNA polymerase chain reaction"},"CD4 COUNT LESS THAN OR EQUAL TO 750":{priority:5,condition:()=>y(750)&&P()&&A()&&l.ageInMonths()>=24&&l.ageInMonths()<=56},"CD4 COUNT LESS THAN OR EQUAL TO 500":{priority:6,condition:()=>d.isPedaid()&&y(500)&&P()&&A()},"HIV infected":{priority:7,condition:()=>l.getAgeInMonths()<24||l.getAge()<=5},"WHO STAGE IV ADULT":{priority:1,condition:()=>{const n=$.getConceptsByCategory("severe_hiv_wasting_syndrome");return d.isAdult()&&(f(["stage_4_conditions"])||n.filter(o=>G().includes(o.name)).length>=2)}},"WHO STAGE III ADULT":{priority:2,condition:()=>d.isAdult()&&f(["stage_3_conditions"])},"cd4 less than or equal to 350":{priority:3,condition:()=>d.isAdult()&&y(350)&&A()},"cd4 less than or equal to 250":{priority:4,condition:()=>d.isAdult()&&y(250)&&A()},"cd4 less than or equal to 500":{priority:4,condition:()=>d.isAdult()&&y(500)&&A()},BREASTFEEDING:{priority:5,condition:()=>d.isAdult()&&s.breastFeeding==="Yes"&&P()},"PATIENT PREGNANT":{priority:6,condition:()=>d.isAdult()&&s.pregnant==="Yes"&&P()},Asymptomatic:{priority:7,condition:()=>P()}})},whoStage:{buildObs:()=>d.buildWhoStageObs(s.whoStage),suggestAvalue:()=>({"WHO STAGE IV ADULT":{priority:1,condition:()=>d.isAdult()&&f(["stage_4_conditions"])},"WHO STAGE III ADULT":{priority:2,condition:()=>d.isAdult()&&f(["stage_3_conditions"])},"WHO STAGE II ADULT":{priority:3,condition:()=>d.isAdult()&&f(["stage_2_conditions"])},"WHO STAGE I ADULT":{priority:4,condition:()=>d.isAdult()&&f(["stage_1_conditions"])},"WHO STAGE IV PEDS":{priority:1,condition:()=>d.isPedaid()&&(f(["stage_4_conditions"])||s.reasonForArt==="WHO STAGE IV PEDS")},"WHO STAGE III PEDS":{priority:2,condition:()=>d.isPedaid()&&f(["stage_3_conditions"])},"WHO STAGE II PEDS":{priority:3,condition:()=>d.isPedaid()&&f(["stage_2_conditions"])},"WHO STAGE I PEDS":{priority:4,condition:()=>d.isPedaid()&&f(["stage_1_conditions"])}})},cd4Available:{required:()=>!0,dataHandler:n=>{n!="Yes"&&(s.cd4="",s.cd4Date=""),u.value.cd4="",u.value.cd4Modifier="",u.value.cd4Date="",u.value.cd4Location=""}},pregnant:{required:()=>s.isChildBearing,buildObs:()=>d.buildValueCoded("Is patient pregnant?",s.pregnant)},breastFeeding:{required:()=>s.isChildBearing,buildObs:()=>d.buildValueCoded("Is patient breast feeding?",s.breastFeeding)},cd4:{required:()=>s.cd4Available==="Yes",validation:()=>{if(!O()){u.value.cd4="A number is required";return}R()>1e4&&(u.value.cd4="CD4 value cannot exceed 10,000")},buildObs:()=>d.buildValueNumber("CD4 count",R(),E())},cd4Modifier:{required:()=>s.cd4Available==="Yes",validation:()=>{s.cd4Modifier||(u.value.cd4Modifier="Please select modifier")},dataHandler:n=>s.cd4Modifier=n,options:[{label:"=",value:"="},{label:">",value:">"},{label:"<",value:"<"}]},cd4Date:{required:()=>s.cd4Available==="Yes",dataHandler:n=>{n&&(s.cd4Date=Ie(n).format("YYYY-MM-DD"))},validation:()=>{if(isNaN(new Date(s.cd4Date).getTime())){u.value.cd4Date="Invalid CD4 date";return}const n=Ie(s.cd4Date);if(n.isAfter(Ie(d.getDate()))){u.value.cd4Date="Cd4 result date can't be greater than ".concat(d.getDate());return}n.isBefore(Ie(l.getBirthdate()))&&(u.value.cd4Date="CD4 date must not be earlier than birthdate")},buildObs:()=>d.buildValueDate("Cd4 count datetime",s.cd4Date)},cd4Location:{required:()=>s.cd4Available==="Yes",dataHandler:n=>s.cd4Location=n,buildObs:()=>d.buildValueText("Cd4 count location",s.cd4Location)},staging:{validation:()=>{if(Object.keys(v).every(x=>g(x)<=0)){u.value.staging="Please select one or more staging conditions";return}const o=["stage_4_conditions","stage_3_conditions","stage_2_conditions"].some(x=>g(x)>0);v.stage_1_conditions.options.some(x=>/asymptomatic/i.test(x.name)&&x.checked)&&o&&(u.value.staging="Asymptomatic cannot be selected with other staging conditions")},buildObs:()=>Object.keys(v).reduce((o,p)=>(v[p].options.forEach(x=>{x.checked&&o.push(x.name)}),o),[]).map(o=>d.buildWhoCriteriaObs(o))}};function S(){Object.keys(s).forEach(n=>{typeof s[n]=="boolean"?s[n]=!1:Array.isArray(s[n])?s[n]=[]:s[n]=""}),Object.keys(u.value).forEach(n=>u.value[n]=""),I()}function f(n){return n.some(o=>g(o)>0)}function A(){return new Date(s.cd4Date)<=new Date("2016-04-30")}function E(){return s.cd4Modifier}function R(){return parseInt("".concat(s.cd4))}function O(){return/^\d+$/i.test("".concat(s.cd4))}function y(n){if(!O())return!1;const o=E(),p=R();return o==="="&&n===p||o==="<"&&p<=n||o===">"&&p>=n}function P(){return f(["stage_2_conditions","stage_1_conditions"])}function G(){return Object.keys(v).reduce((n,o)=>(v[o].options.forEach(p=>p.checked&&n.push(p.name)),n),[])}function D(n){if(u.value[n]="",typeof T[n].required=="function"&&T[n].required()&&!s[n]){u.value[n]="This field is required";return}s[n]&&typeof T[n].validation=="function"&&T[n].validation()}function W(n){var o,p,x;if(T[n]&&"suggestAvalue"in T[n]){s[n]="";const j=T[n].suggestAvalue(),de=Object.keys(j).reduce((ne,ce)=>{const ye=j[ce];return typeof ye.condition=="function"&&ye.condition()?[...ne,{value:ce,priority:ye.priority}]:ne},[]);s[n]=(x=(p=(o=de.sort((ne,ce)=>ne.priority-ce.priority))==null?void 0:o[0])==null?void 0:p.value)!=null?x:""}}function H(){return Object.keys(s).reduce((n,o)=>{if(o in T&&s[o]&&typeof T[o].buildObs=="function"){const p=T[o].buildObs();return Array.isArray(p)?[...n,...p]:[...n,p]}return n},[])}function g(n){return v[n].options.filter(o=>o.checked).length}async function m(){await d.loadHivConfirmatoryTestType(),s.confirmatoryTest=d.getConfirmatoryTestType(),s.isChildBearing=l.isChildBearing()}function c(n,o){n in T&&typeof T[n].dataHandler=="function"&&T[n].dataHandler(o),D(n),Object.keys(T).forEach(p=>W(p))}function I(){Object.keys(v).forEach(n=>{var x,j;const o=Number((j=(x=n.match(/\d+/))==null?void 0:x[0])!=null?j:0),p=d.getStagingConditions(o);v[n].options=p.map(de=>({checked:!1,name:de.name,concept_id:de.concept_id}))})}function V(){return Object.keys(T).forEach(n=>D(n)),Object.keys(u.value).every(n=>"".concat(u.value[n]).length<=0)}async function C(){if(console.log("Submitting staging"),!V())return pe("Please review form for errors"),!1;try{const n=await Promise.all(H());return await J.addObsToEncounterPatient(n,te.AHD_HIV_STAGING),Pe("Staging Observations saved!"),!0}catch(n){return console.error(n),Vt("Error has occured while saving observations"),!1}}return Z(()=>t.date,n=>{d.setDate(n),l.date=n,S()}),ue(async()=>{await m(),I()}),a({validateStagingForm:V,buildPayload:H,onSubmit:C}),(n,o)=>(_(),Q(h(rt),null,{default:r(()=>[i(h(ct),null,{default:r(()=>[s.isChildBearing?(_(),L("div",un,[i(h($e),null,{default:r(()=>[i(h(Ce),null,{default:r(()=>[i(h(le),null,{default:r(()=>[i(Ve,{label:"Pregnant?",modelValue:s.pregnant,"onUpdate:modelValue":o[0]||(o[0]=p=>s.pregnant=p),onIonChange:o[1]||(o[1]=p=>c("pregnant",p)),"error-message":u.value.pregnant},null,8,["modelValue","error-message"])]),_:1}),i(h(le),null,{default:r(()=>[i(Ve,{label:"Breastfeeding?",modelValue:s.breastFeeding,"onUpdate:modelValue":o[2]||(o[2]=p=>s.breastFeeding=p),onOnChange:o[3]||(o[3]=p=>c("breastFeeding",p)),"error-message":u.value.breastFeeding},null,8,["modelValue","error-message"])]),_:1})]),_:1})]),_:1})])):F("",!0),b("div",pn,[i(h(la),{color:"light"},{default:r(()=>[(_(!0),L(ge,null,Se(v,(p,x)=>(_(),Q(h(ra),{key:x},{default:r(()=>[i(h(he),{color:"light",slot:"header"},{default:r(()=>[i(h(Ae),{style:{color:"grey","font-size":"17px"},class:"ion-padding"},{default:r(()=>[b("b",mn,[Y(q(p.title)+" ",1),i(h(da),{color:g("".concat(x))>0?"primary":void 0},{default:r(()=>[Y(" Selected: "+q(g("".concat(x))),1)]),_:2},1032,["color"])]),b("p",gn,q(u.value.staging),1)]),_:2},1024)]),_:2},1024),b("div",hn,[i(h(Ge),null,{default:r(()=>[(_(!0),L(ge,null,Se(p.options,(j,de)=>(_(),Q(h(he),{key:de},{default:r(()=>[i(h(dt),{modelValue:j.checked,"onUpdate:modelValue":ne=>j.checked=ne,onIonChange:ne=>c("staging",{stage_type:x,raw:ne,option:j})},null,8,["modelValue","onUpdate:modelValue","onIonChange"]),i(h(Ae),{style:{margin:"13px"}},{default:r(()=>[Y(q(j.name),1)]),_:2},1024),o[15]||(o[15]=b("p",null,null,-1)),j.description?(_(),Q(h(ca),{key:0,color:j.color},{default:r(()=>[Y(q(j.text),1)]),_:2},1032,["color"])):F("",!0)]),_:2},1024))),128))]),_:2},1024)])]),_:2},1024))),128))]),_:1})]),b("div",vn,[b("div",fn,[i(Ve,{label:"Recent CD4 count results available?",modelValue:s.cd4Available,"onUpdate:modelValue":o[4]||(o[4]=p=>s.cd4Available=p),onOnChange:o[5]||(o[5]=p=>c("cd4Available",p)),"error-message":u.value.cd4Available},null,8,["modelValue","error-message"])]),s.cd4Available==="Yes"?(_(),L("div",_n,[i(h($e),{class:"ion-padding"},{default:r(()=>[i(h(Ce),null,{default:r(()=>[i(h(le),null,{default:r(()=>[i(Pt,{label:"CD4 Count Date",modelValue:s.cd4Date,"onUpdate:modelValue":o[6]||(o[6]=p=>s.cd4Date=p),required:s.cd4Available==="Yes","error-message":u.value.cd4Date,onOnChange:o[7]||(o[7]=p=>c("cd4Date",p))},null,8,["modelValue","required","error-message"])]),_:1})]),_:1}),i(h(Ce),null,{default:r(()=>[i(h(le),{size:"2"},{default:r(()=>[i(Nt,{label:"CD4 Result Modifier",required:s.cd4Available==="Yes","error-message":u.value.cd4Modifier,options:T.cd4Modifier.options,onOnChange:o[8]||(o[8]=p=>c("cd4Modifier",p.value))},null,8,["required","error-message","options"])]),_:1}),i(h(le),{size:"10"},{default:r(()=>[i(Mt,{label:"CD4 Count",modelValue:s.cd4,"onUpdate:modelValue":o[9]||(o[9]=p=>s.cd4=p),type:"number",onOnChange:o[10]||(o[10]=p=>c("cd4",p)),placeholder:"Enter CD4 Count","error-message":u.value.cd4},null,8,["modelValue","error-message"])]),_:1})]),_:1}),i(h(Ce),{style:{"margin-top":"15px"}},{default:r(()=>[i(h(le),null,{default:r(()=>[i(Rt,{label:"CD4 Count Location",modelValue:s.cd4Location,"onUpdate:modelValue":o[11]||(o[11]=p=>s.cd4Location=p),required:s.cd4Available==="Yes","error-message":u.value.cd4Location,show_error:!1,selected_district_ids:[],selected_location:s.cd4Location,onOnChange:o[12]||(o[12]=p=>{c("cd4Location",p)})},null,8,["modelValue","required","error-message","selected_location"])]),_:1})]),_:1})]),_:1})])):F("",!0)]),b("div",yn,[i(h($e),null,{default:r(()=>[i(h(Ce),null,{default:r(()=>[i(h(le),null,{default:r(()=>[i(h(He),{readonly:"",placeholder:"N/A",label:"REASON FOR ART:",modelValue:s.reasonForArt,"onUpdate:modelValue":o[13]||(o[13]=p=>s.reasonForArt=p)},null,8,["modelValue"])]),_:1}),i(h(le),null,{default:r(()=>[i(h(He),{readonly:"",placeholder:"N/A",label:"WHO STAGE:",modelValue:s.whoStage,"onUpdate:modelValue":o[14]||(o[14]=p=>s.whoStage=p)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),bn=oe(Dn,[["__scopeId","data-v-f482cf99"]]),Cn={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},In=K({__name:"AHDWorkflow",props:{closeModalOnFinish:{type:Boolean,default:!1}},setup(e,{expose:a}){const{onTabBeforeChange:t,currentTabIndex:l}=Aa();ut();const u=pt(),d=w(!0),v=w(!1),s=w(!1),T=w(null),S=w(null),f=w(null),A=ae(()=>({text:s.value?"Saving...":"Finish",icon:s.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:v.value||s.value})),E=_e(),R=xt(),O=$t(),{patient:y}=me(E),{sessionDate:P}=me(O);Z(A,(C,n)=>{console.log("Done button options changed:",{from:n,to:C,currentStep:l.value,tabsLength:H.value.length}),C.disabled!==(n==null?void 0:n.disabled)&&console.log("Done button ".concat(C.disabled?"disabled":"enabled")),C.text!==(n==null?void 0:n.text)&&console.log('Done button text changed from "'.concat(n==null?void 0:n.text,'" to "').concat(C.text,'"'))},{deep:!0}),Z(s,(C,n)=>{C!==n&&(console.log("Saving state changed: ".concat(n," -> ").concat(C)),console.log(C?"Starting save process...":"Save process completed"))});const G=C=>{console.log("Done button change received from wizard:",C),C.newOptions.disabled&&console.log("Done button has been disabled"),C.isLastStep&&console.log("User is on the last step, done button should be visible")},D=()=>{let C=!1;return g(),s.value&&(C=!0),v.value=C,!C},W=()=>[{title:"Presenting Complaints",icon:""},{title:"Past Medical History",icon:""},{title:"WHO",icon:""},{title:"Investigation",icon:""}],H=w(W());w(null),w(null);const g=()=>{var o;if(!H.value||H.value.length===0)return console.log("Tabs not yet initialized"),null;const C=l.value>=0&&l.value<H.value.length?l.value:0;switch((o=H.value[C])==null?void 0:o.title){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation";default:if(R.NCDActivities.length>0)switch(R.NCDActivities[0]){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation"}return null}},m=()=>{d.value=!1,setTimeout(()=>{l.value=0,d.value=!0},0)},c=async()=>{zt(P.value,"sessionDate","value")||z.sessionDate(),Ut("vitals");for(let C=0;C<H.value.length;C++)H.value[C];D()},I=async(C,n)=>{var o;(o=H.value[n])==null||o.title,C%1===0&&(l.value=C)},V=async()=>{var C,n,o;s.value=!0;try{(C=T.value)==null||C.onSubmit(),(n=S.value)==null||n.onSubmit(),(o=f.value)==null||o.onSubmit(),ua.dismiss()}catch(p){console.error("Error saving data:",p),pe("Error occurred while saving data. Please try again.")}finally{s.value=!1}};return ue(async()=>{H.value=W(),await c(),(l.value===void 0||l.value<0)&&(l.value=0,console.log("Setting initial tab index to 0")),v.value=!1,s.value=!1,D()}),Z(l,async()=>{await D()}),Z(P,async()=>{await c()},{deep:!0}),Z(u,async C=>{m(),H.value=W()},{deep:!0}),Z(y,async(C,n)=>{await c(),C.ID!=n.ID&&m()},{deep:!0}),a({saveData:V,markWizard:c,refreshWizard:m,validateDoneButtonState:D}),(C,n)=>(_(),Q(Ft,{title:"Advance HIV Disease",subtitle:"",headerIcon:h(ee).demographics},{content:r(()=>[b("div",Cn,[d.value?(_(),Q(wa,{key:0,ref:"wizard",headingTitle:"AHD Screening","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:A.value,"custom-tabs":H.value,beforeChange:h(t),onChange:I,"onComplete:wizard":n[0]||(n[0]=o=>V()),onDoneButtonChanged:G},{default:r(()=>[Oe(b("div",null,[i(cn,{ref_key:"AHDPresentingComplaintsRef",ref:T},null,512)],512),[[Te,g()=="Presenting Complaints"]]),Oe(b("div",null,[i(qa,{ref_key:"AHDPastMedicalHistoryRef",ref:S},null,512)],512),[[Te,g()=="Past Medical History"]]),Oe(b("div",null,[i(bn,{ref_key:"AHDStagingRef",ref:f},null,512)],512),[[Te,g()=="WHO"]]),Oe(b("div",null,[i(sn,{ref:"investigationRef"},null,512)],512),[[Te,g()=="Investigation"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):F("",!0)])]),_:1},8,["headerIcon"]))}}),Sn=async()=>{const{hasWaitingList:e}=Ea(),a=await J.getObsByEncounterIdAndDate(te.PRESENTING_COMPLAINTS),t=await J.getObsByEncounterId(te.HIV_CLINIC_REGISTRATION),l=await J.getObsByEncounterId(te.PAST_MEDICAL_HISTORY),u=await J.getObsByEncounterId(te.HIV_STATUS_AT_ENROLLMENT),d=await J.getObsByEncounterId(te.PATIENT_OUTCOME),v=await $.getConceptID("Slow onset severe headache"),s=await $.getConceptID("Confusion"),T=await $.getConceptID("Fever"),S=await $.getConceptID("Neck stiffness"),f=await $.getConceptID("Persistent fever/drenching night sweats"),A=await $.getConceptID("Weight loss or failure to thrive"),E=await $.getConceptID("Anaemia<8gdl"),R=await $.getConceptID("Enlarged nodes"),O=await $.getConceptID("Meningits signs"),y=await $.getConceptID("Cough"),P=await $.getConceptID("Yes"),G=await $.getConceptID("Reactive"),D=await $.getConceptID("New Positive"),W=await $.getConceptID("HIV status"),H=await $.getConceptID("Presenting complaint"),g=J.isValueCodedAvailable(a,[v,s,T,S,f,A,E,R,O,y],H),m=J.isValueCodedAvailable(l,[P],W),c=J.isValueCodedAvailable(u,[G],W),I=J.isValueCodedAvailable(d,[P],D);return console.log("ðŸš€ ~ isQualifiedAHD ~ hasCoughComplaint:",g),console.log("ðŸš€ ~ isQualifiedAHD ~ isClinician():",Ke()),console.log('ðŸš€ ~ isQualifiedAHD ~ hasWaitingList("Waiting for Consultation")) :',e("Waiting for Consultation")),console.log("ðŸš€ ~ isQualifiedAHD ~ hasHIVHistory:",m),(Ke()||e("Waiting for Consultation"))&&g&&(m||I||c||t.length>0)},An={class:"background"},wn={key:0},En={key:1},On={key:2},Tn={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},Ln={key:3},kn={class:"ion-padding",slot:"content"},Hn={key:4},Bn=K({__name:"Investigations",setup(e,{expose:a}){const t=w("Lab Investigations"),l=w(!1);w(!0);const u=w(!1),d=w(!1),v=w(!0),s=w(""),T=w("");w("");const S=w("");w(""),w([]),w(!1);const f=w(!1);w("");const A=w("");w(!1),w(!1);const E=ze(),R=_e(),{investigations:O}=me(E),{patient:y}=me(R),P=pt(),G=ut(),D=ae(()=>O.value[0].data.rowData[0].colData),W=k=>{t.value=k},H=async()=>{let k;U.getPouchDbStatus()&&U.getLanConnectionStatus()?k=await ke("test_types"):k=await re.getTestTypes(),B(O.value,"test","multiSelectData",k)},g=()=>{f.value=!f.value},m=async()=>{var N;if(!((N=y.value)!=null&&N.labOrders))return;S.value=[...y.value.labOrders.saved,...y.value.labOrders.unsaved];const k=await S.value.filter(X=>z.toStandardHisFormat(z.sessionDate())===z.toStandardHisFormat(X.order_date));k.length>0?O.value[0].selectedData=k:O.value[0].selectedData=""},c=async()=>{await m(),E.setInvestigations(O.value)},I=()=>{T.value="",s.value="",l.value=!1,v.value=!1,u.value=!0},V=async()=>Be(O.value),C=async()=>await o(D.value[0].value.name,await O.value[0].selectedData)?(B(O.value,"test","alertsErrorMassage","Lab order already selected"),!1):(B(O.value,"test","alertsErrorMassage",""),!0),n=async()=>{Be(O.value)&&await C()&&(await p(),O.value[0].data.rowData[0].colData[0].value="",O.value[0].data.rowData[0].colData[1].value="",u.value=!1,d.value=!0,v.value=!0),m()},o=(k,N)=>{for(let X of N)for(let De of X.tests)if(De.name===k)return!0;return!1},p=async()=>{await new vt().postActivities(y.value.patientID,[{concept_id:D.value[0].value.concept_id,name:D.value[0].value.name,specimen:D.value[1].value.name,reason:"Routine",specimenConcept:await $.getConceptID(D.value[1].value.name,!0)}]),B(O.value,"specimen","disabled",!0),S.value=[...y.value.labOrders.saved,...y.value.labOrders.unsaved]},x=async k=>{if(k.inputHeader=="Test"&&C(),B(O.value,"specimen","alertsErrorMassage",""),k.inputHeader=="Test"&&k.value){let N;U.getPouchDbStatus()&&U.getLanConnectionStatus()?N=await ke("specimens"):N=await re.getSpecimens("",1e3),A.value=await $.getConceptSet(k.value.name,"",{names:N.map(X=>X.name)}),A.value.length==1?(B(O.value,"specimen","value",A.value[0]),B(O.value,"specimen","disabled",!0)):(B(O.value,"specimen","value",""),B(O.value,"specimen","disabled",!1)),B(O.value,"specimen","multiSelectData",A.value)}},j=async k=>await S.value.filter(N=>N.name.toLowerCase().includes(k.toLowerCase())),de=async k=>{var N;return(N=A.value[0])!=null&&N.name&&k?await A.value.filter(X=>X==null?void 0:X.name.toLowerCase().includes(k.toLowerCase())):[]},ne=k=>{s.value=k.name,D.value[1].inputHeader=="Test"?O.value[0].data.rowData[0].colData[0].value=k.name:O.value[0].data.rowData[0].colData[1].value=k.name,c()},ce=()=>{(D.value[1].value||D.value[0].value)&&(v.value=!1,u.value=!0,l.value=!1),O.value[0].selectedData.length>0?(d.value=!0,l.value=!1):u.value||(l.value=!0)},ye=async()=>{await Sn()&&G.currentRoute.value.name=="OPDConsultationPlan"&&await Gt("Do you want to do AHD screening?")&&(await at(In,{class:"fullScreenModal"}),await Wt(y.value))};return Z(O,()=>{ce()},{deep:!0}),Z(y,async()=>{var k;(k=y.value)!=null&&k.labOrders&&(S.value=[...y.value.labOrders.saved,...y.value.labOrders.unsaved])},{deep:!0}),Z(P,async()=>{await H()},{deep:!0}),ue(async()=>{await H(),c(),ce(),m()}),a({openAHDModal:ye,setSegmentContent:W,getTests:H,toggleLabOrderStatus:g,updateInvestigationWizard:m,updateInvestigationsStores:c,displayInputFields:I,validateRowData:V,checkTest:C,addNewRow:n,isNameInData:o,saveTest:p,handleInputData:x,filterTest:j,filterSpecimen:de,setTest:ne,setDashedBox:ce}),(k,N)=>{const X=M("ion-label"),De=M("ion-segment-button"),_t=M("ion-segment"),yt=M("VisitsHistory");return _(),L("div",An,[i(_t,{value:t.value,style:{"margin-top":"5px"}},{default:r(()=>[i(De,{value:"Lab Investigations",onClick:N[0]||(N[0]=We=>W("Lab Investigations"))},{default:r(()=>[i(X,null,{default:r(()=>[...N[3]||(N[3]=[Y("Lab Investigations",-1)])]),_:1})]),_:1}),i(De,{value:"Radiology Investigation",onClick:N[1]||(N[1]=We=>W("Radiology Investigation"))},{default:r(()=>[i(X,null,{default:r(()=>[...N[4]||(N[4]=[Y("Radiology Investigation",-1)])]),_:1})]),_:1}),i(De,{value:"Other Investigation",onClick:N[2]||(N[2]=We=>W("Other Investigation"))},{default:r(()=>[i(X,null,{default:r(()=>[...N[5]||(N[5]=[Y("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),t.value=="Radiology Investigation"?(_(),L("div",wn,[i(yt)])):F("",!0),t.value=="Other Investigation"?(_(),L("div",En)):F("",!0),t.value=="Lab Investigations"?(_(),L("div",On,[b("div",Tn,[b("span",null,[i(mt,{propOrders:S.value},null,8,["propOrders"])])])])):F("",!0),t.value=="Radiology Investigation"?(_(),L("div",Ln,[b("div",kn,[i(ft)])])):F("",!0),t.value=="Other Investigation"?(_(),L("div",Hn)):F("",!0)])}}}),bs=oe(Bn,[["__scopeId","data-v-9ab30198"]]),Pn=K({created(){},components:{IonItem:he,IonCol:le,IonLabel:Ae,IonIcon:Ue},data(){return{iconsContent:ee,localMedicalDrugsList:[...this.$props._selectedMedicalDrugsList]}},props:{_selectedMedicalDrugsList:{type:Array,default:[]},show_actions_buttons:{type:Boolean,default:!0},highLightBackground:{type:String,default:"item-native"}},watch:{},methods:{highlightItem(e){const a=document.getElementById(e+"_lbl");a&&(a.style.color="#006401"),this.highlightActionBtns(e)},undoHighlightItem(e){const a=document.getElementById(e+"_lbl");a&&(a.style.color="#636363"),this.undohighlightActionBtns(e)},highlightActionBtns(e){const a=document.getElementsByClassName(e+"_spanlbl");for(let t=0;t<a.length;t++)a[t].style.display="inline-block"},undohighlightActionBtns(e){const a=document.getElementsByClassName(e+"_spanlbl");for(let t=0;t<a.length;t++)a[t].style.display="none"},asignLblID(e){return e+"_lbl"},asignSpanLblID(e){return e+"_spanlbl"},async removeItemAtIndex(e,a){await qt("Do you want to delete it?",a)&&this.$emit("remove-item",e)},editItemAtIndex(e){this.$emit("edit-item",e)},highLightBnd(e){if(e){if(e.highlightbackground!==void 0&&e.highlightbackground==!0)return this.$props.highLightBackground}else return!1}}}),Nn=["onMousemove","onMouseout"],Mn={class:"route-label"};function Rn(e,a,t,l,u,d){const v=M("ion-label"),s=M("ion-col"),T=M("ion-row"),S=M("ion-icon");return _(!0),L(ge,null,Se(e.localMedicalDrugsList,(f,A)=>(_(),L("div",{id:"df",class:"medication-item",key:A,onMousemove:E=>e.highlightItem(A),onMouseout:E=>e.undoHighlightItem(A)},[i(T,{class:"medication-header"},{default:r(()=>[i(s,{class:ve(["ion-text-wrap",e.highLightBnd(f)])},{default:r(()=>[i(v,{id:e.asignLblID(A),class:"medication-name"},{default:r(()=>[Y(q(f.drugName),1)]),_:2},1032,["id"])]),_:2},1032,["class"])]),_:2},1024),i(T,{class:"medication-details"},{default:r(()=>[i(s,{size:"10",class:ve(["ion-text-wrap details-col",e.highLightBnd(f)])},{default:r(()=>[i(v,{class:"details-text"},{default:r(()=>[Y(q(f.dose)+" / "+q(f.frequency)+" / daily / "+q(f.duration)+" / until "+q(f.prescription)+" ",1),b("span",Mn,q(f.route_name),1)]),_:2},1024)]),_:2},1032,["class"]),e.show_actions_buttons?(_(),Q(s,{key:0,class:ve([e.highLightBnd(f),"actions-col"]),size:"2"},{default:r(()=>[i(v,{class:ve(["action-button",e.asignSpanLblID(A)]),onClick:E=>e.editItemAtIndex(A)},{default:r(()=>[i(S,{icon:e.iconsContent.edit},null,8,["icon"])]),_:1},8,["class","onClick"]),i(v,{class:ve(["action-button",e.asignSpanLblID(A)]),onClick:E=>e.removeItemAtIndex(A,E)},{default:r(()=>[i(S,{icon:e.iconsContent.delete},null,8,["icon"])]),_:1},8,["class","onClick"])]),_:2},1032,["class"])):F("",!0)]),_:2},1024)],40,Nn))),128)}const Cs=oe(Pn,[["render",Rn],["__scopeId","data-v-01c693a3"]]),Vn={key:0,class:"custom-allergy-container"},xn={class:"button-group"},$n=K({watch:{},name:"AllergiesComponent"}),Fn=K({...$n,setup(e,{expose:a}){const t=Yt(),l=_e(),u=jt(),d=ae(()=>t.selectedMedicalAllergiesList),v=ae(()=>l.patient),s=ae(()=>t.medicalAllergiesList),T=w(D(8,"item-")),S=ae(()=>t.selectedMedicalAllergiesList),f=w(""),A=w(!1),E=[{multi_Selection:!0,show_list_label:!0,unqueId:T.value,name_of_list:"Add/Remove allergies",placeHolder:"Search for an allergy",items:[],listUpdatedFN:y,listFilteredFN:()=>{},searchTextFN:P,use_internal_filter:!0,show_error:w(!1),error_message:"please select a User",disabled:w(!1)}],R=w(!1);ue(async()=>{O()});const O=()=>{t.current_patient.ID!=v.value.ID&&(t.clearSelectedMedicalAllergiesList(),t.setCurrentPatient(v.value))};function y(m){m.forEach(c=>{c.selected==!0&&c.name==="Other"&&(A.value=c.name==="Other"),c.selected==!1&&c.name==="Other"&&H()}),t.setSelectedMedicalAllergiesList(m),G()}async function P(m){const c=m,I=await $.getConceptSet("OPD Medication",c);if(!I)return;I.map(o=>({label:o.name,value:o.name,other:o}));const V=Qt(c),n=Kt(V,I).sort((o,p)=>o.name.localeCompare(p.name));t.setMedicalAllergiesList(n),G()}function G(){const m=s.value;d.value.forEach(I=>{let V=!1;m.forEach((C,n)=>{C.concept_id==I.concept_id&&I.selected===!0&&(m[n]=I,V=!0)}),!V&&I.selected===!0&&m.push(I)});const c=m.filter((I,V,C)=>V===C.findIndex(n=>(n==null?void 0:n.concept_id)===(I==null?void 0:I.concept_id)));t.setMedicalAllergiesList(c)}function D(m=8,c=""){const I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let V=c;for(let C=0;C<m;C++)V+=I.charAt(Math.floor(Math.random()*I.length));return V+="-".concat(Date.now()),V}async function W(m){try{const c=m.trim();if(c){const I={name:c,selected:!0,concept_id:D(8,"12"),concept_name_id:D(8,"34")};t.setMedicalAllergiesList([...s.value,I]),t.setSelectedMedicalAllergiesList(I),A.value=!1,R.value=!0,f.value="";const V=t.findSelectedAllergyByName("Other");t.unselectOther(V)}}catch(c){console.error(c)}}const H=()=>{A.value=!1,f.value="",R.value=!1;const m=t.findSelectedAllergyByName("Other");m&&t.unselectOther(m)};return a({onSubmit:async()=>{try{if(gt.isEmpty(S.value))return;const m=await $.getConceptID("Allergic"),c=S.value.map(I=>({concept_id:m,obs_datetime:U.getSessionDate(),value_coded:I.concept_id,location_id:u.facilityLocation.code,value_text:I.name}));await J.addObsToEncounterPatient(c,te.MEDICAL_HISTORY),Pe("Allergies appended to patient record successfully")}catch(m){pe("Failed to save allergies")}}}),(m,c)=>(_(),Q(h(rt),null,{default:r(()=>[i(h(pa),null,{default:r(()=>[i(h(Ae),{class:"header-container"},{default:r(()=>[i(h(Ue),{icon:h(ma),class:"allergy-icon"},null,8,["icon"]),c[3]||(c[3]=b("span",{style:{"font-size":"16px","font-weight":"600"}}," Allergies (Medication, Healthcare items, Environment and Food) ",-1))]),_:1})]),_:1}),i(h(ct),null,{default:r(()=>[i(Xt,{multiSelection:E[0].multi_Selection,show_label:E[0].show_list_label,uniqueId:E[0].unqueId,name_of_list:E[0].name_of_list,choose_place_holder:E[0].placeHolder,"items_-list":s.value,use_internal_filter:E[0].use_internal_filter,disabled:E[0].disabled.value,onItemListUpDated:E[0].listUpdatedFN,onItemListFiltered:E[0].listFilteredFN,onItemSearchText:E[0].searchTextFN},null,8,["multiSelection","show_label","uniqueId","name_of_list","choose_place_holder","items_-list","use_internal_filter","disabled","onItemListUpDated","onItemListFiltered","onItemSearchText"]),A.value?(_(),L("div",Vn,[i(h(He),{modelValue:f.value,"onUpdate:modelValue":c[0]||(c[0]=I=>f.value=I),placeholder:"Please specify the allergy",fill:"outline",class:"custom-input"},null,8,["modelValue"]),b("div",xn,[i(h(Qe),{onClick:c[1]||(c[1]=I=>W(f.value)),class:"addCustomAllergyBtn"},{default:r(()=>[...c[4]||(c[4]=[Y(" Add Allergy ",-1)])]),_:1}),i(h(Qe),{onClick:c[2]||(c[2]=I=>H()),fill:"clear",class:"cancelBtn"},{default:r(()=>[i(h(Ue),{icon:h(ga),slot:"icon-only"},null,8,["icon"])]),_:1})])])):F("",!0)]),_:1})]),_:1}))}}),Is=oe(Fn,[["__scopeId","data-v-d63cacc6"]]),zn={class:"checklist-container"},Un=K({watch:{},name:"xxxComponent"}),Gn=K({...Un,setup(e){const a=_e(),t=ae(()=>a.patient),l=Oa(),u=l.items;ue(async()=>{d()});const d=()=>{l.current_patient.ID!=t.value.ID&&(l.clearSelectednonPharmaTherapyStore(),l.setCurrentPatient(t.value))};return Z(()=>t.value,async v=>{}),(v,s)=>(_(),L("div",zn,[(_(!0),L(ge,null,Se(h(u),T=>(_(),Q(h(he),{key:T.id,class:"no-border"},{default:r(()=>[i(h(dt),{id:T.id,modelValue:T.checked,"onUpdate:modelValue":S=>T.checked=S,slot:"start"},null,8,["id","modelValue","onUpdate:modelValue"]),i(h(Ae),{style:{"font-size":"16px","font-weight":"600"}},{default:r(()=>[Y(q(T.label),1)]),_:2},1024)]),_:2},1024))),128))]))}}),Ss=oe(Gn,[["__scopeId","data-v-371e920f"]]),Wn=K({components:{IonContent:lt,IonHeader:ot,IonItem:he,IonList:Ge,IonMenu:it,IonTitle:st,IonToolbar:nt,BasicInputField:et,IonDatetime:va,IonBadge:ha,DateInputField:La,DynamicButton:Le},props:{showPeripheral:{type:Boolean,default:!0}},setup(e){const a=xe(),t=w(0),l=ae(()=>a.getDisabledDates()),u=ae(()=>a.getAssignedAppointments()),d=w(),v=ae(()=>e.showPeripheral);return{disabledDates:l,datesCounts:u,appointment_count:t,calendarOutline:fa,inputPRDate:d,show_peripheral:v}},data(){return se(),Ye(),{iconsContent:ee,date:new Date(U.getSessionDate()),tomorrow:new Date(U.getSessionDate()).getDate()+1,appointment:"",drugRunoutDate:"",nextAppointmentDate:"",minDate:new Date(U.getSessionDate())}},computed:{...fe(se,["nextAppointment","appointmentCountsCache","currentSelectedNextAppointmentDate"]),...fe(xe,["maximumNumberOfDaysForEachDay","assignedAppointmentsDates"]),...fe(_e,["patient"]),...fe(Ye,["activeProgram"]),calendarDate(){const e=se();return e.currentSelectedNextAppointmentDate?z.toStandardHisDisplayFormat(e.currentSelectedNextAppointmentDate):""},runOutDate(){var a;const e=se();return((a=this.activeProgram)==null?void 0:a.program_id)===14?Xe():e.getAppointmentMedicationRunOutDate()}},watch:{calendarDate:{handler(){this.updateNextAppointment()},deep:!0},"$service.sessionDate":{handler(){this.updateMinDate()},immediate:!0},"patient.ID":{async handler(e,a){e!==a&&(this.cleanCurrentNextAppointmentDate(),this.checkIfSamePatientInContext(),this.clearNextAppointment())}}},async mounted(){this.checkIfSamePatientInContext(),await this.getAppointmentMents(this.runOutDate.date),await ta().loadGlobalProperty(),this.validateAppointmentCountsCache(),await this.preloadAppointmentCounts(),aa();const e=U.getUserID(),a=new tt;this.appointment=new Ee(a.getID(),e),this.nextAppointmentDate=this.appointment.date,this.supposedRunOutDate(),window.addEventListener("storage",this.handleStorageChange),Xe()},beforeUnmount(){window.removeEventListener("storage",this.handleStorageChange)},methods:{handleStorageChange(e){e.key==="sessionDate"&&this.updateMinDate()},updateMinDate(){this.date=new Date(U.getSessionDate()),this.minDate=new Date(U.getSessionDate())},updateNextAppointment(){se().setNextAppointment(this.calendarDate)},async handleDateUpdate(e){e&&(xe().setAssignedAppointmentsDates(e,!0),this.calendarDate=z.toStandardHisDisplayFormat(e),await this.save(),await this.getAppointmentMents(e),await this.updateAppointmentCache(e),se().setCurrentSelectedNextAppointmentDate(e,this.patient.ID))},async getAppointmentMents(e){if(ea().apiStatus)try{const t=await Ee.getDailyAppointments(z.toStandardHisFormat(e),z.toStandardHisFormat(e));this.appointment_count=t.length}catch(t){}},getCounter(e){const a=z.toStandardHisFormat(e);return this.appointmentCountsCache[a]||""},async save(){if(this.assignedAppointmentsDates.length>0)try{const a=await new Ta().createOfflineAppointment()}catch(e){}},async openCornfirmModal(e){this.calendarDate=z.toStandardHisDisplayFormat(e),await this.getAppointmentMents(e),at(Zt,{class:"otherVitalsModal"},!0,{message:"Are you sure you want to add this Appointment?"},{cancel:u=>{},confirm:async u=>{u.detail==!0&&await this.handleDateUpdate(e)}})},async handleInput(e){this.inputPRDate=z.toStandardHisDisplayFormat(e),await this.openCornfirmModal(e)},async supposedRunOutDate(){await Jt.getLastDrugsReceived(this.patient.patientID)},async preloadAppointmentCounts(){try{const e=new Date(U.getSessionDate());e.setDate(1);const a=new Date(U.getSessionDate());a.setMonth(a.getMonth()+2),a.setDate(0);try{const t=await Ee.getDailyAppointments(z.toStandardHisFormat(e),z.toStandardHisFormat(a));if(!t)return;const l=this.filterUniqueAppointments(t),u={};l.forEach(d=>{const v=new Date(d.appointment_date),s=z.toStandardHisFormat(v);u[s]||(u[s]=0),u[s]++}),Object.keys(u).forEach(d=>{this.appointmentCountsCache[d]=u[d]})}catch(t){console.error("Error fetching appointments for date range:",t)}}catch(e){console.error("Error in preload process:",e)}},filterUniqueAppointments(e){const a=new Map;return e.forEach(t=>{const l="".concat(t.given_name,"_").concat(t.family_name,"_").concat(t.birthdate,"_").concat(t.appointment_date);a.has(l)||a.set(l,t)}),Array.from(a.values())},async updateAppointmentCache(e){try{const a=z.toStandardHisFormat(e),t=await Ee.getDailyAppointments(z.toStandardHisFormat(e),z.toStandardHisFormat(e));if(!t)return;this.appointmentCountsCache[a]=t.length}catch(a){console.error("Error updating appointment cache:",a)}},validateAppointmentCountsCache(){se().checkCurrentLocationIfInContext()},isRunOutDate(e){return!this.runOutDate||!this.runOutDate.date?!1:z.toStandardHisFormat(e)===z.toStandardHisFormat(this.runOutDate.date)},cleanCurrentNextAppointmentDate(){se().cleanCurrentSelectedNextAppointmentDate()},checkIfSamePatientInContext(){const e=se();e.current_patient.ID!=this.patient.ID&&(this.cleanCurrentNextAppointmentDate(),e.setCurrentPatient(this.patient))},clearNextAppointment(){se().clearAppointmentMedicationRunOutDate()}}}),qn={class:"card_content"},Yn={class:"count-badge"},jn={class:"dates_title"},Qn={class:"sub_data"},Kn={class:"dates_title"},Xn={class:"sub_data"},Jn={class:"dates_title"},Zn={class:"sub_data"},es={class:"dates_title"},ts={class:"sub_data"};function as(e,a,t,l,u,d){const v=M("VueDatePicker"),s=M("ion-col"),T=M("DynamicButton"),S=M("ion-item"),f=M("ion-row"),A=M("DateInputField");return _(),L("div",qn,[i(f,null,{default:r(()=>[i(s,{"size-sm":"12","size-md":"12","size-lg":"12","size-xl":"8"},{default:r(()=>[i(v,{class:"calender",onDateUpdate:e.openCornfirmModal,inline:"","auto-apply":"","enable-time-picker":!1,"disabled-dates":e.disabledDates,"min-date":e.minDate,modelValue:e.runOutDate.date,"onUpdate:modelValue":a[0]||(a[0]=E=>e.runOutDate.date=E)},{day:r(({day:E,date:R})=>[(_(),L("p",{key:0,class:ve({"run-out-date":e.isRunOutDate(R)}),style:{"font-weight":"600","font-size":"20px"}},[b("span",null,[Y(q(E),1),b("sup",Yn,q(e.getCounter(R)),1)])],2))]),_:1},8,["onDateUpdate","disabled-dates","min-date","modelValue"])]),_:1}),e.show_peripheral?(_(),Q(s,{key:0},{default:r(()=>[i(S,null,{default:r(()=>[b("div",jn,[a[3]||(a[3]=b("div",null,[Y("Suggested Next Appointment Date "),b("span",{style:{"font-size":"16px"}},"(Medication run out date)")],-1)),b("div",Qn,[Y(q(e.runOutDate.formattedDate||"No run out date available")+" ",1),e.runOutDate.formattedDate?(_(),Q(T,{key:0,onClick:a[1]||(a[1]=E=>e.handleDateUpdate(e.runOutDate.date)),name:"Set Next Appt.",fill:"solid",iconSlot:"icon-only",style:{float:"right"}})):F("",!0)])])]),_:1}),i(S,null,{default:r(()=>[b("div",Kn,[a[4]||(a[4]=b("div",null,"User set appointment date",-1)),b("div",Xn,q(e.calendarDate),1)])]),_:1}),i(S,null,{default:r(()=>[b("div",Jn,[a[5]||(a[5]=b("div",null,"Appointments",-1)),b("div",Zn,q(e.appointment_count),1)])]),_:1}),i(S,null,{default:r(()=>[b("div",es,[a[6]||(a[6]=b("div",null,"Appointment limit (per/day)",-1)),b("div",ts,q(e.appointment_count)+"/"+q(e.maximumNumberOfDaysForEachDay),1)])]),_:1})]),_:1})):F("",!0)]),_:1}),e.show_peripheral?(_(),Q(f,{key:0},{default:r(()=>[i(s,{size:"4"},{default:r(()=>[i(A,{inputHeader:"Preferred Next Appointment Date",bold:"600",fontSize:"17px",placeholderFontSize:"17px",placeholderFontWeight:"600",unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.inputPRDate,eventType:"",minDate:e.minDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":a[2]||(a[2]=E=>e.handleInput(E))},null,8,["icon","inputValue","minDate"])]),_:1})]),_:1})):F("",!0)])}const As=oe(Wn,[["render",as],["__scopeId","data-v-4e58e0bc"]]);export{Is as A,Cs as D,bs as I,vt as L,As as N,In as _,Ss as a,Ya as b,Sn as i};

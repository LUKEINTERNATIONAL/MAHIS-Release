import{d as N,a as C,r as g,H as y,e as M,f as x,k as a,l,J as u,Q as D,u as w,N as Y,R as L,cr as X,w as H,b7 as J,cY as Z,n as tt,O as et,m as at,ab as st,p as it,ae as nt}from"./vendor-Do1wNTJR.js";import{a1 as V,V as lt,F as R,t as k,_ as O,a0 as F,S as j,K as Q,n as $,D as ot,o as B,a3 as rt,g as A,H as G,T as ut}from"../index-BqlopBXU.js";import{u as dt}from"./StockStore-Cl8DxV3R.js";import{u as _t}from"./StartEndDate-B6dSxQio.js";import{B as P}from"./BasicForm-v8TM_gE2.js";import{v as I}from"./group_validation-DO40xpDn.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-CCt-rnNp.js";import"./DateInputField-CAJn8xHQ.js";const pt={class:"pim-cls-1 modal_wrapper"},vt={class:"center text_12"},gt={class:"btnContent"},ft={class:"saveBtn"},mt=N({__name:"AddVillage",props:{taData:Object},setup(h){C(async()=>{});const _=h,f=()=>{L.dismiss()},p=async()=>{if(await I(d.value)){const o=V(d.value,"Village","value").split(",");await lt.createAddress({address_type:"Village",addresses:o,parent_location:_.taData.traditional_authority_id})&&R("Location added successfully"),f()}else k("Please fill all the required field")},d=g([{data:{rowData:[{colData:[{inputHeader:"Village*",value:"",name:"Village",eventType:"input",alertsErrorMassage:"",validate:!1,required:!0}]}]}}]);return(o,s)=>{const n=y("ion-row");return x(),M("div",pt,[s[3]||(s[3]=a("div",{class:"OtherVitalsHeading"},[a("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add Village")],-1)),a("div",null,[a("div",vt,[l(n,null,{default:u(()=>[l(P,{contentData:d.value},null,8,["contentData"])]),_:1})])]),a("div",gt,[a("div",ft,[l(w(Y),{class:"btnText",color:"danger",fill:"solid",onClick:s[0]||(s[0]=v=>f()),style:{"margin-right":"8px"}},{default:u(()=>[...s[1]||(s[1]=[D(" Cancel ",-1)])]),_:1}),l(w(Y),{class:"btnText",fill:"solid",onClick:p},{default:u(()=>[...s[2]||(s[2]=[D(" Save ",-1)])]),_:1})])])])}}}),yt=O(mt,[["__scopeId","data-v-1152b56a"]]),bt={class:"pim-cls-1 modal_wrapper"},wt={class:"center text_12"},ht={class:"btnContent"},Tt={class:"saveBtn"},Dt=N({__name:"UpdateVillage",props:{villageData:Object},setup(h){C(async()=>{await f()});const _=h,f=async()=>{F(o.value,"Village","value",_.villageData.name)},p=()=>{L.dismiss()},d=async()=>{if(await I(o.value)){const s=V(o.value,"Village","value");await j.putJson("villages/".concat(_.villageData.village_id),{id:_.villageData.village_id,name:s,ta_id:_.villageData.traditional_authority_id})&&R("Village updated successfully"),p()}else k("Please fill all the required field")},o=g([{data:{rowData:[{colData:[{inputHeader:"Village*",value:"",name:"Village",eventType:"input",alertsErrorMassage:"",validate:!1,required:!0}]}]}}]);return(s,n)=>{const v=y("ion-row"),m=y("ion-button");return x(),M("div",bt,[n[3]||(n[3]=a("div",{class:"OtherVitalsHeading"},[a("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add TA")],-1)),a("div",null,[a("div",wt,[l(v,null,{default:u(()=>[l(P,{contentData:o.value},null,8,["contentData"])]),_:1})])]),a("div",ht,[a("div",Tt,[l(m,{class:"btnText",color:"danger",fill:"solid",onClick:n[0]||(n[0]=E=>p()),style:{"margin-right":"8px"}},{default:u(()=>[...n[1]||(n[1]=[D(" Cancel ",-1)])]),_:1}),l(m,{class:"btnText",fill:"solid",onClick:d},{default:u(()=>[...n[2]||(n[2]=[D(" Save ",-1)])]),_:1})])])])}}}),At=O(Dt,[["__scopeId","data-v-cfc2edfa"]]),xt={key:0,class:"spinner-overlay"},St={class:"container"},Vt={style:{"margin-top":"25px"}},$t={class:"table-responsive"},Nt=N({__name:"ManageVillageModal",props:{taData:Object},setup(h){const _=dt(),f=Q(),p=X(),d=g(null),o=g(!1),s=h,n=g({responsive:!0,select:!1,processing:!0,serverSide:!0,pageLength:10,searching:!0,ajax:async function(i,r){var t;try{o.value=!0;const e=Math.floor(i.start/i.length)+1;let c={traditional_authority_id:s.taData.traditional_authority_id};(t=i.search)!=null&&t.value&&(c.name={$regex:new RegExp(i.search.value,"i")});const b={currentPage:e,itemsPerPage:i.length,selector:c},T=await A("villages",b),K=await Promise.all(T.records.map(async S=>({name:S.name,actions:'\n                            <button class="btn btn-sm btn-primary edit-btn" data-id=\''.concat(JSON.stringify(S),"'>Edit</button>\n                            <button class=\"btn btn-sm btn-danger delete-btn\" data-id='").concat(JSON.stringify(S),"'>Delete</button>\n                        ")})));r({draw:i.draw,recordsTotal:T.totalCount,recordsFiltered:T.totalCount,data:K})}catch(e){console.error("Error fetching data:",e),k("An error occurred while loading data."),r({draw:i.draw,recordsTotal:0,recordsFiltered:0,data:[]})}finally{o.value=!1}},columns:[{data:"name"},{data:"actions"}],language:{processing:"Loading...",emptyTable:"No data available",info:"Showing _START_ to _END_ of _TOTAL_ entries",infoEmpty:"Showing 0 to 0 of 0 entries",lengthMenu:"Show _MENU_ entries",loadingRecords:"Loading...",search:"Search:",zeroRecords:"No matching records found"}});function v(){L.dismiss("dismiss")}const m=(i=!0)=>{d.value.dt.ajax.reload(null,i)},E=async()=>{const i=JSON.parse(JSON.stringify(s.taData));await B(yt,{class:"fullScreenModal"},!0,{taData:i}),m(!1)},q=async(i,r)=>{await rt("Do you want to delete village ".concat(i.name," ?"),r)&&z(i)},z=async i=>{const r=await j.delete("villages/".concat(i.village_id),{id:i.village_id});(r==null?void 0:r.message)=="Village successfully deleted"&&await f.postData({command:"deleteData",storeName:"villages",data:{village_id:i.village_id}}),m(!1)};H(()=>_.stock,async()=>{const i=d.value.dt;i==null||i.ajax.reload()},{deep:!0}),H(()=>p,async()=>{const i=d.value.dt;i==null||i.ajax.reload()},{deep:!0});const U=async i=>{await B(At,{class:"fullScreenModal"},!0,{villageData:i}),m(!1)},W=()=>{const i=d.value.dt;i.on("click",".edit-btn",r=>{const t=r.target.getAttribute("data-id");t&&U(JSON.parse(t))}),i.on("click",".delete-btn",r=>{const t=r.target.getAttribute("data-id");t&&q(JSON.parse(t),r)})};return C(()=>{J.use(Z),tt(()=>{W()})}),(i,r)=>{const t=y("ion-spinner"),e=y("ion-title"),c=y("ion-icon"),b=y("ion-header");return x(),et(w(nt),{class:it({loading:o.value})},{default:u(()=>[o.value?(x(),M("div",xt,[l(t,{name:"bubbles"}),r[2]||(r[2]=a("div",{class:"loading-text"},"Please wait...",-1))])):at("",!0),l(b,{style:{display:"flex","justify-content":"space-between"}},{default:u(()=>[l(e,{class:"modalTitle"},{default:u(()=>[...r[3]||(r[3]=[D("Village Management",-1)])]),_:1}),l(c,{onClick:r[0]||(r[0]=T=>v()),style:{"padding-top":"10px","padding-right":"10px"},icon:w($).cancel},null,8,["icon"])]),_:1}),l(w(st),{style:{"--background":"#fff"}},{default:u(()=>[a("div",St,[a("div",Vt,[l(ot,{style:{height:"45px"},name:" Add Village",size:"small",iconSlot:"start",icon:w($).plusWhite,onClick:r[1]||(r[1]=T=>E())},null,8,["icon"])]),a("div",$t,[l(w(J),{ref_key:"dataTableRef",ref:d,options:n.value,class:"display nowrap",width:"100%"},{default:u(()=>[...r[4]||(r[4]=[a("thead",null,[a("tr",null,[a("th",null,"Villages"),a("th",null,"Action")])],-1)])]),_:1},8,["options"])])])]),_:1})]),_:1},8,["class"])}}}),Ct=O(Nt,[["__scopeId","data-v-0609d13b"]]),Mt={class:"pim-cls-1 modal_wrapper"},kt={class:"center text_12"},Ot={class:"btnContent"},Et={class:"saveBtn"},Ft=N({__name:"AddTA",setup(h){C(async()=>{await _()});const _=async()=>{F(d.value,"TA_district","multiSelectData",await A("districts",{selector:{region_id:{$ne:4}}}))},f=()=>{L.dismiss()},p=async()=>{if(await I(d.value)){const o=V(d.value,"TA","value"),s=V(d.value,"Village","value").split(","),n=V(d.value,"TA_district","value").district_id;await lt.createAddress({address_type:"Village",addresses:s,parent_location:n,ta_name:o})&&R("Location added successfully"),f()}else k("Please fill all the required field")},d=g([{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"District*",icon:$.search,value:"",name:"TA_district",setName:"TALocation",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,popOver:!0,trackBy:"district_id",multiSelectData:[],id:"",idName:"district_id",validationFunctionName:"required"}]}]}},{data:{rowData:[{colData:[{inputHeader:"TA*",value:"",name:"TA",eventType:"input",alertsErrorMassage:"",validationFunctionName:"required"}]}]}},{data:{rowData:[{colData:[{inputHeader:"Village*",value:"",name:"Village",eventType:"input",alertsErrorMassage:"",validate:!1,validationFunctionName:"required"}]}]}}]);return(o,s)=>{const n=y("ion-row"),v=y("ion-button");return x(),M("div",Mt,[s[3]||(s[3]=a("div",{class:"OtherVitalsHeading"},[a("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add TA")],-1)),a("div",null,[a("div",kt,[l(n,null,{default:u(()=>[l(P,{contentData:d.value},null,8,["contentData"])]),_:1})])]),a("div",Ot,[a("div",Et,[l(v,{class:"btnText",color:"danger",fill:"solid",onClick:s[0]||(s[0]=m=>f()),style:{"margin-right":"8px"}},{default:u(()=>[...s[1]||(s[1]=[D(" Cancel ",-1)])]),_:1}),l(v,{class:"btnText",fill:"solid",onClick:p},{default:u(()=>[...s[2]||(s[2]=[D(" Save ",-1)])]),_:1})])])])}}}),Bt=O(Ft,[["__scopeId","data-v-6b698657"]]),Lt={class:"pim-cls-1 modal_wrapper"},Pt={class:"center text_12"},Ht={class:"btnContent"},Jt={class:"saveBtn"},Rt=N({__name:"UpdateTA",props:{taData:Object},setup(h){C(async()=>{await f()});const _=h,f=async()=>{const s=await A("districts",{selector:{district_id:_.taData.district_id}});F(o.value,"TA_district","multiSelectData",await A("districts",{selector:{region_id:{$ne:4}}})),F(o.value,"TA_district","value",s[0]),F(o.value,"TA","value",_.taData.name)},p=()=>{L.dismiss()},d=async()=>{if(await I(o.value)){const s=V(o.value,"TA","value"),n=V(o.value,"TA_district","value").district_id;await j.putJson("traditional_authorities/".concat(_.taData.traditional_authority_id),{id:_.taData.traditional_authority_id,name:s,district_id:n})&&R("TA updated successfully"),p()}else k("Please fill all the required field")},o=g([{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"District*",icon:$.search,value:"",name:"TA_district",setName:"TALocation",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,popOver:!0,trackBy:"district_id",multiSelectData:[],id:"",idName:"district_id",validationFunctionName:"required"}]}]}},{data:{rowData:[{colData:[{inputHeader:"TA*",value:"",name:"TA",eventType:"input",alertsErrorMassage:"",validationFunctionName:"required"}]}]}}]);return(s,n)=>{const v=y("ion-row"),m=y("ion-button");return x(),M("div",Lt,[n[3]||(n[3]=a("div",{class:"OtherVitalsHeading"},[a("div",{class:"OtherVitalsTitle",style:{color:"#1f2221d4","font-size":"16px"}},"Add TA")],-1)),a("div",null,[a("div",Pt,[l(v,null,{default:u(()=>[l(P,{contentData:o.value},null,8,["contentData"])]),_:1})])]),a("div",Ht,[a("div",Jt,[l(m,{class:"btnText",color:"danger",fill:"solid",onClick:n[0]||(n[0]=E=>p()),style:{"margin-right":"8px"}},{default:u(()=>[...n[1]||(n[1]=[D(" Cancel ",-1)])]),_:1}),l(m,{class:"btnText",fill:"solid",onClick:d},{default:u(()=>[...n[2]||(n[2]=[D(" Save ",-1)])]),_:1})])])])}}}),jt=O(Rt,[["__scopeId","data-v-c3da4f3d"]]),It={key:0,class:"spinner-overlay"},qt={class:"container"},zt={style:{display:"flex","justify-content":"space-between"}},Ut={style:{width:"50%","max-width":"350px"}},Wt={style:{"margin-top":"25px"}},Kt={class:"table-responsive"},Qt=N({__name:"LocationsManagement",setup(h){const _=dt();_t();const f=X(),p=g(null),d=g(!1);g("all"),g(G.sessionDate()),g(G.sessionDate());const o=g(""),s=g([]),n=async t=>Promise.all(t.map(async e=>{const c=await A("districts",{selector:{district_id:e.district_id}}),b=await A("villages",{selector:{traditional_authority_id:e.traditional_authority_id}});return{ta_id:e.traditional_authority_id,name:e.name,district:c[0].name,villages:'<button class="btn btn-sm btn-primary view-btn" data-id=\''.concat(JSON.stringify(e),"'> View ").concat(b.length,"   </button>"),actions:'\n                    <button class="btn btn-sm btn-primary edit-btn" data-id=\''.concat(JSON.stringify(e),"'>Edit</button>\n                    <button class=\"btn btn-sm btn-danger delete-btn\" data-id='").concat(JSON.stringify(e),"'>Delete</button>\n                ")}})),v=(t=!0)=>{p.value.dt.ajax.reload(null,t)},m=g({responsive:!0,select:!1,processing:!0,serverSide:!0,pageLength:10,searching:!0,ajax:async function(t,e){var c;try{d.value=!0;const b=Math.floor(t.start/t.length)+1;let T={};o.value&&(T.district_id=o.value),(c=t.search)!=null&&c.value&&(T.name={$regex:new RegExp(t.search.value,"i")});const K={currentPage:b,itemsPerPage:t.length,selector:T},S=await A("traditional_authorities",K),ct=await n(S.records);e({draw:t.draw,recordsTotal:S.totalCount,recordsFiltered:S.totalCount,data:ct})}catch(b){console.error("Error fetching data:",b),k("An error occurred while loading data."),e({draw:t.draw,recordsTotal:0,recordsFiltered:0,data:[]})}finally{d.value=!1}},columns:[{data:"ta_id"},{data:"name"},{data:"district"},{data:"villages"},{data:"actions"}],language:{processing:"Loading...",emptyTable:"No data available",info:"Showing _START_ to _END_ of _TOTAL_ entries",infoEmpty:"Showing 0 to 0 of 0 entries",lengthMenu:"Show _MENU_ entries",loadingRecords:"Loading...",search:"Search:",zeroRecords:"No matching records found"}}),E=async t=>{await B(Ct,{class:"fullScreenModal"},!0,{taData:t})==="dismiss"&&v(!1)},q=async t=>{var e;o.value=(e=t==null?void 0:t.value)==null?void 0:e.district_id,v()},z=async(t,e)=>{const c=JSON.parse(t);await rt("Do you want to delete TA ".concat(c.name," ?"),e)&&U(c)},U=async t=>{const e=await j.delete("traditional_authorities/".concat(t.traditional_authority_id),{id:t.traditional_authority_id});(e==null?void 0:e.message)=="Traditional Authority and associated villages successfully deleted"&&(Q().postData({command:"deleteData",storeName:"traditional_authorities",data:{traditional_authority_id:t.traditional_authority_id}}),Q().postData({command:"deleteData",storeName:"villages",data:{traditional_authority_id:t.traditional_authority_id}})),v(!1)},W=async()=>{await B(Bt,{class:"otherVitalsModal"}),v(!1)},i=async t=>{await B(jt,{class:"otherVitalsModal"},!0,{taData:t}),v(!1)};H(()=>_.stock,async()=>{const t=p.value.dt;t==null||t.ajax.reload()},{deep:!0}),H(()=>f,async t=>{if(t.name=="LocationsManagement"){const e=p.value.dt;e==null||e.ajax.reload()}},{deep:!0});const r=()=>{const t=p.value.dt;t.on("click",".edit-btn",e=>{const c=e.target.getAttribute("data-id");c&&i(JSON.parse(c))}),t.on("click",".delete-btn",e=>{const c=e.target.getAttribute("data-id");c&&z(c,e)}),t.on("click",".view-btn",e=>{const c=e.target.getAttribute("data-id");c&&E(JSON.parse(c))})};return C(async()=>{s.value=[{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"Filter by districts",popOver:!0,icon:$.search,value:"",name:"filter_district",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,trackBy:"district_id",multiSelectData:await A("districts",{selector:{region_id:{$ne:4}}}),id:"",idName:"district_id"}]}]}}],J.use(Z),tt(()=>{r()})}),(t,e)=>{const c=y("ion-spinner");return x(),et(w(nt),{class:it({loading:d.value})},{default:u(()=>[d.value?(x(),M("div",It,[l(c,{name:"bubbles"}),e[1]||(e[1]=a("div",{class:"loading-text"},"Please wait...",-1))])):at("",!0),l(ut),l(w(st),null,{default:u(()=>[a("div",qt,[e[3]||(e[3]=a("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"TA Management",-1)),a("div",zt,[a("div",Ut,[l(P,{contentData:s.value,"onUpdate:inputValue":q},null,8,["contentData"])]),a("div",Wt,[l(ot,{style:{height:"45px"},name:" Add TA",size:"small",iconSlot:"start",icon:w($).plusWhite,onClick:e[0]||(e[0]=b=>W())},null,8,["icon"])])]),a("div",Kt,[l(w(J),{ref_key:"dataTableRef",ref:p,options:m.value,class:"display nowrap",width:"100%"},{default:u(()=>[...e[2]||(e[2]=[a("thead",null,[a("tr",null,[a("th",null,"ID"),a("th",null,"TA"),a("th",null,"District"),a("th",null,"Villages"),a("th",null,"Action")])],-1)])]),_:1},8,["options"])])])]),_:1})]),_:1},8,["class"])}}}),ne=O(Qt,[["__scopeId","data-v-a96719ae"]]);export{ne as default};

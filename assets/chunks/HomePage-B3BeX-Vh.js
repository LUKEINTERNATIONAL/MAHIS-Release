var Tn=Object.defineProperty;var Nn=(e,t,a)=>t in e?Tn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var fe=(e,t,a)=>Nn(e,typeof t!="symbol"?t+"":t,a);import{d as Q,cZ as On,am as Te,r as F,c as q,w as ge,a as _e,e as b,f as d,k as n,m as T,p as ue,K as w,l as o,u as C,b3 as ut,Q as x,L as Y,F as K,P as ae,c_ as Rn,cb as Fn,av as Et,bD as Bn,bp as Ln,c6 as pt,be as Ht,b7 as Me,H as _,O as H,J as l,D as Ut,cr as He,n as ce,ak as Vn,af as me,c$ as Wt,d0 as jt,ao as zt,d1 as qt,d2 as Mn,cg as Gt,d3 as xn,d4 as En,d5 as Hn,d6 as Un,d7 as Wn,d8 as jn,d9 as zn,aU as qn,bT as Jt,aV as Xe,aR as mt,aS as ft,bw as Ue,ad as Ze,N as Se,ac as et,G as Ne,ae as xe,I as ve,ab as pe,bE as lt,a9 as Gn,da as Jn,aE as Qn,db as Yn,dc as Kn,cG as Xn,aD as Zn,cL as Qt,aM as Ee,b2 as Qe,a1 as Ye,dd as Yt,aI as ht,aC as ea,i as we,b9 as ta,de as na,z as aa,df as gt,dg as Pe,a2 as Ae,dh as Kt,ba as sa,bu as oa,br as ia,E as We,ag as je,ah as Oe,a6 as Re,R as ze,bb as ra,di as la,dj as da,dk as ca,dl as ua,bC as tt,b6 as _t,b as pa,a0 as Xt,aT as Pt,b4 as ma,aW as fa,dm as ha,v as Ie,M as ga,aa as _a,dn as va,dp as Zt,dq as ya,ca as ba,dr as Da,ds as $a,bx as wa,b$ as Ca}from"./vendor-BTebhqHt.js";import{S as j,u as re,_ as Z,P as Fe,t as oe,a as en,E as tn,H as B,g as Ce,b as vt,A as ka,c as Ia,d as nn,e as At,f as yt,h as Sa,i as qe,R as Pa,p as Aa,j as Tt,k as Ta,O as Na,l as Oa,B as Ra,m as Nt,n as se,o as Le,q as Fa,r as an,s as dt,v as Ba,w as Ot,x as La,y as Va,z as Ma,C as xa,D as st,F as ot,G as Rt,I as Ft,J as Be,T as sn,K as Ea,L as he,M as Bt,N as Ha,Q as Ua,U as Wa,V as ja,W as za}from"../index-Bgj4Spg5.js";import{m as Ke}from"./apexcharts-no8IW45T.js";import{A as on}from"./ncd_appointment_service-BbVOdlkc.js";import{D as bt}from"./DateInputField-DkQBtt49.js";import{u as qa,_ as Ga,M as Ja}from"./ActionButtons.vue_vue_type_script_setup_true_lang-Y3fj0v1A.js";import{V as Qa}from"./ViewToggleComponent-CDUXg90U.js";import{B as Ya}from"./bottomNavBar-DXoyXzym.js";import{P as Ka}from"./patient_report_service-B86shuWD.js";import{l as Ve}from"./lodash-NJiRuGo9.js";import{B as Ge}from"./BasicForm-L1Fe7doK.js";import{B as nt}from"./BasicCard-DS3OGd-l.js";import{u as Xa}from"./AdministerOtherVaccinesStore-CMEV2ux8.js";import{c as Za}from"./customDatePicker-CrftdP0i.js";import{s as es}from"./vaccines_service-BYAmYoLn.js";import{g as ts}from"./dashboard_service-CewIhiLU.js";import{i as ns}from"./Img-CJEgX1Vr.js";import{R as as}from"./ReusableDataTable-BqaHGcCq.js";import{R as Lt,u as ss,a as os,_ as is,b as rs,c as ls,d as ds,e as cs,f as us,g as ps}from"./useSetRegistrationValues-AFKSSWJG.js";import{u as rn}from"./useUserActivities-bqLkLFUN.js";import ms from"./NeonatalHome-ZOiqgzgI.js";import"./sms_service-C0sgSJqT.js";import"./EIRreportsStore-xF8KfXWW.js";import"./Export-DBs2gDaN.js";import"./useLocation-CLP2Lqkf.js";import"./neonatal_service-DzQ8LsP7.js";import"./images-Zb0Yk5XL.js";const De={VITALS:6,APPOINTMENT:7,HIV_CLINIC_REGISTRATION:9,TREATMENT:25,HIV_RECEPTION:51,HIV_STAGING:52,HIV_CLINIC_CONSULTATION:53,DISPENSING:54,ART_ADHERENCE:68};class Vt extends j{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(t){return await super.getJson("fhir/patient/".concat(t),{id:t})}static async getFhirObservations(t){return await super.getJson("fhir/patient/".concat(t,"/observations/"),{id:t})}}const fs={class:"fhir-viewer"},hs={class:"container"},gs={key:0,class:"main-header"},_s={class:"header-line"},vs={key:0,class:"last-updated-display"},ys={key:1,class:"card initial-input-card"},bs={class:"action-area-initial"},Ds={key:0,class:"card patient-card"},$s={class:"card-title"},ws={class:"patient-info-grid"},Cs={class:"info-item"},ks={class:"info-value"},Is={class:"info-item"},Ss={class:"info-value"},Ps={class:"info-item"},As={class:"info-value"},Ts={class:"info-item"},Ns={class:"info-value"},Os={class:"info-value"},Rs={class:"info-value"},Fs={class:"info-label"},Bs={class:"info-value"},Ls={key:2,class:"card observations-card"},Vs={class:"card-title"},Ms={class:"observations-grid"},xs={class:"obs-header"},Es={class:"obs-title"},Hs={class:"obs-details"},Us={class:"obs-detail obs-value-highlight"},Ws={class:"obs-value"},js={class:"obs-detail"},zs={class:"obs-value"},qs={key:0,class:"obs-detail"},Gs={class:"obs-value"},Js={key:3,class:"no-data-found"},Qs={key:4,class:"no-data-found"},Ys={key:5,class:"main-footer"},Ks=Q({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(e){On({"person-circle-outline":Ht,"clipboard-outline":pt,"search-outline":Ln,"information-circle-outline":Bn,"alert-circle-outline":Et,"person-add-outline":Fn,"arrow-back-outline":Rn});const t=e,a=Te(),s=F(!1),i=F([]),c=F(),r=F(),u=F(null),m=F([]),f=q(()=>i.value.some(S=>S.resourceType==="Bundle"&&S.entry&&S.entry.some($=>$.resource&&$.resource.resourceType==="Patient"))),p=q(()=>m.value.length>0),D=async()=>{if(i.value=[],r.value=null,u.value=null,m.value=[],!c.value){console.error("Please enter a Patient Identifier.");return}s.value=!0;try{const S=await Vt.getFhirPatient(c.value);if(S&&S.entry&&S.entry.length>0){const $=S.entry[0].resource,G=$.id,J=await Vt.getFhirObservations(G);i.value=[S],J&&(i.value.push(J),m.value=J.entry.filter(ne=>ne.resource&&ne.resource.resourceType==="Observation").map(ne=>{const U=ne.resource;return{id:U.id,display:V(U),value:X(U),date:U.effectiveDateTime,category:U.category&&U.category[0]&&U.category[0].coding&&U.category[0].coding[0]?U.category[0].coding[0].display||U.category[0].coding[0].code:"N/A"}}));const z=$.name&&$.name[0];u.value={personInformation:{given_name:z&&z.given?z.given.join(" "):"",middle_name:z&&z.middle?z.middle.join(" "):"",family_name:z&&z.family?z.family:"",gender:$.gender=="male"?"M":($==null?void 0:$.gender)=="female"?"F":"",birthdate:$.birthDate||"",cell_phone_number:$.telecom&&$.telecom[0]?$.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:$.contact&&$.contact[0]&&$.contact[0].telecom?$.contact[0].telecom[0].value:""}]}};const L=[S,J].filter(Boolean).reduce((ne,U)=>{if(U.meta&&U.meta.lastUpdated){const de=new Date(U.meta.lastUpdated);return ne===null||de>ne?de:ne}return ne},null);L&&(r.value=N(L.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch(S){console.error("Error loading FHIR data:",S),i.value=[],r.value=null,u.value=null,m.value=[]}finally{s.value=!1}},h=S=>{if(S.name&&S.name[0]){const $=S.name[0],G=$.given?$.given.join(" "):"",J=$.family||"";return"".concat(G," ").concat(J).trim()||"N/A"}return"N/A"},v=S=>S.identifier&&S.identifier.length>0?S.identifier.map($=>{let G="Unknown System";if($.type&&$.type.coding&&$.type.coding[0]&&$.type.coding[0].display)G=$.type.coding[0].display;else if($.system){const z=$.system.split("/");G=z[z.length-1]||$.system,$.system==="urn:oid:2.16.840.1.113883.4.6"&&(G="Social Security Number")}sessionStorage.setItem(G,$.value);let J=null;return $.assigner&&$.assigner.display?J=$.assigner.display:$.assigner&&$.assigner.reference&&(J=$.assigner.reference.split("/").pop()||$.assigner.reference),{value:$.value||"N/A",systemDisplay:G,periodStart:$.period?$.period.start:null,periodEnd:$.period?$.period.end:null,assignerDisplay:J}}):[],g=S=>S.telecom&&S.telecom.length>0?S.telecom.filter($=>$.system==="phone"&&$.value):[],y=S=>{if(S.contact&&S.contact.length>0){const $=S.contact.filter(J=>{var z;return(z=J.relationship)==null?void 0:z.some(W=>{var L;return(L=W.coding)==null?void 0:L.some(ne=>ne.code==="GUARD")})}),G=[];return $.forEach(J=>{J.telecom&&J.telecom.length>0&&J.telecom.filter(z=>z.system==="phone"&&z.value).forEach(z=>G.push(z))}),G}return[]},k=S=>{if(!S)return"N/A";try{return new Date(S).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch($){return console.error("Invalid date string for formatDate:",S,$),"Invalid Date"}},N=S=>{if(!S)return"N/A";try{return new Date(S).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch($){return console.error("Invalid date time string for formatDateTime:",S,$),"Invalid Date/Time"}},O=S=>{if(!S)return"N/A";try{const $=new Date,G=new Date(S);let J=$.getFullYear()-G.getFullYear();const z=$.getMonth()-G.getMonth();return(z<0||z===0&&$.getDate()<G.getDate())&&J--,J}catch($){return console.error("Invalid birth date string for calculateAge:",S,$),"N/A"}},P=S=>{if(S.meta&&S.meta.tag){const $=S.meta.tag.find(G=>G.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return $?$.code:"Unknown"}return"Unknown"},V=S=>S.code&&S.code.coding&&S.code.coding[0]&&(S.code.coding[0].display||S.code.coding[0].code)||"Unknown Observation",X=S=>S.valueQuantity?"".concat(S.valueQuantity.value," ").concat(S.valueQuantity.unit||"").trim():S.valueString?S.valueString:S.valueBoolean!==void 0?S.valueBoolean?"True":"False":"N/A",ee=()=>{re().setRecord(u.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(m.value)),ye("/registration/manual")},le=()=>{i.value=[],c.value="",r.value=null,u.value=null,m.value=[]},ye=S=>{a.push({path:S})};return ge(()=>a,async()=>{i.value=[],m.value=[]},{deep:!0}),_e(()=>{var S;if(t.initialData.length>0){i.value=t.initialData;const G=t.initialData.filter(Boolean).reduce((W,L)=>{if(L.meta&&L.meta.lastUpdated){const ne=new Date(L.meta.lastUpdated);return W===null||ne>W?ne:W}return W},null);G&&(r.value=N(G.toISOString()));const J=t.initialData.find(W=>W.resourceType==="Bundle"&&W.entry&&W.entry.some(L=>L.resource&&L.resource.resourceType==="Patient"));if(J){const W=(S=J.entry.find(L=>L.resource&&L.resource.resourceType==="Patient"))==null?void 0:S.resource;if(W){const L=W.name&&W.name[0];u.value={personInformation:{given_name:L&&L.given?L.given.join(" "):"",middle_name:L&&L.middle?L.middle.join(" "):"",family_name:L&&L.family?L.family:"",gender:W.gender||"",birthdate:W.birthDate||""}}}}const z=t.initialData.find(W=>W.resourceType==="Bundle"&&W.entry&&W.entry.some(L=>L.resource&&L.resource.resourceType==="Observation"));z&&(m.value=z.entry.filter(W=>W.resource&&W.resource.resourceType==="Observation").map(W=>{const L=W.resource;return{id:L.id,display:V(L),value:X(L),date:L.effectiveDateTime,category:L.category&&L.category[0]&&L.category[0].coding&&L.category[0].coding[0]?L.category[0].coding[0].display||L.category[0].coding[0].code:"N/A"}}))}}),(S,$)=>{var G,J,z,W,L,ne;return d(),b("div",fs,[n("div",hs,[(G=i.value)!=null&&G.length?(d(),b("header",gs,[n("div",_s,[$[1]||($[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:ue(["last-updated-display","status-"+P(i.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+w(P(i.value[0].entry[0].resource)),3),r.value?(d(),b("span",vs,"Last Updated: "+w(r.value),1)):T("",!0)])])])):T("",!0),(J=i.value)!=null&&J.length?T("",!0):(d(),b("section",ys,[o(C(ut),{modelValue:c.value,"onUpdate:modelValue":$[0]||($[0]=U=>c.value=U),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",bs,[n("button",{onClick:D,class:"load-data-btn"},[o(C(Y),{name:"search-outline"}),$[2]||($[2]=x(" Find Patient ",-1))])])])),(d(!0),b(K,null,ae(i.value,U=>(d(),b("div",{key:U.id},[U.resourceType==="Bundle"&&U.entry&&U.entry[0]&&U.entry[0].resource.resourceType==="Patient"?(d(),b("section",Ds,[n("h2",$s,[o(C(Y),{name:"person-circle-outline"}),$[3]||($[3]=x(" Patient Demographics",-1))]),n("div",ws,[n("div",Cs,[$[4]||($[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",ks,w(h(U.entry[0].resource)),1)]),n("div",Is,[$[5]||($[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",Ss,w(U.entry[0].resource.gender||"Not specified"),1)]),n("div",Ps,[$[6]||($[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",As,w(k(U.entry[0].resource.birthDate)),1)]),n("div",Ts,[$[7]||($[7]=n("span",{class:"info-label"},"Age",-1)),n("span",Ns,w(O(U.entry[0].resource.birthDate))+" years",1)]),g(U.entry[0].resource).length?(d(!0),b(K,{key:0},ae(g(U.entry[0].resource),(de,ke)=>(d(),b("div",{key:"patient-phone-".concat(ke),class:"info-item"},[$[8]||($[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",Os,w(de.value),1)]))),128)):T("",!0),y(U.entry[0].resource).length?(d(!0),b(K,{key:1},ae(y(U.entry[0].resource),(de,ke)=>(d(),b("div",{key:"guardian-phone-".concat(ke),class:"info-item"},[$[9]||($[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",Rs,w(de.value),1)]))),128)):T("",!0),(d(!0),b(K,null,ae(v(U.entry[0].resource),(de,ke)=>(d(),b("div",{key:de.value||ke,class:"info-item"},[n("span",Fs,w(de.systemDisplay),1),n("span",Bs,w(de.value),1)]))),128))])])):T("",!0)]))),128)),((z=m.value)==null?void 0:z.length)>0?(d(),b("section",Ls,[n("h2",Vs,[o(C(Y),{name:"clipboard-outline"}),$[10]||($[10]=x(" Clinical Observations",-1))]),n("div",Ms,[(d(!0),b(K,null,ae(m.value,U=>(d(),b("div",{key:U.id,class:"observation-item"},[n("div",xs,[n("h3",Es,w(U.display),1)]),n("div",Hs,[n("div",Us,[$[11]||($[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",Ws,w(U.value),1)]),n("div",js,[$[12]||($[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",zs,w(N(U.date)),1)]),U.category&&U.category!=="N/A"?(d(),b("div",qs,[$[13]||($[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",Gs,w(U.category),1)])):T("",!0)])]))),128))])])):T("",!0),(W=i.value)!=null&&W.length&&!f.value?(d(),b("div",Js,[n("p",null,[o(C(Y),{name:"alert-circle-outline"}),$[14]||($[14]=x(" No patient data found for the provided identifier. Please try again.",-1))])])):(L=i.value)!=null&&L.length&&f.value&&!p.value?(d(),b("div",Qs,[n("p",null,[o(C(Y),{name:"information-circle-outline"}),$[15]||($[15]=x(" No clinical observations found for this patient.",-1))])])):T("",!0),(ne=i.value)!=null&&ne.length?(d(),b("footer",Ys,[n("button",{onClick:le,class:"back-to-search-btn small-btn"},[o(C(Y),{name:"arrow-back-outline"}),$[16]||($[16]=x(" Back to Search ",-1))]),n("button",{onClick:ee,class:"register-btn small-btn"},[o(C(Y),{name:"person-add-outline"}),$[17]||($[17]=x(" Register New Patient ",-1))])])):T("",!0)])])}}}),Xs=Z(Ks,[["__scopeId","data-v-0dc329ef"]]),Zs=Q({components:{DataTable:Me},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Referred From",data:"referredFrom"},{title:"Referred By",data:"referredBy"},{title:"Clinic Date",data:"appointmentDate"},{title:"Actions",data:null,render:(e,t,a)=>'<ion-button size="small" fill="solid" color="primary" onclick="window.navigatePatient(\''.concat(a.patient_id,"')\">Profile</ion-button>"),orderable:!1,width:"20%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No referrals found."}}}},async mounted(){var i;const t=(i=en().activeProgram)==null?void 0:i.program_id,a=String(localStorage.getItem("locationID")),s=await tn.getAllEncounters({encounter_type_id:114});console.log("Encounters fetched for Internal Referrals:",s),this.patients=s.reduce((c,r)=>{var h,v,g,y,k,N,O,P;if(String(r==null?void 0:r.location_id)!==a||!((h=r==null?void 0:r.observations)==null?void 0:h.find(V=>(V==null?void 0:V.concept_id)===2227&&(V==null?void 0:V.value_numeric)===t)))return c;const m=(y=(g=(v=r==null?void 0:r.patient)==null?void 0:v.person)==null?void 0:g.names)!=null&&y[0]?"".concat(r.patient.person.names[0].given_name||""," ").concat(r.patient.person.names[0].family_name||""):"Unknown";let f=((k=r==null?void 0:r.program)==null?void 0:k.name)||"Unknown Program";f=f.replace(/program/i,"").trim();const p=(O=(N=r==null?void 0:r.provider)==null?void 0:N.names)!=null&&O[0]?"".concat(r.provider.names[0].given_name||""," ").concat(r.provider.names[0].family_name||""):"Unknown",D=(P=r==null?void 0:r.observations)==null?void 0:P.find(V=>{var X,ee;return(ee=(X=V==null?void 0:V.concept)==null?void 0:X.concept_names)==null?void 0:ee.some(le=>{var ye;return(ye=le==null?void 0:le.name)==null?void 0:ye.toLowerCase().includes("date of referral")})});return c.push({patient_id:r.patient_id,fullName:m,referredFrom:f,referredBy:p,appointmentDate:(D==null?void 0:D.value_text)||"N/A"}),c},[]),window.navigatePatient=this.navigateTo},methods:{async navigateTo(e){let t=await Fe.findByID(e);t?(await re().setPatientRecord(t),this.$router.push("/patientProfile")):oe("Patient not found. Please try searching by name.")}}}),eo={class:"dueCardContent"};function to(e,t,a,s,i,c){const r=_("DataTable"),u=_("ion-card-content"),m=_("ion-card");return d(),H(m,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:l(()=>[o(u,null,{default:l(()=>[n("div",eo,[o(r,{data:e.patients,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})}const ln=Z(Zs,[["render",to],["__scopeId","data-v-a95ef46a"]]),no=Q({name:"referrals",components:{InternalReferrals:ln,ExternalReferrals:Xs},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(e){this.segmentContent=e}}}),ao={key:0},so={style:{display:"flex","margin-top":"10px"}},oo={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},io={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},ro={key:1},lo={key:2};function co(e,t,a,s,i,c){const r=_("ion-label"),u=_("ion-segment-button"),m=_("ion-segment"),f=_("ExternalReferrals"),p=_("InternalReferrals");return d(),b(K,null,[n("div",null,[o(m,{value:e.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:l(()=>[o(u,{value:"External referrals",onClick:t[0]||(t[0]=D=>e.setSegmentContent("External referrals"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[2]||(t[2]=[x("External referrals",-1)])]),_:1})]),_:1}),o(u,{value:"Internal referrals",onClick:t[1]||(t[1]=D=>e.setSegmentContent("Internal referrals"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[3]||(t[3]=[x("Internal referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),e.segmentContent=="Internal referrals"?(d(),b("div",ao,[n("div",so,[e.checkUnderFive?(d(),b("div",oo)):T("",!0),t[4]||(t[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),e.checkUnderFive?T("",!0):(d(),b("div",io))])])):T("",!0),e.segmentContent=="External referrals"?(d(),b("div",ro,[o(f)])):T("",!0),e.segmentContent=="Internal referrals"?(d(),b("div",lo,[o(p)])):T("",!0)],64)}const uo=Z(no,[["render",co],["__scopeId","data-v-8f0f935e"]]),po=Ut("ncdDashboardStore",{state:()=>({dashboardData:null,appointments:[],isLoading:!1,error:null,lastFetchDate:null,programId:32}),getters:{appointmentsCount:e=>e.appointments.length,pendingDispensationsCount:e=>{var t;return((t=e.dashboardData)==null?void 0:t.total_pending_dispensations)||0},defaultersCount:e=>{var t;return((t=e.dashboardData)==null?void 0:t.total_defaulters)||0},complicationsCount:e=>{var t;return((t=e.dashboardData)==null?void 0:t.total_complications)||0},activeClientsCount:e=>{var t;return((t=e.dashboardData)==null?void 0:t.total_client_registered)||0},genderChartData:e=>{var t;return(t=e.dashboardData)!=null&&t.gender_data?{categories:e.dashboardData.gender_data.categories,series:[{name:"Male",data:e.dashboardData.gender_data.maleSeries},{name:"Female",data:e.dashboardData.gender_data.femaleSeries}]}:{categories:[],series:[{name:"Male",data:[]},{name:"Female",data:[]}]}},diagnosisChartData:e=>{var t;return(t=e.dashboardData)!=null&&t.diagnosis_data?{categories:e.dashboardData.diagnosis_data.categories,series:[{name:"Type 1 Diabetes",data:e.dashboardData.diagnosis_data.typeOneSeries},{name:"Type 2 Diabetes",data:e.dashboardData.diagnosis_data.typeTwoSeries},{name:"Hypertention",data:e.dashboardData.diagnosis_data.hypertentionSeries}]}:{categories:[],series:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},hasData:e=>e.dashboardData!==null,isDataStale:e=>{if(!e.lastFetchDate)return!0;const t=B.toStandardHisFormat(B.sessionDate());return e.lastFetchDate!==t}},actions:{async fetchDashboardData(e,t){this.isLoading=!0,this.error=null;try{const a=e||B.toStandardHisFormat(B.sessionDate()),s=t||B.toStandardHisFormat(B.sessionDate()),i="programs/".concat(this.programId,"/reports/ncd_dashboard"),c=await j.getJson(i,{start_date:a,end_date:s});this.setDashboardData(c),this.lastFetchDate=a}catch(a){this.error=a.message||"Failed to fetch dashboard data",console.error("Error fetching NCD dashboard data:",a)}finally{this.isLoading=!1}},setDashboardData(e){this.dashboardData=e},setAppointments(e){this.appointments=e},addAppointment(e){this.appointments.push(e)},removeAppointment(e){this.appointments=this.appointments.filter(t=>t.id!==e)},updateAppointment(e,t){const a=this.appointments.findIndex(s=>s.id===e);a!==-1&&(this.appointments[a]={...this.appointments[a],...t})},setProgramId(e){this.programId=e},clearDashboardData(){this.dashboardData=null,this.appointments=[],this.error=null,this.lastFetchDate=null},async refreshDashboardData(){await this.fetchDashboardData()},async ensureFreshData(){(this.isDataStale||!this.hasData)&&await this.fetchDashboardData()}},persist:{key:"ncd-dashboard-store",storage:localStorage,paths:["dashboardData","appointments","lastFetchDate","programId"]}});async function mo(){const e=localStorage.getItem("locationID"),t=32,s=(await Ce("patients_records",{selector:{location_id:e}})).filter(h=>(h.activePrograms||[]).some(g=>g.program_id===t)),i=s.length,c=s.filter(h=>{var v;return((v=h.personInformation)==null?void 0:v.gender)==="M"}).length,r=s.filter(h=>{var v;return((v=h.personInformation)==null?void 0:v.gender)==="F"}).length,u=fo(s),m=ho(s),f=go(s),p=_o(s),D=vo(s);return{total_client_registered:i,total_male_registered:c,total_female_registered:r,total_complications:u,total_defaulters:m,total_pending_dispensations:f,gender_data:{categories:p.categories,series:[{name:"Male",data:p.male,group:"apexcharts-axis-0"},{name:"Female",data:p.female,group:"apexcharts-axis-0"}]},diagnosis_data:{categories:D.categories,series:[{name:"Type 1 Diabetes",data:D.type_one,group:"apexcharts-axis-0"},{name:"Type 2 Diabetes",data:D.type_two,group:"apexcharts-axis-0"},{name:"Hypertension",data:D.hypertension,group:"apexcharts-axis-0"}]}}}function fo(e){let t=0;return e.forEach(a=>{(a.observations||[]).some(c=>{var r;return c.encounter_type===vt.COMPLICATIONS&&c.status==="saved"&&((r=c.obs)==null?void 0:r.length)>0})&&t++}),t}function ho(e){const t=new Date,a=new Date(t);a.setDate(a.getDate()-60);const s=new Date(t);s.setDate(s.getDate()-120);let i=0;return e.forEach(c=>{var f;const r=((f=c.MedicationOrder)==null?void 0:f.saved)||[];if(r.length===0)return;const u=r.filter(p=>p.quantity>0).sort((p,D)=>new Date(D.start_date).getTime()-new Date(p.start_date).getTime())[0];if(!u)return;const m=new Date(u.start_date);m>=s&&m<=a&&(r.some(D=>new Date(D.start_date)>a)||i++)}),i}function go(e){let t=0;return e.forEach(a=>{var c;(((c=a.MedicationOrder)==null?void 0:c.saved)||[]).some(r=>r.quantity<=0)&&t++}),t}function _o(e){const t={};let a=new Date;for(let c=0;c<4;c++){const r=dn(a),u=cn(r);t[u]={male:new Set,female:new Set},e.forEach(m=>{var v;const f=m.patientID,p=(v=m.personInformation)==null?void 0:v.gender,D=m.observations||[];let h=!1;D.forEach(g=>{var y;g.status==="saved"&&((y=g.obs)==null||y.forEach(k=>{const N=k.obs_datetime?new Date(k.obs_datetime):null;N&&N>=r&&N<=a&&(h=!0)}))}),h&&(p==="M"?t[u].male.add(f):p==="F"&&t[u].female.add(f))}),a=new Date(r),a.setDate(a.getDate()-1)}const s={};Object.entries(t).forEach(([c,r])=>{s[c]={male:r.male.size,female:r.female.size}});const i=un(s);return{categories:Object.keys(i),male:Object.values(i).map(c=>c.male),female:Object.values(i).map(c=>c.female)}}function vo(e){const t={};let a=new Date;for(let c=0;c<4;c++){const r=dn(a),u=cn(r);t[u]={type_one:new Set,type_two:new Set,hypertension:new Set},e.forEach(m=>{const f=m.patientID,p=m.observations||[];let D=null;p.forEach(h=>{var v;h.encounter_type===vt.DIAGNOSIS&&((v=h.obs)==null||v.forEach(g=>{const y=g.obs_datetime?new Date(g.obs_datetime):null;y&&y>=r&&y<=a&&g.concept_id===6542&&(D=g.value_coded)}))}),D===6409?t[u].type_one.add(f):D===6410?t[u].type_two.add(f):(D===8809||D===903)&&t[u].hypertension.add(f)}),a=new Date(r),a.setDate(a.getDate()-1)}const s={};Object.entries(t).forEach(([c,r])=>{s[c]={type_one:r.type_one.size,type_two:r.type_two.size,hypertension:r.hypertension.size}});const i=un(s);return{categories:Object.keys(i),type_one:Object.values(i).map(c=>c.type_one),type_two:Object.values(i).map(c=>c.type_two),hypertension:Object.values(i).map(c=>c.hypertension)}}function dn(e){const t=e.getMonth(),a=Math.floor(t/3)*3;return new Date(e.getFullYear(),a,1)}function cn(e){const t=Math.floor(e.getMonth()/3)+1;return"Q".concat(t," ").concat(e.getFullYear())}function un(e){return Object.fromEntries(Object.entries(e).reverse())}const yo={class:"cards-container"},bo={class:"top-card-text"},Do={class:"text-2xl font-bold"},$o={class:"top-card-text"},wo={class:"text-2xl font-bold"},Co={class:"top-card-text"},ko={class:"text-2xl font-bold"},Io={class:"top-card-text"},So={class:"text-2xl font-bold"},Po={class:"top-card-text"},Ao={class:"text-2xl font-bold"},To={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},No={ref:"chartRef1"},Oo={key:1,class:"loading-state"},Ro={ref:"chartRef2"},Fo={key:1,class:"loading-state"},Bo=Q({__name:"Dashboard",setup(e){const t=Te(),a=He();po();const s=F(!1),i=F({total_pending_dispensations:0,total_defaulters:0,total_complications:0,total_client_registered:0,diagnosis_data:{series:[],categories:[]},gender_data:{series:[],categories:[]},isLoading:!1}),c=F([]),r=q(()=>({chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:i.value.gender_data.categories},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}})),u=q(()=>({chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:i.value.diagnosis_data.categories},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}})),m=async()=>{if(j.getLanConnectionStatus()||j.getPouchDbStatus())i.value=await mo();else{const D=B.toStandardHisFormat(B.sessionDate()),h=B.toStandardHisFormat(B.sessionDate()),v="programs/".concat(j.getProgramID(),"/reports/ncd_dashboard");i.value=await j.getJson(v,{start_date:D,end_date:h})}await ce(),setTimeout(()=>{s.value=!0},100)},f=D=>{try{Vn.close(),t.push(D).then(()=>{})}catch(h){console.error(h)}},p=D=>{console.log("Setting active item:",D)};return ge(()=>a.path,async()=>{await m()},{deep:!0}),_e(async()=>{await m()}),(D,h)=>{const v=_("ion-card-content"),g=_("ion-card");return d(),b(K,null,[n("div",yo,[o(g,{class:"top-card action-card",onClick:h[0]||(h[0]=y=>p("appointments"))},{default:l(()=>[o(v,null,{default:l(()=>{var y;return[n("div",bo,[n("div",Do,w(((y=c.value)==null?void 0:y.length)||0),1),h[2]||(h[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]}),_:1})]),_:1}),o(g,{class:"top-card action-card"},{default:l(()=>[o(v,null,{default:l(()=>[n("div",$o,[n("div",wo,w(i.value.total_pending_dispensations),1),h[3]||(h[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]),_:1})]),_:1}),o(g,{class:"top-card action-card"},{default:l(()=>[o(v,null,{default:l(()=>[n("div",Co,[n("div",ko,w(i.value.total_defaulters),1),h[4]||(h[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]),_:1})]),_:1}),o(g,{class:"top-card action-card"},{default:l(()=>[o(v,null,{default:l(()=>[n("div",Io,[n("div",So,w(i.value.total_complications),1),h[5]||(h[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]),_:1})]),_:1}),o(g,{class:"top-card action-card",onClick:h[1]||(h[1]=y=>f("NCDActivePatients"))},{default:l(()=>[o(v,null,{default:l(()=>[n("div",Po,[n("div",Ao,w(i.value.total_client_registered),1),h[6]||(h[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]),_:1})]),_:1})]),n("div",To,[o(g,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[o(v,null,{default:l(()=>[h[7]||(h[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",No,[s.value?(d(),H(C(Ke),{key:0,style:{width:"100%",height:"500px"},type:"bar",options:u.value,series:i.value.diagnosis_data.series},null,8,["options","series"])):T("",!0),i.value.isLoading?(d(),b("div",Oo,"Loading...")):T("",!0)],512)]),_:1})]),_:1}),o(g,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[o(v,null,{default:l(()=>[h[8]||(h[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",Ro,[s.value?(d(),H(C(Ke),{key:0,style:{width:"100%",height:"500px"},type:"line",options:r.value,series:i.value.gender_data.series},null,8,["options","series"])):T("",!0),i.value.isLoading?(d(),b("div",Fo,"Loading...")):T("",!0)],512)]),_:1})]),_:1})])],64)}}}),Lo=Z(Bo,[["__scopeId","data-v-a5d22305"]]),ct=Ut("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(e){this.selectedItem=e},getSelectedItem(){return this.selectedItem}},persist:!0}),Vo=()=>{const e=F(null);return{activeIteminMixin:e,setActiveItem:a=>{e.value=a,console.log("lll: ",e.value)}}},at=Q({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:e,setActiveItem:t}=Vo();return{chevronBackOutline:Jt,checkmark:qn,grid:zn,chevronDownCircle:jn,chevronForwardCircle:Wn,chevronUpCircle:Un,colorPalette:Hn,document:En,globe:xn,medkit:Gt,add:Mn,person:qt,people:zt,thermometer:jt,clipboard:Wt,activeIteminMixin:e,setActiveItem:t}},async mounted(){await this.setAppointments()},computed:{...me(re,["patient"])},watch:{$route:{async handler(e){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await ka.getDailyAppointments(B.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((e,t)=>e.given_name.localeCompare(t.given_name)))},formatBirthdate(e){return B.getBirthdateAge(e)},setActiveItemRefFN(e){ct().setSelectedItem(e)}}}),Mo=Q({name:"Home",mixins:[nn,at],components:{IonContent:pe,IonHeader:ve,IonPage:xe,IonToolbar:Ne,IonRow:et,DateInputField:bt,IonIcon:Y,IonButton:Se,IonCol:Ze,IonCard:Ue,IonCardHeader:ft,IonCardTitle:mt,IonCardContent:Xe,ViewToggleComponent:Qa,bottomNavBar:Ya,HorizontalLine:Ia},data(){const e=localStorage.getItem("ncdStartDate"),t=localStorage.getItem("ncdEndDate"),a=F(e||B.sessionDate()),s=F(t||B.sessionDate()),i=F(B.sessionDate()),c=F(B.sessionDate()),r=F([]),u=lt({page:1,itemsPerPage:10}),m=F(0),f=qa(),p=F("list");return{minDate:i,startDate:a,endDate:s,people:r,calendarOutline:Ee,openOutline:Qt,maxDate:c,alertCircleOutline:Et,personOutline:Zn,idCardOutline:Xn,manOutline:Kn,womanOutline:Yn,locationOutline:Qn,timeOutline:Jn,todayOutline:Gn,pagination:u,totalCount:m,actionButtonStore:f,currentToggleView:p}},computed:{...me(At,["NCDAppointmentsTogglePreference"]),paginatedPeople(){const e=(this.pagination.page-1)*this.pagination.itemsPerPage,t=e+this.pagination.itemsPerPage;return this.people.slice(e,t)},groupedPaginatedPeople(){const e={};this.paginatedPeople.forEach(s=>{const i=s.appointmentDate;e[i]||(e[i]=[]),e[i].push(s)});const t=Object.keys(e).sort((s,i)=>new Date(s)-new Date(i)),a={};return t.forEach(s=>{a[s]=e[s]}),a}},$route:{async handler(){},deep:!0},watch:{NCDAppointmentsTogglePreference:{handler(e){e&&e.toggle_view&&(this.currentToggleView=e.toggle_view)},deep:!0,immediate:!0}},async mounted(){this.initTogglePreference(),this.getAppointments(),this.HideHomePageActionButton()},async unmounted(){this.actionButtonStore.resetShowActionButton()},methods:{formatBirthdate(e){return B.getBirthdateAge(e)},async getAppointments(e=!1){if(yt().apiStatus){this.people=[],this.pagination.page=1;try{e==!0&&(this.startDate=B.sessionDate(),this.endDate=B.sessionDate(),this.getAppointmentsD1(this.startDate),this.getAppointmentsD2(this.endDate)),this.startDate>this.endDate&&(this.endDate=this.startDate),console.log(this.startDate,this.endDate),(await on.getAppointments(this.startDate,this.endDate,"")).forEach(s=>{const i=B.toStandardHisDisplayFormat(s.appointment_date);if(!this.people.some(r=>r.person_id===s.person_id&&r.appointmentDate===i)){const r={person_id:s.person_id,npid:s.npid,appointment_id:103,encounter_id:s.encounter_id,name:s.given_name.concat(" ",s.family_name),gender:s.gender,ageDob:this.formatBirthdate(s.birthdate),village:s.city_village,appointmentDate:i};this.people.push(r)}}),this.totalCount=this.people.length}catch(a){}}},async getAppointmentsD1(e){this.startDate=B.toStandardHisFormat(e),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(e){this.endDate=B.toStandardHisFormat(e),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(e){const t=await Fe.findByNpid(e);re().setPatientRecord(t[0]),this.redirectUser()},handleViewChange(e){this.currentToggleView=e,this.initTogglePreference(e,!0)},initTogglePreference(e="list",t=!1){const a={toggle_view:e},s=At();Object.keys(this.NCDAppointmentsTogglePreference).length===0?(a.toggle_view="list",s.setNCDAppointmentsTogglePreference(a),this.currentToggleView="list"):t===!0?s.setNCDAppointmentsTogglePreference(a):this.currentToggleView=this.NCDAppointmentsTogglePreference.toggle_view||"list"},redirectUser(){const e=JSON.parse(localStorage.getItem("userRoles")),t=e||[];t.some(a=>t.some(s=>s.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")},handlePaginationUpdate({page:e,itemsPerPage:t}){if(t!==this.pagination.itemsPerPage){const a=(this.pagination.page-1)*this.pagination.itemsPerPage,s=Math.floor(a/t)+1,i=Math.ceil(this.totalCount/t);this.pagination.page=Math.min(s,i)||1,this.pagination.itemsPerPage=t}else this.pagination.page=e},HideHomePageActionButton(){this.actionButtonStore.setShowActionButton(!1)}}}),xo={class:"appointments-container"},Eo={class:"date-filter"},Ho={key:0,style:{margin:"20px"}},Uo={key:1},Wo={class:"appointments-table"},jo={key:2},zo={class:"date-group-header"},qo={class:"date-header-title"},Go={class:"date-header-count"},Jo={class:"cards-container"},Qo={class:"card-details"},Yo={class:"detail-item"},Ko={class:"detail-value"},Xo={class:"detail-item"},Zo={class:"detail-value"},ei={class:"detail-item"},ti={class:"detail-value"},ni={class:"detail-item"},ai={class:"detail-value"};function si(e,t,a,s,i,c){const r=_("DateInputField"),u=_("ion-col"),m=_("ion-icon"),f=_("ion-button"),p=_("ViewToggleComponent"),D=_("ion-row"),h=_("ion-card"),v=_("HorizontalLine"),g=_("ion-card-title"),y=_("ion-card-header"),k=_("ion-card-content"),N=_("ion-content"),O=_("bottomNavBar"),P=_("ion-footer");return d(),b("div",xo,[n("div",Eo,[o(D,null,{default:l(()=>[o(u,null,{default:l(()=>[o(r,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),o(u,null,{default:l(()=>[o(r,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1}),o(u,null,{default:l(()=>[o(f,{color:"primary",onClick:t[0]||(t[0]=V=>e.getAppointments(!0)),class:"apt-btn"},{default:l(()=>[o(m,{icon:e.todayOutline,slot:"start"},null,8,["icon"]),t[1]||(t[1]=n("span",{style:{margin:"5px"}}," Today ",-1))]),_:1})]),_:1}),o(u,null,{default:l(()=>[o(p,{"initial-view":e.currentToggleView,onViewChanged:e.handleViewChange},null,8,["initial-view","onViewChanged"])]),_:1})]),_:1})]),o(N,{class:"scrollable-content"},{default:l(()=>[e.people.length===0?(d(),b("div",Ho,[o(m,{icon:e.alertCircleOutline,size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),t[2]||(t[2]=n("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Appointments for selected date range",-1))])):e.currentToggleView==="list"&&e.people.length>0?(d(),b("div",Uo,[o(h,null,{default:l(()=>[n("table",Wo,[t[3]||(t[3]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),b(K,null,ae(e.paginatedPeople,V=>(d(),b("tr",{key:V.npid},[n("td",null,[o(D,null,{default:l(()=>[o(u,null,{default:l(()=>[x(w(V.name),1)]),_:2},1024),o(u,null,{default:l(()=>[o(f,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:X=>e.openClientProfile(V.npid),color:"primary",fill:"clear",size:"small"},{default:l(()=>[o(m,{icon:e.openOutline,style:{"font-size":"28px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,w(V.npid),1),n("td",null,w(V.ageDob),1),n("td",null,w(V.gender),1),n("td",null,w(V.village),1),n("td",null,w(V.appointmentDate),1)]))),128))])])]),_:1})])):e.currentToggleView==="card"&&e.people.length>0?(d(),b("div",jo,[(d(!0),b(K,null,ae(e.groupedPaginatedPeople,(V,X)=>(d(),b("div",{key:X,class:"date-group"},[n("div",zo,[o(m,{icon:e.calendarOutline,class:"date-header-icon"},null,8,["icon"]),n("h2",qo,w(X),1),n("div",Go,w(V.length)+" appointment"+w(V.length!==1?"s":""),1)]),o(v,{color:"#006401",thickness:1,spacing:"sm"}),n("div",Jo,[(d(!0),b(K,null,ae(V,ee=>(d(),H(h,{key:ee.npid,class:"appointment-card"},{default:l(()=>[o(y,null,{default:l(()=>[o(D,{class:"ion-align-items-center"},{default:l(()=>[o(u,null,{default:l(()=>[o(g,{class:"card-name"},{default:l(()=>[o(m,{icon:e.personOutline,class:"name-icon"},null,8,["icon"]),x(" "+w(ee.name),1)]),_:2},1024)]),_:2},1024),o(u,{size:"auto"},{default:l(()=>[o(f,{onClick:le=>e.openClientProfile(ee.npid),color:"primary",fill:"clear",size:"small",class:"view-profile-btn"},{default:l(()=>[o(m,{icon:e.openOutline},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(k,null,{default:l(()=>[n("div",Qo,[n("div",Yo,[o(m,{icon:e.idCardOutline,class:"detail-icon"},null,8,["icon"]),t[4]||(t[4]=n("span",{class:"detail-label"},"NPID:",-1)),n("span",Ko,w(ee.npid),1)]),n("div",Xo,[o(m,{icon:e.calendarOutline,class:"detail-icon"},null,8,["icon"]),t[5]||(t[5]=n("span",{class:"detail-label"},"Age/DOB:",-1)),n("span",Zo,w(ee.ageDob),1)]),n("div",ei,[o(m,{icon:ee.gender==="Male"?e.manOutline:e.womanOutline,class:"detail-icon"},null,8,["icon"]),t[6]||(t[6]=n("span",{class:"detail-label"},"Gender:",-1)),n("span",ti,w(ee.gender),1)]),n("div",ni,[o(m,{icon:e.locationOutline,class:"detail-icon"},null,8,["icon"]),t[7]||(t[7]=n("span",{class:"detail-label"},"Village:",-1)),n("span",ai,w(ee.village),1)])])]),_:2},1024)]),_:2},1024))),128))])]))),128))])):T("",!0)]),_:1}),e.people.length>0?(d(),H(P,{key:0,class:"sticky-footer"},{default:l(()=>[o(D,null,{default:l(()=>[o(u,{size:"12",style:{"max-width":"100%"}},{default:l(()=>[o(O,{totalItems:e.totalCount,currentPage:e.pagination.page,itemsPerPage:e.pagination.itemsPerPage,"onUpdate:pagination":e.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])]),_:1})]),_:1})]),_:1})):T("",!0)])}const oi=Z(Mo,[["render",si],["__scopeId","data-v-6d92a5ce"]]),ii={key:0,class:"left_col"},ri={class:"nav-menu"},li=["onClick"],di={class:"ellipsis"},ci={key:1,style:{"padding-left":"20px","padding-right":"20px"}},ui=Q({__name:"NCDDashboard",setup(e){const t=ct(),a=q(()=>t.selectedItem),{screenWidth:s}=Sa(),i=F([{id:"dashboard",label:"Dashboard",icon:Yt},{id:"referrals",label:"Referrals",icon:ht},{id:"appointments",label:"Appointments",icon:Ee}]),c=F("dashboard"),r=qe(),{substance:u}=Qe(r);ge(()=>u.value,(f,p)=>{f!==p&&console.log("Substance changed:",f)},{deep:!0,immediate:!0});const m=f=>{c.value=f,ct().setSelectedItem(c.value)};return ge(()=>a.value,f=>{console.log("Active item from mixin changed:",f),f&&f!=null&&m(f)},{immediate:!0}),(f,p)=>{const D=_("ion-segment-button"),h=_("ion-segment");return d(),b("div",{style:Ye(C(s)>940?"display: flex":"display: block")},[C(s)>940?(d(),b("div",ii,[n("nav",ri,[n("ul",null,[(d(!0),b(K,null,ae(i.value,v=>(d(),b("li",{key:v.id,class:ue({active:c.value===v.id}),onClick:g=>m(v.id)},[o(C(Y),{icon:v.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",di,w(v.label),1)],10,li))),128))])])])):T("",!0),C(s)<=940?(d(),b("div",ci,[o(h,{value:c.value,style:{"margin-top":"5px","justify-content":"left"}},{default:l(()=>[(d(!0),b(K,null,ae(i.value,v=>(d(),H(D,{value:v.id,key:v.id,class:ue({active:c.value===v.id}),onClick:g=>m(v.id)},{default:l(()=>[o(C(Y),{icon:v.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,w(v.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):T("",!0),n("div",{class:"right_col",style:Ye(C(s)>940?"width: 85%":"width: 100%")},[n("div",null,[c.value==="referrals"?(d(),H(uo,{key:0})):T("",!0),c.value==="dashboard"?(d(),H(Lo,{key:1})):T("",!0),c.value==="appointments"?(d(),H(oi,{key:2})):T("",!0)])],4)],4)}}}),pi=Z(ui,[["__scopeId","data-v-a1132315"]]);class mi extends j{constructor(){super()}static async getHTCDashboardSummary(t={}){return this.getJson("hts_stats",t)}}const fi={class:"content-wrapper dashboard"},hi={class:"header"},gi={class:"overlay"},_i={class:"big-number"},vi={class:""},yi={class:"cards"},bi={class:"card"},Di={class:"card-info"},$i={class:"card-number"},wi={class:"card"},Ci={class:"card-info"},ki={class:"card-number"},Ii={class:"card"},Si={class:"card-info"},Pi={class:"card-number"},Ai={class:"card"},Ti={class:"card-info"},Ni={class:"card-number"},Oi={class:"section-title"},Ri={class:"section"},Fi={class:"filter-bar"},Bi={class:"patient-list"},Li=["onClick"],Vi={class:"status-tags"},Mi={class:ue(["tag","yellow"])},xi={class:"pagination"},Ei=["disabled"],Hi={class:"pagination-info"},Ui={class:"showing-info"},Wi=["disabled"],it=5,ji=Q({__name:"HTSDashboard",setup(e){const t=Te(),a=He(),s=re(),i=F({clients_with_conclusive_results:0,total_clients:0,clients_tested_today:0,clients_referred_to_ART:0,visit_scheduled_today:0,patient_data:[]}),c=F(""),r=F(1),u=q(()=>v.value.length),m=q(()=>Math.ceil(u.value/it)),f=q(()=>(r.value-1)*it),p=q(()=>Math.min(f.value+it,u.value)),D=q(()=>v.value.slice(f.value,p.value)),h=O=>O.toLowerCase().trim().replace(/\s+/g," "),v=q(()=>{if(!c.value.trim())return i.value.patient_data;const O=h(c.value);return i.value.patient_data.filter(P=>h(P.patient_name||"").includes(O)||h(P.patient_gender||"").includes(O)||h(P.program_names||"").includes(O)||String(P.patient_age).includes(O))});function g(){r.value<m.value&&r.value++}function y(){r.value>1&&r.value--}const k=async O=>{await s.setPatientRecord({patient_id:O.patient_id}),t.push("/patientProfile")};ge(c,()=>{r.value=1}),ge(a,async()=>{a.name=="Home"&&await N()}),_e(async()=>{await N()});async function N(){i.value=await mi.getHTCDashboardSummary()}return(O,P)=>(d(),H(C(pe),{class:"content"},{default:l(()=>{var V;return[n("div",fi,[n("div",hi,[n("div",gi,[n("h1",_i,w((V=i.value)==null?void 0:V.clients_with_conclusive_results),1),P[1]||(P[1]=n("p",{class:"header-text"},[x(" Total Number of Clients Tested"),n("br"),x(" with Conclusive Results ")],-1))])]),n("div",vi,[P[8]||(P[8]=n("h2",{class:"section-title"},"Today's Stats",-1)),n("div",yi,[n("div",bi,[n("div",Di,[o(C(Y),{icon:C(ht),class:"card-icon"},null,8,["icon"])]),P[2]||(P[2]=n("div",{class:"card-info"},[n("p",null,"Total Clients")],-1)),n("div",$i,w(i.value.total_clients),1)]),n("div",wi,[n("div",Ci,[o(C(Y),{icon:C(pt),class:"card-icon"},null,8,["icon"])]),P[3]||(P[3]=n("div",{class:"card-info"},[n("p",null,"Clients Tested Today")],-1)),n("div",ki,w(i.value.clients_tested_today),1)]),n("div",Ii,[n("div",Si,[o(C(Y),{icon:C(ea),class:"card-icon"},null,8,["icon"])]),P[4]||(P[4]=n("div",{class:"card-info"},[n("p",null,"Clients Referred To ART")],-1)),n("div",Pi,w(i.value.clients_referred_to_ART),1)]),n("div",Ai,[n("div",Ti,[o(C(Y),{icon:C(Ee),class:"card-icon"},null,8,["icon"])]),P[5]||(P[5]=n("div",{class:"card-info"},[n("p",null,"Visit Scheduled Today")],-1)),n("div",Ni,w(i.value.visit_scheduled_today),1)])]),n("h2",Oi,"Patient Awaiting List ("+w(u.value)+")",1),n("div",Ri,[n("div",Fi,[we(n("input",{class:"search-input",type:"text",placeholder:"Search Patient","onUpdate:modelValue":P[0]||(P[0]=X=>c.value=X)},null,512),[[ta,c.value]])]),n("div",Bi,[(d(!0),b(K,null,ae(D.value,X=>(d(),b("div",{class:"patient-item",key:X.id,onClick:ee=>k(X)},[n("div",null,[n("strong",null,w(X.patient_name),1),n("p",null,w(X.patient_gender=="M"?"Male":"Female")+" â€¢ "+w(X.patient_age)+"y",1)]),n("div",Vi,[n("span",Mi,w(X.program_names),1)])],8,Li))),128))]),n("div",xi,[n("button",{onClick:y,disabled:r.value===1,class:"pagination-btn"},[o(C(Y),{icon:C(Jt)},null,8,["icon"]),P[6]||(P[6]=x(" Previous ",-1))],8,Ei),n("div",Hi,[x(" Page "+w(r.value)+" of "+w(m.value)+" ",1),n("span",Ui,"(Showing "+w(f.value+1)+"-"+w(p.value)+" of "+w(u.value)+")",1)]),n("button",{onClick:g,disabled:r.value===m.value,class:"pagination-btn"},[P[7]||(P[7]=x(" Next ",-1)),o(C(Y),{icon:C(na)},null,8,["icon"])],8,Wi)])])])])]}),_:1}))}}),zi=Z(ji,[["__scopeId","data-v-dde1df6c"]]),Mt={"HIV clinic registration":De.HIV_CLINIC_REGISTRATION,"HIV reception":De.HIV_RECEPTION,Vitals:De.VITALS,"HIV staging":De.HIV_STAGING,"HIV clinic consultation":De.HIV_CLINIC_CONSULTATION,"ART adherence":De.ART_ADHERENCE,Prescription:De.TREATMENT,Dispensing:De.DISPENSING,Appointments:De.APPOINTMENT};class qi extends Pa{constructor(){super()}buildEncounters(t,a){return Object.entries(Mt).map(([s,i])=>({encounter:s,female:t?t[i].F:0,male:t?t[i].M:0,me:a?a[i].F+a[i].M:0,facility:t?t[i].F+t[i].M:0}))}async getStats(){const t=Object.values(Mt),a=Aa("reports/encounters",this.buildParams()),s=await j.postJson(a,{encounter_types:t}),i=await j.postJson(a,{encounter_types:t,all:!0});return this.buildEncounters(s.data,i.data)}getEncounterStats(t){return j.postJson("reports/encounters?date=".concat(this.date,"&program_id=1"),t)}}const Gi={class:"dashboard-container"},Ji={class:"main-section"},Qi={class:"chart-section"},Yi={class:"encounters-section"},Ki={class:"his-sm-text"},Xi={key:0},Zi={class:"encounter-td"},er={class:"other-td"},tr={class:"other-td"},nr={class:"other-td"},ar={class:"other-td"},sr={key:1},or=Q({__name:"ARTDashboard",setup(e){const t=F([]),a=lt({options:{chart:{id:"vuechart-example"},xaxis:{categories:["","","","",""]},yaxis:{min:0,forceNiceScale:!0,title:{text:"Number of clients",align:"left"}}},series:[{name:"Total visits",data:[0,0,0,0,0],color:"#7cb5ec"},{name:"Total incomplete visits",data:[0,0,0,0,0],color:"#434348"}]}),s=lt([{"HIV clinic registration":9},{"HIV reception":51},{Vitals:6},{"HIV staging":52},{"HIV clinic consultation":53},{"ART adherence":68},{Treatment:25},{Dispensing:54},{Appointments:7}]),i=()=>{t.value=s.map(u=>({encounter:Object.keys(u)[0],female:"",male:"",me:"",facility:""}))},c=async()=>{const u=new Ka,m=j.getSessionDate();u.setStartDate(B.subtract(m,"days",5).format(Tt)),u.setEndDate(B.subtract(m,"days",1).format(Tt));const f=await u.getVisitStats(),p=[],D=[],h=[];Object.entries(f).forEach(([v,{incomplete:g,complete:y}])=>{h.push(aa(v).format("dddd")),p.push(g),D.push(g+y)}),a.series[0].data=[...D],a.series[1].data=[...p],a.options={...a.options,xaxis:{categories:[...h]}}},r=async()=>{try{const u=new qi,m=s.map(D=>Object.values(D)[0]),f=await u.getEncounterStats({encounter_types:m}),p=await u.getEncounterStats({encounter_types:m,all:!0});t.value=s.map(D=>{const[h,v]=Object.entries(D)[0];return{encounter:h,female:p[v].F,male:p[v].M,me:f[v].F+f[v].M,facility:p[v].F+p[v].M}})}catch(u){console.error(u)}};return _e(()=>{i(),c(),r()}),(u,m)=>(d(),b("div",Gi,[n("div",Ji,[n("div",Qi,[m[0]||(m[0]=n("h3",null,"Total visits/incomplete visits: last 5 days",-1)),o(C(Ke),{width:"100%",height:"390px",type:"bar",options:a.options,series:a.series},null,8,["options","series"])]),n("div",Yi,[m[3]||(m[3]=n("h3",null,"Encounters created today",-1)),n("table",Ki,[m[2]||(m[2]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),t.value.length?(d(),b("tbody",Xi,[(d(!0),b(K,null,ae(t.value,(f,p)=>(d(),b("tr",{key:p},[n("td",Zi,w(f.encounter),1),n("td",er,w(f.female),1),n("td",tr,w(f.male),1),n("td",nr,w(f.me),1),n("td",ar,w(f.facility),1)]))),128))])):(d(),b("tbody",sr,[...m[1]||(m[1]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])]))])])])]))}}),ir=Z(or,[["__scopeId","data-v-9bb19378"]]);class rt extends j{static getlogs(t,a){return this.getJson("notification/logs",{startDate:t,endDate:a})}static clear(t){return this.putJson("notifications/clear/".concat(t),{id:t})}static read(t){return this.putJson("notifications/update",{alerts:t})}static unread(){return this.getJson("notifications")}}const $e=F([]),rr=Te();function pn(){const e=q(()=>$e.value.filter(p=>!p.read)),t=q(()=>$e.value.length>0),a=q(()=>e.value.length>0),s=q(()=>e.value.length),i=q(()=>$e.value.sort((p,D)=>new Date(p.date)>new Date(D.date)?-1:1));function c(p,D){Ta("Are you sure you want to clear notification?").then(h=>{h&&rt.clear(p).then(()=>{$e.value=$e.value.filter(v=>v.id!=p),D(p),u()}).catch(v=>{console.error(v),oe("Unable to clear notification")})})}function r(p){return B.toStandardHisDisplayFormat(p)}async function u(){$e.value=[];const p=await rt.unread();if(!Ve.isEmpty(p)){const D={highVL:[],normalVL:[],rejectedVL:[]};let h={};$e.value=p.map(v=>{let g="General";const y=v.text;let k=null;try{const N=JSON.parse(v.text);if(N.Type.match(/lims/i)){k=()=>rr.push("/art/encounters/lab/".concat(N.PatientID)),g="".concat(N["Test type"]," results for ").concat(N["ARV-Number"]||N["Accession number"]);const O=Na.detectHighVl(N.Result[0].value,N.Result[0].value_modifier);h={handler:k,id:v.alert_id,arv:N["ARV-Number"],accession:N["Accession number"],order_date:r(N["Orde date"]),results:N.Result[0].value_modifier+" "+N.Result[0].value,results_date:r(N.Result[0].date)},O?D.highVL.push(h):N.rejection_reason?(h={handler:k,id:v.alert_id,arv:N.arv_number,accession:N.accession_number,order_date:r(N.order_date),rejection_reason:N.rejection_reason},D.rejectedVL.push(h)):O||D.normalVL.push(h)}}catch(N){console.warn(N)}return{handler:k,message:y,vlMessageObs:D,title:g,id:v.alert_id,date:r(v.date_created)}})}}async function m(p){rt.read([p.id]).then(()=>p.read=!0)}function f(p){typeof p.handler=="function"&&(m(p),p.handler())}return{markAsRead:m,openNotification:f,loadNotifications:u,clearNotification:c,sortedNotifications:i,hasUnreadNotifications:a,notificationCount:s,hasNotifications:t,notificationData:$e}}const lr={class:"vl-alerts-container"},dr={class:"table-container"},cr={class:"vl-table"},ur={key:0},pr={key:0},mr=["colspan"],fr={key:0},hr=Q({__name:"ARTVlAlert",setup(e){const t=F("high_vl"),{notificationData:a,loadNotifications:s,clearNotification:i,openNotification:c}=pn(),r=q(()=>{var g,y;return a.value.length?(((y=(g=a.value[0])==null?void 0:g.vlMessageObs)==null?void 0:y.highVL)||[]).length:0}),u=q(()=>{var g,y;return a.value.length?(((y=(g=a.value[0])==null?void 0:g.vlMessageObs)==null?void 0:y.rejectedVL)||[]).length:0}),m=q(()=>{var g,y;return a.value.length?(((y=(g=a.value[0])==null?void 0:g.vlMessageObs)==null?void 0:y.normalVL)||[]).length:0}),f=q(()=>{var g;if(!a.value.length)return[];const v=(g=a.value[0])==null?void 0:g.vlMessageObs;if(!v)return[];switch(t.value){case"high_vl":return v.highVL||[];case"rejected":return v.rejectedVL||[];case"normal":return v.normalVL||[];default:return[]}}),p=v=>c(v),D=v=>{v.id&&i(v.id,g=>{console.log("Cleared notification ".concat(g))})},h=()=>{switch(t.value){case"high_vl":return"No high viral load results found";case"rejected":return"No rejected samples found";case"normal":return"No normal results found";default:return"No results found"}};return _e(()=>{s()}),(v,g)=>(d(),b("div",lr,[o(C(gt),{mode:"ios",modelValue:t.value,"onUpdate:modelValue":g[0]||(g[0]=y=>t.value=y),class:"category-segment"},{default:l(()=>[o(C(Pe),{value:"high_vl"},{default:l(()=>[o(C(Ae),null,{default:l(()=>[x("High VL ("+w(r.value)+")",1)]),_:1})]),_:1}),o(C(Pe),{value:"rejected"},{default:l(()=>[o(C(Ae),null,{default:l(()=>[x("Rejected ("+w(u.value)+")",1)]),_:1})]),_:1}),o(C(Pe),{value:"normal"},{default:l(()=>[o(C(Ae),null,{default:l(()=>[x("Normal Results ("+w(m.value)+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",dr,[n("table",cr,[n("thead",null,[n("tr",null,[g[1]||(g[1]=n("th",null,"ARV #",-1)),g[2]||(g[2]=n("th",null,"Accession #",-1)),g[3]||(g[3]=n("th",null,"Order Date",-1)),t.value==="rejected"?(d(),b("th",ur,"Rejection Reason")):T("",!0),g[4]||(g[4]=n("th",null,"View",-1)),g[5]||(g[5]=n("th",null,"Clear",-1))])]),n("tbody",null,[f.value.length===0?(d(),b("tr",pr,[n("td",{colspan:t.value==="rejected"?6:5,class:"empty-message"},w(h()),9,mr)])):T("",!0),(d(!0),b(K,null,ae(f.value,y=>(d(),b("tr",{key:y.id},[n("td",null,w(y.arv||"-"),1),n("td",null,w(y.accession||"-"),1),n("td",null,w(y.order_date||"-"),1),t.value==="rejected"?(d(),b("td",fr,w(y.rejection_reason||"-"),1)):T("",!0),n("td",null,[o(C(Se),{fill:"clear",size:"small",onClick:k=>p(y)},{default:l(()=>[o(C(Y),{icon:C(Kt),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])]),n("td",null,[o(C(Se),{fill:"clear",size:"small",onClick:k=>D(y),color:"success"},{default:l(()=>[o(C(Y),{icon:C(sa),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])])]))),128))])])])]))}}),gr=Z(hr,[["__scopeId","data-v-7b9c4735"]]),_r={class:"dashboard-container"},vr={class:"segment-content"},yr={key:0},br={key:1},Dr={key:2},$r=Q({__name:"ARTHome",setup(e){const t=F("dashboard"),{notificationCount:a,loadNotifications:s}=pn();return _e(()=>{s()}),(i,c)=>(d(),b("div",_r,[o(C(gt),{modelValue:t.value,"onUpdate:modelValue":c[0]||(c[0]=r=>t.value=r)},{default:l(()=>[o(C(Pe),{value:"dashboard"},{default:l(()=>[...c[1]||(c[1]=[x(" Overview ",-1)])]),_:1}),o(C(Pe),{value:"viralLoadAlerts"},{default:l(()=>[n("div",vr,[c[2]||(c[2]=x(" VL Alerts ",-1)),C(a)>0?(d(),H(C(oa),{key:0,color:"primary"},{default:l(()=>[x(w(C(a)),1)]),_:1})):T("",!0)])]),_:1}),o(C(Pe),{value:"internalReferrals"},{default:l(()=>[...c[3]||(c[3]=[x(" Internal referrals ",-1)])]),_:1})]),_:1},8,["modelValue"]),t.value==="dashboard"?(d(),b("div",yr,[o(ir)])):T("",!0),t.value==="viralLoadAlerts"?(d(),b("div",br,[o(gr)])):T("",!0),t.value==="internalReferrals"?(d(),b("div",Dr,[o(ln)])):T("",!0)]))}}),wr=Z($r,[["__scopeId","data-v-d237cab2"]]);class Cr{constructor(){fe(this,"socket",null);fe(this,"channel","ImmunizationReportChannel");fe(this,"isConnected",!1);fe(this,"pendingFetch",null);fe(this,"location_id");fe(this,"initPromise");fe(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});fe(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});fe(this,"onError",t=>{console.error("WebSocket error:",t),this.isConnected=!1});this.initPromise=this.init()}async init(){const t=localStorage.getItem("apiURL"),a=localStorage.getItem("apiPort"),s=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const i="".concat(s,"://").concat(t,"/api/v1/cable");this.socket=new WebSocket(i),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(i){console.error(i),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const t={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(t))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await j.getJson("immunization/stats",{start_date:B.getDateBeforeByDays(B.sessionDate(),365),end_date:B.sessionDate()})}async setMessageHandler(t){await this.initPromise,this.socket?this.socket.onmessage=a=>{t(a)}:console.error("WebSocket connection not established.")}}const kr=Q({components:{IonContent:pe,IonHeader:ve,IonItem:Re,IonList:Oe,IonMenu:je,IonTitle:We,IonToolbar:Ne,IonInput:ut,BasicInputField:Ra,BasicForm:Ge,PreviousVitals:Oa,customDatePicker:Za,IonCol:Ze,IonRow:et,VueMultiselect:ia,IonLabel:Ae,DataTable:Me},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:se,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:B.toStandardHisDisplayFormat(j.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...me(Xa,["administerOtherVaccine"]),...me(Nt,["tempScannedBatchNumber"]),...me(re,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await ts(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:qt,pulseOutline:ra,clipboardOutline:pt}},methods:{formatBirthdate(e){return B.getBirthdateAge(e)},async openClientProfile(e){const t=await Fe.findByID(e);await re().setPatientRecord(t),this.$router.push("patientProfile")},processData(){var t;return((t=this.data)==null?void 0:t.map(a=>{if(a.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let s=[];const i=c=>c.map(u=>{let m=0;return u.clients.map(f=>{(u.drug_name==this.drug_name&&(this.village==f.table.city_village||this.village=="All")||(u.drug_name==this.drug_name||this.village==f.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:f.table.given_name,family_name:f.table.family_name,patient_id:f.table.patient_id,birthdate:f.table.birthdate,city_village:f.table.city_village}),m++),this.villageList.push(f.table.city_village)}),[u.drug_name,m]}).filter(u=>u[1]!==0);return this.title=="Client due today"&&(s=i(a.value.due_today_antigens)),this.title=="Client due this week"&&(s=i(a.value.due_this_week_antigens)),this.title=="Client due this month"&&(s=i(a.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(s=i(a.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(s=i(a.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(c=>JSON.stringify(c)))].map(c=>JSON.parse(c)),this.villageList=[...new Set(this.villageList)],s}}))[0]},handleVillageClick(e){this.drug_name="",this.village=e,this.tableData=this.processData()},handleRowClick(e){var a;this.tableEvent=e.target;const t=this.tableEvent.closest("tr");if(t){const s=Array.from(((a=t.parentNode)==null?void 0:a.children)||[]).indexOf(t),i=this.tableData[s];this.drug_name=i[0],t.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(e){return B.calculateDisplayAge(e)},openPopover(e){this.event=e,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(e){var a;const t=e.target.value;this.batchNumber=t||((a=this.tempScannedBatchNumber)==null?void 0:a.text)||""},saveBatchWithTodayDate(){let e=j.getSessionDate();this.saveDta(e)},dismiss(){ze.dismiss()},saveBatch(){let e;Ve.isEmpty(this.vaccineDate)==!0?e=j.getSessionDate():e=this.vaccineDate,this.saveDta(e)},validateVaccineName(){if(Ve.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(Ve.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(e){this.currentDrugOb=e},isAlphaNumeric(e){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(e)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(e){this.batchNumber=e},saveDta(e){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){oe("Enter batch number!");return}if(this.batchNumber==""){oe("Enter batch number!");return}const t={batch_number:this.batchNumber,date_administered:e,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},a=Nt();a.setAdministeredVaccine(t),es(this.patient),this.dismiss(),a.setTempScannedBatchNumber(null)}}}),Ir={key:0,class:"spinner-overlay"},Sr={class:"header position_content"},Pr={style:{"font-size":"1.2em","font-weight":"700"}},Ar={class:"dueCardContent"},Tr=["onClick"],Nr={style:{"margin-right":"15px"}},Or={style:{"align-items":"center",display:"flex"}},Rr={style:{"line-height":"1"}},Fr={class:"client_name"},Br={class:"name"},Lr={class:"demographicsOtherRow"},Vr={class:"demographicsText"};function Mr(e,t,a,s,i,c){const r=_("ion-spinner"),u=_("ion-icon"),m=_("ion-header"),f=_("ion-card-title"),p=_("ion-card-header"),D=_("DataTable"),h=_("ion-card-content"),v=_("ion-card"),g=_("ion-item"),y=_("ion-list"),k=_("ion-popover"),N=_("ion-content");return d(),b(K,null,[e.isLoading?(d(),b("div",Ir,[o(r,{name:"bubbles"}),t[3]||(t[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):T("",!0),o(m,null,{default:l(()=>[n("div",Sr,[n("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=O=>e.dismiss())},[o(u,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Pr,w(e.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:t[1]||(t[1]=O=>e.openPopover(O))},[o(u,{slot:"separator",size:"large",icon:e.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),o(N,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:l(()=>[n("div",null,[o(v,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:l(()=>[o(p,null,{default:l(()=>[o(f,{class:"sectionTitle"},{default:l(()=>[...t[4]||(t[4]=[x(" Summary of required doses ",-1)])]),_:1})]),_:1}),o(h,null,{default:l(()=>[n("div",Ar,[o(D,{options:e.options,data:e.tableData,class:"display nowrap",width:"100%",onClick:e.handleRowClick},{default:l(()=>[...t[5]||(t[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])]),_:1},8,["options","data","onClick"])])]),_:1})]),_:1}),o(v,{class:"section",style:{"margin-inline":"0px"}},{default:l(()=>[o(p,null,{default:l(()=>[o(f,{class:"sectionTitle"},{default:l(()=>[...t[6]||(t[6]=[x("Client Details ",-1)])]),_:1})]),_:1}),o(h,null,{default:l(()=>[(d(!0),b(K,null,ae(e.clientDetails,(O,P)=>(d(),b("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:P,onClick:V=>e.openClientProfile(O.patient_id)},[n("div",Nr,[n("div",{class:ue((O==null?void 0:O.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[o(u,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:e.person},null,8,["icon"])],2)]),n("div",Or,[n("div",Rr,[n("div",Fr,[n("div",Br,w(O.given_name)+" "+w(O.family_name),1)]),n("div",Lr,[n("div",Vr,[x(w(O.gender=="M"?"Male":"Female")+" ",1),t[7]||(t[7]=n("span",{class:"dot"},".",-1)),x(w(e.formatBirthdate(O.birthdate)),1)])]),n("div",null,"Village: "+w(O.city_village),1)])])],8,Tr))),128))]),_:1})]),_:1})]),o(k,{style:{"--offset-x":"-10px"},"is-open":e.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:e.event,onDidDismiss:t[2]||(t[2]=O=>e.popoverOpen=!1)},{default:l(()=>[n("div",null,[t[8]||(t[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(d(!0),b(K,null,ae(e.villageList,(O,P)=>(d(),H(y,{class:ue(O==e.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:P},{default:l(()=>[o(g,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:V=>e.handleVillageClick(O)},{default:l(()=>[x(w(O),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const xr=Z(kr,[["render",Mr],["__scopeId","data-v-dfc02771"]]),Er=Q({name:"Menu",mixins:[at],components:{IonContent:pe,IonHeader:ve,IonItem:Re,IonList:Oe,IonMenu:je,IonTitle:We,IonToolbar:Ne,IonCheckbox:tt,BasicForm:Ge,BasicCard:nt,Carousel:ua,Slide:ca,Pagination:da,Navigation:la},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},setup(){return{personCircleOutline:Ht}},computed:{...me(qe,["substance"]),backgroundStyle(){return{background:"linear-gradient(135deg, rgba(32, 178, 170, 0.95) 0%, rgba(64, 192, 176, 0.9) 50%, rgba(150, 220, 200, 0.85) 100%), url(".concat(ns("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",minHeight:"240px"}}},watch:{},async mounted(){new Cr().setMessageHandler(this.onMessage)},methods:{async onMessage(e){var a,s,i;const t=JSON.parse(e.data);t.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=t.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((a=this.reportData)==null?void 0:a.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((s=this.reportData)==null?void 0:s.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((i=this.reportData)==null?void 0:i.total_male_vaccinated_this_year)||0}])},openDueModal(e){const t={title:e,dashBoardData:this.reportData};Le(xr,{class:"fullScreenModal"},!0,t)},async openClientProfile(e){const t=await Fe.findByNpid(e);await re().setPatientRecord(t[0]),this.$router.push("patientProfile")}}}),Hr={class:"topStats"},Ur={class:"hero-section"},Wr={class:"totalStats"},jr={class:"statsValue"},zr={class:"statsText"},qr={class:"dueCardContent"},Gr={class:"statsValue"},Jr={class:"statsValue"},Qr={class:"statsValue"},Yr={class:"overDueCardContent"},Kr={class:"statsValue"},Xr={class:"statsValue"},Zr={class:"appointment-count"},el={key:0,class:"appointments-list"},tl=["onClick"],nl={class:"avatar-container"},al={class:"appointment-details"},sl={class:"client-name"},ol={class:"client-info"},il={class:"info-badge"},rl={class:"client-location"},ll={key:1,class:"empty-state"};function dl(e,t,a,s,i,c){const r=_("Slide"),u=_("Pagination"),m=_("Carousel"),f=_("ion-card-title"),p=_("ion-card-header"),D=_("ion-card-content"),h=_("ion-card"),v=_("ion-icon"),g=_("ion-content");return d(),H(g,{class:"content"},{default:l(()=>[n("div",Hr,[n("div",Ur,[n("div",{style:Ye(e.backgroundStyle)},[o(m,{autoplay:4e3,"wrap-around":!0,itemsToShow:1,transition:600,class:"stats-carousel"},{addons:l(()=>[o(u)]),default:l(()=>[(d(!0),b(K,null,ae(e.totalStats,y=>(d(),H(r,{key:y},{default:l(()=>[n("div",Wr,[t[5]||(t[5]=n("div",{class:"stats-icon"},"ðŸ“Š",-1)),n("div",jr,w(y.value),1),n("div",zr,w(y.name),1)])]),_:2},1024))),128))]),_:1})],4)]),o(h,{class:"section modern-card"},{default:l(()=>[o(p,null,{default:l(()=>[o(f,{class:"cardTitle"},{default:l(()=>[...t[6]||(t[6]=[n("span",{class:"title-icon"},"ðŸ“…",-1),x(" Clients Due ",-1)])]),_:1})]),_:1}),o(D,null,{default:l(()=>{var y,k,N;return[n("div",qr,[n("div",{class:"dueCard today-card",onClick:t[0]||(t[0]=O=>e.openDueModal("Client due today"))},[t[7]||(t[7]=n("div",{class:"card-badge success"},"Today",-1)),n("div",Gr,w(((y=e.reportData)==null?void 0:y.due_today_count)||0),1),t[8]||(t[8]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard week-card",onClick:t[1]||(t[1]=O=>e.openDueModal("Client due this week"))},[t[9]||(t[9]=n("div",{class:"card-badge warning"},"Week",-1)),n("div",Jr,w(((k=e.reportData)==null?void 0:k.due_this_week_count)||0),1),t[10]||(t[10]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard month-card",onClick:t[2]||(t[2]=O=>e.openDueModal("Client due this month"))},[t[11]||(t[11]=n("div",{class:"card-badge danger"},"Month",-1)),n("div",Qr,w(((N=e.reportData)==null?void 0:N.due_this_month_count)||0),1),t[12]||(t[12]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),o(h,{class:"section modern-card"},{default:l(()=>[o(p,null,{default:l(()=>[o(f,{class:"cardTitle"},{default:l(()=>[...t[13]||(t[13]=[n("span",{class:"title-icon"},"âš ï¸",-1),x(" Clients Overdue ",-1)])]),_:1})]),_:1}),o(D,null,{default:l(()=>{var y,k;return[n("div",Yr,[n("div",{class:"overDueCard",onClick:t[3]||(t[3]=N=>e.openDueModal("Client overdue under 5yrs"))},[t[14]||(t[14]=n("div",{class:"overdue-icon"},"ðŸ‘¶",-1)),n("div",Kr,w(((y=e.reportData)==null?void 0:y.under_five_overdue)||0),1),t[15]||(t[15]=n("div",{class:"statsText"},"Under 5 years",-1))]),n("div",{class:"overDueCard",onClick:t[4]||(t[4]=N=>e.openDueModal("Client overdue over 5yrs"))},[t[16]||(t[16]=n("div",{class:"overdue-icon"},"ðŸ§’",-1)),n("div",Xr,w(((k=e.reportData)==null?void 0:k.over_five_overdue)||0),1),t[17]||(t[17]=n("div",{class:"statsText"},"Over 5 years",-1))])])]}),_:1})]),_:1}),o(h,{class:"section modern-card appointments-card"},{default:l(()=>[o(p,null,{default:l(()=>[o(f,{class:"cardTitle"},{default:l(()=>{var y;return[t[18]||(t[18]=n("span",{class:"title-icon"},"ðŸ—“ï¸",-1)),t[19]||(t[19]=x(" Today's Appointments ",-1)),n("span",Zr,w(((y=e.appointments)==null?void 0:y.length)||0),1)]}),_:1})]),_:1}),o(D,null,{default:l(()=>{var y;return[((y=e.appointments)==null?void 0:y.length)>0?(d(),b("div",el,[(d(!0),b(K,null,ae(e.appointments,(k,N)=>(d(),b("div",{class:"appointment-item",key:N,onClick:O=>e.openClientProfile(k.npid)},[n("div",nl,[n("div",{class:ue(k.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[o(v,{class:"person-icon",icon:e.personCircleOutline},null,8,["icon"])],2)]),n("div",al,[n("div",sl,w(k.given_name)+" "+w(k.family_name),1),n("div",ol,[n("span",il,w(k.gender=="M"?"Male":"Female"),1),t[20]||(t[20]=n("span",{class:"dot"},"â€¢",-1)),n("span",null,w(e.formatBirthdate(k.birthdate)),1)]),n("div",rl,[t[21]||(t[21]=n("span",{class:"location-icon"},"ðŸ“",-1)),x(" "+w(k==null?void 0:k.city_village),1)])]),t[22]||(t[22]=n("div",{class:"appointment-arrow"},"â€º",-1))],8,tl))),128))])):(d(),b("div",ll,[...t[23]||(t[23]=[n("div",{class:"empty-icon"},"ðŸ“‹",-1),n("p",null,"No appointments scheduled for today",-1)])]))]}),_:1})]),_:1})])]),_:1})}const cl=Z(Er,[["render",dl],["__scopeId","data-v-c322c517"]]),ul=Q({components:{DataTable:Me},props:{title:{type:String,default:""},list:{type:String,default:""},buttonTitle:{type:String,default:""},buttonLink:{type:String,default:""}},data(){return{patients:[],loadingStates:{},tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:(e,t)=>{if(!e)return"-";const a=new Date(e).getTime(),s=Date.now()-a,i=Math.floor(s/6e4),c=(()=>{if(i<1)return"Just now";if(i<60)return"".concat(i," min").concat(i>1?"s":""," ago");const r=Math.floor(i/60);if(r<24)return"".concat(r," hour").concat(r>1?"s":""," ago");const u=Math.floor(r/24);return"".concat(u," day").concat(u>1?"s":""," ago")})();return t==="display"?c:s},type:"num",width:"15%"},{title:"Actions",data:null,render:(e,t,a)=>{const s=document.createElement("div");s.style.display="flex",s.style.gap="6px",s.setAttribute("data-patient-id",a.identifier);const i="  --padding-top: 4px;\n                                            --padding-bottom: 4px;\n                                            --padding-start: 8px;\n                                            --padding-end: 8px;\n                                            font-size: 0.8rem;\n                                            height: 28px;\n                                            min-width: 70px;\n                                            white-space: nowrap;\n                                            ",c=(r,u,m,f)=>{const p=document.createElement("ion-button");p.setAttribute("data-button-type",f),p.size="small",p.fill="solid",p.color=u,p.style.cssText=i;const D=document.createElement("span");D.className="button-text",D.innerText=r;const h=document.createElement("ion-spinner");return h.name="crescent",h.className="button-spinner",h.style.display="none",h.style.width="16px",h.style.height="16px",p.appendChild(D),p.appendChild(h),p.addEventListener("click",m),p};return s.appendChild(c(this.buttonTitle,"primary",()=>this.navigateTo(a,this.buttonLink),"primary")),s.appendChild(c("Profile","warning",()=>this.navigateTo(a,"/patientProfile"),"profile")),s.appendChild(c("Abscond","danger",()=>this.handleAbscond(a.identifier),"abscond")),s},orderable:!1,width:"25%"}],tableOptions:{order:[[1,"desc"]]}}},computed:{...me(dt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{patientsWaitingForConsultation:{handler(e){this.list==="CONSULTATION"&&(this.patients=e)},deep:!0},patientsWaitingForVitals:{handler(e){this.list==="VITALS"&&(this.patients=e)},deep:!0},patientsWaitingForLab:{handler(e){this.list==="LAB"&&(this.patients=e)},deep:!0},patientsWaitingForDispensation:{handler(e){this.list==="DISPENSATION"&&(this.patients=e)},deep:!0}},mounted(){this.setList()},methods:{setList(){const e={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation},t=this.list;this.patients=e[t]||[]},setButtonLoading(e,t,a){const s=document.querySelector('[data-patient-id="'.concat(e,'"]'));if(!s)return;const i=s.querySelector('[data-button-type="'.concat(t,'"]'));if(!i)return;const c=i.querySelector(".button-text"),r=i.querySelector(".button-spinner");a?(i.setAttribute("disabled","true"),c&&(c.style.display="none"),r&&(r.style.display="inline-block")):(i.removeAttribute("disabled"),c&&(c.style.display="inline"),r&&(r.style.display="none"))},waitingTime(e){if(!e)return"-";const t=Date.now()-new Date(e).getTime(),a=Math.floor(t/6e4);if(a<1)return"Just now";if(a<60)return"".concat(a," min").concat(a>1?"s":""," ago");const s=Math.floor(a/60);if(s<24)return"".concat(s," hour").concat(s>1?"s":""," ago");const i=Math.floor(s/24);return"".concat(i," day").concat(i>1?"s":""," ago")},async navigateTo(e,t){const a=t===this.buttonLink?"primary":"profile";this.setButtonLoading(e.identifier,a,!0);try{let s=[],i=null;j.getPouchDbStatus()||j.getLanConnectionStatus()?(s=await Ce("patients_records",{selector:{ID:e.identifier}}),i=s[0]):i||(i=await j.getJson("/patients/".concat(e.patient_id,"/get_patient_record")));const c=i;if(await re().setPatientRecord(c),await ce(),an()){this.$router.push("/deathPatientProfile");return}this.$router.push(t)}catch(s){console.error("Error navigating:",s)}finally{this.setButtonLoading(e.identifier,a,!1)}},async handleAbscond(e){this.setButtonLoading(e,"abscond",!0);try{await Fa({ID:e})}catch(t){console.error("Error closing visit:",t)}finally{this.setButtonLoading(e,"abscond",!1)}},dismiss(){ze.dismiss()}}}),pl={class:"modal-container"},ml={class:"dueCardContent"};function fl(e,t,a,s,i,c){const r=_("ion-button"),u=_("ion-card-title"),m=_("ion-card-header"),f=_("DataTable"),p=_("ion-card-content"),D=_("ion-card");return d(),b("div",pl,[o(r,{class:"close-button",fill:"clear",size:"large",onClick:e.dismiss},{default:l(()=>[...t[0]||(t[0]=[x(" Close ",-1)])]),_:1},8,["onClick"]),o(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:l(()=>[o(m,null,{default:l(()=>[o(u,{class:"sectionTitle"},{default:l(()=>[x(w(e.title),1)]),_:1})]),_:1}),o(p,null,{default:l(()=>[n("div",ml,[o(f,{data:e.patients,options:e.tableOptions,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const hl=Z(ul,[["render",fl],["__scopeId","data-v-ab268e6c"]]),gl=Q({components:{IonContent:pe,IonHeader:ve,IonItem:Re,IonList:Oe,IonIcon:Y,IonCard:Ue,IonCardHeader:ft,IonCardTitle:mt,IonCardContent:Xe,IonPopover:_t,DataTable:Me},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:se,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:e=>this.waitingTime(e),width:"20%"},{title:"Actions",data:null,render:(e,t,a)=>{const s=document.createElement("div");s.style.display="flex",s.style.gap="6px",s.setAttribute("data-patient-id",a.identifier);const i="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",c=(r,u,m,f)=>{const p=document.createElement("ion-button");p.setAttribute("data-button-type",f),p.size="small",p.fill="solid",p.color=u,p.style.cssText=i;const D=document.createElement("span");D.className="button-text",D.innerText=r;const h=document.createElement("ion-spinner");return h.name="crescent",h.className="button-spinner",h.style.display="none",h.style.width="16px",h.style.height="16px",p.appendChild(D),p.appendChild(h),p.addEventListener("click",m),p};return s.appendChild(c("Profile","warning",()=>this.navigateTo(e,"/patientProfile"),"profile")),s},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[1,"desc"],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const e=await Ba();this.patients=e.map(t=>({fullName:t.fullName||"",arrivalTime:t.startDate||"",patient_id:t.patientId||"",identifier:t.identifier||""}))},methods:{setButtonLoading(e,t,a){const s=document.querySelector('[data-patient-id="'.concat(e,'"]'));if(!s)return;const i=s.querySelector('[data-button-type="'.concat(t,'"]'));if(!i)return;const c=i.querySelector(".button-text"),r=i.querySelector(".button-spinner");a?(i.setAttribute("disabled","true"),c&&(c.style.display="none"),r&&(r.style.display="inline-block")):(i.removeAttribute("disabled"),c&&(c.style.display="inline"),r&&(r.style.display="none"))},openPopover(e){this.event=e,this.popoverOpen=!0},dismiss(){ze.dismiss()},waitingTime(e){if(!e)return"-";const t=Date.now()-new Date(e).getTime(),a=Math.floor(t/6e4);if(a<1)return"Just now";if(a<60)return"".concat(a," min").concat(a>1?"s":""," ago");const s=Math.floor(a/60);if(s<24)return"".concat(s," hour").concat(s>1?"s":""," ago");const i=Math.floor(s/24);return"".concat(i," day").concat(i>1?"s":""," ago")},async navigateTo(e,t){this.setButtonLoading(e.identifier,"profile",!0);try{let a;(j.getPouchDbStatus()||j.getLanConnectionStatus())&&(a=await Ce("patients_records",{selector:{ID:e.identifier}}),a=a[0]),a||(a=await Fe.findByID(e.patient_id)),a?(await re().setPatientRecord(a),await ce(),an()?this.$router.push("/deathPatientProfile"):this.$router.push(t)):(oe("Patient not found. Please try searching the patient by name."),this.setButtonLoading(e.identifier,"profile",!1))}catch(a){console.error("Error navigating to profile:",a),this.setButtonLoading(e.identifier,"profile",!1)}}}}),_l={class:"modal-container"},vl={class:"dueCardContent"};function yl(e,t,a,s,i,c){const r=_("ion-button"),u=_("ion-card-title"),m=_("ion-card-header"),f=_("DataTable"),p=_("ion-card-content"),D=_("ion-card");return d(),b("div",_l,[o(r,{class:"close-button",fill:"clear",size:"large",onClick:e.dismiss},{default:l(()=>[...t[0]||(t[0]=[x(" Close ",-1)])]),_:1},8,["onClick"]),o(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:l(()=>[o(m,null,{default:l(()=>[o(u,{class:"sectionTitle"},{default:l(()=>[x(w(e.title),1)]),_:1})]),_:1}),o(p,null,{default:l(()=>[n("div",vl,[o(f,{data:e.patients,options:e.tableOptions,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const bl=Z(gl,[["render",yl],["__scopeId","data-v-5866989b"]]),Dl=Q({name:"OPDAppointmentsModal",components:{IonPage:xe,IonHeader:ve,IonContent:pe,IonItem:Re,IonList:Oe,IonIcon:Y,IonCard:Ue,IonCardContent:Xe,IonPopover:_t,DataTable:Me,IonSegment:gt,IonSegmentButton:Pe,IonLabel:Ae,IonRow:et,IonCol:Ze,DateInputField:bt},props:{title:{type:String,default:"OPD Appointments"},programType:{type:String,required:!0},programId:{type:Number,required:!0}},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:se,appointments:[],viewMode:"today",startDate:B.sessionDate(),endDate:B.sessionDate(),calendarOutline:Ee,openOutline:Qt,tableColumns:[{title:"Patient ID",data:"ID"},{title:"Name",data:"name"},{title:"Age/DOB",data:"ageDob"},{title:"Gender",data:"gender"},{title:"Village",data:"village"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(e,t,a)=>{const s=document.createElement("div"),i=document.createElement("ion-button");return i.innerText="Profile",i.size="small",i.style.color="#fff",i.style.padding="8px 12px",i.style.marginRight="8px",i.addEventListener("click",()=>this.openClientProfile(a.ID)),s.appendChild(i),s},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,order:[[5,"asc"]]}}},async mounted(){await this.loadAppointments()},methods:{async loadAppointments(){this.isLoading=!0;try{const e=B.sessionDate(),t=this.viewMode==="today"?e:this.startDate,a=this.viewMode==="today"?e:this.endDate,s=localStorage.getItem("locationID"),i=typeof t=="string"?t:B.toStandardHisFormat(t),c=typeof a=="string"?a:B.toStandardHisFormat(a),u=(await Ce("patients_records")).flatMap(m=>{var p,D;return[...((p=m.appointments)==null?void 0:p.saved)||[],...((D=m.appointments)==null?void 0:D.unsaved)||[]].filter(h=>{if(!(h!=null&&h.value_datetime)||h.location_id&&h.location_id!==s)return!1;const v=B.toStandardHisFormat(h.value_datetime);return v>=i&&v<=c}).map(h=>{var v,g,y,k,N;return{ID:m.ID,name:[(v=m.personInformation)==null?void 0:v.given_name,(g=m.personInformation)==null?void 0:g.family_name].filter(Boolean).join(" ")||"Unknown",ageDob:(y=m.personInformation)!=null&&y.birthdate?B.getBirthdateAge(m.personInformation.birthdate):"N/A",gender:((k=m.personInformation)==null?void 0:k.gender)||"Unknown",village:((N=m.personInformation)==null?void 0:N.home_village)||"Unknown",appointmentDate:B.toStandardHisDisplayFormat(h.value_datetime),appointmentDateTime:h.value_datetime,rawData:h}})}).sort((m,f)=>new Date(m.appointmentDateTime).getTime()-new Date(f.appointmentDateTime).getTime());this.appointments=u,console.log("Found ".concat(u.length," appointments"))}catch(e){console.error("Error loading appointments:",e),Ot("Failed to load appointments")}finally{this.isLoading=!1}},async getAppointmentsD1(e){this.startDate=B.toStandardHisFormat(e),await this.loadAppointments()},async getAppointmentsD2(e){this.endDate=B.toStandardHisFormat(e),await this.loadAppointments()},onViewModeChange(){this.viewMode==="today"&&(this.startDate=B.sessionDate(),this.endDate=B.sessionDate()),this.loadAppointments()},async openClientProfile(e){try{const t=await Ce("patients_records",{selector:{ID:e}});await re().setPatientRecord(t[0]),this.$router.push("patientProfile")}catch(t){console.error("Error opening profile:",t),Ot("Failed to open patient profile")}},openPopover(e){this.event=e,this.popoverOpen=!0},dismiss(){ze.dismiss()}}}),$l={class:"header position_content"},wl={style:{"font-size":"1.2em","font-weight":"700"}},Cl={key:0,class:"date-filter"},kl={class:"dueCardContent"},Il={key:1,class:"no-appointments"};function Sl(e,t,a,s,i,c){const r=_("ion-icon"),u=_("ion-header"),m=_("ion-label"),f=_("ion-segment-button"),p=_("ion-segment"),D=_("DateInputField"),h=_("ion-col"),v=_("ion-row"),g=_("DataTable"),y=_("ion-card-content"),k=_("ion-card"),N=_("ion-content"),O=_("ion-page");return d(),H(O,null,{default:l(()=>[o(u,null,{default:l(()=>[n("div",$l,[n("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=(...P)=>e.dismiss&&e.dismiss(...P))},[o(r,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",wl,w(e.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:t[1]||(t[1]=P=>e.openPopover(P))},[o(r,{slot:"separator",size:"large",icon:e.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),o(N,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:l(()=>[o(p,{modelValue:e.viewMode,"onUpdate:modelValue":t[2]||(t[2]=P=>e.viewMode=P),onIonChange:e.onViewModeChange},{default:l(()=>[o(f,{value:"today"},{default:l(()=>[o(m,null,{default:l(()=>[...t[3]||(t[3]=[x("Today's Appointments",-1)])]),_:1})]),_:1}),o(f,{value:"range"},{default:l(()=>[o(m,null,{default:l(()=>[...t[4]||(t[4]=[x("Date Range",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","onIonChange"]),e.viewMode==="range"?(d(),b("div",Cl,[o(v,null,{default:l(()=>[o(h,null,{default:l(()=>[o(D,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:e.endDate,disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1},null,8,["icon","inputValue","maxDate","onUpdate:rawDateValue"])]),_:1}),o(h,null,{default:l(()=>[o(D,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):T("",!0),o(k,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:l(()=>[o(y,null,{default:l(()=>[n("div",kl,[e.appointments.length>0?(d(),H(g,{key:0,data:e.appointments,columns:e.tableColumns,options:e.tableOptions,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns","options"])):(d(),b("div",Il," No appointments found for the selected "+w(e.viewMode==="today"?"day":"date range"),1))])]),_:1})]),_:1})]),_:1})]),_:1})}const Pl=Z(Dl,[["render",Sl],["__scopeId","data-v-e54f2168"]]),Al={class:"card-count"},Tl={class:"card-label"},Nl="#ffffff",Ol=Q({__name:"DashboardCard",props:{icon:{},count:{},label:{},color:{}},emits:["cardClick"],setup(e,{emit:t}){const i={success:"#A5D6A7",info:"#81D4FA",warning:"#FFF59D",danger:"#EF9A9A"}[e.color||"info"]||"#E0E0E0";return(c,r)=>(d(),H(C(Ue),{class:"dashboard-card",style:Ye({borderColor:C(i),backgroundColor:Nl}),onClick:r[0]||(r[0]=u=>c.$emit("cardClick"))},{default:l(()=>[o(C(Y),{icon:e.icon,class:"card-icon"},null,8,["icon"]),n("div",Al,w(e.count),1),n("div",Tl,w(e.label),1)]),_:1},8,["style"]))}}),Rl=Z(Ol,[["__scopeId","data-v-84ad3c1b"]]),Fl=()=>({deathOutcomeForm:q(()=>[{componentType:"Heading",name:"Death Details",position:"center",grid:{s:"12"}},{componentType:"inputField",header:"Place of death",name:"Place of death",icon:se.editPen,grid:{s:"12"},validation:t=>!t||t===""?"Place of death is required":null},{componentType:"dateInputField",header:"Date of death",name:"Date of death",icon:se.calenderPrimary,showTodayButton:!0,grid:{s:"12"},validation:t=>!t||t===""?"Date of death is required":null},{componentType:"timeInputField",header:"Time of death",name:"Time Of Death",showNowButton:!0,icon:se.calenderPrimary,grid:{s:"12"},validation:t=>!t||t===""?"Time of death is required":null},{componentType:"inputField",header:"Name of guardian",name:"Guardian; name and first names",icon:se.editPen,grid:{s:"12"},validation:t=>!t||t===""?"Guardian name is required":null},{componentType:"phoneInputField",header:"Guardian phone number",name:"Phone number",grid:{s:"12"},validation:t=>La.isMWPhoneNumber(t.phoneNumber)},{componentType:"checkboxField",name:"Pregnant woman",type:"single",label:"Was the individual pregnant at the time of death?",grid:{s:"12"},condition:t=>t._isChildBearing===!0},{componentType:"dateInputField",header:"Date arrived",name:"Death on arrival",showTodayButton:!0,icon:se.calenderPrimary,grid:{s:"12"},validation:t=>!t||t===""?"Date arrived is required":null},{componentType:"timeInputField",header:"Time arrived",name:"Time to clinic",icon:se.calenderPrimary,grid:{s:"12"},showNowButton:!0,validation:t=>!t||t===""?"Time arrived is required":null},{componentType:"multiSelectInputField",header:"Cause of death",name:"Cause of death",trackBy:"id",isMultiple:!1,grid:{s:"12"},options:[{id:1,name:"Natural"},{id:2,name:"Accident"},{id:3,name:"Homicide"},{id:4,name:"Suicide"},{id:5,name:"Pending investigation"},{id:6,name:"Could not be determined"},{id:7,name:"Other - specify"}],validation:t=>t?null:"Cause of death is required",onChange:t=>{const a={},s=typeof t=="object"&&t!==null?t.name:t;return s!=="Other - specify"&&(a["Other notes"]=""),s!=="Accident"&&(a["Road traffic accident"]=""),a}},{componentType:"inputField",header:"Specify other manner of death",name:"Other notes",icon:se.editPen,grid:{s:"12"},validation:(t,a)=>{const s=a==null?void 0:a["Cause of death"];return(typeof s=="object"&&s!==null?s.name:s)==="Other - specify"&&(!t||t==="")?"Please specify other manner of death":null},condition:t=>{const a=t==null?void 0:t["Cause of death"];return(typeof a=="object"&&a!==null?a.name:a)==="Other - specify"}},{componentType:"multiSelectInputField",header:"How did the accident occur?",name:"Road traffic accident",trackBy:"id",isMultiple:!1,grid:{s:"12"},options:[{id:1,name:"Motor vehicle (passenger)"},{id:2,name:"Motor vehicle (pedestrian)"},{id:3,name:"Drowning"},{id:4,name:"Other - specify"}],validation:(t,a)=>{const s=a==null?void 0:a["Cause of death"];return(typeof s=="object"&&s!==null?s.name:s)==="Accident"&&!t?"Please specify how the accident occurred":null},condition:t=>{const a=t==null?void 0:t["Cause of death"];return(typeof a=="object"&&a!==null?a.name:a)==="Accident"},onChange:t=>{const a={};return(typeof t=="object"&&t!==null?t.name:t)!=="Other - specify"&&(a["Other notes"]=""),a}},{componentType:"inputField",header:"Specify other cause of death",name:"Other notes",icon:se.editPen,grid:{s:"12"},validation:(t,a)=>{const s=a==null?void 0:a["Road traffic accident"];return(typeof s=="object"&&s!==null?s.name:s)==="Other - specify"&&(!t||t==="")?"Please specify other cause of death":null},condition:t=>{const a=t==null?void 0:t["Road traffic accident"];return(typeof a=="object"&&a!==null?a.name:a)==="Other - specify"}},{componentType:"Heading",name:"Death Confirmation",position:"center",grid:{s:"12"}},{componentType:"dateInputField",header:"Date confirming death",name:"Date of confinement",icon:se.calenderPrimary,showTodayButton:!0,grid:{s:"12"},validation:t=>!t||t===""?"Date confirming death is required":null},{componentType:"timeInputField",header:"Time confirming death",name:"Confirmed",icon:se.calenderPrimary,showNowButton:!0,grid:{s:"12"},validation:t=>!t||t===""?"Time confirming death is required":null},{componentType:"inputField",header:"Person confirming death",name:"Responsible person present",icon:se.editPen,grid:{s:"12"},validation:t=>!t||t===""?"Person confirming death is required":null},{componentType:"inputField",header:"Position",name:"Position",icon:se.editPen,grid:{s:"12"},validation:t=>!t||t===""?"Position is required":null},{componentType:"inputField",header:"Medical council registration number",name:"Register Number",icon:se.editPen,grid:{s:"12"}}])}),xt=Q({__name:"BroughtDead",setup(e,{expose:t}){const{deathOutcomeForm:a}=Fl(),{formRef:s,exposeFormMethods:i}=Va(),c=()=>{if(s.value){const u=new Fe().isChildBearing();s.value.setFormValue("_isChildBearing",u)}};return _e(()=>{c()}),ge(()=>{var r;return(r=s.value)==null?void 0:r.formValues},()=>{c()},{deep:!0}),t(i()),(r,u)=>(d(),H(Ma,{formData:C(a),ref_key:"formRef",ref:s},null,8,["formData"]))}}),Bl={key:0,class:"spinner-overlay"},Ll={class:"header-container"},Vl={class:"header-title"},Ml={key:0,class:"search-container"},xl={style:{display:"flex",width:"100%","justify-content":"center",padding:"20px"}},El={class:"search-results-container"},Hl={key:1,class:"patient-info-banner"},Ul={class:"patient-details"},Wl={key:2,class:"masonry-grid"},jl={class:"card-container"},zl={class:"custom-card"},ql={class:"card-container"},Gl={key:0,class:"custom-card"},Jl={key:1,class:"custom-card"},Ql={class:"custom-card card-margin-top"},Yl={key:0,class:"card-container"},Kl={class:"custom-card"},Xl={class:"custom-card card-margin-top"},Zl={class:"card-container"},ed={class:"custom-card"},td={key:0,class:"custom-card card-margin-top"},nd={key:3,class:"death-outcome-centered"},ad={class:"custom-card"},sd={class:"footer-content"},od={class:"footer-buttons-left"},id={key:0,class:"pagination-dots"},rd=["onClick"],ld={class:"footer-buttons-right"},dd=Q({__name:"BroughtInDeadRegistration",props:{editMode:{type:Boolean,default:!1}},setup(e){const t=F(!1),a=Te();He();const s=re(),{patient:i}=Qe(s),c=F(null),r=F(null),u=F(null),m=F(null),f=F(null),p=F(null),D=F(null),h=F(null),v=F(!1),g=F(""),y=F([]),k=F(!1),N=F(null),O=F(null),P=F(null),V=F(!1),X=F(null),ee=new xa,le=F({personalInformationRef:c,birthRegistrationRef:r,socialHistoryRef:u,countryRef:m,currentLocationRef:f,homeLocationRef:p,patientTypeRef:D,deathOutcomeRef:h}),ye=q(()=>{var A;return((A=c.value)==null?void 0:A.currentFormValues)||{}}),S=q(()=>{var A;return((A=r.value)==null?void 0:A.currentFormValues)||{}}),$=q(()=>{var A;return((A=u.value)==null?void 0:A.currentFormValues)||{}}),G=q(()=>{var A;return((A=m.value)==null?void 0:A.currentFormValues)||{}}),J=q(()=>{var A;return((A=f.value)==null?void 0:A.currentFormValues)||{}}),z=q(()=>{var A;return((A=p.value)==null?void 0:A.currentFormValues)||{}}),W=q(()=>{var A;return((A=D.value)==null?void 0:A.currentFormValues)||{}}),L=q(()=>{var A;return((A=h.value)==null?void 0:A.currentFormValues)||{}}),ne=q(()=>({personalInformation:ye.value,birthRegistration:S.value,socialHistory:$.value,country:G.value,currentLocation:J.value,homeLocation:z.value,patientType:W.value,deathOutcome:L.value})),U=q(()=>new Lt().checkIfChild(ye.value)),{nextPage:de,prevPage:ke,goToPage:fn,isCardVisible:Je,showPreviousButton:hn,showPaginationButtons:gn,totalPages:Dt,currentPage:$t,showNextButton:_n}=ss();os();const wt=A=>{try{return(A.observations||[]).some(M=>M.encounter_type===40?(M.obs||[]).some(te=>te.concept_id===11520):!1)}catch(I){return console.error("Error checking deceased status:",I),!1}},vn=F([{title:"Name",data:null,render:(A,I,R)=>{var te;const M=R.personInformation||R.person,E=((te=M==null?void 0:M.names)==null?void 0:te[0])||M;if(E){const ie=E.given_name||E.givenName||"",An=E.family_name||E.familyName||"";return"".concat(ie," ").concat(An).trim()||"N/A"}return"N/A"}},{title:"MRN",data:null,render:(A,I,R)=>{var E;const M=R.patient_identifiers||((E=R.person)==null?void 0:E.patient_identifiers);if(Array.isArray(M)){const te=M.find(ie=>ie.identifier_type===3||ie.type===3||ie.name==="Patient Identifier");if(te)return te.identifier||"N/A";if(M.length>0)return M[0].identifier||"N/A"}return"N/A"}},{title:"Gender",data:null,render:(A,I,R)=>{const M=R.personInformation||R.person,E=M==null?void 0:M.gender;return E==="M"||E==="Male"?"Male":E==="F"||E==="Female"?"Female":"N/A"}},{title:"Birthdate",data:null,render:(A,I,R)=>{const M=R.personInformation||R.person,E=(M==null?void 0:M.birthdate)||(M==null?void 0:M.birth_date);if(E)try{return B.toStandardHisDisplayFormat(new Date(E))}catch(te){return E}return"N/A"}},{title:"Status",data:null,defaultContent:"",render:(A,I,R)=>wt(R)?'<span style="background:#dc2626;color:#fff;padding:4px 12px;border-radius:12px;font-size:11px;font-weight:600;">DECEASED</span>':'<span style="background:#10b981;color:#fff;padding:4px 12px;border-radius:12px;font-size:11px;font-weight:600;">ALIVE</span>'}]),yn=F({responsive:!0,searching:!1,paging:!1,info:!1,scrollX:!0}),bn=()=>{const A=Object.values(le.value);return A.forEach(I=>I==null?void 0:I.validateForm()),A.every(I=>(I==null?void 0:I.validateForm())==null)},Ct=()=>{Object.values(le.value).forEach(A=>A==null?void 0:A.resetForm())},Dn=A=>{X.value(A)},$n=async A=>{const I=A.target.value;if(!I||I.length<2){y.value=[],k.value=!1;return}try{const R=await ee.searchPatients({searchText:I,page:1,paginationSize:10,sitePrefix:"",ddeEnabled:!1,programId:j.getProgramID(),activeFilter:"All"});console.log("Search results:",R);let M=(R==null?void 0:R.onlinePatients)||[];R!=null&&R.offlinePatients&&(Array.isArray(R.offlinePatients)?M=[...M,...R.offlinePatients]:R.offlinePatients.records&&Array.isArray(R.offlinePatients.records)&&(M=[...M,...R.offlinePatients.records])),y.value=M,y.value.length>0?(N.value=A,k.value=!0,await ce(),await ce(),wn()):console.log("No search results found")}catch(R){console.error("Search error:",R),oe("Search failed. Please try again.")}},be=()=>{if(O.value)try{const A=O.value.dt;A&&A.off("click")}catch(A){console.error("Cleanup error:",A)}},wn=async()=>{if(await ce(),!O.value){console.log("Search table ref not available");return}be();const A=O.value.dt;A&&A.on("click","tbody tr",async I=>{const R=A.row(I.currentTarget).data();R&&await Cn(R)})},Cn=async A=>{if(!t.value)try{t.value=!0,k.value=!1,s.$reset(),P.value=null,await ce();let I=null;if(j.getPouchDbStatus()||j.getLanConnectionStatus()){const M=await Ce("patients_records",{selector:{patientID:A.patient_id||A.patientID}});if(Array.isArray(M))I=M.length>0?M[0]:null;else if(M&&typeof M=="object"&&"data"in M){const E=M;I=E.data.length>0?E.data[0]:null}}if(I||(I=await j.getJson("/patients/".concat(A.patient_id||A.patientID,"/get_patient_record"))),!I){oe("Patient record not found"),g.value="",y.value=[],be();return}if(wt(I)){oe("This patient is already marked as deceased. Redirecting to profile..."),await s.setPatientRecord(I),await ce(),g.value="",y.value=[],be(),a.push("/deathPatientProfile");return}await s.setPatientRecord(I),await ce();const R=ee.formatPatientForDisplay(I);P.value={fullName:R.displayName,identifier:R.identifier,gender:R.gender,age:R.birthdate,patientId:I.patient_id||I.patientID},V.value=!1,g.value="",y.value=[],be(),ot("Patient selected. Please fill death outcome form.")}catch(I){oe("Failed to load patient. Please try again."),s.$reset(),P.value=null,k.value=!1,g.value="",y.value=[],be()}finally{t.value=!1}},kn=()=>{P.value=null,V.value=!0,g.value="",k.value=!1,y.value=[],s.$reset(),be(),t.value=!1},In=async()=>{await Rt("Clear selected patient?")&&(P.value=null,V.value=!1,s.$reset(),g.value="",y.value=[],k.value=!1,be(),t.value=!1,await ce())},Sn=()=>{k.value=!1,be()},Pn=async()=>{var A;try{if(v.value=!0,P.value){const I=(A=h.value)==null?void 0:A.validateForm();if(console.log("Death form validation result:",I),console.log("Death form values:",L.value),I!=null){oe("Please fill in all required death information"),v.value=!1;return}const R=L.value;R&&Object.keys(R).length>0?(await kt(R),i.value&&await Ft(i.value),ot("Death outcome saved"),St("/deathPatientProfile")):(oe("Please fill in death outcome information"),v.value=!1)}else{if(!bn()){oe("Please fill in all required fields"),v.value=!1;return}if(await new Lt().saveRegistrationData(ne.value)){const R=L.value;R&&Object.keys(R).length>0&&await kt(R),i.value&&await Ft(i.value),Ct(),ot("Patient registered and death outcome saved"),St("/deathPatientProfile")}}}catch(I){console.error(I),oe("Failed to save")}finally{v.value=!1}},kt=async A=>{const I=[],R=B.sessionDate();for(const[M,E]of Object.entries(A))if(!(!E||E===!1||E===""||M.startsWith("_")))if(typeof E=="object"&&E!==null&&!Array.isArray(E)){const te=E.name||E.id||String(E);te&&te!==""&&I.push(await Be.buildValueText(M,String(te)))}else if(M==="Phone number"&&typeof E=="object"){const te=E.phoneNumber||String(E);te&&te!==""&&I.push(await Be.buildValueText(M,String(te)))}else if(Array.isArray(E))for(const te of E){const ie=typeof te=="object"&&te!==null?te.value||te.name:te;ie&&ie!==""&&I.push(await Be.buildValueText(M,String(ie)))}else typeof E=="string"||typeof E=="number"?I.push(await Be.buildValueText(M,String(E))):typeof E=="boolean"&&E===!0&&I.push(await Be.buildValueText(M,"Yes"));I.length>0&&await Be.addObsToEncounterPatient([{concept_id:11520,value_coded:11520,child:I,obs_datetime:R}],vt.PATIENT_OUTCOME)},It=async()=>{await Rt("Cancel registration?")&&(Ct(),P.value=null,V.value=!1,s.$reset(),ze.dismiss())},St=A=>{a.push({path:A})};return _e(()=>{X.value=Ve.debounce($n,800)}),pa(()=>{be()}),(A,I)=>(d(),H(C(xe),{class:ue({loading:t.value})},{default:l(()=>[t.value?(d(),b("div",Bl,[o(C(Xt),{name:"bubbles"}),I[8]||(I[8]=n("div",{class:"loading-text"},"Please wait...",-1))])):T("",!0),o(C(ve),null,{default:l(()=>[n("div",Ll,[n("div",Vl,w(e.editMode?"Edit Patient Demographic":"Register Brought In Dead"),1),!e.editMode&&!V.value&&!P.value?(d(),H(C(Se),{key:0,fill:"clear",color:"danger",onClick:I[0]||(I[0]=R=>It()),class:"header-cancel-btn"},{default:l(()=>[o(C(Y),{icon:C(Pt),slot:"icon-only"},null,8,["icon"])]),_:1})):T("",!0)])]),_:1}),o(C(pe),null,{default:l(()=>{var R,M,E,te;return[e.editMode?T("",!0):(d(),b("div",Ml,[n("div",xl,[o(C(ut),{style:{color:"#000",width:"70%"},onIonInput:Dn,fill:"outline",modelValue:g.value,"onUpdate:modelValue":I[2]||(I[2]=ie=>g.value=ie),placeholder:"Search if patient exists by MRN or Name else register new record",class:"searchField"},{default:l(()=>[o(C(Ae),{style:{display:"flex"},slot:"start"},{default:l(()=>[o(C(Y),{icon:C(ma),style:{color:"#000"},"aria-hidden":"true"},null,8,["icon"])]),_:1}),o(C(Ae),{style:{display:"flex"},slot:"end"},{default:l(()=>[o(C(fa),{style:{cursor:"pointer",color:"#74ff15"},slot:"end"},{default:l(()=>[o(C(Y),{icon:C(ha),onClick:I[1]||(I[1]=ie=>kn()),"aria-hidden":"true",title:"Register New Patient"},null,8,["icon"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),o(C(_t),{"is-open":k.value,event:N.value,onDidDismiss:Sn,"show-backdrop":!0},{default:l(()=>[n("div",El,[o(C(Me),{data:y.value,columns:vn.value,options:yn.value,class:"display nowrap search-table",width:"100%",ref_key:"searchDataTableRef",ref:O},null,8,["data","columns","options"])])]),_:1},8,["is-open","event"])])),P.value&&!V.value?(d(),b("div",Hl,[n("div",Ul,[n("h3",null,w(P.value.fullName),1),n("p",null,"MRN: "+w(P.value.identifier)+" | Gender: "+w(P.value.gender)+" | Age: "+w(P.value.age),1)]),o(C(Se),{size:"small",color:"danger",onClick:I[3]||(I[3]=ie=>In())},{default:l(()=>[o(C(Y),{icon:C(Pt),slot:"start"},null,8,["icon"]),I[9]||(I[9]=x(" Clear Selection ",-1))]),_:1})])):T("",!0),V.value?(d(),b("div",Wl,[we(n("div",jl,[n("div",zl,[o(is,{ref_key:"personalInformationRef",ref:c},null,512)])],512),[[Ie,C(Je)(0)]]),we(n("div",ql,[U.value.underNineMonths&&!e.editMode?(d(),b("div",Gl,[o(rs,{ref_key:"birthRegistrationRef",ref:r},null,512)])):T("",!0),U.value.moreThanThirteenYears?(d(),b("div",Jl,[o(ls,{ref_key:"socialHistoryRef",ref:u},null,512)])):T("",!0),n("div",Ql,[o(ds,{ref_key:"countryRef",ref:m},null,512)])],512),[[Ie,C(Je)(1)]]),!((M=(R=G.value)==null?void 0:R.country)!=null&&M.name)||((te=(E=G.value)==null?void 0:E.country)==null?void 0:te.name)==="Malawi"?we((d(),b("div",Yl,[n("div",Kl,[o(cs,{ref_key:"currentLocationRef",ref:f},null,512)]),n("div",Xl,[o(us,{currentLocationFormValues:J.value,ref_key:"homeLocationRef",ref:p},null,8,["currentLocationFormValues"])])],512)),[[Ie,C(Je)(2)]]):T("",!0),we(n("div",Zl,[n("div",ed,[o(xt,{ref_key:"deathOutcomeRef",ref:h},null,512)]),C(j).getProgramID()==1?(d(),b("div",td,[o(ps,{ref_key:"patientTypeRef",ref:D},null,512)])):T("",!0)],512),[[Ie,C(Je)(3)]])])):P.value?(d(),b("div",nd,[n("div",ad,[o(xt,{ref_key:"deathOutcomeRef",ref:h},null,512)])])):T("",!0)]}),_:1}),V.value||P.value?(d(),H(C(ga),{key:1},{default:l(()=>[n("div",sd,[n("div",od,[o(st,{name:"Cancel",color:"danger",icon:C(_a),"onClicked:btn":I[4]||(I[4]=R=>It())},null,8,["icon"]),we(o(C(Se),{onClick:I[5]||(I[5]=R=>C(ke)())},{default:l(()=>[...I[10]||(I[10]=[x("Previous",-1)])]),_:1},512),[[Ie,C(hn)&&V.value]])]),C(gn)&&V.value?(d(),b("div",id,[(d(!0),b(K,null,ae(C(Dt),R=>(d(),b("span",{key:R,class:ue({dot:!0,active:R===C($t)}),onClick:M=>C(fn)(R),role:"button"},null,10,rd))),128))])):T("",!0),n("div",ld,[we(o(st,{name:"Save",loading:v.value,fill:"solid",color:"primary",icon:C(va),"onClicked:btn":I[6]||(I[6]=R=>Pn())},null,8,["loading","icon"]),[[Ie,!V.value||C($t)===C(Dt)]]),we(o(st,{name:"Next","onClicked:btn":I[7]||(I[7]=R=>C(de)())},null,512),[[Ie,C(_n)&&V.value]])])])]),_:1})):T("",!0)]),_:1},8,["class"]))}}),mn=Z(dd,[["__scopeId","data-v-58f168b0"]]),cd=Q({name:"BroughtInDeadTable",components:{IonCard:Ue,IonCardHeader:ft,IonCardTitle:mt,IonCardContent:Xe,IonIcon:Y,IonSpinner:Xt,ReusableDataTable:as},setup(){const e=Te(),t=yt();return{router:e,statusStore:t}},data(){return{loadingBroughtInDead:!1,broughtInDeadData:[],tableKey:0,refreshInterval:null,bidHeaders:["First Name","Surname","Gender","Age","Date Of Death","Cause Of Death","Brought By","Confirmed By","Action"],bidTableOptions:{responsive:!0,ordering:!1,buttons:[],pageLength:10,dom:'<"table-controls"<"buttons-container">f>rtip',language:{emptyTable:"No dead patients recorded today",zeroRecords:"No matching records found"},initComplete:function(){const e=document.querySelector(".buttons-container");if(e){e.innerHTML='\n                            <button class="btn-register-bid" style="\n                                background: #dc2626; color: white; border: none; border-radius: 8px;\n                                padding: 8px 20px; font-weight: 600; font-size: 14px; cursor: pointer;\n                                display: flex; align-items: center; gap: 8px;\n                                box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);\n                            ">\n                                <ion-icon name="add-circle-outline" style="font-size: 20px;"></ion-icon>\n                                Register Brought In Dead\n                            </button>\n                        ';const t=e.querySelector(".btn-register-bid");t&&t.addEventListener("click",()=>{window.dispatchEvent(new CustomEvent("register-bid-click"))})}}}}},computed:{broughtInDeadTableData(){return this.broughtInDeadData.map(e=>[e.firstName,e.surname,e.gender,e.age,e.dateOfDeath,e.causeOfDeath,e.broughtBy,e.confirmedBy,this.buildActionButtons({id:e.id,name:"".concat(e.firstName," ").concat(e.surname),patientId:e.id})])},bidActionHandlers(){return{"view-profile-btn":this.handleViewProfile}}},watch:{"statusStore.apiStatus":{handler(){this.fetchBroughtInDeadData()}}},async mounted(){await this.fetchBroughtInDeadData(),this.refreshInterval=setInterval(()=>{this.fetchBroughtInDeadData()},3e4),window.addEventListener("register-bid-click",this.openBroughtDeadModal),window.addEventListener("bid-registration-complete",this.handleRegistrationComplete)},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval),window.removeEventListener("register-bid-click",this.openBroughtDeadModal),window.removeEventListener("bid-registration-complete",this.handleRegistrationComplete)},methods:{skullOutline(){return Zt},openBroughtDeadModal(){Le(mn,{class:"fullScreenModal"},!0)},async handleRegistrationComplete(){await this.fetchBroughtInDeadData()},async fetchBroughtInDeadData(){this.loadingBroughtInDead=!0;try{const e=j.getUserLocationId();if(!e){this.broughtInDeadData=[];return}const t=B.currentDate();let a=[],s=[];try{const i=await tn.getAllEncounters({encounter_type_id:40,date:t});a=this.processEncounters(i||[],e)}catch(i){console.error("Online fetch failed:",i)}try{const i=await Ce("patients_records",{}),c=Array.isArray(i)?i:(i==null?void 0:i.data)||[];s=this.processPatientRecords(c,e,t)}catch(i){console.error("Offline fetch failed:",i)}this.broughtInDeadData=this.combineAndDeduplicate(a,s),this.forceTableUpdate()}catch(e){console.error("Error in fetchBroughtInDeadData:",e),this.broughtInDeadData=[],this.forceTableUpdate()}finally{this.loadingBroughtInDead=!1}},processPatientRecords(e,t,a){const s=[];return console.log("Processing ".concat(e.length," patient records for date ").concat(a)),e.forEach(i=>{try{const r=(i.observations||[]).filter(u=>u.encounter_type===40);if(r.length===0)return;r.forEach(u=>{var $,G,J,z;const f=(u.obs||[]).find(W=>W.concept_id===11520);if(!f)return;const p=u.encounter_datetime||f.obs_datetime||u.obs_datetime;if(!p){console.log("No encounter date found for patient:",i.patientID);return}const D=B.toStandardHisFormat(new Date(p));if(console.log("Patient ".concat(i.patientID,": encounter date ").concat(D," vs target ").concat(a)),D!==a)return;const h=f.children||[];let v="N/A",g="N/A",y="N/A",k="N/A";h.forEach(W=>{const L=W.concept_id,ne=W.value_text||W.value_datetime||W.value_coded_name||"";L===1815||L===7398?v=ne:L===5002?g=ne:L===1824?y=ne:L===1345&&(k=ne)});let N="Unknown";const O=u.provider||u.creator;if(O){const W=O.given_name||((G=($=O.names)==null?void 0:$[0])==null?void 0:G.given_name)||"",L=O.family_name||((z=(J=O.names)==null?void 0:J[0])==null?void 0:z.family_name)||"";N="".concat(W," ").concat(L).trim()||"Unknown"}else k!=="N/A"&&(N="Confirmed at ".concat(k));const P=i.personInformation||{},V=P.given_name||"N/A",X=P.family_name||"N/A",ee=P.gender==="M"?"Male":P.gender==="F"?"Female":"N/A",le=P.birthdate,ye=le?this.calculateAge(le):"N/A",S=i.patientID||i.patient_id;console.log("Added offline patient: ".concat(V," ").concat(X," (").concat(S,")")),s.push({id:S,firstName:V,surname:X,age:ye,gender:ee,dateOfDeath:v,causeOfDeath:g,broughtBy:y,confirmedBy:N})})}catch(c){console.error("Error processing patient record:",c)}}),console.log("Processed offline results: ".concat(s.length," patients")),s},processEncounters(e,t){return e.reduce((a,s)=>{var v,g,y;if(String(s==null?void 0:s.location_id)!==String(t))return a;const i=s.observations||[];if(!i.some(k=>k.concept_id===7398||k.concept_id===11520))return a;let r="N/A",u="N/A",m="N/A";i.forEach(k=>{var N,O,P;(k.concept_id===1815||(N=k.concept_name)!=null&&N.includes("Date of death"))&&(r=k.value_text||k.value_datetime||r),(k.concept_id===5002||(O=k.concept_name)!=null&&O.includes("Cause of death"))&&(u=k.value_text||k.value_coded_name||u),(k.concept_id===1824||(P=k.concept_name)!=null&&P.includes("Guardian"))&&(m=k.value_text||m)});const f=((v=s==null?void 0:s.patient)==null?void 0:v.person)||(s==null?void 0:s.person),p=(g=f==null?void 0:f.names)==null?void 0:g[0],D=(s==null?void 0:s.provider)||(s==null?void 0:s.creator),h=(y=D==null?void 0:D.names)!=null&&y[0]?"".concat(D.names[0].given_name||""," ").concat(D.names[0].family_name||"").trim():"Unknown";return a.push({id:s.patient_id,firstName:(p==null?void 0:p.given_name)||"N/A",surname:(p==null?void 0:p.family_name)||"N/A",age:this.calculateAge(f==null?void 0:f.birthdate),gender:(f==null?void 0:f.gender)==="M"?"Male":"Female",dateOfDeath:r,causeOfDeath:u,broughtBy:m,confirmedBy:h}),a},[])},combineAndDeduplicate(e,t){const a=new Map;return[...e,...t].forEach(s=>{a.has(s.id)||a.set(s.id,s)}),Array.from(a.values())},forceTableUpdate(){this.tableKey+=1},calculateAge(e){if(!e)return"N/A";try{const t=new Date(e),a=new Date;if(isNaN(t.getTime()))return"N/A";let s=a.getFullYear()-t.getFullYear();const i=a.getMonth()-t.getMonth();return(i<0||i===0&&a.getDate()<t.getDate())&&s--,s>=0?s.toString():"N/A"}catch(t){return"N/A"}},buildActionButtons(e){return'\n                <div style="display: flex; gap: 6px;" data-patient-id="'.concat(e.patientId,'">\n                    <button class="view-profile-btn"\n                            data-button-type="profile"\n                            style="').concat("\n                padding: 4px 12px;\n                font-size: 0.8rem;\n                height: 28px;\n                min-width: 70px;\n                white-space: nowrap;\n                background-color: #3880ff;\n                color: white;\n                border: none;\n                border-radius: 4px;\n                cursor: pointer;\n            ","\"\n                            data-id='").concat(JSON.stringify(e),'\'\n                            title="View Profile">\n                        <span class="button-text">Profile</span>\n                        <span class="button-spinner" style="display: none;">Loading...</span>\n                    </button>\n                </div>\n            ')},async handleViewProfile(e){if(!(!e||!e.patientId)){this.setButtonLoading(e.patientId,"profile",!0);try{let t=null;try{t=(await Ce("patients_records",{selector:{patientID:e.patientId}}))[0]}catch(a){console.error("PouchDB fetch failed:",a)}if(!t&&this.statusStore.apiStatus)try{t=await j.getJson("/patients/".concat(e.patientId,"/get_patient_record"))}catch(a){console.error("API fetch failed:",a)}t?(await re().setPatientRecord(t),await ce(),this.$router.push("/deathPatientProfile")):(oe("Patient not found."),this.setButtonLoading(e.patientId,"profile",!1))}catch(t){console.error("Error in handleViewProfile:",t),oe("Error loading patient profile."),this.setButtonLoading(e.patientId,"profile",!1)}}},setButtonLoading(e,t,a){const s=document.querySelector('[data-patient-id="'.concat(e,'"]'));if(!s)return;const i=s.querySelector('[data-button-type="'.concat(t,'"]'));if(!i)return;const c=i.querySelector(".button-text"),r=i.querySelector(".button-spinner");a?(i.setAttribute("disabled","true"),c&&(c.style.display="none"),r&&(r.style.display="inline-block")):(i.removeAttribute("disabled"),c&&(c.style.display="inline"),r&&(r.style.display="none"))}}}),ud={key:0,class:"loading-container"};function pd(e,t,a,s,i,c){const r=_("ion-icon"),u=_("ion-card-title"),m=_("ion-card-header"),f=_("ion-spinner"),p=_("ReusableDataTable"),D=_("ion-card-content"),h=_("ion-card");return d(),H(h,{class:"dashboard-card bid-card"},{default:l(()=>[o(m,{class:"dashboard-card-header"},{default:l(()=>[o(u,{class:"dashboard-title"},{default:l(()=>[o(r,{icon:e.skullOutline,slot:"start",class:"dashboard-icon danger-icon"},null,8,["icon"]),t[0]||(t[0]=x(" Dead Patients Today ",-1))]),_:1})]),_:1}),o(D,{class:"bid-card-content"},{default:l(()=>[e.loadingBroughtInDead?(d(),b("div",ud,[o(f,{name:"crescent"}),t[1]||(t[1]=n("p",{class:"loading-text"},"Loading dead patients' records...",-1))])):(d(),H(p,{headers:e.bidHeaders,data:e.broughtInDeadTableData,options:e.bidTableOptions,actionHandlers:e.bidActionHandlers,containerClass:"",key:e.tableKey},null,8,["headers","data","options","actionHandlers"]))]),_:1})]),_:1})}const md=Z(cd,[["render",pd],["__scopeId","data-v-21c50a20"]]),fd=Q({name:"OPDDashboard",components:{DashboardCard:Rl,BroughtInDeadTable:md},setup(){const{ready:e,OPDWaitingLists:t,hasWaitingList:a,refreshUserData:s}=rn();return{ready:e,OPDWaitingLists:t,hasWaitingList:a,refreshUserData:s}},data(){return{totalPatientsToday:0,isRefreshing:!1}},computed:{...me(dt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","patientsVisits","todaysAppointmentsCount"])},async mounted(){await this.refreshDashboard()},methods:{skullOutline(){return Zt},openBroughtDeadModal(){Le(mn,{class:"fullScreenModal"},!0)},lockClosed(){return $a},refresh(){return Da},medkit(){return Gt},flask(){return ba},async refreshDashboard(){if(!this.isRefreshing){this.isRefreshing=!0;try{const e=j.getUserLocationId();if(!e)return;await Promise.all([dt().refresh(e),this.refreshUserData()])}finally{this.isRefreshing=!1}}},clipboard(){return Wt},thermometer(){return jt},calendar(){return ya},people(){return zt},openAllModal(e,t,a){Le(bl,{class:"fullScreenModal"},!0,{title:e,buttonTitle:t,buttonLink:a})},openPatientsListModal(e,t,a,s){Le(hl,{class:"fullScreenModal"},!0,{title:e,list:t,buttonTitle:a,buttonLink:s})},openAppointmentsModal(e,t){Le(Pl,{class:"fullScreenModal"},!0,{title:e,programType:t,programId:14})}}}),hd={class:"dashboard-wrapper"},gd={key:0,class:"loading-container"},_d={key:1,class:"no-access-container"};function vd(e,t,a,s,i,c){const r=_("ion-icon"),u=_("ion-card-title"),m=_("ion-card-header"),f=_("ion-spinner"),p=_("ion-button"),D=_("DashboardCard"),h=_("ion-row"),v=_("ion-grid"),g=_("ion-card-content"),y=_("ion-card"),k=_("BroughtInDeadTable"),N=_("ion-content");return d(),H(N,{fullscreen:!0},{default:l(()=>[n("div",hd,[o(y,{class:"dashboard-card"},{default:l(()=>[o(m,{class:"dashboard-card-header"},{default:l(()=>[o(u,{class:"dashboard-title"},{default:l(()=>[o(r,{icon:e.people(),slot:"start",class:"dashboard-icon"},null,8,["icon"]),t[6]||(t[6]=x(" Today's Patients Overview ",-1))]),_:1})]),_:1}),o(g,null,{default:l(()=>[e.ready?e.OPDWaitingLists.length===0?(d(),b("div",_d,[o(r,{icon:e.lockClosed(),class:"no-access-icon"},null,8,["icon"]),t[9]||(t[9]=n("h2",{class:"no-access-title"},"No Waiting Lists Assigned",-1)),t[10]||(t[10]=n("p",{class:"no-access-message"}," You currently don't have access to any waiting lists. Please contact your system administrator or supervisor to request access. ",-1)),o(p,{color:"primary",fill:"outline",onClick:e.refreshDashboard,class:"refresh-button"},{default:l(()=>[o(r,{icon:e.refresh(),slot:"start"},null,8,["icon"]),t[8]||(t[8]=x(" Refresh ",-1))]),_:1},8,["onClick"])])):(d(),H(v,{key:2,class:"centered-grid"},{default:l(()=>[o(h,{class:"centered-row"},{default:l(()=>{var O,P,V,X;return[e.hasWaitingList("Total Patients Today")?(d(),H(D,{key:0,icon:e.people(),color:"primary",count:e.patientsVisits.length,label:"Total patients today",onCardClick:t[0]||(t[0]=ee=>e.openAllModal("All patients today","View profile","/patientProfile"))},null,8,["icon","count"])):T("",!0),e.hasWaitingList("Appointments Today")?(d(),H(D,{key:1,icon:e.calendar(),color:"primary",count:((O=e.todaysAppointmentsCount)==null?void 0:O.length)||0,label:"Appointments",onCardClick:t[1]||(t[1]=ee=>e.openAppointmentsModal("OPD Appointments","14"))},null,8,["icon","count"])):T("",!0),e.hasWaitingList("Waiting for Vitals")?(d(),H(D,{key:2,icon:e.thermometer(),color:"primary",count:(P=e.patientsWaitingForVitals)==null?void 0:P.length,label:"Waiting for vitals",onCardClick:t[2]||(t[2]=ee=>e.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals"))},null,8,["icon","count"])):T("",!0),e.hasWaitingList("Waiting for Consultation")?(d(),H(D,{key:3,icon:e.clipboard(),color:"primary",count:(V=e.patientsWaitingForConsultation)==null?void 0:V.length,label:"Waiting for consultation",onCardClick:t[3]||(t[3]=ee=>e.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan"))},null,8,["icon","count"])):T("",!0),e.hasWaitingList("Waiting for Laboratory")?(d(),H(D,{key:4,icon:e.flask(),color:"primary",count:e.patientsWaitingForLab.length,label:"Waiting for lab",onCardClick:t[4]||(t[4]=ee=>e.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan"))},null,8,["icon","count"])):T("",!0),e.hasWaitingList("Waiting for Dispensation")?(d(),H(D,{key:5,icon:e.medkit(),color:"primary",count:(X=e.patientsWaitingForDispensation)==null?void 0:X.length,label:"Waiting for dispensation",onCardClick:t[5]||(t[5]=ee=>e.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations"))},null,8,["icon","count"])):T("",!0)]}),_:1})]),_:1})):(d(),b("div",gd,[o(f,{name:"crescent"}),t[7]||(t[7]=n("p",{class:"loading-text"},"Loading dashboard...",-1))]))]),_:1})]),_:1}),e.ready&&e.OPDWaitingLists.length>0?(d(),H(k,{key:0})):T("",!0)])]),_:1})}const yd=Z(fd,[["render",vd],["__scopeId","data-v-e2741e83"]]),bd={class:"icon-container"},Dd=["src","alt"],$d={class:"card-title"},wd=Q({__name:"DashboardCard",props:{icon:{},title:{}},emits:["click"],setup(e,{emit:t}){const a=e,s=t,i=q(()=>se[a.icon]||"");return(c,r)=>(d(),b("div",{class:"card",onClick:r[0]||(r[0]=u=>s("click"))},[n("div",bd,[n("img",{src:i.value,alt:e.title},null,8,Dd)]),n("div",$d,w(e.title),1)]))}}),Cd=Z(wd,[["__scopeId","data-v-334cd0db"]]),kd={class:"dashboard-container"},Id={class:"dashboard-grid"},Sd=Q({__name:"AETCDashboard",setup(e){F("");const t=Te(),a=F([{id:"patientArrival",icon:"plus_dashboard",title:"Patient Arrival"},{id:"screeningList",icon:"checklist",title:"Awaiting Screening List"},{id:"registrationList",icon:"checklist",title:"Awaiting Registration List"},{id:"triageList",icon:"checklist",title:"Awaiting Triage List"},{id:"assessmentList",icon:"checklist",title:"Awaiting Assessment List"},{id:"testResultsList",icon:"checklist",title:"Awaiting Test Results List"},{id:"specialtyList",icon:"checklist",title:"Awaiting Specialty List"},{id:"dispositionList",icon:"checklist",title:"Disposition List"},{id:"broughtDead",icon:"document",title:"Brought In Dead"},{id:"reports",icon:"chart",title:"Reports"}]),s=i=>{t.push({name:i})};return(i,c)=>(d(),H(C(xe),null,{default:l(()=>[o(C(pe),{fullscreen:!0},{default:l(()=>[n("div",kd,[n("div",Id,[(d(!0),b(K,null,ae(a.value,r=>(d(),H(Cd,{key:r.id,icon:r.icon,title:r.title,onClick:u=>s(r.id)},null,8,["icon","title","onClick"]))),128))])])]),_:1})]),_:1}))}}),Pd=Z(Sd,[["__scopeId","data-v-bcce1a76"]]),Ad=Q({name:"NCDDashboard",mixins:[at],components:{ApexChart:Ke},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await ce(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return j.getJson("programs/32/reports/ncd_dashboard",{start_date:B.toStandardHisFormat(B.sessionDate()),end_date:B.toStandardHisFormat(B.sessionDate())})}}}),Td={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},Nd={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},Od={ref:"chartRef1"},Rd={ref:"chartRef2"};function Fd(e,t,a,s,i,c){const r=_("ion-card-content"),u=_("ion-card"),m=_("ApexChart");return d(),b(K,null,[n("div",Td,[o(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[o(r,null,{default:l(()=>[...t[0]||(t[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])]),_:1})]),_:1}),o(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[o(r,null,{default:l(()=>[...t[1]||(t[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])]),_:1})]),_:1}),o(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[o(r,null,{default:l(()=>[...t[2]||(t[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])]),_:1})]),_:1}),o(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[o(r,null,{default:l(()=>[...t[3]||(t[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])]),_:1})]),_:1})]),n("div",Nd,[o(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[o(r,null,{default:l(()=>[t[4]||(t[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",Od,[e.isChartReady?(d(),H(m,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:e.barChartOptions,series:e.barChartSeries},null,8,["options","series"])):T("",!0)],512)]),_:1})]),_:1}),o(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[o(r,null,{default:l(()=>[t[5]||(t[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",Rd,[e.isChartReady?(d(),H(m,{key:0,style:{width:"100%",height:"500px"},type:"line",options:e.lineChartOptions,series:e.lineChartSeries},null,8,["options","series"])):T("",!0)],512)]),_:1})]),_:1})])],64)}const Bd=Z(Ad,[["render",Fd],["__scopeId","data-v-58e2a3d8"]]),Ld=Q({name:"Home",mixins:[nn,at],components:{IonContent:pe,IonHeader:ve,IonPage:xe,IonToolbar:Ne,Toolbar:sn,IonRow:et,DateInputField:bt,IonIcon:Y,IonButton:Se,IonCol:Ze},data(){const e=F(B.sessionDate()),t=F(B.sessionDate()),a=F(B.sessionDate()),s=F([]);return{segmentContent:"Today",minDate:a,startDate:e,endDate:t,people:s,calendarOutline:Ee,eyeOutline:Kt}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(e){this.segmentContent=e},formatBirthdate(e){return B.getBirthdateAge(e)},async getAppointments(){this.people=[],(await on.getAppointments(this.startDate,this.endDate,"")).forEach(t=>{const a={person_id:t.person_id,npid:t.npid,appointment_id:103,encounter_id:t.encounter_id,name:t.given_name.concat(" ",t.family_name),gender:t.gender,ageDob:this.formatBirthdate(t.birthdate),village:t.city_village,appointmentDate:B.toStandardHisDisplayFormat(t.appointment_date)};this.people.push(a)})},async getAppointmentsD1(e){this.startDate=B.toStandardHisFormat(e),await this.getAppointments()},async getAppointmentsD2(e){this.endDate=B.toStandardHisFormat(e),await this.getAppointments()},async openClientProfile(e){await Fe.findByNpid(e),this.isPharmacist()},isPharmacist(){const e=JSON.parse(localStorage.getItem("userRoles")),t=e||[];t.some(a=>t.some(s=>s.role==="Pharmacist"))&&(this.$router.push("dispensation"),j.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),Vd={class:"appointments-container"},Md={key:0,class:"date-filter"},xd={class:"appointments-table"};function Ed(e,t,a,s,i,c){const r=_("ion-label"),u=_("ion-segment-button"),m=_("ion-segment"),f=_("DateInputField"),p=_("ion-col"),D=_("ion-row"),h=_("ion-icon"),v=_("ion-button"),g=_("ion-card");return d(),b("div",Vd,[n("div",null,[o(m,{value:e.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:l(()=>[o(u,{value:"Today",onClick:t[0]||(t[0]=y=>e.setSegmentContent("Today"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[3]||(t[3]=[x("Today",-1)])]),_:1})]),_:1}),o(u,{value:"Tomorrow",onClick:t[1]||(t[1]=y=>e.setSegmentContent("Tomorrow"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[4]||(t[4]=[x("Tomorrow",-1)])]),_:1})]),_:1}),o(u,{value:"Date range",onClick:t[2]||(t[2]=y=>e.setSegmentContent("Date range"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[5]||(t[5]=[x("Date range",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),e.segmentContent==="Date range"?(d(),b("div",Md,[o(D,null,{default:l(()=>[o(p,null,{default:l(()=>[o(f,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),o(p,null,{default:l(()=>[o(f,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):T("",!0),e.people.length>0?(d(),H(g,{key:1},{default:l(()=>[n("table",xd,[t[6]||(t[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),b(K,null,ae(e.people,y=>(d(),b("tr",{key:y.npid},[n("td",null,[o(D,null,{default:l(()=>[o(p,null,{default:l(()=>[x(w(y.name),1)]),_:2},1024),o(p,null,{default:l(()=>[o(v,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:k=>e.openClientProfile(y.npid),color:"primary",fill:"clear",size:"small"},{default:l(()=>[o(h,{icon:e.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,w(y.npid),1),n("td",null,w(y.ageDob),1),n("td",null,w(y.gender),1),n("td",null,w(y.village),1),n("td",null,w(y.appointmentDate),1)]))),128))])])]),_:1})):(d(),H(g,{key:2},{default:l(()=>[...t[7]||(t[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])]),_:1}))])}const Hd=Z(Ld,[["render",Ed],["__scopeId","data-v-c47f7768"]]),Ud=Q({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(e){}}}),Wd={key:0},jd={style:{display:"flex","margin-top":"10px"}},zd={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},qd={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},Gd={key:1};function Jd(e,t,a,s,i,c){const r=_("ion-label"),u=_("ion-segment-button"),m=_("ion-segment"),f=_("VisitsHistory");return d(),b(K,null,[n("div",null,[o(m,{value:e.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:l(()=>[o(u,{value:"Internal referrals",onClick:t[0]||(t[0]=p=>e.setSegmentContent("Internal referrals"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[2]||(t[2]=[x("Internal referrals",-1)])]),_:1})]),_:1}),o(u,{value:"External referrals",onClick:t[1]||(t[1]=p=>e.setSegmentContent("External referrals"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[3]||(t[3]=[x("External referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),e.segmentContent=="Internal referrals"?(d(),b("div",Wd,[n("div",jd,[e.checkUnderFive?(d(),b("div",zd)):T("",!0),t[4]||(t[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),e.checkUnderFive?T("",!0):(d(),b("div",qd))])])):T("",!0),e.segmentContent=="External referrals"?(d(),b("div",Gd,[o(f)])):T("",!0)],64)}const Qd=Z(Ud,[["render",Jd],["__scopeId","data-v-faad8f8b"]]),Yd=Q({name:"Menu",components:{IonContent:pe,IonHeader:ve,IonItem:Re,IonList:Oe,IonMenu:je,IonTitle:We,IonToolbar:Ne,IonCheckbox:tt,IonIcon:Y,BasicForm:Ge,BasicCard:nt,Referrals:Qd,Dashboard:Bd,ANCAppointments:Hd},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:Yt},{id:"referrals",label:"Referrals",icon:ht},{id:"appointments",label:"Appointments",icon:Ee}],activeItem:"dashboard"}},computed:{...me(qe,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),Kd={style:{display:"flex"}},Xd={class:"left_col"},Zd={class:"nav-menu"},ec=["onClick"],tc={class:"right_col"};function nc(e,t,a,s,i,c){const r=_("ion-icon"),u=_("Dashboard"),m=_("ANCAppointments"),f=_("Referrals");return d(),b("div",Kd,[n("div",Xd,[n("nav",Zd,[n("ul",null,[(d(!0),b(K,null,ae(e.menuItems,p=>(d(),b("li",{key:p.id,class:ue({active:e.activeItem===p.id}),onClick:D=>e.setActiveItem(p.id)},[o(r,{icon:p.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,w(p.label),1)],10,ec))),128))])])]),n("div",tc,[n("div",null,[e.activeItem==="dashboard"?(d(),H(u,{key:0})):T("",!0),e.activeItem==="appointments"?(d(),H(m,{key:1})):T("",!0),e.activeItem==="referrals"?(d(),H(f,{key:2})):T("",!0)])])])}const ac=Z(Yd,[["render",nc],["__scopeId","data-v-7e786ea4"]]),sc=Q({name:"Menu",components:{IonContent:pe,IonHeader:ve,IonItem:Re,IonList:Oe,IonMenu:je,IonTitle:We,IonToolbar:Ne,IonCheckbox:tt,BasicForm:Ge,BasicCard:nt},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...me(qe,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),oc={class:"left_col"},ic={class:"nav-menu"},rc=["onClick"];function lc(e,t,a,s,i,c){return d(),b("div",null,[n("div",oc,[n("nav",ic,[n("ul",null,[(d(!0),b(K,null,ae(e.menuItems,r=>(d(),b("li",{key:r.id,class:ue({active:e.activeItem===r.id}),onClick:u=>e.setActiveItem(r.id)},w(r.label),11,rc))),128))])])]),t[0]||(t[0]=n("div",{class:"right_col"},null,-1))])}const dc=Z(sc,[["render",lc],["__scopeId","data-v-32dd02d3"]]),cc=Q({name:"Menu",components:{IonContent:pe,IonHeader:ve,IonItem:Re,IonList:Oe,IonMenu:je,IonTitle:We,IonToolbar:Ne,IonCheckbox:tt,BasicForm:Ge,BasicCard:nt},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...me(qe,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),uc={class:"left_col"},pc={class:"nav-menu"},mc=["onClick"];function fc(e,t,a,s,i,c){return d(),b("div",null,[n("div",uc,[n("nav",pc,[n("ul",null,[(d(!0),b(K,null,ae(e.menuItems,r=>(d(),b("li",{key:r.id,class:ue({active:e.activeItem===r.id}),onClick:u=>e.setActiveItem(r.id)},w(r.label),11,mc))),128))])])]),t[0]||(t[0]=n("div",{class:"right_col"},null,-1))])}const hc=Z(cc,[["render",fc],["__scopeId","data-v-b49d8600"]]);function gc(){const e=He(),t=F(""),a=F(!1),s=F({}),i=()=>{const c=j.getUserRoles(),r=j.getProgramID(),u=j.getProgramName();t.value=c,a.value=!1,c==="Lab"&&r===14?s.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:r===14&&c!=="Lab"?s.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:r===12?s.value={url:"contact",btnName:"Back"}:u==="LABOUR AND DELIVERY PROGRAM"?s.value={url:"labour/labourHome",btnName:"Back to home"}:u==="PNC PROGRAM"?s.value={url:"pnc/home",btnName:"Back to home"}:s.value={url:"",btnName:""},a.value=!0};return ge(()=>e.path,()=>{i()},{immediate:!0,deep:!0}),{userRole:t,ready:a,userRoleSettings:s,updateUserRoleSettings:i}}const zc=Q({__name:"HomePage",setup(e){const t=F(!0),a=He(),s=Ea(),i=F(localStorage.getItem("sessionDate")||"");gc();const c=en(),{apiStatus:r}=Qe(yt()),{activeProgram:u}=Qe(c),m=q(()=>{var g;switch(console.log("ðŸš€ ~ activeDashboard ~ activeProgram:",u.value.program_id),(g=u.value)==null?void 0:g.program_id){case he.IMMUNIZATION_PROGRAM:return cl;case he.OPD_PROGRAM:return yd;case he.NCD_PROGRAM:return pi;case he.AETC_PROGRAM:return Pd;case he.HTS_PROGRAM:return zi;case he.ANC_PROGRAM:return ac;case he.PNC_PROGRAM:return hc;case he.LABOUR_AND_DELIVERY_PROGRAM:return dc;case he.HIV_PROGRAM:return wr;case he.NEONATAL_PROGRAM:return ms;default:return null}}),f=()=>{const g=localStorage.getItem("sessionDate");(!g||g.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),Bt()),i.value=g||""};let p=null;_e(()=>{p=()=>f(),window.addEventListener("storage",p);const g=setInterval(f,1e3);wa(()=>{clearInterval(g),p&&window.removeEventListener("storage",p)}),f()}),ge(i,(g,y)=>{(!g||g.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),Bt())});const D=async()=>{Ve.isEmpty(u.value)&&await za.show(Ja,{},"module-picker-modal")},h=async(g=[])=>{try{t.value=!0,Ha(),await Ua().loadGlobalProperty(),s.postData({command:"ping"});for(const y of g)typeof y=="function"?await y():console.warn("Non-function item found in extraFns array:",y)}catch(y){console.error("Error initializing component:",y)}finally{t.value=!1}};ge(()=>a.name,async g=>{g==="Home"&&await h([D])},{immediate:!0,deep:!0});const v=async()=>{try{const g=j.getUserID(),y=await Wa.getUserByID(g);if(y.location_id!=null){const k=await ja.getLocation(y.location_id);localStorage.setItem("locationData",JSON.stringify(k))}}catch(g){console.error("Failed to retrieve location data:",g)}};return r.value&&(rn(),v()),_e(async()=>{try{await h()}catch(g){console.error("Error initializing component:",g)}finally{t.value=!1}}),(g,y)=>{const k=_("ion-content");return d(),H(C(xe),null,{default:l(()=>[o(sn),o(Ga),m.value?(d(),H(Ca(m.value),{key:0})):(d(),H(k,{key:1},{default:l(()=>[...y[0]||(y[0]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])]),_:1}))]),_:1})}}});export{zc as default};

var Ht=Object.defineProperty;var Bt=(e,t,a)=>t in e?Ht(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var Ke=(e,t,a)=>Bt(e,typeof t!="symbol"?t+"":t,a);import{O as fe,bn as rt,t as Le,aY as he,l as _e,_ as ge,bo as Rt,bp as Mt,b1 as Pe,M,b3 as Qe,ag as de,G as He,S as z,J as Ge,b7 as gt,B as vt,be as $t,o as ze,aS as ie,aI as We,H as x,u as Te,bq as Vt,aC as $e,aB as Ft,aD as xt,b4 as Xe,L as Ut,br as Gt,bs as zt,bt as Wt,bu as qt,bv as Yt,bw as jt,bx as Kt,P as ft,by as Je,bz as Qt,bA as Xt,bB as Jt,bC as Zt,s as en,aH as lt,aJ as tn,aK as nn,aL as an,d as sn,aM as on,g as rn,Z as ln,e as ht,N as dn,aN as Ve,aO as un,aQ as cn,aP as pn,m as _t,V as mn,aT as gn,bD as vn,bE as fn,ar as hn,bF as ce,A as Fe,bG as _n,aR as yn,az as Ze,y as Dn,aA as bn,a as dt}from"../index-DRRMZTZF.js";import{d as ae,aU as te,r as I,a as Ie,H,O as ne,f as _,J as o,l as n,k as f,e as P,F as Se,P as Be,m as G,u as g,w as q,ah as Ee,b4 as Sn,b1 as qe,G as yt,E as Dt,ai as bt,aj as st,_ as Ce,I as St,a3 as it,be as In,aS as Cn,Q as K,c as me,bz as ut,aT as It,bl as et,a4 as ke,a5 as ve,al as An,ak as wn,W as Re,K as Y,bC as On,bv as Ct,Z as En,bp as At,z as Ne,an as wt,cG as Ot,a2 as Et,R as ct,i as xe,v as Ue,b8 as we,L as at,p as Oe,aQ as Ln,aw as Tn,N as pt,bn as Pn,bR as kn,aN as Nn}from"./vendor-BpjEhVym.js";import Lt from"./LabOrdersList-BfJDcoet.js";import{v as Ye}from"./group_validation-B62ONXDk.js";import{u as Hn}from"./RadiologyStore-CUsjVSWV.js";import{B as pe}from"./BasicForm-DdW-I70b.js";import{c as Bn,f as Rn,a as Mn}from"./formatServerData-BzZZpjZl.js";import{D as Tt}from"./DashBox-D1ETjt-9.js";import{p as $n}from"./previousComplaints-D0LcGVx3.js";import{P as Vn}from"./patient_complaints_service-BJD0oXnt.js";import{u as Fn,a as tt,_ as xn,b as Un,d as mt}from"./nonPharmaTherapyStore-jcotUp7G.js";import{u as Gn}from"./usePatientProfile-DP4GYidq.js";import{A as zn}from"./ncd_appointment_service-sNJR4lbL.js";import{D as Wn}from"./DateInputField-D1F_O0SW.js";class Pt extends fe{constructor(){super()}async postActivities(t,a){const l=a.location_id,r=await new rt(parseInt(t),-1,l).createEncounter();if(r){const h=await fe.buildLabOrders(r,a.orders||a);if(!await fe.saveOrdersArray(r.encounter_id,h))return Le("Unable to save lab orders")}}async postAHDActivities(t,a){const l=a.location_id,r=await new rt(parseInt(t),-1,l).createEncounter(he.AHD_LAB_ORDERS);if(r){const h=await fe.buildLabOrders(r,a.orders||a);if(!await fe.saveOrdersArray(r.encounter_id,h))return Le("Unable to save lab orders")}}}const qn=["innerHTML"],Yn={class:"scrollable-container"},jn={key:0,class:"form-section"},Kn={key:1,class:"form-section"},Qn={key:2,class:"form-section"},Xn={key:3,class:"form-section"},Jn={key:4,class:"form-section"},Zn={key:5,class:"form-section"},ea={key:6,class:"form-section"},ta={key:7,class:"form-section"},na=ae({__name:"RadiologyInvestigation",setup(e){const t=Hn(),{head:a,neck:l,chest:d,abdomen:r,upper_extremity:h,spine:s,pelvis:b,lower_extremity:c}=te(t),D=I(_e),C=I([]),T=(S,y,F)=>{document.querySelectorAll("#".concat(S," path")).forEach(v=>{v.classList.toggle("white-fill")}),document.querySelectorAll("#".concat(y," line")).forEach(v=>{v.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(y," rect")).forEach(v=>{v.classList.toggle("bright-green-fill"),v.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(y," path")).forEach(v=>{v.classList.toggle("dark-green-fill")}),document.querySelectorAll("#".concat(y," circle")).forEach(v=>{v.classList.toggle("bright-green-fill")});const W=C.value.findIndex(v=>v.id===F);W>=0?C.value.splice(W,1):C.value.unshift({id:F,active:!0})},U=()=>{const S=document.getElementById("SPINE");S.style.display==="none"||S.style.display==""?S.style.display="block":S.style.display="none",T("SPINE","SPINE_LABEL-2","spine")};return Ie(()=>{const S=document.getElementById("HEAD");S&&S.addEventListener("click",()=>{T("HEAD","LABEL-6","head")});const y=document.getElementById("NECK");y&&y.addEventListener("click",()=>{T("NECK","LABEL-5","neck")});const F=document.getElementById("CHEST");F&&F.addEventListener("click",()=>{T("CHEST","LABEL-4","chest")});const W=document.getElementById("ABDOMEN_LABEL");W&&W.addEventListener("click",()=>{const V=document.getElementById("ABDOMEN-2");V.style.display==="none"||V.style.display==""?V.style.display="block":V.style.display="none",T("ABDOMEN","ABDOMEN_LABEL-2","abdomen")});const v=document.getElementById("UPPER_EXTRMITY");v&&v.addEventListener("click",()=>{T("UPPER_EXTRMITY","LABEL-3","upper_extremity")});const w=document.getElementById("SPINE"),A=document.getElementById("SPINE_LABEL"),p=document.getElementById("LOWER_SPINE_INACTIVE");w&&w.addEventListener("click",()=>{U()}),A&&A.addEventListener("click",()=>{U()}),p&&p.addEventListener("click",()=>{U()});const O=document.getElementById("PELVIS");O&&O.addEventListener("click",()=>{T("PELVIS","LABEL-2","pelvis")});const E=document.getElementById("LOWER_EXTREMITY");E&&E.addEventListener("click",()=>{T("LOWER_EXTREMITY","LABEL","lower_extremity")})}),(S,y)=>{const F=H("ion-col"),W=H("ion-row");return _(),ne(W,null,{default:o(()=>[n(F,{size:"7"},{default:o(()=>[f("div",{innerHTML:D.value.full_body_sk},null,8,qn)]),_:1}),n(F,{size:"5",class:"form-column"},{default:o(()=>[f("div",Yn,[(_(!0),P(Se,null,Be(C.value,v=>(_(),P(Se,null,[v.id==="head"?(_(),P("div",jn,[y[0]||(y[0]=f("h6",null,"Body Part: Head",-1)),n(pe,{contentData:g(a)},null,8,["contentData"])])):v.id==="neck"?(_(),P("div",Kn,[y[1]||(y[1]=f("h6",null,"Body Part: Neck",-1)),n(pe,{contentData:g(l)},null,8,["contentData"])])):v.id==="chest"?(_(),P("div",Qn,[y[2]||(y[2]=f("h6",null,"Body Part: Chest",-1)),n(pe,{contentData:g(d)},null,8,["contentData"])])):v.id==="abdomen"?(_(),P("div",Xn,[y[3]||(y[3]=f("h6",null,"Body Part: Abdomen",-1)),n(pe,{contentData:g(r)},null,8,["contentData"])])):v.id==="upper_extremity"?(_(),P("div",Jn,[y[4]||(y[4]=f("h6",null,"Body Part: Upper Extremity",-1)),n(pe,{contentData:g(h)},null,8,["contentData"])])):v.id==="spine"?(_(),P("div",Zn,[y[5]||(y[5]=f("h6",null,"Body Part: Spine",-1)),n(pe,{contentData:g(s)},null,8,["contentData"])])):v.id==="pelvis"?(_(),P("div",ea,[y[6]||(y[6]=f("h6",null,"Body Part: Pelvis",-1)),n(pe,{contentData:g(b)},null,8,["contentData"])])):v.id==="lower_extremity"?(_(),P("div",ta,[y[7]||(y[7]=f("h6",null,"Body Part: Lower Extremity",-1)),n(pe,{contentData:g(c)},null,8,["contentData"])])):G("",!0)],64))),256))])]),_:1})]),_:1})}}}),kt=ge(na,[["__scopeId","data-v-5ab54fe8"]]),aa={class:"modal_wrapper"},sa={class:"uniform_columns"},ia=ae({__name:"AHDPastMedicalHistory",setup(e,{expose:t}){const a=Rt(),{pastMedicalHistory:l}=te(a),d=I([]);Ie(()=>{d.value=a.getInitial(),r()}),q(l,()=>{r()},{deep:!0});const r=()=>{var D;const c=["TB","Chronic Obstructive Pulmonary Disease (COPD)","Asthma","Epilepsy","Previous stroke","Peptic Ulcer Disease (PUD)","Mental disorder","Bleeding disorders","Hypertension","HIV Positive","Diabetes Mellitus"];(D=Mt(l.value,"None"))!=null&&D.checked?c.forEach(C=>{Pe(l.value,"TB treatment","displayNone",!0),M(l.value,"TB drugs","displayNone",!0),M(l.value,"TB drug start date","displayNone",!0),Pe(l.value,"Hypertension medication","displayNone",!0),M(l.value,"Current hypertension treatment regimen","displayNone",!0),Pe(l.value,"HIV status","displayNone",!0),M(l.value,"ARV start date","displayNone",!0),Pe(l.value,"Diabetes","displayNone",!0),Pe(l.value,"Controlled by","displayNone",!0),Qe(l.value,C,"checked",!1),Qe(l.value,C,"disabled",!0)}):c.forEach(C=>{Qe(l.value,C,"disabled",!1)})},h=c=>{M(l.value,"TB drugs","popOverData",{filterData:!0,data:[{name:"Auramine 'O' (C.I. 41000) 50g"},{name:"Bedaquilline 100mg"},{name:"Clofazimine 100mg"},{name:"Clofazimine 50mg"},{name:"Cycloserine 125mg"},{name:"Cycloserine 250mg"},{name:"Delamanid 50mg"},{name:"Ethambutol 100mg"},{name:"Ethambutol 400mg"},{name:"Ethionamide 250mg"},{name:"Isoniazid 100mg "},{name:"Isoniazid 300mg"},{name:"Isoniazid / Rifapentine 300mg / 300mg"},{name:"Levofloxacin 100mg"},{name:"Levofloxacin 250mg"},{name:"Linezolid 600mg"},{name:"Moxifloxacin 400mg"},{name:"Pyrazinamide 400mg"},{name:"Rifabutin 150mg Capsules"},{name:"Rifampicin 150mg/isoniazid 75mg"},{name:"Rifampicin 75mg+INH 50mg dispersible"},{name:"Rifampicin 75mg+INH 50mg+Pyrazinamide 150mg dispersible"},{name:"Rifampicin150mg/Isoniazid75mg/Pyrazinamide 400mg/Ethambutol"}]}),M(l.value,"Current hypertension treatment regimen","popOverData",{filterData:!0,data:[{name:"Captopril 12.5mg"},{name:"Aspirin 75mg"},{name:"Hydrochlorothiazide 25mg"},{name:"Enalapril Meleate 5mg"},{name:"Enalapril Maleate 10mg"}]})},s=async()=>[...await Bn(l.value),...await Rn(l.value),...await Mn(l.value)];return t({onSubmit:async()=>{const c=await s();if(c.length===0){Le("No past medical history data to save");return}await de.addObsToEncounterPatient(c,he.AHD_PAST_MEDICAL_HISTORY),He("Past medical history saved successful")}}),(c,D)=>(_(),P("div",aa,[f("div",sa,[n(pe,{contentData:g(l),initialData:d.value,"onUpdate:inputValue":h,"onUpdate:selected":h},null,8,["contentData","initialData"])])]))}}),oa=ge(ia,[["__scopeId","data-v-e5153372"]]),ra=ae({data:()=>({userRole:"",ready:!1,userRoleSettings:{}}),watch:{$route:{async handler(e){this.userRole=z.getUserRoles();const t=z.getProgramID(),a=z.getProgramName();this.userRole=="Lab"&&t==14&&(this.userRoleSettings={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}),t==14&&this.userRole!="Lab"&&(this.userRoleSettings={url:"home",btnName:"Go to waiting list",stepperTitle:"Consultation Plan"}),t==12&&(this.userRoleSettings={url:"contact",btnName:"Back"}),a=="LABOUR AND DELIVERY PROGRAM"&&(this.userRoleSettings={url:"labour/labourHome",btnName:"Back to home"}),a=="PNC PROGRAM"&&(this.userRoleSettings={url:"pnc/home",btnName:"Back to home"})},immediate:!0,deep:!0}}}),la=ae({name:"Menu",mixins:[ra],components:{IonContent:it,IonHeader:St,IonItem:Ce,IonList:st,IonMenu:bt,IonTitle:Dt,IonToolbar:yt,IonInput:qe,IonPopover:Sn,DashBox:Tt,SelectionPopover:$t,BasicInputField:vt,BasicForm:pe,List:gt,DynamicButton:Ge,LabOrdersList:Lt,RadiologyInvestigation:kt},data(){return{segmentContent:"Lab Investigations",iconsContent:_e,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",testResult:"",test:"",labOrders:"",filteredSpecimen:"",testData:[],popoverOpen:!1,labOrderStatus:!1,event:"",specimen:"",radiologyOrdersStatus:!1,otherOrdersStatus:!1}},setup(){return{checkmark:Cn,pulseOutline:In}},computed:{...Ee(We,["investigations"]),...Ee(Te,["patient"]),inputFields(){return this.investigations[0].data.rowData[0].colData}},watch:{investigations:{handler(){this.setDashedBox()},deep:!0},patient:{async handler(){var e;(e=this.patient)!=null&&e.labOrders&&(this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved])},deep:!0},$route:{async handler(){await this.getTests()},deep:!0}},async mounted(){await this.getTests(),this.updateInvestigationsStores(),this.setDashedBox(),this.updateInvestigationWizard()},methods:{setSegmentContent(e){this.segmentContent=e},async getTests(){let e;z.getPouchDbStatus()&&z.getLanConnectionStatus()?e=await ze("test_types"):e=await fe.getTestTypes(),M(this.investigations,"test","multiSelectData",e)},toggleLabOrderStatus(){this.labOrderStatus=!this.labOrderStatus},async updateInvestigationWizard(){var t;if(!((t=this.patient)!=null&&t.labOrders))return;this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved];const e=await this.labOrders.filter(a=>x.toStandardHisFormat(x.sessionDate())===x.toStandardHisFormat(a.order_date));e.length>0?this.investigations[0].selectedData=e:this.investigations[0].selectedData=""},async updateInvestigationsStores(){await this.updateInvestigationWizard(),We().setInvestigations(this.investigations)},displayInputFields(){this.testResult="",this.selectedText="",this.no_item=!1,this.addItemButton=!1,this.search_item=!0},async validateRowData(){return Ye(this.investigations)},async checkTest(){return await this.isNameInData(this.inputFields[0].value.name,await this.investigations[0].selectedData)?(M(this.investigations,"test","alertsErrorMassage","Lab order already selected"),!1):(M(this.investigations,"test","alertsErrorMassage",""),!0)},async addNewRow(){Ye(this.investigations)&&await this.checkTest()&&(await this.saveTest(),this.investigations[0].data.rowData[0].colData[0].value="",this.investigations[0].data.rowData[0].colData[1].value="",this.search_item=!1,this.display_item=!0,this.addItemButton=!0),this.updateInvestigationWizard()},isNameInData(e,t){for(let a of t)for(let l of a.tests)if(l.name===e)return!0;return!1},async saveTest(){await new Pt().postAHDActivities(this.patient.patientID,[{concept_id:this.inputFields[0].value.concept_id,name:this.inputFields[0].value.name,specimen:this.inputFields[1].value.name,reason:"Routine",specimenConcept:await ie.getConceptID(this.inputFields[1].value.name,!0)}]),M(this.investigations,"specimen","disabled",!0),this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved]},async handleInputData(e){if(e.inputHeader=="Test"&&this.checkTest(),M(this.investigations,"specimen","alertsErrorMassage",""),e.inputHeader=="Test"&&e.value){let t;z.getPouchDbStatus()&&z.getLanConnectionStatus()?t=await ze("specimens"):t=await fe.getSpecimens("",1e3),this.specimen=await ie.getConceptSet(e.value.name,"",{names:t.map(a=>a.name)}),this.specimen.length==1?(M(this.investigations,"specimen","value",this.specimen[0]),M(this.investigations,"specimen","disabled",!0)):(M(this.investigations,"specimen","value",""),M(this.investigations,"specimen","disabled",!1)),M(this.investigations,"specimen","multiSelectData",this.specimen)}},async filterTest(e){return await this.labOrders.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()))},async filterSpecimen(e){var t;return(t=this.specimen[0])!=null&&t.name&&e?await this.specimen.filter(a=>a==null?void 0:a.name.toLowerCase().includes(e.toLowerCase())):[]},setTest(e){this.selectedText=e.name,this.inputFields[1].inputHeader=="Test"?this.investigations[0].data.rowData[0].colData[0].value=e.name:this.investigations[0].data.rowData[0].colData[1].value=e.name,this.updateInvestigationsStores()},setDashedBox(){(this.inputFields[1].value||this.inputFields[0].value)&&(this.addItemButton=!1,this.search_item=!0,this.no_item=!1),this.investigations[0].selectedData.length>0?(this.display_item=!0,this.no_item=!1):this.search_item||(this.no_item=!0)}}}),da={class:"background"},ua={key:0},ca={key:1},pa={key:2},ma={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},ga={key:3},va={class:"ion-padding",slot:"content"},fa={key:4};function ha(e,t,a,l,d,r){const h=H("ion-label"),s=H("ion-segment-button"),b=H("ion-segment"),c=H("VisitsHistory"),D=H("LabOrdersList"),C=H("RadiologyInvestigation");return _(),P("div",da,[n(b,{value:e.segmentContent,style:{"margin-top":"5px"}},{default:o(()=>[n(s,{value:"Lab Investigations",onClick:t[0]||(t[0]=T=>e.setSegmentContent("Lab Investigations"))},{default:o(()=>[n(h,null,{default:o(()=>[...t[3]||(t[3]=[K("Lab Investigations",-1)])]),_:1})]),_:1}),n(s,{value:"Radiology Investigation",onClick:t[1]||(t[1]=T=>e.setSegmentContent("Radiology Investigation"))},{default:o(()=>[n(h,null,{default:o(()=>[...t[4]||(t[4]=[K("Radiology Investigation",-1)])]),_:1})]),_:1}),n(s,{value:"Other Investigation",onClick:t[2]||(t[2]=T=>e.setSegmentContent("Other Investigation"))},{default:o(()=>[n(h,null,{default:o(()=>[...t[5]||(t[5]=[K("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),e.segmentContent=="Radiology Investigation"?(_(),P("div",ua,[n(c)])):G("",!0),e.segmentContent=="Other Investigation"?(_(),P("div",ca)):G("",!0),e.segmentContent=="Lab Investigations"?(_(),P("div",pa,[f("div",ma,[f("span",null,[n(D,{propOrders:e.labOrders},null,8,["propOrders"])])])])):G("",!0),e.segmentContent=="Radiology Investigation"?(_(),P("div",ga,[f("div",va,[n(C)])])):G("",!0),e.segmentContent=="Other Investigation"?(_(),P("div",fa)):G("",!0)])}const _a=ge(la,[["render",ha],["__scopeId","data-v-67ff1a61"]]),ya={key:0},Da={style:{"align-content":"center"}},ba={class:"ion-padding",slot:"content"},Sa=ae({__name:"AHDPresentingComplaints",setup(e,{expose:t}){const a=Vt(),{presentingComplaints:l}=te(a),d=I(_e),r=I(!0),h=I(!1),s=I(!0),b=I(!1),c=I([]),D=I([]),C=I(),T=me(()=>[{componentType:"multiSelectInputField",header:"Presenting Complaints",name:"PresentingComplaints",trackBy:"concept_id",icon:_e.search,hideSelected:!0,validation:p=>v(p==null?void 0:p.name,c.value)?"Presenting complaint already added":$e.required(p),options:D.value,grid:{s:"6"}},{componentType:"inputField",header:"Duration",name:"duration",icon:_e.time,validation:p=>$e.isNotEmptyandNumber(p),grid:{s:"6"},unitOptions:[{label:"Hours",value:"Hours"},{label:"Days",value:"Days"},{label:"Weeks",value:"Weeks"},{label:"Months",value:"Months"},{label:"Years",value:"Years"}],unitValidation:p=>!p||p===""?"Please select a unit.":null},{componentType:"inputField",header:"Specify the presenting complaint(s)",name:"Other (specify)",icon:_e.editPen,validation:p=>v(p,c.value)?"Presenting complaint already added":$e.required(p),condition:p=>{var O;return((O=p==null?void 0:p.PresentingComplaints)==null?void 0:O.name)==="Other"}},{componentType:"Alert",condition:p=>{var O;return $e.required((O=p==null?void 0:p.PresentingComplaints)==null?void 0:O.name)!=null},backgroundColor:"lightyellow",textColor:"black",value:"Please search thoroughly for the complaint. If it is not listed, search and select the 'Other' option to specify the complaint.",name:"noMatchAlert"}]),{formRef:U}=Ft(),S=async()=>{D.value=await Vn.getComplaintsList("Presenting complaint"),M(l.value,"PresentingComplaints","multiSelectData",D.value)},y=()=>{r.value=!1,s.value=!1,h.value=!0},F=async()=>{var E,V;const p=(E=U.value)==null?void 0:E.getFormValues();((V=U.value)==null?void 0:V.validateForm())==null&&(W(p),h.value=!1,s.value=!0)},W=p=>{var J;const O=p.duration+" "+p.duration_unit,E=p.PresentingComplaints,V=E.name==="Other"?p["Other (specify)"]:E.name;c.value.push({actionBtn:!0,btn:["delete"],name:V,concept_id:E.concept_id,duration:E.duration,durationUnits:E.duration_unit,display:[V,O],data:[{concept_id:8578,value_coded:E.concept_id,obs_datetime:z.getSessionDate(),child:[{concept_id:E.concept_id,value_text:O,obs_datetime:z.getSessionDate()}]}]}),(J=U.value)==null||J.resetForm(),b.value=!0},v=(p,O)=>O.some(E=>E.name===p),w=p=>{c.value=c.value.filter(O=>O.display[0]!==p.name)},A=async()=>{const p=c.value.flatMap(O=>O.data);if(p.length<=0)return Le("Presenting complaints is required");p.length<=0||(await de.addObsToEncounterPatient(p,he.AHD_PRESENTING_COMPLAINTS),He("Presenting complaints saved successful"),c.value=[])};return Ie(async()=>{await S()}),t({onSubmit:A}),(p,O)=>{const E=H("ion-row"),V=H("ion-label"),J=H("ion-accordion"),ye=H("ion-accordion-group");return _(),P(Se,null,[n(Tt,{status:r.value,content:"No presenting complaints added"},null,8,["status"]),b.value?(_(),P("span",ya,[n(gt,{listData:c.value,"onClicked:delete":w},null,8,["listData"])])):G("",!0),h.value?(_(),ne(E,{key:1},{default:o(()=>[n(xt,{formData:T.value,ref_key:"formRef",ref:U},null,8,["formData"]),f("div",Da,[n(Ge,{fill:"clear",icon:d.value.plus,iconSlot:"icon-only","onClicked:btn":O[0]||(O[0]=i=>F()),name:"Save"},null,8,["icon"])])]),_:1})):G("",!0),s.value?(_(),ne(E,{key:2,style:{"margin-top":"10px"}},{default:o(()=>[n(Ge,{fill:"clear",icon:d.value.plus,iconSlot:"icon-only","onClicked:btn":O[1]||(O[1]=i=>y()),name:"Add new presenting complaints"},null,8,["icon"])]),_:1})):G("",!0),n(E,null,{default:o(()=>[n(ye,{ref_key:"accordionGroup",ref:C,class:"previousView"},{default:o(()=>[n(J,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:o(()=>[n(g(Ce),{slot:"header",color:"light"},{default:o(()=>[n(V,{class:"previousLabel"},{default:o(()=>[...O[2]||(O[2]=[K("Previous presenting complaints",-1)])]),_:1})]),_:1}),f("div",ba,[n($n)])]),_:1})]),_:1},512)]),_:1})],64)}}}),Ia=ge(Sa,[["__scopeId","data-v-04755951"]]);class nt extends Xe{constructor(a,l,d){super(a,he.AHD_HIV_STAGING,d);Ke(this,"age");Ke(this,"confirmatoryTest");this.age=l,this.confirmatoryTest=null}isAdult(){return this.age>=15}isPedaid(){return this.age<=14}setAge(a){this.age=a}getFacilities(a=""){return Ut.getFacilities({name:a})}getConfirmatoryTestType(){return this.confirmatoryTest}cd4CountIsValid(a){try{return!!a.match(/^(=|<|>)([0-9]*)$/m)}catch(l){return!1}}getAlertGuidelines(){return Gt}getWhoStageGuidelines(){return this.isAdult()?zt:Wt}getProgramEligibilityGuidelines(){return this.isAdult()?qt:Yt}getRecommendedConditionGuidelines(){return this.isAdult()?jt:Kt}getStagingConditions(a){const l=this.getStagingCategoryByNum(a);return Xe.getConceptsByCategory(l)}buildWhoStageObs(a){return this.buildValueCoded("Who stage",a)}buildWhoCriteriaObs(a){return this.buildValueCoded("Who stages criteria present",a)}buildReasonForArtObs(a){return this.buildValueCoded("Reason for ART eligibility",a)}getStagingCategoryByNum(a){switch(a){case 1:return this.isAdult()?"stage_1_conditions_adults":"stage_1_conditions_pedaids";case 2:return this.isAdult()?"stage_2_conditions_adults":"stage_2_conditions_pedaids";case 3:return this.isAdult()?"stage_3_conditions_adults":"stage_3_conditions_pedaids";case 4:return this.isAdult()?"stage_4_conditions_adults":"stage_4_conditions_pedaids";default:return""}}async loadHivConfirmatoryTestType(){const a=await Xe.getFirstValueCoded(this.patientID,"Confirmatory hiv test type");a&&(this.confirmatoryTest=a)}}const Ca={key:0,class:"ion-padding"},Aa={class:"accordion_group ion-padding"},wa={style:{"font-weight":"bold"}},Oa={class:"error"},Ea={class:"ion-padding",slot:"content"},La={class:"ion-padding"},Ta={class:"ion-padding"},Pa={key:0,class:"ion-padding"},ka={class:"ion-padding",style:{"border-bottom":"dashed #ccc"}},Na=ae({__name:"AHDStaging",props:{hideSubmit:{type:Boolean,default:!1},date:{default:nt.getSessionDate()}},setup(e,{expose:t}){const a=e,l=new ft,d=I({}),r=new nt(l.getID(),l.getAge(),-1);q(()=>a.date,i=>{var $;const u=($=i==null?void 0:i.standardDate)!=null?$:nt.getSessionDate(),m=Ne(u).diff(l.getBirthdate(),"years");r.setAge(m),r.setDate(u)},{deep:!0,immediate:!0});const h=ut({stage_4_conditions:{title:"Stage 4 Conditions",options:[]},stage_3_conditions:{title:"Stage 3 Conditions",options:[]},stage_2_conditions:{title:"Stage 2 Conditions",options:[]},stage_1_conditions:{title:"Stage 1 Conditions",options:[]}}),s=ut({cd4:"",cd4Date:"",isChildBearing:!1,reasonForArt:"",pregnant:"",breastFeeding:"",cd4Available:"",cd4Modifier:"",cd4Location:"",whoStage:"",staging:[],confirmatoryTest:""}),b={reasonForArt:{buildObs:()=>r.buildReasonForArtObs(s.reasonForArt),suggestAvalue:()=>({"PRESUMED SEVERE HIV":{priority:1,condition:()=>l.getAgeInMonths()<12&&s.confirmatoryTest==="HIV rapid test"&&ie.getConceptsByCategory("pshd_condition").some(i=>W().includes(i.name))},"WHO STAGE IV PEDS":{priority:2,condition:()=>r.isPedaid()&&D(["stage_4_conditions"])},"WHO STAGE III PEDS":{priority:3,condition:()=>r.isPedaid()&&D(["stage_3_conditions"])},"HIV DNA polymerase chain reaction":{priority:4,condition:()=>l.getAgeInMonths()<12&&s.confirmatoryTest==="HIV DNA polymerase chain reaction"},"CD4 COUNT LESS THAN OR EQUAL TO 750":{priority:5,condition:()=>y(750)&&F()&&C()&&l.ageInMonths()>=24&&l.ageInMonths()<=56},"CD4 COUNT LESS THAN OR EQUAL TO 500":{priority:6,condition:()=>r.isPedaid()&&y(500)&&F()&&C()},"HIV infected":{priority:7,condition:()=>l.getAgeInMonths()<24||l.getAge()<=5},"WHO STAGE IV ADULT":{priority:1,condition:()=>{const i=ie.getConceptsByCategory("severe_hiv_wasting_syndrome");return r.isAdult()&&(D(["stage_4_conditions"])||i.filter(u=>W().includes(u.name)).length>=2)}},"WHO STAGE III ADULT":{priority:2,condition:()=>r.isAdult()&&D(["stage_3_conditions"])},"cd4 less than or equal to 350":{priority:3,condition:()=>r.isAdult()&&y(350)&&C()},"cd4 less than or equal to 250":{priority:4,condition:()=>r.isAdult()&&y(250)&&C()},"cd4 less than or equal to 500":{priority:4,condition:()=>r.isAdult()&&y(500)&&C()},BREASTFEEDING:{priority:5,condition:()=>r.isAdult()&&s.breastFeeding==="Yes"&&F()},"PATIENT PREGNANT":{priority:6,condition:()=>r.isAdult()&&s.pregnant==="Yes"&&F()},Asymptomatic:{priority:7,condition:()=>F()}})},whoStage:{buildObs:()=>r.buildWhoStageObs(s.whoStage),suggestAvalue:()=>({"WHO STAGE IV ADULT":{priority:1,condition:()=>r.isAdult()&&D(["stage_4_conditions"])},"WHO STAGE III ADULT":{priority:2,condition:()=>r.isAdult()&&D(["stage_3_conditions"])},"WHO STAGE II ADULT":{priority:3,condition:()=>r.isAdult()&&D(["stage_2_conditions"])},"WHO STAGE I ADULT":{priority:4,condition:()=>r.isAdult()&&D(["stage_1_conditions"])},"WHO STAGE IV PEDS":{priority:1,condition:()=>r.isPedaid()&&(D(["stage_4_conditions"])||s.reasonForArt==="WHO STAGE IV PEDS")},"WHO STAGE III PEDS":{priority:2,condition:()=>r.isPedaid()&&D(["stage_3_conditions"])},"WHO STAGE II PEDS":{priority:3,condition:()=>r.isPedaid()&&D(["stage_2_conditions"])},"WHO STAGE I PEDS":{priority:4,condition:()=>r.isPedaid()&&D(["stage_1_conditions"])}})},cd4Available:{required:()=>!0,dataHandler:i=>{i!="Yes"&&(s.cd4="",s.cd4Date=""),d.value.cd4="",d.value.cd4Modifier="",d.value.cd4Date="",d.value.cd4Location=""}},pregnant:{required:()=>s.isChildBearing,buildObs:()=>r.buildValueCoded("Is patient pregnant?",s.pregnant)},breastFeeding:{required:()=>s.isChildBearing,buildObs:()=>r.buildValueCoded("Is patient breast feeding?",s.breastFeeding)},cd4:{required:()=>s.cd4Available==="Yes",validation:()=>{if(!S()){d.value.cd4="A number is required";return}U()>1e4&&(d.value.cd4="CD4 value cannot exceed 10,000")},buildObs:()=>r.buildValueNumber("CD4 count",U(),T())},cd4Modifier:{required:()=>s.cd4Available==="Yes",validation:()=>{s.cd4Modifier||(d.value.cd4Modifier="Please select modifier")},dataHandler:i=>s.cd4Modifier=i,options:[{label:"=",value:"="},{label:">",value:">"},{label:"<",value:"<"}]},cd4Date:{required:()=>s.cd4Available==="Yes",dataHandler:i=>{i&&(s.cd4Date=Ne(i).format("YYYY-MM-DD"))},validation:()=>{if(isNaN(new Date(s.cd4Date).getTime())){d.value.cd4Date="Invalid CD4 date";return}const i=Ne(s.cd4Date);if(i.isAfter(Ne(r.getDate()))){d.value.cd4Date="Cd4 result date can't be greater than ".concat(r.getDate());return}i.isBefore(Ne(l.getBirthdate()))&&(d.value.cd4Date="CD4 date must not be earlier than birthdate")},buildObs:()=>r.buildValueDate("Cd4 count datetime",s.cd4Date)},cd4Location:{required:()=>s.cd4Available==="Yes",dataHandler:i=>s.cd4Location=i,buildObs:()=>r.buildValueText("Cd4 count location",s.cd4Location)},staging:{validation:()=>{if(Object.keys(h).every($=>p($)<=0)){d.value.staging="Please select one or more staging conditions";return}const u=["stage_4_conditions","stage_3_conditions","stage_2_conditions"].some($=>p($)>0);h.stage_1_conditions.options.some($=>/asymptomatic/i.test($.name)&&$.checked)&&u&&(d.value.staging="Asymptomatic cannot be selected with other staging conditions")},buildObs:()=>Object.keys(h).reduce((u,m)=>(h[m].options.forEach($=>{$.checked&&u.push($.name)}),u),[]).map(u=>r.buildWhoCriteriaObs(u))}};function c(){Object.keys(s).forEach(i=>{typeof s[i]=="boolean"?s[i]=!1:Array.isArray(s[i])?s[i]=[]:s[i]=""}),Object.keys(d.value).forEach(i=>d.value[i]=""),V()}function D(i){return i.some(u=>p(u)>0)}function C(){return new Date(s.cd4Date)<=new Date("2016-04-30")}function T(){return s.cd4Modifier}function U(){return parseInt("".concat(s.cd4))}function S(){return/^\d+$/i.test("".concat(s.cd4))}function y(i){if(!S())return!1;const u=T(),m=U();return u==="="&&i===m||u==="<"&&m<=i||u===">"&&m>=i}function F(){return D(["stage_2_conditions","stage_1_conditions"])}function W(){return Object.keys(h).reduce((i,u)=>(h[u].options.forEach(m=>m.checked&&i.push(m.name)),i),[])}function v(i){if(d.value[i]="",typeof b[i].required=="function"&&b[i].required()&&!s[i]){d.value[i]="This field is required";return}s[i]&&typeof b[i].validation=="function"&&b[i].validation()}function w(i){var u,m,$;if(b[i]&&"suggestAvalue"in b[i]){s[i]="";const Q=b[i].suggestAvalue(),se=Object.keys(Q).reduce((Z,R)=>{const De=Q[R];return typeof De.condition=="function"&&De.condition()?[...Z,{value:R,priority:De.priority}]:Z},[]);s[i]=($=(m=(u=se.sort((Z,R)=>Z.priority-R.priority))==null?void 0:u[0])==null?void 0:m.value)!=null?$:""}}function A(){return Object.keys(s).reduce((i,u)=>{if(u in b&&s[u]&&typeof b[u].buildObs=="function"){const m=b[u].buildObs();return Array.isArray(m)?[...i,...m]:[...i,m]}return i},[])}function p(i){return h[i].options.filter(u=>u.checked).length}async function O(){await r.loadHivConfirmatoryTestType(),s.confirmatoryTest=r.getConfirmatoryTestType(),s.isChildBearing=l.isChildBearing()}function E(i,u){i in b&&typeof b[i].dataHandler=="function"&&b[i].dataHandler(u),v(i),Object.keys(b).forEach(m=>w(m))}function V(){Object.keys(h).forEach(i=>{var $,Q;const u=Number((Q=($=i.match(/\d+/))==null?void 0:$[0])!=null?Q:0),m=r.getStagingConditions(u);h[i].options=m.map(se=>({checked:!1,name:se.name,concept_id:se.concept_id}))})}function J(){return Object.keys(b).forEach(i=>v(i)),Object.keys(d.value).every(i=>"".concat(d.value[i]).length<=0)}async function ye(){if(console.log("Submitting staging"),!J())return Le("Please review form for errors"),!1;try{const i=await Promise.all(A());return await r.createEncounter(),await r.saveObservationList(i),He("Staging Observations saved!"),!0}catch(i){return console.error(i),en("Error has occured while saving observations"),!1}}return q(()=>a.date,i=>{r.setDate(i),l.date=i,c()}),Ie(async()=>{await O(),V()}),t({validateStagingForm:J,buildPayload:A,onSubmit:ye}),(i,u)=>(_(),ne(g(At),null,{default:o(()=>[n(g(It),null,{default:o(()=>[s.isChildBearing?(_(),P("div",Ca,[n(g(et),null,{default:o(()=>[n(g(ke),null,{default:o(()=>[n(g(ve),null,{default:o(()=>[n(Je,{label:"Pregnant?",modelValue:s.pregnant,"onUpdate:modelValue":u[0]||(u[0]=m=>s.pregnant=m),onIonChange:u[1]||(u[1]=m=>E("pregnant",m)),"error-message":d.value.pregnant},null,8,["modelValue","error-message"])]),_:1}),n(g(ve),null,{default:o(()=>[n(Je,{label:"Breastfeeding?",modelValue:s.breastFeeding,"onUpdate:modelValue":u[2]||(u[2]=m=>s.breastFeeding=m),onOnChange:u[3]||(u[3]=m=>E("breastFeeding",m)),"error-message":d.value.breastFeeding},null,8,["modelValue","error-message"])]),_:1})]),_:1})]),_:1})])):G("",!0),f("div",Aa,[n(g(An),{color:"light"},{default:o(()=>[(_(!0),P(Se,null,Be(h,(m,$)=>(_(),ne(g(wn),{key:$},{default:o(()=>[n(g(Ce),{color:"light",slot:"header"},{default:o(()=>[n(g(Re),{style:{color:"grey","font-size":"17px"},class:"ion-padding"},{default:o(()=>[f("b",wa,[K(Y(m.title)+" ",1),n(g(On),{color:p("".concat($))>0?"primary":void 0},{default:o(()=>[K(" Selected: "+Y(p("".concat($))),1)]),_:2},1032,["color"])]),f("p",Oa,Y(d.value.staging),1)]),_:2},1024)]),_:2},1024),f("div",Ea,[n(g(st),null,{default:o(()=>[(_(!0),P(Se,null,Be(m.options,(Q,se)=>(_(),ne(g(Ce),{key:se},{default:o(()=>[n(g(Ct),{modelValue:Q.checked,"onUpdate:modelValue":Z=>Q.checked=Z,onIonChange:Z=>E("staging",{stage_type:$,raw:Z,option:Q})},null,8,["modelValue","onUpdate:modelValue","onIonChange"]),n(g(Re),{style:{margin:"13px"}},{default:o(()=>[K(Y(Q.name),1)]),_:2},1024),u[15]||(u[15]=f("p",null,null,-1)),Q.description?(_(),ne(g(En),{key:0,color:Q.color},{default:o(()=>[K(Y(Q.text),1)]),_:2},1032,["color"])):G("",!0)]),_:2},1024))),128))]),_:2},1024)])]),_:2},1024))),128))]),_:1})]),f("div",La,[f("div",Ta,[n(Je,{label:"Recent CD4 count results available?",modelValue:s.cd4Available,"onUpdate:modelValue":u[4]||(u[4]=m=>s.cd4Available=m),onOnChange:u[5]||(u[5]=m=>E("cd4Available",m)),"error-message":d.value.cd4Available},null,8,["modelValue","error-message"])]),s.cd4Available==="Yes"?(_(),P("div",Pa,[n(g(et),{class:"ion-padding"},{default:o(()=>[n(g(ke),null,{default:o(()=>[n(g(ve),null,{default:o(()=>[n(Qt,{label:"CD4 Count Date",modelValue:s.cd4Date,"onUpdate:modelValue":u[6]||(u[6]=m=>s.cd4Date=m),required:s.cd4Available==="Yes","error-message":d.value.cd4Date,onOnChange:u[7]||(u[7]=m=>E("cd4Date",m))},null,8,["modelValue","required","error-message"])]),_:1})]),_:1}),n(g(ke),null,{default:o(()=>[n(g(ve),{size:"2"},{default:o(()=>[n(Xt,{label:"CD4 Result Modifier",required:s.cd4Available==="Yes","error-message":d.value.cd4Modifier,options:b.cd4Modifier.options,onOnChange:u[8]||(u[8]=m=>E("cd4Modifier",m.value))},null,8,["required","error-message","options"])]),_:1}),n(g(ve),{size:"10"},{default:o(()=>[n(Jt,{label:"CD4 Count",modelValue:s.cd4,"onUpdate:modelValue":u[9]||(u[9]=m=>s.cd4=m),type:"number",onOnChange:u[10]||(u[10]=m=>E("cd4",m)),placeholder:"Enter CD4 Count","error-message":d.value.cd4},null,8,["modelValue","error-message"])]),_:1})]),_:1}),n(g(ke),{style:{"margin-top":"15px"}},{default:o(()=>[n(g(ve),null,{default:o(()=>[n(Zt,{label:"CD4 Count Location",modelValue:s.cd4Location,"onUpdate:modelValue":u[11]||(u[11]=m=>s.cd4Location=m),required:s.cd4Available==="Yes","error-message":d.value.cd4Location,show_error:!1,selected_district_ids:[],selected_location:s.cd4Location,onOnChange:u[12]||(u[12]=m=>{E("cd4Location",m)})},null,8,["modelValue","required","error-message","selected_location"])]),_:1})]),_:1})]),_:1})])):G("",!0)]),f("div",ka,[n(g(et),null,{default:o(()=>[n(g(ke),null,{default:o(()=>[n(g(ve),null,{default:o(()=>[n(g(qe),{readonly:"",placeholder:"N/A",label:"REASON FOR ART:",modelValue:s.reasonForArt,"onUpdate:modelValue":u[13]||(u[13]=m=>s.reasonForArt=m)},null,8,["modelValue"])]),_:1}),n(g(ve),null,{default:o(()=>[n(g(qe),{readonly:"",placeholder:"N/A",label:"WHO STAGE:",modelValue:s.whoStage,"onUpdate:modelValue":u[14]||(u[14]=m=>s.whoStage=m)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),Ha=ge(Na,[["__scopeId","data-v-1fe6c93a"]]),Ba={style:{display:"flex","align-items":"center"}},Ra={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},Ma=ae({__name:"AHDWorkflow",props:{closeModalOnFinish:{type:Boolean,default:!1}},setup(e,{expose:t}){const a=e,{onTabBeforeChange:l,currentTabIndex:d}=Fn();Gn();const r=wt(),h=Ot();I([]),I([]),I(!1);const s=I(!0),b=I(!1),c=I(!1),D=me(()=>({text:c.value?"Saving...":"Finish",icon:c.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:b.value||c.value})),C=lt(),T=Te(),U=We(),S=tn();nn();const y=an(),F=sn();on();const W=rn(),v=tt(),w=ln(),{patient:A}=te(T),{vitals:p}=te(C),{investigations:O}=te(U),{diagnosis:E}=te(S),{substance:V}=te(W),{selectedNCDMedicationList:J}=te(y),{FootScreening:ye,visualScreening:i,cvScreening:u}=te(v),{sessionDate:m}=te(w),{apiStatus:$}=te(ht());q(D,(L,B)=>{console.log("Done button options changed:",{from:B,to:L,currentStep:d.value,tabsLength:R.value.length}),L.disabled!==(B==null?void 0:B.disabled)&&console.log("Done button ".concat(L.disabled?"disabled":"enabled")),L.text!==(B==null?void 0:B.text)&&console.log('Done button text changed from "'.concat(B==null?void 0:B.text,'" to "').concat(L.text,'"'))},{deep:!0}),q(c,(L,B)=>{L!==B&&(console.log("Saving state changed: ".concat(B," -> ").concat(L)),console.log(L?"Starting save process...":"Save process completed"))});const Q=L=>{console.log("Done button change received from wizard:",L),L.newOptions.disabled&&console.log("Done button has been disabled"),L.isLastStep&&console.log("User is on the last step, done button should be visible")},se=()=>{let L=!1;return k(),c.value&&(L=!0),b.value=L,!L},Z=()=>[{title:"Presenting Complaints",icon:""},{title:"Past Medical History",icon:""},{title:"WHO",icon:""},{title:"Investigation",icon:""}],R=I(Z()),De=I(null),N=I(null),k=()=>{var ee;if(!R.value||R.value.length===0)return console.log("Tabs not yet initialized"),null;const L=d.value>=0&&d.value<R.value.length?d.value:0;switch((ee=R.value[L])==null?void 0:ee.title){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation";default:if(F.NCDActivities.length>0)switch(F.NCDActivities[0]){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation"}return null}},X=()=>{s.value=!1,setTimeout(()=>{d.value=0,s.value=!0},0)},be=()=>{const L=lt();L.setVitals(L.getInitialVitals(A.value.ID))},oe=async()=>{var ee,ue;const L=dn(m.value,"sessionDate","value")||x.sessionDate(),B=Ve("vitals");for(let j=0;j<R.value.length;j++){const re=R.value[j];if(re.title==="Vital Signs")R.value[j].icon=Ae(L,B)?we:"";else if(re.title==="Risk Assessment"){const le=Ve("substanceAbuse");R.value[j].icon=Ae(L,le)?we:""}else if(re.title==="Investigations"){const le=(ue=(ee=A==null?void 0:A.value)==null?void 0:ee.labOrders)==null?void 0:ue.saved,je=le==null?void 0:le.filter(Nt=>x.toStandardHisFormat(L)===x.toStandardHisFormat(Nt.order_date));R.value[j].icon=(je==null?void 0:je.length)>0?we:""}else if(re.title==="Diagnosis"){const le=Ve("diagnosis");R.value[j].icon=Ae(L,le)?we:""}else if(re.title==="Complications Screening"){const le=Ve("screening");R.value[j].icon=Ae(L,le)?we:""}else re.title==="Treatment Plan"&&(J.value.length>0?R.value[j].icon=un()?we:"":R.value[j].icon="")}se()},Ae=(L,B)=>{const ee=new Date(L);return ee.setHours(0,0,0,0),B.some(ue=>{const j=new Date(ue.obs_datetime);return j.setHours(0,0,0,0),j.getTime()===ee.getTime()})},Me=async(L,B)=>{var ue,j,re;const ee=(ue=R.value[B])==null?void 0:ue.title;L%1===0&&(d.value=L),ee=="Vital Signs"&&((j=De.value)==null||j.onSubmit()),ee=="Risk Assessment"&&((re=N.value)==null||re.onSubmit())},ot=async()=>{c.value=!0;try{await cn(),await pn(A.value),a.closeModalOnFinish?(await ct.dismiss(),He("All data saved successfully")):(He("All data saved successfully"),r.push("/triageList"))}catch(L){console.error("Error saving data:",L),Le("Error occurred while saving data. Please try again.")}finally{c.value=!1}};return Ie(async()=>{if(F.NCDActivities.length===0){r.push("patientProfile");return}tt().resetScreening(),R.value=Z(),await oe(),(d.value===void 0||d.value<0)&&(d.value=0,console.log("Setting initial tab index to 0")),b.value=!1,c.value=!1,se()}),q(d,async()=>{await se()}),q(p,async()=>{await oe()},{deep:!0}),q(A,async()=>{tt().resetScreening(),await oe()},{deep:!0}),q(m,async()=>{await oe()},{deep:!0}),q(O,async()=>{await oe()},{deep:!0}),q(E,async()=>{await oe()},{deep:!0}),q(V,async()=>{await oe()},{deep:!0}),q(J,async()=>{await oe()},{deep:!0}),q(h,async L=>{X(),be(),R.value=Z()},{deep:!0}),q(A,async(L,B)=>{L.ID!=B.ID&&(X(),be())},{deep:!0}),t({saveData:ot,markWizard:oe,refreshWizard:X,validateDoneButtonState:se}),(L,B)=>{const ee=H("ion-icon"),ue=H("ion-title"),j=H("ion-toolbar"),re=H("ion-header");return _(),P(Se,null,[n(re,null,{default:o(()=>[n(j,{class:"modal-title"},{default:o(()=>[n(ue,null,{default:o(()=>[f("div",Ba,[n(ee,{icon:g(_e).demographics,class:"sub-menu-icon",style:{"font-size":"1.4rem"}},null,8,["icon"]),B[2]||(B[2]=f("b",{style:{"margin-left":"6px"}},"Advance HIV Disease",-1))])]),_:1}),n(ee,{slot:"end",onClick:B[0]||(B[0]=le=>g(ct).dismiss()),style:{"font-size":"30px","padding-right":"10px"},icon:g(Et)},null,8,["icon"])]),_:1})]),_:1}),n(g(it),{class:"ion-padding"},{default:o(()=>[f("div",Ra,[s.value?(_(),ne(xn,{key:0,ref:"wizard",headingTitle:"AHD Screening","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:D.value,"custom-tabs":R.value,beforeChange:g(l),onChange:Me,"onComplete:wizard":B[1]||(B[1]=le=>ot()),onDoneButtonChanged:Q},{default:o(()=>[xe(f("div",null,[n(Ia,{ref:"observationsRef"},null,512)],512),[[Ue,k()=="Presenting Complaints"]]),xe(f("div",null,[n(oa,{ref:"interventionsRef"},null,512)],512),[[Ue,k()=="Past Medical History"]]),xe(f("div",null,[n(Ha,{ref:"medicationsRef"},null,512)],512),[[Ue,k()=="WHO"]]),xe(f("div",null,[n(_a,{ref:"medicationsRef"},null,512)],512),[[Ue,k()=="Investigation"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):G("",!0)])]),_:1})],64)}}}),$a=async()=>{const e=await de.getObsByEncounterIdAndDate(he.PRESENTING_COMPLAINTS),t=await de.getObsByEncounterId(he.HIV_CLINIC_REGISTRATION),a=await de.getObsByEncounterId(he.PAST_MEDICAL_HISTORY),l=await de.getObsByEncounterId(he.HIV_STATUS_AT_ENROLLMENT),d=await de.getObsByEncounterId(he.PATIENT_OUTCOME),r=await ie.getConceptID("Cough"),h=await ie.getConceptID("Yes"),s=await ie.getConceptID("Reactive"),b=await ie.getConceptID("New Positive"),c=await ie.getConceptID("HIV status"),D=await ie.getConceptID("Presenting complaint"),C=de.isValueCodedAvailable(e,[r],D),T=de.isValueCodedAvailable(a,[h],c),U=de.isValueCodedAvailable(l,[s],c),S=de.isValueCodedAvailable(d,[h],b);return C||T||S||U||t.length>0},Va={class:"background"},Fa={key:0},xa={key:1},Ua={key:2},Ga={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},za={key:3},Wa={class:"ion-padding",slot:"content"},qa={key:4},Ya=ae({__name:"Investigations",setup(e,{expose:t}){const a=I("Lab Investigations"),l=I(!1),d=I(!1),r=I(!1),h=I(!0),s=I(""),b=I("");I("");const c=I("");I(""),I([]),I(!1);const D=I(!1);I("");const C=I("");I(!1),I(!1);const T=We(),U=Te(),{investigations:S}=te(T),{patient:y}=te(U),F=Ot(),W=wt(),v=me(()=>S.value[0].data.rowData[0].colData),w=N=>{a.value=N},A=async()=>{let N;z.getPouchDbStatus()&&z.getLanConnectionStatus()?N=await ze("test_types"):N=await fe.getTestTypes(),M(S.value,"test","multiSelectData",N)},p=()=>{D.value=!D.value},O=async()=>{var k;if(!((k=y.value)!=null&&k.labOrders))return;c.value=[...y.value.labOrders.saved,...y.value.labOrders.unsaved];const N=await c.value.filter(X=>x.toStandardHisFormat(x.sessionDate())===x.toStandardHisFormat(X.order_date));N.length>0?S.value[0].selectedData=N:S.value[0].selectedData=""},E=async()=>{await O(),T.setInvestigations(S.value)},V=()=>{b.value="",s.value="",l.value=!1,h.value=!1,d.value=!0},J=async()=>Ye(S.value),ye=async()=>await u(v.value[0].value.name,await S.value[0].selectedData)?(M(S.value,"test","alertsErrorMassage","Lab order already selected"),!1):(M(S.value,"test","alertsErrorMassage",""),!0),i=async()=>{Ye(S.value)&&await ye()&&(await m(),S.value[0].data.rowData[0].colData[0].value="",S.value[0].data.rowData[0].colData[1].value="",d.value=!1,r.value=!0,h.value=!0),O()},u=(N,k)=>{for(let X of k)for(let be of X.tests)if(be.name===N)return!0;return!1},m=async()=>{await new Pt().postActivities(y.value.patientID,[{concept_id:v.value[0].value.concept_id,name:v.value[0].value.name,specimen:v.value[1].value.name,reason:"Routine",specimenConcept:await ie.getConceptID(v.value[1].value.name,!0)}]),M(S.value,"specimen","disabled",!0),c.value=[...y.value.labOrders.saved,...y.value.labOrders.unsaved]},$=async N=>{if(N.inputHeader=="Test"&&ye(),M(S.value,"specimen","alertsErrorMassage",""),N.inputHeader=="Test"&&N.value){let k;z.getPouchDbStatus()&&z.getLanConnectionStatus()?k=await ze("specimens"):k=await fe.getSpecimens("",1e3),C.value=await ie.getConceptSet(N.value.name,"",{names:k.map(X=>X.name)}),C.value.length==1?(M(S.value,"specimen","value",C.value[0]),M(S.value,"specimen","disabled",!0)):(M(S.value,"specimen","value",""),M(S.value,"specimen","disabled",!1)),M(S.value,"specimen","multiSelectData",C.value)}},Q=async N=>await c.value.filter(k=>k.name.toLowerCase().includes(N.toLowerCase())),se=async N=>{var k;return(k=C.value[0])!=null&&k.name&&N?await C.value.filter(X=>X==null?void 0:X.name.toLowerCase().includes(N.toLowerCase())):[]},Z=N=>{s.value=N.name,v.value[1].inputHeader=="Test"?S.value[0].data.rowData[0].colData[0].value=N.name:S.value[0].data.rowData[0].colData[1].value=N.name,E()},R=()=>{(v.value[1].value||v.value[0].value)&&(h.value=!1,d.value=!0,l.value=!1),S.value[0].selectedData.length>0?(r.value=!0,l.value=!1):d.value||(l.value=!0)},De=async()=>{await $a()&&W.currentRoute.value.name=="OPDConsultationPlan"&&await _t(Ma,{class:"fullScreenModal"})};return q(S,()=>{R()},{deep:!0}),q(y,async()=>{var N,k;console.log("ðŸš€ ~ patient.value?.labOrders:pppp",(N=y.value)==null?void 0:N.labOrders),await De(),(k=y.value)!=null&&k.labOrders&&(c.value=[...y.value.labOrders.saved,...y.value.labOrders.unsaved])},{deep:!0}),q(F,async()=>{await A()},{deep:!0}),Ie(async()=>{await A(),E(),R(),O()}),t({openAHDModal:De,setSegmentContent:w,getTests:A,toggleLabOrderStatus:p,updateInvestigationWizard:O,updateInvestigationsStores:E,displayInputFields:V,validateRowData:J,checkTest:ye,addNewRow:i,isNameInData:u,saveTest:m,handleInputData:$,filterTest:Q,filterSpecimen:se,setTest:Z,setDashedBox:R}),(N,k)=>{const X=H("ion-label"),be=H("ion-segment-button"),oe=H("ion-segment"),Ae=H("VisitsHistory");return _(),P("div",Va,[n(oe,{value:a.value,style:{"margin-top":"5px"}},{default:o(()=>[n(be,{value:"Lab Investigations",onClick:k[0]||(k[0]=Me=>w("Lab Investigations"))},{default:o(()=>[n(X,null,{default:o(()=>[...k[3]||(k[3]=[K("Lab Investigations",-1)])]),_:1})]),_:1}),n(be,{value:"Radiology Investigation",onClick:k[1]||(k[1]=Me=>w("Radiology Investigation"))},{default:o(()=>[n(X,null,{default:o(()=>[...k[4]||(k[4]=[K("Radiology Investigation",-1)])]),_:1})]),_:1}),n(be,{value:"Other Investigation",onClick:k[2]||(k[2]=Me=>w("Other Investigation"))},{default:o(()=>[n(X,null,{default:o(()=>[...k[5]||(k[5]=[K("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),a.value=="Radiology Investigation"?(_(),P("div",Fa,[n(Ae)])):G("",!0),a.value=="Other Investigation"?(_(),P("div",xa)):G("",!0),a.value=="Lab Investigations"?(_(),P("div",Ua,[f("div",Ga,[f("span",null,[n(Lt,{propOrders:c.value},null,8,["propOrders"])])])])):G("",!0),a.value=="Radiology Investigation"?(_(),P("div",za,[f("div",Wa,[n(kt)])])):G("",!0),a.value=="Other Investigation"?(_(),P("div",qa)):G("",!0)])}}}),ks=ge(Ya,[["__scopeId","data-v-36ed3f82"]]),ja=ae({created(){},components:{IonItem:Ce,IonCol:ve,IonLabel:Re,IonIcon:at},data(){return{iconsContent:_e,localMedicalDrugsList:[...this.$props._selectedMedicalDrugsList]}},props:{_selectedMedicalDrugsList:{type:Array,default:[]},show_actions_buttons:{type:Boolean,default:!0},highLightBackground:{type:String,default:"item-native"}},watch:{},methods:{highlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#006401"),this.highlightActionBtns(e)},undoHighlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#636363"),this.undohighlightActionBtns(e)},highlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let a=0;a<t.length;a++)t[a].style.display="inline-block"},undohighlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let a=0;a<t.length;a++)t[a].style.display="none"},asignLblID(e){return e+"_lbl"},asignSpanLblID(e){return e+"_spanlbl"},async removeItemAtIndex(e,t){await mn("Do you want to delete it?",t)&&this.$emit("remove-item",e)},editItemAtIndex(e){this.$emit("edit-item",e)},highLightBnd(e){if(e){if(e.highlightbackground!==void 0&&e.highlightbackground==!0)return this.$props.highLightBackground}else return!1}}}),Ka=["onMousemove","onMouseout"],Qa={class:"route-label"};function Xa(e,t,a,l,d,r){const h=H("ion-label"),s=H("ion-col"),b=H("ion-row"),c=H("ion-icon");return _(!0),P(Se,null,Be(e.localMedicalDrugsList,(D,C)=>(_(),P("div",{id:"df",class:"medication-item",key:C,onMousemove:T=>e.highlightItem(C),onMouseout:T=>e.undoHighlightItem(C)},[n(b,{class:"medication-header"},{default:o(()=>[n(s,{class:Oe(["ion-text-wrap",e.highLightBnd(D)])},{default:o(()=>[n(h,{id:e.asignLblID(C),class:"medication-name"},{default:o(()=>[K(Y(D.drugName),1)]),_:2},1032,["id"])]),_:2},1032,["class"])]),_:2},1024),n(b,{class:"medication-details"},{default:o(()=>[n(s,{size:"10",class:Oe(["ion-text-wrap details-col",e.highLightBnd(D)])},{default:o(()=>[n(h,{class:"details-text"},{default:o(()=>[K(Y(D.dose)+" / "+Y(D.frequency)+" / daily / "+Y(D.duration)+" / until "+Y(D.prescription)+" ",1),f("span",Qa,Y(D.route_name),1)]),_:2},1024)]),_:2},1032,["class"]),e.show_actions_buttons?(_(),ne(s,{key:0,class:Oe([e.highLightBnd(D),"actions-col"]),size:"2"},{default:o(()=>[n(h,{class:Oe(["action-button",e.asignSpanLblID(C)]),onClick:T=>e.editItemAtIndex(C)},{default:o(()=>[n(c,{icon:e.iconsContent.edit},null,8,["icon"])]),_:1},8,["class","onClick"]),n(h,{class:Oe(["action-button",e.asignSpanLblID(C)]),onClick:T=>e.removeItemAtIndex(C,T)},{default:o(()=>[n(c,{icon:e.iconsContent.delete},null,8,["icon"])]),_:1},8,["class","onClick"])]),_:2},1032,["class"])):G("",!0)]),_:2},1024)],40,Ka))),128)}const Ns=ge(ja,[["render",Xa],["__scopeId","data-v-01c693a3"]]),Ja={key:0,class:"custom-allergy-container"},Za={class:"button-group"},es=ae({watch:{},name:"AllergiesComponent"}),ts=ae({...es,setup(e){const t=gn(),a=Te(),l=me(()=>t.selectedMedicalAllergiesList),d=me(()=>a.patient),r=me(()=>t.medicalAllergiesList),h=I(y(8,"item-")),s=I(""),b=I(!1),c=[{multi_Selection:!0,show_list_label:!0,unqueId:h.value,name_of_list:"Add/Remove allergies",placeHolder:"Search for an allergy",items:[],listUpdatedFN:T,listFilteredFN:()=>{},searchTextFN:U,use_internal_filter:!0,show_error:I(!1),error_message:"please select a User",disabled:I(!1)}],D=I(!1);Ie(async()=>{C()});const C=()=>{t.current_patient.ID!=d.value.ID&&(t.clearSelectedMedicalAllergiesList(),t.setCurrentPatient(d.value))};function T(v){v.forEach(w=>{w.selected==!0&&w.name==="Other"&&(b.value=w.name==="Other"),w.selected==!1&&w.name==="Other"&&W()}),t.setSelectedMedicalAllergiesList(v),S()}async function U(v){const w=v,A=await ie.getConceptSet("OPD Medication",w);if(!A)return;A.map(V=>({label:V.name,value:V.name,other:V}));const p=vn(w),E=fn(p,A).sort((V,J)=>V.name.localeCompare(J.name));t.setMedicalAllergiesList(E),S()}function S(){const v=r.value;l.value.forEach(A=>{let p=!1;v.forEach((O,E)=>{O.concept_id==A.concept_id&&A.selected===!0&&(v[E]=A,p=!0)}),!p&&A.selected===!0&&v.push(A)});const w=v.filter((A,p,O)=>p===O.findIndex(E=>(E==null?void 0:E.concept_id)===(A==null?void 0:A.concept_id)));t.setMedicalAllergiesList(w)}function y(v=8,w=""){const A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let p=w;for(let O=0;O<v;O++)p+=A.charAt(Math.floor(Math.random()*A.length));return p+="-".concat(Date.now()),p}async function F(v){try{const w=v.trim();if(w){const A={name:w,selected:!0,concept_id:y(8,"12"),concept_name_id:y(8,"34")};t.setMedicalAllergiesList([...r.value,A]),t.setSelectedMedicalAllergiesList(A),b.value=!1,D.value=!0,s.value="";const p=t.findSelectedAllergyByName("Other");t.unselectOther(p)}}catch(w){console.error(w)}}const W=()=>{b.value=!1,s.value="",D.value=!1;const v=t.findSelectedAllergyByName("Other");v&&t.unselectOther(v)};return(v,w)=>(_(),ne(g(At),null,{default:o(()=>[n(g(Ln),null,{default:o(()=>[n(g(Re),{class:"header-container"},{default:o(()=>[n(g(at),{icon:g(Tn),class:"allergy-icon"},null,8,["icon"]),w[3]||(w[3]=f("span",{style:{"font-size":"16px","font-weight":"600"}}," Allergies (Medication, Healthcare items, Environment and Food) ",-1))]),_:1})]),_:1}),n(g(It),null,{default:o(()=>[n(hn,{multiSelection:c[0].multi_Selection,show_label:c[0].show_list_label,uniqueId:c[0].unqueId,name_of_list:c[0].name_of_list,choose_place_holder:c[0].placeHolder,"items_-list":r.value,use_internal_filter:c[0].use_internal_filter,disabled:c[0].disabled.value,onItemListUpDated:c[0].listUpdatedFN,onItemListFiltered:c[0].listFilteredFN,onItemSearchText:c[0].searchTextFN},null,8,["multiSelection","show_label","uniqueId","name_of_list","choose_place_holder","items_-list","use_internal_filter","disabled","onItemListUpDated","onItemListFiltered","onItemSearchText"]),b.value?(_(),P("div",Ja,[n(g(qe),{modelValue:s.value,"onUpdate:modelValue":w[0]||(w[0]=A=>s.value=A),placeholder:"Please specify the allergy",fill:"outline",class:"custom-input"},null,8,["modelValue"]),f("div",Za,[n(g(pt),{onClick:w[1]||(w[1]=A=>F(s.value)),class:"addCustomAllergyBtn"},{default:o(()=>[...w[4]||(w[4]=[K(" Add Allergy ",-1)])]),_:1}),n(g(pt),{onClick:w[2]||(w[2]=A=>W()),fill:"clear",class:"cancelBtn"},{default:o(()=>[n(g(at),{icon:g(Et),slot:"icon-only"},null,8,["icon"])]),_:1})])])):G("",!0)]),_:1})]),_:1}))}}),Hs=ge(ts,[["__scopeId","data-v-3314535a"]]),ns={class:"checklist-container"},as=ae({watch:{},name:"xxxComponent"}),ss=ae({...as,setup(e){const t=Te(),a=me(()=>t.patient),l=Un(),d=l.items;Ie(async()=>{r()});const r=()=>{l.current_patient.ID!=a.value.ID&&(l.clearSelectednonPharmaTherapyStore(),l.setCurrentPatient(a.value))};return q(()=>a.value,async h=>{}),(h,s)=>(_(),P("div",ns,[(_(!0),P(Se,null,Be(g(d),b=>(_(),ne(g(Ce),{key:b.id,class:"no-border"},{default:o(()=>[n(g(Ct),{id:b.id,modelValue:b.checked,"onUpdate:modelValue":c=>b.checked=c,slot:"start"},null,8,["id","modelValue","onUpdate:modelValue"]),n(g(Re),{style:{"font-size":"16px","font-weight":"600"}},{default:o(()=>[K(Y(b.label),1)]),_:2},1024)]),_:2},1024))),128))]))}}),Bs=ge(ss,[["__scopeId","data-v-371e920f"]]),is=ae({components:{IonContent:it,IonHeader:St,IonItem:Ce,IonList:st,IonMenu:bt,IonTitle:Dt,IonToolbar:yt,BasicInputField:vt,IonDatetime:kn,IonBadge:Pn,DateInputField:Wn,DynamicButton:Ge},props:{showPeripheral:{type:Boolean,default:!0}},setup(e){const t=Ze(),a=I(0),l=me(()=>t.getDisabledDates()),d=me(()=>t.getAssignedAppointments()),r=I(),h=me(()=>e.showPeripheral);return{disabledDates:l,datesCounts:d,appointment_count:a,calendarOutline:Nn,inputPRDate:r,show_peripheral:h}},data(){return ce(),dt(),{iconsContent:_e,date:new Date(z.getSessionDate()),tomorrow:new Date(z.getSessionDate()).getDate()+1,appointment:"",drugRunoutDate:"",nextAppointmentDate:"",minDate:new Date(z.getSessionDate())}},computed:{...Ee(ce,["nextAppointment","appointmentCountsCache","currentSelectedNextAppointmentDate"]),...Ee(Ze,["maximumNumberOfDaysForEachDay","assignedAppointmentsDates"]),...Ee(Te,["patient"]),...Ee(dt,["activeProgram"]),calendarDate(){const e=ce();return e.currentSelectedNextAppointmentDate?x.toStandardHisDisplayFormat(e.currentSelectedNextAppointmentDate):""},runOutDate(){var t;const e=ce();return((t=this.activeProgram)==null?void 0:t.program_id)===14?mt():e.getAppointmentMedicationRunOutDate()}},watch:{calendarDate:{handler(){this.updateNextAppointment()},deep:!0},"$service.sessionDate":{handler(){this.updateMinDate()},immediate:!0},"patient.ID":{async handler(e,t){e!==t&&(this.cleanCurrentNextAppointmentDate(),this.checkIfSamePatientInContext(),this.clearNextAppointment())}}},async mounted(){this.checkIfSamePatientInContext(),await this.getAppointmentMents(this.runOutDate.date),await Dn().loadGlobalProperty(),this.validateAppointmentCountsCache(),await this.preloadAppointmentCounts(),bn();const e=z.getUserID(),t=new ft;this.appointment=new Fe(t.getID(),e),this.nextAppointmentDate=this.appointment.date,this.supposedRunOutDate(),window.addEventListener("storage",this.handleStorageChange),mt()},beforeUnmount(){window.removeEventListener("storage",this.handleStorageChange)},methods:{handleStorageChange(e){e.key==="sessionDate"&&this.updateMinDate()},updateMinDate(){this.date=new Date(z.getSessionDate()),this.minDate=new Date(z.getSessionDate())},updateNextAppointment(){ce().setNextAppointment(this.calendarDate)},async handleDateUpdate(e){e&&(Ze().setAssignedAppointmentsDates(e,!0),this.calendarDate=x.toStandardHisDisplayFormat(e),await this.save(),await this.getAppointmentMents(e),await this.updateAppointmentCache(e),ce().setCurrentSelectedNextAppointmentDate(e,this.patient.ID))},async getAppointmentMents(e){if(ht().apiStatus)try{const a=await Fe.getDailyAppointments(x.toStandardHisFormat(e),x.toStandardHisFormat(e));this.appointment_count=a.length}catch(a){}},getCounter(e){const t=x.toStandardHisFormat(e);return this.appointmentCountsCache[t]||""},async save(){if(this.assignedAppointmentsDates.length>0)try{const t=await new zn().createOfflineAppointment()}catch(e){}},async openCornfirmModal(e){this.calendarDate=x.toStandardHisDisplayFormat(e),await this.getAppointmentMents(e),_t(yn,{class:"otherVitalsModal"},!0,{message:"Are you sure you want to add this Appointment?"},{cancel:d=>{},confirm:async d=>{d.detail==!0&&await this.handleDateUpdate(e)}})},async handleInput(e){this.inputPRDate=x.toStandardHisDisplayFormat(e),await this.openCornfirmModal(e)},async supposedRunOutDate(){await _n.getLastDrugsReceived(this.patient.patientID)},async preloadAppointmentCounts(){try{const e=new Date(z.getSessionDate());e.setDate(1);const t=new Date(z.getSessionDate());t.setMonth(t.getMonth()+2),t.setDate(0);try{const a=await Fe.getDailyAppointments(x.toStandardHisFormat(e),x.toStandardHisFormat(t));if(!a)return;const l=this.filterUniqueAppointments(a),d={};l.forEach(r=>{const h=new Date(r.appointment_date),s=x.toStandardHisFormat(h);d[s]||(d[s]=0),d[s]++}),Object.keys(d).forEach(r=>{this.appointmentCountsCache[r]=d[r]})}catch(a){console.error("Error fetching appointments for date range:",a)}}catch(e){console.error("Error in preload process:",e)}},filterUniqueAppointments(e){const t=new Map;return e.forEach(a=>{const l="".concat(a.given_name,"_").concat(a.family_name,"_").concat(a.birthdate,"_").concat(a.appointment_date);t.has(l)||t.set(l,a)}),Array.from(t.values())},async updateAppointmentCache(e){try{const t=x.toStandardHisFormat(e),a=await Fe.getDailyAppointments(x.toStandardHisFormat(e),x.toStandardHisFormat(e));if(!a)return;this.appointmentCountsCache[t]=a.length}catch(t){console.error("Error updating appointment cache:",t)}},validateAppointmentCountsCache(){ce().checkCurrentLocationIfInContext()},isRunOutDate(e){return!this.runOutDate||!this.runOutDate.date?!1:x.toStandardHisFormat(e)===x.toStandardHisFormat(this.runOutDate.date)},cleanCurrentNextAppointmentDate(){ce().cleanCurrentSelectedNextAppointmentDate()},checkIfSamePatientInContext(){const e=ce();e.current_patient.ID!=this.patient.ID&&(this.cleanCurrentNextAppointmentDate(),e.setCurrentPatient(this.patient))},clearNextAppointment(){ce().clearAppointmentMedicationRunOutDate()}}}),os={class:"card_content"},rs={class:"count-badge"},ls={class:"dates_title"},ds={class:"sub_data"},us={class:"dates_title"},cs={class:"sub_data"},ps={class:"dates_title"},ms={class:"sub_data"},gs={class:"dates_title"},vs={class:"sub_data"};function fs(e,t,a,l,d,r){const h=H("VueDatePicker"),s=H("ion-col"),b=H("DynamicButton"),c=H("ion-item"),D=H("ion-row"),C=H("DateInputField");return _(),P("div",os,[n(D,null,{default:o(()=>[n(s,{"size-sm":"12","size-md":"12","size-lg":"12","size-xl":"8"},{default:o(()=>[n(h,{class:"calender",onDateUpdate:e.openCornfirmModal,inline:"","auto-apply":"","enable-time-picker":!1,"disabled-dates":e.disabledDates,"min-date":e.minDate,modelValue:e.runOutDate.date,"onUpdate:modelValue":t[0]||(t[0]=T=>e.runOutDate.date=T)},{day:o(({day:T,date:U})=>[(_(),P("p",{key:0,class:Oe({"run-out-date":e.isRunOutDate(U)}),style:{"font-weight":"600","font-size":"20px"}},[f("span",null,[K(Y(T),1),f("sup",rs,Y(e.getCounter(U)),1)])],2))]),_:1},8,["onDateUpdate","disabled-dates","min-date","modelValue"])]),_:1}),e.show_peripheral?(_(),ne(s,{key:0},{default:o(()=>[n(c,null,{default:o(()=>[f("div",ls,[t[3]||(t[3]=f("div",null,[K("Suggested Next Appointment Date "),f("span",{style:{"font-size":"16px"}},"(Medication run out date)")],-1)),f("div",ds,[K(Y(e.runOutDate.formattedDate||"No run out date available")+" ",1),e.runOutDate.formattedDate?(_(),ne(b,{key:0,onClick:t[1]||(t[1]=T=>e.handleDateUpdate(e.runOutDate.date)),name:"Set Next Appt.",fill:"solid",iconSlot:"icon-only",style:{float:"right"}})):G("",!0)])])]),_:1}),n(c,null,{default:o(()=>[f("div",us,[t[4]||(t[4]=f("div",null,"User set appointment date",-1)),f("div",cs,Y(e.calendarDate),1)])]),_:1}),n(c,null,{default:o(()=>[f("div",ps,[t[5]||(t[5]=f("div",null,"Appointments",-1)),f("div",ms,Y(e.appointment_count),1)])]),_:1}),n(c,null,{default:o(()=>[f("div",gs,[t[6]||(t[6]=f("div",null,"Appointment limit (per/day)",-1)),f("div",vs,Y(e.appointment_count)+"/"+Y(e.maximumNumberOfDaysForEachDay),1)])]),_:1})]),_:1})):G("",!0)]),_:1}),e.show_peripheral?(_(),ne(D,{key:0},{default:o(()=>[n(s,{size:"4"},{default:o(()=>[n(C,{inputHeader:"Preferred Next Appointment Date",bold:"600",fontSize:"17px",placeholderFontSize:"17px",placeholderFontWeight:"600",unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.inputPRDate,eventType:"",minDate:e.minDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t[2]||(t[2]=T=>e.handleInput(T))},null,8,["icon","inputValue","minDate"])]),_:1})]),_:1})):G("",!0)])}const Rs=ge(is,[["render",fs],["__scopeId","data-v-4e58e0bc"]]);export{Hs as A,Ns as D,ks as I,Pt as L,Rs as N,Ma as _,Bs as a,ra as b};

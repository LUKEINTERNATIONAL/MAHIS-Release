import{y as v,a1 as b,t as c,S as t,G as g}from"../index-DySoFw7y.js";import{r as y}from"./vendor-ChpUWbYC.js";function C(){const d=v(),n=b(),e=y(!1),l=y(!1),i=async o=>{try{e.value=!0;const r={...o,configuredBy:t.getUserName(),configuredAt:new Date().toISOString(),locationId:t.getUserLocationId()};return await d.setGlobalProperty("facility_network_config",JSON.stringify(r)),u(o),g("Network configuration saved for entire facility!",3e3),!0}catch(r){return console.error("Error saving global network config:",r),c("Failed to save global configuration. Saved locally only."),!1}finally{e.value=!1}},a=async()=>{try{e.value=!0;const o=await t.getJson("global_properties",{property:"facility_network_config"});if(o&&o.facility_network_config){const r=JSON.parse(o.facility_network_config);if(r.locationId===t.getUserLocationId())return r}return null}catch(o){return console.error("Error loading global network config:",o),null}finally{e.value=!1}},u=o=>{n.setConfig(o)},s=()=>n.loadFromLocalStorage()?n.config:null,p=async()=>{if(l.value)return{success:!1,config:null,source:"none"};l.value=!0;try{const o=await a();if(o)return n.setConfig({...o,configSource:"global_property"}),g("Network configuration loaded from facility settings",4e3),{success:!0,config:o,source:"global_property"};const r=s();return r?{success:!0,config:r,source:"local_storage"}:{success:!1,config:null,source:"none"}}catch(o){return console.error("Error during auto-discovery:",o),{success:!1,config:null,source:"none"}}},S=async()=>await a()!==null,w=()=>localStorage.getItem("network_config_source")||"manual",f=()=>{const o=t.getUserRoles()||[];return o.includes("Superuser")||o.includes("Superuser,Superuser,")};return{isLoading:e,saveAsGlobalProperty:i,loadFromGlobalProperty:a,saveToLocalStorage:u,loadFromLocalStorage:s,autoDiscoverConfig:p,hasGlobalConfig:S,getConfigSource:w,isSuperUser:f,syncLocalToGlobal:async()=>{if(!f())return c("Only super users can save facility-wide network configurations"),!1;const o=s();return o?await i(o):(c("No local configuration found to sync"),!1)}}}export{C as u};

var Tn=Object.defineProperty;var Nn=(t,e,a)=>e in t?Tn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var me=(t,e,a)=>Nn(t,typeof e!="symbol"?e+"":e,a);import{d as J,cZ as On,am as Te,r as O,c as z,w as he,a as ge,e as v,f as d,k as n,m as A,p as ce,K as D,l as s,u as C,b3 as ut,Q as M,L as X,F as Z,P as ne,c_ as Rn,cb as Ln,av as xt,bD as Fn,bp as Vn,c6 as pt,be as Et,b7 as Me,H as g,O as H,J as l,D as Ht,cr as He,n as de,ak as Bn,af as pe,c$ as Ut,d0 as Wt,ao as jt,d1 as zt,d2 as Mn,cg as qt,d3 as xn,d4 as En,d5 as Hn,d6 as Un,d7 as Wn,d8 as jn,d9 as zn,aU as qn,bT as Gt,aV as Ze,aR as mt,aS as ft,bw as Ue,ad as Ke,N as Se,ac as et,G as Ne,ae as xe,I as _e,ab as ue,bE as lt,a9 as Gn,da as Jn,aE as Qn,db as Yn,dc as Xn,cG as Zn,aD as Kn,cL as Jt,aM as Ee,b2 as Qe,a1 as Ye,dd as Qt,aI as ht,aC as ea,i as $e,b9 as ta,de as na,z as aa,df as gt,dg as Ie,a2 as Pe,dh as Yt,ba as sa,bu as oa,br as ia,E as We,ag as je,ah as Oe,a6 as Re,R as ze,bb as ra,di as la,dj as da,dk as ca,dl as ua,bC as tt,b6 as _t,b as pa,a0 as Xt,aT as It,b4 as ma,aW as fa,dm as ha,v as ke,M as ga,aa as _a,dn as va,b8 as ya,dp as Zt,dq as ba,ca as Da,dr as $a,ds as wa,bx as Ca,b$ as ka}from"./vendor-BTebhqHt.js";import{S as W,u as re,_ as ee,P as Le,t as oe,a as Kt,E as en,H as R,g as Ae,b as vt,A as Sa,c as Ia,d as tn,e as Pt,f as nn,h as Pa,i as qe,R as Aa,p as Ta,j as At,k as Na,O as Oa,l as Ra,B as La,m as Tt,n as se,o as Ve,q as Fa,r as an,s as dt,v as Va,w as Nt,x as Ba,y as Ma,z as xa,C as Ea,D as st,F as ot,G as Ot,I as Rt,J as Fe,T as sn,K as Ha,L as fe,M as Lt,N as Ua,Q as Wa,U as ja,V as za,W as qa}from"../index-DBQF-8Xn.js";import{m as Xe}from"./apexcharts-no8IW45T.js";import{A as on}from"./ncd_appointment_service-vM1q5oeR.js";import{D as yt}from"./DateInputField-0lrp9UXU.js";import{u as Ga,_ as Ja,M as Qa}from"./ActionButtons.vue_vue_type_script_setup_true_lang-DXouIAZK.js";import{V as Ya}from"./ViewToggleComponent-Bru8j5Uz.js";import{B as Xa}from"./bottomNavBar-DTLP-NWA.js";import{P as Za}from"./patient_report_service-CNSC4Mkp.js";import{l as Be}from"./lodash-NJiRuGo9.js";import{B as Ge}from"./BasicForm-7DaBPuA7.js";import{B as nt}from"./BasicCard-Cdy7zntW.js";import{u as Ka}from"./AdministerOtherVaccinesStore-CMEV2ux8.js";import{c as es}from"./customDatePicker-7aA8wHN0.js";import{s as ts}from"./vaccines_service-CPD8V9uh.js";import{g as ns}from"./dashboard_service-DFjc5eHo.js";import{i as as}from"./Img-CJEgX1Vr.js";import{R as ss}from"./ReusableDataTable-B-85zsJZ.js";import{R as Ft,u as os,a as is,_ as rs,b as ls,c as ds,d as cs,e as us,f as ps,g as ms}from"./useSetRegistrationValues-D_O_P88p.js";import{u as rn}from"./useUserActivities-60ApcIW0.js";import fs from"./NeonatalHome-CZsTogQ1.js";import"./sms_service-BnFxTj4j.js";import"./EIRreportsStore-xF8KfXWW.js";import"./Export-JdaAXeIZ.js";import"./useLocation-DWKEe-Fi.js";import"./neonatal_service-Cya1LD0G.js";import"./images-Zb0Yk5XL.js";const be={VITALS:6,APPOINTMENT:7,HIV_CLINIC_REGISTRATION:9,TREATMENT:25,HIV_RECEPTION:51,HIV_STAGING:52,HIV_CLINIC_CONSULTATION:53,DISPENSING:54,ART_ADHERENCE:68};class Vt extends W{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(e){return await super.getJson("fhir/patient/".concat(e),{id:e})}static async getFhirObservations(e){return await super.getJson("fhir/patient/".concat(e,"/observations/"),{id:e})}}const hs={class:"fhir-viewer"},gs={class:"container"},_s={key:0,class:"main-header"},vs={class:"header-line"},ys={key:0,class:"last-updated-display"},bs={key:1,class:"card initial-input-card"},Ds={class:"action-area-initial"},$s={key:0,class:"card patient-card"},ws={class:"card-title"},Cs={class:"patient-info-grid"},ks={class:"info-item"},Ss={class:"info-value"},Is={class:"info-item"},Ps={class:"info-value"},As={class:"info-item"},Ts={class:"info-value"},Ns={class:"info-item"},Os={class:"info-value"},Rs={class:"info-value"},Ls={class:"info-value"},Fs={class:"info-label"},Vs={class:"info-value"},Bs={key:2,class:"card observations-card"},Ms={class:"card-title"},xs={class:"observations-grid"},Es={class:"obs-header"},Hs={class:"obs-title"},Us={class:"obs-details"},Ws={class:"obs-detail obs-value-highlight"},js={class:"obs-value"},zs={class:"obs-detail"},qs={class:"obs-value"},Gs={key:0,class:"obs-detail"},Js={class:"obs-value"},Qs={key:3,class:"no-data-found"},Ys={key:4,class:"no-data-found"},Xs={key:5,class:"main-footer"},Zs=J({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(t){On({"person-circle-outline":Et,"clipboard-outline":pt,"search-outline":Vn,"information-circle-outline":Fn,"alert-circle-outline":xt,"person-add-outline":Ln,"arrow-back-outline":Rn});const e=t,a=Te(),o=O(!1),i=O([]),c=O(),r=O(),u=O(null),m=O([]),h=z(()=>i.value.some(S=>S.resourceType==="Bundle"&&S.entry&&S.entry.some($=>$.resource&&$.resource.resourceType==="Patient"))),p=z(()=>m.value.length>0),w=async()=>{if(i.value=[],r.value=null,u.value=null,m.value=[],!c.value){console.error("Please enter a Patient Identifier.");return}o.value=!0;try{const S=await Vt.getFhirPatient(c.value);if(S&&S.entry&&S.entry.length>0){const $=S.entry[0].resource,Q=$.id,Y=await Vt.getFhirObservations(Q);i.value=[S],Y&&(i.value.push(Y),m.value=Y.entry.filter(ae=>ae.resource&&ae.resource.resourceType==="Observation").map(ae=>{const U=ae.resource;return{id:U.id,display:V(U),value:K(U),date:U.effectiveDateTime,category:U.category&&U.category[0]&&U.category[0].coding&&U.category[0].coding[0]?U.category[0].coding[0].display||U.category[0].coding[0].code:"N/A"}}));const q=$.name&&$.name[0];u.value={personInformation:{given_name:q&&q.given?q.given.join(" "):"",middle_name:q&&q.middle?q.middle.join(" "):"",family_name:q&&q.family?q.family:"",gender:$.gender=="male"?"M":($==null?void 0:$.gender)=="female"?"F":"",birthdate:$.birthDate||"",cell_phone_number:$.telecom&&$.telecom[0]?$.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:$.contact&&$.contact[0]&&$.contact[0].telecom?$.contact[0].telecom[0].value:""}]}};const x=[S,Y].filter(Boolean).reduce((ae,U)=>{if(U.meta&&U.meta.lastUpdated){const le=new Date(U.meta.lastUpdated);return ae===null||le>ae?le:ae}return ae},null);x&&(r.value=N(x.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch(S){console.error("Error loading FHIR data:",S),i.value=[],r.value=null,u.value=null,m.value=[]}finally{o.value=!1}},f=S=>{if(S.name&&S.name[0]){const $=S.name[0],Q=$.given?$.given.join(" "):"",Y=$.family||"";return"".concat(Q," ").concat(Y).trim()||"N/A"}return"N/A"},b=S=>S.identifier&&S.identifier.length>0?S.identifier.map($=>{let Q="Unknown System";if($.type&&$.type.coding&&$.type.coding[0]&&$.type.coding[0].display)Q=$.type.coding[0].display;else if($.system){const q=$.system.split("/");Q=q[q.length-1]||$.system,$.system==="urn:oid:2.16.840.1.113883.4.6"&&(Q="Social Security Number")}sessionStorage.setItem(Q,$.value);let Y=null;return $.assigner&&$.assigner.display?Y=$.assigner.display:$.assigner&&$.assigner.reference&&(Y=$.assigner.reference.split("/").pop()||$.assigner.reference),{value:$.value||"N/A",systemDisplay:Q,periodStart:$.period?$.period.start:null,periodEnd:$.period?$.period.end:null,assignerDisplay:Y}}):[],_=S=>S.telecom&&S.telecom.length>0?S.telecom.filter($=>$.system==="phone"&&$.value):[],y=S=>{if(S.contact&&S.contact.length>0){const $=S.contact.filter(Y=>{var q;return(q=Y.relationship)==null?void 0:q.some(G=>{var x;return(x=G.coding)==null?void 0:x.some(ae=>ae.code==="GUARD")})}),Q=[];return $.forEach(Y=>{Y.telecom&&Y.telecom.length>0&&Y.telecom.filter(q=>q.system==="phone"&&q.value).forEach(q=>Q.push(q))}),Q}return[]},T=S=>{if(!S)return"N/A";try{return new Date(S).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch($){return console.error("Invalid date string for formatDate:",S,$),"Invalid Date"}},N=S=>{if(!S)return"N/A";try{return new Date(S).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch($){return console.error("Invalid date time string for formatDateTime:",S,$),"Invalid Date/Time"}},L=S=>{if(!S)return"N/A";try{const $=new Date,Q=new Date(S);let Y=$.getFullYear()-Q.getFullYear();const q=$.getMonth()-Q.getMonth();return(q<0||q===0&&$.getDate()<Q.getDate())&&Y--,Y}catch($){return console.error("Invalid birth date string for calculateAge:",S,$),"N/A"}},P=S=>{if(S.meta&&S.meta.tag){const $=S.meta.tag.find(Q=>Q.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return $?$.code:"Unknown"}return"Unknown"},V=S=>S.code&&S.code.coding&&S.code.coding[0]&&(S.code.coding[0].display||S.code.coding[0].code)||"Unknown Observation",K=S=>S.valueQuantity?"".concat(S.valueQuantity.value," ").concat(S.valueQuantity.unit||"").trim():S.valueString?S.valueString:S.valueBoolean!==void 0?S.valueBoolean?"True":"False":"N/A",j=()=>{re().setRecord(u.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(m.value)),we("/registration/manual")},ve=()=>{i.value=[],c.value="",r.value=null,u.value=null,m.value=[]},we=S=>{a.push({path:S})};return he(()=>a,async()=>{i.value=[],m.value=[]},{deep:!0}),ge(()=>{var S;if(e.initialData.length>0){i.value=e.initialData;const Q=e.initialData.filter(Boolean).reduce((G,x)=>{if(x.meta&&x.meta.lastUpdated){const ae=new Date(x.meta.lastUpdated);return G===null||ae>G?ae:G}return G},null);Q&&(r.value=N(Q.toISOString()));const Y=e.initialData.find(G=>G.resourceType==="Bundle"&&G.entry&&G.entry.some(x=>x.resource&&x.resource.resourceType==="Patient"));if(Y){const G=(S=Y.entry.find(x=>x.resource&&x.resource.resourceType==="Patient"))==null?void 0:S.resource;if(G){const x=G.name&&G.name[0];u.value={personInformation:{given_name:x&&x.given?x.given.join(" "):"",middle_name:x&&x.middle?x.middle.join(" "):"",family_name:x&&x.family?x.family:"",gender:G.gender||"",birthdate:G.birthDate||""}}}}const q=e.initialData.find(G=>G.resourceType==="Bundle"&&G.entry&&G.entry.some(x=>x.resource&&x.resource.resourceType==="Observation"));q&&(m.value=q.entry.filter(G=>G.resource&&G.resource.resourceType==="Observation").map(G=>{const x=G.resource;return{id:x.id,display:V(x),value:K(x),date:x.effectiveDateTime,category:x.category&&x.category[0]&&x.category[0].coding&&x.category[0].coding[0]?x.category[0].coding[0].display||x.category[0].coding[0].code:"N/A"}}))}}),(S,$)=>{var Q,Y,q,G,x,ae;return d(),v("div",hs,[n("div",gs,[(Q=i.value)!=null&&Q.length?(d(),v("header",_s,[n("div",vs,[$[1]||($[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:ce(["last-updated-display","status-"+P(i.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+D(P(i.value[0].entry[0].resource)),3),r.value?(d(),v("span",ys,"Last Updated: "+D(r.value),1)):A("",!0)])])])):A("",!0),(Y=i.value)!=null&&Y.length?A("",!0):(d(),v("section",bs,[s(C(ut),{modelValue:c.value,"onUpdate:modelValue":$[0]||($[0]=U=>c.value=U),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",Ds,[n("button",{onClick:w,class:"load-data-btn"},[s(C(X),{name:"search-outline"}),$[2]||($[2]=M(" Find Patient ",-1))])])])),(d(!0),v(Z,null,ne(i.value,U=>(d(),v("div",{key:U.id},[U.resourceType==="Bundle"&&U.entry&&U.entry[0]&&U.entry[0].resource.resourceType==="Patient"?(d(),v("section",$s,[n("h2",ws,[s(C(X),{name:"person-circle-outline"}),$[3]||($[3]=M(" Patient Demographics",-1))]),n("div",Cs,[n("div",ks,[$[4]||($[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",Ss,D(f(U.entry[0].resource)),1)]),n("div",Is,[$[5]||($[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",Ps,D(U.entry[0].resource.gender||"Not specified"),1)]),n("div",As,[$[6]||($[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",Ts,D(T(U.entry[0].resource.birthDate)),1)]),n("div",Ns,[$[7]||($[7]=n("span",{class:"info-label"},"Age",-1)),n("span",Os,D(L(U.entry[0].resource.birthDate))+" years",1)]),_(U.entry[0].resource).length?(d(!0),v(Z,{key:0},ne(_(U.entry[0].resource),(le,Ce)=>(d(),v("div",{key:"patient-phone-".concat(Ce),class:"info-item"},[$[8]||($[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",Rs,D(le.value),1)]))),128)):A("",!0),y(U.entry[0].resource).length?(d(!0),v(Z,{key:1},ne(y(U.entry[0].resource),(le,Ce)=>(d(),v("div",{key:"guardian-phone-".concat(Ce),class:"info-item"},[$[9]||($[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",Ls,D(le.value),1)]))),128)):A("",!0),(d(!0),v(Z,null,ne(b(U.entry[0].resource),(le,Ce)=>(d(),v("div",{key:le.value||Ce,class:"info-item"},[n("span",Fs,D(le.systemDisplay),1),n("span",Vs,D(le.value),1)]))),128))])])):A("",!0)]))),128)),((q=m.value)==null?void 0:q.length)>0?(d(),v("section",Bs,[n("h2",Ms,[s(C(X),{name:"clipboard-outline"}),$[10]||($[10]=M(" Clinical Observations",-1))]),n("div",xs,[(d(!0),v(Z,null,ne(m.value,U=>(d(),v("div",{key:U.id,class:"observation-item"},[n("div",Es,[n("h3",Hs,D(U.display),1)]),n("div",Us,[n("div",Ws,[$[11]||($[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",js,D(U.value),1)]),n("div",zs,[$[12]||($[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",qs,D(N(U.date)),1)]),U.category&&U.category!=="N/A"?(d(),v("div",Gs,[$[13]||($[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",Js,D(U.category),1)])):A("",!0)])]))),128))])])):A("",!0),(G=i.value)!=null&&G.length&&!h.value?(d(),v("div",Qs,[n("p",null,[s(C(X),{name:"alert-circle-outline"}),$[14]||($[14]=M(" No patient data found for the provided identifier. Please try again.",-1))])])):(x=i.value)!=null&&x.length&&h.value&&!p.value?(d(),v("div",Ys,[n("p",null,[s(C(X),{name:"information-circle-outline"}),$[15]||($[15]=M(" No clinical observations found for this patient.",-1))])])):A("",!0),(ae=i.value)!=null&&ae.length?(d(),v("footer",Xs,[n("button",{onClick:ve,class:"back-to-search-btn small-btn"},[s(C(X),{name:"arrow-back-outline"}),$[16]||($[16]=M(" Back to Search ",-1))]),n("button",{onClick:j,class:"register-btn small-btn"},[s(C(X),{name:"person-add-outline"}),$[17]||($[17]=M(" Register New Patient ",-1))])])):A("",!0)])])}}}),Ks=ee(Zs,[["__scopeId","data-v-0dc329ef"]]),eo=J({components:{DataTable:Me},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Referred From",data:"referredFrom"},{title:"Referred By",data:"referredBy"},{title:"Clinic Date",data:"appointmentDate"},{title:"Actions",data:null,render:(t,e,a)=>'<ion-button size="small" fill="solid" color="primary" onclick="window.navigatePatient(\''.concat(a.patient_id,"')\">Profile</ion-button>"),orderable:!1,width:"20%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No referrals found."}}}},async mounted(){var i;const e=(i=Kt().activeProgram)==null?void 0:i.program_id,a=String(localStorage.getItem("locationID")),o=await en.getAllEncounters({encounter_type_id:114});console.log("Encounters fetched for Internal Referrals:",o),this.patients=o.reduce((c,r)=>{var f,b,_,y,T,N,L,P;if(String(r==null?void 0:r.location_id)!==a||!((f=r==null?void 0:r.observations)==null?void 0:f.find(V=>(V==null?void 0:V.concept_id)===2227&&(V==null?void 0:V.value_numeric)===e)))return c;const m=(y=(_=(b=r==null?void 0:r.patient)==null?void 0:b.person)==null?void 0:_.names)!=null&&y[0]?"".concat(r.patient.person.names[0].given_name||""," ").concat(r.patient.person.names[0].family_name||""):"Unknown";let h=((T=r==null?void 0:r.program)==null?void 0:T.name)||"Unknown Program";h=h.replace(/program/i,"").trim();const p=(L=(N=r==null?void 0:r.provider)==null?void 0:N.names)!=null&&L[0]?"".concat(r.provider.names[0].given_name||""," ").concat(r.provider.names[0].family_name||""):"Unknown",w=(P=r==null?void 0:r.observations)==null?void 0:P.find(V=>{var K,j;return(j=(K=V==null?void 0:V.concept)==null?void 0:K.concept_names)==null?void 0:j.some(ve=>{var we;return(we=ve==null?void 0:ve.name)==null?void 0:we.toLowerCase().includes("date of referral")})});return c.push({patient_id:r.patient_id,fullName:m,referredFrom:h,referredBy:p,appointmentDate:(w==null?void 0:w.value_text)||"N/A"}),c},[]),window.navigatePatient=this.navigateTo},methods:{async navigateTo(t){let e=await Le.findByID(t);e?(await re().setPatientRecord(e),this.$router.push("/patientProfile")):oe("Patient not found. Please try searching by name.")}}}),to={class:"dueCardContent"};function no(t,e,a,o,i,c){const r=g("DataTable"),u=g("ion-card-content"),m=g("ion-card");return d(),H(m,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:l(()=>[s(u,null,{default:l(()=>[n("div",to,[s(r,{data:t.patients,columns:t.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})}const ln=ee(eo,[["render",no],["__scopeId","data-v-a95ef46a"]]),ao=J({name:"referrals",components:{InternalReferrals:ln,ExternalReferrals:Ks},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){this.segmentContent=t}}}),so={key:0},oo={style:{display:"flex","margin-top":"10px"}},io={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},ro={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},lo={key:1},co={key:2};function uo(t,e,a,o,i,c){const r=g("ion-label"),u=g("ion-segment-button"),m=g("ion-segment"),h=g("ExternalReferrals"),p=g("InternalReferrals");return d(),v(Z,null,[n("div",null,[s(m,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:l(()=>[s(u,{value:"External referrals",onClick:e[0]||(e[0]=w=>t.setSegmentContent("External referrals"))},{default:l(()=>[s(r,null,{default:l(()=>[...e[2]||(e[2]=[M("External referrals",-1)])]),_:1})]),_:1}),s(u,{value:"Internal referrals",onClick:e[1]||(e[1]=w=>t.setSegmentContent("Internal referrals"))},{default:l(()=>[s(r,null,{default:l(()=>[...e[3]||(e[3]=[M("Internal referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(d(),v("div",so,[n("div",oo,[t.checkUnderFive?(d(),v("div",io)):A("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?A("",!0):(d(),v("div",ro))])])):A("",!0),t.segmentContent=="External referrals"?(d(),v("div",lo,[s(h)])):A("",!0),t.segmentContent=="Internal referrals"?(d(),v("div",co,[s(p)])):A("",!0)],64)}const po=ee(ao,[["render",uo],["__scopeId","data-v-8f0f935e"]]),mo=Ht("ncdDashboardStore",{state:()=>({dashboardData:null,appointments:[],isLoading:!1,error:null,lastFetchDate:null,programId:32}),getters:{appointmentsCount:t=>t.appointments.length,pendingDispensationsCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_pending_dispensations)||0},defaultersCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_defaulters)||0},complicationsCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_complications)||0},activeClientsCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_client_registered)||0},genderChartData:t=>{var e;return(e=t.dashboardData)!=null&&e.gender_data?{categories:t.dashboardData.gender_data.categories,series:[{name:"Male",data:t.dashboardData.gender_data.maleSeries},{name:"Female",data:t.dashboardData.gender_data.femaleSeries}]}:{categories:[],series:[{name:"Male",data:[]},{name:"Female",data:[]}]}},diagnosisChartData:t=>{var e;return(e=t.dashboardData)!=null&&e.diagnosis_data?{categories:t.dashboardData.diagnosis_data.categories,series:[{name:"Type 1 Diabetes",data:t.dashboardData.diagnosis_data.typeOneSeries},{name:"Type 2 Diabetes",data:t.dashboardData.diagnosis_data.typeTwoSeries},{name:"Hypertention",data:t.dashboardData.diagnosis_data.hypertentionSeries}]}:{categories:[],series:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},hasData:t=>t.dashboardData!==null,isDataStale:t=>{if(!t.lastFetchDate)return!0;const e=R.toStandardHisFormat(R.sessionDate());return t.lastFetchDate!==e}},actions:{async fetchDashboardData(t,e){this.isLoading=!0,this.error=null;try{const a=t||R.toStandardHisFormat(R.sessionDate()),o=e||R.toStandardHisFormat(R.sessionDate()),i="programs/".concat(this.programId,"/reports/ncd_dashboard"),c=await W.getJson(i,{start_date:a,end_date:o});this.setDashboardData(c),this.lastFetchDate=a}catch(a){this.error=a.message||"Failed to fetch dashboard data",console.error("Error fetching NCD dashboard data:",a)}finally{this.isLoading=!1}},setDashboardData(t){this.dashboardData=t},setAppointments(t){this.appointments=t},addAppointment(t){this.appointments.push(t)},removeAppointment(t){this.appointments=this.appointments.filter(e=>e.id!==t)},updateAppointment(t,e){const a=this.appointments.findIndex(o=>o.id===t);a!==-1&&(this.appointments[a]={...this.appointments[a],...e})},setProgramId(t){this.programId=t},clearDashboardData(){this.dashboardData=null,this.appointments=[],this.error=null,this.lastFetchDate=null},async refreshDashboardData(){await this.fetchDashboardData()},async ensureFreshData(){(this.isDataStale||!this.hasData)&&await this.fetchDashboardData()}},persist:{key:"ncd-dashboard-store",storage:localStorage,paths:["dashboardData","appointments","lastFetchDate","programId"]}});async function fo(){const t=localStorage.getItem("locationID"),e=32,o=(await Ae("patients_records",{selector:{location_id:t}})).filter(f=>(f.activePrograms||[]).some(_=>_.program_id===e)),i=o.length,c=o.filter(f=>{var b;return((b=f.personInformation)==null?void 0:b.gender)==="M"}).length,r=o.filter(f=>{var b;return((b=f.personInformation)==null?void 0:b.gender)==="F"}).length,u=ho(o),m=go(o),h=_o(o),p=vo(o),w=yo(o);return{total_client_registered:i,total_male_registered:c,total_female_registered:r,total_complications:u,total_defaulters:m,total_pending_dispensations:h,gender_data:{categories:p.categories,series:[{name:"Male",data:p.male,group:"apexcharts-axis-0"},{name:"Female",data:p.female,group:"apexcharts-axis-0"}]},diagnosis_data:{categories:w.categories,series:[{name:"Type 1 Diabetes",data:w.type_one,group:"apexcharts-axis-0"},{name:"Type 2 Diabetes",data:w.type_two,group:"apexcharts-axis-0"},{name:"Hypertension",data:w.hypertension,group:"apexcharts-axis-0"}]}}}function ho(t){let e=0;return t.forEach(a=>{(a.observations||[]).some(c=>{var r;return c.encounter_type===vt.COMPLICATIONS&&c.status==="saved"&&((r=c.obs)==null?void 0:r.length)>0})&&e++}),e}function go(t){const e=new Date,a=new Date(e);a.setDate(a.getDate()-60);const o=new Date(e);o.setDate(o.getDate()-120);let i=0;return t.forEach(c=>{var h;const r=((h=c.MedicationOrder)==null?void 0:h.saved)||[];if(r.length===0)return;const u=r.filter(p=>p.quantity>0).sort((p,w)=>new Date(w.start_date).getTime()-new Date(p.start_date).getTime())[0];if(!u)return;const m=new Date(u.start_date);m>=o&&m<=a&&(r.some(w=>new Date(w.start_date)>a)||i++)}),i}function _o(t){let e=0;return t.forEach(a=>{var c;(((c=a.MedicationOrder)==null?void 0:c.saved)||[]).some(r=>r.quantity<=0)&&e++}),e}function vo(t){const e={};let a=new Date;for(let c=0;c<4;c++){const r=dn(a),u=cn(r);e[u]={male:new Set,female:new Set},t.forEach(m=>{var b;const h=m.patientID,p=(b=m.personInformation)==null?void 0:b.gender,w=m.observations||[];let f=!1;w.forEach(_=>{var y;_.status==="saved"&&((y=_.obs)==null||y.forEach(T=>{const N=T.obs_datetime?new Date(T.obs_datetime):null;N&&N>=r&&N<=a&&(f=!0)}))}),f&&(p==="M"?e[u].male.add(h):p==="F"&&e[u].female.add(h))}),a=new Date(r),a.setDate(a.getDate()-1)}const o={};Object.entries(e).forEach(([c,r])=>{o[c]={male:r.male.size,female:r.female.size}});const i=un(o);return{categories:Object.keys(i),male:Object.values(i).map(c=>c.male),female:Object.values(i).map(c=>c.female)}}function yo(t){const e={};let a=new Date;for(let c=0;c<4;c++){const r=dn(a),u=cn(r);e[u]={type_one:new Set,type_two:new Set,hypertension:new Set},t.forEach(m=>{const h=m.patientID,p=m.observations||[];let w=null;p.forEach(f=>{var b;f.encounter_type===vt.DIAGNOSIS&&((b=f.obs)==null||b.forEach(_=>{const y=_.obs_datetime?new Date(_.obs_datetime):null;y&&y>=r&&y<=a&&_.concept_id===6542&&(w=_.value_coded)}))}),w===6409?e[u].type_one.add(h):w===6410?e[u].type_two.add(h):(w===8809||w===903)&&e[u].hypertension.add(h)}),a=new Date(r),a.setDate(a.getDate()-1)}const o={};Object.entries(e).forEach(([c,r])=>{o[c]={type_one:r.type_one.size,type_two:r.type_two.size,hypertension:r.hypertension.size}});const i=un(o);return{categories:Object.keys(i),type_one:Object.values(i).map(c=>c.type_one),type_two:Object.values(i).map(c=>c.type_two),hypertension:Object.values(i).map(c=>c.hypertension)}}function dn(t){const e=t.getMonth(),a=Math.floor(e/3)*3;return new Date(t.getFullYear(),a,1)}function cn(t){const e=Math.floor(t.getMonth()/3)+1;return"Q".concat(e," ").concat(t.getFullYear())}function un(t){return Object.fromEntries(Object.entries(t).reverse())}const bo={class:"cards-container"},Do={class:"top-card-text"},$o={class:"text-2xl font-bold"},wo={class:"top-card-text"},Co={class:"text-2xl font-bold"},ko={class:"top-card-text"},So={class:"text-2xl font-bold"},Io={class:"top-card-text"},Po={class:"text-2xl font-bold"},Ao={class:"top-card-text"},To={class:"text-2xl font-bold"},No={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},Oo={ref:"chartRef1"},Ro={key:1,class:"loading-state"},Lo={ref:"chartRef2"},Fo={key:1,class:"loading-state"},Vo=J({__name:"Dashboard",setup(t){const e=Te(),a=He();mo();const o=O(!1),i=O({total_pending_dispensations:0,total_defaulters:0,total_complications:0,total_client_registered:0,diagnosis_data:{series:[],categories:[]},gender_data:{series:[],categories:[]},isLoading:!1}),c=O([]),r=z(()=>({chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:i.value.gender_data.categories},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}})),u=z(()=>({chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:i.value.diagnosis_data.categories},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}})),m=async()=>{if(W.getLanConnectionStatus()||W.getPouchDbStatus())i.value=await fo();else{const w=R.toStandardHisFormat(R.sessionDate()),f=R.toStandardHisFormat(R.sessionDate()),b="programs/".concat(W.getProgramID(),"/reports/ncd_dashboard");i.value=await W.getJson(b,{start_date:w,end_date:f})}await de(),setTimeout(()=>{o.value=!0},100)},h=w=>{try{Bn.close(),e.push(w).then(()=>{})}catch(f){console.error(f)}},p=w=>{console.log("Setting active item:",w)};return he(()=>a.path,async()=>{await m()},{deep:!0}),ge(async()=>{await m()}),(w,f)=>{const b=g("ion-card-content"),_=g("ion-card");return d(),v(Z,null,[n("div",bo,[s(_,{class:"top-card action-card",onClick:f[0]||(f[0]=y=>p("appointments"))},{default:l(()=>[s(b,null,{default:l(()=>{var y;return[n("div",Do,[n("div",$o,D(((y=c.value)==null?void 0:y.length)||0),1),f[2]||(f[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]}),_:1})]),_:1}),s(_,{class:"top-card action-card"},{default:l(()=>[s(b,null,{default:l(()=>[n("div",wo,[n("div",Co,D(i.value.total_pending_dispensations),1),f[3]||(f[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]),_:1})]),_:1}),s(_,{class:"top-card action-card"},{default:l(()=>[s(b,null,{default:l(()=>[n("div",ko,[n("div",So,D(i.value.total_defaulters),1),f[4]||(f[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]),_:1})]),_:1}),s(_,{class:"top-card action-card"},{default:l(()=>[s(b,null,{default:l(()=>[n("div",Io,[n("div",Po,D(i.value.total_complications),1),f[5]||(f[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]),_:1})]),_:1}),s(_,{class:"top-card action-card",onClick:f[1]||(f[1]=y=>h("NCDActivePatients"))},{default:l(()=>[s(b,null,{default:l(()=>[n("div",Ao,[n("div",To,D(i.value.total_client_registered),1),f[6]||(f[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]),_:1})]),_:1})]),n("div",No,[s(_,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[s(b,null,{default:l(()=>[f[7]||(f[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",Oo,[o.value?(d(),H(C(Xe),{key:0,style:{width:"100%",height:"500px"},type:"bar",options:u.value,series:i.value.diagnosis_data.series},null,8,["options","series"])):A("",!0),i.value.isLoading?(d(),v("div",Ro,"Loading...")):A("",!0)],512)]),_:1})]),_:1}),s(_,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[s(b,null,{default:l(()=>[f[8]||(f[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",Lo,[o.value?(d(),H(C(Xe),{key:0,style:{width:"100%",height:"500px"},type:"line",options:r.value,series:i.value.gender_data.series},null,8,["options","series"])):A("",!0),i.value.isLoading?(d(),v("div",Fo,"Loading...")):A("",!0)],512)]),_:1})]),_:1})])],64)}}}),Bo=ee(Vo,[["__scopeId","data-v-a5d22305"]]),ct=Ht("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(t){this.selectedItem=t},getSelectedItem(){return this.selectedItem}},persist:!0}),Mo=()=>{const t=O(null);return{activeIteminMixin:t,setActiveItem:a=>{t.value=a,console.log("lll: ",t.value)}}},at=J({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:t,setActiveItem:e}=Mo();return{chevronBackOutline:Gt,checkmark:qn,grid:zn,chevronDownCircle:jn,chevronForwardCircle:Wn,chevronUpCircle:Un,colorPalette:Hn,document:En,globe:xn,medkit:qt,add:Mn,person:zt,people:jt,thermometer:Wt,clipboard:Ut,activeIteminMixin:t,setActiveItem:e}},async mounted(){await this.setAppointments()},computed:{...pe(re,["patient"])},watch:{$route:{async handler(t){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await Sa.getDailyAppointments(R.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((t,e)=>t.given_name.localeCompare(e.given_name)))},formatBirthdate(t){return R.getBirthdateAge(t)},setActiveItemRefFN(t){ct().setSelectedItem(t)}}}),xo=J({name:"Home",mixins:[tn,at],components:{IonContent:ue,IonHeader:_e,IonPage:xe,IonToolbar:Ne,IonRow:et,DateInputField:yt,IonIcon:X,IonButton:Se,IonCol:Ke,IonCard:Ue,IonCardHeader:ft,IonCardTitle:mt,IonCardContent:Ze,ViewToggleComponent:Ya,bottomNavBar:Xa,HorizontalLine:Ia},data(){const t=localStorage.getItem("ncdStartDate"),e=localStorage.getItem("ncdEndDate"),a=O(t||R.sessionDate()),o=O(e||R.sessionDate()),i=O(R.sessionDate()),c=O(R.sessionDate()),r=O([]),u=lt({page:1,itemsPerPage:10}),m=O(0),h=Ga(),p=O("list");return{minDate:i,startDate:a,endDate:o,people:r,calendarOutline:Ee,openOutline:Jt,maxDate:c,alertCircleOutline:xt,personOutline:Kn,idCardOutline:Zn,manOutline:Xn,womanOutline:Yn,locationOutline:Qn,timeOutline:Jn,todayOutline:Gn,pagination:u,totalCount:m,actionButtonStore:h,currentToggleView:p}},computed:{...pe(Pt,["NCDAppointmentsTogglePreference"]),paginatedPeople(){const t=(this.pagination.page-1)*this.pagination.itemsPerPage,e=t+this.pagination.itemsPerPage;return this.people.slice(t,e)},groupedPaginatedPeople(){const t={};this.paginatedPeople.forEach(o=>{const i=o.appointmentDate;t[i]||(t[i]=[]),t[i].push(o)});const e=Object.keys(t).sort((o,i)=>new Date(o)-new Date(i)),a={};return e.forEach(o=>{a[o]=t[o]}),a}},$route:{async handler(){},deep:!0},watch:{NCDAppointmentsTogglePreference:{handler(t){t&&t.toggle_view&&(this.currentToggleView=t.toggle_view)},deep:!0,immediate:!0}},async mounted(){this.initTogglePreference(),this.getAppointments(),this.HideHomePageActionButton()},async unmounted(){this.actionButtonStore.resetShowActionButton()},methods:{formatBirthdate(t){return R.getBirthdateAge(t)},async getAppointments(t=!1){if(nn().apiStatus){this.people=[],this.pagination.page=1;try{t==!0&&(this.startDate=R.sessionDate(),this.endDate=R.sessionDate(),this.getAppointmentsD1(this.startDate),this.getAppointmentsD2(this.endDate)),this.startDate>this.endDate&&(this.endDate=this.startDate),console.log(this.startDate,this.endDate),(await on.getAppointments(this.startDate,this.endDate,"")).forEach(o=>{const i=R.toStandardHisDisplayFormat(o.appointment_date);if(!this.people.some(r=>r.person_id===o.person_id&&r.appointmentDate===i)){const r={person_id:o.person_id,npid:o.npid,appointment_id:103,encounter_id:o.encounter_id,name:o.given_name.concat(" ",o.family_name),gender:o.gender,ageDob:this.formatBirthdate(o.birthdate),village:o.city_village,appointmentDate:i};this.people.push(r)}}),this.totalCount=this.people.length}catch(a){}}},async getAppointmentsD1(t){this.startDate=R.toStandardHisFormat(t),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=R.toStandardHisFormat(t),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(t){const e=await Le.findByNpid(t);re().setPatientRecord(e[0]),this.redirectUser()},handleViewChange(t){this.currentToggleView=t,this.initTogglePreference(t,!0)},initTogglePreference(t="list",e=!1){const a={toggle_view:t},o=Pt();Object.keys(this.NCDAppointmentsTogglePreference).length===0?(a.toggle_view="list",o.setNCDAppointmentsTogglePreference(a),this.currentToggleView="list"):e===!0?o.setNCDAppointmentsTogglePreference(a):this.currentToggleView=this.NCDAppointmentsTogglePreference.toggle_view||"list"},redirectUser(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(a=>e.some(o=>o.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")},handlePaginationUpdate({page:t,itemsPerPage:e}){if(e!==this.pagination.itemsPerPage){const a=(this.pagination.page-1)*this.pagination.itemsPerPage,o=Math.floor(a/e)+1,i=Math.ceil(this.totalCount/e);this.pagination.page=Math.min(o,i)||1,this.pagination.itemsPerPage=e}else this.pagination.page=t},HideHomePageActionButton(){this.actionButtonStore.setShowActionButton(!1)}}}),Eo={class:"appointments-container"},Ho={class:"date-filter"},Uo={key:0,style:{margin:"20px"}},Wo={key:1},jo={class:"appointments-table"},zo={key:2},qo={class:"date-group-header"},Go={class:"date-header-title"},Jo={class:"date-header-count"},Qo={class:"cards-container"},Yo={class:"card-details"},Xo={class:"detail-item"},Zo={class:"detail-value"},Ko={class:"detail-item"},ei={class:"detail-value"},ti={class:"detail-item"},ni={class:"detail-value"},ai={class:"detail-item"},si={class:"detail-value"};function oi(t,e,a,o,i,c){const r=g("DateInputField"),u=g("ion-col"),m=g("ion-icon"),h=g("ion-button"),p=g("ViewToggleComponent"),w=g("ion-row"),f=g("ion-card"),b=g("HorizontalLine"),_=g("ion-card-title"),y=g("ion-card-header"),T=g("ion-card-content"),N=g("ion-content"),L=g("bottomNavBar"),P=g("ion-footer");return d(),v("div",Eo,[n("div",Ho,[s(w,null,{default:l(()=>[s(u,null,{default:l(()=>[s(r,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),s(u,null,{default:l(()=>[s(r,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1}),s(u,null,{default:l(()=>[s(h,{color:"primary",onClick:e[0]||(e[0]=V=>t.getAppointments(!0)),class:"apt-btn"},{default:l(()=>[s(m,{icon:t.todayOutline,slot:"start"},null,8,["icon"]),e[1]||(e[1]=n("span",{style:{margin:"5px"}}," Today ",-1))]),_:1})]),_:1}),s(u,null,{default:l(()=>[s(p,{"initial-view":t.currentToggleView,onViewChanged:t.handleViewChange},null,8,["initial-view","onViewChanged"])]),_:1})]),_:1})]),s(N,{class:"scrollable-content"},{default:l(()=>[t.people.length===0?(d(),v("div",Uo,[s(m,{icon:t.alertCircleOutline,size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),e[2]||(e[2]=n("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Appointments for selected date range",-1))])):t.currentToggleView==="list"&&t.people.length>0?(d(),v("div",Wo,[s(f,null,{default:l(()=>[n("table",jo,[e[3]||(e[3]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),v(Z,null,ne(t.paginatedPeople,V=>(d(),v("tr",{key:V.npid},[n("td",null,[s(w,null,{default:l(()=>[s(u,null,{default:l(()=>[M(D(V.name),1)]),_:2},1024),s(u,null,{default:l(()=>[s(h,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:K=>t.openClientProfile(V.npid),color:"primary",fill:"clear",size:"small"},{default:l(()=>[s(m,{icon:t.openOutline,style:{"font-size":"28px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,D(V.npid),1),n("td",null,D(V.ageDob),1),n("td",null,D(V.gender),1),n("td",null,D(V.village),1),n("td",null,D(V.appointmentDate),1)]))),128))])])]),_:1})])):t.currentToggleView==="card"&&t.people.length>0?(d(),v("div",zo,[(d(!0),v(Z,null,ne(t.groupedPaginatedPeople,(V,K)=>(d(),v("div",{key:K,class:"date-group"},[n("div",qo,[s(m,{icon:t.calendarOutline,class:"date-header-icon"},null,8,["icon"]),n("h2",Go,D(K),1),n("div",Jo,D(V.length)+" appointment"+D(V.length!==1?"s":""),1)]),s(b,{color:"#006401",thickness:1,spacing:"sm"}),n("div",Qo,[(d(!0),v(Z,null,ne(V,j=>(d(),H(f,{key:j.npid,class:"appointment-card"},{default:l(()=>[s(y,null,{default:l(()=>[s(w,{class:"ion-align-items-center"},{default:l(()=>[s(u,null,{default:l(()=>[s(_,{class:"card-name"},{default:l(()=>[s(m,{icon:t.personOutline,class:"name-icon"},null,8,["icon"]),M(" "+D(j.name),1)]),_:2},1024)]),_:2},1024),s(u,{size:"auto"},{default:l(()=>[s(h,{onClick:ve=>t.openClientProfile(j.npid),color:"primary",fill:"clear",size:"small",class:"view-profile-btn"},{default:l(()=>[s(m,{icon:t.openOutline},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),s(T,null,{default:l(()=>[n("div",Yo,[n("div",Xo,[s(m,{icon:t.idCardOutline,class:"detail-icon"},null,8,["icon"]),e[4]||(e[4]=n("span",{class:"detail-label"},"NPID:",-1)),n("span",Zo,D(j.npid),1)]),n("div",Ko,[s(m,{icon:t.calendarOutline,class:"detail-icon"},null,8,["icon"]),e[5]||(e[5]=n("span",{class:"detail-label"},"Age/DOB:",-1)),n("span",ei,D(j.ageDob),1)]),n("div",ti,[s(m,{icon:j.gender==="Male"?t.manOutline:t.womanOutline,class:"detail-icon"},null,8,["icon"]),e[6]||(e[6]=n("span",{class:"detail-label"},"Gender:",-1)),n("span",ni,D(j.gender),1)]),n("div",ai,[s(m,{icon:t.locationOutline,class:"detail-icon"},null,8,["icon"]),e[7]||(e[7]=n("span",{class:"detail-label"},"Village:",-1)),n("span",si,D(j.village),1)])])]),_:2},1024)]),_:2},1024))),128))])]))),128))])):A("",!0)]),_:1}),t.people.length>0?(d(),H(P,{key:0,class:"sticky-footer"},{default:l(()=>[s(w,null,{default:l(()=>[s(u,{size:"12",style:{"max-width":"100%"}},{default:l(()=>[s(L,{totalItems:t.totalCount,currentPage:t.pagination.page,itemsPerPage:t.pagination.itemsPerPage,"onUpdate:pagination":t.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])]),_:1})]),_:1})]),_:1})):A("",!0)])}const ii=ee(xo,[["render",oi],["__scopeId","data-v-6d92a5ce"]]),ri={key:0,class:"left_col"},li={class:"nav-menu"},di=["onClick"],ci={class:"ellipsis"},ui={key:1,style:{"padding-left":"20px","padding-right":"20px"}},pi=J({__name:"NCDDashboard",setup(t){const e=ct(),a=z(()=>e.selectedItem),{screenWidth:o}=Pa(),i=O([{id:"dashboard",label:"Dashboard",icon:Qt},{id:"referrals",label:"Referrals",icon:ht},{id:"appointments",label:"Appointments",icon:Ee}]),c=O("dashboard"),r=qe(),{substance:u}=Qe(r);he(()=>u.value,(h,p)=>{h!==p&&console.log("Substance changed:",h)},{deep:!0,immediate:!0});const m=h=>{c.value=h,ct().setSelectedItem(c.value)};return he(()=>a.value,h=>{console.log("Active item from mixin changed:",h),h&&h!=null&&m(h)},{immediate:!0}),(h,p)=>{const w=g("ion-segment-button"),f=g("ion-segment");return d(),v("div",{style:Ye(C(o)>940?"display: flex":"display: block")},[C(o)>940?(d(),v("div",ri,[n("nav",li,[n("ul",null,[(d(!0),v(Z,null,ne(i.value,b=>(d(),v("li",{key:b.id,class:ce({active:c.value===b.id}),onClick:_=>m(b.id)},[s(C(X),{icon:b.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",ci,D(b.label),1)],10,di))),128))])])])):A("",!0),C(o)<=940?(d(),v("div",ui,[s(f,{value:c.value,style:{"margin-top":"5px","justify-content":"left"}},{default:l(()=>[(d(!0),v(Z,null,ne(i.value,b=>(d(),H(w,{value:b.id,key:b.id,class:ce({active:c.value===b.id}),onClick:_=>m(b.id)},{default:l(()=>[s(C(X),{icon:b.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,D(b.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):A("",!0),n("div",{class:"right_col",style:Ye(C(o)>940?"width: 85%":"width: 100%")},[n("div",null,[c.value==="referrals"?(d(),H(po,{key:0})):A("",!0),c.value==="dashboard"?(d(),H(Bo,{key:1})):A("",!0),c.value==="appointments"?(d(),H(ii,{key:2})):A("",!0)])],4)],4)}}}),mi=ee(pi,[["__scopeId","data-v-a1132315"]]);class fi extends W{constructor(){super()}static async getHTCDashboardSummary(e={}){return this.getJson("hts_stats",e)}}const hi={class:"content-wrapper dashboard"},gi={class:"header"},_i={class:"overlay"},vi={class:"big-number"},yi={class:""},bi={class:"cards"},Di={class:"card"},$i={class:"card-info"},wi={class:"card-number"},Ci={class:"card"},ki={class:"card-info"},Si={class:"card-number"},Ii={class:"card"},Pi={class:"card-info"},Ai={class:"card-number"},Ti={class:"card"},Ni={class:"card-info"},Oi={class:"card-number"},Ri={class:"section-title"},Li={class:"section"},Fi={class:"filter-bar"},Vi={class:"patient-list"},Bi=["onClick"],Mi={class:"status-tags"},xi={class:ce(["tag","yellow"])},Ei={class:"pagination"},Hi=["disabled"],Ui={class:"pagination-info"},Wi={class:"showing-info"},ji=["disabled"],it=5,zi=J({__name:"HTSDashboard",setup(t){const e=Te(),a=He(),o=re(),i=O({clients_with_conclusive_results:0,total_clients:0,clients_tested_today:0,clients_referred_to_ART:0,visit_scheduled_today:0,patient_data:[]}),c=O(""),r=O(1),u=z(()=>b.value.length),m=z(()=>Math.ceil(u.value/it)),h=z(()=>(r.value-1)*it),p=z(()=>Math.min(h.value+it,u.value)),w=z(()=>b.value.slice(h.value,p.value)),f=L=>L.toLowerCase().trim().replace(/\s+/g," "),b=z(()=>{if(!c.value.trim())return i.value.patient_data;const L=f(c.value);return i.value.patient_data.filter(P=>f(P.patient_name||"").includes(L)||f(P.patient_gender||"").includes(L)||f(P.program_names||"").includes(L)||String(P.patient_age).includes(L))});function _(){r.value<m.value&&r.value++}function y(){r.value>1&&r.value--}const T=async L=>{await o.setPatientRecord({patient_id:L.patient_id}),e.push("/patientProfile")};he(c,()=>{r.value=1}),he(a,async()=>{a.name=="Home"&&await N()}),ge(async()=>{await N()});async function N(){i.value=await fi.getHTCDashboardSummary()}return(L,P)=>(d(),H(C(ue),{class:"content"},{default:l(()=>{var V;return[n("div",hi,[n("div",gi,[n("div",_i,[n("h1",vi,D((V=i.value)==null?void 0:V.clients_with_conclusive_results),1),P[1]||(P[1]=n("p",{class:"header-text"},[M(" Total Number of Clients Tested"),n("br"),M(" with Conclusive Results ")],-1))])]),n("div",yi,[P[8]||(P[8]=n("h2",{class:"section-title"},"Today's Stats",-1)),n("div",bi,[n("div",Di,[n("div",$i,[s(C(X),{icon:C(ht),class:"card-icon"},null,8,["icon"])]),P[2]||(P[2]=n("div",{class:"card-info"},[n("p",null,"Total Clients")],-1)),n("div",wi,D(i.value.total_clients),1)]),n("div",Ci,[n("div",ki,[s(C(X),{icon:C(pt),class:"card-icon"},null,8,["icon"])]),P[3]||(P[3]=n("div",{class:"card-info"},[n("p",null,"Clients Tested Today")],-1)),n("div",Si,D(i.value.clients_tested_today),1)]),n("div",Ii,[n("div",Pi,[s(C(X),{icon:C(ea),class:"card-icon"},null,8,["icon"])]),P[4]||(P[4]=n("div",{class:"card-info"},[n("p",null,"Clients Referred To ART")],-1)),n("div",Ai,D(i.value.clients_referred_to_ART),1)]),n("div",Ti,[n("div",Ni,[s(C(X),{icon:C(Ee),class:"card-icon"},null,8,["icon"])]),P[5]||(P[5]=n("div",{class:"card-info"},[n("p",null,"Visit Scheduled Today")],-1)),n("div",Oi,D(i.value.visit_scheduled_today),1)])]),n("h2",Ri,"Patient Awaiting List ("+D(u.value)+")",1),n("div",Li,[n("div",Fi,[$e(n("input",{class:"search-input",type:"text",placeholder:"Search Patient","onUpdate:modelValue":P[0]||(P[0]=K=>c.value=K)},null,512),[[ta,c.value]])]),n("div",Vi,[(d(!0),v(Z,null,ne(w.value,K=>(d(),v("div",{class:"patient-item",key:K.id,onClick:j=>T(K)},[n("div",null,[n("strong",null,D(K.patient_name),1),n("p",null,D(K.patient_gender=="M"?"Male":"Female")+" â€¢ "+D(K.patient_age)+"y",1)]),n("div",Mi,[n("span",xi,D(K.program_names),1)])],8,Bi))),128))]),n("div",Ei,[n("button",{onClick:y,disabled:r.value===1,class:"pagination-btn"},[s(C(X),{icon:C(Gt)},null,8,["icon"]),P[6]||(P[6]=M(" Previous ",-1))],8,Hi),n("div",Ui,[M(" Page "+D(r.value)+" of "+D(m.value)+" ",1),n("span",Wi,"(Showing "+D(h.value+1)+"-"+D(p.value)+" of "+D(u.value)+")",1)]),n("button",{onClick:_,disabled:r.value===m.value,class:"pagination-btn"},[P[7]||(P[7]=M(" Next ",-1)),s(C(X),{icon:C(na)},null,8,["icon"])],8,ji)])])])])]}),_:1}))}}),qi=ee(zi,[["__scopeId","data-v-dde1df6c"]]),Bt={"HIV clinic registration":be.HIV_CLINIC_REGISTRATION,"HIV reception":be.HIV_RECEPTION,Vitals:be.VITALS,"HIV staging":be.HIV_STAGING,"HIV clinic consultation":be.HIV_CLINIC_CONSULTATION,"ART adherence":be.ART_ADHERENCE,Prescription:be.TREATMENT,Dispensing:be.DISPENSING,Appointments:be.APPOINTMENT};class Gi extends Aa{constructor(){super()}buildEncounters(e,a){return Object.entries(Bt).map(([o,i])=>({encounter:o,female:e?e[i].F:0,male:e?e[i].M:0,me:a?a[i].F+a[i].M:0,facility:e?e[i].F+e[i].M:0}))}async getStats(){const e=Object.values(Bt),a=Ta("reports/encounters",this.buildParams()),o=await W.postJson(a,{encounter_types:e}),i=await W.postJson(a,{encounter_types:e,all:!0});return this.buildEncounters(o.data,i.data)}getEncounterStats(e){return W.postJson("reports/encounters?date=".concat(this.date,"&program_id=1"),e)}}const Ji={class:"dashboard-container"},Qi={class:"main-section"},Yi={class:"chart-section"},Xi={class:"encounters-section"},Zi={class:"his-sm-text"},Ki={key:0},er={class:"encounter-td"},tr={class:"other-td"},nr={class:"other-td"},ar={class:"other-td"},sr={class:"other-td"},or={key:1},ir=J({__name:"ARTDashboard",setup(t){const e=O([]),a=lt({options:{chart:{id:"vuechart-example"},xaxis:{categories:["","","","",""]},yaxis:{min:0,forceNiceScale:!0,title:{text:"Number of clients",align:"left"}}},series:[{name:"Total visits",data:[0,0,0,0,0],color:"#7cb5ec"},{name:"Total incomplete visits",data:[0,0,0,0,0],color:"#434348"}]}),o=lt([{"HIV clinic registration":9},{"HIV reception":51},{Vitals:6},{"HIV staging":52},{"HIV clinic consultation":53},{"ART adherence":68},{Treatment:25},{Dispensing:54},{Appointments:7}]),i=()=>{e.value=o.map(u=>({encounter:Object.keys(u)[0],female:"",male:"",me:"",facility:""}))},c=async()=>{const u=new Za,m=W.getSessionDate();u.setStartDate(R.subtract(m,"days",5).format(At)),u.setEndDate(R.subtract(m,"days",1).format(At));const h=await u.getVisitStats(),p=[],w=[],f=[];Object.entries(h).forEach(([b,{incomplete:_,complete:y}])=>{f.push(aa(b).format("dddd")),p.push(_),w.push(_+y)}),a.series[0].data=[...w],a.series[1].data=[...p],a.options={...a.options,xaxis:{categories:[...f]}}},r=async()=>{try{const u=new Gi,m=o.map(w=>Object.values(w)[0]),h=await u.getEncounterStats({encounter_types:m}),p=await u.getEncounterStats({encounter_types:m,all:!0});e.value=o.map(w=>{const[f,b]=Object.entries(w)[0];return{encounter:f,female:p[b].F,male:p[b].M,me:h[b].F+h[b].M,facility:p[b].F+p[b].M}})}catch(u){console.error(u)}};return ge(()=>{i(),c(),r()}),(u,m)=>(d(),v("div",Ji,[n("div",Qi,[n("div",Yi,[m[0]||(m[0]=n("h3",null,"Total visits/incomplete visits: last 5 days",-1)),s(C(Xe),{width:"100%",height:"390px",type:"bar",options:a.options,series:a.series},null,8,["options","series"])]),n("div",Xi,[m[3]||(m[3]=n("h3",null,"Encounters created today",-1)),n("table",Zi,[m[2]||(m[2]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),e.value.length?(d(),v("tbody",Ki,[(d(!0),v(Z,null,ne(e.value,(h,p)=>(d(),v("tr",{key:p},[n("td",er,D(h.encounter),1),n("td",tr,D(h.female),1),n("td",nr,D(h.male),1),n("td",ar,D(h.me),1),n("td",sr,D(h.facility),1)]))),128))])):(d(),v("tbody",or,[...m[1]||(m[1]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])]))])])])]))}}),rr=ee(ir,[["__scopeId","data-v-9bb19378"]]);class rt extends W{static getlogs(e,a){return this.getJson("notification/logs",{startDate:e,endDate:a})}static clear(e){return this.putJson("notifications/clear/".concat(e),{id:e})}static read(e){return this.putJson("notifications/update",{alerts:e})}static unread(){return this.getJson("notifications")}}const De=O([]),lr=Te();function pn(){const t=z(()=>De.value.filter(p=>!p.read)),e=z(()=>De.value.length>0),a=z(()=>t.value.length>0),o=z(()=>t.value.length),i=z(()=>De.value.sort((p,w)=>new Date(p.date)>new Date(w.date)?-1:1));function c(p,w){Na("Are you sure you want to clear notification?").then(f=>{f&&rt.clear(p).then(()=>{De.value=De.value.filter(b=>b.id!=p),w(p),u()}).catch(b=>{console.error(b),oe("Unable to clear notification")})})}function r(p){return R.toStandardHisDisplayFormat(p)}async function u(){De.value=[];const p=await rt.unread();if(!Be.isEmpty(p)){const w={highVL:[],normalVL:[],rejectedVL:[]};let f={};De.value=p.map(b=>{let _="General";const y=b.text;let T=null;try{const N=JSON.parse(b.text);if(N.Type.match(/lims/i)){T=()=>lr.push("/art/encounters/lab/".concat(N.PatientID)),_="".concat(N["Test type"]," results for ").concat(N["ARV-Number"]||N["Accession number"]);const L=Oa.detectHighVl(N.Result[0].value,N.Result[0].value_modifier);f={handler:T,id:b.alert_id,arv:N["ARV-Number"],accession:N["Accession number"],order_date:r(N["Orde date"]),results:N.Result[0].value_modifier+" "+N.Result[0].value,results_date:r(N.Result[0].date)},L?w.highVL.push(f):N.rejection_reason?(f={handler:T,id:b.alert_id,arv:N.arv_number,accession:N.accession_number,order_date:r(N.order_date),rejection_reason:N.rejection_reason},w.rejectedVL.push(f)):L||w.normalVL.push(f)}}catch(N){console.warn(N)}return{handler:T,message:y,vlMessageObs:w,title:_,id:b.alert_id,date:r(b.date_created)}})}}async function m(p){rt.read([p.id]).then(()=>p.read=!0)}function h(p){typeof p.handler=="function"&&(m(p),p.handler())}return{markAsRead:m,openNotification:h,loadNotifications:u,clearNotification:c,sortedNotifications:i,hasUnreadNotifications:a,notificationCount:o,hasNotifications:e,notificationData:De}}const dr={class:"vl-alerts-container"},cr={class:"table-container"},ur={class:"vl-table"},pr={key:0},mr={key:0},fr=["colspan"],hr={key:0},gr=J({__name:"ARTVlAlert",setup(t){const e=O("high_vl"),{notificationData:a,loadNotifications:o,clearNotification:i,openNotification:c}=pn(),r=z(()=>{var _,y;return a.value.length?(((y=(_=a.value[0])==null?void 0:_.vlMessageObs)==null?void 0:y.highVL)||[]).length:0}),u=z(()=>{var _,y;return a.value.length?(((y=(_=a.value[0])==null?void 0:_.vlMessageObs)==null?void 0:y.rejectedVL)||[]).length:0}),m=z(()=>{var _,y;return a.value.length?(((y=(_=a.value[0])==null?void 0:_.vlMessageObs)==null?void 0:y.normalVL)||[]).length:0}),h=z(()=>{var _;if(!a.value.length)return[];const b=(_=a.value[0])==null?void 0:_.vlMessageObs;if(!b)return[];switch(e.value){case"high_vl":return b.highVL||[];case"rejected":return b.rejectedVL||[];case"normal":return b.normalVL||[];default:return[]}}),p=b=>c(b),w=b=>{b.id&&i(b.id,_=>{console.log("Cleared notification ".concat(_))})},f=()=>{switch(e.value){case"high_vl":return"No high viral load results found";case"rejected":return"No rejected samples found";case"normal":return"No normal results found";default:return"No results found"}};return ge(()=>{o()}),(b,_)=>(d(),v("div",dr,[s(C(gt),{mode:"ios",modelValue:e.value,"onUpdate:modelValue":_[0]||(_[0]=y=>e.value=y),class:"category-segment"},{default:l(()=>[s(C(Ie),{value:"high_vl"},{default:l(()=>[s(C(Pe),null,{default:l(()=>[M("High VL ("+D(r.value)+")",1)]),_:1})]),_:1}),s(C(Ie),{value:"rejected"},{default:l(()=>[s(C(Pe),null,{default:l(()=>[M("Rejected ("+D(u.value)+")",1)]),_:1})]),_:1}),s(C(Ie),{value:"normal"},{default:l(()=>[s(C(Pe),null,{default:l(()=>[M("Normal Results ("+D(m.value)+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",cr,[n("table",ur,[n("thead",null,[n("tr",null,[_[1]||(_[1]=n("th",null,"ARV #",-1)),_[2]||(_[2]=n("th",null,"Accession #",-1)),_[3]||(_[3]=n("th",null,"Order Date",-1)),e.value==="rejected"?(d(),v("th",pr,"Rejection Reason")):A("",!0),_[4]||(_[4]=n("th",null,"View",-1)),_[5]||(_[5]=n("th",null,"Clear",-1))])]),n("tbody",null,[h.value.length===0?(d(),v("tr",mr,[n("td",{colspan:e.value==="rejected"?6:5,class:"empty-message"},D(f()),9,fr)])):A("",!0),(d(!0),v(Z,null,ne(h.value,y=>(d(),v("tr",{key:y.id},[n("td",null,D(y.arv||"-"),1),n("td",null,D(y.accession||"-"),1),n("td",null,D(y.order_date||"-"),1),e.value==="rejected"?(d(),v("td",hr,D(y.rejection_reason||"-"),1)):A("",!0),n("td",null,[s(C(Se),{fill:"clear",size:"small",onClick:T=>p(y)},{default:l(()=>[s(C(X),{icon:C(Yt),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])]),n("td",null,[s(C(Se),{fill:"clear",size:"small",onClick:T=>w(y),color:"success"},{default:l(()=>[s(C(X),{icon:C(sa),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])])]))),128))])])])]))}}),_r=ee(gr,[["__scopeId","data-v-7b9c4735"]]),vr={class:"dashboard-container"},yr={class:"segment-content"},br={key:0},Dr={key:1},$r={key:2},wr=J({__name:"ARTHome",setup(t){const e=O("dashboard"),{notificationCount:a,loadNotifications:o}=pn();return ge(()=>{o()}),(i,c)=>(d(),v("div",vr,[s(C(gt),{modelValue:e.value,"onUpdate:modelValue":c[0]||(c[0]=r=>e.value=r)},{default:l(()=>[s(C(Ie),{value:"dashboard"},{default:l(()=>[...c[1]||(c[1]=[M(" Overview ",-1)])]),_:1}),s(C(Ie),{value:"viralLoadAlerts"},{default:l(()=>[n("div",yr,[c[2]||(c[2]=M(" VL Alerts ",-1)),C(a)>0?(d(),H(C(oa),{key:0,color:"primary"},{default:l(()=>[M(D(C(a)),1)]),_:1})):A("",!0)])]),_:1}),s(C(Ie),{value:"internalReferrals"},{default:l(()=>[...c[3]||(c[3]=[M(" Internal referrals ",-1)])]),_:1})]),_:1},8,["modelValue"]),e.value==="dashboard"?(d(),v("div",br,[s(rr)])):A("",!0),e.value==="viralLoadAlerts"?(d(),v("div",Dr,[s(_r)])):A("",!0),e.value==="internalReferrals"?(d(),v("div",$r,[s(ln)])):A("",!0)]))}}),Cr=ee(wr,[["__scopeId","data-v-d237cab2"]]);class kr{constructor(){me(this,"socket",null);me(this,"channel","ImmunizationReportChannel");me(this,"isConnected",!1);me(this,"pendingFetch",null);me(this,"location_id");me(this,"initPromise");me(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});me(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});me(this,"onError",e=>{console.error("WebSocket error:",e),this.isConnected=!1});this.initPromise=this.init()}async init(){const e=localStorage.getItem("apiURL"),a=localStorage.getItem("apiPort"),o=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const i="".concat(o,"://").concat(e,"/api/v1/cable");this.socket=new WebSocket(i),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(i){console.error(i),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const e={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(e))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await W.getJson("immunization/stats",{start_date:R.getDateBeforeByDays(R.sessionDate(),365),end_date:R.sessionDate()})}async setMessageHandler(e){await this.initPromise,this.socket?this.socket.onmessage=a=>{e(a)}:console.error("WebSocket connection not established.")}}const Sr=J({components:{IonContent:ue,IonHeader:_e,IonItem:Re,IonList:Oe,IonMenu:je,IonTitle:We,IonToolbar:Ne,IonInput:ut,BasicInputField:La,BasicForm:Ge,PreviousVitals:Ra,customDatePicker:es,IonCol:Ke,IonRow:et,VueMultiselect:ia,IonLabel:Pe,DataTable:Me},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:se,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:R.toStandardHisDisplayFormat(W.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...pe(Ka,["administerOtherVaccine"]),...pe(Tt,["tempScannedBatchNumber"]),...pe(re,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await ns(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:zt,pulseOutline:ra,clipboardOutline:pt}},methods:{formatBirthdate(t){return R.getBirthdateAge(t)},async openClientProfile(t){const e=await Le.findByID(t);await re().setPatientRecord(e),this.$router.push("patientProfile")},processData(){var e;return((e=this.data)==null?void 0:e.map(a=>{if(a.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let o=[];const i=c=>c.map(u=>{let m=0;return u.clients.map(h=>{(u.drug_name==this.drug_name&&(this.village==h.table.city_village||this.village=="All")||(u.drug_name==this.drug_name||this.village==h.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:h.table.given_name,family_name:h.table.family_name,patient_id:h.table.patient_id,birthdate:h.table.birthdate,city_village:h.table.city_village}),m++),this.villageList.push(h.table.city_village)}),[u.drug_name,m]}).filter(u=>u[1]!==0);return this.title=="Client due today"&&(o=i(a.value.due_today_antigens)),this.title=="Client due this week"&&(o=i(a.value.due_this_week_antigens)),this.title=="Client due this month"&&(o=i(a.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(o=i(a.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(o=i(a.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(c=>JSON.stringify(c)))].map(c=>JSON.parse(c)),this.villageList=[...new Set(this.villageList)],o}}))[0]},handleVillageClick(t){this.drug_name="",this.village=t,this.tableData=this.processData()},handleRowClick(t){var a;this.tableEvent=t.target;const e=this.tableEvent.closest("tr");if(e){const o=Array.from(((a=e.parentNode)==null?void 0:a.children)||[]).indexOf(e),i=this.tableData[o];this.drug_name=i[0],e.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(t){return R.calculateDisplayAge(t)},openPopover(t){this.event=t,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(t){var a;const e=t.target.value;this.batchNumber=e||((a=this.tempScannedBatchNumber)==null?void 0:a.text)||""},saveBatchWithTodayDate(){let t=W.getSessionDate();this.saveDta(t)},dismiss(){ze.dismiss()},saveBatch(){let t;Be.isEmpty(this.vaccineDate)==!0?t=W.getSessionDate():t=this.vaccineDate,this.saveDta(t)},validateVaccineName(){if(Be.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(Be.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(t){this.currentDrugOb=t},isAlphaNumeric(t){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(t)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(t){this.batchNumber=t},saveDta(t){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){oe("Enter batch number!");return}if(this.batchNumber==""){oe("Enter batch number!");return}const e={batch_number:this.batchNumber,date_administered:t,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},a=Tt();a.setAdministeredVaccine(e),ts(this.patient),this.dismiss(),a.setTempScannedBatchNumber(null)}}}),Ir={key:0,class:"spinner-overlay"},Pr={class:"header position_content"},Ar={style:{"font-size":"1.2em","font-weight":"700"}},Tr={class:"dueCardContent"},Nr=["onClick"],Or={style:{"margin-right":"15px"}},Rr={style:{"align-items":"center",display:"flex"}},Lr={style:{"line-height":"1"}},Fr={class:"client_name"},Vr={class:"name"},Br={class:"demographicsOtherRow"},Mr={class:"demographicsText"};function xr(t,e,a,o,i,c){const r=g("ion-spinner"),u=g("ion-icon"),m=g("ion-header"),h=g("ion-card-title"),p=g("ion-card-header"),w=g("DataTable"),f=g("ion-card-content"),b=g("ion-card"),_=g("ion-item"),y=g("ion-list"),T=g("ion-popover"),N=g("ion-content");return d(),v(Z,null,[t.isLoading?(d(),v("div",Ir,[s(r,{name:"bubbles"}),e[3]||(e[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):A("",!0),s(m,null,{default:l(()=>[n("div",Pr,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=L=>t.dismiss())},[s(u,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Ar,D(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=L=>t.openPopover(L))},[s(u,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),s(N,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:l(()=>[n("div",null,[s(b,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:l(()=>[s(p,null,{default:l(()=>[s(h,{class:"sectionTitle"},{default:l(()=>[...e[4]||(e[4]=[M(" Summary of required doses ",-1)])]),_:1})]),_:1}),s(f,null,{default:l(()=>[n("div",Tr,[s(w,{options:t.options,data:t.tableData,class:"display nowrap",width:"100%",onClick:t.handleRowClick},{default:l(()=>[...e[5]||(e[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])]),_:1},8,["options","data","onClick"])])]),_:1})]),_:1}),s(b,{class:"section",style:{"margin-inline":"0px"}},{default:l(()=>[s(p,null,{default:l(()=>[s(h,{class:"sectionTitle"},{default:l(()=>[...e[6]||(e[6]=[M("Client Details ",-1)])]),_:1})]),_:1}),s(f,null,{default:l(()=>[(d(!0),v(Z,null,ne(t.clientDetails,(L,P)=>(d(),v("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:P,onClick:V=>t.openClientProfile(L.patient_id)},[n("div",Or,[n("div",{class:ce((L==null?void 0:L.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[s(u,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),n("div",Rr,[n("div",Lr,[n("div",Fr,[n("div",Vr,D(L.given_name)+" "+D(L.family_name),1)]),n("div",Br,[n("div",Mr,[M(D(L.gender=="M"?"Male":"Female")+" ",1),e[7]||(e[7]=n("span",{class:"dot"},".",-1)),M(D(t.formatBirthdate(L.birthdate)),1)])]),n("div",null,"Village: "+D(L.city_village),1)])])],8,Nr))),128))]),_:1})]),_:1})]),s(T,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:t.event,onDidDismiss:e[2]||(e[2]=L=>t.popoverOpen=!1)},{default:l(()=>[n("div",null,[e[8]||(e[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(d(!0),v(Z,null,ne(t.villageList,(L,P)=>(d(),H(y,{class:ce(L==t.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:P},{default:l(()=>[s(_,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:V=>t.handleVillageClick(L)},{default:l(()=>[M(D(L),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const Er=ee(Sr,[["render",xr],["__scopeId","data-v-dfc02771"]]),Hr=J({name:"Menu",mixins:[at],components:{IonContent:ue,IonHeader:_e,IonItem:Re,IonList:Oe,IonMenu:je,IonTitle:We,IonToolbar:Ne,IonCheckbox:tt,BasicForm:Ge,BasicCard:nt,Carousel:ua,Slide:ca,Pagination:da,Navigation:la},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},setup(){return{personCircleOutline:Et}},computed:{...pe(qe,["substance"]),backgroundStyle(){return{background:"linear-gradient(135deg, rgba(32, 178, 170, 0.95) 0%, rgba(64, 192, 176, 0.9) 50%, rgba(150, 220, 200, 0.85) 100%), url(".concat(as("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",minHeight:"240px"}}},watch:{},async mounted(){new kr().setMessageHandler(this.onMessage)},methods:{async onMessage(t){var a,o,i;const e=JSON.parse(t.data);e.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=e.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((a=this.reportData)==null?void 0:a.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((o=this.reportData)==null?void 0:o.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((i=this.reportData)==null?void 0:i.total_male_vaccinated_this_year)||0}])},openDueModal(t){const e={title:t,dashBoardData:this.reportData};Ve(Er,{class:"fullScreenModal"},!0,e)},async openClientProfile(t){const e=await Le.findByNpid(t);await re().setPatientRecord(e[0]),this.$router.push("patientProfile")}}}),Ur={class:"topStats"},Wr={class:"hero-section"},jr={class:"totalStats"},zr={class:"statsValue"},qr={class:"statsText"},Gr={class:"dueCardContent"},Jr={class:"statsValue"},Qr={class:"statsValue"},Yr={class:"statsValue"},Xr={class:"overDueCardContent"},Zr={class:"statsValue"},Kr={class:"statsValue"},el={class:"appointment-count"},tl={key:0,class:"appointments-list"},nl=["onClick"],al={class:"avatar-container"},sl={class:"appointment-details"},ol={class:"client-name"},il={class:"client-info"},rl={class:"info-badge"},ll={class:"client-location"},dl={key:1,class:"empty-state"};function cl(t,e,a,o,i,c){const r=g("Slide"),u=g("Pagination"),m=g("Carousel"),h=g("ion-card-title"),p=g("ion-card-header"),w=g("ion-card-content"),f=g("ion-card"),b=g("ion-icon"),_=g("ion-content");return d(),H(_,{class:"content"},{default:l(()=>[n("div",Ur,[n("div",Wr,[n("div",{style:Ye(t.backgroundStyle)},[s(m,{autoplay:4e3,"wrap-around":!0,itemsToShow:1,transition:600,class:"stats-carousel"},{addons:l(()=>[s(u)]),default:l(()=>[(d(!0),v(Z,null,ne(t.totalStats,y=>(d(),H(r,{key:y},{default:l(()=>[n("div",jr,[e[5]||(e[5]=n("div",{class:"stats-icon"},"ðŸ“Š",-1)),n("div",zr,D(y.value),1),n("div",qr,D(y.name),1)])]),_:2},1024))),128))]),_:1})],4)]),s(f,{class:"section modern-card"},{default:l(()=>[s(p,null,{default:l(()=>[s(h,{class:"cardTitle"},{default:l(()=>[...e[6]||(e[6]=[n("span",{class:"title-icon"},"ðŸ“…",-1),M(" Clients Due ",-1)])]),_:1})]),_:1}),s(w,null,{default:l(()=>{var y,T,N;return[n("div",Gr,[n("div",{class:"dueCard today-card",onClick:e[0]||(e[0]=L=>t.openDueModal("Client due today"))},[e[7]||(e[7]=n("div",{class:"card-badge success"},"Today",-1)),n("div",Jr,D(((y=t.reportData)==null?void 0:y.due_today_count)||0),1),e[8]||(e[8]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard week-card",onClick:e[1]||(e[1]=L=>t.openDueModal("Client due this week"))},[e[9]||(e[9]=n("div",{class:"card-badge warning"},"Week",-1)),n("div",Qr,D(((T=t.reportData)==null?void 0:T.due_this_week_count)||0),1),e[10]||(e[10]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard month-card",onClick:e[2]||(e[2]=L=>t.openDueModal("Client due this month"))},[e[11]||(e[11]=n("div",{class:"card-badge danger"},"Month",-1)),n("div",Yr,D(((N=t.reportData)==null?void 0:N.due_this_month_count)||0),1),e[12]||(e[12]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),s(f,{class:"section modern-card"},{default:l(()=>[s(p,null,{default:l(()=>[s(h,{class:"cardTitle"},{default:l(()=>[...e[13]||(e[13]=[n("span",{class:"title-icon"},"âš ï¸",-1),M(" Clients Overdue ",-1)])]),_:1})]),_:1}),s(w,null,{default:l(()=>{var y,T;return[n("div",Xr,[n("div",{class:"overDueCard",onClick:e[3]||(e[3]=N=>t.openDueModal("Client overdue under 5yrs"))},[e[14]||(e[14]=n("div",{class:"overdue-icon"},"ðŸ‘¶",-1)),n("div",Zr,D(((y=t.reportData)==null?void 0:y.under_five_overdue)||0),1),e[15]||(e[15]=n("div",{class:"statsText"},"Under 5 years",-1))]),n("div",{class:"overDueCard",onClick:e[4]||(e[4]=N=>t.openDueModal("Client overdue over 5yrs"))},[e[16]||(e[16]=n("div",{class:"overdue-icon"},"ðŸ§’",-1)),n("div",Kr,D(((T=t.reportData)==null?void 0:T.over_five_overdue)||0),1),e[17]||(e[17]=n("div",{class:"statsText"},"Over 5 years",-1))])])]}),_:1})]),_:1}),s(f,{class:"section modern-card appointments-card"},{default:l(()=>[s(p,null,{default:l(()=>[s(h,{class:"cardTitle"},{default:l(()=>{var y;return[e[18]||(e[18]=n("span",{class:"title-icon"},"ðŸ—“ï¸",-1)),e[19]||(e[19]=M(" Today's Appointments ",-1)),n("span",el,D(((y=t.appointments)==null?void 0:y.length)||0),1)]}),_:1})]),_:1}),s(w,null,{default:l(()=>{var y;return[((y=t.appointments)==null?void 0:y.length)>0?(d(),v("div",tl,[(d(!0),v(Z,null,ne(t.appointments,(T,N)=>(d(),v("div",{class:"appointment-item",key:N,onClick:L=>t.openClientProfile(T.npid)},[n("div",al,[n("div",{class:ce(T.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[s(b,{class:"person-icon",icon:t.personCircleOutline},null,8,["icon"])],2)]),n("div",sl,[n("div",ol,D(T.given_name)+" "+D(T.family_name),1),n("div",il,[n("span",rl,D(T.gender=="M"?"Male":"Female"),1),e[20]||(e[20]=n("span",{class:"dot"},"â€¢",-1)),n("span",null,D(t.formatBirthdate(T.birthdate)),1)]),n("div",ll,[e[21]||(e[21]=n("span",{class:"location-icon"},"ðŸ“",-1)),M(" "+D(T==null?void 0:T.city_village),1)])]),e[22]||(e[22]=n("div",{class:"appointment-arrow"},"â€º",-1))],8,nl))),128))])):(d(),v("div",dl,[...e[23]||(e[23]=[n("div",{class:"empty-icon"},"ðŸ“‹",-1),n("p",null,"No appointments scheduled for today",-1)])]))]}),_:1})]),_:1})])]),_:1})}const ul=ee(Hr,[["render",cl],["__scopeId","data-v-c322c517"]]),pl=J({components:{DataTable:Me},props:{title:{type:String,default:""},list:{type:String,default:""},buttonTitle:{type:String,default:""},buttonLink:{type:String,default:""}},data(){return{patients:[],loadingStates:{},tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:(t,e)=>{if(!t)return"-";const a=new Date(t).getTime(),o=Date.now()-a,i=Math.floor(o/6e4),c=(()=>{if(i<1)return"Just now";if(i<60)return"".concat(i," min").concat(i>1?"s":""," ago");const r=Math.floor(i/60);if(r<24)return"".concat(r," hour").concat(r>1?"s":""," ago");const u=Math.floor(r/24);return"".concat(u," day").concat(u>1?"s":""," ago")})();return e==="display"?c:o},type:"num",width:"15%"},{title:"Actions",data:null,render:(t,e,a)=>{const o=document.createElement("div");o.style.display="flex",o.style.gap="6px",o.setAttribute("data-patient-id",a.identifier);const i="  --padding-top: 4px;\n                                            --padding-bottom: 4px;\n                                            --padding-start: 8px;\n                                            --padding-end: 8px;\n                                            font-size: 0.8rem;\n                                            height: 28px;\n                                            min-width: 70px;\n                                            white-space: nowrap;\n                                            ",c=(r,u,m,h)=>{const p=document.createElement("ion-button");p.setAttribute("data-button-type",h),p.size="small",p.fill="solid",p.color=u,p.style.cssText=i;const w=document.createElement("span");w.className="button-text",w.innerText=r;const f=document.createElement("ion-spinner");return f.name="crescent",f.className="button-spinner",f.style.display="none",f.style.width="16px",f.style.height="16px",p.appendChild(w),p.appendChild(f),p.addEventListener("click",m),p};return o.appendChild(c(this.buttonTitle,"primary",()=>this.navigateTo(a,this.buttonLink),"primary")),o.appendChild(c("Profile","warning",()=>this.navigateTo(a,"/patientProfile"),"profile")),o.appendChild(c("Abscond","danger",()=>this.handleAbscond(a.identifier),"abscond")),o},orderable:!1,width:"25%"}],tableOptions:{order:[[1,"desc"]]}}},computed:{...pe(dt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{patientsWaitingForConsultation:{handler(t){this.list==="CONSULTATION"&&(this.patients=t)},deep:!0},patientsWaitingForVitals:{handler(t){this.list==="VITALS"&&(this.patients=t)},deep:!0},patientsWaitingForLab:{handler(t){this.list==="LAB"&&(this.patients=t)},deep:!0},patientsWaitingForDispensation:{handler(t){this.list==="DISPENSATION"&&(this.patients=t)},deep:!0}},mounted(){this.setList()},methods:{setList(){const t={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation},e=this.list;this.patients=t[e]||[]},setButtonLoading(t,e,a){const o=document.querySelector('[data-patient-id="'.concat(t,'"]'));if(!o)return;const i=o.querySelector('[data-button-type="'.concat(e,'"]'));if(!i)return;const c=i.querySelector(".button-text"),r=i.querySelector(".button-spinner");a?(i.setAttribute("disabled","true"),c&&(c.style.display="none"),r&&(r.style.display="inline-block")):(i.removeAttribute("disabled"),c&&(c.style.display="inline"),r&&(r.style.display="none"))},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),a=Math.floor(e/6e4);if(a<1)return"Just now";if(a<60)return"".concat(a," min").concat(a>1?"s":""," ago");const o=Math.floor(a/60);if(o<24)return"".concat(o," hour").concat(o>1?"s":""," ago");const i=Math.floor(o/24);return"".concat(i," day").concat(i>1?"s":""," ago")},async navigateTo(t,e){const a=e===this.buttonLink?"primary":"profile";this.setButtonLoading(t.identifier,a,!0);try{let o=[],i=null;W.getPouchDbStatus()||W.getLanConnectionStatus()?(o=await Ae("patients_records",{selector:{ID:t.identifier}}),i=o[0]):i||(i=await W.getJson("/patients/".concat(t.patient_id,"/get_patient_record")));const c=i;if(await re().setPatientRecord(c),await de(),an()){this.$router.push("/deathPatientProfile");return}this.$router.push(e)}catch(o){console.error("Error navigating:",o)}finally{this.setButtonLoading(t.identifier,a,!1)}},async handleAbscond(t){this.setButtonLoading(t,"abscond",!0);try{await Fa({ID:t})}catch(e){console.error("Error closing visit:",e)}finally{this.setButtonLoading(t,"abscond",!1)}},dismiss(){ze.dismiss()}}}),ml={class:"modal-container"},fl={class:"dueCardContent"};function hl(t,e,a,o,i,c){const r=g("ion-button"),u=g("ion-card-title"),m=g("ion-card-header"),h=g("DataTable"),p=g("ion-card-content"),w=g("ion-card");return d(),v("div",ml,[s(r,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:l(()=>[...e[0]||(e[0]=[M(" Close ",-1)])]),_:1},8,["onClick"]),s(w,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:l(()=>[s(m,null,{default:l(()=>[s(u,{class:"sectionTitle"},{default:l(()=>[M(D(t.title),1)]),_:1})]),_:1}),s(p,null,{default:l(()=>[n("div",fl,[s(h,{data:t.patients,options:t.tableOptions,columns:t.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const gl=ee(pl,[["render",hl],["__scopeId","data-v-ab268e6c"]]),_l=J({components:{IonContent:ue,IonHeader:_e,IonItem:Re,IonList:Oe,IonIcon:X,IonCard:Ue,IonCardHeader:ft,IonCardTitle:mt,IonCardContent:Ze,IonPopover:_t,DataTable:Me},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:se,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:t=>this.waitingTime(t),width:"20%"},{title:"Actions",data:null,render:(t,e,a)=>{const o=document.createElement("div");o.style.display="flex",o.style.gap="6px",o.setAttribute("data-patient-id",a.identifier);const i="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",c=(r,u,m,h)=>{const p=document.createElement("ion-button");p.setAttribute("data-button-type",h),p.size="small",p.fill="solid",p.color=u,p.style.cssText=i;const w=document.createElement("span");w.className="button-text",w.innerText=r;const f=document.createElement("ion-spinner");return f.name="crescent",f.className="button-spinner",f.style.display="none",f.style.width="16px",f.style.height="16px",p.appendChild(w),p.appendChild(f),p.addEventListener("click",m),p};return o.appendChild(c("Profile","warning",()=>this.navigateTo(t,"/patientProfile"),"profile")),o},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[1,"desc"],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const t=await Va();this.patients=t.map(e=>({fullName:e.fullName||"",arrivalTime:e.startDate||"",patient_id:e.patientId||"",identifier:e.identifier||""}))},methods:{setButtonLoading(t,e,a){const o=document.querySelector('[data-patient-id="'.concat(t,'"]'));if(!o)return;const i=o.querySelector('[data-button-type="'.concat(e,'"]'));if(!i)return;const c=i.querySelector(".button-text"),r=i.querySelector(".button-spinner");a?(i.setAttribute("disabled","true"),c&&(c.style.display="none"),r&&(r.style.display="inline-block")):(i.removeAttribute("disabled"),c&&(c.style.display="inline"),r&&(r.style.display="none"))},openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){ze.dismiss()},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),a=Math.floor(e/6e4);if(a<1)return"Just now";if(a<60)return"".concat(a," min").concat(a>1?"s":""," ago");const o=Math.floor(a/60);if(o<24)return"".concat(o," hour").concat(o>1?"s":""," ago");const i=Math.floor(o/24);return"".concat(i," day").concat(i>1?"s":""," ago")},async navigateTo(t,e){this.setButtonLoading(t.identifier,"profile",!0);try{let a;(W.getPouchDbStatus()||W.getLanConnectionStatus())&&(a=await Ae("patients_records",{selector:{ID:t.identifier}}),a=a[0]),a||(a=await Le.findByID(t.patient_id)),a?(await re().setPatientRecord(a),await de(),an()?this.$router.push("/deathPatientProfile"):this.$router.push(e)):(oe("Patient not found. Please try searching the patient by name."),this.setButtonLoading(t.identifier,"profile",!1))}catch(a){console.error("Error navigating to profile:",a),this.setButtonLoading(t.identifier,"profile",!1)}}}}),vl={class:"modal-container"},yl={class:"dueCardContent"};function bl(t,e,a,o,i,c){const r=g("ion-button"),u=g("ion-card-title"),m=g("ion-card-header"),h=g("DataTable"),p=g("ion-card-content"),w=g("ion-card");return d(),v("div",vl,[s(r,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:l(()=>[...e[0]||(e[0]=[M(" Close ",-1)])]),_:1},8,["onClick"]),s(w,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:l(()=>[s(m,null,{default:l(()=>[s(u,{class:"sectionTitle"},{default:l(()=>[M(D(t.title),1)]),_:1})]),_:1}),s(p,null,{default:l(()=>[n("div",yl,[s(h,{data:t.patients,options:t.tableOptions,columns:t.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const Dl=ee(_l,[["render",bl],["__scopeId","data-v-5866989b"]]),$l=J({name:"OPDAppointmentsModal",components:{IonPage:xe,IonHeader:_e,IonContent:ue,IonItem:Re,IonList:Oe,IonIcon:X,IonCard:Ue,IonCardContent:Ze,IonPopover:_t,DataTable:Me,IonSegment:gt,IonSegmentButton:Ie,IonLabel:Pe,IonRow:et,IonCol:Ke,DateInputField:yt},props:{title:{type:String,default:"OPD Appointments"},programType:{type:String,required:!0},programId:{type:Number,required:!0}},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:se,appointments:[],viewMode:"today",startDate:R.sessionDate(),endDate:R.sessionDate(),calendarOutline:Ee,openOutline:Jt,tableColumns:[{title:"Patient ID",data:"ID"},{title:"Name",data:"name"},{title:"Age/DOB",data:"ageDob"},{title:"Gender",data:"gender"},{title:"Village",data:"village"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(t,e,a)=>{const o=document.createElement("div"),i=document.createElement("ion-button");return i.innerText="Profile",i.size="small",i.style.color="#fff",i.style.padding="8px 12px",i.style.marginRight="8px",i.addEventListener("click",()=>this.openClientProfile(a.ID)),o.appendChild(i),o},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,order:[[5,"asc"]]}}},async mounted(){await this.loadAppointments()},methods:{async loadAppointments(){this.isLoading=!0;try{const t=R.sessionDate(),e=this.viewMode==="today"?t:this.startDate,a=this.viewMode==="today"?t:this.endDate,o=localStorage.getItem("locationID"),i=typeof e=="string"?e:R.toStandardHisFormat(e),c=typeof a=="string"?a:R.toStandardHisFormat(a),u=(await Ae("patients_records")).flatMap(m=>{var p,w;return[...((p=m.appointments)==null?void 0:p.saved)||[],...((w=m.appointments)==null?void 0:w.unsaved)||[]].filter(f=>{if(!(f!=null&&f.value_datetime)||f.location_id&&f.location_id!==o)return!1;const b=R.toStandardHisFormat(f.value_datetime);return b>=i&&b<=c}).map(f=>{var b,_,y,T,N;return{ID:m.ID,name:[(b=m.personInformation)==null?void 0:b.given_name,(_=m.personInformation)==null?void 0:_.family_name].filter(Boolean).join(" ")||"Unknown",ageDob:(y=m.personInformation)!=null&&y.birthdate?R.getBirthdateAge(m.personInformation.birthdate):"N/A",gender:((T=m.personInformation)==null?void 0:T.gender)||"Unknown",village:((N=m.personInformation)==null?void 0:N.home_village)||"Unknown",appointmentDate:R.toStandardHisDisplayFormat(f.value_datetime),appointmentDateTime:f.value_datetime,rawData:f}})}).sort((m,h)=>new Date(m.appointmentDateTime).getTime()-new Date(h.appointmentDateTime).getTime());this.appointments=u,console.log("Found ".concat(u.length," appointments"))}catch(t){console.error("Error loading appointments:",t),Nt("Failed to load appointments")}finally{this.isLoading=!1}},async getAppointmentsD1(t){this.startDate=R.toStandardHisFormat(t),await this.loadAppointments()},async getAppointmentsD2(t){this.endDate=R.toStandardHisFormat(t),await this.loadAppointments()},onViewModeChange(){this.viewMode==="today"&&(this.startDate=R.sessionDate(),this.endDate=R.sessionDate()),this.loadAppointments()},async openClientProfile(t){try{const e=await Ae("patients_records",{selector:{ID:t}});await re().setPatientRecord(e[0]),this.$router.push("patientProfile")}catch(e){console.error("Error opening profile:",e),Nt("Failed to open patient profile")}},openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){ze.dismiss()}}}),wl={class:"header position_content"},Cl={style:{"font-size":"1.2em","font-weight":"700"}},kl={key:0,class:"date-filter"},Sl={class:"dueCardContent"},Il={key:1,class:"no-appointments"};function Pl(t,e,a,o,i,c){const r=g("ion-icon"),u=g("ion-header"),m=g("ion-label"),h=g("ion-segment-button"),p=g("ion-segment"),w=g("DateInputField"),f=g("ion-col"),b=g("ion-row"),_=g("DataTable"),y=g("ion-card-content"),T=g("ion-card"),N=g("ion-content"),L=g("ion-page");return d(),H(L,null,{default:l(()=>[s(u,null,{default:l(()=>[n("div",wl,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=(...P)=>t.dismiss&&t.dismiss(...P))},[s(r,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Cl,D(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=P=>t.openPopover(P))},[s(r,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),s(N,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:l(()=>[s(p,{modelValue:t.viewMode,"onUpdate:modelValue":e[2]||(e[2]=P=>t.viewMode=P),onIonChange:t.onViewModeChange},{default:l(()=>[s(h,{value:"today"},{default:l(()=>[s(m,null,{default:l(()=>[...e[3]||(e[3]=[M("Today's Appointments",-1)])]),_:1})]),_:1}),s(h,{value:"range"},{default:l(()=>[s(m,null,{default:l(()=>[...e[4]||(e[4]=[M("Date Range",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","onIonChange"]),t.viewMode==="range"?(d(),v("div",kl,[s(b,null,{default:l(()=>[s(f,null,{default:l(()=>[s(w,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:t.endDate,disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","maxDate","onUpdate:rawDateValue"])]),_:1}),s(f,null,{default:l(()=>[s(w,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):A("",!0),s(T,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:l(()=>[s(y,null,{default:l(()=>[n("div",Sl,[t.appointments.length>0?(d(),H(_,{key:0,data:t.appointments,columns:t.tableColumns,options:t.tableOptions,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns","options"])):(d(),v("div",Il," No appointments found for the selected "+D(t.viewMode==="today"?"day":"date range"),1))])]),_:1})]),_:1})]),_:1})]),_:1})}const Al=ee($l,[["render",Pl],["__scopeId","data-v-e54f2168"]]),Tl={class:"card-count"},Nl={class:"card-label"},Ol="#ffffff",Rl=J({__name:"DashboardCard",props:{icon:{},count:{},label:{},color:{}},emits:["cardClick"],setup(t,{emit:e}){const i={success:"#A5D6A7",info:"#81D4FA",warning:"#FFF59D",danger:"#EF9A9A"}[t.color||"info"]||"#E0E0E0";return(c,r)=>(d(),H(C(Ue),{class:"dashboard-card",style:Ye({borderColor:C(i),backgroundColor:Ol}),onClick:r[0]||(r[0]=u=>c.$emit("cardClick"))},{default:l(()=>[s(C(X),{icon:t.icon,class:"card-icon"},null,8,["icon"]),n("div",Tl,D(t.count),1),n("div",Nl,D(t.label),1)]),_:1},8,["style"]))}}),Ll=ee(Rl,[["__scopeId","data-v-84ad3c1b"]]),Fl=()=>({deathOutcomeForm:z(()=>[{componentType:"Heading",name:"Death Details",position:"center",grid:{s:"12"}},{componentType:"inputField",header:"Place of death",name:"Place of death",icon:se.editPen,grid:{s:"12"},validation:e=>!e||e===""?"Place of death is required":null},{componentType:"dateInputField",header:"Date of death",name:"Date of death",icon:se.calenderPrimary,showTodayButton:!0,grid:{s:"12"},validation:e=>!e||e===""?"Date of death is required":null},{componentType:"timeInputField",header:"Time of death",name:"Time Of Death",showNowButton:!0,icon:se.calenderPrimary,grid:{s:"12"},validation:e=>!e||e===""?"Time of death is required":null},{componentType:"inputField",header:"Name of guardian",name:"Guardian; name and first names",icon:se.editPen,grid:{s:"12"},validation:e=>!e||e===""?"Guardian name is required":null},{componentType:"phoneInputField",header:"Guardian phone number",name:"Phone number",grid:{s:"12"},validation:e=>Ba.isMWPhoneNumber(e.phoneNumber)},{componentType:"checkboxField",name:"Pregnant woman",type:"single",label:"Was the individual pregnant at the time of death?",grid:{s:"12"},condition:e=>e._isChildBearing===!0},{componentType:"dateInputField",header:"Date arrived",name:"Death on arrival",showTodayButton:!0,icon:se.calenderPrimary,grid:{s:"12"},validation:e=>!e||e===""?"Date arrived is required":null},{componentType:"timeInputField",header:"Time arrived",name:"Time to clinic",icon:se.calenderPrimary,grid:{s:"12"},showNowButton:!0,validation:e=>!e||e===""?"Time arrived is required":null},{componentType:"multiSelectInputField",header:"Cause of death",name:"Cause of death",trackBy:"id",isMultiple:!1,grid:{s:"12"},options:[{id:1,name:"Natural"},{id:2,name:"Accident"},{id:3,name:"Homicide"},{id:4,name:"Suicide"},{id:5,name:"Pending investigation"},{id:6,name:"Could not be determined"},{id:7,name:"Other - specify"}],validation:e=>e?null:"Cause of death is required",onChange:e=>{const a={},o=typeof e=="object"&&e!==null?e.name:e;return o!=="Other - specify"&&(a["Other notes"]=""),o!=="Accident"&&(a["Road traffic accident"]=""),a}},{componentType:"inputField",header:"Specify other manner of death",name:"Other notes",icon:se.editPen,grid:{s:"12"},validation:(e,a)=>{const o=a==null?void 0:a["Cause of death"];return(typeof o=="object"&&o!==null?o.name:o)==="Other - specify"&&(!e||e==="")?"Please specify other manner of death":null},condition:e=>{const a=e==null?void 0:e["Cause of death"];return(typeof a=="object"&&a!==null?a.name:a)==="Other - specify"}},{componentType:"multiSelectInputField",header:"How did the accident occur?",name:"Road traffic accident",trackBy:"id",isMultiple:!1,grid:{s:"12"},options:[{id:1,name:"Motor vehicle (passenger)"},{id:2,name:"Motor vehicle (pedestrian)"},{id:3,name:"Drowning"},{id:4,name:"Other - specify"}],validation:(e,a)=>{const o=a==null?void 0:a["Cause of death"];return(typeof o=="object"&&o!==null?o.name:o)==="Accident"&&!e?"Please specify how the accident occurred":null},condition:e=>{const a=e==null?void 0:e["Cause of death"];return(typeof a=="object"&&a!==null?a.name:a)==="Accident"},onChange:e=>{const a={};return(typeof e=="object"&&e!==null?e.name:e)!=="Other - specify"&&(a["Other notes"]=""),a}},{componentType:"inputField",header:"Specify other cause of death",name:"Other notes",icon:se.editPen,grid:{s:"12"},validation:(e,a)=>{const o=a==null?void 0:a["Road traffic accident"];return(typeof o=="object"&&o!==null?o.name:o)==="Other - specify"&&(!e||e==="")?"Please specify other cause of death":null},condition:e=>{const a=e==null?void 0:e["Road traffic accident"];return(typeof a=="object"&&a!==null?a.name:a)==="Other - specify"}},{componentType:"Heading",name:"Death Confirmation",position:"center",grid:{s:"12"}},{componentType:"dateInputField",header:"Date confirming death",name:"Date of confinement",icon:se.calenderPrimary,showTodayButton:!0,grid:{s:"12"},validation:e=>!e||e===""?"Date confirming death is required":null},{componentType:"timeInputField",header:"Time confirming death",name:"Confirmed",icon:se.calenderPrimary,showNowButton:!0,grid:{s:"12"},validation:e=>!e||e===""?"Time confirming death is required":null},{componentType:"inputField",header:"Person confirming death",name:"Responsible person present",icon:se.editPen,grid:{s:"12"},validation:e=>!e||e===""?"Person confirming death is required":null},{componentType:"inputField",header:"Position",name:"Position",icon:se.editPen,grid:{s:"12"},validation:e=>!e||e===""?"Position is required":null},{componentType:"inputField",header:"Medical council registration number",name:"Register Number",icon:se.editPen,grid:{s:"12"}}])}),Mt=J({__name:"BroughtDead",setup(t,{expose:e}){const{deathOutcomeForm:a}=Fl(),{formRef:o,exposeFormMethods:i}=Ma(),c=()=>{if(o.value){const u=new Le().isChildBearing();o.value.setFormValue("_isChildBearing",u)}};return ge(()=>{c()}),he(()=>{var r;return(r=o.value)==null?void 0:r.formValues},()=>{c()},{deep:!0}),e(i()),(r,u)=>(d(),H(xa,{formData:C(a),ref_key:"formRef",ref:o},null,8,["formData"]))}}),Vl={key:0,class:"spinner-overlay"},Bl={class:"header-container"},Ml={class:"header-title"},xl={key:0,class:"search-container"},El={style:{display:"flex",width:"100%","justify-content":"center",padding:"20px"}},Hl={class:"search-results-container"},Ul={key:1,class:"patient-info-banner"},Wl={class:"patient-details"},jl={key:2,class:"masonry-grid"},zl={class:"card-container"},ql={class:"custom-card"},Gl={class:"card-container"},Jl={key:0,class:"custom-card"},Ql={key:1,class:"custom-card"},Yl={class:"custom-card card-margin-top"},Xl={key:0,class:"card-container"},Zl={class:"custom-card"},Kl={class:"custom-card card-margin-top"},ed={class:"card-container"},td={class:"custom-card"},nd={key:0,class:"custom-card card-margin-top"},ad={key:3,class:"death-outcome-centered"},sd={class:"custom-card"},od={class:"footer-content"},id={class:"footer-buttons-left"},rd={key:0,class:"pagination-dots"},ld=["onClick"],dd={class:"footer-buttons-right"},cd=J({__name:"BroughtInDeadRegistration",props:{editMode:{type:Boolean,default:!1}},setup(t){const e=O(!1),a=Te();He();const o=re(),{patient:i}=Qe(o),c=O(null),r=O(null),u=O(null),m=O(null),h=O(null),p=O(null),w=O(null),f=O(null),b=O(!1),_=O(""),y=O([]),T=O(!1),N=O(null),L=O(null),P=O(null),V=O(!1),K=O(null),j=new Ea,ve=O({personalInformationRef:c,birthRegistrationRef:r,socialHistoryRef:u,countryRef:m,currentLocationRef:h,homeLocationRef:p,patientTypeRef:w,deathOutcomeRef:f}),we=z(()=>{var I;return((I=c.value)==null?void 0:I.currentFormValues)||{}}),S=z(()=>{var I;return((I=r.value)==null?void 0:I.currentFormValues)||{}}),$=z(()=>{var I;return((I=u.value)==null?void 0:I.currentFormValues)||{}}),Q=z(()=>{var I;return((I=m.value)==null?void 0:I.currentFormValues)||{}}),Y=z(()=>{var I;return((I=h.value)==null?void 0:I.currentFormValues)||{}}),q=z(()=>{var I;return((I=p.value)==null?void 0:I.currentFormValues)||{}}),G=z(()=>{var I;return((I=w.value)==null?void 0:I.currentFormValues)||{}}),x=z(()=>{var I;return((I=f.value)==null?void 0:I.currentFormValues)||{}}),ae=z(()=>({personalInformation:we.value,birthRegistration:S.value,socialHistory:$.value,country:Q.value,currentLocation:Y.value,homeLocation:q.value,patientType:G.value,deathOutcome:x.value})),U=z(()=>new Ft().checkIfChild(we.value)),{nextPage:le,prevPage:Ce,goToPage:fn,isCardVisible:Je,showPreviousButton:hn,showPaginationButtons:gn,totalPages:bt,currentPage:Dt,showNextButton:_n}=os();is();const $t=I=>{try{return(I.observations||[]).some(B=>B.encounter_type===40?(B.obs||[]).some(te=>te.concept_id===11520):!1)}catch(k){return console.error("Error checking deceased status:",k),!1}},vn=O([{title:"Name",data:null,render:(I,k,F)=>{var te;const B=F.personInformation||F.person,E=((te=B==null?void 0:B.names)==null?void 0:te[0])||B;if(E){const ie=E.given_name||E.givenName||"",An=E.family_name||E.familyName||"";return"".concat(ie," ").concat(An).trim()||"N/A"}return"N/A"}},{title:"MRN",data:null,render:(I,k,F)=>{var E;const B=F.patient_identifiers||((E=F.person)==null?void 0:E.patient_identifiers);if(Array.isArray(B)){const te=B.find(ie=>ie.identifier_type===3||ie.type===3||ie.name==="Patient Identifier");if(te)return te.identifier||"N/A";if(B.length>0)return B[0].identifier||"N/A"}return"N/A"}},{title:"Gender",data:null,render:(I,k,F)=>{const B=F.personInformation||F.person,E=B==null?void 0:B.gender;return E==="M"||E==="Male"?"Male":E==="F"||E==="Female"?"Female":"N/A"}},{title:"Birthdate",data:null,render:(I,k,F)=>{const B=F.personInformation||F.person,E=(B==null?void 0:B.birthdate)||(B==null?void 0:B.birth_date);if(E)try{return R.toStandardHisDisplayFormat(new Date(E))}catch(te){return E}return"N/A"}},{title:"Status",data:null,defaultContent:"",render:(I,k,F)=>$t(F)?'<span style="background:#dc2626;color:#fff;padding:4px 12px;border-radius:12px;font-size:11px;font-weight:600;">DECEASED</span>':'<span style="background:#10b981;color:#fff;padding:4px 12px;border-radius:12px;font-size:11px;font-weight:600;">ALIVE</span>'}]),yn=O({responsive:!0,searching:!1,paging:!1,info:!1,scrollX:!0}),bn=()=>{const I=Object.values(ve.value);return I.forEach(k=>k==null?void 0:k.validateForm()),I.every(k=>(k==null?void 0:k.validateForm())==null)},wt=()=>{Object.values(ve.value).forEach(I=>I==null?void 0:I.resetForm())},Dn=I=>{K.value(I)},$n=async I=>{const k=I.target.value;if(!k||k.length<2){y.value=[],T.value=!1;return}try{const F=await j.searchPatients({searchText:k,page:1,paginationSize:10,sitePrefix:"",ddeEnabled:!1,programId:W.getProgramID(),activeFilter:"All"});console.log("Search results:",F);let B=(F==null?void 0:F.onlinePatients)||[];F!=null&&F.offlinePatients&&(Array.isArray(F.offlinePatients)?B=[...B,...F.offlinePatients]:F.offlinePatients.records&&Array.isArray(F.offlinePatients.records)&&(B=[...B,...F.offlinePatients.records])),y.value=B,y.value.length>0?(N.value=I,T.value=!0,await de(),await de(),wn()):console.log("No search results found")}catch(F){console.error("Search error:",F),oe("Search failed. Please try again.")}},ye=()=>{if(L.value)try{const I=L.value.dt;I&&I.off("click")}catch(I){console.error("Cleanup error:",I)}},wn=async()=>{if(await de(),!L.value){console.log("Search table ref not available");return}ye();const I=L.value.dt;I&&I.on("click","tbody tr",async k=>{const F=I.row(k.currentTarget).data();F&&await Cn(F)})},Cn=async I=>{if(!e.value)try{e.value=!0,T.value=!1,o.$reset(),P.value=null,await de();let k=null;if(W.getPouchDbStatus()||W.getLanConnectionStatus()){const B=await Ae("patients_records",{selector:{patientID:I.patient_id||I.patientID}});if(Array.isArray(B))k=B.length>0?B[0]:null;else if(B&&typeof B=="object"&&"data"in B){const E=B;k=E.data.length>0?E.data[0]:null}}if(k||(k=await W.getJson("/patients/".concat(I.patient_id||I.patientID,"/get_patient_record"))),!k){oe("Patient record not found"),_.value="",y.value=[],ye();return}if($t(k)){oe("This patient is already marked as deceased. Redirecting to profile..."),await o.setPatientRecord(k),await de(),_.value="",y.value=[],ye(),a.push("/deathPatientProfile");return}await o.setPatientRecord(k),await de();const F=j.formatPatientForDisplay(k);P.value={fullName:F.displayName,identifier:F.identifier,gender:F.gender,age:F.birthdate,patientId:k.patient_id||k.patientID},V.value=!1,_.value="",y.value=[],ye(),ot("Patient selected. Please fill death outcome form.")}catch(k){oe("Failed to load patient. Please try again."),o.$reset(),P.value=null,T.value=!1,_.value="",y.value=[],ye()}finally{e.value=!1}},kn=()=>{P.value=null,V.value=!0,_.value="",T.value=!1,y.value=[],o.$reset(),ye(),e.value=!1},Sn=async()=>{await Ot("Clear selected patient?")&&(P.value=null,V.value=!1,o.$reset(),_.value="",y.value=[],T.value=!1,ye(),e.value=!1,await de())},In=()=>{T.value=!1,ye()},Pn=async()=>{var I;try{if(b.value=!0,P.value){if(!((I=f.value)!=null&&I.validateForm())){oe("Please fill in all required death information"),b.value=!1;return}const k=x.value;k&&Object.keys(k).length>0&&(await Ct(k),i.value&&await Rt(i.value),ot("Death outcome saved"),St("/deathPatientProfile"))}else{if(!bn()){oe("Please fill in all required fields"),b.value=!1;return}if(await new Ft().saveRegistrationData(ae.value)){const F=x.value;F&&Object.keys(F).length>0&&await Ct(F),i.value&&await Rt(i.value),wt(),ot("Patient registered"),St("/deathPatientProfile")}}}catch(k){console.error(k),oe("Failed to save")}finally{b.value=!1}},Ct=async I=>{const k=[],F=R.sessionDate();for(const[B,E]of Object.entries(I))if(!(!E||E===!1||E===""||B.startsWith("_")))if(typeof E=="object"&&E!==null&&!Array.isArray(E)){const te=E.name||E.id||String(E);te&&te!==""&&k.push(await Fe.buildValueText(B,String(te)))}else if(B==="Phone number"&&typeof E=="object"){const te=E.phoneNumber||String(E);te&&te!==""&&k.push(await Fe.buildValueText(B,String(te)))}else if(Array.isArray(E))for(const te of E){const ie=typeof te=="object"&&te!==null?te.value||te.name:te;ie&&ie!==""&&k.push(await Fe.buildValueText(B,String(ie)))}else typeof E=="string"||typeof E=="number"?k.push(await Fe.buildValueText(B,String(E))):typeof E=="boolean"&&E===!0&&k.push(await Fe.buildValueText(B,"Yes"));k.length>0&&await Fe.addObsToEncounterPatient([{concept_id:11520,value_coded:11520,child:k,obs_datetime:F}],vt.PATIENT_OUTCOME)},kt=async()=>{await Ot("Cancel registration?")&&(wt(),P.value=null,V.value=!1,o.$reset(),ze.dismiss())},St=I=>{a.push({path:I})};return ge(()=>{K.value=Be.debounce($n,800)}),pa(()=>{ye()}),(I,k)=>(d(),H(C(xe),{class:ce({loading:e.value})},{default:l(()=>[e.value?(d(),v("div",Vl,[s(C(Xt),{name:"bubbles"}),k[8]||(k[8]=n("div",{class:"loading-text"},"Please wait...",-1))])):A("",!0),s(C(_e),null,{default:l(()=>[n("div",Bl,[n("div",Ml,D(t.editMode?"Edit Patient Demographic":"Register Brought In Dead"),1),!t.editMode&&!V.value&&!P.value?(d(),H(C(Se),{key:0,fill:"clear",color:"danger",onClick:k[0]||(k[0]=F=>kt()),class:"header-cancel-btn"},{default:l(()=>[s(C(X),{icon:C(It),slot:"icon-only"},null,8,["icon"])]),_:1})):A("",!0)])]),_:1}),s(C(ue),null,{default:l(()=>{var F,B,E,te;return[t.editMode?A("",!0):(d(),v("div",xl,[n("div",El,[s(C(ut),{style:{color:"#000",width:"70%"},onIonInput:Dn,fill:"outline",modelValue:_.value,"onUpdate:modelValue":k[2]||(k[2]=ie=>_.value=ie),placeholder:"Search if patient exists by MRN or Name else register new record",class:"searchField"},{default:l(()=>[s(C(Pe),{style:{display:"flex"},slot:"start"},{default:l(()=>[s(C(X),{icon:C(ma),style:{color:"#000"},"aria-hidden":"true"},null,8,["icon"])]),_:1}),s(C(Pe),{style:{display:"flex"},slot:"end"},{default:l(()=>[s(C(fa),{style:{cursor:"pointer",color:"#74ff15"},slot:"end"},{default:l(()=>[s(C(X),{icon:C(ha),onClick:k[1]||(k[1]=ie=>kn()),"aria-hidden":"true",title:"Register New Patient"},null,8,["icon"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s(C(_t),{"is-open":T.value,event:N.value,onDidDismiss:In,"show-backdrop":!0},{default:l(()=>[n("div",Hl,[s(C(Me),{data:y.value,columns:vn.value,options:yn.value,class:"display nowrap search-table",width:"100%",ref_key:"searchDataTableRef",ref:L},null,8,["data","columns","options"])])]),_:1},8,["is-open","event"])])),P.value&&!V.value?(d(),v("div",Ul,[n("div",Wl,[n("h3",null,D(P.value.fullName),1),n("p",null,"MRN: "+D(P.value.identifier)+" | Gender: "+D(P.value.gender)+" | Age: "+D(P.value.age),1)]),s(C(Se),{size:"small",color:"danger",onClick:k[3]||(k[3]=ie=>Sn())},{default:l(()=>[s(C(X),{icon:C(It),slot:"start"},null,8,["icon"]),k[9]||(k[9]=M(" Clear Selection ",-1))]),_:1})])):A("",!0),V.value?(d(),v("div",jl,[$e(n("div",zl,[n("div",ql,[s(rs,{ref_key:"personalInformationRef",ref:c},null,512)])],512),[[ke,C(Je)(0)]]),$e(n("div",Gl,[U.value.underNineMonths&&!t.editMode?(d(),v("div",Jl,[s(ls,{ref_key:"birthRegistrationRef",ref:r},null,512)])):A("",!0),U.value.moreThanThirteenYears?(d(),v("div",Ql,[s(ds,{ref_key:"socialHistoryRef",ref:u},null,512)])):A("",!0),n("div",Yl,[s(cs,{ref_key:"countryRef",ref:m},null,512)])],512),[[ke,C(Je)(1)]]),!((B=(F=Q.value)==null?void 0:F.country)!=null&&B.name)||((te=(E=Q.value)==null?void 0:E.country)==null?void 0:te.name)==="Malawi"?$e((d(),v("div",Xl,[n("div",Zl,[s(us,{ref_key:"currentLocationRef",ref:h},null,512)]),n("div",Kl,[s(ps,{currentLocationFormValues:Y.value,ref_key:"homeLocationRef",ref:p},null,8,["currentLocationFormValues"])])],512)),[[ke,C(Je)(2)]]):A("",!0),$e(n("div",ed,[n("div",td,[s(Mt,{ref_key:"deathOutcomeRef",ref:f},null,512)]),C(W).getProgramID()==1?(d(),v("div",nd,[s(ms,{ref_key:"patientTypeRef",ref:w},null,512)])):A("",!0)],512),[[ke,C(Je)(3)]])])):P.value?(d(),v("div",ad,[n("div",sd,[s(Mt,{ref_key:"deathOutcomeRef",ref:f},null,512)])])):A("",!0)]}),_:1}),V.value||P.value?(d(),H(C(ga),{key:1},{default:l(()=>[n("div",od,[n("div",id,[s(st,{name:"Cancel",color:"danger",icon:C(_a),"onClicked:btn":k[4]||(k[4]=F=>kt())},null,8,["icon"]),$e(s(C(Se),{onClick:k[5]||(k[5]=F=>C(Ce)())},{default:l(()=>[...k[10]||(k[10]=[M("Previous",-1)])]),_:1},512),[[ke,C(hn)&&V.value]])]),C(gn)&&V.value?(d(),v("div",rd,[(d(!0),v(Z,null,ne(C(bt),F=>(d(),v("span",{key:F,class:ce({dot:!0,active:F===C(Dt)}),onClick:B=>C(fn)(F),role:"button"},null,10,ld))),128))])):A("",!0),n("div",dd,[$e(s(st,{name:"Save",loading:b.value,fill:"solid",color:"primary",icon:C(va),"onClicked:btn":k[6]||(k[6]=F=>Pn())},null,8,["loading","icon"]),[[ke,!V.value||C(Dt)===C(bt)]]),$e(s(st,{name:"Next","onClicked:btn":k[7]||(k[7]=F=>C(le)())},null,512),[[ke,C(_n)&&V.value]])])])]),_:1})):A("",!0)]),_:1},8,["class"]))}}),mn=ee(cd,[["__scopeId","data-v-a16a5f49"]]),ud=J({name:"BroughtInDeadTable",components:{IonCard:Ue,IonCardHeader:ft,IonCardTitle:mt,IonCardContent:Ze,IonIcon:X,IonSpinner:Xt,ReusableDataTable:ss},setup(){return{router:Te()}},data(){return{loadingBroughtInDead:!1,broughtInDeadData:[],bidHeaders:["First Name","Surname","Gender","Age","Date Of Death","Cause Of Death","Brought By","Confirmed By","Action"],bidTableOptions:{responsive:!0,ordering:!1,buttons:[],pageLength:10,dom:'<"table-controls"<"buttons-container">f>rtip',language:{emptyTable:"No patients brought in dead today",zeroRecords:"No matching records found"},initComplete:function(){const t=document.querySelector(".buttons-container");if(t){t.innerHTML='\n                            <button class="btn-register-bid" style="\n                                background: #dc2626; color: white; border: none; border-radius: 8px;\n                                padding: 8px 20px; font-weight: 600; font-size: 14px; cursor: pointer;\n                                display: flex; align-items: center; gap: 8px;\n                                box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);\n                            ">\n                                <ion-icon name="add-circle-outline" style="font-size: 20px;"></ion-icon>\n                                Register Brought In Dead\n                            </button>\n                        ';const e=t.querySelector(".btn-register-bid");e&&e.addEventListener("click",()=>{window.dispatchEvent(new CustomEvent("register-bid-click"))})}}}}},computed:{broughtInDeadTableData(){return this.broughtInDeadData.map(t=>[t.firstName,t.surname,t.gender,t.age,t.dateOfDeath,t.causeOfDeath,t.broughtBy,t.confirmedBy,this.buildActionButtons({id:t.id,name:"".concat(t.firstName," ").concat(t.surname),patientId:t.id})])},bidActionHandlers(){return{"view-profile-btn":this.handleViewProfile}}},async mounted(){await this.fetchBroughtInDeadData(),window.addEventListener("register-bid-click",this.openBroughtDeadModal)},beforeUnmount(){window.removeEventListener("register-bid-click",this.openBroughtDeadModal)},methods:{skullOutline(){return Zt},addCircleOutline(){return ya},openBroughtDeadModal(){Ve(mn,{class:"fullScreenModal"},!0)},async fetchBroughtInDeadData(){this.loadingBroughtInDead=!0;try{const t=W.getUserLocationId();if(!t){this.broughtInDeadData=[];return}const e=R.currentDate(),a=await en.getAllEncounters({encounter_type_id:40,date:e});if(!a||a.length===0){this.broughtInDeadData=[];return}this.broughtInDeadData=a.reduce((o,i)=>{var f,b,_,y,T,N,L,P,V,K;if(String(i==null?void 0:i.location_id)!==String(t)||!((f=i==null?void 0:i.observations)==null?void 0:f.some(j=>j.concept_id===7398||j.concept_name==="Death on arrival")))return o;const r=i.observations||[];let u="N/A",m="N/A",h="N/A";r.forEach(j=>{j.concept_id===1815&&(u=j.value_text||u),j.concept_id===5002&&(m=j.value_text||m),j.concept_id===1824&&(h=j.value_text||h)});const p=(y=(_=(b=i==null?void 0:i.patient)==null?void 0:b.person)==null?void 0:_.names)==null?void 0:y[0],w=(N=(T=i==null?void 0:i.provider)==null?void 0:T.names)!=null&&N[0]?"".concat(i.provider.names[0].given_name||""," ").concat(i.provider.names[0].family_name||"").trim():"Unknown";return o.push({id:i.patient_id,firstName:(p==null?void 0:p.given_name)||"N/A",surname:(p==null?void 0:p.family_name)||"N/A",age:this.calculateAge((P=(L=i==null?void 0:i.patient)==null?void 0:L.person)==null?void 0:P.birthdate),gender:((K=(V=i==null?void 0:i.patient)==null?void 0:V.person)==null?void 0:K.gender)==="M"?"Male":"Female",dateOfDeath:u,causeOfDeath:m,broughtBy:h,confirmedBy:w}),o},[])}catch(t){console.error("Error fetching brought in dead data:",t),this.broughtInDeadData=[]}finally{this.loadingBroughtInDead=!1}},calculateAge(t){if(!t)return"N/A";try{const e=new Date(t),a=new Date;if(isNaN(e.getTime()))return"N/A";let o=a.getFullYear()-e.getFullYear();const i=a.getMonth()-e.getMonth();return(i<0||i===0&&a.getDate()<e.getDate())&&o--,o>=0?o.toString():"N/A"}catch(e){return"N/A"}},buildActionButtons(t){return'\n                <div style="display: flex; gap: 6px;" data-patient-id="'.concat(t.patientId,'">\n                    <button class="view-profile-btn"\n                            data-button-type="profile"\n                            style="').concat("\n                padding: 4px 12px;\n                font-size: 0.8rem;\n                height: 28px;\n                min-width: 70px;\n                white-space: nowrap;\n                background-color: #3880ff;\n                color: white;\n                border: none;\n                border-radius: 4px;\n                cursor: pointer;\n            ","\"\n                            data-id='").concat(JSON.stringify(t),'\'\n                            title="View Profile">\n                        <span class="button-text">Profile</span>\n                        <span class="button-spinner" style="display: none;">Loading...</span>\n                    </button>\n                </div>\n            ')},async handleViewProfile(t){if(!t||!t.patientId){console.log("No patient ID found");return}this.setButtonLoading(t.patientId,"profile",!0);try{let e=null;(W.getPouchDbStatus()||W.getLanConnectionStatus())&&(e=(await Ae("patients_records",{selector:{patientID:t.patientId}}))[0]),e||(e=await W.getJson("/patients/".concat(t.patientId,"/get_patient_record"))),e?(await re().setPatientRecord(e),await de(),this.$router.push("/deathPatientProfile")):(oe("Patient not found. Please try searching by name."),this.setButtonLoading(t.patientId,"profile",!1))}catch(e){console.error("Error in handleViewProfile:",e),oe("Error loading patient profile."),this.setButtonLoading(t.patientId,"profile",!1)}},setButtonLoading(t,e,a){const o=document.querySelector('[data-patient-id="'.concat(t,'"]'));if(!o)return;const i=o.querySelector('[data-button-type="'.concat(e,'"]'));if(!i)return;const c=i.querySelector(".button-text"),r=i.querySelector(".button-spinner");a?(i.setAttribute("disabled","true"),c&&(c.style.display="none"),r&&(r.style.display="inline-block")):(i.removeAttribute("disabled"),c&&(c.style.display="inline"),r&&(r.style.display="none"))}}}),pd={key:0,class:"loading-container"};function md(t,e,a,o,i,c){const r=g("ion-icon"),u=g("ion-card-title"),m=g("ion-card-header"),h=g("ion-spinner"),p=g("ReusableDataTable"),w=g("ion-card-content"),f=g("ion-card");return d(),H(f,{class:"dashboard-card bid-card"},{default:l(()=>[s(m,{class:"dashboard-card-header"},{default:l(()=>[s(u,{class:"dashboard-title"},{default:l(()=>[s(r,{icon:t.skullOutline,slot:"start",class:"dashboard-icon danger-icon"},null,8,["icon"]),e[0]||(e[0]=M(" Dead Patients Today ",-1))]),_:1})]),_:1}),s(w,{class:"bid-card-content"},{default:l(()=>[t.loadingBroughtInDead?(d(),v("div",pd,[s(h,{name:"crescent"}),e[1]||(e[1]=n("p",{class:"loading-text"},"Loading brought in dead records...",-1))])):(d(),H(p,{key:1,headers:t.bidHeaders,data:t.broughtInDeadTableData,options:t.bidTableOptions,actionHandlers:t.bidActionHandlers,containerClass:""},null,8,["headers","data","options","actionHandlers"]))]),_:1})]),_:1})}const fd=ee(ud,[["render",md],["__scopeId","data-v-728648bb"]]),hd=J({name:"OPDDashboard",components:{DashboardCard:Ll,BroughtInDeadTable:fd},setup(){const{ready:t,OPDWaitingLists:e,hasWaitingList:a,refreshUserData:o}=rn();return{ready:t,OPDWaitingLists:e,hasWaitingList:a,refreshUserData:o}},data(){return{totalPatientsToday:0,isRefreshing:!1}},computed:{...pe(dt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","patientsVisits","todaysAppointmentsCount"])},async mounted(){await this.refreshDashboard()},methods:{skullOutline(){return Zt},openBroughtDeadModal(){Ve(mn,{class:"fullScreenModal"},!0)},lockClosed(){return wa},refresh(){return $a},medkit(){return qt},flask(){return Da},async refreshDashboard(){if(!this.isRefreshing){this.isRefreshing=!0;try{const t=W.getUserLocationId();if(!t)return;await Promise.all([dt().refresh(t),this.refreshUserData()])}finally{this.isRefreshing=!1}}},clipboard(){return Ut},thermometer(){return Wt},calendar(){return ba},people(){return jt},openAllModal(t,e,a){Ve(Dl,{class:"fullScreenModal"},!0,{title:t,buttonTitle:e,buttonLink:a})},openPatientsListModal(t,e,a,o){Ve(gl,{class:"fullScreenModal"},!0,{title:t,list:e,buttonTitle:a,buttonLink:o})},openAppointmentsModal(t,e){Ve(Al,{class:"fullScreenModal"},!0,{title:t,programType:e,programId:14})}}}),gd={class:"dashboard-wrapper"},_d={key:0,class:"loading-container"},vd={key:1,class:"no-access-container"};function yd(t,e,a,o,i,c){const r=g("ion-icon"),u=g("ion-card-title"),m=g("ion-card-header"),h=g("ion-spinner"),p=g("ion-button"),w=g("DashboardCard"),f=g("ion-row"),b=g("ion-grid"),_=g("ion-card-content"),y=g("ion-card"),T=g("BroughtInDeadTable"),N=g("ion-content");return d(),H(N,{fullscreen:!0},{default:l(()=>[n("div",gd,[s(y,{class:"dashboard-card"},{default:l(()=>[s(m,{class:"dashboard-card-header"},{default:l(()=>[s(u,{class:"dashboard-title"},{default:l(()=>[s(r,{icon:t.people(),slot:"start",class:"dashboard-icon"},null,8,["icon"]),e[6]||(e[6]=M(" Today's Patients Overview ",-1))]),_:1})]),_:1}),s(_,null,{default:l(()=>[t.ready?t.OPDWaitingLists.length===0?(d(),v("div",vd,[s(r,{icon:t.lockClosed(),class:"no-access-icon"},null,8,["icon"]),e[9]||(e[9]=n("h2",{class:"no-access-title"},"No Waiting Lists Assigned",-1)),e[10]||(e[10]=n("p",{class:"no-access-message"}," You currently don't have access to any waiting lists. Please contact your system administrator or supervisor to request access. ",-1)),s(p,{color:"primary",fill:"outline",onClick:t.refreshDashboard,class:"refresh-button"},{default:l(()=>[s(r,{icon:t.refresh(),slot:"start"},null,8,["icon"]),e[8]||(e[8]=M(" Refresh ",-1))]),_:1},8,["onClick"])])):(d(),H(b,{key:2,class:"centered-grid"},{default:l(()=>[s(f,{class:"centered-row"},{default:l(()=>{var L,P,V,K;return[t.hasWaitingList("Total Patients Today")?(d(),H(w,{key:0,icon:t.people(),color:"primary",count:t.patientsVisits.length,label:"Total patients today",onCardClick:e[0]||(e[0]=j=>t.openAllModal("All patients today","View profile","/patientProfile"))},null,8,["icon","count"])):A("",!0),t.hasWaitingList("Appointments Today")?(d(),H(w,{key:1,icon:t.calendar(),color:"primary",count:((L=t.todaysAppointmentsCount)==null?void 0:L.length)||0,label:"Appointments",onCardClick:e[1]||(e[1]=j=>t.openAppointmentsModal("OPD Appointments","14"))},null,8,["icon","count"])):A("",!0),t.hasWaitingList("Waiting for Vitals")?(d(),H(w,{key:2,icon:t.thermometer(),color:"primary",count:(P=t.patientsWaitingForVitals)==null?void 0:P.length,label:"Waiting for vitals",onCardClick:e[2]||(e[2]=j=>t.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals"))},null,8,["icon","count"])):A("",!0),t.hasWaitingList("Waiting for Consultation")?(d(),H(w,{key:3,icon:t.clipboard(),color:"primary",count:(V=t.patientsWaitingForConsultation)==null?void 0:V.length,label:"Waiting for consultation",onCardClick:e[3]||(e[3]=j=>t.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan"))},null,8,["icon","count"])):A("",!0),t.hasWaitingList("Waiting for Laboratory")?(d(),H(w,{key:4,icon:t.flask(),color:"primary",count:t.patientsWaitingForLab.length,label:"Waiting for lab",onCardClick:e[4]||(e[4]=j=>t.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan"))},null,8,["icon","count"])):A("",!0),t.hasWaitingList("Waiting for Dispensation")?(d(),H(w,{key:5,icon:t.medkit(),color:"primary",count:(K=t.patientsWaitingForDispensation)==null?void 0:K.length,label:"Waiting for dispensation",onCardClick:e[5]||(e[5]=j=>t.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations"))},null,8,["icon","count"])):A("",!0)]}),_:1})]),_:1})):(d(),v("div",_d,[s(h,{name:"crescent"}),e[7]||(e[7]=n("p",{class:"loading-text"},"Loading dashboard...",-1))]))]),_:1})]),_:1}),t.ready&&t.OPDWaitingLists.length>0?(d(),H(T,{key:0})):A("",!0)])]),_:1})}const bd=ee(hd,[["render",yd],["__scopeId","data-v-e2741e83"]]),Dd={class:"icon-container"},$d=["src","alt"],wd={class:"card-title"},Cd=J({__name:"DashboardCard",props:{icon:{},title:{}},emits:["click"],setup(t,{emit:e}){const a=t,o=e,i=z(()=>se[a.icon]||"");return(c,r)=>(d(),v("div",{class:"card",onClick:r[0]||(r[0]=u=>o("click"))},[n("div",Dd,[n("img",{src:i.value,alt:t.title},null,8,$d)]),n("div",wd,D(t.title),1)]))}}),kd=ee(Cd,[["__scopeId","data-v-334cd0db"]]),Sd={class:"dashboard-container"},Id={class:"dashboard-grid"},Pd=J({__name:"AETCDashboard",setup(t){O("");const e=Te(),a=O([{id:"patientArrival",icon:"plus_dashboard",title:"Patient Arrival"},{id:"screeningList",icon:"checklist",title:"Awaiting Screening List"},{id:"registrationList",icon:"checklist",title:"Awaiting Registration List"},{id:"triageList",icon:"checklist",title:"Awaiting Triage List"},{id:"assessmentList",icon:"checklist",title:"Awaiting Assessment List"},{id:"testResultsList",icon:"checklist",title:"Awaiting Test Results List"},{id:"specialtyList",icon:"checklist",title:"Awaiting Specialty List"},{id:"dispositionList",icon:"checklist",title:"Disposition List"},{id:"broughtDead",icon:"document",title:"Brought In Dead"},{id:"reports",icon:"chart",title:"Reports"}]),o=i=>{e.push({name:i})};return(i,c)=>(d(),H(C(xe),null,{default:l(()=>[s(C(ue),{fullscreen:!0},{default:l(()=>[n("div",Sd,[n("div",Id,[(d(!0),v(Z,null,ne(a.value,r=>(d(),H(kd,{key:r.id,icon:r.icon,title:r.title,onClick:u=>o(r.id)},null,8,["icon","title","onClick"]))),128))])])]),_:1})]),_:1}))}}),Ad=ee(Pd,[["__scopeId","data-v-bcce1a76"]]),Td=J({name:"NCDDashboard",mixins:[at],components:{ApexChart:Xe},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await de(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return W.getJson("programs/32/reports/ncd_dashboard",{start_date:R.toStandardHisFormat(R.sessionDate()),end_date:R.toStandardHisFormat(R.sessionDate())})}}}),Nd={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},Od={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},Rd={ref:"chartRef1"},Ld={ref:"chartRef2"};function Fd(t,e,a,o,i,c){const r=g("ion-card-content"),u=g("ion-card"),m=g("ApexChart");return d(),v(Z,null,[n("div",Nd,[s(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[s(r,null,{default:l(()=>[...e[0]||(e[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])]),_:1})]),_:1}),s(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[s(r,null,{default:l(()=>[...e[1]||(e[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])]),_:1})]),_:1}),s(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[s(r,null,{default:l(()=>[...e[2]||(e[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])]),_:1})]),_:1}),s(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[s(r,null,{default:l(()=>[...e[3]||(e[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])]),_:1})]),_:1})]),n("div",Od,[s(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[s(r,null,{default:l(()=>[e[4]||(e[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",Rd,[t.isChartReady?(d(),H(m,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):A("",!0)],512)]),_:1})]),_:1}),s(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[s(r,null,{default:l(()=>[e[5]||(e[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",Ld,[t.isChartReady?(d(),H(m,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):A("",!0)],512)]),_:1})]),_:1})])],64)}const Vd=ee(Td,[["render",Fd],["__scopeId","data-v-58e2a3d8"]]),Bd=J({name:"Home",mixins:[tn,at],components:{IonContent:ue,IonHeader:_e,IonPage:xe,IonToolbar:Ne,Toolbar:sn,IonRow:et,DateInputField:yt,IonIcon:X,IonButton:Se,IonCol:Ke},data(){const t=O(R.sessionDate()),e=O(R.sessionDate()),a=O(R.sessionDate()),o=O([]);return{segmentContent:"Today",minDate:a,startDate:t,endDate:e,people:o,calendarOutline:Ee,eyeOutline:Yt}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(t){this.segmentContent=t},formatBirthdate(t){return R.getBirthdateAge(t)},async getAppointments(){this.people=[],(await on.getAppointments(this.startDate,this.endDate,"")).forEach(e=>{const a={person_id:e.person_id,npid:e.npid,appointment_id:103,encounter_id:e.encounter_id,name:e.given_name.concat(" ",e.family_name),gender:e.gender,ageDob:this.formatBirthdate(e.birthdate),village:e.city_village,appointmentDate:R.toStandardHisDisplayFormat(e.appointment_date)};this.people.push(a)})},async getAppointmentsD1(t){this.startDate=R.toStandardHisFormat(t),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=R.toStandardHisFormat(t),await this.getAppointments()},async openClientProfile(t){await Le.findByNpid(t),this.isPharmacist()},isPharmacist(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(a=>e.some(o=>o.role==="Pharmacist"))&&(this.$router.push("dispensation"),W.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),Md={class:"appointments-container"},xd={key:0,class:"date-filter"},Ed={class:"appointments-table"};function Hd(t,e,a,o,i,c){const r=g("ion-label"),u=g("ion-segment-button"),m=g("ion-segment"),h=g("DateInputField"),p=g("ion-col"),w=g("ion-row"),f=g("ion-icon"),b=g("ion-button"),_=g("ion-card");return d(),v("div",Md,[n("div",null,[s(m,{value:t.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:l(()=>[s(u,{value:"Today",onClick:e[0]||(e[0]=y=>t.setSegmentContent("Today"))},{default:l(()=>[s(r,null,{default:l(()=>[...e[3]||(e[3]=[M("Today",-1)])]),_:1})]),_:1}),s(u,{value:"Tomorrow",onClick:e[1]||(e[1]=y=>t.setSegmentContent("Tomorrow"))},{default:l(()=>[s(r,null,{default:l(()=>[...e[4]||(e[4]=[M("Tomorrow",-1)])]),_:1})]),_:1}),s(u,{value:"Date range",onClick:e[2]||(e[2]=y=>t.setSegmentContent("Date range"))},{default:l(()=>[s(r,null,{default:l(()=>[...e[5]||(e[5]=[M("Date range",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),t.segmentContent==="Date range"?(d(),v("div",xd,[s(w,null,{default:l(()=>[s(p,null,{default:l(()=>[s(h,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),s(p,null,{default:l(()=>[s(h,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):A("",!0),t.people.length>0?(d(),H(_,{key:1},{default:l(()=>[n("table",Ed,[e[6]||(e[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),v(Z,null,ne(t.people,y=>(d(),v("tr",{key:y.npid},[n("td",null,[s(w,null,{default:l(()=>[s(p,null,{default:l(()=>[M(D(y.name),1)]),_:2},1024),s(p,null,{default:l(()=>[s(b,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:T=>t.openClientProfile(y.npid),color:"primary",fill:"clear",size:"small"},{default:l(()=>[s(f,{icon:t.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,D(y.npid),1),n("td",null,D(y.ageDob),1),n("td",null,D(y.gender),1),n("td",null,D(y.village),1),n("td",null,D(y.appointmentDate),1)]))),128))])])]),_:1})):(d(),H(_,{key:2},{default:l(()=>[...e[7]||(e[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])]),_:1}))])}const Ud=ee(Bd,[["render",Hd],["__scopeId","data-v-c47f7768"]]),Wd=J({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){}}}),jd={key:0},zd={style:{display:"flex","margin-top":"10px"}},qd={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},Gd={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},Jd={key:1};function Qd(t,e,a,o,i,c){const r=g("ion-label"),u=g("ion-segment-button"),m=g("ion-segment"),h=g("VisitsHistory");return d(),v(Z,null,[n("div",null,[s(m,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:l(()=>[s(u,{value:"Internal referrals",onClick:e[0]||(e[0]=p=>t.setSegmentContent("Internal referrals"))},{default:l(()=>[s(r,null,{default:l(()=>[...e[2]||(e[2]=[M("Internal referrals",-1)])]),_:1})]),_:1}),s(u,{value:"External referrals",onClick:e[1]||(e[1]=p=>t.setSegmentContent("External referrals"))},{default:l(()=>[s(r,null,{default:l(()=>[...e[3]||(e[3]=[M("External referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(d(),v("div",jd,[n("div",zd,[t.checkUnderFive?(d(),v("div",qd)):A("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?A("",!0):(d(),v("div",Gd))])])):A("",!0),t.segmentContent=="External referrals"?(d(),v("div",Jd,[s(h)])):A("",!0)],64)}const Yd=ee(Wd,[["render",Qd],["__scopeId","data-v-faad8f8b"]]),Xd=J({name:"Menu",components:{IonContent:ue,IonHeader:_e,IonItem:Re,IonList:Oe,IonMenu:je,IonTitle:We,IonToolbar:Ne,IonCheckbox:tt,IonIcon:X,BasicForm:Ge,BasicCard:nt,Referrals:Yd,Dashboard:Vd,ANCAppointments:Ud},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:Qt},{id:"referrals",label:"Referrals",icon:ht},{id:"appointments",label:"Appointments",icon:Ee}],activeItem:"dashboard"}},computed:{...pe(qe,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Zd={style:{display:"flex"}},Kd={class:"left_col"},ec={class:"nav-menu"},tc=["onClick"],nc={class:"right_col"};function ac(t,e,a,o,i,c){const r=g("ion-icon"),u=g("Dashboard"),m=g("ANCAppointments"),h=g("Referrals");return d(),v("div",Zd,[n("div",Kd,[n("nav",ec,[n("ul",null,[(d(!0),v(Z,null,ne(t.menuItems,p=>(d(),v("li",{key:p.id,class:ce({active:t.activeItem===p.id}),onClick:w=>t.setActiveItem(p.id)},[s(r,{icon:p.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,D(p.label),1)],10,tc))),128))])])]),n("div",nc,[n("div",null,[t.activeItem==="dashboard"?(d(),H(u,{key:0})):A("",!0),t.activeItem==="appointments"?(d(),H(m,{key:1})):A("",!0),t.activeItem==="referrals"?(d(),H(h,{key:2})):A("",!0)])])])}const sc=ee(Xd,[["render",ac],["__scopeId","data-v-7e786ea4"]]),oc=J({name:"Menu",components:{IonContent:ue,IonHeader:_e,IonItem:Re,IonList:Oe,IonMenu:je,IonTitle:We,IonToolbar:Ne,IonCheckbox:tt,BasicForm:Ge,BasicCard:nt},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...pe(qe,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),ic={class:"left_col"},rc={class:"nav-menu"},lc=["onClick"];function dc(t,e,a,o,i,c){return d(),v("div",null,[n("div",ic,[n("nav",rc,[n("ul",null,[(d(!0),v(Z,null,ne(t.menuItems,r=>(d(),v("li",{key:r.id,class:ce({active:t.activeItem===r.id}),onClick:u=>t.setActiveItem(r.id)},D(r.label),11,lc))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const cc=ee(oc,[["render",dc],["__scopeId","data-v-32dd02d3"]]),uc=J({name:"Menu",components:{IonContent:ue,IonHeader:_e,IonItem:Re,IonList:Oe,IonMenu:je,IonTitle:We,IonToolbar:Ne,IonCheckbox:tt,BasicForm:Ge,BasicCard:nt},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...pe(qe,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),pc={class:"left_col"},mc={class:"nav-menu"},fc=["onClick"];function hc(t,e,a,o,i,c){return d(),v("div",null,[n("div",pc,[n("nav",mc,[n("ul",null,[(d(!0),v(Z,null,ne(t.menuItems,r=>(d(),v("li",{key:r.id,class:ce({active:t.activeItem===r.id}),onClick:u=>t.setActiveItem(r.id)},D(r.label),11,fc))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const gc=ee(uc,[["render",hc],["__scopeId","data-v-b49d8600"]]);function _c(){const t=He(),e=O(""),a=O(!1),o=O({}),i=()=>{const c=W.getUserRoles(),r=W.getProgramID(),u=W.getProgramName();e.value=c,a.value=!1,c==="Lab"&&r===14?o.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:r===14&&c!=="Lab"?o.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:r===12?o.value={url:"contact",btnName:"Back"}:u==="LABOUR AND DELIVERY PROGRAM"?o.value={url:"labour/labourHome",btnName:"Back to home"}:u==="PNC PROGRAM"?o.value={url:"pnc/home",btnName:"Back to home"}:o.value={url:"",btnName:""},a.value=!0};return he(()=>t.path,()=>{i()},{immediate:!0,deep:!0}),{userRole:e,ready:a,userRoleSettings:o,updateUserRoleSettings:i}}const qc=J({__name:"HomePage",setup(t){const e=O(!0),a=He(),o=Ha(),i=O(localStorage.getItem("sessionDate")||"");_c();const c=Kt(),{apiStatus:r}=Qe(nn()),{activeProgram:u}=Qe(c),m=z(()=>{var _;switch(console.log("ðŸš€ ~ activeDashboard ~ activeProgram:",u.value.program_id),(_=u.value)==null?void 0:_.program_id){case fe.IMMUNIZATION_PROGRAM:return ul;case fe.OPD_PROGRAM:return bd;case fe.NCD_PROGRAM:return mi;case fe.AETC_PROGRAM:return Ad;case fe.HTS_PROGRAM:return qi;case fe.ANC_PROGRAM:return sc;case fe.PNC_PROGRAM:return gc;case fe.LABOUR_AND_DELIVERY_PROGRAM:return cc;case fe.HIV_PROGRAM:return Cr;case fe.NEONATAL_PROGRAM:return fs;default:return null}}),h=()=>{const _=localStorage.getItem("sessionDate");(!_||_.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),Lt()),i.value=_||""};let p=null;ge(()=>{p=()=>h(),window.addEventListener("storage",p);const _=setInterval(h,1e3);Ca(()=>{clearInterval(_),p&&window.removeEventListener("storage",p)}),h()}),he(i,(_,y)=>{(!_||_.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),Lt())});const w=async()=>{Be.isEmpty(u.value)&&await qa.show(Qa,{},"module-picker-modal")},f=async(_=[])=>{try{e.value=!0,Ua(),await Wa().loadGlobalProperty(),o.postData({command:"ping"});for(const y of _)typeof y=="function"?await y():console.warn("Non-function item found in extraFns array:",y)}catch(y){console.error("Error initializing component:",y)}finally{e.value=!1}};he(()=>a.name,async _=>{_==="Home"&&await f([w])},{immediate:!0,deep:!0});const b=async()=>{try{const _=W.getUserID(),y=await ja.getUserByID(_);if(y.location_id!=null){const T=await za.getLocation(y.location_id);localStorage.setItem("locationData",JSON.stringify(T))}}catch(_){console.error("Failed to retrieve location data:",_)}};return r.value&&(rn(),b()),ge(async()=>{try{await f()}catch(_){console.error("Error initializing component:",_)}finally{e.value=!1}}),(_,y)=>{const T=g("ion-content");return d(),H(C(xe),null,{default:l(()=>[s(sn),s(Ja),m.value?(d(),H(ka(m.value),{key:0})):(d(),H(T,{key:1},{default:l(()=>[...y[0]||(y[0]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])]),_:1}))]),_:1})}}});export{qc as default};

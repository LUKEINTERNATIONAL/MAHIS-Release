var ne=Object.defineProperty;var oe=(a,e,n)=>e in a?ne(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n;var S=(a,e,n)=>oe(a,typeof e!="symbol"?e+"":e,n);import{D as K,d as U,c as m,H as ie,e as f,f as g,m as O,k as D,p as I,j as v,l as E,K as F,r as G,w as R,a as re,F as ce,P as le,O as de,u as ue,J,n as X,aV as x}from"./vendor-CdYsMjog.js";import{l as T}from"./lodash-NJiRuGo9.js";import{b0 as Z,u as k,af as L,S as h,E as pe,H as N,aS as ge,bF as fe,P as he,a7 as ve,G as B,t as P,aK as H,aL as A,a0 as me}from"../index-CR9tVNI2.js";import{g as be,D as ee,a as _}from"./drug_prescription_service-BLhLo4nX.js";import{P as ye}from"./patient_diagnosis_service-CNYU35IU.js";const W=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"Visual acuity test",data:{rowData:[{colData:[{inputHeader:"Left Eye",value:"",name:"Left eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"},{inputHeader:"Right Eye",value:"",name:"Right eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"}]}]}}],Y=[{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Peripheral neuropathy"},data:[{name:"Neuropathy/PVO",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Deformity"},data:[{name:"Deformities",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Ulcers"},data:[{name:"Ulcers",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}}],Q=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"CV Risk %",data:{rowData:[{colData:[{inputHeader:"",value:"",name:"CVD",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,valueType:"text",validationFunctionName:"isNumber"}]}]}}],Ze=K("complicationsStore",{state:()=>({visualScreening:[...W],FootScreening:[...Y],cvScreening:[...Q]}),actions:{setCvScreening(a){this.cvScreening=a},setVisualScreening(a){this.visualScreening=a},setFootScreening(a){this.FootScreening=a},getInitialCvScreening(){return[...T.cloneDeep(Q)]},getInitialVisualScreening(){return[...T.cloneDeep(W)]},getInitialFootScreening(){return[...T.cloneDeep(Y)]},resetScreening(){this.setCvScreening(this.getInitialCvScreening()),this.setFootScreening(this.getInitialFootScreening()),this.setVisualScreening(this.getInitialVisualScreening())}},persist:!0}),De={class:"fw-list-wrapper"},Se=["id"],we={class:"fw-step-container"},_e={key:0},Ne={key:1},Ce=U({__name:"WizardStep",props:{tab:{type:Object,default:()=>{}},index:{type:Number,default:0},currentIndex:{type:Number,default:0},squaredTab:{type:Boolean,default:!1},showProgress:{type:Boolean,default:!0}},setup(a){const e=a,n=m(()=>e.currentIndex>e.index);m(()=>"pi pi-".concat(e.tab.icon));const s=m(()=>["fw-list-wrapper-icon",{"fw-step-active":e.tab.active,"fw-step-checked":e.tab.checked,"fw-squared-tab":e.squaredTab}]);return(t,o)=>{const i=ie("ion-icon");return g(),f("li",null,[a.showProgress?(g(),f("div",{key:0,class:I(["fw-list-progress",{"fw-list-progress-active":n.value}])},null,2)):O("",!0),D("div",De,[D("div",{id:"step-".concat(a.tab.id),role:"tab",class:I(s.value)},[D("div",we,[v(t.$slots,"active-step",{},()=>[a.tab.icon?(g(),f("i",_e,[E(i,{icon:a.tab.icon,style:{"font-size":"16px"}},null,8,["icon"])])):(g(),f("i",Ne,F(a.index+1),1))])])],10,Se),v(t.$slots,"title",{},()=>[D("span",{class:I(["fw-step-title",{active:a.tab.active}])},F(a.tab.title),3)])])])}}}),Te=["disabled"],Pe={key:0},j=U({__name:"Button",props:{options:{type:Object,default:function(){return{}}}},setup(a){const e=a,n=t=>"pi pi-".concat(t),s=m(()=>["fw-btn",{"fw-btn-disabled":e.options.disabled}]);return(t,o)=>(g(),f("button",{class:I(s.value),disabled:a.options.disabled},[a.options.hideText?O("",!0):(g(),f("span",Pe,F(a.options.text),1)),a.options.hideIcon?O("",!0):(g(),f("i",{key:1,class:I(n(a.options.icon))},null,2))],10,Te))}}),Oe=["id"],Ie={key:0,class:"fw-body-list",role:"tablist"},ke={class:"fw-body"},xe={class:"fw-body-content"},Be={class:"fw-body-container"},Me={key:0,class:"fw-footer"},$e={class:"fw-footer-left"},Ee={class:"fw-footer-right"},et=U({__name:"Wizard",props:{id:{type:String,default:"fw-"+new Date().valueOf()},headingTitle:{type:String,default:""},customTabs:{type:Array,default:()=>[{id:0,title:"Step 1",icon:"map"},{id:1,title:"Step 2",icon:"check"},{id:2,title:"Step 3",icon:"pencil"}]},nextButton:{type:Object,default:function(){return{}}},backButton:{type:Object,default:function(){return{}}},doneButton:{type:Object,default:function(){return{}}},hideButtons:{type:Boolean,default:!1},startIndex:{type:Number,default:0,validator:a=>a>=0},verticalTabs:{type:Boolean,default:!1},beforeChange:{type:Function,default:()=>{}},beforeMount:{type:Function,default:()=>{}},navigableTabs:{type:Boolean,default:!1},scrollableTabs:{type:Boolean,default:!1},cardBackground:{type:Boolean,default:!1},squaredTabs:{type:Boolean,default:!1},showProgress:{type:Boolean,default:!0},showWizard:{type:Boolean,default:!0}},emits:["change","complete:wizard","updated:tabs","onValidateTabs","done-button-changed"],setup(a,{expose:e,emit:n}){const s=n,t=a;let o=G(0);const i=m(()=>[...t.customTabs].map((u,w)=>({...u,checked:w<o.value,active:w===o.value}))),c=m(()=>i.value.length-1),b=m(()=>Object.assign({text:"Back",icon:"arrow-left",hideText:!1,hideIcon:!1,disabled:!1},t.backButton)),p=m(()=>Object.assign({text:"Next",icon:"arrow-right",hideText:!1,hideIcon:!1,disabled:!1},t.nextButton)),d=m(()=>Object.assign({text:"Done",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},t.doneButton));R(()=>t.doneButton,(r,u)=>{s("done-button-changed",{newOptions:d.value,oldOptions:u?Object.assign({text:"Done",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},u):null,currentTabIndex:o.value,isLastStep:l.value})},{deep:!0,immediate:!1}),R(d,(r,u)=>{console.log("Done button options changed:",{new:r,old:u,currentStep:o.value})},{deep:!0}),re(()=>{o.value=t.startIndex,C(),s("change",o.value)});const y=m(()=>o.value!==0),l=m(()=>o.value===c.value),V=m(()=>["form-wizard-vue",{"fw-vertical":t.verticalTabs},{"fw-overflow-scroll":t.scrollableTabs},{"fw-card":t.cardBackground}]),C=()=>{s("updated:tabs",i.value,o.value)},M=async()=>{if(o.value===c.value){d.value.disabled||se();return}if(p.value.disabled)return;const r=o.value+1,u=o.value;if(!t.navigableTabs){s("change",r,u,!0);return}s("change",r,u),await t.beforeChange(),$(r)},ae=async()=>{if(o.value===0||b.value.disabled)return;const r=o.value-1,u=o.value;s("change",r,u),await t.beforeChange(),$(r)},se=()=>{const r=o.value,u=o.value-1;s("complete:wizard",r,u)},q=async r=>{if(!t.navigableTabs)return;const u=r,w=o.value;s("change",u,w),await t.beforeChange(),$(u)},$=async r=>{o.value=r,C(),await X(),await t.beforeMount()};return e({changeTab:$}),(r,u)=>(g(),f("div",{id:a.id,class:I(V.value)},[a.showWizard?(g(),f("ul",Ie,[D("h4",null,F(a.headingTitle),1),(g(!0),f(ce,null,le(i.value,(w,z)=>v(r.$slots,"wizard-step",{tab:w,index:z,navigateToTab:q},()=>[(g(),de(Ce,{key:w.id,tab:w,index:z,currentIndex:ue(o),squaredTab:a.squaredTabs,showProgress:a.showProgress,onClick:Je=>q(z)},{"active-step":J(()=>[v(r.$slots,"active-step")]),title:J(()=>[v(r.$slots,"title")]),_:3},8,["tab","index","currentIndex","squaredTab","showProgress","onClick"]))])),256))])):O("",!0),D("div",ke,[D("div",xe,[D("div",Be,[v(r.$slots,"default")])]),a.hideButtons?O("",!0):(g(),f("div",Me,[v(r.$slots,"footer",{},()=>[D("div",$e,[y.value?(g(),f("span",{key:0,role:"button",onClick:ae},[v(r.$slots,"back",{},()=>[E(j,{options:b.value},null,8,["options"])])])):O("",!0),v(r.$slots,"custom-buttons-left")]),D("div",Ee,[v(r.$slots,"custom-buttons-right"),l.value?(g(),f("span",{key:0,role:"button",onClick:M},[v(r.$slots,"done",{},()=>[E(j,{options:d.value},null,8,["options"])])])):(g(),f("div",{key:1,role:"button",onClick:M},[v(r.$slots,"next",{},()=>[E(j,{options:p.value},null,8,["options"])])]))])])]))])],10,Oe))}}),tt=()=>{const a=G(""),e=t=>{t%1===0&&(a.value=t)};return{currentTabIndex:a,onChangeCurrentTab:e,onTabBeforeChange:t=>{a.value===0&&console.log("First Tab"),e(t)},changeBtnIconPosition:()=>{X(()=>{const t=document.querySelector(".fw-footer-left .fw-btn");if(!t)return;const o=t.querySelector("span"),i=t.querySelector("i");!o||!i||(t.removeChild(o),t.removeChild(i),t.appendChild(i),t.appendChild(o))})}}};class Fe extends Z{constructor(e,n){super(e,105,n)}}class Ae extends Z{constructor(e,n){super(e,25,n)}static async get_____(e="",n=1,s=10){}}async function at(a){var e,n,s;try{const t=k(),{patient:o}=x(t),i=JSON.parse(JSON.stringify(o.value));return(s=(n=(e=i.allergies)!=null?e:i.allergies={}).unsaved)!=null||(n.unsaved=[]),i.allergies.unsaved.push(...a),B("Allergies appended to patient record successfully"),i}catch(t){P("Unable to save Allegies!")}}class st{async onSubmitNotes(e,n,s){const t=new Fe(e,n);await t.createEncounter(),await t.saveObservationList(s)}async onSubmitAllergies(e,n,s){try{const t=new Ae(e,n);await t.createEncounter(),await t.saveObservationList(s),B("Allergies saved successfully")}catch(t){console.error("Error saving allergies:",t),P("Failed to save allergies")}}}class nt{constructor(){S(this,"programID");S(this,"providerID");S(this,"patientID");S(this,"date");S(this,"demographics");S(this,"previousDrugPrescriptions",[]);S(this,"previousClinicalNotes");S(this,"previousDrugAllergies");const e=k();this.demographics=e.patient,this.patientID=this.demographics.patientID,this.date=L.getSessionDate(),this.providerID=h.getUserID(),this.programID=L.getProgramID(),this.previousClinicalNotes={},this.previousDrugAllergies={}}async getPatientEncounters(){const e=await this.getPatientVisitDates(),n=e.map(async t=>{const o=t.value,i=await pe.getEncounters(this.patientID,{date:o});await Promise.all(i.map(async c=>{var b;if(c.type.name=="NOTES"){const{observations:p}=c;T.isEmpty(p)||p.forEach(d=>{if(d.concept_id=="2688"){const y=N.toStandardHisDisplayFormat(d.obs_datetime);T.isEmpty(this.previousClinicalNotes.hasOwnProperty(y))&&(this.previousClinicalNotes[y]=[]),this.previousClinicalNotes[y].push({date:y,notes:d.value_text})}})}if(c.type.name=="TREATMENT"){const{observations:p}=c;if(!T.isEmpty(p))for(const d in p){let y="<UNKNOWN CONCEPT>";const l=p[d];try{(b=l==null?void 0:l.concept)!=null&&b.concept_names?y=l.concept.concept_names[0].name:y=await ge.getConceptName(l.concept_id)}catch(M){console.error(l,M)}const V=await L.resolvePrimaryValue(l),C=N.toStandardHisDisplayFormat(l.date_created);y=="Allergic"&&(this.previousDrugAllergies.hasOwnProperty(C)||(this.previousDrugAllergies[C]=[]),this.previousDrugAllergies[C].push({date:C,value:V}))}}}))});await Promise.all(n);const s=e.map(async t=>{const o=await fe.getOrderByPatient(this.patientID,{start_date:t.value});if(!T.isEmpty(o)){const i=o.map(c=>({drugName:c.drug.name,value:N.toStandardHisTimeFormat(c.order.start_date),dose:c.dose,frequency:be(c.frequency),prescription:N.toStandardHisFormat(c.order.auto_expire_date),duration:Ve(c.order.instructions),other:c}));this.previousDrugPrescriptions.push({prescriptionDate:N.toStandardHisDisplayFormat(t.value),previousPrescriptions:i})}});return await Promise.all(s),{previousDrugPrescriptions:this.previousDrugPrescriptions,previousClinicalNotes:this.previousClinicalNotes,previousDrugAllergies:this.previousDrugAllergies}}async getPatientVisitDates(){return(await he.getPatientVisits(this.patientID,!1)).map(e=>({label:N.toStandardHisDisplayFormat(e),value:e,other:{isActive:e===ve.getSessionDate()}}))}}function Ve(a){const e=/(\d+)\s+days/i,n=a.match(e);return n&&n.length>1?parseInt(n[1]):null}async function ot(){const a=k(),{patient:e}=x(a),n=e.value,s=[8809,903,6410,6409],t="";let o;h.getLanConnectionStatus()||h.getPouchDbStatus()?o=await ye.getDiagnosis(t,1,15):o=await h.getJson("diagnosis",{id:7409,page_size:2e3});const i=o.filter(l=>s.includes(l.concept_id));i.push({concept_id:8809,concept_name_id:926,concept_name_type:"FULLY_SPECIFIED",creator:1,date_created:"2004-06-25T00:00:00.000+02:00",date_voided:null,id:72,locale:"en",locale_preferred:0,name:"Hypertension",uuid:"b99faa1e-8d80-11d8-abbb-0024217bb78e",void_reason:null,voided:0,voided_by:null});const c=n.diagnosis.saved.map(l=>l.value_coded),b=n.diagnosis.unsaved.map(l=>l.value_coded),p=[...c,...b];return i.filter(l=>p.includes(l.concept_id)).map(l=>l.name)}async function it(){var a,e,n;try{const s=k(),{patient:t}=x(s),o=Le(),i=JSON.parse(JSON.stringify(t.value));if(o.length>0){(n=(e=(a=i.MedicationOrder)!=null?a:i.MedicationOrder={}).unsaved)!=null||(e.unsaved=[]),i.MedicationOrder.unsaved=[...i.MedicationOrder.unsaved,...o];const c=A();return c.setMedicationRunOutDate(ze()),c.clearMedicationDataStores(),B("Drug order(s) has been created"),i}else P("Unable to create drug orders!")}catch(s){P("Unable to create drug orders!")}}function rt(){try{const a=new Date(h.getSessionDate()),n=H().selectedMedicalDrugsList;let s=0;if(n.forEach(p=>{const d=parseInt(p.duration,10);!isNaN(d)&&d>s&&(s=d)}),s<=0)return{date:null,formattedDate:null};const t=new Date(a);t.setDate(a.getDate()+s);const o=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),c=t.getFullYear(),b="".concat(o,"/").concat(i,"/").concat(c);return{date:t,formattedDate:b}}catch(a){return console.error("Error calculating OPD medication run out date:",a),{date:null,formattedDate:null}}}function ze(){try{const a=new Date(h.getSessionDate()),n=A().selectedNCDMedicationList;let s=0;if(n.forEach(p=>{const d=parseInt(p.duration,10);!isNaN(d)&&d>s&&(s=d)}),s<=0)return{date:null,formattedDate:null};const t=new Date(a);t.setDate(a.getDate()+s);const o=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),c=t.getFullYear(),b="".concat(o,"/").concat(i,"/").concat(c);return{date:t,formattedDate:b}}catch(a){return console.error("Error calculating medication run out date:",a),{date:null,formattedDate:null}}}const Le=()=>{const a=A();return a.selectedNCDMedicationList.map(e=>{e.frequency=a.frequency_selections[e.drug_id]||"",e.totalDosage=Object.values(e.dosage).reduce((t,o)=>t+Number(o),0);const n=ee.getSessionDate(),s=He(e.drug_id);return{drug_inventory_id:e.drug_id,equivalent_daily_dose:e.totalDosage=="Unknown"?0:e.totalDosage*(s==null?void 0:s.value)||0,start_date:n,auto_expire_date:te(n,e.duration),units:e.units,instructions:"".concat(e.name," ").concat(e.totalDosage," ").concat(e.units," ").concat((s==null?void 0:s.code)||""," for ").concat(e.duration," days"),dose:je(e),frequency:(s==null?void 0:s.code)||"",drug_name:e.drugName,offline_id:h.generateId(h.getUserName()),program_id:h.getProgramID()}})},je=a=>a.dose_strength!=null&&a.dose_strength?Math.trunc(a.dose_strength):1;async function ct(){var a,e,n;try{const s=k(),{patient:t}=x(s),o=Ue(),i=JSON.parse(JSON.stringify(t.value));if(o.length>0)return(n=(e=(a=i.MedicationOrder)!=null?a:i.MedicationOrder={}).unsaved)!=null||(e.unsaved=[]),i.MedicationOrder.unsaved=[...i.MedicationOrder.unsaved,...o],B("Drug order(s) has been created"),i}catch(s){P("Unable to create drug orders!")}}const Ue=()=>H().selectedMedicalDrugsList.map(e=>{const n=ee.getSessionDate(),s=_.find(t=>t.label===e.frequency)||{};return{drug_inventory_id:e.drug_id,equivalent_daily_dose:e.dose=="Unknown"?0:e.dose*(s==null?void 0:s.value)||0,start_date:n,auto_expire_date:te(n,e.duration),units:e.units,instructions:"".concat(e.drugName,": ").concat(e.dose," ").concat(e.units," ").concat((s==null?void 0:s.code)||""," for ").concat(e.duration," days"),dose:e.dose,frequency:(s==null?void 0:s.code)||"",drug_name:e.drugName,offline_id:h.generateId(h.getUserName()),program_id:h.getProgramID()}}),He=a=>{const n=A().selectedNCDMedicationList.find(t=>t.drug_id===a);if(!n||!n.dosage)return null;switch(["morning","afternoon","evening"].reduce((t,o)=>t+(n.dosage[o]?1:0),0)){case 1:return n.dosage.morning?_.find(t=>t.code==="QAM"):n.dosage.afternoon?_.find(t=>t.code==="QNOON"):n.dosage.evening?_.find(t=>t.code==="QPM"):_.find(t=>t.code==="OD");case 2:return _.find(t=>t.code==="BD");case 3:return _.find(t=>t.code==="TDS");default:return _.find(t=>t.code==="Unknown")}},te=(a,e)=>{const n=new Date(a);return n.setDate(n.getDate()+parseInt(e)),N.toStandardHisFormat(n)},qe=()=>H().nonPharmalogicalTherapyAndOtherNotes,lt=K("nonPharmaTherapyStore",{state:()=>({items:[{id:"wound-dressing",label:"Wound dressing",checked:!1},{id:"patient-education",label:"Patient education",checked:!1},{id:"counseling",label:"Counseling",checked:!1},{id:"minor-surgery",label:"Minor Surgery",checked:!1}],current_patient:{}}),actions:{async saveNonPharmaTherapyPatientData(){const a=me(),e=[];this.items.forEach(s=>{s.checked==!0&&e.push({concept_id:11023,value_text:s.label,obs_datetime:N.toStandardHisFormat(h.getSessionDate()),location_id:a.facilityLocation.code})});const n=qe();n&&e.push({concept_id:2592,obs_datetime:h.getSessionDate(),value_text:n,location_id:a.facilityLocation.code});try{if(e.length>0)return this.clearSelectednonPharmaTherapyStore(),B("Non Pharma Therapy staged successfully!"),await Re(e)}catch(s){P("Unable to update Non Pharma Therapy!")}},clearSelectednonPharmaTherapyStore(){this.items.forEach(a=>{a.checked=!1})},setCurrentPatient(a){this.current_patient=a}},persist:!0});async function Re(a){var e,n,s;try{const t=k(),{patient:o}=x(t),i=JSON.parse(JSON.stringify(o.value));return(s=(n=(e=i.notes)!=null?e:i.notes={}).unsaved)!=null||(n.unsaved=[]),i.notes.unsaved.push(...a),i}catch(t){P("Unable to create non pharmalogical notes!")}}export{nt as P,st as T,et as _,Ze as a,lt as b,it as c,rt as d,ct as e,ot as g,at as s,tt as u};

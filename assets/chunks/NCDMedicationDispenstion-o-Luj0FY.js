var Pe=Object.defineProperty;var Oe=(l,r,i)=>r in l?Pe(l,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[r]=i;var H=(l,r,i)=>Oe(l,typeof r!="symbol"?r+"":r,i);import{d as pe,L as x,N as O,a5 as B,a4 as z,E as Se,a6 as ge,M as G,I as Ne,a3 as fe,aR as Te,cd as J,R as Ve,H as P,e as v,f,l as o,J as c,k as e,K as d,Q as y,F as C,aU as E,an as $e,cG as Ae,r as S,c as qe,w as ne,a as Be,O as oe,u as s,aw as U,P as V,bp as re,aT as ae,m as N,b1 as le,p as ie,eG as de,c5 as ce,aQ as ze,aP as Ee}from"./vendor-BpjEhVym.js";import{E as Fe}from"./EIRreportsStore-C3K2RALB.js";import{N as Re}from"./NavigationMenu-BQ30x3EY.js";import{V as He}from"./ViewToggleComponent-ChgpAt9h.js";import{l as Ue,_ as me,b4 as j,P as je,S as Q,u as ye,aP as _e,G as Le,bX as Ge,br as ue,d as Je,q as Qe,aE as Ke,n as Xe,s as L,m as Ye,bY as We,o as Ze}from"../index-CiSAd7V7.js";import{a as ve}from"./drug_prescription_service-Cys2sRGr.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-DMAoEdNS.js";const et=pe({name:"MedicationDetailsModal",components:{IonContent:fe,IonHeader:Ne,IonFooter:G,IonPage:ge,IonTitle:Se,IonRow:z,IonCol:B,IonButton:O,IonIcon:x},props:{selectedMedication:{type:Object,default:null}},data(){return{iconsContent:Ue,medkit:J,closeIcon:Te,dismiss:()=>(this.$emit("close"),Ve.dismiss())}},methods:{formatFullDate(l){return l?new Date(l).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"N/A"},getFrequencyLabel(l){const r=ve.find(i=>i.code===l);return r?r.label:"Unknown"}}}),tt={class:"medication-details-header"},st={class:"modal_wrapper"},nt={class:"medication-details-modal"},ot={class:"text-xl font-bold mb-4"},rt={class:"grid grid-cols-2 gap-3"};function at(l,r,i,g,h,I){const p=P("ion-icon"),b=P("ion-title"),w=P("ion-header"),T=P("ion-content"),F=P("ion-button"),k=P("ion-col"),$=P("ion-row"),A=P("ion-footer");return f(),v(C,null,[o(w,{style:{display:"flex","justify-content":"space-between"}},{default:c(()=>[o(b,{class:"modalTitle"},{default:c(()=>[e("div",tt,[o(p,{icon:l.medkit,class:"ion-margin-end"},null,8,["icon"]),r[1]||(r[1]=e("span",null,"Medication Details",-1))])]),_:1}),o(p,{onClick:r[0]||(r[0]=q=>l.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:l.iconsContent.cancel},null,8,["icon"])]),_:1}),o(T,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:c(()=>[e("div",st,[e("div",nt,[e("h2",ot,d(l.selectedMedication.drug.name),1),e("div",rt,[e("div",null,[r[2]||(r[2]=e("strong",null,"Order ID:",-1)),y(" "+d(l.selectedMedication.order_id),1)]),e("div",null,[r[3]||(r[3]=e("strong",null,"Drug ID:",-1)),y(" "+d(l.selectedMedication.drug_inventory_id),1)]),e("div",null,[r[4]||(r[4]=e("strong",null,"Dose:",-1)),y(" "+d(l.selectedMedication.dose)+" "+d(l.selectedMedication.units),1)]),e("div",null,[r[5]||(r[5]=e("strong",null,"Equivalent Daily Dose:",-1)),y(" "+d(l.selectedMedication.equivalent_daily_dose),1)]),e("div",null,[r[6]||(r[6]=e("strong",null,"Frequency:",-1)),y(" "+d(l.getFrequencyLabel(l.selectedMedication.frequency)),1)]),e("div",null,[r[7]||(r[7]=e("strong",null,"Order Type:",-1)),y(" "+d(l.selectedMedication.order.order_type_id),1)]),e("div",null,[r[8]||(r[8]=e("strong",null,"Start Date:",-1)),y(" "+d(l.formatFullDate(l.selectedMedication.order.start_date)),1)]),e("div",null,[r[9]||(r[9]=e("strong",null,"Date Created:",-1)),y(" "+d(l.formatFullDate(l.selectedMedication.order.date_created)),1)]),e("div",null,[r[10]||(r[10]=e("strong",null,"Orderer:",-1)),y(" "+d(l.selectedMedication.order.orderer),1)]),e("div",null,[r[11]||(r[11]=e("strong",null,"Instructions:",-1)),y(" "+d(l.selectedMedication.order.instructions),1)])])])])]),_:1}),o(A,{collapse:"fade",class:"ion-no-border"},{default:c(()=>[o($,null,{default:c(()=>[o(k,null,{default:c(()=>[o(F,{onClick:l.dismiss,color:"primary",style:{float:"right","margin-bottom":"20px","margin-right":"20px"}},{default:c(()=>[o(p,{icon:l.closeIcon,slot:"start"},null,8,["icon"]),r[12]||(r[12]=y(" Close ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})],64)}const lt=me(et,[["render",at],["__scopeId","data-v-01db984e"]]);class it extends j{constructor(i=null,g=null){const h=new je,I=i!==null?i:h.getID(),p=g!==null?g:Q.getUserID();super(I,32,p);H(this,"drugHistory");H(this,"currentDrugOrder");this.drugHistory=[],this.currentDrugOrder=[]}getDrugHistory(){return this.drugHistory}getCurrentOrder(){return this.currentDrugOrder}getDispensationArryObj(i){return[{drug_order_id:i.order_id,date:this.date,quantity:i.amountToDispense,offline_id:i.offline_id,provider_id:this.providerID,program_id:i.program_id,patient_id:this.patientID}]}saveDispensations(i,g){return j.postJson("/dispensations",{dispensations:i,provider_id:this.providerID,program_id:g})}generateOfflineDispensatiobObject(i,g){return{dispensations:i,provider_id:this.providerID,program_id:g,patient_id:this.patientID}}async saveDispensationsOffline(i){var g,h,I;try{const p=ye(),{patient:b}=E(p),w=JSON.parse(JSON.stringify(b.value));i.length>0&&((I=(h=(g=w.dispensations)!=null?g:w.dispensations={}).unsaved)!=null||(h.unsaved=[]),w.dispensations.unsaved.length>=0&&w.dispensations.unsaved.push(...i)),await _e(w),Le("Dispensations saved offline successfully")}catch(p){Ge("Error saving dispensations offline"+p)}}async voidOrder(i){return j.void("/dispensations/".concat(i),{})}async loadDrugHistory(){const i=await ue.getDrugOrderHistory(this.patientID);i&&(this.drugHistory=i)}async loadCurrentDrugOrder(){const i=await ue.getDrugOrders(this.patientID);i&&(this.currentDrugOrder=await Promise.all(i))}calcCompletePack(i,g){const h=i.barcodes.sort(function(b,w){return b.tabs-w.tabs});if(h.length==0||g==0)return g;for(let b=0;b<=h.length-1;b++)if(parseInt(h[b].tabs)>=g)return h[b].tabs;const I=parseInt(h[0].tabs);let p=parseInt(h[h.length-1].tabs);for(;p<g;)p+=I;return p}}const dt={key:0,style:{margin:"20px"},class:"flex flex-col items-center justify-center p-8"},ct={key:1,class:"p-4",style:{"margin-left":"10px","margin-right":"10px"}},ut={class:"text-xl font-bold mb-4 program-name"},pt={class:"overflow-x-auto"},gt={class:"w-full"},ft={class:"p-3"},mt={class:"p-3"},yt={class:"flex items-center"},_t={class:"p-3"},vt={class:"p-3"},ht={class:"p-3"},bt={class:"flex items-center space-x-2"},Dt={key:0,class:"error-text text-sm"},wt={class:"p-3"},xt={class:"flex space-x-2"},kt={key:0,class:"text-center py-8"},Ct={key:2,class:"p-4",style:{"margin-left":"10px","margin-right":"10px"}},It={class:"text-xl font-bold mb-4 program-name"},Mt={class:"text-lg font-bold mb-2",style:{"margin-left":"10px","margin-right":"10px"}},Pt={class:"text-md font-medium",style:{"margin-left":"10px","margin-right":"10px"}},Ot={class:"medication-details"},St={class:"flex justify-between mb-3"},Nt={class:"flex items-center"},Tt={class:"flex items-center mb-3"},Vt={key:0,class:"error-text"},$t={class:"mt-3 flex space-x-2",style:{"margin-top":"10px"}},At={key:0,class:"text-center mb-8"},qt=pe({__name:"NCDMedicationDispenstion",setup(l){const r=Fe(),i=ye(),g=Je(),h=Qe(),{navigationPayload:I}=E(r),{patient:p}=E(i),{NCDMedicatioTogglePreference:b}=E(g),w=$e(),T=Ae(),F=S(null),k=S({}),$=S([]),A=S(null);S(""),S(!1),qe(()=>$.value.reduce((t,n)=>{const u=n.order.date_created.split("T")[0];return t[u]||(t[u]=[]),t[u].push(n),t},{}));const q=async()=>{te(),$.value=[],xe(),await ke()},he=async()=>{try{return await We()?await K():await be()}catch(t){return console.error("Error fetching programs:",t),await K()}},K=async()=>await Q.getJson("/programs",{page_size:1e3}),be=async()=>{try{return await Ze("programs")}catch(t){throw console.error("Error fetching offline districts:",t.message),t}},De=async()=>{await new Ke().printData("visit")},we=async t=>{await X(t),await w.push("/home")},X=async t=>{try{await Xe(t),await h.refresh(Q.getUserLocationId())}catch(n){console.error(n)}},xe=()=>{r.setNavigationPayload("Dispense Medication",!0,!1,"/","home")},ke=async()=>{var D,a,_,m,M,se;const t=(_=(a=(D=p.value)==null?void 0:D.MedicationOrder)==null?void 0:a.saved)!=null?_:[],n=(se=(M=(m=p.value)==null?void 0:m.MedicationOrder)==null?void 0:M.unsaved)!=null?se:[],u=[...t,...n];await Ce(u)},Ce=async t=>{const n=await he(),u={};n.forEach(a=>{u[a.program_id]=a.name}),k.value={},t.forEach(a=>{const _=u[a.program_id];_&&(k.value[_]||(k.value[_]=[]),a.quantity||k.value[_].push(a))}),t.every(a=>a.quantity)&&X(p.value)},Y=t=>{const n=ve.find(u=>u.code===t);return n?n.label:"Unknown"},R=t=>{const n=parseFloat(t.amountToDispense);isNaN(n)||n<=0?t.error="Please enter a valid amount greater than 0.":t.error=null},Bt=t=>{t.amountToDispense=t.dose,R(t)},W=async t=>{if(t.quantity=t.amountToDispense,t.error){L("Fix errors before dispensing.");return}try{const u=new it().getDispensationArryObj(t);t.dispensation=u,t.dispensed=!0,await _e(p.value)}catch(n){L("Dispensing failed. Please try again."),L("Error: "+n),console.error(n)}},Z=async t=>{A.value=t,await Ye(lt,{class:"large-modal"},!0,{selectedMedication:A.value})},ee=t=>new Date(t).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),Ie=t=>{te(t,!0)},te=(t="list",n=!1)=>{const u={toggle_view:t};Object.keys(b.value).length===0&&(u.toggle_view="list",g.setNCDMedicatioTogglePreference(u)),Object.keys(b.value).length>0&&n===!0&&g.setNCDMedicatioTogglePreference(u)},Me=t=>(console.log("Grouping medications by date:",t),t.reduce((n,u)=>{const D=u.start_date.split("T")[0];return n[D]||(n[D]=[]),n[D].push(u),n},{}));return ne(p,async()=>{T.name==="NCDDispensations"&&await q()},{deep:!0}),ne(T,t=>{t.name==="NCDDispensations"&&q()},{immediate:!0}),Be(()=>{q()}),(t,n)=>(f(),oe(s(ge),null,{default:c(()=>[o(Re,{ref_key:"navMenuRef",ref:F},null,512),o(He,{"initial-view":s(b).toggle_view,onViewChanged:Ie},null,8,["initial-view"]),o(s(fe),null,{default:c(()=>[Object.keys(k.value).length===0?(f(),v("div",dt,[o(s(x),{icon:s(U),size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),n[2]||(n[2]=e("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Medications to Dispense",-1)),n[3]||(n[3]=e("p",{class:"text-gray-600"},"There are currently no medications waiting to be dispensed for current Client.",-1))])):s(b).toggle_view==="list"?(f(),v("div",ct,[(f(!0),v(C,null,V(k.value,(u,D)=>(f(),v(C,{key:D},[e("h2",ut,d(D),1),o(s(re),{class:"mb-6"},{default:c(()=>[o(s(ae),null,{default:c(()=>[e("div",pt,[e("table",gt,[n[6]||(n[6]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"p-3 text-left"},"Date"),e("th",{class:"p-3 text-left"},"Medication"),e("th",{class:"p-3 text-left"},"Dose"),e("th",{class:"p-3 text-left"},"Frequency"),e("th",{class:"p-3 text-left"},"Amount to Dispense"),e("th",{class:"p-3 text-left"},"Actions")])],-1)),e("tbody",null,[(f(!0),v(C,null,V(u,a=>(f(),v("tr",{key:(a==null?void 0:a.order_id)||(a==null?void 0:a.offline_id),class:"border-b hover:bg-gray-50"},[e("td",ft,d(ee(a.start_date)),1),e("td",mt,[e("div",yt,[o(s(x),{icon:s(J),class:"mr-2"},null,8,["icon"]),y(" "+d(a.drug_name),1)])]),e("td",_t,d(a.dose)+" "+d(a.units),1),e("td",vt,d(Y(a.frequency)),1),e("td",ht,[e("div",bt,[o(s(le),{type:"number",placeholder:"Amount",modelValue:a.amountToDispense,"onUpdate:modelValue":_=>a.amountToDispense=_,onInput:_=>R(a),class:ie(["w-24 dose-input bordered-input",a.error?"input-error":""])},null,8,["modelValue","onUpdate:modelValue","onInput","class"]),N("",!0)]),a.error?(f(),v("div",Dt,d(a.error),1)):N("",!0)]),e("td",wt,[e("div",xt,[o(s(O),{color:"primary",size:"small",onClick:_=>W(a),disabled:!a.amountToDispense||a.dispensed},{default:c(()=>[o(s(x),{icon:s(de),class:"mr-1",style:{"margin-right":"5px"}},null,8,["icon"]),y(" "+d(a.dispensed?"Dispensed":"Dispense"),1)]),_:2},1032,["onClick","disabled"]),o(s(O),{color:"secondary",size:"small",onClick:_=>Z(a),style:{"margin-left":"10px"}},{default:c(()=>[o(s(x),{icon:s(ce),class:"mr-1",style:{"margin-right":"5px"}},null,8,["icon"]),n[5]||(n[5]=y(" Details ",-1))]),_:1},8,["onClick"])])])]))),128))])]),u.length===0?(f(),v("div",kt,[o(s(x),{icon:s(U),size:"large",class:"mb-2"},null,8,["icon"]),e("p",null,"No medications prescribed for "+d(D),1)])):N("",!0)])]),_:2},1024)]),_:2},1024)],64))),128))])):(f(),v("div",Ct,[(f(!0),v(C,null,V(k.value,(u,D)=>(f(),v(C,{key:D},[e("h2",It,d(D),1),(f(!0),v(C,null,V(Me(u),(a,_)=>(f(),v(C,{key:_},[e("h3",Mt,d(ee(_)),1),o(s(z),null,{default:c(()=>[o(s(B),{size:"12","size-md":"6","size-lg":"4"},{default:c(()=>[e("h3",Pt,d(_),1)]),_:2},1024)]),_:2},1024),o(s(z),null,{default:c(()=>[(f(!0),v(C,null,V(a,m=>(f(),oe(s(B),{style:{"margin-left":"10px","margin-right":"10px"},key:m.order_id,size:"12","size-md":"6","size-lg":"4"},{default:c(()=>[o(s(re),{class:"mb-4"},{default:c(()=>[o(s(ze),null,{default:c(()=>[o(s(Ee),{class:"medication-details-header"},{default:c(()=>[o(s(x),{icon:s(J),class:"ion-margin-end"},null,8,["icon"]),e("span",null,d(m.drug_name),1)]),_:2},1024)]),_:2},1024),o(s(ae),null,{default:c(()=>[e("div",Ot,[e("div",St,[e("span",Nt,d(Y(m.frequency))+" ("+d(m.frequency)+") ",1)]),e("div",Tt,[o(s(le),{type:"number",placeholder:"Amount",modelValue:m.amountToDispense,"onUpdate:modelValue":M=>m.amountToDispense=M,onInput:M=>R(m),class:ie(["w-24 dose-input bordered-input",m.error?"input-error":""])},null,8,["modelValue","onUpdate:modelValue","onInput","class"]),N("",!0)]),m.error?(f(),v("div",Vt,d(m.error),1)):N("",!0),e("div",$t,[o(s(O),{color:"primary",onClick:M=>W(m),disabled:!m.amountToDispense||m.dispensed},{default:c(()=>[o(s(x),{icon:s(de),class:"mr-2",style:{"margin-right":"5px"}},null,8,["icon"]),y(" "+d(m.dispensed?"Dispensed":"Dispense"),1)]),_:2},1032,["onClick","disabled"]),o(s(O),{color:"secondary",style:{"margin-left":"20px"},onClick:M=>Z(m)},{default:c(()=>[o(s(x),{icon:s(ce),class:"mr-2",style:{"margin-right":"5px"}},null,8,["icon"]),n[8]||(n[8]=y(" Details ",-1))]),_:1},8,["onClick"])])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)],64))),128)),u.length===0?(f(),v("div",At,[o(s(x),{icon:s(U),size:"large",class:"mb-2"},null,8,["icon"]),e("p",null,"No medications prescribed for "+d(D),1)])):N("",!0)],64))),128))]))]),_:1}),o(s(G),{collapse:"fade",class:"ion-no-border"},{default:c(()=>[o(s(z),null,{default:c(()=>[o(s(B),null,{default:c(()=>[o(s(O),{id:"cbtn",class:"",color:"primary",fill:"solid",style:{float:"right","margin-left":"50px"},onClick:n[0]||(n[0]=u=>De())},{default:c(()=>[...n[9]||(n[9]=[y(" Print Visit Summary ",-1)])]),_:1}),o(s(O),{id:"cbtn",class:"",color:"danger",fill:"solid",style:{float:"right","margin-left":"50px"},onClick:n[1]||(n[1]=u=>we(s(p)))},{default:c(()=>[...n[10]||(n[10]=[y(" Close visit ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),o(s(G))]),_:1}))}}),Jt=me(qt,[["__scopeId","data-v-fcb43e5d"]]);export{Jt as default};

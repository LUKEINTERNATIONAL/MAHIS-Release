System.register(["./vendor-legacy-zFWXXa6m.js","./nonPharmaTherapyStore-legacy-4z5GrC4j.js","../index-legacy-qQbWOmO1.js","./DemographicBar-legacy-B-NFJH30.js","./OPDOutcome-legacy-B5td4uBs.js","./NextAppointment-legacy-DWnrt-tW.js","./OPDDiagnosis-legacy-IVho-SfJ.js","./OPDPrintingModal-legacy-DHLY9_Ca.js","./usePatientProfile-legacy-CnLojeq4.js","./useUserActivities-legacy-DPSp7OOl.js","./lodash-legacy-pOOc9Efu.js","./drug_prescription_service-legacy-_UhxTEGS.js","./patient_diagnosis_service-legacy-D6xKfWYU.js","./apexcharts-legacy-BCtySm-E.js","./LevelOfConsciousness.vue_vue_type_script_setup_true_lang-legacy-NDJwN7Kd.js","./previousComplaints-legacy-Dao3Pi_C.js","./patient_complaints_service-legacy-BftvT6B7.js","./DashBox-legacy-BUDZWo8x.js","./BasicForm-legacy-CmL3FEpE.js","./DateInputField-legacy-DOLSCvcW.js","./formatServerData-legacy-Dk7jyFIY.js","./Outcome-legacy-CylkV3LH.js","./wardsStore-legacy-JGOHYEkn.js","./LabOrdersList-legacy-9Fpx9BCp.js","./group_validation-legacy-D5BXsFHb.js","./RadiologyStore-legacy-Di-413Ue.js","./user_role_management-legacy-CdFFs8JZ.js","./ncd_appointment_service-legacy-Bi3pa0Dj.js","./Registration-legacy-BPnNA9Ef.js","./useLocation-legacy-DYxQ-gBS.js","./vaccines_service-legacy-DjjyMr64.js","./sms_service-legacy-CoxpZpR-.js","./EIRreportsStore-legacy-U27SNdjf.js","./Export-legacy-BBiyfPBy.js","./useNeonatalEnrollmentStore-legacy-X4ma3SEH.js","./enrollment-legacy-BWFKsMdA.js"],function(e,a){"use strict";var t,n,l,i,s,o,u,r,c,v,d,g,m,p,y,f,h,b,w,P,D,_,x,j,O,S,C,T,I,A,k,N,L,F,R,B,E,M,H,W,z,U,V,Y,G,K,X,$,q,J,Q,Z,ee,ae,te,ne,le,ie,se,oe,ue,re,ce;return{setters:[e=>{t=e.d,n=e.ap,l=e.cp,i=e.r,s=e.c,o=e.b2,u=e.a,r=e.w,c=e.O,v=e.f,d=e.J,g=e.l,m=e.e,p=e.m,y=e.k,f=e.u,h=e.V,b=e.dz,w=e.a4,P=e.i,D=e.bM,_=e.v,x=e.a7,j=e.eK,O=e.ba},e=>{S=e.u,C=e._,T=e.d,I=e.a},e=>{A=e.u,k=e.aK,N=e.bX,L=e.aM,F=e.d,R=e.aO,B=e.b7,E=e.bE,M=e.bp,H=e.T,W=e.J,z=e.G,U=e.s,V=e.ag,Y=e.aU,G=e.H,K=e.aP,X=e.aR,$=e.bV,q=e.bH,J=e.q,Q=e.t,Z=e.n,ee=e._},e=>{ae=e.D},e=>{te=e.C,ne=e.b,le=e.O},e=>{ie=e.I,se=e.N},e=>{oe=e.O},e=>{ue=e.O},e=>{re=e.u},e=>{ce=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".disabled[data-v-146b079a]{color:red}.spinner-overlay[data-v-146b079a]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-146b079a]{width:80px;height:80px}.loading-text[data-v-146b079a]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-146b079a]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-146b079a]{pointer-events:none}.back_profile[data-v-146b079a]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(a);const ve={key:0,class:"spinner-overlay"},de={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},ge={class:"back_profile"};e("default",ee(t({__name:"ConsultationPlan",setup(e){const{currentTabIndex:a}=S(),{printVisitSummary:t}=re(),{hasWaitingList:ee}=ce(),me=n(),pe=l(),ye=i(!1),fe=i(!0),he=i(!1),be=i(!1),we=i(!0),Pe=i(!1),De=i(!1),_e=i(!1),xe=A(),je=k(),Oe=N(),Se=L(),Ce=F(),Te=R(),Ie=B(),Ae=E(),ke=M(),Ne=i(!1),Le=i(!1),Fe=s(()=>({text:Le.value?"Saving...":"Finish",icon:Le.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:Ne.value||Le.value})),{patient:Re}=o(xe),{investigations:Be}=o(je),{OPDdiagnosis:Ee}=o(Oe),{selectedMedicalDrugsList:Me}=o(Se),{OPDActivities:He}=o(Ce),{outcomes:We}=o(Te),{currentSelectedNextAppointmentDate:ze}=o(Ae),{presentingComplaints:Ue}=o(ke),{vitals:Ve}=o(Ie),Ye=i(null),Ge=i(null),Ke=i(null),Xe=i(null),$e=i(null),qe=i(null),Je=i(null),Qe=i(),Ze=()=>He.value.map(e=>({title:e,icon:""})),ea=async(e,t,n)=>{var l;0===t&&await oa(),await la()&&(await ia(),e%1==0&&(a.value=e),Je.value&&n&&Je.value.changeTab(e),"Investigations"===(null===(l=Qe.value[e])||void 0===l?void 0:l.title)&&Ge.value&&await Ge.value.openAHDModal())},aa=()=>{var e;if(!Qe.value||0===Qe.value.length)return null;const t=a.value>=0&&a.value<Qe.value.length?a.value:0;switch(null===(e=Qe.value[t])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(He.value.length>0)switch(He.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},ta=async()=>{be.value=!0,z("Printing consultation summary... Please wait.");try{await t(),z("Consultation summary printed successfully!"),setTimeout(()=>{me.push("home")},3500)}catch(e){U("Failed to print consultation summary.")}finally{be.value=!1}},na=()=>{z("Patient has finished consultation!"),me.push("home")},la=async()=>{const e=await V.getObsByEncounterIdAndDate(Y.PRESENTING_COMPLAINTS);return!!(e&&e.length>0)},ia=async()=>{const e=G.sessionDate();for(let t=0;t<Qe.value.length;t++)if(await la()){fe.value=!0,he.value=!1;const n=Qe.value[t];if("Clinical Assessment"===n.title){const a=K("presentingComplaints");Qe.value[t].icon=sa(e,a)?O:""}else if("Investigations"===n.title){var a;const n=null===(a=Re.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,l=null==n?void 0:n.filter(a=>G.toStandardHisFormat(e)===G.toStandardHisFormat(a.order_date));Qe.value[t].icon=(null==l?void 0:l.length)>0?O:""}else if("Diagnosis"===n.title){const a=K("diagnosis");Qe.value[t].icon=sa(e,a)?O:""}else if("Treatment Plan"===n.title){const e=K("treatment");Qe.value[t].icon=(null==e?void 0:e.length)>0?O:""}else if("Next Appointment"===n.title){const a=K("appointments");Qe.value[t].icon=sa(e,a)?O:""}else if("Outcome"===n.title){const e=K("outcomes");Qe.value[t].icon=(null==e?void 0:e.length)>0?O:""}}else fe.value=!1,"Clinical Assessment"!==Qe.value[t].title&&(Qe.value[t].icon=j);ga()},sa=(e,a)=>{if(!a)return!1;const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime||e.order_date);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},oa=async()=>{ye.value=!0;try{var e;await Promise.all([null===(e=Ye.value)||void 0===e?void 0:e.onSubmit()]),await X(Re.value),$()}catch(a){throw U("Failed to save clinical assessment"),a}finally{ye.value=!1}},ua=async()=>{try{var e;Le.value=!0,await(null===(e=Ke.value)||void 0===e?void 0:e.onSubmit()),await(async()=>{try{const e=await T();Re.value={...Re.value,...e},await I().saveNonPharmaTherapyPatientData()}catch{Q("Failed to save treatment plan")}})(),await Te.saveOutcomPatientData(),await X(Re.value);const a=localStorage.getItem("locationID");if(!a)return void U("Location ID missing.");const t=(()=>{const e=Me.value;return console.log("Checking prescribed medications:",{medicationsCount:e.length,medications:e}),e.length>0})();if(ee("Waiting for Laboratory"))return await ca(a),void z("Patient moved to Consultation for Lab follow-up.");if(t&&ee("Waiting for Consultation"))return void(ee("Waiting for Dispensation")?await ra(a):await va(a));if(!t&&ee("Waiting for Consultation"))return void(await da(a))}catch(a){U("Failed to save consultation.")}finally{Le.value=!1}},ra=async e=>{try{await q.addPatientToStage(Re.value,"DISPENSATION"),await J().refresh(e),Se.clearSelectedMedicalDrugsList(),z("Patient moved to Dispensation."),me.push("home")}catch(a){throw U("Failed to move patient to dispensation"),a}},ca=async e=>{try{await q.addPatientToStage(Re.value,"CONSULTATION"),await J().refresh(e),Se.clearSelectedMedicalDrugsList(),me.push("home")}catch(a){throw U("Failed to move patient to consultation"),a}},va=async e=>{try{await q.addPatientToStage(Re.value,"DISPENSATION"),await J().refresh(e),Se.clearSelectedMedicalDrugsList(),Q("Patient moved to dispensation queue. You lack access to dispense."),me.push("home")}catch(a){throw U("Failed to move patient to dispensation"),a}},da=async e=>{try{await Z(Re.value),await J().refresh(e),me.push("home")}catch(a){console.error("Failed to close visit:",a),U("Failed to close visit.")}};u(async()=>{0!==He.value.length?(Qe.value=Ze(),await ia(),(void 0===a.value||a.value<0)&&(a.value=0),Ne.value=!1,ga()):await me.push("home")}),r(a,async()=>{await ga()}),r(Ve,async()=>{await ia()},{deep:!0}),r(Re,async()=>{await ia()},{deep:!0}),r(Be,async()=>{await ia()},{deep:!0}),r(Ee,async()=>{await ia()},{deep:!0}),r(Me,async()=>{await ia()},{deep:!0}),r(We,async()=>{await ia()},{deep:!0}),r(ze,async()=>{await ia()}),r(Ue,async()=>{await ia()},{deep:!0}),r(pe,async()=>{we.value=!1,Qe.value=Ze(),setTimeout(()=>{a.value=0,we.value=!0},0)},{deep:!0}),r(_e,e=>{De.value=e,De.value&&setTimeout(()=>{De.value=!1},15e3)}),r(Fe,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:a.value,tabsLength:Qe.value.length})},{deep:!0});const ga=()=>{let e=!1;return Le.value&&(e=!0),Ne.value=e,!e};return(e,a)=>(v(),c(f(x),null,{default:d(()=>[g(ue,{onYes:ta,onNo:na,isOpen:Pe.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),ye.value?(v(),m("div",ve,[g(f(h),{name:"bubbles"}),a[3]||(a[3]=y("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),g(f(b),{"is-open":be.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),g(H),g(f(w),{fullscreen:!0},{default:d(()=>[g(ae),y("div",de,[we.value?(v(),c(C,{key:0,ref_key:"wizard",ref:Je,headingTitle:"Consultation Plan","vertical-tabs":"","navigable-tabs":fe.value,"scrollable-tabs":"",startIndex:0,doneButton:Fe.value,nextButton:{disabled:he.value},"custom-tabs":Qe.value,tabs:Qe.value,onChange:ea,"onComplete:wizard":a[2]||(a[2]=e=>ua())},{default:d(()=>[y("div",null,[y("div",ge,[g(W,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:f(D),"font-weight":"600",onClick:a[0]||(a[0]=e=>{me.push("home")})},null,8,["icon"]),g(W,{name:"Back to Profile",iconSlot:"start",fill:"clear",icon:f(D),"font-weight":"600",onClick:a[1]||(a[1]=e=>{me.push("patientProfile")}),style:{"margin-left":"15px"}},null,8,["icon"])])]),P(y("div",null,[g(te,{ref_key:"clinicalAssessmentRef",ref:Ye},null,512)],512),[[_,"ClinicalAssessment"===aa()]]),P(y("div",null,[g(ie,{ref_key:"investigationsRef",ref:Ge},null,512)],512),[[_,"Investigations"===aa()]]),P(y("div",null,[g(oe,{ref_key:"diagnosisRef",ref:Ke},null,512)],512),[[_,"OPDDiagnosis"===aa()]]),P(y("div",null,[g(ne,{ref_key:"treatmentPlanRef",ref:Xe},null,512)],512),[[_,"OPDTreatmentPlan"===aa()]]),P(y("div",null,[g(se,{ref_key:"nextAppointmentRef",ref:$e},null,512)],512),[[_,"NextAppointment"===aa()]]),P(y("div",null,[g(le,{ref_key:"outcomeRef",ref:qe},null,512)],512),[[_,"Outcome"===aa()]])]),_:1},8,["navigable-tabs","doneButton","nextButton","custom-tabs","tabs"])):p("",!0)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-146b079a"]]))}}});

!function(){function e(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}System.register(["./vendor-legacy-C2-GgcAe.js","./lodash-legacy-pOOc9Efu.js","../index-legacy-DggixPvN.js","./drug_prescription_service-legacy-48TQuf7Q.js","./patient_diagnosis_service-legacy-3cYDJ7MI.js"],function(t,a){"use strict";var n,i,s,r,o,d,c,l,u,g,p,v,h,m,D,y,f,_,S,b,N,O;return{setters:[e=>{n=e.D,i=e.aV},e=>{s=e.l},e=>{r=e.b2,o=e.u,d=e.af,c=e.S,l=e.E,u=e.H,g=e.aQ,p=e.bq,v=e.P,h=e.a7,m=e.G,D=e.t,y=e.aJ,f=e.aK,_=e.a0},e=>{S=e.g,b=e.D,N=e.a},e=>{O=e.P}],execute:function(){t({b:function(){try{const e=new Date(c.getSessionDate()),t=y().selectedMedicalDrugsList;let a=0;if(t.forEach(e=>{const t=parseInt(e.duration,10);!isNaN(t)&&t>a&&(a=t)}),a<=0)return{date:null,formattedDate:null};const n=new Date(e);n.setDate(e.getDate()+a);const i=String(n.getDate()).padStart(2,"0"),s=String(n.getMonth()+1).padStart(2,"0"),r=n.getFullYear();return{date:n,formattedDate:`${i}/${s}/${r}`}}catch(e){return console.error("Error calculating OPD medication run out date:",e),{date:null,formattedDate:null}}},c:async function(){try{const n=o(),{patient:s}=i(n),r=I(),d=JSON.parse(JSON.stringify(s.value));if(r.length>0){var e,t,a;null!==(t=(e=null!==(a=d.MedicationOrder)&&void 0!==a?a:d.MedicationOrder={}).unsaved)&&void 0!==t||(e.unsaved=[]);const n=d.MedicationOrder.unsaved.findIndex(e=>e.NCD_Drug_Orders);if(n>=0)d.MedicationOrder.unsaved[n].NCD_Drug_Orders=[...d.MedicationOrder.unsaved[n].NCD_Drug_Orders,...r];else{const e={NCD_Drug_Orders:r};d.MedicationOrder.unsaved.push(e)}const i=f();return i.setMedicationRunOutDate(function(){try{const e=new Date(c.getSessionDate()),t=f().selectedNCDMedicationList;let a=0;if(t.forEach(e=>{const t=parseInt(e.duration,10);!isNaN(t)&&t>a&&(a=t)}),a<=0)return{date:null,formattedDate:null};const n=new Date(e);n.setDate(e.getDate()+a);const i=String(n.getDate()).padStart(2,"0"),s=String(n.getMonth()+1).padStart(2,"0"),r=n.getFullYear();return{date:n,formattedDate:`${i}/${s}/${r}`}}catch(e){return console.error("Error calculating medication run out date:",e),{date:null,formattedDate:null}}}()),i.clearMedicationDataStores(),m("Drug order(s) has been created"),d}D("Unable to create drug orders!")}catch(n){D("Unable to create drug orders!")}},d:async function(){try{const n=o(),{patient:s}=i(n),r=T(),d=JSON.parse(JSON.stringify(s.value));if(r.length>0){var e,t,a;null!==(t=(e=null!==(a=d.MedicationOrder)&&void 0!==a?a:d.MedicationOrder={}).unsaved)&&void 0!==t||(e.unsaved=[]);const n=d.MedicationOrder.unsaved.findIndex(e=>e.NCD_Drug_Orders);if(n>=0)d.MedicationOrder.unsaved[n].NCD_Drug_Orders=[...d.MedicationOrder.unsaved[n].NCD_Drug_Orders,...r];else{const e={NCD_Drug_Orders:r};d.MedicationOrder.unsaved.push(e)}return y().clearSelectedMedicalDrugsList(),m("Drug order(s) has been created"),d}}catch(n){D("Unable to create drug orders!")}},g:async function(){const e=o(),{patient:t}=i(e),a=t.value,n=[8809,903,6410,6409];let s;s=c.getLanConnectionStatus()||c.getPouchDbStatus()?await O.getDiagnosis("",1,15):await c.getJson("diagnosis",{id:7409,page_size:2e3});const r=s.filter(e=>n.includes(e.concept_id));r.push({concept_id:8809,concept_name_id:926,concept_name_type:"FULLY_SPECIFIED",creator:1,date_created:"2004-06-25T00:00:00.000+02:00",date_voided:null,id:72,locale:"en",locale_preferred:0,name:"Hypertension",uuid:"b99faa1e-8d80-11d8-abbb-0024217bb78e",void_reason:null,voided:0,voided_by:null});const d=a.diagnosis.saved.map(e=>e.value_coded),l=a.diagnosis.unsaved.map(e=>e.value_coded),u=[...d,...l],g=r.filter(e=>u.includes(e.concept_id));return g.map(e=>e.name)},s:async function(e){try{var t,a,n;const s=o(),{patient:r}=i(s),d=JSON.parse(JSON.stringify(r.value));return null!==(a=(t=null!==(n=d.allergies)&&void 0!==n?n:d.allergies={}).unsaved)&&void 0!==a||(t.unsaved=[]),d.allergies.unsaved.push(...e),m("Allergies appended to patient record successfully"),d}catch(s){D("Unable to save Allegies!")}}});const a=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"Visual acuity test",data:{rowData:[{colData:[{inputHeader:"Left Eye",value:"",name:"Left eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"},{inputHeader:"Right Eye",value:"",name:"Right eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"}]}]}}],P=[{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Peripheral neuropathy"},data:[{name:"Neuropathy/PVO",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Deformity"},data:[{name:"Deformities",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Ulcers"},data:[{name:"Ulcers",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}}],w=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"CV Risk %",data:{rowData:[{colData:[{inputHeader:"",value:"",name:"CVD",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,valueType:"text",validationFunctionName:"isNumber"}]}]}}];t("u",n("complicationsStore",{state:()=>({visualScreening:[...a],FootScreening:[...P],cvScreening:[...w]}),actions:{setCvScreening(e){this.cvScreening=e},setVisualScreening(e){this.visualScreening=e},setFootScreening(e){this.FootScreening=e},getInitialCvScreening:()=>[...s.cloneDeep(w)],getInitialVisualScreening:()=>[...s.cloneDeep(a)],getInitialFootScreening:()=>[...s.cloneDeep(P)],resetScreening(){this.setCvScreening(this.getInitialCvScreening()),this.setFootScreening(this.getInitialFootScreening()),this.setVisualScreening(this.getInitialVisualScreening())}},persist:!0}));class C extends r{constructor(e,t){super(e,105,t)}}class M extends r{constructor(e,t){super(e,25,t)}static async get_____(e="",t=1,a=10){}}t("T",class{async onSubmitNotes(e,t,a){const n=new C(e,t);await n.createEncounter(),await n.saveObservationList(a)}async onSubmitAllergies(e,t,a){try{const n=new M(e,t);await n.createEncounter(),await n.saveObservationList(a),m("Allergies saved successfully")}catch(n){console.error("Error saving allergies:",n),D("Failed to save allergies")}}});function E(e){const t=e.match(/(\d+)\s+days/i);return t&&t.length>1?parseInt(t[1]):null}t("P",class{constructor(){e(this,"programID",void 0),e(this,"providerID",void 0),e(this,"patientID",void 0),e(this,"date",void 0),e(this,"demographics",void 0),e(this,"previousDrugPrescriptions",[]),e(this,"previousClinicalNotes",void 0),e(this,"previousDrugAllergies",void 0);const t=o();this.demographics=t.patient,this.patientID=this.demographics.patientID,this.date=d.getSessionDate(),this.providerID=c.getUserID(),this.programID=d.getProgramID(),this.previousClinicalNotes={},this.previousDrugAllergies={}}async getPatientEncounters(){const e=await this.getPatientVisitDates(),t=e.map(async e=>{const t=e.value,a=await l.getEncounters(this.patientID,{date:t});await Promise.all(a.map(async e=>{if("NOTES"==e.type.name){const{observations:t}=e;s.isEmpty(t)||t.forEach(e=>{if("2688"==e.concept_id){const t=u.toStandardHisDisplayFormat(e.obs_datetime);s.isEmpty(this.previousClinicalNotes.hasOwnProperty(t))&&(this.previousClinicalNotes[t]=[]),this.previousClinicalNotes[t].push({date:t,notes:e.value_text})}})}if("TREATMENT"==e.type.name){const{observations:n}=e;if(!s.isEmpty(n))for(const e in n){let i="<UNKNOWN CONCEPT>";const s=n[e];try{var t;i=null!=s&&null!==(t=s.concept)&&void 0!==t&&t.concept_names?s.concept.concept_names[0].name:await g.getConceptName(s.concept_id)}catch(a){console.error(s,a)}const r=await d.resolvePrimaryValue(s),o=u.toStandardHisDisplayFormat(s.date_created);"Allergic"==i&&(this.previousDrugAllergies.hasOwnProperty(o)||(this.previousDrugAllergies[o]=[]),this.previousDrugAllergies[o].push({date:o,value:r}))}}}))});await Promise.all(t);const a=e.map(async e=>{const t=await p.getOrderByPatient(this.patientID,{start_date:e.value});if(!s.isEmpty(t)){const a=t.map(e=>({drugName:e.drug.name,value:u.toStandardHisTimeFormat(e.order.start_date),dose:e.dose,frequency:S(e.frequency),prescription:u.toStandardHisFormat(e.order.auto_expire_date),duration:E(e.order.instructions),other:e}));this.previousDrugPrescriptions.push({prescriptionDate:u.toStandardHisDisplayFormat(e.value),previousPrescriptions:a})}});return await Promise.all(a),{previousDrugPrescriptions:this.previousDrugPrescriptions,previousClinicalNotes:this.previousClinicalNotes,previousDrugAllergies:this.previousDrugAllergies}}async getPatientVisitDates(){return(await v.getPatientVisits(this.patientID,!1)).map(e=>({label:u.toStandardHisDisplayFormat(e),value:e,other:{isActive:e===h.getSessionDate()}}))}});const I=()=>{const e=f();return e.selectedNCDMedicationList.map(t=>{t.frequency=e.frequency_selections[t.drug_id]||"",t.totalDosage=Object.values(t.dosage).reduce((e,t)=>e+Number(t),0);const a=b.getSessionDate(),n=j(t.drug_id);return{drug_inventory_id:t.drug_id,equivalent_daily_dose:"Unknown"==t.totalDosage?0:t.totalDosage*(null==n?void 0:n.value)||0,start_date:a,auto_expire_date:k(a,t.duration),units:t.units,instructions:`${t.name} ${t.totalDosage} ${t.units} ${(null==n?void 0:n.code)||""} for ${t.duration} days`,dose:F(t),frequency:(null==n?void 0:n.code)||""}})},F=e=>null!=e.dose_strength&&e.dose_strength?Math.trunc(e.dose_strength):1;const T=()=>y().selectedMedicalDrugsList.map(e=>{const t=b.getSessionDate(),a=N.find(t=>t.label===e.frequency)||{};return{drug_inventory_id:e.drug_id,equivalent_daily_dose:"Unknown"==e.dose?0:e.dose*(null==a?void 0:a.value)||0,start_date:t,auto_expire_date:k(t,e.duration),units:e.units,instructions:`${e.drugName}: ${e.dose} ${e.units} ${(null==a?void 0:a.code)||""} for ${e.duration} days`,dose:e.dose,frequency:(null==a?void 0:a.code)||""}}),j=e=>{const t=f().selectedNCDMedicationList.find(t=>t.drug_id===e);if(!t||!t.dosage)return null;switch(["morning","afternoon","evening"].reduce((e,a)=>e+(t.dosage[a]?1:0),0)){case 1:return t.dosage.morning?N.find(e=>"QAM"===e.code):t.dosage.afternoon?N.find(e=>"QNOON"===e.code):t.dosage.evening?N.find(e=>"QPM"===e.code):N.find(e=>"OD"===e.code);case 2:return N.find(e=>"BD"===e.code);case 3:return N.find(e=>"TDS"===e.code);default:return N.find(e=>"Unknown"===e.code)}},k=(e,t)=>{const a=new Date(e);return a.setDate(a.getDate()+parseInt(t)),u.toStandardHisFormat(a)};t("a",n("nonPharmaTherapyStore",{state:()=>({items:[{id:"wound-dressing",label:"Wound dressing",checked:!1},{id:"patient-education",label:"Patient education",checked:!1},{id:"counseling",label:"Counseling",checked:!1},{id:"minor-surgery",label:"Minor Surgery",checked:!1}],current_patient:{}}),actions:{async saveNonPharmaTherapyPatientData(){const e=_(),t=[];this.items.forEach(a=>{1==a.checked&&t.push({concept_id:11023,value_text:a.label,obs_datetime:u.toStandardHisFormat(c.getSessionDate()),location_id:e.facilityLocation.code})});const a=y().nonPharmalogicalTherapyAndOtherNotes;a&&t.push({concept_id:2592,obs_datetime:c.getSessionDate(),value_text:a,location_id:e.facilityLocation.code});try{if(t.length>0)return this.clearSelectednonPharmaTherapyStore(),m("Non Pharma Therapy staged successfully!"),await async function(e){try{var t,a,n;const s=o(),{patient:r}=i(s),d=JSON.parse(JSON.stringify(r.value));return null!==(a=(t=null!==(n=d.notes)&&void 0!==n?n:d.notes={}).unsaved)&&void 0!==a||(t.unsaved=[]),d.notes.unsaved.push(...e),d}catch(s){D("Unable to create non pharmalogical notes!")}}(t)}catch(n){D("Unable to update Non Pharma Therapy!")}},clearSelectednonPharmaTherapyStore(){this.items.forEach(e=>{e.checked=!1})},setCurrentPatient(e){this.current_patient=e}},persist:!0}))}}})}();

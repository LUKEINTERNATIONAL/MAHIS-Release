!function(){function e(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}System.register(["./vendor-legacy-DiKnuFk3.js","../index-legacy-DERpyovg.js","./BasicForm-legacy-CZRxcR_E.js","./useUserActivities-legacy-BdlxeQAu.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-OrDB9Kfl.js","./DateInputField-legacy-nin1YqTr.js"],function(t,a){"use strict";var n,s,o,i,l,d,r,u,c,p,m,v,b,f,g,y,h,_,w,I,x,S,O,T,k,D,C,B,H,L,N,F,R,P,A,J,j,$,V,E,M,z,W,K,q,U,Y,G,X,Q,Z,ee,te,ae,ne,se,oe,ie,le,de,re,ue,ce,pe,me,ve,be,fe,ge,ye;return{setters:[e=>{n=e.d,s=e.r,o=e.ap,i=e.b2,l=e.a,d=e.H,r=e.e,u=e.f,c=e.F,p=e.l,m=e.u,v=e.I,b=e.J,f=e.G,g=e.E,y=e.k,h=e.K,_=e.aW,w=e.N,I=e.a3,x=e.a4,S=e.M,O=e.bo,T=e.R,k=e.aj,D=e.a7,C=e.X,B=e.dn,H=e.dX,L=e.ak,N=e.$,F=e.bj,R=e.O,P=e.Q,A=e.P,J=e.c,j=e.w,$=e.m,V=e.cp,E=e.eq,M=e.n,z=e.b7,W=e.cW},e=>{K=e.b2,q=e.O,U=e.u,Y=e.l,G=e.aE,X=e.S,Q=e.o,Z=e.af,ee=e.bm,te=e.G,ae=e._,ne=e.J,se=e.q,oe=e.aD,ie=e.t,le=e.bH,de=e.s,re=e.aR,ue=e.aK,ce=e.m,pe=e.bI,me=e.H,ve=e.V,be=e.a,fe=e.i},e=>{ge=e.B},e=>{ye=e.u},null,null,null],execute:function(){var a=document.createElement("style");a.textContent="ion-footer[data-v-9a2f68e9]{--ion-toolbar-background: #f4f4f4f4}ion-modal[data-v-9a2f68e9]{--width: 90%;--height: 94%}ion-footer[data-v-a0bebd3e]{--ion-toolbar-background: #f4f4f4f4}ion-modal[data-v-a0bebd3e]{--width: 90%;--height: 94%}.ion-padding[data-v-ad29d329]{--padding-start: var(--ion-padding, 0px);--padding-end: var(--ion-padding, 0px);--padding-top: var(--ion-padding, 0px);--padding-bottom: var(--ion-padding, 16px)}#container[data-v-ad29d329]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container strong[data-v-ad29d329]{font-size:20px;line-height:26px}#container p[data-v-ad29d329]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container a[data-v-ad29d329]{text-decoration:none}.action_buttons[data-v-ad29d329]{color:var(--ion-color-primary);display:flex;align-items:center;float:right;max-width:70px}.modify_buttons[data-v-ad29d329]{padding-left:20px}.item_no_border[data-v-ad29d329]{--border-color: transparent}.search_result[data-v-ad29d329]{padding:10px}.action_buttons[data-v-ad29d329]{opacity:0;transition:opacity .3s}.dashed_bottom_border:hover .action_buttons[data-v-ad29d329]{opacity:1}.dashed_bottom_border[data-v-ad29d329]{font-weight:700}.sub_item_body[data-v-ad29d329]{margin-left:45px}ion-segment-button[data-v-ad29d329]{background:#fff;margin-right:1px;font-size:12px;text-transform:unset}.bottomSummary[data-v-ad29d329]{margin-top:20px;max-width:600px}.bottomSummary .segment-button-checked[data-v-ad29d329]{background:#fff!important;--indicator-color: none}.bottomSummary ion-segment-button[data-v-ad29d329]{background:#e6e6e6;margin-right:5px;border-top-right-radius:10px;border-top-left-radius:10px;text-transform:unset;font-style:normal;font-weight:700;font-size:12px}.bmi_blood[data-v-83ee6e62]{font-size:14px;font-weight:500;border:1px solid #ddeedd;border-radius:4px;padding:4px;min-width:190px}.graphBtn[data-v-83ee6e62]{font-size:14px;font-weight:500;border:1px solid #ddeedd;border-radius:4px;padding:4px;min-width:90px}._active[data-v-83ee6e62]{background-color:#ded;color:#006401;padding:5px;border-radius:4px}.iconBg[data-v-83ee6e62]{background:#ded;padding:2px;border-radius:5px}.show_more[data-v-83ee6e62]{color:#006401;padding:10px}.no-margin-left[data-v-83ee6e62]{margin:0;display:flex;justify-content:flex-start;background:#e0ffff}.scrollable-container[data-v-83ee6e62]{overflow-x:auto;-webkit-overflow-scrolling:touch;width:100%}\n/*$vite$:1*/",document.head.appendChild(a);class he extends K{constructor(t){super(t,32),e(this,"patientID",void 0),e(this,"testTypeID",void 0),e(this,"resultDate",void 0),e(this,"testID",void 0),this.patientID=t,this.testTypeID=-1,this.resultDate="",this.testID=-1}createLabResult(e){return K.postJson(`lab/tests/${this.testID}/results`,{encounter_id:this.encounterID,date:this.resultDate,measures:e})}getTestID(){return this.testID}getTestTypeID(){return this.testTypeID}setTestTypeID(e){this.testTypeID=e}setResultDate(e){this.resultDate=e}setTestID(e){this.testID=e}getTestsWithoutResults(){return q.getOrders(this.patientID,{status:"drawn"})}getTestIndicators(){return q.getJson("lab/test_result_indicators",{test_type_id:this.testTypeID})}static getTestIndicatorsWithID(e){return q.getJson("lab/test_result_indicators",{test_type_id:e})}}const _e={style:{display:"flex","align-items":"center"}},we={style:{"margin-left":"6px"}},Ie={style:{"font-weight":"400","font-size":"19px"}},xe={style:{display:"flex","align-items":"center"}},Se={style:{"font-weight":"400","font-size":"20px"}},Oe={style:{display:"flex","align-items":"center"}},Te=n({__name:"EnterLabResultsModal",props:{keyboardClose:{type:Boolean,default:!1},keepContentsMounted:{type:Boolean,default:!1},content:{default:()=>({})},popoverOpen:{type:Boolean,default:!1},event:{default:""},title:{default:""},test_data:{}},emits:["closePopoover","closeModal","saved"],setup(e,{emit:t}){var a,n;const k=e;let D=s([]);o();const C=U(),{patient:B}=i(C),H=s(null),L=s((null===(a=k.test_data)||void 0===a?void 0:a.tests[0])||{}),N=s((null===(n=L.value)||void 0===n?void 0:n.name)||""),F=()=>{T.dismiss()},R=async()=>{var e,t,a;const n=null===(e=H.value)||void 0===e?void 0:e.getFormValues(),s=await Promise.all(Object.entries(n).map(async([e,t])=>({name:e,concept_id:await Z.getConceptID(e,!0),value:(null==t?void 0:t.name)||t}))),o=await ee.buildResults(s);await ee.saveResults(B.value,o,null===(t=L.value)||void 0===t?void 0:t.id,null===(a=k.test_data)||void 0===a?void 0:a.offline_id),te("Lab results saved successfully"),F()};return l(async()=>{await(async e=>{let t;t=X.getPouchDbStatus()||X.getLanConnectionStatus()?await Q("test_result_indicators",{selector:{concept_id:e.concept_id}}):await he.getTestIndicatorsWithID(e.concept_id),t.forEach(e=>{let t={componentType:"inputField",name:e.name,header:e.name,grid:{s:"3"}};if("RBS"!=e.name&&"FBS"!=e.name||(t={...t,unit:"mg/dl"}),"MRDT"==e.name||"Tuberculosis program"==e.name||"Vdrl"==e.name||"Hepatitis B"==e.name||"Lam"==e.name||"CrAg"==e.name||"CD4 count"==e.name||"Leukocytes"==e.name||"Protein"==e.name||"Nitrite"==e.name||"Urine Ketones"==e.name||"HIV test"==e.name){let a=[];"MRDT"!=e.name&&"Vdrl"!=e.name&&"Hepatitis B"!=e.name&&"CrAg"!=e.name&&"Lam"!=e.name||(a=[{id:"1",name:"Positive"},{id:"2",name:"Negative"},{id:"3",name:"Invalid"}]),"Tuberculosis program"==e.name&&(a=[{id:"1",name:"Scanty"},{id:"2",name:"Negative"},{id:"3",name:"1+"},{id:"4",name:"2+"},{id:"5",name:"3+"}]),"CD4 count"==e.name&&(a=[{id:"1",name:"below reference line"},{id:"2",name:"above reference line"}]),"Leukocytes"!=e.name&&"Protein"!=e.name&&"Nitrite"!=e.name&&"Ketones"!=e.name&&"Urine Ketones"!=e.name||(a=[{id:"2",name:"Negative"},{id:"1",name:"Trace"},{id:"3",name:"1+"},{id:"4",name:"2+"},{id:"5",name:"3+"},{id:"6",name:"4+"}]),"HIV test"==e.name&&(a=[{id:"2",name:"Positive"},{id:"1",name:"Negative"},{id:"3",name:"Invalid"}]),t={componentType:"multiSelectInputField",header:e.name,name:e.name,trackBy:"id",icon:Y.search,options:a}}D.value.push(t)})})(L.value)}),(e,t)=>{const a=d("ion-icon");return u(),r(c,null,[p(m(v),null,{default:b(()=>[p(m(f),null,{default:b(()=>[p(m(g),null,{default:b(()=>[y("div",_e,[p(a,{icon:m(Y).saveWhite,class:"sub-menu-icon",style:{"font-size":"1.6rem"}},null,8,["icon"]),y("b",we,"Enter lab results for "+h(N.value),1)])]),_:1}),p(m(_),{slot:"end"},{default:b(()=>[p(m(g),null,{default:b(()=>[p(m(w),{onClick:t[0]||(t[0]=e=>F()),fill:"solid"},{default:b(()=>[y("span",Ie,[y("div",xe,[p(a,{icon:m(I),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),t[1]||(t[1]=y("span",{style:{"margin-left":"6px"}},"Close",-1))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),p(m(x),{class:"ion-padding"},{default:b(()=>[p(G,{formData:m(D),ref_key:"formRef",ref:H},null,8,["formData"])]),_:1}),p(m(S),null,{default:b(()=>[p(m(f),null,{default:b(()=>[p(m(_),{slot:"end"},{default:b(()=>[p(m(g),null,{default:b(()=>[p(m(w),{onClick:R,color:"primary",fill:"solid"},{default:b(()=>[y("span",Se,[y("div",Oe,[p(a,{icon:m(O),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),t[2]||(t[2]=y("span",{style:{"margin-left":"6px"}},"Save",-1))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})],64)}}}),ke=ae(Te,[["__scopeId","data-v-9a2f68e9"]]),De=n({components:{IonButtons:_,IonButton:w,IonModal:F,IonHeader:v,IonContent:x,IonToolbar:f,IonTitle:g,IonItem:N,IonList:L,IonAvatar:H,IonImg:B,IonLabel:C,IonPage:D,IonMenu:k,BasicForm:ge,IonFooter:S,DynamicButton:ne},data:()=>({popoverStatus:null}),props:{keyboardClose:{type:Boolean,default:!1},keepContentsMounted:{type:Boolean,default:!1},content:{default:[]},popoverOpen:{type:Boolean,default:!1},event:{type:Event,default:""},title:{type:String,default:""}},methods:{dismiss(){T.dismiss()},nav(e,t){this.dismiss(),this.$router.push(e)}}}),Ce={class:"modal_wrapper"},Be={class:"center text_12"};const He=ae(De,[["render",function(e,t,a,n,s,o){const i=d("ion-title"),l=d("ion-button"),m=d("ion-buttons"),v=d("ion-toolbar"),f=d("ion-header"),g=d("ion-skeleton-text"),_=d("ion-col"),w=d("ion-row"),I=d("ion-content"),x=d("ion-modal");return u(),R(x,{"is-open":e.popoverOpen,"show-backdrop":!0,onDidDismiss:t[1]||(t[1]=t=>e.$emit("closePopover",!1)),"keyboard-close":e.keyboardClose},{default:b(()=>[p(f,null,{default:b(()=>[p(v,null,{default:b(()=>[p(i,null,{default:b(()=>[y("b",null,"Lab results for ("+h(e.content.name)+") test",1)]),_:1}),p(m,{slot:"end"},{default:b(()=>[p(l,{onClick:t[0]||(t[0]=t=>e.$emit("closeModal"))},{default:b(()=>[...t[2]||(t[2]=[P("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),p(I,{class:"ion-padding"},{default:b(()=>[y("div",Ce,[y("div",Be,[p(w,null,{default:b(()=>[(u(!0),r(c,null,A(e.content.result,(e,a)=>(u(),R(_,{size:"4",key:a},{default:b(()=>[p(w,null,{default:b(()=>[p(_,{size:"8"},{default:b(()=>[e.indicator&&e.indicator.name?(u(),r(c,{key:0},[P(h(e.indicator.name),1)],64)):(u(),R(g,{key:1,animated:"",style:{width:"80%"}}))]),_:2},1024),p(_,{class:"bold",size:"0.5"},{default:b(()=>[...t[3]||(t[3]=[P(":",-1)])]),_:1}),p(_,{class:"bold",size:"2"},{default:b(()=>[P(h(e.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),_:1})]),_:1},8,["is-open","keyboard-close"])}],["__scopeId","data-v-a0bebd3e"]]),Le=ae(n({__name:"AddLabTestModal",setup(e){const t=U(),a=se(),{patient:n}=i(t),f=o(),y=Y,h=s(""),_=s(""),w=s(""),I=s(""),S=s(null),O=s(null),k=s([]),D=J(()=>[{componentType:"multiSelectInputField",name:"test",header:"Test",options:I.value,grid:{s:"6"},icon:Y.search,validation:oe.required,onChange:e=>{h.value=e.name,L()&&(w.value=[])}},{componentType:"multiSelectInputField",name:"specimen",header:"Specimen",grid:{s:"6"},icon:Y.search,validation:oe.required,value:1==w.value.length?w.value[0]:"",options:w.value.length>1?w.value:[]}]),C=J(()=>[{componentType:"checkboxField",type:"single",name:"HIV test",label:"HIV test",value:"HIV test"==h.value},{componentType:"checkboxField",type:"single",name:"Hepatitis B Test",label:"Hepatitis B Test",value:"Hepatitis B Test"==h.value},{componentType:"checkboxField",type:"single",name:"Syphilis",label:"Syphilis",value:"Syphilis"==h.value},{componentType:"checkboxField",type:"single",name:"Hepatitis C Test",label:"Hepatitis C Test",value:"Hepatitis C Test"==h.value}]);j(h,async e=>{if(e)try{w.value=await B(e)}catch(t){w.value=[]}else w.value=[]});const B=async e=>{let t;t=X.getPouchDbStatus()||X.getLanConnectionStatus()?await Q("specimens"):await q.getSpecimens("",1e3);return await Z.getConceptSet(e,"",{names:t.map(e=>e.name)})};j(n,async()=>{_.value=[...n.value.labOrders.saved,...n.value.labOrders.unsaved]},{deep:!0});const H=()=>{T.dismiss()},L=()=>"HIV test"==h.value||"Syphilis"==h.value||"Hepatitis B Test"==h.value||"Hepatitis C Test"==h.value,N=async()=>{H();const e=String(localStorage.getItem("locationID"));e?(await a.refresh(e),await f.push("/home")):de("Location not found")},F=async(e="",t)=>{try{const a=O.value.getFormValues();if(!a||0===Object.keys(a).length)return!1;if(!Object.values(a).some(e=>e))return!1;const n=Object.keys(a).map(async n=>{a[n]&&k.value.push({order_type_id:t,concept_id:await Z.getConceptID(n,!0),name:n,specimen:"Blood",reason:"Routine",specimenConcept:await Z.getConceptID("Blood",!0),referral:e})});return await Promise.all(n),k.value.length>0&&await A(k.value),a}catch(a){return console.error("Error saving HIV tests:",a),!1}},A=async e=>{var t,a,s,o,i,l;const d=await q.buildLabOrders("",e),r=JSON.parse(JSON.stringify(n.value));null!==(a=(t=null!==(s=r.labOrders)&&void 0!==s?s:r.labOrders={}).unsaved)&&void 0!==a||(t.unsaved=[]),null!==(i=(o=null!==(l=r.labOrders)&&void 0!==l?l:r.labOrders={}).saved)&&void 0!==i||(o.saved=[]),r.labOrders.unsaved.push(...d),await re(r),_.value=[...r.labOrders.saved,...r.labOrders.unsaved]};return l(async()=>{I.value=await(async()=>X.getPouchDbStatus()||X.getLanConnectionStatus()?await Q("test_types"):await q.getTestTypes())()}),(e,t)=>{const a=d("ion-icon"),s=d("ion-footer");return u(),r(c,null,[p(m(v),{style:{display:"flex","justify-content":"space-between"}},{default:b(()=>[L()?$("",!0):(u(),R(m(g),{key:0,class:"modalTitle"},{default:b(()=>[...t[5]||(t[5]=[P("Add Lab Test",-1)])]),_:1})),L()?(u(),R(m(g),{key:1,class:"modalTitle"},{default:b(()=>[...t[6]||(t[6]=[P("Add HIV Test",-1)])]),_:1})):$("",!0),p(a,{onClick:t[0]||(t[0]=e=>H()),style:{"padding-top":"10px","padding-right":"10px"},icon:m(y).cancel},null,8,["icon"])]),_:1}),L()?$("",!0):(u(),R(m(x),{key:0,class:"ion-padding",style:{"--background":"#fff"}},{default:b(()=>[p(G,{formData:D.value,ref_key:"formRef",ref:S},null,8,["formData"])]),_:1})),L()?(u(),R(m(x),{key:1,class:"ion-padding",style:{"--background":"#fff"}},{default:b(()=>[p(G,{formData:C.value,ref_key:"formRefHiv",ref:O},null,8,["formData"])]),_:1})):$("",!0),p(s,{collapse:"fade",class:"ion-no-border"},{default:b(()=>[L()?$("",!0):(u(),R(ne,{key:0,onClick:t[1]||(t[1]=e=>(async()=>{if(S.value.validateForm())return void ie("Test not saved");if(!S.value)return void console.error("Form reference is not available");const e=S.value.getFormValues(),t=e.test.name,a=e.specimen.name,n=[{concept_id:e.test.concept_id,name:t,specimen:a,reason:"Routine",specimenConcept:await Z.getConceptID(a,!0)}];await A(n),H()})()),name:"Save",fill:"solid",style:{float:"right",margin:"2%"}})),L()?(u(),R(ne,{key:1,onClick:t[2]||(t[2]=e=>(async()=>{await F("referral",9)?(te("HIV Test sent to HTS successfully"),await N()):ie("No HIV Test selected")})()),name:"Send to HTS",fill:"solid",style:{float:"right",margin:"2%"}})):$("",!0),L()?(u(),R(ne,{key:2,onClick:t[3]||(t[3]=e=>(async()=>{if(await F("",4))try{await le.addPatientToStage(n.value,"LAB"),te("The patient successfully sent to the lab. You may now attend to other patients."),await N()}catch(e){console.error("Error sending to lab:",e),de("Failed to send patient to lab")}H()})()),name:"Send to Lab",fill:"solid",style:{float:"right",margin:"2%"}})):$("",!0),L()?(u(),R(ne,{key:3,onClick:t[4]||(t[4]=e=>{h.value=""}),color:"danger",name:"Back",fill:"solid",style:{margin:"2%"}})):$("",!0)]),_:1})],64)}}}),[["__scopeId","data-v-ad29d329"]]),Ne={class:"container"},Fe={class:"table-responsive"};t("default",ae(n({__name:"LabOrdersList",props:{propOrders:{default:()=>[]}},setup(e){const t=e,a=o(),n=V(),d=U(),v=ue(),f=se(),{hasWaitingList:g}=ye(),{patient:_}=i(d),{investigations:w}=i(v),I=s(),x=s([]),S=s(["Lab Test","Specimen","Accession Number","Location","Order Date","Result","Action"]),O=s([]),T=s([]),k=s(""),D=s(!1),C=s(""),B=E(()=>{var e;return null===(e=_.value)||void 0===e?void 0:e.labOrders}),H=Y,L=s({responsive:!0,select:!1,layout:{topStart:"buttons",topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1,buttons:[{text:" <b>+ Add other tests </b>",className:"add-test text-white",action:async()=>{await F()}},{text:" <b>Send to Lab </b>",className:"send-lab text-white",attr:{id:"send-to-lab-btn"},action:async()=>{await R()}}]}),N=()=>{var e;const t=14===(null===(e=be().activeProgram)||void 0===e?void 0:e.program_id)&&!g("Waiting for Laboratory"),a=document.getElementById("send-to-lab-btn");a&&(t&&$.value?a.style.display="inline":a.style.display="none")},F=async()=>{await ce(Le,{class:"lab-results-modal"},!0,{title:"name"}),await Q()},R=async()=>{"Confirm"==await fe("Do you want to send this patient to the lab?",{cancelBtnLabel:"Cancel",confirmBtnLabel:"Send to Lab",returnName:!0})&&await P()},P=async()=>{try{const e=String(localStorage.getItem("locationID"));if(!e)return void de("Location not found");await le.addPatientToStage(_.value,"LAB"),await f.refresh(e),await a.push("home"),te("The patient successfully sent to the lab. You may now attend to other patients.")}catch(e){console.error("Error sending to lab:",e),de("Failed to send patient to lab")}},$=J(()=>{const e=B.value;if(!e)return!1;const t=[...e.saved||[],...e.unsaved||[]];return 0!==t.length&&t.some(e=>!(null==e||!e.tests||!Array.isArray(e.tests))&&e.tests.some(e=>!(null!=e&&e.result)||0===e.result.length))}),K=async()=>{var e,t,a;if(null===(e=_.value)||void 0===e||!e.labOrders)return;if(O.value=[...null===(t=_.value)||void 0===t||null===(t=t.labOrders)||void 0===t?void 0:t.saved,...null===(a=_.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.unsaved],!O.value)return;const n=await O.value.filter(e=>me.toStandardHisFormat(me.sessionDate())===me.toStandardHisFormat(e.order_date));n.length>0?w.value[0].selectedData=n:w.value[0].selectedData=""},G=(e,t,a)=>e.filter(e=>(e.order_date===a&&(e.tests=e.tests.filter(e=>e.name!==t)),e.tests.length>0)),Q=async()=>{if(!_.value.labOrders)return;O.value=[..._.value.labOrders.saved,..._.value.labOrders.unsaved];const e=ee(O.value),t=32==X.getProgramID()?[["FBS","Blood","","","","",`<button class="btn btn-outline-success btn-sm order-btn" data-id='${JSON.stringify({name:"FBS",specimen:"Blood"})}'>Order Test</button> `],["HbA1c","Blood","","","","",`<button class="btn btn-outline-success btn-sm order-btn" data-id='${JSON.stringify({name:"HbA1c",specimen:"Blood"})}'>Order Test</button> `],["RBS","Blood","","","","",`<button class="btn btn-outline-success btn-sm order-btn" data-id='${JSON.stringify({name:"RBS",specimen:"Blood"})}'>Order Test</button> `]]:[],a=t.filter(t=>!e.some(e=>e[0]===t[0])),n=e.filter(e=>t.some(t=>t[0]===e[0])),s=e.filter(e=>!n.some(t=>t[0]===e[0]));x.value=[...n,...a,...s],N(),await K(),z.use(W)},ee=(e,t)=>e.length>0?e.flatMap(e=>e.tests.flatMap(t=>{var a,n;const s=`<button class="btn btn-outline-success btn-sm result-btn" data-id='${JSON.stringify(e)}'>Enter Result</button> `,o=`<button class="btn btn-outline-secondary btn-sm view-btn" data-id='${JSON.stringify(t)}'>${H.view2}</button> `;let i=s;var l;1==(null==t||null===(a=t.result)||void 0===a?void 0:a.length)?i=null!=(null==t?void 0:t.result)?(null==t||null===(l=t.result[0])||void 0===l?void 0:l.value)||"":null:(null==t||null===(n=t.result)||void 0===n?void 0:n.length)>1&&(null==t||t.result,i=o);let d="";return null!=e&&e.accession_number&&(d=`<button class="btn btn-outline-secondary btn-sm" data-id='${JSON.stringify(e)}'>${H.print2}</button>`),[[null==t?void 0:t.name,null==e?void 0:e.specimen.name,(null==e?void 0:e.accession_number)||"",9==(null==e?void 0:e.order_type_id)?"<span class='red-tag'>HTS</span>":"",me.toStandardHisFormat(null==e?void 0:e.order_date),i,d+`\n                        <button class="btn btn-outline-danger btn-sm delete-btn" data-id='${JSON.stringify(e)}'>${H.delete2}</button>\n                        `]]})):[];return l(async()=>{14==X.getProgramID()&&L.value.buttons.push(),await K(),await Q(),M(()=>{const e=I.value.dt;e.columns.adjust().draw(),e.on("click",".result-btn",async e=>{const t=e.target.getAttribute("data-id");await ce(ke,{class:"lab-results-modal"},!0,{test_data:JSON.parse(t)})}),e.on("click",".view-btn",e=>{const t=e.target.getAttribute("data-id");k.value=JSON.parse(t),D.value=!0}),e.on("click",".delete-btn",e=>{const t=e.target.getAttribute("data-id");(async(e,t)=>{if(await ve(`Do you want to delete ${e.tests[0].name} ?`,t)){const t=JSON.parse(JSON.stringify(_.value));var a,n,s;t.labOrders.saved.some(t=>{var a,n;return t.order_date===e.order_date&&(null==t||null===(a=t.tests[0])||void 0===a?void 0:a.name)==(null==e||null===(n=e.tests[0])||void 0===n?void 0:n.name)})?(t.labOrders.saved=G(t.labOrders.saved,e.tests[0].name,e.order_date),null!==(n=(a=null!==(s=t.labOrders)&&void 0!==s?s:t.labOrders={}).voided)&&void 0!==n||(a.voided=[]),t.labOrders.voided.push({orderId:e.id,reason:"Mistake entry"})):t.labOrders.unsaved=G(t.labOrders.unsaved,e.tests[0].name,e.date),await re(t)}await Q()})(JSON.parse(t),e)}),e.on("click",".order-btn",e=>{const t=e.target.getAttribute("data-id");(async e=>{const t=[{concept_id:await Z.getConceptID(e.name,!0),name:e.name,specimen:e.specimen,reason:"Routine",specimenConcept:await Z.getConceptID(e.specimen,!0)}];let a=(await q.buildLabOrders("",t))[0];if(a.order_date=a.date||me.sessionDate(),a.specimen.name||(a.specimen.name=await Z.getConceptName(a.specimen.concept_id)),a.tests&&a.tests.length>0)for(let n=0;n<a.tests.length;n++)a.tests[n].name||(a.tests[n].name=await Z.getConceptName(a.tests[n].concept_id));_.value.labOrders.unsaved.push(a),await re(_.value),await Q()})(JSON.parse(t))})}),O.value=t.propOrders,C.value=new pe(_.value.patientID),T.value=await X.getUserRoles()}),j(()=>n,async()=>{await Q()},{deep:!0,immediate:!0}),j(()=>_,async()=>{await Q()},{deep:!0,immediate:!0}),j(()=>{var e,t;return[null===(e=_.value)||void 0===e||null===(e=e.labOrders)||void 0===e?void 0:e.saved,null===(t=_.value)||void 0===t||null===(t=t.labOrders)||void 0===t?void 0:t.unsaved]},()=>{M(()=>{N()})},{deep:!0,immediate:!0}),j($,e=>{console.log("hasTestsWithoutResults changed:",e),M(()=>{N()})},{deep:!0,immediate:!0}),(e,t)=>(u(),r("div",Ne,[y("div",Fe,[p(m(z),{ref_key:"dataTable",ref:I,options:L.value,data:x.value,class:"display nowrap modern-table",width:"100%"},{default:b(()=>[y("thead",null,[y("tr",null,[(u(!0),r(c,null,A(S.value,e=>(u(),r("th",{key:e},h(e),1))),128))])])]),_:1},8,["options","data"])]),p(He,{popoverOpen:D.value,content:k.value,onCloseModal:t[0]||(t[0]=e=>D.value=!1)},null,8,["popoverOpen","content"])]))}}),[["__scopeId","data-v-83ee6e62"]]))}}})}();

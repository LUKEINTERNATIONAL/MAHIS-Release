var ee=Object.defineProperty;var te=(a,e,n)=>e in a?ee(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n;var S=(a,e,n)=>te(a,typeof e!="symbol"?e+"":e,n);import{d as j,c as m,H as ae,e as f,f as g,m as O,k as y,p as C,j as v,l as B,K as A,r as R,w as W,a as se,F as ne,P as oe,O as re,u as ie,J,n as Q,b2 as F,D as ce}from"./vendor-BuyqdZ53.js";import{b2 as Y,u as I,ag as E,S as h,E as de,H as T,af as le,bF as ue,P as pe,a8 as ge,G as x,t as P,aM as q,aN as L,a1 as fe,aU as he}from"../index-DAxTqYIj.js";import{l as M}from"./lodash-NJiRuGo9.js";import{g as ve,D as G,a as _}from"./drug_prescription_service-CxT1X9CF.js";import{P as me}from"./patient_diagnosis_service-CvBXIerP.js";const be={class:"fw-list-wrapper"},De=["id"],ye={class:"fw-step-container"},Se={key:0},we={key:1},_e=j({__name:"WizardStep",props:{tab:{type:Object,default:()=>{}},index:{type:Number,default:0},currentIndex:{type:Number,default:0},squaredTab:{type:Boolean,default:!1},showProgress:{type:Boolean,default:!0}},setup(a){const e=a,n=m(()=>e.currentIndex>e.index);m(()=>"pi pi-".concat(e.tab.icon));const s=m(()=>["fw-list-wrapper-icon",{"fw-step-active":e.tab.active,"fw-step-checked":e.tab.checked,"fw-squared-tab":e.squaredTab}]);return(t,o)=>{const r=ae("ion-icon");return g(),f("li",null,[a.showProgress?(g(),f("div",{key:0,class:C(["fw-list-progress",{"fw-list-progress-active":n.value}])},null,2)):O("",!0),y("div",be,[y("div",{id:"step-".concat(a.tab.id),role:"tab",class:C(s.value)},[y("div",ye,[v(t.$slots,"active-step",{},()=>[a.tab.icon?(g(),f("i",Se,[B(r,{icon:a.tab.icon,style:{"font-size":"16px"}},null,8,["icon"])])):(g(),f("i",we,A(a.index+1),1))])])],10,De),v(t.$slots,"title",{},()=>[y("span",{class:C(["fw-step-title",{active:a.tab.active}])},A(a.tab.title),3)])])])}}}),Te=["disabled"],Ne={key:0},H=j({__name:"Button",props:{options:{type:Object,default:function(){return{}}}},setup(a){const e=a,n=t=>"pi pi-".concat(t),s=m(()=>["fw-btn",{"fw-btn-disabled":e.options.disabled}]);return(t,o)=>(g(),f("button",{class:C(s.value),disabled:a.options.disabled},[a.options.hideText?O("",!0):(g(),f("span",Ne,A(a.options.text),1)),a.options.hideIcon?O("",!0):(g(),f("i",{key:1,class:C(n(a.options.icon))},null,2))],10,Te))}}),Pe=["id"],Oe={key:0,class:"fw-body-list",role:"tablist"},Ce={class:"fw-body"},Ie={class:"fw-body-content"},xe={class:"fw-body-container"},ke={key:0,class:"fw-footer"},$e={class:"fw-footer-left"},Me={class:"fw-footer-right"},Ke=j({__name:"Wizard",props:{id:{type:String,default:"fw-"+new Date().valueOf()},headingTitle:{type:String,default:""},customTabs:{type:Array,default:()=>[{id:0,title:"Step 1",icon:"map"},{id:1,title:"Step 2",icon:"check"},{id:2,title:"Step 3",icon:"pencil"}]},nextButton:{type:Object,default:function(){return{}}},backButton:{type:Object,default:function(){return{}}},doneButton:{type:Object,default:function(){return{}}},hideButtons:{type:Boolean,default:!1},startIndex:{type:Number,default:0,validator:a=>a>=0},verticalTabs:{type:Boolean,default:!1},beforeChange:{type:Function,default:()=>{}},beforeMount:{type:Function,default:()=>{}},navigableTabs:{type:Boolean,default:!1},scrollableTabs:{type:Boolean,default:!1},cardBackground:{type:Boolean,default:!1},squaredTabs:{type:Boolean,default:!1},showProgress:{type:Boolean,default:!0},showWizard:{type:Boolean,default:!0}},emits:["change","complete:wizard","updated:tabs","onValidateTabs","done-button-changed"],setup(a,{expose:e,emit:n}){const s=n,t=a;let o=R(0);const r=m(()=>[...t.customTabs].map((u,w)=>({...u,checked:w<o.value,active:w===o.value}))),c=m(()=>r.value.length-1),b=m(()=>Object.assign({text:"Back",icon:"arrow-left",hideText:!1,hideIcon:!1,disabled:!1},t.backButton)),p=m(()=>Object.assign({text:"Next",icon:"arrow-right",hideText:!1,hideIcon:!1,disabled:!1},t.nextButton)),l=m(()=>Object.assign({text:"Done",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},t.doneButton));W(()=>t.doneButton,(i,u)=>{s("done-button-changed",{newOptions:l.value,oldOptions:u?Object.assign({text:"Done",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},u):null,currentTabIndex:o.value,isLastStep:d.value})},{deep:!0,immediate:!1}),W(l,(i,u)=>{console.log("Done button options changed:",{new:i,old:u,currentStep:o.value})},{deep:!0}),se(()=>{o.value=t.startIndex,N(),s("change",o.value)});const D=m(()=>o.value!==0),d=m(()=>o.value===c.value),U=m(()=>["form-wizard-vue",{"fw-vertical":t.verticalTabs},{"fw-overflow-scroll":t.scrollableTabs},{"fw-card":t.cardBackground}]),N=()=>{s("updated:tabs",r.value,o.value)},k=async()=>{if(o.value===c.value){l.value.disabled||Z();return}if(p.value.disabled)return;const i=o.value+1,u=o.value;if(!t.navigableTabs){s("change",i,u,!0);return}s("change",i,u),await t.beforeChange(),$(i)},X=async()=>{if(o.value===0||b.value.disabled)return;const i=o.value-1,u=o.value;s("change",i,u),await t.beforeChange(),$(i)},Z=()=>{const i=o.value,u=o.value-1;s("complete:wizard",i,u)},V=async i=>{if(!t.navigableTabs)return;const u=i,w=o.value;s("change",u,w),await t.beforeChange(),$(u)},$=async i=>{o.value=i,N(),await Q(),await t.beforeMount()};return e({changeTab:$}),(i,u)=>(g(),f("div",{id:a.id,class:C(U.value)},[a.showWizard?(g(),f("ul",Oe,[y("h4",null,A(a.headingTitle),1),(g(!0),f(ne,null,oe(r.value,(w,z)=>v(i.$slots,"wizard-step",{tab:w,index:z,navigateToTab:V},()=>[(g(),re(_e,{key:w.id,tab:w,index:z,currentIndex:ie(o),squaredTab:a.squaredTabs,showProgress:a.showProgress,onClick:Ve=>V(z)},{"active-step":J(()=>[v(i.$slots,"active-step")]),title:J(()=>[v(i.$slots,"title")]),_:3},8,["tab","index","currentIndex","squaredTab","showProgress","onClick"]))])),256))])):O("",!0),y("div",Ce,[y("div",Ie,[y("div",xe,[v(i.$slots,"default")])]),a.hideButtons?O("",!0):(g(),f("div",ke,[v(i.$slots,"footer",{},()=>[y("div",$e,[D.value?(g(),f("span",{key:0,role:"button",onClick:X},[v(i.$slots,"back",{},()=>[B(H,{options:b.value},null,8,["options"])])])):O("",!0),v(i.$slots,"custom-buttons-left")]),y("div",Me,[v(i.$slots,"custom-buttons-right"),d.value?(g(),f("span",{key:0,role:"button",onClick:k},[v(i.$slots,"done",{},()=>[B(H,{options:l.value},null,8,["options"])])])):(g(),f("div",{key:1,role:"button",onClick:k},[v(i.$slots,"next",{},()=>[B(H,{options:p.value},null,8,["options"])])]))])])]))])],10,Pe))}}),Xe=()=>{const a=R(""),e=t=>{t%1===0&&(a.value=t)};return{currentTabIndex:a,onChangeCurrentTab:e,onTabBeforeChange:t=>{a.value===0&&console.log("First Tab"),e(t)},changeBtnIconPosition:()=>{Q(()=>{const t=document.querySelector(".fw-footer-left .fw-btn");if(!t)return;const o=t.querySelector("span"),r=t.querySelector("i");!o||!r||(t.removeChild(o),t.removeChild(r),t.appendChild(r),t.appendChild(o))})}}};class Be extends Y{constructor(e,n){super(e,105,n)}}class Ee extends Y{constructor(e,n){super(e,25,n)}static async get_____(e="",n=1,s=10){}}async function Ze(a){var e,n,s;try{const t=I(),{patient:o}=F(t),r=JSON.parse(JSON.stringify(o.value));return(s=(n=(e=r.allergies)!=null?e:r.allergies={}).unsaved)!=null||(n.unsaved=[]),r.allergies.unsaved.push(...a),x("Allergies appended to patient record successfully"),r}catch(t){P("Unable to save Allegies!")}}class et{async onSubmitNotes(e,n,s){const t=new Be(e,n);await t.createEncounter(),await t.saveObservationList(s)}async onSubmitAllergies(e,n,s){try{const t=new Ee(e,n);await t.createEncounter(),await t.saveObservationList(s),x("Allergies saved successfully")}catch(t){console.error("Error saving allergies:",t),P("Failed to save allergies")}}}class tt{constructor(){S(this,"programID");S(this,"providerID");S(this,"patientID");S(this,"date");S(this,"demographics");S(this,"previousDrugPrescriptions",[]);S(this,"previousClinicalNotes");S(this,"previousDrugAllergies");const e=I();this.demographics=e.patient,this.patientID=this.demographics.patientID,this.date=E.getSessionDate(),this.providerID=h.getUserID(),this.programID=E.getProgramID(),this.previousClinicalNotes={},this.previousDrugAllergies={}}async getPatientEncounters(){const e=await this.getPatientVisitDates(),n=e.map(async t=>{const o=t.value,r=await de.getEncounters(this.patientID,{date:o});await Promise.all(r.map(async c=>{var b;if(c.type.name=="NOTES"){const{observations:p}=c;M.isEmpty(p)||p.forEach(l=>{if(l.concept_id=="2688"){const D=T.toStandardHisDisplayFormat(l.obs_datetime);M.isEmpty(this.previousClinicalNotes.hasOwnProperty(D))&&(this.previousClinicalNotes[D]=[]),this.previousClinicalNotes[D].push({date:D,notes:l.value_text})}})}if(c.type.name=="TREATMENT"){const{observations:p}=c;if(!M.isEmpty(p))for(const l in p){let D="<UNKNOWN CONCEPT>";const d=p[l];try{(b=d==null?void 0:d.concept)!=null&&b.concept_names?D=d.concept.concept_names[0].name:D=await le.getConceptName(d.concept_id)}catch(k){console.error(d,k)}const U=await E.resolvePrimaryValue(d),N=T.toStandardHisDisplayFormat(d.date_created);D=="Allergic"&&(this.previousDrugAllergies.hasOwnProperty(N)||(this.previousDrugAllergies[N]=[]),this.previousDrugAllergies[N].push({date:N,value:U}))}}}))});await Promise.all(n);const s=e.map(async t=>{const o=await ue.getOrderByPatient(this.patientID,{start_date:t.value});if(!M.isEmpty(o)){const r=o.map(c=>({drugName:c.drug.name,value:T.toStandardHisTimeFormat(c.order.start_date),dose:c.dose,frequency:ve(c.frequency),prescription:T.toStandardHisFormat(c.order.auto_expire_date),duration:Ae(c.order.instructions),other:c}));this.previousDrugPrescriptions.push({prescriptionDate:T.toStandardHisDisplayFormat(t.value),previousPrescriptions:r})}});return await Promise.all(s),{previousDrugPrescriptions:this.previousDrugPrescriptions,previousClinicalNotes:this.previousClinicalNotes,previousDrugAllergies:this.previousDrugAllergies}}async getPatientVisitDates(){return(await pe.getPatientVisits(this.patientID,!1)).map(e=>({label:T.toStandardHisDisplayFormat(e),value:e,other:{isActive:e===ge.getSessionDate()}}))}}function Ae(a){const e=/(\d+)\s+days/i,n=a.match(e);return n&&n.length>1?parseInt(n[1]):null}async function at(){const a=I(),{patient:e}=F(a),n=e.value,s=[8809,903,6410,6409],t="";let o;h.getLanConnectionStatus()||h.getPouchDbStatus()?o=await me.getDiagnosis(t,1,15):o=await h.getJson("diagnosis",{id:7409,page_size:2e3});const r=o.filter(d=>s.includes(d.concept_id));r.push({concept_id:8809,concept_name_id:926,concept_name_type:"FULLY_SPECIFIED",creator:1,date_created:"2004-06-25T00:00:00.000+02:00",date_voided:null,id:72,locale:"en",locale_preferred:0,name:"Hypertension",uuid:"b99faa1e-8d80-11d8-abbb-0024217bb78e",void_reason:null,voided:0,voided_by:null});const c=n.diagnosis.saved.map(d=>d.value_coded),b=n.diagnosis.unsaved.map(d=>d.value_coded),p=[...c,...b];return r.filter(d=>p.includes(d.concept_id)).map(d=>d.name)}async function st(){var a,e,n;try{const s=I(),{patient:t}=F(s),o=Le(),r=JSON.parse(JSON.stringify(t.value));if(o.length>0){(n=(e=(a=r.MedicationOrder)!=null?a:r.MedicationOrder={}).unsaved)!=null||(e.unsaved=[]),r.MedicationOrder.unsaved=[...r.MedicationOrder.unsaved,...o];const c=L();return c.setMedicationRunOutDate(Fe()),c.clearMedicationDataStores(),x("Drug order(s) has been created"),r}else P("Unable to create drug orders!")}catch(s){P("Unable to create drug orders!")}}function nt(){try{const a=new Date(h.getSessionDate()),n=q().selectedMedicalDrugsList;let s=0;if(n.forEach(p=>{const l=parseInt(p.duration,10);!isNaN(l)&&l>s&&(s=l)}),s<=0)return{date:null,formattedDate:null};const t=new Date(a);t.setDate(a.getDate()+s);const o=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),c=t.getFullYear(),b="".concat(o,"/").concat(r,"/").concat(c);return{date:t,formattedDate:b}}catch(a){return console.error("Error calculating OPD medication run out date:",a),{date:null,formattedDate:null}}}function Fe(){try{const a=new Date(h.getSessionDate()),n=L().selectedNCDMedicationList;let s=0;if(n.forEach(p=>{const l=parseInt(p.duration,10);!isNaN(l)&&l>s&&(s=l)}),s<=0)return{date:null,formattedDate:null};const t=new Date(a);t.setDate(a.getDate()+s);const o=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),c=t.getFullYear(),b="".concat(o,"/").concat(r,"/").concat(c);return{date:t,formattedDate:b}}catch(a){return console.error("Error calculating medication run out date:",a),{date:null,formattedDate:null}}}const Le=()=>{const a=L();return a.selectedNCDMedicationList.map(e=>{e.frequency=a.frequency_selections[e.drug_id]||"",e.totalDosage=Object.values(e.dosage).reduce((t,o)=>t+Number(o),0);const n=G.getSessionDate(),s=He(e.drug_id);return{drug_inventory_id:e.drug_id,equivalent_daily_dose:e.totalDosage=="Unknown"?0:e.totalDosage*(s==null?void 0:s.value)||0,start_date:n,auto_expire_date:K(n,e.duration),units:e.units,instructions:"".concat(e.name," ").concat(e.totalDosage," ").concat(e.units," ").concat((s==null?void 0:s.code)||""," for ").concat(e.duration," days"),dose:Ue(e),frequency:(s==null?void 0:s.code)||"",drug_name:e.drugName,offline_id:h.generateId(h.getUserName()),program_id:h.getProgramID()}})},Ue=a=>a.dose_strength!=null&&a.dose_strength?Math.trunc(a.dose_strength):1;async function ot(){var a,e,n;try{const s=I(),{patient:t}=F(s),o=ze(),r=JSON.parse(JSON.stringify(t.value));if(o.length>0)return(n=(e=(a=r.MedicationOrder)!=null?a:r.MedicationOrder={}).unsaved)!=null||(e.unsaved=[]),r.MedicationOrder.unsaved=[...r.MedicationOrder.unsaved,...o],x("Drug order(s) has been created"),r}catch(s){P("Unable to create drug orders!")}}const ze=()=>q().selectedMedicalDrugsList.map(e=>{const n=G.getSessionDate(),s=_.find(t=>t.label===e.frequency)||{};return{drug_inventory_id:e.drug_id,equivalent_daily_dose:e.dose=="Unknown"?0:e.dose*(s==null?void 0:s.value)||0,start_date:n,auto_expire_date:K(n,e.duration),units:e.units,instructions:"".concat(e.drugName,": ").concat(e.dose," ").concat(e.units," ").concat((s==null?void 0:s.code)||""," for ").concat(e.duration," days"),dose:e.dose,frequency:(s==null?void 0:s.code)||"",drug_name:e.drugName,offline_id:h.generateId(h.getUserName()),program_id:h.getProgramID()}}),He=a=>{const n=L().selectedNCDMedicationList.find(t=>t.drug_id===a);if(!n||!n.dosage)return null;switch(["morning","afternoon","evening"].reduce((t,o)=>t+(n.dosage[o]?1:0),0)){case 1:return n.dosage.morning?_.find(t=>t.code==="QAM"):n.dosage.afternoon?_.find(t=>t.code==="QNOON"):n.dosage.evening?_.find(t=>t.code==="QPM"):_.find(t=>t.code==="OD");case 2:return _.find(t=>t.code==="BD");case 3:return _.find(t=>t.code==="TDS");default:return _.find(t=>t.code==="Unknown")}},K=(a,e)=>{const n=new Date(a);return n.setDate(n.getDate()+parseInt(e)),T.toStandardHisFormat(n)},je=()=>q().nonPharmalogicalTherapyAndOtherNotes,rt=ce("nonPharmaTherapyStore",{state:()=>({items:[{id:"wound-dressing",label:"Wound dressing",checked:!1},{id:"patient-education",label:"Patient education",checked:!1},{id:"counseling",label:"Counseling",checked:!1},{id:"minor-surgery",label:"Minor Surgery",checked:!1}],current_patient:{}}),actions:{async saveNonPharmaTherapyPatientData(){const a=fe(),e=[];this.items.forEach(s=>{s.checked==!0&&e.push({concept_id:11023,value_text:s.label,obs_datetime:T.toStandardHisFormat(h.getSessionDate()),location_id:a.facilityLocation.code})});const n=je();n&&e.push({concept_id:2592,obs_datetime:h.getSessionDate(),value_text:n,location_id:a.facilityLocation.code});try{if(e.length>0)return this.clearSelectednonPharmaTherapyStore(),x("Non Pharma Therapy staged successfully!"),await qe(e)}catch(s){P("Unable to update Non Pharma Therapy!")}},clearSelectednonPharmaTherapyStore(){this.items.forEach(a=>{a.checked=!1})},setCurrentPatient(a){this.current_patient=a}},persist:!0});async function qe(a){try{await E.addObsToEncounterPatient(a,he.NOTES)}catch(e){P("Unable to create non pharmalogical notes!")}}export{tt as P,et as T,Ke as _,rt as a,nt as b,st as c,ot as d,at as g,Ze as s,Xe as u};

var Nt=Object.defineProperty;var Bt=(e,t,s)=>t in e?Nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var Ke=(e,t,s)=>Bt(e,typeof t!="symbol"?t+"":t,s);import{O as fe,bm as rt,t as Le,b2 as he,l as _e,_ as ge,bn as Rt,bo as Mt,aZ as Pe,M,a$ as Qe,af as de,G as Ne,S as W,J as Ge,b4 as gt,B as vt,bd as $t,o as We,aS as ie,aI as ze,H as F,u as Te,bp as Vt,aB as $e,aA as xt,aC as Ft,b0 as Xe,L as Ut,bq as Gt,br as Wt,bs as zt,bt as qt,bu as Yt,bv as jt,bw as Kt,P as ft,bx as Je,by as Qt,bz as Xt,bA as Jt,bB as Zt,s as en,aH as lt,aJ as tn,aK as nn,aL as an,d as sn,aM as on,g as rn,Z as ln,e as ht,N as dn,aN as Ve,aO as un,aQ as cn,aP as pn,bc as mn,m as _t,V as gn,aT as vn,bC as fn,bD as hn,aq as _n,bE as ce,A as xe,bF as yn,aR as Dn,ay as Ze,y as bn,az as In,a as dt}from"../index-HYjSt5BG.js";import{d as ae,aV as te,r as I,a as Ie,H as N,O as ne,f as _,J as o,l as n,k as f,e as P,F as be,P as Be,m as G,u as g,w as q,ah as Ee,b5 as Sn,b2 as qe,G as yt,E as Dt,ai as bt,aj as st,_ as Ce,I as It,a3 as it,bf as Cn,aT as An,Q as K,c as me,bA as ut,aU as St,bm as et,a4 as ke,a5 as ve,al as wn,ak as On,W as Re,K as Y,bD as En,bw as Ct,Z as Ln,bq as At,z as He,ao as wt,cp as Ot,a2 as Et,R as ct,i as Fe,v as Ue,b9 as we,L as at,p as Oe,aR as Tn,ax as Pn,N as pt,bo as kn,bS as Hn,aO as Nn}from"./vendor-Cp5kB0Ag.js";import Lt from"./LabOrdersList-CYZWvJH-.js";import{v as Ye}from"./group_validation-DBmQt7Zo.js";import{u as Bn}from"./RadiologyStore-M2NwtYqj.js";import{B as pe}from"./BasicForm-6tUEQlMT.js";import{c as Rn,f as Mn,a as $n}from"./formatServerData-VoOkvUUY.js";import{D as Tt}from"./DashBox-NCl3hQO9.js";import{p as Vn}from"./previousComplaints-XKQPsyjW.js";import{P as xn}from"./patient_complaints_service-CH1VQ_ht.js";import{u as Fn,a as tt,_ as Un,b as Gn,d as mt}from"./nonPharmaTherapyStore-Bz7RnJPq.js";import{u as Wn}from"./usePatientProfile-zXo8_NDw.js";import{u as zn}from"./useUserActivities-DJH018R3.js";import{A as qn}from"./ncd_appointment_service-Xn2VVasc.js";import{D as Yn}from"./DateInputField-BQv5ETnN.js";class Pt extends fe{constructor(){super()}async postActivities(t,s){const l=s.location_id,r=await new rt(parseInt(t),-1,l).createEncounter();if(r){const y=await fe.buildLabOrders(r,s.orders||s);if(!await fe.saveOrdersArray(r.encounter_id,y))return Le("Unable to save lab orders")}}async postAHDActivities(t,s){const l=s.location_id,r=await new rt(parseInt(t),-1,l).createEncounter(he.AHD_LAB_ORDERS);if(r){const y=await fe.buildLabOrders(r,s.orders||s);if(!await fe.saveOrdersArray(r.encounter_id,y))return Le("Unable to save lab orders")}}}const jn=["innerHTML"],Kn={class:"scrollable-container"},Qn={key:0,class:"form-section"},Xn={key:1,class:"form-section"},Jn={key:2,class:"form-section"},Zn={key:3,class:"form-section"},ea={key:4,class:"form-section"},ta={key:5,class:"form-section"},na={key:6,class:"form-section"},aa={key:7,class:"form-section"},sa=ae({__name:"RadiologyInvestigation",setup(e){const t=Bn(),{head:s,neck:l,chest:d,abdomen:r,upper_extremity:y,spine:a,pelvis:b,lower_extremity:p}=te(t),D=I(_e),C=I([]),T=(S,h,x)=>{document.querySelectorAll("#".concat(S," path")).forEach(v=>{v.classList.toggle("white-fill")}),document.querySelectorAll("#".concat(h," line")).forEach(v=>{v.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(h," rect")).forEach(v=>{v.classList.toggle("bright-green-fill"),v.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(h," path")).forEach(v=>{v.classList.toggle("dark-green-fill")}),document.querySelectorAll("#".concat(h," circle")).forEach(v=>{v.classList.toggle("bright-green-fill")});const z=C.value.findIndex(v=>v.id===x);z>=0?C.value.splice(z,1):C.value.unshift({id:x,active:!0})},U=()=>{const S=document.getElementById("SPINE");S.style.display==="none"||S.style.display==""?S.style.display="block":S.style.display="none",T("SPINE","SPINE_LABEL-2","spine")};return Ie(()=>{const S=document.getElementById("HEAD");S&&S.addEventListener("click",()=>{T("HEAD","LABEL-6","head")});const h=document.getElementById("NECK");h&&h.addEventListener("click",()=>{T("NECK","LABEL-5","neck")});const x=document.getElementById("CHEST");x&&x.addEventListener("click",()=>{T("CHEST","LABEL-4","chest")});const z=document.getElementById("ABDOMEN_LABEL");z&&z.addEventListener("click",()=>{const V=document.getElementById("ABDOMEN-2");V.style.display==="none"||V.style.display==""?V.style.display="block":V.style.display="none",T("ABDOMEN","ABDOMEN_LABEL-2","abdomen")});const v=document.getElementById("UPPER_EXTRMITY");v&&v.addEventListener("click",()=>{T("UPPER_EXTRMITY","LABEL-3","upper_extremity")});const w=document.getElementById("SPINE"),A=document.getElementById("SPINE_LABEL"),c=document.getElementById("LOWER_SPINE_INACTIVE");w&&w.addEventListener("click",()=>{U()}),A&&A.addEventListener("click",()=>{U()}),c&&c.addEventListener("click",()=>{U()});const O=document.getElementById("PELVIS");O&&O.addEventListener("click",()=>{T("PELVIS","LABEL-2","pelvis")});const E=document.getElementById("LOWER_EXTREMITY");E&&E.addEventListener("click",()=>{T("LOWER_EXTREMITY","LABEL","lower_extremity")})}),(S,h)=>{const x=N("ion-col"),z=N("ion-row");return _(),ne(z,null,{default:o(()=>[n(x,{size:"7"},{default:o(()=>[f("div",{innerHTML:D.value.full_body_sk},null,8,jn)]),_:1}),n(x,{size:"5",class:"form-column"},{default:o(()=>[f("div",Kn,[(_(!0),P(be,null,Be(C.value,v=>(_(),P(be,null,[v.id==="head"?(_(),P("div",Qn,[h[0]||(h[0]=f("h6",null,"Body Part: Head",-1)),n(pe,{contentData:g(s)},null,8,["contentData"])])):v.id==="neck"?(_(),P("div",Xn,[h[1]||(h[1]=f("h6",null,"Body Part: Neck",-1)),n(pe,{contentData:g(l)},null,8,["contentData"])])):v.id==="chest"?(_(),P("div",Jn,[h[2]||(h[2]=f("h6",null,"Body Part: Chest",-1)),n(pe,{contentData:g(d)},null,8,["contentData"])])):v.id==="abdomen"?(_(),P("div",Zn,[h[3]||(h[3]=f("h6",null,"Body Part: Abdomen",-1)),n(pe,{contentData:g(r)},null,8,["contentData"])])):v.id==="upper_extremity"?(_(),P("div",ea,[h[4]||(h[4]=f("h6",null,"Body Part: Upper Extremity",-1)),n(pe,{contentData:g(y)},null,8,["contentData"])])):v.id==="spine"?(_(),P("div",ta,[h[5]||(h[5]=f("h6",null,"Body Part: Spine",-1)),n(pe,{contentData:g(a)},null,8,["contentData"])])):v.id==="pelvis"?(_(),P("div",na,[h[6]||(h[6]=f("h6",null,"Body Part: Pelvis",-1)),n(pe,{contentData:g(b)},null,8,["contentData"])])):v.id==="lower_extremity"?(_(),P("div",aa,[h[7]||(h[7]=f("h6",null,"Body Part: Lower Extremity",-1)),n(pe,{contentData:g(p)},null,8,["contentData"])])):G("",!0)],64))),256))])]),_:1})]),_:1})}}}),kt=ge(sa,[["__scopeId","data-v-5ab54fe8"]]),ia={class:"modal_wrapper"},oa={class:"uniform_columns"},ra=ae({__name:"AHDPastMedicalHistory",setup(e,{expose:t}){const s=Rt(),{pastMedicalHistory:l}=te(s),d=I([]);Ie(()=>{d.value=s.getInitial(),r()}),q(l,()=>{r()},{deep:!0});const r=()=>{var D;const p=["TB","Chronic Obstructive Pulmonary Disease (COPD)","Asthma","Epilepsy","Previous stroke","Peptic Ulcer Disease (PUD)","Mental disorder","Bleeding disorders","Hypertension","HIV Positive","Diabetes Mellitus"];(D=Mt(l.value,"None"))!=null&&D.checked?p.forEach(C=>{Pe(l.value,"TB treatment","displayNone",!0),M(l.value,"TB drugs","displayNone",!0),M(l.value,"TB drug start date","displayNone",!0),Pe(l.value,"Hypertension medication","displayNone",!0),M(l.value,"Current hypertension treatment regimen","displayNone",!0),Pe(l.value,"HIV status","displayNone",!0),M(l.value,"ARV start date","displayNone",!0),Pe(l.value,"Diabetes","displayNone",!0),Pe(l.value,"Controlled by","displayNone",!0),Qe(l.value,C,"checked",!1),Qe(l.value,C,"disabled",!0)}):p.forEach(C=>{Qe(l.value,C,"disabled",!1)})},y=p=>{M(l.value,"TB drugs","popOverData",{filterData:!0,data:[{name:"Auramine 'O' (C.I. 41000) 50g"},{name:"Bedaquilline 100mg"},{name:"Clofazimine 100mg"},{name:"Clofazimine 50mg"},{name:"Cycloserine 125mg"},{name:"Cycloserine 250mg"},{name:"Delamanid 50mg"},{name:"Ethambutol 100mg"},{name:"Ethambutol 400mg"},{name:"Ethionamide 250mg"},{name:"Isoniazid 100mg "},{name:"Isoniazid 300mg"},{name:"Isoniazid / Rifapentine 300mg / 300mg"},{name:"Levofloxacin 100mg"},{name:"Levofloxacin 250mg"},{name:"Linezolid 600mg"},{name:"Moxifloxacin 400mg"},{name:"Pyrazinamide 400mg"},{name:"Rifabutin 150mg Capsules"},{name:"Rifampicin 150mg/isoniazid 75mg"},{name:"Rifampicin 75mg+INH 50mg dispersible"},{name:"Rifampicin 75mg+INH 50mg+Pyrazinamide 150mg dispersible"},{name:"Rifampicin150mg/Isoniazid75mg/Pyrazinamide 400mg/Ethambutol"}]}),M(l.value,"Current hypertension treatment regimen","popOverData",{filterData:!0,data:[{name:"Captopril 12.5mg"},{name:"Aspirin 75mg"},{name:"Hydrochlorothiazide 25mg"},{name:"Enalapril Meleate 5mg"},{name:"Enalapril Maleate 10mg"}]})},a=async()=>[...await Rn(l.value),...await Mn(l.value),...await $n(l.value)];return t({onSubmit:async()=>{const p=await a();if(p.length===0){Le("No past medical history data to save");return}await de.addObsToEncounterPatient(p,he.AHD_PAST_MEDICAL_HISTORY),Ne("Past medical history saved successful")}}),(p,D)=>(_(),P("div",ia,[f("div",oa,[n(pe,{contentData:g(l),initialData:d.value,"onUpdate:inputValue":y,"onUpdate:selected":y},null,8,["contentData","initialData"])])]))}}),la=ge(ra,[["__scopeId","data-v-e5153372"]]),da=ae({data:()=>({userRole:"",ready:!1,userRoleSettings:{}}),watch:{$route:{async handler(e){this.userRole=W.getUserRoles();const t=W.getProgramID(),s=W.getProgramName();this.userRole=="Lab"&&t==14&&(this.userRoleSettings={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}),t==14&&this.userRole!="Lab"&&(this.userRoleSettings={url:"home",btnName:"Go to waiting list",stepperTitle:"Consultation Plan"}),t==12&&(this.userRoleSettings={url:"contact",btnName:"Back"}),s=="LABOUR AND DELIVERY PROGRAM"&&(this.userRoleSettings={url:"labour/labourHome",btnName:"Back to home"}),s=="PNC PROGRAM"&&(this.userRoleSettings={url:"pnc/home",btnName:"Back to home"})},immediate:!0,deep:!0}}}),ua=ae({name:"Menu",mixins:[da],components:{IonContent:it,IonHeader:It,IonItem:Ce,IonList:st,IonMenu:bt,IonTitle:Dt,IonToolbar:yt,IonInput:qe,IonPopover:Sn,DashBox:Tt,SelectionPopover:$t,BasicInputField:vt,BasicForm:pe,List:gt,DynamicButton:Ge,LabOrdersList:Lt,RadiologyInvestigation:kt},data(){return{segmentContent:"Lab Investigations",iconsContent:_e,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",testResult:"",test:"",labOrders:"",filteredSpecimen:"",testData:[],popoverOpen:!1,labOrderStatus:!1,event:"",specimen:"",radiologyOrdersStatus:!1,otherOrdersStatus:!1}},setup(){return{checkmark:An,pulseOutline:Cn}},computed:{...Ee(ze,["investigations"]),...Ee(Te,["patient"]),inputFields(){return this.investigations[0].data.rowData[0].colData}},watch:{investigations:{handler(){this.setDashedBox()},deep:!0},patient:{async handler(){var e;(e=this.patient)!=null&&e.labOrders&&(this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved])},deep:!0},$route:{async handler(){await this.getTests()},deep:!0}},async mounted(){await this.getTests(),this.updateInvestigationsStores(),this.setDashedBox(),this.updateInvestigationWizard()},methods:{setSegmentContent(e){this.segmentContent=e},async getTests(){let e;W.getPouchDbStatus()&&W.getLanConnectionStatus()?e=await We("test_types"):e=await fe.getTestTypes(),M(this.investigations,"test","multiSelectData",e)},toggleLabOrderStatus(){this.labOrderStatus=!this.labOrderStatus},async updateInvestigationWizard(){var t;if(!((t=this.patient)!=null&&t.labOrders))return;this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved];const e=await this.labOrders.filter(s=>F.toStandardHisFormat(F.sessionDate())===F.toStandardHisFormat(s.order_date));e.length>0?this.investigations[0].selectedData=e:this.investigations[0].selectedData=""},async updateInvestigationsStores(){await this.updateInvestigationWizard(),ze().setInvestigations(this.investigations)},displayInputFields(){this.testResult="",this.selectedText="",this.no_item=!1,this.addItemButton=!1,this.search_item=!0},async validateRowData(){return Ye(this.investigations)},async checkTest(){return await this.isNameInData(this.inputFields[0].value.name,await this.investigations[0].selectedData)?(M(this.investigations,"test","alertsErrorMassage","Lab order already selected"),!1):(M(this.investigations,"test","alertsErrorMassage",""),!0)},async addNewRow(){Ye(this.investigations)&&await this.checkTest()&&(await this.saveTest(),this.investigations[0].data.rowData[0].colData[0].value="",this.investigations[0].data.rowData[0].colData[1].value="",this.search_item=!1,this.display_item=!0,this.addItemButton=!0),this.updateInvestigationWizard()},isNameInData(e,t){for(let s of t)for(let l of s.tests)if(l.name===e)return!0;return!1},async saveTest(){await new Pt().postAHDActivities(this.patient.patientID,[{concept_id:this.inputFields[0].value.concept_id,name:this.inputFields[0].value.name,specimen:this.inputFields[1].value.name,reason:"Routine",specimenConcept:await ie.getConceptID(this.inputFields[1].value.name,!0)}]),M(this.investigations,"specimen","disabled",!0),this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved]},async handleInputData(e){if(e.inputHeader=="Test"&&this.checkTest(),M(this.investigations,"specimen","alertsErrorMassage",""),e.inputHeader=="Test"&&e.value){let t;W.getPouchDbStatus()&&W.getLanConnectionStatus()?t=await We("specimens"):t=await fe.getSpecimens("",1e3),this.specimen=await ie.getConceptSet(e.value.name,"",{names:t.map(s=>s.name)}),this.specimen.length==1?(M(this.investigations,"specimen","value",this.specimen[0]),M(this.investigations,"specimen","disabled",!0)):(M(this.investigations,"specimen","value",""),M(this.investigations,"specimen","disabled",!1)),M(this.investigations,"specimen","multiSelectData",this.specimen)}},async filterTest(e){return await this.labOrders.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()))},async filterSpecimen(e){var t;return(t=this.specimen[0])!=null&&t.name&&e?await this.specimen.filter(s=>s==null?void 0:s.name.toLowerCase().includes(e.toLowerCase())):[]},setTest(e){this.selectedText=e.name,this.inputFields[1].inputHeader=="Test"?this.investigations[0].data.rowData[0].colData[0].value=e.name:this.investigations[0].data.rowData[0].colData[1].value=e.name,this.updateInvestigationsStores()},setDashedBox(){(this.inputFields[1].value||this.inputFields[0].value)&&(this.addItemButton=!1,this.search_item=!0,this.no_item=!1),this.investigations[0].selectedData.length>0?(this.display_item=!0,this.no_item=!1):this.search_item||(this.no_item=!0)}}}),ca={class:"background"},pa={key:0},ma={key:1},ga={key:2},va={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},fa={key:3},ha={class:"ion-padding",slot:"content"},_a={key:4};function ya(e,t,s,l,d,r){const y=N("ion-label"),a=N("ion-segment-button"),b=N("ion-segment"),p=N("VisitsHistory"),D=N("LabOrdersList"),C=N("RadiologyInvestigation");return _(),P("div",ca,[n(b,{value:e.segmentContent,style:{"margin-top":"5px"}},{default:o(()=>[n(a,{value:"Lab Investigations",onClick:t[0]||(t[0]=T=>e.setSegmentContent("Lab Investigations"))},{default:o(()=>[n(y,null,{default:o(()=>[...t[3]||(t[3]=[K("Lab Investigations",-1)])]),_:1})]),_:1}),n(a,{value:"Radiology Investigation",onClick:t[1]||(t[1]=T=>e.setSegmentContent("Radiology Investigation"))},{default:o(()=>[n(y,null,{default:o(()=>[...t[4]||(t[4]=[K("Radiology Investigation",-1)])]),_:1})]),_:1}),n(a,{value:"Other Investigation",onClick:t[2]||(t[2]=T=>e.setSegmentContent("Other Investigation"))},{default:o(()=>[n(y,null,{default:o(()=>[...t[5]||(t[5]=[K("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),e.segmentContent=="Radiology Investigation"?(_(),P("div",pa,[n(p)])):G("",!0),e.segmentContent=="Other Investigation"?(_(),P("div",ma)):G("",!0),e.segmentContent=="Lab Investigations"?(_(),P("div",ga,[f("div",va,[f("span",null,[n(D,{propOrders:e.labOrders},null,8,["propOrders"])])])])):G("",!0),e.segmentContent=="Radiology Investigation"?(_(),P("div",fa,[f("div",ha,[n(C)])])):G("",!0),e.segmentContent=="Other Investigation"?(_(),P("div",_a)):G("",!0)])}const Da=ge(ua,[["render",ya],["__scopeId","data-v-67ff1a61"]]),ba={key:0},Ia={style:{"align-content":"center"}},Sa={class:"ion-padding",slot:"content"},Ca=ae({__name:"AHDPresentingComplaints",setup(e,{expose:t}){const s=Vt(),{presentingComplaints:l}=te(s),d=I(_e),r=I(!0),y=I(!1),a=I(!0),b=I(!1),p=I([]),D=I([]),C=I(),T=me(()=>[{componentType:"multiSelectInputField",header:"Presenting Complaints",name:"PresentingComplaints",trackBy:"concept_id",icon:_e.search,hideSelected:!0,validation:c=>v(c==null?void 0:c.name,p.value)?"Presenting complaint already added":$e.required(c),options:D.value,grid:{s:"6"}},{componentType:"inputField",header:"Duration",name:"duration",icon:_e.time,validation:c=>$e.isNotEmptyandNumber(c),grid:{s:"6"},unitOptions:[{label:"Hours",value:"Hours"},{label:"Days",value:"Days"},{label:"Weeks",value:"Weeks"},{label:"Months",value:"Months"},{label:"Years",value:"Years"}],unitValidation:c=>!c||c===""?"Please select a unit.":null},{componentType:"inputField",header:"Specify the presenting complaint(s)",name:"Other (specify)",icon:_e.editPen,validation:c=>v(c,p.value)?"Presenting complaint already added":$e.required(c),condition:c=>{var O;return((O=c==null?void 0:c.PresentingComplaints)==null?void 0:O.name)==="Other"}},{componentType:"Alert",condition:c=>{var O;return $e.required((O=c==null?void 0:c.PresentingComplaints)==null?void 0:O.name)!=null},backgroundColor:"lightyellow",textColor:"black",value:"Please search thoroughly for the complaint. If it is not listed, search and select the 'Other' option to specify the complaint.",name:"noMatchAlert"}]),{formRef:U}=xt(),S=async()=>{D.value=await xn.getComplaintsList("Presenting complaint"),M(l.value,"PresentingComplaints","multiSelectData",D.value)},h=()=>{r.value=!1,a.value=!1,y.value=!0},x=async()=>{var E,V;const c=(E=U.value)==null?void 0:E.getFormValues();((V=U.value)==null?void 0:V.validateForm())==null&&(z(c),y.value=!1,a.value=!0)},z=c=>{var J;const O=c.duration+" "+c.duration_unit,E=c.PresentingComplaints,V=E.name==="Other"?c["Other (specify)"]:E.name;p.value.push({actionBtn:!0,btn:["delete"],name:V,concept_id:E.concept_id,duration:E.duration,durationUnits:E.duration_unit,display:[V,O],data:[{concept_id:8578,value_coded:E.concept_id,obs_datetime:W.getSessionDate(),child:[{concept_id:E.concept_id,value_text:O,obs_datetime:W.getSessionDate()}]}]}),(J=U.value)==null||J.resetForm(),b.value=!0},v=(c,O)=>O.some(E=>E.name===c),w=c=>{p.value=p.value.filter(O=>O.display[0]!==c.name)},A=async()=>{const c=p.value.flatMap(O=>O.data);if(c.length<=0)return Le("Presenting complaints is required");c.length<=0||(await de.addObsToEncounterPatient(c,he.AHD_PRESENTING_COMPLAINTS),Ne("Presenting complaints saved successful"),p.value=[])};return Ie(async()=>{await S()}),t({onSubmit:A}),(c,O)=>{const E=N("ion-row"),V=N("ion-label"),J=N("ion-accordion"),ye=N("ion-accordion-group");return _(),P(be,null,[n(Tt,{status:r.value,content:"No presenting complaints added"},null,8,["status"]),b.value?(_(),P("span",ba,[n(gt,{listData:p.value,"onClicked:delete":w},null,8,["listData"])])):G("",!0),y.value?(_(),ne(E,{key:1},{default:o(()=>[n(Ft,{formData:T.value,ref_key:"formRef",ref:U},null,8,["formData"]),f("div",Ia,[n(Ge,{fill:"clear",icon:d.value.plus,iconSlot:"icon-only","onClicked:btn":O[0]||(O[0]=i=>x()),name:"Save"},null,8,["icon"])])]),_:1})):G("",!0),a.value?(_(),ne(E,{key:2,style:{"margin-top":"10px"}},{default:o(()=>[n(Ge,{fill:"clear",icon:d.value.plus,iconSlot:"icon-only","onClicked:btn":O[1]||(O[1]=i=>h()),name:"Add new presenting complaints"},null,8,["icon"])]),_:1})):G("",!0),n(E,null,{default:o(()=>[n(ye,{ref_key:"accordionGroup",ref:C,class:"previousView"},{default:o(()=>[n(J,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:o(()=>[n(g(Ce),{slot:"header",color:"light"},{default:o(()=>[n(V,{class:"previousLabel"},{default:o(()=>[...O[2]||(O[2]=[K("Previous presenting complaints",-1)])]),_:1})]),_:1}),f("div",Sa,[n(Vn)])]),_:1})]),_:1},512)]),_:1})],64)}}}),Aa=ge(Ca,[["__scopeId","data-v-04755951"]]);class nt extends Xe{constructor(s,l,d){super(s,he.AHD_HIV_STAGING,d);Ke(this,"age");Ke(this,"confirmatoryTest");this.age=l,this.confirmatoryTest=null}isAdult(){return this.age>=15}isPedaid(){return this.age<=14}setAge(s){this.age=s}getFacilities(s=""){return Ut.getFacilities({name:s})}getConfirmatoryTestType(){return this.confirmatoryTest}cd4CountIsValid(s){try{return!!s.match(/^(=|<|>)([0-9]*)$/m)}catch(l){return!1}}getAlertGuidelines(){return Gt}getWhoStageGuidelines(){return this.isAdult()?Wt:zt}getProgramEligibilityGuidelines(){return this.isAdult()?qt:Yt}getRecommendedConditionGuidelines(){return this.isAdult()?jt:Kt}getStagingConditions(s){const l=this.getStagingCategoryByNum(s);return Xe.getConceptsByCategory(l)}buildWhoStageObs(s){return this.buildValueCoded("Who stage",s)}buildWhoCriteriaObs(s){return this.buildValueCoded("Who stages criteria present",s)}buildReasonForArtObs(s){return this.buildValueCoded("Reason for ART eligibility",s)}getStagingCategoryByNum(s){switch(s){case 1:return this.isAdult()?"stage_1_conditions_adults":"stage_1_conditions_pedaids";case 2:return this.isAdult()?"stage_2_conditions_adults":"stage_2_conditions_pedaids";case 3:return this.isAdult()?"stage_3_conditions_adults":"stage_3_conditions_pedaids";case 4:return this.isAdult()?"stage_4_conditions_adults":"stage_4_conditions_pedaids";default:return""}}async loadHivConfirmatoryTestType(){const s=await Xe.getFirstValueCoded(this.patientID,"Confirmatory hiv test type");s&&(this.confirmatoryTest=s)}}const wa={key:0,class:"ion-padding"},Oa={class:"accordion_group ion-padding"},Ea={style:{"font-weight":"bold"}},La={class:"error"},Ta={class:"ion-padding",slot:"content"},Pa={class:"ion-padding"},ka={class:"ion-padding"},Ha={key:0,class:"ion-padding"},Na={class:"ion-padding",style:{"border-bottom":"dashed #ccc"}},Ba=ae({__name:"AHDStaging",props:{hideSubmit:{type:Boolean,default:!1},date:{default:nt.getSessionDate()}},setup(e,{expose:t}){const s=e,l=new ft,d=I({}),r=new nt(l.getID(),l.getAge(),-1);q(()=>s.date,i=>{var $;const u=($=i==null?void 0:i.standardDate)!=null?$:nt.getSessionDate(),m=He(u).diff(l.getBirthdate(),"years");r.setAge(m),r.setDate(u)},{deep:!0,immediate:!0});const y=ut({stage_4_conditions:{title:"Stage 4 Conditions",options:[]},stage_3_conditions:{title:"Stage 3 Conditions",options:[]},stage_2_conditions:{title:"Stage 2 Conditions",options:[]},stage_1_conditions:{title:"Stage 1 Conditions",options:[]}}),a=ut({cd4:"",cd4Date:"",isChildBearing:!1,reasonForArt:"",pregnant:"",breastFeeding:"",cd4Available:"",cd4Modifier:"",cd4Location:"",whoStage:"",staging:[],confirmatoryTest:""}),b={reasonForArt:{buildObs:()=>r.buildReasonForArtObs(a.reasonForArt),suggestAvalue:()=>({"PRESUMED SEVERE HIV":{priority:1,condition:()=>l.getAgeInMonths()<12&&a.confirmatoryTest==="HIV rapid test"&&ie.getConceptsByCategory("pshd_condition").some(i=>z().includes(i.name))},"WHO STAGE IV PEDS":{priority:2,condition:()=>r.isPedaid()&&D(["stage_4_conditions"])},"WHO STAGE III PEDS":{priority:3,condition:()=>r.isPedaid()&&D(["stage_3_conditions"])},"HIV DNA polymerase chain reaction":{priority:4,condition:()=>l.getAgeInMonths()<12&&a.confirmatoryTest==="HIV DNA polymerase chain reaction"},"CD4 COUNT LESS THAN OR EQUAL TO 750":{priority:5,condition:()=>h(750)&&x()&&C()&&l.ageInMonths()>=24&&l.ageInMonths()<=56},"CD4 COUNT LESS THAN OR EQUAL TO 500":{priority:6,condition:()=>r.isPedaid()&&h(500)&&x()&&C()},"HIV infected":{priority:7,condition:()=>l.getAgeInMonths()<24||l.getAge()<=5},"WHO STAGE IV ADULT":{priority:1,condition:()=>{const i=ie.getConceptsByCategory("severe_hiv_wasting_syndrome");return r.isAdult()&&(D(["stage_4_conditions"])||i.filter(u=>z().includes(u.name)).length>=2)}},"WHO STAGE III ADULT":{priority:2,condition:()=>r.isAdult()&&D(["stage_3_conditions"])},"cd4 less than or equal to 350":{priority:3,condition:()=>r.isAdult()&&h(350)&&C()},"cd4 less than or equal to 250":{priority:4,condition:()=>r.isAdult()&&h(250)&&C()},"cd4 less than or equal to 500":{priority:4,condition:()=>r.isAdult()&&h(500)&&C()},BREASTFEEDING:{priority:5,condition:()=>r.isAdult()&&a.breastFeeding==="Yes"&&x()},"PATIENT PREGNANT":{priority:6,condition:()=>r.isAdult()&&a.pregnant==="Yes"&&x()},Asymptomatic:{priority:7,condition:()=>x()}})},whoStage:{buildObs:()=>r.buildWhoStageObs(a.whoStage),suggestAvalue:()=>({"WHO STAGE IV ADULT":{priority:1,condition:()=>r.isAdult()&&D(["stage_4_conditions"])},"WHO STAGE III ADULT":{priority:2,condition:()=>r.isAdult()&&D(["stage_3_conditions"])},"WHO STAGE II ADULT":{priority:3,condition:()=>r.isAdult()&&D(["stage_2_conditions"])},"WHO STAGE I ADULT":{priority:4,condition:()=>r.isAdult()&&D(["stage_1_conditions"])},"WHO STAGE IV PEDS":{priority:1,condition:()=>r.isPedaid()&&(D(["stage_4_conditions"])||a.reasonForArt==="WHO STAGE IV PEDS")},"WHO STAGE III PEDS":{priority:2,condition:()=>r.isPedaid()&&D(["stage_3_conditions"])},"WHO STAGE II PEDS":{priority:3,condition:()=>r.isPedaid()&&D(["stage_2_conditions"])},"WHO STAGE I PEDS":{priority:4,condition:()=>r.isPedaid()&&D(["stage_1_conditions"])}})},cd4Available:{required:()=>!0,dataHandler:i=>{i!="Yes"&&(a.cd4="",a.cd4Date=""),d.value.cd4="",d.value.cd4Modifier="",d.value.cd4Date="",d.value.cd4Location=""}},pregnant:{required:()=>a.isChildBearing,buildObs:()=>r.buildValueCoded("Is patient pregnant?",a.pregnant)},breastFeeding:{required:()=>a.isChildBearing,buildObs:()=>r.buildValueCoded("Is patient breast feeding?",a.breastFeeding)},cd4:{required:()=>a.cd4Available==="Yes",validation:()=>{if(!S()){d.value.cd4="A number is required";return}U()>1e4&&(d.value.cd4="CD4 value cannot exceed 10,000")},buildObs:()=>r.buildValueNumber("CD4 count",U(),T())},cd4Modifier:{required:()=>a.cd4Available==="Yes",validation:()=>{a.cd4Modifier||(d.value.cd4Modifier="Please select modifier")},dataHandler:i=>a.cd4Modifier=i,options:[{label:"=",value:"="},{label:">",value:">"},{label:"<",value:"<"}]},cd4Date:{required:()=>a.cd4Available==="Yes",dataHandler:i=>{i&&(a.cd4Date=He(i).format("YYYY-MM-DD"))},validation:()=>{if(isNaN(new Date(a.cd4Date).getTime())){d.value.cd4Date="Invalid CD4 date";return}const i=He(a.cd4Date);if(i.isAfter(He(r.getDate()))){d.value.cd4Date="Cd4 result date can't be greater than ".concat(r.getDate());return}i.isBefore(He(l.getBirthdate()))&&(d.value.cd4Date="CD4 date must not be earlier than birthdate")},buildObs:()=>r.buildValueDate("Cd4 count datetime",a.cd4Date)},cd4Location:{required:()=>a.cd4Available==="Yes",dataHandler:i=>a.cd4Location=i,buildObs:()=>r.buildValueText("Cd4 count location",a.cd4Location)},staging:{validation:()=>{if(Object.keys(y).every($=>c($)<=0)){d.value.staging="Please select one or more staging conditions";return}const u=["stage_4_conditions","stage_3_conditions","stage_2_conditions"].some($=>c($)>0);y.stage_1_conditions.options.some($=>/asymptomatic/i.test($.name)&&$.checked)&&u&&(d.value.staging="Asymptomatic cannot be selected with other staging conditions")},buildObs:()=>Object.keys(y).reduce((u,m)=>(y[m].options.forEach($=>{$.checked&&u.push($.name)}),u),[]).map(u=>r.buildWhoCriteriaObs(u))}};function p(){Object.keys(a).forEach(i=>{typeof a[i]=="boolean"?a[i]=!1:Array.isArray(a[i])?a[i]=[]:a[i]=""}),Object.keys(d.value).forEach(i=>d.value[i]=""),V()}function D(i){return i.some(u=>c(u)>0)}function C(){return new Date(a.cd4Date)<=new Date("2016-04-30")}function T(){return a.cd4Modifier}function U(){return parseInt("".concat(a.cd4))}function S(){return/^\d+$/i.test("".concat(a.cd4))}function h(i){if(!S())return!1;const u=T(),m=U();return u==="="&&i===m||u==="<"&&m<=i||u===">"&&m>=i}function x(){return D(["stage_2_conditions","stage_1_conditions"])}function z(){return Object.keys(y).reduce((i,u)=>(y[u].options.forEach(m=>m.checked&&i.push(m.name)),i),[])}function v(i){if(d.value[i]="",typeof b[i].required=="function"&&b[i].required()&&!a[i]){d.value[i]="This field is required";return}a[i]&&typeof b[i].validation=="function"&&b[i].validation()}function w(i){var u,m,$;if(b[i]&&"suggestAvalue"in b[i]){a[i]="";const Q=b[i].suggestAvalue(),se=Object.keys(Q).reduce((Z,R)=>{const Se=Q[R];return typeof Se.condition=="function"&&Se.condition()?[...Z,{value:R,priority:Se.priority}]:Z},[]);a[i]=($=(m=(u=se.sort((Z,R)=>Z.priority-R.priority))==null?void 0:u[0])==null?void 0:m.value)!=null?$:""}}function A(){return Object.keys(a).reduce((i,u)=>{if(u in b&&a[u]&&typeof b[u].buildObs=="function"){const m=b[u].buildObs();return Array.isArray(m)?[...i,...m]:[...i,m]}return i},[])}function c(i){return y[i].options.filter(u=>u.checked).length}async function O(){await r.loadHivConfirmatoryTestType(),a.confirmatoryTest=r.getConfirmatoryTestType(),a.isChildBearing=l.isChildBearing()}function E(i,u){i in b&&typeof b[i].dataHandler=="function"&&b[i].dataHandler(u),v(i),Object.keys(b).forEach(m=>w(m))}function V(){Object.keys(y).forEach(i=>{var $,Q;const u=Number((Q=($=i.match(/\d+/))==null?void 0:$[0])!=null?Q:0),m=r.getStagingConditions(u);y[i].options=m.map(se=>({checked:!1,name:se.name,concept_id:se.concept_id}))})}function J(){return Object.keys(b).forEach(i=>v(i)),Object.keys(d.value).every(i=>"".concat(d.value[i]).length<=0)}async function ye(){if(console.log("Submitting staging"),!J())return Le("Please review form for errors"),!1;try{const i=await Promise.all(A());return await r.createEncounter(),await r.saveObservationList(i),Ne("Staging Observations saved!"),!0}catch(i){return console.error(i),en("Error has occured while saving observations"),!1}}return q(()=>s.date,i=>{r.setDate(i),l.date=i,p()}),Ie(async()=>{await O(),V()}),t({validateStagingForm:J,buildPayload:A,onSubmit:ye}),(i,u)=>(_(),ne(g(At),null,{default:o(()=>[n(g(St),null,{default:o(()=>[a.isChildBearing?(_(),P("div",wa,[n(g(et),null,{default:o(()=>[n(g(ke),null,{default:o(()=>[n(g(ve),null,{default:o(()=>[n(Je,{label:"Pregnant?",modelValue:a.pregnant,"onUpdate:modelValue":u[0]||(u[0]=m=>a.pregnant=m),onIonChange:u[1]||(u[1]=m=>E("pregnant",m)),"error-message":d.value.pregnant},null,8,["modelValue","error-message"])]),_:1}),n(g(ve),null,{default:o(()=>[n(Je,{label:"Breastfeeding?",modelValue:a.breastFeeding,"onUpdate:modelValue":u[2]||(u[2]=m=>a.breastFeeding=m),onOnChange:u[3]||(u[3]=m=>E("breastFeeding",m)),"error-message":d.value.breastFeeding},null,8,["modelValue","error-message"])]),_:1})]),_:1})]),_:1})])):G("",!0),f("div",Oa,[n(g(wn),{color:"light"},{default:o(()=>[(_(!0),P(be,null,Be(y,(m,$)=>(_(),ne(g(On),{key:$},{default:o(()=>[n(g(Ce),{color:"light",slot:"header"},{default:o(()=>[n(g(Re),{style:{color:"grey","font-size":"17px"},class:"ion-padding"},{default:o(()=>[f("b",Ea,[K(Y(m.title)+" ",1),n(g(En),{color:c("".concat($))>0?"primary":void 0},{default:o(()=>[K(" Selected: "+Y(c("".concat($))),1)]),_:2},1032,["color"])]),f("p",La,Y(d.value.staging),1)]),_:2},1024)]),_:2},1024),f("div",Ta,[n(g(st),null,{default:o(()=>[(_(!0),P(be,null,Be(m.options,(Q,se)=>(_(),ne(g(Ce),{key:se},{default:o(()=>[n(g(Ct),{modelValue:Q.checked,"onUpdate:modelValue":Z=>Q.checked=Z,onIonChange:Z=>E("staging",{stage_type:$,raw:Z,option:Q})},null,8,["modelValue","onUpdate:modelValue","onIonChange"]),n(g(Re),{style:{margin:"13px"}},{default:o(()=>[K(Y(Q.name),1)]),_:2},1024),u[15]||(u[15]=f("p",null,null,-1)),Q.description?(_(),ne(g(Ln),{key:0,color:Q.color},{default:o(()=>[K(Y(Q.text),1)]),_:2},1032,["color"])):G("",!0)]),_:2},1024))),128))]),_:2},1024)])]),_:2},1024))),128))]),_:1})]),f("div",Pa,[f("div",ka,[n(Je,{label:"Recent CD4 count results available?",modelValue:a.cd4Available,"onUpdate:modelValue":u[4]||(u[4]=m=>a.cd4Available=m),onOnChange:u[5]||(u[5]=m=>E("cd4Available",m)),"error-message":d.value.cd4Available},null,8,["modelValue","error-message"])]),a.cd4Available==="Yes"?(_(),P("div",Ha,[n(g(et),{class:"ion-padding"},{default:o(()=>[n(g(ke),null,{default:o(()=>[n(g(ve),null,{default:o(()=>[n(Qt,{label:"CD4 Count Date",modelValue:a.cd4Date,"onUpdate:modelValue":u[6]||(u[6]=m=>a.cd4Date=m),required:a.cd4Available==="Yes","error-message":d.value.cd4Date,onOnChange:u[7]||(u[7]=m=>E("cd4Date",m))},null,8,["modelValue","required","error-message"])]),_:1})]),_:1}),n(g(ke),null,{default:o(()=>[n(g(ve),{size:"2"},{default:o(()=>[n(Xt,{label:"CD4 Result Modifier",required:a.cd4Available==="Yes","error-message":d.value.cd4Modifier,options:b.cd4Modifier.options,onOnChange:u[8]||(u[8]=m=>E("cd4Modifier",m.value))},null,8,["required","error-message","options"])]),_:1}),n(g(ve),{size:"10"},{default:o(()=>[n(Jt,{label:"CD4 Count",modelValue:a.cd4,"onUpdate:modelValue":u[9]||(u[9]=m=>a.cd4=m),type:"number",onOnChange:u[10]||(u[10]=m=>E("cd4",m)),placeholder:"Enter CD4 Count","error-message":d.value.cd4},null,8,["modelValue","error-message"])]),_:1})]),_:1}),n(g(ke),{style:{"margin-top":"15px"}},{default:o(()=>[n(g(ve),null,{default:o(()=>[n(Zt,{label:"CD4 Count Location",modelValue:a.cd4Location,"onUpdate:modelValue":u[11]||(u[11]=m=>a.cd4Location=m),required:a.cd4Available==="Yes","error-message":d.value.cd4Location,show_error:!1,selected_district_ids:[],selected_location:a.cd4Location,onOnChange:u[12]||(u[12]=m=>{E("cd4Location",m)})},null,8,["modelValue","required","error-message","selected_location"])]),_:1})]),_:1})]),_:1})])):G("",!0)]),f("div",Na,[n(g(et),null,{default:o(()=>[n(g(ke),null,{default:o(()=>[n(g(ve),null,{default:o(()=>[n(g(qe),{readonly:"",placeholder:"N/A",label:"REASON FOR ART:",modelValue:a.reasonForArt,"onUpdate:modelValue":u[13]||(u[13]=m=>a.reasonForArt=m)},null,8,["modelValue"])]),_:1}),n(g(ve),null,{default:o(()=>[n(g(qe),{readonly:"",placeholder:"N/A",label:"WHO STAGE:",modelValue:a.whoStage,"onUpdate:modelValue":u[14]||(u[14]=m=>a.whoStage=m)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),Ra=ge(Ba,[["__scopeId","data-v-1fe6c93a"]]),Ma={style:{display:"flex","align-items":"center"}},$a={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},Va=ae({__name:"AHDWorkflow",props:{closeModalOnFinish:{type:Boolean,default:!1}},setup(e,{expose:t}){const s=e,{onTabBeforeChange:l,currentTabIndex:d}=Fn();Wn();const r=wt(),y=Ot();I([]),I([]),I(!1);const a=I(!0),b=I(!1),p=I(!1),D=me(()=>({text:p.value?"Saving...":"Finish",icon:p.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:b.value||p.value})),C=lt(),T=Te(),U=ze(),S=tn();nn();const h=an(),x=sn();on();const z=rn(),v=tt(),w=ln(),{patient:A}=te(T),{vitals:c}=te(C),{investigations:O}=te(U),{diagnosis:E}=te(S),{substance:V}=te(z),{selectedNCDMedicationList:J}=te(h),{FootScreening:ye,visualScreening:i,cvScreening:u}=te(v),{sessionDate:m}=te(w),{apiStatus:$}=te(ht());q(D,(L,B)=>{console.log("Done button options changed:",{from:B,to:L,currentStep:d.value,tabsLength:R.value.length}),L.disabled!==(B==null?void 0:B.disabled)&&console.log("Done button ".concat(L.disabled?"disabled":"enabled")),L.text!==(B==null?void 0:B.text)&&console.log('Done button text changed from "'.concat(B==null?void 0:B.text,'" to "').concat(L.text,'"'))},{deep:!0}),q(p,(L,B)=>{L!==B&&(console.log("Saving state changed: ".concat(B," -> ").concat(L)),console.log(L?"Starting save process...":"Save process completed"))});const Q=L=>{console.log("Done button change received from wizard:",L),L.newOptions.disabled&&console.log("Done button has been disabled"),L.isLastStep&&console.log("User is on the last step, done button should be visible")},se=()=>{let L=!1;return H(),p.value&&(L=!0),b.value=L,!L},Z=()=>[{title:"Presenting Complaints",icon:""},{title:"Past Medical History",icon:""},{title:"WHO",icon:""},{title:"Investigation",icon:""}],R=I(Z()),Se=I(null),k=I(null),H=()=>{var ee;if(!R.value||R.value.length===0)return console.log("Tabs not yet initialized"),null;const L=d.value>=0&&d.value<R.value.length?d.value:0;switch((ee=R.value[L])==null?void 0:ee.title){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation";default:if(x.NCDActivities.length>0)switch(x.NCDActivities[0]){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation"}return null}},X=()=>{a.value=!1,setTimeout(()=>{d.value=0,a.value=!0},0)},De=()=>{const L=lt();L.setVitals(L.getInitialVitals(A.value.ID))},oe=async()=>{var ee,ue;const L=dn(m.value,"sessionDate","value")||F.sessionDate(),B=Ve("vitals");for(let j=0;j<R.value.length;j++){const re=R.value[j];if(re.title==="Vital Signs")R.value[j].icon=Ae(L,B)?we:"";else if(re.title==="Risk Assessment"){const le=Ve("substanceAbuse");R.value[j].icon=Ae(L,le)?we:""}else if(re.title==="Investigations"){const le=(ue=(ee=A==null?void 0:A.value)==null?void 0:ee.labOrders)==null?void 0:ue.saved,je=le==null?void 0:le.filter(Ht=>F.toStandardHisFormat(L)===F.toStandardHisFormat(Ht.order_date));R.value[j].icon=(je==null?void 0:je.length)>0?we:""}else if(re.title==="Diagnosis"){const le=Ve("diagnosis");R.value[j].icon=Ae(L,le)?we:""}else if(re.title==="Complications Screening"){const le=Ve("screening");R.value[j].icon=Ae(L,le)?we:""}else re.title==="Treatment Plan"&&(J.value.length>0?R.value[j].icon=un()?we:"":R.value[j].icon="")}se()},Ae=(L,B)=>{const ee=new Date(L);return ee.setHours(0,0,0,0),B.some(ue=>{const j=new Date(ue.obs_datetime);return j.setHours(0,0,0,0),j.getTime()===ee.getTime()})},Me=async(L,B)=>{var ue,j,re;const ee=(ue=R.value[B])==null?void 0:ue.title;L%1===0&&(d.value=L),ee=="Vital Signs"&&((j=Se.value)==null||j.onSubmit()),ee=="Risk Assessment"&&((re=k.value)==null||re.onSubmit())},ot=async()=>{p.value=!0;try{await cn(),await pn(A.value),s.closeModalOnFinish?(await ct.dismiss(),Ne("All data saved successfully")):(Ne("All data saved successfully"),r.push("/triageList"))}catch(L){console.error("Error saving data:",L),Le("Error occurred while saving data. Please try again.")}finally{p.value=!1}};return Ie(async()=>{if(x.NCDActivities.length===0){r.push("patientProfile");return}tt().resetScreening(),R.value=Z(),await oe(),(d.value===void 0||d.value<0)&&(d.value=0,console.log("Setting initial tab index to 0")),b.value=!1,p.value=!1,se()}),q(d,async()=>{await se()}),q(c,async()=>{await oe()},{deep:!0}),q(A,async()=>{tt().resetScreening(),await oe()},{deep:!0}),q(m,async()=>{await oe()},{deep:!0}),q(O,async()=>{await oe()},{deep:!0}),q(E,async()=>{await oe()},{deep:!0}),q(V,async()=>{await oe()},{deep:!0}),q(J,async()=>{await oe()},{deep:!0}),q(y,async L=>{X(),De(),R.value=Z()},{deep:!0}),q(A,async(L,B)=>{L.ID!=B.ID&&(X(),De())},{deep:!0}),t({saveData:ot,markWizard:oe,refreshWizard:X,validateDoneButtonState:se}),(L,B)=>{const ee=N("ion-icon"),ue=N("ion-title"),j=N("ion-toolbar"),re=N("ion-header");return _(),P(be,null,[n(re,null,{default:o(()=>[n(j,{class:"modal-title"},{default:o(()=>[n(ue,null,{default:o(()=>[f("div",Ma,[n(ee,{icon:g(_e).demographics,class:"sub-menu-icon",style:{"font-size":"1.4rem"}},null,8,["icon"]),B[2]||(B[2]=f("b",{style:{"margin-left":"6px"}},"Advance HIV Disease",-1))])]),_:1}),n(ee,{slot:"end",onClick:B[0]||(B[0]=le=>g(ct).dismiss()),style:{"font-size":"30px","padding-right":"10px"},icon:g(Et)},null,8,["icon"])]),_:1})]),_:1}),n(g(it),{class:"ion-padding"},{default:o(()=>[f("div",$a,[a.value?(_(),ne(Un,{key:0,ref:"wizard",headingTitle:"AHD Screening","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:D.value,"custom-tabs":R.value,beforeChange:g(l),onChange:Me,"onComplete:wizard":B[1]||(B[1]=le=>ot()),onDoneButtonChanged:Q},{default:o(()=>[Fe(f("div",null,[n(Aa,{ref:"observationsRef"},null,512)],512),[[Ue,H()=="Presenting Complaints"]]),Fe(f("div",null,[n(la,{ref:"interventionsRef"},null,512)],512),[[Ue,H()=="Past Medical History"]]),Fe(f("div",null,[n(Ra,{ref:"medicationsRef"},null,512)],512),[[Ue,H()=="WHO"]]),Fe(f("div",null,[n(Da,{ref:"medicationsRef"},null,512)],512),[[Ue,H()=="Investigation"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):G("",!0)])]),_:1})],64)}}}),xa=async()=>{const{hasWaitingList:e}=zn(),t=await de.getObsByEncounterIdAndDate(he.PRESENTING_COMPLAINTS),s=await de.getObsByEncounterId(he.HIV_CLINIC_REGISTRATION),l=await de.getObsByEncounterId(he.PAST_MEDICAL_HISTORY),d=await de.getObsByEncounterId(he.HIV_STATUS_AT_ENROLLMENT),r=await de.getObsByEncounterId(he.PATIENT_OUTCOME),y=await ie.getConceptID("Cough"),a=await ie.getConceptID("Yes"),b=await ie.getConceptID("Reactive"),p=await ie.getConceptID("New Positive"),D=await ie.getConceptID("HIV status"),C=await ie.getConceptID("Presenting complaint"),T=de.isValueCodedAvailable(t,[y],C),U=de.isValueCodedAvailable(l,[a],D),S=de.isValueCodedAvailable(d,[b],D),h=de.isValueCodedAvailable(r,[a],p);return e("Waiting for Consultation")&&(T||U||h||S||s.length>0)},Fa={class:"background"},Ua={key:0},Ga={key:1},Wa={key:2},za={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},qa={key:3},Ya={class:"ion-padding",slot:"content"},ja={key:4},Ka=ae({__name:"Investigations",setup(e,{expose:t}){const s=I("Lab Investigations"),l=I(!1);I(!0);const d=I(!1),r=I(!1),y=I(!0),a=I(""),b=I("");I("");const p=I("");I(""),I([]),I(!1);const D=I(!1);I("");const C=I("");I(!1),I(!1);const T=ze(),U=Te(),{investigations:S}=te(T),{patient:h}=te(U),x=Ot(),z=wt(),v=me(()=>S.value[0].data.rowData[0].colData),w=k=>{s.value=k},A=async()=>{let k;W.getPouchDbStatus()&&W.getLanConnectionStatus()?k=await We("test_types"):k=await fe.getTestTypes(),M(S.value,"test","multiSelectData",k)},c=()=>{D.value=!D.value},O=async()=>{var H;if(!((H=h.value)!=null&&H.labOrders))return;p.value=[...h.value.labOrders.saved,...h.value.labOrders.unsaved];const k=await p.value.filter(X=>F.toStandardHisFormat(F.sessionDate())===F.toStandardHisFormat(X.order_date));k.length>0?S.value[0].selectedData=k:S.value[0].selectedData=""},E=async()=>{await O(),T.setInvestigations(S.value)},V=()=>{b.value="",a.value="",l.value=!1,y.value=!1,d.value=!0},J=async()=>Ye(S.value),ye=async()=>await u(v.value[0].value.name,await S.value[0].selectedData)?(M(S.value,"test","alertsErrorMassage","Lab order already selected"),!1):(M(S.value,"test","alertsErrorMassage",""),!0),i=async()=>{Ye(S.value)&&await ye()&&(await m(),S.value[0].data.rowData[0].colData[0].value="",S.value[0].data.rowData[0].colData[1].value="",d.value=!1,r.value=!0,y.value=!0),O()},u=(k,H)=>{for(let X of H)for(let De of X.tests)if(De.name===k)return!0;return!1},m=async()=>{await new Pt().postActivities(h.value.patientID,[{concept_id:v.value[0].value.concept_id,name:v.value[0].value.name,specimen:v.value[1].value.name,reason:"Routine",specimenConcept:await ie.getConceptID(v.value[1].value.name,!0)}]),M(S.value,"specimen","disabled",!0),p.value=[...h.value.labOrders.saved,...h.value.labOrders.unsaved]},$=async k=>{if(k.inputHeader=="Test"&&ye(),M(S.value,"specimen","alertsErrorMassage",""),k.inputHeader=="Test"&&k.value){let H;W.getPouchDbStatus()&&W.getLanConnectionStatus()?H=await We("specimens"):H=await fe.getSpecimens("",1e3),C.value=await ie.getConceptSet(k.value.name,"",{names:H.map(X=>X.name)}),C.value.length==1?(M(S.value,"specimen","value",C.value[0]),M(S.value,"specimen","disabled",!0)):(M(S.value,"specimen","value",""),M(S.value,"specimen","disabled",!1)),M(S.value,"specimen","multiSelectData",C.value)}},Q=async k=>await p.value.filter(H=>H.name.toLowerCase().includes(k.toLowerCase())),se=async k=>{var H;return(H=C.value[0])!=null&&H.name&&k?await C.value.filter(X=>X==null?void 0:X.name.toLowerCase().includes(k.toLowerCase())):[]},Z=k=>{a.value=k.name,v.value[1].inputHeader=="Test"?S.value[0].data.rowData[0].colData[0].value=k.name:S.value[0].data.rowData[0].colData[1].value=k.name,E()},R=()=>{(v.value[1].value||v.value[0].value)&&(y.value=!1,d.value=!0,l.value=!1),S.value[0].selectedData.length>0?(r.value=!0,l.value=!1):d.value||(l.value=!0)},Se=async()=>{await xa()&&z.currentRoute.value.name=="OPDConsultationPlan"&&await mn("Do you want to do AHD screening?")&&await _t(Va,{class:"fullScreenModal"})};return q(S,()=>{R()},{deep:!0}),q(h,async()=>{var k;(k=h.value)!=null&&k.labOrders&&(p.value=[...h.value.labOrders.saved,...h.value.labOrders.unsaved])},{deep:!0}),q(x,async()=>{await A()},{deep:!0}),Ie(async()=>{await A(),E(),R(),O()}),t({openAHDModal:Se,setSegmentContent:w,getTests:A,toggleLabOrderStatus:c,updateInvestigationWizard:O,updateInvestigationsStores:E,displayInputFields:V,validateRowData:J,checkTest:ye,addNewRow:i,isNameInData:u,saveTest:m,handleInputData:$,filterTest:Q,filterSpecimen:se,setTest:Z,setDashedBox:R}),(k,H)=>{const X=N("ion-label"),De=N("ion-segment-button"),oe=N("ion-segment"),Ae=N("VisitsHistory");return _(),P("div",Fa,[n(oe,{value:s.value,style:{"margin-top":"5px"}},{default:o(()=>[n(De,{value:"Lab Investigations",onClick:H[0]||(H[0]=Me=>w("Lab Investigations"))},{default:o(()=>[n(X,null,{default:o(()=>[...H[3]||(H[3]=[K("Lab Investigations",-1)])]),_:1})]),_:1}),n(De,{value:"Radiology Investigation",onClick:H[1]||(H[1]=Me=>w("Radiology Investigation"))},{default:o(()=>[n(X,null,{default:o(()=>[...H[4]||(H[4]=[K("Radiology Investigation",-1)])]),_:1})]),_:1}),n(De,{value:"Other Investigation",onClick:H[2]||(H[2]=Me=>w("Other Investigation"))},{default:o(()=>[n(X,null,{default:o(()=>[...H[5]||(H[5]=[K("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),s.value=="Radiology Investigation"?(_(),P("div",Ua,[n(Ae)])):G("",!0),s.value=="Other Investigation"?(_(),P("div",Ga)):G("",!0),s.value=="Lab Investigations"?(_(),P("div",Wa,[f("div",za,[f("span",null,[n(Lt,{propOrders:p.value},null,8,["propOrders"])])])])):G("",!0),s.value=="Radiology Investigation"?(_(),P("div",qa,[f("div",Ya,[n(kt)])])):G("",!0),s.value=="Other Investigation"?(_(),P("div",ja)):G("",!0)])}}}),Bs=ge(Ka,[["__scopeId","data-v-aa4a486f"]]),Qa=ae({created(){},components:{IonItem:Ce,IonCol:ve,IonLabel:Re,IonIcon:at},data(){return{iconsContent:_e,localMedicalDrugsList:[...this.$props._selectedMedicalDrugsList]}},props:{_selectedMedicalDrugsList:{type:Array,default:[]},show_actions_buttons:{type:Boolean,default:!0},highLightBackground:{type:String,default:"item-native"}},watch:{},methods:{highlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#006401"),this.highlightActionBtns(e)},undoHighlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#636363"),this.undohighlightActionBtns(e)},highlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let s=0;s<t.length;s++)t[s].style.display="inline-block"},undohighlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let s=0;s<t.length;s++)t[s].style.display="none"},asignLblID(e){return e+"_lbl"},asignSpanLblID(e){return e+"_spanlbl"},async removeItemAtIndex(e,t){await gn("Do you want to delete it?",t)&&this.$emit("remove-item",e)},editItemAtIndex(e){this.$emit("edit-item",e)},highLightBnd(e){if(e){if(e.highlightbackground!==void 0&&e.highlightbackground==!0)return this.$props.highLightBackground}else return!1}}}),Xa=["onMousemove","onMouseout"],Ja={class:"route-label"};function Za(e,t,s,l,d,r){const y=N("ion-label"),a=N("ion-col"),b=N("ion-row"),p=N("ion-icon");return _(!0),P(be,null,Be(e.localMedicalDrugsList,(D,C)=>(_(),P("div",{id:"df",class:"medication-item",key:C,onMousemove:T=>e.highlightItem(C),onMouseout:T=>e.undoHighlightItem(C)},[n(b,{class:"medication-header"},{default:o(()=>[n(a,{class:Oe(["ion-text-wrap",e.highLightBnd(D)])},{default:o(()=>[n(y,{id:e.asignLblID(C),class:"medication-name"},{default:o(()=>[K(Y(D.drugName),1)]),_:2},1032,["id"])]),_:2},1032,["class"])]),_:2},1024),n(b,{class:"medication-details"},{default:o(()=>[n(a,{size:"10",class:Oe(["ion-text-wrap details-col",e.highLightBnd(D)])},{default:o(()=>[n(y,{class:"details-text"},{default:o(()=>[K(Y(D.dose)+" / "+Y(D.frequency)+" / daily / "+Y(D.duration)+" / until "+Y(D.prescription)+" ",1),f("span",Ja,Y(D.route_name),1)]),_:2},1024)]),_:2},1032,["class"]),e.show_actions_buttons?(_(),ne(a,{key:0,class:Oe([e.highLightBnd(D),"actions-col"]),size:"2"},{default:o(()=>[n(y,{class:Oe(["action-button",e.asignSpanLblID(C)]),onClick:T=>e.editItemAtIndex(C)},{default:o(()=>[n(p,{icon:e.iconsContent.edit},null,8,["icon"])]),_:1},8,["class","onClick"]),n(y,{class:Oe(["action-button",e.asignSpanLblID(C)]),onClick:T=>e.removeItemAtIndex(C,T)},{default:o(()=>[n(p,{icon:e.iconsContent.delete},null,8,["icon"])]),_:1},8,["class","onClick"])]),_:2},1032,["class"])):G("",!0)]),_:2},1024)],40,Xa))),128)}const Rs=ge(Qa,[["render",Za],["__scopeId","data-v-01c693a3"]]),es={key:0,class:"custom-allergy-container"},ts={class:"button-group"},ns=ae({watch:{},name:"AllergiesComponent"}),as=ae({...ns,setup(e){const t=vn(),s=Te(),l=me(()=>t.selectedMedicalAllergiesList),d=me(()=>s.patient),r=me(()=>t.medicalAllergiesList),y=I(h(8,"item-")),a=I(""),b=I(!1),p=[{multi_Selection:!0,show_list_label:!0,unqueId:y.value,name_of_list:"Add/Remove allergies",placeHolder:"Search for an allergy",items:[],listUpdatedFN:T,listFilteredFN:()=>{},searchTextFN:U,use_internal_filter:!0,show_error:I(!1),error_message:"please select a User",disabled:I(!1)}],D=I(!1);Ie(async()=>{C()});const C=()=>{t.current_patient.ID!=d.value.ID&&(t.clearSelectedMedicalAllergiesList(),t.setCurrentPatient(d.value))};function T(v){v.forEach(w=>{w.selected==!0&&w.name==="Other"&&(b.value=w.name==="Other"),w.selected==!1&&w.name==="Other"&&z()}),t.setSelectedMedicalAllergiesList(v),S()}async function U(v){const w=v,A=await ie.getConceptSet("OPD Medication",w);if(!A)return;A.map(V=>({label:V.name,value:V.name,other:V}));const c=fn(w),E=hn(c,A).sort((V,J)=>V.name.localeCompare(J.name));t.setMedicalAllergiesList(E),S()}function S(){const v=r.value;l.value.forEach(A=>{let c=!1;v.forEach((O,E)=>{O.concept_id==A.concept_id&&A.selected===!0&&(v[E]=A,c=!0)}),!c&&A.selected===!0&&v.push(A)});const w=v.filter((A,c,O)=>c===O.findIndex(E=>(E==null?void 0:E.concept_id)===(A==null?void 0:A.concept_id)));t.setMedicalAllergiesList(w)}function h(v=8,w=""){const A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let c=w;for(let O=0;O<v;O++)c+=A.charAt(Math.floor(Math.random()*A.length));return c+="-".concat(Date.now()),c}async function x(v){try{const w=v.trim();if(w){const A={name:w,selected:!0,concept_id:h(8,"12"),concept_name_id:h(8,"34")};t.setMedicalAllergiesList([...r.value,A]),t.setSelectedMedicalAllergiesList(A),b.value=!1,D.value=!0,a.value="";const c=t.findSelectedAllergyByName("Other");t.unselectOther(c)}}catch(w){console.error(w)}}const z=()=>{b.value=!1,a.value="",D.value=!1;const v=t.findSelectedAllergyByName("Other");v&&t.unselectOther(v)};return(v,w)=>(_(),ne(g(At),null,{default:o(()=>[n(g(Tn),null,{default:o(()=>[n(g(Re),{class:"header-container"},{default:o(()=>[n(g(at),{icon:g(Pn),class:"allergy-icon"},null,8,["icon"]),w[3]||(w[3]=f("span",{style:{"font-size":"16px","font-weight":"600"}}," Allergies (Medication, Healthcare items, Environment and Food) ",-1))]),_:1})]),_:1}),n(g(St),null,{default:o(()=>[n(_n,{multiSelection:p[0].multi_Selection,show_label:p[0].show_list_label,uniqueId:p[0].unqueId,name_of_list:p[0].name_of_list,choose_place_holder:p[0].placeHolder,"items_-list":r.value,use_internal_filter:p[0].use_internal_filter,disabled:p[0].disabled.value,onItemListUpDated:p[0].listUpdatedFN,onItemListFiltered:p[0].listFilteredFN,onItemSearchText:p[0].searchTextFN},null,8,["multiSelection","show_label","uniqueId","name_of_list","choose_place_holder","items_-list","use_internal_filter","disabled","onItemListUpDated","onItemListFiltered","onItemSearchText"]),b.value?(_(),P("div",es,[n(g(qe),{modelValue:a.value,"onUpdate:modelValue":w[0]||(w[0]=A=>a.value=A),placeholder:"Please specify the allergy",fill:"outline",class:"custom-input"},null,8,["modelValue"]),f("div",ts,[n(g(pt),{onClick:w[1]||(w[1]=A=>x(a.value)),class:"addCustomAllergyBtn"},{default:o(()=>[...w[4]||(w[4]=[K(" Add Allergy ",-1)])]),_:1}),n(g(pt),{onClick:w[2]||(w[2]=A=>z()),fill:"clear",class:"cancelBtn"},{default:o(()=>[n(g(at),{icon:g(Et),slot:"icon-only"},null,8,["icon"])]),_:1})])])):G("",!0)]),_:1})]),_:1}))}}),Ms=ge(as,[["__scopeId","data-v-3314535a"]]),ss={class:"checklist-container"},is=ae({watch:{},name:"xxxComponent"}),os=ae({...is,setup(e){const t=Te(),s=me(()=>t.patient),l=Gn(),d=l.items;Ie(async()=>{r()});const r=()=>{l.current_patient.ID!=s.value.ID&&(l.clearSelectednonPharmaTherapyStore(),l.setCurrentPatient(s.value))};return q(()=>s.value,async y=>{}),(y,a)=>(_(),P("div",ss,[(_(!0),P(be,null,Be(g(d),b=>(_(),ne(g(Ce),{key:b.id,class:"no-border"},{default:o(()=>[n(g(Ct),{id:b.id,modelValue:b.checked,"onUpdate:modelValue":p=>b.checked=p,slot:"start"},null,8,["id","modelValue","onUpdate:modelValue"]),n(g(Re),{style:{"font-size":"16px","font-weight":"600"}},{default:o(()=>[K(Y(b.label),1)]),_:2},1024)]),_:2},1024))),128))]))}}),$s=ge(os,[["__scopeId","data-v-371e920f"]]),rs=ae({components:{IonContent:it,IonHeader:It,IonItem:Ce,IonList:st,IonMenu:bt,IonTitle:Dt,IonToolbar:yt,BasicInputField:vt,IonDatetime:Hn,IonBadge:kn,DateInputField:Yn,DynamicButton:Ge},props:{showPeripheral:{type:Boolean,default:!0}},setup(e){const t=Ze(),s=I(0),l=me(()=>t.getDisabledDates()),d=me(()=>t.getAssignedAppointments()),r=I(),y=me(()=>e.showPeripheral);return{disabledDates:l,datesCounts:d,appointment_count:s,calendarOutline:Nn,inputPRDate:r,show_peripheral:y}},data(){return ce(),dt(),{iconsContent:_e,date:new Date(W.getSessionDate()),tomorrow:new Date(W.getSessionDate()).getDate()+1,appointment:"",drugRunoutDate:"",nextAppointmentDate:"",minDate:new Date(W.getSessionDate())}},computed:{...Ee(ce,["nextAppointment","appointmentCountsCache","currentSelectedNextAppointmentDate"]),...Ee(Ze,["maximumNumberOfDaysForEachDay","assignedAppointmentsDates"]),...Ee(Te,["patient"]),...Ee(dt,["activeProgram"]),calendarDate(){const e=ce();return e.currentSelectedNextAppointmentDate?F.toStandardHisDisplayFormat(e.currentSelectedNextAppointmentDate):""},runOutDate(){var t;const e=ce();return((t=this.activeProgram)==null?void 0:t.program_id)===14?mt():e.getAppointmentMedicationRunOutDate()}},watch:{calendarDate:{handler(){this.updateNextAppointment()},deep:!0},"$service.sessionDate":{handler(){this.updateMinDate()},immediate:!0},"patient.ID":{async handler(e,t){e!==t&&(this.cleanCurrentNextAppointmentDate(),this.checkIfSamePatientInContext(),this.clearNextAppointment())}}},async mounted(){this.checkIfSamePatientInContext(),await this.getAppointmentMents(this.runOutDate.date),await bn().loadGlobalProperty(),this.validateAppointmentCountsCache(),await this.preloadAppointmentCounts(),In();const e=W.getUserID(),t=new ft;this.appointment=new xe(t.getID(),e),this.nextAppointmentDate=this.appointment.date,this.supposedRunOutDate(),window.addEventListener("storage",this.handleStorageChange),mt()},beforeUnmount(){window.removeEventListener("storage",this.handleStorageChange)},methods:{handleStorageChange(e){e.key==="sessionDate"&&this.updateMinDate()},updateMinDate(){this.date=new Date(W.getSessionDate()),this.minDate=new Date(W.getSessionDate())},updateNextAppointment(){ce().setNextAppointment(this.calendarDate)},async handleDateUpdate(e){e&&(Ze().setAssignedAppointmentsDates(e,!0),this.calendarDate=F.toStandardHisDisplayFormat(e),await this.save(),await this.getAppointmentMents(e),await this.updateAppointmentCache(e),ce().setCurrentSelectedNextAppointmentDate(e,this.patient.ID))},async getAppointmentMents(e){if(ht().apiStatus)try{const s=await xe.getDailyAppointments(F.toStandardHisFormat(e),F.toStandardHisFormat(e));this.appointment_count=s.length}catch(s){}},getCounter(e){const t=F.toStandardHisFormat(e);return this.appointmentCountsCache[t]||""},async save(){if(this.assignedAppointmentsDates.length>0)try{const t=await new qn().createOfflineAppointment()}catch(e){}},async openCornfirmModal(e){this.calendarDate=F.toStandardHisDisplayFormat(e),await this.getAppointmentMents(e),_t(Dn,{class:"otherVitalsModal"},!0,{message:"Are you sure you want to add this Appointment?"},{cancel:d=>{},confirm:async d=>{d.detail==!0&&await this.handleDateUpdate(e)}})},async handleInput(e){this.inputPRDate=F.toStandardHisDisplayFormat(e),await this.openCornfirmModal(e)},async supposedRunOutDate(){await yn.getLastDrugsReceived(this.patient.patientID)},async preloadAppointmentCounts(){try{const e=new Date(W.getSessionDate());e.setDate(1);const t=new Date(W.getSessionDate());t.setMonth(t.getMonth()+2),t.setDate(0);try{const s=await xe.getDailyAppointments(F.toStandardHisFormat(e),F.toStandardHisFormat(t));if(!s)return;const l=this.filterUniqueAppointments(s),d={};l.forEach(r=>{const y=new Date(r.appointment_date),a=F.toStandardHisFormat(y);d[a]||(d[a]=0),d[a]++}),Object.keys(d).forEach(r=>{this.appointmentCountsCache[r]=d[r]})}catch(s){console.error("Error fetching appointments for date range:",s)}}catch(e){console.error("Error in preload process:",e)}},filterUniqueAppointments(e){const t=new Map;return e.forEach(s=>{const l="".concat(s.given_name,"_").concat(s.family_name,"_").concat(s.birthdate,"_").concat(s.appointment_date);t.has(l)||t.set(l,s)}),Array.from(t.values())},async updateAppointmentCache(e){try{const t=F.toStandardHisFormat(e),s=await xe.getDailyAppointments(F.toStandardHisFormat(e),F.toStandardHisFormat(e));if(!s)return;this.appointmentCountsCache[t]=s.length}catch(t){console.error("Error updating appointment cache:",t)}},validateAppointmentCountsCache(){ce().checkCurrentLocationIfInContext()},isRunOutDate(e){return!this.runOutDate||!this.runOutDate.date?!1:F.toStandardHisFormat(e)===F.toStandardHisFormat(this.runOutDate.date)},cleanCurrentNextAppointmentDate(){ce().cleanCurrentSelectedNextAppointmentDate()},checkIfSamePatientInContext(){const e=ce();e.current_patient.ID!=this.patient.ID&&(this.cleanCurrentNextAppointmentDate(),e.setCurrentPatient(this.patient))},clearNextAppointment(){ce().clearAppointmentMedicationRunOutDate()}}}),ls={class:"card_content"},ds={class:"count-badge"},us={class:"dates_title"},cs={class:"sub_data"},ps={class:"dates_title"},ms={class:"sub_data"},gs={class:"dates_title"},vs={class:"sub_data"},fs={class:"dates_title"},hs={class:"sub_data"};function _s(e,t,s,l,d,r){const y=N("VueDatePicker"),a=N("ion-col"),b=N("DynamicButton"),p=N("ion-item"),D=N("ion-row"),C=N("DateInputField");return _(),P("div",ls,[n(D,null,{default:o(()=>[n(a,{"size-sm":"12","size-md":"12","size-lg":"12","size-xl":"8"},{default:o(()=>[n(y,{class:"calender",onDateUpdate:e.openCornfirmModal,inline:"","auto-apply":"","enable-time-picker":!1,"disabled-dates":e.disabledDates,"min-date":e.minDate,modelValue:e.runOutDate.date,"onUpdate:modelValue":t[0]||(t[0]=T=>e.runOutDate.date=T)},{day:o(({day:T,date:U})=>[(_(),P("p",{key:0,class:Oe({"run-out-date":e.isRunOutDate(U)}),style:{"font-weight":"600","font-size":"20px"}},[f("span",null,[K(Y(T),1),f("sup",ds,Y(e.getCounter(U)),1)])],2))]),_:1},8,["onDateUpdate","disabled-dates","min-date","modelValue"])]),_:1}),e.show_peripheral?(_(),ne(a,{key:0},{default:o(()=>[n(p,null,{default:o(()=>[f("div",us,[t[3]||(t[3]=f("div",null,[K("Suggested Next Appointment Date "),f("span",{style:{"font-size":"16px"}},"(Medication run out date)")],-1)),f("div",cs,[K(Y(e.runOutDate.formattedDate||"No run out date available")+" ",1),e.runOutDate.formattedDate?(_(),ne(b,{key:0,onClick:t[1]||(t[1]=T=>e.handleDateUpdate(e.runOutDate.date)),name:"Set Next Appt.",fill:"solid",iconSlot:"icon-only",style:{float:"right"}})):G("",!0)])])]),_:1}),n(p,null,{default:o(()=>[f("div",ps,[t[4]||(t[4]=f("div",null,"User set appointment date",-1)),f("div",ms,Y(e.calendarDate),1)])]),_:1}),n(p,null,{default:o(()=>[f("div",gs,[t[5]||(t[5]=f("div",null,"Appointments",-1)),f("div",vs,Y(e.appointment_count),1)])]),_:1}),n(p,null,{default:o(()=>[f("div",fs,[t[6]||(t[6]=f("div",null,"Appointment limit (per/day)",-1)),f("div",hs,Y(e.appointment_count)+"/"+Y(e.maximumNumberOfDaysForEachDay),1)])]),_:1})]),_:1})):G("",!0)]),_:1}),e.show_peripheral?(_(),ne(D,{key:0},{default:o(()=>[n(a,{size:"4"},{default:o(()=>[n(C,{inputHeader:"Preferred Next Appointment Date",bold:"600",fontSize:"17px",placeholderFontSize:"17px",placeholderFontWeight:"600",unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.inputPRDate,eventType:"",minDate:e.minDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t[2]||(t[2]=T=>e.handleInput(T))},null,8,["icon","inputValue","minDate"])]),_:1})]),_:1})):G("",!0)])}const Vs=ge(rs,[["render",_s],["__scopeId","data-v-4e58e0bc"]]);export{Ms as A,Rs as D,Bs as I,Pt as L,Vs as N,Va as _,$s as a,da as b,xa as i};

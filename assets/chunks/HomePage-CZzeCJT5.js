var Ve=Object.defineProperty;var Le=(t,e,s)=>e in t?Ve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var et=(t,e,s)=>Le(t,typeof e!="symbol"?e+"":e,s);import{d as x,cV as Me,an as Rt,r as L,c as q,w as ht,a as dt,e as f,f as l,k as n,m as S,p as nt,K as g,l as a,u as k,b1 as de,Q as A,L as j,F as E,P as G,cW as Be,c8 as Fe,aw as ce,bx as Ee,bi as xe,b_ as Jt,c6 as He,b5 as Dt,H as u,O as R,J as o,D as ue,ah as Z,cX as pe,cY as me,ap as he,cZ as ge,c_ as Ue,cd as fe,c$ as We,d0 as ze,d1 as je,d2 as Ge,d3 as Je,d4 as qe,d5 as Ke,aS as Qe,bL as _e,am as Ye,n as ve,aT as qt,aP as be,aQ as ye,bp as Vt,a5 as Lt,N as Tt,a4 as Mt,G as ct,a6 as Ct,I as it,a3 as st,bz as Wt,a1 as Xe,d6 as Ze,aF as tn,d7 as en,d8 as nn,cB as an,aE as sn,cH as De,aN as gt,aU as zt,V as Nt,d9 as Ce,aJ as Kt,aD as on,i as rn,b7 as ln,da as dn,z as cn,db as Qt,dc as lt,W as vt,dd as $e,b8 as un,bn as pn,bk as mn,E as $t,ai as wt,aj as ut,_ as pt,R as Bt,be as hn,de as gn,df as fn,dg as _n,dh as vn,bv as Ft,b4 as we,di as bn,c2 as yn,dj as Dn,dk as Cn,cG as ke,bq as $n,bT as wn}from"./vendor-BpjEhVym.js";import{S as z,u as at,_ as U,P as ft,t as yt,a as Se,E as kn,H as I,A as Sn,b as In,c as Ie,d as Zt,e as Ae,f as An,g as kt,R as Pn,p as Tn,h as te,i as Nn,O as On,j as Rn,B as Vn,k as ee,l as Et,m as Pt,n as Ln,o as Ot,q as jt,r as Mn,s as ne,T as Pe,v as Bn,w as X,x as ae,y as se,z as Fn,C as oe,U as En,L as xn}from"../index-CgDetJyr.js";import{m as Yt}from"./apexcharts-DMAoEdNS.js";import{A as Te}from"./ncd_appointment_service-_zm1PKn5.js";import{D as Xt}from"./DateInputField-k7wJqEUJ.js";import{u as Hn,M as Un,_ as Wn}from"./ActionButtons.vue_vue_type_script_setup_true_lang-BknOE1MU.js";import{V as zn}from"./ViewToggleComponent-C7OWa2-S.js";import{B as jn}from"./bottomNavBar-CGndl63d.js";import{P as Gn}from"./patient_report_service-CotPtoGh.js";import{l as bt}from"./lodash-NJiRuGo9.js";import{B as St}from"./BasicForm-DI8tVd_D.js";import{B as xt}from"./BasicCard-BwNJdUfU.js";import{u as Jn}from"./AdministerOtherVaccinesStore-Da2Q0NkI.js";import{c as qn}from"./customDatePicker-BgQIj83L.js";import{s as Kn}from"./vaccines_service-DMCAdHAH.js";import{g as Qn}from"./dashboard_service-CkqBjU36.js";import{i as Yn}from"./Img-CJEgX1Vr.js";import{u as Ne}from"./useUserActivities-hYvlzv7w.js";import ie from"./NeonatalHome-DOdKQdAJ.js";import"./sms_service-CH2KGPjb.js";import"./EIRreportsStore-C3K2RALB.js";import"./Export-I0F0jKIY.js";import"./neonatal_service-DTjy3VXY.js";import"./images-DJIykHYW.js";const ot={VITALS:6,APPOINTMENT:7,HIV_CLINIC_REGISTRATION:9,TREATMENT:25,HIV_RECEPTION:51,HIV_STAGING:52,HIV_CLINIC_CONSULTATION:53,DISPENSING:54,ART_ADHERENCE:68};class re extends z{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(e){return await super.getJson("fhir/patient/".concat(e),{id:e})}static async getFhirObservations(e){return await super.getJson("fhir/patient/".concat(e,"/observations/"),{id:e})}}const Xn={class:"fhir-viewer"},Zn={class:"container"},ta={key:0,class:"main-header"},ea={class:"header-line"},na={key:0,class:"last-updated-display"},aa={key:1,class:"card initial-input-card"},sa={class:"action-area-initial"},oa={key:0,class:"card patient-card"},ia={class:"card-title"},ra={class:"patient-info-grid"},la={class:"info-item"},da={class:"info-value"},ca={class:"info-item"},ua={class:"info-value"},pa={class:"info-item"},ma={class:"info-value"},ha={class:"info-item"},ga={class:"info-value"},fa={class:"info-value"},_a={class:"info-value"},va={class:"info-label"},ba={class:"info-value"},ya={key:2,class:"card observations-card"},Da={class:"card-title"},Ca={class:"observations-grid"},$a={class:"obs-header"},wa={class:"obs-title"},ka={class:"obs-details"},Sa={class:"obs-detail obs-value-highlight"},Ia={class:"obs-value"},Aa={class:"obs-detail"},Pa={class:"obs-value"},Ta={key:0,class:"obs-detail"},Na={class:"obs-value"},Oa={key:3,class:"no-data-found"},Ra={key:4,class:"no-data-found"},Va={key:5,class:"main-footer"},La=x({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(t){Me({"person-circle-outline":He,"clipboard-outline":Jt,"search-outline":xe,"information-circle-outline":Ee,"alert-circle-outline":ce,"person-add-outline":Fe,"arrow-back-outline":Be});const e=t,s=Rt(),i=L(!1),d=L([]),_=L(),r=L(),c=L(null),p=L([]),h=q(()=>d.value.some($=>$.resourceType==="Bundle"&&$.entry&&$.entry.some(m=>m.resource&&m.resource.resourceType==="Patient"))),v=q(()=>p.value.length>0),w=async()=>{if(d.value=[],r.value=null,c.value=null,p.value=[],!_.value){console.error("Please enter a Patient Identifier.");return}i.value=!0;try{const $=await re.getFhirPatient(_.value);if($&&$.entry&&$.entry.length>0){const m=$.entry[0].resource,W=m.id,H=await re.getFhirObservations(W);d.value=[$],H&&(d.value.push(H),p.value=H.entry.filter(K=>K.resource&&K.resource.resourceType==="Observation").map(K=>{const O=K.resource;return{id:O.id,display:M(O),value:Q(O),date:O.effectiveDateTime,category:O.category&&O.category[0]&&O.category[0].coding&&O.category[0].coding[0]?O.category[0].coding[0].display||O.category[0].coding[0].code:"N/A"}}));const B=m.name&&m.name[0];c.value={personInformation:{given_name:B&&B.given?B.given.join(" "):"",middle_name:B&&B.middle?B.middle.join(" "):"",family_name:B&&B.family?B.family:"",gender:m.gender=="male"?"M":(m==null?void 0:m.gender)=="female"?"F":"",birthdate:m.birthDate||"",cell_phone_number:m.telecom&&m.telecom[0]?m.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:m.contact&&m.contact[0]&&m.contact[0].telecom?m.contact[0].telecom[0].value:""}]}};const T=[$,H].filter(Boolean).reduce((K,O)=>{if(O.meta&&O.meta.lastUpdated){const tt=new Date(O.meta.lastUpdated);return K===null||tt>K?tt:K}return K},null);T&&(r.value=P(T.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch($){console.error("Error loading FHIR data:",$),d.value=[],r.value=null,c.value=null,p.value=[]}finally{i.value=!1}},C=$=>{if($.name&&$.name[0]){const m=$.name[0],W=m.given?m.given.join(" "):"",H=m.family||"";return"".concat(W," ").concat(H).trim()||"N/A"}return"N/A"},y=$=>$.identifier&&$.identifier.length>0?$.identifier.map(m=>{let W="Unknown System";if(m.type&&m.type.coding&&m.type.coding[0]&&m.type.coding[0].display)W=m.type.coding[0].display;else if(m.system){const B=m.system.split("/");W=B[B.length-1]||m.system,m.system==="urn:oid:2.16.840.1.113883.4.6"&&(W="Social Security Number")}sessionStorage.setItem(W,m.value);let H=null;return m.assigner&&m.assigner.display?H=m.assigner.display:m.assigner&&m.assigner.reference&&(H=m.assigner.reference.split("/").pop()||m.assigner.reference),{value:m.value||"N/A",systemDisplay:W,periodStart:m.period?m.period.start:null,periodEnd:m.period?m.period.end:null,assignerDisplay:H}}):[],b=$=>$.telecom&&$.telecom.length>0?$.telecom.filter(m=>m.system==="phone"&&m.value):[],D=$=>{if($.contact&&$.contact.length>0){const m=$.contact.filter(H=>{var B;return(B=H.relationship)==null?void 0:B.some(F=>{var T;return(T=F.coding)==null?void 0:T.some(K=>K.code==="GUARD")})}),W=[];return m.forEach(H=>{H.telecom&&H.telecom.length>0&&H.telecom.filter(B=>B.system==="phone"&&B.value).forEach(B=>W.push(B))}),W}return[]},N=$=>{if(!$)return"N/A";try{return new Date($).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(m){return console.error("Invalid date string for formatDate:",$,m),"Invalid Date"}},P=$=>{if(!$)return"N/A";try{return new Date($).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(m){return console.error("Invalid date time string for formatDateTime:",$,m),"Invalid Date/Time"}},V=$=>{if(!$)return"N/A";try{const m=new Date,W=new Date($);let H=m.getFullYear()-W.getFullYear();const B=m.getMonth()-W.getMonth();return(B<0||B===0&&m.getDate()<W.getDate())&&H--,H}catch(m){return console.error("Invalid birth date string for calculateAge:",$,m),"N/A"}},J=$=>{if($.meta&&$.meta.tag){const m=$.meta.tag.find(W=>W.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return m?m.code:"Unknown"}return"Unknown"},M=$=>$.code&&$.code.coding&&$.code.coding[0]&&($.code.coding[0].display||$.code.coding[0].code)||"Unknown Observation",Q=$=>$.valueQuantity?"".concat($.valueQuantity.value," ").concat($.valueQuantity.unit||"").trim():$.valueString?$.valueString:$.valueBoolean!==void 0?$.valueBoolean?"True":"False":"N/A",Y=()=>{at().setRecord(c.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(p.value)),At("/registration/manual")},mt=()=>{d.value=[],_.value="",r.value=null,c.value=null,p.value=[]},At=$=>{s.push({path:$})};return ht(()=>s,async()=>{d.value=[],p.value=[]},{deep:!0}),dt(()=>{var $;if(e.initialData.length>0){d.value=e.initialData;const W=e.initialData.filter(Boolean).reduce((F,T)=>{if(T.meta&&T.meta.lastUpdated){const K=new Date(T.meta.lastUpdated);return F===null||K>F?K:F}return F},null);W&&(r.value=P(W.toISOString()));const H=e.initialData.find(F=>F.resourceType==="Bundle"&&F.entry&&F.entry.some(T=>T.resource&&T.resource.resourceType==="Patient"));if(H){const F=($=H.entry.find(T=>T.resource&&T.resource.resourceType==="Patient"))==null?void 0:$.resource;if(F){const T=F.name&&F.name[0];c.value={personInformation:{given_name:T&&T.given?T.given.join(" "):"",middle_name:T&&T.middle?T.middle.join(" "):"",family_name:T&&T.family?T.family:"",gender:F.gender||"",birthdate:F.birthDate||""}}}}const B=e.initialData.find(F=>F.resourceType==="Bundle"&&F.entry&&F.entry.some(T=>T.resource&&T.resource.resourceType==="Observation"));B&&(p.value=B.entry.filter(F=>F.resource&&F.resource.resourceType==="Observation").map(F=>{const T=F.resource;return{id:T.id,display:M(T),value:Q(T),date:T.effectiveDateTime,category:T.category&&T.category[0]&&T.category[0].coding&&T.category[0].coding[0]?T.category[0].coding[0].display||T.category[0].coding[0].code:"N/A"}}))}}),($,m)=>{var W,H,B,F,T,K;return l(),f("div",Xn,[n("div",Zn,[(W=d.value)!=null&&W.length?(l(),f("header",ta,[n("div",ea,[m[1]||(m[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:nt(["last-updated-display","status-"+J(d.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+g(J(d.value[0].entry[0].resource)),3),r.value?(l(),f("span",na,"Last Updated: "+g(r.value),1)):S("",!0)])])])):S("",!0),(H=d.value)!=null&&H.length?S("",!0):(l(),f("section",aa,[a(k(de),{modelValue:_.value,"onUpdate:modelValue":m[0]||(m[0]=O=>_.value=O),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",sa,[n("button",{onClick:w,class:"load-data-btn"},[a(k(j),{name:"search-outline"}),m[2]||(m[2]=A(" Find Patient ",-1))])])])),(l(!0),f(E,null,G(d.value,O=>(l(),f("div",{key:O.id},[O.resourceType==="Bundle"&&O.entry&&O.entry[0]&&O.entry[0].resource.resourceType==="Patient"?(l(),f("section",oa,[n("h2",ia,[a(k(j),{name:"person-circle-outline"}),m[3]||(m[3]=A(" Patient Demographics",-1))]),n("div",ra,[n("div",la,[m[4]||(m[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",da,g(C(O.entry[0].resource)),1)]),n("div",ca,[m[5]||(m[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",ua,g(O.entry[0].resource.gender||"Not specified"),1)]),n("div",pa,[m[6]||(m[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",ma,g(N(O.entry[0].resource.birthDate)),1)]),n("div",ha,[m[7]||(m[7]=n("span",{class:"info-label"},"Age",-1)),n("span",ga,g(V(O.entry[0].resource.birthDate))+" years",1)]),b(O.entry[0].resource).length?(l(!0),f(E,{key:0},G(b(O.entry[0].resource),(tt,_t)=>(l(),f("div",{key:"patient-phone-".concat(_t),class:"info-item"},[m[8]||(m[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",fa,g(tt.value),1)]))),128)):S("",!0),D(O.entry[0].resource).length?(l(!0),f(E,{key:1},G(D(O.entry[0].resource),(tt,_t)=>(l(),f("div",{key:"guardian-phone-".concat(_t),class:"info-item"},[m[9]||(m[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",_a,g(tt.value),1)]))),128)):S("",!0),(l(!0),f(E,null,G(y(O.entry[0].resource),(tt,_t)=>(l(),f("div",{key:tt.value||_t,class:"info-item"},[n("span",va,g(tt.systemDisplay),1),n("span",ba,g(tt.value),1)]))),128))])])):S("",!0)]))),128)),((B=p.value)==null?void 0:B.length)>0?(l(),f("section",ya,[n("h2",Da,[a(k(j),{name:"clipboard-outline"}),m[10]||(m[10]=A(" Clinical Observations",-1))]),n("div",Ca,[(l(!0),f(E,null,G(p.value,O=>(l(),f("div",{key:O.id,class:"observation-item"},[n("div",$a,[n("h3",wa,g(O.display),1)]),n("div",ka,[n("div",Sa,[m[11]||(m[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",Ia,g(O.value),1)]),n("div",Aa,[m[12]||(m[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",Pa,g(P(O.date)),1)]),O.category&&O.category!=="N/A"?(l(),f("div",Ta,[m[13]||(m[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",Na,g(O.category),1)])):S("",!0)])]))),128))])])):S("",!0),(F=d.value)!=null&&F.length&&!h.value?(l(),f("div",Oa,[n("p",null,[a(k(j),{name:"alert-circle-outline"}),m[14]||(m[14]=A(" No patient data found for the provided identifier. Please try again.",-1))])])):(T=d.value)!=null&&T.length&&h.value&&!v.value?(l(),f("div",Ra,[n("p",null,[a(k(j),{name:"information-circle-outline"}),m[15]||(m[15]=A(" No clinical observations found for this patient.",-1))])])):S("",!0),(K=d.value)!=null&&K.length?(l(),f("footer",Va,[n("button",{onClick:mt,class:"back-to-search-btn small-btn"},[a(k(j),{name:"arrow-back-outline"}),m[16]||(m[16]=A(" Back to Search ",-1))]),n("button",{onClick:Y,class:"register-btn small-btn"},[a(k(j),{name:"person-add-outline"}),m[17]||(m[17]=A(" Register New Patient ",-1))])])):S("",!0)])])}}}),Ma=U(La,[["__scopeId","data-v-0dc329ef"]]),Ba=x({components:{DataTable:Dt},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Referred From",data:"referredFrom"},{title:"Referred By",data:"referredBy"},{title:"Clinic Date",data:"appointmentDate"},{title:"Actions",data:null,render:(t,e,s)=>'<ion-button size="small" fill="solid" color="primary" onclick="window.navigatePatient(\''.concat(s.patient_id,"')\">Profile</ion-button>"),orderable:!1,width:"20%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No referrals found."}}}},async mounted(){var d;const e=(d=Se().activeProgram)==null?void 0:d.program_id,s=String(localStorage.getItem("locationID")),i=await kn.getAllEncounters({encounter_type_id:114});console.log("Encounters fetched for Internal Referrals:",i),this.patients=i.reduce((_,r)=>{var C,y,b,D,N,P,V,J;if(String(r==null?void 0:r.location_id)!==s||!((C=r==null?void 0:r.observations)==null?void 0:C.find(M=>(M==null?void 0:M.concept_id)===2227&&(M==null?void 0:M.value_numeric)===e)))return _;const p=(D=(b=(y=r==null?void 0:r.patient)==null?void 0:y.person)==null?void 0:b.names)!=null&&D[0]?"".concat(r.patient.person.names[0].given_name||""," ").concat(r.patient.person.names[0].family_name||""):"Unknown";let h=((N=r==null?void 0:r.program)==null?void 0:N.name)||"Unknown Program";h=h.replace(/program/i,"").trim();const v=(V=(P=r==null?void 0:r.provider)==null?void 0:P.names)!=null&&V[0]?"".concat(r.provider.names[0].given_name||""," ").concat(r.provider.names[0].family_name||""):"Unknown",w=(J=r==null?void 0:r.observations)==null?void 0:J.find(M=>{var Q,Y;return(Y=(Q=M==null?void 0:M.concept)==null?void 0:Q.concept_names)==null?void 0:Y.some(mt=>{var At;return(At=mt==null?void 0:mt.name)==null?void 0:At.toLowerCase().includes("date of referral")})});return _.push({patient_id:r.patient_id,fullName:p,referredFrom:h,referredBy:v,appointmentDate:(w==null?void 0:w.value_text)||"N/A"}),_},[]),window.navigatePatient=this.navigateTo},methods:{async navigateTo(t){let e=await ft.findByID(t);e?(await at().setPatientRecord(e),this.$router.push("/patientProfile")):yt("Patient not found. Please try searching by name.")}}}),Fa={class:"dueCardContent"};function Ea(t,e,s,i,d,_){const r=u("DataTable"),c=u("ion-card-content"),p=u("ion-card");return l(),R(p,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:o(()=>[a(c,null,{default:o(()=>[n("div",Fa,[a(r,{data:t.patients,columns:t.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})}const Oe=U(Ba,[["render",Ea],["__scopeId","data-v-a95ef46a"]]),xa=x({name:"referrals",components:{InternalReferrals:Oe,ExternalReferrals:Ma},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){this.segmentContent=t}}}),Ha={key:0},Ua={style:{display:"flex","margin-top":"10px"}},Wa={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},za={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},ja={key:1},Ga={key:2};function Ja(t,e,s,i,d,_){const r=u("ion-label"),c=u("ion-segment-button"),p=u("ion-segment"),h=u("ExternalReferrals"),v=u("InternalReferrals");return l(),f(E,null,[n("div",null,[a(p,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:o(()=>[a(c,{value:"External referrals",onClick:e[0]||(e[0]=w=>t.setSegmentContent("External referrals"))},{default:o(()=>[a(r,null,{default:o(()=>[...e[2]||(e[2]=[A("External referrals",-1)])]),_:1})]),_:1}),a(c,{value:"Internal referrals",onClick:e[1]||(e[1]=w=>t.setSegmentContent("Internal referrals"))},{default:o(()=>[a(r,null,{default:o(()=>[...e[3]||(e[3]=[A("Internal referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(l(),f("div",Ha,[n("div",Ua,[t.checkUnderFive?(l(),f("div",Wa)):S("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?S("",!0):(l(),f("div",za))])])):S("",!0),t.segmentContent=="External referrals"?(l(),f("div",ja,[a(h)])):S("",!0),t.segmentContent=="Internal referrals"?(l(),f("div",Ga,[a(v)])):S("",!0)],64)}const qa=U(xa,[["render",Ja],["__scopeId","data-v-8f0f935e"]]),Gt=ue("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(t){this.selectedItem=t},getSelectedItem(){return this.selectedItem}},persist:!0}),Ka=()=>{const t=L(null);return{activeIteminMixin:t,setActiveItem:s=>{t.value=s,console.log("lll: ",t.value)}}},It=x({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:t,setActiveItem:e}=Ka();return{chevronBackOutline:_e,checkmark:Qe,grid:Ke,chevronDownCircle:qe,chevronForwardCircle:Je,chevronUpCircle:Ge,colorPalette:je,document:ze,globe:We,medkit:fe,add:Ue,person:ge,people:he,thermometer:me,clipboard:pe,activeIteminMixin:t,setActiveItem:e}},async mounted(){await this.setAppointments()},computed:{...Z(at,["patient"])},watch:{$route:{async handler(t){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await Sn.getDailyAppointments(I.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((t,e)=>t.given_name.localeCompare(e.given_name)))},formatBirthdate(t){return I.getBirthdateAge(t)},setActiveItemRefFN(t){Gt().setSelectedItem(t)}}}),Qa=ue("ncdDashboardStore",{state:()=>({dashboardData:null,appointments:[],isLoading:!1,error:null,lastFetchDate:null,programId:32}),getters:{appointmentsCount:t=>t.appointments.length,pendingDispensationsCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_pending_dispensations)||0},defaultersCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_defaulters)||0},complicationsCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_complications)||0},activeClientsCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_client_registered)||0},genderChartData:t=>{var e;return(e=t.dashboardData)!=null&&e.gender_data?{categories:t.dashboardData.gender_data.categories,series:[{name:"Male",data:t.dashboardData.gender_data.maleSeries},{name:"Female",data:t.dashboardData.gender_data.femaleSeries}]}:{categories:[],series:[{name:"Male",data:[]},{name:"Female",data:[]}]}},diagnosisChartData:t=>{var e;return(e=t.dashboardData)!=null&&e.diagnosis_data?{categories:t.dashboardData.diagnosis_data.categories,series:[{name:"Type 1 Diabetes",data:t.dashboardData.diagnosis_data.typeOneSeries},{name:"Type 2 Diabetes",data:t.dashboardData.diagnosis_data.typeTwoSeries},{name:"Hypertention",data:t.dashboardData.diagnosis_data.hypertentionSeries}]}:{categories:[],series:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},hasData:t=>t.dashboardData!==null,isDataStale:t=>{if(!t.lastFetchDate)return!0;const e=I.toStandardHisFormat(I.sessionDate());return t.lastFetchDate!==e}},actions:{async fetchDashboardData(t,e){this.isLoading=!0,this.error=null;try{const s=t||I.toStandardHisFormat(I.sessionDate()),i=e||I.toStandardHisFormat(I.sessionDate()),d="programs/".concat(this.programId,"/reports/ncd_dashboard"),_=await z.getJson(d,{start_date:s,end_date:i});this.setDashboardData(_),this.lastFetchDate=s}catch(s){this.error=s.message||"Failed to fetch dashboard data",console.error("Error fetching NCD dashboard data:",s)}finally{this.isLoading=!1}},setDashboardData(t){this.dashboardData=t},setAppointments(t){this.appointments=t},addAppointment(t){this.appointments.push(t)},removeAppointment(t){this.appointments=this.appointments.filter(e=>e.id!==t)},updateAppointment(t,e){const s=this.appointments.findIndex(i=>i.id===t);s!==-1&&(this.appointments[s]={...this.appointments[s],...e})},setProgramId(t){this.programId=t},clearDashboardData(){this.dashboardData=null,this.appointments=[],this.error=null,this.lastFetchDate=null},async refreshDashboardData(){await this.fetchDashboardData()},async ensureFreshData(){(this.isDataStale||!this.hasData)&&await this.fetchDashboardData()}},persist:{key:"ncd-dashboard-store",storage:localStorage,paths:["dashboardData","appointments","lastFetchDate","programId"]}}),Ya=x({name:"NCDDashboard",mixins:[It],components:{ApexChart:Yt},setup(){const t=Rt(),e=Qa();return{router:t,dashboardStore:e}},data(){return{isChartReady:!1}},computed:{lineChartOptions(){return{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:this.dashboardStore.genderChartData.categories},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}}},barChartOptions(){return{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:this.dashboardStore.diagnosisChartData.categories},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}}}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){await this.dashboardStore.ensureFreshData(),await ve(),setTimeout(()=>{this.isChartReady=!0},100)},navigationMenu(t){try{Ye.close(),this.router.push(t).then(()=>{})}catch(e){console.error(e)}}}}),Xa={class:"cards-container"},Za={class:"top-card-text"},ts={class:"text-2xl font-bold"},es={class:"top-card-text"},ns={class:"text-2xl font-bold"},as={class:"top-card-text"},ss={class:"text-2xl font-bold"},os={class:"top-card-text"},is={class:"text-2xl font-bold"},rs={class:"top-card-text"},ls={class:"text-2xl font-bold"},ds={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},cs={ref:"chartRef1"},us={key:1,class:"loading-state"},ps={ref:"chartRef2"},ms={key:1,class:"loading-state"};function hs(t,e,s,i,d,_){const r=u("ion-card-content"),c=u("ion-card"),p=u("ApexChart");return l(),f(E,null,[n("div",Xa,[a(c,{class:"top-card action-card",onClick:e[0]||(e[0]=h=>t.setActiveItemRefFN("appointments"))},{default:o(()=>[a(r,null,{default:o(()=>[n("div",Za,[n("div",ts,g(t.dashboardStore.appointmentsCount),1),e[2]||(e[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]),_:1})]),_:1}),a(c,{class:"top-card action-card"},{default:o(()=>[a(r,null,{default:o(()=>[n("div",es,[n("div",ns,g(t.dashboardStore.pendingDispensationsCount),1),e[3]||(e[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]),_:1})]),_:1}),a(c,{class:"top-card action-card"},{default:o(()=>[a(r,null,{default:o(()=>[n("div",as,[n("div",ss,g(t.dashboardStore.defaultersCount),1),e[4]||(e[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]),_:1})]),_:1}),a(c,{class:"top-card action-card"},{default:o(()=>[a(r,null,{default:o(()=>[n("div",os,[n("div",is,g(t.dashboardStore.complicationsCount),1),e[5]||(e[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]),_:1})]),_:1}),a(c,{class:"top-card action-card",onClick:e[1]||(e[1]=h=>t.navigationMenu("NCDActivePatients"))},{default:o(()=>[a(r,null,{default:o(()=>[n("div",rs,[n("div",ls,g(t.dashboardStore.activeClientsCount),1),e[6]||(e[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]),_:1})]),_:1})]),n("div",ds,[a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[e[7]||(e[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",cs,[t.isChartReady&&!t.dashboardStore.isLoading?(l(),R(p,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.dashboardStore.diagnosisChartData.series},null,8,["options","series"])):S("",!0),t.dashboardStore.isLoading?(l(),f("div",us,"Loading...")):S("",!0)],512)]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[e[8]||(e[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",ps,[t.isChartReady&&!t.dashboardStore.isLoading?(l(),R(p,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.dashboardStore.genderChartData.series},null,8,["options","series"])):S("",!0),t.dashboardStore.isLoading?(l(),f("div",ms,"Loading...")):S("",!0)],512)]),_:1})]),_:1})])],64)}const gs=U(Ya,[["render",hs],["__scopeId","data-v-6de1dc4d"]]),fs=x({name:"Home",mixins:[Ie,It],components:{IonContent:st,IonHeader:it,IonPage:Ct,IonToolbar:ct,IonRow:Mt,DateInputField:Xt,IonIcon:j,IonButton:Tt,IonCol:Lt,IonCard:Vt,IonCardHeader:ye,IonCardTitle:be,IonCardContent:qt,ViewToggleComponent:zn,bottomNavBar:jn,HorizontalLine:In},data(){const t=localStorage.getItem("ncdStartDate"),e=localStorage.getItem("ncdEndDate"),s=L(t||I.sessionDate()),i=L(e||I.sessionDate()),d=L(I.sessionDate()),_=L(I.sessionDate()),r=L([]),c=Wt({page:1,itemsPerPage:10}),p=L(0),h=Hn(),v=L("list");return{minDate:d,startDate:s,endDate:i,people:r,calendarOutline:gt,openOutline:De,maxDate:_,alertCircleOutline:ce,personOutline:sn,idCardOutline:an,manOutline:nn,womanOutline:en,locationOutline:tn,timeOutline:Ze,todayOutline:Xe,pagination:c,totalCount:p,actionButtonStore:h,currentToggleView:v}},computed:{...Z(Zt,["NCDAppointmentsTogglePreference"]),paginatedPeople(){const t=(this.pagination.page-1)*this.pagination.itemsPerPage,e=t+this.pagination.itemsPerPage;return this.people.slice(t,e)},groupedPaginatedPeople(){const t={};this.paginatedPeople.forEach(i=>{const d=i.appointmentDate;t[d]||(t[d]=[]),t[d].push(i)});const e=Object.keys(t).sort((i,d)=>new Date(i)-new Date(d)),s={};return e.forEach(i=>{s[i]=t[i]}),s}},$route:{async handler(){},deep:!0},watch:{NCDAppointmentsTogglePreference:{handler(t){t&&t.toggle_view&&(this.currentToggleView=t.toggle_view)},deep:!0,immediate:!0}},async mounted(){this.initTogglePreference(),this.getAppointments(),this.HideHomePageActionButton()},async unmounted(){this.actionButtonStore.resetShowActionButton()},methods:{formatBirthdate(t){return I.getBirthdateAge(t)},async getAppointments(t=!1){if(Ae().apiStatus){this.people=[],this.pagination.page=1;try{t==!0&&(this.startDate=I.sessionDate(),this.endDate=I.sessionDate(),this.getAppointmentsD1(this.startDate),this.getAppointmentsD2(this.endDate)),this.startDate>this.endDate&&(this.endDate=this.startDate),console.log(this.startDate,this.endDate),(await Te.getAppointments(this.startDate,this.endDate,"")).forEach(i=>{const d=I.toStandardHisDisplayFormat(i.appointment_date);if(!this.people.some(r=>r.person_id===i.person_id&&r.appointmentDate===d)){const r={person_id:i.person_id,npid:i.npid,appointment_id:103,encounter_id:i.encounter_id,name:i.given_name.concat(" ",i.family_name),gender:i.gender,ageDob:this.formatBirthdate(i.birthdate),village:i.city_village,appointmentDate:d};this.people.push(r)}}),this.totalCount=this.people.length}catch(s){}}},async getAppointmentsD1(t){this.startDate=I.toStandardHisFormat(t),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=I.toStandardHisFormat(t),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(t){const e=await ft.findByNpid(t);at().setPatientRecord(e[0]),this.redirectUser()},handleViewChange(t){this.currentToggleView=t,this.initTogglePreference(t,!0)},initTogglePreference(t="list",e=!1){const s={toggle_view:t},i=Zt();Object.keys(this.NCDAppointmentsTogglePreference).length===0?(s.toggle_view="list",i.setNCDAppointmentsTogglePreference(s),this.currentToggleView="list"):e===!0?i.setNCDAppointmentsTogglePreference(s):this.currentToggleView=this.NCDAppointmentsTogglePreference.toggle_view||"list"},redirectUser(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(s=>e.some(i=>i.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")},handlePaginationUpdate({page:t,itemsPerPage:e}){if(e!==this.pagination.itemsPerPage){const s=(this.pagination.page-1)*this.pagination.itemsPerPage,i=Math.floor(s/e)+1,d=Math.ceil(this.totalCount/e);this.pagination.page=Math.min(i,d)||1,this.pagination.itemsPerPage=e}else this.pagination.page=t},HideHomePageActionButton(){this.actionButtonStore.setShowActionButton(!1)}}}),_s={class:"appointments-container"},vs={class:"date-filter"},bs={key:0,style:{margin:"20px"}},ys={key:1},Ds={class:"appointments-table"},Cs={key:2},$s={class:"date-group-header"},ws={class:"date-header-title"},ks={class:"date-header-count"},Ss={class:"cards-container"},Is={class:"card-details"},As={class:"detail-item"},Ps={class:"detail-value"},Ts={class:"detail-item"},Ns={class:"detail-value"},Os={class:"detail-item"},Rs={class:"detail-value"},Vs={class:"detail-item"},Ls={class:"detail-value"};function Ms(t,e,s,i,d,_){const r=u("DateInputField"),c=u("ion-col"),p=u("ion-icon"),h=u("ion-button"),v=u("ViewToggleComponent"),w=u("ion-row"),C=u("ion-card"),y=u("HorizontalLine"),b=u("ion-card-title"),D=u("ion-card-header"),N=u("ion-card-content"),P=u("ion-content"),V=u("bottomNavBar"),J=u("ion-footer");return l(),f("div",_s,[n("div",vs,[a(w,null,{default:o(()=>[a(c,null,{default:o(()=>[a(r,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(c,null,{default:o(()=>[a(r,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1}),a(c,null,{default:o(()=>[a(h,{color:"primary",onClick:e[0]||(e[0]=M=>t.getAppointments(!0)),class:"apt-btn"},{default:o(()=>[a(p,{icon:t.todayOutline,slot:"start"},null,8,["icon"]),e[1]||(e[1]=n("span",{style:{margin:"5px"}}," Today ",-1))]),_:1})]),_:1}),a(c,null,{default:o(()=>[a(v,{"initial-view":t.currentToggleView,onViewChanged:t.handleViewChange},null,8,["initial-view","onViewChanged"])]),_:1})]),_:1})]),a(P,{class:"scrollable-content"},{default:o(()=>[t.people.length===0?(l(),f("div",bs,[a(p,{icon:t.alertCircleOutline,size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),e[2]||(e[2]=n("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Appointments for selected date range",-1))])):t.currentToggleView==="list"&&t.people.length>0?(l(),f("div",ys,[a(C,null,{default:o(()=>[n("table",Ds,[e[3]||(e[3]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(l(!0),f(E,null,G(t.paginatedPeople,M=>(l(),f("tr",{key:M.npid},[n("td",null,[a(w,null,{default:o(()=>[a(c,null,{default:o(()=>[A(g(M.name),1)]),_:2},1024),a(c,null,{default:o(()=>[a(h,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:Q=>t.openClientProfile(M.npid),color:"primary",fill:"clear",size:"small"},{default:o(()=>[a(p,{icon:t.openOutline,style:{"font-size":"28px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,g(M.npid),1),n("td",null,g(M.ageDob),1),n("td",null,g(M.gender),1),n("td",null,g(M.village),1),n("td",null,g(M.appointmentDate),1)]))),128))])])]),_:1})])):t.currentToggleView==="card"&&t.people.length>0?(l(),f("div",Cs,[(l(!0),f(E,null,G(t.groupedPaginatedPeople,(M,Q)=>(l(),f("div",{key:Q,class:"date-group"},[n("div",$s,[a(p,{icon:t.calendarOutline,class:"date-header-icon"},null,8,["icon"]),n("h2",ws,g(Q),1),n("div",ks,g(M.length)+" appointment"+g(M.length!==1?"s":""),1)]),a(y,{color:"#006401",thickness:1,spacing:"sm"}),n("div",Ss,[(l(!0),f(E,null,G(M,Y=>(l(),R(C,{key:Y.npid,class:"appointment-card"},{default:o(()=>[a(D,null,{default:o(()=>[a(w,{class:"ion-align-items-center"},{default:o(()=>[a(c,null,{default:o(()=>[a(b,{class:"card-name"},{default:o(()=>[a(p,{icon:t.personOutline,class:"name-icon"},null,8,["icon"]),A(" "+g(Y.name),1)]),_:2},1024)]),_:2},1024),a(c,{size:"auto"},{default:o(()=>[a(h,{onClick:mt=>t.openClientProfile(Y.npid),color:"primary",fill:"clear",size:"small",class:"view-profile-btn"},{default:o(()=>[a(p,{icon:t.openOutline},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(N,null,{default:o(()=>[n("div",Is,[n("div",As,[a(p,{icon:t.idCardOutline,class:"detail-icon"},null,8,["icon"]),e[4]||(e[4]=n("span",{class:"detail-label"},"NPID:",-1)),n("span",Ps,g(Y.npid),1)]),n("div",Ts,[a(p,{icon:t.calendarOutline,class:"detail-icon"},null,8,["icon"]),e[5]||(e[5]=n("span",{class:"detail-label"},"Age/DOB:",-1)),n("span",Ns,g(Y.ageDob),1)]),n("div",Os,[a(p,{icon:Y.gender==="Male"?t.manOutline:t.womanOutline,class:"detail-icon"},null,8,["icon"]),e[6]||(e[6]=n("span",{class:"detail-label"},"Gender:",-1)),n("span",Rs,g(Y.gender),1)]),n("div",Vs,[a(p,{icon:t.locationOutline,class:"detail-icon"},null,8,["icon"]),e[7]||(e[7]=n("span",{class:"detail-label"},"Village:",-1)),n("span",Ls,g(Y.village),1)])])]),_:2},1024)]),_:2},1024))),128))])]))),128))])):S("",!0)]),_:1}),t.people.length>0?(l(),R(J,{key:0,class:"sticky-footer"},{default:o(()=>[a(w,null,{default:o(()=>[a(c,{size:"12",style:{"max-width":"100%"}},{default:o(()=>[a(V,{totalItems:t.totalCount,currentPage:t.pagination.page,itemsPerPage:t.pagination.itemsPerPage,"onUpdate:pagination":t.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])]),_:1})]),_:1})]),_:1})):S("",!0)])}const Bs=U(fs,[["render",Ms],["__scopeId","data-v-d02dae2c"]]),Fs={key:0,class:"left_col"},Es={class:"nav-menu"},xs=["onClick"],Hs={class:"ellipsis"},Us={key:1,style:{"padding-left":"20px","padding-right":"20px"}},Ws=x({__name:"NCDDashboard",setup(t){const e=Gt(),s=q(()=>e.selectedItem),{screenWidth:i}=An(),d=L([{id:"dashboard",label:"Dashboard",icon:Ce},{id:"referrals",label:"Referrals",icon:Kt},{id:"appointments",label:"Appointments",icon:gt}]),_=L("dashboard"),r=kt(),{substance:c}=zt(r);ht(()=>c.value,(h,v)=>{h!==v&&console.log("Substance changed:",h)},{deep:!0,immediate:!0});const p=h=>{_.value=h,Gt().setSelectedItem(_.value)};return ht(()=>s.value,h=>{console.log("Active item from mixin changed:",h),h&&h!=null&&p(h)},{immediate:!0}),(h,v)=>{const w=u("ion-segment-button"),C=u("ion-segment");return l(),f("div",{style:Nt(k(i)>940?"display: flex":"display: block")},[k(i)>940?(l(),f("div",Fs,[n("nav",Es,[n("ul",null,[(l(!0),f(E,null,G(d.value,y=>(l(),f("li",{key:y.id,class:nt({active:_.value===y.id}),onClick:b=>p(y.id)},[a(k(j),{icon:y.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",Hs,g(y.label),1)],10,xs))),128))])])])):S("",!0),k(i)<=940?(l(),f("div",Us,[a(C,{value:_.value,style:{"margin-top":"5px","justify-content":"left"}},{default:o(()=>[(l(!0),f(E,null,G(d.value,y=>(l(),R(w,{value:y.id,key:y.id,class:nt({active:_.value===y.id}),onClick:b=>p(y.id)},{default:o(()=>[a(k(j),{icon:y.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,g(y.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):S("",!0),n("div",{class:"right_col",style:Nt(k(i)>940?"width: 85%":"width: 100%")},[n("div",null,[_.value==="referrals"?(l(),R(qa,{key:0})):S("",!0),_.value==="dashboard"?(l(),R(gs,{key:1})):S("",!0),_.value==="appointments"?(l(),R(Bs,{key:2})):S("",!0)])],4)],4)}}}),zs=U(Ws,[["__scopeId","data-v-a1132315"]]);class js extends z{constructor(){super()}static async getHTCDashboardSummary(){return this.getJson("hts_stats")}}const Gs={class:"content-wrapper dashboard"},Js={class:"header"},qs={class:"overlay"},Ks={class:"big-number"},Qs={class:""},Ys={class:"cards"},Xs={class:"card"},Zs={class:"card-info"},to={class:"card-number"},eo={class:"card"},no={class:"card-info"},ao={class:"card-number"},so={class:"card"},oo={class:"card-info"},io={class:"card-number"},ro={class:"card"},lo={class:"card-info"},co={class:"section-title"},uo={class:"section"},po={class:"filter-bar"},mo={class:"patient-list"},ho={class:"status-tags"},go={class:"pagination"},fo=["disabled"],_o={class:"pagination-info"},vo={class:"showing-info"},bo=["disabled"],Ht=5,yo=x({__name:"HTSDashboard",setup(t){const e=L({clients_with_conclusive_results:0,total_clients:0,clients_tested_today:0,clients_referred_to_ART:0}),s=L(""),i=L(1),d=L([{id:1,name:"Kalumphalinga Kachindamoto",gender:"Male",age:37,status:"Referred OPD",statusClass:"yellow"},{id:2,name:"Kalumphalinga Kachindamoto",gender:"Female",age:26,status:"Returning Client",statusClass:"yellow"},{id:3,name:"Kalumphalinga Kachindamoto",gender:"Female",age:17,status:"Referred ART",statusClass:"yellow"},{id:4,name:"John Banda",gender:"Male",age:45,status:"Referred OPD",statusClass:"yellow"},{id:5,name:"Mary Phiri",gender:"Female",age:32,status:"Returning Client",statusClass:"yellow"},{id:6,name:"Peter Mwale",gender:"Male",age:28,status:"Referred ART",statusClass:"yellow"},{id:7,name:"Grace Lungu",gender:"Female",age:41,status:"Referred OPD",statusClass:"yellow"},{id:8,name:"Joseph Tembo",gender:"Male",age:55,status:"Returning Client",statusClass:"yellow"}]),_=q(()=>d.value.length),r=q(()=>Math.ceil(_.value/Ht)),c=q(()=>(i.value-1)*Ht),p=q(()=>Math.min(c.value+Ht,_.value)),h=q(()=>d.value.slice(c.value,p.value));function v(){i.value<r.value&&i.value++}function w(){i.value>1&&i.value--}dt(async()=>{await C()});async function C(){e.value=await js.getHTCDashboardSummary()}return(y,b)=>{var D;return l(),f("div",Gs,[n("div",Js,[n("div",qs,[n("h1",Ks,g((D=e.value)==null?void 0:D.clients_with_conclusive_results),1),b[1]||(b[1]=n("p",{class:"header-text"},[A(" Total Number of Clients Tested"),n("br"),A(" with Conclusive Results ")],-1))])]),n("div",Qs,[b[9]||(b[9]=n("h2",{class:"section-title"},"Today's Stats",-1)),n("div",Ys,[n("div",Xs,[n("div",Zs,[a(k(j),{icon:k(Kt),class:"card-icon"},null,8,["icon"])]),b[2]||(b[2]=n("div",{class:"card-info"},[n("p",null,"Total Clients")],-1)),n("div",to,g(e.value.total_clients),1)]),n("div",eo,[n("div",no,[a(k(j),{icon:k(Jt),class:"card-icon"},null,8,["icon"])]),b[3]||(b[3]=n("div",{class:"card-info"},[n("p",null,"Clients Tested Today")],-1)),n("div",ao,g(e.value.clients_tested_today),1)]),n("div",so,[n("div",oo,[a(k(j),{icon:k(on),class:"card-icon"},null,8,["icon"])]),b[4]||(b[4]=n("div",{class:"card-info"},[n("p",null,"Clients Referred To ART")],-1)),n("div",io,g(e.value.clients_referred_to_ART),1)]),n("div",ro,[n("div",lo,[a(k(j),{icon:k(gt),class:"card-icon"},null,8,["icon"])]),b[5]||(b[5]=n("div",{class:"card-info"},[n("p",null,"Visit Scheduled Today")],-1)),b[6]||(b[6]=n("div",{class:"card-number"},"10",-1))])]),n("h2",co,"Patient Awaiting List ("+g(_.value)+")",1),n("div",uo,[n("div",po,[rn(n("input",{class:"search-input",type:"text",placeholder:"Search Patient","onUpdate:modelValue":b[0]||(b[0]=N=>s.value=N)},null,512),[[ln,s.value]])]),n("div",mo,[(l(!0),f(E,null,G(h.value,N=>(l(),f("div",{class:"patient-item",key:N.id},[n("div",null,[n("strong",null,g(N.name),1),n("p",null,g(N.gender)+" â€¢ "+g(N.age)+"y",1)]),n("div",ho,[n("span",{class:nt(["tag",N.statusClass])},g(N.status),3)])]))),128))]),n("div",go,[n("button",{onClick:w,disabled:i.value===1,class:"pagination-btn"},[a(k(j),{icon:k(_e)},null,8,["icon"]),b[7]||(b[7]=A(" Previous ",-1))],8,fo),n("div",_o,[A(" Page "+g(i.value)+" of "+g(r.value)+" ",1),n("span",vo,"(Showing "+g(c.value+1)+"-"+g(p.value)+" of "+g(_.value)+")",1)]),n("button",{onClick:v,disabled:i.value===r.value,class:"pagination-btn"},[b[8]||(b[8]=A(" Next ",-1)),a(k(j),{icon:k(dn)},null,8,["icon"])],8,bo)])])])])}}}),Do=U(yo,[["__scopeId","data-v-c7b78569"]]),le={"HIV clinic registration":ot.HIV_CLINIC_REGISTRATION,"HIV reception":ot.HIV_RECEPTION,Vitals:ot.VITALS,"HIV staging":ot.HIV_STAGING,"HIV clinic consultation":ot.HIV_CLINIC_CONSULTATION,"ART adherence":ot.ART_ADHERENCE,Prescription:ot.TREATMENT,Dispensing:ot.DISPENSING,Appointments:ot.APPOINTMENT};class Co extends Pn{constructor(){super()}buildEncounters(e,s){return Object.entries(le).map(([i,d])=>({encounter:i,female:e?e[d].F:0,male:e?e[d].M:0,me:s?s[d].F+s[d].M:0,facility:e?e[d].F+e[d].M:0}))}async getStats(){const e=Object.values(le),s=Tn("reports/encounters",this.buildParams()),i=await z.postJson(s,{encounter_types:e}),d=await z.postJson(s,{encounter_types:e,all:!0});return this.buildEncounters(i.data,d.data)}getEncounterStats(e){return z.postJson("reports/encounters?date=".concat(this.date,"&program_id=1"),e)}}const $o={class:"dashboard-container"},wo={class:"main-section"},ko={class:"chart-section"},So={class:"encounters-section"},Io={class:"his-sm-text"},Ao={key:0},Po={class:"encounter-td"},To={class:"other-td"},No={class:"other-td"},Oo={class:"other-td"},Ro={class:"other-td"},Vo={key:1},Lo=x({__name:"ARTDashboard",setup(t){const e=L([]),s=Wt({options:{chart:{id:"vuechart-example"},xaxis:{categories:["","","","",""]},yaxis:{min:0,forceNiceScale:!0,title:{text:"Number of clients",align:"left"}}},series:[{name:"Total visits",data:[0,0,0,0,0],color:"#7cb5ec"},{name:"Total incomplete visits",data:[0,0,0,0,0],color:"#434348"}]}),i=Wt([{"HIV clinic registration":9},{"HIV reception":51},{Vitals:6},{"HIV staging":52},{"HIV clinic consultation":53},{"ART adherence":68},{Treatment:25},{Dispensing:54},{Appointments:7}]),d=()=>{e.value=i.map(c=>({encounter:Object.keys(c)[0],female:"",male:"",me:"",facility:""}))},_=async()=>{const c=new Gn,p=z.getSessionDate();c.setStartDate(I.subtract(p,"days",5).format(te)),c.setEndDate(I.subtract(p,"days",1).format(te));const h=await c.getVisitStats(),v=[],w=[],C=[];Object.entries(h).forEach(([y,{incomplete:b,complete:D}])=>{C.push(cn(y).format("dddd")),v.push(b),w.push(b+D)}),s.series[0].data=[...w],s.series[1].data=[...v],s.options={...s.options,xaxis:{categories:[...C]}}},r=async()=>{try{const c=new Co,p=i.map(w=>Object.values(w)[0]),h=await c.getEncounterStats({encounter_types:p}),v=await c.getEncounterStats({encounter_types:p,all:!0});e.value=i.map(w=>{const[C,y]=Object.entries(w)[0];return{encounter:C,female:v[y].F,male:v[y].M,me:h[y].F+h[y].M,facility:v[y].F+v[y].M}})}catch(c){console.error(c)}};return dt(()=>{d(),_(),r()}),(c,p)=>(l(),f("div",$o,[n("div",wo,[n("div",ko,[p[0]||(p[0]=n("h3",null,"Total visits/incomplete visits: last 5 days",-1)),a(k(Yt),{width:"100%",height:"390px",type:"bar",options:s.options,series:s.series},null,8,["options","series"])]),n("div",So,[p[3]||(p[3]=n("h3",null,"Encounters created today",-1)),n("table",Io,[p[2]||(p[2]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),e.value.length?(l(),f("tbody",Ao,[(l(!0),f(E,null,G(e.value,(h,v)=>(l(),f("tr",{key:v},[n("td",Po,g(h.encounter),1),n("td",To,g(h.female),1),n("td",No,g(h.male),1),n("td",Oo,g(h.me),1),n("td",Ro,g(h.facility),1)]))),128))])):(l(),f("tbody",Vo,[...p[1]||(p[1]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])]))])])])]))}}),Mo=U(Lo,[["__scopeId","data-v-9bb19378"]]);class Ut extends z{static getlogs(e,s){return this.getJson("notification/logs",{startDate:e,endDate:s})}static clear(e){return this.putJson("notifications/clear/".concat(e),{id:e})}static read(e){return this.putJson("notifications/update",{alerts:e})}static unread(){return this.getJson("notifications")}}const rt=L([]),Bo=Rt();function Re(){const t=q(()=>rt.value.filter(v=>!v.read)),e=q(()=>rt.value.length>0),s=q(()=>t.value.length>0),i=q(()=>t.value.length),d=q(()=>rt.value.sort((v,w)=>new Date(v.date)>new Date(w.date)?-1:1));function _(v,w){Nn("Are you sure you want to clear notification?").then(C=>{C&&Ut.clear(v).then(()=>{rt.value=rt.value.filter(y=>y.id!=v),w(v),c()}).catch(y=>{console.error(y),yt("Unable to clear notification")})})}function r(v){return I.toStandardHisDisplayFormat(v)}async function c(){rt.value=[];const v=await Ut.unread();if(!bt.isEmpty(v)){const w={highVL:[],normalVL:[],rejectedVL:[]};let C={};rt.value=v.map(y=>{let b="General";const D=y.text;let N=null;try{const P=JSON.parse(y.text);if(P.Type.match(/lims/i)){N=()=>Bo.push("/art/encounters/lab/".concat(P.PatientID)),b="".concat(P["Test type"]," results for ").concat(P["ARV-Number"]||P["Accession number"]);const V=On.detectHighVl(P.Result[0].value,P.Result[0].value_modifier);C={handler:N,id:y.alert_id,arv:P["ARV-Number"],accession:P["Accession number"],order_date:r(P["Orde date"]),results:P.Result[0].value_modifier+" "+P.Result[0].value,results_date:r(P.Result[0].date)},V?w.highVL.push(C):P.rejection_reason?(C={handler:N,id:y.alert_id,arv:P.arv_number,accession:P.accession_number,order_date:r(P.order_date),rejection_reason:P.rejection_reason},w.rejectedVL.push(C)):V||w.normalVL.push(C)}}catch(P){console.warn(P)}return{handler:N,message:D,vlMessageObs:w,title:b,id:y.alert_id,date:r(y.date_created)}})}}async function p(v){Ut.read([v.id]).then(()=>v.read=!0)}function h(v){typeof v.handler=="function"&&(p(v),v.handler())}return{markAsRead:p,openNotification:h,loadNotifications:c,clearNotification:_,sortedNotifications:d,hasUnreadNotifications:s,notificationCount:i,hasNotifications:e,notificationData:rt}}const Fo={class:"vl-alerts-container"},Eo={class:"table-container"},xo={class:"vl-table"},Ho={key:0},Uo={key:0},Wo=["colspan"],zo={key:0},jo=x({__name:"ARTVlAlert",setup(t){const e=L("high_vl"),{notificationData:s,loadNotifications:i,clearNotification:d,openNotification:_}=Re(),r=q(()=>{var b,D;return s.value.length?(((D=(b=s.value[0])==null?void 0:b.vlMessageObs)==null?void 0:D.highVL)||[]).length:0}),c=q(()=>{var b,D;return s.value.length?(((D=(b=s.value[0])==null?void 0:b.vlMessageObs)==null?void 0:D.rejectedVL)||[]).length:0}),p=q(()=>{var b,D;return s.value.length?(((D=(b=s.value[0])==null?void 0:b.vlMessageObs)==null?void 0:D.normalVL)||[]).length:0}),h=q(()=>{var b;if(!s.value.length)return[];const y=(b=s.value[0])==null?void 0:b.vlMessageObs;if(!y)return[];switch(e.value){case"high_vl":return y.highVL||[];case"rejected":return y.rejectedVL||[];case"normal":return y.normalVL||[];default:return[]}}),v=y=>_(y),w=y=>{y.id&&d(y.id,b=>{console.log("Cleared notification ".concat(b))})},C=()=>{switch(e.value){case"high_vl":return"No high viral load results found";case"rejected":return"No rejected samples found";case"normal":return"No normal results found";default:return"No results found"}};return dt(()=>{i()}),(y,b)=>(l(),f("div",Fo,[a(k(Qt),{mode:"ios",modelValue:e.value,"onUpdate:modelValue":b[0]||(b[0]=D=>e.value=D),class:"category-segment"},{default:o(()=>[a(k(lt),{value:"high_vl"},{default:o(()=>[a(k(vt),null,{default:o(()=>[A("High VL ("+g(r.value)+")",1)]),_:1})]),_:1}),a(k(lt),{value:"rejected"},{default:o(()=>[a(k(vt),null,{default:o(()=>[A("Rejected ("+g(c.value)+")",1)]),_:1})]),_:1}),a(k(lt),{value:"normal"},{default:o(()=>[a(k(vt),null,{default:o(()=>[A("Normal Results ("+g(p.value)+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",Eo,[n("table",xo,[n("thead",null,[n("tr",null,[b[1]||(b[1]=n("th",null,"ARV #",-1)),b[2]||(b[2]=n("th",null,"Accession #",-1)),b[3]||(b[3]=n("th",null,"Order Date",-1)),e.value==="rejected"?(l(),f("th",Ho,"Rejection Reason")):S("",!0),b[4]||(b[4]=n("th",null,"View",-1)),b[5]||(b[5]=n("th",null,"Clear",-1))])]),n("tbody",null,[h.value.length===0?(l(),f("tr",Uo,[n("td",{colspan:e.value==="rejected"?6:5,class:"empty-message"},g(C()),9,Wo)])):S("",!0),(l(!0),f(E,null,G(h.value,D=>(l(),f("tr",{key:D.id},[n("td",null,g(D.arv||"-"),1),n("td",null,g(D.accession||"-"),1),n("td",null,g(D.order_date||"-"),1),e.value==="rejected"?(l(),f("td",zo,g(D.rejection_reason||"-"),1)):S("",!0),n("td",null,[a(k(Tt),{fill:"clear",size:"small",onClick:N=>v(D)},{default:o(()=>[a(k(j),{icon:k($e),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])]),n("td",null,[a(k(Tt),{fill:"clear",size:"small",onClick:N=>w(D),color:"success"},{default:o(()=>[a(k(j),{icon:k(un),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])])]))),128))])])])]))}}),Go=U(jo,[["__scopeId","data-v-7b9c4735"]]),Jo={class:"dashboard-container"},qo={class:"segment-content"},Ko={key:0},Qo={key:1},Yo={key:2},Xo=x({__name:"ARTHome",setup(t){const e=L("dashboard"),{notificationCount:s,loadNotifications:i}=Re();return dt(()=>{i()}),(d,_)=>(l(),f("div",Jo,[a(k(Qt),{modelValue:e.value,"onUpdate:modelValue":_[0]||(_[0]=r=>e.value=r)},{default:o(()=>[a(k(lt),{value:"dashboard"},{default:o(()=>[..._[1]||(_[1]=[A(" Overview ",-1)])]),_:1}),a(k(lt),{value:"viralLoadAlerts"},{default:o(()=>[n("div",qo,[_[2]||(_[2]=A(" VL Alerts ",-1)),k(s)>0?(l(),R(k(pn),{key:0,color:"primary"},{default:o(()=>[A(g(k(s)),1)]),_:1})):S("",!0)])]),_:1}),a(k(lt),{value:"internalReferrals"},{default:o(()=>[..._[3]||(_[3]=[A(" Internal referrals ",-1)])]),_:1})]),_:1},8,["modelValue"]),e.value==="dashboard"?(l(),f("div",Ko,[a(Mo)])):S("",!0),e.value==="viralLoadAlerts"?(l(),f("div",Qo,[a(Go)])):S("",!0),e.value==="internalReferrals"?(l(),f("div",Yo,[a(Oe)])):S("",!0)]))}}),Zo=U(Xo,[["__scopeId","data-v-d237cab2"]]);class ti{constructor(){et(this,"socket",null);et(this,"channel","ImmunizationReportChannel");et(this,"isConnected",!1);et(this,"pendingFetch",null);et(this,"location_id");et(this,"initPromise");et(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});et(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});et(this,"onError",e=>{console.error("WebSocket error:",e),this.isConnected=!1});this.initPromise=this.init()}async init(){const e=localStorage.getItem("apiURL"),s=localStorage.getItem("apiPort"),i=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const d="".concat(i,"://").concat(e,"/api/v1/cable");this.socket=new WebSocket(d),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(d){console.error(d),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const e={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(e))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await z.getJson("immunization/stats",{start_date:I.getDateBeforeByDays(I.sessionDate(),365),end_date:I.sessionDate()})}async setMessageHandler(e){await this.initPromise,this.socket?this.socket.onmessage=s=>{e(s)}:console.error("WebSocket connection not established.")}}const ei=x({components:{IonContent:st,IonHeader:it,IonItem:pt,IonList:ut,IonMenu:wt,IonTitle:$t,IonToolbar:ct,IonInput:de,BasicInputField:Vn,BasicForm:St,PreviousVitals:Rn,customDatePicker:qn,IonCol:Lt,IonRow:Mt,VueMultiselect:mn,IonLabel:vt,DataTable:Dt},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:Et,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:I.toStandardHisDisplayFormat(z.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...Z(Jn,["administerOtherVaccine"]),...Z(ee,["tempScannedBatchNumber"]),...Z(at,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await Qn(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:ge,pulseOutline:hn,clipboardOutline:Jt}},methods:{formatBirthdate(t){return I.getBirthdateAge(t)},async openClientProfile(t){const e=await ft.findByID(t);await at().setPatientRecord(e),this.$router.push("patientProfile")},processData(){var e;return((e=this.data)==null?void 0:e.map(s=>{if(s.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let i=[];const d=_=>_.map(c=>{let p=0;return c.clients.map(h=>{(c.drug_name==this.drug_name&&(this.village==h.table.city_village||this.village=="All")||(c.drug_name==this.drug_name||this.village==h.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:h.table.given_name,family_name:h.table.family_name,patient_id:h.table.patient_id,birthdate:h.table.birthdate,city_village:h.table.city_village}),p++),this.villageList.push(h.table.city_village)}),[c.drug_name,p]}).filter(c=>c[1]!==0);return this.title=="Client due today"&&(i=d(s.value.due_today_antigens)),this.title=="Client due this week"&&(i=d(s.value.due_this_week_antigens)),this.title=="Client due this month"&&(i=d(s.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(i=d(s.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(i=d(s.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(_=>JSON.stringify(_)))].map(_=>JSON.parse(_)),this.villageList=[...new Set(this.villageList)],i}}))[0]},handleVillageClick(t){this.drug_name="",this.village=t,this.tableData=this.processData()},handleRowClick(t){var s;this.tableEvent=t.target;const e=this.tableEvent.closest("tr");if(e){const i=Array.from(((s=e.parentNode)==null?void 0:s.children)||[]).indexOf(e),d=this.tableData[i];this.drug_name=d[0],e.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(t){return I.calculateDisplayAge(t)},openPopover(t){this.event=t,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(t){var s;const e=t.target.value;this.batchNumber=e||((s=this.tempScannedBatchNumber)==null?void 0:s.text)||""},saveBatchWithTodayDate(){let t=z.getSessionDate();this.saveDta(t)},dismiss(){Bt.dismiss()},saveBatch(){let t;bt.isEmpty(this.vaccineDate)==!0?t=z.getSessionDate():t=this.vaccineDate,this.saveDta(t)},validateVaccineName(){if(bt.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(bt.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(t){this.currentDrugOb=t},isAlphaNumeric(t){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(t)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(t){this.batchNumber=t},saveDta(t){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){yt("Enter batch number!");return}if(this.batchNumber==""){yt("Enter batch number!");return}const e={batch_number:this.batchNumber,date_administered:t,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},s=ee();s.setAdministeredVaccine(e),Kn(this.patient),this.dismiss(),s.setTempScannedBatchNumber(null)}}}),ni={key:0,class:"spinner-overlay"},ai={class:"header position_content"},si={style:{"font-size":"1.2em","font-weight":"700"}},oi={class:"dueCardContent"},ii=["onClick"],ri={style:{"margin-right":"15px"}},li={style:{"align-items":"center",display:"flex"}},di={style:{"line-height":"1"}},ci={class:"client_name"},ui={class:"name"},pi={class:"demographicsOtherRow"},mi={class:"demographicsText"};function hi(t,e,s,i,d,_){const r=u("ion-spinner"),c=u("ion-icon"),p=u("ion-header"),h=u("ion-card-title"),v=u("ion-card-header"),w=u("DataTable"),C=u("ion-card-content"),y=u("ion-card"),b=u("ion-item"),D=u("ion-list"),N=u("ion-popover"),P=u("ion-content");return l(),f(E,null,[t.isLoading?(l(),f("div",ni,[a(r,{name:"bubbles"}),e[3]||(e[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):S("",!0),a(p,null,{default:o(()=>[n("div",ai,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=V=>t.dismiss())},[a(c,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",si,g(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=V=>t.openPopover(V))},[a(c,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(P,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:o(()=>[n("div",null,[a(y,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:o(()=>[a(v,null,{default:o(()=>[a(h,{class:"sectionTitle"},{default:o(()=>[...e[4]||(e[4]=[A(" Summary of required doses ",-1)])]),_:1})]),_:1}),a(C,null,{default:o(()=>[n("div",oi,[a(w,{options:t.options,data:t.tableData,class:"display nowrap",width:"100%",onClick:t.handleRowClick},{default:o(()=>[...e[5]||(e[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])]),_:1},8,["options","data","onClick"])])]),_:1})]),_:1}),a(y,{class:"section",style:{"margin-inline":"0px"}},{default:o(()=>[a(v,null,{default:o(()=>[a(h,{class:"sectionTitle"},{default:o(()=>[...e[6]||(e[6]=[A("Client Details ",-1)])]),_:1})]),_:1}),a(C,null,{default:o(()=>[(l(!0),f(E,null,G(t.clientDetails,(V,J)=>(l(),f("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:J,onClick:M=>t.openClientProfile(V.patient_id)},[n("div",ri,[n("div",{class:nt((V==null?void 0:V.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(c,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),n("div",li,[n("div",di,[n("div",ci,[n("div",ui,g(V.given_name)+" "+g(V.family_name),1)]),n("div",pi,[n("div",mi,[A(g(V.gender=="M"?"Male":"Female")+" ",1),e[7]||(e[7]=n("span",{class:"dot"},".",-1)),A(g(t.formatBirthdate(V.birthdate)),1)])]),n("div",null,"Village: "+g(V.city_village),1)])])],8,ii))),128))]),_:1})]),_:1})]),a(N,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:t.event,onDidDismiss:e[2]||(e[2]=V=>t.popoverOpen=!1)},{default:o(()=>[n("div",null,[e[8]||(e[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(l(!0),f(E,null,G(t.villageList,(V,J)=>(l(),R(D,{class:nt(V==t.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:J},{default:o(()=>[a(b,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:M=>t.handleVillageClick(V)},{default:o(()=>[A(g(V),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const gi=U(ei,[["render",hi],["__scopeId","data-v-dfc02771"]]),fi=x({name:"Menu",mixins:[It],components:{IonContent:st,IonHeader:it,IonItem:pt,IonList:ut,IonMenu:wt,IonTitle:$t,IonToolbar:ct,IonCheckbox:Ft,BasicForm:St,BasicCard:xt,Carousel:vn,Slide:_n,Pagination:fn,Navigation:gn},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},computed:{...Z(kt,["substance"]),backgroundStyle(){return{background:"linear-gradient(180deg, rgba(150, 152, 152, 0.7) 0%, rgba(255, 255, 255, 0.9) 100%), url(".concat(Yn("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",height:"22.8vh"}}},watch:{},async mounted(){new ti().setMessageHandler(this.onMessage)},methods:{async onMessage(t){var s,i,d;const e=JSON.parse(t.data);e.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=e.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((s=this.reportData)==null?void 0:s.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((i=this.reportData)==null?void 0:i.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((d=this.reportData)==null?void 0:d.total_male_vaccinated_this_year)||0}])},openDueModal(t){const e={title:t,dashBoardData:this.reportData};Pt(gi,{class:"fullScreenModal"},!0,e)},async openClientProfile(t){const e=await ft.findByNpid(t);await at().setPatientRecord(e[0])}}}),_i={class:"topStats"},vi={class:"totalStats",style:{background:"linear-gradient(180deg, #20b2aa 0%, #40c0b0 50%, rgb(233, 233, 233) 100%)"}},bi={class:"statsValue",style:{"font-size":"1.4em"}},yi={class:"statsText",style:{"font-size":"0.9em"}},Di={class:"dueCardContent"},Ci={class:"statsValue"},$i={class:"statsValue"},wi={class:"statsValue"},ki={class:"overDueCardContent"},Si={class:"statsValue"},Ii={class:"statsValue"},Ai=["onClick"],Pi={style:{"margin-right":"15px"}},Ti={style:{"align-items":"center",display:"flex"}},Ni={style:{"line-height":"1"}},Oi={class:"client_name"},Ri={class:"name"},Vi={class:"demographicsOtherRow"},Li={class:"demographicsText"};function Mi(t,e,s,i,d,_){const r=u("Slide"),c=u("Pagination"),p=u("Carousel"),h=u("ion-card-title"),v=u("ion-card-header"),w=u("ion-card-content"),C=u("ion-card"),y=u("ion-icon"),b=u("ion-content");return l(),R(b,{class:"content"},{default:o(()=>[n("div",_i,[n("div",null,[n("div",{style:Nt(t.backgroundStyle)},[a(p,{autoplay:4e3,"wrap-around":!0,itemsToShow:1.2,transition:600,style:{"padding-top":"20px"}},{addons:o(()=>[a(c)]),default:o(()=>[(l(!0),f(E,null,G(t.totalStats,D=>(l(),R(r,{key:D},{default:o(()=>[n("div",vi,[n("div",bi,g(D.value),1),n("div",yi,g(D.name),1)])]),_:2},1024))),128))]),_:1})],4)]),a(C,{class:"section"},{default:o(()=>[a(v,null,{default:o(()=>[a(h,{class:"cardTitle"},{default:o(()=>[...e[5]||(e[5]=[A(" Clients due ",-1)])]),_:1})]),_:1}),a(w,null,{default:o(()=>{var D,N,P;return[n("div",Di,[n("div",{class:"dueCard",onClick:e[0]||(e[0]=V=>t.openDueModal("Client due today")),style:{border:"1px solid rgb(158, 207, 136)"}},[n("div",Ci,g(((D=t.reportData)==null?void 0:D.due_today_count)||0),1),e[6]||(e[6]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(239, 221, 121)"},onClick:e[1]||(e[1]=V=>t.openDueModal("Client due this week"))},[n("div",$i,g(((N=t.reportData)==null?void 0:N.due_this_week_count)||0),1),e[7]||(e[7]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(241, 154, 154)"},onClick:e[2]||(e[2]=V=>t.openDueModal("Client due this month"))},[n("div",wi,g(((P=t.reportData)==null?void 0:P.due_this_month_count)||0),1),e[8]||(e[8]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),a(C,{class:"section"},{default:o(()=>[a(v,null,{default:o(()=>[a(h,{class:"cardTitle"},{default:o(()=>[...e[9]||(e[9]=[A(" Clients overdue ",-1)])]),_:1})]),_:1}),a(w,null,{default:o(()=>{var D,N;return[n("div",ki,[n("div",{class:"overDueCard",onClick:e[3]||(e[3]=P=>t.openDueModal("Client overdue under 5yrs"))},[n("div",Si,g(((D=t.reportData)==null?void 0:D.under_five_overdue)||0),1),e[10]||(e[10]=n("div",{class:"statsText"},"Under 5yrs",-1))]),n("div",{class:"overDueCard",onClick:e[4]||(e[4]=P=>t.openDueModal("Client overdue over 5yrs"))},[n("div",Ii,g(((N=t.reportData)==null?void 0:N.over_five_overdue)||0),1),e[11]||(e[11]=n("div",{class:"statsText"},"Over 5yrs",-1))])])]}),_:1})]),_:1}),a(C,{class:"section"},{default:o(()=>[a(v,null,{default:o(()=>[a(h,{class:"cardTitle"},{default:o(()=>{var D;return[A("Today's appointments("+g((D=t.appointments)==null?void 0:D.length)+") ",1)]}),_:1})]),_:1}),a(w,null,{default:o(()=>[(l(!0),f(E,null,G(t.appointments,(D,N)=>(l(),f("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:N,onClick:P=>t.openClientProfile(D.npid)},[n("div",Pi,[n("div",{class:nt(D.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(y,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),n("div",Ti,[n("div",Ni,[n("div",Oi,[n("div",Ri,g(D.given_name)+" "+g(D.family_name),1)]),n("div",Vi,[n("div",Li,[A(g(D.gender=="M"?"Male":"Female")+" ",1),e[12]||(e[12]=n("span",{class:"dot"},".",-1)),A(g(t.formatBirthdate(D.birthdate)),1)])]),n("div",null,"Village: "+g(D==null?void 0:D.city_village),1)])])],8,Ai))),128))]),_:1})]),_:1})])]),_:1})}const Bi=U(fi,[["render",Mi],["__scopeId","data-v-8f784320"]]),Fi=x({components:{DataTable:Dt},props:{title:{type:String,default:""},list:{type:String,default:""},buttonTitle:{type:String,default:""},buttonLink:{type:String,default:""}},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:(t,e)=>{if(!t)return"-";const s=new Date(t).getTime(),i=Date.now()-s,d=Math.floor(i/6e4),_=(()=>{if(d<1)return"Just now";if(d<60)return"".concat(d," min").concat(d>1?"s":""," ago");const r=Math.floor(d/60);if(r<24)return"".concat(r," hour").concat(r>1?"s":""," ago");const c=Math.floor(r/24);return"".concat(c," day").concat(c>1?"s":""," ago")})();return e==="display"?_:i},type:"num",width:"15%"},{title:"Actions",data:null,render:(t,e,s)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px";const d="  --padding-top: 4px;\n                                            --padding-bottom: 4px;\n                                            --padding-start: 8px;\n                                            --padding-end: 8px;\n                                            font-size: 0.8rem;\n                                            height: 28px;\n                                            min-width: 70px;\n                                            white-space: nowrap;\n                                            ",_=(r,c,p)=>{const h=document.createElement("ion-button");return h.innerText=r,h.size="small",h.fill="solid",h.color=c,h.style.cssText=d,h.addEventListener("click",p),h};return i.appendChild(_(this.buttonTitle,"primary",()=>this.navigateTo(s,this.buttonLink))),i.appendChild(_("Profile","warning",()=>this.navigateTo(s,"/patientProfile"))),i.appendChild(_("Abscond","danger",()=>this.handleAbscond(s.identifier))),i},orderable:!1,width:"25%"}],tableOptions:{order:[[1,"desc"]]}}},computed:{...Z(jt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{patientsWaitingForConsultation:{handler(t){this.list==="CONSULTATION"&&(this.patients=t)},deep:!0},patientsWaitingForVitals:{handler(t){this.list==="VITALS"&&(this.patients=t)},deep:!0},patientsWaitingForLab:{handler(t){this.list==="LAB"&&(this.patients=t)},deep:!0},patientsWaitingForDispensation:{handler(t){this.list==="DISPENSATION"&&(this.patients=t)},deep:!0}},mounted(){this.setList()},methods:{setList(){const t={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation},e=this.list;this.patients=t[e]||[]},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),s=Math.floor(e/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const i=Math.floor(s/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const d=Math.floor(i/24);return"".concat(d," day").concat(d>1?"s":""," ago")},async navigateTo(t,e){let s=[],i=null;z.getPouchDbStatus()||z.getLanConnectionStatus()?(s=await Ot("patients_records",{selector:{ID:t.identifier}}),i=s[0]):i||(i=await z.getJson("/patients/".concat(t.patient_id,"/get_patient_record"))),console.log("ðŸš€ ~ patientRecord:",i);const d=i;await at().setPatientRecord(d),this.$router.push(e)},async handleAbscond(t){await Ln({ID:t})},dismiss(){Bt.dismiss()}}}),Ei={class:"modal-container"},xi={class:"dueCardContent"};function Hi(t,e,s,i,d,_){const r=u("ion-button"),c=u("ion-card-title"),p=u("ion-card-header"),h=u("DataTable"),v=u("ion-card-content"),w=u("ion-card");return l(),f("div",Ei,[a(r,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:o(()=>[...e[0]||(e[0]=[A(" Close ",-1)])]),_:1},8,["onClick"]),a(w,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:o(()=>[a(p,null,{default:o(()=>[a(c,{class:"sectionTitle"},{default:o(()=>[A(g(t.title),1)]),_:1})]),_:1}),a(v,null,{default:o(()=>[n("div",xi,[a(h,{data:t.patients,options:t.tableOptions,columns:t.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const Ui=U(Fi,[["render",Hi],["__scopeId","data-v-110bf012"]]),Wi=x({components:{IonContent:st,IonHeader:it,IonItem:pt,IonList:ut,IonIcon:j,IonCard:Vt,IonCardHeader:ye,IonCardTitle:be,IonCardContent:qt,IonPopover:we,DataTable:Dt},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:Et,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:t=>this.waitingTime(t),width:"20%"},{title:"Actions",data:null,render:(t,e,s)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px";const d="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",_=(r,c,p)=>{const h=document.createElement("ion-button");return h.innerText=r,h.size="small",h.fill="solid",h.color=c,h.style.cssText=d,h.addEventListener("click",p),h};return i.appendChild(_("Profile","warning",()=>this.navigateTo(t,"/patientProfile"))),i},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const t=await Mn();this.patients=t.map(e=>({fullName:e.fullName||"",arrivalTime:e.startDate||"",patient_id:e.patientId||"",identifier:e.identifier||""}))},methods:{openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Bt.dismiss()},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),s=Math.floor(e/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const i=Math.floor(s/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const d=Math.floor(i/24);return"".concat(d," day").concat(d>1?"s":""," ago")},async navigateTo(t,e){let s;(z.getPouchDbStatus()||z.getLanConnectionStatus())&&(s=await Ot("patients_records",{selector:{ID:t.identifier}}),s=s[0]),s||(s=await ft.findByID(t.patient_id)),s?(await at().setPatientRecord(s),this.$router.push(e)):yt("Patient not found. Please try searching the patient by name.")}}}),zi={class:"modal-container"},ji={class:"dueCardContent"};function Gi(t,e,s,i,d,_){const r=u("ion-button"),c=u("ion-card-title"),p=u("ion-card-header"),h=u("DataTable"),v=u("ion-card-content"),w=u("ion-card");return l(),f("div",zi,[a(r,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:o(()=>[...e[0]||(e[0]=[A(" Close ",-1)])]),_:1},8,["onClick"]),a(w,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:o(()=>[a(p,null,{default:o(()=>[a(c,{class:"sectionTitle"},{default:o(()=>[A(g(t.title),1)]),_:1})]),_:1}),a(v,null,{default:o(()=>[n("div",ji,[a(h,{data:t.patients,columns:t.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})])}const Ji=U(Wi,[["render",Gi],["__scopeId","data-v-0d3bb4d1"]]),qi=x({name:"OPDAppointmentsModal",components:{IonPage:Ct,IonHeader:it,IonContent:st,IonItem:pt,IonList:ut,IonIcon:j,IonCard:Vt,IonCardContent:qt,IonPopover:we,DataTable:Dt,IonSegment:Qt,IonSegmentButton:lt,IonLabel:vt,IonRow:Mt,IonCol:Lt,DateInputField:Xt},props:{title:{type:String,default:"OPD Appointments"},programType:{type:String,required:!0},programId:{type:Number,required:!0}},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:Et,appointments:[],viewMode:"today",startDate:I.sessionDate(),endDate:I.sessionDate(),calendarOutline:gt,openOutline:De,tableColumns:[{title:"Patient ID",data:"ID"},{title:"Name",data:"name"},{title:"Age/DOB",data:"ageDob"},{title:"Gender",data:"gender"},{title:"Village",data:"village"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(t,e,s)=>{const i=document.createElement("div"),d=document.createElement("ion-button");return d.innerText="Profile",d.size="small",d.style.color="#fff",d.style.padding="8px 12px",d.style.marginRight="8px",d.addEventListener("click",()=>this.openClientProfile(s.ID)),i.appendChild(d),i},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,order:[[5,"asc"]]}}},async mounted(){await this.loadAppointments()},methods:{async loadAppointments(){this.isLoading=!0;try{const t=I.sessionDate(),e=this.viewMode==="today"?t:this.startDate,s=this.viewMode==="today"?t:this.endDate,i=localStorage.getItem("locationID"),d=typeof e=="string"?e:I.toStandardHisFormat(e),_=typeof s=="string"?s:I.toStandardHisFormat(s),c=(await Ot("patients_records")).flatMap(p=>{var v,w;return[...((v=p.appointments)==null?void 0:v.saved)||[],...((w=p.appointments)==null?void 0:w.unsaved)||[]].filter(C=>{if(!(C!=null&&C.value_datetime)||C.location_id&&C.location_id!==i)return!1;const y=I.toStandardHisFormat(C.value_datetime);return y>=d&&y<=_}).map(C=>{var y,b,D,N,P;return{ID:p.ID,name:[(y=p.personInformation)==null?void 0:y.given_name,(b=p.personInformation)==null?void 0:b.family_name].filter(Boolean).join(" ")||"Unknown",ageDob:(D=p.personInformation)!=null&&D.birthdate?I.getBirthdateAge(p.personInformation.birthdate):"N/A",gender:((N=p.personInformation)==null?void 0:N.gender)||"Unknown",village:((P=p.personInformation)==null?void 0:P.home_village)||"Unknown",appointmentDate:I.toStandardHisDisplayFormat(C.value_datetime),appointmentDateTime:C.value_datetime,rawData:C}})}).sort((p,h)=>new Date(p.appointmentDateTime).getTime()-new Date(h.appointmentDateTime).getTime());this.appointments=c,console.log("Found ".concat(c.length," appointments"))}catch(t){console.error("Error loading appointments:",t),ne("Failed to load appointments")}finally{this.isLoading=!1}},async getAppointmentsD1(t){this.startDate=I.toStandardHisFormat(t),await this.loadAppointments()},async getAppointmentsD2(t){this.endDate=I.toStandardHisFormat(t),await this.loadAppointments()},onViewModeChange(){this.viewMode==="today"&&(this.startDate=I.sessionDate(),this.endDate=I.sessionDate()),this.loadAppointments()},async openClientProfile(t){try{const e=await Ot("patients_records",{selector:{ID:t}});await at().setPatientRecord(e[0]),this.$router.push("patientProfile")}catch(e){console.error("Error opening profile:",e),ne("Failed to open patient profile")}},openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Bt.dismiss()}}}),Ki={class:"header position_content"},Qi={style:{"font-size":"1.2em","font-weight":"700"}},Yi={key:0,class:"date-filter"},Xi={class:"dueCardContent"},Zi={key:1,class:"no-appointments"};function tr(t,e,s,i,d,_){const r=u("ion-icon"),c=u("ion-header"),p=u("ion-label"),h=u("ion-segment-button"),v=u("ion-segment"),w=u("DateInputField"),C=u("ion-col"),y=u("ion-row"),b=u("DataTable"),D=u("ion-card-content"),N=u("ion-card"),P=u("ion-content"),V=u("ion-page");return l(),R(V,null,{default:o(()=>[a(c,null,{default:o(()=>[n("div",Ki,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=(...J)=>t.dismiss&&t.dismiss(...J))},[a(r,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Qi,g(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=J=>t.openPopover(J))},[a(r,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(P,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:o(()=>[a(v,{modelValue:t.viewMode,"onUpdate:modelValue":e[2]||(e[2]=J=>t.viewMode=J),onIonChange:t.onViewModeChange},{default:o(()=>[a(h,{value:"today"},{default:o(()=>[a(p,null,{default:o(()=>[...e[3]||(e[3]=[A("Today's Appointments",-1)])]),_:1})]),_:1}),a(h,{value:"range"},{default:o(()=>[a(p,null,{default:o(()=>[...e[4]||(e[4]=[A("Date Range",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","onIonChange"]),t.viewMode==="range"?(l(),f("div",Yi,[a(y,null,{default:o(()=>[a(C,null,{default:o(()=>[a(w,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:t.endDate,disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","maxDate","onUpdate:rawDateValue"])]),_:1}),a(C,null,{default:o(()=>[a(w,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):S("",!0),a(N,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:o(()=>[a(D,null,{default:o(()=>[n("div",Xi,[t.appointments.length>0?(l(),R(b,{key:0,data:t.appointments,columns:t.tableColumns,options:t.tableOptions,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns","options"])):(l(),f("div",Zi," No appointments found for the selected "+g(t.viewMode==="today"?"day":"date range"),1))])]),_:1})]),_:1})]),_:1})]),_:1})}const er=U(qi,[["render",tr],["__scopeId","data-v-e54f2168"]]),nr={class:"card-count"},ar={class:"card-label"},sr="#ffffff",or=x({__name:"DashboardCard",props:{icon:{},count:{},label:{},color:{}},emits:["cardClick"],setup(t,{emit:e}){const d={success:"#A5D6A7",info:"#81D4FA",warning:"#FFF59D",danger:"#EF9A9A"}[t.color||"info"]||"#E0E0E0";return(_,r)=>(l(),R(k(Vt),{class:"dashboard-card",style:Nt({borderColor:k(d),backgroundColor:sr}),onClick:r[0]||(r[0]=c=>_.$emit("cardClick"))},{default:o(()=>[a(k(j),{icon:t.icon,class:"card-icon"},null,8,["icon"]),n("div",nr,g(t.count),1),n("div",ar,g(t.label),1)]),_:1},8,["style"]))}}),ir=U(or,[["__scopeId","data-v-84ad3c1b"]]),rr=x({name:"OPDDashboard",components:{DashboardCard:ir},setup(){const{ready:t,OPDWaitingLists:e,hasWaitingList:s,refreshUserData:i}=Ne();return{ready:t,OPDWaitingLists:e,hasWaitingList:s,refreshUserData:i}},data(){return{totalPatientsToday:0}},computed:{...Z(jt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","patientsVisits","todaysAppointmentsCount"])},watch:{$route:{async handler(){await this.refreshDashboard()},deep:!0}},async mounted(){await this.refreshDashboard()},methods:{lockClosed(){return Cn},refresh(){return Dn},medkit(){return fe},flask(){return yn},async refreshDashboard(){const t=z.getUserLocationId();t&&await Promise.all([jt().refresh(t),this.refreshUserData()])},clipboard(){return pe},thermometer(){return me},calendar(){return bn},people(){return he},openAllModal(t,e,s){Pt(Ji,{class:"fullScreenModal"},!0,{title:t,buttonTitle:e,buttonLink:s})},openPatientsListModal(t,e,s,i){Pt(Ui,{class:"fullScreenModal"},!0,{title:t,list:e,buttonTitle:s,buttonLink:i})},openAppointmentsModal(t,e){Pt(er,{class:"fullScreenModal"},!0,{title:t,programType:e,programId:14})}}}),lr={class:"dashboard-wrapper"},dr={key:0,class:"loading-container"},cr={key:1,class:"no-access-container"};function ur(t,e,s,i,d,_){const r=u("ion-icon"),c=u("ion-card-title"),p=u("ion-card-header"),h=u("ion-spinner"),v=u("ion-button"),w=u("DashboardCard"),C=u("ion-row"),y=u("ion-grid"),b=u("ion-card-content"),D=u("ion-card"),N=u("ion-content");return l(),R(N,{fullscreen:!0},{default:o(()=>[n("div",lr,[a(D,{class:"dashboard-card"},{default:o(()=>[a(p,{class:"dashboard-card-header"},{default:o(()=>[a(c,{class:"dashboard-title"},{default:o(()=>[a(r,{icon:t.people(),slot:"start",class:"dashboard-icon"},null,8,["icon"]),e[6]||(e[6]=A(" Today's Patients Overview ",-1))]),_:1})]),_:1}),a(b,null,{default:o(()=>[t.ready?t.OPDWaitingLists.length===0?(l(),f("div",cr,[a(r,{icon:t.lockClosed(),class:"no-access-icon"},null,8,["icon"]),e[9]||(e[9]=n("h2",{class:"no-access-title"},"No Waiting Lists Assigned",-1)),e[10]||(e[10]=n("p",{class:"no-access-message"}," You currently don't have access to any waiting lists. Please contact your system administrator or supervisor to request access. ",-1)),a(v,{color:"primary",fill:"outline",onClick:t.refreshDashboard,class:"refresh-button"},{default:o(()=>[a(r,{icon:t.refresh(),slot:"start"},null,8,["icon"]),e[8]||(e[8]=A(" Refresh ",-1))]),_:1},8,["onClick"])])):(l(),R(y,{key:2,class:"centered-grid"},{default:o(()=>[a(C,{class:"centered-row"},{default:o(()=>{var P,V,J,M;return[t.hasWaitingList("Total Patients Today")?(l(),R(w,{key:0,icon:t.people(),color:"primary",count:t.patientsVisits.length,label:"Total patients today",onCardClick:e[0]||(e[0]=Q=>t.openAllModal("All patients today","View profile","/patientProfile"))},null,8,["icon","count"])):S("",!0),t.hasWaitingList("Appointments Today")?(l(),R(w,{key:1,icon:t.calendar(),color:"primary",count:((P=t.todaysAppointmentsCount)==null?void 0:P.length)||0,label:"Appointments",onCardClick:e[1]||(e[1]=Q=>t.openAppointmentsModal("OPD Appointments","14"))},null,8,["icon","count"])):S("",!0),t.hasWaitingList("Waiting for Vitals")?(l(),R(w,{key:2,icon:t.thermometer(),color:"primary",count:(V=t.patientsWaitingForVitals)==null?void 0:V.length,label:"Waiting for vitals",onCardClick:e[2]||(e[2]=Q=>t.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals"))},null,8,["icon","count"])):S("",!0),t.hasWaitingList("Waiting for Consultation")?(l(),R(w,{key:3,icon:t.clipboard(),color:"primary",count:(J=t.patientsWaitingForConsultation)==null?void 0:J.length,label:"Waiting for consultation",onCardClick:e[3]||(e[3]=Q=>t.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan"))},null,8,["icon","count"])):S("",!0),t.hasWaitingList("Waiting for Laboratory")?(l(),R(w,{key:4,icon:t.flask(),color:"primary",count:t.patientsWaitingForLab.length,label:"Waiting for lab",onCardClick:e[4]||(e[4]=Q=>t.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan"))},null,8,["icon","count"])):S("",!0),t.hasWaitingList("Waiting for Dispensation")?(l(),R(w,{key:5,icon:t.medkit(),color:"primary",count:(M=t.patientsWaitingForDispensation)==null?void 0:M.length,label:"Waiting for dispensation",onCardClick:e[5]||(e[5]=Q=>t.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations"))},null,8,["icon","count"])):S("",!0)]}),_:1})]),_:1})):(l(),f("div",dr,[a(h,{name:"crescent"}),e[7]||(e[7]=n("p",{class:"loading-text"},"Loading dashboard...",-1))]))]),_:1})]),_:1})])]),_:1})}const pr=U(rr,[["render",ur],["__scopeId","data-v-58f418ae"]]),mr={class:"icon-container"},hr=["src","alt"],gr={class:"card-title"},fr=x({__name:"DashboardCard",props:{icon:{},title:{}},emits:["click"],setup(t,{emit:e}){const s=t,i=e,d=q(()=>Et[s.icon]||"");return(_,r)=>(l(),f("div",{class:"card",onClick:r[0]||(r[0]=c=>i("click"))},[n("div",mr,[n("img",{src:d.value,alt:t.title},null,8,hr)]),n("div",gr,g(t.title),1)]))}}),_r=U(fr,[["__scopeId","data-v-334cd0db"]]),vr={class:"dashboard-container"},br={class:"dashboard-grid"},yr=x({__name:"AETCDashboard",setup(t){L("");const e=Rt(),s=L([{id:"patientArrival",icon:"plus_dashboard",title:"Patient Arrival"},{id:"screeningList",icon:"checklist",title:"Awaiting Screening List"},{id:"registrationList",icon:"checklist",title:"Awaiting Registration List"},{id:"triageList",icon:"checklist",title:"Awaiting Triage List"},{id:"assessmentList",icon:"checklist",title:"Awaiting Assessment List"},{id:"testResultsList",icon:"checklist",title:"Awaiting Test Results List"},{id:"specialtyList",icon:"checklist",title:"Awaiting Specialty List"},{id:"dispositionList",icon:"checklist",title:"Disposition List"},{id:"broughtDead",icon:"document",title:"Brought In Dead"},{id:"reports",icon:"chart",title:"Reports"}]),i=d=>{e.push({name:d})};return(d,_)=>(l(),R(k(Ct),null,{default:o(()=>[a(k(st),{fullscreen:!0},{default:o(()=>[n("div",vr,[n("div",br,[(l(!0),f(E,null,G(s.value,r=>(l(),R(_r,{key:r.id,icon:r.icon,title:r.title,onClick:c=>i(r.id)},null,8,["icon","title","onClick"]))),128))])])]),_:1})]),_:1}))}}),Dr=U(yr,[["__scopeId","data-v-bcce1a76"]]),Cr=x({name:"NCDDashboard",mixins:[It],components:{ApexChart:Yt},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await ve(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return z.getJson("programs/32/reports/ncd_dashboard",{start_date:I.toStandardHisFormat(I.sessionDate()),end_date:I.toStandardHisFormat(I.sessionDate())})}}}),$r={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},wr={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},kr={ref:"chartRef1"},Sr={ref:"chartRef2"};function Ir(t,e,s,i,d,_){const r=u("ion-card-content"),c=u("ion-card"),p=u("ApexChart");return l(),f(E,null,[n("div",$r,[a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[...e[0]||(e[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[...e[1]||(e[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[...e[2]||(e[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[...e[3]||(e[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])]),_:1})]),_:1})]),n("div",wr,[a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[e[4]||(e[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",kr,[t.isChartReady?(l(),R(p,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(r,null,{default:o(()=>[e[5]||(e[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",Sr,[t.isChartReady?(l(),R(p,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1})]),_:1})])],64)}const Ar=U(Cr,[["render",Ir],["__scopeId","data-v-58e2a3d8"]]),Pr=x({name:"Home",mixins:[Ie,It],components:{IonContent:st,IonHeader:it,IonPage:Ct,IonToolbar:ct,Toolbar:Pe,IonRow:Mt,DateInputField:Xt,IonIcon:j,IonButton:Tt,IonCol:Lt},data(){const t=L(I.sessionDate()),e=L(I.sessionDate()),s=L(I.sessionDate()),i=L([]);return{segmentContent:"Today",minDate:s,startDate:t,endDate:e,people:i,calendarOutline:gt,eyeOutline:$e}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(t){this.segmentContent=t},formatBirthdate(t){return I.getBirthdateAge(t)},async getAppointments(){this.people=[],(await Te.getAppointments(this.startDate,this.endDate,"")).forEach(e=>{const s={person_id:e.person_id,npid:e.npid,appointment_id:103,encounter_id:e.encounter_id,name:e.given_name.concat(" ",e.family_name),gender:e.gender,ageDob:this.formatBirthdate(e.birthdate),village:e.city_village,appointmentDate:I.toStandardHisDisplayFormat(e.appointment_date)};this.people.push(s)})},async getAppointmentsD1(t){this.startDate=I.toStandardHisFormat(t),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=I.toStandardHisFormat(t),await this.getAppointments()},async openClientProfile(t){await ft.findByNpid(t),this.isPharmacist()},isPharmacist(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(s=>e.some(i=>i.role==="Pharmacist"))&&(this.$router.push("dispensation"),z.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),Tr={class:"appointments-container"},Nr={key:0,class:"date-filter"},Or={class:"appointments-table"};function Rr(t,e,s,i,d,_){const r=u("ion-label"),c=u("ion-segment-button"),p=u("ion-segment"),h=u("DateInputField"),v=u("ion-col"),w=u("ion-row"),C=u("ion-icon"),y=u("ion-button"),b=u("ion-card");return l(),f("div",Tr,[n("div",null,[a(p,{value:t.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:o(()=>[a(c,{value:"Today",onClick:e[0]||(e[0]=D=>t.setSegmentContent("Today"))},{default:o(()=>[a(r,null,{default:o(()=>[...e[3]||(e[3]=[A("Today",-1)])]),_:1})]),_:1}),a(c,{value:"Tomorrow",onClick:e[1]||(e[1]=D=>t.setSegmentContent("Tomorrow"))},{default:o(()=>[a(r,null,{default:o(()=>[...e[4]||(e[4]=[A("Tomorrow",-1)])]),_:1})]),_:1}),a(c,{value:"Date range",onClick:e[2]||(e[2]=D=>t.setSegmentContent("Date range"))},{default:o(()=>[a(r,null,{default:o(()=>[...e[5]||(e[5]=[A("Date range",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),t.segmentContent==="Date range"?(l(),f("div",Nr,[a(w,null,{default:o(()=>[a(v,null,{default:o(()=>[a(h,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(v,null,{default:o(()=>[a(h,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):S("",!0),t.people.length>0?(l(),R(b,{key:1},{default:o(()=>[n("table",Or,[e[6]||(e[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(l(!0),f(E,null,G(t.people,D=>(l(),f("tr",{key:D.npid},[n("td",null,[a(w,null,{default:o(()=>[a(v,null,{default:o(()=>[A(g(D.name),1)]),_:2},1024),a(v,null,{default:o(()=>[a(y,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:N=>t.openClientProfile(D.npid),color:"primary",fill:"clear",size:"small"},{default:o(()=>[a(C,{icon:t.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,g(D.npid),1),n("td",null,g(D.ageDob),1),n("td",null,g(D.gender),1),n("td",null,g(D.village),1),n("td",null,g(D.appointmentDate),1)]))),128))])])]),_:1})):(l(),R(b,{key:2},{default:o(()=>[...e[7]||(e[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])]),_:1}))])}const Vr=U(Pr,[["render",Rr],["__scopeId","data-v-c47f7768"]]),Lr=x({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){}}}),Mr={key:0},Br={style:{display:"flex","margin-top":"10px"}},Fr={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},Er={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},xr={key:1};function Hr(t,e,s,i,d,_){const r=u("ion-label"),c=u("ion-segment-button"),p=u("ion-segment"),h=u("VisitsHistory");return l(),f(E,null,[n("div",null,[a(p,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:o(()=>[a(c,{value:"Internal referrals",onClick:e[0]||(e[0]=v=>t.setSegmentContent("Internal referrals"))},{default:o(()=>[a(r,null,{default:o(()=>[...e[2]||(e[2]=[A("Internal referrals",-1)])]),_:1})]),_:1}),a(c,{value:"External referrals",onClick:e[1]||(e[1]=v=>t.setSegmentContent("External referrals"))},{default:o(()=>[a(r,null,{default:o(()=>[...e[3]||(e[3]=[A("External referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(l(),f("div",Mr,[n("div",Br,[t.checkUnderFive?(l(),f("div",Fr)):S("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?S("",!0):(l(),f("div",Er))])])):S("",!0),t.segmentContent=="External referrals"?(l(),f("div",xr,[a(h)])):S("",!0)],64)}const Ur=U(Lr,[["render",Hr],["__scopeId","data-v-faad8f8b"]]),Wr=x({name:"Menu",components:{IonContent:st,IonHeader:it,IonItem:pt,IonList:ut,IonMenu:wt,IonTitle:$t,IonToolbar:ct,IonCheckbox:Ft,IonIcon:j,BasicForm:St,BasicCard:xt,Referrals:Ur,Dashboard:Ar,ANCAppointments:Vr},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:Ce},{id:"referrals",label:"Referrals",icon:Kt},{id:"appointments",label:"Appointments",icon:gt}],activeItem:"dashboard"}},computed:{...Z(kt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),zr={style:{display:"flex"}},jr={class:"left_col"},Gr={class:"nav-menu"},Jr=["onClick"],qr={class:"right_col"};function Kr(t,e,s,i,d,_){const r=u("ion-icon"),c=u("Dashboard"),p=u("ANCAppointments"),h=u("Referrals");return l(),f("div",zr,[n("div",jr,[n("nav",Gr,[n("ul",null,[(l(!0),f(E,null,G(t.menuItems,v=>(l(),f("li",{key:v.id,class:nt({active:t.activeItem===v.id}),onClick:w=>t.setActiveItem(v.id)},[a(r,{icon:v.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,g(v.label),1)],10,Jr))),128))])])]),n("div",qr,[n("div",null,[t.activeItem==="dashboard"?(l(),R(c,{key:0})):S("",!0),t.activeItem==="appointments"?(l(),R(p,{key:1})):S("",!0),t.activeItem==="referrals"?(l(),R(h,{key:2})):S("",!0)])])])}const Qr=U(Wr,[["render",Kr],["__scopeId","data-v-7e786ea4"]]),Yr=x({name:"Menu",components:{IonContent:st,IonHeader:it,IonItem:pt,IonList:ut,IonMenu:wt,IonTitle:$t,IonToolbar:ct,IonCheckbox:Ft,BasicForm:St,BasicCard:xt},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Z(kt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Xr={class:"left_col"},Zr={class:"nav-menu"},tl=["onClick"];function el(t,e,s,i,d,_){return l(),f("div",null,[n("div",Xr,[n("nav",Zr,[n("ul",null,[(l(!0),f(E,null,G(t.menuItems,r=>(l(),f("li",{key:r.id,class:nt({active:t.activeItem===r.id}),onClick:c=>t.setActiveItem(r.id)},g(r.label),11,tl))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const nl=U(Yr,[["render",el],["__scopeId","data-v-32dd02d3"]]),al=x({name:"Menu",components:{IonContent:st,IonHeader:it,IonItem:pt,IonList:ut,IonMenu:wt,IonTitle:$t,IonToolbar:ct,IonCheckbox:Ft,BasicForm:St,BasicCard:xt},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Z(kt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),sl={class:"left_col"},ol={class:"nav-menu"},il=["onClick"];function rl(t,e,s,i,d,_){return l(),f("div",null,[n("div",sl,[n("nav",ol,[n("ul",null,[(l(!0),f(E,null,G(t.menuItems,r=>(l(),f("li",{key:r.id,class:nt({active:t.activeItem===r.id}),onClick:c=>t.setActiveItem(r.id)},g(r.label),11,il))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const ll=U(al,[["render",rl],["__scopeId","data-v-b49d8600"]]);function dl(){const t=ke(),e=L(""),s=L(!1),i=L({}),d=()=>{const _=z.getUserRoles(),r=z.getProgramID(),c=z.getProgramName();e.value=_,s.value=!1,_==="Lab"&&r===14?i.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:r===14&&_!=="Lab"?i.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:r===12?i.value={url:"contact",btnName:"Back"}:c==="LABOUR AND DELIVERY PROGRAM"?i.value={url:"labour/labourHome",btnName:"Back to home"}:c==="PNC PROGRAM"?i.value={url:"pnc/home",btnName:"Back to home"}:i.value={url:"",btnName:""},s.value=!0};return ht(()=>t.path,()=>{d()},{immediate:!0,deep:!0}),{userRole:e,ready:s,userRoleSettings:i,updateUserRoleSettings:d}}const cl={key:0,class:"spinner-overlay"},Ml=x({__name:"HomePage",setup(t){const e=L(!0),s=ke(),i=Bn(),d=L(localStorage.getItem("sessionDate")||"");dl();const _=Se(),{apiStatus:r}=zt(Ae()),{activeProgram:c}=zt(_),p=q(()=>{switch(c.value.program_id){case X.IMMUNIZATION_PROGRAM:return Bi;case X.OPD_PROGRAM:return pr;case X.NCD_PROGRAM:return zs;case X.AETC_PROGRAM:return Dr;case X.HTS_PROGRAM:return Do;case X.ANC_PROGRAM:return Qr;case X.PNC_PROGRAM:return ll;case X.LABOUR_AND_DELIVERY_PROGRAM:return nl;case X.HIV_PROGRAM:return Zo;case X.NEONATAL_PROGRAM:return ie;case X.HTC_PROGRAM:return ie;default:return null}}),h=()=>{const C=localStorage.getItem("sessionDate");(!C||C.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),oe()),d.value=C||""};let v=null;dt(()=>{v=()=>h(),window.addEventListener("storage",v);const C=setInterval(h,1e3);$n(()=>{clearInterval(C),v&&window.removeEventListener("storage",v)}),h()}),ht(d,(C,y)=>{(!C||C.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),oe())}),ht(()=>s.name,async C=>{C==="Home"&&(ae(),await se().loadGlobalProperty(),i.postData({command:"ping"}))},{immediate:!0,deep:!0});const w=async()=>{try{const C=z.getUserID(),y=await En.getUserByID(C);if(y.location_id!=null){const b=await xn.getLocation(y.location_id);localStorage.setItem("locationData",JSON.stringify(b))}}catch(C){console.error("Failed to retrieve location data:",C)}};return r.value&&(Ne(),w()),dt(async()=>{try{e.value=!0,ae(),await se().loadGlobalProperty(),bt.isEmpty(c.value)&&await Fn.show(Un,{},"module-picker-modal")}catch(C){console.error("Error initializing component:",C)}finally{e.value=!1}}),(C,y)=>{const b=u("ion-spinner"),D=u("ion-content");return l(),R(k(Ct),null,{default:o(()=>[e.value?(l(),f("div",cl,[a(b,{name:"bubbles"}),y[0]||(y[0]=n("div",{class:"loading-text"},"Please wait...",-1))])):S("",!0),a(Pe),a(Wn),p.value?(l(),R(wn(p.value),{key:1})):(l(),R(D,{key:2},{default:o(()=>[...y[1]||(y[1]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])]),_:1}))]),_:1})}}});export{Ml as default};

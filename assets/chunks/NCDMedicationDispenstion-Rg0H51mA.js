var Ne=Object.defineProperty;var Ve=(l,a,i)=>a in l?Ne(l,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[a]=i;var J=(l,a,i)=>Ve(l,typeof a!="symbol"?a+"":a,i);import{d as ve,L as x,N as S,a6 as q,a5 as z,E as $e,a7 as _e,M as Z,I as Ae,a4 as De,aT as Be,ce as W,R as Fe,H as P,e as D,f as m,l as r,J as c,k as t,K as d,Q as y,F as I,b2 as E,ap as qe,cp as ze,r as O,c as Ee,b as Re,w as ie,a as He,O as de,u as n,ay as G,P as A,br as ue,aV as ce,m as T,b3 as pe,p as ge,eJ as fe,c6 as me,aS as Ue,aR as je}from"./vendor-BuyqdZ53.js";import{E as Le}from"./EIRreportsStore-Co6EtPhe.js";import{N as Je}from"./NavigationMenu-CMFlucv-.js";import{V as Ge}from"./ViewToggleComponent-WD4K9AZU.js";import{l as Qe,_ as he,b2 as Q,P as Ke,S as R,u as be,aR as ke,G as Ze,bZ as We,bF as ye,d as Xe,q as Ye,aF as et,n as tt,s as K,m as st,b_ as nt,o as rt}from"../index-B37K5cbI.js";import{a as we}from"./drug_prescription_service-B3fyOXQd.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-BQpaTz5X.js";const ot=ve({name:"MedicationDetailsModal",components:{IonContent:De,IonHeader:Ae,IonFooter:Z,IonPage:_e,IonTitle:$e,IonRow:z,IonCol:q,IonButton:S,IonIcon:x},props:{selectedMedication:{type:Object,default:null}},data(){return{iconsContent:Qe,medkit:W,closeIcon:Be,dismiss:()=>(this.$emit("close"),Fe.dismiss())}},methods:{formatFullDate(l){return l?new Date(l).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"N/A"},getFrequencyLabel(l){const a=we.find(i=>i.code===l);return a?a.label:"Unknown"}}}),at={class:"medication-details-header"},lt={class:"modal_wrapper"},it={class:"medication-details-modal"},dt={class:"text-xl font-bold mb-4"},ut={class:"grid grid-cols-2 gap-3"};function ct(l,a,i,f,h,M){const g=P("ion-icon"),b=P("ion-title"),k=P("ion-header"),N=P("ion-content"),H=P("ion-button"),C=P("ion-col"),B=P("ion-row"),F=P("ion-footer");return m(),D(I,null,[r(k,{style:{display:"flex","justify-content":"space-between"}},{default:c(()=>[r(b,{class:"modalTitle"},{default:c(()=>[t("div",at,[r(g,{icon:l.medkit,class:"ion-margin-end"},null,8,["icon"]),a[1]||(a[1]=t("span",null,"Medication Details",-1))])]),_:1}),r(g,{onClick:a[0]||(a[0]=V=>l.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:l.iconsContent.cancel},null,8,["icon"])]),_:1}),r(N,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:c(()=>[t("div",lt,[t("div",it,[t("h2",dt,d(l.selectedMedication.drug.name),1),t("div",ut,[t("div",null,[a[2]||(a[2]=t("strong",null,"Order ID:",-1)),y(" "+d(l.selectedMedication.order_id),1)]),t("div",null,[a[3]||(a[3]=t("strong",null,"Drug ID:",-1)),y(" "+d(l.selectedMedication.drug_inventory_id),1)]),t("div",null,[a[4]||(a[4]=t("strong",null,"Dose:",-1)),y(" "+d(l.selectedMedication.dose)+" "+d(l.selectedMedication.units),1)]),t("div",null,[a[5]||(a[5]=t("strong",null,"Equivalent Daily Dose:",-1)),y(" "+d(l.selectedMedication.equivalent_daily_dose),1)]),t("div",null,[a[6]||(a[6]=t("strong",null,"Frequency:",-1)),y(" "+d(l.getFrequencyLabel(l.selectedMedication.frequency)),1)]),t("div",null,[a[7]||(a[7]=t("strong",null,"Order Type:",-1)),y(" "+d(l.selectedMedication.order.order_type_id),1)]),t("div",null,[a[8]||(a[8]=t("strong",null,"Start Date:",-1)),y(" "+d(l.formatFullDate(l.selectedMedication.order.start_date)),1)]),t("div",null,[a[9]||(a[9]=t("strong",null,"Date Created:",-1)),y(" "+d(l.formatFullDate(l.selectedMedication.order.date_created)),1)]),t("div",null,[a[10]||(a[10]=t("strong",null,"Orderer:",-1)),y(" "+d(l.selectedMedication.order.orderer),1)]),t("div",null,[a[11]||(a[11]=t("strong",null,"Instructions:",-1)),y(" "+d(l.selectedMedication.order.instructions),1)])])])])]),_:1}),r(F,{collapse:"fade",class:"ion-no-border"},{default:c(()=>[r(B,null,{default:c(()=>[r(C,null,{default:c(()=>[r(H,{onClick:l.dismiss,color:"primary",style:{float:"right","margin-bottom":"20px","margin-right":"20px"}},{default:c(()=>[r(g,{icon:l.closeIcon,slot:"start"},null,8,["icon"]),a[12]||(a[12]=y(" Close ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})],64)}const pt=he(ot,[["render",ct],["__scopeId","data-v-01db984e"]]);class gt extends Q{constructor(i=null,f=null){const h=new Ke,M=i!==null?i:h.getID(),g=f!==null?f:R.getUserID();super(M,32,g);J(this,"drugHistory");J(this,"currentDrugOrder");this.drugHistory=[],this.currentDrugOrder=[]}getDrugHistory(){return this.drugHistory}getCurrentOrder(){return this.currentDrugOrder}getDispensationArryObj(i){return[{drug_order_id:i.order_id,date:this.date,quantity:i.amountToDispense,offline_id:i.offline_id,provider_id:this.providerID,program_id:i.program_id,patient_id:this.patientID}]}saveDispensations(i,f){return Q.postJson("/dispensations",{dispensations:i,provider_id:this.providerID,program_id:f})}generateOfflineDispensatiobObject(i,f){return{dispensations:i,provider_id:this.providerID,program_id:f,patient_id:this.patientID}}async saveDispensationsOffline(i){var f,h,M;try{const g=be(),{patient:b}=E(g),k=JSON.parse(JSON.stringify(b.value));i.length>0&&((M=(h=(f=k.dispensations)!=null?f:k.dispensations={}).unsaved)!=null||(h.unsaved=[]),k.dispensations.unsaved.length>=0&&k.dispensations.unsaved.push(...i)),await ke(k),Ze("Dispensations saved offline successfully")}catch(g){We("Error saving dispensations offline"+g)}}async voidOrder(i){return Q.void("/dispensations/".concat(i),{})}async loadDrugHistory(){const i=await ye.getDrugOrderHistory(this.patientID);i&&(this.drugHistory=i)}async loadCurrentDrugOrder(){const i=await ye.getDrugOrders(this.patientID);i&&(this.currentDrugOrder=await Promise.all(i))}calcCompletePack(i,f){const h=i.barcodes.sort(function(b,k){return b.tabs-k.tabs});if(h.length==0||f==0)return f;for(let b=0;b<=h.length-1;b++)if(parseInt(h[b].tabs)>=f)return h[b].tabs;const M=parseInt(h[0].tabs);let g=parseInt(h[h.length-1].tabs);for(;g<f;)g+=M;return g}}const ft={key:0,style:{margin:"20px"},class:"flex flex-col items-center justify-center p-8"},mt={key:1,class:"p-4",style:{"margin-left":"10px","margin-right":"10px"}},yt={class:"text-xl font-bold mb-4 program-name"},vt={class:"overflow-x-auto"},_t={class:"w-full"},Dt={class:"p-3"},ht={class:"p-3"},bt={class:"flex items-center"},kt={class:"p-3"},wt={class:"p-3"},xt={class:"p-3"},Ct={class:"flex items-center space-x-2"},It={key:0,class:"error-text text-sm"},Mt={class:"p-3"},Pt={class:"flex space-x-2"},Ot={key:0,class:"text-center py-8"},St={key:2,class:"p-4",style:{"margin-left":"10px","margin-right":"10px"}},Tt={class:"text-xl font-bold mb-4 program-name"},Nt={class:"text-lg font-bold mb-2",style:{"margin-left":"10px","margin-right":"10px"}},Vt={class:"text-md font-medium",style:{"margin-left":"10px","margin-right":"10px"}},$t={class:"medication-details"},At={class:"flex justify-between mb-3"},Bt={class:"flex items-center"},Ft={class:"flex items-center mb-3"},qt={key:0,class:"error-text"},zt={class:"mt-3 flex space-x-2",style:{"margin-top":"10px"}},Et={key:0,class:"text-center mb-8"},Rt=ve({__name:"NCDMedicationDispenstion",setup(l){const a=Le(),i=be(),f=Xe(),h=Ye(),{navigationPayload:M}=E(a),{patient:g}=E(i),{NCDMedicatioTogglePreference:b}=E(f),k=qe(),N=ze(),H=O(null),C=O({}),B=O([]),F=O(null);O(""),O(!1);const V=O(!1),$=O({});Ee(()=>B.value.reduce((e,s)=>{const u=s.order.date_created.split("T")[0];return e[u]||(e[u]=[]),e[u].push(s),e},{}));const U=async()=>{oe(),B.value=[],Pe(),V.value=!1,await ee()},xe=async()=>{try{return await nt()?await X():await Ce()}catch(e){return console.error("Error fetching programs:",e),await X()}},X=async()=>await R.getJson("/programs",{page_size:1e3}),Ce=async()=>{try{return await rt("programs")}catch(e){throw console.error("Error fetching offline districts:",e.message),e}},Ie=async()=>{await new et().printData("visit")},Y=async e=>{await Me(e),await k.push("/home")},Me=async e=>{try{await tt(e),await h.refresh(R.getUserLocationId())}catch(s){console.error(s)}},Pe=()=>{a.setNavigationPayload("Dispense Medication",!0,!1,"/","home")},ee=async()=>{var v,o,_,p,w,le;const e=(_=(o=(v=g.value)==null?void 0:v.MedicationOrder)==null?void 0:o.saved)!=null?_:[],s=(le=(w=(p=g.value)==null?void 0:p.MedicationOrder)==null?void 0:w.unsaved)!=null?le:[],u=[...e,...s];await Oe(u)},Oe=async e=>{const s=await xe(),u={};s.forEach(o=>{u[o.program_id]=o.name}),C.value={},e.forEach(o=>{const _=u[o.program_id];if(_&&(C.value[_]||(C.value[_]=[]),!o.quantity)){const p=j(o);if($.value[p]){o.amountToDispense=$.value[p];const w=parseFloat(o.amountToDispense);isNaN(w)||w<=0?o.error="Please enter a valid amount greater than 0.":o.error=null}C.value[_].push(o)}}),e.every(o=>o.quantity)&&R.getProgramID()==14&&Y(g.value)},te=e=>{const s=we.find(u=>u.code===e);return s?s.label:"Unknown"},j=e=>(e==null?void 0:e.order_id)||(e==null?void 0:e.offline_id)||"".concat(e.drug_name,"_").concat(e.start_date),L=e=>{const s=parseFloat(e.amountToDispense),u=j(e);$.value[u]=e.amountToDispense,isNaN(s)||s<=0?e.error="Please enter a valid amount greater than 0.":e.error=null},Ht=e=>{e.amountToDispense=e.dose,L(e)},se=async e=>{V.value=!0;try{if(e.error){K("Fix errors before dispensing.");return}e.quantity=e.amountToDispense;const u=new gt().getDispensationArryObj(e);e.dispensation=u,e.dispensed=!0,await ke(g.value);const v=j(e);delete $.value[v],await ee()}catch(s){K("Dispensing failed. Please try again."),K("Error: "+s),console.error(s)}finally{V.value=!1}},ne=async e=>{F.value=e,await st(pt,{class:"large-modal"},!0,{selectedMedication:F.value})},re=e=>new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),Se=e=>{oe(e,!0)},oe=(e="list",s=!1)=>{const u={toggle_view:e};Object.keys(b.value).length===0&&(u.toggle_view="list",f.setNCDMedicatioTogglePreference(u)),Object.keys(b.value).length>0&&s===!0&&f.setNCDMedicatioTogglePreference(u)},Te=e=>(console.log("Grouping medications by date:",e),e.reduce((s,u)=>{const v=u.start_date.split("T")[0];return s[v]||(s[v]=[]),s[v].push(u),s},{})),ae=()=>{$.value={}};return Re(()=>{ae()}),ie(g,async()=>{V.value||N.name==="NCDDispensations"&&await U()},{deep:!0}),ie(N,(e,s)=>{(s==null?void 0:s.name)==="NCDDispensations"&&e.name!=="NCDDispensations"&&ae(),e.name==="NCDDispensations"&&U()},{immediate:!0}),He(()=>{U()}),(e,s)=>(m(),de(n(_e),null,{default:c(()=>[r(Je,{ref_key:"navMenuRef",ref:H},null,512),r(Ge,{"initial-view":n(b).toggle_view,onViewChanged:Se},null,8,["initial-view"]),r(n(De),null,{default:c(()=>[Object.keys(C.value).length===0?(m(),D("div",ft,[r(n(x),{icon:n(G),size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),s[2]||(s[2]=t("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Medications to Dispense",-1)),s[3]||(s[3]=t("p",{class:"text-gray-600"},"There are currently no medications waiting to be dispensed for current Client.",-1))])):n(b).toggle_view==="list"?(m(),D("div",mt,[(m(!0),D(I,null,A(C.value,(u,v)=>(m(),D(I,{key:v},[t("h2",yt,d(v),1),r(n(ue),{class:"mb-6"},{default:c(()=>[r(n(ce),null,{default:c(()=>[t("div",vt,[t("table",_t,[s[6]||(s[6]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"p-3 text-left"},"Date"),t("th",{class:"p-3 text-left"},"Medication"),t("th",{class:"p-3 text-left"},"Dose"),t("th",{class:"p-3 text-left"},"Frequency"),t("th",{class:"p-3 text-left"},"Amount to Dispense"),t("th",{class:"p-3 text-left"},"Actions")])],-1)),t("tbody",null,[(m(!0),D(I,null,A(u,o=>(m(),D("tr",{key:(o==null?void 0:o.order_id)||(o==null?void 0:o.offline_id),class:"border-b hover:bg-gray-50"},[t("td",Dt,d(re(o.start_date)),1),t("td",ht,[t("div",bt,[r(n(x),{icon:n(W),class:"mr-2"},null,8,["icon"]),y(" "+d(o.drug_name),1)])]),t("td",kt,d(o.dose)+" "+d(o.units),1),t("td",wt,d(te(o.frequency)),1),t("td",xt,[t("div",Ct,[r(n(pe),{type:"number",placeholder:"Amount",modelValue:o.amountToDispense,"onUpdate:modelValue":_=>o.amountToDispense=_,onInput:_=>L(o),class:ge(["w-24 dose-input bordered-input",o.error?"input-error":""])},null,8,["modelValue","onUpdate:modelValue","onInput","class"]),T("",!0)]),o.error?(m(),D("div",It,d(o.error),1)):T("",!0)]),t("td",Mt,[t("div",Pt,[r(n(S),{color:"primary",size:"small",onClick:_=>se(o),disabled:!o.amountToDispense||parseFloat(o.amountToDispense)<=0||o.dispensed},{default:c(()=>[r(n(x),{icon:n(fe),class:"mr-1",style:{"margin-right":"5px"}},null,8,["icon"]),y(" "+d(o.dispensed?"Dispensed":"Dispense"),1)]),_:2},1032,["onClick","disabled"]),r(n(S),{color:"secondary",size:"small",onClick:_=>ne(o),style:{"margin-left":"10px"}},{default:c(()=>[r(n(x),{icon:n(me),class:"mr-1",style:{"margin-right":"5px"}},null,8,["icon"]),s[5]||(s[5]=y(" Details ",-1))]),_:1},8,["onClick"])])])]))),128))])]),u.length===0?(m(),D("div",Ot,[r(n(x),{icon:n(G),size:"large",class:"mb-2"},null,8,["icon"]),t("p",null,"No medications prescribed for "+d(v),1)])):T("",!0)])]),_:2},1024)]),_:2},1024)],64))),128))])):(m(),D("div",St,[(m(!0),D(I,null,A(C.value,(u,v)=>(m(),D(I,{key:v},[t("h2",Tt,d(v),1),(m(!0),D(I,null,A(Te(u),(o,_)=>(m(),D(I,{key:_},[t("h3",Nt,d(re(_)),1),r(n(z),null,{default:c(()=>[r(n(q),{size:"12","size-md":"6","size-lg":"4"},{default:c(()=>[t("h3",Vt,d(_),1)]),_:2},1024)]),_:2},1024),r(n(z),null,{default:c(()=>[(m(!0),D(I,null,A(o,p=>(m(),de(n(q),{style:{"margin-left":"10px","margin-right":"10px"},key:p.order_id,size:"12","size-md":"6","size-lg":"4"},{default:c(()=>[r(n(ue),{class:"mb-4"},{default:c(()=>[r(n(Ue),null,{default:c(()=>[r(n(je),{class:"medication-details-header"},{default:c(()=>[r(n(x),{icon:n(W),class:"ion-margin-end"},null,8,["icon"]),t("span",null,d(p.drug_name),1)]),_:2},1024)]),_:2},1024),r(n(ce),null,{default:c(()=>[t("div",$t,[t("div",At,[t("span",Bt,d(te(p.frequency))+" ("+d(p.frequency)+") ",1)]),t("div",Ft,[r(n(pe),{type:"number",placeholder:"Amount",modelValue:p.amountToDispense,"onUpdate:modelValue":w=>p.amountToDispense=w,onInput:w=>L(p),class:ge(["w-24 dose-input bordered-input",p.error?"input-error":""])},null,8,["modelValue","onUpdate:modelValue","onInput","class"]),T("",!0)]),p.error?(m(),D("div",qt,d(p.error),1)):T("",!0),t("div",zt,[r(n(S),{color:"primary",onClick:w=>se(p),disabled:!p.amountToDispense||parseFloat(p.amountToDispense)<=0||p.dispensed},{default:c(()=>[r(n(x),{icon:n(fe),class:"mr-2",style:{"margin-right":"5px"}},null,8,["icon"]),y(" "+d(p.dispensed?"Dispensed":"Dispense"),1)]),_:2},1032,["onClick","disabled"]),r(n(S),{color:"secondary",style:{"margin-left":"20px"},onClick:w=>ne(p)},{default:c(()=>[r(n(x),{icon:n(me),class:"mr-2",style:{"margin-right":"5px"}},null,8,["icon"]),s[8]||(s[8]=y(" Details ",-1))]),_:1},8,["onClick"])])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)],64))),128)),u.length===0?(m(),D("div",Et,[r(n(x),{icon:n(G),size:"large",class:"mb-2"},null,8,["icon"]),t("p",null,"No medications prescribed for "+d(v),1)])):T("",!0)],64))),128))]))]),_:1}),r(n(Z),{collapse:"fade",class:"ion-no-border"},{default:c(()=>[r(n(z),null,{default:c(()=>[r(n(q),null,{default:c(()=>[r(n(S),{id:"cbtn",class:"",color:"primary",fill:"solid",style:{float:"right","margin-left":"50px"},onClick:s[0]||(s[0]=u=>Ie())},{default:c(()=>[...s[9]||(s[9]=[y(" Print Visit Summary ",-1)])]),_:1}),r(n(S),{id:"cbtn",class:"",color:"danger",fill:"solid",style:{float:"right","margin-left":"50px"},onClick:s[1]||(s[1]=u=>Y(n(g)))},{default:c(()=>[...s[10]||(s[10]=[y(" Close visit ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),r(n(Z))]),_:1}))}}),Xt=he(Rt,[["__scopeId","data-v-db12c7e5"]]);export{Xt as default};

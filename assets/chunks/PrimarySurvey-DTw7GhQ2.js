import{d as Se,ap as De,cr as Ae,r as v,c as ye,b2 as d,w as c,a as we,O as H,f as W,J as N,l as g,u as _,a4 as _e,k as p,m as Ce,i as D,bT as xe,v as A,a7 as Be,ba as S}from"./vendor-BataJFSH.js";import{b7 as U,u as Te,b8 as ke,b9 as Pe,a_ as Re,ba as Ie,e as Ne,a$ as $e,i as Ve,a1 as Ee,f as Fe,T as Me,M as ze,V as Le,H as $,b1 as C,bb as He,aU as j,bc as We,t as G,ah as x,K as Ue,bd as je,a3 as Ge,S as Je}from"../index-CYcjB3lE.js";import{D as Ke}from"./DemographicBar-BmFdNEyR.js";import{u as qe,_ as Qe}from"./useFormWizard-WA0BdVFf.js";import{u as V}from"./ComplicationsStore-BbalwQUK.js";import{s as Xe,c as Ye,u as Ze}from"./nonPharmaTherapyStore-BeLj4Wxw.js";import{l as Oe}from"./lodash-NJiRuGo9.js";import{a as J,b as et}from"./formatServerData-CrPFhp8u.js";import{u as tt}from"./usePatientProfile-BH-LjvQ2.js";import{_ as st,B as at,a as nt,b as it,c as ot}from"./ExposureAssessment.vue_vue_type_script_setup_true_lang-Bweku3SU.js";import"./apexcharts-BVd6_RNM.js";import"./drug_prescription_service-CAmeZFJa.js";import"./patient_diagnosis_service-Dw0KiIvk.js";import"./Registration-DEByNCkM.js";import"./useLocation-Bl6i7Nj8.js";import"./vaccines_service-jL4y0Qg3.js";import"./sms_service-CfLPAmD3.js";import"./EIRreportsStore-DPBsJTJR.js";import"./Export-kNnnCNnD.js";import"./user_role_management-BpRRS3k4.js";import"./useNeonatalEnrollmentStore-eD5cG8pe.js";import"./enrollment-DU-PLRUa.js";import"./Outcome-T6JLQrwS.js";import"./wardsStore-CIkFtO0D.js";import"./DisplaySelectedBodyParts.vue_vue_type_script_setup_true_lang-BepEJLcU.js";import"./ReusableDataTable-DjWZNA84.js";const rt={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},lt={class:"back_profile"},Ft=Se({__name:"PrimarySurvey",setup(ct,{expose:K}){const{onTabBeforeChange:q,currentTabIndex:u}=qe();tt();const B=De(),Q=Ae();v([]),v([]),v(!1);const T=v(!0),k=v(!1),f=v(!1),E=ye(()=>({text:f.value?"Saving...":"Finish",icon:f.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:k.value||f.value})),X=U(),Y=Te(),Z=ke(),O=Pe();Re();const ee=Ie(),P=Ne();$e();const te=Ve(),se=V(),ae=Ee(),{patient:i}=d(Y),{vitals:ne}=d(X),{investigations:ie}=d(Z),{diagnosis:oe}=d(O),{substance:re}=d(te),{selectedNCDMedicationList:F}=d(ee),{FootScreening:le,visualScreening:ce,cvScreening:ue}=d(se),{sessionDate:M}=d(ae),{apiStatus:ut}=d(Fe());c(E,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:u.value,tabsLength:n.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),c(f,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const me=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},y=()=>{let e=!1;return b(),f.value&&(e=!0),k.value=e,!e},ve=()=>{B.push("/patientProfile")},R=()=>[{title:"Airway Assessment",icon:""},{title:"Breathing Assessment",icon:""},{title:"Circulation Assessment",icon:""},{title:"Disability Assessment",icon:""},{title:"Exposure Assessment",icon:""}],n=v(R()),de=v(null),ge=v(null),b=()=>{var a;if(!n.value||n.value.length===0)return console.log("Tabs not yet initialized"),null;const e=u.value>=0&&u.value<n.value.length?u.value:0;switch((a=n.value[e])==null?void 0:a.title){case"Airway Assessment":return"AirwayAssessment";case"Breathing Assessment":return"BreathingAssessment";case"Circulation Assessment":return"CirculationAssessment";case"Disability Assessment":return"DisabilityAssessment";case"Exposure Assessment":return"ExposureAssessment";default:if(P.NCDActivities.length>0)switch(P.NCDActivities[0]){case"Airway Assessment":return"AirwayAssessment";case"Breathing Assessment":return"BreathingAssessment";case"Circulation Assessment":return"CirculationAssessment";case"Disability Assessment":return"DisabilityAssessment";case"Exposure Assessment":return"ExposureAssessment"}return null}},I=()=>{T.value=!1,setTimeout(()=>{u.value=0,T.value=!0},0)},z=()=>{const e=U();e.setVitals(e.getInitialVitals(i.value.ID))},m=async()=>{var a,l;const e=Le(M.value,"sessionDate","value")||$.sessionDate(),t=C("vitals");for(let s=0;s<n.value.length;s++){const r=n.value[s];if(r.title==="Vital Signs")n.value[s].icon=w(e,t)?S:"";else if(r.title==="Risk Assessment"){const o=C("substanceAbuse");n.value[s].icon=w(e,o)?S:""}else if(r.title==="Investigations"){const o=(l=(a=i==null?void 0:i.value)==null?void 0:a.labOrders)==null?void 0:l.saved,h=o==null?void 0:o.filter(he=>$.toStandardHisFormat(e)===$.toStandardHisFormat(he.order_date));n.value[s].icon=(h==null?void 0:h.length)>0?S:""}else if(r.title==="Diagnosis"){const o=C("diagnosis");n.value[s].icon=w(e,o)?S:""}else if(r.title==="Complications Screening"){const o=C("screening");n.value[s].icon=w(e,o)?S:""}else r.title==="Treatment Plan"&&(F.value.length>0?n.value[s].icon=He()?S:"":n.value[s].icon="")}y()},w=(e,t)=>{const a=new Date(e);return a.setHours(0,0,0,0),t.some(l=>{const s=new Date(l.obs_datetime);return s.setHours(0,0,0,0),s.getTime()===a.getTime()})},fe=async()=>{var s,r,o,h;const e=[],t=await J(ce.value),a=await et(le.value),l=await J(ue.value);t.length>0&&e.push({concept_id:await x.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:x.getSessionDate(),child:t}),a.length>0&&e.push({concept_id:await x.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:x.getSessionDate(),child:a}),l.length>0&&e.push(...l),e.length>0?((h=(o=(r=(s=i.value).screening)!=null?r:s.screening={}).unsaved)!=null||(o.unsaved=[]),i.value.screening.unsaved.push(...e),Ue("Complications saved successfully")):G("No complications data to save")},pe=async()=>{const e=je();if(!Oe.isEmpty(e.selectedMedicalAllergiesList)){const l=Ge(),s=e.selectedMedicalAllergiesList.map(o=>({concept_id:o.concept_id,obs_datetime:Je.getSessionDate(),value_coded:o.concept_id,location_id:l.facilityLocation.code,value_text:o.name})),r=await Xe(s);i.value=Object.assign(i.value,r),console.log("Allergies staged successfully:",i.value),e.clearSelectedMedicalAllergiesList()}const t=await Ye();i.value=Object.assign(i.value,t);const a=await Ze().saveNonPharmaTherapyPatientData();i.value=Object.assign(i.value,a)},be=async(e,t)=>{var l,s,r;const a=(l=n.value[t])==null?void 0:l.title;e%1===0&&(u.value=e),a=="Vital Signs"&&((s=de.value)==null||s.onSubmit()),a=="Risk Assessment"&&((r=ge.value)==null||r.onSubmit()),a=="Complications Screening"&&await fe(),a=="Treatment Plan"&&await pe(),await j(i.value)},L=async()=>{f.value=!0;try{await We(),await j(i.value),B.push("/triageList")}catch(e){console.error("Error saving data:",e),G("Error occurred while saving data. Please try again.")}finally{f.value=!1}};return we(async()=>{if(P.NCDActivities.length===0){B.push("patientProfile");return}V().resetScreening(),n.value=R(),await m(),(u.value===void 0||u.value<0)&&(u.value=0,console.log("Setting initial tab index to 0")),k.value=!1,f.value=!1,y()}),c(u,async()=>{await y()}),c(ne,async()=>{await m()},{deep:!0}),c(i,async()=>{V().resetScreening(),await m()},{deep:!0}),c(M,async()=>{await m()},{deep:!0}),c(ie,async()=>{await m()},{deep:!0}),c(oe,async()=>{await m()},{deep:!0}),c(re,async()=>{await m()},{deep:!0}),c(F,async()=>{await m()},{deep:!0}),c(Q,async e=>{I(),z(),n.value=R()},{deep:!0}),c(i,async(e,t)=>{e.ID!=t.ID&&(I(),z())},{deep:!0}),K({saveData:L,markWizard:m,refreshWizard:I,validateDoneButtonState:y}),(e,t)=>(W(),H(_(Be),null,{default:N(()=>[g(Me),g(_(_e),{fullscreen:!0},{default:N(()=>[g(Ke),p("div",rt,[T.value?(W(),H(Qe,{key:0,ref:"wizard",headingTitle:"Primary Survey","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:E.value,"custom-tabs":n.value,beforeChange:_(q),onChange:be,"onComplete:wizard":t[1]||(t[1]=a=>L()),onDoneButtonChanged:me},{default:N(()=>[p("div",null,[p("div",lt,[g(ze,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:_(xe),"font-weight":"600",onClick:t[0]||(t[0]=a=>ve())},null,8,["icon"])])]),D(p("div",null,[g(st,{ref:"airwayAssessmentRef"},null,512)],512),[[A,b()=="AirwayAssessment"]]),D(p("div",null,[g(at,{ref:"breathingAssessmentRef"},null,512)],512),[[A,b()=="BreathingAssessment"]]),D(p("div",null,[g(nt,{ref:"circulationAssessmentRef"},null,512)],512),[[A,b()=="CirculationAssessment"]]),D(p("div",null,[g(it,{ref:"disabilityAssessmentRef"},null,512)],512),[[A,b()=="DisabilityAssessment"]]),D(p("div",null,[g(ot,{ref:"exposureAssessmentRef"},null,512)],512),[[A,b()=="ExposureAssessment"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Ce("",!0)])]),_:1})]),_:1}))}});export{Ft as default};

var L=Object.defineProperty;var z=(s,a,e)=>a in s?L(s,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[a]=e;var M=(s,a,e)=>z(s,typeof a!="symbol"?a+"":a,e);import{_ as P,u as H,a1 as K,G as Y,s as N,b2 as q,T as G}from"../index-MS1JWVwx.js";import{d as O,bm as W,e as v,f as d,m as _,k as t,l as S,j as J,u as $,J as V,Q as I,K as D,r as C,w as Q,c as h,O as j,p as B,cB as X,ff as Z,D as ee,bU as se,F as A,P as F,bF as T,bt as U,b2 as te,a4 as ie,a7 as ae}from"./vendor-CzFJ4KTZ.js";import{N as oe}from"./NeonatalStepper-CslS6KnU.js";import{V as ne}from"./VueMultiselectStaticList-DmoY7Hnv.js";import{I as le}from"./images-DJIykHYW.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-C9muk_WD.js";import"./SaveProgressModal-yJRuhnSP.js";import"./enrollment-DU-PLRUa.js";const re={class:"multiselect-header-wrapper"},ce={key:0,class:"question-header"},de={class:"selection-instruction"},ue={class:"custom__tag"},ge=["onClick"],me=O({name:"VueMultiselectStyledMulti",components:{VueMultiselect:W},__name:"VueMultiselectStyledMulti",props:{options:{type:Array,required:!0,validator:s=>s.every(a=>"label"in a&&"value"in a)},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(s,{emit:a}){const e=a,i=()=>{e("update:modelValue",[])};return(o,n)=>(d(),v("div",re,[o.$slots.header?(d(),v("div",ce,[J(o.$slots,"header",{},void 0,!0)])):_("",!0),t("div",de,[n[1]||(n[1]=t("span",null,"Select one or more.",-1)),s.modelValue.length>0?(d(),v("button",{key:0,onClick:i,class:"clear-button",type:"button"},"Clear All")):_("",!0)]),S($(W),{"model-value":s.modelValue,"onUpdate:modelValue":n[0]||(n[0]=l=>e("update:modelValue",l)),options:s.options,"track-by":"value",label:"label",searchable:!0,multiple:!0,"close-on-select":!1,"hide-selected":!0},{tag:V(({option:l,remove:g})=>[t("span",ue,[t("span",null,D(l.label),1),t("span",{class:"custom__remove",onClick:b=>g(l)},"âŒ",8,ge)])]),placeholder:V(()=>[...n[2]||(n[2]=[I(" Select the appropriate diagnosis... ",-1)])]),_:1},8,["model-value","options"])]))}}),ve=P(me,[["__scopeId","data-v-4ce94d6e"]]),pe={class:"selected-diagnoses-list"},fe={key:0,class:"empty-state"},De=["src"],ye={key:1,class:"rank-number"},be={class:"item-label"},he=["onClick","aria-label","title"],_e=O({__name:"SelectedDiagnosisDisplay",props:{items:{default:()=>[]},isDifferential:{type:Boolean,default:!1},allowDragging:{type:Boolean,default:!1}},emits:["remove-item","update:items"],setup(s,{emit:a}){const e=s,i=a,o=C([]),n=C(null);Q(()=>e.items,f=>{f?o.value=[...f]:o.value=[]},{immediate:!0,deep:!0});const l=h(()=>({animation:250,disabled:!e.allowDragging||!e.isDifferential,ghostClass:"ghost",dragClass:"dragging-element",forceFallback:!0,fallbackTolerance:5,touchStartThreshold:5,delay:0,delayOnTouchOnly:!0})),g=f=>e.allowDragging&&e.isDifferential,b=f=>{f.oldIndex!==void 0&&o.value[f.oldIndex]&&(n.value=o.value[f.oldIndex].value)},y=f=>{i("update:items",o.value),n.value=null},E=f=>{i("remove-item",f)};return(f,k)=>(d(),v("div",pe,[!s.items||s.items.length===0?(d(),v("div",fe,[t("p",null,"No "+D(s.isDifferential?"differential":"working")+" diagnosis selected",1)])):(d(),j($(Z),X({key:1,modelValue:o.value,"onUpdate:modelValue":k[0]||(k[0]=p=>o.value=p),"item-key":"value",handle:".drag-handle-wrapper",onStart:b,onEnd:y},l.value,{move:g}),{item:V(({element:p,index:c})=>[t("div",{class:B(["selected-item",{differential:s.isDifferential,"is-dragging":n.value===p.value,"draggable-enabled":s.allowDragging&&s.isDifferential}])},[s.allowDragging&&s.isDifferential?(d(),v("div",{key:0,class:B(["drag-handle-wrapper",{"is-active":n.value===p.value}]),title:"Drag to reorder"},[t("img",{src:$(le).icons.dragIcon,alt:"Drag to reorder",class:"drag-icon"},null,8,De)],2)):_("",!0),s.isDifferential?(d(),v("span",ye,"#"+D(c+1),1)):_("",!0),t("span",be,D(p.label),1),t("button",{onClick:m=>E(p),class:"remove-button",type:"button","aria-label":"Remove "+p.label,title:"Remove "+p.label},[...k[1]||(k[1]=[t("span",{class:"trash-icon"},"ðŸ—‘ï¸",-1)])],8,he)],2)]),_:1},16,["modelValue"]))]))}}),R=P(_e,[["__scopeId","data-v-6f381d34"]]),x=ee("diagnosisStore",{state:()=>({workingDiagnosis:null,differentialDiagnoses:[],diagnosisNotes:""}),actions:{setWorkingDiagnosis(s){this.workingDiagnosis=s},setDifferentialDiagnoses(s){this.differentialDiagnoses=s},addDifferentialDiagnosis(s){this.differentialDiagnoses.some(a=>a.value===s.value)||this.differentialDiagnoses.push(s)},removeDifferentialDiagnosis(s){this.differentialDiagnoses=this.differentialDiagnoses.filter(a=>a.value!==s.value)},setDiagnosisNotes(s){this.diagnosisNotes=s},resetDiagnosisData(){this.$reset(),console.log("Diagnosis Store Data has been reset.")}},persist:!0}),Se={class:"diagnosis-selection-panel"},ke={class:"diagnosis-section"},we={class:"diagnosis-section"},$e={key:0,class:"validation-error"},Ve=O({__name:"DiagnosisSelection",setup(s,{expose:a}){const e=ne,i=x(),o=C(null),n=[{label:"Hypoglycaemia (symptomatic)",value:"Hypoglycaemia1"},{label:"Abscess",value:"Abscess"},{label:"Fever",value:"Fever"},{label:"Birth Asphyxia",value:"Asphyxia"},{label:"Neonatal Sepsis (Early onset - Symptomatic)",value:"Neonatal Sepsis - Early Onset"},{label:"Prematurity with Respiratory Distress",value:"Prematurity with RDS"},{label:"Suspected Neonatal Sepsis",value:"Sepsis_Sus"},{label:"Possible Meconium Aspiration",value:"Meconium Aspiration"}],l=h({get:()=>i.workingDiagnosis,set:p=>{o.value=null,i.setWorkingDiagnosis(p)}}),g=h(()=>i.workingDiagnosis?[i.workingDiagnosis]:[]),b=()=>{i.setWorkingDiagnosis(null)},y=h({get:()=>i.differentialDiagnoses,set:p=>{o.value=null,i.setDifferentialDiagnoses(p)}}),E=h(()=>i.differentialDiagnoses),f=p=>{i.removeDifferentialDiagnosis(p)};function k(){const p=!!i.workingDiagnosis,c={};return p?(o.value=null,console.log("Validation Success: Diagnosis Selection passed.")):(o.value="A Primary Diagnosis (Working Diagnosis) is required to proceed to the next step.",c.primaryDiagnosisRequired=o.value,console.error("Validation Error: Primary Diagnosis is missing.")),Object.keys(c).length>0?c:null}return a({validateForm:k}),(p,c)=>(d(),v("div",Se,[t("div",ke,[c[3]||(c[3]=t("div",{class:"description-box"}," Select the diagnoses you think the baby has (you can select more than 1) ",-1)),c[4]||(c[4]=t("h3",{class:"diagnosis-section-title"},"Your Selected Working Diagnosis",-1)),S(R,{items:g.value,onRemoveItem:b},null,8,["items"]),(d(),j(se($(e)),{modelValue:l.value,"onUpdate:modelValue":c[0]||(c[0]=m=>l.value=m),options:n,class:"multiselect-component"},{header:V(()=>[...c[2]||(c[2]=[I(" Primary Diagnosis (Select ONE) ",-1)])]),_:1},8,["modelValue"]))]),c[7]||(c[7]=t("hr",{class:"separator"},null,-1)),t("div",we,[c[6]||(c[6]=t("h3",{class:"diagnosis-section-title"},"Your Selected Differential Diagnosis",-1)),S(R,{items:E.value,"is-differential":!0,onRemoveItem:f},null,8,["items"]),S(ve,{modelValue:y.value,"onUpdate:modelValue":c[1]||(c[1]=m=>y.value=m),options:n,class:"multiselect-component"},{header:V(()=>[...c[5]||(c[5]=[I(" Differential Diagnoses ",-1)])]),_:1},8,["modelValue"]),o.value?(d(),v("div",$e,D(o.value),1)):_("",!0)])]))}}),Ce=P(Ve,[["__scopeId","data-v-0d34bf49"]]),Ee={class:"systems-suggestions-panel"},Ie={class:"diagnosis-section"},Oe={class:"diagnosis-section"},Pe={key:0,class:"validation-error"},xe={class:"suggested-diagnosis-section"},Me={key:0,class:"empty-suggestions"},Re=["onClick","aria-label","onKeydown"],Ne={class:"suggestion-content"},Ae={class:"suggestion-label"},Fe={class:"suggestion-details"},je=["onClick","title","aria-label"],We={key:0,class:"rejected-diagnosis-section"},Be={class:"rejected-content"},Te={class:"rejected-label"},Ue={class:"rejected-details"},qe=["onClick","title","aria-label"],Le=O({__name:"SystemsSuggestions",setup(s,{expose:a}){const e=x(),i=C(null),o=h(()=>e.workingDiagnosis?[e.workingDiagnosis]:[]),n=()=>{e.setWorkingDiagnosis(null),i.value=null},l=m=>{e.removeDifferentialDiagnosis(m),i.value=null},g=m=>{e.setDifferentialDiagnoses(m),i.value=null},b=[{label:"Term with Respiratory Distress",value:"Term_RD",details:"Baby is term and showed one of the signs/risks of respiratory distress - this baby needs referral."},{label:"Mild Hypothermia",value:"Mild_Hypothermia",details:"Baby's temperature is recorded as 36 degrees up to 36.4 degrees."},{label:"Neonatal Jaundice",value:"Neonatal_Jaundice",details:"Baby shows signs of yellowing of skin or eyes within first week of life."}],y=C([]),E=h(()=>b.filter(m=>{const r=e.differentialDiagnoses.some(w=>w.value===m.value),u=y.value.some(w=>w.value===m.value);return!r&&!u})),f=m=>{e.addDifferentialDiagnosis({label:m.label,value:m.value}),i.value=null},k=m=>{y.value.push(m)},p=m=>{y.value=y.value.filter(r=>r.value!==m.value)};function c(){const m=!!e.workingDiagnosis,r={};if(m)i.value=null,console.log("Validation Success: Systems Suggestions passed.");else{const u="A Primary Diagnosis (Working Diagnosis) must be confirmed before reviewing and submitting the final diagnosis.";i.value=u,r.primaryDiagnosisRequired=u,console.error("Validation Error: Primary Diagnosis removed or missing at review stage.")}return Object.keys(r).length>0?r:null}return a({validateForm:c}),(m,r)=>(d(),v("div",Ee,[t("div",Ie,[r[0]||(r[0]=t("h3",{class:"diagnosis-section-title"},"Your Selected Working Diagnosis",-1)),S(R,{items:o.value,"allow-dragging":!1,onRemoveItem:n},null,8,["items"])]),t("div",Oe,[r[1]||(r[1]=t("h3",{class:"diagnosis-section-title"},"Your Selected Differential Diagnosis",-1)),S(R,{items:$(e).differentialDiagnoses,"is-differential":!0,"allow-dragging":!0,onRemoveItem:l,"onUpdate:items":g},null,8,["items"]),i.value?(d(),v("div",Pe,D(i.value),1)):_("",!0)]),r[8]||(r[8]=t("p",{class:"suggestion-instruction"},[I(" Please consider the suggested diagnoses below. "),t("strong",null,"Click on a suggestion to add it to your differential diagnosis"),I(", or click the âŒ button to reject it. ")],-1)),t("div",xe,[r[5]||(r[5]=t("h3",{class:"suggested-title"},"Suggested Diagnosis",-1)),E.value.length===0?(d(),v("div",Me,[...r[2]||(r[2]=[t("p",null,"No suggestions available",-1)])])):_("",!0),(d(!0),v(A,null,F(E.value,u=>(d(),v("div",{key:u.value,class:"suggestion-item",onClick:w=>f(u),role:"button",tabindex:"0","aria-label":"Add ".concat(u.label," to differential diagnosis"),onKeydown:[T(w=>f(u),["enter"]),T(U(w=>f(u),["prevent"]),["space"])]},[t("div",Ne,[t("p",Ae,[r[3]||(r[3]=t("span",{class:"add-indicator"},"+",-1)),I(" "+D(u.label),1)]),t("p",Fe,D(u.details),1)]),t("button",{onClick:U(w=>k(u),["stop"]),class:"suggestion-action-button reject-button",title:"Reject ".concat(u.label),"aria-label":"Reject ".concat(u.label)},[...r[4]||(r[4]=[t("span",{class:"cross-icon"},"âŒ",-1)])],8,je)],40,Re))),128))]),y.value.length>0?(d(),v("div",We,[r[7]||(r[7]=t("h3",{class:"rejected-title"},"Rejected Diagnosis",-1)),(d(!0),v(A,null,F(y.value,u=>(d(),v("div",{key:u.value,class:"rejected-item"},[t("div",Be,[t("p",Te,D(u.label),1),t("p",Ue,D(u.details),1)]),t("button",{onClick:w=>p(u),class:"suggestion-action-button undo-button",title:"Restore ".concat(u.label),"aria-label":"Restore ".concat(u.label," to suggestions")},[...r[6]||(r[6]=[t("span",{class:"undo-icon"},"â†»",-1)])],8,qe)]))),128))])):_("",!0)]))}}),ze=P(Le,[["__scopeId","data-v-999eb904"]]),He={class:"diagnosis-summary-panel"},Ke={class:"summary-section"},Ye={class:"diagnosis-list"},Ge={class:"diagnosis-item primary-item"},Je={class:"summary-section"},Qe={class:"diagnosis-list"},Xe={key:0,class:"no-data-item"},Ze=O({__name:"DiagnosisSummary",setup(s){const a=x(),e=h(()=>{var o;return((o=a.workingDiagnosis)==null?void 0:o.label)||"(None selected)"}),i=h(()=>a.differentialDiagnoses);return(o,n)=>(d(),v("div",He,[t("div",Ke,[n[0]||(n[0]=t("h2",{class:"section-title"},"Primary Diagnosis",-1)),t("div",Ye,[t("p",Ge,D(e.value),1)])]),t("div",Je,[n[1]||(n[1]=t("h2",{class:"section-title"},"Differential Diagnosis",-1)),t("div",Qe,[(d(!0),v(A,null,F(i.value,l=>(d(),v("p",{key:l.value,class:"diagnosis-item differential-item"},D(l.label),1))),128)),i.value.length?_("",!0):(d(),v("p",Xe," (None selected) "))])])]))}}),es=P(Ze,[["__scopeId","data-v-60387580"]]);class ss extends q{constructor(a,e){super(a,41,e)}}class ts extends q{constructor(e,i){super(e,41,i);M(this,"diagnosis_service");M(this,"computeParentObservation",async e=>({tag:e,obs:await this.diagnosis_service.buildValueCoded(e,e)}));M(this,"childObservation",async e=>await this.diagnosis_service.buildValueCoded(e,e));this.diagnosis_service=new ss(e,i)}async ensureEncounterExists(){if(this.encounterID)return;const e=await this.diagnosis_service.createEncounter();if(!e)throw new Error("Failed to create encounter");if(this.encounterID=e.encounter_id,e.patient_id!==this.patientID)throw new Error("Encounter created for the wrong patient! Context inconsistency detected.")}async onSubmit(e){await this.ensureEncounterExists(),this.saveObservationList(e)}}const is=async s=>{try{const a=x();if(!a.workingDiagnosis)throw N("Diagnosis is required"),new Error("Diagnosis is required");const i={primaryDiagnosisObservation:await s.computeParentObservation("Primary diagnosis")},o=await s.childObservation(a.workingDiagnosis.value);if(!o)throw N("Primary diagnosis observations are required"),new Error("Primary diagnosis observations are required");o&&(i.primaryDiagnosisObservation.obs.child=[o]),await s.onSubmit([i.primaryDiagnosisObservation.obs]),a.setWorkingDiagnosis(null),console.log("PrimaryDiagnosisData",i)}catch(a){throw a}},as=async s=>{try{const a=x(),i={secondaryDiagnosisObservation:await s.computeParentObservation("Secondary diagnosis")},o=a.differentialDiagnoses.map(async l=>await s.childObservation(l.value)),n=await Promise.all(o);if(n.length>0)i.secondaryDiagnosisObservation.obs.child=n;else{console.log("No secondary diagnoses to save.");return}await s.onSubmit([i.secondaryDiagnosisObservation.obs]),a.setDifferentialDiagnoses([]),console.log("SecondaryDiagnosisData",i)}catch(a){throw a}},os=async()=>{try{const s=H(),{patient:a}=te(s),e=K(),i=new ts(a.value.patientID,e.user_ID);await Promise.all([is(i),as(i)]),console.log("SUCCESS: All Diagnosis sections saved successfully!"),Y("Diagnosis saved successfully")}catch(s){console.error("FAILED to save diagnosis:",s),N("Failed to save diagnosis. Please try again.")}},fs=O({__name:"Diagnosis",setup(s){const a=C("1"),e=[{title:"Diagnosis",value:"1",component:Ce},{title:"Systems Suggestions",value:"2",component:ze},{title:"Summary",value:"3",component:es}],i=C(e.map((l,g)=>({title:l.title,number:g+1,checked:!1,class:g===0?"open_step common_step":"common_step",last_step:g===e.length-1?"last_step":""}))),o=l=>{l&&l.value&&i.value.forEach((g,b)=>{l.value===(b+1).toString()?(g.class="open_step common_step",g.checked=!1):b<parseInt(l.value)-1?(g.class="common_step color_white",g.checked=!0):(g.class="common_step",g.checked=!1)})},n=l=>{const g=e.length-1;return l===g?os:()=>Promise.resolve()};return(l,g)=>(d(),j($(ae),{class:"neonatal-enrollment-page"},{default:V(()=>[S(G),S($(ie),{fullscreen:!0},{default:V(()=>[S(oe,{wizardData:i.value,StepperData:e,stepperTitle:"General Examination",openStepper:a.value,backUrl:"/patientProfile",getSaveFunction:n,onUpdateStatus:o,"flow-type":"enrollment","show-componet-title":!0},null,8,["wizardData","openStepper"])]),_:1})]),_:1}))}});export{fs as default};

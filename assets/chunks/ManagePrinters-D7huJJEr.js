import{d as B,c as T,O as w,f,J as i,l as r,u as s,I as Z,G as Y,k as o,E as ee,Q as $,a3 as X,a4 as V,a5 as z,a6 as G,R,cp as K,r as P,w as j,a as H,e as F,b6 as te,n as ne,m as A,bx as ae,_ as W,W as U,bz as se,aj as re,F as oe,P as ie,K as le,N as q,p as de}from"./vendor-hvlGrBh_.js";import{aA as ue,l as N,aB as O,J,aC as Q,S as k,_ as L,m as ce,s as x,G as E,aD as pe,T as fe}from"../index-BqFqOLy7.js";import{u as me}from"./useLocation-gr-MXx1j.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-BtPTSgal.js";const _e={style:{display:"flex","justify-content":"space-between"}},ge={style:{"max-width":"500px",margin:"auto"}},ve=B({__name:"AddWebPrinter",setup(M){const{formRef:m}=ue(),{facilityList:g,getFacilities:_}=me();_();const c=T(()=>[{componentType:"inputField",header:"Print name",name:"printer_name",icon:N.print,validation:l=>O.required(l)},{componentType:"inputField",header:"Printer IP address",name:"ip_address",icon:N.networkBarDark,validation:l=>O.required(l)},{componentType:"multiSelectInputField",header:"Facility",name:"location_id",trackBy:"facility_id",openDirection:"auto",icon:N.search,validation:l=>O.required(l),options:g.value.facilities}]),y=()=>{R.dismiss()},p=()=>{var d;const l=(d=m.value)==null?void 0:d.getFormValues();l.location_id=l.location_id.code,k.postJson("/printer_configurations",l),R.dismiss()};return(l,d)=>(f(),w(s(G),null,{default:i(()=>[r(s(Z),null,{default:i(()=>[r(s(Y),null,{default:i(()=>[o("div",_e,[r(s(ee),null,{default:i(()=>[...d[2]||(d[2]=[$("Add Web Printer",-1)])]),_:1}),r(J,{name:"X",style:{"margin-right":"10px"},onClick:d[0]||(d[0]=b=>y())})])]),_:1})]),_:1}),r(s(X),{class:"ion-padding"},{default:i(()=>[o("div",ge,[r(s(V),null,{default:i(()=>[r(s(z),{size:"12"},{default:i(()=>[r(Q,{formData:c.value,ref_key:"formRef",ref:m},null,8,["formData"])]),_:1})]),_:1}),r(s(V),{class:"ion-justify-content-end ion-margin-top"},{default:i(()=>[r(s(z),{size:"auto"},{default:i(()=>[r(J,{name:"Add printer",onClick:d[1]||(d[1]=b=>p())})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),ye=L(ve,[["__scopeId","data-v-bce6abd1"]]),Pe={class:""},be={class:"table-header",style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ie={style:{"min-width":"400px",display:"flex","align-items":"center"}},Se={class:"table-responsive"},ke={key:0,class:"loading-state"},we={key:1,class:"empty-state"},he=B({__name:"ManageIPPrinters",setup(M){const m=K(),g=P([]),_=P(!1),c=P(null),y=T(()=>({paging:!0,lengthChange:!1,searching:!1,ordering:!0,info:!0,autoWidth:!0,responsive:!0,pageLength:8})),p=T(()=>[{data:0,title:"Printer name"},{data:1,title:"Ip address"},{data:2,title:"Date"},{data:3,title:"Actions",orderable:!1,className:"text-left"}]),l=T(()=>[{componentType:"multiSelectInputField",value:k.getDefaultPrinter()||"",trackBy:"id",onChange:e=>{localStorage.setItem("defaultPrinter",JSON.stringify(e))},options:g.value.map(e=>({name:e.printer_name,id:e._id,ip_address:e.ip_address}))}]),d=T(()=>b(g.value)),b=e=>e.length>0?e.map(t=>[t.printer_name,t.ip_address,t.created_at,'<div class="action-buttons">\n                    <button class="test-print-btn action-button" data-id=\''.concat(JSON.stringify({id:t._id,printer_name:t.printer_name,ip_address:t.ip_address,created_at:t.created_at,location_id:t.location_id}),"'>Test Print</button>\n                    <button class=\"edit-btn action-button\" data-id='").concat(JSON.stringify({id:t._id,printer_name:t.printer_name,ip_address:t.ip_address,created_at:t.created_at,location_id:t.location_id}),"'>Edit</button>\n                    <button class=\"delete-btn action-button delete-button\" data-id='").concat(JSON.stringify({id:t._id,printer_name:t.printer_name,ip_address:t.ip_address,created_at:t.created_at,location_id:t.location_id}),"'>Delete</button>\n                </div>")]):[],I=()=>{ne(()=>{var t,u;const e=(t=c.value)==null?void 0:t.dt;(u=e==null?void 0:e.columns)==null||u.adjust().draw(),e==null||e.off("click",".test-print-btn"),e==null||e.off("click",".edit-btn"),e==null||e.off("click",".delete-btn"),e==null||e.on("click",".test-print-btn",v=>{const h=v.target.getAttribute("data-id");n(JSON.parse(h))}),e==null||e.on("click",".edit-btn",v=>{const h=v.target.getAttribute("data-id");S(JSON.parse(h))}),e==null||e.on("click",".delete-btn",v=>{const h=v.target.getAttribute("data-id");D(JSON.parse(h))})})},C=async(e=null)=>{await ce(ye,{class:"large-modal"},!0),await a()},S=async e=>{console.log("Editing printer:",e),E("Edit functionality for ".concat(e.printer_name," is under development."))},D=async e=>{if(confirm("Are you sure you want to delete printer: ".concat(e.printer_name,"?")))try{await k.delete("/printer_configurations/".concat(e.id),{id:e.id}),E("Printer ".concat(e.printer_name," deleted successfully!")),await a()}catch(t){console.error("Error deleting printer:",t),x("Failed to delete printer ".concat(e.printer_name,"."))}},n=async e=>{const t="^XA\n        ^FO50,50^A0N,60,60^FDTest Print from Vue App!^FS\n        ^FO50,150^A0N,30,30^FDPrinter: ".concat(e.printer_name,"^FS\n        ^FO50,200^A0N,30,30^FDIP Address: ").concat(e.ip_address,"^FS\n        ^XZ");try{const u=await fetch("https://".concat(e.ip_address,"/print"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({zpl:t})});if(u.ok)E("Test print sent successfully to ".concat(e.printer_name));else{const v=await u.json();x("Failed to send test print to ".concat(e.printer_name,". Error: ").concat(v.message||u.statusText))}}catch(u){console.error("Error sending test print:",u),x("Error sending test print to ".concat(e.printer_name,". Please check your network or server connection."))}},a=async()=>{_.value=!0;try{g.value=await k.getJson("/printer_configurations",{location_id:k.getUserLocationId()}),I()}catch(e){console.error("Error loading printer configurations:",e),x("Failed to load printer configurations.")}finally{_.value=!1}};return j(m,async()=>{await a()},{deep:!0}),j(d,()=>{I()}),H(async()=>{k.getDefaultPrinter(),await a()}),(e,t)=>(f(),F("div",Pe,[o("div",null,[o("div",be,[t[2]||(t[2]=o("h3",{class:"encounter-title"},"Manage web printers",-1)),o("div",Ie,[t[1]||(t[1]=o("span",{style:{"font-weight":"700"}},"Default Printer",-1)),r(Q,{formData:l.value,ref:"formRef"},null,8,["formData"])]),r(J,{name:"Add printer",fill:"solid",onClick:t[0]||(t[0]=u=>C())})]),o("div",Se,[_.value?(f(),F("div",ke,[...t[3]||(t[3]=[o("p",null,"Loading printers...",-1)])])):g.value.length===0?(f(),F("div",we,[...t[4]||(t[4]=[o("p",null,"No printers found",-1)])])):(f(),w(s(te),{key:2,ref_key:"dataTableRef",ref:c,class:"display nowrap modern-table",width:"100%",data:d.value,columns:p.value,options:y.value},{default:i(()=>[...t[5]||(t[5]=[o("thead",null,[o("tr",null,[o("th",null,"Printer name"),o("th",null,"Ip address"),o("th",null,"Date"),o("th",null,"Actions")])],-1)])]),_:1},8,["data","columns","options"]))])])]))}}),Te=L(he,[["__scopeId","data-v-73e53023"]]),$e={key:0,class:"spinner-overlay"},Fe={class:"container"},xe=B({__name:"ManagePrinters",setup(M){K();const m=P(!1),g=P(Math.random()),_=P([]),c=P({}),y=new pe,p=P(!1);function l(){try{localStorage.setItem("isIpPrinters",JSON.stringify(p.value)),console.log("isIpPrinters state saved:",p.value)}catch(n){console.error("Error saving isIpPrinters state to localStorage:",n)}}function d(){try{const n=localStorage.getItem("isIpPrinters");n!==null&&(p.value=JSON.parse(n),console.log("isIpPrinters state loaded:",p.value))}catch(n){console.error("Error loading isIpPrinters state from localStorage:",n)}}async function b(){if(!m.value){m.value=!0;try{const n=await y.getAllPrinters();console.log("Discovered printers",JSON.stringify(n)),_.value=D(n)}catch(n){console.error("Error loading printers:",n)}finally{m.value=!1,g.value=Math.random()}}}function I(n,a){const e=n.name||"",t=a.name||"",u=n.address||"",v=a.address||"";return e!==t?e.localeCompare(t):u.localeCompare(v)}function C(n){y.setDefaultPrinter(n),c.value=n,g.value=Math.random(),b()}function S(n){return I(n,c.value)===0}function D(n){return n.sort((a,e)=>{const t=S(a),u=S(e);return t&&!u?-1:!t&&u?1:I(a,e)})}return H(async()=>{d(),c.value=await y.getDefaultPrinter()||{},c.value&&(c.value.name||c.value.address)&&(_.value.some(a=>I(a,c.value)===0)||_.value.push(c.value)),b()}),(n,a)=>(f(),w(s(G),{class:de({loading:m.value})},{default:i(()=>[m.value?(f(),F("div",$e,[r(s(ae),{name:"bubbles"}),a[1]||(a[1]=o("div",{class:"loading-text"},"Please wait...",-1))])):A("",!0),r(fe),r(s(X),null,{default:i(()=>[o("div",Fe,[a[5]||(a[5]=o("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Printer Management",-1)),r(s(W),null,{default:i(()=>[r(s(U),null,{default:i(()=>[...a[2]||(a[2]=[$("Use IP Printers",-1)])]),_:1}),r(s(se),{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),onIonChange:l},null,8,["modelValue"])]),_:1}),p.value?A("",!0):(f(),w(s(re),{key:0},{default:i(()=>[(f(!0),F(oe,null,ie(_.value,e=>(f(),w(s(W),{key:e.name||e.address||"unknown-printer"},{default:i(()=>[r(s(U),null,{default:i(()=>[$(le(e.name||e.address||"Unnamed Printer"),1)]),_:2},1024),r(s(q),{size:"small",color:S(e)?"success":"primary",onClick:t=>C(e),disabled:S(e)},{default:i(()=>[...a[3]||(a[3]=[$(" Set as Default ",-1)])]),_:1},8,["color","onClick","disabled"]),r(s(q),{onClick:t=>s(y).printTestLbl(e),size:"small"},{default:i(()=>[...a[4]||(a[4]=[$(" Test Print ",-1)])]),_:1},8,["onClick"])]),_:2},1024))),128))]),_:1})),p.value?(f(),w(Te,{key:1,style:{"margin-top":"10px"}})):A("",!0)])]),_:1})]),_:1},8,["class"]))}}),Ee=L(xe,[["__scopeId","data-v-8151b8bf"]]);export{Ee as default};

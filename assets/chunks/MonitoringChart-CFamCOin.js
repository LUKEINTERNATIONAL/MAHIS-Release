import{c as w,d as z,r as p,Q as P,f as _,u as d,bH as X,H as b,l,e as ne,T as Be,k,m as ce,F as Me,b7 as Y,G as Pe,a3 as Ae,aF as xe,cr as Ne,bh as S,w as f,a as Ve,L as Le,i as W,bU as Ee,v as j,bq as $e,a9 as M}from"./vendor-CJ2tyHrn.js";import{n as g,C as K,F as Q,ba as ie,u as ze,bb as He,bc as Oe,b2 as Ue,bd as Ge,e as We,b3 as je,i as qe,a9 as Je,f as Ke,T as Qe,a2 as Xe,H as q,b5 as E,be as Ye,J as se,bf as Ze,t as oe,aq as $,G as et,bg as tt,ab as at,S as nt}from"../index-CPIhguZJ.js";import{D as it}from"./DemographicBar-CMCjh8ca.js";import{R as st}from"./ReusableDataTable-t4OJD7FM.js";import{u as ot,a as rt,b as lt}from"./useRespiratoryRateOxygenForm-D7IueoPF.js";import{u as ct,_ as ut}from"./useFormWizard-CAiBa2il.js";import{u as J}from"./ComplicationsStore-Ibxa1dsq.js";import{s as dt,c as mt,u as pt}from"./nonPharmaTherapyStore-CAVSqzBF.js";import{l as vt}from"./lodash-NJiRuGo9.js";import{f as re,a as ft}from"./formatServerData-C4-2caW3.js";import{u as gt}from"./usePatientProfile-Bjyh6yGB.js";import"./apexcharts-BtvCa6MI.js";import"./drug_prescription_service-DiJpwuPJ.js";import"./patient_diagnosis_service-DTN-hwjk.js";import"./Registration-F5RJpZPr.js";import"./useSetRegistrationValues-CWxNfeBu.js";import"./useLocation-BxHWO3Ky.js";import"./vaccines_service-CFrWoT5a.js";import"./sms_service-ba9KXWCi.js";import"./EIRreportsStore-COMUTdOQ.js";import"./Export-CZmpfP5c.js";import"./user_role_management-C_d1iPJp.js";import"./useNeonatalEnrollmentStore--u9Qw-om.js";import"./enrollment-DU-PLRUa.js";import"./Outcome-BVD9d5EL.js";import"./wardsStore-DRE4cKPY.js";const le=()=>{const D=w(()=>[{componentType:"multiSelectInputField",header:"Airway intervention(s)",name:"airway_interventions",isMultiple:!0,trackBy:"id",icon:g.search,options:[{id:1,name:"Positioning"},{id:2,name:"Suctioning"},{id:3,name:"Airway Adjuncts"},{id:4,name:"Advanced Airway"}]},{componentType:"multiSelectInputField",header:"Breathing intervention(s)",name:"breathing_interventions",isMultiple:!0,trackBy:"id",icon:g.search,options:[{id:1,name:"Oxygen Therapy"},{id:2,name:"Inhaled Medications"},{id:3,name:"Chest Decompression"},{id:4,name:"Mechanical Ventilation"}]},{componentType:"multiSelectInputField",header:"Circulation intervention(s)",name:"circulation_interventions",isMultiple:!0,trackBy:"id",icon:g.search,options:[{id:1,name:"IV/IO Access"},{id:2,name:"Fluid Resuscitation"},{id:3,name:"Medications"},{id:4,name:"Blood Products"}]},{componentType:"multiSelectInputField",header:"Disability intervention(s)",name:"disability_interventions",isMultiple:!0,trackBy:"id",icon:g.search,options:[{id:1,name:"Blood Glucose Administration"},{id:2,name:"Seizure Management"},{id:3,name:"Pain Management"}]},{componentType:"multiSelectInputField",header:"Exposure intervention(s)",name:"exposure_interventions",isMultiple:!0,trackBy:"id",icon:g.search,options:[{id:1,name:"Warming Measures"},{id:2,name:"Cooling Measures"},{id:3,name:"Thermal Protection"},{id:4,name:"Electrical Protection"}]}]);return{fluidsFormSection:w(()=>[{componentType:"Dashes"},{componentType:"multiSelectInputField",header:"Intake Fluid Type",name:"intake_fluid_type",isMultiple:!0,trackBy:"id",icon:g.search,grid:{s:"4"},options:[{id:1,name:"Normal Saline"},{id:2,name:"Ringer's Lactate"},{id:3,name:"Dextrose Solution"},{id:4,name:"Blood Products"}]},{componentType:"multiSelectInputField",header:"Output Fluid Type",name:"output_fluid_type",isMultiple:!0,trackBy:"id",icon:g.search,grid:{s:"4"},options:[{id:1,name:"Urine"},{id:2,name:"Vomitus"},{id:3,name:"Drainage"},{id:4,name:"Blood Loss"}]},{componentType:"inputField",header:"Fluid Balance",name:"fluid_balance",unit:"ml",grid:{s:"4"}},{componentType:"inputField",header:"Intake Fluid Amount",name:"intake_fluid_amount",unit:"ml",grid:{s:"4"}},{componentType:"inputField",header:"Output Fluid Amount",name:"output_fluid_amount",unit:"ml",grid:{s:"4"}}]),interventionsFormSection:D}},bt=z({__name:"Interventions",setup(D){p(null);const h=p([]),F=le().interventionsFormSection,o=le().fluidsFormSection,v=p([w(()=>o.value)]),I=(c,C)=>{c&&(h.value[C]=c)},T=()=>{v.value.push(w(()=>o.value))},A=c=>{v.value.length>1&&(v.value.splice(c,1),h.value.splice(c,1))};return(c,C)=>(_(),P(d(X),null,{default:b(()=>[l(d(Y),null,{default:b(()=>[l(K,{formData:d(F),ref:"formRef"},null,8,["formData"]),(_(!0),ne(Me,null,Be(v.value,(H,R)=>(_(),ne("div",{key:R,style:{display:"flex","align-items":"center"}},[l(K,{formData:H.value,ref_for:!0,ref:x=>I(x,R)},null,8,["formData"]),k("div",null,[l(Q,{onClick:x=>A(R),fill:"clear",icon:d(g).minus,disabled:v.value.length===1},null,8,["onClick","icon","disabled"]),R===v.value.length-1?(_(),P(Q,{key:0,onClick:C[0]||(C[0]=x=>T()),fill:"clear",icon:d(g).plus},null,8,["icon"])):ce("",!0)])]))),128))]),_:1})]),_:1}))}}),ht=z({__name:"Medications",setup(D){const h=["Medication","Name","Dose","Frequency","Duration","Formulation","Prescriber"],F={responsive:!0,ordering:!1,layout:{topStart:"buttons",topEnd:"",bottomStart:"info",bottomEnd:"paging"},buttons:[{text:" <b> Print Medication </b>",className:"add-test text-white",action:async()=>{}}]},o=[["Antibiotic","Amoxicillin","500 mg","3 times a day","7 days","Capsule","Dr. Smith"],["Analgesic","Paracetamol","650 mg","4 times a day","5 days","Tablet","Dr. Johnson"],["Antihypertensive","Lisinopril","10 mg","Once daily","30 days","Tablet","Dr. Lee"]];return(v,I)=>{const T=Pe("ion-card-title");return _(),P(d(X),null,{default:b(()=>[l(d(Y),null,{default:b(()=>[l(T,null,{default:b(()=>[...I[0]||(I[0]=[Ae("Prescribed Medication",-1)])]),_:1}),l(st,{data:o,headers:h,options:F})]),_:1})]),_:1})}}}),yt=ot(),St=rt(),_t=lt(),Dt=w(()=>[{grid:{s:"3"}},{grid:{s:"9"},componentType:"Dashes"},...yt.bloodPressureFormSection.value,{grid:{s:"3"}},{grid:{s:"9"},componentType:"Dashes"},...St.temperaturePulseRateForm.value,..._t.respiratoryRateOxygenForm.value]),Ft=()=>({observationFormSection:w(()=>[...Dt.value,{componentType:"Dashes"},{componentType:"inputField",header:"Random Blood Glucose (RBG)",name:"random_blood_glucose",unit:"mg/dL"},{componentType:"inputField",header:"Urine Dipstick - Ketones",name:"urine_dipstick_ketones"},{componentType:"multiSelectInputField",header:"AVPU Scale",name:"avpu_scale",isMultiple:!1,trackBy:"id",icon:g.search,options:[{id:1,name:"Alert"},{id:2,name:"Verbal Response"},{id:3,name:"Pain Response"},{id:4,name:"Unresponsive"}]},{componentType:"inputField",header:"Peak Expiratory Flow Rate (PEFR)",name:"peak_expiratory_flow_rate",unit:"L/min"}])}),Tt=z({__name:"Observations",setup(D){const h=p(null),F=Ft().observationFormSection;return(o,v)=>(_(),P(d(X),null,{default:b(()=>[l(d(Y),null,{default:b(()=>[l(K,{formData:d(F),ref_key:"formRef",ref:h},null,8,["formData"])]),_:1})]),_:1}))}}),Ct={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},kt={class:"back_profile"},ea=z({__name:"MonitoringChart",setup(D,{expose:h}){const{onTabBeforeChange:F,currentTabIndex:o}=ct();gt();const v=xe(),I=Ne();p([]),p([]),p(!1);const T=p(!0),A=p(!1),c=p(!1),C=w(()=>({text:c.value?"Saving...":"Finish",icon:c.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:A.value||c.value})),H=ie(),R=ze(),x=He(),ue=Oe();Ue();const de=Ge(),O=We();je();const me=qe(),pe=J(),ve=Je(),{patient:s}=S(R),{vitals:fe}=S(H),{investigations:ge}=S(x),{diagnosis:be}=S(ue),{substance:he}=S(me),{selectedNCDMedicationList:Z}=S(de),{FootScreening:ye,visualScreening:Se,cvScreening:_e}=S(pe),{sessionDate:ee}=S(ve),{apiStatus:wt}=S(Ke());f(C,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:o.value,tabsLength:i.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),f(c,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const De=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},N=()=>{let e=!1;return V(),c.value&&(e=!0),A.value=e,!e},Fe=()=>{v.push("/patientProfile")},U=()=>[{title:"Observations",icon:""},{title:"Interventions",icon:""},{title:"Medications",icon:""}],i=p(U()),Te=p(null),Ce=p(null),V=()=>{var n;if(!i.value||i.value.length===0)return console.log("Tabs not yet initialized"),null;const e=o.value>=0&&o.value<i.value.length?o.value:0;switch((n=i.value[e])==null?void 0:n.title){case"Observations":return"Observations";case"Interventions":return"Interventions";case"Medications":return"Medications";default:if(O.NCDActivities.length>0)switch(O.NCDActivities[0]){case"Observations":return"Observations";case"Interventions":return"Interventions";case"Medications":return"Medications"}return null}},G=()=>{T.value=!1,setTimeout(()=>{o.value=0,T.value=!0},0)},te=()=>{const e=ie();e.setVitals(e.getInitialVitals(s.value.ID))},y=async()=>{var n,m;const e=Xe(ee.value,"sessionDate","value")||q.sessionDate(),t=E("vitals");for(let a=0;a<i.value.length;a++){const u=i.value[a];if(u.title==="Vital Signs")i.value[a].icon=L(e,t)?M:"";else if(u.title==="Risk Assessment"){const r=E("substanceAbuse");i.value[a].icon=L(e,r)?M:""}else if(u.title==="Investigations"){const r=(m=(n=s==null?void 0:s.value)==null?void 0:n.labOrders)==null?void 0:m.saved,B=r==null?void 0:r.filter(Re=>q.toStandardHisFormat(e)===q.toStandardHisFormat(Re.order_date));i.value[a].icon=(B==null?void 0:B.length)>0?M:""}else if(u.title==="Diagnosis"){const r=E("diagnosis");i.value[a].icon=L(e,r)?M:""}else if(u.title==="Complications Screening"){const r=E("screening");i.value[a].icon=L(e,r)?M:""}else u.title==="Treatment Plan"&&(Z.value.length>0?i.value[a].icon=Ye()?M:"":i.value[a].icon="")}N()},L=(e,t)=>{const n=new Date(e);return n.setHours(0,0,0,0),t.some(m=>{const a=new Date(m.obs_datetime);return a.setHours(0,0,0,0),a.getTime()===n.getTime()})},ke=async()=>{var a,u,r,B;const e=[],t=await re(Se.value),n=await ft(ye.value),m=await re(_e.value);t.length>0&&e.push({concept_id:await $.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:$.getSessionDate(),child:t}),n.length>0&&e.push({concept_id:await $.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:$.getSessionDate(),child:n}),m.length>0&&e.push(...m),e.length>0?((B=(r=(u=(a=s.value).screening)!=null?u:a.screening={}).unsaved)!=null||(r.unsaved=[]),s.value.screening.unsaved.push(...e),et("Complications saved successfully")):oe("No complications data to save")},we=async()=>{const e=tt();if(!vt.isEmpty(e.selectedMedicalAllergiesList)){const m=at(),a=e.selectedMedicalAllergiesList.map(r=>({concept_id:r.concept_id,obs_datetime:nt.getSessionDate(),value_coded:r.concept_id,location_id:m.facilityLocation.code,value_text:r.name})),u=await dt(a);s.value=Object.assign(s.value,u),console.log("Allergies staged successfully:",s.value),e.clearSelectedMedicalAllergiesList()}const t=await mt();s.value=Object.assign(s.value,t);const n=await pt().saveNonPharmaTherapyPatientData();s.value=Object.assign(s.value,n)},Ie=async(e,t)=>{var m,a,u;const n=(m=i.value[t])==null?void 0:m.title;e%1===0&&(o.value=e),n=="Vital Signs"&&((a=Te.value)==null||a.onSubmit()),n=="Risk Assessment"&&((u=Ce.value)==null||u.onSubmit()),n=="Complications Screening"&&await ke(),n=="Treatment Plan"&&await we(),await se(s.value)},ae=async()=>{c.value=!0;try{await Ze(),await se(s.value),v.push("/triageList")}catch(e){console.error("Error saving data:",e),oe("Error occurred while saving data. Please try again.")}finally{c.value=!1}};return Ve(async()=>{if(O.NCDActivities.length===0){v.push("patientProfile");return}J().resetScreening(),i.value=U(),await y(),(o.value===void 0||o.value<0)&&(o.value=0,console.log("Setting initial tab index to 0")),A.value=!1,c.value=!1,N()}),f(o,async()=>{await N()}),f(fe,async()=>{await y()},{deep:!0}),f(s,async()=>{J().resetScreening(),await y()},{deep:!0}),f(ee,async()=>{await y()},{deep:!0}),f(ge,async()=>{await y()},{deep:!0}),f(be,async()=>{await y()},{deep:!0}),f(he,async()=>{await y()},{deep:!0}),f(Z,async()=>{await y()},{deep:!0}),f(I,async e=>{G(),te(),i.value=U()},{deep:!0}),f(s,async(e,t)=>{e.ID!=t.ID&&(G(),te())},{deep:!0}),h({saveData:ae,markWizard:y,refreshWizard:G,validateDoneButtonState:N}),(e,t)=>(_(),P(d($e),null,{default:b(()=>[l(Qe),l(d(Le),{fullscreen:!0},{default:b(()=>[l(it),k("div",Ct,[T.value?(_(),P(ut,{key:0,ref:"wizard",headingTitle:"Monitoring Chart","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:C.value,"custom-tabs":i.value,beforeChange:d(F),onChange:Ie,"onComplete:wizard":t[1]||(t[1]=n=>ae()),onDoneButtonChanged:De},{default:b(()=>[k("div",null,[k("div",kt,[l(Q,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:d(Ee),"font-weight":"600",onClick:t[0]||(t[0]=n=>Fe())},null,8,["icon"])])]),W(k("div",null,[l(Tt,{ref:"observationsRef"},null,512)],512),[[j,V()=="Observations"]]),W(k("div",null,[l(bt,{ref:"interventionsRef"},null,512)],512),[[j,V()=="Interventions"]]),W(k("div",null,[l(ht,{ref:"medicationsRef"},null,512)],512),[[j,V()=="Medications"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):ce("",!0)])]),_:1})]),_:1}))}});export{ea as default};

System.register(["./vendor-legacy-IGuUoRYO.js","./useFormWizard-legacy-RaVPiAQl.js","../index-legacy-CPN3hcLt.js","./DemographicBar-legacy-BDCWCL25.js","./OPDOutcome-legacy-Dg1HyYtq.js","./NextAppointment-legacy-DejeZTJK.js","./OPDDiagnosis-legacy-Ds9UfjMs.js","./OPDPrintingModal-legacy-DSKNTrql.js","./nonPharmaTherapyStore-legacy-kzbjJNTA.js","./previousComplaints-legacy-BVAkGFsX.js","./ClientUtils-legacy-iG80ynsa.js","./usePatientProfile-legacy-VQzP8WGN.js","./useUserActivities-legacy-Wl-dR5TT.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-w_Qe4jnt.js","./LevelOfConsciousness.vue_vue_type_script_setup_true_lang-legacy-D-C99Of6.js","./patient_complaints_service-legacy-B2D2fqKG.js","./DashBox-legacy-CceNXQDL.js","./drug_prescription_service-legacy-BvHSYXdJ.js","./Outcome-legacy-va99WsQ3.js","./wardsStore-legacy-2yXvvg-c.js","./LabOrdersList-legacy-D1fFEwYd.js","./EnterLabResultsModal-legacy-BOc6UTPC.js","./BasicForm-legacy-B3YpG0XM.js","./DateInputField-legacy-DgLPZlDc.js","./group_validation-legacy-f50jgf2a.js","./RadiologyStore-legacy-k-l7TGAm.js","./formatServerData-legacy-C4TFvAc3.js","./user_role_management-legacy-s4weOEFd.js","./ncd_appointment_service-legacy-Crb-CAHE.js","./patient_diagnosis_service-legacy-WoFtATc_.js","./Registration-legacy-CvR6Zs0X.js","./useSetRegistrationValues-legacy-BU4Dp69e.js","./useLocation-legacy-DYREuazP.js","./vaccines_service-legacy-Bs1jd4gJ.js","./sms_service-legacy-CMNHGQiD.js","./EIRreportsStore-legacy-apL3S7So.js","./Export-legacy-Ba5zfkL5.js","./useNeonatalEnrollmentStore-legacy-DhUIuEvW.js","./enrollment-legacy-BWFKsMdA.js"],function(e,t){"use strict";var a,n,l,i,s,o,u,r,c,v,d,g,m,p,y,h,f,b,w,P,D,_,j,x,O,S,C,I,T,A,k,N,L,F,R,E,B,M,W,H,z,U,$,G,J,q,Q,V,Y,K,X,Z,ee,te,ae,ne,le,ie,se,oe,ue,re,ce,ve,de;return{setters:[e=>{a=e.d,n=e.aF,l=e.cr,i=e.r,s=e.c,o=e.bh,u=e.a,r=e.w,c=e.Q,v=e.f,d=e.H,g=e.l,m=e.e,p=e.m,y=e.k,h=e.u,f=e.O,b=e.dE,w=e.L,P=e.i,D=e.bU,_=e.v,j=e.bq,x=e.eJ,O=e.a9},e=>{S=e.u,C=e._},e=>{I=e.u,T=e.bb,A=e.bW,k=e.b2,N=e.e,L=e.b3,F=e.b1,R=e.bG,E=e.T,B=e.F,M=e.s,W=e.G,H=e.x,z=e.K,U=e.b,$=e.H,G=e.b5,J=e.J,q=e.b$,Q=e.bJ,V=e.v,Y=e.t,K=e.r,X=e._},e=>{Z=e.D},e=>{ee=e.C,te=e.b,ae=e.O},e=>{ne=e.I,le=e.N},e=>{ie=e.O},e=>{se=e.O},e=>{oe=e.b,ue=e.u},e=>{re=e.u},e=>{ce=e.p},e=>{ve=e.u},e=>{de=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent=".disabled[data-v-637056bb]{color:red}.spinner-overlay[data-v-637056bb]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-637056bb]{width:80px;height:80px}.loading-text[data-v-637056bb]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-637056bb]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-637056bb]{pointer-events:none}.back_profile[data-v-637056bb]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(t);const ge={key:0,class:"spinner-overlay"},me={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},pe={class:"back_profile"};e("default",X(a({__name:"ConsultationPlan",setup(e){const{currentTabIndex:t}=S(),{printVisitSummary:a}=ve(),{hasWaitingList:X}=de(),ye=n(),he=l(),fe=i(!1),be=i(!0),we=i(!1),Pe=i(!1),De=i(!0),_e=i(!1),je=i(!1),xe=i(!1),Oe=I(),Se=T(),Ce=A(),Ie=k(),Te=N(),Ae=L(),ke=F(),Ne=R(),Le=re(),Fe=i(!1),Re=i(!1),Ee=s(()=>({text:Re.value?"Saving...":"Finish",icon:Re.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:Fe.value||Re.value})),{patient:Be}=o(Oe),{investigations:Me}=o(Se),{OPDdiagnosis:We}=o(Ce),{selectedMedicalDrugsList:He}=o(Ie),{OPDActivities:ze}=o(Te),{outcomes:Ue}=o(Ae),{currentSelectedNextAppointmentDate:$e}=o(Ne),{presentingComplaints:Ge}=o(Le),{vitals:Je}=o(ke),qe=i(null),Qe=i(null),Ve=i(null),Ye=i(null),Ke=i(null),Xe=i(null),Ze=i(null),et=i(),tt=()=>ze.value.map(e=>({title:e,icon:""})),at=async(e,a,n)=>{var l;0===a&&await rt(),await st()&&(await ot(),e%1==0&&(t.value=e),Ze.value&&n&&Ze.value.changeTab(e),"Investigations"===(null===(l=et.value[e])||void 0===l?void 0:l.title)&&Qe.value&&await Qe.value.openAHDModal())},nt=()=>{var e;if(!et.value||0===et.value.length)return null;const a=t.value>=0&&t.value<et.value.length?t.value:0;switch(null===(e=et.value[a])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(ze.value.length>0)switch(ze.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},lt=async()=>{Pe.value=!0,W("Printing consultation summary... Please wait.");try{await a(),W("Consultation summary printed successfully!"),setTimeout(()=>{ye.push("home")},3500)}catch(e){H("Failed to print consultation summary.")}finally{Pe.value=!1}},it=()=>{W("Patient has finished consultation!"),ye.push("home")},st=async()=>{const e=await z.getObsByEncounterIdAndDate(U.PRESENTING_COMPLAINTS);return!!(e&&e.length>0)},ot=async()=>{const e=$.sessionDate();for(let a=0;a<et.value.length;a++)if(await st()){be.value=!0,we.value=!1;const n=et.value[a];if("Clinical Assessment"===n.title){const t=G("presentingComplaints");et.value[a].icon=ut(e,t)?O:""}else if("Investigations"===n.title){var t;const n=null===(t=Be.value)||void 0===t||null===(t=t.labOrders)||void 0===t?void 0:t.saved,l=null==n?void 0:n.filter(t=>$.toStandardHisFormat(e)===$.toStandardHisFormat(t.order_date));et.value[a].icon=(null==l?void 0:l.length)>0?O:""}else if("Diagnosis"===n.title){const t=G("diagnosis");et.value[a].icon=ut(e,t)?O:""}else if("Treatment Plan"===n.title){const e=G("treatment");et.value[a].icon=(null==e?void 0:e.length)>0?O:""}else if("Next Appointment"===n.title){const t=G("appointments");et.value[a].icon=ut(e,t)?O:""}else if("Outcome"===n.title){const e=G("outcomes");et.value[a].icon=(null==e?void 0:e.length)>0?O:""}}else be.value=!1,"Clinical Assessment"!==et.value[a].title&&(et.value[a].icon=x);pt()},ut=(e,t)=>{if(!t)return!1;const a=new Date(e);return a.setHours(0,0,0,0),t.some(e=>{const t=new Date(e.obs_datetime||e.order_date);return t.setHours(0,0,0,0),t.getTime()===a.getTime()})},rt=async()=>{fe.value=!0;try{var e;await Promise.all([null===(e=qe.value)||void 0===e?void 0:e.onSubmit()]),await J(Be.value),q()}catch(t){throw H("Failed to save clinical assessment"),t}finally{fe.value=!1}},ct=async()=>{try{var e;Re.value=!0,await(null===(e=Ve.value)||void 0===e?void 0:e.onSubmit()),await(async()=>{try{const e=await oe();Be.value={...Be.value,...e},await ue().saveNonPharmaTherapyPatientData()}catch{Y("Failed to save treatment plan")}})(),await Ae.saveOutcomPatientData(),await J(Be.value);const t=localStorage.getItem("locationID");if(!t)return void H("Location ID missing.");const a=(()=>{const e=He.value;return console.log("Checking prescribed medications:",{medicationsCount:e.length,medications:e}),e.length>0})();if(X("Waiting for Laboratory"))return await dt(t),void W("Patient moved to Consultation for Lab follow-up.");if(a&&X("Waiting for Consultation"))return void(X("Waiting for Dispensation")?await vt(t):await gt(t));if(!a&&X("Waiting for Consultation"))return void(await mt(t))}catch(t){H("Failed to save consultation.")}finally{Re.value=!1}},vt=async e=>{try{await Q.addPatientToStage(Be.value,"DISPENSATION"),await V().refresh(e),Ie.clearSelectedMedicalDrugsList(),W("Patient moved to Dispensation."),ye.push("home")}catch(t){throw H("Failed to move patient to dispensation"),t}},dt=async e=>{try{await Q.addPatientToStage(Be.value,"CONSULTATION"),await V().refresh(e),Ie.clearSelectedMedicalDrugsList(),ye.push("home")}catch(t){throw H("Failed to move patient to consultation"),t}},gt=async e=>{try{await Q.addPatientToStage(Be.value,"DISPENSATION"),await V().refresh(e),Ie.clearSelectedMedicalDrugsList(),Y("Patient moved to dispensation queue. You lack access to dispense."),ye.push("home")}catch(t){throw H("Failed to move patient to dispensation"),t}},mt=async e=>{try{await K(Be.value),await V().refresh(e),ye.push("home")}catch(t){console.error("Failed to close visit:",t),H("Failed to close visit.")}};u(async()=>{try{var e;if(0===ze.value.length)return void(await ye.push("home"));et.value=tt(),ce.setCurrentPatientID(null===(e=Be.value)||void 0===e?void 0:e.patientID),await ot(),(void 0===t.value||t.value<0)&&(t.value=0),Fe.value=!1,pt()}catch(a){console.error("Error: ",a)}}),r(t,async()=>{await pt()}),r(Je,async()=>{await ot()},{deep:!0}),r(Be,async()=>{var e;await ot(),ce.setCurrentPatientID(null===(e=Be.value)||void 0===e?void 0:e.patientID)},{deep:!0}),r(Me,async()=>{await ot()},{deep:!0}),r(We,async()=>{await ot()},{deep:!0}),r(He,async()=>{await ot()},{deep:!0}),r(Ue,async()=>{await ot()},{deep:!0}),r($e,async()=>{await ot()}),r(Ge,async()=>{await ot()},{deep:!0}),r(he,async()=>{De.value=!1,et.value=tt(),setTimeout(()=>{t.value=0,De.value=!0},0)},{deep:!0}),r(xe,e=>{je.value=e,je.value&&setTimeout(()=>{je.value=!1},15e3)}),r(Ee,(e,a)=>{console.log("Done button options changed:",{from:a,to:e,currentStep:t.value,tabsLength:et.value.length})},{deep:!0});const pt=()=>{let e=!1;return Re.value&&(e=!0),Fe.value=e,!e};return(e,t)=>(v(),c(h(j),null,{default:d(()=>[g(se,{onYes:lt,onNo:it,isOpen:_e.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),fe.value?(v(),m("div",ge,[g(h(f),{name:"bubbles"}),t[3]||(t[3]=y("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),g(h(b),{"is-open":Pe.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),g(E),g(h(w),{fullscreen:!0},{default:d(()=>[g(Z),y("div",me,[De.value?(v(),c(C,{key:0,ref_key:"wizard",ref:Ze,headingTitle:"Consultation Plan","vertical-tabs":"","navigable-tabs":be.value,"scrollable-tabs":"",startIndex:0,doneButton:Ee.value,nextButton:{disabled:we.value},"custom-tabs":et.value,tabs:et.value,onChange:at,"onComplete:wizard":t[2]||(t[2]=e=>ct())},{default:d(()=>[y("div",null,[y("div",pe,[g(B,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:h(D),"font-weight":"600",onClick:t[0]||(t[0]=e=>{ye.push("home")})},null,8,["icon"]),g(B,{name:"Back to Profile",iconSlot:"start",fill:"clear",icon:h(D),"font-weight":"600",onClick:t[1]||(t[1]=e=>{M()?ye.push("/deathPatientProfile"):ye.push("/patientProfile")}),style:{"margin-left":"15px"}},null,8,["icon"])])]),P(y("div",null,[g(ee,{ref_key:"clinicalAssessmentRef",ref:qe},null,512)],512),[[_,"ClinicalAssessment"===nt()]]),P(y("div",null,[g(ne,{ref_key:"investigationsRef",ref:Qe},null,512)],512),[[_,"Investigations"===nt()]]),P(y("div",null,[g(ie,{ref_key:"diagnosisRef",ref:Ve},null,512)],512),[[_,"OPDDiagnosis"===nt()]]),P(y("div",null,[g(te,{ref_key:"treatmentPlanRef",ref:Ye},null,512)],512),[[_,"OPDTreatmentPlan"===nt()]]),P(y("div",null,[g(le,{ref_key:"nextAppointmentRef",ref:Ke},null,512)],512),[[_,"NextAppointment"===nt()]]),P(y("div",null,[g(ae,{ref_key:"outcomeRef",ref:Xe},null,512)],512),[[_,"Outcome"===nt()]])]),_:1},8,["navigable-tabs","doneButton","nextButton","custom-tabs","tabs"])):p("",!0)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-637056bb"]]))}}});

var Ut=Object.defineProperty;var Gt=(e,t,a)=>t in e?Ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var Ye=(e,t,a)=>Gt(e,typeof t!="symbol"?t+"":t,a);import{d as ee,aU as ae,r as P,a as _e,H as k,O as Z,f as v,J as o,l as n,k as h,e as O,P as Te,F as he,m as F,u as p,ah as ge,b4 as Dt,b1 as ke,G as at,E as st,ai as it,aj as Ge,_ as fe,I as ot,a3 as ze,be as bt,aS as St,Q as Y,L as tt,W as Pe,a5 as ue,p as be,K as W,c as me,bp as It,aQ as zt,aw as Wt,aT as Ct,N as pt,a2 as At,w as Q,bv as wt,bn as qt,bR as Yt,aN as jt,bz as mt,bl as je,a4 as Oe,al as Kt,ak as Qt,bC as Xt,Z as Jt,z as Ee,an as Zt,cG as en,R as gt,i as Re,v as $e,b8 as De}from"./vendor-umexne7m.js";import{O as pe,bn as ht,t as ve,aY as We,S as x,l as le,_ as de,J as Be,b7 as rt,B as lt,be as Ot,M as B,o as xe,aS as oe,aI as Ne,H,u as Ie,V as tn,aT as Et,bo as nn,bp as an,ar as sn,bq as re,A as Me,br as on,m as rn,aR as ln,e as Lt,az as Ke,y as dn,aA as cn,P as Tt,a as ft,bs as un,bt as pn,b1 as Le,b3 as Qe,ag as kt,G as Se,bu as mn,aC as Fe,aB as gn,aD as hn,b4 as Xe,L as fn,bv as vn,bw as _n,bx as yn,by as Dn,bz as bn,bA as Sn,bB as In,bC as Je,bD as Cn,bE as An,bF as wn,bG as On,s as En,aH as vt,aJ as Ln,aK as Tn,aL as kn,d as Pn,aM as Bn,g as Nn,Z as Hn,N as Rn,aN as Ve,aO as $n,aP as _t,aQ as Mn,a0 as Fn}from"../index-wq8pjg4N.js";import{D as dt}from"./DashBox-fky5MJGF.js";import{B as ie}from"./BasicForm-5hJpTk0c.js";import Pt from"./LabOrdersList-DlZOC0IV.js";import{v as Ue}from"./group_validation-7p9C1GGP.js";import{b as Bt,d as yt,u as Vn,a as Ze,_ as xn,s as Un,c as Gn}from"./useFormWizard-DVR8pS1M.js";import{A as zn}from"./ncd_appointment_service-DtbkiMHl.js";import{D as Wn}from"./DateInputField-DLc_KYfR.js";import{c as qn,f as Yn,a as nt,b as jn}from"./formatServerData-CBjDuu2v.js";import{u as Kn}from"./RadiologyStore-CRJqG8kV.js";import{p as Qn}from"./previousComplaints-CKziMvBC.js";import{P as Xn}from"./patient_complaints_service-WqmzSQw-.js";import{l as Jn}from"./lodash-NJiRuGo9.js";import{u as Zn}from"./usePatientProfile-CUcejX0m.js";class Nt extends pe{constructor(){super()}async postActivities(t,a){const l=a.location_id,r=await new ht(parseInt(t),-1,l).createEncounter();if(r){const D=await pe.buildLabOrders(r,a.orders||a);if(!await pe.saveOrdersArray(r.encounter_id,D))return ve("Unable to save lab orders")}}async postAHDActivities(t,a){const l=a.location_id,r=await new ht(parseInt(t),-1,l).createEncounter(We.AHD_LAB_ORDERS);if(r){const D=await pe.buildLabOrders(r,a.orders||a);if(!await pe.saveOrdersArray(r.encounter_id,D))return ve("Unable to save lab orders")}}}const Ht=ee({data:()=>({userRole:"",ready:!1,userRoleSettings:{}}),watch:{$route:{async handler(e){this.userRole=x.getUserRoles();const t=x.getProgramID(),a=x.getProgramName();this.userRole=="Lab"&&t==14&&(this.userRoleSettings={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}),t==14&&this.userRole!="Lab"&&(this.userRoleSettings={url:"home",btnName:"Go to waiting list",stepperTitle:"Consultation Plan"}),t==12&&(this.userRoleSettings={url:"contact",btnName:"Back"}),a=="LABOUR AND DELIVERY PROGRAM"&&(this.userRoleSettings={url:"labour/labourHome",btnName:"Back to home"}),a=="PNC PROGRAM"&&(this.userRoleSettings={url:"pnc/home",btnName:"Back to home"})},immediate:!0,deep:!0}}}),ea=["innerHTML"],ta={class:"scrollable-container"},na={key:0,class:"form-section"},aa={key:1,class:"form-section"},sa={key:2,class:"form-section"},ia={key:3,class:"form-section"},oa={key:4,class:"form-section"},ra={key:5,class:"form-section"},la={key:6,class:"form-section"},da={key:7,class:"form-section"},ca=ee({__name:"RadiologyInvestigation",setup(e){const t=Kn(),{head:a,neck:l,chest:d,abdomen:r,upper_extremity:D,spine:s,pelvis:b,lower_extremity:g}=ae(t),S=P(le),E=P([]),L=(G,I,V)=>{document.querySelectorAll("#".concat(G," path")).forEach(_=>{_.classList.toggle("white-fill")}),document.querySelectorAll("#".concat(I," line")).forEach(_=>{_.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(I," rect")).forEach(_=>{_.classList.toggle("bright-green-fill"),_.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(I," path")).forEach(_=>{_.classList.toggle("dark-green-fill")}),document.querySelectorAll("#".concat(I," circle")).forEach(_=>{_.classList.toggle("bright-green-fill")});const j=E.value.findIndex(_=>_.id===V);j>=0?E.value.splice(j,1):E.value.unshift({id:V,active:!0})},z=()=>{const G=document.getElementById("SPINE");G.style.display==="none"||G.style.display==""?G.style.display="block":G.style.display="none",L("SPINE","SPINE_LABEL-2","spine")};return _e(()=>{const G=document.getElementById("HEAD");G&&G.addEventListener("click",()=>{L("HEAD","LABEL-6","head")});const I=document.getElementById("NECK");I&&I.addEventListener("click",()=>{L("NECK","LABEL-5","neck")});const V=document.getElementById("CHEST");V&&V.addEventListener("click",()=>{L("CHEST","LABEL-4","chest")});const j=document.getElementById("ABDOMEN_LABEL");j&&j.addEventListener("click",()=>{const R=document.getElementById("ABDOMEN-2");R.style.display==="none"||R.style.display==""?R.style.display="block":R.style.display="none",L("ABDOMEN","ABDOMEN_LABEL-2","abdomen")});const _=document.getElementById("UPPER_EXTRMITY");_&&_.addEventListener("click",()=>{L("UPPER_EXTRMITY","LABEL-3","upper_extremity")});const A=document.getElementById("SPINE"),y=document.getElementById("SPINE_LABEL"),u=document.getElementById("LOWER_SPINE_INACTIVE");A&&A.addEventListener("click",()=>{z()}),y&&y.addEventListener("click",()=>{z()}),u&&u.addEventListener("click",()=>{z()});const w=document.getElementById("PELVIS");w&&w.addEventListener("click",()=>{L("PELVIS","LABEL-2","pelvis")});const C=document.getElementById("LOWER_EXTREMITY");C&&C.addEventListener("click",()=>{L("LOWER_EXTREMITY","LABEL","lower_extremity")})}),(G,I)=>{const V=k("ion-col"),j=k("ion-row");return v(),Z(j,null,{default:o(()=>[n(V,{size:"7"},{default:o(()=>[h("div",{innerHTML:S.value.full_body_sk},null,8,ea)]),_:1}),n(V,{size:"5",class:"form-column"},{default:o(()=>[h("div",ta,[(v(!0),O(he,null,Te(E.value,_=>(v(),O(he,null,[_.id==="head"?(v(),O("div",na,[I[0]||(I[0]=h("h6",null,"Body Part: Head",-1)),n(ie,{contentData:p(a)},null,8,["contentData"])])):_.id==="neck"?(v(),O("div",aa,[I[1]||(I[1]=h("h6",null,"Body Part: Neck",-1)),n(ie,{contentData:p(l)},null,8,["contentData"])])):_.id==="chest"?(v(),O("div",sa,[I[2]||(I[2]=h("h6",null,"Body Part: Chest",-1)),n(ie,{contentData:p(d)},null,8,["contentData"])])):_.id==="abdomen"?(v(),O("div",ia,[I[3]||(I[3]=h("h6",null,"Body Part: Abdomen",-1)),n(ie,{contentData:p(r)},null,8,["contentData"])])):_.id==="upper_extremity"?(v(),O("div",oa,[I[4]||(I[4]=h("h6",null,"Body Part: Upper Extremity",-1)),n(ie,{contentData:p(D)},null,8,["contentData"])])):_.id==="spine"?(v(),O("div",ra,[I[5]||(I[5]=h("h6",null,"Body Part: Spine",-1)),n(ie,{contentData:p(s)},null,8,["contentData"])])):_.id==="pelvis"?(v(),O("div",la,[I[6]||(I[6]=h("h6",null,"Body Part: Pelvis",-1)),n(ie,{contentData:p(b)},null,8,["contentData"])])):_.id==="lower_extremity"?(v(),O("div",da,[I[7]||(I[7]=h("h6",null,"Body Part: Lower Extremity",-1)),n(ie,{contentData:p(g)},null,8,["contentData"])])):F("",!0)],64))),256))])]),_:1})]),_:1})}}}),Rt=de(ca,[["__scopeId","data-v-5ab54fe8"]]),ua=ee({name:"Menu",mixins:[Ht],components:{IonContent:ze,IonHeader:ot,IonItem:fe,IonList:Ge,IonMenu:it,IonTitle:st,IonToolbar:at,IonInput:ke,IonPopover:Dt,DashBox:dt,SelectionPopover:Ot,BasicInputField:lt,BasicForm:ie,List:rt,DynamicButton:Be,LabOrdersList:Pt,RadiologyInvestigation:Rt},data(){return{segmentContent:"Lab Investigations",iconsContent:le,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",testResult:"",test:"",labOrders:"",filteredSpecimen:"",testData:[],popoverOpen:!1,labOrderStatus:!1,event:"",specimen:"",radiologyOrdersStatus:!1,otherOrdersStatus:!1}},setup(){return{checkmark:St,pulseOutline:bt}},computed:{...ge(Ne,["investigations"]),...ge(Ie,["patient"]),inputFields(){return this.investigations[0].data.rowData[0].colData}},watch:{investigations:{handler(){this.setDashedBox()},deep:!0},patient:{async handler(){var e;(e=this.patient)!=null&&e.labOrders&&(this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved])},deep:!0},$route:{async handler(){await this.getTests()},deep:!0}},async mounted(){await this.getTests(),this.updateInvestigationsStores(),this.setDashedBox(),this.updateInvestigationWizard()},methods:{setSegmentContent(e){this.segmentContent=e},async getTests(){let e;x.getPouchDbStatus()&&x.getLanConnectionStatus()?e=await xe("test_types"):e=await pe.getTestTypes(),B(this.investigations,"test","multiSelectData",e)},toggleLabOrderStatus(){this.labOrderStatus=!this.labOrderStatus},async updateInvestigationWizard(){var t;if(!((t=this.patient)!=null&&t.labOrders))return;this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved];const e=await this.labOrders.filter(a=>H.toStandardHisFormat(H.sessionDate())===H.toStandardHisFormat(a.order_date));e.length>0?this.investigations[0].selectedData=e:this.investigations[0].selectedData=""},async updateInvestigationsStores(){await this.updateInvestigationWizard(),Ne().setInvestigations(this.investigations)},displayInputFields(){this.testResult="",this.selectedText="",this.no_item=!1,this.addItemButton=!1,this.search_item=!0},async validateRowData(){return Ue(this.investigations)},async checkTest(){return await this.isNameInData(this.inputFields[0].value.name,await this.investigations[0].selectedData)?(B(this.investigations,"test","alertsErrorMassage","Lab order already selected"),!1):(B(this.investigations,"test","alertsErrorMassage",""),!0)},async addNewRow(){Ue(this.investigations)&&await this.checkTest()&&(await this.saveTest(),this.investigations[0].data.rowData[0].colData[0].value="",this.investigations[0].data.rowData[0].colData[1].value="",this.search_item=!1,this.display_item=!0,this.addItemButton=!0),this.updateInvestigationWizard()},isNameInData(e,t){for(let a of t)for(let l of a.tests)if(l.name===e)return!0;return!1},async saveTest(){await new Nt().postActivities(this.patient.patientID,[{concept_id:this.inputFields[0].value.concept_id,name:this.inputFields[0].value.name,specimen:this.inputFields[1].value.name,reason:"Routine",specimenConcept:await oe.getConceptID(this.inputFields[1].value.name,!0)}]),B(this.investigations,"specimen","disabled",!0),this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved]},async handleInputData(e){if(e.inputHeader=="Test"&&this.checkTest(),B(this.investigations,"specimen","alertsErrorMassage",""),e.inputHeader=="Test"&&e.value){let t;x.getPouchDbStatus()&&x.getLanConnectionStatus()?t=await xe("specimens"):t=await pe.getSpecimens("",1e3),this.specimen=await oe.getConceptSet(e.value.name,"",{names:t.map(a=>a.name)}),this.specimen.length==1?(B(this.investigations,"specimen","value",this.specimen[0]),B(this.investigations,"specimen","disabled",!0)):(B(this.investigations,"specimen","value",""),B(this.investigations,"specimen","disabled",!1)),B(this.investigations,"specimen","multiSelectData",this.specimen)}},async filterTest(e){return await this.labOrders.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()))},async filterSpecimen(e){var t;return(t=this.specimen[0])!=null&&t.name&&e?await this.specimen.filter(a=>a==null?void 0:a.name.toLowerCase().includes(e.toLowerCase())):[]},setTest(e){this.selectedText=e.name,this.inputFields[1].inputHeader=="Test"?this.investigations[0].data.rowData[0].colData[0].value=e.name:this.investigations[0].data.rowData[0].colData[1].value=e.name,this.updateInvestigationsStores()},setDashedBox(){(this.inputFields[1].value||this.inputFields[0].value)&&(this.addItemButton=!1,this.search_item=!0,this.no_item=!1),this.investigations[0].selectedData.length>0?(this.display_item=!0,this.no_item=!1):this.search_item||(this.no_item=!0)}}}),pa={class:"background"},ma={key:0},ga={key:1},ha={key:2},fa={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},va={key:3},_a={class:"ion-padding",slot:"content"},ya={key:4};function Da(e,t,a,l,d,r){const D=k("ion-label"),s=k("ion-segment-button"),b=k("ion-segment"),g=k("VisitsHistory"),S=k("LabOrdersList"),E=k("RadiologyInvestigation");return v(),O("div",pa,[n(b,{value:e.segmentContent,style:{"margin-top":"5px"}},{default:o(()=>[n(s,{value:"Lab Investigations",onClick:t[0]||(t[0]=L=>e.setSegmentContent("Lab Investigations"))},{default:o(()=>[n(D,null,{default:o(()=>[...t[3]||(t[3]=[Y("Lab Investigations",-1)])]),_:1})]),_:1}),n(s,{value:"Radiology Investigation",onClick:t[1]||(t[1]=L=>e.setSegmentContent("Radiology Investigation"))},{default:o(()=>[n(D,null,{default:o(()=>[...t[4]||(t[4]=[Y("Radiology Investigation",-1)])]),_:1})]),_:1}),n(s,{value:"Other Investigation",onClick:t[2]||(t[2]=L=>e.setSegmentContent("Other Investigation"))},{default:o(()=>[n(D,null,{default:o(()=>[...t[5]||(t[5]=[Y("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),e.segmentContent=="Radiology Investigation"?(v(),O("div",ma,[n(g)])):F("",!0),e.segmentContent=="Other Investigation"?(v(),O("div",ga)):F("",!0),e.segmentContent=="Lab Investigations"?(v(),O("div",ha,[h("div",fa,[h("span",null,[n(S,{propOrders:e.labOrders},null,8,["propOrders"])])])])):F("",!0),e.segmentContent=="Radiology Investigation"?(v(),O("div",va,[h("div",_a,[n(E)])])):F("",!0),e.segmentContent=="Other Investigation"?(v(),O("div",ya)):F("",!0)])}const Fs=de(ua,[["render",Da],["__scopeId","data-v-0803dcda"]]),ba=ee({created(){},components:{IonItem:fe,IonCol:ue,IonLabel:Pe,IonIcon:tt},data(){return{iconsContent:le,localMedicalDrugsList:[...this.$props._selectedMedicalDrugsList]}},props:{_selectedMedicalDrugsList:{type:Array,default:[]},show_actions_buttons:{type:Boolean,default:!0},highLightBackground:{type:String,default:"item-native"}},watch:{},methods:{highlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#006401"),this.highlightActionBtns(e)},undoHighlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#636363"),this.undohighlightActionBtns(e)},highlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let a=0;a<t.length;a++)t[a].style.display="inline-block"},undohighlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let a=0;a<t.length;a++)t[a].style.display="none"},asignLblID(e){return e+"_lbl"},asignSpanLblID(e){return e+"_spanlbl"},async removeItemAtIndex(e,t){await tn("Do you want to delete it?",t)&&this.$emit("remove-item",e)},editItemAtIndex(e){this.$emit("edit-item",e)},highLightBnd(e){if(e){if(e.highlightbackground!==void 0&&e.highlightbackground==!0)return this.$props.highLightBackground}else return!1}}}),Sa=["onMousemove","onMouseout"],Ia={class:"route-label"};function Ca(e,t,a,l,d,r){const D=k("ion-label"),s=k("ion-col"),b=k("ion-row"),g=k("ion-icon");return v(!0),O(he,null,Te(e.localMedicalDrugsList,(S,E)=>(v(),O("div",{id:"df",class:"medication-item",key:E,onMousemove:L=>e.highlightItem(E),onMouseout:L=>e.undoHighlightItem(E)},[n(b,{class:"medication-header"},{default:o(()=>[n(s,{class:be(["ion-text-wrap",e.highLightBnd(S)])},{default:o(()=>[n(D,{id:e.asignLblID(E),class:"medication-name"},{default:o(()=>[Y(W(S.drugName),1)]),_:2},1032,["id"])]),_:2},1032,["class"])]),_:2},1024),n(b,{class:"medication-details"},{default:o(()=>[n(s,{size:"10",class:be(["ion-text-wrap details-col",e.highLightBnd(S)])},{default:o(()=>[n(D,{class:"details-text"},{default:o(()=>[Y(W(S.dose)+" / "+W(S.frequency)+" / daily / "+W(S.duration)+" / until "+W(S.prescription)+" ",1),h("span",Ia,W(S.route_name),1)]),_:2},1024)]),_:2},1032,["class"]),e.show_actions_buttons?(v(),Z(s,{key:0,class:be([e.highLightBnd(S),"actions-col"]),size:"2"},{default:o(()=>[n(D,{class:be(["action-button",e.asignSpanLblID(E)]),onClick:L=>e.editItemAtIndex(E)},{default:o(()=>[n(g,{icon:e.iconsContent.edit},null,8,["icon"])]),_:1},8,["class","onClick"]),n(D,{class:be(["action-button",e.asignSpanLblID(E)]),onClick:L=>e.removeItemAtIndex(E,L)},{default:o(()=>[n(g,{icon:e.iconsContent.delete},null,8,["icon"])]),_:1},8,["class","onClick"])]),_:2},1032,["class"])):F("",!0)]),_:2},1024)],40,Sa))),128)}const Vs=de(ba,[["render",Ca],["__scopeId","data-v-01c693a3"]]),Aa={key:0,class:"custom-allergy-container"},wa={class:"button-group"},Oa=ee({watch:{},name:"AllergiesComponent"}),Ea=ee({...Oa,setup(e){const t=Et(),a=Ie(),l=me(()=>t.selectedMedicalAllergiesList),d=me(()=>a.patient),r=me(()=>t.medicalAllergiesList),D=P(I(8,"item-")),s=P(""),b=P(!1),g=[{multi_Selection:!0,show_list_label:!0,unqueId:D.value,name_of_list:"Add/Remove allergies",placeHolder:"Search for an allergy",items:[],listUpdatedFN:L,listFilteredFN:()=>{},searchTextFN:z,use_internal_filter:!0,show_error:P(!1),error_message:"please select a User",disabled:P(!1)}],S=P(!1);_e(async()=>{E()});const E=()=>{t.current_patient.ID!=d.value.ID&&(t.clearSelectedMedicalAllergiesList(),t.setCurrentPatient(d.value))};function L(_){_.forEach(A=>{A.selected==!0&&A.name==="Other"&&(b.value=A.name==="Other"),A.selected==!1&&A.name==="Other"&&j()}),t.setSelectedMedicalAllergiesList(_),G()}async function z(_){const A=_,y=await oe.getConceptSet("OPD Medication",A);if(!y)return;y.map(R=>({label:R.name,value:R.name,other:R}));const u=nn(A),C=an(u,y).sort((R,te)=>R.name.localeCompare(te.name));t.setMedicalAllergiesList(C),G()}function G(){const _=r.value;l.value.forEach(y=>{let u=!1;_.forEach((w,C)=>{w.concept_id==y.concept_id&&y.selected===!0&&(_[C]=y,u=!0)}),!u&&y.selected===!0&&_.push(y)});const A=_.filter((y,u,w)=>u===w.findIndex(C=>(C==null?void 0:C.concept_id)===(y==null?void 0:y.concept_id)));t.setMedicalAllergiesList(A)}function I(_=8,A=""){const y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let u=A;for(let w=0;w<_;w++)u+=y.charAt(Math.floor(Math.random()*y.length));return u+="-".concat(Date.now()),u}async function V(_){try{const A=_.trim();if(A){const y={name:A,selected:!0,concept_id:I(8,"12"),concept_name_id:I(8,"34")};t.setMedicalAllergiesList([...r.value,y]),t.setSelectedMedicalAllergiesList(y),b.value=!1,S.value=!0,s.value="";const u=t.findSelectedAllergyByName("Other");t.unselectOther(u)}}catch(A){console.error(A)}}const j=()=>{b.value=!1,s.value="",S.value=!1;const _=t.findSelectedAllergyByName("Other");_&&t.unselectOther(_)};return(_,A)=>(v(),Z(p(It),null,{default:o(()=>[n(p(zt),null,{default:o(()=>[n(p(Pe),{class:"header-container"},{default:o(()=>[n(p(tt),{icon:p(Wt),class:"allergy-icon"},null,8,["icon"]),A[3]||(A[3]=h("span",{style:{"font-size":"16px","font-weight":"600"}}," Allergies (Medication, Healthcare items, Environment and Food) ",-1))]),_:1})]),_:1}),n(p(Ct),null,{default:o(()=>[n(sn,{multiSelection:g[0].multi_Selection,show_label:g[0].show_list_label,uniqueId:g[0].unqueId,name_of_list:g[0].name_of_list,choose_place_holder:g[0].placeHolder,"items_-list":r.value,use_internal_filter:g[0].use_internal_filter,disabled:g[0].disabled.value,onItemListUpDated:g[0].listUpdatedFN,onItemListFiltered:g[0].listFilteredFN,onItemSearchText:g[0].searchTextFN},null,8,["multiSelection","show_label","uniqueId","name_of_list","choose_place_holder","items_-list","use_internal_filter","disabled","onItemListUpDated","onItemListFiltered","onItemSearchText"]),b.value?(v(),O("div",Aa,[n(p(ke),{modelValue:s.value,"onUpdate:modelValue":A[0]||(A[0]=y=>s.value=y),placeholder:"Please specify the allergy",fill:"outline",class:"custom-input"},null,8,["modelValue"]),h("div",wa,[n(p(pt),{onClick:A[1]||(A[1]=y=>V(s.value)),class:"addCustomAllergyBtn"},{default:o(()=>[...A[4]||(A[4]=[Y(" Add Allergy ",-1)])]),_:1}),n(p(pt),{onClick:A[2]||(A[2]=y=>j()),fill:"clear",class:"cancelBtn"},{default:o(()=>[n(p(tt),{icon:p(At),slot:"icon-only"},null,8,["icon"])]),_:1})])])):F("",!0)]),_:1})]),_:1}))}}),xs=de(Ea,[["__scopeId","data-v-3314535a"]]),La={class:"checklist-container"},Ta=ee({watch:{},name:"xxxComponent"}),ka=ee({...Ta,setup(e){const t=Ie(),a=me(()=>t.patient),l=Bt(),d=l.items;_e(async()=>{r()});const r=()=>{l.current_patient.ID!=a.value.ID&&(l.clearSelectednonPharmaTherapyStore(),l.setCurrentPatient(a.value))};return Q(()=>a.value,async D=>{}),(D,s)=>(v(),O("div",La,[(v(!0),O(he,null,Te(p(d),b=>(v(),Z(p(fe),{key:b.id,class:"no-border"},{default:o(()=>[n(p(wt),{id:b.id,modelValue:b.checked,"onUpdate:modelValue":g=>b.checked=g,slot:"start"},null,8,["id","modelValue","onUpdate:modelValue"]),n(p(Pe),{style:{"font-size":"16px","font-weight":"600"}},{default:o(()=>[Y(W(b.label),1)]),_:2},1024)]),_:2},1024))),128))]))}}),Us=de(ka,[["__scopeId","data-v-371e920f"]]),Pa=ee({components:{IonContent:ze,IonHeader:ot,IonItem:fe,IonList:Ge,IonMenu:it,IonTitle:st,IonToolbar:at,BasicInputField:lt,IonDatetime:Yt,IonBadge:qt,DateInputField:Wn,DynamicButton:Be},props:{showPeripheral:{type:Boolean,default:!0}},setup(e){const t=Ke(),a=P(0),l=me(()=>t.getDisabledDates()),d=me(()=>t.getAssignedAppointments()),r=P(),D=me(()=>e.showPeripheral);return{disabledDates:l,datesCounts:d,appointment_count:a,calendarOutline:jt,inputPRDate:r,show_peripheral:D}},data(){return re(),ft(),{iconsContent:le,date:new Date(x.getSessionDate()),tomorrow:new Date(x.getSessionDate()).getDate()+1,appointment:"",drugRunoutDate:"",nextAppointmentDate:"",minDate:new Date(x.getSessionDate())}},computed:{...ge(re,["nextAppointment","appointmentCountsCache","currentSelectedNextAppointmentDate"]),...ge(Ke,["maximumNumberOfDaysForEachDay","assignedAppointmentsDates"]),...ge(Ie,["patient"]),...ge(ft,["activeProgram"]),calendarDate(){const e=re();return e.currentSelectedNextAppointmentDate?H.toStandardHisDisplayFormat(e.currentSelectedNextAppointmentDate):""},runOutDate(){var t;const e=re();return((t=this.activeProgram)==null?void 0:t.program_id)===14?yt():e.getAppointmentMedicationRunOutDate()}},watch:{calendarDate:{handler(){this.updateNextAppointment()},deep:!0},"$service.sessionDate":{handler(){this.updateMinDate()},immediate:!0},"patient.ID":{async handler(e,t){e!==t&&(this.cleanCurrentNextAppointmentDate(),this.checkIfSamePatientInContext(),this.clearNextAppointment())}}},async mounted(){this.checkIfSamePatientInContext(),await this.getAppointmentMents(this.runOutDate.date),await dn().loadGlobalProperty(),this.validateAppointmentCountsCache(),await this.preloadAppointmentCounts(),cn();const e=x.getUserID(),t=new Tt;this.appointment=new Me(t.getID(),e),this.nextAppointmentDate=this.appointment.date,this.supposedRunOutDate(),window.addEventListener("storage",this.handleStorageChange),yt()},beforeUnmount(){window.removeEventListener("storage",this.handleStorageChange)},methods:{handleStorageChange(e){e.key==="sessionDate"&&this.updateMinDate()},updateMinDate(){this.date=new Date(x.getSessionDate()),this.minDate=new Date(x.getSessionDate())},updateNextAppointment(){re().setNextAppointment(this.calendarDate)},async handleDateUpdate(e){e&&(Ke().setAssignedAppointmentsDates(e,!0),this.calendarDate=H.toStandardHisDisplayFormat(e),await this.save(),await this.getAppointmentMents(e),await this.updateAppointmentCache(e),re().setCurrentSelectedNextAppointmentDate(e,this.patient.ID))},async getAppointmentMents(e){if(Lt().apiStatus)try{const a=await Me.getDailyAppointments(H.toStandardHisFormat(e),H.toStandardHisFormat(e));this.appointment_count=a.length}catch(a){}},getCounter(e){const t=H.toStandardHisFormat(e);return this.appointmentCountsCache[t]||""},async save(){if(this.assignedAppointmentsDates.length>0)try{const t=await new zn().createOfflineAppointment()}catch(e){}},async openCornfirmModal(e){this.calendarDate=H.toStandardHisDisplayFormat(e),await this.getAppointmentMents(e),rn(ln,{class:"otherVitalsModal"},!0,{message:"Are you sure you want to add this Appointment?"},{cancel:d=>{},confirm:async d=>{d.detail==!0&&await this.handleDateUpdate(e)}})},async handleInput(e){this.inputPRDate=H.toStandardHisDisplayFormat(e),await this.openCornfirmModal(e)},async supposedRunOutDate(){await on.getLastDrugsReceived(this.patient.patientID)},async preloadAppointmentCounts(){try{const e=new Date(x.getSessionDate());e.setDate(1);const t=new Date(x.getSessionDate());t.setMonth(t.getMonth()+2),t.setDate(0);try{const a=await Me.getDailyAppointments(H.toStandardHisFormat(e),H.toStandardHisFormat(t));if(!a)return;const l=this.filterUniqueAppointments(a),d={};l.forEach(r=>{const D=new Date(r.appointment_date),s=H.toStandardHisFormat(D);d[s]||(d[s]=0),d[s]++}),Object.keys(d).forEach(r=>{this.appointmentCountsCache[r]=d[r]})}catch(a){console.error("Error fetching appointments for date range:",a)}}catch(e){console.error("Error in preload process:",e)}},filterUniqueAppointments(e){const t=new Map;return e.forEach(a=>{const l="".concat(a.given_name,"_").concat(a.family_name,"_").concat(a.birthdate,"_").concat(a.appointment_date);t.has(l)||t.set(l,a)}),Array.from(t.values())},async updateAppointmentCache(e){try{const t=H.toStandardHisFormat(e),a=await Me.getDailyAppointments(H.toStandardHisFormat(e),H.toStandardHisFormat(e));if(!a)return;this.appointmentCountsCache[t]=a.length}catch(t){console.error("Error updating appointment cache:",t)}},validateAppointmentCountsCache(){re().checkCurrentLocationIfInContext()},isRunOutDate(e){return!this.runOutDate||!this.runOutDate.date?!1:H.toStandardHisFormat(e)===H.toStandardHisFormat(this.runOutDate.date)},cleanCurrentNextAppointmentDate(){re().cleanCurrentSelectedNextAppointmentDate()},checkIfSamePatientInContext(){const e=re();e.current_patient.ID!=this.patient.ID&&(this.cleanCurrentNextAppointmentDate(),e.setCurrentPatient(this.patient))},clearNextAppointment(){re().clearAppointmentMedicationRunOutDate()}}}),Ba={class:"card_content"},Na={class:"count-badge"},Ha={class:"dates_title"},Ra={class:"sub_data"},$a={class:"dates_title"},Ma={class:"sub_data"},Fa={class:"dates_title"},Va={class:"sub_data"},xa={class:"dates_title"},Ua={class:"sub_data"};function Ga(e,t,a,l,d,r){const D=k("VueDatePicker"),s=k("ion-col"),b=k("DynamicButton"),g=k("ion-item"),S=k("ion-row"),E=k("DateInputField");return v(),O("div",Ba,[n(S,null,{default:o(()=>[n(s,{"size-sm":"12","size-md":"12","size-lg":"12","size-xl":"8"},{default:o(()=>[n(D,{class:"calender",onDateUpdate:e.openCornfirmModal,inline:"","auto-apply":"","enable-time-picker":!1,"disabled-dates":e.disabledDates,"min-date":e.minDate,modelValue:e.runOutDate.date,"onUpdate:modelValue":t[0]||(t[0]=L=>e.runOutDate.date=L)},{day:o(({day:L,date:z})=>[(v(),O("p",{key:0,class:be({"run-out-date":e.isRunOutDate(z)}),style:{"font-weight":"600","font-size":"20px"}},[h("span",null,[Y(W(L),1),h("sup",Na,W(e.getCounter(z)),1)])],2))]),_:1},8,["onDateUpdate","disabled-dates","min-date","modelValue"])]),_:1}),e.show_peripheral?(v(),Z(s,{key:0},{default:o(()=>[n(g,null,{default:o(()=>[h("div",Ha,[t[3]||(t[3]=h("div",null,[Y("Suggested Next Appointment Date "),h("span",{style:{"font-size":"16px"}},"(Medication run out date)")],-1)),h("div",Ra,[Y(W(e.runOutDate.formattedDate||"No run out date available")+" ",1),e.runOutDate.formattedDate?(v(),Z(b,{key:0,onClick:t[1]||(t[1]=L=>e.handleDateUpdate(e.runOutDate.date)),name:"Set Next Appt.",fill:"solid",iconSlot:"icon-only",style:{float:"right"}})):F("",!0)])])]),_:1}),n(g,null,{default:o(()=>[h("div",$a,[t[4]||(t[4]=h("div",null,"User set appointment date",-1)),h("div",Ma,W(e.calendarDate),1)])]),_:1}),n(g,null,{default:o(()=>[h("div",Fa,[t[5]||(t[5]=h("div",null,"Appointments",-1)),h("div",Va,W(e.appointment_count),1)])]),_:1}),n(g,null,{default:o(()=>[h("div",xa,[t[6]||(t[6]=h("div",null,"Appointment limit (per/day)",-1)),h("div",Ua,W(e.appointment_count)+"/"+W(e.maximumNumberOfDaysForEachDay),1)])]),_:1})]),_:1})):F("",!0)]),_:1}),e.show_peripheral?(v(),Z(S,{key:0},{default:o(()=>[n(s,{size:"4"},{default:o(()=>[n(E,{inputHeader:"Preferred Next Appointment Date",bold:"600",fontSize:"17px",placeholderFontSize:"17px",placeholderFontWeight:"600",unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.inputPRDate,eventType:"",minDate:e.minDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t[2]||(t[2]=L=>e.handleInput(L))},null,8,["icon","inputValue","minDate"])]),_:1})]),_:1})):F("",!0)])}const Gs=de(Pa,[["render",Ga],["__scopeId","data-v-4e58e0bc"]]),za={class:"modal_wrapper"},Wa={class:"uniform_columns"},qa=ee({__name:"AHDPastMedicalHistory",setup(e,{expose:t}){const a=un(),{pastMedicalHistory:l}=ae(a),d=P([]);_e(()=>{d.value=a.getInitial(),r()}),Q(l,()=>{r()},{deep:!0});const r=()=>{var S;const g=["TB","Chronic Obstructive Pulmonary Disease (COPD)","Asthma","Epilepsy","Previous stroke","Peptic Ulcer Disease (PUD)","Mental disorder","Bleeding disorders","Hypertension","HIV Positive","Diabetes Mellitus"];(S=pn(l.value,"None"))!=null&&S.checked?g.forEach(E=>{Le(l.value,"TB treatment","displayNone",!0),B(l.value,"TB drugs","displayNone",!0),B(l.value,"TB drug start date","displayNone",!0),Le(l.value,"Hypertension medication","displayNone",!0),B(l.value,"Current hypertension treatment regimen","displayNone",!0),Le(l.value,"HIV status","displayNone",!0),B(l.value,"ARV start date","displayNone",!0),Le(l.value,"Diabetes","displayNone",!0),Le(l.value,"Controlled by","displayNone",!0),Qe(l.value,E,"checked",!1),Qe(l.value,E,"disabled",!0)}):g.forEach(E=>{Qe(l.value,E,"disabled",!1)})},D=g=>{B(l.value,"TB drugs","popOverData",{filterData:!0,data:[{name:"Auramine 'O' (C.I. 41000) 50g"},{name:"Bedaquilline 100mg"},{name:"Clofazimine 100mg"},{name:"Clofazimine 50mg"},{name:"Cycloserine 125mg"},{name:"Cycloserine 250mg"},{name:"Delamanid 50mg"},{name:"Ethambutol 100mg"},{name:"Ethambutol 400mg"},{name:"Ethionamide 250mg"},{name:"Isoniazid 100mg "},{name:"Isoniazid 300mg"},{name:"Isoniazid / Rifapentine 300mg / 300mg"},{name:"Levofloxacin 100mg"},{name:"Levofloxacin 250mg"},{name:"Linezolid 600mg"},{name:"Moxifloxacin 400mg"},{name:"Pyrazinamide 400mg"},{name:"Rifabutin 150mg Capsules"},{name:"Rifampicin 150mg/isoniazid 75mg"},{name:"Rifampicin 75mg+INH 50mg dispersible"},{name:"Rifampicin 75mg+INH 50mg+Pyrazinamide 150mg dispersible"},{name:"Rifampicin150mg/Isoniazid75mg/Pyrazinamide 400mg/Ethambutol"}]}),B(l.value,"Current hypertension treatment regimen","popOverData",{filterData:!0,data:[{name:"Captopril 12.5mg"},{name:"Aspirin 75mg"},{name:"Hydrochlorothiazide 25mg"},{name:"Enalapril Meleate 5mg"},{name:"Enalapril Maleate 10mg"}]})},s=async()=>[...await qn(l.value),...await Yn(l.value),...await nt(l.value)];return t({onSubmit:async()=>{const g=await s();if(g.length===0){ve("No past medical history data to save");return}await kt.addObsToEncounterPatient(g,We.AHD_PAST_MEDICAL_HISTORY),Se("Past medical history saved successful")}}),(g,S)=>(v(),O("div",za,[h("div",Wa,[n(ie,{contentData:p(l),initialData:d.value,"onUpdate:inputValue":D,"onUpdate:selected":D},null,8,["contentData","initialData"])])]))}}),Ya=de(qa,[["__scopeId","data-v-e5153372"]]),ja=ee({name:"Menu",mixins:[Ht],components:{IonContent:ze,IonHeader:ot,IonItem:fe,IonList:Ge,IonMenu:it,IonTitle:st,IonToolbar:at,IonInput:ke,IonPopover:Dt,DashBox:dt,SelectionPopover:Ot,BasicInputField:lt,BasicForm:ie,List:rt,DynamicButton:Be,LabOrdersList:Pt,RadiologyInvestigation:Rt},data(){return{segmentContent:"Lab Investigations",iconsContent:le,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",testResult:"",test:"",labOrders:"",filteredSpecimen:"",testData:[],popoverOpen:!1,labOrderStatus:!1,event:"",specimen:"",radiologyOrdersStatus:!1,otherOrdersStatus:!1}},setup(){return{checkmark:St,pulseOutline:bt}},computed:{...ge(Ne,["investigations"]),...ge(Ie,["patient"]),inputFields(){return this.investigations[0].data.rowData[0].colData}},watch:{investigations:{handler(){this.setDashedBox()},deep:!0},patient:{async handler(){var e;(e=this.patient)!=null&&e.labOrders&&(this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved])},deep:!0},$route:{async handler(){await this.getTests()},deep:!0}},async mounted(){await this.getTests(),this.updateInvestigationsStores(),this.setDashedBox(),this.updateInvestigationWizard()},methods:{setSegmentContent(e){this.segmentContent=e},async getTests(){let e;x.getPouchDbStatus()&&x.getLanConnectionStatus()?e=await xe("test_types"):e=await pe.getTestTypes(),B(this.investigations,"test","multiSelectData",e)},toggleLabOrderStatus(){this.labOrderStatus=!this.labOrderStatus},async updateInvestigationWizard(){var t;if(!((t=this.patient)!=null&&t.labOrders))return;this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved];const e=await this.labOrders.filter(a=>H.toStandardHisFormat(H.sessionDate())===H.toStandardHisFormat(a.order_date));e.length>0?this.investigations[0].selectedData=e:this.investigations[0].selectedData=""},async updateInvestigationsStores(){await this.updateInvestigationWizard(),Ne().setInvestigations(this.investigations)},displayInputFields(){this.testResult="",this.selectedText="",this.no_item=!1,this.addItemButton=!1,this.search_item=!0},async validateRowData(){return Ue(this.investigations)},async checkTest(){return await this.isNameInData(this.inputFields[0].value.name,await this.investigations[0].selectedData)?(B(this.investigations,"test","alertsErrorMassage","Lab order already selected"),!1):(B(this.investigations,"test","alertsErrorMassage",""),!0)},async addNewRow(){Ue(this.investigations)&&await this.checkTest()&&(await this.saveTest(),this.investigations[0].data.rowData[0].colData[0].value="",this.investigations[0].data.rowData[0].colData[1].value="",this.search_item=!1,this.display_item=!0,this.addItemButton=!0),this.updateInvestigationWizard()},isNameInData(e,t){for(let a of t)for(let l of a.tests)if(l.name===e)return!0;return!1},async saveTest(){await new Nt().postAHDActivities(this.patient.patientID,[{concept_id:this.inputFields[0].value.concept_id,name:this.inputFields[0].value.name,specimen:this.inputFields[1].value.name,reason:"Routine",specimenConcept:await oe.getConceptID(this.inputFields[1].value.name,!0)}]),B(this.investigations,"specimen","disabled",!0),this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved]},async handleInputData(e){if(e.inputHeader=="Test"&&this.checkTest(),B(this.investigations,"specimen","alertsErrorMassage",""),e.inputHeader=="Test"&&e.value){let t;x.getPouchDbStatus()&&x.getLanConnectionStatus()?t=await xe("specimens"):t=await pe.getSpecimens("",1e3),this.specimen=await oe.getConceptSet(e.value.name,"",{names:t.map(a=>a.name)}),this.specimen.length==1?(B(this.investigations,"specimen","value",this.specimen[0]),B(this.investigations,"specimen","disabled",!0)):(B(this.investigations,"specimen","value",""),B(this.investigations,"specimen","disabled",!1)),B(this.investigations,"specimen","multiSelectData",this.specimen)}},async filterTest(e){return await this.labOrders.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()))},async filterSpecimen(e){var t;return(t=this.specimen[0])!=null&&t.name&&e?await this.specimen.filter(a=>a==null?void 0:a.name.toLowerCase().includes(e.toLowerCase())):[]},setTest(e){this.selectedText=e.name,this.inputFields[1].inputHeader=="Test"?this.investigations[0].data.rowData[0].colData[0].value=e.name:this.investigations[0].data.rowData[0].colData[1].value=e.name,this.updateInvestigationsStores()},setDashedBox(){(this.inputFields[1].value||this.inputFields[0].value)&&(this.addItemButton=!1,this.search_item=!0,this.no_item=!1),this.investigations[0].selectedData.length>0?(this.display_item=!0,this.no_item=!1):this.search_item||(this.no_item=!0)}}}),Ka={class:"background"},Qa={key:0},Xa={key:1},Ja={key:2},Za={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},es={key:3},ts={class:"ion-padding",slot:"content"},ns={key:4};function as(e,t,a,l,d,r){const D=k("ion-label"),s=k("ion-segment-button"),b=k("ion-segment"),g=k("VisitsHistory"),S=k("LabOrdersList"),E=k("RadiologyInvestigation");return v(),O("div",Ka,[n(b,{value:e.segmentContent,style:{"margin-top":"5px"}},{default:o(()=>[n(s,{value:"Lab Investigations",onClick:t[0]||(t[0]=L=>e.setSegmentContent("Lab Investigations"))},{default:o(()=>[n(D,null,{default:o(()=>[...t[3]||(t[3]=[Y("Lab Investigations",-1)])]),_:1})]),_:1}),n(s,{value:"Radiology Investigation",onClick:t[1]||(t[1]=L=>e.setSegmentContent("Radiology Investigation"))},{default:o(()=>[n(D,null,{default:o(()=>[...t[4]||(t[4]=[Y("Radiology Investigation",-1)])]),_:1})]),_:1}),n(s,{value:"Other Investigation",onClick:t[2]||(t[2]=L=>e.setSegmentContent("Other Investigation"))},{default:o(()=>[n(D,null,{default:o(()=>[...t[5]||(t[5]=[Y("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),e.segmentContent=="Radiology Investigation"?(v(),O("div",Qa,[n(g)])):F("",!0),e.segmentContent=="Other Investigation"?(v(),O("div",Xa)):F("",!0),e.segmentContent=="Lab Investigations"?(v(),O("div",Ja,[h("div",Za,[h("span",null,[n(S,{propOrders:e.labOrders},null,8,["propOrders"])])])])):F("",!0),e.segmentContent=="Radiology Investigation"?(v(),O("div",es,[h("div",ts,[n(E)])])):F("",!0),e.segmentContent=="Other Investigation"?(v(),O("div",ns)):F("",!0)])}const ss=de(ja,[["render",as],["__scopeId","data-v-67ff1a61"]]),is={key:0},os={style:{"align-content":"center"}},rs={class:"ion-padding",slot:"content"},ls=ee({__name:"AHDPresentingComplaints",setup(e,{expose:t}){const a=mn(),{presentingComplaints:l}=ae(a),d=P(le),r=P(!0),D=P(!1),s=P(!0),b=P(!1),g=P([]),S=P([]),E=P(),L=me(()=>[{componentType:"multiSelectInputField",header:"Presenting Complaints",name:"PresentingComplaints",trackBy:"concept_id",icon:le.search,hideSelected:!0,validation:u=>_(u==null?void 0:u.name,g.value)?"Presenting complaint already added":Fe.required(u),options:S.value,grid:{s:"6"}},{componentType:"inputField",header:"Duration",name:"duration",icon:le.time,validation:u=>Fe.isNotEmptyandNumber(u),grid:{s:"6"},unitOptions:[{label:"Hours",value:"Hours"},{label:"Days",value:"Days"},{label:"Weeks",value:"Weeks"},{label:"Months",value:"Months"},{label:"Years",value:"Years"}],unitValidation:u=>!u||u===""?"Please select a unit.":null},{componentType:"inputField",header:"Specify the presenting complaint(s)",name:"Other (specify)",icon:le.editPen,validation:u=>_(u,g.value)?"Presenting complaint already added":Fe.required(u),condition:u=>{var w;return((w=u==null?void 0:u.PresentingComplaints)==null?void 0:w.name)==="Other"}},{componentType:"Alert",condition:u=>{var w;return Fe.required((w=u==null?void 0:u.PresentingComplaints)==null?void 0:w.name)!=null},backgroundColor:"lightyellow",textColor:"black",value:"Please search thoroughly for the complaint. If it is not listed, search and select the 'Other' option to specify the complaint.",name:"noMatchAlert"}]),{formRef:z}=gn(),G=async()=>{S.value=await Xn.getComplaintsList("Presenting complaint"),B(l.value,"PresentingComplaints","multiSelectData",S.value)},I=()=>{r.value=!1,s.value=!1,D.value=!0},V=async()=>{var C,R;const u=(C=z.value)==null?void 0:C.getFormValues();((R=z.value)==null?void 0:R.validateForm())==null&&(j(u),D.value=!1,s.value=!0)},j=u=>{var te;const w=u.duration+" "+u.duration_unit,C=u.PresentingComplaints,R=C.name==="Other"?u["Other (specify)"]:C.name;g.value.push({actionBtn:!0,btn:["delete"],name:R,concept_id:C.concept_id,duration:C.duration,durationUnits:C.duration_unit,display:[R,w],data:[{concept_id:8578,value_coded:C.concept_id,obs_datetime:x.getSessionDate(),child:[{concept_id:C.concept_id,value_text:w,obs_datetime:x.getSessionDate()}]}]}),(te=z.value)==null||te.resetForm(),b.value=!0},_=(u,w)=>w.some(C=>C.name===u),A=u=>{g.value=g.value.filter(w=>w.display[0]!==u.name)},y=async()=>{const u=g.value.flatMap(w=>w.data);if(u.length<=0)return ve("Presenting complaints is required");u.length<=0||(await kt.addObsToEncounterPatient(u,We.AHD_PRESENTING_COMPLAINTS),Se("Presenting complaints saved successful"),g.value=[])};return _e(async()=>{await G()}),t({onSubmit:y}),(u,w)=>{const C=k("ion-row"),R=k("ion-label"),te=k("ion-accordion"),Ce=k("ion-accordion-group");return v(),O(he,null,[n(dt,{status:r.value,content:"No presenting complaints added"},null,8,["status"]),b.value?(v(),O("span",is,[n(rt,{listData:g.value,"onClicked:delete":A},null,8,["listData"])])):F("",!0),D.value?(v(),Z(C,{key:1},{default:o(()=>[n(hn,{formData:L.value,ref_key:"formRef",ref:z},null,8,["formData"]),h("div",os,[n(Be,{fill:"clear",icon:d.value.plus,iconSlot:"icon-only","onClicked:btn":w[0]||(w[0]=i=>V()),name:"Save"},null,8,["icon"])])]),_:1})):F("",!0),s.value?(v(),Z(C,{key:2,style:{"margin-top":"10px"}},{default:o(()=>[n(Be,{fill:"clear",icon:d.value.plus,iconSlot:"icon-only","onClicked:btn":w[1]||(w[1]=i=>I()),name:"Add new presenting complaints"},null,8,["icon"])]),_:1})):F("",!0),n(C,null,{default:o(()=>[n(Ce,{ref_key:"accordionGroup",ref:E,class:"previousView"},{default:o(()=>[n(te,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:o(()=>[n(p(fe),{slot:"header",color:"light"},{default:o(()=>[n(R,{class:"previousLabel"},{default:o(()=>[...w[2]||(w[2]=[Y("Previous presenting complaints",-1)])]),_:1})]),_:1}),h("div",rs,[n(Qn)])]),_:1})]),_:1},512)]),_:1})],64)}}}),ds=de(ls,[["__scopeId","data-v-04755951"]]);class et extends Xe{constructor(a,l,d){super(a,We.AHD_HIV_STAGING,d);Ye(this,"age");Ye(this,"confirmatoryTest");this.age=l,this.confirmatoryTest=null}isAdult(){return this.age>=15}isPedaid(){return this.age<=14}setAge(a){this.age=a}getFacilities(a=""){return fn.getFacilities({name:a})}getConfirmatoryTestType(){return this.confirmatoryTest}cd4CountIsValid(a){try{return!!a.match(/^(=|<|>)([0-9]*)$/m)}catch(l){return!1}}getAlertGuidelines(){return vn}getWhoStageGuidelines(){return this.isAdult()?_n:yn}getProgramEligibilityGuidelines(){return this.isAdult()?Dn:bn}getRecommendedConditionGuidelines(){return this.isAdult()?Sn:In}getStagingConditions(a){const l=this.getStagingCategoryByNum(a);return Xe.getConceptsByCategory(l)}buildWhoStageObs(a){return this.buildValueCoded("Who stage",a)}buildWhoCriteriaObs(a){return this.buildValueCoded("Who stages criteria present",a)}buildReasonForArtObs(a){return this.buildValueCoded("Reason for ART eligibility",a)}getStagingCategoryByNum(a){switch(a){case 1:return this.isAdult()?"stage_1_conditions_adults":"stage_1_conditions_pedaids";case 2:return this.isAdult()?"stage_2_conditions_adults":"stage_2_conditions_pedaids";case 3:return this.isAdult()?"stage_3_conditions_adults":"stage_3_conditions_pedaids";case 4:return this.isAdult()?"stage_4_conditions_adults":"stage_4_conditions_pedaids";default:return""}}async loadHivConfirmatoryTestType(){const a=await Xe.getFirstValueCoded(this.patientID,"Confirmatory hiv test type");a&&(this.confirmatoryTest=a)}}const cs={key:0,class:"ion-padding"},us={class:"accordion_group ion-padding"},ps={style:{"font-weight":"bold"}},ms={class:"error"},gs={class:"ion-padding",slot:"content"},hs={class:"ion-padding"},fs={class:"ion-padding"},vs={key:0,class:"ion-padding"},_s={class:"ion-padding",style:{"border-bottom":"dashed #ccc"}},ys=ee({__name:"AHDStaging",props:{hideSubmit:{type:Boolean,default:!1},date:{default:et.getSessionDate()}},setup(e,{expose:t}){const a=e,l=new Tt,d=P({}),r=new et(l.getID(),l.getAge(),-1);Q(()=>a.date,i=>{var N;const c=(N=i==null?void 0:i.standardDate)!=null?N:et.getSessionDate(),m=Ee(c).diff(l.getBirthdate(),"years");r.setAge(m),r.setDate(c)},{deep:!0,immediate:!0});const D=mt({stage_4_conditions:{title:"Stage 4 Conditions",options:[]},stage_3_conditions:{title:"Stage 3 Conditions",options:[]},stage_2_conditions:{title:"Stage 2 Conditions",options:[]},stage_1_conditions:{title:"Stage 1 Conditions",options:[]}}),s=mt({cd4:"",cd4Date:"",isChildBearing:!1,reasonForArt:"",pregnant:"",breastFeeding:"",cd4Available:"",cd4Modifier:"",cd4Location:"",whoStage:"",staging:[],confirmatoryTest:""}),b={reasonForArt:{buildObs:()=>r.buildReasonForArtObs(s.reasonForArt),suggestAvalue:()=>({"PRESUMED SEVERE HIV":{priority:1,condition:()=>l.getAgeInMonths()<12&&s.confirmatoryTest==="HIV rapid test"&&oe.getConceptsByCategory("pshd_condition").some(i=>j().includes(i.name))},"WHO STAGE IV PEDS":{priority:2,condition:()=>r.isPedaid()&&S(["stage_4_conditions"])},"WHO STAGE III PEDS":{priority:3,condition:()=>r.isPedaid()&&S(["stage_3_conditions"])},"HIV DNA polymerase chain reaction":{priority:4,condition:()=>l.getAgeInMonths()<12&&s.confirmatoryTest==="HIV DNA polymerase chain reaction"},"CD4 COUNT LESS THAN OR EQUAL TO 750":{priority:5,condition:()=>I(750)&&V()&&E()&&l.ageInMonths()>=24&&l.ageInMonths()<=56},"CD4 COUNT LESS THAN OR EQUAL TO 500":{priority:6,condition:()=>r.isPedaid()&&I(500)&&V()&&E()},"HIV infected":{priority:7,condition:()=>l.getAgeInMonths()<24||l.getAge()<=5},"WHO STAGE IV ADULT":{priority:1,condition:()=>{const i=oe.getConceptsByCategory("severe_hiv_wasting_syndrome");return r.isAdult()&&(S(["stage_4_conditions"])||i.filter(c=>j().includes(c.name)).length>=2)}},"WHO STAGE III ADULT":{priority:2,condition:()=>r.isAdult()&&S(["stage_3_conditions"])},"cd4 less than or equal to 350":{priority:3,condition:()=>r.isAdult()&&I(350)&&E()},"cd4 less than or equal to 250":{priority:4,condition:()=>r.isAdult()&&I(250)&&E()},"cd4 less than or equal to 500":{priority:4,condition:()=>r.isAdult()&&I(500)&&E()},BREASTFEEDING:{priority:5,condition:()=>r.isAdult()&&s.breastFeeding==="Yes"&&V()},"PATIENT PREGNANT":{priority:6,condition:()=>r.isAdult()&&s.pregnant==="Yes"&&V()},Asymptomatic:{priority:7,condition:()=>V()}})},whoStage:{buildObs:()=>r.buildWhoStageObs(s.whoStage),suggestAvalue:()=>({"WHO STAGE IV ADULT":{priority:1,condition:()=>r.isAdult()&&S(["stage_4_conditions"])},"WHO STAGE III ADULT":{priority:2,condition:()=>r.isAdult()&&S(["stage_3_conditions"])},"WHO STAGE II ADULT":{priority:3,condition:()=>r.isAdult()&&S(["stage_2_conditions"])},"WHO STAGE I ADULT":{priority:4,condition:()=>r.isAdult()&&S(["stage_1_conditions"])},"WHO STAGE IV PEDS":{priority:1,condition:()=>r.isPedaid()&&(S(["stage_4_conditions"])||s.reasonForArt==="WHO STAGE IV PEDS")},"WHO STAGE III PEDS":{priority:2,condition:()=>r.isPedaid()&&S(["stage_3_conditions"])},"WHO STAGE II PEDS":{priority:3,condition:()=>r.isPedaid()&&S(["stage_2_conditions"])},"WHO STAGE I PEDS":{priority:4,condition:()=>r.isPedaid()&&S(["stage_1_conditions"])}})},cd4Available:{required:()=>!0,dataHandler:i=>{i!="Yes"&&(s.cd4="",s.cd4Date=""),d.value.cd4="",d.value.cd4Modifier="",d.value.cd4Date="",d.value.cd4Location=""}},pregnant:{required:()=>s.isChildBearing,buildObs:()=>r.buildValueCoded("Is patient pregnant?",s.pregnant)},breastFeeding:{required:()=>s.isChildBearing,buildObs:()=>r.buildValueCoded("Is patient breast feeding?",s.breastFeeding)},cd4:{required:()=>s.cd4Available==="Yes",validation:()=>{if(!G()){d.value.cd4="A number is required";return}z()>1e4&&(d.value.cd4="CD4 value cannot exceed 10,000")},buildObs:()=>r.buildValueNumber("CD4 count",z(),L())},cd4Modifier:{required:()=>s.cd4Available==="Yes",validation:()=>{s.cd4Modifier||(d.value.cd4Modifier="Please select modifier")},dataHandler:i=>s.cd4Modifier=i,options:[{label:"=",value:"="},{label:">",value:">"},{label:"<",value:"<"}]},cd4Date:{required:()=>s.cd4Available==="Yes",dataHandler:i=>{i&&(s.cd4Date=Ee(i).format("YYYY-MM-DD"))},validation:()=>{if(isNaN(new Date(s.cd4Date).getTime())){d.value.cd4Date="Invalid CD4 date";return}const i=Ee(s.cd4Date);if(i.isAfter(Ee(r.getDate()))){d.value.cd4Date="Cd4 result date can't be greater than ".concat(r.getDate());return}i.isBefore(Ee(l.getBirthdate()))&&(d.value.cd4Date="CD4 date must not be earlier than birthdate")},buildObs:()=>r.buildValueDate("Cd4 count datetime",s.cd4Date)},cd4Location:{required:()=>s.cd4Available==="Yes",dataHandler:i=>s.cd4Location=i,buildObs:()=>r.buildValueText("Cd4 count location",s.cd4Location)},staging:{validation:()=>{if(Object.keys(D).every(N=>u(N)<=0)){d.value.staging="Please select one or more staging conditions";return}const c=["stage_4_conditions","stage_3_conditions","stage_2_conditions"].some(N=>u(N)>0);D.stage_1_conditions.options.some(N=>/asymptomatic/i.test(N.name)&&N.checked)&&c&&(d.value.staging="Asymptomatic cannot be selected with other staging conditions")},buildObs:()=>Object.keys(D).reduce((c,m)=>(D[m].options.forEach(N=>{N.checked&&c.push(N.name)}),c),[]).map(c=>r.buildWhoCriteriaObs(c))}};function g(){Object.keys(s).forEach(i=>{typeof s[i]=="boolean"?s[i]=!1:Array.isArray(s[i])?s[i]=[]:s[i]=""}),Object.keys(d.value).forEach(i=>d.value[i]=""),R()}function S(i){return i.some(c=>u(c)>0)}function E(){return new Date(s.cd4Date)<=new Date("2016-04-30")}function L(){return s.cd4Modifier}function z(){return parseInt("".concat(s.cd4))}function G(){return/^\d+$/i.test("".concat(s.cd4))}function I(i){if(!G())return!1;const c=L(),m=z();return c==="="&&i===m||c==="<"&&m<=i||c===">"&&m>=i}function V(){return S(["stage_2_conditions","stage_1_conditions"])}function j(){return Object.keys(D).reduce((i,c)=>(D[c].options.forEach(m=>m.checked&&i.push(m.name)),i),[])}function _(i){if(d.value[i]="",typeof b[i].required=="function"&&b[i].required()&&!s[i]){d.value[i]="This field is required";return}s[i]&&typeof b[i].validation=="function"&&b[i].validation()}function A(i){var c,m,N;if(b[i]&&"suggestAvalue"in b[i]){s[i]="";const X=b[i].suggestAvalue(),se=Object.keys(X).reduce((ne,$)=>{const Ae=X[$];return typeof Ae.condition=="function"&&Ae.condition()?[...ne,{value:$,priority:Ae.priority}]:ne},[]);s[i]=(N=(m=(c=se.sort((ne,$)=>ne.priority-$.priority))==null?void 0:c[0])==null?void 0:m.value)!=null?N:""}}function y(){return Object.keys(s).reduce((i,c)=>{if(c in b&&s[c]&&typeof b[c].buildObs=="function"){const m=b[c].buildObs();return Array.isArray(m)?[...i,...m]:[...i,m]}return i},[])}function u(i){return D[i].options.filter(c=>c.checked).length}async function w(){await r.loadHivConfirmatoryTestType(),s.confirmatoryTest=r.getConfirmatoryTestType(),s.isChildBearing=l.isChildBearing()}function C(i,c){i in b&&typeof b[i].dataHandler=="function"&&b[i].dataHandler(c),_(i),Object.keys(b).forEach(m=>A(m))}function R(){Object.keys(D).forEach(i=>{var N,X;const c=Number((X=(N=i.match(/\d+/))==null?void 0:N[0])!=null?X:0),m=r.getStagingConditions(c);D[i].options=m.map(se=>({checked:!1,name:se.name,concept_id:se.concept_id}))})}function te(){return Object.keys(b).forEach(i=>_(i)),Object.keys(d.value).every(i=>"".concat(d.value[i]).length<=0)}async function Ce(){if(console.log("Submitting staging"),!te())return ve("Please review form for errors"),!1;try{const i=await Promise.all(y());return await r.createEncounter(),await r.saveObservationList(i),Se("Staging Observations saved!"),!0}catch(i){return console.error(i),En("Error has occured while saving observations"),!1}}return Q(()=>a.date,i=>{r.setDate(i),l.date=i,g()}),_e(async()=>{await w(),R()}),t({validateStagingForm:te,buildPayload:y,onSubmit:Ce}),(i,c)=>(v(),Z(p(It),null,{default:o(()=>[n(p(Ct),null,{default:o(()=>[s.isChildBearing?(v(),O("div",cs,[n(p(je),null,{default:o(()=>[n(p(Oe),null,{default:o(()=>[n(p(ue),null,{default:o(()=>[n(Je,{label:"Pregnant?",modelValue:s.pregnant,"onUpdate:modelValue":c[0]||(c[0]=m=>s.pregnant=m),onIonChange:c[1]||(c[1]=m=>C("pregnant",m)),"error-message":d.value.pregnant},null,8,["modelValue","error-message"])]),_:1}),n(p(ue),null,{default:o(()=>[n(Je,{label:"Breastfeeding?",modelValue:s.breastFeeding,"onUpdate:modelValue":c[2]||(c[2]=m=>s.breastFeeding=m),onOnChange:c[3]||(c[3]=m=>C("breastFeeding",m)),"error-message":d.value.breastFeeding},null,8,["modelValue","error-message"])]),_:1})]),_:1})]),_:1})])):F("",!0),h("div",us,[n(p(Kt),{color:"light"},{default:o(()=>[(v(!0),O(he,null,Te(D,(m,N)=>(v(),Z(p(Qt),{key:N},{default:o(()=>[n(p(fe),{color:"light",slot:"header"},{default:o(()=>[n(p(Pe),{style:{color:"grey","font-size":"17px"},class:"ion-padding"},{default:o(()=>[h("b",ps,[Y(W(m.title)+" ",1),n(p(Xt),{color:u("".concat(N))>0?"primary":void 0},{default:o(()=>[Y(" Selected: "+W(u("".concat(N))),1)]),_:2},1032,["color"])]),h("p",ms,W(d.value.staging),1)]),_:2},1024)]),_:2},1024),h("div",gs,[n(p(Ge),null,{default:o(()=>[(v(!0),O(he,null,Te(m.options,(X,se)=>(v(),Z(p(fe),{key:se},{default:o(()=>[n(p(wt),{modelValue:X.checked,"onUpdate:modelValue":ne=>X.checked=ne,onIonChange:ne=>C("staging",{stage_type:N,raw:ne,option:X})},null,8,["modelValue","onUpdate:modelValue","onIonChange"]),n(p(Pe),{style:{margin:"13px"}},{default:o(()=>[Y(W(X.name),1)]),_:2},1024),c[15]||(c[15]=h("p",null,null,-1)),X.description?(v(),Z(p(Jt),{key:0,color:X.color},{default:o(()=>[Y(W(X.text),1)]),_:2},1032,["color"])):F("",!0)]),_:2},1024))),128))]),_:2},1024)])]),_:2},1024))),128))]),_:1})]),h("div",hs,[h("div",fs,[n(Je,{label:"Recent CD4 count results available?",modelValue:s.cd4Available,"onUpdate:modelValue":c[4]||(c[4]=m=>s.cd4Available=m),onOnChange:c[5]||(c[5]=m=>C("cd4Available",m)),"error-message":d.value.cd4Available},null,8,["modelValue","error-message"])]),s.cd4Available==="Yes"?(v(),O("div",vs,[n(p(je),{class:"ion-padding"},{default:o(()=>[n(p(Oe),null,{default:o(()=>[n(p(ue),null,{default:o(()=>[n(Cn,{label:"CD4 Count Date",modelValue:s.cd4Date,"onUpdate:modelValue":c[6]||(c[6]=m=>s.cd4Date=m),required:s.cd4Available==="Yes","error-message":d.value.cd4Date,onOnChange:c[7]||(c[7]=m=>C("cd4Date",m))},null,8,["modelValue","required","error-message"])]),_:1})]),_:1}),n(p(Oe),null,{default:o(()=>[n(p(ue),{size:"2"},{default:o(()=>[n(An,{label:"CD4 Result Modifier",required:s.cd4Available==="Yes","error-message":d.value.cd4Modifier,options:b.cd4Modifier.options,onOnChange:c[8]||(c[8]=m=>C("cd4Modifier",m.value))},null,8,["required","error-message","options"])]),_:1}),n(p(ue),{size:"10"},{default:o(()=>[n(wn,{label:"CD4 Count",modelValue:s.cd4,"onUpdate:modelValue":c[9]||(c[9]=m=>s.cd4=m),type:"number",onOnChange:c[10]||(c[10]=m=>C("cd4",m)),placeholder:"Enter CD4 Count","error-message":d.value.cd4},null,8,["modelValue","error-message"])]),_:1})]),_:1}),n(p(Oe),{style:{"margin-top":"15px"}},{default:o(()=>[n(p(ue),null,{default:o(()=>[n(On,{label:"CD4 Count Location",modelValue:s.cd4Location,"onUpdate:modelValue":c[11]||(c[11]=m=>s.cd4Location=m),required:s.cd4Available==="Yes","error-message":d.value.cd4Location,show_error:!1,selected_district_ids:[],selected_location:s.cd4Location,onOnChange:c[12]||(c[12]=m=>{C("cd4Location",m)})},null,8,["modelValue","required","error-message","selected_location"])]),_:1})]),_:1})]),_:1})])):F("",!0)]),h("div",_s,[n(p(je),null,{default:o(()=>[n(p(Oe),null,{default:o(()=>[n(p(ue),null,{default:o(()=>[n(p(ke),{readonly:"",placeholder:"N/A",label:"REASON FOR ART:",modelValue:s.reasonForArt,"onUpdate:modelValue":c[13]||(c[13]=m=>s.reasonForArt=m)},null,8,["modelValue"])]),_:1}),n(p(ue),null,{default:o(()=>[n(p(ke),{readonly:"",placeholder:"N/A",label:"WHO STAGE:",modelValue:s.whoStage,"onUpdate:modelValue":c[14]||(c[14]=m=>s.whoStage=m)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),Ds=de(ys,[["__scopeId","data-v-1fe6c93a"]]),bs={style:{display:"flex","align-items":"center"}},Ss={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},zs=ee({__name:"AHDWorkflow",props:{closeModalOnFinish:{type:Boolean,default:!1}},setup(e,{expose:t}){const a=e,{onTabBeforeChange:l,currentTabIndex:d}=Vn();Zn();const r=Zt(),D=en();P([]),P([]),P(!1);const s=P(!0),b=P(!1),g=P(!1),S=me(()=>({text:g.value?"Saving...":"Finish",icon:g.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:b.value||g.value})),E=vt(),L=Ie(),z=Ne(),G=Ln();Tn();const I=kn(),V=Pn();Bn();const j=Nn(),_=Ze(),A=Hn(),{patient:y}=ae(L),{vitals:u}=ae(E),{investigations:w}=ae(z),{diagnosis:C}=ae(G),{substance:R}=ae(j),{selectedNCDMedicationList:te}=ae(I),{FootScreening:Ce,visualScreening:i,cvScreening:c}=ae(_),{sessionDate:m}=ae(A),{apiStatus:N}=ae(Lt());Q(S,(f,T)=>{console.log("Done button options changed:",{from:T,to:f,currentStep:d.value,tabsLength:$.value.length}),f.disabled!==(T==null?void 0:T.disabled)&&console.log("Done button ".concat(f.disabled?"disabled":"enabled")),f.text!==(T==null?void 0:T.text)&&console.log('Done button text changed from "'.concat(T==null?void 0:T.text,'" to "').concat(f.text,'"'))},{deep:!0}),Q(g,(f,T)=>{f!==T&&(console.log("Saving state changed: ".concat(T," -> ").concat(f)),console.log(f?"Starting save process...":"Save process completed"))});const X=f=>{console.log("Done button change received from wizard:",f),f.newOptions.disabled&&console.log("Done button has been disabled"),f.isLastStep&&console.log("User is on the last step, done button should be visible")},se=()=>{let f=!1;return we(),g.value&&(f=!0),b.value=f,!f},ne=()=>[{title:"Presenting Complaints",icon:""},{title:"Past Medical History",icon:""},{title:"WHO",icon:""},{title:"Investigation",icon:""}],$=P(ne()),Ae=P(null),$t=P(null),we=()=>{var U;if(!$.value||$.value.length===0)return console.log("Tabs not yet initialized"),null;const f=d.value>=0&&d.value<$.value.length?d.value:0;switch((U=$.value[f])==null?void 0:U.title){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation";default:if(V.NCDActivities.length>0)switch(V.NCDActivities[0]){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation"}return null}},qe=()=>{s.value=!1,setTimeout(()=>{d.value=0,s.value=!0},0)},ct=()=>{const f=vt();f.setVitals(f.getInitialVitals(y.value.ID))},ce=async()=>{var U,J;const f=Rn(m.value,"sessionDate","value")||H.sessionDate(),T=Ve("vitals");for(let M=0;M<$.value.length;M++){const K=$.value[M];if(K.title==="Vital Signs")$.value[M].icon=He(f,T)?De:"";else if(K.title==="Risk Assessment"){const q=Ve("substanceAbuse");$.value[M].icon=He(f,q)?De:""}else if(K.title==="Investigations"){const q=(J=(U=y==null?void 0:y.value)==null?void 0:U.labOrders)==null?void 0:J.saved,ye=q==null?void 0:q.filter(xt=>H.toStandardHisFormat(f)===H.toStandardHisFormat(xt.order_date));$.value[M].icon=(ye==null?void 0:ye.length)>0?De:""}else if(K.title==="Diagnosis"){const q=Ve("diagnosis");$.value[M].icon=He(f,q)?De:""}else if(K.title==="Complications Screening"){const q=Ve("screening");$.value[M].icon=He(f,q)?De:""}else K.title==="Treatment Plan"&&(te.value.length>0?$.value[M].icon=$n()?De:"":$.value[M].icon="")}se()},He=(f,T)=>{const U=new Date(f);return U.setHours(0,0,0,0),T.some(J=>{const M=new Date(J.obs_datetime);return M.setHours(0,0,0,0),M.getTime()===U.getTime()})},Mt=async()=>{var M,K,q,ye;const f=[],T=await nt(i.value),U=await jn(Ce.value),J=await nt(c.value);T.length>0&&f.push({concept_id:await oe.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:oe.getSessionDate(),child:T}),U.length>0&&f.push({concept_id:await oe.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:oe.getSessionDate(),child:U}),J.length>0&&f.push(...J),f.length>0?((ye=(q=(K=(M=y.value).screening)!=null?K:M.screening={}).unsaved)!=null||(q.unsaved=[]),y.value.screening.unsaved.push(...f),Se("Complications saved successfully")):ve("No complications data to save")},Ft=async()=>{const f=Et();if(!Jn.isEmpty(f.selectedMedicalAllergiesList)){const J=Fn(),M=f.selectedMedicalAllergiesList.map(q=>({concept_id:q.concept_id,obs_datetime:x.getSessionDate(),value_coded:q.concept_id,location_id:J.facilityLocation.code,value_text:q.name})),K=await Un(M);y.value=Object.assign(y.value,K),console.log("Allergies staged successfully:",y.value),f.clearSelectedMedicalAllergiesList()}const T=await Gn();y.value=Object.assign(y.value,T);const U=await Bt().saveNonPharmaTherapyPatientData();y.value=Object.assign(y.value,U)},Vt=async(f,T)=>{var J,M,K;const U=(J=$.value[T])==null?void 0:J.title;f%1===0&&(d.value=f),U=="Vital Signs"&&((M=Ae.value)==null||M.onSubmit()),U=="Risk Assessment"&&((K=$t.value)==null||K.onSubmit()),U=="Complications Screening"&&await Mt(),U=="Treatment Plan"&&await Ft(),await _t(y.value)},ut=async()=>{g.value=!0;try{await Mn(),await _t(y.value),a.closeModalOnFinish?(await gt.dismiss(),Se("All data saved successfully")):(Se("All data saved successfully"),r.push("/triageList"))}catch(f){console.error("Error saving data:",f),ve("Error occurred while saving data. Please try again.")}finally{g.value=!1}};return _e(async()=>{if(V.NCDActivities.length===0){r.push("patientProfile");return}Ze().resetScreening(),$.value=ne(),await ce(),(d.value===void 0||d.value<0)&&(d.value=0,console.log("Setting initial tab index to 0")),b.value=!1,g.value=!1,se()}),Q(d,async()=>{await se()}),Q(u,async()=>{await ce()},{deep:!0}),Q(y,async()=>{Ze().resetScreening(),await ce()},{deep:!0}),Q(m,async()=>{await ce()},{deep:!0}),Q(w,async()=>{await ce()},{deep:!0}),Q(C,async()=>{await ce()},{deep:!0}),Q(R,async()=>{await ce()},{deep:!0}),Q(te,async()=>{await ce()},{deep:!0}),Q(D,async f=>{qe(),ct(),$.value=ne()},{deep:!0}),Q(y,async(f,T)=>{f.ID!=T.ID&&(qe(),ct())},{deep:!0}),t({saveData:ut,markWizard:ce,refreshWizard:qe,validateDoneButtonState:se}),(f,T)=>{const U=k("ion-icon"),J=k("ion-title"),M=k("ion-toolbar"),K=k("ion-header");return v(),O(he,null,[n(K,null,{default:o(()=>[n(M,{class:"modal-title"},{default:o(()=>[n(J,null,{default:o(()=>[h("div",bs,[n(U,{icon:p(le).demographics,class:"sub-menu-icon",style:{"font-size":"1.4rem"}},null,8,["icon"]),T[2]||(T[2]=h("b",{style:{"margin-left":"6px"}},"Advance HIV Disease",-1))])]),_:1}),n(U,{slot:"end",onClick:T[0]||(T[0]=q=>p(gt).dismiss()),style:{"font-size":"30px","padding-right":"10px"},icon:p(At)},null,8,["icon"])]),_:1})]),_:1}),n(p(ze),{class:"ion-padding"},{default:o(()=>[h("div",Ss,[s.value?(v(),Z(xn,{key:0,ref:"wizard",headingTitle:"AHD Screening","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:S.value,"custom-tabs":$.value,beforeChange:p(l),onChange:Vt,"onComplete:wizard":T[1]||(T[1]=q=>ut()),onDoneButtonChanged:X},{default:o(()=>[Re(h("div",null,[n(ds,{ref:"observationsRef"},null,512)],512),[[$e,we()=="Presenting Complaints"]]),Re(h("div",null,[n(Ya,{ref:"interventionsRef"},null,512)],512),[[$e,we()=="Past Medical History"]]),Re(h("div",null,[n(Ds,{ref:"medicationsRef"},null,512)],512),[[$e,we()=="WHO"]]),Re(h("div",null,[n(ss,{ref:"medicationsRef"},null,512)],512),[[$e,we()=="Investigation"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):F("",!0)])]),_:1})],64)}}});export{xs as A,Vs as D,Fs as I,Nt as L,Gs as N,zs as _,Us as a,Ht as b};

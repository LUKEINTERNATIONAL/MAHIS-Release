import{c as L,d as ie,r as N,b2 as Z,w as K,a as ue,n as V,e as S,f as D,k as d,l as T,J as U,O as ee,u as h,aV as ye,bj as Ce,m as E,F as ne,P as se,p as J,L as W,K as z,eP as Ae,at as Ie,aa as Oe,eQ as Me,Q as Y,c1 as be,eJ as _e,aM as De,av as pe,e2 as we,bw as Te,aS as Be,aR as Fe,am as xe,cr as Ee,ab as qe,i as Q,bT as Re,v as X,ae as $e,ba as Le}from"./vendor-Do41i3tR.js";import{n as O,u as ce,z as le,t as $,J as A,b as ge,F as de,_ as re,e as He,a8 as We,f as ze,T as Ue,D as je,a1 as Ve,H as Ye,b4 as Ke,I as Je}from"../index-DmWNBpr9.js";import{D as Qe}from"./DemographicBar-BkCJgdeB.js";import{u as Xe,_ as Ze}from"./useFormWizard-BFgSyO4_.js";import{M as et,a as tt,W as at}from"./MedicalHistory-Bg1HUqf0.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-DB4uOJSt.js";const nt=()=>{const H=()=>{},I=[{id:1,name:"Caesarean section"},{id:2,name:"Vacuum extraction delivery"},{id:3,name:"Breech delivery"},{id:4,name:"SVD"},{id:5,name:"Other"}],m=[{id:1,name:"Asphyxia"},{id:2,name:"Pre-eclampsia"},{id:3,name:"Eclampsia"},{id:4,name:"Puerperal Sepsis"},{id:5,name:"Baby died within 24hrs of birth"},{id:6,name:"Convulsions"},{id:7,name:"Gestational diabetes mellitus"},{id:8,name:"Heavy bleeding"},{id:9,name:"Macrosomia"},{id:10,name:"Perineal tear (3rd or 4th degree)"},{id:11,name:"Other"},{id:12,name:"None"}],g=c=>{const o=[];for(let e=0;e<c;e++)o.push({componentType:"multiSelectInputField",header:"Specify mode of delivery (child ".concat(e+1,")"),name:"Mode of delivery ".concat(e),trackBy:"id",isMultiple:!1,required:!0,options:I,grid:{s:"12",md:"6"},validation:(n,i)=>{const t=parseInt(i==null?void 0:i.LiveBirths)||0;return e>=t?null:!n||n===""?"Mode of delivery for child ".concat(e+1," is required"):null},condition:n=>{const i=parseInt(n.LiveBirths)||0;return i>0&&i>e},onChange:(n,i)=>{const t={},r=I.find(u=>u.id===n);return((r==null?void 0:r.name)||"")!=="Other"&&(t["Specify ".concat(e)]=""),t}});o.push({grid:{s:"12"},componentType:"Dashes",condition:e=>(parseInt(e.LiveBirths)||0)>0});for(let e=0;e<c;e++)o.push({componentType:"inputField",header:"Specify delivery details (child ".concat(e+1,")"),name:"Specify ".concat(e),icon:O.editPen,required:!0,grid:{s:"12",md:"6"},validation:(n,i)=>{const t=parseInt(i==null?void 0:i.LiveBirths)||0;if(e>=t)return null;const r=i==null?void 0:i["Mode of delivery ".concat(e)],l=I.find(v=>v.id===r);return((l==null?void 0:l.name)||"")==="Other"&&(!n||n==="")?"Please specify details for child ".concat(e+1):null},condition:n=>{const i=parseInt(n.LiveBirths)||0,t=n["Mode of delivery ".concat(e)],r=I.find(u=>u.id===t),l=(r==null?void 0:r.name)||"";return i>0&&i>e&&(l==="Caesarean section"||l==="Other")}});return o},a=L(()=>{const c=[{componentType:"inputField",header:"Gravida",name:"Gravida",icon:O.editPen,required:!0,grid:{s:"12"},validation:e=>{if(!e||e==="")return"Gravida is required";const n=Number(e);return isNaN(n)?"Gravida can only be number":n<0?"Gravida must be 0 or greater":n>30?"Gravida must be 30 or less":null},onChange:(e,n)=>{if(!n)return{};const i=e?parseInt(e):null,t={};if(i===null||i===0||e==="")t["Abortions/Miscarriages"]="",t.Stillbirths="",t.LiveBirths="",t.Parity="";else if(i===1){t["Abortions/Miscarriages"]="",t.Stillbirths="",t.LiveBirths="",t.Parity="",t["Gestational age at last live birth"]="",t["Last live birth had congenital abnormalities"]="",t["past pregnancies complications"]=[];for(let r=0;r<30;r++)t["Mode of delivery ".concat(r)]="",t["Specify ".concat(r)]=""}else{const r=parseInt(n["Abortions/Miscarriages"])||0;if(!isNaN(i)&&!isNaN(r)){t.Parity=Math.max(0,i-r-1);const l=parseInt(n.Stillbirths)||0;if(!isNaN(l)){const u=i-r-1;t.LiveBirths=Math.max(0,u-l)}}}return t}},{componentType:"inputField",header:"Abortions/Miscarriages",name:"Abortions/Miscarriages",icon:O.editPen,required:!0,grid:{s:"12",md:"6"},validation:(e,n)=>{const i=parseInt(n==null?void 0:n.Gravida)||0;if(i<=1)return null;if(!e||e==="")return"Abortions/Miscarriages is required";const t=Number(e);return isNaN(t)?"Abortions/Miscarriages can only be number":t<0?"Abortions/Miscarriages must be 0 or greater":i>0&&t>=i?"Abortions/Miscarriages cannot be equal to or greater than Gravida":null},condition:e=>parseInt(e.Gravida)>1,onChange:(e,n)=>{if(!n)return{};const i=parseInt(n.Gravida)||0,t=e?parseInt(e):0,r={};if(!isNaN(i)&&!isNaN(t)&&i>1){const l=Math.max(0,i-t-1);r.Parity=l;const u=parseInt(n.Stillbirths)||0;isNaN(u)||(r.LiveBirths=Math.max(0,l-u))}else r.Parity="",r.LiveBirths="";return r}},{componentType:"inputField",header:"Stillbirths",name:"Stillbirths",icon:O.editPen,required:!0,grid:{s:"12",md:"6"},validation:(e,n)=>{if((parseInt(n==null?void 0:n.Gravida)||0)<=1)return null;if(!e||e==="")return"Stillbirths is required";const t=Number(e);if(isNaN(t))return"Stillbirths can only be number";if(t<0)return"Stillbirths must be 0 or greater";const r=parseInt(n==null?void 0:n.Parity)||0;return r>0&&t>r?"Stillbirths cannot exceed Parity":null},condition:e=>parseInt(e.Gravida)>1,onChange:(e,n)=>{if(!n)return{};const i=parseInt(n.Parity)||0,t=e?parseInt(e):0;return!isNaN(i)&&!isNaN(t)?{LiveBirths:Math.max(0,i-t)}:{LiveBirths:""}}},{componentType:"inputField",header:"Live births",name:"LiveBirths",disabled:!0,grid:{s:"12",md:"6"},condition:e=>parseInt(e.Gravida)>1},{componentType:"inputField",header:"Parity",name:"Parity",required:!1,disabled:!0,grid:{s:"12",md:"6"},condition:e=>parseInt(e.Gravida)>1},{grid:{s:"12"},componentType:"Dashes"}],o=g(30);return c.push(...o),c.push({componentType:"Alert",name:"FirstPregnancyAlert",backgroundColor:"#FFD700",status:"info",icon:"info-circle",textColor:"#000000",value:"First pregnancy, proceed.",grid:{s:"12"},condition:e=>parseInt(e.Gravida)===1},{componentType:"radioButtonField",header:"What was the gestational age at last live birth?",name:"Gestation age at last live birth",options:[{value:"<28 weeks",label:"<28 weeks"},{value:"28–34 weeks",label:"28–34 weeks"},{value:"35–36 weeks",label:"35–36 weeks"},{value:"≥37 weeks (Full term)",label:"≥37 weeks (Full term)"}],grid:{s:"12"},condition:e=>parseInt(e.Gravida)>1},{grid:{s:"12"},componentType:"Dashes"},{componentType:"radioButtonField",header:"Last live birth had congenital abnormalities?",name:"Last live birth had congenital abnormalities",type:"inline",options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],grid:{s:"12"},condition:e=>parseInt(e.Gravida)>1},{grid:{s:"12"},componentType:"Dashes"},{componentType:"Heading",name:"Past Pregnancy Complications",grid:{s:"12"},condition:e=>parseInt(e.Gravida)>1},{componentType:"multiSelectInputField",header:"Did the woman have any of the complications during the past pregnancies?",name:"past pregnancies complications",isMultiple:!0,trackBy:"id",grid:{s:"12"},options:m,validation:e=>{if(!e||e.length===0)return"Please select at least one option or 'None'";if(Array.isArray(e)){const n=e.some(t=>t.name==="None"),i=e.some(t=>t.name!=="None");if(n&&i)return"'None' cannot be selected with other complications"}return null},condition:e=>parseInt(e.Gravida)>1,onChange:(e,n)=>{if(!n||!Array.isArray(e))return{};const i={};if(Array.isArray(e)){const t=e.some(l=>l.name==="None"),r=e.some(l=>l.name==="Other");if(t){const l=e.find(u=>u.name==="None");i["past pregnancies complications"]=[l],i["Other complications notes"]=""}r||(i["Other complications notes"]="")}return i}},{grid:{s:"12"},componentType:"Dashes"},{componentType:"inputField",header:"Specify other complications*",name:"Other complications notes",icon:O.editPen,required:!0,grid:{s:"12"},validation:(e,n)=>{const i=n==null?void 0:n["past pregnancies complications"];if(Array.isArray(i)){const t=i.some(l=>l.name==="Other"),r=i.some(l=>l.name==="None");if(t&&!r&&(!e||e===""))return"Please specify other complications"}return null},condition:e=>{const n=parseInt(e.Gravida),i=e["past pregnancies complications"];if(n<=1||!Array.isArray(i))return!1;const t=i.some(l=>l.name==="Other"),r=i.some(l=>l.name==="None");return t&&!r}}),c});return{resetForm:H,pastObstetricHistoryFormSection:a}},st={class:"container"},it={class:"custom-card"},rt=ie({__name:"PastObstetricHistory",setup(H,{expose:I}){const m=nt(),g=N(null),a=N(0),c=ce(),{patient:o}=Z(c);K(()=>{var t;return(t=o.value)==null?void 0:t.patientID},async(t,r)=>{t&&t!==r&&(a.value++,await V())});const e=async()=>{if(!g.value)return console.error("Form reference is not available"),!1;const t=g.value.validateForm();if(t)return $("Please fix validation errors before submitting"),console.log("Validation errors:",t),!1;const r=g.value.getFormValues();try{const l=await n(r);return l.length===0?($("No past obstetric history data to save"),!1):(await A.addObsToEncounterPatient(l,ge.OBSTETRIC_HISTORY),a.value++,await V(),de("Past obstetric history saved successfully"),!0)}catch(l){return console.error("Error processing past obstetric history:",l),$((l==null?void 0:l.message)||"Failed to save past obstetric history"),!1}},n=async t=>{const r=[];for(const[l,u]of Object.entries(t))if(!(!u||u===!1||u==="")&&l!=="FirstPregnancyAlert")if(Array.isArray(u))if(l==="past pregnancies complications")for(const v of u){const k=typeof v=="object"&&v!==null?v.name:v;k&&k!==""&&r.push(await A.buildValueText(l,String(k)))}else for(const v of u){const k=typeof v=="object"&&v!==null?v.value||v.name:v;k&&k!==""&&r.push(await A.buildValueText(l,String(k)))}else if(typeof u=="object"&&u!==null){if(l.startsWith("Mode of delivery")){const v=u.name||"";if(v){const k=l.replace("Mode of delivery ",""),w="Specify ".concat(k),y=t[w];if((v==="Caesarean section"||v==="Other")&&y){const b=await A.buildValueText("Mode of delivery",v),x=await A.buildValueText("Mode of delivery details",y);b.child=[x],r.push(b)}else r.push(await A.buildValueText("Mode of delivery",v))}}}else if(typeof u=="string"||typeof u=="number"){if(l.startsWith("Specify "))continue;r.push(await A.buildValueText(l,String(u)))}else typeof u=="boolean"&&u===!0&&r.push(await A.buildValueText("Past obstetric finding",l));return r};ue(async()=>{await V()});const i=L(()=>m.pastObstetricHistoryFormSection.value);return I({validateForm:()=>{var t;return(t=g.value)==null?void 0:t.validateForm()},onSubmit:e,resetForm:()=>{a.value++}}),(t,r)=>(D(),S("div",st,[d("div",it,[T(h(ye),null,{default:U(()=>[(D(),ee(le,{formData:i.value,ref_key:"formRef",ref:g,key:a.value},null,8,["formData"]))]),_:1})])]))}}),ot=re(rt,[["__scopeId","data-v-2d34e009"]]),lt={class:"tetanus-immunization-wrapper"},ut={class:"status-selection"},ct=["onClick"],dt={class:"status-content"},ft={class:"status-label"},vt={class:"status-desc"},mt={key:0,class:"dashed-separator"},pt={key:1,class:"doses-section"},yt={class:"section-subtitle-header"},gt={class:"progress-badge"},ht={class:"doses-grid"},bt={class:"input-header-row"},_t={class:"input-label"},Dt={key:0,class:"completed-badge"},wt={class:"input-wrapper"},Tt=["value","onChange","max","min","disabled"],kt={key:0,class:"error-message"},Nt={key:2,class:"doses-section"},Pt={class:"field-group"},St={class:"dose-count-options"},Gt=["onClick"],Ct={class:"count-number"},At={class:"count-label"},It={key:0,class:"dashed-separator"},Ot={class:"doses-grid"},Mt={class:"input-header-row"},Bt={class:"input-label"},Ft={key:0,class:"completed-badge"},xt={class:"input-wrapper"},Et=["value","onChange","max","min","disabled"],qt={key:0,class:"error-message"},Rt={key:3,class:"doses-section"},$t={class:"field-group"},Lt={class:"radio-options"},Ht=["onClick"],Wt={key:0,class:"radio-dot"},zt={key:0,class:"dashed-separator-thin"},Ut={key:1,class:"field-group"},jt={class:"input-label"},Vt={class:"input-wrapper"},Yt={class:"text-input-container"},Kt=["value"],Jt={key:4,class:"alert-box"},Qt={key:5,class:"dashed-separator"},Xt=ie({__name:"TetanusImmunizationTable",setup(H,{expose:I}){const m=[{value:"Fully immunised",label:"Fully Immunised",description:"5 doses",icon:Ae},{value:"Under immunised",label:"Under Immunised",description:"1-4 doses",icon:Ie},{value:"No doses",label:"No Doses",description:"Not immunized",icon:Oe},{value:"Unknown doses",label:"Unknown",description:"Status unclear",icon:Me}],g=[{value:"stockout",label:"Stockout"},{value:"client is ill",label:"Client is ill"},{value:"client refused",label:"Client refused"},{value:"allergy",label:"Allergy to vaccine"},{value:"other",label:"Other (please specify)"}],a=N(""),c=N(Array(5).fill("")),o=N(Array(5).fill("")),e=N(Array(4).fill("")),n=N(Array(4).fill("")),i=N(0),t=N(""),r=N(""),l=L(()=>c.value.filter(f=>f!=="").length);L(()=>e.value.filter(f=>f!=="").length);const u=f=>{a.value=f,c.value=Array(5).fill(""),e.value=Array(4).fill(""),o.value=Array(5).fill(""),n.value=Array(4).fill(""),i.value=0,t.value="",r.value=""},v=f=>{i.value=f,e.value=Array(4).fill(""),n.value=Array(4).fill("")},k=(f,p)=>{if(c.value[f]=p,o.value[f]="",f>0&&c.value[f-1]){const s=new Date(p),C=new Date(c.value[f-1]);if(s<=C){o.value[f]="Date must be after TTV ".concat(f);return}}for(let s=f+1;s<5;s++)if(c.value[s]){const C=new Date(c.value[s]),G=new Date(p);C<=G&&(c.value[s]="",o.value[s]="")}},w=(f,p)=>{if(e.value[f]=p,n.value[f]="",f>0&&e.value[f-1]){const s=new Date(p),C=new Date(e.value[f-1]);if(s<=C){n.value[f]="Date must be after TTV ".concat(f);return}}for(let s=f+1;s<i.value;s++)if(e.value[s]){const C=new Date(e.value[s]),G=new Date(p);C<=G&&(e.value[s]="",n.value[s]="")}},y=f=>{t.value=f,f!=="other"&&(r.value="")},b=f=>{r.value=f};return I({getValues:()=>{const f={"The woman received tetanus doses for immunization?":a.value};if(a.value==="Fully immunised")for(let p=0;p<5;p++)f["tt1Date".concat(p+1)]=c.value[p];if(a.value==="Under immunised"){f["Number of tetanus doses"]=i.value===1?"one dose":i.value===2?"two doses":i.value===3?"three doses":"four doses";for(let p=0;p<i.value;p++)f["tt2Date".concat(p+1)]=e.value[p]}return a.value==="No doses"&&(f["Reason Tetanus toxoid (TT) was not conducted"]=t.value,t.value==="other"&&(f.Other=r.value)),f},validate:()=>{if(!a.value)return"Tetanus immunization status is required";if(a.value==="Fully immunised")for(let f=0;f<5;f++){if(!c.value[f])return"TTV Dose ".concat(f+1," date is required");if(o.value[f])return o.value[f]}if(a.value==="Under immunised"){if(!i.value)return"Please select number of doses";for(let f=0;f<i.value;f++){if(!e.value[f])return"TTV Dose ".concat(f+1," date is required");if(n.value[f])return n.value[f]}}if(a.value==="No doses"){if(!t.value)return"Please select a reason";if(t.value==="other"&&!r.value)return"Please specify other reason"}return null}}),(f,p)=>(D(),S("div",lt,[p[9]||(p[9]=Ce('<div class="dashed-separator" data-v-38c4c6e6></div><div class="field-header-container" data-v-38c4c6e6><div class="header-with-icon" data-v-38c4c6e6><div data-v-38c4c6e6><h6 class="field-header" data-v-38c4c6e6>Select Tetanus Immunization Status <span class="required-asterisk" data-v-38c4c6e6>*</span></h6></div></div></div>',2)),d("div",ut,[(D(),S(ne,null,se(m,s=>d("div",{key:s.value,class:J(["status-option",{selected:a.value===s.value}]),onClick:C=>u(s.value)},[T(h(W),{icon:s.icon,class:"status-icon"},null,8,["icon"]),d("div",dt,[d("span",ft,z(s.label),1),d("span",vt,z(s.description),1)])],10,ct)),64))]),a.value?(D(),S("div",mt)):E("",!0),a.value==="Fully immunised"?(D(),S("div",pt,[d("div",yt,[p[1]||(p[1]=d("div",{class:"subtitle-left"},[d("span",null,"Complete all 5 TDV dose dates")],-1)),d("span",gt,z(l.value)+"/5",1)]),d("div",ht,[(D(),S(ne,null,se(5,s=>d("div",{key:"fully-".concat(s),class:"dose-field-group"},[d("div",bt,[d("label",_t,[Y(" Date for TDV "+z(s)+" ",1),p[2]||(p[2]=d("span",{class:"required-asterisk"},"*",-1))]),c.value[s-1]?(D(),S("span",Dt,[T(h(W),{icon:h(be)},null,8,["icon"])])):E("",!0)]),d("div",wt,[d("input",{type:"date",value:c.value[s-1],onChange:C=>k(s-1,C.target.value),max:new Date().toISOString().split("T")[0],min:s>1&&c.value[s-2]?c.value[s-2]:void 0,disabled:s>1&&!c.value[s-2],class:J(["date-input",{"has-error":o.value[s-1],disabled:s>1&&!c.value[s-2]}])},null,42,Tt),T(h(W),{icon:s>1&&!c.value[s-2]?h(_e):h(De),class:"input-icon-readonly"},null,8,["icon"])]),o.value[s-1]?(D(),S("div",kt,[T(h(W),{icon:h(pe),class:"error-icon"},null,8,["icon"]),Y(" "+z(o.value[s-1]),1)])):E("",!0)])),64))])])):E("",!0),a.value==="Under immunised"?(D(),S("div",Nt,[d("div",Pt,[p[3]||(p[3]=d("div",{class:"header-with-icon"},[d("div",null,[d("h6",{class:"field-header"},[Y("Number of doses received "),d("span",{class:"required-asterisk"},"*")])])],-1)),d("div",St,[(D(),S(ne,null,se([1,2,3,4],s=>d("button",{key:s,type:"button",class:J(["dose-count-btn",{active:i.value===s}]),onClick:C=>v(s)},[d("span",Ct,z(s),1),d("span",At,"dose"+z(s>1?"s":""),1)],10,Gt)),64))])]),i.value?(D(),S("div",It)):E("",!0),d("div",Ot,[(D(!0),S(ne,null,se(i.value,s=>(D(),S("div",{key:"under-".concat(s),class:"dose-field-group"},[d("div",Mt,[d("label",Bt,[Y(" Date for TDV "+z(s)+" ",1),p[4]||(p[4]=d("span",{class:"required-asterisk"},"*",-1))]),e.value[s-1]?(D(),S("span",Ft,[T(h(W),{icon:h(be)},null,8,["icon"])])):E("",!0)]),d("div",xt,[d("input",{type:"date",value:e.value[s-1],onChange:C=>w(s-1,C.target.value),max:new Date().toISOString().split("T")[0],min:s>1&&e.value[s-2]?e.value[s-2]:void 0,disabled:s>1&&!e.value[s-2],class:J(["date-input",{"has-error":n.value[s-1],disabled:s>1&&!e.value[s-2]}])},null,42,Et),T(h(W),{icon:s>1&&!e.value[s-2]?h(_e):h(De),class:"input-icon-readonly"},null,8,["icon"])]),n.value[s-1]?(D(),S("div",qt,[T(h(W),{icon:h(pe),class:"error-icon"},null,8,["icon"]),Y(" "+z(n.value[s-1]),1)])):E("",!0)]))),128))])])):E("",!0),a.value==="No doses"?(D(),S("div",Rt,[d("div",$t,[p[5]||(p[5]=d("div",{class:"header-with-icon"},[d("div",null,[d("h6",{class:"field-header"},[Y("Reason TDV was not conducted "),d("span",{class:"required-asterisk"},"*")])])],-1)),d("div",Lt,[(D(),S(ne,null,se(g,s=>d("div",{key:s.value,class:J(["radio-option",{selected:t.value===s.value}]),onClick:C=>y(s.value)},[d("div",{class:J(["radio-circle",{checked:t.value===s.value}])},[t.value===s.value?(D(),S("div",Wt)):E("",!0)],2),d("label",null,z(s.label),1)],10,Ht)),64))])]),t.value==="other"?(D(),S("div",zt)):E("",!0),t.value==="other"?(D(),S("div",Ut,[d("label",jt,[T(h(W),{icon:h(we),class:"label-icon"},null,8,["icon"]),p[6]||(p[6]=Y(" Specify other reasons ",-1)),p[7]||(p[7]=d("span",{class:"required-asterisk"},"*",-1))]),d("div",Vt,[d("div",Yt,[d("input",{type:"text",value:r.value,onInput:p[0]||(p[0]=s=>b(s.target.value)),placeholder:"Please specify the reason...",class:"text-input"},null,40,Kt),T(h(W),{icon:h(we),class:"input-icon"},null,8,["icon"])])])])):E("",!0)])):E("",!0),a.value==="Unknown doses"?(D(),S("div",Jt,[T(h(W),{icon:h(pe),class:"alert-icon"},null,8,["icon"]),p[8]||(p[8]=d("div",{class:"alert-content"},[d("div",{class:"alert-title"},"Unknown Immunization Status"),d("div",{class:"alert-text"}," The woman's tetanus immunization history is not known. Please try to obtain this information from health records or previous documentation. ")],-1))])):E("",!0),a.value?(D(),S("div",Qt)):E("",!0)]))}}),Zt=re(Xt,[["__scopeId","data-v-38c4c6e6"]]),ea=()=>{const H=()=>{},I=L(()=>[{componentType:"radioButtonField",header:"Gestation age to be used",name:"Gestation age to be used",type:"inline",required:!0,options:[{value:"GA by LNMP",label:"GA by LNMP"},{value:"GA by ultrasound",label:"GA by ultrasound"},{value:"GA by palpation",label:"GA by palpation"}],grid:{s:"12"},validation:a=>!a||a===""?"Gestation age to be used is required":null,onChange:(a,c)=>{const o={};return o["lmnp date"]="",o["Gestation weeks"]="",o["Estimated date of delivery"]="",o.Ultrasound="",o.specify="",o["ultrasound lmnp date"]="",o["Estimated date of delivery from ultrasound"]="",o["Gestation age by palpation"]="",o["date of delivery"]="",o}},{componentType:"dateInputField",header:"LNMP date",name:"lmnp date",icon:O.calenderPrimary,required:!0,grid:{s:"12",md:"6"},validation:(a,c)=>(c==null?void 0:c["Gestation age to be used"])==="GA by LNMP"&&(!a||a==="")?"LNMP date is required":null,condition:a=>a["Gestation age to be used"]==="GA by LNMP",onChange:(a,c)=>{const o={};if(!a||a==="")return o["Gestation weeks"]="",o["Estimated date of delivery"]="",o;const e=Date.parse(a);if(!isNaN(e)){const i=(new Date().getTime()-e)/(1e3*60*60*24),t=Math.floor(i/7);o["Gestation weeks"]=t;const r=new Date(e+280*24*60*60*1e3);o["Estimated date of delivery"]=r.toISOString().split("T")[0]}return o}},{componentType:"inputField",header:"Gestation age",name:"Gestation weeks",unit:"Weeks",disabled:!0,grid:{s:"12",md:"3"},condition:a=>a["Gestation age to be used"]==="GA by LNMP"},{componentType:"dateInputField",header:"EDD",name:"Estimated date of delivery",icon:O.calenderPrimary,disabled:!0,grid:{s:"12",md:"3"},condition:a=>a["Gestation age to be used"]==="GA by LNMP"},{componentType:"dateInputField",header:"Date for ultrasound",name:"Ultrasound",icon:O.calenderPrimary,required:!0,grid:{s:"12",md:"6"},validation:(a,c)=>(c==null?void 0:c["Gestation age to be used"])==="GA by ultrasound"&&(!a||a==="")?"Ultrasound date is required":null,condition:a=>a["Gestation age to be used"]==="GA by ultrasound"},{componentType:"inputField",header:"Gestation age from ultrasound",name:"specify",icon:O.editPen,unit:"Weeks",required:!0,grid:{s:"12",md:"6"},validation:(a,c)=>{if((c==null?void 0:c["Gestation age to be used"])==="GA by ultrasound"){if(!a||a==="")return"Gestation age from ultrasound is required";const e=Number(a);if(isNaN(e))return"Gestation age must be a number";if(e<0||e>42)return"Gestation age must be between 0 and 42 weeks"}return null},condition:a=>a["Gestation age to be used"]==="GA by ultrasound",onChange:(a,c)=>{const o={};if(!a||a==="")return o["lmnp date"]="",o["Estimated date of delivery from ultrasound"]="",o;const e=parseInt(a);if(!isNaN(e)){const n=new Date,i=new Date(n.getTime()-e*7*24*60*60*1e3);o["lmnp date"]=i.toISOString().split("T")[0];const t=new Date(n.getTime()-e*7*24*60*60*1e3),r=new Date(t.getTime()+280*24*60*60*1e3);o["Estimated date of delivery from ultrasound"]=r.toISOString().split("T")[0]}return o}},{componentType:"dateInputField",header:"LMNP date from ultrasound",name:"lmnp date",icon:O.calenderPrimary,grid:{s:"12",md:"6"},condition:a=>a["Gestation age to be used"]==="GA by ultrasound"},{componentType:"dateInputField",header:"EDD from ultrasound",name:"Estimated date of delivery",icon:O.calenderPrimary,grid:{s:"12",md:"6"},condition:a=>a["Gestation age to be used"]==="GA by ultrasound"},{componentType:"inputField",header:"Enter gestation age by palpation (weeks)",name:"Gestation weeks",icon:O.editPen,required:!0,grid:{s:"12",md:"6"},validation:(a,c)=>{if((c==null?void 0:c["Gestation age to be used"])==="GA by palpation"){if(!a||a==="")return"Gestation age by palpation is required";const e=Number(a);if(isNaN(e))return"Gestation age must be a number";if(e<0||e>42)return"Gestation age must be between 0 and 42 weeks"}return null},condition:a=>a["Gestation age to be used"]==="GA by palpation",onChange:(a,c)=>{const o={};if(!a||a==="")return o["date of delivery"]="",o;const e=parseInt(a);if(!isNaN(e)){const n=new Date,i=new Date(n.getTime()-e*7*24*60*60*1e3),t=new Date(i.getTime()+280*24*60*60*1e3);o["date of delivery"]=t.toISOString().split("T")[0]}return o}},{componentType:"dateInputField",header:"EDD",name:"Estimated date of delivery",icon:O.calenderPrimary,disabled:!0,grid:{s:"12",md:"6"},condition:a=>a["Gestation age to be used"]==="GA by palpation"},{grid:{s:"12"},componentType:"Dashes"}]),m=L(()=>[{componentType:"radioButtonField",header:"TDV started at what gestation age?",name:"TDV at gestation age",type:"inline",grid:{s:"12"},options:[{label:"None",value:"None"},{label:"4 Weeks",value:"4 weeks"},{label:"6 Months",value:"6 months"},{label:"1 year",value:"1 year"},{label:"> 1 yr",value:"> 1 yr"}]}]);return{resetForm:H,gestationAgeSection:I,tdvSection:m}},ta={class:"container"},aa=ie({__name:"CurrentPregnancy",setup(H,{expose:I}){const m=ea(),g=N(null),a=N(null),c=N(null),o=N(0),e=ce(),{patient:n}=Z(e);K(()=>{var u;return(u=n.value)==null?void 0:u.patientID},async(u,v)=>{u&&u!==v&&(o.value++,await V())});const i=async()=>{var oe,f,p,s,C,G;const u=(oe=g.value)==null?void 0:oe.validateForm(),v=(f=c.value)==null?void 0:f.validate(),k=(p=a.value)==null?void 0:p.validateForm();if(u||v||k)return v?$(v):$("Please fix validation errors before submitting"),!1;const w=((s=g.value)==null?void 0:s.getFormValues())||{},y=((C=c.value)==null?void 0:C.getValues())||{},b=((G=a.value)==null?void 0:G.getFormValues())||{},x={...w,...y,...b};try{const q=await t(x);return q.length===0?($("No current pregnancy data to save"),!1):(await A.addObsToEncounterPatient(q,ge.CURRENT_PREGNANCY),o.value++,await V(),de("Current pregnancy data saved successfully"),!0)}catch(q){return console.error("Error details:",q),$((q==null?void 0:q.message)||"Failed to save current pregnancy data"),!1}},t=async u=>{const v=[];for(const[w,y]of Object.entries(u))if(!(!y||y===!1||y==="")&&!(w.startsWith("tt1Date")||w.startsWith("tt2Date")))if(Array.isArray(y))for(const b of y){const x=typeof b=="object"&&b!==null?b.value||b.name:b;x&&x!==""&&v.push(await A.buildValueText(w,String(x)))}else if(typeof y=="object"&&y!==null){const b=y.value||y.name||String(y);b&&b!==""&&v.push(await A.buildValueText(w,String(b)))}else typeof y=="string"||typeof y=="number"?v.push(await A.buildValueText(w,String(y))):typeof y=="boolean"&&y===!0&&v.push(await A.buildValueText("Current pregnancy finding",w));const k=u["The woman received tetanus doses for immunization?"];if(k==="Fully immunised")for(let w=1;w<=5;w++){const y=u["tt1Date".concat(w)];y&&y!==""&&v.push(await A.buildValueText("tt1Date",String(y)))}if(k==="Under immunised"){const w=u["Number of tetanus doses"];let y=0;w==="one dose"?y=1:w==="two doses"?y=2:w==="three doses"?y=3:w==="four doses"&&(y=4);for(let b=1;b<=y;b++){const x=u["tt2Date".concat(b)];x&&x!==""&&v.push(await A.buildValueText("tt2Date",String(x)))}}return v};ue(async()=>{await V()});const r=L(()=>m.gestationAgeSection.value),l=L(()=>m.tdvSection.value);return I({validateForm:()=>{var w,y,b;const u=(w=g.value)==null?void 0:w.validateForm(),v=(y=c.value)==null?void 0:y.validate(),k=(b=a.value)==null?void 0:b.validateForm();return u||v||k},onSubmit:i,getFormValues:()=>{var w,y,b;const u=((w=g.value)==null?void 0:w.getFormValues())||{},v=((y=c.value)==null?void 0:y.getValues())||{},k=((b=a.value)==null?void 0:b.getFormValues())||{};return{...u,...v,...k}},resetForm:()=>{o.value++}}),(u,v)=>(D(),S("div",ta,[T(h(Te),{class:"section"},{default:U(()=>[T(h(ye),null,{default:U(()=>[(D(),ee(le,{formData:r.value,ref_key:"gestationFormRef",ref:g,key:o.value},null,8,["formData"])),T(Zt,{ref_key:"tetanusRef",ref:c},null,512),(D(),ee(le,{formData:l.value,ref_key:"tdvFormRef",ref:a,key:o.value},null,8,["formData"]))]),_:1})]),_:1})]))}}),na=re(aa,[["__scopeId","data-v-e88315ec"]]),sa=()=>{const H=()=>{},I=L(()=>[{componentType:"inputField",header:"Age at menarche",name:"Age at menarche",unit:"Years",icon:O.editPen,required:!0,grid:{s:"12"},validation:m=>{if(!m||m==="")return"Age at menarche is required";const g=Number(m);return isNaN(g)?"Age at menarche must be a number":g<8?"Age at menarche must be at least 8 years":g>20?"Age at menarche cannot exceed 20 years":null}},{grid:{s:"12"},componentType:"Dashes"},{componentType:"inputField",header:"Length of menstrual flow",name:"Length of menstrual flow days",unit:"Days",icon:O.editPen,required:!0,grid:{s:"12",md:"6"},validation:m=>{if(!m||m==="")return"Length of menstrual flow is required";const g=Number(m);return isNaN(g)?"Length of menstrual flow must be a number":g<1?"Length of menstrual flow must be at least 1 day":g>15?"Length of menstrual flow cannot exceed 15 days":null}},{componentType:"inputField",header:"Length of menstrual flow",name:"Length of menstrual flow weeks",icon:O.editPen,unit:"Weeks",required:!1,grid:{s:"12",md:"6"},validation:m=>{if(!m||m==="")return null;const g=Number(m);return isNaN(g)?"Length of menstrual flow must be a number":g<0?"Length of menstrual flow cannot be negative":g>4?"Length of menstrual flow cannot exceed 4 weeks":null}},{grid:{s:"12"},componentType:"Dashes"},{componentType:"radioButtonField",header:"Regularity of menstrual flow",name:"Regularity of menstrual flow",required:!0,type:"inline",options:[{value:"Regular",label:"Regular"},{value:"Irregular",label:"Irregular"}],grid:{s:"12"},validation:m=>!m||m===""?"Regularity of menstrual flow is required":null},{grid:{s:"12"},componentType:"Dashes"},{componentType:"radioButtonField",header:"Amount of menstrual flow",name:"Amount of menstrual flow",required:!0,type:"inline",options:[{value:"Light",label:"Light"},{value:"Moderate",label:"Moderate"},{value:"Heavy",label:"Heavy"}],grid:{s:"12"},validation:m=>!m||m===""?"Amount of flow is required":null},{grid:{s:"12"},componentType:"Dashes"},{componentType:"radioButtonField",header:"Dysmenorrhea",name:"Dysmenorrhea",required:!0,type:"inline",options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],grid:{s:"12"},validation:m=>!m||m===""?"Dysmenorrhea is required":null},{grid:{s:"12"},componentType:"Dashes"},{componentType:"inputField",header:"Gynaecological surgery",name:"Gynaecological surgery",icon:O.editPen,required:!1,grid:{s:"12"}},{grid:{s:"12"},componentType:"Dashes"},{componentType:"inputField",header:"Other",name:"Other notes",required:!1,grid:{s:"12"},rows:4}]);return{resetForm:H,gynaecologyFormSection:I}},ia={class:"container"},ra=ie({__name:"Gynaecology",setup(H,{expose:I}){const m=sa(),g=N(null),a=N(0),c=ce(),{patient:o}=Z(c);K(()=>{var t;return(t=o.value)==null?void 0:t.patientID},async(t,r)=>{t&&t!==r&&(a.value++,await V())});const e=async()=>{if(!g.value)return!1;const t=g.value.validateForm();if(t)return $("Please fix validation errors before submitting"),console.log("Validation errors:",t),!1;const r=g.value.getFormValues();try{const l=await n(r);return l.length===0?($("No gynaecological history data to save"),!1):(await A.addObsToEncounterPatient(l,ge.Obstetrics_and_Gynecology),a.value++,await V(),de("Gynaecological history saved successfully"),!0)}catch(l){return console.error("Error details:",l),$((l==null?void 0:l.message)||"Failed to save gynaecological history"),!1}},n=async t=>{const r=[];for(const[l,u]of Object.entries(t))if(!(!u||u===!1||u===""))if(Array.isArray(u))for(const v of u){const k=typeof v=="object"&&v!==null?v.value||v.name:v;k&&k!==""&&r.push(await A.buildValueText(l,String(k)))}else typeof u=="string"||typeof u=="number"?r.push(await A.buildValueText(l,String(u))):typeof u=="boolean"&&u===!0&&r.push(await A.buildValueText("Gynaecological finding",l));return r};ue(async()=>{await V()});const i=L(()=>m.gynaecologyFormSection.value);return I({validateForm:()=>{var t;return(t=g.value)==null?void 0:t.validateForm()},onSubmit:e,resetForm:()=>{a.value++}}),(t,r)=>(D(),S("div",ia,[T(h(Te),{class:"section"},{default:U(()=>[T(h(Be),null,{default:U(()=>[T(h(Fe),null,{default:U(()=>[...r[0]||(r[0]=[Y("Gynaecological History",-1)])]),_:1})]),_:1}),T(h(ye),null,{default:U(()=>[(D(),ee(le,{formData:i.value,ref_key:"formRef",ref:g,key:a.value},null,8,["formData"]))]),_:1})]),_:1})]))}}),oa=re(ra,[["__scopeId","data-v-7161ce7a"]]),la={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},ua={class:"back_profile"},ca=ie({__name:"Profile",setup(H,{expose:I}){const{currentTabIndex:m}=Xe(),g=xe(),a=Ee(),c=N(!0),o=N(!1),e=N(!1),n=N(null),i=N(null),t=N(null),r=N(null),l=N(null),u=N(null),v=L(()=>({text:e.value?"Saving...":"Finish",icon:e.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:o.value||e.value})),k=ce(),w=He(),y=We(),{patient:b}=Z(k),{sessionDate:x}=Z(y),{apiStatus:oe}=Z(ze()),f=P=>{console.log("Done button change received from wizard:",P)},p=()=>{let P=!1;return e.value&&(P=!0),o.value=P,!P},s=()=>{g.push("/patientProfile")},C=()=>[{title:"Past Obstetric History",icon:""},{title:"Medical History",icon:""},{title:"Current Pregnancy",icon:""},{title:"Gynaecology",icon:""},{title:"Medications",icon:""},{title:"Woman Behaviour",icon:""}],G=N(C()),q=()=>{var R;if(!G.value||G.value.length===0)return null;const P=m.value>=0&&m.value<G.value.length?m.value:0,_=(R=G.value[P])==null?void 0:R.title;return{"Past Obstetric History":"PastObstetricHistory","Medical History":"MedicalHistory","Current Pregnancy":"CurrentPregnancy",Gynaecology:"Gynaecology",Medications:"Medications","Woman Behaviour":"WomanBehaviour"}[_]||null},fe=P=>{var M;return((M={"Past Obstetric History":n,"Medical History":i,"Current Pregnancy":t,Gynaecology:r,Medications:l,"Woman Behaviour":u}[P])==null?void 0:M.value)||null},ke=async()=>{var M;const P=(M=G.value[m.value])==null?void 0:M.title;if(!P)return!0;const _=fe(P);if(!_||!_.validateForm)return!0;try{_.markAllAsTouched&&_.markAllAsTouched();const R=_.validateForm();return R?($("Please fix validation errors before proceeding"),console.log("Validation errors:",R),!1):!0}catch(R){return console.error("Error during validation:",R),!0}},ve=()=>{c.value=!1,setTimeout(()=>{m.value=0,c.value=!0},0)},te=async()=>{const P=Ve(x.value,"sessionDate","value")||Ye.sessionDate();for(let _=0;_<G.value.length;_++)if(G.value[_].title==="Past Obstetric History"){const R=Ke("pastObstetricHistory");G.value[_].icon=Ne(P,R)?Le:""}p()},Ne=(P,_)=>{const M=new Date(P);return M.setHours(0,0,0,0),_==null?void 0:_.some(R=>{const B=new Date(R.obs_datetime);return B.setHours(0,0,0,0),B.getTime()===M.getTime()})},Pe=async(P,_)=>{P%1===0&&(m.value=P)},he=async()=>{var P;e.value=!0;try{const _=[];for(let B=0;B<G.value.length;B++){const j=G.value[B],F=fe(j.title);if(F!=null&&F.validateForm){const me=F.validateForm(),Se=((P=F.getFormValues)==null?void 0:P.call(F))||{},Ge=Object.values(Se).some(ae=>ae!==""&&ae!==null&&ae!==void 0&&!(Array.isArray(ae)&&ae.length===0));_.push({tabTitle:j.title,hasErrors:me!==null,hasData:Ge})}}const M=_.filter(B=>B.hasData&&B.hasErrors);if(M.length>0){const B=M[0],j=G.value.findIndex(F=>F.title===B.tabTitle);j!==-1&&(m.value=j),$("Please fix validation errors in: ".concat(M.map(F=>F.tabTitle).join(", "))),e.value=!1;return}let R=0;for(let B=0;B<G.value.length;B++){const j=G.value[B],F=fe(j.title);if(F!=null&&F.onSubmit)try{await F.onSubmit(),R++}catch(me){console.error("Error saving ".concat(j.title,":"),me),$("Error saving ".concat(j.title,". Please try again.")),m.value=B,e.value=!1;return}}await Je(b.value),await te(),de("Successfully saved ".concat(R," section(s)")),g.push("/quickCheck")}catch(_){console.error("Error in saveAllData:",_),$("Error occurred while saving data. Please try again.")}finally{e.value=!1}};return ue(async()=>{if(w.NCDActivities.length===0){g.push("patientProfile");return}G.value=C(),await te(),(m.value===void 0||m.value<0)&&(m.value=0),o.value=!1,e.value=!1,p()}),K(m,async()=>{await p()}),K(b,async()=>{await te()},{deep:!0}),K(x,async()=>{await te()},{deep:!0}),K(a,async()=>{ve(),G.value=C()},{deep:!0}),K(b,async(P,_)=>{_.ID!=P.ID&&ve()},{deep:!0}),I({saveAllData:he,markWizard:te,refreshWizard:ve,validateDoneButtonState:p}),(P,_)=>(D(),ee(h($e),null,{default:U(()=>[T(Ue),T(h(qe),{fullscreen:!0},{default:U(()=>[T(Qe),d("div",la,[c.value?(D(),ee(Ze,{key:0,ref:"wizard",headingTitle:"ANC Profile","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:v.value,"custom-tabs":G.value,beforeChange:ke,onChange:Pe,"onComplete:wizard":_[1]||(_[1]=M=>he()),onDoneButtonChanged:f},{default:U(()=>[d("div",null,[d("div",ua,[T(je,{name:"Back to Profile",iconSlot:"start",fill:"clear",icon:h(Re),"font-weight":"600",onClick:_[0]||(_[0]=M=>s())},null,8,["icon"])])]),Q(d("div",null,[T(ot,{ref_key:"pastObstetricHistoryRef",ref:n},null,512)],512),[[X,q()=="PastObstetricHistory"]]),Q(d("div",null,[T(et,{ref_key:"medicalHistoryRef",ref:i},null,512)],512),[[X,q()=="MedicalHistory"]]),Q(d("div",null,[T(na,{ref_key:"currentPregnancyRef",ref:t},null,512)],512),[[X,q()=="CurrentPregnancy"]]),Q(d("div",null,[T(oa,{ref_key:"gynaecologyRef",ref:r},null,512)],512),[[X,q()=="Gynaecology"]]),Q(d("div",null,[T(tt,{ref_key:"medicationsRef",ref:l},null,512)],512),[[X,q()=="Medications"]]),Q(d("div",null,[T(at,{ref_key:"womanBehaviourRef",ref:u},null,512)],512),[[X,q()=="WomanBehaviour"]])]),_:1},8,["doneButton","custom-tabs"])):E("",!0)])]),_:1})]),_:1}))}}),ha=re(ca,[["__scopeId","data-v-7e500135"]]);export{ha as default};

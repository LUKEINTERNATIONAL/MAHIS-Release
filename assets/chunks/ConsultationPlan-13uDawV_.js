import{d as Pe,an as Re,cG as xe,r,c as Ie,aU as p,w as u,a as Ne,O as j,f as J,J as B,l as m,u as A,a3 as Be,k as v,m as Ve,i as D,bL as Me,v as b,a6 as Fe,b8 as C}from"./vendor-BpjEhVym.js";import{aG as K,u as $e,aH as He,aI as Le,aJ as ze,aK as Ee,d as Ge,aL as We,g as Ue,Z as je,e as Je,T as Ke,J as Qe,N as Ye,H as V,aM as k,aN as Ze,m as M,aO as Q,aP as qe,t as Y,aQ as Xe,aR as T,G as Oe,aS as et,a0 as tt,S as at}from"../index-DCB2BQuP.js";import{D as st}from"./DemographicBar-BK_nM1pQ.js";import{D as nt,C as it,T as ot}from"./TreatmentPlan-DJaWo89E.js";import{I as lt,N as rt,_ as ct}from"./NextAppointment-CeU-A_c-.js";import{_ as ut}from"./RiskAssessment.vue_vue_type_script_setup_true_lang-BEFqcwg6.js";import{_ as mt}from"./Vitals.vue_vue_type_script_setup_true_lang-DP-9UMEX.js";import{u as dt,a as F,_ as vt,s as ft,c as gt,b as pt}from"./nonPharmaTherapyStore-C1OFptYG.js";import{l as ht}from"./lodash-NJiRuGo9.js";import{a as Z,b as St}from"./formatServerData-zqb2yhjf.js";import{C as Dt}from"./Registration-BTXl1rPb.js";import{u as bt}from"./usePatientProfile-CTAGMj_H.js";import"./apexcharts-DMAoEdNS.js";import"./patient_diagnosis_service-GUiqNrTZ.js";import"./DashBox-De28QOYp.js";import"./BasicForm-CylZfjsy.js";import"./DateInputField-CrB6lk2_.js";import"./previousDiagnosis-Bxqr5YFr.js";import"./group_validation-CiPxwb2F.js";import"./LabOrdersList-BpIRyM-m.js";import"./RadiologyStore-CUsjVSWV.js";import"./previousComplaints-BGVvb2z_.js";import"./patient_complaints_service-eZIzhK8c.js";import"./ncd_appointment_service-CU4ce2u8.js";import"./drug_prescription_service-DAGxQZwn.js";import"./useLocation-Dv5gUi6J.js";import"./vaccines_service-LMNVvQ2r.js";import"./sms_service-DW6PI8NB.js";import"./EIRreportsStore-C3K2RALB.js";import"./Export-BFpAJrkX.js";import"./useNeonatalEnrollmentStore-3kwioDpG.js";import"./enrollment-DU-PLRUa.js";const Ct={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},_t={class:"back_profile"},sa=Pe({__name:"ConsultationPlan",setup(yt,{expose:q}){const{onTabBeforeChange:X,currentTabIndex:d}=dt(),{printVisitSummary:O}=bt(),P=Re(),ee=xe();r([]),r([]),r(!1);const R=r(!0),x=r(!1),h=r(!1),$=Ie(()=>({text:h.value?"Saving...":"Finish",icon:h.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:x.value||h.value})),te=K(),ae=$e(),se=He(),ne=Le();ze();const ie=Ee(),_=Ge();We();const oe=Ue(),le=F(),re=je(),{patient:o}=p(ae),{vitals:ce}=p(te),{investigations:ue}=p(se),{diagnosis:me}=p(ne),{substance:de}=p(oe),{selectedNCDMedicationList:H}=p(ie),{FootScreening:ve,visualScreening:fe,cvScreening:ge}=p(le),{sessionDate:L}=p(re),{apiStatus:wt}=p(Je());r(!1);const pe=async()=>{let e=!1;return await M(Xe,{class:"otherVitalsModal"},!0,{message:"You can screen the patient for AHD, do you want to proceed?"},{cancel:a=>{e=!1},confirm:async a=>{a.detail==!0&&(e=!0)}}),e};u($,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:d.value,tabsLength:s.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),u(h,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const he=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},y=()=>{let e=!1;return S(),h.value&&(e=!0),x.value=e,!e},Se=()=>{P.push("patientProfile")},I=()=>_.NCDActivities.map(e=>({title:e,icon:""})),s=r(I()),z=r(null),E=r(null),De=r(null),be=r(null),Ce=r(null),_e=r(null),ye=r(null),S=()=>{var i;if(!s.value||s.value.length===0)return console.log("Tabs not yet initialized"),null;const e=d.value>=0&&d.value<s.value.length?d.value:0;switch((i=s.value[e])==null?void 0:i.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(_.NCDActivities.length>0)switch(_.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},N=()=>{R.value=!1,setTimeout(()=>{d.value=0,R.value=!0},0)},G=()=>{const e=K();e.setVitals(e.getInitialVitals(o.value.ID))},f=async()=>{var i,l;const e=Ye(L.value,"sessionDate","value")||V.sessionDate(),t=k("vitals");for(let a=0;a<s.value.length;a++){const c=s.value[a];if(c.title==="Vital Signs")s.value[a].icon=w(e,t)?C:"";else if(c.title==="Risk Assessment"){const n=k("substanceAbuse");s.value[a].icon=w(e,n)?C:""}else if(c.title==="Investigations"){const n=(l=(i=o==null?void 0:o.value)==null?void 0:i.labOrders)==null?void 0:l.saved,g=n==null?void 0:n.filter(U=>V.toStandardHisFormat(e)===V.toStandardHisFormat(U.order_date));s.value[a].icon=(g==null?void 0:g.length)>0?C:""}else if(c.title==="Diagnosis"){const n=k("diagnosis");s.value[a].icon=w(e,n)?C:""}else if(c.title==="Complications Screening"){const n=k("screening");s.value[a].icon=w(e,n)?C:""}else c.title==="Treatment Plan"&&(H.value.length>0?s.value[a].icon=Ze()?C:"":s.value[a].icon="")}y()},w=(e,t)=>{const i=new Date(e);return i.setHours(0,0,0,0),t.some(l=>{const a=new Date(l.obs_datetime);return a.setHours(0,0,0,0),a.getTime()===i.getTime()})},we=async()=>{var a,c,n,g;const e=[],t=await Z(fe.value),i=await St(ve.value),l=await Z(ge.value);t.length>0&&e.push({concept_id:await T.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:T.getSessionDate(),child:t}),i.length>0&&e.push({concept_id:await T.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:T.getSessionDate(),child:i}),l.length>0&&e.push(...l),e.length>0?((g=(n=(c=(a=o.value).screening)!=null?c:a.screening={}).unsaved)!=null||(n.unsaved=[]),o.value.screening.unsaved.push(...e),Oe("Complications saved successfully")):Y("No complications data to save")},Ae=async()=>{const e=et();if(!ht.isEmpty(e.selectedMedicalAllergiesList)){const l=tt(),a=e.selectedMedicalAllergiesList.map(n=>({concept_id:n.concept_id,obs_datetime:at.getSessionDate(),value_coded:n.concept_id,location_id:l.facilityLocation.code,value_text:n.name})),c=await ft(a);o.value=Object.assign(o.value,c),console.log("Allergies staged successfully:",o.value),e.clearSelectedMedicalAllergiesList()}const t=await gt();o.value=Object.assign(o.value,t);const i=await pt().saveNonPharmaTherapyPatientData();o.value=Object.assign(o.value,i)},ke=async(e,t)=>{var a,c,n,g;const i=(a=s.value[e])==null?void 0:a.title,l=(c=s.value[t])==null?void 0:c.title;e%1===0&&(d.value=e),l=="Vital Signs"&&((n=z.value)==null||n.onSubmit()),l=="Risk Assessment"&&((g=E.value)==null||g.onSubmit()),l=="Complications Screening"&&await we(),l=="Treatment Plan"&&await Ae(),i=="Investigations"&&await pe()==!0&&await M(ct,{class:"fullScreenModal"},!0,{closeModalOnFinish:!0}),await Q(o.value)},W=async()=>{h.value=!0;try{await qe(),await Q(o.value),await Te(),P.push("patientProfile")}catch(e){console.error("Error saving data:",e),Y("Error occurred while saving data. Please try again.")}finally{h.value=!1}},Te=async()=>{await M(Dt,{class:"small-confirm-modal "})!=="dismiss"&&await O()};return Ne(async()=>{if(_.NCDActivities.length===0){P.push("patientProfile");return}F().resetScreening(),s.value=I(),await f(),(d.value===void 0||d.value<0)&&(d.value=0,console.log("Setting initial tab index to 0")),x.value=!1,h.value=!1,y()}),u(d,async()=>{await y()}),u(ce,async()=>{await f()},{deep:!0}),u(o,async()=>{F().resetScreening(),await f()},{deep:!0}),u(L,async()=>{await f()},{deep:!0}),u(ue,async()=>{await f()},{deep:!0}),u(me,async()=>{await f()},{deep:!0}),u(de,async()=>{await f()},{deep:!0}),u(H,async()=>{await f()},{deep:!0}),u(ee,async e=>{N(),G(),s.value=I()},{deep:!0}),u(o,async(e,t)=>{e.ID!=t.ID&&(N(),G())},{deep:!0}),q({saveData:W,markWizard:f,refreshWizard:N,validateDoneButtonState:y}),(e,t)=>(J(),j(A(Fe),null,{default:B(()=>[m(Ke),m(A(Be),{fullscreen:!0},{default:B(()=>[m(st),v("div",Ct,[R.value?(J(),j(vt,{key:0,ref:"wizard",headingTitle:"Consultation Plan","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:$.value,"custom-tabs":s.value,beforeChange:A(X),onChange:ke,"onComplete:wizard":t[1]||(t[1]=i=>W()),onDoneButtonChanged:he},{default:B(()=>[v("div",null,[v("div",_t,[m(Qe,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:A(Me),"font-weight":"600",onClick:t[0]||(t[0]=i=>Se())},null,8,["icon"])])]),D(v("div",null,[m(mt,{ref_key:"vitalsRef",ref:z},null,512)],512),[[b,S()=="Vitals"]]),D(v("div",null,[m(ut,{ref_key:"riskAssessmentRef",ref:E},null,512)],512),[[b,S()=="RiskAssessment"]]),D(v("div",null,[m(lt,{ref_key:"investigationsRef",ref:De},null,512)],512),[[b,S()=="Investigations"]]),D(v("div",null,[m(nt,{ref_key:"diagnosisRef",ref:be},null,512)],512),[[b,S()=="DiagnosisComponent"]]),D(v("div",null,[m(it,{ref_key:"complicationsRef",ref:Ce},null,512)],512),[[b,S()=="ComplicationsScreening"]]),D(v("div",null,[m(ot,{ref_key:"treatmentPlanRef",ref:_e},null,512)],512),[[b,S()=="TreatmentPlan"]]),D(v("div",null,[m(rt,{ref_key:"nextAppointmentRef",ref:ye},null,512)],512),[[b,S()=="NextAppointment"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Ve("",!0)])]),_:1})]),_:1}))}});export{sa as default};

import{d as S,b2 as A,cp as D,r as n,w as u,a as E,b7 as p,cW as k,e as c,f as d,l as x,J as H,k as _,F as B,P as N,K as T,u as F}from"./vendor-CzFJ4KTZ.js";import{u as O,ag as V,H as q,_ as C}from"../index-CmeorCN9.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-C9muk_WD.js";const I={class:"table-responsive"},M=S({__name:"AllergiesHistory",setup(R){const f=O(),{patient:b}=A(f),y=D(),m=n(null),r=n([]),v=n(["Allergy","Date","Status"]),g=n({responsive:!0,select:!1,layout:{topStart:"",topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1}),h=s=>{const a=new Map;return s.forEach(t=>{const e="".concat(t.value_coded,"_").concat(t.value_text);if(!a.has(e))a.set(e,t);else{const o=a.get(e);t.obs_id&&o.obs_id?t.obs_id>o.obs_id&&a.set(e,t):t.obs_datetime&&o.obs_datetime&&new Date(t.obs_datetime)>new Date(o.obs_datetime)&&a.set(e,t)}}),Array.from(a.values())},l=async()=>{try{r.value=[];const s=await V.getObsByEncounterId(30);if(s&&Array.isArray(s)){let a=[];s.forEach(e=>{if(e.obs&&Array.isArray(e.obs)){const o=e.obs.map(i=>({...i,encounterStatus:e.status}));a=a.concat(o)}}),h(a).forEach(e=>{const o=e.value_text||"Unknown Allergy",i=e.obs_datetime?q.toStandardHisDisplayFormat(e.obs_datetime):"N/A",w=e.encounterStatus==="saved"||e.obs_id!==void 0&&e.obs_id!==null?'<span style="color: #046c04; font-weight: bold;">Saved</span>':'<span style="color: #ff9800; font-weight: bold;">Unsaved</span>';r.value.push([o,i,w])})}}catch(s){console.error("Error updating allergy data:",s),r.value=[]}};return u(()=>y,async()=>{await l()},{deep:!0,immediate:!0}),u(b,async()=>{await l()},{deep:!0,immediate:!0}),E(async()=>{await l(),p.use(k)}),(s,a)=>(d(),c("div",I,[x(F(p),{ref_key:"dataTable",ref:m,options:g.value,data:r.value,class:"display nowrap modern-table",width:"100%"},{default:H(()=>[_("thead",null,[_("tr",null,[(d(!0),c(B,null,N(v.value,t=>(d(),c("th",{key:t},T(t),1))),128))])])]),_:1},8,["options","data"])]))}}),L=C(M,[["__scopeId","data-v-255115b8"]]);export{L as default};

var Pe=Object.defineProperty;var Se=(l,r,i)=>r in l?Pe(l,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[r]=i;var U=(l,r,i)=>Se(l,typeof r!="symbol"?r+"":r,i);import{d as ge,L as w,N as S,a5 as B,a4 as z,E as Te,a6 as fe,M as J,I as Ne,a3 as me,aS as Ve,ce as G,R as $e,H as O,e as v,f as m,l as o,J as c,k as e,K as d,Q as y,F as C,aV as F,ao as qe,cp as Ae,r as P,c as Be,w as oe,a as ze,O as re,u as s,ax as j,P as $,bq as ae,aU as le,m as N,b2 as ie,p as de,eI as ce,c6 as ue,aR as Fe,aQ as Ee}from"./vendor-BolvhNQv.js";import{E as Re}from"./EIRreportsStore-hgF2UhSl.js";import{N as He}from"./NavigationMenu-Dj36egf6.js";import{V as Ue}from"./ViewToggleComponent-Dlg-_III.js";import{l as je,_ as ye,b1 as L,P as Le,S as K,u as _e,aQ as ve,G as Qe,bZ as Je,bF as pe,d as Ge,q as Ke,aE as Ze,n as We,s as Q,m as Xe,b_ as Ye,o as et}from"../index-BOg8gPmV.js";import{a as he}from"./drug_prescription_service-CtSNlkd9.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-Go-aTq24.js";const tt=ge({name:"MedicationDetailsModal",components:{IonContent:me,IonHeader:Ne,IonFooter:J,IonPage:fe,IonTitle:Te,IonRow:z,IonCol:B,IonButton:S,IonIcon:w},props:{selectedMedication:{type:Object,default:null}},data(){return{iconsContent:je,medkit:G,closeIcon:Ve,dismiss:()=>(this.$emit("close"),$e.dismiss())}},methods:{formatFullDate(l){return l?new Date(l).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"N/A"},getFrequencyLabel(l){const r=he.find(i=>i.code===l);return r?r.label:"Unknown"}}}),st={class:"medication-details-header"},nt={class:"modal_wrapper"},ot={class:"medication-details-modal"},rt={class:"text-xl font-bold mb-4"},at={class:"grid grid-cols-2 gap-3"};function lt(l,r,i,g,h,I){const p=O("ion-icon"),D=O("ion-title"),x=O("ion-header"),V=O("ion-content"),E=O("ion-button"),k=O("ion-col"),q=O("ion-row"),A=O("ion-footer");return m(),v(C,null,[o(x,{style:{display:"flex","justify-content":"space-between"}},{default:c(()=>[o(D,{class:"modalTitle"},{default:c(()=>[e("div",st,[o(p,{icon:l.medkit,class:"ion-margin-end"},null,8,["icon"]),r[1]||(r[1]=e("span",null,"Medication Details",-1))])]),_:1}),o(p,{onClick:r[0]||(r[0]=T=>l.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:l.iconsContent.cancel},null,8,["icon"])]),_:1}),o(V,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:c(()=>[e("div",nt,[e("div",ot,[e("h2",rt,d(l.selectedMedication.drug.name),1),e("div",at,[e("div",null,[r[2]||(r[2]=e("strong",null,"Order ID:",-1)),y(" "+d(l.selectedMedication.order_id),1)]),e("div",null,[r[3]||(r[3]=e("strong",null,"Drug ID:",-1)),y(" "+d(l.selectedMedication.drug_inventory_id),1)]),e("div",null,[r[4]||(r[4]=e("strong",null,"Dose:",-1)),y(" "+d(l.selectedMedication.dose)+" "+d(l.selectedMedication.units),1)]),e("div",null,[r[5]||(r[5]=e("strong",null,"Equivalent Daily Dose:",-1)),y(" "+d(l.selectedMedication.equivalent_daily_dose),1)]),e("div",null,[r[6]||(r[6]=e("strong",null,"Frequency:",-1)),y(" "+d(l.getFrequencyLabel(l.selectedMedication.frequency)),1)]),e("div",null,[r[7]||(r[7]=e("strong",null,"Order Type:",-1)),y(" "+d(l.selectedMedication.order.order_type_id),1)]),e("div",null,[r[8]||(r[8]=e("strong",null,"Start Date:",-1)),y(" "+d(l.formatFullDate(l.selectedMedication.order.start_date)),1)]),e("div",null,[r[9]||(r[9]=e("strong",null,"Date Created:",-1)),y(" "+d(l.formatFullDate(l.selectedMedication.order.date_created)),1)]),e("div",null,[r[10]||(r[10]=e("strong",null,"Orderer:",-1)),y(" "+d(l.selectedMedication.order.orderer),1)]),e("div",null,[r[11]||(r[11]=e("strong",null,"Instructions:",-1)),y(" "+d(l.selectedMedication.order.instructions),1)])])])])]),_:1}),o(A,{collapse:"fade",class:"ion-no-border"},{default:c(()=>[o(q,null,{default:c(()=>[o(k,null,{default:c(()=>[o(E,{onClick:l.dismiss,color:"primary",style:{float:"right","margin-bottom":"20px","margin-right":"20px"}},{default:c(()=>[o(p,{icon:l.closeIcon,slot:"start"},null,8,["icon"]),r[12]||(r[12]=y(" Close ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})],64)}const it=ye(tt,[["render",lt],["__scopeId","data-v-01db984e"]]);class dt extends L{constructor(i=null,g=null){const h=new Le,I=i!==null?i:h.getID(),p=g!==null?g:K.getUserID();super(I,32,p);U(this,"drugHistory");U(this,"currentDrugOrder");this.drugHistory=[],this.currentDrugOrder=[]}getDrugHistory(){return this.drugHistory}getCurrentOrder(){return this.currentDrugOrder}getDispensationArryObj(i){return[{drug_order_id:i.order_id,date:this.date,quantity:i.amountToDispense,offline_id:i.offline_id,provider_id:this.providerID,program_id:i.program_id,patient_id:this.patientID}]}saveDispensations(i,g){return L.postJson("/dispensations",{dispensations:i,provider_id:this.providerID,program_id:g})}generateOfflineDispensatiobObject(i,g){return{dispensations:i,provider_id:this.providerID,program_id:g,patient_id:this.patientID}}async saveDispensationsOffline(i){var g,h,I;try{const p=_e(),{patient:D}=F(p),x=JSON.parse(JSON.stringify(D.value));i.length>0&&((I=(h=(g=x.dispensations)!=null?g:x.dispensations={}).unsaved)!=null||(h.unsaved=[]),x.dispensations.unsaved.length>=0&&x.dispensations.unsaved.push(...i)),await ve(x),Qe("Dispensations saved offline successfully")}catch(p){Je("Error saving dispensations offline"+p)}}async voidOrder(i){return L.void("/dispensations/".concat(i),{})}async loadDrugHistory(){const i=await pe.getDrugOrderHistory(this.patientID);i&&(this.drugHistory=i)}async loadCurrentDrugOrder(){const i=await pe.getDrugOrders(this.patientID);i&&(this.currentDrugOrder=await Promise.all(i))}calcCompletePack(i,g){const h=i.barcodes.sort(function(D,x){return D.tabs-x.tabs});if(h.length==0||g==0)return g;for(let D=0;D<=h.length-1;D++)if(parseInt(h[D].tabs)>=g)return h[D].tabs;const I=parseInt(h[0].tabs);let p=parseInt(h[h.length-1].tabs);for(;p<g;)p+=I;return p}}const ct={key:0,style:{margin:"20px"},class:"flex flex-col items-center justify-center p-8"},ut={key:1,class:"p-4",style:{"margin-left":"10px","margin-right":"10px"}},pt={class:"text-xl font-bold mb-4 program-name"},gt={class:"overflow-x-auto"},ft={class:"w-full"},mt={class:"p-3"},yt={class:"p-3"},_t={class:"flex items-center"},vt={class:"p-3"},ht={class:"p-3"},Dt={class:"p-3"},bt={class:"flex items-center space-x-2"},xt={key:0,class:"error-text text-sm"},wt={class:"p-3"},kt={class:"flex space-x-2"},Ct={key:0,class:"text-center py-8"},It={key:2,class:"p-4",style:{"margin-left":"10px","margin-right":"10px"}},Mt={class:"text-xl font-bold mb-4 program-name"},Ot={class:"text-lg font-bold mb-2",style:{"margin-left":"10px","margin-right":"10px"}},Pt={class:"text-md font-medium",style:{"margin-left":"10px","margin-right":"10px"}},St={class:"medication-details"},Tt={class:"flex justify-between mb-3"},Nt={class:"flex items-center"},Vt={class:"flex items-center mb-3"},$t={key:0,class:"error-text"},qt={class:"mt-3 flex space-x-2",style:{"margin-top":"10px"}},At={key:0,class:"text-center mb-8"},Bt=ge({__name:"NCDMedicationDispenstion",setup(l){const r=Re(),i=_e(),g=Ge(),h=Ke(),{navigationPayload:I}=F(r),{patient:p}=F(i),{NCDMedicatioTogglePreference:D}=F(g),x=qe(),V=Ae(),E=P(null),k=P({}),q=P([]),A=P(null);P(""),P(!1);const T=P(!1);Be(()=>q.value.reduce((t,n)=>{const u=n.order.date_created.split("T")[0];return t[u]||(t[u]=[]),t[u].push(n),t},{}));const R=async()=>{se(),q.value=[],ke(),T.value=!1,await Ce()},De=async()=>{try{return await Ye()?await Z():await be()}catch(t){return console.error("Error fetching programs:",t),await Z()}},Z=async()=>await K.getJson("/programs",{page_size:1e3}),be=async()=>{try{return await et("programs")}catch(t){throw console.error("Error fetching offline districts:",t.message),t}},xe=async()=>{await new Ze().printData("visit")},we=async t=>{await W(t),await x.push("/home")},W=async t=>{try{await We(t),await h.refresh(K.getUserLocationId())}catch(n){console.error(n)}},ke=()=>{r.setNavigationPayload("Dispense Medication",!0,!1,"/","home")},Ce=async()=>{var b,a,_,f,M,ne;const t=(_=(a=(b=p.value)==null?void 0:b.MedicationOrder)==null?void 0:a.saved)!=null?_:[],n=(ne=(M=(f=p.value)==null?void 0:f.MedicationOrder)==null?void 0:M.unsaved)!=null?ne:[],u=[...t,...n];await Ie(u)},Ie=async t=>{const n=await De(),u={};n.forEach(a=>{u[a.program_id]=a.name}),k.value={},t.forEach(a=>{const _=u[a.program_id];_&&(k.value[_]||(k.value[_]=[]),a.quantity||k.value[_].push(a))}),t.every(a=>a.quantity)&&W(p.value)},X=t=>{const n=he.find(u=>u.code===t);return n?n.label:"Unknown"},H=t=>{const n=parseFloat(t.amountToDispense);isNaN(n)||n<=0?t.error="Please enter a valid amount greater than 0.":t.error=null},zt=t=>{t.amountToDispense=t.dose,H(t)},Y=async t=>{T.value=!0;try{if(t.error){Q("Fix errors before dispensing.");return}t.quantity=t.amountToDispense;const u=new dt().getDispensationArryObj(t);t.dispensation=u,t.dispensed=!0,await ve(p.value)}catch(n){Q("Dispensing failed. Please try again."),Q("Error: "+n),console.error(n)}finally{T.value=!1}},ee=async t=>{A.value=t,await Xe(it,{class:"large-modal"},!0,{selectedMedication:A.value})},te=t=>new Date(t).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),Me=t=>{se(t,!0)},se=(t="list",n=!1)=>{const u={toggle_view:t};Object.keys(D.value).length===0&&(u.toggle_view="list",g.setNCDMedicatioTogglePreference(u)),Object.keys(D.value).length>0&&n===!0&&g.setNCDMedicatioTogglePreference(u)},Oe=t=>(console.log("Grouping medications by date:",t),t.reduce((n,u)=>{const b=u.start_date.split("T")[0];return n[b]||(n[b]=[]),n[b].push(u),n},{}));return oe(p,async()=>{T.value||V.name==="NCDDispensations"&&await R()},{deep:!0}),oe(V,t=>{T.value||t.name==="NCDDispensations"&&R()},{immediate:!0}),ze(()=>{R()}),(t,n)=>(m(),re(s(fe),null,{default:c(()=>[o(He,{ref_key:"navMenuRef",ref:E},null,512),o(Ue,{"initial-view":s(D).toggle_view,onViewChanged:Me},null,8,["initial-view"]),o(s(me),null,{default:c(()=>[Object.keys(k.value).length===0?(m(),v("div",ct,[o(s(w),{icon:s(j),size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),n[2]||(n[2]=e("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Medications to Dispense",-1)),n[3]||(n[3]=e("p",{class:"text-gray-600"},"There are currently no medications waiting to be dispensed for current Client.",-1))])):s(D).toggle_view==="list"?(m(),v("div",ut,[(m(!0),v(C,null,$(k.value,(u,b)=>(m(),v(C,{key:b},[e("h2",pt,d(b),1),o(s(ae),{class:"mb-6"},{default:c(()=>[o(s(le),null,{default:c(()=>[e("div",gt,[e("table",ft,[n[6]||(n[6]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"p-3 text-left"},"Date"),e("th",{class:"p-3 text-left"},"Medication"),e("th",{class:"p-3 text-left"},"Dose"),e("th",{class:"p-3 text-left"},"Frequency"),e("th",{class:"p-3 text-left"},"Amount to Dispense"),e("th",{class:"p-3 text-left"},"Actions")])],-1)),e("tbody",null,[(m(!0),v(C,null,$(u,a=>(m(),v("tr",{key:(a==null?void 0:a.order_id)||(a==null?void 0:a.offline_id),class:"border-b hover:bg-gray-50"},[e("td",mt,d(te(a.start_date)),1),e("td",yt,[e("div",_t,[o(s(w),{icon:s(G),class:"mr-2"},null,8,["icon"]),y(" "+d(a.drug_name),1)])]),e("td",vt,d(a.dose)+" "+d(a.units),1),e("td",ht,d(X(a.frequency)),1),e("td",Dt,[e("div",bt,[o(s(ie),{type:"number",placeholder:"Amount",modelValue:a.amountToDispense,"onUpdate:modelValue":_=>a.amountToDispense=_,onInput:_=>H(a),class:de(["w-24 dose-input bordered-input",a.error?"input-error":""])},null,8,["modelValue","onUpdate:modelValue","onInput","class"]),N("",!0)]),a.error?(m(),v("div",xt,d(a.error),1)):N("",!0)]),e("td",wt,[e("div",kt,[o(s(S),{color:"primary",size:"small",onClick:_=>Y(a),disabled:!a.amountToDispense||parseFloat(a.amountToDispense)<=0||a.dispensed},{default:c(()=>[o(s(w),{icon:s(ce),class:"mr-1",style:{"margin-right":"5px"}},null,8,["icon"]),y(" "+d(a.dispensed?"Dispensed":"Dispense"),1)]),_:2},1032,["onClick","disabled"]),o(s(S),{color:"secondary",size:"small",onClick:_=>ee(a),style:{"margin-left":"10px"}},{default:c(()=>[o(s(w),{icon:s(ue),class:"mr-1",style:{"margin-right":"5px"}},null,8,["icon"]),n[5]||(n[5]=y(" Details ",-1))]),_:1},8,["onClick"])])])]))),128))])]),u.length===0?(m(),v("div",Ct,[o(s(w),{icon:s(j),size:"large",class:"mb-2"},null,8,["icon"]),e("p",null,"No medications prescribed for "+d(b),1)])):N("",!0)])]),_:2},1024)]),_:2},1024)],64))),128))])):(m(),v("div",It,[(m(!0),v(C,null,$(k.value,(u,b)=>(m(),v(C,{key:b},[e("h2",Mt,d(b),1),(m(!0),v(C,null,$(Oe(u),(a,_)=>(m(),v(C,{key:_},[e("h3",Ot,d(te(_)),1),o(s(z),null,{default:c(()=>[o(s(B),{size:"12","size-md":"6","size-lg":"4"},{default:c(()=>[e("h3",Pt,d(_),1)]),_:2},1024)]),_:2},1024),o(s(z),null,{default:c(()=>[(m(!0),v(C,null,$(a,f=>(m(),re(s(B),{style:{"margin-left":"10px","margin-right":"10px"},key:f.order_id,size:"12","size-md":"6","size-lg":"4"},{default:c(()=>[o(s(ae),{class:"mb-4"},{default:c(()=>[o(s(Fe),null,{default:c(()=>[o(s(Ee),{class:"medication-details-header"},{default:c(()=>[o(s(w),{icon:s(G),class:"ion-margin-end"},null,8,["icon"]),e("span",null,d(f.drug_name),1)]),_:2},1024)]),_:2},1024),o(s(le),null,{default:c(()=>[e("div",St,[e("div",Tt,[e("span",Nt,d(X(f.frequency))+" ("+d(f.frequency)+") ",1)]),e("div",Vt,[o(s(ie),{type:"number",placeholder:"Amount",modelValue:f.amountToDispense,"onUpdate:modelValue":M=>f.amountToDispense=M,onInput:M=>H(f),class:de(["w-24 dose-input bordered-input",f.error?"input-error":""])},null,8,["modelValue","onUpdate:modelValue","onInput","class"]),N("",!0)]),f.error?(m(),v("div",$t,d(f.error),1)):N("",!0),e("div",qt,[o(s(S),{color:"primary",onClick:M=>Y(f),disabled:!f.amountToDispense||parseFloat(f.amountToDispense)<=0||f.dispensed},{default:c(()=>[o(s(w),{icon:s(ce),class:"mr-2",style:{"margin-right":"5px"}},null,8,["icon"]),y(" "+d(f.dispensed?"Dispensed":"Dispense"),1)]),_:2},1032,["onClick","disabled"]),o(s(S),{color:"secondary",style:{"margin-left":"20px"},onClick:M=>ee(f)},{default:c(()=>[o(s(w),{icon:s(ue),class:"mr-2",style:{"margin-right":"5px"}},null,8,["icon"]),n[8]||(n[8]=y(" Details ",-1))]),_:1},8,["onClick"])])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)],64))),128)),u.length===0?(m(),v("div",At,[o(s(w),{icon:s(j),size:"large",class:"mb-2"},null,8,["icon"]),e("p",null,"No medications prescribed for "+d(b),1)])):N("",!0)],64))),128))]))]),_:1}),o(s(J),{collapse:"fade",class:"ion-no-border"},{default:c(()=>[o(s(z),null,{default:c(()=>[o(s(B),null,{default:c(()=>[o(s(S),{id:"cbtn",class:"",color:"primary",fill:"solid",style:{float:"right","margin-left":"50px"},onClick:n[0]||(n[0]=u=>xe())},{default:c(()=>[...n[9]||(n[9]=[y(" Print Visit Summary ",-1)])]),_:1}),o(s(S),{id:"cbtn",class:"",color:"danger",fill:"solid",style:{float:"right","margin-left":"50px"},onClick:n[1]||(n[1]=u=>we(s(p)))},{default:c(()=>[...n[10]||(n[10]=[y(" Close visit ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),o(s(J))]),_:1}))}}),Gt=ye(Bt,[["__scopeId","data-v-61766a6b"]]);export{Gt as default};

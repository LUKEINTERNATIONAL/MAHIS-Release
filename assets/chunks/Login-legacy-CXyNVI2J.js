System.register(["./vendor-legacy-MDCAArnS.js","../index-legacy-DRyvt8NW.js","./Img-legacy-BNmikZ_d.js","./userService-legacy-B4IPvWv6.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-COdBUCSh.js"],function(e,a){"use strict";var t,l,s,n,r,o,i,u,d,c,v,p,m,f,g,w,h,y,P,x,b,A,k,_,I,S,C,M,q,E,U,L,z,R,j,N,D,F,H,O,$,T,K,G,B,J,Q,W,X;return{setters:[e=>{t=e.D,l=e.d,s=e.r,n=e.an,r=e.c,o=e.a,i=e.H,u=e.O,d=e.f,c=e.J,v=e.l,p=e.u,m=e.a3,f=e.k,g=e.aS,w=e.aP,h=e.e,y=e.m,P=e.dh,x=e.E,b=e.Q,A=e.K,k=e.b2,_=e.W,I=e.cX,S=e.bC,C=e.c4,M=e.c3,q=e.N,E=e.br,U=e.p,L=e.a6},e=>{z=e.v,R=e.a0,j=e.a1,N=e.t,D=e.U,F=e.G,H=e.a2,O=e.s,$=e.a3,T=e.a4,K=e.a5,G=e.a,B=e.a6,J=e._},e=>{Q=e.i},e=>{W=e.p,X=e.g},null,null],execute:function(){var a=document.createElement("style");a.textContent='.login-page[data-v-18536141]{background-color:#fff}.login-container[data-v-18536141]{display:flex;justify-content:center;align-items:center;text-align:center;height:90vh}.login-title[data-v-18536141]{font-size:24px;margin-bottom:30px;font-weight:700;margin-top:20px}.input-fields[data-v-18536141]{margin-bottom:35px}.invalid-input[data-v-18536141]{--border-color: #ff4444 !important;--color: #ff4444 !important}.password-requirements[data-v-18536141]{text-align:left;margin-bottom:20px;padding:15px;background-color:#f8f9fa;border-radius:8px;border-left:4px solid #34af4d}.requirements-title[data-v-18536141]{margin:0 0 10px;font-weight:600;color:#333;font-size:14px}.requirements-list[data-v-18536141]{margin:0;padding-left:20px;list-style:none}.requirements-list li[data-v-18536141]{margin-bottom:5px;font-size:13px;color:#666;position:relative}.requirements-list li[data-v-18536141]:before{content:"✗";color:#f44;font-weight:700;position:absolute;left:-20px}.requirements-list li.valid[data-v-18536141]:before{content:"✓";color:#34af4d}.requirements-list li.valid[data-v-18536141]{color:#34af4d}.password-toggle[data-v-18536141]{cursor:pointer;position:absolute;margin-top:-73px;margin-left:130px;z-index:1000}.login-button[data-v-18536141]{color:#fff;margin-top:30px}.login-button[data-v-18536141]:disabled{opacity:.5;cursor:not-allowed}.signup-link[data-v-18536141]{margin-top:50px}.signup-link a[data-v-18536141]{text-decoration:underline;color:#34af4d;cursor:pointer}.signup-link a[data-v-18536141]:hover{color:#2d8f3f}.password-toggle[data-v-18536141]{font-size:20px}.login_img[data-v-18536141]{width:90px;margin:auto}ion-card[data-v-18536141]{min-width:330px}@media(max-width:902px){.login-page[data-v-18536141]{--ion-background-color: #ffffff}ion-card[data-v-18536141]{box-shadow:unset}}\n/*$vite$:1*/',document.head.appendChild(a);const Y=t("authStatusStore",{state:()=>({emrAuthenticated:!1,miumAuthenticated:!1,lastLoginAttempt:null,loginTimestamp:null,username:""}),getters:{isPartiallyAuthenticated:e=>e.emrAuthenticated||e.miumAuthenticated,isFullyAuthenticated:e=>e.emrAuthenticated&&e.miumAuthenticated,authenticationStatus:e=>e.emrAuthenticated&&e.miumAuthenticated?"full":e.emrAuthenticated||e.miumAuthenticated?"partial":"none",authenticatedSystems:e=>{const a=[];return e.emrAuthenticated&&a.push("EMR"),e.miumAuthenticated&&a.push("MIUM"),a},failedSystems:e=>{const a=[];return e.emrAuthenticated||a.push("EMR"),e.miumAuthenticated||a.push("MIUM"),a}},actions:{setEMRAuthenticated(e){this.emrAuthenticated=e,e&&(this.loginTimestamp=new Date)},setMIUMAuthenticated(e){this.miumAuthenticated=e},setUsername(e){this.username=e},recordLoginAttempt(){this.lastLoginAttempt=new Date},clearAuthStatus(){this.emrAuthenticated=!1,this.miumAuthenticated=!1,this.loginTimestamp=null,this.lastLoginAttempt=null,this.username=""},hasSystemAccess(e){return"EMR"===e?this.emrAuthenticated:this.miumAuthenticated}},persist:!0}),Z={class:"login-container"},V={key:0,style:{"justify-content":"center",display:"block"}},ee={style:{"font-size":"15px"}},ae={style:{"font-size":"12px",color:"#34af4d"}},te={key:1},le={style:{"font-size":"15px"}},se={key:0},ne={style:{"text-align":"left"}},re={class:"signup-link"},oe={style:{display:"flex","justify-content":"center","align-items":"center"}},ie={key:1},ue={style:{"text-align":"left"}},de={key:0,class:"password-requirements"},ce={class:"requirements-list"},ve={class:"signup-link"};e("default",J(l({__name:"Login",setup(e){const a=s(""),t=s(""),l=s(""),J=s(!1),pe=s(!1),me=s("test"),fe=s(new B),ge=s({username:"",currentPassword:"",newPassword:"",confirmPassword:""}),we=s(!1),he=s(!1),ye=s(!1),Pe=n(),xe=z(),be=R(),Ae=r(()=>""!==ge.value.username.trim()&&""!==ge.value.currentPassword.trim()&&""!==ge.value.newPassword.trim()&&""!==ge.value.confirmPassword.trim()&&j(ge.value.newPassword)&&ge.value.newPassword===ge.value.confirmPassword&&ge.value.newPassword!==ge.value.currentPassword),ke=()=>{pe.value=!pe.value,pe.value&&(ge.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""})},_e=()=>{N("Help functionality to be implemented")},Ie=async()=>{if(!Ae.value)return N("Please complete all fields correctly"),void N("Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character.");try{const e=await fe.value.requestLogin(ge.value.currentPassword,ge.value.username);if(e){const{authorization:a}=e,{token:t,user:l}=a;l&&(localStorage.setItem("apiKey",t),await D.updateUser(l.user_id,{password:ge.value.newPassword}),F("Password changed successfully!"),await fe.value.requestLogin(ge.value.newPassword,ge.value.username),ge.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""},pe.value=!1,localStorage.setItem("apiKey",""))}}catch(e){O(e instanceof H?"Current password is incorrect":`Error changing password: ${e}`)}},Se=async()=>{const e=Y();if(!a.value||!t.value)return{success:!1,error:null,validationError:!0};fe.value.setUsername(a.value),e.setUsername(a.value);try{return await fe.value.login(t.value),await(async()=>{const e=R(),a=await X();a&&(e.setUserFacilityName(a.name),e.setFacilityLocation(a),localStorage.setItem("facility_code",a.code))})(),await(async()=>{const e=await fe.value.checkUserPrograms(void 0);null!=e&&e.programs&&G().setAuthorizedPrograms(null==e?void 0:e.programs)})(),await K(),await W(),e.setEMRAuthenticated(!0),be.setLoginStatus(!0),{success:!0,error:null}}catch(l){return e.setEMRAuthenticated(!1),be.setLoginStatus(!1),{success:!1,error:l}}},Ce=async()=>{const e=Y();if(!a.value||!t.value)return{success:!1,error:null,validationError:!0};fe.value.setUsername(a.value);try{return await fe.value.loginToMIUM(t.value),e.setMIUMAuthenticated(!0),{success:!0,error:null}}catch(l){return e.setMIUMAuthenticated(!1),{success:!1,error:l}}},Me=async()=>{const e=Y();if(!a.value||!t.value)return void N("Complete form to log in");e.recordLoginAttempt();const[l,s]=await Promise.allSettled([Se(),Ce()]),n="fulfilled"===l.status&&l.value.success,r="fulfilled"===s.status&&s.value.success;if(n)Pe.push("/home");else if(n||r)!n&&r&&("fulfilled"===l.status?l.value.error:l.reason);else{const e="fulfilled"===l.status?l.value.error:l.reason;e instanceof H?O("Invalid username or password"):e instanceof $?(ke(),O("Please change your password",5e4)):e instanceof T?(ke(),O("Your password has expired. Please change your password",5e4)):O(`${e}`,5e4)}};return o(async()=>{be.checkLoginStatus()&&Pe.push("/home"),be.setLoginStatus(!1),await fe.value.loadConfig(),l.value=localStorage.getItem("core_version")||"",await(async()=>{xe.terminate(),await z().postData("SET_OFFLINE_PROGRAMS")})()}),(e,s)=>{const n=i("ion-icon");return d(),u(p(L),null,{default:c(()=>[v(p(m),{class:"ion-padding login-page"},{default:c(()=>[f("div",Z,[v(p(g),{style:{"background-color":"#fff"}},{default:c(()=>[v(p(w),null,{default:c(()=>[v(p(P),{class:"login_img",src:p(Q)("mw.png"),id:"logo"},null,8,["src"]),v(p(x),{class:"login-title"},{default:c(()=>["development"===me.value||"test"===me.value?(d(),h("span",V,[f("div",null,[s[11]||(s[11]=b(" MaHIS ",-1)),f("small",ee,"(v"+A(l.value)+")",1)]),f("div",ae,"("+A(me.value)+")",1)])):(d(),h("span",te,[s[12]||(s[12]=b(" MaHIS ",-1)),f("small",le,"(v"+A(l.value)+")",1)]))]),_:1}),pe.value?y("",!0):(d(),h("div",se,[f("span",ne,[v(p(k),{value:a.value,onIonInput:s[0]||(s[0]=e=>a.value=e.target.value||""),type:"text",label:"Username",ref:"usernameRef","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:c(()=>[v(p(_),{slot:"end"},{default:c(()=>[v(n,{icon:p(I)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),v(p(k),{value:t.value,onIonInput:s[2]||(s[2]=e=>t.value=e.target.value||""),type:J.value?"text":"password",label:"Password",ref:"passwordRef","label-placement":"floating",fill:"outline",placeholder:"Enter Password",class:"input-fields",required:"",onKeydown:S(Me,["enter"])},{default:c(()=>[v(p(_),{slot:"end"},{default:c(()=>[v(n,{icon:J.value?p(C):p(M),onClick:s[1]||(s[1]=e=>J.value=!J.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"])]),v(p(q),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:Me,class:"login-button"},{default:c(()=>[...s[13]||(s[13]=[b(" Login ",-1)])]),_:1}),f("p",re,[s[17]||(s[17]=b(" For help click ",-1)),f("a",{href:"#",onClick:E(_e,["prevent"])},"Here"),s[18]||(s[18]=b()),s[19]||(s[19]=f("br",null,null,-1)),f("div",oe,[v(p(q),{fill:"clear",size:"small",onClick:ke,style:{display:"inline","--padding-start":"2px","--padding-end":"2px"}},{default:c(()=>[...s[14]||(s[14]=[f("span",{style:{"text-decoration":"underline",color:"#34af4d",cursor:"pointer"}}," Change Password ",-1)])]),_:1}),s[16]||(s[16]=b(" | ",-1)),v(p(q),{fill:"clear",size:"small",onClick:s[3]||(s[3]=e=>{return a="/downloads",void Pe.push(a);var a}),style:{display:"inline","--padding-start":"2px","--padding-end":"2px"}},{default:c(()=>[...s[15]||(s[15]=[f("span",{style:{"text-decoration":"underline",color:"#34af4d",cursor:"pointer"}}," Download MaHIS ",-1)])]),_:1})])])])),pe.value?(d(),h("div",ie,[s[22]||(s[22]=f("h3",{style:{"text-align":"center","margin-bottom":"20px",color:"#34af4d"}},"Change Password",-1)),f("span",ue,[v(p(k),{value:ge.value.username,onIonInput:s[4]||(s[4]=e=>ge.value.username=e.target.value||""),type:"text",label:"Username","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:c(()=>[v(p(_),{slot:"end"},{default:c(()=>[v(n,{icon:p(I)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),v(p(k),{value:ge.value.currentPassword,onIonInput:s[6]||(s[6]=e=>ge.value.currentPassword=e.target.value||""),type:we.value?"text":"password",label:"Current Password","label-placement":"floating",fill:"outline",placeholder:"Enter Current Password",class:"input-fields",required:""},{default:c(()=>[v(p(_),{slot:"end"},{default:c(()=>[v(n,{icon:we.value?p(C):p(M),onClick:s[5]||(s[5]=e=>we.value=!we.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"]),v(p(k),{value:ge.value.newPassword,onIonInput:s[8]||(s[8]=e=>ge.value.newPassword=e.target.value||""),type:he.value?"text":"password",label:"New Password","label-placement":"floating",fill:"outline",placeholder:"Enter New Password",class:U(["input-fields",{"invalid-input":ge.value.newPassword&&!p(j)(ge.value.newPassword)}]),required:""},{default:c(()=>[v(p(_),{slot:"end"},{default:c(()=>[v(n,{icon:he.value?p(C):p(M),onClick:s[7]||(s[7]=e=>he.value=!he.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"]),v(p(k),{value:ge.value.confirmPassword,onIonInput:s[10]||(s[10]=e=>ge.value.confirmPassword=e.target.value||""),type:ye.value?"text":"password",label:"Confirm New Password","label-placement":"floating",fill:"outline",placeholder:"Confirm New Password",class:U(["input-fields",{"invalid-input":ge.value.confirmPassword&&ge.value.newPassword!==ge.value.confirmPassword}]),required:""},{default:c(()=>[v(p(_),{slot:"end"},{default:c(()=>[v(n,{icon:ye.value?p(C):p(M),onClick:s[9]||(s[9]=e=>ye.value=!ye.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"])]),ge.value.newPassword?(d(),h("div",de,[s[20]||(s[20]=f("p",{class:"requirements-title"},"Password Requirements:",-1)),f("ul",ce,[f("li",{class:U({valid:ge.value.newPassword.length>=8})},"At least 8 characters",2),f("li",{class:U({valid:/[A-Z]/.test(ge.value.newPassword)})},"One uppercase letter",2),f("li",{class:U({valid:/[0-9]/.test(ge.value.newPassword)})},"One number",2),f("li",{class:U({valid:/[@#$%^&+=*!-]/.test(ge.value.newPassword)})}," One special character (@#$%^&+=*!-) ",2),f("li",{class:U({valid:ge.value.newPassword!==ge.value.currentPassword&&""!==ge.value.currentPassword})}," Different from current password ",2)])])):y("",!0),v(p(q),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:Ie,class:"login-button",disabled:!Ae.value},{default:c(()=>[...s[21]||(s[21]=[b(" Change Password ",-1)])]),_:1},8,["disabled"]),f("p",ve,[f("a",{href:"#",onClick:E(ke,["prevent"])},"Back to Login")])])):y("",!0)]),_:1})]),_:1})])]),_:1})]),_:1})}}}),[["__scopeId","data-v-18536141"]]))}}});

System.register(["./vendor-legacy-CKuXRHbj.js","./useFormWizard-legacy-B7BwIHIs.js","../index-legacy-BbRj4XQc.js","./DemographicBar-legacy-B39cTenT.js","./OPDOutcome-legacy-QRrrMX0d.js","./AHDWorkflow.vue_vue_type_script_setup_true_lang-legacy-CFh8eYcJ.js","./OPDDiagnosis-legacy-C_l75bd5.js","./OPDPrintingModal-legacy-OXoCcuKD.js","./lodash-legacy-pOOc9Efu.js","./usePatientProfile-legacy-NxI1MEMM.js","./drug_prescription_service-legacy-g_7EQph1.js","./patient_diagnosis_service-legacy-DkTa_TWn.js","./apexcharts-legacy-D8bOsbLx.js","./LevelOfConsciousness.vue_vue_type_script_setup_true_lang-legacy-D7nf6qmI.js","./previousComplaints-legacy-O4ODquT9.js","./patient_complaints_service-legacy-DcaaC8bq.js","./DashBox-legacy-BIDVFMCe.js","./BasicForm-legacy-DNfJv05i.js","./DateInputField-legacy-C8iOhVhB.js","./formatServerData-legacy-MQtXFeQZ.js","./LabOrdersList-legacy-UMBSm7T2.js","./group_validation-legacy-DDatL0fW.js","./ncd_appointment_service-legacy-4aguTY5d.js","./RadiologyStore-legacy-ChSr6ZMN.js","./Registration-legacy-CHAmgaT2.js","./useLocation-legacy-_IuP09V6.js","./vaccines_service-legacy-pYkjwxMF.js","./sms_service-legacy-BoW9zeLY.js","./EIRreportsStore-legacy-oMdih02d.js","./Export-legacy-Co6I-MoA.js","./useNeonatalEnrollmentStore-legacy-Du5Smndy.js","./enrollment-legacy-BWFKsMdA.js"],function(e,a){"use strict";var t,l,n,s,i,o,u,c,r,d,v,g,m,p,y,b,f,h,_,w,P,x,D,O,j,T,S,I,A,C,N,k,L,F,R,B,E,H,M,z,U,$,J,G,W,Y,Z,q,V,K,Q,X,ee,ae,te,le,ne,se,ie,oe,ue,ce,re,de,ve,ge;return{setters:[e=>{t=e.d,l=e.an,n=e.cG,s=e.r,i=e.c,o=e.aU,u=e.a,c=e.w,r=e.O,d=e.f,v=e.J,g=e.l,m=e.e,p=e.m,y=e.k,b=e.u,f=e.bw,h=e.dv,_=e.a3,w=e.i,P=e.bL,x=e.v,D=e.a6,O=e.eF,j=e.b8},e=>{T=e.u,S=e._,I=e.s,A=e.e,C=e.b},e=>{N=e.u,k=e.aI,L=e.bV,F=e.aK,R=e.d,B=e.aM,E=e.a0,H=e.aX,M=e.bq,z=e.bu,U=e.aT,$=e.T,J=e.J,G=e.G,W=e.s,Y=e.ag,Z=e.aY,q=e.H,V=e.aN,K=e.aP,Q=e.bZ,X=e.t,ee=e.S,ae=e.bI,te=e.q,le=e._},e=>{ne=e.D},e=>{se=e.C,ie=e.b,oe=e.O},e=>{ue=e.I,ce=e.N},e=>{re=e.O},e=>{de=e.O},e=>{ve=e.l},e=>{ge=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".disabled[data-v-dcbfb1eb]{color:red}.spinner-overlay[data-v-dcbfb1eb]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-dcbfb1eb]{width:80px;height:80px}.loading-text[data-v-dcbfb1eb]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-dcbfb1eb]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-dcbfb1eb]{pointer-events:none}.back_profile[data-v-dcbfb1eb]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(a);const me={key:0,class:"spinner-overlay"},pe={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},ye={class:"back_profile"};e("default",le(t({__name:"ConsultationPlan",setup(e){const{currentTabIndex:a}=T(),{printVisitSummary:t}=ge(),le=l(),be=n(),fe=s(!1),he=s(!0),_e=s(!1),we=s(!1),Pe=s(!0),xe=s(!1),De=s(!1),Oe=s(!1),je=N(),Te=k(),Se=L(),Ie=F(),Ae=R(),Ce=B(),Ne=E(),ke=H(),Le=M(),Fe=z(),Re=s(!1),Be=s(!1),Ee=i(()=>({text:Be.value?"Saving...":"Finish",icon:Be.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:Re.value||Be.value})),{patient:He}=o(je),{investigations:Me}=o(Te),{OPDdiagnosis:ze}=o(Se),{selectedMedicalDrugsList:Ue,nonPharmalogicalTherapyAndOtherNotes:$e}=o(Ie),{OPDActivities:Je}=o(Ae),{outcomes:Ge}=o(Ce),{currentSelectedNextAppointmentDate:We}=o(Le),{presentingComplaints:Ye}=o(Fe),{vitals:Ze}=o(ke),qe=U(),Ve=i(()=>qe.selectedMedicalAllergiesList),Ke=s(null),Qe=s(null),Xe=s(null),ea=s(null),aa=s(null),ta=s(null),la=s(null),na=()=>Je.value.map(e=>({title:e,icon:""})),sa=s(),ia=s({}),oa=async(e,t,l)=>{0===t&&await ma(),await da()&&(await va(),e%1==0&&(a.value=e),la.value&&l&&la.value.changeTab(e))},ua=()=>{var e;if(!sa.value||0===sa.value.length)return null;const t=a.value>=0&&a.value<sa.value.length?a.value:0;switch(null===(e=sa.value[t])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(Je.value.length>0)switch(Je.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},ca=async()=>{we.value=!0,G("Printing consultation summary... Please wait.");try{await t(),G("Consultation summary printed successfully!"),setTimeout(()=>{le.push("home")},3500)}catch(e){W("Failed to print consultation summary.")}finally{we.value=!1}},ra=()=>{G("Patient has finished consultation!"),le.push("home")},da=async()=>{const e=await Y.getObsByEncounterIdAndDate(Z.PRESENTING_COMPLAINTS);return!!(e&&e.length>0)},va=async()=>{const e=q.sessionDate();for(let t=0;t<sa.value.length;t++)if(await da()){he.value=!0,_e.value=!1;const l=sa.value[t];if(ia.value={title:"Untitled"},"Clinical Assessment"===l.title){const a=V("presentingComplaints");sa.value[t].icon=ga(e,a)?j:""}else if("Investigations"===l.title){var a;const l=null===(a=He.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,n=null==l?void 0:l.filter(a=>q.toStandardHisFormat(e)===q.toStandardHisFormat(a.order_date));sa.value[t].icon=(null==n?void 0:n.length)>0?j:""}else if("Diagnosis"===l.title){const a=V("diagnosis");sa.value[t].icon=ga(e,a)?j:""}else if("Treatment Plan"===l.title){const e=V("treatment");sa.value[t].icon=(null==e?void 0:e.length)>0?j:""}else if("Next Appointment"===l.title){const a=V("appointments");sa.value[t].icon=ga(e,a)?j:""}else if("Outcome"===l.title){const e=V("outcomes");sa.value[t].icon=(null==e?void 0:e.length)>0?j:""}}else he.value=!1,"Clinical Assessment"!==sa.value[t].title&&(sa.value[t].icon=O);fa()},ga=(e,a)=>{if(!a)return!1;const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime||e.order_date);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},ma=async()=>{fe.value=!0;try{var e;await pa(),await Promise.all([null===(e=Ke.value)||void 0===e?void 0:e.onSubmit()]),await K(He.value),Q()}catch(a){throw W("Failed to save clinical assessment"),a}finally{fe.value=!1}},pa=async()=>{try{if(!ve.isEmpty(Ve.value)){const e=ya(),a=await I(e);je.setPatientRecord(a)}}catch(e){console.error("Failed to save allergies:",e),X("Failed to save allergies")}},ya=()=>Ve.value.map(e=>({concept_id:e.concept_id,obs_datetime:ee.getSessionDate(),value_coded:e.concept_id,location_id:Ne.facilityLocation.code,value_text:e.name})),ba=async()=>{try{var e;Be.value=!0,null!==(e=Xe.value)&&void 0!==e&&e.onSubmit(),await(async()=>{try{const e=await A();He.value=Object.assign(He.value,e);const a=await C().saveNonPharmaTherapyPatientData();He.value=Object.assign(He.value,a)}catch(e){X("Failed to save treatment plan")}})(),await Ce.saveOutcomPatientData(),await Q(),await K(He.value);const a=localStorage.getItem("locationID"),t=localStorage.getItem("userRoles");if(!a)return void W("Location ID could not be found. Please check your settings.");const l=t?JSON.parse(t):[];l.some(e=>"Lab"===e.role)?(await ae.addPatientToStage(He.value,"CONSULTATION"),await te().refresh(a),await le.push("home"),G("Lab results submitted. Patient can return to consultation")):(await ae.addPatientToStage(He.value,"DISPENSATION"),await te().refresh(a),await le.push("home"),G("Consultation patient saved successfully."))}catch(a){W("Failed to save consultation data"),await le.push("home")}finally{Be.value=!1}};u(async()=>{0!==Je.value.length?(sa.value=na(),await va(),(void 0===a.value||a.value<0)&&(a.value=0),Re.value=!1,fa()):await le.push("home")}),c(a,async()=>{await fa()}),c(Ze,async()=>{await va()},{deep:!0}),c(He,async()=>{await va()},{deep:!0}),c(Me,async()=>{await va()},{deep:!0}),c(ze,async()=>{await va()},{deep:!0}),c(Ue,async()=>{await va()},{deep:!0}),c(Ge,async()=>{await va()},{deep:!0}),c(We,async()=>{await va()}),c(Ye,async()=>{await va()},{deep:!0}),c(be,async()=>{Pe.value=!1,sa.value=na(),setTimeout(()=>{a.value=0,Pe.value=!0},0)},{deep:!0}),c(Oe,e=>{De.value=e,De.value&&setTimeout(()=>{De.value=!1},15e3)}),c(Ee,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:a.value,tabsLength:sa.value.length}),e.disabled!==(null==t?void 0:t.disabled)&&console.log("Done button "+(e.disabled?"disabled":"enabled")),e.text!==(null==t?void 0:t.text)&&console.log(`Done button text changed from "${null==t?void 0:t.text}" to "${e.text}"`)},{deep:!0});const fa=()=>{let e=!1;return ua(),Be.value&&(e=!0),Re.value=e,!e};return(e,a)=>(d(),r(b(D),null,{default:v(()=>[g(de,{onYes:ca,onNo:ra,isOpen:xe.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),fe.value?(d(),m("div",me,[g(b(f),{name:"bubbles"}),a[2]||(a[2]=y("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),g(b(h),{"is-open":we.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),g($),g(b(_),{fullscreen:!0},{default:v(()=>[g(ne),y("div",pe,[Pe.value?(d(),r(S,{key:0,ref_key:"wizard",ref:la,headingTitle:"Consultation Plan","vertical-tabs":"","navigable-tabs":he.value,"scrollable-tabs":"",startIndex:0,doneButton:Ee.value,nextButton:{disabled:_e.value},"custom-tabs":sa.value,tabs:sa.value,onChange:oa,"onComplete:wizard":a[1]||(a[1]=e=>ba())},{default:v(()=>[y("div",null,[y("div",ye,[g(J,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:b(P),"font-weight":"600",onClick:a[0]||(a[0]=e=>{le.push("home")})},null,8,["icon"])])]),w(y("div",null,[g(se,{ref_key:"clinicalAssessmentRef",ref:Ke},null,512)],512),[[x,"ClinicalAssessment"===ua()]]),w(y("div",null,[g(ue,{ref_key:"investigationsRef",ref:Qe},null,512)],512),[[x,"Investigations"===ua()]]),w(y("div",null,[g(re,{ref_key:"diagnosisRef",ref:Xe},null,512)],512),[[x,"OPDDiagnosis"===ua()]]),w(y("div",null,[g(ie,{ref_key:"treatmentPlanRef",ref:ea},null,512)],512),[[x,"OPDTreatmentPlan"===ua()]]),w(y("div",null,[g(ce,{ref_key:"nextAppointmentRef",ref:aa},null,512)],512),[[x,"NextAppointment"===ua()]]),w(y("div",null,[g(oe,{ref_key:"outcomeRef",ref:ta},null,512)],512),[[x,"Outcome"===ua()]])]),_:1},8,["navigable-tabs","doneButton","nextButton","custom-tabs","tabs"])):p("",!0)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-dcbfb1eb"]]))}}});

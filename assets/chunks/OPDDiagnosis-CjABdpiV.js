import{d as A,af as X,G as Y,E as ee,ag as ae,ah as se,a6 as L,I as te,ab as ne,R as ie,bb as oe,aU as le,H as I,e as P,f as v,k as S,l as o,r as l,c as H,w as re,a as ce,m as F,O as V,J as h,u as T,Q as de,F as ue}from"./vendor-DXMRec6a.js";import{aZ as G,H as pe,J as k,a$ as me,a_ as ge,u as fe,_ as R,bV as he,x as ve,n as _e,z as ye,D as N,S as E,w as De,b as be,F as Ie}from"../index-DFvmUOLO.js";import{P as Se}from"./patient_diagnosis_service-CtDPrhI5.js";import{D as ke}from"./DashBox-CUlDocb0.js";import{l as xe}from"./lodash-NJiRuGo9.js";const we=A({name:"Menu",components:{IonContent:ne,IonHeader:te,IonItem:L,IonList:se,IonMenu:ae,IonTitle:ee,IonToolbar:Y,List:G},computed:{...X(fe,["patient"])},data(){return{valueNumericArray:[],obsDatetime:[],graphIcon:ge(["#006401"]),listIcon:me(["#636363"]),displayGraph:!0,orders:[],height:[],BMI:[],iconBg:{},activeWeight:[],activeHeight:[],activeBMI:[],list:[],series:[{name:"",data:[]}]}},setup(){return{checkmark:le,pulseOutline:oe}},async mounted(){const r=await k.getAll(this.patient.patientID,"Primary diagnosis"),m=await k.getAll(this.patient.patientID,"Secondary diagnosis"),u=await k.getAll(this.patient.patientID,"Attempted/ Differential diagnosis"),p=[...r||[],...m||[],...u||[]],g=xe.isEmpty(p)?[]:Promise.all(p.map(async _=>({name:await k.getConceptName(_.value_coded),obs_date:_.obs_datetime})));this.setListData(await g)},methods:{dismiss(){ie.dismiss()},handleIcon(){},setActivClass(r){this.activeHeight="",this.activeBMI="",this.activeWeight="",r=="height"?this.activeHeight="_active":r=="weight"?this.activeWeight="_active":r=="BMI"&&(this.activeBMI="_active")},setListData(r){this.list=[],this.list.push({actionBtn:!1,class:"col_background",header:!0,minHeight:"--min-height: 25px;",display:["Date","Diagnosis","Notes"]}),r.forEach(m=>{this.list.push({actionBtn:!1,minHeight:"--min-height: 25px;",class:"col_background",display:[pe.toStandardHisFormat(m.obs_date),m.name,""]})})}}}),Be={class:"modal_wrapper"};function Ce(r,m,u,p,g,_){const y=I("list");return v(),P("div",Be,[S("div",null,[o(y,{listData:r.list},null,8,["listData"])])])}const Fe=R(we,[["render",Ce],["__scopeId","data-v-88580898"]]),Pe={class:"custom_card",style:{padding:"10px"}},Te={key:0},Ee={key:0,style:{color:"red","margin-top":"10px",background:"lightgoldenrodyellow"}},$e={style:{width:"100%"}},Me={class:"ion-padding",slot:"content"},Oe=A({__name:"OPDDiagnosis",setup(r,{expose:m}){const u=_e,p=l(!0),g=l(!1),_=l(!0),y=l(!1),x=l(!0),W=l(""),J=l(""),D=l([]),n=l([]),q=l(),w=l(null);he();const $=H(()=>n.value.some(e=>e.data.concept_id===6542));re(n,()=>{O()},{deep:!0});const z=H(()=>[{name:"primaryDiagnosis",header:"Primary Diagnosis",componentType:"multiSelectInputField",trackBy:"name",options:D.value,icon:u.search,onSearchChange:B,validation:ve.required},{componentType:"checkboxField",label:"Secondary Diagnosis",type:"single",grid:{s:"6"},name:"secondaryDiagnosisCheckbox"},{componentType:"checkboxField",label:"Differential Diagnosis",type:"single",grid:{s:"6"},name:"differentialDiagnosisCheckbox"},{componentType:"Dashes"},{name:"secondaryDiagnosis",header:"Secondary Diagnosis",trackBy:"name",componentType:"multiSelectInputField",isMultiple:!0,options:D.value,icon:u.search,condition:e=>e==null?void 0:e.secondaryDiagnosisCheckbox,onSearchChange:B,validation:(e,a)=>M(a,"secondaryDiagnosis")},{name:"differentialDiagnosis",header:"Differential Diagnosis",trackBy:"name",componentType:"multiSelectInputField",options:D.value,icon:u.search,isMultiple:!0,condition:e=>e==null?void 0:e.differentialDiagnosisCheckbox,onSearchChange:B,validation:(e,a)=>M(a,"differentialDiagnosis")}]),M=(e,a)=>{var d,s,C;if(!e)return null;const t=(d=e.primaryDiagnosis)==null?void 0:d.name,i=((s=e.secondaryDiagnosis)==null?void 0:s.map(b=>b.name))||[],c=((C=e.differentialDiagnosis)==null?void 0:C.map(b=>b.name))||[];if(a==="secondaryDiagnosis"&&i.includes(t)||a==="differentialDiagnosis"&&c.includes(t))return"".concat(t," is already the primary diagnosis");const f=i.find(b=>c.includes(b));return f?"".concat(f," cannot be both secondary and differential"):null},Q=()=>{J.value="",W.value="",p.value=!1,x.value=!1,g.value=!0},U=async()=>{var e;((e=w.value)==null?void 0:e.validateForm())==null&&(Z(),g.value=!1,y.value=!0,x.value=!0,_.value=!1)},Z=()=>{var d;const e=[],a=n.value.map(s=>s.name),t=((d=w.value)==null?void 0:d.getFormValues())||{},i=t.primaryDiagnosis||[],c=t.secondaryDiagnosis||[],f=t.differentialDiagnosis||[];if(i.name&&!a.includes(i.name))if(!n.value.some(C=>C.data.concept_id===6542))e.push({actionBtn:!0,btn:["delete"],name:i.name,id:i.concept_id,display:[i.name,"Primary diagnosis"],data:{concept_id:6542,value_coded:i.concept_id,obs_datetime:E.getSessionDate()}});else return De("Only one primary diagnosis is allowed"),!1;return c&&c.forEach(s=>{a.includes(s.name)||e.push({actionBtn:!0,btn:["delete"],name:s.name,id:s.concept_id,display:[s.name,"Secondary diagnosis"],data:{concept_id:6543,value_coded:s.concept_id,obs_datetime:E.getSessionDate()}})}),f&&f.forEach(s=>{a.includes(s.name)||e.push({actionBtn:!0,btn:["delete"],name:s.name,id:s.concept_id,display:[s.name,"Differential diagnosis"],data:{concept_id:10201,value_coded:s.concept_id,obs_datetime:E.getSessionDate()}})}),e.length>0&&(n.value=[...n.value,...e]),!0},B=async e=>{const a=e.trim().toLowerCase()||"";return D.value=await Se.getDiagnosis(a,1,15),D.value},j=e=>{const a=n.value,t=e.name,i=a.filter(c=>c.display[0]!==t);n.value=i},O=()=>{n.value.length>0?(y.value=!0,p.value=!1):g.value||(p.value=!0),x.value=!$.value},K=async()=>{if(n.value.length<=0)return;const e=n.value.flatMap(a=>a.data);e.length<=0||(await k.addObsToEncounterPatient(e,be.DIAGNOSIS),Ie("Diagnosis saved successful"),n.value=[])};return ce(async()=>{O(),await B("")}),m({onSubmit:K}),(e,a)=>{const t=I("ion-row"),i=I("ion-label"),c=I("ion-accordion"),f=I("ion-accordion-group");return v(),P(ue,null,[S("div",Pe,[o(ke,{status:p.value,content:"No Diagnosis added"},null,8,["status"]),y.value?(v(),P("span",Te,[o(G,{listData:n.value,"onClicked:delete":j},null,8,["listData"]),$.value?(v(),P("div",Ee," In order to update the diagnosis list, please remove/delete the primary diagnosis only and then re-add or change it along with the secondary and differential diagnoses. ")):F("",!0)])):F("",!0),g.value?(v(),V(t,{key:1},{default:h(()=>{var d;return[S("div",$e,[o(ye,{formData:z.value,ref_key:"formRef",ref:w},null,8,["formData"])]),S("div",null,[o(N,{fill:"clear",icon:T(u).plus,iconSlot:"icon-only","onClicked:btn":a[0]||(a[0]=s=>U()),name:"Save",disabled:(d=w.value)==null?void 0:d.validateForm(),class:"ion-margin-top"},null,8,["icon","disabled"])])]}),_:1})):F("",!0),x.value?(v(),V(t,{key:2,style:{"margin-top":"10px"}},{default:h(()=>[o(N,{fill:"clear",icon:T(u).plus,iconSlot:"icon-only","onClicked:btn":a[1]||(a[1]=d=>Q()),name:"Add new Diagnosis"},null,8,["icon"])]),_:1})):F("",!0)]),o(t,null,{default:h(()=>[o(f,{ref_key:"accordionGroup",ref:q,class:"previousView"},{default:h(()=>[o(c,{value:"first","toggle-icon-slot":"start",class:"custom_card"},{default:h(()=>[o(T(L),{slot:"header",color:"light"},{default:h(()=>[o(i,{class:"previousLabel"},{default:h(()=>[...a[2]||(a[2]=[de("Previous Diagnosis",-1)])]),_:1})]),_:1}),S("div",Me,[o(Fe)])]),_:1})]),_:1},512)]),_:1})],64)}}}),Ge=R(Oe,[["__scopeId","data-v-5b47889c"]]);export{Ge as O};

import{d as U,aV as W,cp as q,r as d,c as f,w as N,a as K,H as O,e as v,f as r,l as _,J as p,k as o,F as $,P as H,O as h,m as P,K as B,u as j,b6 as G}from"./vendor-BolvhNQv.js";import{u as Q,b3 as X,J as k,H as Y,cG as Z,E as ee,G as te,s as ae,aT as ne,_ as oe}from"../index-tYOBQoko.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-Go-aTq24.js";const se={class:"visitContent"},le={class:"visitData"},re={class:"table-header"},ie={class:"encounter-title"},ue={class:"table-responsive"},ce={key:0,class:"loading-state"},de={key:1,class:"empty-state"},ve=U({__name:"VisitsHistory",setup(pe){const L=Q(),{patient:C}=W(L),F=q(),g=d([]),u=d(""),n=d(null),i=d([]),y=d(!1),w=f(()=>{const e=new Set;return g.value.forEach(t=>{t.obs.forEach(a=>{if(a.obs_datetime){const l=a.obs_datetime.split(" ")[0];e.add(l)}})}),Array.from(e).sort((t,a)=>new Date(a).getTime()-new Date(t).getTime())}),D=f(()=>{if(!u.value)return[];const e=new Map;return g.value.forEach(t=>{t.obs.forEach(a=>{if(a.obs_datetime&&a.obs_datetime.startsWith(u.value)){const l=a.encounter_id;e.has(l)||e.set(l,{encounter_id:l,encounter_type:t.encounter_type,name:A(t.encounter_type),encounter_datetime:a.encounter_datetime,observations:[]}),e.get(l).observations.push(a)}})}),Array.from(e.values()).sort((t,a)=>new Date(a.encounter_datetime).getTime()-new Date(t.encounter_datetime).getTime())}),R=f(()=>({paging:!0,lengthChange:!1,searching:!1,ordering:!1,info:!0,autoWidth:!0,responsive:!0,pageLength:8})),z=f(()=>[{data:"observation",title:"Observation"},{data:"value",title:"Value"},{data:"date",title:"Date"}]),A=e=>{const t=X[e];return t?t.toLowerCase().replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()):"Unknown Encounter"},b=e=>Y.toStandardHisDisplayFormat(e),x=e=>{u.value=e,n.value=null,i.value=[],D.value.length>0&&V(D.value[0])},V=e=>{n.value=e,I()},S=async(e,t,a)=>{const l="  ".repeat(t),s=t>0?"└─ ":"";if(a.push({observation:"".concat(l).concat(s).concat(e.concept_name),value:await M(e),date:b(e.obs_datetime)}),e.children&&e.children.length>0)for(const c of e.children)await S(c,t+1,a)},I=async()=>{if(!n.value){i.value=[];return}y.value=!0;try{const e=n.value.observations||[],t=[];for(const a of e)await S(a,0,t);i.value=t}catch(e){console.error("Error loading table data:",e),i.value=[]}finally{y.value=!1}},M=async e=>e.value_text?e.value_text:e.value_numeric!==null&&e.value_numeric!==void 0?String(e.value_numeric):e.value_datetime?b(e.value_datetime):e.value_coded?await ne.getConceptName(e.value_coded):"N/A",J=async()=>{n.value&&Z(async e=>{try{await ee.voidEncounter(n.value.encounter_id,e),await m(),te("Encounter has been voided!",2e3)}catch(t){ae("".concat(t),32e3)}})},m=async()=>{g.value=C.value.observations||[],w.value.length>0&&x(w.value[0])};return N(C,async()=>{await m()},{deep:!0}),N(F,async()=>{await m()},{deep:!0}),K(async()=>{await m()}),(e,t)=>{const a=O("ion-col"),l=O("ion-row");return r(),v("div",se,[_(l,null,{default:p(()=>[_(a,{size:"1.6",style:{height:"62vh","overflow-y":"auto","padding-right":"0px","padding-left":"0px"}},{default:p(()=>[o("div",null,[(r(!0),v($,null,H(w.value,(s,c)=>(r(),h(k,{class:"",style:{"margin-bottom":"5px",width:"96%",height:"45px"},onClick:E=>x(s),key:c,name:b(s),fill:u.value!=s?"outline":"solid",color:u.value==s?"success":""},null,8,["onClick","name","fill","color"]))),128))])]),_:1}),_(a,{size:"2.5"},{default:p(()=>[o("div",null,[(r(!0),v($,null,H(D.value,(s,c)=>{var E,T;return r(),h(k,{class:"",style:{"margin-bottom":"5px",width:"96%",height:"45px"},onClick:me=>V(s),key:c,name:s.name,fill:((E=n.value)==null?void 0:E.encounter_id)!=s.encounter_id?"outline":"solid",color:((T=n.value)==null?void 0:T.encounter_id)==s.encounter_id?"success":""},null,8,["onClick","name","fill","color"])}),128))])]),_:1}),_(a,{offset:"0.1",size:"7.8"},{default:p(()=>[o("div",le,[o("div",re,[o("h3",ie,B(n.value?n.value.name:"Select an Encounter"),1),n.value?(r(),h(k,{key:0,name:"Void Encounter",fill:"solid",color:"danger",onClick:t[0]||(t[0]=s=>J())})):P("",!0)]),o("div",ue,[y.value?(r(),v("div",ce,[...t[1]||(t[1]=[o("p",null,"Loading observations...",-1)])])):i.value.length===0&&n.value?(r(),v("div",de,[o("p",null,"No observations found for "+B(n.value.name),1)])):(r(),h(j(G),{key:2,ref:"dataTable",class:"display nowrap modern-table",width:"100%",data:i.value,columns:z.value,options:R.value},{default:p(()=>[...t[2]||(t[2]=[o("thead",null,[o("tr",null,[o("th",null,"Observation"),o("th",null,"Value"),o("th",null,"Date")])],-1)])]),_:1},8,["data","columns","options"]))])])]),_:1})]),_:1})])}}}),ye=oe(ve,[["__scopeId","data-v-f26a084f"]]);export{ye as default};

!function(){function e(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}System.register(["./vendor-legacy-IGuUoRYO.js","./EIRreportsStore-legacy-apL3S7So.js","./NavigationMenu-legacy-D4o_dcwJ.js","./ViewToggleComponent-legacy-B4YjhZ07.js","../index-legacy-CPN3hcLt.js","./drug_prescription_service-legacy-BvHSYXdJ.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-w_Qe4jnt.js"],function(t,a){"use strict";var n,i,l,s,r,o,d,c,u,p,g,m,f,v,y,b,h,x,_,D,w,k,I,C,M,O,T,N,j,P,z,q,F,S,V,E,H,U,A,L,$,J,G,R,B,K,Q,W,Y,Z,X,ee,te,ae,ne,ie,le,se,re,oe,de,ce,ue,pe,ge,me;return{setters:[e=>{n=e.d,i=e.N,l=e.P,s=e.av,r=e.ad,o=e.az,d=e.bq,c=e.b9,u=e.K,p=e.L,g=e.ae,m=e.cg,f=e.M,v=e.G,y=e.e,b=e.f,h=e.l,x=e.H,_=e.k,D=e.I,w=e.a3,k=e.F,I=e.bh,C=e.aF,M=e.cr,O=e.r,T=e.c,N=e.b,j=e.w,P=e.a,z=e.Q,q=e.u,F=e.S,S=e.T,V=e.bH,E=e.b7,H=e.m,U=e.a4,A=e.p,L=e.dn,$=e.bt,J=e.b5,G=e.b4},e=>{R=e.E},e=>{B=e.N},e=>{K=e.V},e=>{Q=e.n,W=e._,Y=e.aY,Z=e.P,X=e.S,ee=e.u,te=e.J,ae=e.G,ne=e.bZ,ie=e.bH,le=e.e,se=e.v,re=e.aM,oe=e.r,de=e.k,ce=e.x,ue=e.o,pe=e.b_,ge=e.g},e=>{me=e.a},null,null],execute:function(){var a=document.createElement("style");a.textContent=".medication-details-header[data-v-01db984e]{display:flex;align-items:center;gap:8px}.medication-details-modal[data-v-01db984e]{font-family:Arial,sans-serif}.text-xl[data-v-01db984e]{font-size:1.25rem}.font-bold[data-v-01db984e]{font-weight:700}.mb-4[data-v-01db984e]{margin-bottom:1rem}.grid[data-v-01db984e]{display:grid}.grid-cols-2[data-v-01db984e]{grid-template-columns:repeat(2,1fr)}.gap-3[data-v-01db984e]{gap:1rem}.dose-input[data-v-d7e6a4a3]{--padding-start: 8px;--padding-end: 8px;margin-left:10px;width:200px}.bordered-input[data-v-d7e6a4a3]{border:2px solid #ccc;border-radius:4px;padding:4px}.medication-details-header[data-v-d7e6a4a3]{display:flex;align-items:center;gap:8px}.input-error[data-v-d7e6a4a3]{border-color:red}.error-text[data-v-d7e6a4a3]{color:red;font-size:.875rem;margin-top:4px}table[data-v-d7e6a4a3]{border-collapse:collapse;width:100%}th[data-v-d7e6a4a3]{font-weight:600;text-align:left}td[data-v-d7e6a4a3],th[data-v-d7e6a4a3]{padding:12px;border-bottom:1px solid #e2e8f0}tr[data-v-d7e6a4a3]:hover{background-color:#f8fafc}.program-name[data-v-d7e6a4a3]{color:#0e7e20;font-weight:600;font-size:18px;margin-left:10px}\n/*$vite$:1*/",document.head.appendChild(a);const fe=n({name:"MedicationDetailsModal",components:{IonContent:p,IonHeader:u,IonFooter:c,IonPage:d,IonTitle:o,IonRow:r,IonCol:s,IonButton:l,IonIcon:i},props:{selectedMedication:{type:Object,default:null}},data(){return{iconsContent:Q,medkit:m,closeIcon:g,dismiss:()=>(this.$emit("close"),f.dismiss())}},methods:{formatFullDate:e=>e?new Date(e).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"N/A",getFrequencyLabel(e){const t=me.find(t=>t.code===e);return t?t.label:"Unknown"}}}),ve={class:"medication-details-header"},ye={class:"modal_wrapper"},be={class:"medication-details-modal"},he={class:"text-xl font-bold mb-4"},xe={class:"grid grid-cols-2 gap-3"};const _e=W(fe,[["render",function(e,t,a,n,i,l){const s=v("ion-icon"),r=v("ion-title"),o=v("ion-header"),d=v("ion-content"),c=v("ion-button"),u=v("ion-col"),p=v("ion-row"),g=v("ion-footer");return b(),y(k,null,[h(o,{style:{display:"flex","justify-content":"space-between"}},{default:x(()=>[h(r,{class:"modalTitle"},{default:x(()=>[_("div",ve,[h(s,{icon:e.medkit,class:"ion-margin-end"},null,8,["icon"]),t[1]||(t[1]=_("span",null,"Medication Details",-1))])]),_:1}),h(s,{onClick:t[0]||(t[0]=t=>e.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:e.iconsContent.cancel},null,8,["icon"])]),_:1}),h(d,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:x(()=>[_("div",ye,[_("div",be,[_("h2",he,D(e.selectedMedication.drug.name),1),_("div",xe,[_("div",null,[t[2]||(t[2]=_("strong",null,"Order ID:",-1)),w(" "+D(e.selectedMedication.order_id),1)]),_("div",null,[t[3]||(t[3]=_("strong",null,"Drug ID:",-1)),w(" "+D(e.selectedMedication.drug_inventory_id),1)]),_("div",null,[t[4]||(t[4]=_("strong",null,"Dose:",-1)),w(" "+D(e.selectedMedication.dose)+" "+D(e.selectedMedication.units),1)]),_("div",null,[t[5]||(t[5]=_("strong",null,"Equivalent Daily Dose:",-1)),w(" "+D(e.selectedMedication.equivalent_daily_dose),1)]),_("div",null,[t[6]||(t[6]=_("strong",null,"Frequency:",-1)),w(" "+D(e.getFrequencyLabel(e.selectedMedication.frequency)),1)]),_("div",null,[t[7]||(t[7]=_("strong",null,"Order Type:",-1)),w(" "+D(e.selectedMedication.order.order_type_id),1)]),_("div",null,[t[8]||(t[8]=_("strong",null,"Start Date:",-1)),w(" "+D(e.formatFullDate(e.selectedMedication.order.start_date)),1)]),_("div",null,[t[9]||(t[9]=_("strong",null,"Date Created:",-1)),w(" "+D(e.formatFullDate(e.selectedMedication.order.date_created)),1)]),_("div",null,[t[10]||(t[10]=_("strong",null,"Orderer:",-1)),w(" "+D(e.selectedMedication.order.orderer),1)]),_("div",null,[t[11]||(t[11]=_("strong",null,"Instructions:",-1)),w(" "+D(e.selectedMedication.order.instructions),1)])])])])]),_:1}),h(g,{collapse:"fade",class:"ion-no-border"},{default:x(()=>[h(p,null,{default:x(()=>[h(u,null,{default:x(()=>[h(c,{onClick:e.dismiss,color:"primary",style:{float:"right","margin-bottom":"20px","margin-right":"20px"}},{default:x(()=>[h(s,{icon:e.closeIcon,slot:"start"},null,8,["icon"]),t[12]||(t[12]=w(" Close ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})],64)}],["__scopeId","data-v-01db984e"]]);class De extends Y{constructor(t=null,a=null){const n=new Z;super(null!==t?t:n.getID(),32,null!==a?a:X.getUserID()),e(this,"drugHistory",void 0),e(this,"currentDrugOrder",void 0),this.drugHistory=[],this.currentDrugOrder=[]}getDrugHistory(){return this.drugHistory}getCurrentOrder(){return this.currentDrugOrder}getDispensationArryObj(e){return[{drug_order_id:e.order_id,date:this.date,quantity:e.amountToDispense,offline_id:e.offline_id,provider_id:this.providerID,program_id:e.program_id,patient_id:this.patientID}]}saveDispensations(e,t){return Y.postJson("/dispensations",{dispensations:e,provider_id:this.providerID,program_id:t})}generateOfflineDispensatiobObject(e,t){return{dispensations:e,provider_id:this.providerID,program_id:t,patient_id:this.patientID}}async saveDispensationsOffline(e){try{const i=ee(),{patient:l}=I(i),s=JSON.parse(JSON.stringify(l.value));if(e.length>0){var t,a,n;null!==(a=(t=null!==(n=s.dispensations)&&void 0!==n?n:s.dispensations={}).unsaved)&&void 0!==a||(t.unsaved=[]);s.dispensations.unsaved.length>=0&&s.dispensations.unsaved.push(...e)}await te(s),ae("Dispensations saved offline successfully")}catch(i){ne("Error saving dispensations offline"+i)}}async voidOrder(e){return Y.void(`/dispensations/${e}`,{})}async loadDrugHistory(){const e=await ie.getDrugOrderHistory(this.patientID);e&&(this.drugHistory=e)}async loadCurrentDrugOrder(){const e=await ie.getDrugOrders(this.patientID);e&&(this.currentDrugOrder=await Promise.all(e))}calcCompletePack(e,t){const a=e.barcodes.sort(function(e,t){return e.tabs-t.tabs});if(0==a.length||0==t)return t;for(let l=0;l<=a.length-1;l++)if(parseInt(a[l].tabs)>=t)return a[l].tabs;const n=parseInt(a[0].tabs);let i=parseInt(a[a.length-1].tabs);for(;i<t;)i+=n;return i}}const we={key:0,style:{margin:"20px"},class:"flex flex-col items-center justify-center p-8"},ke={key:1,class:"p-4",style:{"margin-left":"10px","margin-right":"10px"}},Ie={class:"text-xl font-bold mb-4 program-name"},Ce={class:"overflow-x-auto"},Me={class:"w-full"},Oe={class:"p-3"},Te={class:"p-3"},Ne={class:"flex items-center"},je={class:"p-3"},Pe={class:"p-3"},ze={class:"p-3"},qe={class:"flex items-center space-x-2"},Fe={key:0,class:"error-text text-sm"},Se={class:"p-3"},Ve={class:"flex space-x-2"},Ee={key:0,class:"text-center py-8"},He={key:2,class:"p-4",style:{"margin-left":"10px","margin-right":"10px"}},Ue={class:"text-xl font-bold mb-4 program-name"},Ae={class:"text-lg font-bold mb-2",style:{"margin-left":"10px","margin-right":"10px"}},Le={class:"text-md font-medium",style:{"margin-left":"10px","margin-right":"10px"}},$e={class:"medication-details"},Je={class:"flex justify-between mb-3"},Ge={class:"flex items-center"},Re={class:"flex items-center mb-3"},Be={key:0,class:"error-text"},Ke={class:"mt-3 flex space-x-2",style:{"margin-top":"10px"}},Qe={key:0,class:"text-center mb-8"};t("default",W(n({__name:"NCDMedicationDispenstion",setup(e){const t=R(),a=ee(),n=le(),o=se(),{navigationPayload:u}=I(t),{patient:g}=I(a),{NCDMedicatioTogglePreference:f}=I(n),v=C(),Q=M(),W=O(null),Y=O({}),Z=O([]),ae=O(null);O(""),O(!1);const ne=O(!1),ie=O({});T(()=>Z.value.reduce((e,t)=>{const a=t.order.date_created.split("T")[0];return e[a]||(e[a]=[]),e[a].push(t),e},{}));const fe=async()=>{lt(),Z.value=[],xe(),ne.value=!1,await We()},ve=async()=>await X.getJson("/programs",{page_size:1e3}),ye=async()=>{try{return await ge("programs")}catch(e){throw console.error("Error fetching offline districts:",e.message),e}},be=async()=>{await(new re).printData("visit")},he=async e=>{try{await oe(e),await o.refresh(X.getUserLocationId())}catch(t){console.error(t)}},xe=()=>{t.setNavigationPayload("Dispense Medication",!0,!1,"/","home")},We=async()=>{var e,t,a,n;const i=[...null!==(e=null===(t=g.value)||void 0===t||null===(t=t.MedicationOrder)||void 0===t?void 0:t.saved)&&void 0!==e?e:[],...null!==(a=null===(n=g.value)||void 0===n||null===(n=n.MedicationOrder)||void 0===n?void 0:n.unsaved)&&void 0!==a?a:[]];await Ye(i)},Ye=async e=>{const t=await(async()=>{try{return await pe()?await ve():await ye()}catch(e){return console.error("Error fetching programs:",e),await ve()}})(),a={};t.forEach(e=>{a[e.program_id]=e.name}),Y.value={},e.forEach(e=>{const t=a[e.program_id];if(t&&(Y.value[t]||(Y.value[t]=[]),!e.quantity)){const a=Xe(e);if(ie.value[a]){e.amountToDispense=ie.value[a];const t=parseFloat(e.amountToDispense);isNaN(t)||t<=0?e.error="Please enter a valid amount greater than 0.":e.error=null}Y.value[t].push(e)}});e.every(e=>e.quantity)&&14==X.getProgramID()&&(await de("All medications dispensed. Would you like to print the visit summary before closing?")&&await be(),await he(g.value),await v.push("/home"))},Ze=e=>{const t=me.find(t=>t.code===e);return t?t.label:"Unknown"},Xe=e=>(null==e?void 0:e.order_id)||(null==e?void 0:e.offline_id)||`${e.drug_name}_${e.start_date}`,et=e=>{const t=parseFloat(e.amountToDispense),a=Xe(e);ie.value[a]=e.amountToDispense,isNaN(t)||t<=0?e.error="Please enter a valid amount greater than 0.":e.error=null},tt=async e=>{ne.value=!0;try{if(e.error)return void ce("Fix errors before dispensing.");e.quantity=e.amountToDispense;const t=(new De).getDispensationArryObj(e);e.dispensation=t,e.dispensed=!0,await te(g.value);const a=Xe(e);delete ie.value[a],await We()}catch(t){ce("Dispensing failed. Please try again."),ce("Error: "+t),console.error(t)}finally{ne.value=!1}},at=async e=>{ae.value=e,await ue(_e,{class:"large-modal"},!0,{selectedMedication:ae.value})},nt=e=>new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),it=e=>{lt(e,!0)},lt=(e="list",t=!1)=>{const a={toggle_view:e};0===Object.keys(f.value).length&&(a.toggle_view="list",n.setNCDMedicatioTogglePreference(a)),Object.keys(f.value).length>0&&!0===t&&n.setNCDMedicatioTogglePreference(a)},st=()=>{ie.value={}};return N(()=>{st()}),j(g,async()=>{ne.value||"NCDDispensations"===Q.name&&await fe()},{deep:!0}),j(Q,(e,t)=>{"NCDDispensations"===(null==t?void 0:t.name)&&"NCDDispensations"!==e.name&&st(),"NCDDispensations"===e.name&&fe()},{immediate:!0}),P(()=>{fe()}),(e,t)=>(b(),z(q(d),null,{default:x(()=>[h(B,{ref_key:"navMenuRef",ref:W},null,512),h(K,{"initial-view":q(f).toggle_view,onViewChanged:it},null,8,["initial-view"]),h(q(p),null,{default:x(()=>[0===Object.keys(Y.value).length?(b(),y("div",we,[h(q(i),{icon:q(F),size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),t[2]||(t[2]=_("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Medications to Dispense",-1)),t[3]||(t[3]=_("p",{class:"text-gray-600"},"There are currently no medications waiting to be dispensed for current Client.",-1))])):"list"===q(f).toggle_view?(b(),y("div",ke,[(b(!0),y(k,null,S(Y.value,(e,a)=>(b(),y(k,{key:a},[_("h2",Ie,D(a),1),h(q(V),{class:"mb-6"},{default:x(()=>[h(q(E),null,{default:x(()=>[_("div",Ce,[_("table",Me,[t[6]||(t[6]=_("thead",null,[_("tr",{class:"bg-gray-100"},[_("th",{class:"p-3 text-left"},"Date"),_("th",{class:"p-3 text-left"},"Medication"),_("th",{class:"p-3 text-left"},"Dose"),_("th",{class:"p-3 text-left"},"Frequency"),_("th",{class:"p-3 text-left"},"Amount to Dispense"),_("th",{class:"p-3 text-left"},"Actions")])],-1)),_("tbody",null,[(b(!0),y(k,null,S(e,e=>(b(),y("tr",{key:(null==e?void 0:e.order_id)||(null==e?void 0:e.offline_id),class:"border-b hover:bg-gray-50"},[_("td",Oe,D(nt(e.start_date)),1),_("td",Te,[_("div",Ne,[h(q(i),{icon:q(m),class:"mr-2"},null,8,["icon"]),w(" "+D(e.drug_name),1)])]),_("td",je,D(e.dose)+" "+D(e.units),1),_("td",Pe,D(Ze(e.frequency)),1),_("td",ze,[_("div",qe,[h(q(U),{type:"number",placeholder:"Amount",modelValue:e.amountToDispense,"onUpdate:modelValue":t=>e.amountToDispense=t,onInput:t=>et(e),class:A(["w-24 dose-input bordered-input",e.error?"input-error":""])},null,8,["modelValue","onUpdate:modelValue","onInput","class"]),H("",!0)]),e.error?(b(),y("div",Fe,D(e.error),1)):H("",!0)]),_("td",Se,[_("div",Ve,[h(q(l),{color:"primary",size:"small",onClick:t=>tt(e),disabled:!e.amountToDispense||parseFloat(e.amountToDispense)<=0||e.dispensed},{default:x(()=>[h(q(i),{icon:q(L),class:"mr-1",style:{"margin-right":"5px"}},null,8,["icon"]),w(" "+D(e.dispensed?"Dispensed":"Dispense"),1)]),_:2},1032,["onClick","disabled"]),h(q(l),{color:"secondary",size:"small",onClick:t=>at(e),style:{"margin-left":"10px"}},{default:x(()=>[h(q(i),{icon:q($),class:"mr-1",style:{"margin-right":"5px"}},null,8,["icon"]),t[5]||(t[5]=w(" Details ",-1))]),_:1},8,["onClick"])])])]))),128))])]),0===e.length?(b(),y("div",Ee,[h(q(i),{icon:q(F),size:"large",class:"mb-2"},null,8,["icon"]),_("p",null,"No medications prescribed for "+D(a),1)])):H("",!0)])]),_:2},1024)]),_:2},1024)],64))),128))])):(b(),y("div",He,[(b(!0),y(k,null,S(Y.value,(e,a)=>{return b(),y(k,{key:a},[_("h2",Ue,D(a),1),(b(!0),y(k,null,S((n=e,console.log("Grouping medications by date:",n),n.reduce((e,t)=>{const a=t.start_date.split("T")[0];return e[a]||(e[a]=[]),e[a].push(t),e},{})),(e,a)=>(b(),y(k,{key:a},[_("h3",Ae,D(nt(a)),1),h(q(r),null,{default:x(()=>[h(q(s),{size:"12","size-md":"6","size-lg":"4"},{default:x(()=>[_("h3",Le,D(a),1)]),_:2},1024)]),_:2},1024),h(q(r),null,{default:x(()=>[(b(!0),y(k,null,S(e,e=>(b(),z(q(s),{style:{"margin-left":"10px","margin-right":"10px"},key:e.order_id,size:"12","size-md":"6","size-lg":"4"},{default:x(()=>[h(q(V),{class:"mb-4"},{default:x(()=>[h(q(J),null,{default:x(()=>[h(q(G),{class:"medication-details-header"},{default:x(()=>[h(q(i),{icon:q(m),class:"ion-margin-end"},null,8,["icon"]),_("span",null,D(e.drug_name),1)]),_:2},1024)]),_:2},1024),h(q(E),null,{default:x(()=>[_("div",$e,[_("div",Je,[_("span",Ge,D(Ze(e.frequency))+" ("+D(e.frequency)+") ",1)]),_("div",Re,[h(q(U),{type:"number",placeholder:"Amount",modelValue:e.amountToDispense,"onUpdate:modelValue":t=>e.amountToDispense=t,onInput:t=>et(e),class:A(["w-24 dose-input bordered-input",e.error?"input-error":""])},null,8,["modelValue","onUpdate:modelValue","onInput","class"]),H("",!0)]),e.error?(b(),y("div",Be,D(e.error),1)):H("",!0),_("div",Ke,[h(q(l),{color:"primary",onClick:t=>tt(e),disabled:!e.amountToDispense||parseFloat(e.amountToDispense)<=0||e.dispensed},{default:x(()=>[h(q(i),{icon:q(L),class:"mr-2",style:{"margin-right":"5px"}},null,8,["icon"]),w(" "+D(e.dispensed?"Dispensed":"Dispense"),1)]),_:2},1032,["onClick","disabled"]),h(q(l),{color:"secondary",style:{"margin-left":"20px"},onClick:t=>at(e)},{default:x(()=>[h(q(i),{icon:q($),class:"mr-2",style:{"margin-right":"5px"}},null,8,["icon"]),t[8]||(t[8]=w(" Details ",-1))]),_:1},8,["onClick"])])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)],64))),128)),0===e.length?(b(),y("div",Qe,[h(q(i),{icon:q(F),size:"large",class:"mb-2"},null,8,["icon"]),_("p",null,"No medications prescribed for "+D(a),1)])):H("",!0)],64);var n}),128))]))]),_:1}),h(q(c),{collapse:"fade",class:"ion-no-border"},{default:x(()=>[h(q(r),null,{default:x(()=>[h(q(s),null,{default:x(()=>[h(q(l),{id:"cbtn",class:"",color:"primary",fill:"solid",style:{float:"right","margin-left":"50px"},onClick:t[0]||(t[0]=e=>be())},{default:x(()=>[...t[9]||(t[9]=[w(" Print Visit Summary ",-1)])]),_:1}),h(q(l),{id:"cbtn",class:"",color:"danger",fill:"solid",style:{float:"right","margin-left":"50px"},onClick:t[1]||(t[1]=e=>(async e=>{await he(e),await v.push("/home")})(q(g)))},{default:x(()=>[...t[10]||(t[10]=[w(" Close visit ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),h(q(c))]),_:1}))}}),[["__scopeId","data-v-d7e6a4a3"]]))}}})}();

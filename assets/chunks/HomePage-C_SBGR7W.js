var dn=Object.defineProperty;var cn=(e,t,a)=>t in e?dn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var ue=(e,t,a)=>cn(e,typeof t!="symbol"?t+"":t,a);import{d as z,cZ as un,am as ke,r as O,c as E,w as ce,a as he,e as v,f as d,k as n,m as S,p as re,K as C,l as o,u as w,b3 as kt,Q as R,L as Z,F as G,P as K,c_ as pn,cb as mn,av as St,bD as hn,bp as fn,c6 as dt,be as It,b7 as Me,H as g,O as F,J as l,D as Pt,cr as xe,n as Ee,ak as gn,af as de,c$ as Tt,d0 as At,ao as Nt,d1 as Ot,d2 as _n,cg as Rt,d3 as vn,d4 as yn,d5 as bn,d6 as Dn,d7 as $n,d8 as Cn,d9 as wn,aU as kn,bT as Lt,aV as Qe,aR as ct,aS as ut,bw as He,ad as Ye,N as Fe,ac as Ze,G as Se,ae as Re,I as fe,ab as le,bE as it,a9 as Sn,da as In,aE as Pn,db as Tn,dc as An,cG as Nn,aD as On,cL as Vt,aM as Le,b2 as qe,a1 as Ge,dd as Bt,aI as pt,aC as Rn,i as be,b9 as Ln,de as Vn,z as Bn,df as mt,dg as Ce,a2 as Ve,dh as Ft,ba as Fn,bu as Mn,br as xn,E as Ue,ag as We,ah as Ie,a6 as Pe,R as we,bb as En,di as Hn,dj as Un,dk as Wn,dl as jn,bC as Ke,b6 as Mt,a0 as xt,v as $e,M as zn,aa as qn,dm as Gn,b8 as Jn,dn as Et,dp as Qn,ca as Yn,dq as Zn,dr as Kn,bx as Xn,b$ as ea}from"./vendor-CAxM8KGs.js";import{S as H,u as se,_ as Y,P as Te,t as me,a as Ht,E as Ut,H as T,g as Oe,b as ht,A as ta,c as na,d as Wt,e as vt,f as jt,h as aa,i as je,R as oa,p as sa,j as yt,k as ia,O as ra,l as la,B as da,m as bt,n as te,o as Ne,q as ca,r as zt,s as rt,v as ua,w as Dt,x as pa,y as ma,z as ha,D as nt,C as fa,F as Ae,G as ga,I as _a,T as qt,J as va,K as pe,L as $t,M as ya,N as ba,U as Da,Q as $a,V as Ca}from"../index-eJpzASAs.js";import{m as Je}from"./apexcharts-y0ZeiY9V.js";import{A as Gt}from"./ncd_appointment_service-CI4E6iDG.js";import{D as ft}from"./DateInputField-d-5zH_YB.js";import{u as wa,_ as ka,M as Sa}from"./ActionButtons.vue_vue_type_script_setup_true_lang-D9iS7Vqf.js";import{V as Ia}from"./ViewToggleComponent-0D372Q2Y.js";import{B as Pa}from"./bottomNavBar-j1T6uG9L.js";import{P as Ta}from"./patient_report_service-CrvU6fm6.js";import{l as Be}from"./lodash-NJiRuGo9.js";import{B as ze}from"./BasicForm-C-DonRdG.js";import{B as Xe}from"./BasicCard-sXNLok_-.js";import{u as Aa}from"./AdministerOtherVaccinesStore-C6BNz-Y7.js";import{c as Na}from"./customDatePicker-Chc9ZbH3.js";import{s as Oa}from"./vaccines_service-BDpBzyEg.js";import{g as Ra}from"./dashboard_service-C-jXrzTj.js";import{i as La}from"./Img-CJEgX1Vr.js";import{R as Va}from"./ReusableDataTable-BeKbXyE6.js";import{R as at,u as Ba,a as Fa,_ as Ma,b as xa,c as Ea,d as Ha,e as Ua,f as Wa,g as ja}from"./useSetRegistrationValues-DseBIBMA.js";import{u as za}from"./useNeonatalEnrollmentStore-Dr5mQm84.js";import{u as Jt}from"./useUserActivities-Cw4a7Opx.js";import qa from"./NeonatalHome-BmzWVFUq.js";import"./sms_service-Cmxm60dQ.js";import"./EIRreportsStore-Cbu3hXyV.js";import"./Export-BBLpqVO_.js";import"./useLocation-BMCjqj38.js";import"./enrollment-DU-PLRUa.js";import"./neonatal_service-CkHGSnqr.js";import"./images-Zb0Yk5XL.js";const ge={VITALS:6,APPOINTMENT:7,HIV_CLINIC_REGISTRATION:9,TREATMENT:25,HIV_RECEPTION:51,HIV_STAGING:52,HIV_CLINIC_CONSULTATION:53,DISPENSING:54,ART_ADHERENCE:68};class Ct extends H{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(t){return await super.getJson("fhir/patient/".concat(t),{id:t})}static async getFhirObservations(t){return await super.getJson("fhir/patient/".concat(t,"/observations/"),{id:t})}}const Ga={class:"fhir-viewer"},Ja={class:"container"},Qa={key:0,class:"main-header"},Ya={class:"header-line"},Za={key:0,class:"last-updated-display"},Ka={key:1,class:"card initial-input-card"},Xa={class:"action-area-initial"},eo={key:0,class:"card patient-card"},to={class:"card-title"},no={class:"patient-info-grid"},ao={class:"info-item"},oo={class:"info-value"},so={class:"info-item"},io={class:"info-value"},ro={class:"info-item"},lo={class:"info-value"},co={class:"info-item"},uo={class:"info-value"},po={class:"info-value"},mo={class:"info-value"},ho={class:"info-label"},fo={class:"info-value"},go={key:2,class:"card observations-card"},_o={class:"card-title"},vo={class:"observations-grid"},yo={class:"obs-header"},bo={class:"obs-title"},Do={class:"obs-details"},$o={class:"obs-detail obs-value-highlight"},Co={class:"obs-value"},wo={class:"obs-detail"},ko={class:"obs-value"},So={key:0,class:"obs-detail"},Io={class:"obs-value"},Po={key:3,class:"no-data-found"},To={key:4,class:"no-data-found"},Ao={key:5,class:"main-footer"},No=z({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(e){un({"person-circle-outline":It,"clipboard-outline":dt,"search-outline":fn,"information-circle-outline":hn,"alert-circle-outline":St,"person-add-outline":mn,"arrow-back-outline":pn});const t=e,a=ke(),s=O(!1),i=O([]),c=O(),r=O(),u=O(null),m=O([]),f=E(()=>i.value.some(k=>k.resourceType==="Bundle"&&k.entry&&k.entry.some(b=>b.resource&&b.resource.resourceType==="Patient"))),p=E(()=>m.value.length>0),D=async()=>{if(i.value=[],r.value=null,u.value=null,m.value=[],!c.value){console.error("Please enter a Patient Identifier.");return}s.value=!0;try{const k=await Ct.getFhirPatient(c.value);if(k&&k.entry&&k.entry.length>0){const b=k.entry[0].resource,Q=b.id,q=await Ct.getFhirObservations(Q);i.value=[k],q&&(i.value.push(q),m.value=q.entry.filter(X=>X.resource&&X.resource.resourceType==="Observation").map(X=>{const M=X.resource;return{id:M.id,display:B(M),value:J(M),date:M.effectiveDateTime,category:M.category&&M.category[0]&&M.category[0].coding&&M.category[0].coding[0]?M.category[0].coding[0].display||M.category[0].coding[0].code:"N/A"}}));const W=b.name&&b.name[0];u.value={personInformation:{given_name:W&&W.given?W.given.join(" "):"",middle_name:W&&W.middle?W.middle.join(" "):"",family_name:W&&W.family?W.family:"",gender:b.gender=="male"?"M":(b==null?void 0:b.gender)=="female"?"F":"",birthdate:b.birthDate||"",cell_phone_number:b.telecom&&b.telecom[0]?b.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:b.contact&&b.contact[0]&&b.contact[0].telecom?b.contact[0].telecom[0].value:""}]}};const V=[k,q].filter(Boolean).reduce((X,M)=>{if(M.meta&&M.meta.lastUpdated){const ie=new Date(M.meta.lastUpdated);return X===null||ie>X?ie:X}return X},null);V&&(r.value=I(V.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch(k){console.error("Error loading FHIR data:",k),i.value=[],r.value=null,u.value=null,m.value=[]}finally{s.value=!1}},h=k=>{if(k.name&&k.name[0]){const b=k.name[0],Q=b.given?b.given.join(" "):"",q=b.family||"";return"".concat(Q," ").concat(q).trim()||"N/A"}return"N/A"},y=k=>k.identifier&&k.identifier.length>0?k.identifier.map(b=>{let Q="Unknown System";if(b.type&&b.type.coding&&b.type.coding[0]&&b.type.coding[0].display)Q=b.type.coding[0].display;else if(b.system){const W=b.system.split("/");Q=W[W.length-1]||b.system,b.system==="urn:oid:2.16.840.1.113883.4.6"&&(Q="Social Security Number")}sessionStorage.setItem(Q,b.value);let q=null;return b.assigner&&b.assigner.display?q=b.assigner.display:b.assigner&&b.assigner.reference&&(q=b.assigner.reference.split("/").pop()||b.assigner.reference),{value:b.value||"N/A",systemDisplay:Q,periodStart:b.period?b.period.start:null,periodEnd:b.period?b.period.end:null,assignerDisplay:q}}):[],_=k=>k.telecom&&k.telecom.length>0?k.telecom.filter(b=>b.system==="phone"&&b.value):[],$=k=>{if(k.contact&&k.contact.length>0){const b=k.contact.filter(q=>{var W;return(W=q.relationship)==null?void 0:W.some(j=>{var V;return(V=j.coding)==null?void 0:V.some(X=>X.code==="GUARD")})}),Q=[];return b.forEach(q=>{q.telecom&&q.telecom.length>0&&q.telecom.filter(W=>W.system==="phone"&&W.value).forEach(W=>Q.push(W))}),Q}return[]},P=k=>{if(!k)return"N/A";try{return new Date(k).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(b){return console.error("Invalid date string for formatDate:",k,b),"Invalid Date"}},I=k=>{if(!k)return"N/A";try{return new Date(k).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(b){return console.error("Invalid date time string for formatDateTime:",k,b),"Invalid Date/Time"}},A=k=>{if(!k)return"N/A";try{const b=new Date,Q=new Date(k);let q=b.getFullYear()-Q.getFullYear();const W=b.getMonth()-Q.getMonth();return(W<0||W===0&&b.getDate()<Q.getDate())&&q--,q}catch(b){return console.error("Invalid birth date string for calculateAge:",k,b),"N/A"}},N=k=>{if(k.meta&&k.meta.tag){const b=k.meta.tag.find(Q=>Q.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return b?b.code:"Unknown"}return"Unknown"},B=k=>k.code&&k.code.coding&&k.code.coding[0]&&(k.code.coding[0].display||k.code.coding[0].code)||"Unknown Observation",J=k=>k.valueQuantity?"".concat(k.valueQuantity.value," ").concat(k.valueQuantity.unit||"").trim():k.valueString?k.valueString:k.valueBoolean!==void 0?k.valueBoolean?"True":"False":"N/A",U=()=>{se().setRecord(u.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(m.value)),De("/registration/manual")},_e=()=>{i.value=[],c.value="",r.value=null,u.value=null,m.value=[]},De=k=>{a.push({path:k})};return ce(()=>a,async()=>{i.value=[],m.value=[]},{deep:!0}),he(()=>{var k;if(t.initialData.length>0){i.value=t.initialData;const Q=t.initialData.filter(Boolean).reduce((j,V)=>{if(V.meta&&V.meta.lastUpdated){const X=new Date(V.meta.lastUpdated);return j===null||X>j?X:j}return j},null);Q&&(r.value=I(Q.toISOString()));const q=t.initialData.find(j=>j.resourceType==="Bundle"&&j.entry&&j.entry.some(V=>V.resource&&V.resource.resourceType==="Patient"));if(q){const j=(k=q.entry.find(V=>V.resource&&V.resource.resourceType==="Patient"))==null?void 0:k.resource;if(j){const V=j.name&&j.name[0];u.value={personInformation:{given_name:V&&V.given?V.given.join(" "):"",middle_name:V&&V.middle?V.middle.join(" "):"",family_name:V&&V.family?V.family:"",gender:j.gender||"",birthdate:j.birthDate||""}}}}const W=t.initialData.find(j=>j.resourceType==="Bundle"&&j.entry&&j.entry.some(V=>V.resource&&V.resource.resourceType==="Observation"));W&&(m.value=W.entry.filter(j=>j.resource&&j.resource.resourceType==="Observation").map(j=>{const V=j.resource;return{id:V.id,display:B(V),value:J(V),date:V.effectiveDateTime,category:V.category&&V.category[0]&&V.category[0].coding&&V.category[0].coding[0]?V.category[0].coding[0].display||V.category[0].coding[0].code:"N/A"}}))}}),(k,b)=>{var Q,q,W,j,V,X;return d(),v("div",Ga,[n("div",Ja,[(Q=i.value)!=null&&Q.length?(d(),v("header",Qa,[n("div",Ya,[b[1]||(b[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:re(["last-updated-display","status-"+N(i.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+C(N(i.value[0].entry[0].resource)),3),r.value?(d(),v("span",Za,"Last Updated: "+C(r.value),1)):S("",!0)])])])):S("",!0),(q=i.value)!=null&&q.length?S("",!0):(d(),v("section",Ka,[o(w(kt),{modelValue:c.value,"onUpdate:modelValue":b[0]||(b[0]=M=>c.value=M),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",Xa,[n("button",{onClick:D,class:"load-data-btn"},[o(w(Z),{name:"search-outline"}),b[2]||(b[2]=R(" Find Patient ",-1))])])])),(d(!0),v(G,null,K(i.value,M=>(d(),v("div",{key:M.id},[M.resourceType==="Bundle"&&M.entry&&M.entry[0]&&M.entry[0].resource.resourceType==="Patient"?(d(),v("section",eo,[n("h2",to,[o(w(Z),{name:"person-circle-outline"}),b[3]||(b[3]=R(" Patient Demographics",-1))]),n("div",no,[n("div",ao,[b[4]||(b[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",oo,C(h(M.entry[0].resource)),1)]),n("div",so,[b[5]||(b[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",io,C(M.entry[0].resource.gender||"Not specified"),1)]),n("div",ro,[b[6]||(b[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",lo,C(P(M.entry[0].resource.birthDate)),1)]),n("div",co,[b[7]||(b[7]=n("span",{class:"info-label"},"Age",-1)),n("span",uo,C(A(M.entry[0].resource.birthDate))+" years",1)]),_(M.entry[0].resource).length?(d(!0),v(G,{key:0},K(_(M.entry[0].resource),(ie,ve)=>(d(),v("div",{key:"patient-phone-".concat(ve),class:"info-item"},[b[8]||(b[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",po,C(ie.value),1)]))),128)):S("",!0),$(M.entry[0].resource).length?(d(!0),v(G,{key:1},K($(M.entry[0].resource),(ie,ve)=>(d(),v("div",{key:"guardian-phone-".concat(ve),class:"info-item"},[b[9]||(b[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",mo,C(ie.value),1)]))),128)):S("",!0),(d(!0),v(G,null,K(y(M.entry[0].resource),(ie,ve)=>(d(),v("div",{key:ie.value||ve,class:"info-item"},[n("span",ho,C(ie.systemDisplay),1),n("span",fo,C(ie.value),1)]))),128))])])):S("",!0)]))),128)),((W=m.value)==null?void 0:W.length)>0?(d(),v("section",go,[n("h2",_o,[o(w(Z),{name:"clipboard-outline"}),b[10]||(b[10]=R(" Clinical Observations",-1))]),n("div",vo,[(d(!0),v(G,null,K(m.value,M=>(d(),v("div",{key:M.id,class:"observation-item"},[n("div",yo,[n("h3",bo,C(M.display),1)]),n("div",Do,[n("div",$o,[b[11]||(b[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",Co,C(M.value),1)]),n("div",wo,[b[12]||(b[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",ko,C(I(M.date)),1)]),M.category&&M.category!=="N/A"?(d(),v("div",So,[b[13]||(b[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",Io,C(M.category),1)])):S("",!0)])]))),128))])])):S("",!0),(j=i.value)!=null&&j.length&&!f.value?(d(),v("div",Po,[n("p",null,[o(w(Z),{name:"alert-circle-outline"}),b[14]||(b[14]=R(" No patient data found for the provided identifier. Please try again.",-1))])])):(V=i.value)!=null&&V.length&&f.value&&!p.value?(d(),v("div",To,[n("p",null,[o(w(Z),{name:"information-circle-outline"}),b[15]||(b[15]=R(" No clinical observations found for this patient.",-1))])])):S("",!0),(X=i.value)!=null&&X.length?(d(),v("footer",Ao,[n("button",{onClick:_e,class:"back-to-search-btn small-btn"},[o(w(Z),{name:"arrow-back-outline"}),b[16]||(b[16]=R(" Back to Search ",-1))]),n("button",{onClick:U,class:"register-btn small-btn"},[o(w(Z),{name:"person-add-outline"}),b[17]||(b[17]=R(" Register New Patient ",-1))])])):S("",!0)])])}}}),Oo=Y(No,[["__scopeId","data-v-0dc329ef"]]),Ro=z({components:{DataTable:Me},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Referred From",data:"referredFrom"},{title:"Referred By",data:"referredBy"},{title:"Clinic Date",data:"appointmentDate"},{title:"Actions",data:null,render:(e,t,a)=>'<ion-button size="small" fill="solid" color="primary" onclick="window.navigatePatient(\''.concat(a.patient_id,"')\">Profile</ion-button>"),orderable:!1,width:"20%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No referrals found."}}}},async mounted(){var i;const t=(i=Ht().activeProgram)==null?void 0:i.program_id,a=String(localStorage.getItem("locationID")),s=await Ut.getAllEncounters({encounter_type_id:114});console.log("Encounters fetched for Internal Referrals:",s),this.patients=s.reduce((c,r)=>{var h,y,_,$,P,I,A,N;if(String(r==null?void 0:r.location_id)!==a||!((h=r==null?void 0:r.observations)==null?void 0:h.find(B=>(B==null?void 0:B.concept_id)===2227&&(B==null?void 0:B.value_numeric)===t)))return c;const m=($=(_=(y=r==null?void 0:r.patient)==null?void 0:y.person)==null?void 0:_.names)!=null&&$[0]?"".concat(r.patient.person.names[0].given_name||""," ").concat(r.patient.person.names[0].family_name||""):"Unknown";let f=((P=r==null?void 0:r.program)==null?void 0:P.name)||"Unknown Program";f=f.replace(/program/i,"").trim();const p=(A=(I=r==null?void 0:r.provider)==null?void 0:I.names)!=null&&A[0]?"".concat(r.provider.names[0].given_name||""," ").concat(r.provider.names[0].family_name||""):"Unknown",D=(N=r==null?void 0:r.observations)==null?void 0:N.find(B=>{var J,U;return(U=(J=B==null?void 0:B.concept)==null?void 0:J.concept_names)==null?void 0:U.some(_e=>{var De;return(De=_e==null?void 0:_e.name)==null?void 0:De.toLowerCase().includes("date of referral")})});return c.push({patient_id:r.patient_id,fullName:m,referredFrom:f,referredBy:p,appointmentDate:(D==null?void 0:D.value_text)||"N/A"}),c},[]),window.navigatePatient=this.navigateTo},methods:{async navigateTo(e){let t=await Te.findByID(e);t?(await se().setPatientRecord(t),this.$router.push("/patientProfile")):me("Patient not found. Please try searching by name.")}}}),Lo={class:"dueCardContent"};function Vo(e,t,a,s,i,c){const r=g("DataTable"),u=g("ion-card-content"),m=g("ion-card");return d(),F(m,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:l(()=>[o(u,null,{default:l(()=>[n("div",Lo,[o(r,{data:e.patients,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})}const Qt=Y(Ro,[["render",Vo],["__scopeId","data-v-a95ef46a"]]),Bo=z({name:"referrals",components:{InternalReferrals:Qt,ExternalReferrals:Oo},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(e){this.segmentContent=e}}}),Fo={key:0},Mo={style:{display:"flex","margin-top":"10px"}},xo={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},Eo={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},Ho={key:1},Uo={key:2};function Wo(e,t,a,s,i,c){const r=g("ion-label"),u=g("ion-segment-button"),m=g("ion-segment"),f=g("ExternalReferrals"),p=g("InternalReferrals");return d(),v(G,null,[n("div",null,[o(m,{value:e.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:l(()=>[o(u,{value:"External referrals",onClick:t[0]||(t[0]=D=>e.setSegmentContent("External referrals"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[2]||(t[2]=[R("External referrals",-1)])]),_:1})]),_:1}),o(u,{value:"Internal referrals",onClick:t[1]||(t[1]=D=>e.setSegmentContent("Internal referrals"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[3]||(t[3]=[R("Internal referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),e.segmentContent=="Internal referrals"?(d(),v("div",Fo,[n("div",Mo,[e.checkUnderFive?(d(),v("div",xo)):S("",!0),t[4]||(t[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),e.checkUnderFive?S("",!0):(d(),v("div",Eo))])])):S("",!0),e.segmentContent=="External referrals"?(d(),v("div",Ho,[o(f)])):S("",!0),e.segmentContent=="Internal referrals"?(d(),v("div",Uo,[o(p)])):S("",!0)],64)}const jo=Y(Bo,[["render",Wo],["__scopeId","data-v-8f0f935e"]]),zo=Pt("ncdDashboardStore",{state:()=>({dashboardData:null,appointments:[],isLoading:!1,error:null,lastFetchDate:null,programId:32}),getters:{appointmentsCount:e=>e.appointments.length,pendingDispensationsCount:e=>{var t;return((t=e.dashboardData)==null?void 0:t.total_pending_dispensations)||0},defaultersCount:e=>{var t;return((t=e.dashboardData)==null?void 0:t.total_defaulters)||0},complicationsCount:e=>{var t;return((t=e.dashboardData)==null?void 0:t.total_complications)||0},activeClientsCount:e=>{var t;return((t=e.dashboardData)==null?void 0:t.total_client_registered)||0},genderChartData:e=>{var t;return(t=e.dashboardData)!=null&&t.gender_data?{categories:e.dashboardData.gender_data.categories,series:[{name:"Male",data:e.dashboardData.gender_data.maleSeries},{name:"Female",data:e.dashboardData.gender_data.femaleSeries}]}:{categories:[],series:[{name:"Male",data:[]},{name:"Female",data:[]}]}},diagnosisChartData:e=>{var t;return(t=e.dashboardData)!=null&&t.diagnosis_data?{categories:e.dashboardData.diagnosis_data.categories,series:[{name:"Type 1 Diabetes",data:e.dashboardData.diagnosis_data.typeOneSeries},{name:"Type 2 Diabetes",data:e.dashboardData.diagnosis_data.typeTwoSeries},{name:"Hypertention",data:e.dashboardData.diagnosis_data.hypertentionSeries}]}:{categories:[],series:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},hasData:e=>e.dashboardData!==null,isDataStale:e=>{if(!e.lastFetchDate)return!0;const t=T.toStandardHisFormat(T.sessionDate());return e.lastFetchDate!==t}},actions:{async fetchDashboardData(e,t){this.isLoading=!0,this.error=null;try{const a=e||T.toStandardHisFormat(T.sessionDate()),s=t||T.toStandardHisFormat(T.sessionDate()),i="programs/".concat(this.programId,"/reports/ncd_dashboard"),c=await H.getJson(i,{start_date:a,end_date:s});this.setDashboardData(c),this.lastFetchDate=a}catch(a){this.error=a.message||"Failed to fetch dashboard data",console.error("Error fetching NCD dashboard data:",a)}finally{this.isLoading=!1}},setDashboardData(e){this.dashboardData=e},setAppointments(e){this.appointments=e},addAppointment(e){this.appointments.push(e)},removeAppointment(e){this.appointments=this.appointments.filter(t=>t.id!==e)},updateAppointment(e,t){const a=this.appointments.findIndex(s=>s.id===e);a!==-1&&(this.appointments[a]={...this.appointments[a],...t})},setProgramId(e){this.programId=e},clearDashboardData(){this.dashboardData=null,this.appointments=[],this.error=null,this.lastFetchDate=null},async refreshDashboardData(){await this.fetchDashboardData()},async ensureFreshData(){(this.isDataStale||!this.hasData)&&await this.fetchDashboardData()}},persist:{key:"ncd-dashboard-store",storage:localStorage,paths:["dashboardData","appointments","lastFetchDate","programId"]}});async function qo(){const e=localStorage.getItem("locationID"),t=32,s=(await Oe("patients_records",{selector:{location_id:e}})).filter(h=>(h.activePrograms||[]).some(_=>_.program_id===t)),i=s.length,c=s.filter(h=>{var y;return((y=h.personInformation)==null?void 0:y.gender)==="M"}).length,r=s.filter(h=>{var y;return((y=h.personInformation)==null?void 0:y.gender)==="F"}).length,u=Go(s),m=Jo(s),f=Qo(s),p=Yo(s),D=Zo(s);return{total_client_registered:i,total_male_registered:c,total_female_registered:r,total_complications:u,total_defaulters:m,total_pending_dispensations:f,gender_data:{categories:p.categories,series:[{name:"Male",data:p.male,group:"apexcharts-axis-0"},{name:"Female",data:p.female,group:"apexcharts-axis-0"}]},diagnosis_data:{categories:D.categories,series:[{name:"Type 1 Diabetes",data:D.type_one,group:"apexcharts-axis-0"},{name:"Type 2 Diabetes",data:D.type_two,group:"apexcharts-axis-0"},{name:"Hypertension",data:D.hypertension,group:"apexcharts-axis-0"}]}}}function Go(e){let t=0;return e.forEach(a=>{(a.observations||[]).some(c=>{var r;return c.encounter_type===ht.COMPLICATIONS&&c.status==="saved"&&((r=c.obs)==null?void 0:r.length)>0})&&t++}),t}function Jo(e){const t=new Date,a=new Date(t);a.setDate(a.getDate()-60);const s=new Date(t);s.setDate(s.getDate()-120);let i=0;return e.forEach(c=>{var f;const r=((f=c.MedicationOrder)==null?void 0:f.saved)||[];if(r.length===0)return;const u=r.filter(p=>p.quantity>0).sort((p,D)=>new Date(D.start_date).getTime()-new Date(p.start_date).getTime())[0];if(!u)return;const m=new Date(u.start_date);m>=s&&m<=a&&(r.some(D=>new Date(D.start_date)>a)||i++)}),i}function Qo(e){let t=0;return e.forEach(a=>{var c;(((c=a.MedicationOrder)==null?void 0:c.saved)||[]).some(r=>r.quantity<=0)&&t++}),t}function Yo(e){const t={};let a=new Date;for(let c=0;c<4;c++){const r=Yt(a),u=Zt(r);t[u]={male:new Set,female:new Set},e.forEach(m=>{var y;const f=m.patientID,p=(y=m.personInformation)==null?void 0:y.gender,D=m.observations||[];let h=!1;D.forEach(_=>{var $;_.status==="saved"&&(($=_.obs)==null||$.forEach(P=>{const I=P.obs_datetime?new Date(P.obs_datetime):null;I&&I>=r&&I<=a&&(h=!0)}))}),h&&(p==="M"?t[u].male.add(f):p==="F"&&t[u].female.add(f))}),a=new Date(r),a.setDate(a.getDate()-1)}const s={};Object.entries(t).forEach(([c,r])=>{s[c]={male:r.male.size,female:r.female.size}});const i=Kt(s);return{categories:Object.keys(i),male:Object.values(i).map(c=>c.male),female:Object.values(i).map(c=>c.female)}}function Zo(e){const t={};let a=new Date;for(let c=0;c<4;c++){const r=Yt(a),u=Zt(r);t[u]={type_one:new Set,type_two:new Set,hypertension:new Set},e.forEach(m=>{const f=m.patientID,p=m.observations||[];let D=null;p.forEach(h=>{var y;h.encounter_type===ht.DIAGNOSIS&&((y=h.obs)==null||y.forEach(_=>{const $=_.obs_datetime?new Date(_.obs_datetime):null;$&&$>=r&&$<=a&&_.concept_id===6542&&(D=_.value_coded)}))}),D===6409?t[u].type_one.add(f):D===6410?t[u].type_two.add(f):(D===8809||D===903)&&t[u].hypertension.add(f)}),a=new Date(r),a.setDate(a.getDate()-1)}const s={};Object.entries(t).forEach(([c,r])=>{s[c]={type_one:r.type_one.size,type_two:r.type_two.size,hypertension:r.hypertension.size}});const i=Kt(s);return{categories:Object.keys(i),type_one:Object.values(i).map(c=>c.type_one),type_two:Object.values(i).map(c=>c.type_two),hypertension:Object.values(i).map(c=>c.hypertension)}}function Yt(e){const t=e.getMonth(),a=Math.floor(t/3)*3;return new Date(e.getFullYear(),a,1)}function Zt(e){const t=Math.floor(e.getMonth()/3)+1;return"Q".concat(t," ").concat(e.getFullYear())}function Kt(e){return Object.fromEntries(Object.entries(e).reverse())}const Ko={class:"cards-container"},Xo={class:"top-card-text"},es={class:"text-2xl font-bold"},ts={class:"top-card-text"},ns={class:"text-2xl font-bold"},as={class:"top-card-text"},os={class:"text-2xl font-bold"},ss={class:"top-card-text"},is={class:"text-2xl font-bold"},rs={class:"top-card-text"},ls={class:"text-2xl font-bold"},ds={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},cs={ref:"chartRef1"},us={key:1,class:"loading-state"},ps={ref:"chartRef2"},ms={key:1,class:"loading-state"},hs=z({__name:"Dashboard",setup(e){const t=ke(),a=xe();zo();const s=O(!1),i=O({total_pending_dispensations:0,total_defaulters:0,total_complications:0,total_client_registered:0,diagnosis_data:{series:[],categories:[]},gender_data:{series:[],categories:[]},isLoading:!1}),c=O([]),r=E(()=>({chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:i.value.gender_data.categories},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}})),u=E(()=>({chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:i.value.diagnosis_data.categories},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}})),m=async()=>{if(H.getLanConnectionStatus()||H.getPouchDbStatus())i.value=await qo();else{const D=T.toStandardHisFormat(T.sessionDate()),h=T.toStandardHisFormat(T.sessionDate()),y="programs/".concat(H.getProgramID(),"/reports/ncd_dashboard");i.value=await H.getJson(y,{start_date:D,end_date:h})}await Ee(),setTimeout(()=>{s.value=!0},100)},f=D=>{try{gn.close(),t.push(D).then(()=>{})}catch(h){console.error(h)}},p=D=>{console.log("Setting active item:",D)};return ce(()=>a.path,async()=>{await m()},{deep:!0}),he(async()=>{await m()}),(D,h)=>{const y=g("ion-card-content"),_=g("ion-card");return d(),v(G,null,[n("div",Ko,[o(_,{class:"top-card action-card",onClick:h[0]||(h[0]=$=>p("appointments"))},{default:l(()=>[o(y,null,{default:l(()=>{var $;return[n("div",Xo,[n("div",es,C((($=c.value)==null?void 0:$.length)||0),1),h[2]||(h[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]}),_:1})]),_:1}),o(_,{class:"top-card action-card"},{default:l(()=>[o(y,null,{default:l(()=>[n("div",ts,[n("div",ns,C(i.value.total_pending_dispensations),1),h[3]||(h[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]),_:1})]),_:1}),o(_,{class:"top-card action-card"},{default:l(()=>[o(y,null,{default:l(()=>[n("div",as,[n("div",os,C(i.value.total_defaulters),1),h[4]||(h[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]),_:1})]),_:1}),o(_,{class:"top-card action-card"},{default:l(()=>[o(y,null,{default:l(()=>[n("div",ss,[n("div",is,C(i.value.total_complications),1),h[5]||(h[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]),_:1})]),_:1}),o(_,{class:"top-card action-card",onClick:h[1]||(h[1]=$=>f("NCDActivePatients"))},{default:l(()=>[o(y,null,{default:l(()=>[n("div",rs,[n("div",ls,C(i.value.total_client_registered),1),h[6]||(h[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]),_:1})]),_:1})]),n("div",ds,[o(_,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[o(y,null,{default:l(()=>[h[7]||(h[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",cs,[s.value?(d(),F(w(Je),{key:0,style:{width:"100%",height:"500px"},type:"bar",options:u.value,series:i.value.diagnosis_data.series},null,8,["options","series"])):S("",!0),i.value.isLoading?(d(),v("div",us,"Loading...")):S("",!0)],512)]),_:1})]),_:1}),o(_,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[o(y,null,{default:l(()=>[h[8]||(h[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",ps,[s.value?(d(),F(w(Je),{key:0,style:{width:"100%",height:"500px"},type:"line",options:r.value,series:i.value.gender_data.series},null,8,["options","series"])):S("",!0),i.value.isLoading?(d(),v("div",ms,"Loading...")):S("",!0)],512)]),_:1})]),_:1})])],64)}}}),fs=Y(hs,[["__scopeId","data-v-a5d22305"]]),lt=Pt("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(e){this.selectedItem=e},getSelectedItem(){return this.selectedItem}},persist:!0}),gs=()=>{const e=O(null);return{activeIteminMixin:e,setActiveItem:a=>{e.value=a,console.log("lll: ",e.value)}}},et=z({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:e,setActiveItem:t}=gs();return{chevronBackOutline:Lt,checkmark:kn,grid:wn,chevronDownCircle:Cn,chevronForwardCircle:$n,chevronUpCircle:Dn,colorPalette:bn,document:yn,globe:vn,medkit:Rt,add:_n,person:Ot,people:Nt,thermometer:At,clipboard:Tt,activeIteminMixin:e,setActiveItem:t}},async mounted(){await this.setAppointments()},computed:{...de(se,["patient"])},watch:{$route:{async handler(e){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await ta.getDailyAppointments(T.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((e,t)=>e.given_name.localeCompare(t.given_name)))},formatBirthdate(e){return T.getBirthdateAge(e)},setActiveItemRefFN(e){lt().setSelectedItem(e)}}}),_s=z({name:"Home",mixins:[Wt,et],components:{IonContent:le,IonHeader:fe,IonPage:Re,IonToolbar:Se,IonRow:Ze,DateInputField:ft,IonIcon:Z,IonButton:Fe,IonCol:Ye,IonCard:He,IonCardHeader:ut,IonCardTitle:ct,IonCardContent:Qe,ViewToggleComponent:Ia,bottomNavBar:Pa,HorizontalLine:na},data(){const e=localStorage.getItem("ncdStartDate"),t=localStorage.getItem("ncdEndDate"),a=O(e||T.sessionDate()),s=O(t||T.sessionDate()),i=O(T.sessionDate()),c=O(T.sessionDate()),r=O([]),u=it({page:1,itemsPerPage:10}),m=O(0),f=wa(),p=O("list");return{minDate:i,startDate:a,endDate:s,people:r,calendarOutline:Le,openOutline:Vt,maxDate:c,alertCircleOutline:St,personOutline:On,idCardOutline:Nn,manOutline:An,womanOutline:Tn,locationOutline:Pn,timeOutline:In,todayOutline:Sn,pagination:u,totalCount:m,actionButtonStore:f,currentToggleView:p}},computed:{...de(vt,["NCDAppointmentsTogglePreference"]),paginatedPeople(){const e=(this.pagination.page-1)*this.pagination.itemsPerPage,t=e+this.pagination.itemsPerPage;return this.people.slice(e,t)},groupedPaginatedPeople(){const e={};this.paginatedPeople.forEach(s=>{const i=s.appointmentDate;e[i]||(e[i]=[]),e[i].push(s)});const t=Object.keys(e).sort((s,i)=>new Date(s)-new Date(i)),a={};return t.forEach(s=>{a[s]=e[s]}),a}},$route:{async handler(){},deep:!0},watch:{NCDAppointmentsTogglePreference:{handler(e){e&&e.toggle_view&&(this.currentToggleView=e.toggle_view)},deep:!0,immediate:!0}},async mounted(){this.initTogglePreference(),this.getAppointments(),this.HideHomePageActionButton()},async unmounted(){this.actionButtonStore.resetShowActionButton()},methods:{formatBirthdate(e){return T.getBirthdateAge(e)},async getAppointments(e=!1){if(jt().apiStatus){this.people=[],this.pagination.page=1;try{e==!0&&(this.startDate=T.sessionDate(),this.endDate=T.sessionDate(),this.getAppointmentsD1(this.startDate),this.getAppointmentsD2(this.endDate)),this.startDate>this.endDate&&(this.endDate=this.startDate),console.log(this.startDate,this.endDate),(await Gt.getAppointments(this.startDate,this.endDate,"")).forEach(s=>{const i=T.toStandardHisDisplayFormat(s.appointment_date);if(!this.people.some(r=>r.person_id===s.person_id&&r.appointmentDate===i)){const r={person_id:s.person_id,npid:s.npid,appointment_id:103,encounter_id:s.encounter_id,name:s.given_name.concat(" ",s.family_name),gender:s.gender,ageDob:this.formatBirthdate(s.birthdate),village:s.city_village,appointmentDate:i};this.people.push(r)}}),this.totalCount=this.people.length}catch(a){}}},async getAppointmentsD1(e){this.startDate=T.toStandardHisFormat(e),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(e){this.endDate=T.toStandardHisFormat(e),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(e){const t=await Te.findByNpid(e);se().setPatientRecord(t[0]),this.redirectUser()},handleViewChange(e){this.currentToggleView=e,this.initTogglePreference(e,!0)},initTogglePreference(e="list",t=!1){const a={toggle_view:e},s=vt();Object.keys(this.NCDAppointmentsTogglePreference).length===0?(a.toggle_view="list",s.setNCDAppointmentsTogglePreference(a),this.currentToggleView="list"):t===!0?s.setNCDAppointmentsTogglePreference(a):this.currentToggleView=this.NCDAppointmentsTogglePreference.toggle_view||"list"},redirectUser(){const e=JSON.parse(localStorage.getItem("userRoles")),t=e||[];t.some(a=>t.some(s=>s.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")},handlePaginationUpdate({page:e,itemsPerPage:t}){if(t!==this.pagination.itemsPerPage){const a=(this.pagination.page-1)*this.pagination.itemsPerPage,s=Math.floor(a/t)+1,i=Math.ceil(this.totalCount/t);this.pagination.page=Math.min(s,i)||1,this.pagination.itemsPerPage=t}else this.pagination.page=e},HideHomePageActionButton(){this.actionButtonStore.setShowActionButton(!1)}}}),vs={class:"appointments-container"},ys={class:"date-filter"},bs={key:0,style:{margin:"20px"}},Ds={key:1},$s={class:"appointments-table"},Cs={key:2},ws={class:"date-group-header"},ks={class:"date-header-title"},Ss={class:"date-header-count"},Is={class:"cards-container"},Ps={class:"card-details"},Ts={class:"detail-item"},As={class:"detail-value"},Ns={class:"detail-item"},Os={class:"detail-value"},Rs={class:"detail-item"},Ls={class:"detail-value"},Vs={class:"detail-item"},Bs={class:"detail-value"};function Fs(e,t,a,s,i,c){const r=g("DateInputField"),u=g("ion-col"),m=g("ion-icon"),f=g("ion-button"),p=g("ViewToggleComponent"),D=g("ion-row"),h=g("ion-card"),y=g("HorizontalLine"),_=g("ion-card-title"),$=g("ion-card-header"),P=g("ion-card-content"),I=g("ion-content"),A=g("bottomNavBar"),N=g("ion-footer");return d(),v("div",vs,[n("div",ys,[o(D,null,{default:l(()=>[o(u,null,{default:l(()=>[o(r,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),o(u,null,{default:l(()=>[o(r,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1}),o(u,null,{default:l(()=>[o(f,{color:"primary",onClick:t[0]||(t[0]=B=>e.getAppointments(!0)),class:"apt-btn"},{default:l(()=>[o(m,{icon:e.todayOutline,slot:"start"},null,8,["icon"]),t[1]||(t[1]=n("span",{style:{margin:"5px"}}," Today ",-1))]),_:1})]),_:1}),o(u,null,{default:l(()=>[o(p,{"initial-view":e.currentToggleView,onViewChanged:e.handleViewChange},null,8,["initial-view","onViewChanged"])]),_:1})]),_:1})]),o(I,{class:"scrollable-content"},{default:l(()=>[e.people.length===0?(d(),v("div",bs,[o(m,{icon:e.alertCircleOutline,size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),t[2]||(t[2]=n("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Appointments for selected date range",-1))])):e.currentToggleView==="list"&&e.people.length>0?(d(),v("div",Ds,[o(h,null,{default:l(()=>[n("table",$s,[t[3]||(t[3]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),v(G,null,K(e.paginatedPeople,B=>(d(),v("tr",{key:B.npid},[n("td",null,[o(D,null,{default:l(()=>[o(u,null,{default:l(()=>[R(C(B.name),1)]),_:2},1024),o(u,null,{default:l(()=>[o(f,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:J=>e.openClientProfile(B.npid),color:"primary",fill:"clear",size:"small"},{default:l(()=>[o(m,{icon:e.openOutline,style:{"font-size":"28px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,C(B.npid),1),n("td",null,C(B.ageDob),1),n("td",null,C(B.gender),1),n("td",null,C(B.village),1),n("td",null,C(B.appointmentDate),1)]))),128))])])]),_:1})])):e.currentToggleView==="card"&&e.people.length>0?(d(),v("div",Cs,[(d(!0),v(G,null,K(e.groupedPaginatedPeople,(B,J)=>(d(),v("div",{key:J,class:"date-group"},[n("div",ws,[o(m,{icon:e.calendarOutline,class:"date-header-icon"},null,8,["icon"]),n("h2",ks,C(J),1),n("div",Ss,C(B.length)+" appointment"+C(B.length!==1?"s":""),1)]),o(y,{color:"#006401",thickness:1,spacing:"sm"}),n("div",Is,[(d(!0),v(G,null,K(B,U=>(d(),F(h,{key:U.npid,class:"appointment-card"},{default:l(()=>[o($,null,{default:l(()=>[o(D,{class:"ion-align-items-center"},{default:l(()=>[o(u,null,{default:l(()=>[o(_,{class:"card-name"},{default:l(()=>[o(m,{icon:e.personOutline,class:"name-icon"},null,8,["icon"]),R(" "+C(U.name),1)]),_:2},1024)]),_:2},1024),o(u,{size:"auto"},{default:l(()=>[o(f,{onClick:_e=>e.openClientProfile(U.npid),color:"primary",fill:"clear",size:"small",class:"view-profile-btn"},{default:l(()=>[o(m,{icon:e.openOutline},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(P,null,{default:l(()=>[n("div",Ps,[n("div",Ts,[o(m,{icon:e.idCardOutline,class:"detail-icon"},null,8,["icon"]),t[4]||(t[4]=n("span",{class:"detail-label"},"NPID:",-1)),n("span",As,C(U.npid),1)]),n("div",Ns,[o(m,{icon:e.calendarOutline,class:"detail-icon"},null,8,["icon"]),t[5]||(t[5]=n("span",{class:"detail-label"},"Age/DOB:",-1)),n("span",Os,C(U.ageDob),1)]),n("div",Rs,[o(m,{icon:U.gender==="Male"?e.manOutline:e.womanOutline,class:"detail-icon"},null,8,["icon"]),t[6]||(t[6]=n("span",{class:"detail-label"},"Gender:",-1)),n("span",Ls,C(U.gender),1)]),n("div",Vs,[o(m,{icon:e.locationOutline,class:"detail-icon"},null,8,["icon"]),t[7]||(t[7]=n("span",{class:"detail-label"},"Village:",-1)),n("span",Bs,C(U.village),1)])])]),_:2},1024)]),_:2},1024))),128))])]))),128))])):S("",!0)]),_:1}),e.people.length>0?(d(),F(N,{key:0,class:"sticky-footer"},{default:l(()=>[o(D,null,{default:l(()=>[o(u,{size:"12",style:{"max-width":"100%"}},{default:l(()=>[o(A,{totalItems:e.totalCount,currentPage:e.pagination.page,itemsPerPage:e.pagination.itemsPerPage,"onUpdate:pagination":e.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])]),_:1})]),_:1})]),_:1})):S("",!0)])}const Ms=Y(_s,[["render",Fs],["__scopeId","data-v-6d92a5ce"]]),xs={key:0,class:"left_col"},Es={class:"nav-menu"},Hs=["onClick"],Us={class:"ellipsis"},Ws={key:1,style:{"padding-left":"20px","padding-right":"20px"}},js=z({__name:"NCDDashboard",setup(e){const t=lt(),a=E(()=>t.selectedItem),{screenWidth:s}=aa(),i=O([{id:"dashboard",label:"Dashboard",icon:Bt},{id:"referrals",label:"Referrals",icon:pt},{id:"appointments",label:"Appointments",icon:Le}]),c=O("dashboard"),r=je(),{substance:u}=qe(r);ce(()=>u.value,(f,p)=>{f!==p&&console.log("Substance changed:",f)},{deep:!0,immediate:!0});const m=f=>{c.value=f,lt().setSelectedItem(c.value)};return ce(()=>a.value,f=>{console.log("Active item from mixin changed:",f),f&&f!=null&&m(f)},{immediate:!0}),(f,p)=>{const D=g("ion-segment-button"),h=g("ion-segment");return d(),v("div",{style:Ge(w(s)>940?"display: flex":"display: block")},[w(s)>940?(d(),v("div",xs,[n("nav",Es,[n("ul",null,[(d(!0),v(G,null,K(i.value,y=>(d(),v("li",{key:y.id,class:re({active:c.value===y.id}),onClick:_=>m(y.id)},[o(w(Z),{icon:y.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",Us,C(y.label),1)],10,Hs))),128))])])])):S("",!0),w(s)<=940?(d(),v("div",Ws,[o(h,{value:c.value,style:{"margin-top":"5px","justify-content":"left"}},{default:l(()=>[(d(!0),v(G,null,K(i.value,y=>(d(),F(D,{value:y.id,key:y.id,class:re({active:c.value===y.id}),onClick:_=>m(y.id)},{default:l(()=>[o(w(Z),{icon:y.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,C(y.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):S("",!0),n("div",{class:"right_col",style:Ge(w(s)>940?"width: 85%":"width: 100%")},[n("div",null,[c.value==="referrals"?(d(),F(jo,{key:0})):S("",!0),c.value==="dashboard"?(d(),F(fs,{key:1})):S("",!0),c.value==="appointments"?(d(),F(Ms,{key:2})):S("",!0)])],4)],4)}}}),zs=Y(js,[["__scopeId","data-v-a1132315"]]);class qs extends H{constructor(){super()}static async getHTCDashboardSummary(t={}){return this.getJson("hts_stats",t)}}const Gs={class:"content-wrapper dashboard"},Js={class:"header"},Qs={class:"overlay"},Ys={class:"big-number"},Zs={class:""},Ks={class:"cards"},Xs={class:"card"},ei={class:"card-info"},ti={class:"card-number"},ni={class:"card"},ai={class:"card-info"},oi={class:"card-number"},si={class:"card"},ii={class:"card-info"},ri={class:"card-number"},li={class:"card"},di={class:"card-info"},ci={class:"card-number"},ui={class:"section-title"},pi={class:"section"},mi={class:"filter-bar"},hi={class:"patient-list"},fi=["onClick"],gi={class:"status-tags"},_i={class:re(["tag","yellow"])},vi={class:"pagination"},yi=["disabled"],bi={class:"pagination-info"},Di={class:"showing-info"},$i=["disabled"],ot=5,Ci=z({__name:"HTSDashboard",setup(e){const t=ke(),a=xe(),s=se(),i=O({clients_with_conclusive_results:0,total_clients:0,clients_tested_today:0,clients_referred_to_ART:0,visit_scheduled_today:0,patient_data:[]}),c=O(""),r=O(1),u=E(()=>y.value.length),m=E(()=>Math.ceil(u.value/ot)),f=E(()=>(r.value-1)*ot),p=E(()=>Math.min(f.value+ot,u.value)),D=E(()=>y.value.slice(f.value,p.value)),h=A=>A.toLowerCase().trim().replace(/\s+/g," "),y=E(()=>{if(!c.value.trim())return i.value.patient_data;const A=h(c.value);return i.value.patient_data.filter(N=>h(N.patient_name||"").includes(A)||h(N.patient_gender||"").includes(A)||h(N.program_names||"").includes(A)||String(N.patient_age).includes(A))});function _(){r.value<m.value&&r.value++}function $(){r.value>1&&r.value--}const P=async A=>{await s.setPatientRecord({patient_id:A.patient_id}),t.push("/patientProfile")};ce(c,()=>{r.value=1}),ce(a,async()=>{a.name=="Home"&&await I()}),he(async()=>{await I()});async function I(){i.value=await qs.getHTCDashboardSummary()}return(A,N)=>(d(),F(w(le),{class:"content"},{default:l(()=>{var B;return[n("div",Gs,[n("div",Js,[n("div",Qs,[n("h1",Ys,C((B=i.value)==null?void 0:B.clients_with_conclusive_results),1),N[1]||(N[1]=n("p",{class:"header-text"},[R(" Total Number of Clients Tested"),n("br"),R(" with Conclusive Results ")],-1))])]),n("div",Zs,[N[8]||(N[8]=n("h2",{class:"section-title"},"Today's Stats",-1)),n("div",Ks,[n("div",Xs,[n("div",ei,[o(w(Z),{icon:w(pt),class:"card-icon"},null,8,["icon"])]),N[2]||(N[2]=n("div",{class:"card-info"},[n("p",null,"Total Clients")],-1)),n("div",ti,C(i.value.total_clients),1)]),n("div",ni,[n("div",ai,[o(w(Z),{icon:w(dt),class:"card-icon"},null,8,["icon"])]),N[3]||(N[3]=n("div",{class:"card-info"},[n("p",null,"Clients Tested Today")],-1)),n("div",oi,C(i.value.clients_tested_today),1)]),n("div",si,[n("div",ii,[o(w(Z),{icon:w(Rn),class:"card-icon"},null,8,["icon"])]),N[4]||(N[4]=n("div",{class:"card-info"},[n("p",null,"Clients Referred To ART")],-1)),n("div",ri,C(i.value.clients_referred_to_ART),1)]),n("div",li,[n("div",di,[o(w(Z),{icon:w(Le),class:"card-icon"},null,8,["icon"])]),N[5]||(N[5]=n("div",{class:"card-info"},[n("p",null,"Visit Scheduled Today")],-1)),n("div",ci,C(i.value.visit_scheduled_today),1)])]),n("h2",ui,"Patient Awaiting List ("+C(u.value)+")",1),n("div",pi,[n("div",mi,[be(n("input",{class:"search-input",type:"text",placeholder:"Search Patient","onUpdate:modelValue":N[0]||(N[0]=J=>c.value=J)},null,512),[[Ln,c.value]])]),n("div",hi,[(d(!0),v(G,null,K(D.value,J=>(d(),v("div",{class:"patient-item",key:J.id,onClick:U=>P(J)},[n("div",null,[n("strong",null,C(J.patient_name),1),n("p",null,C(J.patient_gender=="M"?"Male":"Female")+" â€¢ "+C(J.patient_age)+"y",1)]),n("div",gi,[n("span",_i,C(J.program_names),1)])],8,fi))),128))]),n("div",vi,[n("button",{onClick:$,disabled:r.value===1,class:"pagination-btn"},[o(w(Z),{icon:w(Lt)},null,8,["icon"]),N[6]||(N[6]=R(" Previous ",-1))],8,yi),n("div",bi,[R(" Page "+C(r.value)+" of "+C(m.value)+" ",1),n("span",Di,"(Showing "+C(f.value+1)+"-"+C(p.value)+" of "+C(u.value)+")",1)]),n("button",{onClick:_,disabled:r.value===m.value,class:"pagination-btn"},[N[7]||(N[7]=R(" Next ",-1)),o(w(Z),{icon:w(Vn)},null,8,["icon"])],8,$i)])])])])]}),_:1}))}}),wi=Y(Ci,[["__scopeId","data-v-dde1df6c"]]),wt={"HIV clinic registration":ge.HIV_CLINIC_REGISTRATION,"HIV reception":ge.HIV_RECEPTION,Vitals:ge.VITALS,"HIV staging":ge.HIV_STAGING,"HIV clinic consultation":ge.HIV_CLINIC_CONSULTATION,"ART adherence":ge.ART_ADHERENCE,Prescription:ge.TREATMENT,Dispensing:ge.DISPENSING,Appointments:ge.APPOINTMENT};class ki extends oa{constructor(){super()}buildEncounters(t,a){return Object.entries(wt).map(([s,i])=>({encounter:s,female:t?t[i].F:0,male:t?t[i].M:0,me:a?a[i].F+a[i].M:0,facility:t?t[i].F+t[i].M:0}))}async getStats(){const t=Object.values(wt),a=sa("reports/encounters",this.buildParams()),s=await H.postJson(a,{encounter_types:t}),i=await H.postJson(a,{encounter_types:t,all:!0});return this.buildEncounters(s.data,i.data)}getEncounterStats(t){return H.postJson("reports/encounters?date=".concat(this.date,"&program_id=1"),t)}}const Si={class:"dashboard-container"},Ii={class:"main-section"},Pi={class:"chart-section"},Ti={class:"encounters-section"},Ai={class:"his-sm-text"},Ni={key:0},Oi={class:"encounter-td"},Ri={class:"other-td"},Li={class:"other-td"},Vi={class:"other-td"},Bi={class:"other-td"},Fi={key:1},Mi=z({__name:"ARTDashboard",setup(e){const t=O([]),a=it({options:{chart:{id:"vuechart-example"},xaxis:{categories:["","","","",""]},yaxis:{min:0,forceNiceScale:!0,title:{text:"Number of clients",align:"left"}}},series:[{name:"Total visits",data:[0,0,0,0,0],color:"#7cb5ec"},{name:"Total incomplete visits",data:[0,0,0,0,0],color:"#434348"}]}),s=it([{"HIV clinic registration":9},{"HIV reception":51},{Vitals:6},{"HIV staging":52},{"HIV clinic consultation":53},{"ART adherence":68},{Treatment:25},{Dispensing:54},{Appointments:7}]),i=()=>{t.value=s.map(u=>({encounter:Object.keys(u)[0],female:"",male:"",me:"",facility:""}))},c=async()=>{const u=new Ta,m=H.getSessionDate();u.setStartDate(T.subtract(m,"days",5).format(yt)),u.setEndDate(T.subtract(m,"days",1).format(yt));const f=await u.getVisitStats(),p=[],D=[],h=[];Object.entries(f).forEach(([y,{incomplete:_,complete:$}])=>{h.push(Bn(y).format("dddd")),p.push(_),D.push(_+$)}),a.series[0].data=[...D],a.series[1].data=[...p],a.options={...a.options,xaxis:{categories:[...h]}}},r=async()=>{try{const u=new ki,m=s.map(D=>Object.values(D)[0]),f=await u.getEncounterStats({encounter_types:m}),p=await u.getEncounterStats({encounter_types:m,all:!0});t.value=s.map(D=>{const[h,y]=Object.entries(D)[0];return{encounter:h,female:p[y].F,male:p[y].M,me:f[y].F+f[y].M,facility:p[y].F+p[y].M}})}catch(u){console.error(u)}};return he(()=>{i(),c(),r()}),(u,m)=>(d(),v("div",Si,[n("div",Ii,[n("div",Pi,[m[0]||(m[0]=n("h3",null,"Total visits/incomplete visits: last 5 days",-1)),o(w(Je),{width:"100%",height:"390px",type:"bar",options:a.options,series:a.series},null,8,["options","series"])]),n("div",Ti,[m[3]||(m[3]=n("h3",null,"Encounters created today",-1)),n("table",Ai,[m[2]||(m[2]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),t.value.length?(d(),v("tbody",Ni,[(d(!0),v(G,null,K(t.value,(f,p)=>(d(),v("tr",{key:p},[n("td",Oi,C(f.encounter),1),n("td",Ri,C(f.female),1),n("td",Li,C(f.male),1),n("td",Vi,C(f.me),1),n("td",Bi,C(f.facility),1)]))),128))])):(d(),v("tbody",Fi,[...m[1]||(m[1]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])]))])])])]))}}),xi=Y(Mi,[["__scopeId","data-v-9bb19378"]]);class st extends H{static getlogs(t,a){return this.getJson("notification/logs",{startDate:t,endDate:a})}static clear(t){return this.putJson("notifications/clear/".concat(t),{id:t})}static read(t){return this.putJson("notifications/update",{alerts:t})}static unread(){return this.getJson("notifications")}}const ye=O([]),Ei=ke();function Xt(){const e=E(()=>ye.value.filter(p=>!p.read)),t=E(()=>ye.value.length>0),a=E(()=>e.value.length>0),s=E(()=>e.value.length),i=E(()=>ye.value.sort((p,D)=>new Date(p.date)>new Date(D.date)?-1:1));function c(p,D){ia("Are you sure you want to clear notification?").then(h=>{h&&st.clear(p).then(()=>{ye.value=ye.value.filter(y=>y.id!=p),D(p),u()}).catch(y=>{console.error(y),me("Unable to clear notification")})})}function r(p){return T.toStandardHisDisplayFormat(p)}async function u(){ye.value=[];const p=await st.unread();if(!Be.isEmpty(p)){const D={highVL:[],normalVL:[],rejectedVL:[]};let h={};ye.value=p.map(y=>{let _="General";const $=y.text;let P=null;try{const I=JSON.parse(y.text);if(I.Type.match(/lims/i)){P=()=>Ei.push("/art/encounters/lab/".concat(I.PatientID)),_="".concat(I["Test type"]," results for ").concat(I["ARV-Number"]||I["Accession number"]);const A=ra.detectHighVl(I.Result[0].value,I.Result[0].value_modifier);h={handler:P,id:y.alert_id,arv:I["ARV-Number"],accession:I["Accession number"],order_date:r(I["Orde date"]),results:I.Result[0].value_modifier+" "+I.Result[0].value,results_date:r(I.Result[0].date)},A?D.highVL.push(h):I.rejection_reason?(h={handler:P,id:y.alert_id,arv:I.arv_number,accession:I.accession_number,order_date:r(I.order_date),rejection_reason:I.rejection_reason},D.rejectedVL.push(h)):A||D.normalVL.push(h)}}catch(I){console.warn(I)}return{handler:P,message:$,vlMessageObs:D,title:_,id:y.alert_id,date:r(y.date_created)}})}}async function m(p){st.read([p.id]).then(()=>p.read=!0)}function f(p){typeof p.handler=="function"&&(m(p),p.handler())}return{markAsRead:m,openNotification:f,loadNotifications:u,clearNotification:c,sortedNotifications:i,hasUnreadNotifications:a,notificationCount:s,hasNotifications:t,notificationData:ye}}const Hi={class:"vl-alerts-container"},Ui={class:"table-container"},Wi={class:"vl-table"},ji={key:0},zi={key:0},qi=["colspan"],Gi={key:0},Ji=z({__name:"ARTVlAlert",setup(e){const t=O("high_vl"),{notificationData:a,loadNotifications:s,clearNotification:i,openNotification:c}=Xt(),r=E(()=>{var _,$;return a.value.length?((($=(_=a.value[0])==null?void 0:_.vlMessageObs)==null?void 0:$.highVL)||[]).length:0}),u=E(()=>{var _,$;return a.value.length?((($=(_=a.value[0])==null?void 0:_.vlMessageObs)==null?void 0:$.rejectedVL)||[]).length:0}),m=E(()=>{var _,$;return a.value.length?((($=(_=a.value[0])==null?void 0:_.vlMessageObs)==null?void 0:$.normalVL)||[]).length:0}),f=E(()=>{var _;if(!a.value.length)return[];const y=(_=a.value[0])==null?void 0:_.vlMessageObs;if(!y)return[];switch(t.value){case"high_vl":return y.highVL||[];case"rejected":return y.rejectedVL||[];case"normal":return y.normalVL||[];default:return[]}}),p=y=>c(y),D=y=>{y.id&&i(y.id,_=>{console.log("Cleared notification ".concat(_))})},h=()=>{switch(t.value){case"high_vl":return"No high viral load results found";case"rejected":return"No rejected samples found";case"normal":return"No normal results found";default:return"No results found"}};return he(()=>{s()}),(y,_)=>(d(),v("div",Hi,[o(w(mt),{mode:"ios",modelValue:t.value,"onUpdate:modelValue":_[0]||(_[0]=$=>t.value=$),class:"category-segment"},{default:l(()=>[o(w(Ce),{value:"high_vl"},{default:l(()=>[o(w(Ve),null,{default:l(()=>[R("High VL ("+C(r.value)+")",1)]),_:1})]),_:1}),o(w(Ce),{value:"rejected"},{default:l(()=>[o(w(Ve),null,{default:l(()=>[R("Rejected ("+C(u.value)+")",1)]),_:1})]),_:1}),o(w(Ce),{value:"normal"},{default:l(()=>[o(w(Ve),null,{default:l(()=>[R("Normal Results ("+C(m.value)+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",Ui,[n("table",Wi,[n("thead",null,[n("tr",null,[_[1]||(_[1]=n("th",null,"ARV #",-1)),_[2]||(_[2]=n("th",null,"Accession #",-1)),_[3]||(_[3]=n("th",null,"Order Date",-1)),t.value==="rejected"?(d(),v("th",ji,"Rejection Reason")):S("",!0),_[4]||(_[4]=n("th",null,"View",-1)),_[5]||(_[5]=n("th",null,"Clear",-1))])]),n("tbody",null,[f.value.length===0?(d(),v("tr",zi,[n("td",{colspan:t.value==="rejected"?6:5,class:"empty-message"},C(h()),9,qi)])):S("",!0),(d(!0),v(G,null,K(f.value,$=>(d(),v("tr",{key:$.id},[n("td",null,C($.arv||"-"),1),n("td",null,C($.accession||"-"),1),n("td",null,C($.order_date||"-"),1),t.value==="rejected"?(d(),v("td",Gi,C($.rejection_reason||"-"),1)):S("",!0),n("td",null,[o(w(Fe),{fill:"clear",size:"small",onClick:P=>p($)},{default:l(()=>[o(w(Z),{icon:w(Ft),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])]),n("td",null,[o(w(Fe),{fill:"clear",size:"small",onClick:P=>D($),color:"success"},{default:l(()=>[o(w(Z),{icon:w(Fn),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])])]))),128))])])])]))}}),Qi=Y(Ji,[["__scopeId","data-v-7b9c4735"]]),Yi={class:"dashboard-container"},Zi={class:"segment-content"},Ki={key:0},Xi={key:1},er={key:2},tr=z({__name:"ARTHome",setup(e){const t=O("dashboard"),{notificationCount:a,loadNotifications:s}=Xt();return he(()=>{s()}),(i,c)=>(d(),v("div",Yi,[o(w(mt),{modelValue:t.value,"onUpdate:modelValue":c[0]||(c[0]=r=>t.value=r)},{default:l(()=>[o(w(Ce),{value:"dashboard"},{default:l(()=>[...c[1]||(c[1]=[R(" Overview ",-1)])]),_:1}),o(w(Ce),{value:"viralLoadAlerts"},{default:l(()=>[n("div",Zi,[c[2]||(c[2]=R(" VL Alerts ",-1)),w(a)>0?(d(),F(w(Mn),{key:0,color:"primary"},{default:l(()=>[R(C(w(a)),1)]),_:1})):S("",!0)])]),_:1}),o(w(Ce),{value:"internalReferrals"},{default:l(()=>[...c[3]||(c[3]=[R(" Internal referrals ",-1)])]),_:1})]),_:1},8,["modelValue"]),t.value==="dashboard"?(d(),v("div",Ki,[o(xi)])):S("",!0),t.value==="viralLoadAlerts"?(d(),v("div",Xi,[o(Qi)])):S("",!0),t.value==="internalReferrals"?(d(),v("div",er,[o(Qt)])):S("",!0)]))}}),nr=Y(tr,[["__scopeId","data-v-d237cab2"]]);class ar{constructor(){ue(this,"socket",null);ue(this,"channel","ImmunizationReportChannel");ue(this,"isConnected",!1);ue(this,"pendingFetch",null);ue(this,"location_id");ue(this,"initPromise");ue(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});ue(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});ue(this,"onError",t=>{console.error("WebSocket error:",t),this.isConnected=!1});this.initPromise=this.init()}async init(){const t=localStorage.getItem("apiURL"),a=localStorage.getItem("apiPort"),s=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const i="".concat(s,"://").concat(t,"/api/v1/cable");this.socket=new WebSocket(i),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(i){console.error(i),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const t={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(t))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await H.getJson("immunization/stats",{start_date:T.getDateBeforeByDays(T.sessionDate(),365),end_date:T.sessionDate()})}async setMessageHandler(t){await this.initPromise,this.socket?this.socket.onmessage=a=>{t(a)}:console.error("WebSocket connection not established.")}}const or=z({components:{IonContent:le,IonHeader:fe,IonItem:Pe,IonList:Ie,IonMenu:We,IonTitle:Ue,IonToolbar:Se,IonInput:kt,BasicInputField:da,BasicForm:ze,PreviousVitals:la,customDatePicker:Na,IonCol:Ye,IonRow:Ze,VueMultiselect:xn,IonLabel:Ve,DataTable:Me},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:te,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:T.toStandardHisDisplayFormat(H.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...de(Aa,["administerOtherVaccine"]),...de(bt,["tempScannedBatchNumber"]),...de(se,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await Ra(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:Ot,pulseOutline:En,clipboardOutline:dt}},methods:{formatBirthdate(e){return T.getBirthdateAge(e)},async openClientProfile(e){const t=await Te.findByID(e);await se().setPatientRecord(t),this.$router.push("patientProfile")},processData(){var t;return((t=this.data)==null?void 0:t.map(a=>{if(a.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let s=[];const i=c=>c.map(u=>{let m=0;return u.clients.map(f=>{(u.drug_name==this.drug_name&&(this.village==f.table.city_village||this.village=="All")||(u.drug_name==this.drug_name||this.village==f.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:f.table.given_name,family_name:f.table.family_name,patient_id:f.table.patient_id,birthdate:f.table.birthdate,city_village:f.table.city_village}),m++),this.villageList.push(f.table.city_village)}),[u.drug_name,m]}).filter(u=>u[1]!==0);return this.title=="Client due today"&&(s=i(a.value.due_today_antigens)),this.title=="Client due this week"&&(s=i(a.value.due_this_week_antigens)),this.title=="Client due this month"&&(s=i(a.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(s=i(a.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(s=i(a.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(c=>JSON.stringify(c)))].map(c=>JSON.parse(c)),this.villageList=[...new Set(this.villageList)],s}}))[0]},handleVillageClick(e){this.drug_name="",this.village=e,this.tableData=this.processData()},handleRowClick(e){var a;this.tableEvent=e.target;const t=this.tableEvent.closest("tr");if(t){const s=Array.from(((a=t.parentNode)==null?void 0:a.children)||[]).indexOf(t),i=this.tableData[s];this.drug_name=i[0],t.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(e){return T.calculateDisplayAge(e)},openPopover(e){this.event=e,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(e){var a;const t=e.target.value;this.batchNumber=t||((a=this.tempScannedBatchNumber)==null?void 0:a.text)||""},saveBatchWithTodayDate(){let e=H.getSessionDate();this.saveDta(e)},dismiss(){we.dismiss()},saveBatch(){let e;Be.isEmpty(this.vaccineDate)==!0?e=H.getSessionDate():e=this.vaccineDate,this.saveDta(e)},validateVaccineName(){if(Be.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(Be.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(e){this.currentDrugOb=e},isAlphaNumeric(e){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(e)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(e){this.batchNumber=e},saveDta(e){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){me("Enter batch number!");return}if(this.batchNumber==""){me("Enter batch number!");return}const t={batch_number:this.batchNumber,date_administered:e,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},a=bt();a.setAdministeredVaccine(t),Oa(this.patient),this.dismiss(),a.setTempScannedBatchNumber(null)}}}),sr={key:0,class:"spinner-overlay"},ir={class:"header position_content"},rr={style:{"font-size":"1.2em","font-weight":"700"}},lr={class:"dueCardContent"},dr=["onClick"],cr={style:{"margin-right":"15px"}},ur={style:{"align-items":"center",display:"flex"}},pr={style:{"line-height":"1"}},mr={class:"client_name"},hr={class:"name"},fr={class:"demographicsOtherRow"},gr={class:"demographicsText"};function _r(e,t,a,s,i,c){const r=g("ion-spinner"),u=g("ion-icon"),m=g("ion-header"),f=g("ion-card-title"),p=g("ion-card-header"),D=g("DataTable"),h=g("ion-card-content"),y=g("ion-card"),_=g("ion-item"),$=g("ion-list"),P=g("ion-popover"),I=g("ion-content");return d(),v(G,null,[e.isLoading?(d(),v("div",sr,[o(r,{name:"bubbles"}),t[3]||(t[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):S("",!0),o(m,null,{default:l(()=>[n("div",ir,[n("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=A=>e.dismiss())},[o(u,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",rr,C(e.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:t[1]||(t[1]=A=>e.openPopover(A))},[o(u,{slot:"separator",size:"large",icon:e.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),o(I,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:l(()=>[n("div",null,[o(y,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:l(()=>[o(p,null,{default:l(()=>[o(f,{class:"sectionTitle"},{default:l(()=>[...t[4]||(t[4]=[R(" Summary of required doses ",-1)])]),_:1})]),_:1}),o(h,null,{default:l(()=>[n("div",lr,[o(D,{options:e.options,data:e.tableData,class:"display nowrap",width:"100%",onClick:e.handleRowClick},{default:l(()=>[...t[5]||(t[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])]),_:1},8,["options","data","onClick"])])]),_:1})]),_:1}),o(y,{class:"section",style:{"margin-inline":"0px"}},{default:l(()=>[o(p,null,{default:l(()=>[o(f,{class:"sectionTitle"},{default:l(()=>[...t[6]||(t[6]=[R("Client Details ",-1)])]),_:1})]),_:1}),o(h,null,{default:l(()=>[(d(!0),v(G,null,K(e.clientDetails,(A,N)=>(d(),v("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:N,onClick:B=>e.openClientProfile(A.patient_id)},[n("div",cr,[n("div",{class:re((A==null?void 0:A.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[o(u,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:e.person},null,8,["icon"])],2)]),n("div",ur,[n("div",pr,[n("div",mr,[n("div",hr,C(A.given_name)+" "+C(A.family_name),1)]),n("div",fr,[n("div",gr,[R(C(A.gender=="M"?"Male":"Female")+" ",1),t[7]||(t[7]=n("span",{class:"dot"},".",-1)),R(C(e.formatBirthdate(A.birthdate)),1)])]),n("div",null,"Village: "+C(A.city_village),1)])])],8,dr))),128))]),_:1})]),_:1})]),o(P,{style:{"--offset-x":"-10px"},"is-open":e.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:e.event,onDidDismiss:t[2]||(t[2]=A=>e.popoverOpen=!1)},{default:l(()=>[n("div",null,[t[8]||(t[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(d(!0),v(G,null,K(e.villageList,(A,N)=>(d(),F($,{class:re(A==e.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:N},{default:l(()=>[o(_,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:B=>e.handleVillageClick(A)},{default:l(()=>[R(C(A),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const vr=Y(or,[["render",_r],["__scopeId","data-v-dfc02771"]]),yr=z({name:"Menu",mixins:[et],components:{IonContent:le,IonHeader:fe,IonItem:Pe,IonList:Ie,IonMenu:We,IonTitle:Ue,IonToolbar:Se,IonCheckbox:Ke,BasicForm:ze,BasicCard:Xe,Carousel:jn,Slide:Wn,Pagination:Un,Navigation:Hn},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},setup(){return{personCircleOutline:It}},computed:{...de(je,["substance"]),backgroundStyle(){return{background:"linear-gradient(135deg, rgba(32, 178, 170, 0.95) 0%, rgba(64, 192, 176, 0.9) 50%, rgba(150, 220, 200, 0.85) 100%), url(".concat(La("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",minHeight:"240px"}}},watch:{},async mounted(){new ar().setMessageHandler(this.onMessage)},methods:{async onMessage(e){var a,s,i;const t=JSON.parse(e.data);t.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=t.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((a=this.reportData)==null?void 0:a.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((s=this.reportData)==null?void 0:s.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((i=this.reportData)==null?void 0:i.total_male_vaccinated_this_year)||0}])},openDueModal(e){const t={title:e,dashBoardData:this.reportData};Ne(vr,{class:"fullScreenModal"},!0,t)},async openClientProfile(e){const t=await Te.findByNpid(e);await se().setPatientRecord(t[0]),this.$router.push("patientProfile")}}}),br={class:"topStats"},Dr={class:"hero-section"},$r={class:"totalStats"},Cr={class:"statsValue"},wr={class:"statsText"},kr={class:"dueCardContent"},Sr={class:"statsValue"},Ir={class:"statsValue"},Pr={class:"statsValue"},Tr={class:"overDueCardContent"},Ar={class:"statsValue"},Nr={class:"statsValue"},Or={class:"appointment-count"},Rr={key:0,class:"appointments-list"},Lr=["onClick"],Vr={class:"avatar-container"},Br={class:"appointment-details"},Fr={class:"client-name"},Mr={class:"client-info"},xr={class:"info-badge"},Er={class:"client-location"},Hr={key:1,class:"empty-state"};function Ur(e,t,a,s,i,c){const r=g("Slide"),u=g("Pagination"),m=g("Carousel"),f=g("ion-card-title"),p=g("ion-card-header"),D=g("ion-card-content"),h=g("ion-card"),y=g("ion-icon"),_=g("ion-content");return d(),F(_,{class:"content"},{default:l(()=>[n("div",br,[n("div",Dr,[n("div",{style:Ge(e.backgroundStyle)},[o(m,{autoplay:4e3,"wrap-around":!0,itemsToShow:1,transition:600,class:"stats-carousel"},{addons:l(()=>[o(u)]),default:l(()=>[(d(!0),v(G,null,K(e.totalStats,$=>(d(),F(r,{key:$},{default:l(()=>[n("div",$r,[t[5]||(t[5]=n("div",{class:"stats-icon"},"ðŸ“Š",-1)),n("div",Cr,C($.value),1),n("div",wr,C($.name),1)])]),_:2},1024))),128))]),_:1})],4)]),o(h,{class:"section modern-card"},{default:l(()=>[o(p,null,{default:l(()=>[o(f,{class:"cardTitle"},{default:l(()=>[...t[6]||(t[6]=[n("span",{class:"title-icon"},"ðŸ“…",-1),R(" Clients Due ",-1)])]),_:1})]),_:1}),o(D,null,{default:l(()=>{var $,P,I;return[n("div",kr,[n("div",{class:"dueCard today-card",onClick:t[0]||(t[0]=A=>e.openDueModal("Client due today"))},[t[7]||(t[7]=n("div",{class:"card-badge success"},"Today",-1)),n("div",Sr,C((($=e.reportData)==null?void 0:$.due_today_count)||0),1),t[8]||(t[8]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard week-card",onClick:t[1]||(t[1]=A=>e.openDueModal("Client due this week"))},[t[9]||(t[9]=n("div",{class:"card-badge warning"},"Week",-1)),n("div",Ir,C(((P=e.reportData)==null?void 0:P.due_this_week_count)||0),1),t[10]||(t[10]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard month-card",onClick:t[2]||(t[2]=A=>e.openDueModal("Client due this month"))},[t[11]||(t[11]=n("div",{class:"card-badge danger"},"Month",-1)),n("div",Pr,C(((I=e.reportData)==null?void 0:I.due_this_month_count)||0),1),t[12]||(t[12]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),o(h,{class:"section modern-card"},{default:l(()=>[o(p,null,{default:l(()=>[o(f,{class:"cardTitle"},{default:l(()=>[...t[13]||(t[13]=[n("span",{class:"title-icon"},"âš ï¸",-1),R(" Clients Overdue ",-1)])]),_:1})]),_:1}),o(D,null,{default:l(()=>{var $,P;return[n("div",Tr,[n("div",{class:"overDueCard",onClick:t[3]||(t[3]=I=>e.openDueModal("Client overdue under 5yrs"))},[t[14]||(t[14]=n("div",{class:"overdue-icon"},"ðŸ‘¶",-1)),n("div",Ar,C((($=e.reportData)==null?void 0:$.under_five_overdue)||0),1),t[15]||(t[15]=n("div",{class:"statsText"},"Under 5 years",-1))]),n("div",{class:"overDueCard",onClick:t[4]||(t[4]=I=>e.openDueModal("Client overdue over 5yrs"))},[t[16]||(t[16]=n("div",{class:"overdue-icon"},"ðŸ§’",-1)),n("div",Nr,C(((P=e.reportData)==null?void 0:P.over_five_overdue)||0),1),t[17]||(t[17]=n("div",{class:"statsText"},"Over 5 years",-1))])])]}),_:1})]),_:1}),o(h,{class:"section modern-card appointments-card"},{default:l(()=>[o(p,null,{default:l(()=>[o(f,{class:"cardTitle"},{default:l(()=>{var $;return[t[18]||(t[18]=n("span",{class:"title-icon"},"ðŸ—“ï¸",-1)),t[19]||(t[19]=R(" Today's Appointments ",-1)),n("span",Or,C((($=e.appointments)==null?void 0:$.length)||0),1)]}),_:1})]),_:1}),o(D,null,{default:l(()=>{var $;return[(($=e.appointments)==null?void 0:$.length)>0?(d(),v("div",Rr,[(d(!0),v(G,null,K(e.appointments,(P,I)=>(d(),v("div",{class:"appointment-item",key:I,onClick:A=>e.openClientProfile(P.npid)},[n("div",Vr,[n("div",{class:re(P.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[o(y,{class:"person-icon",icon:e.personCircleOutline},null,8,["icon"])],2)]),n("div",Br,[n("div",Fr,C(P.given_name)+" "+C(P.family_name),1),n("div",Mr,[n("span",xr,C(P.gender=="M"?"Male":"Female"),1),t[20]||(t[20]=n("span",{class:"dot"},"â€¢",-1)),n("span",null,C(e.formatBirthdate(P.birthdate)),1)]),n("div",Er,[t[21]||(t[21]=n("span",{class:"location-icon"},"ðŸ“",-1)),R(" "+C(P==null?void 0:P.city_village),1)])]),t[22]||(t[22]=n("div",{class:"appointment-arrow"},"â€º",-1))],8,Lr))),128))])):(d(),v("div",Hr,[...t[23]||(t[23]=[n("div",{class:"empty-icon"},"ðŸ“‹",-1),n("p",null,"No appointments scheduled for today",-1)])]))]}),_:1})]),_:1})])]),_:1})}const Wr=Y(yr,[["render",Ur],["__scopeId","data-v-c322c517"]]),jr=z({components:{DataTable:Me},props:{title:{type:String,default:""},list:{type:String,default:""},buttonTitle:{type:String,default:""},buttonLink:{type:String,default:""}},data(){return{patients:[],loadingStates:{},tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:(e,t)=>{if(!e)return"-";const a=new Date(e).getTime(),s=Date.now()-a,i=Math.floor(s/6e4),c=(()=>{if(i<1)return"Just now";if(i<60)return"".concat(i," min").concat(i>1?"s":""," ago");const r=Math.floor(i/60);if(r<24)return"".concat(r," hour").concat(r>1?"s":""," ago");const u=Math.floor(r/24);return"".concat(u," day").concat(u>1?"s":""," ago")})();return t==="display"?c:s},type:"num",width:"15%"},{title:"Actions",data:null,render:(e,t,a)=>{const s=document.createElement("div");s.style.display="flex",s.style.gap="6px",s.setAttribute("data-patient-id",a.identifier);const i="  --padding-top: 4px;\n                                            --padding-bottom: 4px;\n                                            --padding-start: 8px;\n                                            --padding-end: 8px;\n                                            font-size: 0.8rem;\n                                            height: 28px;\n                                            min-width: 70px;\n                                            white-space: nowrap;\n                                            ",c=(r,u,m,f)=>{const p=document.createElement("ion-button");p.setAttribute("data-button-type",f),p.size="small",p.fill="solid",p.color=u,p.style.cssText=i;const D=document.createElement("span");D.className="button-text",D.innerText=r;const h=document.createElement("ion-spinner");return h.name="crescent",h.className="button-spinner",h.style.display="none",h.style.width="16px",h.style.height="16px",p.appendChild(D),p.appendChild(h),p.addEventListener("click",m),p};return s.appendChild(c(this.buttonTitle,"primary",()=>this.navigateTo(a,this.buttonLink),"primary")),s.appendChild(c("Profile","warning",()=>this.navigateTo(a,"/patientProfile"),"profile")),s.appendChild(c("Abscond","danger",()=>this.handleAbscond(a.identifier),"abscond")),s},orderable:!1,width:"25%"}],tableOptions:{order:[[1,"desc"]]}}},computed:{...de(rt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{patientsWaitingForConsultation:{handler(e){this.list==="CONSULTATION"&&(this.patients=e)},deep:!0},patientsWaitingForVitals:{handler(e){this.list==="VITALS"&&(this.patients=e)},deep:!0},patientsWaitingForLab:{handler(e){this.list==="LAB"&&(this.patients=e)},deep:!0},patientsWaitingForDispensation:{handler(e){this.list==="DISPENSATION"&&(this.patients=e)},deep:!0}},mounted(){this.setList()},methods:{setList(){const e={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation},t=this.list;this.patients=e[t]||[]},setButtonLoading(e,t,a){const s=document.querySelector('[data-patient-id="'.concat(e,'"]'));if(!s)return;const i=s.querySelector('[data-button-type="'.concat(t,'"]'));if(!i)return;const c=i.querySelector(".button-text"),r=i.querySelector(".button-spinner");a?(i.setAttribute("disabled","true"),c&&(c.style.display="none"),r&&(r.style.display="inline-block")):(i.removeAttribute("disabled"),c&&(c.style.display="inline"),r&&(r.style.display="none"))},waitingTime(e){if(!e)return"-";const t=Date.now()-new Date(e).getTime(),a=Math.floor(t/6e4);if(a<1)return"Just now";if(a<60)return"".concat(a," min").concat(a>1?"s":""," ago");const s=Math.floor(a/60);if(s<24)return"".concat(s," hour").concat(s>1?"s":""," ago");const i=Math.floor(s/24);return"".concat(i," day").concat(i>1?"s":""," ago")},async navigateTo(e,t){const a=t===this.buttonLink?"primary":"profile";this.setButtonLoading(e.identifier,a,!0);try{let s=[],i=null;H.getPouchDbStatus()||H.getLanConnectionStatus()?(s=await Oe("patients_records",{selector:{ID:e.identifier}}),i=s[0]):i||(i=await H.getJson("/patients/".concat(e.patient_id,"/get_patient_record")));const c=i;if(await se().setPatientRecord(c),await Ee(),zt()){this.$router.push("/deathPatientProfile");return}this.$router.push(t)}catch(s){console.error("Error navigating:",s)}finally{this.setButtonLoading(e.identifier,a,!1)}},async handleAbscond(e){this.setButtonLoading(e,"abscond",!0);try{await ca({ID:e})}catch(t){console.error("Error closing visit:",t)}finally{this.setButtonLoading(e,"abscond",!1)}},dismiss(){we.dismiss()}}}),zr={class:"modal-container"},qr={class:"dueCardContent"};function Gr(e,t,a,s,i,c){const r=g("ion-button"),u=g("ion-card-title"),m=g("ion-card-header"),f=g("DataTable"),p=g("ion-card-content"),D=g("ion-card");return d(),v("div",zr,[o(r,{class:"close-button",fill:"clear",size:"large",onClick:e.dismiss},{default:l(()=>[...t[0]||(t[0]=[R(" Close ",-1)])]),_:1},8,["onClick"]),o(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:l(()=>[o(m,null,{default:l(()=>[o(u,{class:"sectionTitle"},{default:l(()=>[R(C(e.title),1)]),_:1})]),_:1}),o(p,null,{default:l(()=>[n("div",qr,[o(f,{data:e.patients,options:e.tableOptions,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const Jr=Y(jr,[["render",Gr],["__scopeId","data-v-ab268e6c"]]),Qr=z({components:{IonContent:le,IonHeader:fe,IonItem:Pe,IonList:Ie,IonIcon:Z,IonCard:He,IonCardHeader:ut,IonCardTitle:ct,IonCardContent:Qe,IonPopover:Mt,DataTable:Me},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:te,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:e=>this.waitingTime(e),width:"20%"},{title:"Actions",data:null,render:(e,t,a)=>{const s=document.createElement("div");s.style.display="flex",s.style.gap="6px",s.setAttribute("data-patient-id",a.identifier);const i="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",c=(r,u,m,f)=>{const p=document.createElement("ion-button");p.setAttribute("data-button-type",f),p.size="small",p.fill="solid",p.color=u,p.style.cssText=i;const D=document.createElement("span");D.className="button-text",D.innerText=r;const h=document.createElement("ion-spinner");return h.name="crescent",h.className="button-spinner",h.style.display="none",h.style.width="16px",h.style.height="16px",p.appendChild(D),p.appendChild(h),p.addEventListener("click",m),p};return s.appendChild(c("Profile","warning",()=>this.navigateTo(e,"/patientProfile"),"profile")),s},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[1,"desc"],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const e=await ua();this.patients=e.map(t=>({fullName:t.fullName||"",arrivalTime:t.startDate||"",patient_id:t.patientId||"",identifier:t.identifier||""}))},methods:{setButtonLoading(e,t,a){const s=document.querySelector('[data-patient-id="'.concat(e,'"]'));if(!s)return;const i=s.querySelector('[data-button-type="'.concat(t,'"]'));if(!i)return;const c=i.querySelector(".button-text"),r=i.querySelector(".button-spinner");a?(i.setAttribute("disabled","true"),c&&(c.style.display="none"),r&&(r.style.display="inline-block")):(i.removeAttribute("disabled"),c&&(c.style.display="inline"),r&&(r.style.display="none"))},openPopover(e){this.event=e,this.popoverOpen=!0},dismiss(){we.dismiss()},waitingTime(e){if(!e)return"-";const t=Date.now()-new Date(e).getTime(),a=Math.floor(t/6e4);if(a<1)return"Just now";if(a<60)return"".concat(a," min").concat(a>1?"s":""," ago");const s=Math.floor(a/60);if(s<24)return"".concat(s," hour").concat(s>1?"s":""," ago");const i=Math.floor(s/24);return"".concat(i," day").concat(i>1?"s":""," ago")},async navigateTo(e,t){this.setButtonLoading(e.identifier,"profile",!0);try{let a;(H.getPouchDbStatus()||H.getLanConnectionStatus())&&(a=await Oe("patients_records",{selector:{ID:e.identifier}}),a=a[0]),a||(a=await Te.findByID(e.patient_id)),a?(await se().setPatientRecord(a),await Ee(),zt()?this.$router.push("/deathPatientProfile"):this.$router.push(t)):(me("Patient not found. Please try searching the patient by name."),this.setButtonLoading(e.identifier,"profile",!1))}catch(a){console.error("Error navigating to profile:",a),this.setButtonLoading(e.identifier,"profile",!1)}}}}),Yr={class:"modal-container"},Zr={class:"dueCardContent"};function Kr(e,t,a,s,i,c){const r=g("ion-button"),u=g("ion-card-title"),m=g("ion-card-header"),f=g("DataTable"),p=g("ion-card-content"),D=g("ion-card");return d(),v("div",Yr,[o(r,{class:"close-button",fill:"clear",size:"large",onClick:e.dismiss},{default:l(()=>[...t[0]||(t[0]=[R(" Close ",-1)])]),_:1},8,["onClick"]),o(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:l(()=>[o(m,null,{default:l(()=>[o(u,{class:"sectionTitle"},{default:l(()=>[R(C(e.title),1)]),_:1})]),_:1}),o(p,null,{default:l(()=>[n("div",Zr,[o(f,{data:e.patients,options:e.tableOptions,columns:e.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const Xr=Y(Qr,[["render",Kr],["__scopeId","data-v-5866989b"]]),el=z({name:"OPDAppointmentsModal",components:{IonPage:Re,IonHeader:fe,IonContent:le,IonItem:Pe,IonList:Ie,IonIcon:Z,IonCard:He,IonCardContent:Qe,IonPopover:Mt,DataTable:Me,IonSegment:mt,IonSegmentButton:Ce,IonLabel:Ve,IonRow:Ze,IonCol:Ye,DateInputField:ft},props:{title:{type:String,default:"OPD Appointments"},programType:{type:String,required:!0},programId:{type:Number,required:!0}},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:te,appointments:[],viewMode:"today",startDate:T.sessionDate(),endDate:T.sessionDate(),calendarOutline:Le,openOutline:Vt,tableColumns:[{title:"Patient ID",data:"ID"},{title:"Name",data:"name"},{title:"Age/DOB",data:"ageDob"},{title:"Gender",data:"gender"},{title:"Village",data:"village"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(e,t,a)=>{const s=document.createElement("div"),i=document.createElement("ion-button");return i.innerText="Profile",i.size="small",i.style.color="#fff",i.style.padding="8px 12px",i.style.marginRight="8px",i.addEventListener("click",()=>this.openClientProfile(a.ID)),s.appendChild(i),s},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,order:[[5,"asc"]]}}},async mounted(){await this.loadAppointments()},methods:{async loadAppointments(){this.isLoading=!0;try{const e=T.sessionDate(),t=this.viewMode==="today"?e:this.startDate,a=this.viewMode==="today"?e:this.endDate,s=localStorage.getItem("locationID"),i=typeof t=="string"?t:T.toStandardHisFormat(t),c=typeof a=="string"?a:T.toStandardHisFormat(a),u=(await Oe("patients_records")).flatMap(m=>{var p,D;return[...((p=m.appointments)==null?void 0:p.saved)||[],...((D=m.appointments)==null?void 0:D.unsaved)||[]].filter(h=>{if(!(h!=null&&h.value_datetime)||h.location_id&&h.location_id!==s)return!1;const y=T.toStandardHisFormat(h.value_datetime);return y>=i&&y<=c}).map(h=>{var y,_,$,P,I;return{ID:m.ID,name:[(y=m.personInformation)==null?void 0:y.given_name,(_=m.personInformation)==null?void 0:_.family_name].filter(Boolean).join(" ")||"Unknown",ageDob:($=m.personInformation)!=null&&$.birthdate?T.getBirthdateAge(m.personInformation.birthdate):"N/A",gender:((P=m.personInformation)==null?void 0:P.gender)||"Unknown",village:((I=m.personInformation)==null?void 0:I.home_village)||"Unknown",appointmentDate:T.toStandardHisDisplayFormat(h.value_datetime),appointmentDateTime:h.value_datetime,rawData:h}})}).sort((m,f)=>new Date(m.appointmentDateTime).getTime()-new Date(f.appointmentDateTime).getTime());this.appointments=u,console.log("Found ".concat(u.length," appointments"))}catch(e){console.error("Error loading appointments:",e),Dt("Failed to load appointments")}finally{this.isLoading=!1}},async getAppointmentsD1(e){this.startDate=T.toStandardHisFormat(e),await this.loadAppointments()},async getAppointmentsD2(e){this.endDate=T.toStandardHisFormat(e),await this.loadAppointments()},onViewModeChange(){this.viewMode==="today"&&(this.startDate=T.sessionDate(),this.endDate=T.sessionDate()),this.loadAppointments()},async openClientProfile(e){try{const t=await Oe("patients_records",{selector:{ID:e}});await se().setPatientRecord(t[0]),this.$router.push("patientProfile")}catch(t){console.error("Error opening profile:",t),Dt("Failed to open patient profile")}},openPopover(e){this.event=e,this.popoverOpen=!0},dismiss(){we.dismiss()}}}),tl={class:"header position_content"},nl={style:{"font-size":"1.2em","font-weight":"700"}},al={key:0,class:"date-filter"},ol={class:"dueCardContent"},sl={key:1,class:"no-appointments"};function il(e,t,a,s,i,c){const r=g("ion-icon"),u=g("ion-header"),m=g("ion-label"),f=g("ion-segment-button"),p=g("ion-segment"),D=g("DateInputField"),h=g("ion-col"),y=g("ion-row"),_=g("DataTable"),$=g("ion-card-content"),P=g("ion-card"),I=g("ion-content"),A=g("ion-page");return d(),F(A,null,{default:l(()=>[o(u,null,{default:l(()=>[n("div",tl,[n("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=(...N)=>e.dismiss&&e.dismiss(...N))},[o(r,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",nl,C(e.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:t[1]||(t[1]=N=>e.openPopover(N))},[o(r,{slot:"separator",size:"large",icon:e.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),o(I,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:l(()=>[o(p,{modelValue:e.viewMode,"onUpdate:modelValue":t[2]||(t[2]=N=>e.viewMode=N),onIonChange:e.onViewModeChange},{default:l(()=>[o(f,{value:"today"},{default:l(()=>[o(m,null,{default:l(()=>[...t[3]||(t[3]=[R("Today's Appointments",-1)])]),_:1})]),_:1}),o(f,{value:"range"},{default:l(()=>[o(m,null,{default:l(()=>[...t[4]||(t[4]=[R("Date Range",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","onIonChange"]),e.viewMode==="range"?(d(),v("div",al,[o(y,null,{default:l(()=>[o(h,null,{default:l(()=>[o(D,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:e.endDate,disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1},null,8,["icon","inputValue","maxDate","onUpdate:rawDateValue"])]),_:1}),o(h,null,{default:l(()=>[o(D,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):S("",!0),o(P,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:l(()=>[o($,null,{default:l(()=>[n("div",ol,[e.appointments.length>0?(d(),F(_,{key:0,data:e.appointments,columns:e.tableColumns,options:e.tableOptions,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns","options"])):(d(),v("div",sl," No appointments found for the selected "+C(e.viewMode==="today"?"day":"date range"),1))])]),_:1})]),_:1})]),_:1})]),_:1})}const rl=Y(el,[["render",il],["__scopeId","data-v-e54f2168"]]),ll={class:"card-count"},dl={class:"card-label"},cl="#ffffff",ul=z({__name:"DashboardCard",props:{icon:{},count:{},label:{},color:{}},emits:["cardClick"],setup(e,{emit:t}){const i={success:"#A5D6A7",info:"#81D4FA",warning:"#FFF59D",danger:"#EF9A9A"}[e.color||"info"]||"#E0E0E0";return(c,r)=>(d(),F(w(He),{class:"dashboard-card",style:Ge({borderColor:w(i),backgroundColor:cl}),onClick:r[0]||(r[0]=u=>c.$emit("cardClick"))},{default:l(()=>[o(w(Z),{icon:e.icon,class:"card-icon"},null,8,["icon"]),n("div",ll,C(e.count),1),n("div",dl,C(e.label),1)]),_:1},8,["style"]))}}),pl=Y(ul,[["__scopeId","data-v-84ad3c1b"]]),ml=()=>({deathOutcomeForm:E(()=>[{componentType:"Heading",name:"Death Details",position:"center",grid:{s:"12"}},{componentType:"inputField",header:"Place of death",name:"Place of death",icon:te.editPen,grid:{s:"12"},validation:t=>!t||t===""?"Place of death is required":null},{componentType:"dateInputField",header:"Date of death",name:"Date of death",icon:te.calenderPrimary,showTodayButton:!0,grid:{s:"12"},validation:t=>!t||t===""?"Date of death is required":null},{componentType:"timeInputField",header:"Time of death",name:"Time Of Death",showNowButton:!0,icon:te.calenderPrimary,grid:{s:"12"},validation:t=>!t||t===""?"Time of death is required":null},{componentType:"inputField",header:"Name of guardian",name:"Guardian; name and first names",icon:te.editPen,grid:{s:"12"},validation:t=>!t||t===""?"Guardian name is required":null},{componentType:"phoneInputField",header:"Guardian phone number",name:"Phone number",grid:{s:"12"},validation:t=>pa.isMWPhoneNumber(t.phoneNumber)},{componentType:"checkboxField",name:"Pregnant woman",type:"single",label:"Was the individual pregnant at the time of death?",grid:{s:"12"},condition:t=>t._isChildBearing===!0},{componentType:"dateInputField",header:"Date arrived",name:"Death on arrival",showTodayButton:!0,icon:te.calenderPrimary,grid:{s:"12"},validation:t=>!t||t===""?"Date arrived is required":null},{componentType:"timeInputField",header:"Time arrived",name:"Time to clinic",icon:te.calenderPrimary,grid:{s:"12"},showNowButton:!0,validation:t=>!t||t===""?"Time arrived is required":null},{componentType:"multiSelectInputField",header:"Cause of death",name:"Cause of death",trackBy:"id",isMultiple:!1,grid:{s:"12"},options:[{id:1,name:"Natural"},{id:2,name:"Accident"},{id:3,name:"Homicide"},{id:4,name:"Suicide"},{id:5,name:"Pending investigation"},{id:6,name:"Could not be determined"},{id:7,name:"Other - specify"}],validation:t=>t?null:"Cause of death is required",onChange:t=>{const a={},s=typeof t=="object"&&t!==null?t.name:t;return s!=="Other - specify"&&(a["Other notes"]=""),s!=="Accident"&&(a["Road traffic accident"]=""),a}},{componentType:"inputField",header:"Specify other manner of death",name:"Other notes",icon:te.editPen,grid:{s:"12"},validation:(t,a)=>{const s=a==null?void 0:a["Cause of death"];return(typeof s=="object"&&s!==null?s.name:s)==="Other - specify"&&(!t||t==="")?"Please specify other manner of death":null},condition:t=>{const a=t==null?void 0:t["Cause of death"];return(typeof a=="object"&&a!==null?a.name:a)==="Other - specify"}},{componentType:"multiSelectInputField",header:"How did the accident occur?",name:"Road traffic accident",trackBy:"id",isMultiple:!1,grid:{s:"12"},options:[{id:1,name:"Motor vehicle (passenger)"},{id:2,name:"Motor vehicle (pedestrian)"},{id:3,name:"Drowning"},{id:4,name:"Other - specify"}],validation:(t,a)=>{const s=a==null?void 0:a["Cause of death"];return(typeof s=="object"&&s!==null?s.name:s)==="Accident"&&!t?"Please specify how the accident occurred":null},condition:t=>{const a=t==null?void 0:t["Cause of death"];return(typeof a=="object"&&a!==null?a.name:a)==="Accident"},onChange:t=>{const a={};return(typeof t=="object"&&t!==null?t.name:t)!=="Other - specify"&&(a["Other notes"]=""),a}},{componentType:"inputField",header:"Specify other cause of death",name:"Other notes",icon:te.editPen,grid:{s:"12"},validation:(t,a)=>{const s=a==null?void 0:a["Road traffic accident"];return(typeof s=="object"&&s!==null?s.name:s)==="Other - specify"&&(!t||t==="")?"Please specify other cause of death":null},condition:t=>{const a=t==null?void 0:t["Road traffic accident"];return(typeof a=="object"&&a!==null?a.name:a)==="Other - specify"}},{componentType:"Heading",name:"Death Confirmation",position:"center",grid:{s:"12"}},{componentType:"dateInputField",header:"Date confirming death",name:"Date of confinement",icon:te.calenderPrimary,showTodayButton:!0,grid:{s:"12"},validation:t=>!t||t===""?"Date confirming death is required":null},{componentType:"timeInputField",header:"Time confirming death",name:"Confirmed",icon:te.calenderPrimary,showNowButton:!0,grid:{s:"12"},validation:t=>!t||t===""?"Time confirming death is required":null},{componentType:"inputField",header:"Person confirming death",name:"Responsible person present",icon:te.editPen,grid:{s:"12"},validation:t=>!t||t===""?"Person confirming death is required":null},{componentType:"inputField",header:"Position",name:"Position",icon:te.editPen,grid:{s:"12"},validation:t=>!t||t===""?"Position is required":null},{componentType:"inputField",header:"Medical council registration number",name:"Register Number",icon:te.editPen,grid:{s:"12"}}])}),hl=z({__name:"BroughtDead",setup(e,{expose:t}){const{deathOutcomeForm:a}=ml(),{formRef:s,exposeFormMethods:i}=ma(),c=()=>{if(s.value){const u=new Te().isChildBearing();s.value.setFormValue("_isChildBearing",u)}};return he(()=>{c()}),ce(()=>{var r;return(r=s.value)==null?void 0:r.formValues},()=>{c()},{deep:!0}),t(i()),(r,u)=>(d(),F(ha,{formData:w(a),ref_key:"formRef",ref:s},null,8,["formData"]))}}),fl={key:0,class:"spinner-overlay"},gl={class:"header-title"},_l={class:"masonry-grid"},vl={class:"card-container"},yl={class:"custom-card"},bl={class:"card-container"},Dl={key:0,class:"custom-card"},$l={key:1,class:"custom-card"},Cl={class:"custom-card card-margin-top"},wl={key:0,class:"card-container"},kl={class:"custom-card"},Sl={class:"custom-card card-margin-top"},Il={class:"card-container"},Pl={class:"custom-card"},Tl={key:0,class:"custom-card card-margin-top"},Al={class:"footer-content"},Nl={class:"footer-buttons-left"},Ol={key:0,class:"pagination-dots"},Rl=["onClick","aria-label"],Ll={class:"footer-buttons-right"},Vl=z({__name:"BroughtInDeadRegistration",props:{editMode:{type:Boolean,default:!1}},setup(e){const t=O(!1),a=ke(),s=xe(),i=za(),c=se(),{patient:r}=qe(c),u=O(null),m=O(null),f=O(null),p=O(null),D=O(null),h=O(null),y=O(null),_=O(!1),$=O(null),P=O({personalInformationRef:u,birthRegistrationRef:m,socialHistoryRef:f,countryRef:p,currentLocationRef:D,homeLocationRef:h,patientTypeRef:y,deathOutcomeRef:$}),I=E(()=>{var L;return((L=u.value)==null?void 0:L.currentFormValues)||{}}),A=E(()=>{var L;return((L=m.value)==null?void 0:L.currentFormValues)||{}}),N=E(()=>{var L;return((L=f.value)==null?void 0:L.currentFormValues)||{}}),B=E(()=>{var L;return((L=p.value)==null?void 0:L.currentFormValues)||{}}),J=E(()=>{var L;return((L=D.value)==null?void 0:L.currentFormValues)||{}}),U=E(()=>{var L;return((L=h.value)==null?void 0:L.currentFormValues)||{}}),_e=E(()=>{var L;return((L=y.value)==null?void 0:L.currentFormValues)||{}}),De=E(()=>{var L;return((L=$.value)==null?void 0:L.currentFormValues)||{}}),k=E(()=>({personalInformation:I.value,birthRegistration:A.value,socialHistory:N.value,country:B.value,currentLocation:J.value,homeLocation:U.value,patientType:_e.value,deathOutcome:De.value})),b=()=>{const L=Object.values(P.value);return L.forEach(x=>x==null?void 0:x.validateForm()),L.every(x=>(x==null?void 0:x.validateForm())==null)},Q=()=>{Object.values(P.value).forEach(L=>L==null?void 0:L.resetForm())},q=E(()=>new at().checkIfChild(I.value)),{nextPage:W,prevPage:j,goToPage:V,isCardVisible:X,showPreviousButton:M,showPaginationButtons:ie,totalPages:ve,currentPage:gt,showNextButton:tn}=Ba(),{setFormValues:_t}=Fa(),nn=async()=>{try{if(_.value=!0,!b()){me("Please fill in all required fields");return}if(await new at().saveRegistrationData(k.value)){const x=De.value;x&&Object.keys(x).length>0&&await an(x),r.value&&await fa(r.value),Q(),ln("/deathPatientProfile")}}catch(L){console.error(L),me("Failed to save registration data")}finally{_.value=!1}},an=async L=>{try{const x=[],ne=T.sessionDate();for(const[oe,ee]of Object.entries(L))if(!(!ee||ee===!1||ee===""||oe.startsWith("_")))if(typeof ee=="object"&&ee!==null&&!Array.isArray(ee)){const ae=ee.name||ee.id||String(ee);ae&&ae!==""&&x.push(await Ae.buildValueText(oe,String(ae)))}else if(oe==="Phone number"&&typeof ee=="object"){const ae=ee.phoneNumber||String(ee);ae&&ae!==""&&x.push(await Ae.buildValueText(oe,String(ae)))}else if(Array.isArray(ee))for(const ae of ee){const tt=typeof ae=="object"&&ae!==null?ae.value||ae.name:ae;tt&&tt!==""&&x.push(await Ae.buildValueText(oe,String(tt)))}else typeof ee=="string"||typeof ee=="number"?x.push(await Ae.buildValueText(oe,String(ee))):typeof ee=="boolean"&&ee===!0&&x.push(await Ae.buildValueText(oe,"Yes"));if(x.length>0){const oe=[{concept_id:11520,value_coded:11520,child:x,obs_datetime:ne}];await Ae.addObsToEncounterPatient(oe,ht.PATIENT_OUTCOME),console.log("Death outcome saved successfully")}}catch(x){throw console.error("Error saving death outcome:",x),x}},on=async()=>{try{if(_.value=!0,!b()){me("Please fill in all required fields");return}await new at().updateDemographics(k.value)&&we.dismiss()}catch(L){console.error(L)}finally{_.value=!1}},sn=async()=>{if(await ga("Do you want to cancel registration?")){const x=s.query.context,ne=s.query.returnTo;if(Q(),x==="neonatal-mother"&&ne==="/neonatal/enrollment"){i.clearEnrollmentContext(),setTimeout(()=>{a.replace({path:ne})},50);return}we.dismiss()}},rn=async()=>{await _a("Do you want to cancel editing of demographics?","",{confirmBtnLabel:"Yes",icon:"",showBackdrop:!0})&&we.dismiss()},ln=L=>{a.push({path:L})};return ce(s,async L=>{L.query.context!=="neonatal-mother"&&_t(P)},{deep:!0}),he(async()=>{s.query.context!=="neonatal-mother"&&_t(P)}),(L,x)=>(d(),F(w(Re),{class:re({loading:t.value})},{default:l(()=>[t.value?(d(),v("div",fl,[o(w(xt),{name:"bubbles"}),x[4]||(x[4]=n("div",{class:"loading-text"},"Please wait...",-1))])):S("",!0),o(w(fe),null,{default:l(()=>[n("div",gl,C(e.editMode?"Edit Patient Demographic":"Register Brought In Dead"),1)]),_:1}),o(w(le),null,{default:l(()=>{var ne,oe,ee,ae;return[n("div",_l,[be(n("div",vl,[n("div",yl,[o(Ma,{ref_key:"personalInformationRef",ref:u},null,512)])],512),[[$e,w(X)(0)]]),be(n("div",bl,[q.value.underNineMonths&&!e.editMode?(d(),v("div",Dl,[q.value.underNineMonths?(d(),F(xa,{key:0,ref_key:"birthRegistrationRef",ref:m},null,512)):S("",!0)])):S("",!0),q.value.moreThanThirteenYears?(d(),v("div",$l,[o(Ea,{ref_key:"socialHistoryRef",ref:f},null,512)])):S("",!0),n("div",Cl,[o(Ha,{ref_key:"countryRef",ref:p},null,512)])],512),[[$e,w(X)(1)]]),!((oe=(ne=B.value)==null?void 0:ne.country)!=null&&oe.name)||((ae=(ee=B.value)==null?void 0:ee.country)==null?void 0:ae.name)==="Malawi"?be((d(),v("div",wl,[n("div",kl,[o(Ua,{ref_key:"currentLocationRef",ref:D},null,512)]),n("div",Sl,[o(Wa,{currentLocationFormValues:J.value,ref_key:"homeLocationRef",ref:h},null,8,["currentLocationFormValues"])])],512)),[[$e,w(X)(2)]]):S("",!0),be(n("div",Il,[n("div",Pl,[o(hl,{ref_key:"deathOutcomeRef",ref:$},null,512)]),w(H).getProgramID()==1?(d(),v("div",Tl,[o(ja,{ref_key:"patientTypeRef",ref:y},null,512)])):S("",!0)],512),[[$e,w(X)(3)]])])]}),_:1}),o(w(zn),null,{default:l(()=>[n("div",Al,[n("div",Nl,[o(nt,{name:"Cancel",color:"danger",icon:w(qn),"onClicked:btn":x[0]||(x[0]=ne=>e.editMode?rn():sn())},null,8,["icon"]),be(o(w(Fe),{onClick:x[1]||(x[1]=ne=>w(j)()),"aria-label":"Go to previous page"},{default:l(()=>[...x[5]||(x[5]=[R("Previous",-1)])]),_:1},512),[[$e,w(M)]])]),w(ie)?(d(),v("div",Ol,[(d(!0),v(G,null,K(w(ve),ne=>(d(),v("span",{key:ne,class:re({dot:!0,active:ne===w(gt)}),onClick:oe=>w(V)(ne),"aria-label":"Go to page ".concat(ne),role:"button"},null,10,Rl))),128))])):S("",!0),n("div",Ll,[be(o(nt,{name:e.editMode?"Update":"Save",loading:_.value,fill:"solid",color:"primary",icon:w(Gn),"onClicked:btn":x[2]||(x[2]=ne=>e.editMode?on():nn())},null,8,["name","loading","icon"]),[[$e,w(gt)===w(ve)]]),be(o(nt,{name:"Next","onClicked:btn":x[3]||(x[3]=ne=>w(W)())},null,512),[[$e,w(tn)]])])])]),_:1})]),_:1},8,["class"]))}}),en=Y(Vl,[["__scopeId","data-v-2ae9377b"]]),Bl=z({name:"BroughtInDeadTable",components:{IonCard:He,IonCardHeader:ut,IonCardTitle:ct,IonCardContent:Qe,IonIcon:Z,IonSpinner:xt,ReusableDataTable:Va},setup(){return{router:ke()}},data(){return{loadingBroughtInDead:!1,broughtInDeadData:[],bidHeaders:["First Name","Surname","Gender","Age","Date Of Death","Cause Of Death","Brought By","Confirmed By","Action"],bidTableOptions:{responsive:!0,ordering:!1,buttons:[],pageLength:10,dom:'<"table-controls"<"buttons-container">f>rtip',language:{emptyTable:"No patients brought in dead today",zeroRecords:"No matching records found"},initComplete:function(){const e=document.querySelector(".buttons-container");if(e){e.innerHTML='\n                            <button class="btn-register-bid" style="\n                                background: #dc2626; color: white; border: none; border-radius: 8px;\n                                padding: 8px 20px; font-weight: 600; font-size: 14px; cursor: pointer;\n                                display: flex; align-items: center; gap: 8px;\n                                box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);\n                            ">\n                                <ion-icon name="add-circle-outline" style="font-size: 20px;"></ion-icon>\n                                Register Brought In Dead\n                            </button>\n                        ';const t=e.querySelector(".btn-register-bid");t&&t.addEventListener("click",()=>{window.dispatchEvent(new CustomEvent("register-bid-click"))})}}}}},computed:{broughtInDeadTableData(){return this.broughtInDeadData.map(e=>[e.firstName,e.surname,e.gender,e.age,e.dateOfDeath,e.causeOfDeath,e.broughtBy,e.confirmedBy,this.buildActionButtons({id:e.id,name:"".concat(e.firstName," ").concat(e.surname),patientId:e.id})])},bidActionHandlers(){return{"view-profile-btn":this.handleViewProfile}}},async mounted(){await this.fetchBroughtInDeadData(),window.addEventListener("register-bid-click",this.openBroughtDeadModal)},beforeUnmount(){window.removeEventListener("register-bid-click",this.openBroughtDeadModal)},methods:{skullOutline(){return Et},addCircleOutline(){return Jn},openBroughtDeadModal(){Ne(en,{class:"fullScreenModal"},!0)},async fetchBroughtInDeadData(){this.loadingBroughtInDead=!0;try{const e=H.getUserLocationId();if(!e){this.broughtInDeadData=[];return}const t=T.currentDate(),a=await Ut.getAllEncounters({encounter_type_id:40,date:t});if(!a||a.length===0){this.broughtInDeadData=[];return}this.broughtInDeadData=a.reduce((s,i)=>{var h,y,_,$,P,I,A,N,B,J;if(String(i==null?void 0:i.location_id)!==String(e)||!((h=i==null?void 0:i.observations)==null?void 0:h.some(U=>U.concept_id===7398||U.concept_name==="Death on arrival")))return s;const r=i.observations||[];let u="N/A",m="N/A",f="N/A";r.forEach(U=>{U.concept_id===1815&&(u=U.value_text||u),U.concept_id===5002&&(m=U.value_text||m),U.concept_id===1824&&(f=U.value_text||f)});const p=($=(_=(y=i==null?void 0:i.patient)==null?void 0:y.person)==null?void 0:_.names)==null?void 0:$[0],D=(I=(P=i==null?void 0:i.provider)==null?void 0:P.names)!=null&&I[0]?"".concat(i.provider.names[0].given_name||""," ").concat(i.provider.names[0].family_name||"").trim():"Unknown";return s.push({id:i.patient_id,firstName:(p==null?void 0:p.given_name)||"N/A",surname:(p==null?void 0:p.family_name)||"N/A",age:this.calculateAge((N=(A=i==null?void 0:i.patient)==null?void 0:A.person)==null?void 0:N.birthdate),gender:((J=(B=i==null?void 0:i.patient)==null?void 0:B.person)==null?void 0:J.gender)==="M"?"Male":"Female",dateOfDeath:u,causeOfDeath:m,broughtBy:f,confirmedBy:D}),s},[])}catch(e){console.error("Error fetching brought in dead data:",e),this.broughtInDeadData=[]}finally{this.loadingBroughtInDead=!1}},calculateAge(e){if(!e)return"N/A";try{const t=new Date(e),a=new Date;if(isNaN(t.getTime()))return"N/A";let s=a.getFullYear()-t.getFullYear();const i=a.getMonth()-t.getMonth();return(i<0||i===0&&a.getDate()<t.getDate())&&s--,s>=0?s.toString():"N/A"}catch(t){return"N/A"}},buildActionButtons(e){return'\n                <div style="display: flex; gap: 6px;" data-patient-id="'.concat(e.patientId,'">\n                    <button class="view-profile-btn"\n                            data-button-type="profile"\n                            style="').concat("\n                padding: 4px 12px;\n                font-size: 0.8rem;\n                height: 28px;\n                min-width: 70px;\n                white-space: nowrap;\n                background-color: #3880ff;\n                color: white;\n                border: none;\n                border-radius: 4px;\n                cursor: pointer;\n            ","\"\n                            data-id='").concat(JSON.stringify(e),'\'\n                            title="View Profile">\n                        <span class="button-text">Profile</span>\n                        <span class="button-spinner" style="display: none;">Loading...</span>\n                    </button>\n                </div>\n            ')},async handleViewProfile(e){if(!e||!e.patientId){console.log("No patient ID found");return}this.setButtonLoading(e.patientId,"profile",!0);try{let t=null;(H.getPouchDbStatus()||H.getLanConnectionStatus())&&(t=(await Oe("patients_records",{selector:{patientID:e.patientId}}))[0]),t||(t=await H.getJson("/patients/".concat(e.patientId,"/get_patient_record"))),t?(await se().setPatientRecord(t),await Ee(),this.$router.push("/deathPatientProfile")):(me("Patient not found. Please try searching by name."),this.setButtonLoading(e.patientId,"profile",!1))}catch(t){console.error("Error in handleViewProfile:",t),me("Error loading patient profile."),this.setButtonLoading(e.patientId,"profile",!1)}},setButtonLoading(e,t,a){const s=document.querySelector('[data-patient-id="'.concat(e,'"]'));if(!s)return;const i=s.querySelector('[data-button-type="'.concat(t,'"]'));if(!i)return;const c=i.querySelector(".button-text"),r=i.querySelector(".button-spinner");a?(i.setAttribute("disabled","true"),c&&(c.style.display="none"),r&&(r.style.display="inline-block")):(i.removeAttribute("disabled"),c&&(c.style.display="inline"),r&&(r.style.display="none"))}}}),Fl={key:0,class:"loading-container"};function Ml(e,t,a,s,i,c){const r=g("ion-icon"),u=g("ion-card-title"),m=g("ion-card-header"),f=g("ion-spinner"),p=g("ReusableDataTable"),D=g("ion-card-content"),h=g("ion-card");return d(),F(h,{class:"dashboard-card bid-card"},{default:l(()=>[o(m,{class:"dashboard-card-header"},{default:l(()=>[o(u,{class:"dashboard-title"},{default:l(()=>[o(r,{icon:e.skullOutline,slot:"start",class:"dashboard-icon danger-icon"},null,8,["icon"]),t[0]||(t[0]=R(" Dead Patients Today ",-1))]),_:1})]),_:1}),o(D,{class:"bid-card-content"},{default:l(()=>[e.loadingBroughtInDead?(d(),v("div",Fl,[o(f,{name:"crescent"}),t[1]||(t[1]=n("p",{class:"loading-text"},"Loading brought in dead records...",-1))])):(d(),F(p,{key:1,headers:e.bidHeaders,data:e.broughtInDeadTableData,options:e.bidTableOptions,actionHandlers:e.bidActionHandlers,containerClass:""},null,8,["headers","data","options","actionHandlers"]))]),_:1})]),_:1})}const xl=Y(Bl,[["render",Ml],["__scopeId","data-v-728648bb"]]),El=z({name:"OPDDashboard",components:{DashboardCard:pl,BroughtInDeadTable:xl},setup(){const{ready:e,OPDWaitingLists:t,hasWaitingList:a,refreshUserData:s}=Jt();return{ready:e,OPDWaitingLists:t,hasWaitingList:a,refreshUserData:s}},data(){return{totalPatientsToday:0,isRefreshing:!1}},computed:{...de(rt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","patientsVisits","todaysAppointmentsCount"])},async mounted(){await this.refreshDashboard()},methods:{skullOutline(){return Et},openBroughtDeadModal(){Ne(en,{class:"fullScreenModal"},!0)},lockClosed(){return Kn},refresh(){return Zn},medkit(){return Rt},flask(){return Yn},async refreshDashboard(){if(!this.isRefreshing){this.isRefreshing=!0;try{const e=H.getUserLocationId();if(!e)return;await Promise.all([rt().refresh(e),this.refreshUserData()])}finally{this.isRefreshing=!1}}},clipboard(){return Tt},thermometer(){return At},calendar(){return Qn},people(){return Nt},openAllModal(e,t,a){Ne(Xr,{class:"fullScreenModal"},!0,{title:e,buttonTitle:t,buttonLink:a})},openPatientsListModal(e,t,a,s){Ne(Jr,{class:"fullScreenModal"},!0,{title:e,list:t,buttonTitle:a,buttonLink:s})},openAppointmentsModal(e,t){Ne(rl,{class:"fullScreenModal"},!0,{title:e,programType:t,programId:14})}}}),Hl={class:"dashboard-wrapper"},Ul={key:0,class:"loading-container"},Wl={key:1,class:"no-access-container"};function jl(e,t,a,s,i,c){const r=g("ion-icon"),u=g("ion-card-title"),m=g("ion-card-header"),f=g("ion-spinner"),p=g("ion-button"),D=g("DashboardCard"),h=g("ion-row"),y=g("ion-grid"),_=g("ion-card-content"),$=g("ion-card"),P=g("BroughtInDeadTable"),I=g("ion-content");return d(),F(I,{fullscreen:!0},{default:l(()=>[n("div",Hl,[o($,{class:"dashboard-card"},{default:l(()=>[o(m,{class:"dashboard-card-header"},{default:l(()=>[o(u,{class:"dashboard-title"},{default:l(()=>[o(r,{icon:e.people(),slot:"start",class:"dashboard-icon"},null,8,["icon"]),t[6]||(t[6]=R(" Today's Patients Overview ",-1))]),_:1})]),_:1}),o(_,null,{default:l(()=>[e.ready?e.OPDWaitingLists.length===0?(d(),v("div",Wl,[o(r,{icon:e.lockClosed(),class:"no-access-icon"},null,8,["icon"]),t[9]||(t[9]=n("h2",{class:"no-access-title"},"No Waiting Lists Assigned",-1)),t[10]||(t[10]=n("p",{class:"no-access-message"}," You currently don't have access to any waiting lists. Please contact your system administrator or supervisor to request access. ",-1)),o(p,{color:"primary",fill:"outline",onClick:e.refreshDashboard,class:"refresh-button"},{default:l(()=>[o(r,{icon:e.refresh(),slot:"start"},null,8,["icon"]),t[8]||(t[8]=R(" Refresh ",-1))]),_:1},8,["onClick"])])):(d(),F(y,{key:2,class:"centered-grid"},{default:l(()=>[o(h,{class:"centered-row"},{default:l(()=>{var A,N,B,J;return[e.hasWaitingList("Total Patients Today")?(d(),F(D,{key:0,icon:e.people(),color:"primary",count:e.patientsVisits.length,label:"Total patients today",onCardClick:t[0]||(t[0]=U=>e.openAllModal("All patients today","View profile","/patientProfile"))},null,8,["icon","count"])):S("",!0),e.hasWaitingList("Appointments Today")?(d(),F(D,{key:1,icon:e.calendar(),color:"primary",count:((A=e.todaysAppointmentsCount)==null?void 0:A.length)||0,label:"Appointments",onCardClick:t[1]||(t[1]=U=>e.openAppointmentsModal("OPD Appointments","14"))},null,8,["icon","count"])):S("",!0),e.hasWaitingList("Waiting for Vitals")?(d(),F(D,{key:2,icon:e.thermometer(),color:"primary",count:(N=e.patientsWaitingForVitals)==null?void 0:N.length,label:"Waiting for vitals",onCardClick:t[2]||(t[2]=U=>e.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals"))},null,8,["icon","count"])):S("",!0),e.hasWaitingList("Waiting for Consultation")?(d(),F(D,{key:3,icon:e.clipboard(),color:"primary",count:(B=e.patientsWaitingForConsultation)==null?void 0:B.length,label:"Waiting for consultation",onCardClick:t[3]||(t[3]=U=>e.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan"))},null,8,["icon","count"])):S("",!0),e.hasWaitingList("Waiting for Laboratory")?(d(),F(D,{key:4,icon:e.flask(),color:"primary",count:e.patientsWaitingForLab.length,label:"Waiting for lab",onCardClick:t[4]||(t[4]=U=>e.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan"))},null,8,["icon","count"])):S("",!0),e.hasWaitingList("Waiting for Dispensation")?(d(),F(D,{key:5,icon:e.medkit(),color:"primary",count:(J=e.patientsWaitingForDispensation)==null?void 0:J.length,label:"Waiting for dispensation",onCardClick:t[5]||(t[5]=U=>e.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations"))},null,8,["icon","count"])):S("",!0)]}),_:1})]),_:1})):(d(),v("div",Ul,[o(f,{name:"crescent"}),t[7]||(t[7]=n("p",{class:"loading-text"},"Loading dashboard...",-1))]))]),_:1})]),_:1}),e.ready&&e.OPDWaitingLists.length>0?(d(),F(P,{key:0})):S("",!0)])]),_:1})}const zl=Y(El,[["render",jl],["__scopeId","data-v-e2741e83"]]),ql={class:"icon-container"},Gl=["src","alt"],Jl={class:"card-title"},Ql=z({__name:"DashboardCard",props:{icon:{},title:{}},emits:["click"],setup(e,{emit:t}){const a=e,s=t,i=E(()=>te[a.icon]||"");return(c,r)=>(d(),v("div",{class:"card",onClick:r[0]||(r[0]=u=>s("click"))},[n("div",ql,[n("img",{src:i.value,alt:e.title},null,8,Gl)]),n("div",Jl,C(e.title),1)]))}}),Yl=Y(Ql,[["__scopeId","data-v-334cd0db"]]),Zl={class:"dashboard-container"},Kl={class:"dashboard-grid"},Xl=z({__name:"AETCDashboard",setup(e){O("");const t=ke(),a=O([{id:"patientArrival",icon:"plus_dashboard",title:"Patient Arrival"},{id:"screeningList",icon:"checklist",title:"Awaiting Screening List"},{id:"registrationList",icon:"checklist",title:"Awaiting Registration List"},{id:"triageList",icon:"checklist",title:"Awaiting Triage List"},{id:"assessmentList",icon:"checklist",title:"Awaiting Assessment List"},{id:"testResultsList",icon:"checklist",title:"Awaiting Test Results List"},{id:"specialtyList",icon:"checklist",title:"Awaiting Specialty List"},{id:"dispositionList",icon:"checklist",title:"Disposition List"},{id:"broughtDead",icon:"document",title:"Brought In Dead"},{id:"reports",icon:"chart",title:"Reports"}]),s=i=>{t.push({name:i})};return(i,c)=>(d(),F(w(Re),null,{default:l(()=>[o(w(le),{fullscreen:!0},{default:l(()=>[n("div",Zl,[n("div",Kl,[(d(!0),v(G,null,K(a.value,r=>(d(),F(Yl,{key:r.id,icon:r.icon,title:r.title,onClick:u=>s(r.id)},null,8,["icon","title","onClick"]))),128))])])]),_:1})]),_:1}))}}),ed=Y(Xl,[["__scopeId","data-v-bcce1a76"]]),td=z({name:"NCDDashboard",mixins:[et],components:{ApexChart:Je},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await Ee(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return H.getJson("programs/32/reports/ncd_dashboard",{start_date:T.toStandardHisFormat(T.sessionDate()),end_date:T.toStandardHisFormat(T.sessionDate())})}}}),nd={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},ad={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},od={ref:"chartRef1"},sd={ref:"chartRef2"};function id(e,t,a,s,i,c){const r=g("ion-card-content"),u=g("ion-card"),m=g("ApexChart");return d(),v(G,null,[n("div",nd,[o(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[o(r,null,{default:l(()=>[...t[0]||(t[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])]),_:1})]),_:1}),o(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[o(r,null,{default:l(()=>[...t[1]||(t[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])]),_:1})]),_:1}),o(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[o(r,null,{default:l(()=>[...t[2]||(t[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])]),_:1})]),_:1}),o(u,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:l(()=>[o(r,null,{default:l(()=>[...t[3]||(t[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])]),_:1})]),_:1})]),n("div",ad,[o(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[o(r,null,{default:l(()=>[t[4]||(t[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",od,[e.isChartReady?(d(),F(m,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:e.barChartOptions,series:e.barChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1})]),_:1}),o(u,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:l(()=>[o(r,null,{default:l(()=>[t[5]||(t[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",sd,[e.isChartReady?(d(),F(m,{key:0,style:{width:"100%",height:"500px"},type:"line",options:e.lineChartOptions,series:e.lineChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1})]),_:1})])],64)}const rd=Y(td,[["render",id],["__scopeId","data-v-58e2a3d8"]]),ld=z({name:"Home",mixins:[Wt,et],components:{IonContent:le,IonHeader:fe,IonPage:Re,IonToolbar:Se,Toolbar:qt,IonRow:Ze,DateInputField:ft,IonIcon:Z,IonButton:Fe,IonCol:Ye},data(){const e=O(T.sessionDate()),t=O(T.sessionDate()),a=O(T.sessionDate()),s=O([]);return{segmentContent:"Today",minDate:a,startDate:e,endDate:t,people:s,calendarOutline:Le,eyeOutline:Ft}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(e){this.segmentContent=e},formatBirthdate(e){return T.getBirthdateAge(e)},async getAppointments(){this.people=[],(await Gt.getAppointments(this.startDate,this.endDate,"")).forEach(t=>{const a={person_id:t.person_id,npid:t.npid,appointment_id:103,encounter_id:t.encounter_id,name:t.given_name.concat(" ",t.family_name),gender:t.gender,ageDob:this.formatBirthdate(t.birthdate),village:t.city_village,appointmentDate:T.toStandardHisDisplayFormat(t.appointment_date)};this.people.push(a)})},async getAppointmentsD1(e){this.startDate=T.toStandardHisFormat(e),await this.getAppointments()},async getAppointmentsD2(e){this.endDate=T.toStandardHisFormat(e),await this.getAppointments()},async openClientProfile(e){await Te.findByNpid(e),this.isPharmacist()},isPharmacist(){const e=JSON.parse(localStorage.getItem("userRoles")),t=e||[];t.some(a=>t.some(s=>s.role==="Pharmacist"))&&(this.$router.push("dispensation"),H.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),dd={class:"appointments-container"},cd={key:0,class:"date-filter"},ud={class:"appointments-table"};function pd(e,t,a,s,i,c){const r=g("ion-label"),u=g("ion-segment-button"),m=g("ion-segment"),f=g("DateInputField"),p=g("ion-col"),D=g("ion-row"),h=g("ion-icon"),y=g("ion-button"),_=g("ion-card");return d(),v("div",dd,[n("div",null,[o(m,{value:e.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:l(()=>[o(u,{value:"Today",onClick:t[0]||(t[0]=$=>e.setSegmentContent("Today"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[3]||(t[3]=[R("Today",-1)])]),_:1})]),_:1}),o(u,{value:"Tomorrow",onClick:t[1]||(t[1]=$=>e.setSegmentContent("Tomorrow"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[4]||(t[4]=[R("Tomorrow",-1)])]),_:1})]),_:1}),o(u,{value:"Date range",onClick:t[2]||(t[2]=$=>e.setSegmentContent("Date range"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[5]||(t[5]=[R("Date range",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),e.segmentContent==="Date range"?(d(),v("div",cd,[o(D,null,{default:l(()=>[o(p,null,{default:l(()=>[o(f,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),o(p,null,{default:l(()=>[o(f,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):S("",!0),e.people.length>0?(d(),F(_,{key:1},{default:l(()=>[n("table",ud,[t[6]||(t[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),v(G,null,K(e.people,$=>(d(),v("tr",{key:$.npid},[n("td",null,[o(D,null,{default:l(()=>[o(p,null,{default:l(()=>[R(C($.name),1)]),_:2},1024),o(p,null,{default:l(()=>[o(y,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:P=>e.openClientProfile($.npid),color:"primary",fill:"clear",size:"small"},{default:l(()=>[o(h,{icon:e.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,C($.npid),1),n("td",null,C($.ageDob),1),n("td",null,C($.gender),1),n("td",null,C($.village),1),n("td",null,C($.appointmentDate),1)]))),128))])])]),_:1})):(d(),F(_,{key:2},{default:l(()=>[...t[7]||(t[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])]),_:1}))])}const md=Y(ld,[["render",pd],["__scopeId","data-v-c47f7768"]]),hd=z({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(e){}}}),fd={key:0},gd={style:{display:"flex","margin-top":"10px"}},_d={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},vd={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},yd={key:1};function bd(e,t,a,s,i,c){const r=g("ion-label"),u=g("ion-segment-button"),m=g("ion-segment"),f=g("VisitsHistory");return d(),v(G,null,[n("div",null,[o(m,{value:e.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:l(()=>[o(u,{value:"Internal referrals",onClick:t[0]||(t[0]=p=>e.setSegmentContent("Internal referrals"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[2]||(t[2]=[R("Internal referrals",-1)])]),_:1})]),_:1}),o(u,{value:"External referrals",onClick:t[1]||(t[1]=p=>e.setSegmentContent("External referrals"))},{default:l(()=>[o(r,null,{default:l(()=>[...t[3]||(t[3]=[R("External referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),e.segmentContent=="Internal referrals"?(d(),v("div",fd,[n("div",gd,[e.checkUnderFive?(d(),v("div",_d)):S("",!0),t[4]||(t[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),e.checkUnderFive?S("",!0):(d(),v("div",vd))])])):S("",!0),e.segmentContent=="External referrals"?(d(),v("div",yd,[o(f)])):S("",!0)],64)}const Dd=Y(hd,[["render",bd],["__scopeId","data-v-faad8f8b"]]),$d=z({name:"Menu",components:{IonContent:le,IonHeader:fe,IonItem:Pe,IonList:Ie,IonMenu:We,IonTitle:Ue,IonToolbar:Se,IonCheckbox:Ke,IonIcon:Z,BasicForm:ze,BasicCard:Xe,Referrals:Dd,Dashboard:rd,ANCAppointments:md},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:Bt},{id:"referrals",label:"Referrals",icon:pt},{id:"appointments",label:"Appointments",icon:Le}],activeItem:"dashboard"}},computed:{...de(je,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),Cd={style:{display:"flex"}},wd={class:"left_col"},kd={class:"nav-menu"},Sd=["onClick"],Id={class:"right_col"};function Pd(e,t,a,s,i,c){const r=g("ion-icon"),u=g("Dashboard"),m=g("ANCAppointments"),f=g("Referrals");return d(),v("div",Cd,[n("div",wd,[n("nav",kd,[n("ul",null,[(d(!0),v(G,null,K(e.menuItems,p=>(d(),v("li",{key:p.id,class:re({active:e.activeItem===p.id}),onClick:D=>e.setActiveItem(p.id)},[o(r,{icon:p.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,C(p.label),1)],10,Sd))),128))])])]),n("div",Id,[n("div",null,[e.activeItem==="dashboard"?(d(),F(u,{key:0})):S("",!0),e.activeItem==="appointments"?(d(),F(m,{key:1})):S("",!0),e.activeItem==="referrals"?(d(),F(f,{key:2})):S("",!0)])])])}const Td=Y($d,[["render",Pd],["__scopeId","data-v-7e786ea4"]]),Ad=z({name:"Menu",components:{IonContent:le,IonHeader:fe,IonItem:Pe,IonList:Ie,IonMenu:We,IonTitle:Ue,IonToolbar:Se,IonCheckbox:Ke,BasicForm:ze,BasicCard:Xe},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...de(je,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),Nd={class:"left_col"},Od={class:"nav-menu"},Rd=["onClick"];function Ld(e,t,a,s,i,c){return d(),v("div",null,[n("div",Nd,[n("nav",Od,[n("ul",null,[(d(!0),v(G,null,K(e.menuItems,r=>(d(),v("li",{key:r.id,class:re({active:e.activeItem===r.id}),onClick:u=>e.setActiveItem(r.id)},C(r.label),11,Rd))),128))])])]),t[0]||(t[0]=n("div",{class:"right_col"},null,-1))])}const Vd=Y(Ad,[["render",Ld],["__scopeId","data-v-32dd02d3"]]),Bd=z({name:"Menu",components:{IonContent:le,IonHeader:fe,IonItem:Pe,IonList:Ie,IonMenu:We,IonTitle:Ue,IonToolbar:Se,IonCheckbox:Ke,BasicForm:ze,BasicCard:Xe},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...de(je,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),Fd={class:"left_col"},Md={class:"nav-menu"},xd=["onClick"];function Ed(e,t,a,s,i,c){return d(),v("div",null,[n("div",Fd,[n("nav",Md,[n("ul",null,[(d(!0),v(G,null,K(e.menuItems,r=>(d(),v("li",{key:r.id,class:re({active:e.activeItem===r.id}),onClick:u=>e.setActiveItem(r.id)},C(r.label),11,xd))),128))])])]),t[0]||(t[0]=n("div",{class:"right_col"},null,-1))])}const Hd=Y(Bd,[["render",Ed],["__scopeId","data-v-b49d8600"]]);function Ud(){const e=xe(),t=O(""),a=O(!1),s=O({}),i=()=>{const c=H.getUserRoles(),r=H.getProgramID(),u=H.getProgramName();t.value=c,a.value=!1,c==="Lab"&&r===14?s.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:r===14&&c!=="Lab"?s.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:r===12?s.value={url:"contact",btnName:"Back"}:u==="LABOUR AND DELIVERY PROGRAM"?s.value={url:"labour/labourHome",btnName:"Back to home"}:u==="PNC PROGRAM"?s.value={url:"pnc/home",btnName:"Back to home"}:s.value={url:"",btnName:""},a.value=!0};return ce(()=>e.path,()=>{i()},{immediate:!0,deep:!0}),{userRole:t,ready:a,userRoleSettings:s,updateUserRoleSettings:i}}const yc=z({__name:"HomePage",setup(e){const t=O(!0),a=xe(),s=va(),i=O(localStorage.getItem("sessionDate")||"");Ud();const c=Ht(),{apiStatus:r}=qe(jt()),{activeProgram:u}=qe(c),m=E(()=>{var _;switch(console.log("ðŸš€ ~ activeDashboard ~ activeProgram:",u.value.program_id),(_=u.value)==null?void 0:_.program_id){case pe.IMMUNIZATION_PROGRAM:return Wr;case pe.OPD_PROGRAM:return zl;case pe.NCD_PROGRAM:return zs;case pe.AETC_PROGRAM:return ed;case pe.HTS_PROGRAM:return wi;case pe.ANC_PROGRAM:return Td;case pe.PNC_PROGRAM:return Hd;case pe.LABOUR_AND_DELIVERY_PROGRAM:return Vd;case pe.HIV_PROGRAM:return nr;case pe.NEONATAL_PROGRAM:return qa;default:return null}}),f=()=>{const _=localStorage.getItem("sessionDate");(!_||_.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),$t()),i.value=_||""};let p=null;he(()=>{p=()=>f(),window.addEventListener("storage",p);const _=setInterval(f,1e3);Xn(()=>{clearInterval(_),p&&window.removeEventListener("storage",p)}),f()}),ce(i,(_,$)=>{(!_||_.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),$t())});const D=async()=>{Be.isEmpty(u.value)&&await Ca.show(Sa,{},"module-picker-modal")},h=async(_=[])=>{try{t.value=!0,ya(),await ba().loadGlobalProperty(),s.postData({command:"ping"});for(const $ of _)typeof $=="function"?await $():console.warn("Non-function item found in extraFns array:",$)}catch($){console.error("Error initializing component:",$)}finally{t.value=!1}};ce(()=>a.name,async _=>{_==="Home"&&await h([D])},{immediate:!0,deep:!0});const y=async()=>{try{const _=H.getUserID(),$=await Da.getUserByID(_);if($.location_id!=null){const P=await $a.getLocation($.location_id);localStorage.setItem("locationData",JSON.stringify(P))}}catch(_){console.error("Failed to retrieve location data:",_)}};return r.value&&(Jt(),y()),he(async()=>{try{await h()}catch(_){console.error("Error initializing component:",_)}finally{t.value=!1}}),(_,$)=>{const P=g("ion-content");return d(),F(w(Re),null,{default:l(()=>[o(qt),o(ka),m.value?(d(),F(ea(m.value),{key:0})):(d(),F(P,{key:1},{default:l(()=>[...$[0]||($[0]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])]),_:1}))]),_:1})}}});export{yc as default};

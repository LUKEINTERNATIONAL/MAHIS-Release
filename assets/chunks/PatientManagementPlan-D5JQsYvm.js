import{c as I,d as B,r as p,O as k,f as C,u as m,aS as U,J as v,l as d,aP as j,an as Ce,cG as Pe,aV as b,w as g,a as xe,a3 as we,k as T,m as Ae,i as $,bL as Me,v as H,a6 as Ie,b9 as F}from"./vendor-Cjwp4qqF.js";import{aD as J,l as E,aH as Z,u as Be,aI as Re,aJ as Ne,aK as Le,aL as Ve,d as ze,aM as $e,g as He,Z as Ee,e as Ge,T as We,J as Ue,N as je,H as G,aN as A,aO as Je,aP as X,aQ as qe,t as ee,aR as M,G as Oe,aS as Ye,a0 as Ke,S as Qe}from"../index-Dpew_BwD.js";import{D as Ze}from"./DemographicBar-CNH587IV.js";import{u as Xe,a as W,_ as ea,s as aa,c as ta,b as na}from"./useFormWizard-Dy3j6HNd.js";import{l as ia}from"./lodash-NJiRuGo9.js";import{a as ae,b as oa}from"./formatServerData-qqPUzGTC.js";import{u as sa}from"./usePatientProfile-DZWk9Ho4.js";import"./apexcharts-H6sKa3PN.js";import"./drug_prescription_service-BtoL5kiL.js";import"./patient_diagnosis_service-CR9b28AW.js";import"./Registration-BidGKuZ2.js";import"./useLocation-L5MiBDEF.js";import"./vaccines_service-B3gcVHaI.js";import"./sms_service-Ci2Zpl87.js";import"./EIRreportsStore-Db74iuSW.js";import"./Export-o53OzKoH.js";import"./useNeonatalEnrollmentStore-BQIh-FHM.js";import"./enrollment-DU-PLRUa.js";const la=()=>({nonPharmacologicalFormSection:I(()=>[{componentType:"Heading",name:"Procedures",grid:{s:"5"}},{grid:{s:"2"}},{componentType:"Heading",name:"Supportive Care",grid:{s:"5"}},{componentType:"checkboxField",type:"single",label:"Minor Surgery",name:"minor_surgery",grid:{s:"5"}},{grid:{s:"2"}},{componentType:"checkboxField",type:"single",label:"Wound Dressing",name:"wound_dressing",grid:{s:"5"}},{componentType:"checkboxField",type:"single",label:"Suturing",name:"suturing",grid:{s:"5"}},{grid:{s:"2"}},{componentType:"checkboxField",type:"single",label:"Patient Education",name:"patient_education",grid:{s:"5"}},{componentType:"checkboxField",type:"single",label:"Joint Reduction",name:"joint_reduction",grid:{s:"5"}},{grid:{s:"2"}},{componentType:"checkboxField",type:"single",label:"Counselling",name:"counselling",grid:{s:"5"}},{componentType:"checkboxField",type:"single",label:"Fracture Reduction",name:"fracture_reduction",grid:{s:"5"}},{grid:{s:"2"}},{componentType:"checkboxField",type:"single",label:"Feeding",name:"feeding",grid:{s:"5"}},{componentType:"checkboxField",type:"single",label:"Intercostal Drain Insertion",name:"intercostal_drain_insertion",grid:{s:"5"}},{grid:{s:"2"}},{componentType:"checkboxField",type:"single",label:"Oxygenation",name:"oxygenation",grid:{s:"5"}},{componentType:"checkboxField",type:"single",label:"Pleurocentesis",name:"pleurocentesis",grid:{s:"5"}},{grid:{s:"2"}},{componentType:"checkboxField",type:"single",label:"Tepid Sponging",name:"tepid_sponging",grid:{s:"5"}},{componentType:"checkboxField",type:"single",label:"Pericardiocentesis",name:"pericardiocentesis",grid:{s:"5"}},{grid:{s:"2"}},{componentType:"checkboxField",type:"single",label:"Electrocardiography (ECG) Monitoring",name:"electrocardiography_monitoring",grid:{s:"5"}},{componentType:"checkboxField",type:"single",label:"Paracentesis",name:"paracentesis",grid:{s:"5"}},{grid:{s:"2"}},{componentType:"checkboxField",type:"single",label:"Turning Patients",name:"turning_patients",grid:{s:"5"}},{componentType:"checkboxField",type:"single",label:"Lumbar Puncture",name:"lumbar_puncture",grid:{s:"5"}},{grid:{s:"2"}},{componentType:"checkboxField",type:"single",label:"Oral Care",name:"oral_care",grid:{s:"5"}},{componentType:"checkboxField",type:"single",label:"Intravenous Cannulation",name:"intravenous_cannulation",grid:{s:"5"}},{grid:{s:"2"}},{componentType:"checkboxField",type:"single",label:"Other (Specify)",name:"supportive_care_other",grid:{s:"5"}},{componentType:"checkboxField",type:"single",label:"Central Line Insertion",name:"central_line_insertion",grid:{s:"5"}},{grid:{s:"2"}},{componentType:"checkboxField",type:"single",label:"Urethral Catheterization",name:"urethral_catheterization",grid:{s:"12"}},{componentType:"checkboxField",type:"single",label:"Suprapubic Catheterization",name:"suprapubic_catheterization",grid:{s:"12"}},{componentType:"checkboxField",type:"single",label:"Suctioning",name:"suctioning",grid:{s:"12"}},{componentType:"checkboxField",type:"single",label:"Oropharyngeal Airway Insertion",name:"oropharyngeal_airway_insertion",grid:{s:"12"}},{componentType:"checkboxField",type:"single",label:"Nasopharyngeal Airway Insertion",name:"nasopharyngeal_airway_insertion",grid:{s:"12"}},{componentType:"checkboxField",type:"single",label:"Laryngeal Mask Airway Insertion",name:"laryngeal_mask_airway_insertion",grid:{s:"12"}},{componentType:"checkboxField",type:"single",label:"Endotracheal Tube Insertion",name:"endotracheal_tube_insertion",grid:{s:"12"}},{componentType:"checkboxField",type:"single",label:"Nasogastric Tube Insertion",name:"nasogastric_tube_insertion",grid:{s:"12"}},{componentType:"checkboxField",type:"single",label:"Manual Ventilation",name:"manual_ventilation",grid:{s:"12"}},{componentType:"checkboxField",type:"single",label:"Continuous Positive Airway Pressure (CPAP)",name:"continuous_positive_airway_pressure",grid:{s:"12"}},{componentType:"checkboxField",type:"single",label:"Other (Specify)",name:"procedures_other",grid:{s:"12"}}])}),ra=B({__name:"NonPharmacological",setup(_){const r=p(null),f=la().nonPharmacologicalFormSection;return(c,S)=>(C(),k(m(U),null,{default:v(()=>[d(m(j),null,{default:v(()=>[d(J,{formData:m(f),ref_key:"formRef",ref:r},null,8,["formData"])]),_:1})]),_:1}))}}),ca=()=>({pharmacologicalFormSection:I(()=>[{componentType:"multiSelectInputField",header:"Medication Name",name:"medication_name",isMultiple:!1,trackBy:"id",grid:{s:"4"},icon:E.search,options:[{id:1,name:"Dextrose"},{id:2,name:"Epinephrine"},{id:3,name:"Atropine"},{id:4,name:"Amiodarone"}]},{componentType:"multiSelectInputField",header:"Formulation",name:"formulation",isMultiple:!1,trackBy:"id",grid:{s:"4"},icon:E.search,options:[{id:1,name:"Solution"},{id:2,name:"Powder"},{id:3,name:"Capsule"},{id:4,name:"Tablet"}]},{componentType:"inputField",header:"Dose",name:"dose",grid:{s:"4"},initialUnit:"Years",unitOptions:[{label:"Grams (g)",value:"Grams (g)"},{label:"Milligrams (mg)",value:"Milligrams (mg)"},{label:"Micrograms (mcg)",value:"Micrograms (mcg)"},{label:"Units",value:"Units"}],unitValidation:r=>!r||r===""?"Please select a unit.":null},{componentType:"multiSelectInputField",header:"Frequency",name:"frequency",isMultiple:!1,trackBy:"id",grid:{s:"4"},icon:E.search,options:[{id:1,name:"Daily"},{id:2,name:"Twice Daily"},{id:3,name:"Three Times Daily"},{id:4,name:"Four Times Daily"}]},{componentType:"inputField",header:"Duration",name:"duration ",grid:{s:"4"},initialUnit:"hours",unitOptions:[{label:"Hours",value:"hours"},{label:"Days",value:"days"},{label:"Weeks",value:"weeks"},{label:"Months",value:"months"},{label:"Years",value:"years"}],unitValidation:r=>!r||r===""?"Please select a unit.":null}])}),ua=B({__name:"Medication",setup(_){const r=p(null),f=ca().pharmacologicalFormSection;return(c,S)=>(C(),k(m(U),null,{default:v(()=>[d(m(j),null,{default:v(()=>[d(J,{formData:m(f),ref_key:"formRef",ref:r},null,8,["formData"])]),_:1})]),_:1}))}}),da=()=>({patientCareAreaFormSection:I(()=>[{header:"Select Patient Care Area",name:"patient_care_area",componentType:"radioButtonField",type:"inline",grid:{s:"8"},options:[{label:"Rescitation",value:"Rescitation"},{label:"Short Stay",value:"Short Stay"},{label:"Gynae Bench",value:"Gynae Bench"},{label:"Isolation Room",value:"Isolation Room"},{label:"Trauma",value:"Trauma"},{label:"Medical Bench",value:"Medical Bench"},{label:"Surgical Bench",value:"Surgical Bench"},{label:"SSW",value:"SSW"},{label:"Priority Area",value:"Priority Area"},{label:"Other",value:"Other"}]}])}),ma=B({__name:"PatientCareArea",setup(_){const r=p(null),f=da().patientCareAreaFormSection;return(c,S)=>(C(),k(m(U),null,{default:v(()=>[d(m(j),null,{default:v(()=>[d(J,{formData:m(f),ref_key:"formRef",ref:r},null,8,["formData"])]),_:1})]),_:1}))}}),ga={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},pa={class:"back_profile"},Ra=B({__name:"PatientManagementPlan",setup(_,{expose:r}){const{onTabBeforeChange:f,currentTabIndex:c}=Xe();sa();const S=Ce(),te=Pe();p([]),p([]),p(!1);const R=p(!0),N=p(!1),y=p(!1),q=I(()=>({text:y.value?"Saving...":"Finish",icon:y.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:N.value||y.value})),ne=Z(),ie=Be(),oe=Re(),se=Ne();Le();const le=Ve(),L=ze();$e();const re=He(),ce=W(),ue=Ee(),{patient:o}=b(ie),{vitals:de}=b(ne),{investigations:me}=b(oe),{diagnosis:ge}=b(se),{substance:pe}=b(re),{selectedNCDMedicationList:O}=b(le),{FootScreening:he,visualScreening:be,cvScreening:ve}=b(ce),{sessionDate:Y}=b(ue),{apiStatus:ha}=b(Ge());g(q,(e,a)=>{console.log("Done button options changed:",{from:a,to:e,currentStep:c.value,tabsLength:i.value.length}),e.disabled!==(a==null?void 0:a.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(a==null?void 0:a.text)&&console.log('Done button text changed from "'.concat(a==null?void 0:a.text,'" to "').concat(e.text,'"'))},{deep:!0}),g(y,(e,a)=>{e!==a&&(console.log("Saving state changed: ".concat(a," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const ye=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},P=()=>{let e=!1;return x(),y.value&&(e=!0),N.value=e,!e},fe=()=>{S.push("/patientProfile")},V=()=>[{title:"Non Pharmacological",icon:""},{title:"Patient Care Area",icon:""},{title:"Medication",icon:""}],i=p(V()),_e=p(null),Se=p(null),x=()=>{var n;if(!i.value||i.value.length===0)return console.log("Tabs not yet initialized"),null;const e=c.value>=0&&c.value<i.value.length?c.value:0;switch((n=i.value[e])==null?void 0:n.title){case"Non Pharmacological":return"NonPharmacological";case"Patient Care Area":return"PatientCareArea";case"Medication":return"Medication";default:if(L.NCDActivities.length>0)switch(L.NCDActivities[0]){case"Non Pharmacological":return"NonPharmacological";case"Patient Care Area":return"PatientCareArea";case"Medication":return"Medication"}return null}},z=()=>{R.value=!1,setTimeout(()=>{c.value=0,R.value=!0},0)},K=()=>{const e=Z();e.setVitals(e.getInitialVitals(o.value.ID))},h=async()=>{var n,u;const e=je(Y.value,"sessionDate","value")||G.sessionDate(),a=A("vitals");for(let t=0;t<i.value.length;t++){const l=i.value[t];if(l.title==="Vital Signs")i.value[t].icon=w(e,a)?F:"";else if(l.title==="Risk Assessment"){const s=A("substanceAbuse");i.value[t].icon=w(e,s)?F:""}else if(l.title==="Investigations"){const s=(u=(n=o==null?void 0:o.value)==null?void 0:n.labOrders)==null?void 0:u.saved,D=s==null?void 0:s.filter(ke=>G.toStandardHisFormat(e)===G.toStandardHisFormat(ke.order_date));i.value[t].icon=(D==null?void 0:D.length)>0?F:""}else if(l.title==="Diagnosis"){const s=A("diagnosis");i.value[t].icon=w(e,s)?F:""}else if(l.title==="Complications Screening"){const s=A("screening");i.value[t].icon=w(e,s)?F:""}else l.title==="Treatment Plan"&&(O.value.length>0?i.value[t].icon=Je()?F:"":i.value[t].icon="")}P()},w=(e,a)=>{const n=new Date(e);return n.setHours(0,0,0,0),a.some(u=>{const t=new Date(u.obs_datetime);return t.setHours(0,0,0,0),t.getTime()===n.getTime()})},De=async()=>{var t,l,s,D;const e=[],a=await ae(be.value),n=await oa(he.value),u=await ae(ve.value);a.length>0&&e.push({concept_id:await M.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:M.getSessionDate(),child:a}),n.length>0&&e.push({concept_id:await M.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:M.getSessionDate(),child:n}),u.length>0&&e.push(...u),e.length>0?((D=(s=(l=(t=o.value).screening)!=null?l:t.screening={}).unsaved)!=null||(s.unsaved=[]),o.value.screening.unsaved.push(...e),Oe("Complications saved successfully")):ee("No complications data to save")},Te=async()=>{const e=Ye();if(!ia.isEmpty(e.selectedMedicalAllergiesList)){const u=Ke(),t=e.selectedMedicalAllergiesList.map(s=>({concept_id:s.concept_id,obs_datetime:Qe.getSessionDate(),value_coded:s.concept_id,location_id:u.facilityLocation.code,value_text:s.name})),l=await aa(t);o.value=Object.assign(o.value,l),console.log("Allergies staged successfully:",o.value),e.clearSelectedMedicalAllergiesList()}const a=await ta();o.value=Object.assign(o.value,a);const n=await na().saveNonPharmaTherapyPatientData();o.value=Object.assign(o.value,n)},Fe=async(e,a)=>{var u,t,l;const n=(u=i.value[a])==null?void 0:u.title;e%1===0&&(c.value=e),n=="Vital Signs"&&((t=_e.value)==null||t.onSubmit()),n=="Risk Assessment"&&((l=Se.value)==null||l.onSubmit()),n=="Complications Screening"&&await De(),n=="Treatment Plan"&&await Te(),await X(o.value)},Q=async()=>{y.value=!0;try{await qe(),await X(o.value),S.push("/triageList")}catch(e){console.error("Error saving data:",e),ee("Error occurred while saving data. Please try again.")}finally{y.value=!1}};return xe(async()=>{if(L.NCDActivities.length===0){S.push("patientProfile");return}W().resetScreening(),i.value=V(),await h(),(c.value===void 0||c.value<0)&&(c.value=0,console.log("Setting initial tab index to 0")),N.value=!1,y.value=!1,P()}),g(c,async()=>{await P()}),g(de,async()=>{await h()},{deep:!0}),g(o,async()=>{W().resetScreening(),await h()},{deep:!0}),g(Y,async()=>{await h()},{deep:!0}),g(me,async()=>{await h()},{deep:!0}),g(ge,async()=>{await h()},{deep:!0}),g(pe,async()=>{await h()},{deep:!0}),g(O,async()=>{await h()},{deep:!0}),g(te,async e=>{z(),K(),i.value=V()},{deep:!0}),g(o,async(e,a)=>{e.ID!=a.ID&&(z(),K())},{deep:!0}),r({saveData:Q,markWizard:h,refreshWizard:z,validateDoneButtonState:P}),(e,a)=>(C(),k(m(Ie),null,{default:v(()=>[d(We),d(m(we),{fullscreen:!0},{default:v(()=>[d(Ze),T("div",ga,[R.value?(C(),k(ea,{key:0,ref:"wizard",headingTitle:"Patient Management Plan","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:q.value,"custom-tabs":i.value,beforeChange:m(f),onChange:Fe,"onComplete:wizard":a[1]||(a[1]=n=>Q()),onDoneButtonChanged:ye},{default:v(()=>[T("div",null,[T("div",pa,[d(Ue,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:m(Me),"font-weight":"600",onClick:a[0]||(a[0]=n=>fe())},null,8,["icon"])])]),$(T("div",null,[d(ra,{ref:"nonPharmacologicalRef"},null,512)],512),[[H,x()=="NonPharmacological"]]),$(T("div",null,[d(ma,{ref:"patientCareAreaRef"},null,512)],512),[[H,x()=="PatientCareArea"]]),$(T("div",null,[d(ua,{ref:"medicationRef"},null,512)],512),[[H,x()=="Medication"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Ae("",!0)])]),_:1})]),_:1}))}});export{Ra as default};

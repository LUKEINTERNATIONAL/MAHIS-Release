System.register(["./vendor-legacy-IGuUoRYO.js","../index-legacy-CPN3hcLt.js","./EnterLabResultsModal-legacy-BOc6UTPC.js","./BasicForm-legacy-B3YpG0XM.js","./useUserActivities-legacy-Wl-dR5TT.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-w_Qe4jnt.js","./DateInputField-legacy-DgLPZlDc.js"],function(e,t){"use strict";var a,n,o,s,l,i,d,r,u,c,p,v,b,m,f,g,y,h,w,_,x,S,O,k,I,T,B,C,H,D,L,F,A,N,J,$,j,M,R,z,E,P,V,q,Y,W,G,K,U,Q,X,Z,ee,te,ae,ne,oe,se,le,ie,de,re,ue,ce,pe,ve,be,me;return{setters:[e=>{a=e.d,n=e.b9,o=e.aA,s=e.bq,l=e.a5,i=e.dt,d=e.e1,r=e.ak,u=e.al,c=e.az,p=e.ay,v=e.L,b=e.K,m=e.bC,f=e.P,g=e.b8,y=e.M,h=e.G,w=e.Q,_=e.f,x=e.H,S=e.l,O=e.k,k=e.I,I=e.a3,T=e.e,B=e.F,C=e.T,H=e.bh,D=e.aF,L=e.r,F=e.c,A=e.w,N=e.a,J=e.m,$=e.cr,j=e.et,M=e.bl,R=e.cY,z=e.n,E=e.u},e=>{P=e.F,V=e._,q=e.u,Y=e.v,W=e.y,G=e.n,K=e.q,U=e.C,Q=e.S,X=e.g,Z=e.O,ee=e.t,te=e.G,ae=e.bJ,ne=e.x,oe=e.aq,se=e.J,le=e.bb,ie=e.o,de=e.k,re=e.H,ue=e.bK,ce=e.a,pe=e.a4},e=>{ve=e.E},e=>{be=e.B},e=>{me=e.u},null,null,null],execute:function(){var t=document.createElement("style");t.textContent="ion-footer[data-v-a0bebd3e]{--ion-toolbar-background: #f4f4f4f4}ion-modal[data-v-a0bebd3e]{--width: 90%;--height: 94%}.ion-padding[data-v-5cf5d632]{--padding-start: var(--ion-padding, 0px);--padding-end: var(--ion-padding, 0px);--padding-top: var(--ion-padding, 0px);--padding-bottom: var(--ion-padding, 16px)}#container[data-v-5cf5d632]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container strong[data-v-5cf5d632]{font-size:20px;line-height:26px}#container p[data-v-5cf5d632]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container a[data-v-5cf5d632]{text-decoration:none}.action_buttons[data-v-5cf5d632]{color:var(--ion-color-primary);display:flex;align-items:center;float:right;max-width:70px}.modify_buttons[data-v-5cf5d632]{padding-left:20px}.item_no_border[data-v-5cf5d632]{--border-color: transparent}.search_result[data-v-5cf5d632]{padding:10px}.action_buttons[data-v-5cf5d632]{opacity:0;transition:opacity .3s}.dashed_bottom_border:hover .action_buttons[data-v-5cf5d632]{opacity:1}.dashed_bottom_border[data-v-5cf5d632]{font-weight:700}.sub_item_body[data-v-5cf5d632]{margin-left:45px}ion-segment-button[data-v-5cf5d632]{background:#fff;margin-right:1px;font-size:12px;text-transform:unset}.bottomSummary[data-v-5cf5d632]{margin-top:20px;max-width:600px}.bottomSummary .segment-button-checked[data-v-5cf5d632]{background:#fff!important;--indicator-color: none}.bottomSummary ion-segment-button[data-v-5cf5d632]{background:#e6e6e6;margin-right:5px;border-top-right-radius:10px;border-top-left-radius:10px;text-transform:unset;font-style:normal;font-weight:700;font-size:12px}.bmi_blood[data-v-054ff036]{font-size:14px;font-weight:500;border:1px solid #ddeedd;border-radius:4px;padding:4px;min-width:190px}.graphBtn[data-v-054ff036]{font-size:14px;font-weight:500;border:1px solid #ddeedd;border-radius:4px;padding:4px;min-width:90px}._active[data-v-054ff036]{background-color:#ded;color:#006401;padding:5px;border-radius:4px}.iconBg[data-v-054ff036]{background:#ded;padding:2px;border-radius:5px}.show_more[data-v-054ff036]{color:#006401;padding:10px}.no-margin-left[data-v-054ff036]{margin:0;display:flex;justify-content:flex-start;background:#e0ffff}.scrollable-container[data-v-054ff036]{overflow-x:auto;-webkit-overflow-scrolling:touch;width:100%}\n/*$vite$:1*/",document.head.appendChild(t);const fe=a({components:{IonButtons:g,IonButton:f,IonModal:m,IonHeader:b,IonContent:v,IonToolbar:p,IonTitle:c,IonItem:u,IonList:r,IonAvatar:d,IonImg:i,IonLabel:l,IonPage:s,IonMenu:o,BasicForm:be,IonFooter:n,DynamicButton:P},data:()=>({popoverStatus:null}),props:{keyboardClose:{type:Boolean,default:!1},keepContentsMounted:{type:Boolean,default:!1},content:{default:[]},popoverOpen:{type:Boolean,default:!1},event:{type:Event,default:""},title:{type:String,default:""}},methods:{dismiss(){y.dismiss()},nav(e,t){this.dismiss(),this.$router.push(e)}}}),ge={class:"modal_wrapper"},ye={class:"center text_12"},he=V(fe,[["render",function(e,t,a,n,o,s){const l=h("ion-title"),i=h("ion-button"),d=h("ion-buttons"),r=h("ion-toolbar"),u=h("ion-header"),c=h("ion-skeleton-text"),p=h("ion-col"),v=h("ion-row"),b=h("ion-content"),m=h("ion-modal");return _(),w(m,{"is-open":e.popoverOpen,"show-backdrop":!0,onDidDismiss:t[1]||(t[1]=t=>e.$emit("closePopover",!1)),"keyboard-close":e.keyboardClose},{default:x(()=>[S(u,null,{default:x(()=>[S(r,null,{default:x(()=>[S(l,null,{default:x(()=>[O("b",null,"Lab results for ("+k(e.content.name)+") test",1)]),_:1}),S(d,{slot:"end"},{default:x(()=>[S(i,{onClick:t[0]||(t[0]=t=>e.$emit("closeModal"))},{default:x(()=>[...t[2]||(t[2]=[I("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),S(b,{class:"ion-padding"},{default:x(()=>[O("div",ge,[O("div",ye,[S(v,null,{default:x(()=>[(_(!0),T(B,null,C(e.content.result,(e,a)=>(_(),w(p,{size:"4",key:a},{default:x(()=>[S(v,null,{default:x(()=>[S(p,{size:"8"},{default:x(()=>[e.indicator&&e.indicator.name?(_(),T(B,{key:0},[I(k(e.indicator.name),1)],64)):(_(),w(c,{key:1,animated:"",style:{width:"80%"}}))]),_:2},1024),S(p,{class:"bold",size:"0.5"},{default:x(()=>[...t[3]||(t[3]=[I(":",-1)])]),_:1}),S(p,{class:"bold",size:"2"},{default:x(()=>[I(k(e.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),_:1})]),_:1},8,["is-open","keyboard-close"])}],["__scopeId","data-v-a0bebd3e"]]),we={style:{display:"flex",gap:"8px"}},_e=V(a({__name:"AddLabTestModal",setup(e){const t=q(),a=Y(),{patient:n}=H(t),o=D(),s=L(""),l=L(""),i=L(""),d=L(""),r=L(null),u=L(null),c=L([]),p=F(()=>g()?"Add HIV Test":"Add Lab Test"),v=F(()=>[{componentType:"multiSelectInputField",name:"test",header:"Test",options:d.value,grid:{s:"6"},icon:G.search,validation:W.required,onChange:e=>{s.value=e.name,g()&&(i.value=[])}},{componentType:"multiSelectInputField",name:"specimen",header:"Specimen",grid:{s:"6"},icon:G.search,validation:W.required,value:1==i.value.length?i.value[0]:"",options:i.value.length>1?i.value:[]}]),b=F(()=>[{componentType:"checkboxField",type:"single",name:"HIV test",label:"HIV test",value:"HIV test"==s.value},{componentType:"checkboxField",type:"single",name:"Hepatitis B Test",label:"Hepatitis B Test",value:"Hepatitis B Test"==s.value},{componentType:"checkboxField",type:"single",name:"Syphilis",label:"Syphilis",value:"Syphilis"==s.value},{componentType:"checkboxField",type:"single",name:"Hepatitis C Test",label:"Hepatitis C Test",value:"Hepatitis C Test"==s.value}]);A(s,async e=>{if(e)try{i.value=await m(e)}catch(t){i.value=[]}else i.value=[]});const m=async e=>{let t;return t=Q.getPouchDbStatus()||Q.getLanConnectionStatus()?await X("specimens"):await Z.getSpecimens("",1e3),await oe.getConceptSet(e,"",{names:t.map(e=>e.name)})};A(n,async()=>{l.value=[...n.value.labOrders.saved,...n.value.labOrders.unsaved]},{deep:!0});const f=()=>{y.dismiss()},g=()=>"HIV test"==s.value||"Syphilis"==s.value||"Hepatitis B Test"==s.value||"Hepatitis C Test"==s.value,h=async()=>{f();const e=String(localStorage.getItem("locationID"));e?(await a.refresh(e),await o.push("/home")):ne("Location not found")},S=async(e="",t)=>{try{const a=u.value.getFormValues();if(!a||0===Object.keys(a).length)return!1;if(!Object.values(a).some(e=>e))return!1;const n=Object.keys(a).map(async n=>{a[n]&&c.value.push({order_type_id:t,concept_id:await oe.getConceptID(n,!0),name:n,specimen:"Blood",reason:"Routine",specimenConcept:await oe.getConceptID("Blood",!0),referral:e})});return await Promise.all(n),c.value.length>0&&await k(c.value),a}catch(a){return console.error("Error saving HIV tests:",a),!1}},k=async e=>{var t,a,o,s,i,d;const r=await Z.buildLabOrders("",e),u=JSON.parse(JSON.stringify(n.value));null!==(a=(t=null!==(o=u.labOrders)&&void 0!==o?o:u.labOrders={}).unsaved)&&void 0!==a||(t.unsaved=[]),null!==(i=(s=null!==(d=u.labOrders)&&void 0!==d?d:u.labOrders={}).saved)&&void 0!==i||(s.saved=[]),u.labOrders.unsaved.push(...r),await se(u),l.value=[...u.labOrders.saved,...u.labOrders.unsaved]};return N(async()=>{d.value=await(async()=>Q.getPouchDbStatus()||Q.getLanConnectionStatus()?await X("test_types"):await Z.getTestTypes())()}),(e,t)=>(_(),w(K,{title:p.value,subtitle:""},{"top-buttons":x(()=>[O("div",we,[g()?J("",!0):(_(),w(P,{key:0,onClick:t[0]||(t[0]=e=>(async()=>{if(r.value.validateForm())return void ee("Test not saved");if(!r.value)return void console.error("Form reference is not available");const e=r.value.getFormValues(),t=e.test.name,a=e.specimen.name,n=[{concept_id:e.test.concept_id,name:t,specimen:a,reason:"Routine",specimenConcept:await oe.getConceptID(a,!0)}];await k(n),f()})()),name:"Save",fill:"solid",style:{}})),g()?(_(),w(P,{key:1,onClick:t[1]||(t[1]=e=>(async()=>{await S("referral",9)?(te("HIV Test sent to HTS successfully"),await h()):ee("No HIV Test selected")})()),name:"Send to HTS",fill:"solid",style:{}})):J("",!0),g()?(_(),w(P,{key:2,onClick:t[2]||(t[2]=e=>(async()=>{if(await S("",4))try{await ae.addPatientToStage(n.value,"LAB"),te("The patient successfully sent to the lab. You may now attend to other patients."),await h()}catch(e){console.error("Error sending to lab:",e),ne("Failed to send patient to lab")}f()})()),name:"Send to Lab",fill:"solid",style:{}})):J("",!0),g()?(_(),w(P,{key:3,onClick:t[3]||(t[3]=e=>{s.value=""}),color:"danger",name:"Back",fill:"solid",style:{}})):J("",!0)])]),content:x(()=>[g()?J("",!0):(_(),w(U,{key:0,formData:v.value,ref_key:"formRef",ref:r},null,8,["formData"])),g()?(_(),w(U,{key:1,formData:b.value,ref_key:"formRefHiv",ref:u},null,8,["formData"])):J("",!0)]),_:1},8,["title"]))}}),[["__scopeId","data-v-5cf5d632"]]),xe={class:"container"},Se={class:"table-responsive"},Oe=a({__name:"LabOrdersList",props:{propOrders:{default:()=>[]},showAddTestButton:{type:Boolean,default:!0},showSendToLabButton:{type:Boolean,default:!0}},setup(e){const t=e,a=D(),n=$(),o=q(),s=le(),l=Y(),{hasWaitingList:i}=me(),{patient:d}=H(o),{investigations:r}=H(s),u=L(),c=L([]),p=L(["Lab Test","Specimen","Accession Number","Location","Order Date","Result","Action"]),v=L([]),b=L([]),m=L(""),f=L(!1),g=L(""),y=j(()=>{var e;return null===(e=d.value)||void 0===e?void 0:e.labOrders}),h=G,w=F(()=>{const e=[];return t.showAddTestButton&&e.push({text:" <b>+ Add other tests </b>",className:"add-test text-white",action:async()=>{await J()}}),t.showSendToLabButton&&e.push({text:" <b>Send to Lab </b>",className:"send-lab text-white",attr:{id:"send-to-lab-btn"},action:async()=>{await P()}}),{responsive:!0,select:!1,layout:{topStart:"buttons",topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1,buttons:e}}),I=()=>{var e;const t=14===(null===(e=ce().activeProgram)||void 0===e?void 0:e.program_id)&&!i("Waiting for Laboratory"),a=document.getElementById("send-to-lab-btn");a&&(t&&W.value?a.style.display="inline":a.style.display="none")},J=async()=>{await ie(_e,{class:"large-medium-width-modal"},!0),await X()},P=async()=>{"Confirm"==await de("Do you want to send this patient to the lab?",{confirmBtnLabel:"Send to Lab",returnName:!0})&&await V()},V=async()=>{try{const e=String(localStorage.getItem("locationID"));if(!e)return void ne("Location not found");await ae.addPatientToStage(d.value,"LAB"),await l.refresh(e),await a.push("home"),te("The patient successfully sent to the lab. You may now attend to other patients.")}catch(e){console.error("Error sending to lab:",e),ne("Failed to send patient to lab")}},W=F(()=>{const e=y.value;if(!e)return!1;const t=[...e.saved||[],...e.unsaved||[]];return 0!==t.length&&t.some(e=>!(null==e||!e.tests||!Array.isArray(e.tests))&&e.tests.some(e=>!(null!=e&&e.result)||0===e.result.length))}),K=async()=>{var e,t,a;if(null===(e=d.value)||void 0===e||!e.labOrders)return;if(v.value=[...null===(t=d.value)||void 0===t||null===(t=t.labOrders)||void 0===t?void 0:t.saved,...null===(a=d.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.unsaved],!v.value)return;const n=await v.value.filter(e=>re.toStandardHisFormat(re.sessionDate())===re.toStandardHisFormat(e.order_date));n.length>0?r.value[0].selectedData=n:r.value[0].selectedData=""},U=(e,t,a)=>e.filter(e=>(e.order_date===a&&(e.tests=e.tests.filter(e=>e.name!==t)),e.tests.length>0)),X=async()=>{if(!d.value.labOrders)return;v.value=[...d.value.labOrders.saved,...d.value.labOrders.unsaved];const e=ee(v.value),t=(32==Q.getProgramID()?[["FBS","Blood","","","","",`<button class="btn btn-outline-success btn-sm order-btn" data-id='${JSON.stringify({name:"FBS",specimen:"Blood"})}'>Order Test</button> `],["HbA1c","Blood","","","","",`<button class="btn btn-outline-success btn-sm order-btn" data-id='${JSON.stringify({name:"HbA1c",specimen:"Blood"})}'>Order Test</button> `],["RBS","Blood","","","","",`<button class="btn btn-outline-success btn-sm order-btn" data-id='${JSON.stringify({name:"RBS",specimen:"Blood"})}'>Order Test</button> `]]:[]).filter(t=>!e.some(e=>e[0]===t[0]));c.value=[...e,...t],I(),await K(),M.use(R)},ee=(e,t)=>e.length>0?e.flatMap(e=>e.tests.flatMap(t=>{var a,n;const o=`<button class="btn btn-outline-success btn-sm result-btn" data-id='${JSON.stringify(e)}'>Enter Result</button> `,s=`<button class="btn btn-outline-secondary btn-sm view-btn" data-id='${JSON.stringify(t)}'>${h.view2}</button> `;let l=o;var i;1==(null==t||null===(a=t.result)||void 0===a?void 0:a.length)?l=null!=(null==t?void 0:t.result)?(null==t||null===(i=t.result[0])||void 0===i?void 0:i.value)||"":null:(null==t||null===(n=t.result)||void 0===n?void 0:n.length)>1&&(null==t||t.result,l=s);let d="";return null!=e&&e.accession_number&&(d=`<button class="btn btn-outline-secondary btn-sm" data-id='${JSON.stringify(e)}'>${h.print2}</button>`),[[null==t?void 0:t.name,null==e?void 0:e.specimen.name,(null==e?void 0:e.accession_number)||"",9==(null==e?void 0:e.order_type_id)?"<span class='red-tag'>HTS</span>":"",re.toStandardHisFormat(null==e?void 0:e.order_date),l,d+`\n                        <button class="btn btn-outline-danger btn-sm delete-btn" data-id='${JSON.stringify(e)}'>${h.delete2}</button>\n                        `]]})):[];return N(async()=>{14==Q.getProgramID()&&w.value.buttons.push(),await K(),await X(),z(()=>{const e=u.value.dt;e.columns.adjust().draw(),e.on("click",".result-btn",async e=>{const t=e.target.getAttribute("data-id");await ie(ve,{class:"mediumAutoHeightModal"},!0,{test_data:JSON.parse(t)})}),e.on("click",".view-btn",e=>{const t=e.target.getAttribute("data-id");m.value=JSON.parse(t),f.value=!0}),e.on("click",".delete-btn",e=>{const t=e.target.getAttribute("data-id");(async(e,t)=>{if(await pe(`Do you want to delete ${e.tests[0].name} ?`,t)){const t=JSON.parse(JSON.stringify(d.value));var a,n,o;t.labOrders.saved.some(t=>{var a,n;return t.order_date===e.order_date&&(null==t||null===(a=t.tests[0])||void 0===a?void 0:a.name)==(null==e||null===(n=e.tests[0])||void 0===n?void 0:n.name)})?(t.labOrders.saved=U(t.labOrders.saved,e.tests[0].name,e.order_date),null!==(n=(a=null!==(o=t.labOrders)&&void 0!==o?o:t.labOrders={}).voided)&&void 0!==n||(a.voided=[]),t.labOrders.voided.push({orderId:e.id,reason:"Mistake entry"})):t.labOrders.unsaved=U(t.labOrders.unsaved,e.tests[0].name,e.date),await se(t)}await X()})(JSON.parse(t),e)}),e.on("click",".order-btn",e=>{const t=e.target.getAttribute("data-id");(async e=>{const t=[{concept_id:await oe.getConceptID(e.name,!0),name:e.name,specimen:e.specimen,reason:"Routine",specimenConcept:await oe.getConceptID(e.specimen,!0)}];let a=(await Z.buildLabOrders("",t))[0];if(a.order_date=a.date||re.sessionDate(),a.specimen.name||(a.specimen.name=await oe.getConceptName(a.specimen.concept_id)),a.tests&&a.tests.length>0)for(let n=0;n<a.tests.length;n++)a.tests[n].name||(a.tests[n].name=await oe.getConceptName(a.tests[n].concept_id));d.value.labOrders.unsaved.push(a),await se(d.value),await X()})(JSON.parse(t))})}),v.value=t.propOrders,g.value=new ue(d.value.patientID),b.value=await Q.getUserRoles()}),A(()=>n,async()=>{await X()},{deep:!0,immediate:!0}),A(()=>d,async()=>{await X()},{deep:!0,immediate:!0}),A(()=>{var e,t;return[null===(e=d.value)||void 0===e||null===(e=e.labOrders)||void 0===e?void 0:e.saved,null===(t=d.value)||void 0===t||null===(t=t.labOrders)||void 0===t?void 0:t.unsaved]},()=>{z(()=>{I()})},{deep:!0,immediate:!0}),A(W,e=>{console.log("hasTestsWithoutResults changed:",e),z(()=>{I()})},{deep:!0,immediate:!0}),(e,t)=>(_(),T("div",xe,[O("div",Se,[S(E(M),{ref_key:"dataTable",ref:u,options:w.value,data:c.value,class:"display nowrap modern-table",width:"100%"},{default:x(()=>[O("thead",null,[O("tr",null,[(_(!0),T(B,null,C(p.value,e=>(_(),T("th",{key:e},k(e),1))),128))])])]),_:1},8,["options","data"])]),S(he,{popoverOpen:f.value,content:m.value,onCloseModal:t[0]||(t[0]=e=>f.value=!1)},null,8,["popoverOpen","content"])]))}});e("default",V(Oe,[["__scopeId","data-v-054ff036"]]))}}});

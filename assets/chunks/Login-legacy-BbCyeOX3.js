System.register(["./vendor-legacy-DjGXx6Xl.js","../index-legacy-OwzSed-e.js","./Img-legacy-BNmikZ_d.js","./userService-legacy-CzRKSoJi.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-CnQpVQ3m.js"],function(e,a){"use strict";var t,l,s,n,r,o,i,u,d,c,v,p,m,f,g,w,h,b,y,P,x,A,k,_,I,S,C,M,q,U,E,L,z,R,j,D,F,N,$,H,O,T,K,G,B,J,Q,W,Y,Z;return{setters:[e=>{t=e.D,l=e.d,s=e.r,n=e.ao,r=e.c,o=e.a,i=e.H,u=e.O,d=e.f,c=e.J,v=e.l,p=e.u,m=e.a3,f=e.k,g=e.bq,w=e.aU,h=e.e,b=e.m,y=e.dn,P=e.E,x=e.Q,A=e.K,k=e.b2,_=e.W,I=e.c$,S=e.bF,C=e.c6,M=e.c5,q=e.N,U=e.bs,E=e.p,L=e.a6},e=>{z=e.v,R=e.a1,j=e.a2,D=e.t,F=e.U,N=e.G,$=e.a3,H=e.s,O=e.a4,T=e.a5,K=e.a6,G=e.S,B=e.a,J=e.a7,Q=e._},e=>{W=e.i},e=>{Y=e.p,Z=e.g},null,null],execute:function(){var a=document.createElement("style");a.textContent='.login-page[data-v-79b80d99]{background-color:#fff}.login-container[data-v-79b80d99]{display:flex;justify-content:center;align-items:center;text-align:center;height:90vh}.login-title[data-v-79b80d99]{font-size:24px;margin-bottom:30px;font-weight:700;margin-top:20px}.input-fields[data-v-79b80d99]{margin-bottom:35px}.invalid-input[data-v-79b80d99]{--border-color: #ff4444 !important;--color: #ff4444 !important}.password-requirements[data-v-79b80d99]{text-align:left;margin-bottom:20px;padding:15px;background-color:#f8f9fa;border-radius:8px;border-left:4px solid #34af4d}.requirements-title[data-v-79b80d99]{margin:0 0 10px;font-weight:600;color:#333;font-size:14px}.requirements-list[data-v-79b80d99]{margin:0;padding-left:20px;list-style:none}.requirements-list li[data-v-79b80d99]{margin-bottom:5px;font-size:13px;color:#666;position:relative}.requirements-list li[data-v-79b80d99]:before{content:"✗";color:#f44;font-weight:700;position:absolute;left:-20px}.requirements-list li.valid[data-v-79b80d99]:before{content:"✓";color:#34af4d}.requirements-list li.valid[data-v-79b80d99]{color:#34af4d}.password-toggle[data-v-79b80d99]{cursor:pointer;position:absolute;margin-top:-73px;margin-left:130px;z-index:1000}.login-button[data-v-79b80d99]{color:#fff;margin-top:30px}.login-button[data-v-79b80d99]:disabled{opacity:.5;cursor:not-allowed}.signup-link[data-v-79b80d99]{margin-top:50px}.signup-link a[data-v-79b80d99]{text-decoration:underline;color:#34af4d;cursor:pointer}.signup-link a[data-v-79b80d99]:hover{color:#2d8f3f}.password-toggle[data-v-79b80d99]{font-size:20px}.login_img[data-v-79b80d99]{width:90px;margin:auto}ion-card[data-v-79b80d99]{min-width:330px}@media(max-width:902px){.login-page[data-v-79b80d99]{--ion-background-color: #ffffff}ion-card[data-v-79b80d99]{box-shadow:unset}}\n/*$vite$:1*/',document.head.appendChild(a);const V=t("authStatusStore",{state:()=>({emrAuthenticated:!1,miumAuthenticated:!1,lastLoginAttempt:null,loginTimestamp:null,username:""}),getters:{isPartiallyAuthenticated:e=>e.emrAuthenticated||e.miumAuthenticated,isFullyAuthenticated:e=>e.emrAuthenticated&&e.miumAuthenticated,authenticationStatus:e=>e.emrAuthenticated&&e.miumAuthenticated?"full":e.emrAuthenticated||e.miumAuthenticated?"partial":"none",authenticatedSystems:e=>{const a=[];return e.emrAuthenticated&&a.push("EMR"),e.miumAuthenticated&&a.push("MIUM"),a},failedSystems:e=>{const a=[];return e.emrAuthenticated||a.push("EMR"),e.miumAuthenticated||a.push("MIUM"),a}},actions:{setEMRAuthenticated(e){this.emrAuthenticated=e,e&&(this.loginTimestamp=new Date)},setMIUMAuthenticated(e){this.miumAuthenticated=e},setUsername(e){this.username=e},recordLoginAttempt(){this.lastLoginAttempt=new Date},clearAuthStatus(){this.emrAuthenticated=!1,this.miumAuthenticated=!1,this.loginTimestamp=null,this.lastLoginAttempt=null,this.username=""},hasSystemAccess(e){return"EMR"===e?this.emrAuthenticated:this.miumAuthenticated}},persist:!0}),X={class:"login-container"},ee={key:0,style:{"justify-content":"center",display:"block"}},ae={style:{"font-size":"15px"}},te={style:{"font-size":"12px",color:"#34af4d"}},le={key:1},se={style:{"font-size":"15px"}},ne={key:0},re={style:{"text-align":"left"}},oe={class:"signup-link"},ie={style:{display:"flex","justify-content":"center","align-items":"center"}},ue={key:1},de={style:{"text-align":"left"}},ce={key:0,class:"password-requirements"},ve={class:"requirements-list"},pe={class:"signup-link"};e("default",Q(l({__name:"Login",setup(e){const a=s(""),t=s(""),l=s(""),Q=s(!1),me=s(!1),fe=s("test"),ge=s(new J),we=s({username:"",currentPassword:"",newPassword:"",confirmPassword:""}),he=s(!1),be=s(!1),ye=s(!1),Pe=n(),xe=z(),Ae=R(),ke=r(()=>""!==we.value.username.trim()&&""!==we.value.currentPassword.trim()&&""!==we.value.newPassword.trim()&&""!==we.value.confirmPassword.trim()&&j(we.value.newPassword)&&we.value.newPassword===we.value.confirmPassword&&we.value.newPassword!==we.value.currentPassword),_e=()=>{me.value=!me.value,me.value&&(we.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""})},Ie=()=>{D("Help functionality to be implemented")},Se=async()=>{if(!ke.value)return D("Please complete all fields correctly"),void D("Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character.");try{const e=await ge.value.requestLogin(we.value.currentPassword,we.value.username);if(e){const{authorization:a}=e,{token:t,user:l}=a;l&&(localStorage.setItem("apiKey",t),await F.updateUser(l.user_id,{password:we.value.newPassword}),N("Password changed successfully!"),await ge.value.requestLogin(we.value.newPassword,we.value.username),we.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""},me.value=!1,localStorage.setItem("apiKey",""))}}catch(e){H(e instanceof $?"Current password is incorrect":`Error changing password: ${e}`)}},Ce=async()=>{const e=V();if(!a.value||!t.value)return{success:!1,error:null,validationError:!0};ge.value.setUsername(a.value),e.setUsername(a.value);try{return await ge.value.login(t.value),await(async()=>{const e=R(),a=await Z();a&&(e.setUserFacilityName(a.name),e.setFacilityLocation(a),localStorage.setItem("facility_code",a.code))})(),await(async()=>{const e=await ge.value.checkUserPrograms(void 0);null!=e&&e.programs&&B().setAuthorizedPrograms(null==e?void 0:e.programs)})(),await K(),await Y(),e.setEMRAuthenticated(!0),Ae.setLoginStatus(!0),{success:!0,error:null}}catch(l){return e.setEMRAuthenticated(!1),Ae.setLoginStatus(!1),{success:!1,error:l}}},Me=async()=>{if(G.getLanConnectionStatus()||G.getPouchDbStatus())return{success:!0,error:null};const e=V();if(!a.value||!t.value)return{success:!1,error:null,validationError:!0};ge.value.setUsername(a.value);try{return await ge.value.loginToMIUM(t.value),e.setMIUMAuthenticated(!0),{success:!0,error:null}}catch(l){return e.setMIUMAuthenticated(!1),{success:!1,error:l}}},qe=async()=>{const e=V();if(!a.value||!t.value)return void D("Complete form to log in");e.recordLoginAttempt();const[l,s]=await Promise.allSettled([Ce(),Me()]),n="fulfilled"===l.status&&l.value.success,r="fulfilled"===s.status&&s.value.success;if(n)Pe.push("/home");else if(n||r)!n&&r&&("fulfilled"===l.status?l.value.error:l.reason);else{const e="fulfilled"===l.status?l.value.error:l.reason;e instanceof $?H("Invalid username or password"):e instanceof O?(_e(),H("Please change your password",5e4)):e instanceof T?(_e(),H("Your password has expired. Please change your password",5e4)):H(`${e}`,5e4)}};return o(async()=>{Ae.checkLoginStatus()&&Pe.push("/home"),Ae.setLoginStatus(!1),await ge.value.loadConfig(),l.value=localStorage.getItem("core_version")||"",await(async()=>{xe.terminate(),await z().postData("SET_OFFLINE_PROGRAMS")})()}),(e,s)=>{const n=i("ion-icon");return d(),u(p(L),null,{default:c(()=>[v(p(m),{class:"ion-padding login-page"},{default:c(()=>[f("div",X,[v(p(g),{style:{"background-color":"#fff"}},{default:c(()=>[v(p(w),null,{default:c(()=>[v(p(y),{class:"login_img",src:p(W)("mw.png"),id:"logo"},null,8,["src"]),v(p(P),{class:"login-title"},{default:c(()=>["development"===fe.value||"test"===fe.value?(d(),h("span",ee,[f("div",null,[s[11]||(s[11]=x(" MaHIS ",-1)),f("small",ae,"(v"+A(l.value)+")",1)]),f("div",te,"("+A(fe.value)+")",1)])):(d(),h("span",le,[s[12]||(s[12]=x(" MaHIS ",-1)),f("small",se,"(v"+A(l.value)+")",1)]))]),_:1}),me.value?b("",!0):(d(),h("div",ne,[f("span",re,[v(p(k),{value:a.value,onIonInput:s[0]||(s[0]=e=>a.value=e.target.value||""),type:"text",label:"Username",ref:"usernameRef","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:c(()=>[v(p(_),{slot:"end"},{default:c(()=>[v(n,{icon:p(I)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),v(p(k),{value:t.value,onIonInput:s[2]||(s[2]=e=>t.value=e.target.value||""),type:Q.value?"text":"password",label:"Password",ref:"passwordRef","label-placement":"floating",fill:"outline",placeholder:"Enter Password",class:"input-fields",required:"",onKeydown:S(qe,["enter"])},{default:c(()=>[v(p(_),{slot:"end"},{default:c(()=>[v(n,{icon:Q.value?p(C):p(M),onClick:s[1]||(s[1]=e=>Q.value=!Q.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"])]),v(p(q),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:qe,class:"login-button"},{default:c(()=>[...s[13]||(s[13]=[x(" Login ",-1)])]),_:1}),f("p",oe,[s[17]||(s[17]=x(" For help click ",-1)),f("a",{href:"#",onClick:U(Ie,["prevent"])},"Here"),s[18]||(s[18]=x()),s[19]||(s[19]=f("br",null,null,-1)),f("div",ie,[v(p(q),{fill:"clear",size:"small",onClick:_e,style:{display:"inline","--padding-start":"2px","--padding-end":"2px"}},{default:c(()=>[...s[14]||(s[14]=[f("span",{style:{"text-decoration":"underline",color:"#34af4d",cursor:"pointer"}}," Change Password ",-1)])]),_:1}),s[16]||(s[16]=x(" | ",-1)),v(p(q),{fill:"clear",size:"small",onClick:s[3]||(s[3]=e=>{return a="/downloads",void Pe.push(a);var a}),style:{display:"inline","--padding-start":"2px","--padding-end":"2px"}},{default:c(()=>[...s[15]||(s[15]=[f("span",{style:{"text-decoration":"underline",color:"#34af4d",cursor:"pointer"}}," Download MaHIS ",-1)])]),_:1})])])])),me.value?(d(),h("div",ue,[s[22]||(s[22]=f("h3",{style:{"text-align":"center","margin-bottom":"20px",color:"#34af4d"}},"Change Password",-1)),f("span",de,[v(p(k),{value:we.value.username,onIonInput:s[4]||(s[4]=e=>we.value.username=e.target.value||""),type:"text",label:"Username","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:c(()=>[v(p(_),{slot:"end"},{default:c(()=>[v(n,{icon:p(I)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),v(p(k),{value:we.value.currentPassword,onIonInput:s[6]||(s[6]=e=>we.value.currentPassword=e.target.value||""),type:he.value?"text":"password",label:"Current Password","label-placement":"floating",fill:"outline",placeholder:"Enter Current Password",class:"input-fields",required:""},{default:c(()=>[v(p(_),{slot:"end"},{default:c(()=>[v(n,{icon:he.value?p(C):p(M),onClick:s[5]||(s[5]=e=>he.value=!he.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"]),v(p(k),{value:we.value.newPassword,onIonInput:s[8]||(s[8]=e=>we.value.newPassword=e.target.value||""),type:be.value?"text":"password",label:"New Password","label-placement":"floating",fill:"outline",placeholder:"Enter New Password",class:E(["input-fields",{"invalid-input":we.value.newPassword&&!p(j)(we.value.newPassword)}]),required:""},{default:c(()=>[v(p(_),{slot:"end"},{default:c(()=>[v(n,{icon:be.value?p(C):p(M),onClick:s[7]||(s[7]=e=>be.value=!be.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"]),v(p(k),{value:we.value.confirmPassword,onIonInput:s[10]||(s[10]=e=>we.value.confirmPassword=e.target.value||""),type:ye.value?"text":"password",label:"Confirm New Password","label-placement":"floating",fill:"outline",placeholder:"Confirm New Password",class:E(["input-fields",{"invalid-input":we.value.confirmPassword&&we.value.newPassword!==we.value.confirmPassword}]),required:""},{default:c(()=>[v(p(_),{slot:"end"},{default:c(()=>[v(n,{icon:ye.value?p(C):p(M),onClick:s[9]||(s[9]=e=>ye.value=!ye.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"])]),we.value.newPassword?(d(),h("div",ce,[s[20]||(s[20]=f("p",{class:"requirements-title"},"Password Requirements:",-1)),f("ul",ve,[f("li",{class:E({valid:we.value.newPassword.length>=8})},"At least 8 characters",2),f("li",{class:E({valid:/[A-Z]/.test(we.value.newPassword)})},"One uppercase letter",2),f("li",{class:E({valid:/[0-9]/.test(we.value.newPassword)})},"One number",2),f("li",{class:E({valid:/[@#$%^&+=*!-]/.test(we.value.newPassword)})}," One special character (@#$%^&+=*!-) ",2),f("li",{class:E({valid:we.value.newPassword!==we.value.currentPassword&&""!==we.value.currentPassword})}," Different from current password ",2)])])):b("",!0),v(p(q),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:Se,class:"login-button",disabled:!ke.value},{default:c(()=>[...s[21]||(s[21]=[x(" Change Password ",-1)])]),_:1},8,["disabled"]),f("p",pe,[f("a",{href:"#",onClick:U(_e,["prevent"])},"Back to Login")])])):b("",!0)]),_:1})]),_:1})])]),_:1})]),_:1})}}}),[["__scopeId","data-v-79b80d99"]]))}}});

import{d as H,bH as L,r as S,c as j,w as $,e as b,m as O,f as h,k as s,l as f,u as c,aS as Fe,J as V,L as x,bp as Z,cB as Ne,Q as P,aR as Se,aV as ke,a4 as Ie,bO as Ve,N as q,b1 as xe,F as ee,P as te,K as F,cM as $e,a as le,O as Y,am as Re,cr as Be,fg as Le,bq as He,fh as ze,bT as Ge,de as qe,ab as Ue,ae as Qe,b2 as We,eU as Ke,H as X}from"./vendor-BTebhqHt.js";import{u as Te,P as Ae,_ as ae,V as Pe,z as U,T as Ye,t as me,a5 as fe,H as oe,b as pe,S as je,ch as Je,an as Xe,F as Ze,w as et}from"../index-CDqf5wLI.js";import{N as ve}from"./neonatal_service-CCQ9wqYK.js";import{D as tt}from"./DemographicBar-DZ_MDCk1.js";import{c as E,N as at}from"./NeonatalStepper-CCdzAGyo.js";import{n as z}from"./enrollment-DU-PLRUa.js";import{I as ne}from"./images-Zb0Yk5XL.js";import{u as Ee}from"./useNeonatalEnrollmentStore-CfCsBxiA.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-no8IW45T.js";import"./SaveProgressModal-BNIvWrSZ.js";const rt={key:0,class:"twin-search-container"},ot={style:{border:"1px dotted #ececec","border-radius":"8px"}},st={class:"header-with-icon"},nt={class:"icon-wrapper"},lt=["src"],it={class:"search-with-button"},ut={class:"search-wrapper"},ct={key:0,class:"search-results"},dt={key:0,class:"search-loading"},mt={key:1,class:"results-list"},ft=["onClick"],pt={class:"result-header"},vt={class:"twin-name"},ht={class:"twin-mrn"},_t={class:"twin-dob"},gt={class:"result-details"},yt={key:0,class:"twin-gender"},Dt={key:2,class:"no-results"},bt={key:1,class:"selected-twin"},wt={class:"selected-card"},Ft={class:"selected-card-header"},Nt={class:"header-content"},St={class:"selected-icon-wrapper"},kt=["src"],It={class:"selected-card-content"},Vt={class:"patient-info-grid"},$t={class:"info-row"},Rt={class:"info-value"},Tt={class:"info-row"},At={class:"info-value"},Pt={key:0,class:"info-row"},Et={class:"info-value"},Ct={key:1,class:"info-row"},Ot={class:"info-value"},Mt=H({__name:"TwinSearch",setup(m,{expose:N}){const a=L(z),y=Te(),t=S(""),_=S(!1),e=S([]),l=S(null),o=S(!1),n=j(()=>(a==null?void 0:a.hasTwin)==="Yes"),R=async()=>{if(!t.value||t.value.trim().length<2){e.value=[];return}_.value=!0;try{const p=t.value.trim();if(/^\d+$/.test(p))try{const i=await y.getPatientData(Number(p));if(i&&i.personInformation){const v=i.personInformation;e.value=[{patientID:v.person_id,firstName:v.given_name||"",middleName:v.middle_name||"",lastName:v.family_name||"",gender:v.gender,birthdate:v.birthdate}]}else e.value=[]}catch(i){console.error("Error searching by MRN:",i),e.value=[]}else{const i=p.split(" "),v={given_name:i[0],family_name:i[1]||"",page:"1",per_page:"20"},A=await Ae.search(v);e.value=Array.isArray(A)?A.filter(g=>{const k=g.person;if(!k.birthdate)return!1;const M=new Date(k.birthdate);return Math.floor((Date.now()-M.getTime())/(1e3*60*60*24))<=7}).map(g=>{var u;const k=g.person,M=((u=k.names)==null?void 0:u[0])||{};return{patientID:k.person_id,firstName:M.given_name||"",middleName:M.middle_name||"",lastName:M.family_name||"",gender:k.gender,birthdate:k.birthdate}}):[]}}catch(p){console.error("Error searching for twin:",p),e.value=[]}finally{_.value=!1}},G=p=>{l.value=p,t.value="",o.value=!1,a&&(a.twinPatientId=p.patientID,a.twinName="".concat(p.firstName," ").concat(p.middleName||""," ").concat(p.lastName).trim())},w=()=>{l.value=null,o.value=!1,a&&(a.twinPatientId=void 0,a.twinName=void 0)},r=()=>{o.value=!0,l.value=null,t.value="",a&&(a.twinPatientId=void 0,a.twinName=void 0)};$(()=>a==null?void 0:a.hasTwin,p=>{p!=="Yes"&&(w(),o.value=!1)});const D=p=>"".concat(p.firstName," ").concat(p.middleName||""," ").concat(p.lastName).trim(),C=p=>p?new Date(p).toLocaleDateString():"";return N({validateForm:()=>(a==null?void 0:a.hasTwin)==="Yes"&&!l.value&&!o.value?{twinSelection:"Select the twin record or tap Skip if the twin is not yet registered"}:null,getFormValues:()=>l.value?{twinPatientId:l.value.patientID,twinName:D(l.value)}:{}}),(p,i)=>n.value?(h(),b("div",rt,[s("div",ot,[f(c(Fe),null,{default:V(()=>[s("div",st,[s("div",nt,[s("img",{src:c(ne).icons.twins,alt:"Twin",class:"header-icon"},null,8,lt),f(c(x),{icon:c(Z),class:"search-badge-icon"},null,8,["icon"])]),s("div",null,[f(c(Ne),null,{default:V(()=>[...i[1]||(i[1]=[P("Twin Information",-1)])]),_:1}),f(c(Se),null,{default:V(()=>[...i[2]||(i[2]=[P("Search for twin sibling",-1)])]),_:1})])])]),_:1}),f(c(ke),null,{default:V(()=>[f(c(Ie),{class:"info-note"},{default:V(()=>[...i[3]||(i[3]=[P(" This baby has a twin. Please search for the twin's record or register if not found. ",-1)])]),_:1}),s("div",it,[s("div",ut,[f(c(Ve),{modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=v=>t.value=v),placeholder:"Search for twin's MRN or scan barcode",onIonInput:R,debounce:300,"show-clear-button":"focus",class:"search-input"},null,8,["modelValue"])]),f(c(q),{color:"primary",onClick:r,class:"skip-btn"},{default:V(()=>[i[4]||(i[4]=P(" Skip ",-1)),f(c(x),{size:"small",icon:c(xe),slot:"end"},null,8,["icon"])]),_:1})]),t.value&&t.value.length>0&&!l.value?(h(),b("div",ct,[_.value?(h(),b("div",dt,[(h(),b(ee,null,te(3,v=>s("div",{key:"skeleton-".concat(v),class:"result-item-skeleton"},[...i[5]||(i[5]=[s("div",{class:"skeleton-header"},[s("div",{class:"skeleton-name"}),s("div",{class:"skeleton-dob"})],-1)])])),64))])):e.value.length>0?(h(),b("div",mt,[(h(!0),b(ee,null,te(e.value,(v,A)=>(h(),b("div",{key:v.patientID||A,class:"result-item",onClick:g=>G(v)},[s("div",pt,[s("span",vt,F(D(v)),1),s("span",ht,"MRN: "+F(v.patientID),1),s("span",_t,"DOB: "+F(C(v.birthdate)),1)]),s("div",gt,[v.gender?(h(),b("p",yt,[i[6]||(i[6]=s("strong",null,"Gender:",-1)),P(" "+F(v.gender),1)])):O("",!0)])],8,ft))),128))])):(h(),b("div",Dt,[f(c(x),{icon:c(Z),class:"no-results-icon"},null,8,["icon"]),s("p",null,'No patients found matching "'+F(t.value)+'"',1),i[7]||(i[7]=s("p",{class:"info-text"},"The twin may not be registered yet. You can skip this step and register the twin later.",-1))]))])):O("",!0),l.value?(h(),b("div",bt,[s("div",wt,[s("div",Ft,[s("div",Nt,[s("div",St,[s("img",{src:c(ne).icons.twins,alt:"Twin",class:"selected-header-icon"},null,8,kt)]),i[8]||(i[8]=s("div",{class:"header-separator"},null,-1)),i[9]||(i[9]=s("span",{class:"selected-subtitle"},"Twin Selected",-1))]),f(c(q),{fill:"clear",size:"small",onClick:w,class:"clear-selection-btn"},{default:V(()=>[f(c(x),{icon:c($e)},null,8,["icon"])]),_:1})]),s("div",It,[s("div",Vt,[s("div",$t,[i[10]||(i[10]=s("span",{class:"info-label"},"Full Name",-1)),s("span",Rt,F(D(l.value)),1)]),s("div",Tt,[i[11]||(i[11]=s("span",{class:"info-label"},"MRN",-1)),s("span",At,F(l.value.patientID),1)]),l.value.birthdate?(h(),b("div",Pt,[i[12]||(i[12]=s("span",{class:"info-label"},"Date of Birth",-1)),s("span",Et,F(C(l.value.birthdate)),1)])):O("",!0),l.value.gender?(h(),b("div",Ct,[i[13]||(i[13]=s("span",{class:"info-label"},"Gender",-1)),s("span",Ot,F(l.value.gender),1)])):O("",!0)])])])])):O("",!0)]),_:1})])])):O("",!0)}}),xt=ae(Mt,[["__scopeId","data-v-ed5f0376"]]),T=m=>{var N,a,y;if(!(m==null||m==="")){if(typeof m=="string"||typeof m=="number")return m.toString();if(typeof m=="object"){const t=(y=(a=(N=m.label)!=null?N:m.value)!=null?a:m.name)!=null?y:m.title;if(t!=null&&t!=="")return t.toString()}}},Ce=m=>{if(!m)return[];if(Array.isArray(m))return m.map(a=>T(a)).filter(a=>!!a);const N=T(m);return N?[N]:[]},K=m=>m==null?"":m.toString(),Bt={class:"birth-details-wrapper"},Lt=H({__name:"BirthDetails",setup(m,{expose:N}){const a=S(null),y=S(null),t=S(null),_=E[0].formData,e=_.slice(0,1),l=_.slice(1),o=L(z),n=S([]);le(async()=>{try{const r=await Pe.getAllFacilities();Array.isArray(r)?n.value=r:r!=null&&r.facilities&&Array.isArray(r.facilities)?n.value=r.facilities:r!=null&&r.records&&Array.isArray(r.records)?n.value=r.records:n.value=[]}catch(r){console.error("Error loading facilities:",r),n.value=[]}});const R=j(()=>l.map(r=>r.name==="birthFacility"?{...r,options:n.value.map(D=>{const C=D.name||D.facility_name||"Unknown";return{name:C,label:C,value:D.id||D.facility_id||C,code:D.code||D.facility_code,district:D.district||D.district_name}})}:r)),G=r=>{o&&(o.hasTwin=r.hasTwin||"")},w=r=>{o&&(o.placeOfBirth=T(r.placeOfBirth)||"",o.nameOfBirthFacility=T(r.birthFacility)||"",o.typeOfBirth=T(r.typeOfBirth)||"",o.birthWeight=K(r.birthWeight||""),o.timeOfBirth=K(r.birthTime||""))};return $(()=>{var r;return(r=y.value)==null?void 0:r.formValues},r=>{r&&w(r)},{deep:!0}),$(()=>y.value,r=>{r!=null&&r.getFormValues&&w(r.getFormValues())},{immediate:!0}),$(()=>{var r;return(r=a.value)==null?void 0:r.formValues},r=>{r&&G(r)},{deep:!0}),$(()=>a.value,r=>{r!=null&&r.getFormValues&&G(r.getFormValues())},{immediate:!0}),N({getFormRef:()=>y.value,getTwinQuestionFormRef:()=>a.value,validateForm:()=>{var i,v,A,g,k,M;const r=((v=(i=a.value)==null?void 0:i.validateForm)==null?void 0:v.call(i))||null,D=((g=(A=y.value)==null?void 0:A.validateForm)==null?void 0:g.call(A))||null,C=((M=(k=t.value)==null?void 0:k.validateForm)==null?void 0:M.call(k))||null,p=[r,D,C].filter(Boolean);return p.length?p.reduce((u,d)=>({...u,...d}),{}):null},getFormValues:()=>{var p,i,v,A,g,k;const r=((i=(p=a.value)==null?void 0:p.getFormValues)==null?void 0:i.call(p))||{},D=((A=(v=y.value)==null?void 0:v.getFormValues)==null?void 0:A.call(v))||{},C=((k=(g=t.value)==null?void 0:g.getFormValues)==null?void 0:k.call(g))||{};return{...r,...D,...C}}}),(r,D)=>(h(),b("div",Bt,[f(U,{formData:c(e),ref_key:"twinQuestionFormRef",ref:a,class:"twin-question-form"},null,8,["formData"]),f(xt,{ref_key:"twinSearchRef",ref:t},null,512),f(U,{formData:R.value,ref_key:"formRef",ref:y,class:"main-form"},null,8,["formData"])]))}}),he=ae(Lt,[["__scopeId","data-v-9a714757"]]),_e=H({__name:"ReferralInformation",setup(m,{expose:N}){const a=S(null),y=E[1].formData,t=L(z),_=S([]);le(async()=>{try{const o=await Pe.getAllFacilities();Array.isArray(o)?_.value=o:o!=null&&o.facilities&&Array.isArray(o.facilities)?_.value=o.facilities:o!=null&&o.records&&Array.isArray(o.records)?_.value=o.records:_.value=[]}catch(o){console.error("Error loading facilities:",o),_.value=[]}});const e=j(()=>y.map(o=>o.name==="referringFacilityName"?{...o,options:_.value.map(n=>{const R=n.name||n.facility_name||"Unknown";return{name:R,label:R,value:n.id||n.facility_id||R,code:n.code||n.facility_code,district:n.district||n.district_name}})}:o)),l=o=>{if(!t)return;t.referredFromOtherFacility=o.referredFromAnotherFacility||"",t.referredFrom=T(o.referredFrom)||"";const n=o.referringFacilityName;t.referringFacilityName=(n==null?void 0:n.name)||K(n||""),t.modeOfTransport=T(o.modeOfTransport)||"",t.admittedFrom=T(o.admittedFrom)||""};return $(()=>{var o;return(o=a.value)==null?void 0:o.formValues},o=>{o&&l(o)},{deep:!0}),$(()=>a.value,o=>{o!=null&&o.getFormValues&&l(o.getFormValues())},{immediate:!0}),N({getFormRef:()=>a.value,validateForm:()=>{var o,n;return((n=(o=a.value)==null?void 0:o.validateForm)==null?void 0:n.call(o))||null},getFormValues:()=>{var o,n;return((n=(o=a.value)==null?void 0:o.getFormValues)==null?void 0:n.call(o))||{}}}),(o,n)=>(h(),Y(U,{formData:e.value,ref_key:"formRef",ref:a},null,8,["formData"]))}}),ge=H({__name:"BirthAssessment",setup(m,{expose:N}){const a=S(null),y=E[2].formData,t=L(z),_=e=>{t&&(t.criedAfterBirth=e.criedAfterBirth||"",t.apgarScoreAt1=T(e.apgar1)||"",t.apgarScoreAt5=T(e.apgar5)||"",t.apgarScoreAt10=T(e.apgar10)||"",t.resuscitationMethods=Ce(e.resuscitationMethods))};return $(()=>{var e;return(e=a.value)==null?void 0:e.formValues},e=>{e&&_(e)},{deep:!0}),$(()=>a.value,e=>{e!=null&&e.getFormValues&&_(e.getFormValues())},{immediate:!0}),N({getFormRef:()=>a.value,validateForm:()=>{var e,l;return((l=(e=a.value)==null?void 0:e.validateForm)==null?void 0:l.call(e))||null},getFormValues:()=>{var e,l;return((l=(e=a.value)==null?void 0:e.getFormValues)==null?void 0:l.call(e))||{}}}),(e,l)=>(h(),Y(U,{formData:c(y),ref_key:"formRef",ref:a},null,8,["formData"]))}}),Ht={class:"mother-search-container"},zt={style:{border:"1px dotted #ececec","border-radius":"8px"}},Gt={class:"header-with-icon"},qt={class:"icon-wrapper"},Ut=["src"],Qt={class:"search-with-button"},Wt={class:"search-wrapper"},Kt={class:"barcode-btn","aria-label":"Scan MRN"},Yt={key:0,class:"search-results"},jt={key:0,class:"search-loading"},Jt={key:1,class:"results-list"},Xt=["onClick"],Zt={class:"result-header"},ea={class:"mother-name"},ta={class:"mother-dob"},aa={class:"mother-gender"},ra={class:"result-details"},oa={key:0,class:"mother-address"},sa={key:1,class:"mother-phone"},na={key:0,class:"pagination"},la={class:"page-info"},ia={key:2,class:"no-results"},ua={key:1,class:"selected-mother"},ca={class:"selected-card"},da={class:"selected-card-header"},ma={class:"selected-header-with-button"},fa={class:"selected-card-content"},pa={class:"selected-info"},va={key:0},ha={key:1},se=10,_a=H({__name:"MotherSearch",setup(m,{expose:N}){const a=Re(),y=Be(),t=L(z),_=Ee(),e=S(""),l=S(!1),o=S([]),n=S(null),R=S(1),G=async()=>{await new Promise(d=>setTimeout(d,50));const u=_.motherData;u&&u.patientID&&(n.value=u,await new Promise(d=>setTimeout(d,100)),_.clearEnrollmentContext())};le(async()=>{await G()}),$(()=>y.query.motherAdded,async u=>{u&&await G()}),$(n,u=>{u&&t&&(t.motherPatientId=u.patientID,t.motherName="".concat(u.firstName," ").concat(u.middleName||""," ").concat(u.lastName).trim(),t.motherNationalId=u.nationalId||"")});const w=j(()=>Math.ceil(o.value.length/se)),r=j(()=>{const u=(R.value-1)*se,d=u+se;return o.value.slice(u,d)}),D=async()=>{if(!e.value||e.value.trim().length<2){o.value=[];return}l.value=!0,R.value=1;try{const d=e.value.trim().split(" "),I={given_name:d[0],family_name:d[1]||"",page:"1",per_page:"50"},J=await Ae.search(I);o.value=Array.isArray(J)?J.filter(Q=>{var W;const B=((W=Q.person)==null?void 0:W.gender)||Q.gender;return B==="F"||B==="Female"}).map(Q=>{var ie,ue,ce;const B=Q.person,W=((ie=B.names)==null?void 0:ie[0])||{},Oe=((ue=B.addresses)==null?void 0:ue[0])||{},re=(ce=B.person_attributes)==null?void 0:ce.find(Me=>{var de;return((de=Me.person_attribute_type)==null?void 0:de.name)==="Cell Phone Number"});return{patientID:B.person_id,firstName:W.given_name||"",middleName:W.middle_name||"",lastName:W.family_name||"",gender:B.gender,birthdate:B.birthdate,nationalId:Q.national_id||"",address:Oe,phone:(re==null?void 0:re.value)||""}}):[]}catch(u){console.error("Error searching for mothers:",u),o.value=[]}finally{l.value=!1}},C=u=>{n.value=u,e.value="",t&&(t.motherPatientId=u.patientID,t.motherName="".concat(u.firstName," ").concat(u.middleName||""," ").concat(u.lastName).trim(),t.motherNationalId=u.nationalId||"")},p=()=>{n.value=null,t&&(t.motherPatientId=void 0,t.motherName=void 0,t.motherNationalId=void 0)},i=()=>{var d;const u=L("patient");u&&((d=u.value)!=null&&d.patientID)&&_.setMotherCreationContext(u.value.patientID,4),a.push({path:"/registration/manual",query:{returnTo:"/neonatal/enrollment",context:"neonatal-mother"}})},v=()=>{R.value<w.value&&R.value++},A=()=>{R.value>1&&R.value--},g=u=>u?new Date(u).toLocaleDateString():"",k=u=>{if(!u)return"";if(typeof u=="string")return u;const d=[];return u.city_village&&d.push(u.city_village),u.township_division&&d.push(u.township_division),u.state_province&&d.push(u.state_province),d.join(", ")};return N({getFormRef:()=>({validate:()=>n.value!==null,getFormData:()=>{var u,d;return{motherPatientId:(u=n.value)==null?void 0:u.patientID,motherName:n.value?"".concat(n.value.firstName," ").concat(n.value.middleName||""," ").concat(n.value.lastName).trim():void 0,motherNationalId:(d=n.value)==null?void 0:d.nationalId}}}),validateForm:()=>n.value?null:{motherSelection:"Please select a mother or register a new one"},getFormValues:()=>n.value?{motherPatientId:n.value.patientID,motherName:"".concat(n.value.firstName," ").concat(n.value.middleName||""," ").concat(n.value.lastName).trim(),motherNationalId:n.value.nationalId}:{}}),(u,d)=>(h(),b("div",Ht,[s("div",zt,[f(c(Fe),null,{default:V(()=>[s("div",Gt,[s("div",qt,[s("img",{src:c(ne).icons.care,alt:"Care",class:"header-icon"},null,8,Ut),f(c(x),{icon:c(Z),class:"search-badge-icon"},null,8,["icon"])]),s("div",null,[f(c(Ne),null,{default:V(()=>[...d[1]||(d[1]=[P("Search for Mother",-1)])]),_:1}),f(c(Se),null,{default:V(()=>[...d[2]||(d[2]=[P("Find mother's existing record",-1)])]),_:1})])])]),_:1}),f(c(ke),null,{default:V(()=>[f(c(Ie),{class:"info-note"},{default:V(()=>[...d[3]||(d[3]=[P(" We now need to link this neonate's record to it's mother, please search and find the mother or register if mother not found. ",-1)])]),_:1}),s("div",Qt,[s("div",Wt,[f(c(Ve),{modelValue:e.value,"onUpdate:modelValue":d[0]||(d[0]=I=>e.value=I),placeholder:"Search for mother's Name or scan MRN",onIonInput:D,debounce:300,"show-clear-button":"focus",class:"search-input"},null,8,["modelValue"]),s("div",Kt,[f(c(x),{color:"primary",size:"small",icon:c(Le),slot:"icon-only"},null,8,["icon"])])]),f(c(q),{color:"success",onClick:i,class:"new-registration-btn"},{default:V(()=>[f(c(x),{icon:c(He),slot:"icon-only"},null,8,["icon"]),d[4]||(d[4]=P("New Registration ",-1))]),_:1})]),e.value&&e.value.length>0&&!n.value?(h(),b("div",Yt,[l.value?(h(),b("div",jt,[(h(),b(ee,null,te(3,I=>s("div",{key:"skeleton-".concat(I),class:"result-item-skeleton"},[...d[5]||(d[5]=[s("div",{class:"skeleton-header"},[s("div",{class:"skeleton-name"}),s("div",{class:"skeleton-dob"}),s("div",{class:"skeleton-gender"})],-1),s("div",{class:"skeleton-details"},[s("div",{class:"skeleton-address"}),s("div",{class:"skeleton-phone"})],-1)])])),64))])):o.value.length>0?(h(),b("div",Jt,[(h(!0),b(ee,null,te(r.value,(I,J)=>(h(),b("div",{key:I.patientID||J,class:"result-item",onClick:Q=>C(I)},[s("div",Zt,[s("span",ea,F(I.firstName)+" "+F(I.middleName?I.middleName+" ":"")+F(I.lastName),1),s("span",ta,"DOB "+F(g(I.birthdate)),1),s("span",aa,F(I.gender==="F"?"Female":I.gender),1)]),s("div",ra,[I.address?(h(),b("p",oa,[d[6]||(d[6]=s("strong",null,"Current Address:",-1)),P(" "+F(k(I.address)),1)])):O("",!0),I.phone?(h(),b("p",sa,[f(c(x),{icon:c(ze)},null,8,["icon"]),P(" "+F(I.phone),1)])):O("",!0)])],8,Xt))),128)),w.value>1?(h(),b("div",na,[f(c(q),{fill:"outline",size:"small",onClick:A,disabled:R.value===1},{default:V(()=>[f(c(x),{icon:c(Ge)},null,8,["icon"])]),_:1},8,["disabled"]),s("span",la,"Page "+F(R.value)+" of "+F(w.value),1),f(c(q),{fill:"outline",size:"small",onClick:v,disabled:R.value===w.value},{default:V(()=>[f(c(x),{icon:c(qe)},null,8,["icon"])]),_:1},8,["disabled"])])):O("",!0)])):(h(),b("div",ia,[f(c(x),{icon:c(Z),class:"no-results-icon"},null,8,["icon"]),s("p",null,'No mothers found matching "'+F(e.value)+'"',1),f(c(q),{expand:"block",onClick:i},{default:V(()=>[...d[7]||(d[7]=[P("Register new mother",-1)])]),_:1})]))])):O("",!0),n.value?(h(),b("div",ua,[s("div",ca,[s("div",da,[s("div",ma,[d[8]||(d[8]=s("span",{class:"selected-subtitle"},"Selected Mother",-1)),f(c(q),{fill:"clear",size:"small",color:"danger",onClick:p,class:"clear-selection-btn"},{default:V(()=>[f(c(x),{icon:c($e),slot:"icon-only"},null,8,["icon"])]),_:1})])]),s("div",fa,[s("div",pa,[s("h3",null,F(n.value.firstName)+" "+F(n.value.middleName?n.value.middleName+" ":"")+F(n.value.lastName),1),s("p",null,[d[9]||(d[9]=s("strong",null,"MRN:",-1)),P(" "+F(n.value.patientID),1)]),n.value.birthdate?(h(),b("p",va,[d[10]||(d[10]=s("strong",null,"DOB:",-1)),P(" "+F(g(n.value.birthdate)),1)])):O("",!0),n.value.address?(h(),b("p",ha,[d[11]||(d[11]=s("strong",null,"Address:",-1)),P(" "+F(k(n.value.address)),1)])):O("",!0)])])])])):O("",!0)]),_:1})])]))}}),ye=ae(_a,[["__scopeId","data-v-2bf8e305"]]),De=H({__name:"Pregnancy",setup(m,{expose:N}){const a=S(null),y=E[4].formData,t=L(z),_=e=>{t&&(t.gestationWeeks=K(e.gestationWeeks||""),t.steroidsGiven=e.steroidsGiven||"",t.gestationMethodAssessment=T(e.gestationMethodAssessment)||"",t.ultraSoundScanning=e.ultraSoundScanning||"",t.onsetOfLabor=K(e.onsetOfLabor||""),t.ruptureOfMembranes=e.ruptureOfMembranes||"",t.durationOfRuptureMembranes=T(e.durationOfRuptureMembranes)||"",t.offensiveLiquor=e.offensiveLiquor||"",t.modeOfDelivery=T(e.modeOfDelivery)||"",t.meconiumPresent=e.meconiumPresent||"",t.maternalAnalgesia=e.maternalAnalgesia||"",t.analgesiasDrug=T(e.analgesiasDrug)||"",t.anesthesiaUsed=e.anesthesiaUsed||"",t.teo=e.teo||"",t.chlorohexidineCordCare=e.chlorohexidineCordCare||"",t.vitaminKGiven=e.vitaminKGiven||"",t.dextroseGiven=e.dextroseGiven||"")};return $(()=>{var e;return(e=a.value)==null?void 0:e.formValues},e=>{e&&_(e)},{deep:!0}),$(()=>a.value,e=>{e!=null&&e.getFormValues&&_(e.getFormValues())},{immediate:!0}),N({getFormRef:()=>a.value,validateForm:()=>{var e,l;return((l=(e=a.value)==null?void 0:e.validateForm)==null?void 0:l.call(e))||null},getFormValues:()=>{var e,l;return((l=(e=a.value)==null?void 0:e.getFormValues)==null?void 0:l.call(e))||{}}}),(e,l)=>(h(),Y(U,{formData:c(y),ref_key:"formRef",ref:a},null,8,["formData"]))}}),be=H({__name:"MotherEnrollmentDetails",setup(m,{expose:N}){const a=S(null),y=E[5].formData,t=L(z),_=e=>{t&&(t.motherStatus=e.motherStatus||"",t.motherHivStatus=T(e.motherHivStatus)||"",t.lastHivTestDate=K(e.lastHivTestDate||""),t.doHivRetest=e.doHivRetest||"",t.babyGivenNvp=e.babyGivenNvp||"",t.motherVdrlResult=T(e.motherVdrlResult)||"",t.motherTreatedForVdrl=e.motherTreatedForVdrl||"",t.babyTestedForHepatitis=e.babyTestedForHepatitis||"",t.allThreeDosesCompleted=e.allThreeDosesCompleted||"",t.motherHepatitisResult=T(e.motherHepatitisResult)||"")};return $(()=>{var e;return(e=a.value)==null?void 0:e.formValues},e=>{e&&_(e)},{deep:!0}),$(()=>a.value,e=>{e!=null&&e.getFormValues&&_(e.getFormValues())},{immediate:!0}),N({getFormRef:()=>a.value,validateForm:()=>{var e,l;return((l=(e=a.value)==null?void 0:e.validateForm)==null?void 0:l.call(e))||null},getFormValues:()=>{var e,l;return((l=(e=a.value)==null?void 0:e.getFormValues)==null?void 0:l.call(e))||{}}}),(e,l)=>(h(),Y(U,{formData:c(y),ref_key:"formRef",ref:a},null,8,["formData"]))}}),we=H({__name:"KnownMedicalConditions",setup(m,{expose:N}){const a=S(null),y=E[6].formData,t=L(z),_=e=>{t&&(t.tetanusDiphtheria=Ce(e.tetanusDiphtheria))};return $(()=>{var e;return(e=a.value)==null?void 0:e.formValues},e=>{e&&_(e)},{deep:!0}),$(()=>a.value,e=>{e!=null&&e.getFormValues&&_(e.getFormValues())},{immediate:!0}),N({getFormRef:()=>a.value,validateForm:()=>{var e,l;return((l=(e=a.value)==null?void 0:e.validateForm)==null?void 0:l.call(e))||null},getFormValues:()=>{var e,l;return((l=(e=a.value)==null?void 0:e.getFormValues)==null?void 0:l.call(e))||{}}}),(e,l)=>(h(),Y(U,{formData:c(y),ref_key:"formRef",ref:a},null,8,["formData"]))}}),ga=H({name:"NeonatalEnrollment",components:{IonPage:Qe,IonContent:Ue,Toolbar:Ye,DemographicBar:tt,NeonatalStepper:at,BirthDetails:he,ReferralInformation:_e,BirthAssessment:ge,MotherSearch:ye,Pregnancy:De,MotherEnrollmentDetails:be,KnownMedicalConditions:we},setup(){const m=Re(),N=Te(),{patient:a}=We(N),y=S(!1),t=Ee(),_=w=>{const r=Number(w);return Number.isFinite(r)?r:null},e=()=>{var r;const w=_((r=a.value)==null?void 0:r.patientID);t.initializeEnrollmentForm(w)};e(),$(()=>{var w;return(w=a.value)==null?void 0:w.patientID},()=>e());const l=t.enrollmentForm;Ke(z,l),$(()=>t.enrollmentForm,()=>t.saveEnrollmentSnapshot(),{deep:!0});const o=S(E.map((w,r)=>({title:w.title,number:r+1,checked:!1,class:r===0?"open_step common_step":"common_step",last_step:r===E.length-1?"last_step":""}))),n=[{title:E[0].title,value:"1",component:he},{title:E[1].title,value:"2",component:_e},{title:E[2].title,value:"3",component:ge},{title:E[3].title,value:"4",component:ye},{title:E[4].title,value:"5",component:De},{title:E[5].title,value:"6",component:be},{title:E[6].title,value:"7",component:we}];return{router:m,patient:a,enrollmentFormData:l,stepperTitle:"Profiling",currentOpenStepper:"1",wizardData:o,stepperData:n,updateStatus:w=>{w&&w.value&&o.value.forEach((r,D)=>{w.value===(D+1).toString()?(r.class="open_step common_step",r.checked=!1):D<parseInt(w.value)-1?(r.class="common_step color_white",r.checked=!0):(r.class="common_step",r.checked=!1)})},getSaveFunction:w=>w===n.length-1?async()=>{var r;if(!((r=a.value)!=null&&r.patientID)){me("No patient selected");return}if(!y.value)try{if(y.value=!0,!l.birthWeight||!l.timeOfBirth){me("Please complete required birth details"),y.value=!1;return}if(l.motherPatientId)try{const k=(await fe.getRelations()).find(M=>M.b_is_to_a==="Mother"||M.b_is_to_a==="Parent");k&&await fe.createRelation(a.value.patientID,l.motherPatientId,k.relationship_type_id)}catch(g){console.error("Failed to create mother-baby relationship",g)}const D=await ve.buildEnrollmentObservations(l,oe.sessionDate());console.log("[Enrollment] observations count:",D==null?void 0:D.length),console.log("[Enrollment] saving encounter with ID:",pe.NEONATAL_ENROLLMENT),console.log("[Enrollment] current program_id from Service.getProgramID():",je.getProgramID());const C=await Je(a.value.patientID,pe.NEONATAL_ENROLLMENT,D);console.log("[Enrollment] save result:",C),console.log("[Enrollment] session date used:",oe.sessionDate()),await Xe.userProgramData(a.value.patientID),Ze("Neonate enrolled successfully"),await new Promise(g=>setTimeout(g,1e3));const p=oe.sessionDate();console.log("[Enrollment] Checking saved encounters for date:",p);const i=await ve.getSavedEncounters(a.value.patientID,p);console.log("[Enrollment] encountersResponse after delay:",i);const v=Array.isArray(i==null?void 0:i.encounters)?i.encounters:[];console.log("[Enrollment] encounters array:",v),console.log("[Enrollment] encounter type names:",v.map(g=>typeof g=="string"?g:(g==null?void 0:g.name)||g));const A=v.some(g=>(g==null?void 0:g.trim().toUpperCase())==="NEONATAL TRIAGE");m.push("/neonatal/checkpoint")}catch(D){console.error("Neonatal enrollment failed",D),et("Failed to enroll neonate. Please try again."),y.value=!1}}:null,isEnrolling:y}}});function ya(m,N,a,y,t,_){const e=X("Toolbar"),l=X("NeonatalStepper"),o=X("ion-content"),n=X("ion-page");return h(),Y(n,{class:"neonatal-enrollment-page"},{default:V(()=>[f(e),f(o,{fullscreen:!0},{default:V(()=>[f(l,{wizardData:m.wizardData,StepperData:m.stepperData,stepperTitle:m.stepperTitle,openStepper:m.currentOpenStepper,backUrl:"/patientProfile",getSaveFunction:m.getSaveFunction,flowType:"enrollment",onUpdateStatus:m.updateStatus},null,8,["wizardData","StepperData","stepperTitle","openStepper","getSaveFunction","onUpdateStatus"])]),_:1})]),_:1})}const Ta=ae(ga,[["render",ya],["__scopeId","data-v-591c026e"]]);export{Ta as default};

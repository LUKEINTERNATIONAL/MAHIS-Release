import{d as Pe,ap as Re,cp as xe,r as l,c as Ie,b2 as p,w as u,a as Ne,O as U,f as j,J as V,l as m,u as A,a4 as Ve,k as f,m as Be,i as D,bM as Me,v as b,a7 as Fe,ba as C}from"./vendor-BuyqdZ53.js";import{aJ as J,u as He,aK as $e,aL as Ee,aM as ze,aN as Le,d as We,aO as Ge,g as Qe,$ as Ue,e as je,T as Je,J as Ke,N as Ye,H as B,aP as T,aQ as qe,m as M,aR as K,aS as Xe,t as Y,aT as Ze,af as k,ag as Oe,aU as et,G as tt,aV as at,a1 as st,S as nt}from"../index-DuvGWDti.js";import{D as it}from"./DemographicBar-8H9KIl_X.js";import{D as ot,C as rt,T as lt}from"./TreatmentPlan-Cw1caacr.js";import{I as ct,N as ut,_ as mt,i as dt}from"./NextAppointment-UiQp5KjD.js";import{_ as ft}from"./RiskAssessment.vue_vue_type_script_setup_true_lang-B0A449Co.js";import{V as vt}from"./Vitals-WwHoCGVn.js";import{u as gt,_ as pt,s as St,c as ht,a as Dt}from"./nonPharmaTherapyStore-0zMmppAQ.js";import{u as F}from"./ComplicationsStore-DPlbnaGr.js";import{l as bt}from"./lodash-NJiRuGo9.js";import{a as q,b as Ct}from"./formatServerData-BO6Uv99S.js";import{C as _t}from"./Registration-BT7E8qmt.js";import{u as yt}from"./usePatientProfile-l2ysL9Da.js";import"./apexcharts-BQpaTz5X.js";import"./patient_diagnosis_service-CGIFs8eI.js";import"./DashBox-gUWEgdPU.js";import"./BasicForm-KCiyoQpK.js";import"./DateInputField-VXANR0PG.js";import"./group_validation-BqdoYFlV.js";import"./LabOrdersList-B1MRpMXh.js";import"./useUserActivities-wgQXI6OR.js";import"./RadiologyStore-D9QtbdJH.js";import"./previousComplaints-Kqjv8XXW.js";import"./patient_complaints_service-BHIhczlx.js";import"./user_role_management-BTCw8Fzt.js";import"./ncd_appointment_service-JK6-Os1b.js";import"./drug_prescription_service-IpxpOU-S.js";import"./useLocation-DIlgHE40.js";import"./vaccines_service-CSLokeSd.js";import"./sms_service-Dd8Hsonr.js";import"./EIRreportsStore-Co6EtPhe.js";import"./Export-B_cubd-3.js";import"./useNeonatalEnrollmentStore-CknJF5nL.js";import"./enrollment-DU-PLRUa.js";import"./Outcome-tqvxwBjO.js";import"./wardsStore-Czi59OdB.js";const wt={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},At={class:"back_profile"},ua=Pe({__name:"ConsultationPlan",setup(Tt,{expose:X}){const{onTabBeforeChange:Z,currentTabIndex:d}=gt(),{printVisitSummary:O}=yt(),P=Re(),ee=xe();l([]),l([]),l(!1);const R=l(!0),x=l(!1),S=l(!1),H=Ie(()=>({text:S.value?"Saving...":"Finish",icon:S.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:x.value||S.value})),te=J(),ae=He(),se=$e(),ne=Ee();ze();const ie=Le(),_=We();Ge();const oe=Qe(),re=F(),le=Ue(),{patient:o}=p(ae),{vitals:ce}=p(te),{investigations:ue}=p(se),{diagnosis:me}=p(ne),{substance:de}=p(oe),{selectedNCDMedicationList:$}=p(ie),{FootScreening:fe,visualScreening:ve,cvScreening:ge}=p(re),{sessionDate:E}=p(le),{apiStatus:kt}=p(je());l(!1);const pe=async()=>{let e=!1;const t=a=>{e=!1},n=async a=>{a.detail==!0&&(e=!0)};return await dt()==!0?await M(Ze,{class:"otherVitalsModal"},!0,{message:"You can screen the patient for AHD, do you want to proceed?"},{cancel:t,confirm:n}):e=!1,e};u(H,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:d.value,tabsLength:s.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),u(S,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const Se=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},y=()=>{let e=!1;return h(),S.value&&(e=!0),x.value=e,!e},he=()=>{P.push("patientProfile")},I=()=>_.NCDActivities.map(e=>({title:e,icon:""})),s=l(I()),z=l(null),L=l(null),De=l(null),be=l(null),Ce=l(null),_e=l(null),ye=l(null),h=()=>{var n;if(!s.value||s.value.length===0)return console.log("Tabs not yet initialized"),null;const e=d.value>=0&&d.value<s.value.length?d.value:0;switch((n=s.value[e])==null?void 0:n.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(_.NCDActivities.length>0)switch(_.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},N=()=>{R.value=!1,setTimeout(()=>{d.value=0,R.value=!0},0)},W=()=>{const e=J();e.setVitals(e.getInitialVitals(o.value.ID))},v=async()=>{var n,r;const e=Ye(E.value,"sessionDate","value")||B.sessionDate(),t=T("vitals");for(let a=0;a<s.value.length;a++){const c=s.value[a];if(c.title==="Vital Signs")s.value[a].icon=w(e,t)?C:"";else if(c.title==="Risk Assessment"){const i=T("substanceAbuse");s.value[a].icon=w(e,i)?C:""}else if(c.title==="Investigations"){const i=(r=(n=o==null?void 0:o.value)==null?void 0:n.labOrders)==null?void 0:r.saved,g=i==null?void 0:i.filter(Q=>B.toStandardHisFormat(e)===B.toStandardHisFormat(Q.order_date));s.value[a].icon=(g==null?void 0:g.length)>0?C:""}else if(c.title==="Diagnosis"){const i=T("diagnosis");s.value[a].icon=w(e,i)?C:""}else if(c.title==="Complications Screening"){const i=T("screening");s.value[a].icon=w(e,i)?C:""}else c.title==="Treatment Plan"&&($.value.length>0?s.value[a].icon=qe()?C:"":s.value[a].icon="")}y()},w=(e,t)=>{const n=new Date(e);return n.setHours(0,0,0,0),t.some(r=>{const a=new Date(r.obs_datetime);return a.setHours(0,0,0,0),a.getTime()===n.getTime()})},we=async()=>{var a,c,i,g;const e=[],t=await q(ve.value),n=await Ct(fe.value),r=await q(ge.value);t.length>0&&e.push({concept_id:await k.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:k.getSessionDate(),child:t}),n.length>0&&e.push({concept_id:await k.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:k.getSessionDate(),child:n}),r.length>0&&e.push(...r),e.length>0?((g=(i=(c=(a=o.value).screening)!=null?c:a.screening={}).unsaved)!=null||(i.unsaved=[]),await Oe.addObsToEncounterPatient(e,et.SCREENING),tt("Complications saved successfully")):Y("No complications data to save")},Ae=async()=>{const e=at();if(!bt.isEmpty(e.selectedMedicalAllergiesList)){const r=st(),a=e.selectedMedicalAllergiesList.map(i=>({concept_id:i.concept_id,obs_datetime:nt.getSessionDate(),value_coded:i.concept_id,location_id:r.facilityLocation.code,value_text:i.name})),c=await St(a);o.value=Object.assign(o.value,c),console.log("Allergies staged successfully:",o.value),e.clearSelectedMedicalAllergiesList()}const t=await ht();o.value=Object.assign(o.value,t);const n=await Dt().saveNonPharmaTherapyPatientData();o.value=Object.assign(o.value,n)},Te=async(e,t)=>{var a,c,i,g;const n=(a=s.value[e])==null?void 0:a.title,r=(c=s.value[t])==null?void 0:c.title;e%1===0&&(d.value=e),r=="Vital Signs"&&((i=z.value)==null||i.onSubmit()),r=="Risk Assessment"&&((g=L.value)==null||g.onSubmit()),r=="Complications Screening"&&await we(),r=="Treatment Plan"&&await Ae(),n=="Investigations"&&await pe()==!0&&await M(mt,{class:"fullScreenModal"},!0,{closeModalOnFinish:!0}),await K(o.value)},G=async()=>{S.value=!0;try{await Xe(),await K(o.value),await ke(),P.push("patientProfile")}catch(e){console.error("Error saving data:",e),Y("Error occurred while saving data. Please try again.")}finally{S.value=!1}},ke=async()=>{await M(_t,{class:"small-confirm-modal "})!=="dismiss"&&await O()};return Ne(async()=>{if(_.NCDActivities.length===0){P.push("patientProfile");return}F().resetScreening(),s.value=I(),await v(),(d.value===void 0||d.value<0)&&(d.value=0,console.log("Setting initial tab index to 0")),x.value=!1,S.value=!1,y()}),u(d,async()=>{await y()}),u(ce,async()=>{await v()},{deep:!0}),u(o,async()=>{F().resetScreening(),await v()},{deep:!0}),u(E,async()=>{await v()},{deep:!0}),u(ue,async()=>{await v()},{deep:!0}),u(me,async()=>{await v()},{deep:!0}),u(de,async()=>{await v()},{deep:!0}),u($,async()=>{await v()},{deep:!0}),u(ee,async e=>{N(),W(),s.value=I()},{deep:!0}),u(o,async(e,t)=>{e.ID!=t.ID&&(N(),W())},{deep:!0}),X({saveData:G,markWizard:v,refreshWizard:N,validateDoneButtonState:y}),(e,t)=>(j(),U(A(Fe),null,{default:V(()=>[m(Je),m(A(Ve),{fullscreen:!0},{default:V(()=>[m(it),f("div",wt,[R.value?(j(),U(pt,{key:0,ref:"wizard",headingTitle:"Consultation Plan","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:H.value,"custom-tabs":s.value,beforeChange:A(Z),onChange:Te,"onComplete:wizard":t[1]||(t[1]=n=>G()),onDoneButtonChanged:Se},{default:V(()=>[f("div",null,[f("div",At,[m(Ke,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:A(Me),"font-weight":"600",onClick:t[0]||(t[0]=n=>he())},null,8,["icon"])])]),D(f("div",null,[m(vt,{ref_key:"vitalsRef",ref:z},null,512)],512),[[b,h()=="Vitals"]]),D(f("div",null,[m(ft,{ref_key:"riskAssessmentRef",ref:L},null,512)],512),[[b,h()=="RiskAssessment"]]),D(f("div",null,[m(ct,{ref_key:"investigationsRef",ref:De},null,512)],512),[[b,h()=="Investigations"]]),D(f("div",null,[m(ot,{ref_key:"diagnosisRef",ref:be},null,512)],512),[[b,h()=="DiagnosisComponent"]]),D(f("div",null,[m(rt,{ref_key:"complicationsRef",ref:Ce},null,512)],512),[[b,h()=="ComplicationsScreening"]]),D(f("div",null,[m(lt,{ref_key:"treatmentPlanRef",ref:_e},null,512)],512),[[b,h()=="TreatmentPlan"]]),D(f("div",null,[m(ut,{ref_key:"nextAppointmentRef",ref:ye},null,512)],512),[[b,h()=="NextAppointment"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Be("",!0)])]),_:1})]),_:1}))}});export{ua as default};

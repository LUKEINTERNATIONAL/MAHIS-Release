import{t as s,_ as F,O as H}from"./ReportMixin.vue_vue_type_script_lang-BeIgxLY2.js";import{R as M}from"./BaseTableReport-B1J7XMue.js";import{_ as D,H as y,S as x}from"../index-BVTwk_Db.js";import{d as B,bc as b,H as i,e as w,f as v,l as o,J as n,Q as c,k as f,F as R,P as O,O as C,K as g,a6 as V}from"./vendor-D6KKOjhr.js";import"./lodash-NJiRuGo9.js";import"./Export-D-UTgVEL.js";import"./apexcharts-DipIgGe9.js";const E=B({props:{list:Object},setup(){return{closeModal:async()=>await b.dismiss()}}});function I(e,t,l,r,d,u){const p=i("ion-title"),_=i("ion-button"),h=i("ion-toolbar"),$=i("ion-header"),a=i("ion-col"),S=i("ion-row"),T=i("ion-item"),k=i("ion-list"),N=i("ion-grid"),P=i("ion-content");return v(),w(R,null,[o($,null,{default:n(()=>[o(h,null,{default:n(()=>[o(p,null,{default:n(()=>[...t[1]||(t[1]=[c("Clinic Registration Report Summary",-1)])]),_:1}),o(_,{color:"danger",slot:"end",onClick:t[0]||(t[0]=m=>e.closeModal())},{default:n(()=>[...t[2]||(t[2]=[c("X",-1)])]),_:1})]),_:1})]),_:1}),o(P,{class:"ion-padding"},{default:n(()=>[o(N,null,{default:n(()=>[o(S,null,{default:n(()=>[o(a,null,{default:n(()=>[...t[3]||(t[3]=[f("h3",null,"Type of Visit",-1)])]),_:1}),o(a,null,{default:n(()=>[...t[4]||(t[4]=[f("h3",null," < 5yrs ",-1)])]),_:1}),o(a,null,{default:n(()=>[...t[5]||(t[5]=[f("h3",null," > 5yrs",-1)])]),_:1}),o(a,null,{default:n(()=>[...t[6]||(t[6]=[f("h3",null,"Total",-1)])]),_:1})]),_:1}),o(k,null,{default:n(()=>[(v(!0),w(R,null,O(e.list,m=>(v(),C(T,{key:m},{default:n(()=>[o(a,null,{default:n(()=>[c(g(m.label),1)]),_:2},1024),o(a,null,{default:n(()=>[c(g(m.under5),1)]),_:2},1024),o(a,null,{default:n(()=>[c(g(m.over5),1)]),_:2},1024),o(a,null,{default:n(()=>[c(g(m.value),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})],64)}const L=D(E,[["render",I]]),j=B({components:{ReportTemplate:M,IonPage:V},mixins:[F],data:()=>({title:"Clinic Registration",rows:[],reportData:[],columns:[[s.thTxt("Reg"),s.thTxt("First Name"),s.thTxt("Last Name"),s.thTxt("Gender"),s.thTxt("DOB"),s.thTxt("Date reg.")]],customBtns:[]}),created(){this.fields=this.getDateDurationFields(),this.customBtns.push({name:"High level view",size:"large",slot:"start",color:"primary",visible:!0,onClick:async()=>this.showModal()})},methods:{async init(e,t){const l=new H;l.setStartDate(t.start_date),l.setEndDate(t.end_date),this.period=l.getDateIntervalPeriod();const r=await l.getClinicRegistrations();this.reportData=r.sort((d,u)=>d.visit_type>u.visit_type?1:d.visit_type<u.visit_type?-1:0),this.rows=this.buildRows(this.reportData)},buildRows(e){return e.length?e.map(t=>[s.td(t.visit_type),s.td(t.given_name),s.td(t.family_name),s.td(t.gender),s.td(y.toStandardHisDisplayFormat(t.birthdate)),s.td(y.toStandardHisDisplayFormat(t.visit_date))]):[]},filterBy(e,t){return this.reportData.filter(l=>{const r=y.calculateAge(l.birthdate,x.getSessionDate());return l.visit_type===e&&(t==="under5"?r<=5:r>6)})},modalData(){const e=[...this.filterBy("New patient","under5")].length,t=[...this.filterBy("New patient","over5")].length,l=e+t,r=[...this.filterBy("Referral","under5")].length,d=[...this.filterBy("Referral","over5")].length,u=r+d,p=[...this.filterBy("Revisiting","under5")].length,_=[...this.filterBy("Revisiting","over5")].length,h=p+_;return[{label:"New patient",under5:e,over5:t,value:l},{label:"Referral",under5:r,over5:d,value:u},{label:"Revisiting",under5:p,over5:_,value:h}]},async showModal(){const e=[...this.modalData()];(await b.create({component:L,backdropDismiss:!0,cssClass:"action-sheet-modal",componentProps:{list:e}})).present()}}});function z(e,t,l,r,d,u){const p=i("report-template"),_=i("ion-page");return v(),C(_,null,{default:n(()=>[o(p,{title:e.title,rows:e.rows,fields:e.fields,columns:e.columns,itemsPerPage:10,period:e.period,reportPrefix:"Clinic",onReportConfiguration:e.init,customBtns:e.customBtns,paginated:""},null,8,["title","rows","fields","columns","period","onReportConfiguration","customBtns"])]),_:1})}const U=D(j,[["render",z]]);export{U as default};

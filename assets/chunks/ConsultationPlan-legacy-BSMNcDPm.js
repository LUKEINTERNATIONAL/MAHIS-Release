System.register(["./vendor-legacy-CdypqbXP.js","../index-legacy-CQ-7M6kd.js","./DemographicBar-legacy-BEY4wqH6.js","./TreatmentPlan-legacy-BhFlC662.js","./NextAppointment-legacy-B7_xdaAW.js","./RiskAssessment.vue_vue_type_script_setup_true_lang-legacy-CCqJaUc3.js","./Vitals-legacy-9tvqVnej.js","./useFormWizard-legacy-DczO6gxA.js","./ComplicationsStore-legacy-C6kh9Gm4.js","./nonPharmaTherapyStore-legacy-Dgf8Ss9q.js","./lodash-legacy-pOOc9Efu.js","./formatServerData-legacy-CLaDeN80.js","./useSetRegistrationValues-legacy-IforFUde.js","./usePatientProfile-legacy-BbB0e34Z.js","./ClientUtils-legacy-CzSlmC8x.js","./apexcharts-legacy-DPlv51y0.js","./patient_diagnosis_service-legacy-BJeeEUxT.js","./DashBox-legacy-_gz6Wzjn.js","./BasicForm-legacy-BVNhE0wj.js","./DateInputField-legacy-TUfzYZF5.js","./group_validation-legacy-BFZvzolA.js","./LabOrdersList-legacy-DHIJKZnX.js","./EnterLabResultsModal-legacy-c-l6jHZ9.js","./useUserActivities-legacy-vJ1TNX0J.js","./RadiologyStore-legacy-CnrF9MFG.js","./previousComplaints-legacy-rFhIy4lZ.js","./patient_complaints_service-legacy-CE7KASDZ.js","./user_role_management-legacy-CcinxvQT.js","./ncd_appointment_service-legacy-DZqA8o23.js","./drug_prescription_service-legacy-CnmefQBQ.js","./useLocation-legacy-BZZkt9lG.js","./vaccines_service-legacy-B8eoR-ig.js","./sms_service-legacy-ChckZ70S.js","./EIRreportsStore-legacy-CgG4vUEp.js","./Export-legacy-Br3f2iIr.js","./Registration-legacy-JhJajsP_.js","./useNeonatalEnrollmentStore-legacy-DHZSAMR0.js","./enrollment-legacy-BWFKsMdA.js","./Outcome-legacy-CSvd9eX3.js","./wardsStore-legacy-CQsA9Tn3.js"],function(e,t){"use strict";var a,n,l,s,i,o,c,u,r,v,d,g,p,m,y,f,b,h,_,S,w,D,j,C,x,A,k,I,P,R,T,N,V,E,L,B,F,O,M,z,H,$,U,W,Y,Z,G,J,Q,X,q,K,ee,te,ae,ne,le,se,ie,oe,ce,ue,re,ve,de,ge,pe,me,ye,fe,be,he;return{setters:[e=>{a=e.d,n=e.am,l=e.cr,s=e.r,i=e.c,o=e.b2,c=e.w,u=e.a,r=e.O,v=e.f,d=e.J,g=e.l,p=e.u,m=e.ab,y=e.k,f=e.m,b=e.i,h=e.bT,_=e.v,S=e.ae,w=e.ba},e=>{D=e.b8,j=e.u,C=e.b9,x=e.ba,A=e.b0,k=e.bb,I=e.e,P=e.b1,R=e.i,T=e.a7,N=e.f,V=e.T,E=e.D,L=e.a1,B=e.H,F=e.b3,O=e.bc,M=e.o,z=e.C,H=e.bd,$=e.t,U=e.b7,W=e.an,Y=e.F,Z=e.b,G=e.Z,J=e.be,Q=e.a9,X=e.S},e=>{q=e.D},e=>{K=e.D,ee=e.C,te=e.T},e=>{ae=e.I,ne=e.N,le=e._,se=e.i},e=>{ie=e._},e=>{oe=e.V},e=>{ce=e.u,ue=e._},e=>{re=e.u},e=>{ve=e.s,de=e.c,ge=e.u},e=>{pe=e.l},e=>{me=e.f,ye=e.a},e=>{fe=e.C},e=>{be=e.u},e=>{he=e.p},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){const t={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},_e={class:"back_profile"};e("default",a({__name:"ConsultationPlan",setup(e,{expose:a}){const{onTabBeforeChange:Se,currentTabIndex:we}=ce(),{printVisitSummary:De}=be(),je=n(),Ce=l();s([]),s([]),s(!1);const xe=s(!0),Ae=s(!1),ke=s(!1),Ie=i(()=>({text:ke.value?"Saving...":"Finish",icon:ke.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:Ae.value||ke.value})),Pe=D(),Re=j(),Te=C(),Ne=x();A();const Ve=k(),Ee=I();P();const Le=R(),Be=re(),Fe=T(),{patient:Oe}=o(Re),{vitals:Me}=o(Pe),{investigations:ze}=o(Te),{diagnosis:He}=o(Ne),{substance:$e}=o(Le),{selectedNCDMedicationList:Ue}=o(Ve),{FootScreening:We,visualScreening:Ye,cvScreening:Ze}=o(Be),{sessionDate:Ge}=o(Fe),{apiStatus:Je}=o(N());s(!1),c(Ie,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:we.value,tabsLength:Ke.value.length}),e.disabled!==(null==t?void 0:t.disabled)&&console.log("Done button "+(e.disabled?"disabled":"enabled")),e.text!==(null==t?void 0:t.text)&&console.log(`Done button text changed from "${null==t?void 0:t.text}" to "${e.text}"`)},{deep:!0}),c(ke,(e,t)=>{e!==t&&(console.log(`Saving state changed: ${t} -> ${e}`),e?console.log("Starting save process..."):console.log("Save process completed"))});const Qe=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},Xe=()=>{let e=!1;return ot(),ke.value&&(e=!0),Ae.value=e,!e},qe=()=>Ee.NCDActivities.map(e=>({title:e,icon:""})),Ke=s(qe()),et=s(null),tt=s(null),at=s(null),nt=s(null),lt=s(null),st=s(null),it=s(null),ot=()=>{var e;if(!Ke.value||0===Ke.value.length)return console.log("Tabs not yet initialized"),null;const t=we.value>=0&&we.value<Ke.value.length?we.value:0;switch(null===(e=Ke.value[t])||void 0===e?void 0:e.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(Ee.NCDActivities.length>0)switch(Ee.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},ct=()=>{xe.value=!1,setTimeout(()=>{we.value=0,xe.value=!0},0)},ut=()=>{const e=D();e.setVitals(e.getInitialVitals(Oe.value.ID))},rt=async()=>{const e=L(Ge.value,"sessionDate","value")||B.sessionDate(),t=F("vitals");for(let n=0;n<Ke.value.length;n++){const l=Ke.value[n];if("Vital Signs"===l.title)Ke.value[n].icon=vt(e,t)?w:"";else if("Risk Assessment"===l.title){const t=F("substanceAbuse");Ke.value[n].icon=vt(e,t)?w:""}else if("Investigations"===l.title){var a;const t=null==Oe||null===(a=Oe.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,l=null==t?void 0:t.filter(t=>B.toStandardHisFormat(e)===B.toStandardHisFormat(t.order_date));Ke.value[n].icon=(null==l?void 0:l.length)>0?w:""}else if("Diagnosis"===l.title){const t=F("diagnosis");Ke.value[n].icon=vt(e,t)?w:""}else if("Complications Screening"===l.title){const t=F("screening");Ke.value[n].icon=vt(e,t)?w:""}else"Treatment Plan"===l.title&&(Ue.value.length>0?Ke.value[n].icon=O()?w:"":Ke.value[n].icon="")}Xe()},vt=(e,t)=>{const a=new Date(e);return a.setHours(0,0,0,0),t.some(e=>{const t=new Date(e.obs_datetime);return t.setHours(0,0,0,0),t.getTime()===a.getTime()})},dt=async(e,t)=>{var a,n;const l=null===(a=Ke.value[e])||void 0===a?void 0:a.title,s=null===(n=Ke.value[t])||void 0===n?void 0:n.title;var i,o;e%1==0&&(we.value=e),"Vital Signs"==s&&(null===(i=et.value)||void 0===i||i.onSubmit()),"Risk Assessment"==s&&(null===(o=tt.value)||void 0===o||o.onSubmit()),"Complications Screening"==s&&await(async()=>{const e=[],t=await me(Ye.value),a=await ye(We.value),n=await me(Ze.value);var l,s,i,o;t.length>0&&e.push({concept_id:await W.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:W.getSessionDate(),child:t}),a.length>0&&e.push({concept_id:await W.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:W.getSessionDate(),child:a}),n.length>0&&e.push(...n),e.length>0?(null!==(s=(l=null!==(o=(i=Oe.value).screening)&&void 0!==o?o:i.screening={}).unsaved)&&void 0!==s||(l.unsaved=[]),await Y.addObsToEncounterPatient(e,Z.SCREENING),G("Complications saved successfully")):$("No complications data to save")})(),"Treatment Plan"==s&&await(async()=>{const e=J();if(!pe.isEmpty(e.selectedMedicalAllergiesList)){const t=Q(),a=e.selectedMedicalAllergiesList.map(e=>({concept_id:e.concept_id,obs_datetime:X.getSessionDate(),value_coded:e.concept_id,location_id:t.facilityLocation.code,value_text:e.name})),n=await ve(a);Oe.value=Object.assign(Oe.value,n),console.log("Allergies staged successfully:",Oe.value),e.clearSelectedMedicalAllergiesList()}const t=await de();Oe.value=Object.assign(Oe.value,t);const a=await ge().saveNonPharmaTherapyPatientData();Oe.value=Object.assign(Oe.value,a)})(),"Investigations"==l&&1==await(async()=>{let e=!1;const t=t=>{e=!1},a=async t=>{1==t.detail&&(e=!0)};if(1==await se()){const e={message:"You can screen the patient for AHD, do you want to proceed?"};await M(U,{class:"otherVitalsModal"},!0,e,{cancel:t,confirm:a})}else e=!1;return e})()&&await M(le,{class:"fullScreenModal"},!0,{closeModalOnFinish:!0}),await z(Oe.value)},gt=async()=>{ke.value=!0;try{await H(),await z(Oe.value),await pt(),je.push("patientProfile")}catch(e){console.error("Error saving data:",e),$("Error occurred while saving data. Please try again.")}finally{ke.value=!1}},pt=async()=>{"dismiss"!==await M(fe,{class:"small-confirm-modal "})&&await De()};return u(async()=>{try{var e;if(0===Ee.NCDActivities.length)return void je.push("patientProfile");re().resetScreening(),Ke.value=qe(),he.setCurrentPatientID(null===(e=Oe.value)||void 0===e?void 0:e.patientID),await rt(),(void 0===we.value||we.value<0)&&(we.value=0,console.log("Setting initial tab index to 0")),Ae.value=!1,ke.value=!1,Xe()}catch(t){console.error("Error: ",t)}}),c(we,async()=>{await Xe()}),c(Me,async()=>{await rt()},{deep:!0}),c(Oe,async()=>{try{var e;re().resetScreening(),he.setCurrentPatientID(null===(e=Oe.value)||void 0===e?void 0:e.patientID),await rt()}catch(t){console.error("Error updating patient data: ",t)}},{deep:!0}),c(Ge,async()=>{await rt()},{deep:!0}),c(ze,async()=>{await rt()},{deep:!0}),c(He,async()=>{await rt()},{deep:!0}),c($e,async()=>{await rt()},{deep:!0}),c(Ue,async()=>{await rt()},{deep:!0}),c(Ce,async e=>{ct(),ut(),Ke.value=qe()},{deep:!0}),c(Oe,async(e,t)=>{e.ID!=t.ID&&(ct(),ut())},{deep:!0}),a({saveData:gt,markWizard:rt,refreshWizard:ct,validateDoneButtonState:Xe}),(e,a)=>(v(),r(p(S),null,{default:d(()=>[g(V),g(p(m),{fullscreen:!0},{default:d(()=>[g(q),y("div",t,[xe.value?(v(),r(ue,{key:0,ref:"wizard",headingTitle:"Consultation Plan","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:Ie.value,"custom-tabs":Ke.value,beforeChange:p(Se),onChange:dt,"onComplete:wizard":a[1]||(a[1]=e=>gt()),onDoneButtonChanged:Qe},{default:d(()=>[y("div",null,[y("div",_e,[g(E,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:p(h),"font-weight":"600",onClick:a[0]||(a[0]=e=>{je.push("patientProfile")})},null,8,["icon"])])]),b(y("div",null,[g(oe,{ref_key:"vitalsRef",ref:et},null,512)],512),[[_,"Vitals"==ot()]]),b(y("div",null,[g(ie,{ref_key:"riskAssessmentRef",ref:tt},null,512)],512),[[_,"RiskAssessment"==ot()]]),b(y("div",null,[g(ae,{ref_key:"investigationsRef",ref:at},null,512)],512),[[_,"Investigations"==ot()]]),b(y("div",null,[g(K,{ref_key:"diagnosisRef",ref:nt},null,512)],512),[[_,"DiagnosisComponent"==ot()]]),b(y("div",null,[g(ee,{ref_key:"complicationsRef",ref:lt},null,512)],512),[[_,"ComplicationsScreening"==ot()]]),b(y("div",null,[g(te,{ref_key:"treatmentPlanRef",ref:st},null,512)],512),[[_,"TreatmentPlan"==ot()]]),b(y("div",null,[g(ne,{ref_key:"nextAppointmentRef",ref:it},null,512)],512),[[_,"NextAppointment"==ot()]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):f("",!0)])]),_:1})]),_:1}))}}))}}});

import{d as Ae,an as Re,cE as Pe,r,c as Te,aV as f,w as u,a as xe,O as G,f as J,J as B,l as m,u as k,a3 as Ie,k as d,m as Ne,i as h,bJ as Be,v as D,a6 as Ve,b9 as C}from"./vendor-DoZkSJso.js";import{aG as j,u as Fe,aH as Me,aI as $e,aJ as ze,aK as He,d as Le,aL as Ee,g as We,Z as Ge,e as Je,T as je,J as Ue,N as Ke,H as V,aM as A,aN as Qe,aO as U,aP as Ze,t as K,m as qe,aQ as R,G as Xe,aR as Ye,a0 as Oe,S as et}from"../index-gGhCNNm-.js";import{D as tt}from"./DemographicBar-CtVSx6-H.js";import{D as at,C as st,T as nt}from"./TreatmentPlan-DMA_8KiT.js";import{I as it,N as ot}from"./NextAppointment-GsAUsYCE.js";import{_ as lt}from"./RiskAssessment.vue_vue_type_script_setup_true_lang-C7pz9ATc.js";import{_ as rt}from"./Vitals.vue_vue_type_script_setup_true_lang-CXFhvOdu.js";import{u as ct,a as F,_ as ut,s as mt,c as vt,b as dt}from"./useFormWizard-JN9numg1.js";import{l as gt}from"./lodash-NJiRuGo9.js";import{a as Q,b as ft}from"./formatServerData-BhodKM1q.js";import{C as pt}from"./Registration-DRJYRMvO.js";import{u as St}from"./usePatientProfile-C2cO7zjl.js";import"./apexcharts-BgIpHCiE.js";import"./patient_diagnosis_service-CmdsHOhe.js";import"./DashBox-9XOan6Xt.js";import"./BasicForm-VcZvAgk9.js";import"./DateInputField-DqG-yEpm.js";import"./previousDiagnosis-I5L8beXC.js";import"./group_validation-Bp8nJQtG.js";import"./LabOrdersList-CDjKIg69.js";import"./RadiologyStore-DU1OmsPo.js";import"./ncd_appointment_service-DxQ7T2i2.js";import"./drug_prescription_service-f79fYRb1.js";import"./useLocation-74cWvL7y.js";import"./vaccines_service-CQ7yhFHd.js";import"./sms_service-DxUxqMsi.js";import"./EIRreportsStore-BwOyTE6V.js";import"./Export-ZturoHo9.js";import"./NeonatalEnrollmentStore-CRXyCJpY.js";const ht={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},Dt={class:"back_profile"},Xt=Ae({__name:"ConsultationPlan",setup(bt,{expose:Z}){const{onTabBeforeChange:q,currentTabIndex:v}=ct(),{printVisitSummary:X}=St(),P=Re(),Y=Pe();r([]),r([]),r(!1);const T=r(!0),x=r(!1),p=r(!1),M=Te(()=>({text:p.value?"Saving...":"Finish",icon:p.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:x.value||p.value})),O=j(),ee=Fe(),te=Me(),ae=$e();ze();const se=He(),_=Le();Ee();const ne=We(),ie=F(),oe=Ge(),{patient:i}=f(ee),{vitals:le}=f(O),{investigations:re}=f(te),{diagnosis:ce}=f(ae),{substance:ue}=f(ne),{selectedNCDMedicationList:$}=f(se),{FootScreening:me,visualScreening:ve,cvScreening:de}=f(ie),{sessionDate:z}=f(oe),{apiStatus:Ct}=f(Je());u(M,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:v.value,tabsLength:n.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),u(p,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const ge=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},y=()=>{let e=!1;return S(),p.value&&(e=!0),x.value=e,!e},fe=()=>{P.push("patientProfile")},I=()=>_.NCDActivities.map(e=>({title:e,icon:""})),n=r(I()),H=r(null),L=r(null),pe=r(null),Se=r(null),he=r(null),De=r(null),be=r(null),S=()=>{var s;if(!n.value||n.value.length===0)return console.log("Tabs not yet initialized"),null;const e=v.value>=0&&v.value<n.value.length?v.value:0;switch((s=n.value[e])==null?void 0:s.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(_.NCDActivities.length>0)switch(_.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},N=()=>{T.value=!1,setTimeout(()=>{v.value=0,T.value=!0},0)},E=()=>{const e=j();e.setVitals(e.getInitialVitals(i.value.ID))},g=async()=>{var s,c;const e=Ke(z.value,"sessionDate","value")||V.sessionDate(),t=A("vitals");for(let a=0;a<n.value.length;a++){const l=n.value[a];if(l.title==="Vital Signs")n.value[a].icon=w(e,t)?C:"";else if(l.title==="Risk Assessment"){const o=A("substanceAbuse");n.value[a].icon=w(e,o)?C:""}else if(l.title==="Investigations"){const o=(c=(s=i==null?void 0:i.value)==null?void 0:s.labOrders)==null?void 0:c.saved,b=o==null?void 0:o.filter(ke=>V.toStandardHisFormat(e)===V.toStandardHisFormat(ke.order_date));n.value[a].icon=(b==null?void 0:b.length)>0?C:""}else if(l.title==="Diagnosis"){const o=A("diagnosis");n.value[a].icon=w(e,o)?C:""}else if(l.title==="Complications Screening"){const o=A("screening");n.value[a].icon=w(e,o)?C:""}else l.title==="Treatment Plan"&&($.value.length>0?n.value[a].icon=Qe()?C:"":n.value[a].icon="")}y()},w=(e,t)=>{const s=new Date(e);return s.setHours(0,0,0,0),t.some(c=>{const a=new Date(c.obs_datetime);return a.setHours(0,0,0,0),a.getTime()===s.getTime()})},Ce=async()=>{var a,l,o,b;const e=[],t=await Q(ve.value),s=await ft(me.value),c=await Q(de.value);t.length>0&&e.push({concept_id:await R.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:R.getSessionDate(),child:t}),s.length>0&&e.push({concept_id:await R.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:R.getSessionDate(),child:s}),c.length>0&&e.push(...c),e.length>0?((b=(o=(l=(a=i.value).screening)!=null?l:a.screening={}).unsaved)!=null||(o.unsaved=[]),i.value.screening.unsaved.push(...e),Xe("Complications saved successfully")):K("No complications data to save")},_e=async()=>{const e=Ye();if(!gt.isEmpty(e.selectedMedicalAllergiesList)){const c=Oe(),a=e.selectedMedicalAllergiesList.map(o=>({concept_id:o.concept_id,obs_datetime:et.getSessionDate(),value_coded:o.concept_id,location_id:c.facilityLocation.code,value_text:o.name})),l=await mt(a);i.value=Object.assign(i.value,l),console.log("Allergies staged successfully:",i.value),e.clearSelectedMedicalAllergiesList()}const t=await vt();i.value=Object.assign(i.value,t);const s=await dt().saveNonPharmaTherapyPatientData();i.value=Object.assign(i.value,s)},ye=async(e,t)=>{var c,a,l;const s=(c=n.value[t])==null?void 0:c.title;e%1===0&&(v.value=e),s=="Vital Signs"&&((a=H.value)==null||a.onSubmit()),s=="Risk Assessment"&&((l=L.value)==null||l.onSubmit()),s=="Complications Screening"&&await Ce(),s=="Treatment Plan"&&await _e(),await U(i.value)},W=async()=>{p.value=!0;try{await Ze(),await U(i.value),await we(),P.push("patientProfile")}catch(e){console.error("Error saving data:",e),K("Error occurred while saving data. Please try again.")}finally{p.value=!1}},we=async()=>{await qe(pt,{class:"small-confirm-modal "})!=="dismiss"&&await X()};return xe(async()=>{if(_.NCDActivities.length===0){P.push("patientProfile");return}F().resetScreening(),n.value=I(),await g(),(v.value===void 0||v.value<0)&&(v.value=0,console.log("Setting initial tab index to 0")),x.value=!1,p.value=!1,y()}),u(v,async()=>{await y()}),u(le,async()=>{await g()},{deep:!0}),u(i,async()=>{F().resetScreening(),await g()},{deep:!0}),u(z,async()=>{await g()},{deep:!0}),u(re,async()=>{await g()},{deep:!0}),u(ce,async()=>{await g()},{deep:!0}),u(ue,async()=>{await g()},{deep:!0}),u($,async()=>{await g()},{deep:!0}),u(Y,async e=>{N(),E(),n.value=I()},{deep:!0}),u(i,async(e,t)=>{e.ID!=t.ID&&(N(),E())},{deep:!0}),Z({saveData:W,markWizard:g,refreshWizard:N,validateDoneButtonState:y}),(e,t)=>(J(),G(k(Ve),null,{default:B(()=>[m(je),m(k(Ie),{fullscreen:!0},{default:B(()=>[m(tt),d("div",ht,[T.value?(J(),G(ut,{key:0,ref:"wizard",headingTitle:"Consultation Plan","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:M.value,"custom-tabs":n.value,beforeChange:k(q),onChange:ye,"onComplete:wizard":t[1]||(t[1]=s=>W()),onDoneButtonChanged:ge},{default:B(()=>[d("div",null,[d("div",Dt,[m(Ue,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:k(Be),"font-weight":"600",onClick:t[0]||(t[0]=s=>fe())},null,8,["icon"])])]),h(d("div",null,[m(rt,{ref_key:"vitalsRef",ref:H},null,512)],512),[[D,S()=="Vitals"]]),h(d("div",null,[m(lt,{ref_key:"riskAssessmentRef",ref:L},null,512)],512),[[D,S()=="RiskAssessment"]]),h(d("div",null,[m(it,{ref_key:"investigationsRef",ref:pe},null,512)],512),[[D,S()=="Investigations"]]),h(d("div",null,[m(at,{ref_key:"diagnosisRef",ref:Se},null,512)],512),[[D,S()=="DiagnosisComponent"]]),h(d("div",null,[m(st,{ref_key:"complicationsRef",ref:he},null,512)],512),[[D,S()=="ComplicationsScreening"]]),h(d("div",null,[m(nt,{ref_key:"treatmentPlanRef",ref:De},null,512)],512),[[D,S()=="TreatmentPlan"]]),h(d("div",null,[m(ot,{ref_key:"nextAppointmentRef",ref:be},null,512)],512),[[D,S()=="NextAppointment"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Ne("",!0)])]),_:1})]),_:1}))}});export{Xt as default};

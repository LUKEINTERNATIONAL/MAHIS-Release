import{d as Se,aF as De,cr as Ae,r as v,c as ye,bh as d,w as c,a as we,Q as M,f as W,H as N,l as g,u as _,L as _e,k as p,m as Ce,i as D,bU as xe,v as A,bq as Be,a9 as S}from"./vendor-CJ2tyHrn.js";import{ba as U,u as Te,bb as ke,bc as Pe,b2 as Re,bd as Ie,e as Ne,b3 as Fe,i as $e,a9 as Ee,f as Ve,T as Le,F as ze,a2 as He,H as F,b5 as C,be as Me,J as j,bf as We,t as G,aq as x,G as Ue,bg as je,ab as Ge,S as qe}from"../index-CPIhguZJ.js";import{D as Je}from"./DemographicBar-CMCjh8ca.js";import{u as Qe,_ as Ke}from"./useFormWizard-CAiBa2il.js";import{u as $}from"./ComplicationsStore-Ibxa1dsq.js";import{s as Xe,c as Ye,u as Ze}from"./nonPharmaTherapyStore-CAVSqzBF.js";import{l as Oe}from"./lodash-NJiRuGo9.js";import{f as q,a as et}from"./formatServerData-C4-2caW3.js";import{u as tt}from"./usePatientProfile-Bjyh6yGB.js";import{_ as st,B as at,a as nt,b as it,c as ot}from"./ExposureAssessment.vue_vue_type_script_setup_true_lang-B6OFmnsy.js";import"./apexcharts-BtvCa6MI.js";import"./drug_prescription_service-DiJpwuPJ.js";import"./patient_diagnosis_service-DTN-hwjk.js";import"./Registration-F5RJpZPr.js";import"./useSetRegistrationValues-CWxNfeBu.js";import"./useLocation-BxHWO3Ky.js";import"./vaccines_service-CFrWoT5a.js";import"./sms_service-ba9KXWCi.js";import"./EIRreportsStore-COMUTdOQ.js";import"./Export-CZmpfP5c.js";import"./user_role_management-C_d1iPJp.js";import"./useNeonatalEnrollmentStore--u9Qw-om.js";import"./enrollment-DU-PLRUa.js";import"./Outcome-BVD9d5EL.js";import"./wardsStore-DRE4cKPY.js";import"./DisplaySelectedBodyParts.vue_vue_type_script_setup_true_lang-KHDFXEVg.js";import"./ReusableDataTable-t4OJD7FM.js";const rt={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},lt={class:"back_profile"},Lt=Se({__name:"PrimarySurvey",setup(ct,{expose:J}){const{onTabBeforeChange:Q,currentTabIndex:u}=Qe();tt();const B=De(),K=Ae();v([]),v([]),v(!1);const T=v(!0),k=v(!1),f=v(!1),E=ye(()=>({text:f.value?"Saving...":"Finish",icon:f.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:k.value||f.value})),X=U(),Y=Te(),Z=ke(),O=Pe();Re();const ee=Ie(),P=Ne();Fe();const te=$e(),se=$(),ae=Ee(),{patient:i}=d(Y),{vitals:ne}=d(X),{investigations:ie}=d(Z),{diagnosis:oe}=d(O),{substance:re}=d(te),{selectedNCDMedicationList:V}=d(ee),{FootScreening:le,visualScreening:ce,cvScreening:ue}=d(se),{sessionDate:L}=d(ae),{apiStatus:ut}=d(Ve());c(E,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:u.value,tabsLength:n.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),c(f,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const me=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},y=()=>{let e=!1;return b(),f.value&&(e=!0),k.value=e,!e},ve=()=>{B.push("/patientProfile")},R=()=>[{title:"Airway Assessment",icon:""},{title:"Breathing Assessment",icon:""},{title:"Circulation Assessment",icon:""},{title:"Disability Assessment",icon:""},{title:"Exposure Assessment",icon:""}],n=v(R()),de=v(null),ge=v(null),b=()=>{var a;if(!n.value||n.value.length===0)return console.log("Tabs not yet initialized"),null;const e=u.value>=0&&u.value<n.value.length?u.value:0;switch((a=n.value[e])==null?void 0:a.title){case"Airway Assessment":return"AirwayAssessment";case"Breathing Assessment":return"BreathingAssessment";case"Circulation Assessment":return"CirculationAssessment";case"Disability Assessment":return"DisabilityAssessment";case"Exposure Assessment":return"ExposureAssessment";default:if(P.NCDActivities.length>0)switch(P.NCDActivities[0]){case"Airway Assessment":return"AirwayAssessment";case"Breathing Assessment":return"BreathingAssessment";case"Circulation Assessment":return"CirculationAssessment";case"Disability Assessment":return"DisabilityAssessment";case"Exposure Assessment":return"ExposureAssessment"}return null}},I=()=>{T.value=!1,setTimeout(()=>{u.value=0,T.value=!0},0)},z=()=>{const e=U();e.setVitals(e.getInitialVitals(i.value.ID))},m=async()=>{var a,l;const e=He(L.value,"sessionDate","value")||F.sessionDate(),t=C("vitals");for(let s=0;s<n.value.length;s++){const r=n.value[s];if(r.title==="Vital Signs")n.value[s].icon=w(e,t)?S:"";else if(r.title==="Risk Assessment"){const o=C("substanceAbuse");n.value[s].icon=w(e,o)?S:""}else if(r.title==="Investigations"){const o=(l=(a=i==null?void 0:i.value)==null?void 0:a.labOrders)==null?void 0:l.saved,h=o==null?void 0:o.filter(he=>F.toStandardHisFormat(e)===F.toStandardHisFormat(he.order_date));n.value[s].icon=(h==null?void 0:h.length)>0?S:""}else if(r.title==="Diagnosis"){const o=C("diagnosis");n.value[s].icon=w(e,o)?S:""}else if(r.title==="Complications Screening"){const o=C("screening");n.value[s].icon=w(e,o)?S:""}else r.title==="Treatment Plan"&&(V.value.length>0?n.value[s].icon=Me()?S:"":n.value[s].icon="")}y()},w=(e,t)=>{const a=new Date(e);return a.setHours(0,0,0,0),t.some(l=>{const s=new Date(l.obs_datetime);return s.setHours(0,0,0,0),s.getTime()===a.getTime()})},fe=async()=>{var s,r,o,h;const e=[],t=await q(ce.value),a=await et(le.value),l=await q(ue.value);t.length>0&&e.push({concept_id:await x.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:x.getSessionDate(),child:t}),a.length>0&&e.push({concept_id:await x.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:x.getSessionDate(),child:a}),l.length>0&&e.push(...l),e.length>0?((h=(o=(r=(s=i.value).screening)!=null?r:s.screening={}).unsaved)!=null||(o.unsaved=[]),i.value.screening.unsaved.push(...e),Ue("Complications saved successfully")):G("No complications data to save")},pe=async()=>{const e=je();if(!Oe.isEmpty(e.selectedMedicalAllergiesList)){const l=Ge(),s=e.selectedMedicalAllergiesList.map(o=>({concept_id:o.concept_id,obs_datetime:qe.getSessionDate(),value_coded:o.concept_id,location_id:l.facilityLocation.code,value_text:o.name})),r=await Xe(s);i.value=Object.assign(i.value,r),console.log("Allergies staged successfully:",i.value),e.clearSelectedMedicalAllergiesList()}const t=await Ye();i.value=Object.assign(i.value,t);const a=await Ze().saveNonPharmaTherapyPatientData();i.value=Object.assign(i.value,a)},be=async(e,t)=>{var l,s,r;const a=(l=n.value[t])==null?void 0:l.title;e%1===0&&(u.value=e),a=="Vital Signs"&&((s=de.value)==null||s.onSubmit()),a=="Risk Assessment"&&((r=ge.value)==null||r.onSubmit()),a=="Complications Screening"&&await fe(),a=="Treatment Plan"&&await pe(),await j(i.value)},H=async()=>{f.value=!0;try{await We(),await j(i.value),B.push("/triageList")}catch(e){console.error("Error saving data:",e),G("Error occurred while saving data. Please try again.")}finally{f.value=!1}};return we(async()=>{if(P.NCDActivities.length===0){B.push("patientProfile");return}$().resetScreening(),n.value=R(),await m(),(u.value===void 0||u.value<0)&&(u.value=0,console.log("Setting initial tab index to 0")),k.value=!1,f.value=!1,y()}),c(u,async()=>{await y()}),c(ne,async()=>{await m()},{deep:!0}),c(i,async()=>{$().resetScreening(),await m()},{deep:!0}),c(L,async()=>{await m()},{deep:!0}),c(ie,async()=>{await m()},{deep:!0}),c(oe,async()=>{await m()},{deep:!0}),c(re,async()=>{await m()},{deep:!0}),c(V,async()=>{await m()},{deep:!0}),c(K,async e=>{I(),z(),n.value=R()},{deep:!0}),c(i,async(e,t)=>{e.ID!=t.ID&&(I(),z())},{deep:!0}),J({saveData:H,markWizard:m,refreshWizard:I,validateDoneButtonState:y}),(e,t)=>(W(),M(_(Be),null,{default:N(()=>[g(Le),g(_(_e),{fullscreen:!0},{default:N(()=>[g(Je),p("div",rt,[T.value?(W(),M(Ke,{key:0,ref:"wizard",headingTitle:"Primary Survey","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:E.value,"custom-tabs":n.value,beforeChange:_(Q),onChange:be,"onComplete:wizard":t[1]||(t[1]=a=>H()),onDoneButtonChanged:me},{default:N(()=>[p("div",null,[p("div",lt,[g(ze,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:_(xe),"font-weight":"600",onClick:t[0]||(t[0]=a=>ve())},null,8,["icon"])])]),D(p("div",null,[g(st,{ref:"airwayAssessmentRef"},null,512)],512),[[A,b()=="AirwayAssessment"]]),D(p("div",null,[g(at,{ref:"breathingAssessmentRef"},null,512)],512),[[A,b()=="BreathingAssessment"]]),D(p("div",null,[g(nt,{ref:"circulationAssessmentRef"},null,512)],512),[[A,b()=="CirculationAssessment"]]),D(p("div",null,[g(it,{ref:"disabilityAssessmentRef"},null,512)],512),[[A,b()=="DisabilityAssessment"]]),D(p("div",null,[g(ot,{ref:"exposureAssessmentRef"},null,512)],512),[[A,b()=="ExposureAssessment"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Ce("",!0)])]),_:1})]),_:1}))}});export{Lt as default};

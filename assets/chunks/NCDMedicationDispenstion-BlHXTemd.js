var Ne=Object.defineProperty;var Ve=(l,a,i)=>a in l?Ne(l,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[a]=i;var J=(l,a,i)=>Ve(l,typeof a!="symbol"?a+"":a,i);import{d as _e,L as x,N as S,ad as F,ac as z,E as $e,ae as he,M as W,I as Ae,ab as De,aT as Be,cg as X,R as qe,H as P,e as h,f as m,l as r,J as c,k as t,K as d,Q as y,F as I,b2 as E,am as Fe,cr as ze,r as O,c as Ee,b as Re,w as de,a as He,O as ue,u as n,av as G,P as A,bw as ce,aV as pe,m as T,b3 as ge,p as fe,dn as me,bg as ye,aS as Ue,aR as je}from"./vendor-BTebhqHt.js";import{E as Le}from"./EIRreportsStore-xF8KfXWW.js";import{N as Je}from"./NavigationMenu-CGKXhEJr.js";import{V as Ge}from"./ViewToggleComponent-hzyESSXG.js";import{n as Qe,_ as be,aX as Q,P as Ke,S as R,u as we,I as ke,F as We,bY as Xe,bG as ve,e as Ye,s as Ze,aL as et,q as tt,k as st,w as K,o as nt,bZ as rt,g as ot}from"../index-BpQfAx9h.js";import{a as xe}from"./drug_prescription_service-B0LJjeBw.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-no8IW45T.js";const at=_e({name:"MedicationDetailsModal",components:{IonContent:De,IonHeader:Ae,IonFooter:W,IonPage:he,IonTitle:$e,IonRow:z,IonCol:F,IonButton:S,IonIcon:x},props:{selectedMedication:{type:Object,default:null}},data(){return{iconsContent:Qe,medkit:X,closeIcon:Be,dismiss:()=>(this.$emit("close"),qe.dismiss())}},methods:{formatFullDate(l){return l?new Date(l).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"N/A"},getFrequencyLabel(l){const a=xe.find(i=>i.code===l);return a?a.label:"Unknown"}}}),lt={class:"medication-details-header"},it={class:"modal_wrapper"},dt={class:"medication-details-modal"},ut={class:"text-xl font-bold mb-4"},ct={class:"grid grid-cols-2 gap-3"};function pt(l,a,i,f,D,M){const g=P("ion-icon"),b=P("ion-title"),w=P("ion-header"),N=P("ion-content"),H=P("ion-button"),C=P("ion-col"),B=P("ion-row"),q=P("ion-footer");return m(),h(I,null,[r(w,{style:{display:"flex","justify-content":"space-between"}},{default:c(()=>[r(b,{class:"modalTitle"},{default:c(()=>[t("div",lt,[r(g,{icon:l.medkit,class:"ion-margin-end"},null,8,["icon"]),a[1]||(a[1]=t("span",null,"Medication Details",-1))])]),_:1}),r(g,{onClick:a[0]||(a[0]=V=>l.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:l.iconsContent.cancel},null,8,["icon"])]),_:1}),r(N,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:c(()=>[t("div",it,[t("div",dt,[t("h2",ut,d(l.selectedMedication.drug.name),1),t("div",ct,[t("div",null,[a[2]||(a[2]=t("strong",null,"Order ID:",-1)),y(" "+d(l.selectedMedication.order_id),1)]),t("div",null,[a[3]||(a[3]=t("strong",null,"Drug ID:",-1)),y(" "+d(l.selectedMedication.drug_inventory_id),1)]),t("div",null,[a[4]||(a[4]=t("strong",null,"Dose:",-1)),y(" "+d(l.selectedMedication.dose)+" "+d(l.selectedMedication.units),1)]),t("div",null,[a[5]||(a[5]=t("strong",null,"Equivalent Daily Dose:",-1)),y(" "+d(l.selectedMedication.equivalent_daily_dose),1)]),t("div",null,[a[6]||(a[6]=t("strong",null,"Frequency:",-1)),y(" "+d(l.getFrequencyLabel(l.selectedMedication.frequency)),1)]),t("div",null,[a[7]||(a[7]=t("strong",null,"Order Type:",-1)),y(" "+d(l.selectedMedication.order.order_type_id),1)]),t("div",null,[a[8]||(a[8]=t("strong",null,"Start Date:",-1)),y(" "+d(l.formatFullDate(l.selectedMedication.order.start_date)),1)]),t("div",null,[a[9]||(a[9]=t("strong",null,"Date Created:",-1)),y(" "+d(l.formatFullDate(l.selectedMedication.order.date_created)),1)]),t("div",null,[a[10]||(a[10]=t("strong",null,"Orderer:",-1)),y(" "+d(l.selectedMedication.order.orderer),1)]),t("div",null,[a[11]||(a[11]=t("strong",null,"Instructions:",-1)),y(" "+d(l.selectedMedication.order.instructions),1)])])])])]),_:1}),r(q,{collapse:"fade",class:"ion-no-border"},{default:c(()=>[r(B,null,{default:c(()=>[r(C,null,{default:c(()=>[r(H,{onClick:l.dismiss,color:"primary",style:{float:"right","margin-bottom":"20px","margin-right":"20px"}},{default:c(()=>[r(g,{icon:l.closeIcon,slot:"start"},null,8,["icon"]),a[12]||(a[12]=y(" Close ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})],64)}const gt=be(at,[["render",pt],["__scopeId","data-v-01db984e"]]);class ft extends Q{constructor(i=null,f=null){const D=new Ke,M=i!==null?i:D.getID(),g=f!==null?f:R.getUserID();super(M,32,g);J(this,"drugHistory");J(this,"currentDrugOrder");this.drugHistory=[],this.currentDrugOrder=[]}getDrugHistory(){return this.drugHistory}getCurrentOrder(){return this.currentDrugOrder}getDispensationArryObj(i){return[{drug_order_id:i.order_id,date:this.date,quantity:i.amountToDispense,offline_id:i.offline_id,provider_id:this.providerID,program_id:i.program_id,patient_id:this.patientID}]}saveDispensations(i,f){return Q.postJson("/dispensations",{dispensations:i,provider_id:this.providerID,program_id:f})}generateOfflineDispensatiobObject(i,f){return{dispensations:i,provider_id:this.providerID,program_id:f,patient_id:this.patientID}}async saveDispensationsOffline(i){var f,D,M;try{const g=we(),{patient:b}=E(g),w=JSON.parse(JSON.stringify(b.value));i.length>0&&((M=(D=(f=w.dispensations)!=null?f:w.dispensations={}).unsaved)!=null||(D.unsaved=[]),w.dispensations.unsaved.length>=0&&w.dispensations.unsaved.push(...i)),await ke(w),We("Dispensations saved offline successfully")}catch(g){Xe("Error saving dispensations offline"+g)}}async voidOrder(i){return Q.void("/dispensations/".concat(i),{})}async loadDrugHistory(){const i=await ve.getDrugOrderHistory(this.patientID);i&&(this.drugHistory=i)}async loadCurrentDrugOrder(){const i=await ve.getDrugOrders(this.patientID);i&&(this.currentDrugOrder=await Promise.all(i))}calcCompletePack(i,f){const D=i.barcodes.sort(function(b,w){return b.tabs-w.tabs});if(D.length==0||f==0)return f;for(let b=0;b<=D.length-1;b++)if(parseInt(D[b].tabs)>=f)return D[b].tabs;const M=parseInt(D[0].tabs);let g=parseInt(D[D.length-1].tabs);for(;g<f;)g+=M;return g}}const mt={key:0,style:{margin:"20px"},class:"flex flex-col items-center justify-center p-8"},yt={key:1,class:"p-4",style:{"margin-left":"10px","margin-right":"10px"}},vt={class:"text-xl font-bold mb-4 program-name"},_t={class:"overflow-x-auto"},ht={class:"w-full"},Dt={class:"p-3"},bt={class:"p-3"},wt={class:"flex items-center"},kt={class:"p-3"},xt={class:"p-3"},Ct={class:"p-3"},It={class:"flex items-center space-x-2"},Mt={key:0,class:"error-text text-sm"},Pt={class:"p-3"},Ot={class:"flex space-x-2"},St={key:0,class:"text-center py-8"},Tt={key:2,class:"p-4",style:{"margin-left":"10px","margin-right":"10px"}},Nt={class:"text-xl font-bold mb-4 program-name"},Vt={class:"text-lg font-bold mb-2",style:{"margin-left":"10px","margin-right":"10px"}},$t={class:"text-md font-medium",style:{"margin-left":"10px","margin-right":"10px"}},At={class:"medication-details"},Bt={class:"flex justify-between mb-3"},qt={class:"flex items-center"},Ft={class:"flex items-center mb-3"},zt={key:0,class:"error-text"},Et={class:"mt-3 flex space-x-2",style:{"margin-top":"10px"}},Rt={key:0,class:"text-center mb-8"},Ht=_e({__name:"NCDMedicationDispenstion",setup(l){const a=Le(),i=we(),f=Ye(),D=Ze(),{navigationPayload:M}=E(a),{patient:g}=E(i),{NCDMedicatioTogglePreference:b}=E(f),w=Fe(),N=ze(),H=O(null),C=O({}),B=O([]),q=O(null);O(""),O(!1);const V=O(!1),$=O({});Ee(()=>B.value.reduce((e,s)=>{const u=s.order.date_created.split("T")[0];return e[u]||(e[u]=[]),e[u].push(s),e},{}));const U=async()=>{ae(),B.value=[],Pe(),V.value=!1,await te()},Ce=async()=>{try{return await rt()?await Y():await Ie()}catch(e){return console.error("Error fetching programs:",e),await Y()}},Y=async()=>await R.getJson("/programs",{page_size:1e3}),Ie=async()=>{try{return await ot("programs")}catch(e){throw console.error("Error fetching offline districts:",e.message),e}},Z=async()=>{await new et().printData("visit")},Me=async e=>{await ee(e),await w.push("/home")},ee=async e=>{try{await tt(e),await D.refresh(R.getUserLocationId())}catch(s){console.error(s)}},Pe=()=>{a.setNavigationPayload("Dispense Medication",!0,!1,"/","home")},te=async()=>{var v,o,_,p,k,ie;const e=(_=(o=(v=g.value)==null?void 0:v.MedicationOrder)==null?void 0:o.saved)!=null?_:[],s=(ie=(k=(p=g.value)==null?void 0:p.MedicationOrder)==null?void 0:k.unsaved)!=null?ie:[],u=[...e,...s];await Oe(u)},Oe=async e=>{const s=await Ce(),u={};s.forEach(o=>{u[o.program_id]=o.name}),C.value={},e.forEach(o=>{const _=u[o.program_id];if(_&&(C.value[_]||(C.value[_]=[]),!o.quantity)){const p=j(o);if($.value[p]){o.amountToDispense=$.value[p];const k=parseFloat(o.amountToDispense);isNaN(k)||k<=0?o.error="Please enter a valid amount greater than 0.":o.error=null}C.value[_].push(o)}}),e.every(o=>o.quantity)&&R.getProgramID()==14&&(await st("All medications dispensed. Would you like to print the visit summary before closing?")&&await Z(),await ee(g.value),await w.push("/home"))},se=e=>{const s=xe.find(u=>u.code===e);return s?s.label:"Unknown"},j=e=>(e==null?void 0:e.order_id)||(e==null?void 0:e.offline_id)||"".concat(e.drug_name,"_").concat(e.start_date),L=e=>{const s=parseFloat(e.amountToDispense),u=j(e);$.value[u]=e.amountToDispense,isNaN(s)||s<=0?e.error="Please enter a valid amount greater than 0.":e.error=null},Ut=e=>{e.amountToDispense=e.dose,L(e)},ne=async e=>{V.value=!0;try{if(e.error){K("Fix errors before dispensing.");return}e.quantity=e.amountToDispense;const u=new ft().getDispensationArryObj(e);e.dispensation=u,e.dispensed=!0,await ke(g.value);const v=j(e);delete $.value[v],await te()}catch(s){K("Dispensing failed. Please try again."),K("Error: "+s),console.error(s)}finally{V.value=!1}},re=async e=>{q.value=e,await nt(gt,{class:"large-modal"},!0,{selectedMedication:q.value})},oe=e=>new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),Se=e=>{ae(e,!0)},ae=(e="list",s=!1)=>{const u={toggle_view:e};Object.keys(b.value).length===0&&(u.toggle_view="list",f.setNCDMedicatioTogglePreference(u)),Object.keys(b.value).length>0&&s===!0&&f.setNCDMedicatioTogglePreference(u)},Te=e=>(console.log("Grouping medications by date:",e),e.reduce((s,u)=>{const v=u.start_date.split("T")[0];return s[v]||(s[v]=[]),s[v].push(u),s},{})),le=()=>{$.value={}};return Re(()=>{le()}),de(g,async()=>{V.value||N.name==="NCDDispensations"&&await U()},{deep:!0}),de(N,(e,s)=>{(s==null?void 0:s.name)==="NCDDispensations"&&e.name!=="NCDDispensations"&&le(),e.name==="NCDDispensations"&&U()},{immediate:!0}),He(()=>{U()}),(e,s)=>(m(),ue(n(he),null,{default:c(()=>[r(Je,{ref_key:"navMenuRef",ref:H},null,512),r(Ge,{"initial-view":n(b).toggle_view,onViewChanged:Se},null,8,["initial-view"]),r(n(De),null,{default:c(()=>[Object.keys(C.value).length===0?(m(),h("div",mt,[r(n(x),{icon:n(G),size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),s[2]||(s[2]=t("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Medications to Dispense",-1)),s[3]||(s[3]=t("p",{class:"text-gray-600"},"There are currently no medications waiting to be dispensed for current Client.",-1))])):n(b).toggle_view==="list"?(m(),h("div",yt,[(m(!0),h(I,null,A(C.value,(u,v)=>(m(),h(I,{key:v},[t("h2",vt,d(v),1),r(n(ce),{class:"mb-6"},{default:c(()=>[r(n(pe),null,{default:c(()=>[t("div",_t,[t("table",ht,[s[6]||(s[6]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"p-3 text-left"},"Date"),t("th",{class:"p-3 text-left"},"Medication"),t("th",{class:"p-3 text-left"},"Dose"),t("th",{class:"p-3 text-left"},"Frequency"),t("th",{class:"p-3 text-left"},"Amount to Dispense"),t("th",{class:"p-3 text-left"},"Actions")])],-1)),t("tbody",null,[(m(!0),h(I,null,A(u,o=>(m(),h("tr",{key:(o==null?void 0:o.order_id)||(o==null?void 0:o.offline_id),class:"border-b hover:bg-gray-50"},[t("td",Dt,d(oe(o.start_date)),1),t("td",bt,[t("div",wt,[r(n(x),{icon:n(X),class:"mr-2"},null,8,["icon"]),y(" "+d(o.drug_name),1)])]),t("td",kt,d(o.dose)+" "+d(o.units),1),t("td",xt,d(se(o.frequency)),1),t("td",Ct,[t("div",It,[r(n(ge),{type:"number",placeholder:"Amount",modelValue:o.amountToDispense,"onUpdate:modelValue":_=>o.amountToDispense=_,onInput:_=>L(o),class:fe(["w-24 dose-input bordered-input",o.error?"input-error":""])},null,8,["modelValue","onUpdate:modelValue","onInput","class"]),T("",!0)]),o.error?(m(),h("div",Mt,d(o.error),1)):T("",!0)]),t("td",Pt,[t("div",Ot,[r(n(S),{color:"primary",size:"small",onClick:_=>ne(o),disabled:!o.amountToDispense||parseFloat(o.amountToDispense)<=0||o.dispensed},{default:c(()=>[r(n(x),{icon:n(me),class:"mr-1",style:{"margin-right":"5px"}},null,8,["icon"]),y(" "+d(o.dispensed?"Dispensed":"Dispense"),1)]),_:2},1032,["onClick","disabled"]),r(n(S),{color:"secondary",size:"small",onClick:_=>re(o),style:{"margin-left":"10px"}},{default:c(()=>[r(n(x),{icon:n(ye),class:"mr-1",style:{"margin-right":"5px"}},null,8,["icon"]),s[5]||(s[5]=y(" Details ",-1))]),_:1},8,["onClick"])])])]))),128))])]),u.length===0?(m(),h("div",St,[r(n(x),{icon:n(G),size:"large",class:"mb-2"},null,8,["icon"]),t("p",null,"No medications prescribed for "+d(v),1)])):T("",!0)])]),_:2},1024)]),_:2},1024)],64))),128))])):(m(),h("div",Tt,[(m(!0),h(I,null,A(C.value,(u,v)=>(m(),h(I,{key:v},[t("h2",Nt,d(v),1),(m(!0),h(I,null,A(Te(u),(o,_)=>(m(),h(I,{key:_},[t("h3",Vt,d(oe(_)),1),r(n(z),null,{default:c(()=>[r(n(F),{size:"12","size-md":"6","size-lg":"4"},{default:c(()=>[t("h3",$t,d(_),1)]),_:2},1024)]),_:2},1024),r(n(z),null,{default:c(()=>[(m(!0),h(I,null,A(o,p=>(m(),ue(n(F),{style:{"margin-left":"10px","margin-right":"10px"},key:p.order_id,size:"12","size-md":"6","size-lg":"4"},{default:c(()=>[r(n(ce),{class:"mb-4"},{default:c(()=>[r(n(Ue),null,{default:c(()=>[r(n(je),{class:"medication-details-header"},{default:c(()=>[r(n(x),{icon:n(X),class:"ion-margin-end"},null,8,["icon"]),t("span",null,d(p.drug_name),1)]),_:2},1024)]),_:2},1024),r(n(pe),null,{default:c(()=>[t("div",At,[t("div",Bt,[t("span",qt,d(se(p.frequency))+" ("+d(p.frequency)+") ",1)]),t("div",Ft,[r(n(ge),{type:"number",placeholder:"Amount",modelValue:p.amountToDispense,"onUpdate:modelValue":k=>p.amountToDispense=k,onInput:k=>L(p),class:fe(["w-24 dose-input bordered-input",p.error?"input-error":""])},null,8,["modelValue","onUpdate:modelValue","onInput","class"]),T("",!0)]),p.error?(m(),h("div",zt,d(p.error),1)):T("",!0),t("div",Et,[r(n(S),{color:"primary",onClick:k=>ne(p),disabled:!p.amountToDispense||parseFloat(p.amountToDispense)<=0||p.dispensed},{default:c(()=>[r(n(x),{icon:n(me),class:"mr-2",style:{"margin-right":"5px"}},null,8,["icon"]),y(" "+d(p.dispensed?"Dispensed":"Dispense"),1)]),_:2},1032,["onClick","disabled"]),r(n(S),{color:"secondary",style:{"margin-left":"20px"},onClick:k=>re(p)},{default:c(()=>[r(n(x),{icon:n(ye),class:"mr-2",style:{"margin-right":"5px"}},null,8,["icon"]),s[8]||(s[8]=y(" Details ",-1))]),_:1},8,["onClick"])])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)],64))),128)),u.length===0?(m(),h("div",Rt,[r(n(x),{icon:n(G),size:"large",class:"mb-2"},null,8,["icon"]),t("p",null,"No medications prescribed for "+d(v),1)])):T("",!0)],64))),128))]))]),_:1}),r(n(W),{collapse:"fade",class:"ion-no-border"},{default:c(()=>[r(n(z),null,{default:c(()=>[r(n(F),null,{default:c(()=>[r(n(S),{id:"cbtn",class:"",color:"primary",fill:"solid",style:{float:"right","margin-left":"50px"},onClick:s[0]||(s[0]=u=>Z())},{default:c(()=>[...s[9]||(s[9]=[y(" Print Visit Summary ",-1)])]),_:1}),r(n(S),{id:"cbtn",class:"",color:"danger",fill:"solid",style:{float:"right","margin-left":"50px"},onClick:s[1]||(s[1]=u=>Me(n(g)))},{default:c(()=>[...s[10]||(s[10]=[y(" Close visit ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),r(n(W))]),_:1}))}}),Zt=be(Ht,[["__scopeId","data-v-d7e6a4a3"]]);export{Zt as default};

System.register(["./vendor-legacy-D3PRHnoP.js","../index-legacy-B1Y8M3LU.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-BGLXb50r.js"],function(e,a){"use strict";var t,l,d,n,u,i,r,o,s,c,v,p,b,g,m,h,f,y,x,_,w,k,S,C,D,$,j,z,A,T,E,I,N,O,P,V,G,U,F,H,R;return{setters:[e=>{t=e.d,l=e.r,d=e.c,n=e.w,u=e.a,i=e.O,r=e.f,o=e.J,s=e.l,c=e.u,v=e.a4,p=e.bn,b=e.a5,g=e.a6,m=e.k,h=e.br,f=e.aS,y=e.m,x=e.aR,_=e.Q,w=e.K,k=e.cz,S=e.aV,C=e.e,D=e.i,$=e.b9,j=e.N,z=e.F,A=e.P,T=e.bj,E=e.I,I=e.G,N=e.E,O=e.a$,P=e.a7},e=>{V=e.T,G=e.aG,U=e.aH,F=e.U,H=e.H,R=e._},null,null],execute:function(){var a=document.createElement("style");a.textContent="ion-card[data-v-bde1132c]{margin:16px}.table-responsive[data-v-bde1132c]{overflow-x:auto}.audits-table[data-v-bde1132c],.changes-table[data-v-bde1132c]{width:100%;border-collapse:collapse;margin-bottom:1rem}.audits-table th[data-v-bde1132c],.audits-table td[data-v-bde1132c],.changes-table th[data-v-bde1132c],.changes-table td[data-v-bde1132c]{padding:.75rem;text-align:left;border-bottom:1px solid #dee2e6}.audits-table th[data-v-bde1132c],.changes-table th[data-v-bde1132c]{font-weight:600;background-color:#f8f9fa}.audits-table tr[data-v-bde1132c]:hover,.changes-table tr[data-v-bde1132c]:hover{background-color:rgba(0,0,0,.03)}.pagination-container[data-v-bde1132c]{display:flex;justify-content:center;align-items:center;gap:1rem;margin-top:1rem}.page-info[data-v-bde1132c]{font-size:.9rem;color:var(--ion-color-medium)}.date-controls[data-v-bde1132c]{margin-bottom:1rem}.date-inputs[data-v-bde1132c]{display:flex;align-items:end;gap:1rem;flex-wrap:wrap}.date-input-group[data-v-bde1132c]{display:flex;flex-direction:column;gap:.25rem}.date-input-group label[data-v-bde1132c]{font-size:.875rem;font-weight:500;color:var(--ion-color-medium)}.date-input[data-v-bde1132c]{padding:.5rem;border:1px solid #d1d5db;border-radius:4px;font-size:.875rem;background-color:#fff;min-width:140px}.date-input[data-v-bde1132c]:focus{outline:none;border-color:var(--ion-color-primary);box-shadow:0 0 0 2px rgba(var(--ion-color-primary-rgb),.2)}@media(max-width:768px){.date-inputs[data-v-bde1132c]{flex-direction:column;align-items:stretch}.date-input[data-v-bde1132c]{min-width:auto}}ion-modal[data-v-bde1132c]{--width: 80%;--height: 70%;--border-radius: 8px}@media(max-width:768px){ion-modal[data-v-bde1132c]{--width: 95%;--height: 80%}}.card-wrapper[data-v-bde1132c]{display:flex;justify-content:center}ion-card[data-v-bde1132c]{max-width:1000px;width:100%}\n/*$vite$:1*/",document.head.appendChild(a);const B={class:"card-wrapper"},J={class:"date-controls"},K={class:"date-inputs"},L={class:"date-input-group"},M=["max"],Q={class:"date-input-group"},q=["min","max"],W={key:0,class:"table-responsive"},X={class:"audits-table"},Y={key:0,class:"pagination-container"},Z={class:"page-info"},ee={key:1,class:"ion-text-center ion-padding"},ae={key:2,class:"ion-text-center ion-padding"},te={class:"table-responsive"},le={class:"changes-table"};e("default",R(t({__name:"SystemAudits",setup(e){const a=l("System Audits"),t=l([]),R=l("");l(""),l("");const de=l(""),ne=l(""),ue=l(!1),ie=l(1),re=l(!1),oe=l(""),se=l([]),ce=d(()=>Math.ceil(t.value.length/20)),ve=d(()=>{const e=20*(ie.value-1),a=e+20;return t.value.slice(e,a)});n([de,ne],([e,a])=>{e&&a&&(R.value=`${be(e)} - ${be(a)}`)}),u(()=>{const e=new Date;ne.value=e.toISOString().split("T")[0],de.value=e.toISOString().split("T")[0]});const pe=()=>(new Date).toISOString().split("T")[0],be=e=>new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),ge=async()=>{if(de.value&&ne.value){await U.show();try{t.value=await F.getAuditReports(de.value,ne.value),ue.value=!0,ie.value=1}catch(e){console.error("Error generating audit report:",e),G("Failed to generate audit report"),t.value=[]}finally{await U.hide()}}else G("Please select both start and end dates")},me=()=>{re.value=!1,oe.value="",se.value=[]},he=()=>{ie.value<ce.value&&ie.value++},fe=()=>{ie.value>1&&ie.value--};return(e,l)=>(r(),i(c(P),null,{default:o(()=>[s(V,{title:"System Audits"}),s(c(v),null,{default:o(()=>[s(c(p),null,{default:o(()=>[s(c(b),null,{default:o(()=>[s(c(g),{size:"12","size-md":"12","size-lg":"12"},{default:o(()=>[m("div",B,[s(c(h),null,{default:o(()=>[s(c(f),null,{default:o(()=>[s(c(x),null,{default:o(()=>[_(w(a.value),1)]),_:1}),R.value?(r(),i(c(k),{key:0},{default:o(()=>[_(w(R.value),1)]),_:1})):y("",!0)]),_:1}),s(c(S),null,{default:o(()=>[m("div",J,[m("div",K,[m("div",L,[l[2]||(l[2]=m("label",null,"Start Date:",-1)),D(m("input",{type:"date","onUpdate:modelValue":l[0]||(l[0]=e=>de.value=e),max:ne.value||pe(),class:"date-input"},null,8,M),[[$,de.value]])]),m("div",Q,[l[3]||(l[3]=m("label",null,"End Date:",-1)),D(m("input",{type:"date","onUpdate:modelValue":l[1]||(l[1]=e=>ne.value=e),min:de.value,max:pe(),class:"date-input"},null,8,q),[[$,ne.value]])]),s(c(j),{fill:"solid",onClick:ge,disabled:!de.value||!ne.value},{default:o(()=>[...l[4]||(l[4]=[_(" Generate Report ",-1)])]),_:1},8,["disabled"])])]),t.value.length>0?(r(),C("div",W,[m("table",X,[l[5]||(l[5]=m("thead",null,[m("tr",null,[m("th",null,"Encounter"),m("th",null,"Action Type"),m("th",null,"User"),m("th",null,"Timestamp"),m("th",null,"Changes")])],-1)),m("tbody",null,[(r(!0),C(z,null,A(ve.value,e=>{return r(),C("tr",{key:e.id},[m("td",null,w(e.auditable_type),1),m("td",null,w(e.action),1),m("td",null,w((t=e.user,t?`${t.username} (${t.name})`:"")),1),m("td",null,w((a=e.created_at,H.toStandardHisDisplayFormat(a))),1),m("td",null,[s(c(j),{size:"small",fill:"outline",onClick:a=>(async e=>{if(!e.changes||0===e.changes.length)return;const a=e.changes.map(e=>{const[a,t]=Object.entries(e)[0]||[];return a?/password/i.test(a)?{attribute:a,previous:"*******",current:"*******"}:{attribute:a,...t}:null}).filter(e=>null!==e);oe.value=`Changes made by ${e.user.name} on ${e.auditable_type}`,se.value=a,re.value=!0})(e),disabled:!e.changes||0===e.changes.length},{default:o(()=>{var a,t;return[_(w(null!==(a=null===(t=e.changes)||void 0===t?void 0:t.length)&&void 0!==a?a:0)+" Changes ",1)]}),_:2},1032,["onClick","disabled"])])]);var a,t}),128))])]),ce.value>1?(r(),C("div",Y,[s(c(j),{fill:"clear",onClick:fe,disabled:1===ie.value},{default:o(()=>[...l[6]||(l[6]=[_(" Previous ",-1)])]),_:1},8,["disabled"]),m("span",Z," Page "+w(ie.value)+" of "+w(ce.value),1),s(c(j),{fill:"clear",onClick:he,disabled:ie.value===ce.value},{default:o(()=>[...l[7]||(l[7]=[_(" Next ",-1)])]),_:1},8,["disabled"])])):y("",!0)])):0===t.value.length&&ue.value?(r(),C("div",ee,[...l[8]||(l[8]=[m("p",null,"No audit records found for the selected period",-1)])])):(r(),C("div",ae,[...l[9]||(l[9]=[m("p",null,"Select date range and generate report to view audit data",-1)])]))]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),s(c(T),{"is-open":re.value,onDidDismiss:me},{default:o(()=>[s(c(E),null,{default:o(()=>[s(c(I),null,{default:o(()=>[s(c(N),null,{default:o(()=>[_(w(oe.value),1)]),_:1}),s(c(O),{slot:"end"},{default:o(()=>[s(c(j),{onClick:me},{default:o(()=>[...l[10]||(l[10]=[_("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(c(v),null,{default:o(()=>[s(c(h),null,{default:o(()=>[s(c(S),null,{default:o(()=>[m("div",te,[m("table",le,[l[11]||(l[11]=m("thead",null,[m("tr",null,[m("th",null,"Attribute"),m("th",null,"Previous Value"),m("th",null,"Current Value")])],-1)),m("tbody",null,[(r(!0),C(z,null,A(se.value,(e,a)=>(r(),C("tr",{key:a},[m("td",null,w(e.attribute),1),m("td",null,w(e.previous||"N/A"),1),m("td",null,w(e.current||"N/A"),1)]))),128))])])])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])]),_:1}))}}),[["__scopeId","data-v-bde1132c"]]))}}});

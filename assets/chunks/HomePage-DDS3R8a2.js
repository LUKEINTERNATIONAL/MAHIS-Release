var Re=Object.defineProperty;var Le=(t,e,s)=>e in t?Re(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var at=(t,e,s)=>Le(t,typeof e!="symbol"?e+"":e,s);import{d as H,cX as Ve,ap as Dt,r as B,c as Q,w as lt,a as ct,e as _,f as d,k as n,m as S,p as st,K as g,l as a,u as k,b3 as le,Q as T,L as J,F as x,P as q,cY as Me,c9 as Be,ay as de,by as Ee,bk as Fe,b$ as Jt,c7 as ce,b7 as Ct,H as u,O as V,J as o,D as ue,ai as K,cZ as pe,c_ as me,ar as he,c$ as ge,d0 as xe,ce as fe,d1 as He,d2 as Ue,d3 as We,d4 as ze,d5 as je,d6 as Ge,d7 as Je,aU as qe,bM as _e,an as Qe,n as ve,aV as qt,aR as be,aS as ye,br as Lt,a6 as Vt,N as Nt,a5 as Mt,G as ut,a7 as $t,I as it,a4 as et,bA as Wt,a2 as Ye,d8 as Xe,aH as Ze,d9 as Ke,da as tn,cE as en,aG as nn,cJ as De,aP as gt,b2 as zt,W as Ot,db as Ce,aL as Qt,cp as Yt,aF as an,i as sn,b9 as on,dc as rn,z as ln,dd as Xt,de as dt,X as vt,df as $e,ba as dn,bp as cn,bm as un,E as wt,aj as kt,ak as pt,$ as mt,R as Bt,bg as pn,dg as mn,dh as hn,di as gn,dj as fn,bx as Et,b6 as we,dk as _n,c3 as vn,dl as bn,dm as yn,bs as Dn,bU as Cn}from"./vendor-CxrCa3Dl.js";import{S as G,u as tt,_ as W,P as ft,t as yt,a as ke,E as $n,H as A,A as wn,b as kn,c as Se,d as te,e as Ie,f as Sn,g as St,R as In,p as An,h as ee,i as Pn,O as Tn,j as Nn,B as On,k as ne,l as Ft,m as Tt,n as Rn,o as Rt,q as jt,r as Ln,s as ae,T as Ae,v as Vn,w as Z,x as se,y as Mn,z as Bn,U as En,L as Fn,C as xn}from"../index-Bez2ogcw.js";import{m as Zt}from"./apexcharts-aekSR0UU.js";import{A as Pe}from"./ncd_appointment_service-B-cbFPHa.js";import{D as Kt}from"./DateInputField-7JTv07nc.js";import{u as Hn,_ as Un,M as Wn}from"./ActionButtons.vue_vue_type_script_setup_true_lang-DDWZe7yT.js";import{V as zn}from"./ViewToggleComponent-FO8KlEZ5.js";import{B as jn}from"./bottomNavBar-DbtnAyP5.js";import{P as Gn}from"./patient_report_service-BCLTVJ2z.js";import{l as bt}from"./lodash-NJiRuGo9.js";import{B as It}from"./BasicForm-DIbjKF_k.js";import{B as xt}from"./BasicCard-CWjD1YqO.js";import{u as Jn}from"./AdministerOtherVaccinesStore-wD-Llj3j.js";import{c as qn}from"./customDatePicker-vc8DJ-Jm.js";import{s as Qn}from"./vaccines_service-C9ysOmK-.js";import{g as Yn}from"./dashboard_service-_SjiRP6n.js";import{i as Xn}from"./Img-CJEgX1Vr.js";import{u as Te}from"./useUserActivities-BTgbu-Lj.js";import oe from"./NeonatalHome-RrUDtMVk.js";import"./sms_service-Si4wsnmX.js";import"./EIRreportsStore-BVaUBqq8.js";import"./Export-BFLGM8r3.js";import"./neonatal_service-BVzqfR5W.js";import"./images-DJIykHYW.js";const ot={VITALS:6,APPOINTMENT:7,HIV_CLINIC_REGISTRATION:9,TREATMENT:25,HIV_RECEPTION:51,HIV_STAGING:52,HIV_CLINIC_CONSULTATION:53,DISPENSING:54,ART_ADHERENCE:68};class ie extends G{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(e){return await super.getJson("fhir/patient/".concat(e),{id:e})}static async getFhirObservations(e){return await super.getJson("fhir/patient/".concat(e,"/observations/"),{id:e})}}const Zn={class:"fhir-viewer"},Kn={class:"container"},ta={key:0,class:"main-header"},ea={class:"header-line"},na={key:0,class:"last-updated-display"},aa={key:1,class:"card initial-input-card"},sa={class:"action-area-initial"},oa={key:0,class:"card patient-card"},ia={class:"card-title"},ra={class:"patient-info-grid"},la={class:"info-item"},da={class:"info-value"},ca={class:"info-item"},ua={class:"info-value"},pa={class:"info-item"},ma={class:"info-value"},ha={class:"info-item"},ga={class:"info-value"},fa={class:"info-value"},_a={class:"info-value"},va={class:"info-label"},ba={class:"info-value"},ya={key:2,class:"card observations-card"},Da={class:"card-title"},Ca={class:"observations-grid"},$a={class:"obs-header"},wa={class:"obs-title"},ka={class:"obs-details"},Sa={class:"obs-detail obs-value-highlight"},Ia={class:"obs-value"},Aa={class:"obs-detail"},Pa={class:"obs-value"},Ta={key:0,class:"obs-detail"},Na={class:"obs-value"},Oa={key:3,class:"no-data-found"},Ra={key:4,class:"no-data-found"},La={key:5,class:"main-footer"},Va=H({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(t){Ve({"person-circle-outline":ce,"clipboard-outline":Jt,"search-outline":Fe,"information-circle-outline":Ee,"alert-circle-outline":de,"person-add-outline":Be,"arrow-back-outline":Me});const e=t,s=Dt(),r=B(!1),l=B([]),f=B(),i=B(),c=B(null),p=B([]),v=Q(()=>l.value.some(w=>w.resourceType==="Bundle"&&w.entry&&w.entry.some(h=>h.resource&&h.resource.resourceType==="Patient"))),m=Q(()=>p.value.length>0),C=async()=>{if(l.value=[],i.value=null,c.value=null,p.value=[],!f.value){console.error("Please enter a Patient Identifier.");return}r.value=!0;try{const w=await ie.getFhirPatient(f.value);if(w&&w.entry&&w.entry.length>0){const h=w.entry[0].resource,j=h.id,U=await ie.getFhirObservations(j);l.value=[w],U&&(l.value.push(U),p.value=U.entry.filter(Y=>Y.resource&&Y.resource.resourceType==="Observation").map(Y=>{const L=Y.resource;return{id:L.id,display:M(L),value:z(L),date:L.effectiveDateTime,category:L.category&&L.category[0]&&L.category[0].coding&&L.category[0].coding[0]?L.category[0].coding[0].display||L.category[0].coding[0].code:"N/A"}}));const E=h.name&&h.name[0];c.value={personInformation:{given_name:E&&E.given?E.given.join(" "):"",middle_name:E&&E.middle?E.middle.join(" "):"",family_name:E&&E.family?E.family:"",gender:h.gender=="male"?"M":(h==null?void 0:h.gender)=="female"?"F":"",birthdate:h.birthDate||"",cell_phone_number:h.telecom&&h.telecom[0]?h.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:h.contact&&h.contact[0]&&h.contact[0].telecom?h.contact[0].telecom[0].value:""}]}};const R=[w,U].filter(Boolean).reduce((Y,L)=>{if(L.meta&&L.meta.lastUpdated){const nt=new Date(L.meta.lastUpdated);return Y===null||nt>Y?nt:Y}return Y},null);R&&(i.value=I(R.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch(w){console.error("Error loading FHIR data:",w),l.value=[],i.value=null,c.value=null,p.value=[]}finally{r.value=!1}},$=w=>{if(w.name&&w.name[0]){const h=w.name[0],j=h.given?h.given.join(" "):"",U=h.family||"";return"".concat(j," ").concat(U).trim()||"N/A"}return"N/A"},D=w=>w.identifier&&w.identifier.length>0?w.identifier.map(h=>{let j="Unknown System";if(h.type&&h.type.coding&&h.type.coding[0]&&h.type.coding[0].display)j=h.type.coding[0].display;else if(h.system){const E=h.system.split("/");j=E[E.length-1]||h.system,h.system==="urn:oid:2.16.840.1.113883.4.6"&&(j="Social Security Number")}sessionStorage.setItem(j,h.value);let U=null;return h.assigner&&h.assigner.display?U=h.assigner.display:h.assigner&&h.assigner.reference&&(U=h.assigner.reference.split("/").pop()||h.assigner.reference),{value:h.value||"N/A",systemDisplay:j,periodStart:h.period?h.period.start:null,periodEnd:h.period?h.period.end:null,assignerDisplay:U}}):[],y=w=>w.telecom&&w.telecom.length>0?w.telecom.filter(h=>h.system==="phone"&&h.value):[],b=w=>{if(w.contact&&w.contact.length>0){const h=w.contact.filter(U=>{var E;return(E=U.relationship)==null?void 0:E.some(F=>{var R;return(R=F.coding)==null?void 0:R.some(Y=>Y.code==="GUARD")})}),j=[];return h.forEach(U=>{U.telecom&&U.telecom.length>0&&U.telecom.filter(E=>E.system==="phone"&&E.value).forEach(E=>j.push(E))}),j}return[]},N=w=>{if(!w)return"N/A";try{return new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(h){return console.error("Invalid date string for formatDate:",w,h),"Invalid Date"}},I=w=>{if(!w)return"N/A";try{return new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(h){return console.error("Invalid date time string for formatDateTime:",w,h),"Invalid Date/Time"}},P=w=>{if(!w)return"N/A";try{const h=new Date,j=new Date(w);let U=h.getFullYear()-j.getFullYear();const E=h.getMonth()-j.getMonth();return(E<0||E===0&&h.getDate()<j.getDate())&&U--,U}catch(h){return console.error("Invalid birth date string for calculateAge:",w,h),"N/A"}},O=w=>{if(w.meta&&w.meta.tag){const h=w.meta.tag.find(j=>j.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return h?h.code:"Unknown"}return"Unknown"},M=w=>w.code&&w.code.coding&&w.code.coding[0]&&(w.code.coding[0].display||w.code.coding[0].code)||"Unknown Observation",z=w=>w.valueQuantity?"".concat(w.valueQuantity.value," ").concat(w.valueQuantity.unit||"").trim():w.valueString?w.valueString:w.valueBoolean!==void 0?w.valueBoolean?"True":"False":"N/A",X=()=>{tt().setRecord(c.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(p.value)),Pt("/registration/manual")},ht=()=>{l.value=[],f.value="",i.value=null,c.value=null,p.value=[]},Pt=w=>{s.push({path:w})};return lt(()=>s,async()=>{l.value=[],p.value=[]},{deep:!0}),ct(()=>{var w;if(e.initialData.length>0){l.value=e.initialData;const j=e.initialData.filter(Boolean).reduce((F,R)=>{if(R.meta&&R.meta.lastUpdated){const Y=new Date(R.meta.lastUpdated);return F===null||Y>F?Y:F}return F},null);j&&(i.value=I(j.toISOString()));const U=e.initialData.find(F=>F.resourceType==="Bundle"&&F.entry&&F.entry.some(R=>R.resource&&R.resource.resourceType==="Patient"));if(U){const F=(w=U.entry.find(R=>R.resource&&R.resource.resourceType==="Patient"))==null?void 0:w.resource;if(F){const R=F.name&&F.name[0];c.value={personInformation:{given_name:R&&R.given?R.given.join(" "):"",middle_name:R&&R.middle?R.middle.join(" "):"",family_name:R&&R.family?R.family:"",gender:F.gender||"",birthdate:F.birthDate||""}}}}const E=e.initialData.find(F=>F.resourceType==="Bundle"&&F.entry&&F.entry.some(R=>R.resource&&R.resource.resourceType==="Observation"));E&&(p.value=E.entry.filter(F=>F.resource&&F.resource.resourceType==="Observation").map(F=>{const R=F.resource;return{id:R.id,display:M(R),value:z(R),date:R.effectiveDateTime,category:R.category&&R.category[0]&&R.category[0].coding&&R.category[0].coding[0]?R.category[0].coding[0].display||R.category[0].coding[0].code:"N/A"}}))}}),(w,h)=>{var j,U,E,F,R,Y;return d(),_("div",Zn,[n("div",Kn,[(j=l.value)!=null&&j.length?(d(),_("header",ta,[n("div",ea,[h[1]||(h[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:st(["last-updated-display","status-"+O(l.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+g(O(l.value[0].entry[0].resource)),3),i.value?(d(),_("span",na,"Last Updated: "+g(i.value),1)):S("",!0)])])])):S("",!0),(U=l.value)!=null&&U.length?S("",!0):(d(),_("section",aa,[a(k(le),{modelValue:f.value,"onUpdate:modelValue":h[0]||(h[0]=L=>f.value=L),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",sa,[n("button",{onClick:C,class:"load-data-btn"},[a(k(J),{name:"search-outline"}),h[2]||(h[2]=T(" Find Patient ",-1))])])])),(d(!0),_(x,null,q(l.value,L=>(d(),_("div",{key:L.id},[L.resourceType==="Bundle"&&L.entry&&L.entry[0]&&L.entry[0].resource.resourceType==="Patient"?(d(),_("section",oa,[n("h2",ia,[a(k(J),{name:"person-circle-outline"}),h[3]||(h[3]=T(" Patient Demographics",-1))]),n("div",ra,[n("div",la,[h[4]||(h[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",da,g($(L.entry[0].resource)),1)]),n("div",ca,[h[5]||(h[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",ua,g(L.entry[0].resource.gender||"Not specified"),1)]),n("div",pa,[h[6]||(h[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",ma,g(N(L.entry[0].resource.birthDate)),1)]),n("div",ha,[h[7]||(h[7]=n("span",{class:"info-label"},"Age",-1)),n("span",ga,g(P(L.entry[0].resource.birthDate))+" years",1)]),y(L.entry[0].resource).length?(d(!0),_(x,{key:0},q(y(L.entry[0].resource),(nt,_t)=>(d(),_("div",{key:"patient-phone-".concat(_t),class:"info-item"},[h[8]||(h[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",fa,g(nt.value),1)]))),128)):S("",!0),b(L.entry[0].resource).length?(d(!0),_(x,{key:1},q(b(L.entry[0].resource),(nt,_t)=>(d(),_("div",{key:"guardian-phone-".concat(_t),class:"info-item"},[h[9]||(h[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",_a,g(nt.value),1)]))),128)):S("",!0),(d(!0),_(x,null,q(D(L.entry[0].resource),(nt,_t)=>(d(),_("div",{key:nt.value||_t,class:"info-item"},[n("span",va,g(nt.systemDisplay),1),n("span",ba,g(nt.value),1)]))),128))])])):S("",!0)]))),128)),((E=p.value)==null?void 0:E.length)>0?(d(),_("section",ya,[n("h2",Da,[a(k(J),{name:"clipboard-outline"}),h[10]||(h[10]=T(" Clinical Observations",-1))]),n("div",Ca,[(d(!0),_(x,null,q(p.value,L=>(d(),_("div",{key:L.id,class:"observation-item"},[n("div",$a,[n("h3",wa,g(L.display),1)]),n("div",ka,[n("div",Sa,[h[11]||(h[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",Ia,g(L.value),1)]),n("div",Aa,[h[12]||(h[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",Pa,g(I(L.date)),1)]),L.category&&L.category!=="N/A"?(d(),_("div",Ta,[h[13]||(h[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",Na,g(L.category),1)])):S("",!0)])]))),128))])])):S("",!0),(F=l.value)!=null&&F.length&&!v.value?(d(),_("div",Oa,[n("p",null,[a(k(J),{name:"alert-circle-outline"}),h[14]||(h[14]=T(" No patient data found for the provided identifier. Please try again.",-1))])])):(R=l.value)!=null&&R.length&&v.value&&!m.value?(d(),_("div",Ra,[n("p",null,[a(k(J),{name:"information-circle-outline"}),h[15]||(h[15]=T(" No clinical observations found for this patient.",-1))])])):S("",!0),(Y=l.value)!=null&&Y.length?(d(),_("footer",La,[n("button",{onClick:ht,class:"back-to-search-btn small-btn"},[a(k(J),{name:"arrow-back-outline"}),h[16]||(h[16]=T(" Back to Search ",-1))]),n("button",{onClick:X,class:"register-btn small-btn"},[a(k(J),{name:"person-add-outline"}),h[17]||(h[17]=T(" Register New Patient ",-1))])])):S("",!0)])])}}}),Ma=W(Va,[["__scopeId","data-v-0dc329ef"]]),Ba=H({components:{DataTable:Ct},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Referred From",data:"referredFrom"},{title:"Referred By",data:"referredBy"},{title:"Clinic Date",data:"appointmentDate"},{title:"Actions",data:null,render:(t,e,s)=>'<ion-button size="small" fill="solid" color="primary" onclick="window.navigatePatient(\''.concat(s.patient_id,"')\">Profile</ion-button>"),orderable:!1,width:"20%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No referrals found."}}}},async mounted(){var l;const e=(l=ke().activeProgram)==null?void 0:l.program_id,s=String(localStorage.getItem("locationID")),r=await $n.getAllEncounters({encounter_type_id:114});console.log("Encounters fetched for Internal Referrals:",r),this.patients=r.reduce((f,i)=>{var $,D,y,b,N,I,P,O;if(String(i==null?void 0:i.location_id)!==s||!(($=i==null?void 0:i.observations)==null?void 0:$.find(M=>(M==null?void 0:M.concept_id)===2227&&(M==null?void 0:M.value_numeric)===e)))return f;const p=(b=(y=(D=i==null?void 0:i.patient)==null?void 0:D.person)==null?void 0:y.names)!=null&&b[0]?"".concat(i.patient.person.names[0].given_name||""," ").concat(i.patient.person.names[0].family_name||""):"Unknown";let v=((N=i==null?void 0:i.program)==null?void 0:N.name)||"Unknown Program";v=v.replace(/program/i,"").trim();const m=(P=(I=i==null?void 0:i.provider)==null?void 0:I.names)!=null&&P[0]?"".concat(i.provider.names[0].given_name||""," ").concat(i.provider.names[0].family_name||""):"Unknown",C=(O=i==null?void 0:i.observations)==null?void 0:O.find(M=>{var z,X;return(X=(z=M==null?void 0:M.concept)==null?void 0:z.concept_names)==null?void 0:X.some(ht=>{var Pt;return(Pt=ht==null?void 0:ht.name)==null?void 0:Pt.toLowerCase().includes("date of referral")})});return f.push({patient_id:i.patient_id,fullName:p,referredFrom:v,referredBy:m,appointmentDate:(C==null?void 0:C.value_text)||"N/A"}),f},[]),window.navigatePatient=this.navigateTo},methods:{async navigateTo(t){let e=await ft.findByID(t);e?(await tt().setPatientRecord(e),this.$router.push("/patientProfile")):yt("Patient not found. Please try searching by name.")}}}),Ea={class:"dueCardContent"};function Fa(t,e,s,r,l,f){const i=u("DataTable"),c=u("ion-card-content"),p=u("ion-card");return d(),V(p,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:o(()=>[a(c,null,{default:o(()=>[n("div",Ea,[a(i,{data:t.patients,columns:t.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})}const Ne=W(Ba,[["render",Fa],["__scopeId","data-v-a95ef46a"]]),xa=H({name:"referrals",components:{InternalReferrals:Ne,ExternalReferrals:Ma},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){this.segmentContent=t}}}),Ha={key:0},Ua={style:{display:"flex","margin-top":"10px"}},Wa={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},za={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},ja={key:1},Ga={key:2};function Ja(t,e,s,r,l,f){const i=u("ion-label"),c=u("ion-segment-button"),p=u("ion-segment"),v=u("ExternalReferrals"),m=u("InternalReferrals");return d(),_(x,null,[n("div",null,[a(p,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:o(()=>[a(c,{value:"External referrals",onClick:e[0]||(e[0]=C=>t.setSegmentContent("External referrals"))},{default:o(()=>[a(i,null,{default:o(()=>[...e[2]||(e[2]=[T("External referrals",-1)])]),_:1})]),_:1}),a(c,{value:"Internal referrals",onClick:e[1]||(e[1]=C=>t.setSegmentContent("Internal referrals"))},{default:o(()=>[a(i,null,{default:o(()=>[...e[3]||(e[3]=[T("Internal referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(d(),_("div",Ha,[n("div",Ua,[t.checkUnderFive?(d(),_("div",Wa)):S("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?S("",!0):(d(),_("div",za))])])):S("",!0),t.segmentContent=="External referrals"?(d(),_("div",ja,[a(v)])):S("",!0),t.segmentContent=="Internal referrals"?(d(),_("div",Ga,[a(m)])):S("",!0)],64)}const qa=W(xa,[["render",Ja],["__scopeId","data-v-8f0f935e"]]),Gt=ue("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(t){this.selectedItem=t},getSelectedItem(){return this.selectedItem}},persist:!0}),Qa=()=>{const t=B(null);return{activeIteminMixin:t,setActiveItem:s=>{t.value=s,console.log("lll: ",t.value)}}},At=H({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:t,setActiveItem:e}=Qa();return{chevronBackOutline:_e,checkmark:qe,grid:Je,chevronDownCircle:Ge,chevronForwardCircle:je,chevronUpCircle:ze,colorPalette:We,document:Ue,globe:He,medkit:fe,add:xe,person:ge,people:he,thermometer:me,clipboard:pe,activeIteminMixin:t,setActiveItem:e}},async mounted(){await this.setAppointments()},computed:{...K(tt,["patient"])},watch:{$route:{async handler(t){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await wn.getDailyAppointments(A.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((t,e)=>t.given_name.localeCompare(e.given_name)))},formatBirthdate(t){return A.getBirthdateAge(t)},setActiveItemRefFN(t){Gt().setSelectedItem(t)}}}),Ya=ue("ncdDashboardStore",{state:()=>({dashboardData:null,appointments:[],isLoading:!1,error:null,lastFetchDate:null,programId:32}),getters:{appointmentsCount:t=>t.appointments.length,pendingDispensationsCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_pending_dispensations)||0},defaultersCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_defaulters)||0},complicationsCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_complications)||0},activeClientsCount:t=>{var e;return((e=t.dashboardData)==null?void 0:e.total_client_registered)||0},genderChartData:t=>{var e;return(e=t.dashboardData)!=null&&e.gender_data?{categories:t.dashboardData.gender_data.categories,series:[{name:"Male",data:t.dashboardData.gender_data.maleSeries},{name:"Female",data:t.dashboardData.gender_data.femaleSeries}]}:{categories:[],series:[{name:"Male",data:[]},{name:"Female",data:[]}]}},diagnosisChartData:t=>{var e;return(e=t.dashboardData)!=null&&e.diagnosis_data?{categories:t.dashboardData.diagnosis_data.categories,series:[{name:"Type 1 Diabetes",data:t.dashboardData.diagnosis_data.typeOneSeries},{name:"Type 2 Diabetes",data:t.dashboardData.diagnosis_data.typeTwoSeries},{name:"Hypertention",data:t.dashboardData.diagnosis_data.hypertentionSeries}]}:{categories:[],series:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},hasData:t=>t.dashboardData!==null,isDataStale:t=>{if(!t.lastFetchDate)return!0;const e=A.toStandardHisFormat(A.sessionDate());return t.lastFetchDate!==e}},actions:{async fetchDashboardData(t,e){this.isLoading=!0,this.error=null;try{const s=t||A.toStandardHisFormat(A.sessionDate()),r=e||A.toStandardHisFormat(A.sessionDate()),l="programs/".concat(this.programId,"/reports/ncd_dashboard"),f=await G.getJson(l,{start_date:s,end_date:r});this.setDashboardData(f),this.lastFetchDate=s}catch(s){this.error=s.message||"Failed to fetch dashboard data",console.error("Error fetching NCD dashboard data:",s)}finally{this.isLoading=!1}},setDashboardData(t){this.dashboardData=t},setAppointments(t){this.appointments=t},addAppointment(t){this.appointments.push(t)},removeAppointment(t){this.appointments=this.appointments.filter(e=>e.id!==t)},updateAppointment(t,e){const s=this.appointments.findIndex(r=>r.id===t);s!==-1&&(this.appointments[s]={...this.appointments[s],...e})},setProgramId(t){this.programId=t},clearDashboardData(){this.dashboardData=null,this.appointments=[],this.error=null,this.lastFetchDate=null},async refreshDashboardData(){await this.fetchDashboardData()},async ensureFreshData(){(this.isDataStale||!this.hasData)&&await this.fetchDashboardData()}},persist:{key:"ncd-dashboard-store",storage:localStorage,paths:["dashboardData","appointments","lastFetchDate","programId"]}}),Xa=H({name:"NCDDashboard",mixins:[At],components:{ApexChart:Zt},setup(){const t=Dt(),e=Ya();return{router:t,dashboardStore:e}},data(){return{isChartReady:!1}},computed:{lineChartOptions(){return{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:this.dashboardStore.genderChartData.categories},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}}},barChartOptions(){return{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:this.dashboardStore.diagnosisChartData.categories},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}}}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){await this.dashboardStore.ensureFreshData(),await ve(),setTimeout(()=>{this.isChartReady=!0},100)},navigationMenu(t){try{Qe.close(),this.router.push(t).then(()=>{})}catch(e){console.error(e)}}}}),Za={class:"cards-container"},Ka={class:"top-card-text"},ts={class:"text-2xl font-bold"},es={class:"top-card-text"},ns={class:"text-2xl font-bold"},as={class:"top-card-text"},ss={class:"text-2xl font-bold"},os={class:"top-card-text"},is={class:"text-2xl font-bold"},rs={class:"top-card-text"},ls={class:"text-2xl font-bold"},ds={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},cs={ref:"chartRef1"},us={key:1,class:"loading-state"},ps={ref:"chartRef2"},ms={key:1,class:"loading-state"};function hs(t,e,s,r,l,f){const i=u("ion-card-content"),c=u("ion-card"),p=u("ApexChart");return d(),_(x,null,[n("div",Za,[a(c,{class:"top-card action-card",onClick:e[0]||(e[0]=v=>t.setActiveItemRefFN("appointments"))},{default:o(()=>[a(i,null,{default:o(()=>[n("div",Ka,[n("div",ts,g(t.dashboardStore.appointmentsCount),1),e[2]||(e[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]),_:1})]),_:1}),a(c,{class:"top-card action-card"},{default:o(()=>[a(i,null,{default:o(()=>[n("div",es,[n("div",ns,g(t.dashboardStore.pendingDispensationsCount),1),e[3]||(e[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]),_:1})]),_:1}),a(c,{class:"top-card action-card"},{default:o(()=>[a(i,null,{default:o(()=>[n("div",as,[n("div",ss,g(t.dashboardStore.defaultersCount),1),e[4]||(e[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]),_:1})]),_:1}),a(c,{class:"top-card action-card"},{default:o(()=>[a(i,null,{default:o(()=>[n("div",os,[n("div",is,g(t.dashboardStore.complicationsCount),1),e[5]||(e[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]),_:1})]),_:1}),a(c,{class:"top-card action-card",onClick:e[1]||(e[1]=v=>t.navigationMenu("NCDActivePatients"))},{default:o(()=>[a(i,null,{default:o(()=>[n("div",rs,[n("div",ls,g(t.dashboardStore.activeClientsCount),1),e[6]||(e[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]),_:1})]),_:1})]),n("div",ds,[a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(i,null,{default:o(()=>[e[7]||(e[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",cs,[t.isChartReady&&!t.dashboardStore.isLoading?(d(),V(p,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.dashboardStore.diagnosisChartData.series},null,8,["options","series"])):S("",!0),t.dashboardStore.isLoading?(d(),_("div",us,"Loading...")):S("",!0)],512)]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(i,null,{default:o(()=>[e[8]||(e[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",ps,[t.isChartReady&&!t.dashboardStore.isLoading?(d(),V(p,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.dashboardStore.genderChartData.series},null,8,["options","series"])):S("",!0),t.dashboardStore.isLoading?(d(),_("div",ms,"Loading...")):S("",!0)],512)]),_:1})]),_:1})])],64)}const gs=W(Xa,[["render",hs],["__scopeId","data-v-6de1dc4d"]]),fs=H({name:"Home",mixins:[Se,At],components:{IonContent:et,IonHeader:it,IonPage:$t,IonToolbar:ut,IonRow:Mt,DateInputField:Kt,IonIcon:J,IonButton:Nt,IonCol:Vt,IonCard:Lt,IonCardHeader:ye,IonCardTitle:be,IonCardContent:qt,ViewToggleComponent:zn,bottomNavBar:jn,HorizontalLine:kn},data(){const t=localStorage.getItem("ncdStartDate"),e=localStorage.getItem("ncdEndDate"),s=B(t||A.sessionDate()),r=B(e||A.sessionDate()),l=B(A.sessionDate()),f=B(A.sessionDate()),i=B([]),c=Wt({page:1,itemsPerPage:10}),p=B(0),v=Hn(),m=B("list");return{minDate:l,startDate:s,endDate:r,people:i,calendarOutline:gt,openOutline:De,maxDate:f,alertCircleOutline:de,personOutline:nn,idCardOutline:en,manOutline:tn,womanOutline:Ke,locationOutline:Ze,timeOutline:Xe,todayOutline:Ye,pagination:c,totalCount:p,actionButtonStore:v,currentToggleView:m}},computed:{...K(te,["NCDAppointmentsTogglePreference"]),paginatedPeople(){const t=(this.pagination.page-1)*this.pagination.itemsPerPage,e=t+this.pagination.itemsPerPage;return this.people.slice(t,e)},groupedPaginatedPeople(){const t={};this.paginatedPeople.forEach(r=>{const l=r.appointmentDate;t[l]||(t[l]=[]),t[l].push(r)});const e=Object.keys(t).sort((r,l)=>new Date(r)-new Date(l)),s={};return e.forEach(r=>{s[r]=t[r]}),s}},$route:{async handler(){},deep:!0},watch:{NCDAppointmentsTogglePreference:{handler(t){t&&t.toggle_view&&(this.currentToggleView=t.toggle_view)},deep:!0,immediate:!0}},async mounted(){this.initTogglePreference(),this.getAppointments(),this.HideHomePageActionButton()},async unmounted(){this.actionButtonStore.resetShowActionButton()},methods:{formatBirthdate(t){return A.getBirthdateAge(t)},async getAppointments(t=!1){if(Ie().apiStatus){this.people=[],this.pagination.page=1;try{t==!0&&(this.startDate=A.sessionDate(),this.endDate=A.sessionDate(),this.getAppointmentsD1(this.startDate),this.getAppointmentsD2(this.endDate)),this.startDate>this.endDate&&(this.endDate=this.startDate),console.log(this.startDate,this.endDate),(await Pe.getAppointments(this.startDate,this.endDate,"")).forEach(r=>{const l=A.toStandardHisDisplayFormat(r.appointment_date);if(!this.people.some(i=>i.person_id===r.person_id&&i.appointmentDate===l)){const i={person_id:r.person_id,npid:r.npid,appointment_id:103,encounter_id:r.encounter_id,name:r.given_name.concat(" ",r.family_name),gender:r.gender,ageDob:this.formatBirthdate(r.birthdate),village:r.city_village,appointmentDate:l};this.people.push(i)}}),this.totalCount=this.people.length}catch(s){}}},async getAppointmentsD1(t){this.startDate=A.toStandardHisFormat(t),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=A.toStandardHisFormat(t),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(t){const e=await ft.findByNpid(t);tt().setPatientRecord(e[0]),this.redirectUser()},handleViewChange(t){this.currentToggleView=t,this.initTogglePreference(t,!0)},initTogglePreference(t="list",e=!1){const s={toggle_view:t},r=te();Object.keys(this.NCDAppointmentsTogglePreference).length===0?(s.toggle_view="list",r.setNCDAppointmentsTogglePreference(s),this.currentToggleView="list"):e===!0?r.setNCDAppointmentsTogglePreference(s):this.currentToggleView=this.NCDAppointmentsTogglePreference.toggle_view||"list"},redirectUser(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(s=>e.some(r=>r.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")},handlePaginationUpdate({page:t,itemsPerPage:e}){if(e!==this.pagination.itemsPerPage){const s=(this.pagination.page-1)*this.pagination.itemsPerPage,r=Math.floor(s/e)+1,l=Math.ceil(this.totalCount/e);this.pagination.page=Math.min(r,l)||1,this.pagination.itemsPerPage=e}else this.pagination.page=t},HideHomePageActionButton(){this.actionButtonStore.setShowActionButton(!1)}}}),_s={class:"appointments-container"},vs={class:"date-filter"},bs={key:0,style:{margin:"20px"}},ys={key:1},Ds={class:"appointments-table"},Cs={key:2},$s={class:"date-group-header"},ws={class:"date-header-title"},ks={class:"date-header-count"},Ss={class:"cards-container"},Is={class:"card-details"},As={class:"detail-item"},Ps={class:"detail-value"},Ts={class:"detail-item"},Ns={class:"detail-value"},Os={class:"detail-item"},Rs={class:"detail-value"},Ls={class:"detail-item"},Vs={class:"detail-value"};function Ms(t,e,s,r,l,f){const i=u("DateInputField"),c=u("ion-col"),p=u("ion-icon"),v=u("ion-button"),m=u("ViewToggleComponent"),C=u("ion-row"),$=u("ion-card"),D=u("HorizontalLine"),y=u("ion-card-title"),b=u("ion-card-header"),N=u("ion-card-content"),I=u("ion-content"),P=u("bottomNavBar"),O=u("ion-footer");return d(),_("div",_s,[n("div",vs,[a(C,null,{default:o(()=>[a(c,null,{default:o(()=>[a(i,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(c,null,{default:o(()=>[a(i,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1}),a(c,null,{default:o(()=>[a(v,{color:"primary",onClick:e[0]||(e[0]=M=>t.getAppointments(!0)),class:"apt-btn"},{default:o(()=>[a(p,{icon:t.todayOutline,slot:"start"},null,8,["icon"]),e[1]||(e[1]=n("span",{style:{margin:"5px"}}," Today ",-1))]),_:1})]),_:1}),a(c,null,{default:o(()=>[a(m,{"initial-view":t.currentToggleView,onViewChanged:t.handleViewChange},null,8,["initial-view","onViewChanged"])]),_:1})]),_:1})]),a(I,{class:"scrollable-content"},{default:o(()=>[t.people.length===0?(d(),_("div",bs,[a(p,{icon:t.alertCircleOutline,size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),e[2]||(e[2]=n("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Appointments for selected date range",-1))])):t.currentToggleView==="list"&&t.people.length>0?(d(),_("div",ys,[a($,null,{default:o(()=>[n("table",Ds,[e[3]||(e[3]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),_(x,null,q(t.paginatedPeople,M=>(d(),_("tr",{key:M.npid},[n("td",null,[a(C,null,{default:o(()=>[a(c,null,{default:o(()=>[T(g(M.name),1)]),_:2},1024),a(c,null,{default:o(()=>[a(v,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:z=>t.openClientProfile(M.npid),color:"primary",fill:"clear",size:"small"},{default:o(()=>[a(p,{icon:t.openOutline,style:{"font-size":"28px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,g(M.npid),1),n("td",null,g(M.ageDob),1),n("td",null,g(M.gender),1),n("td",null,g(M.village),1),n("td",null,g(M.appointmentDate),1)]))),128))])])]),_:1})])):t.currentToggleView==="card"&&t.people.length>0?(d(),_("div",Cs,[(d(!0),_(x,null,q(t.groupedPaginatedPeople,(M,z)=>(d(),_("div",{key:z,class:"date-group"},[n("div",$s,[a(p,{icon:t.calendarOutline,class:"date-header-icon"},null,8,["icon"]),n("h2",ws,g(z),1),n("div",ks,g(M.length)+" appointment"+g(M.length!==1?"s":""),1)]),a(D,{color:"#006401",thickness:1,spacing:"sm"}),n("div",Ss,[(d(!0),_(x,null,q(M,X=>(d(),V($,{key:X.npid,class:"appointment-card"},{default:o(()=>[a(b,null,{default:o(()=>[a(C,{class:"ion-align-items-center"},{default:o(()=>[a(c,null,{default:o(()=>[a(y,{class:"card-name"},{default:o(()=>[a(p,{icon:t.personOutline,class:"name-icon"},null,8,["icon"]),T(" "+g(X.name),1)]),_:2},1024)]),_:2},1024),a(c,{size:"auto"},{default:o(()=>[a(v,{onClick:ht=>t.openClientProfile(X.npid),color:"primary",fill:"clear",size:"small",class:"view-profile-btn"},{default:o(()=>[a(p,{icon:t.openOutline},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(N,null,{default:o(()=>[n("div",Is,[n("div",As,[a(p,{icon:t.idCardOutline,class:"detail-icon"},null,8,["icon"]),e[4]||(e[4]=n("span",{class:"detail-label"},"NPID:",-1)),n("span",Ps,g(X.npid),1)]),n("div",Ts,[a(p,{icon:t.calendarOutline,class:"detail-icon"},null,8,["icon"]),e[5]||(e[5]=n("span",{class:"detail-label"},"Age/DOB:",-1)),n("span",Ns,g(X.ageDob),1)]),n("div",Os,[a(p,{icon:X.gender==="Male"?t.manOutline:t.womanOutline,class:"detail-icon"},null,8,["icon"]),e[6]||(e[6]=n("span",{class:"detail-label"},"Gender:",-1)),n("span",Rs,g(X.gender),1)]),n("div",Ls,[a(p,{icon:t.locationOutline,class:"detail-icon"},null,8,["icon"]),e[7]||(e[7]=n("span",{class:"detail-label"},"Village:",-1)),n("span",Vs,g(X.village),1)])])]),_:2},1024)]),_:2},1024))),128))])]))),128))])):S("",!0)]),_:1}),t.people.length>0?(d(),V(O,{key:0,class:"sticky-footer"},{default:o(()=>[a(C,null,{default:o(()=>[a(c,{size:"12",style:{"max-width":"100%"}},{default:o(()=>[a(P,{totalItems:t.totalCount,currentPage:t.pagination.page,itemsPerPage:t.pagination.itemsPerPage,"onUpdate:pagination":t.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])]),_:1})]),_:1})]),_:1})):S("",!0)])}const Bs=W(fs,[["render",Ms],["__scopeId","data-v-d02dae2c"]]),Es={key:0,class:"left_col"},Fs={class:"nav-menu"},xs=["onClick"],Hs={class:"ellipsis"},Us={key:1,style:{"padding-left":"20px","padding-right":"20px"}},Ws=H({__name:"NCDDashboard",setup(t){const e=Gt(),s=Q(()=>e.selectedItem),{screenWidth:r}=Sn(),l=B([{id:"dashboard",label:"Dashboard",icon:Ce},{id:"referrals",label:"Referrals",icon:Qt},{id:"appointments",label:"Appointments",icon:gt}]),f=B("dashboard"),i=St(),{substance:c}=zt(i);lt(()=>c.value,(v,m)=>{v!==m&&console.log("Substance changed:",v)},{deep:!0,immediate:!0});const p=v=>{f.value=v,Gt().setSelectedItem(f.value)};return lt(()=>s.value,v=>{console.log("Active item from mixin changed:",v),v&&v!=null&&p(v)},{immediate:!0}),(v,m)=>{const C=u("ion-segment-button"),$=u("ion-segment");return d(),_("div",{style:Ot(k(r)>940?"display: flex":"display: block")},[k(r)>940?(d(),_("div",Es,[n("nav",Fs,[n("ul",null,[(d(!0),_(x,null,q(l.value,D=>(d(),_("li",{key:D.id,class:st({active:f.value===D.id}),onClick:y=>p(D.id)},[a(k(J),{icon:D.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",Hs,g(D.label),1)],10,xs))),128))])])])):S("",!0),k(r)<=940?(d(),_("div",Us,[a($,{value:f.value,style:{"margin-top":"5px","justify-content":"left"}},{default:o(()=>[(d(!0),_(x,null,q(l.value,D=>(d(),V(C,{value:D.id,key:D.id,class:st({active:f.value===D.id}),onClick:y=>p(D.id)},{default:o(()=>[a(k(J),{icon:D.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,g(D.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):S("",!0),n("div",{class:"right_col",style:Ot(k(r)>940?"width: 85%":"width: 100%")},[n("div",null,[f.value==="referrals"?(d(),V(qa,{key:0})):S("",!0),f.value==="dashboard"?(d(),V(gs,{key:1})):S("",!0),f.value==="appointments"?(d(),V(Bs,{key:2})):S("",!0)])],4)],4)}}}),zs=W(Ws,[["__scopeId","data-v-a1132315"]]);class js extends G{constructor(){super()}static async getHTCDashboardSummary(e={}){return this.getJson("hts_stats",e)}}const Gs={class:"content-wrapper dashboard"},Js={class:"header"},qs={class:"overlay"},Qs={class:"big-number"},Ys={class:""},Xs={class:"cards"},Zs={class:"card"},Ks={class:"card-info"},to={class:"card-number"},eo={class:"card"},no={class:"card-info"},ao={class:"card-number"},so={class:"card"},oo={class:"card-info"},io={class:"card-number"},ro={class:"card"},lo={class:"card-info"},co={class:"card-number"},uo={class:"section-title"},po={class:"section"},mo={class:"filter-bar"},ho={class:"patient-list"},go=["onClick"],fo={class:"status-tags"},_o={class:st(["tag","yellow"])},vo={class:"pagination"},bo=["disabled"],yo={class:"pagination-info"},Do={class:"showing-info"},Co=["disabled"],Ht=5,$o=H({__name:"HTSDashboard",setup(t){const e=Dt(),s=Yt(),r=tt(),l=B({clients_with_conclusive_results:0,total_clients:0,clients_tested_today:0,clients_referred_to_ART:0,visit_scheduled_today:0,patient_data:[]}),f=B(""),i=B(1),c=Q(()=>D.value.length),p=Q(()=>Math.ceil(c.value/Ht)),v=Q(()=>(i.value-1)*Ht),m=Q(()=>Math.min(v.value+Ht,c.value)),C=Q(()=>D.value.slice(v.value,m.value)),$=P=>P.toLowerCase().trim().replace(/\s+/g," "),D=Q(()=>{if(!f.value.trim())return l.value.patient_data;const P=$(f.value);return l.value.patient_data.filter(O=>$(O.patient_name||"").includes(P)||$(O.patient_gender||"").includes(P)||$(O.program_names||"").includes(P)||String(O.patient_age).includes(P))});function y(){i.value<p.value&&i.value++}function b(){i.value>1&&i.value--}const N=async P=>{await r.setPatientRecord({patient_id:P.patient_id}),e.push("/patientProfile")};lt(f,()=>{i.value=1}),lt(s,async()=>{s.name=="Home"&&await I()}),ct(async()=>{await I()});async function I(){l.value=await js.getHTCDashboardSummary()}return(P,O)=>(d(),V(k(et),{class:"content"},{default:o(()=>{var M;return[n("div",Gs,[n("div",Js,[n("div",qs,[n("h1",Qs,g((M=l.value)==null?void 0:M.clients_with_conclusive_results),1),O[1]||(O[1]=n("p",{class:"header-text"},[T(" Total Number of Clients Tested"),n("br"),T(" with Conclusive Results ")],-1))])]),n("div",Ys,[O[8]||(O[8]=n("h2",{class:"section-title"},"Today's Stats",-1)),n("div",Xs,[n("div",Zs,[n("div",Ks,[a(k(J),{icon:k(Qt),class:"card-icon"},null,8,["icon"])]),O[2]||(O[2]=n("div",{class:"card-info"},[n("p",null,"Total Clients")],-1)),n("div",to,g(l.value.total_clients),1)]),n("div",eo,[n("div",no,[a(k(J),{icon:k(Jt),class:"card-icon"},null,8,["icon"])]),O[3]||(O[3]=n("div",{class:"card-info"},[n("p",null,"Clients Tested Today")],-1)),n("div",ao,g(l.value.clients_tested_today),1)]),n("div",so,[n("div",oo,[a(k(J),{icon:k(an),class:"card-icon"},null,8,["icon"])]),O[4]||(O[4]=n("div",{class:"card-info"},[n("p",null,"Clients Referred To ART")],-1)),n("div",io,g(l.value.clients_referred_to_ART),1)]),n("div",ro,[n("div",lo,[a(k(J),{icon:k(gt),class:"card-icon"},null,8,["icon"])]),O[5]||(O[5]=n("div",{class:"card-info"},[n("p",null,"Visit Scheduled Today")],-1)),n("div",co,g(l.value.visit_scheduled_today),1)])]),n("h2",uo,"Patient Awaiting List ("+g(c.value)+")",1),n("div",po,[n("div",mo,[sn(n("input",{class:"search-input",type:"text",placeholder:"Search Patient","onUpdate:modelValue":O[0]||(O[0]=z=>f.value=z)},null,512),[[on,f.value]])]),n("div",ho,[(d(!0),_(x,null,q(C.value,z=>(d(),_("div",{class:"patient-item",key:z.id,onClick:X=>N(z)},[n("div",null,[n("strong",null,g(z.patient_name),1),n("p",null,g(z.patient_gender=="M"?"Male":"Female")+" â€¢ "+g(z.patient_age)+"y",1)]),n("div",fo,[n("span",_o,g(z.program_names),1)])],8,go))),128))]),n("div",vo,[n("button",{onClick:b,disabled:i.value===1,class:"pagination-btn"},[a(k(J),{icon:k(_e)},null,8,["icon"]),O[6]||(O[6]=T(" Previous ",-1))],8,bo),n("div",yo,[T(" Page "+g(i.value)+" of "+g(p.value)+" ",1),n("span",Do,"(Showing "+g(v.value+1)+"-"+g(m.value)+" of "+g(c.value)+")",1)]),n("button",{onClick:y,disabled:i.value===p.value,class:"pagination-btn"},[O[7]||(O[7]=T(" Next ",-1)),a(k(J),{icon:k(rn)},null,8,["icon"])],8,Co)])])])])]}),_:1}))}}),wo=W($o,[["__scopeId","data-v-dde1df6c"]]),re={"HIV clinic registration":ot.HIV_CLINIC_REGISTRATION,"HIV reception":ot.HIV_RECEPTION,Vitals:ot.VITALS,"HIV staging":ot.HIV_STAGING,"HIV clinic consultation":ot.HIV_CLINIC_CONSULTATION,"ART adherence":ot.ART_ADHERENCE,Prescription:ot.TREATMENT,Dispensing:ot.DISPENSING,Appointments:ot.APPOINTMENT};class ko extends In{constructor(){super()}buildEncounters(e,s){return Object.entries(re).map(([r,l])=>({encounter:r,female:e?e[l].F:0,male:e?e[l].M:0,me:s?s[l].F+s[l].M:0,facility:e?e[l].F+e[l].M:0}))}async getStats(){const e=Object.values(re),s=An("reports/encounters",this.buildParams()),r=await G.postJson(s,{encounter_types:e}),l=await G.postJson(s,{encounter_types:e,all:!0});return this.buildEncounters(r.data,l.data)}getEncounterStats(e){return G.postJson("reports/encounters?date=".concat(this.date,"&program_id=1"),e)}}const So={class:"dashboard-container"},Io={class:"main-section"},Ao={class:"chart-section"},Po={class:"encounters-section"},To={class:"his-sm-text"},No={key:0},Oo={class:"encounter-td"},Ro={class:"other-td"},Lo={class:"other-td"},Vo={class:"other-td"},Mo={class:"other-td"},Bo={key:1},Eo=H({__name:"ARTDashboard",setup(t){const e=B([]),s=Wt({options:{chart:{id:"vuechart-example"},xaxis:{categories:["","","","",""]},yaxis:{min:0,forceNiceScale:!0,title:{text:"Number of clients",align:"left"}}},series:[{name:"Total visits",data:[0,0,0,0,0],color:"#7cb5ec"},{name:"Total incomplete visits",data:[0,0,0,0,0],color:"#434348"}]}),r=Wt([{"HIV clinic registration":9},{"HIV reception":51},{Vitals:6},{"HIV staging":52},{"HIV clinic consultation":53},{"ART adherence":68},{Treatment:25},{Dispensing:54},{Appointments:7}]),l=()=>{e.value=r.map(c=>({encounter:Object.keys(c)[0],female:"",male:"",me:"",facility:""}))},f=async()=>{const c=new Gn,p=G.getSessionDate();c.setStartDate(A.subtract(p,"days",5).format(ee)),c.setEndDate(A.subtract(p,"days",1).format(ee));const v=await c.getVisitStats(),m=[],C=[],$=[];Object.entries(v).forEach(([D,{incomplete:y,complete:b}])=>{$.push(ln(D).format("dddd")),m.push(y),C.push(y+b)}),s.series[0].data=[...C],s.series[1].data=[...m],s.options={...s.options,xaxis:{categories:[...$]}}},i=async()=>{try{const c=new ko,p=r.map(C=>Object.values(C)[0]),v=await c.getEncounterStats({encounter_types:p}),m=await c.getEncounterStats({encounter_types:p,all:!0});e.value=r.map(C=>{const[$,D]=Object.entries(C)[0];return{encounter:$,female:m[D].F,male:m[D].M,me:v[D].F+v[D].M,facility:m[D].F+m[D].M}})}catch(c){console.error(c)}};return ct(()=>{l(),f(),i()}),(c,p)=>(d(),_("div",So,[n("div",Io,[n("div",Ao,[p[0]||(p[0]=n("h3",null,"Total visits/incomplete visits: last 5 days",-1)),a(k(Zt),{width:"100%",height:"390px",type:"bar",options:s.options,series:s.series},null,8,["options","series"])]),n("div",Po,[p[3]||(p[3]=n("h3",null,"Encounters created today",-1)),n("table",To,[p[2]||(p[2]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),e.value.length?(d(),_("tbody",No,[(d(!0),_(x,null,q(e.value,(v,m)=>(d(),_("tr",{key:m},[n("td",Oo,g(v.encounter),1),n("td",Ro,g(v.female),1),n("td",Lo,g(v.male),1),n("td",Vo,g(v.me),1),n("td",Mo,g(v.facility),1)]))),128))])):(d(),_("tbody",Bo,[...p[1]||(p[1]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])]))])])])]))}}),Fo=W(Eo,[["__scopeId","data-v-9bb19378"]]);class Ut extends G{static getlogs(e,s){return this.getJson("notification/logs",{startDate:e,endDate:s})}static clear(e){return this.putJson("notifications/clear/".concat(e),{id:e})}static read(e){return this.putJson("notifications/update",{alerts:e})}static unread(){return this.getJson("notifications")}}const rt=B([]),xo=Dt();function Oe(){const t=Q(()=>rt.value.filter(m=>!m.read)),e=Q(()=>rt.value.length>0),s=Q(()=>t.value.length>0),r=Q(()=>t.value.length),l=Q(()=>rt.value.sort((m,C)=>new Date(m.date)>new Date(C.date)?-1:1));function f(m,C){Pn("Are you sure you want to clear notification?").then($=>{$&&Ut.clear(m).then(()=>{rt.value=rt.value.filter(D=>D.id!=m),C(m),c()}).catch(D=>{console.error(D),yt("Unable to clear notification")})})}function i(m){return A.toStandardHisDisplayFormat(m)}async function c(){rt.value=[];const m=await Ut.unread();if(!bt.isEmpty(m)){const C={highVL:[],normalVL:[],rejectedVL:[]};let $={};rt.value=m.map(D=>{let y="General";const b=D.text;let N=null;try{const I=JSON.parse(D.text);if(I.Type.match(/lims/i)){N=()=>xo.push("/art/encounters/lab/".concat(I.PatientID)),y="".concat(I["Test type"]," results for ").concat(I["ARV-Number"]||I["Accession number"]);const P=Tn.detectHighVl(I.Result[0].value,I.Result[0].value_modifier);$={handler:N,id:D.alert_id,arv:I["ARV-Number"],accession:I["Accession number"],order_date:i(I["Orde date"]),results:I.Result[0].value_modifier+" "+I.Result[0].value,results_date:i(I.Result[0].date)},P?C.highVL.push($):I.rejection_reason?($={handler:N,id:D.alert_id,arv:I.arv_number,accession:I.accession_number,order_date:i(I.order_date),rejection_reason:I.rejection_reason},C.rejectedVL.push($)):P||C.normalVL.push($)}}catch(I){console.warn(I)}return{handler:N,message:b,vlMessageObs:C,title:y,id:D.alert_id,date:i(D.date_created)}})}}async function p(m){Ut.read([m.id]).then(()=>m.read=!0)}function v(m){typeof m.handler=="function"&&(p(m),m.handler())}return{markAsRead:p,openNotification:v,loadNotifications:c,clearNotification:f,sortedNotifications:l,hasUnreadNotifications:s,notificationCount:r,hasNotifications:e,notificationData:rt}}const Ho={class:"vl-alerts-container"},Uo={class:"table-container"},Wo={class:"vl-table"},zo={key:0},jo={key:0},Go=["colspan"],Jo={key:0},qo=H({__name:"ARTVlAlert",setup(t){const e=B("high_vl"),{notificationData:s,loadNotifications:r,clearNotification:l,openNotification:f}=Oe(),i=Q(()=>{var y,b;return s.value.length?(((b=(y=s.value[0])==null?void 0:y.vlMessageObs)==null?void 0:b.highVL)||[]).length:0}),c=Q(()=>{var y,b;return s.value.length?(((b=(y=s.value[0])==null?void 0:y.vlMessageObs)==null?void 0:b.rejectedVL)||[]).length:0}),p=Q(()=>{var y,b;return s.value.length?(((b=(y=s.value[0])==null?void 0:y.vlMessageObs)==null?void 0:b.normalVL)||[]).length:0}),v=Q(()=>{var y;if(!s.value.length)return[];const D=(y=s.value[0])==null?void 0:y.vlMessageObs;if(!D)return[];switch(e.value){case"high_vl":return D.highVL||[];case"rejected":return D.rejectedVL||[];case"normal":return D.normalVL||[];default:return[]}}),m=D=>f(D),C=D=>{D.id&&l(D.id,y=>{console.log("Cleared notification ".concat(y))})},$=()=>{switch(e.value){case"high_vl":return"No high viral load results found";case"rejected":return"No rejected samples found";case"normal":return"No normal results found";default:return"No results found"}};return ct(()=>{r()}),(D,y)=>(d(),_("div",Ho,[a(k(Xt),{mode:"ios",modelValue:e.value,"onUpdate:modelValue":y[0]||(y[0]=b=>e.value=b),class:"category-segment"},{default:o(()=>[a(k(dt),{value:"high_vl"},{default:o(()=>[a(k(vt),null,{default:o(()=>[T("High VL ("+g(i.value)+")",1)]),_:1})]),_:1}),a(k(dt),{value:"rejected"},{default:o(()=>[a(k(vt),null,{default:o(()=>[T("Rejected ("+g(c.value)+")",1)]),_:1})]),_:1}),a(k(dt),{value:"normal"},{default:o(()=>[a(k(vt),null,{default:o(()=>[T("Normal Results ("+g(p.value)+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",Uo,[n("table",Wo,[n("thead",null,[n("tr",null,[y[1]||(y[1]=n("th",null,"ARV #",-1)),y[2]||(y[2]=n("th",null,"Accession #",-1)),y[3]||(y[3]=n("th",null,"Order Date",-1)),e.value==="rejected"?(d(),_("th",zo,"Rejection Reason")):S("",!0),y[4]||(y[4]=n("th",null,"View",-1)),y[5]||(y[5]=n("th",null,"Clear",-1))])]),n("tbody",null,[v.value.length===0?(d(),_("tr",jo,[n("td",{colspan:e.value==="rejected"?6:5,class:"empty-message"},g($()),9,Go)])):S("",!0),(d(!0),_(x,null,q(v.value,b=>(d(),_("tr",{key:b.id},[n("td",null,g(b.arv||"-"),1),n("td",null,g(b.accession||"-"),1),n("td",null,g(b.order_date||"-"),1),e.value==="rejected"?(d(),_("td",Jo,g(b.rejection_reason||"-"),1)):S("",!0),n("td",null,[a(k(Nt),{fill:"clear",size:"small",onClick:N=>m(b)},{default:o(()=>[a(k(J),{icon:k($e),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])]),n("td",null,[a(k(Nt),{fill:"clear",size:"small",onClick:N=>C(b),color:"success"},{default:o(()=>[a(k(J),{icon:k(dn),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])])]))),128))])])])]))}}),Qo=W(qo,[["__scopeId","data-v-7b9c4735"]]),Yo={class:"dashboard-container"},Xo={class:"segment-content"},Zo={key:0},Ko={key:1},ti={key:2},ei=H({__name:"ARTHome",setup(t){const e=B("dashboard"),{notificationCount:s,loadNotifications:r}=Oe();return ct(()=>{r()}),(l,f)=>(d(),_("div",Yo,[a(k(Xt),{modelValue:e.value,"onUpdate:modelValue":f[0]||(f[0]=i=>e.value=i)},{default:o(()=>[a(k(dt),{value:"dashboard"},{default:o(()=>[...f[1]||(f[1]=[T(" Overview ",-1)])]),_:1}),a(k(dt),{value:"viralLoadAlerts"},{default:o(()=>[n("div",Xo,[f[2]||(f[2]=T(" VL Alerts ",-1)),k(s)>0?(d(),V(k(cn),{key:0,color:"primary"},{default:o(()=>[T(g(k(s)),1)]),_:1})):S("",!0)])]),_:1}),a(k(dt),{value:"internalReferrals"},{default:o(()=>[...f[3]||(f[3]=[T(" Internal referrals ",-1)])]),_:1})]),_:1},8,["modelValue"]),e.value==="dashboard"?(d(),_("div",Zo,[a(Fo)])):S("",!0),e.value==="viralLoadAlerts"?(d(),_("div",Ko,[a(Qo)])):S("",!0),e.value==="internalReferrals"?(d(),_("div",ti,[a(Ne)])):S("",!0)]))}}),ni=W(ei,[["__scopeId","data-v-d237cab2"]]);class ai{constructor(){at(this,"socket",null);at(this,"channel","ImmunizationReportChannel");at(this,"isConnected",!1);at(this,"pendingFetch",null);at(this,"location_id");at(this,"initPromise");at(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});at(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});at(this,"onError",e=>{console.error("WebSocket error:",e),this.isConnected=!1});this.initPromise=this.init()}async init(){const e=localStorage.getItem("apiURL"),s=localStorage.getItem("apiPort"),r=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const l="".concat(r,"://").concat(e,"/api/v1/cable");this.socket=new WebSocket(l),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(l){console.error(l),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const e={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(e))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await G.getJson("immunization/stats",{start_date:A.getDateBeforeByDays(A.sessionDate(),365),end_date:A.sessionDate()})}async setMessageHandler(e){await this.initPromise,this.socket?this.socket.onmessage=s=>{e(s)}:console.error("WebSocket connection not established.")}}const si=H({components:{IonContent:et,IonHeader:it,IonItem:mt,IonList:pt,IonMenu:kt,IonTitle:wt,IonToolbar:ut,IonInput:le,BasicInputField:On,BasicForm:It,PreviousVitals:Nn,customDatePicker:qn,IonCol:Vt,IonRow:Mt,VueMultiselect:un,IonLabel:vt,DataTable:Ct},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:Ft,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:A.toStandardHisDisplayFormat(G.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...K(Jn,["administerOtherVaccine"]),...K(ne,["tempScannedBatchNumber"]),...K(tt,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await Yn(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:ge,pulseOutline:pn,clipboardOutline:Jt}},methods:{formatBirthdate(t){return A.getBirthdateAge(t)},async openClientProfile(t){const e=await ft.findByID(t);await tt().setPatientRecord(e),this.$router.push("patientProfile")},processData(){var e;return((e=this.data)==null?void 0:e.map(s=>{if(s.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let r=[];const l=f=>f.map(c=>{let p=0;return c.clients.map(v=>{(c.drug_name==this.drug_name&&(this.village==v.table.city_village||this.village=="All")||(c.drug_name==this.drug_name||this.village==v.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:v.table.given_name,family_name:v.table.family_name,patient_id:v.table.patient_id,birthdate:v.table.birthdate,city_village:v.table.city_village}),p++),this.villageList.push(v.table.city_village)}),[c.drug_name,p]}).filter(c=>c[1]!==0);return this.title=="Client due today"&&(r=l(s.value.due_today_antigens)),this.title=="Client due this week"&&(r=l(s.value.due_this_week_antigens)),this.title=="Client due this month"&&(r=l(s.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(r=l(s.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(r=l(s.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(f=>JSON.stringify(f)))].map(f=>JSON.parse(f)),this.villageList=[...new Set(this.villageList)],r}}))[0]},handleVillageClick(t){this.drug_name="",this.village=t,this.tableData=this.processData()},handleRowClick(t){var s;this.tableEvent=t.target;const e=this.tableEvent.closest("tr");if(e){const r=Array.from(((s=e.parentNode)==null?void 0:s.children)||[]).indexOf(e),l=this.tableData[r];this.drug_name=l[0],e.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(t){return A.calculateDisplayAge(t)},openPopover(t){this.event=t,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(t){var s;const e=t.target.value;this.batchNumber=e||((s=this.tempScannedBatchNumber)==null?void 0:s.text)||""},saveBatchWithTodayDate(){let t=G.getSessionDate();this.saveDta(t)},dismiss(){Bt.dismiss()},saveBatch(){let t;bt.isEmpty(this.vaccineDate)==!0?t=G.getSessionDate():t=this.vaccineDate,this.saveDta(t)},validateVaccineName(){if(bt.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(bt.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(t){this.currentDrugOb=t},isAlphaNumeric(t){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(t)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(t){this.batchNumber=t},saveDta(t){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){yt("Enter batch number!");return}if(this.batchNumber==""){yt("Enter batch number!");return}const e={batch_number:this.batchNumber,date_administered:t,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},s=ne();s.setAdministeredVaccine(e),Qn(this.patient),this.dismiss(),s.setTempScannedBatchNumber(null)}}}),oi={key:0,class:"spinner-overlay"},ii={class:"header position_content"},ri={style:{"font-size":"1.2em","font-weight":"700"}},li={class:"dueCardContent"},di=["onClick"],ci={style:{"margin-right":"15px"}},ui={style:{"align-items":"center",display:"flex"}},pi={style:{"line-height":"1"}},mi={class:"client_name"},hi={class:"name"},gi={class:"demographicsOtherRow"},fi={class:"demographicsText"};function _i(t,e,s,r,l,f){const i=u("ion-spinner"),c=u("ion-icon"),p=u("ion-header"),v=u("ion-card-title"),m=u("ion-card-header"),C=u("DataTable"),$=u("ion-card-content"),D=u("ion-card"),y=u("ion-item"),b=u("ion-list"),N=u("ion-popover"),I=u("ion-content");return d(),_(x,null,[t.isLoading?(d(),_("div",oi,[a(i,{name:"bubbles"}),e[3]||(e[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):S("",!0),a(p,null,{default:o(()=>[n("div",ii,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=P=>t.dismiss())},[a(c,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",ri,g(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=P=>t.openPopover(P))},[a(c,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(I,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:o(()=>[n("div",null,[a(D,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:o(()=>[a(m,null,{default:o(()=>[a(v,{class:"sectionTitle"},{default:o(()=>[...e[4]||(e[4]=[T(" Summary of required doses ",-1)])]),_:1})]),_:1}),a($,null,{default:o(()=>[n("div",li,[a(C,{options:t.options,data:t.tableData,class:"display nowrap",width:"100%",onClick:t.handleRowClick},{default:o(()=>[...e[5]||(e[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])]),_:1},8,["options","data","onClick"])])]),_:1})]),_:1}),a(D,{class:"section",style:{"margin-inline":"0px"}},{default:o(()=>[a(m,null,{default:o(()=>[a(v,{class:"sectionTitle"},{default:o(()=>[...e[6]||(e[6]=[T("Client Details ",-1)])]),_:1})]),_:1}),a($,null,{default:o(()=>[(d(!0),_(x,null,q(t.clientDetails,(P,O)=>(d(),_("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:O,onClick:M=>t.openClientProfile(P.patient_id)},[n("div",ci,[n("div",{class:st((P==null?void 0:P.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(c,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),n("div",ui,[n("div",pi,[n("div",mi,[n("div",hi,g(P.given_name)+" "+g(P.family_name),1)]),n("div",gi,[n("div",fi,[T(g(P.gender=="M"?"Male":"Female")+" ",1),e[7]||(e[7]=n("span",{class:"dot"},".",-1)),T(g(t.formatBirthdate(P.birthdate)),1)])]),n("div",null,"Village: "+g(P.city_village),1)])])],8,di))),128))]),_:1})]),_:1})]),a(N,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:t.event,onDidDismiss:e[2]||(e[2]=P=>t.popoverOpen=!1)},{default:o(()=>[n("div",null,[e[8]||(e[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(d(!0),_(x,null,q(t.villageList,(P,O)=>(d(),V(b,{class:st(P==t.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:O},{default:o(()=>[a(y,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:M=>t.handleVillageClick(P)},{default:o(()=>[T(g(P),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const vi=W(si,[["render",_i],["__scopeId","data-v-dfc02771"]]),bi=H({name:"Menu",mixins:[At],components:{IonContent:et,IonHeader:it,IonItem:mt,IonList:pt,IonMenu:kt,IonTitle:wt,IonToolbar:ut,IonCheckbox:Et,BasicForm:It,BasicCard:xt,Carousel:fn,Slide:gn,Pagination:hn,Navigation:mn},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},setup(){return{personCircleOutline:ce}},computed:{...K(St,["substance"]),backgroundStyle(){return{background:"linear-gradient(135deg, rgba(32, 178, 170, 0.95) 0%, rgba(64, 192, 176, 0.9) 50%, rgba(150, 220, 200, 0.85) 100%), url(".concat(Xn("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",minHeight:"240px"}}},watch:{},async mounted(){new ai().setMessageHandler(this.onMessage)},methods:{async onMessage(t){var s,r,l;const e=JSON.parse(t.data);e.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=e.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((s=this.reportData)==null?void 0:s.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((r=this.reportData)==null?void 0:r.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((l=this.reportData)==null?void 0:l.total_male_vaccinated_this_year)||0}])},openDueModal(t){const e={title:t,dashBoardData:this.reportData};Tt(vi,{class:"fullScreenModal"},!0,e)},async openClientProfile(t){const e=await ft.findByNpid(t);await tt().setPatientRecord(e[0]),this.$router.push("patientProfile")}}}),yi={class:"topStats"},Di={class:"hero-section"},Ci={class:"totalStats"},$i={class:"statsValue"},wi={class:"statsText"},ki={class:"dueCardContent"},Si={class:"statsValue"},Ii={class:"statsValue"},Ai={class:"statsValue"},Pi={class:"overDueCardContent"},Ti={class:"statsValue"},Ni={class:"statsValue"},Oi={class:"appointment-count"},Ri={key:0,class:"appointments-list"},Li=["onClick"],Vi={class:"avatar-container"},Mi={class:"appointment-details"},Bi={class:"client-name"},Ei={class:"client-info"},Fi={class:"info-badge"},xi={class:"client-location"},Hi={key:1,class:"empty-state"};function Ui(t,e,s,r,l,f){const i=u("Slide"),c=u("Pagination"),p=u("Carousel"),v=u("ion-card-title"),m=u("ion-card-header"),C=u("ion-card-content"),$=u("ion-card"),D=u("ion-icon"),y=u("ion-content");return d(),V(y,{class:"content"},{default:o(()=>[n("div",yi,[n("div",Di,[n("div",{style:Ot(t.backgroundStyle)},[a(p,{autoplay:4e3,"wrap-around":!0,itemsToShow:1,transition:600,class:"stats-carousel"},{addons:o(()=>[a(c)]),default:o(()=>[(d(!0),_(x,null,q(t.totalStats,b=>(d(),V(i,{key:b},{default:o(()=>[n("div",Ci,[e[5]||(e[5]=n("div",{class:"stats-icon"},"ðŸ“Š",-1)),n("div",$i,g(b.value),1),n("div",wi,g(b.name),1)])]),_:2},1024))),128))]),_:1})],4)]),a($,{class:"section modern-card"},{default:o(()=>[a(m,null,{default:o(()=>[a(v,{class:"cardTitle"},{default:o(()=>[...e[6]||(e[6]=[n("span",{class:"title-icon"},"ðŸ“…",-1),T(" Clients Due ",-1)])]),_:1})]),_:1}),a(C,null,{default:o(()=>{var b,N,I;return[n("div",ki,[n("div",{class:"dueCard today-card",onClick:e[0]||(e[0]=P=>t.openDueModal("Client due today"))},[e[7]||(e[7]=n("div",{class:"card-badge success"},"Today",-1)),n("div",Si,g(((b=t.reportData)==null?void 0:b.due_today_count)||0),1),e[8]||(e[8]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard week-card",onClick:e[1]||(e[1]=P=>t.openDueModal("Client due this week"))},[e[9]||(e[9]=n("div",{class:"card-badge warning"},"Week",-1)),n("div",Ii,g(((N=t.reportData)==null?void 0:N.due_this_week_count)||0),1),e[10]||(e[10]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard month-card",onClick:e[2]||(e[2]=P=>t.openDueModal("Client due this month"))},[e[11]||(e[11]=n("div",{class:"card-badge danger"},"Month",-1)),n("div",Ai,g(((I=t.reportData)==null?void 0:I.due_this_month_count)||0),1),e[12]||(e[12]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),a($,{class:"section modern-card"},{default:o(()=>[a(m,null,{default:o(()=>[a(v,{class:"cardTitle"},{default:o(()=>[...e[13]||(e[13]=[n("span",{class:"title-icon"},"âš ï¸",-1),T(" Clients Overdue ",-1)])]),_:1})]),_:1}),a(C,null,{default:o(()=>{var b,N;return[n("div",Pi,[n("div",{class:"overDueCard",onClick:e[3]||(e[3]=I=>t.openDueModal("Client overdue under 5yrs"))},[e[14]||(e[14]=n("div",{class:"overdue-icon"},"ðŸ‘¶",-1)),n("div",Ti,g(((b=t.reportData)==null?void 0:b.under_five_overdue)||0),1),e[15]||(e[15]=n("div",{class:"statsText"},"Under 5 years",-1))]),n("div",{class:"overDueCard",onClick:e[4]||(e[4]=I=>t.openDueModal("Client overdue over 5yrs"))},[e[16]||(e[16]=n("div",{class:"overdue-icon"},"ðŸ§’",-1)),n("div",Ni,g(((N=t.reportData)==null?void 0:N.over_five_overdue)||0),1),e[17]||(e[17]=n("div",{class:"statsText"},"Over 5 years",-1))])])]}),_:1})]),_:1}),a($,{class:"section modern-card appointments-card"},{default:o(()=>[a(m,null,{default:o(()=>[a(v,{class:"cardTitle"},{default:o(()=>{var b;return[e[18]||(e[18]=n("span",{class:"title-icon"},"ðŸ—“ï¸",-1)),e[19]||(e[19]=T(" Today's Appointments ",-1)),n("span",Oi,g(((b=t.appointments)==null?void 0:b.length)||0),1)]}),_:1})]),_:1}),a(C,null,{default:o(()=>{var b;return[((b=t.appointments)==null?void 0:b.length)>0?(d(),_("div",Ri,[(d(!0),_(x,null,q(t.appointments,(N,I)=>(d(),_("div",{class:"appointment-item",key:I,onClick:P=>t.openClientProfile(N.npid)},[n("div",Vi,[n("div",{class:st(N.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(D,{class:"person-icon",icon:t.personCircleOutline},null,8,["icon"])],2)]),n("div",Mi,[n("div",Bi,g(N.given_name)+" "+g(N.family_name),1),n("div",Ei,[n("span",Fi,g(N.gender=="M"?"Male":"Female"),1),e[20]||(e[20]=n("span",{class:"dot"},"â€¢",-1)),n("span",null,g(t.formatBirthdate(N.birthdate)),1)]),n("div",xi,[e[21]||(e[21]=n("span",{class:"location-icon"},"ðŸ“",-1)),T(" "+g(N==null?void 0:N.city_village),1)])]),e[22]||(e[22]=n("div",{class:"appointment-arrow"},"â€º",-1))],8,Li))),128))])):(d(),_("div",Hi,[...e[23]||(e[23]=[n("div",{class:"empty-icon"},"ðŸ“‹",-1),n("p",null,"No appointments scheduled for today",-1)])]))]}),_:1})]),_:1})])]),_:1})}const Wi=W(bi,[["render",Ui],["__scopeId","data-v-c322c517"]]),zi=H({components:{DataTable:Ct},props:{title:{type:String,default:""},list:{type:String,default:""},buttonTitle:{type:String,default:""},buttonLink:{type:String,default:""}},data(){return{patients:[],loadingStates:{},tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:(t,e)=>{if(!t)return"-";const s=new Date(t).getTime(),r=Date.now()-s,l=Math.floor(r/6e4),f=(()=>{if(l<1)return"Just now";if(l<60)return"".concat(l," min").concat(l>1?"s":""," ago");const i=Math.floor(l/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const c=Math.floor(i/24);return"".concat(c," day").concat(c>1?"s":""," ago")})();return e==="display"?f:r},type:"num",width:"15%"},{title:"Actions",data:null,render:(t,e,s)=>{const r=document.createElement("div");r.style.display="flex",r.style.gap="6px",r.setAttribute("data-patient-id",s.identifier);const l="  --padding-top: 4px;\n                                            --padding-bottom: 4px;\n                                            --padding-start: 8px;\n                                            --padding-end: 8px;\n                                            font-size: 0.8rem;\n                                            height: 28px;\n                                            min-width: 70px;\n                                            white-space: nowrap;\n                                            ",f=(i,c,p,v)=>{const m=document.createElement("ion-button");m.setAttribute("data-button-type",v),m.size="small",m.fill="solid",m.color=c,m.style.cssText=l;const C=document.createElement("span");C.className="button-text",C.innerText=i;const $=document.createElement("ion-spinner");return $.name="crescent",$.className="button-spinner",$.style.display="none",$.style.width="16px",$.style.height="16px",m.appendChild(C),m.appendChild($),m.addEventListener("click",p),m};return r.appendChild(f(this.buttonTitle,"primary",()=>this.navigateTo(s,this.buttonLink),"primary")),r.appendChild(f("Profile","warning",()=>this.navigateTo(s,"/patientProfile"),"profile")),r.appendChild(f("Abscond","danger",()=>this.handleAbscond(s.identifier),"abscond")),r},orderable:!1,width:"25%"}],tableOptions:{order:[[1,"desc"]]}}},computed:{...K(jt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{patientsWaitingForConsultation:{handler(t){this.list==="CONSULTATION"&&(this.patients=t)},deep:!0},patientsWaitingForVitals:{handler(t){this.list==="VITALS"&&(this.patients=t)},deep:!0},patientsWaitingForLab:{handler(t){this.list==="LAB"&&(this.patients=t)},deep:!0},patientsWaitingForDispensation:{handler(t){this.list==="DISPENSATION"&&(this.patients=t)},deep:!0}},mounted(){this.setList()},methods:{setList(){const t={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation},e=this.list;this.patients=t[e]||[]},setButtonLoading(t,e,s){const r=document.querySelector('[data-patient-id="'.concat(t,'"]'));if(!r)return;const l=r.querySelector('[data-button-type="'.concat(e,'"]'));if(!l)return;const f=l.querySelector(".button-text"),i=l.querySelector(".button-spinner");s?(l.setAttribute("disabled","true"),f&&(f.style.display="none"),i&&(i.style.display="inline-block")):(l.removeAttribute("disabled"),f&&(f.style.display="inline"),i&&(i.style.display="none"))},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),s=Math.floor(e/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const r=Math.floor(s/60);if(r<24)return"".concat(r," hour").concat(r>1?"s":""," ago");const l=Math.floor(r/24);return"".concat(l," day").concat(l>1?"s":""," ago")},async navigateTo(t,e){const s=e===this.buttonLink?"primary":"profile";this.setButtonLoading(t.identifier,s,!0);try{let r=[],l=null;G.getPouchDbStatus()||G.getLanConnectionStatus()?(r=await Rt("patients_records",{selector:{ID:t.identifier}}),l=r[0]):l||(l=await G.getJson("/patients/".concat(t.patient_id,"/get_patient_record"))),console.log("ðŸš€ ~ patientRecord:",l);const f=l;await tt().setPatientRecord(f),this.$router.push(e)}catch(r){console.error("Error navigating:",r),this.setButtonLoading(t.identifier,s,!1)}},async handleAbscond(t){this.setButtonLoading(t,"abscond",!0);try{await Rn({ID:t})}catch(e){console.error("Error closing visit:",e)}finally{this.setButtonLoading(t,"abscond",!1)}},dismiss(){Bt.dismiss()}}}),ji={class:"modal-container"},Gi={class:"dueCardContent"};function Ji(t,e,s,r,l,f){const i=u("ion-button"),c=u("ion-card-title"),p=u("ion-card-header"),v=u("DataTable"),m=u("ion-card-content"),C=u("ion-card");return d(),_("div",ji,[a(i,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:o(()=>[...e[0]||(e[0]=[T(" Close ",-1)])]),_:1},8,["onClick"]),a(C,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:o(()=>[a(p,null,{default:o(()=>[a(c,{class:"sectionTitle"},{default:o(()=>[T(g(t.title),1)]),_:1})]),_:1}),a(m,null,{default:o(()=>[n("div",Gi,[a(v,{data:t.patients,options:t.tableOptions,columns:t.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const qi=W(zi,[["render",Ji],["__scopeId","data-v-c16e66ea"]]),Qi=H({components:{IonContent:et,IonHeader:it,IonItem:mt,IonList:pt,IonIcon:J,IonCard:Lt,IonCardHeader:ye,IonCardTitle:be,IonCardContent:qt,IonPopover:we,DataTable:Ct},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:Ft,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:t=>this.waitingTime(t),width:"20%"},{title:"Actions",data:null,render:(t,e,s)=>{const r=document.createElement("div");r.style.display="flex",r.style.gap="6px",r.setAttribute("data-patient-id",s.identifier);const l="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",f=(i,c,p,v)=>{const m=document.createElement("ion-button");m.setAttribute("data-button-type",v),m.size="small",m.fill="solid",m.color=c,m.style.cssText=l;const C=document.createElement("span");C.className="button-text",C.innerText=i;const $=document.createElement("ion-spinner");return $.name="crescent",$.className="button-spinner",$.style.display="none",$.style.width="16px",$.style.height="16px",m.appendChild(C),m.appendChild($),m.addEventListener("click",p),m};return r.appendChild(f("Profile","warning",()=>this.navigateTo(t,"/patientProfile"),"profile")),r},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const t=await Ln();this.patients=t.map(e=>({fullName:e.fullName||"",arrivalTime:e.startDate||"",patient_id:e.patientId||"",identifier:e.identifier||""}))},methods:{setButtonLoading(t,e,s){const r=document.querySelector('[data-patient-id="'.concat(t,'"]'));if(!r)return;const l=r.querySelector('[data-button-type="'.concat(e,'"]'));if(!l)return;const f=l.querySelector(".button-text"),i=l.querySelector(".button-spinner");s?(l.setAttribute("disabled","true"),f&&(f.style.display="none"),i&&(i.style.display="inline-block")):(l.removeAttribute("disabled"),f&&(f.style.display="inline"),i&&(i.style.display="none"))},openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Bt.dismiss()},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),s=Math.floor(e/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const r=Math.floor(s/60);if(r<24)return"".concat(r," hour").concat(r>1?"s":""," ago");const l=Math.floor(r/24);return"".concat(l," day").concat(l>1?"s":""," ago")},async navigateTo(t,e){this.setButtonLoading(t.identifier,"profile",!0);try{let s;(G.getPouchDbStatus()||G.getLanConnectionStatus())&&(s=await Rt("patients_records",{selector:{ID:t.identifier}}),s=s[0]),s||(s=await ft.findByID(t.patient_id)),s?(await tt().setPatientRecord(s),this.$router.push(e)):(yt("Patient not found. Please try searching the patient by name."),this.setButtonLoading(t.identifier,"profile",!1))}catch(s){console.error("Error navigating to profile:",s),this.setButtonLoading(t.identifier,"profile",!1)}}}}),Yi={class:"modal-container"},Xi={class:"dueCardContent"};function Zi(t,e,s,r,l,f){const i=u("ion-button"),c=u("ion-card-title"),p=u("ion-card-header"),v=u("DataTable"),m=u("ion-card-content"),C=u("ion-card");return d(),_("div",Yi,[a(i,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:o(()=>[...e[0]||(e[0]=[T(" Close ",-1)])]),_:1},8,["onClick"]),a(C,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:o(()=>[a(p,null,{default:o(()=>[a(c,{class:"sectionTitle"},{default:o(()=>[T(g(t.title),1)]),_:1})]),_:1}),a(m,null,{default:o(()=>[n("div",Xi,[a(v,{data:t.patients,options:t.tableOptions,columns:t.tableColumns,class:"display nowrap modern-table",width:"100%"},null,8,["data","options","columns"])])]),_:1})]),_:1})])}const Ki=W(Qi,[["render",Zi],["__scopeId","data-v-cc4bdd19"]]),tr=H({name:"OPDAppointmentsModal",components:{IonPage:$t,IonHeader:it,IonContent:et,IonItem:mt,IonList:pt,IonIcon:J,IonCard:Lt,IonCardContent:qt,IonPopover:we,DataTable:Ct,IonSegment:Xt,IonSegmentButton:dt,IonLabel:vt,IonRow:Mt,IonCol:Vt,DateInputField:Kt},props:{title:{type:String,default:"OPD Appointments"},programType:{type:String,required:!0},programId:{type:Number,required:!0}},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:Ft,appointments:[],viewMode:"today",startDate:A.sessionDate(),endDate:A.sessionDate(),calendarOutline:gt,openOutline:De,tableColumns:[{title:"Patient ID",data:"ID"},{title:"Name",data:"name"},{title:"Age/DOB",data:"ageDob"},{title:"Gender",data:"gender"},{title:"Village",data:"village"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(t,e,s)=>{const r=document.createElement("div"),l=document.createElement("ion-button");return l.innerText="Profile",l.size="small",l.style.color="#fff",l.style.padding="8px 12px",l.style.marginRight="8px",l.addEventListener("click",()=>this.openClientProfile(s.ID)),r.appendChild(l),r},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,order:[[5,"asc"]]}}},async mounted(){await this.loadAppointments()},methods:{async loadAppointments(){this.isLoading=!0;try{const t=A.sessionDate(),e=this.viewMode==="today"?t:this.startDate,s=this.viewMode==="today"?t:this.endDate,r=localStorage.getItem("locationID"),l=typeof e=="string"?e:A.toStandardHisFormat(e),f=typeof s=="string"?s:A.toStandardHisFormat(s),c=(await Rt("patients_records")).flatMap(p=>{var m,C;return[...((m=p.appointments)==null?void 0:m.saved)||[],...((C=p.appointments)==null?void 0:C.unsaved)||[]].filter($=>{if(!($!=null&&$.value_datetime)||$.location_id&&$.location_id!==r)return!1;const D=A.toStandardHisFormat($.value_datetime);return D>=l&&D<=f}).map($=>{var D,y,b,N,I;return{ID:p.ID,name:[(D=p.personInformation)==null?void 0:D.given_name,(y=p.personInformation)==null?void 0:y.family_name].filter(Boolean).join(" ")||"Unknown",ageDob:(b=p.personInformation)!=null&&b.birthdate?A.getBirthdateAge(p.personInformation.birthdate):"N/A",gender:((N=p.personInformation)==null?void 0:N.gender)||"Unknown",village:((I=p.personInformation)==null?void 0:I.home_village)||"Unknown",appointmentDate:A.toStandardHisDisplayFormat($.value_datetime),appointmentDateTime:$.value_datetime,rawData:$}})}).sort((p,v)=>new Date(p.appointmentDateTime).getTime()-new Date(v.appointmentDateTime).getTime());this.appointments=c,console.log("Found ".concat(c.length," appointments"))}catch(t){console.error("Error loading appointments:",t),ae("Failed to load appointments")}finally{this.isLoading=!1}},async getAppointmentsD1(t){this.startDate=A.toStandardHisFormat(t),await this.loadAppointments()},async getAppointmentsD2(t){this.endDate=A.toStandardHisFormat(t),await this.loadAppointments()},onViewModeChange(){this.viewMode==="today"&&(this.startDate=A.sessionDate(),this.endDate=A.sessionDate()),this.loadAppointments()},async openClientProfile(t){try{const e=await Rt("patients_records",{selector:{ID:t}});await tt().setPatientRecord(e[0]),this.$router.push("patientProfile")}catch(e){console.error("Error opening profile:",e),ae("Failed to open patient profile")}},openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Bt.dismiss()}}}),er={class:"header position_content"},nr={style:{"font-size":"1.2em","font-weight":"700"}},ar={key:0,class:"date-filter"},sr={class:"dueCardContent"},or={key:1,class:"no-appointments"};function ir(t,e,s,r,l,f){const i=u("ion-icon"),c=u("ion-header"),p=u("ion-label"),v=u("ion-segment-button"),m=u("ion-segment"),C=u("DateInputField"),$=u("ion-col"),D=u("ion-row"),y=u("DataTable"),b=u("ion-card-content"),N=u("ion-card"),I=u("ion-content"),P=u("ion-page");return d(),V(P,null,{default:o(()=>[a(c,null,{default:o(()=>[n("div",er,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=(...O)=>t.dismiss&&t.dismiss(...O))},[a(i,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",nr,g(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=O=>t.openPopover(O))},[a(i,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(I,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:o(()=>[a(m,{modelValue:t.viewMode,"onUpdate:modelValue":e[2]||(e[2]=O=>t.viewMode=O),onIonChange:t.onViewModeChange},{default:o(()=>[a(v,{value:"today"},{default:o(()=>[a(p,null,{default:o(()=>[...e[3]||(e[3]=[T("Today's Appointments",-1)])]),_:1})]),_:1}),a(v,{value:"range"},{default:o(()=>[a(p,null,{default:o(()=>[...e[4]||(e[4]=[T("Date Range",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","onIonChange"]),t.viewMode==="range"?(d(),_("div",ar,[a(D,null,{default:o(()=>[a($,null,{default:o(()=>[a(C,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:t.endDate,disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","maxDate","onUpdate:rawDateValue"])]),_:1}),a($,null,{default:o(()=>[a(C,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):S("",!0),a(N,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:o(()=>[a(b,null,{default:o(()=>[n("div",sr,[t.appointments.length>0?(d(),V(y,{key:0,data:t.appointments,columns:t.tableColumns,options:t.tableOptions,class:"display nowrap modern-table",width:"100%"},null,8,["data","columns","options"])):(d(),_("div",or," No appointments found for the selected "+g(t.viewMode==="today"?"day":"date range"),1))])]),_:1})]),_:1})]),_:1})]),_:1})}const rr=W(tr,[["render",ir],["__scopeId","data-v-e54f2168"]]),lr={class:"card-count"},dr={class:"card-label"},cr="#ffffff",ur=H({__name:"DashboardCard",props:{icon:{},count:{},label:{},color:{}},emits:["cardClick"],setup(t,{emit:e}){const l={success:"#A5D6A7",info:"#81D4FA",warning:"#FFF59D",danger:"#EF9A9A"}[t.color||"info"]||"#E0E0E0";return(f,i)=>(d(),V(k(Lt),{class:"dashboard-card",style:Ot({borderColor:k(l),backgroundColor:cr}),onClick:i[0]||(i[0]=c=>f.$emit("cardClick"))},{default:o(()=>[a(k(J),{icon:t.icon,class:"card-icon"},null,8,["icon"]),n("div",lr,g(t.count),1),n("div",dr,g(t.label),1)]),_:1},8,["style"]))}}),pr=W(ur,[["__scopeId","data-v-84ad3c1b"]]),mr=H({name:"OPDDashboard",components:{DashboardCard:pr},setup(){const{ready:t,OPDWaitingLists:e,hasWaitingList:s,refreshUserData:r}=Te();return{ready:t,OPDWaitingLists:e,hasWaitingList:s,refreshUserData:r}},data(){return{totalPatientsToday:0,isRefreshing:!1}},computed:{...K(jt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","patientsVisits","todaysAppointmentsCount"])},async mounted(){await this.refreshDashboard()},methods:{lockClosed(){return yn},refresh(){return bn},medkit(){return fe},flask(){return vn},async refreshDashboard(){if(!this.isRefreshing){this.isRefreshing=!0;try{const t=G.getUserLocationId();if(!t)return;await Promise.all([jt().refresh(t),this.refreshUserData()])}finally{this.isRefreshing=!1}}},clipboard(){return pe},thermometer(){return me},calendar(){return _n},people(){return he},openAllModal(t,e,s){Tt(Ki,{class:"fullScreenModal"},!0,{title:t,buttonTitle:e,buttonLink:s})},openPatientsListModal(t,e,s,r){Tt(qi,{class:"fullScreenModal"},!0,{title:t,list:e,buttonTitle:s,buttonLink:r})},openAppointmentsModal(t,e){Tt(rr,{class:"fullScreenModal"},!0,{title:t,programType:e,programId:14})}}}),hr={class:"dashboard-wrapper"},gr={key:0,class:"loading-container"},fr={key:1,class:"no-access-container"};function _r(t,e,s,r,l,f){const i=u("ion-icon"),c=u("ion-card-title"),p=u("ion-card-header"),v=u("ion-spinner"),m=u("ion-button"),C=u("DashboardCard"),$=u("ion-row"),D=u("ion-grid"),y=u("ion-card-content"),b=u("ion-card"),N=u("ion-content");return d(),V(N,{fullscreen:!0},{default:o(()=>[n("div",hr,[a(b,{class:"dashboard-card"},{default:o(()=>[a(p,{class:"dashboard-card-header"},{default:o(()=>[a(c,{class:"dashboard-title"},{default:o(()=>[a(i,{icon:t.people(),slot:"start",class:"dashboard-icon"},null,8,["icon"]),e[6]||(e[6]=T(" Today's Patients Overview ",-1))]),_:1})]),_:1}),a(y,null,{default:o(()=>[t.ready?t.OPDWaitingLists.length===0?(d(),_("div",fr,[a(i,{icon:t.lockClosed(),class:"no-access-icon"},null,8,["icon"]),e[9]||(e[9]=n("h2",{class:"no-access-title"},"No Waiting Lists Assigned",-1)),e[10]||(e[10]=n("p",{class:"no-access-message"}," You currently don't have access to any waiting lists. Please contact your system administrator or supervisor to request access. ",-1)),a(m,{color:"primary",fill:"outline",onClick:t.refreshDashboard,class:"refresh-button"},{default:o(()=>[a(i,{icon:t.refresh(),slot:"start"},null,8,["icon"]),e[8]||(e[8]=T(" Refresh ",-1))]),_:1},8,["onClick"])])):(d(),V(D,{key:2,class:"centered-grid"},{default:o(()=>[a($,{class:"centered-row"},{default:o(()=>{var I,P,O,M;return[t.hasWaitingList("Total Patients Today")?(d(),V(C,{key:0,icon:t.people(),color:"primary",count:t.patientsVisits.length,label:"Total patients today",onCardClick:e[0]||(e[0]=z=>t.openAllModal("All patients today","View profile","/patientProfile"))},null,8,["icon","count"])):S("",!0),t.hasWaitingList("Appointments Today")?(d(),V(C,{key:1,icon:t.calendar(),color:"primary",count:((I=t.todaysAppointmentsCount)==null?void 0:I.length)||0,label:"Appointments",onCardClick:e[1]||(e[1]=z=>t.openAppointmentsModal("OPD Appointments","14"))},null,8,["icon","count"])):S("",!0),t.hasWaitingList("Waiting for Vitals")?(d(),V(C,{key:2,icon:t.thermometer(),color:"primary",count:(P=t.patientsWaitingForVitals)==null?void 0:P.length,label:"Waiting for vitals",onCardClick:e[2]||(e[2]=z=>t.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals"))},null,8,["icon","count"])):S("",!0),t.hasWaitingList("Waiting for Consultation")?(d(),V(C,{key:3,icon:t.clipboard(),color:"primary",count:(O=t.patientsWaitingForConsultation)==null?void 0:O.length,label:"Waiting for consultation",onCardClick:e[3]||(e[3]=z=>t.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan"))},null,8,["icon","count"])):S("",!0),t.hasWaitingList("Waiting for Laboratory")?(d(),V(C,{key:4,icon:t.flask(),color:"primary",count:t.patientsWaitingForLab.length,label:"Waiting for lab",onCardClick:e[4]||(e[4]=z=>t.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan"))},null,8,["icon","count"])):S("",!0),t.hasWaitingList("Waiting for Dispensation")?(d(),V(C,{key:5,icon:t.medkit(),color:"primary",count:(M=t.patientsWaitingForDispensation)==null?void 0:M.length,label:"Waiting for dispensation",onCardClick:e[5]||(e[5]=z=>t.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations"))},null,8,["icon","count"])):S("",!0)]}),_:1})]),_:1})):(d(),_("div",gr,[a(v,{name:"crescent"}),e[7]||(e[7]=n("p",{class:"loading-text"},"Loading dashboard...",-1))]))]),_:1})]),_:1})])]),_:1})}const vr=W(mr,[["render",_r],["__scopeId","data-v-0c821bbd"]]),br={class:"icon-container"},yr=["src","alt"],Dr={class:"card-title"},Cr=H({__name:"DashboardCard",props:{icon:{},title:{}},emits:["click"],setup(t,{emit:e}){const s=t,r=e,l=Q(()=>Ft[s.icon]||"");return(f,i)=>(d(),_("div",{class:"card",onClick:i[0]||(i[0]=c=>r("click"))},[n("div",br,[n("img",{src:l.value,alt:t.title},null,8,yr)]),n("div",Dr,g(t.title),1)]))}}),$r=W(Cr,[["__scopeId","data-v-334cd0db"]]),wr={class:"dashboard-container"},kr={class:"dashboard-grid"},Sr=H({__name:"AETCDashboard",setup(t){B("");const e=Dt(),s=B([{id:"patientArrival",icon:"plus_dashboard",title:"Patient Arrival"},{id:"screeningList",icon:"checklist",title:"Awaiting Screening List"},{id:"registrationList",icon:"checklist",title:"Awaiting Registration List"},{id:"triageList",icon:"checklist",title:"Awaiting Triage List"},{id:"assessmentList",icon:"checklist",title:"Awaiting Assessment List"},{id:"testResultsList",icon:"checklist",title:"Awaiting Test Results List"},{id:"specialtyList",icon:"checklist",title:"Awaiting Specialty List"},{id:"dispositionList",icon:"checklist",title:"Disposition List"},{id:"broughtDead",icon:"document",title:"Brought In Dead"},{id:"reports",icon:"chart",title:"Reports"}]),r=l=>{e.push({name:l})};return(l,f)=>(d(),V(k($t),null,{default:o(()=>[a(k(et),{fullscreen:!0},{default:o(()=>[n("div",wr,[n("div",kr,[(d(!0),_(x,null,q(s.value,i=>(d(),V($r,{key:i.id,icon:i.icon,title:i.title,onClick:c=>r(i.id)},null,8,["icon","title","onClick"]))),128))])])]),_:1})]),_:1}))}}),Ir=W(Sr,[["__scopeId","data-v-bcce1a76"]]),Ar=H({name:"NCDDashboard",mixins:[At],components:{ApexChart:Zt},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await ve(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return G.getJson("programs/32/reports/ncd_dashboard",{start_date:A.toStandardHisFormat(A.sessionDate()),end_date:A.toStandardHisFormat(A.sessionDate())})}}}),Pr={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},Tr={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},Nr={ref:"chartRef1"},Or={ref:"chartRef2"};function Rr(t,e,s,r,l,f){const i=u("ion-card-content"),c=u("ion-card"),p=u("ApexChart");return d(),_(x,null,[n("div",Pr,[a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(i,null,{default:o(()=>[...e[0]||(e[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(i,null,{default:o(()=>[...e[1]||(e[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(i,null,{default:o(()=>[...e[2]||(e[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:o(()=>[a(i,null,{default:o(()=>[...e[3]||(e[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])]),_:1})]),_:1})]),n("div",Tr,[a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(i,null,{default:o(()=>[e[4]||(e[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",Nr,[t.isChartReady?(d(),V(p,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1})]),_:1}),a(c,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:o(()=>[a(i,null,{default:o(()=>[e[5]||(e[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",Or,[t.isChartReady?(d(),V(p,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1})]),_:1})])],64)}const Lr=W(Ar,[["render",Rr],["__scopeId","data-v-58e2a3d8"]]),Vr=H({name:"Home",mixins:[Se,At],components:{IonContent:et,IonHeader:it,IonPage:$t,IonToolbar:ut,Toolbar:Ae,IonRow:Mt,DateInputField:Kt,IonIcon:J,IonButton:Nt,IonCol:Vt},data(){const t=B(A.sessionDate()),e=B(A.sessionDate()),s=B(A.sessionDate()),r=B([]);return{segmentContent:"Today",minDate:s,startDate:t,endDate:e,people:r,calendarOutline:gt,eyeOutline:$e}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(t){this.segmentContent=t},formatBirthdate(t){return A.getBirthdateAge(t)},async getAppointments(){this.people=[],(await Pe.getAppointments(this.startDate,this.endDate,"")).forEach(e=>{const s={person_id:e.person_id,npid:e.npid,appointment_id:103,encounter_id:e.encounter_id,name:e.given_name.concat(" ",e.family_name),gender:e.gender,ageDob:this.formatBirthdate(e.birthdate),village:e.city_village,appointmentDate:A.toStandardHisDisplayFormat(e.appointment_date)};this.people.push(s)})},async getAppointmentsD1(t){this.startDate=A.toStandardHisFormat(t),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=A.toStandardHisFormat(t),await this.getAppointments()},async openClientProfile(t){await ft.findByNpid(t),this.isPharmacist()},isPharmacist(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(s=>e.some(r=>r.role==="Pharmacist"))&&(this.$router.push("dispensation"),G.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),Mr={class:"appointments-container"},Br={key:0,class:"date-filter"},Er={class:"appointments-table"};function Fr(t,e,s,r,l,f){const i=u("ion-label"),c=u("ion-segment-button"),p=u("ion-segment"),v=u("DateInputField"),m=u("ion-col"),C=u("ion-row"),$=u("ion-icon"),D=u("ion-button"),y=u("ion-card");return d(),_("div",Mr,[n("div",null,[a(p,{value:t.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:o(()=>[a(c,{value:"Today",onClick:e[0]||(e[0]=b=>t.setSegmentContent("Today"))},{default:o(()=>[a(i,null,{default:o(()=>[...e[3]||(e[3]=[T("Today",-1)])]),_:1})]),_:1}),a(c,{value:"Tomorrow",onClick:e[1]||(e[1]=b=>t.setSegmentContent("Tomorrow"))},{default:o(()=>[a(i,null,{default:o(()=>[...e[4]||(e[4]=[T("Tomorrow",-1)])]),_:1})]),_:1}),a(c,{value:"Date range",onClick:e[2]||(e[2]=b=>t.setSegmentContent("Date range"))},{default:o(()=>[a(i,null,{default:o(()=>[...e[5]||(e[5]=[T("Date range",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),t.segmentContent==="Date range"?(d(),_("div",Br,[a(C,null,{default:o(()=>[a(m,null,{default:o(()=>[a(v,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(m,null,{default:o(()=>[a(v,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):S("",!0),t.people.length>0?(d(),V(y,{key:1},{default:o(()=>[n("table",Er,[e[6]||(e[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),_(x,null,q(t.people,b=>(d(),_("tr",{key:b.npid},[n("td",null,[a(C,null,{default:o(()=>[a(m,null,{default:o(()=>[T(g(b.name),1)]),_:2},1024),a(m,null,{default:o(()=>[a(D,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:N=>t.openClientProfile(b.npid),color:"primary",fill:"clear",size:"small"},{default:o(()=>[a($,{icon:t.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,g(b.npid),1),n("td",null,g(b.ageDob),1),n("td",null,g(b.gender),1),n("td",null,g(b.village),1),n("td",null,g(b.appointmentDate),1)]))),128))])])]),_:1})):(d(),V(y,{key:2},{default:o(()=>[...e[7]||(e[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])]),_:1}))])}const xr=W(Vr,[["render",Fr],["__scopeId","data-v-c47f7768"]]),Hr=H({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){}}}),Ur={key:0},Wr={style:{display:"flex","margin-top":"10px"}},zr={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},jr={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},Gr={key:1};function Jr(t,e,s,r,l,f){const i=u("ion-label"),c=u("ion-segment-button"),p=u("ion-segment"),v=u("VisitsHistory");return d(),_(x,null,[n("div",null,[a(p,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:o(()=>[a(c,{value:"Internal referrals",onClick:e[0]||(e[0]=m=>t.setSegmentContent("Internal referrals"))},{default:o(()=>[a(i,null,{default:o(()=>[...e[2]||(e[2]=[T("Internal referrals",-1)])]),_:1})]),_:1}),a(c,{value:"External referrals",onClick:e[1]||(e[1]=m=>t.setSegmentContent("External referrals"))},{default:o(()=>[a(i,null,{default:o(()=>[...e[3]||(e[3]=[T("External referrals",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(d(),_("div",Ur,[n("div",Wr,[t.checkUnderFive?(d(),_("div",zr)):S("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?S("",!0):(d(),_("div",jr))])])):S("",!0),t.segmentContent=="External referrals"?(d(),_("div",Gr,[a(v)])):S("",!0)],64)}const qr=W(Hr,[["render",Jr],["__scopeId","data-v-faad8f8b"]]),Qr=H({name:"Menu",components:{IonContent:et,IonHeader:it,IonItem:mt,IonList:pt,IonMenu:kt,IonTitle:wt,IonToolbar:ut,IonCheckbox:Et,IonIcon:J,BasicForm:It,BasicCard:xt,Referrals:qr,Dashboard:Lr,ANCAppointments:xr},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:Ce},{id:"referrals",label:"Referrals",icon:Qt},{id:"appointments",label:"Appointments",icon:gt}],activeItem:"dashboard"}},computed:{...K(St,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Yr={style:{display:"flex"}},Xr={class:"left_col"},Zr={class:"nav-menu"},Kr=["onClick"],tl={class:"right_col"};function el(t,e,s,r,l,f){const i=u("ion-icon"),c=u("Dashboard"),p=u("ANCAppointments"),v=u("Referrals");return d(),_("div",Yr,[n("div",Xr,[n("nav",Zr,[n("ul",null,[(d(!0),_(x,null,q(t.menuItems,m=>(d(),_("li",{key:m.id,class:st({active:t.activeItem===m.id}),onClick:C=>t.setActiveItem(m.id)},[a(i,{icon:m.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,g(m.label),1)],10,Kr))),128))])])]),n("div",tl,[n("div",null,[t.activeItem==="dashboard"?(d(),V(c,{key:0})):S("",!0),t.activeItem==="appointments"?(d(),V(p,{key:1})):S("",!0),t.activeItem==="referrals"?(d(),V(v,{key:2})):S("",!0)])])])}const nl=W(Qr,[["render",el],["__scopeId","data-v-7e786ea4"]]),al=H({name:"Menu",components:{IonContent:et,IonHeader:it,IonItem:mt,IonList:pt,IonMenu:kt,IonTitle:wt,IonToolbar:ut,IonCheckbox:Et,BasicForm:It,BasicCard:xt},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...K(St,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),sl={class:"left_col"},ol={class:"nav-menu"},il=["onClick"];function rl(t,e,s,r,l,f){return d(),_("div",null,[n("div",sl,[n("nav",ol,[n("ul",null,[(d(!0),_(x,null,q(t.menuItems,i=>(d(),_("li",{key:i.id,class:st({active:t.activeItem===i.id}),onClick:c=>t.setActiveItem(i.id)},g(i.label),11,il))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const ll=W(al,[["render",rl],["__scopeId","data-v-32dd02d3"]]),dl=H({name:"Menu",components:{IonContent:et,IonHeader:it,IonItem:mt,IonList:pt,IonMenu:kt,IonTitle:wt,IonToolbar:ut,IonCheckbox:Et,BasicForm:It,BasicCard:xt},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...K(St,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),cl={class:"left_col"},ul={class:"nav-menu"},pl=["onClick"];function ml(t,e,s,r,l,f){return d(),_("div",null,[n("div",cl,[n("nav",ul,[n("ul",null,[(d(!0),_(x,null,q(t.menuItems,i=>(d(),_("li",{key:i.id,class:st({active:t.activeItem===i.id}),onClick:c=>t.setActiveItem(i.id)},g(i.label),11,pl))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const hl=W(dl,[["render",ml],["__scopeId","data-v-b49d8600"]]);function gl(){const t=Yt(),e=B(""),s=B(!1),r=B({}),l=()=>{const f=G.getUserRoles(),i=G.getProgramID(),c=G.getProgramName();e.value=f,s.value=!1,f==="Lab"&&i===14?r.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:i===14&&f!=="Lab"?r.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:i===12?r.value={url:"contact",btnName:"Back"}:c==="LABOUR AND DELIVERY PROGRAM"?r.value={url:"labour/labourHome",btnName:"Back to home"}:c==="PNC PROGRAM"?r.value={url:"pnc/home",btnName:"Back to home"}:r.value={url:"",btnName:""},s.value=!0};return lt(()=>t.path,()=>{l()},{immediate:!0,deep:!0}),{userRole:e,ready:s,userRoleSettings:r,updateUserRoleSettings:l}}const fl={key:0,class:"spinner-overlay"},Ul=H({__name:"HomePage",setup(t){const e=B(!0),s=Yt(),r=Vn(),l=B(localStorage.getItem("sessionDate")||"");gl();const f=ke(),{apiStatus:i}=zt(Ie()),{activeProgram:c}=zt(f),p=Q(()=>{var y;switch((y=c.value)==null?void 0:y.program_id){case Z.IMMUNIZATION_PROGRAM:return Wi;case Z.OPD_PROGRAM:return vr;case Z.NCD_PROGRAM:return zs;case Z.AETC_PROGRAM:return Ir;case Z.HTS_PROGRAM:return wo;case Z.ANC_PROGRAM:return nl;case Z.PNC_PROGRAM:return hl;case Z.LABOUR_AND_DELIVERY_PROGRAM:return ll;case Z.HIV_PROGRAM:return ni;case Z.NEONATAL_PROGRAM:return oe;case Z.HTC_PROGRAM:return oe;default:return null}}),v=()=>{const y=localStorage.getItem("sessionDate");(!y||y.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),se()),l.value=y||""};let m=null;ct(()=>{m=()=>v(),window.addEventListener("storage",m);const y=setInterval(v,1e3);Dn(()=>{clearInterval(y),m&&window.removeEventListener("storage",m)}),v()}),lt(l,(y,b)=>{(!y||y.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),se())});const C=async()=>{bt.isEmpty(c.value)&&await xn.show(Wn,{},"module-picker-modal")},$=async(y=[])=>{try{e.value=!0,Mn(),await Bn().loadGlobalProperty(),r.postData({command:"ping"});for(const b of y)typeof b=="function"?await b():console.warn("Non-function item found in extraFns array:",b)}catch(b){console.error("Error initializing component:",b)}finally{e.value=!1}};lt(()=>s.name,async y=>{y==="Home"&&await $([C])},{immediate:!0,deep:!0});const D=async()=>{try{const y=G.getUserID(),b=await En.getUserByID(y);if(b.location_id!=null){const N=await Fn.getLocation(b.location_id);localStorage.setItem("locationData",JSON.stringify(N))}}catch(y){console.error("Failed to retrieve location data:",y)}};return i.value&&(Te(),D()),ct(async()=>{try{await $()}catch(y){console.error("Error initializing component:",y)}finally{e.value=!1}}),(y,b)=>{const N=u("ion-spinner"),I=u("ion-content");return d(),V(k($t),null,{default:o(()=>[e.value?(d(),_("div",fl,[a(N,{name:"bubbles"}),b[0]||(b[0]=n("div",{class:"loading-text"},"Please wait...",-1))])):S("",!0),a(Ae),a(Un),p.value?(d(),V(Cn(p.value),{key:1})):(d(),V(I,{key:2},{default:o(()=>[...b[1]||(b[1]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])]),_:1}))]),_:1})}}});export{Ul as default};

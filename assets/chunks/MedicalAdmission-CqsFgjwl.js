import{d as Ie,ao as Re,cp as Me,r as S,c as Ae,aV as D,w as f,a as Te,H as m,O as j,f as G,J as B,l as o,u as w,a3 as ke,k as r,m as Fe,i as v,bM as Be,v as d,a6 as Ne,b9 as _}from"./vendor-DXb7_Vik.js";import{aH as J,u as Ee,aI as Ve,aJ as Le,aK as ze,aL as $e,d as We,aM as je,g as Ge,Z as Je,e as Ue,T as Ke,J as Qe,N as Ze,H as N,aN as C,aO as qe,aP as U,aQ as Xe,t as K,aS as x,G as Ye,aT as Oe,a0 as et,S as tt}from"../index-BTzlHWti.js";import{D as at}from"./DemographicBar-eNQEFxwo.js";import{u as st,a as E,_ as nt,s as it,c as ot,b as lt}from"./nonPharmaTherapyStore-BeISV_Ld.js";import{l as rt}from"./lodash-NJiRuGo9.js";import{a as Q,b as ct}from"./formatServerData-7qThvcTY.js";import{u as ut}from"./usePatientProfile-Sa7_6IKd.js";import"./apexcharts-BuY4MMmo.js";import"./drug_prescription_service-ySIgUyjo.js";import"./patient_diagnosis_service-CQuOZ-dD.js";import"./Registration-BkEh1pO3.js";import"./useLocation-Cp0h58AO.js";import"./vaccines_service-ClIn1bil.js";import"./sms_service-6uMMsQoU.js";import"./EIRreportsStore-BZue7Psd.js";import"./Export-CsyA_qG4.js";import"./useNeonatalEnrollmentStore-CKsTgfLA.js";import"./enrollment-DU-PLRUa.js";const gt={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},mt={class:"back_profile"},kt=Ie({__name:"MedicalAdmission",setup(vt,{expose:Z}){const{onTabBeforeChange:q,currentTabIndex:y}=st();ut();const I=Re(),X=Me();S([]),S([]),S(!1);const R=S(!0),M=S(!1),h=S(!1),V=Ae(()=>({text:h.value?"Saving...":"Finish",icon:h.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:M.value||h.value})),Y=J(),O=Ee(),ee=Ve(),te=Le();ze();const ae=$e(),A=We();je();const se=Ge(),ne=E(),ie=Je(),{patient:l}=D(O),{vitals:oe}=D(Y),{investigations:le}=D(ee),{diagnosis:re}=D(te),{substance:ce}=D(se),{selectedNCDMedicationList:L}=D(ae),{FootScreening:ue,visualScreening:ge,cvScreening:me}=D(ne),{sessionDate:z}=D(ie),{apiStatus:dt}=D(Ue());f(V,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:y.value,tabsLength:n.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),f(h,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const ve=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},P=()=>{let e=!1;return u(),h.value&&(e=!0),M.value=e,!e},de=()=>{I.push("/patientProfile")},T=()=>[{title:"Presenting Complaints",icon:""},{title:"Drug History",icon:""},{title:"Past Medical History",icon:""},{title:"Past Surgical History",icon:""},{title:"Allergy",icon:""},{title:"Intoxication",icon:""},{title:"Social History",icon:""},{title:"Family History",icon:""},{title:"Review of Systems",icon:""},{title:"Physical Examination",icon:""},{title:"Summary",icon:""},{title:"Differential Diagnosis",icon:""},{title:"Investigation",icon:""},{title:"Management Plan",icon:""}],n=S(T()),fe=S(null),ye=S(null),u=()=>{var s;if(!n.value||n.value.length===0)return console.log("Tabs not yet initialized"),null;const e=y.value>=0&&y.value<n.value.length?y.value:0;switch((s=n.value[e])==null?void 0:s.title){case"Presenting Complaints":return"Presenting Complaints";case"Drug History":return"DrugHistory";case"Past Medical History":return"PastMedicalHistory";case"Past Surgical History":return"PastSurgicalHistory";case"Allergy":return"Allergy";case"Intoxication":return"Intoxication";case"Social History":return"SocialHistory";case"Family History":return"FamilyHistory";case"Review of Systems":return"ReviewOfSystems";case"Physical Examination":return"PhysicalExamination";case"Summary":return"Summary";case"Differential Diagnosis":return"DifferentialDiagnosis";case"Investigation":return"Investigation";case"Management Plan":return"ManagementPlan";default:if(A.NCDActivities.length>0)switch(A.NCDActivities[0]){case"Presenting Complaints":return"PresentingComplaints";case"Drug History":return"DrugHistory";case"Past Medical History":return"PastMedicalHistory";case"Past Surgical History":return"PastSurgicalHistory";case"Allergy":return"Allergy";case"Intoxication":return"Intoxication";case"Social History":return"SocialHistory";case"Family History":return"FamilyHistory";case"Review of Systems":return"ReviewOfSystems";case"Physical Examination":return"PhysicalExamination";case"Summary":return"Summary";case"Differential Diagnosis":return"DifferentialDiagnosis";case"Investigation":return"Investigation";case"Management Plan":return"ManagementPlan"}return null}},k=()=>{R.value=!1,setTimeout(()=>{y.value=0,R.value=!0},0)},$=()=>{const e=J();e.setVitals(e.getInitialVitals(l.value.ID))},p=async()=>{var s,g;const e=Ze(z.value,"sessionDate","value")||N.sessionDate(),t=C("vitals");for(let a=0;a<n.value.length;a++){const c=n.value[a];if(c.title==="Vital Signs")n.value[a].icon=H(e,t)?_:"";else if(c.title==="Risk Assessment"){const i=C("substanceAbuse");n.value[a].icon=H(e,i)?_:""}else if(c.title==="Investigations"){const i=(g=(s=l==null?void 0:l.value)==null?void 0:s.labOrders)==null?void 0:g.saved,b=i==null?void 0:i.filter(F=>N.toStandardHisFormat(e)===N.toStandardHisFormat(F.order_date));n.value[a].icon=(b==null?void 0:b.length)>0?_:""}else if(c.title==="Diagnosis"){const i=C("diagnosis");n.value[a].icon=H(e,i)?_:""}else if(c.title==="Complications Screening"){const i=C("screening");n.value[a].icon=H(e,i)?_:""}else c.title==="Treatment Plan"&&(L.value.length>0?n.value[a].icon=qe()?_:"":n.value[a].icon="")}P()},H=(e,t)=>{const s=new Date(e);return s.setHours(0,0,0,0),t.some(g=>{const a=new Date(g.obs_datetime);return a.setHours(0,0,0,0),a.getTime()===s.getTime()})},pe=async()=>{var a,c,i,b;const e=[],t=await Q(ge.value),s=await ct(ue.value),g=await Q(me.value);t.length>0&&e.push({concept_id:await x.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:x.getSessionDate(),child:t}),s.length>0&&e.push({concept_id:await x.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:x.getSessionDate(),child:s}),g.length>0&&e.push(...g),e.length>0?((b=(i=(c=(a=l.value).screening)!=null?c:a.screening={}).unsaved)!=null||(i.unsaved=[]),l.value.screening.unsaved.push(...e),Ye("Complications saved successfully")):K("No complications data to save")},Se=async()=>{const e=Oe();if(!rt.isEmpty(e.selectedMedicalAllergiesList)){const g=et(),a=e.selectedMedicalAllergiesList.map(i=>({concept_id:i.concept_id,obs_datetime:tt.getSessionDate(),value_coded:i.concept_id,location_id:g.facilityLocation.code,value_text:i.name})),c=await it(a);l.value=Object.assign(l.value,c),console.log("Allergies staged successfully:",l.value),e.clearSelectedMedicalAllergiesList()}const t=await ot();l.value=Object.assign(l.value,t);const s=await lt().saveNonPharmaTherapyPatientData();l.value=Object.assign(l.value,s)},De=async(e,t)=>{var g,a,c;const s=(g=n.value[t])==null?void 0:g.title;e%1===0&&(y.value=e),s=="Vital Signs"&&((a=fe.value)==null||a.onSubmit()),s=="Risk Assessment"&&((c=ye.value)==null||c.onSubmit()),s=="Complications Screening"&&await pe(),s=="Treatment Plan"&&await Se(),await U(l.value)},W=async()=>{h.value=!0;try{await Xe(),await U(l.value),I.push("/triageList")}catch(e){console.error("Error saving data:",e),K("Error occurred while saving data. Please try again.")}finally{h.value=!1}};return Te(async()=>{if(A.NCDActivities.length===0){I.push("patientProfile");return}E().resetScreening(),n.value=T(),await p(),(y.value===void 0||y.value<0)&&(y.value=0,console.log("Setting initial tab index to 0")),M.value=!1,h.value=!1,P()}),f(y,async()=>{await P()}),f(oe,async()=>{await p()},{deep:!0}),f(l,async()=>{E().resetScreening(),await p()},{deep:!0}),f(z,async()=>{await p()},{deep:!0}),f(le,async()=>{await p()},{deep:!0}),f(re,async()=>{await p()},{deep:!0}),f(ce,async()=>{await p()},{deep:!0}),f(L,async()=>{await p()},{deep:!0}),f(X,async e=>{k(),$(),n.value=T()},{deep:!0}),f(l,async(e,t)=>{e.ID!=t.ID&&(k(),$())},{deep:!0}),Z({saveData:W,markWizard:p,refreshWizard:k,validateDoneButtonState:P}),(e,t)=>{const s=m("PresentingComplaints"),g=m("DrugHistory"),a=m("PastMedicalHistory"),c=m("PastSurgicalHistory"),i=m("Allergy"),b=m("Intoxication"),F=m("SocialHistory"),he=m("FamilyHistory"),be=m("ReviewOfSystems"),_e=m("PhysicalExamination"),Pe=m("Summary"),He=m("DifferentialDiagnosis"),we=m("Investigation"),Ce=m("ManagementPlan");return G(),j(w(Ne),null,{default:B(()=>[o(Ke),o(w(ke),{fullscreen:!0},{default:B(()=>[o(at),r("div",gt,[R.value?(G(),j(nt,{key:0,ref:"wizard",headingTitle:"Medical Inpatient Admission Sheet","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:V.value,"custom-tabs":n.value,beforeChange:w(q),onChange:De,"onComplete:wizard":t[1]||(t[1]=xe=>W()),onDoneButtonChanged:ve},{default:B(()=>[r("div",null,[r("div",mt,[o(Qe,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:w(Be),"font-weight":"600",onClick:t[0]||(t[0]=xe=>de())},null,8,["icon"])])]),v(r("div",null,[o(s,{ref:"presentingComplaintsRef"},null,512)],512),[[d,u()=="PresentingComplaints"]]),v(r("div",null,[o(g,{ref:"drugHistoryRef"},null,512)],512),[[d,u()=="DrugHistory"]]),v(r("div",null,[o(a,{ref:"pastMedicalHistoryRef"},null,512)],512),[[d,u()=="PastMedicalHistory"]]),v(r("div",null,[o(c,{ref:"pastSurgicalHistoryRef"},null,512)],512),[[d,u()=="PastSurgicalHistory"]]),v(r("div",null,[o(i,{ref:"allergyRef"},null,512)],512),[[d,u()=="Allergy"]]),v(r("div",null,[o(b,{ref:"IntoxicationRef"},null,512)],512),[[d,u()=="Intoxication"]]),v(r("div",null,[o(F,{ref:"socialHistoryRef"},null,512)],512),[[d,u()=="SocialHistory"]]),v(r("div",null,[o(he,{ref:"familyHistoryRef"},null,512)],512),[[d,u()=="FamilyHistory"]]),v(r("div",null,[o(be,{ref:"reviewOfSystemsRef"},null,512)],512),[[d,u()=="ReviewOfSystems"]]),v(r("div",null,[o(_e,{ref:"physicalExaminationRef"},null,512)],512),[[d,u()=="PhysicalExamination"]]),v(r("div",null,[o(Pe,{ref:"summaryRef"},null,512)],512),[[d,u()=="Summary"]]),v(r("div",null,[o(He,{ref:"differentialDiagnosisRef"},null,512)],512),[[d,u()=="DifferentialDiagnosis"]]),v(r("div",null,[o(we,{ref:"investigationRef"},null,512)],512),[[d,u()=="Investigation"]]),v(r("div",null,[o(Ce,{ref:"managementPlanRef"},null,512)],512),[[d,u()=="ManagementPlan"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Fe("",!0)])]),_:1})]),_:1})}}});export{kt as default};

System.register(["./vendor-legacy-3W6n1FJZ.js","./nonPharmaTherapyStore-legacy-gFaN-1xg.js","../index-legacy-yxHYuYvv.js","./DemographicBar-legacy-SkB-Z2iY.js","./OPDOutcome-legacy-BMfRrfgh.js","./NextAppointment-legacy-DzN9fA8C.js","./OPDDiagnosis-legacy-CuFsEEPV.js","./OPDPrintingModal-legacy-PWd78HkS.js","./lodash-legacy-pOOc9Efu.js","./usePatientProfile-legacy-DNZMGu8h.js","./useUserActivities-legacy-BxdOyOSW.js","./drug_prescription_service-legacy-cNQBmNZu.js","./patient_diagnosis_service-legacy-CfX17kaB.js","./apexcharts-legacy-D3ICHakN.js","./LevelOfConsciousness.vue_vue_type_script_setup_true_lang-legacy-DuScItgl.js","./previousComplaints-legacy-CXO3PApT.js","./patient_complaints_service-legacy-F5QB0qrX.js","./DashBox-legacy-Bfpi7TQj.js","./BasicForm-legacy-BTZHkSwl.js","./DateInputField-legacy-DOo0nbQC.js","./formatServerData-legacy-D2AZ1mUP.js","./LabOrdersList-legacy-CX1Tuk80.js","./group_validation-legacy-41BRMy8M.js","./RadiologyStore-legacy-BNiW_qTJ.js","./ncd_appointment_service-legacy-BDmpoqVQ.js","./Registration-legacy-BJpap_YB.js","./useLocation-legacy-BBOEHowb.js","./vaccines_service-legacy-DkqhgL54.js","./sms_service-legacy-CtEyT2n0.js","./EIRreportsStore-legacy-CijPpI_-.js","./Export-legacy-DdFi4CVn.js","./useNeonatalEnrollmentStore-legacy-Bq6TKv22.js","./enrollment-legacy-BWFKsMdA.js"],function(e,t){"use strict";var a,n,l,i,s,o,u,c,r,d,v,g,p,m,y,f,h,b,w,_,P,D,x,O,j,S,T,C,A,I,N,k,L,F,E,R,B,M,H,W,z,J,U,V,$,q,G,K,Y,Q,X,Z,ee,te,ae,ne,le,ie,se,oe,ue,ce,re,de,ve,ge,pe,me;return{setters:[e=>{a=e.d,n=e.ao,l=e.cp,i=e.r,s=e.c,o=e.aV,u=e.a,c=e.w,r=e.O,d=e.f,v=e.J,g=e.l,p=e.e,m=e.m,y=e.k,f=e.u,h=e.bx,b=e.dz,w=e.a3,_=e.i,P=e.bM,D=e.v,x=e.a6,O=e.eJ,j=e.b9},e=>{S=e.u,T=e._,C=e.s,A=e.e,I=e.b},e=>{N=e.u,k=e.aI,L=e.bW,F=e.aK,E=e.d,R=e.aM,B=e.a0,M=e.b7,H=e.bE,W=e.bp,z=e.aT,J=e.T,U=e.J,V=e.G,$=e.s,q=e.af,G=e.b2,K=e.H,Y=e.aN,Q=e.aP,X=e.b_,Z=e.S,ee=e.t,te=e.bH,ae=e.q,ne=e.n,le=e._},e=>{ie=e.D},e=>{se=e.C,oe=e.b,ue=e.O},e=>{ce=e.I,re=e.N},e=>{de=e.O},e=>{ve=e.O},e=>{ge=e.l},e=>{pe=e.u},e=>{me=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent=".disabled[data-v-9b0dbbde]{color:red}.spinner-overlay[data-v-9b0dbbde]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-9b0dbbde]{width:80px;height:80px}.loading-text[data-v-9b0dbbde]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-9b0dbbde]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-9b0dbbde]{pointer-events:none}.back_profile[data-v-9b0dbbde]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(t);const ye={key:0,class:"spinner-overlay"},fe={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},he={class:"back_profile"};e("default",le(a({__name:"ConsultationPlan",setup(e){const{currentTabIndex:t}=S(),{printVisitSummary:a}=pe(),{hasWaitingList:le}=me(),be=n(),we=l(),_e=i(!1),Pe=i(!0),De=i(!1),xe=i(!1),Oe=i(!0),je=i(!1),Se=i(!1),Te=i(!1),Ce=N(),Ae=k(),Ie=L(),Ne=F(),ke=E(),Le=R(),Fe=B(),Ee=M(),Re=H(),Be=W(),Me=z(),He=i(!1),We=i(!1),ze=s(()=>({text:We.value?"Saving...":"Finish",icon:We.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:He.value||We.value})),{patient:Je}=o(Ce),{investigations:Ue}=o(Ae),{OPDdiagnosis:Ve}=o(Ie),{selectedMedicalDrugsList:$e}=o(Ne),{OPDActivities:qe}=o(ke),{outcomes:Ge}=o(Le),{currentSelectedNextAppointmentDate:Ke}=o(Re),{presentingComplaints:Ye}=o(Be),{vitals:Qe}=o(Ee),Xe=s(()=>Me.selectedMedicalAllergiesList),Ze=i(null),et=i(null),tt=i(null),at=i(null),nt=i(null),lt=i(null),it=i(null),st=i(),ot=()=>qe.value.map(e=>({title:e,icon:""})),ut=async(e,a,n)=>{var l;0===a&&await mt(),await vt()&&(await gt(),e%1==0&&(t.value=e),it.value&&n&&it.value.changeTab(e),"Investigations"===(null===(l=st.value[e])||void 0===l?void 0:l.title)&&et.value&&await et.value.openAHDModal())},ct=()=>{var e;if(!st.value||0===st.value.length)return null;const a=t.value>=0&&t.value<st.value.length?t.value:0;switch(null===(e=st.value[a])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(qe.value.length>0)switch(qe.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},rt=async()=>{xe.value=!0,V("Printing consultation summary... Please wait.");try{await a(),V("Consultation summary printed successfully!"),setTimeout(()=>{be.push("home")},3500)}catch(e){$("Failed to print consultation summary.")}finally{xe.value=!1}},dt=()=>{V("Patient has finished consultation!"),be.push("home")},vt=async()=>{const e=await q.getObsByEncounterIdAndDate(G.PRESENTING_COMPLAINTS);return!!(e&&e.length>0)},gt=async()=>{const e=K.sessionDate();for(let a=0;a<st.value.length;a++)if(await vt()){Pe.value=!0,De.value=!1;const n=st.value[a];if("Clinical Assessment"===n.title){const t=Y("presentingComplaints");st.value[a].icon=pt(e,t)?j:""}else if("Investigations"===n.title){var t;const n=null===(t=Je.value)||void 0===t||null===(t=t.labOrders)||void 0===t?void 0:t.saved,l=null==n?void 0:n.filter(t=>K.toStandardHisFormat(e)===K.toStandardHisFormat(t.order_date));st.value[a].icon=(null==l?void 0:l.length)>0?j:""}else if("Diagnosis"===n.title){const t=Y("diagnosis");st.value[a].icon=pt(e,t)?j:""}else if("Treatment Plan"===n.title){const e=Y("treatment");st.value[a].icon=(null==e?void 0:e.length)>0?j:""}else if("Next Appointment"===n.title){const t=Y("appointments");st.value[a].icon=pt(e,t)?j:""}else if("Outcome"===n.title){const e=Y("outcomes");st.value[a].icon=(null==e?void 0:e.length)>0?j:""}}else Pe.value=!1,"Clinical Assessment"!==st.value[a].title&&(st.value[a].icon=O);Pt()},pt=(e,t)=>{if(!t)return!1;const a=new Date(e);return a.setHours(0,0,0,0),t.some(e=>{const t=new Date(e.obs_datetime||e.order_date);return t.setHours(0,0,0,0),t.getTime()===a.getTime()})},mt=async()=>{_e.value=!0;try{var e;await yt(),await Promise.all([null===(e=Ze.value)||void 0===e?void 0:e.onSubmit()]),await Q(Je.value),X()}catch(t){throw $("Failed to save clinical assessment"),t}finally{_e.value=!1}},yt=async()=>{try{if(ge.isEmpty(Xe.value))return;const e=Xe.value.map(e=>({concept_id:e.concept_id,obs_datetime:Z.getSessionDate(),value_coded:e.concept_id,location_id:Fe.facilityLocation.code,value_text:e.name})),t=await C(e);Ce.setPatientRecord(t)}catch{ee("Failed to save allergies")}},ft=async()=>{try{var e;We.value=!0,await(null===(e=tt.value)||void 0===e?void 0:e.onSubmit()),await(async()=>{try{const e=await A();Je.value={...Je.value,...e};const t=await I().saveNonPharmaTherapyPatientData();Je.value={...Je.value,...t}}catch{ee("Failed to save treatment plan")}})(),await Le.saveOutcomPatientData(),await Q(Je.value);const t=localStorage.getItem("locationID");if(!t)return void $("Location ID missing.");const a=(()=>{const e=$e.value;return console.log("Checking prescribed medications:",{medicationsCount:e.length,medications:e}),e.length>0})();if(le("Waiting for Laboratory"))return await bt(t),void V("Patient moved to Consultation for Lab follow-up.");if(a&&le("Waiting for Consultation"))return void(le("Waiting for Dispensation")?await ht(t):await wt(t));if(!a&&le("Waiting for Consultation"))return void(await _t(t))}catch(t){$("Failed to save consultation.")}finally{We.value=!1}},ht=async e=>{try{await te.addPatientToStage(Je.value,"DISPENSATION"),await ae().refresh(e),Ne.clearSelectedMedicalDrugsList(),V("Patient moved to Dispensation."),be.push("home")}catch(t){throw $("Failed to move patient to dispensation"),t}},bt=async e=>{try{await te.addPatientToStage(Je.value,"CONSULTATION"),await ae().refresh(e),Ne.clearSelectedMedicalDrugsList(),be.push("home")}catch(t){throw $("Failed to move patient to consultation"),t}},wt=async e=>{try{await te.addPatientToStage(Je.value,"DISPENSATION"),await ae().refresh(e),Ne.clearSelectedMedicalDrugsList(),ee("Patient moved to dispensation queue. You lack access to dispense."),be.push("home")}catch(t){throw $("Failed to move patient to dispensation"),t}},_t=async e=>{try{await ne(Je.value),await ae().refresh(e),be.push("home")}catch(t){console.error("Failed to close visit:",t),$("Failed to close visit.")}};u(async()=>{0!==qe.value.length?(st.value=ot(),await gt(),(void 0===t.value||t.value<0)&&(t.value=0),He.value=!1,Pt()):await be.push("home")}),c(t,async()=>{await Pt()}),c(Qe,async()=>{await gt()},{deep:!0}),c(Je,async()=>{await gt()},{deep:!0}),c(Ue,async()=>{await gt()},{deep:!0}),c(Ve,async()=>{await gt()},{deep:!0}),c($e,async()=>{await gt()},{deep:!0}),c(Ge,async()=>{await gt()},{deep:!0}),c(Ke,async()=>{await gt()}),c(Ye,async()=>{await gt()},{deep:!0}),c(we,async()=>{Oe.value=!1,st.value=ot(),setTimeout(()=>{t.value=0,Oe.value=!0},0)},{deep:!0}),c(Te,e=>{Se.value=e,Se.value&&setTimeout(()=>{Se.value=!1},15e3)}),c(ze,(e,a)=>{console.log("Done button options changed:",{from:a,to:e,currentStep:t.value,tabsLength:st.value.length})},{deep:!0});const Pt=()=>{let e=!1;return We.value&&(e=!0),He.value=e,!e};return(e,t)=>(d(),r(f(x),null,{default:v(()=>[g(ve,{onYes:rt,onNo:dt,isOpen:je.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),_e.value?(d(),p("div",ye,[g(f(h),{name:"bubbles"}),t[3]||(t[3]=y("div",{class:"loading-text"},"Please wait...",-1))])):m("",!0),g(f(b),{"is-open":xe.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),g(J),g(f(w),{fullscreen:!0},{default:v(()=>[g(ie),y("div",fe,[Oe.value?(d(),r(T,{key:0,ref_key:"wizard",ref:it,headingTitle:"Consultation Plan","vertical-tabs":"","navigable-tabs":Pe.value,"scrollable-tabs":"",startIndex:0,doneButton:ze.value,nextButton:{disabled:De.value},"custom-tabs":st.value,tabs:st.value,onChange:ut,"onComplete:wizard":t[2]||(t[2]=e=>ft())},{default:v(()=>[y("div",null,[y("div",he,[g(U,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:f(P),"font-weight":"600",onClick:t[0]||(t[0]=e=>{be.push("home")})},null,8,["icon"]),g(U,{name:"Back to Profile",iconSlot:"start",fill:"clear",icon:f(P),"font-weight":"600",onClick:t[1]||(t[1]=e=>{be.push("patientProfile")}),style:{"margin-left":"15px"}},null,8,["icon"])])]),_(y("div",null,[g(se,{ref_key:"clinicalAssessmentRef",ref:Ze},null,512)],512),[[D,"ClinicalAssessment"===ct()]]),_(y("div",null,[g(ce,{ref_key:"investigationsRef",ref:et},null,512)],512),[[D,"Investigations"===ct()]]),_(y("div",null,[g(de,{ref_key:"diagnosisRef",ref:tt},null,512)],512),[[D,"OPDDiagnosis"===ct()]]),_(y("div",null,[g(oe,{ref_key:"treatmentPlanRef",ref:at},null,512)],512),[[D,"OPDTreatmentPlan"===ct()]]),_(y("div",null,[g(re,{ref_key:"nextAppointmentRef",ref:nt},null,512)],512),[[D,"NextAppointment"===ct()]]),_(y("div",null,[g(ue,{ref_key:"outcomeRef",ref:lt},null,512)],512),[[D,"Outcome"===ct()]])]),_:1},8,["navigable-tabs","doneButton","nextButton","custom-tabs","tabs"])):m("",!0)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-9b0dbbde"]]))}}});

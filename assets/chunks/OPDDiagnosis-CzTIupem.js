import{d as A,ah as Y,G as Z,E as ee,ai as ae,aj as se,_ as G,I as ie,a3 as ne,R as te,bf as oe,aU as le,H as S,e as F,f as h,k as x,l as o,r as l,c as H,w as ce,a as re,m as T,O as N,J as v,u as P,Q as de,F as ue}from"./vendor-DoZkSJso.js";import{b5 as L,H as pe,af as _,b7 as me,b6 as ge,u as fe,_ as R,bU as ve,aB as he,l as _e,aC as ye,J as V,S as E,s as De,aW as be,G as Ie}from"../index-BXzz1Dug.js";import{P as Se}from"./patient_diagnosis_service-C5mVUJ0j.js";import{D as xe}from"./DashBox-CvT4UZar.js";import{l as ke}from"./lodash-NJiRuGo9.js";const we=A({name:"Menu",components:{IonContent:ne,IonHeader:ie,IonItem:G,IonList:se,IonMenu:ae,IonTitle:ee,IonToolbar:Z,List:L},computed:{...Y(fe,["patient"])},data(){return{valueNumericArray:[],obsDatetime:[],graphIcon:ge(["#006401"]),listIcon:me(["#636363"]),displayGraph:!0,orders:[],height:[],BMI:[],iconBg:{},activeWeight:[],activeHeight:[],activeBMI:[],list:[],series:[{name:"",data:[]}]}},setup(){return{checkmark:le,pulseOutline:oe}},async mounted(){const c=await _.getAll(this.patient.patientID,"Primary diagnosis"),m=await _.getAll(this.patient.patientID,"Secondary diagnosis"),u=await _.getAll(this.patient.patientID,"Attempted/ Differential diagnosis"),p=[...c||[],...m||[],...u||[]],g=ke.isEmpty(p)?[]:Promise.all(p.map(async y=>({name:await _.getConceptName(y.value_coded),obs_date:y.obs_datetime})));this.setListData(await g)},methods:{dismiss(){te.dismiss()},handleIcon(){},setActivClass(c){this.activeHeight="",this.activeBMI="",this.activeWeight="",c=="height"?this.activeHeight="_active":c=="weight"?this.activeWeight="_active":c=="BMI"&&(this.activeBMI="_active")},setListData(c){this.list=[],this.list.push({actionBtn:!1,class:"col_background",header:!0,minHeight:"--min-height: 25px;",display:["Date","Diagnosis","Notes"]}),c.forEach(m=>{this.list.push({actionBtn:!1,minHeight:"--min-height: 25px;",class:"col_background",display:[pe.toStandardHisFormat(m.obs_date),m.name,""]})})}}}),Ce={class:"modal_wrapper"};function Be(c,m,u,p,g,y){const D=S("list");return h(),F("div",Ce,[x("div",null,[o(D,{listData:c.list},null,8,["listData"])])])}const Te=R(we,[["render",Be],["__scopeId","data-v-88580898"]]),Fe={class:"custom_card",style:{padding:"10px"}},Pe={key:0},Ee={key:0,style:{color:"red","margin-top":"10px",background:"lightgoldenrodyellow"}},Oe={class:"ion-padding",slot:"content"},$e=A({__name:"OPDDiagnosis",setup(c,{expose:m}){const u=_e,p=l(!0),g=l(!1),y=l(!0),D=l(!1),k=l(!0),W=l(""),J=l(""),b=l([]),n=l([]),U=l(),w=l(null);ve();const O=H(()=>n.value.some(e=>e.data.concept_id===6542));ce(n,()=>{M()},{deep:!0});const j=H(()=>[{name:"primaryDiagnosis",header:"Primary Diagnosis",componentType:"multiSelectInputField",options:b.value,icon:u.search,onSearchChange:C,validation:he.required},{componentType:"checkboxField",label:"Secondary Diagnosis",type:"single",grid:{s:"6"},name:"secondaryDiagnosisCheckbox"},{componentType:"checkboxField",label:"Differential Diagnosis",type:"single",grid:{s:"6"},name:"differentialDiagnosisCheckbox"},{componentType:"Dashes"},{name:"secondaryDiagnosis",header:"Secondary Diagnosis",componentType:"multiSelectInputField",isMultiple:!0,options:b.value,icon:u.search,condition:e=>e==null?void 0:e.secondaryDiagnosisCheckbox,onSearchChange:C,validation:(e,a)=>$(a,"secondaryDiagnosis")},{name:"differentialDiagnosis",header:"Differential Diagnosis",componentType:"multiSelectInputField",options:b.value,icon:u.search,isMultiple:!0,condition:e=>e==null?void 0:e.differentialDiagnosisCheckbox,onSearchChange:C,validation:(e,a)=>$(a,"differentialDiagnosis")}]),$=(e,a)=>{var d,s,B;if(!e)return null;const i=(d=e.primaryDiagnosis)==null?void 0:d.name,t=((s=e.secondaryDiagnosis)==null?void 0:s.map(I=>I.name))||[],r=((B=e.differentialDiagnosis)==null?void 0:B.map(I=>I.name))||[];if(a==="secondaryDiagnosis"&&t.includes(i)||a==="differentialDiagnosis"&&r.includes(i))return"".concat(i," is already the primary diagnosis");const f=t.find(I=>r.includes(I));return f?"".concat(f," cannot be both secondary and differential"):null},q=()=>{J.value="",W.value="",p.value=!1,k.value=!1,g.value=!0},Q=async()=>{var e;((e=w.value)==null?void 0:e.validateForm())==null&&(z(),g.value=!1,D.value=!0,k.value=!0,y.value=!1)},z=()=>{var d;const e=[],a=n.value.map(s=>s.name),i=((d=w.value)==null?void 0:d.getFormValues())||{},t=i.primaryDiagnosis||[],r=i.secondaryDiagnosis||[],f=i.differentialDiagnosis||[];if(t.name&&!a.includes(t.name))if(!n.value.some(B=>B.data.concept_id===6542))e.push({actionBtn:!0,btn:["delete"],name:t.name,id:t.concept_id,display:[t.name,"Primary diagnosis"],data:{concept_id:6542,value_coded:t.concept_id,obs_datetime:E.getSessionDate()}});else return De("Only one primary diagnosis is allowed"),!1;return r&&r.forEach(s=>{a.includes(s.name)||e.push({actionBtn:!0,btn:["delete"],name:s.name,id:s.concept_id,display:[s.name,"Secondary diagnosis"],data:{concept_id:6543,value_coded:s.concept_id,obs_datetime:E.getSessionDate()}})}),f&&f.forEach(s=>{a.includes(s.name)||e.push({actionBtn:!0,btn:["delete"],name:s.name,id:s.concept_id,display:[s.name,"Differential diagnosis"],data:{concept_id:10201,value_coded:s.concept_id,obs_datetime:E.getSessionDate()}})}),e.length>0&&(n.value=[...n.value,...e]),!0},C=async e=>{const a=e.trim().toLowerCase()||"";return b.value=await Se.getDiagnosis(a,1,15),b.value},K=e=>{const a=n.value,i=e.name,t=a.filter(r=>r.display[0]!==i);n.value=t},M=()=>{n.value.length>0?(D.value=!0,p.value=!1):g.value||(p.value=!0),k.value=!O.value},X=async()=>{if(n.value.length<=0)return;const e=n.value.flatMap(i=>i.data);if(e.length<=0)return;const a=await _.addObsToEncounter(e,be.DIAGNOSIS);await _.mergeObsToPatient(a),Ie("Diagnosis saved successful"),n.value=[]};return re(async()=>{M(),await C("")}),m({onSubmit:X}),(e,a)=>{const i=S("ion-row"),t=S("ion-label"),r=S("ion-accordion"),f=S("ion-accordion-group");return h(),F(ue,null,[x("div",Fe,[o(xe,{status:p.value,content:"No Diagnosis added"},null,8,["status"]),D.value?(h(),F("span",Pe,[o(L,{listData:n.value,"onClicked:delete":K},null,8,["listData"]),O.value?(h(),F("div",Ee," In order to update the diagnosis list, please remove/delete the primary diagnosis only and then re-add or change it along with the secondary and differential diagnoses. ")):T("",!0)])):T("",!0),g.value?(h(),N(i,{key:1},{default:v(()=>{var d;return[x("div",null,[o(ye,{formData:j.value,ref_key:"formRef",ref:w},null,8,["formData"])]),x("div",null,[o(V,{fill:"clear",icon:P(u).plus,iconSlot:"icon-only","onClicked:btn":a[0]||(a[0]=s=>Q()),name:"Save",disabled:(d=w.value)==null?void 0:d.validateForm(),class:"ion-margin-top"},null,8,["icon","disabled"])])]}),_:1})):T("",!0),k.value?(h(),N(i,{key:2,style:{"margin-top":"10px"}},{default:v(()=>[o(V,{fill:"clear",icon:P(u).plus,iconSlot:"icon-only","onClicked:btn":a[1]||(a[1]=d=>q()),name:"Add new Diagnosis"},null,8,["icon"])]),_:1})):T("",!0)]),o(i,null,{default:v(()=>[o(f,{ref_key:"accordionGroup",ref:U,class:"previousView"},{default:v(()=>[o(r,{value:"first","toggle-icon-slot":"start",class:"custom_card"},{default:v(()=>[o(P(G),{slot:"header",color:"light"},{default:v(()=>[o(t,{class:"previousLabel"},{default:v(()=>[...a[2]||(a[2]=[de("Previous Diagnosis",-1)])]),_:1})]),_:1}),x("div",Oe,[o(Te)])]),_:1})]),_:1},512)]),_:1})],64)}}}),Ge=R($e,[["__scopeId","data-v-efe6cdf3"]]);export{Ge as O};

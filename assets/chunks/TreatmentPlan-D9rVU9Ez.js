import{aG as pe,_ as Z,N as ye,ck as _e,cl as De,u as be,T as Se,t as ae,ai as K,cf as Fe,S as Ve,bE as Ce,K as ie}from"../index-BPAV0PIM.js";import{d as H,r as V,bH as se,w as U,e as f,f as d,l as q,u as b,c as O,bE as oe,a as Pe,m as x,k as _,O as X,p as te,Q as ce,K as M,F as G,P as W,L as ue,bG as we,i as de,eg as ke,b9 as Te,b3 as xe,J as Q,X as Ae,bp as Ie,Z as Ne,D as Ee,b2 as qe,ap as Re,a4 as $e,a7 as ze,eS as Me}from"./vendor-BataJFSH.js";import{z as B,A as Y,B as Ue,C as Le,N as Oe}from"./NeonatalStepper-CR5leb6B.js";import{l as Be}from"./lodash-NJiRuGo9.js";import"./apexcharts-BVd6_RNM.js";import"./SaveProgressModal-BodNTIHT.js";import"./images-Zb0Yk5XL.js";import"./enrollment-DU-PLRUa.js";const Ke={class:"wrapper"},Qe=H({__name:"NonPharmacological",setup(S,{expose:C}){const s=V(null),F=B[0].formData,n=se(Y),l=()=>{var t,c,D,r,u,v,y,h,P,R,k,A,N,E,T,$,z;if(!s.value||!n)return;const e=(D=(c=(t=s.value).getFormValues)==null?void 0:c.call(t))!=null?D:{};(u=(r=n.treatments)==null?void 0:r.length)!=null&&u&&!((y=(v=e.treatments)==null?void 0:v.length)!=null&&y)&&((P=(h=s.value).setFormValue)==null||P.call(h,"treatments",[...n.treatments])),n.thermalCareDetails&&((k=(R=s.value).setFormValue)==null||k.call(R,"thermalCareDetails",[...n.thermalCareDetails])),n.incubator&&((N=(A=s.value).setFormValue)==null||N.call(A,"incubator",n.incubator)),n.feedingSupportDetails&&((T=(E=s.value).setFormValue)==null||T.call(E,"feedingSupportDetails",[...n.feedingSupportDetails])),n.admissionDetails&&((z=($=s.value).setFormValue)==null||z.call($,"admissionDetails",n.admissionDetails))},w=()=>{var t,c,D;if(!n)return;const e=(D=(c=(t=s.value)==null?void 0:t.getFormValues)==null?void 0:c.call(t))!=null?D:{};n.treatments=e.treatments||[],n.thermalCareDetails=e.thermalCareDetails||[],n.feedingSupportDetails=e.feedingSupportDetails||[],n.admissionDetails=e.admissionDetails||"",n.incubator=e.incubator||""};return U(()=>{var e,t;return(t=(e=s.value)==null?void 0:e.formValues)==null?void 0:t.value},()=>{w()},{deep:!0}),U(()=>s.value,e=>{e&&l()},{immediate:!0}),C({getFormRef:()=>s.value,validateForm:()=>{var e,t;return((t=(e=s.value)==null?void 0:e.validateForm)==null?void 0:t.call(e))||null},getFormValues:()=>{var e,t;return((t=(e=s.value)==null?void 0:e.getFormValues)==null?void 0:t.call(e))||{}}}),(e,t)=>(d(),f("div",Ke,[q(pe,{formData:b(F),ref_key:"formRef",ref:s},null,8,["formData"])]))}}),je=Z(Qe,[["__scopeId","data-v-85366be5"]]),Ge={key:0,class:"required"},He={key:1,class:"pill-list"},Je=["onClick"],We={class:"tp-section"},Xe={class:"prescription-row"},Ze={class:"prescription-name"},Ye=["onUpdate:modelValue","onChange"],ea=["value"],aa=["onUpdate:modelValue","onInput"],ta=["onClick","disabled","title"],oa={key:0,class:"field-error"},sa={key:1,class:"empty-hint"},ra={class:"search-wrapper"},na={class:"med-list"},la={key:0,class:"loader-row"},ia={key:1,class:"error-row"},ca=["onClick","disabled"],ua={key:0,slot:"end",class:"checkmark"},da={key:2,class:"loader-row"},ma=["disabled"],pa={key:4,class:"no-results"},fa=H({__name:"DrugPrescriptionField",props:{config:{},allFormValues:{},modelValue:{default:()=>[]}},emits:["update:modelValue","update:value","field-changed"],setup(S,{expose:C,emit:s}){const g=S,F=s,n=V(!1),l=O(()=>{if(typeof g.config.disabled=="boolean")return g.config.disabled;if(typeof g.config.disabled=="function")try{return g.config.disabled(g.allFormValues)}catch(a){return console.warn("[DrugPrescriptionField] Disabled function error:",a),!1}return!1}),w=O(()=>g.config.frequencies||["once a day","twice a day","three times a day","every 6 hours","every 8 hours"]),e=oe([]),t=oe({}),c=V(new Set),D=V(""),r=V("");let u=null;const v=V([]),y=V(!1),h=V(null),P=V(1),R=O(()=>g.config.pageSize||40),k=V(!0),A=()=>{n.value=!0},N=O(()=>{var o,p;if(l.value)return null;const a=ee();return((p=(o=g.config).validation)==null?void 0:p.call(o,a))||null});U(D,a=>{u&&clearTimeout(u),u=setTimeout(()=>{r.value=a.toLowerCase().trim()},250)},{immediate:!0});const E=async a=>{try{if(a!=null&&a.reset&&(P.value=1,v.value=[],k.value=!0,h.value=null),!k.value)return;y.value=!0,h.value=null;const o=await ye.getDrugs({name:r.value||"",page:P.value,page_size:R.value});let p=[];Array.isArray(o)?p=o:Array.isArray(o==null?void 0:o.results)?p=o.results:Array.isArray(o==null?void 0:o.data)?p=o.data:(console.warn("[DrugPrescriptionField] Unexpected drugs response shape:",o),p=[]),p.length<R.value&&(k.value=!1),v.value=[...v.value,...p]}catch(o){console.error(o),h.value="Failed to load medications.",k.value=!1}finally{y.value=!1}};Pe(()=>{E({reset:!0})}),U(r,()=>{E({reset:!0})});const T=O(()=>k.value&&!h.value),$=()=>{!k.value||y.value||(P.value+=1,E())},z=a=>e.some(o=>o.name===a),J=a=>{t[a]&&delete t[a]};let L=null;const i=()=>{const a=ee();L=a,F("update:modelValue",a),F("update:value",a),F("field-changed",{fieldName:g.config.name||g.config.header||"",value:a,config:g.config})},fe=a=>{if(l.value)return;if(A(),e.findIndex(p=>p.name===a.name)>=0){re(a.name);return}e.push({name:a.name,frequency:w.value[0]||"once a day",dosage:"",drug_id:String(a.drug_id),isAdded:!1})},re=a=>{const o=e.findIndex(p=>p.name===a);if(o>=0&&e.splice(o,1),J(a),c.value.has(a)){const p=new Set(c.value);p.delete(a),c.value=p}i()},ge=a=>{A(),J(a),ne(a)},ne=a=>{if(!c.value.has(a))return;const o=e.find(p=>p.name===a);o&&(o.isAdded=!0,i())},he=a=>{var j;if(A(),!((j=a.dosage)!=null?j:"").toString().trim()){t[a.name]="Dosage is required.";return}if(!a.drug_id){t[a.name]="Drug ID not found for this medication.";return}a.isAdded=!0;const p=new Set(c.value);p.add(a.name),c.value=p,J(a.name),i()},ee=()=>e.filter(a=>a.isAdded).map(a=>({name:a.name,frequency:a.frequency,dosage:a.dosage,drug_id:a.drug_id})),le=(a=[])=>{e.splice(0,e.length),a.forEach(o=>{e.push({name:o.name,frequency:o.frequency||w.value[0]||"once a day",dosage:o.dosage||"",drug_id:o.drug_id||"",isAdded:!0})}),c.value=new Set(a.map(o=>o.name)),Object.keys(t).forEach(o=>delete t[o])},ve=a=>{const o=Array.isArray(a)?a:[];L=null,le(o)};return U(()=>g.modelValue,a=>{if(L&&a===L){L=null;return}le(Array.isArray(a)?a:[])},{immediate:!0,deep:!0}),C({getValue:ee,setValue:ve,validate:()=>l.value?null:(n.value=!0,N.value),shouldShow:O(()=>!0),markAsTouched:()=>{n.value=!0},resetTouched:()=>{n.value=!1},clearError:()=>{n.value=!1}}),(a,o)=>{var p,j;return d(),f("div",null,[S.config.header?(d(),f("h6",{key:0,class:te([{"is-bold":S.config.bold},"header"])},[ce(M(S.config.header)+" ",1),((j=(p=S.config).validation)==null?void 0:j.call(p,[]))!=null?(d(),f("span",Ge,"*")):x("",!0)],2)):x("",!0),e.length?(d(),f("div",He,[(d(!0),f(G,null,W(e,m=>(d(),f("div",{key:m.name,class:"pill"},[_("span",null,M(m.name),1),_("button",{class:"pill-remove",type:"button",onClick:I=>re(m.name),"aria-label":"Remove medication"},[q(b(ue),{icon:b(we),class:"remove-icon"},null,8,["icon"])],8,Je)]))),128))])):x("",!0),_("div",We,[o[2]||(o[2]=_("h3",{class:"tp-section-title"},"Prescription Details",-1)),e.length?(d(),f(G,{key:0},[o[1]||(o[1]=_("div",{class:"prescription-header"},[_("span",null,"Name"),_("span",null,"Frequency"),_("span",null,"Dosage"),_("span")],-1)),(d(!0),f(G,null,W(e,m=>(d(),f("div",{key:m.name,class:"prescription-row-wrap"},[_("div",Xe,[_("span",Ze,M(m.name),1),de(_("select",{"onUpdate:modelValue":I=>m.frequency=I,class:"prescription-select",onChange:I=>ne(m.name)},[(d(!0),f(G,null,W(w.value,I=>(d(),f("option",{key:I,value:I},M(I),9,ea))),128))],40,Ye),[[ke,m.frequency]]),de(_("input",{"onUpdate:modelValue":I=>m.dosage=I,type:"text",class:te(["prescription-input",{"input-error":!!t[m.name]}]),placeholder:"e.g. 40mg",onInput:I=>ge(m.name)},null,42,aa),[[Te,m.dosage]]),_("button",{class:"prescription-add",type:"button",onClick:I=>he(m),disabled:c.value.has(m.name),title:c.value.has(m.name)?"Added":"Add prescription"},M(c.value.has(m.name)?"✓":"+"),9,ta)]),t[m.name]?(d(),f("div",oa,M(t[m.name]),1)):x("",!0)]))),128))],64)):(d(),f("div",sa,"Select a medication to add prescription details."))]),_("div",ra,[q(b(xe),{modelValue:D.value,"onUpdate:modelValue":o[0]||(o[0]=m=>D.value=m),placeholder:S.config.placeholder||"Search",type:"text",class:"search-input",onIonFocus:A,onClick:A,fill:"outline",disabled:l.value},{default:Q(()=>[q(b(Ae),{slot:"start",class:"start-content"},{default:Q(()=>[q(b(ue),{icon:b(Ie),class:"search-icon"},null,8,["icon"])]),_:1})]),_:1},8,["modelValue","placeholder","disabled"])]),_("div",na,[y.value&&!v.value.length?(d(),f("div",la,"Loading medications...")):x("",!0),h.value?(d(),f("div",ia,M(h.value),1)):x("",!0),(d(!0),f(G,null,W(v.value,m=>(d(),f("button",{key:m.drug_id,type:"button",class:te(["med-list-item",{"med-list-item--selected":z(m.name)}]),onClick:I=>fe(m),disabled:l.value},[_("span",null,M(m.name),1),z(m.name)?(d(),f("span",ua,"✔")):x("",!0)],10,ca))),128)),y.value&&v.value.length?(d(),f("div",da,"Loading more...")):x("",!0),T.value&&!y.value?(d(),f("button",{key:3,type:"button",class:"med-list-more",onClick:$,disabled:l.value}," Show more… ",8,ma)):x("",!0),!y.value&&!v.value.length&&!h.value?(d(),f("div",pa,"No medications found.")):x("",!0)]),N.value&&n.value?(d(),X(b(Ne),{key:2,class:"error-note"},{default:Q(()=>[ce(M(N.value),1)]),_:1})):x("",!0)])}}}),ga=Z(fa,[["__scopeId","data-v-9e350060"]]),ha={class:"treatment-plan-section-wrapper"},va=H({__name:"Pharmacological",setup(S,{expose:C}){const s=V(null),F=B[2].formData,n=se(Y),l=e=>{n&&(n.prescriptions=e.prescriptions||[])},w=()=>{var t,c,D,r,u,v,y,h,P;if(!s.value||!n)return;const e=(D=(c=(t=s.value).getFormValues)==null?void 0:c.call(t))!=null?D:{};(u=(r=n.prescriptions)==null?void 0:r.length)!=null&&u&&!((y=(v=e.prescriptions)==null?void 0:v.length)!=null&&y)&&((P=(h=s.value).setFormValue)==null||P.call(h,"prescriptions",[...n.prescriptions]))};return U(()=>{var e,t;return(t=(e=s.value)==null?void 0:e.formValues)==null?void 0:t.value},e=>{e&&l(e)},{deep:!0}),U(()=>s.value,e=>{var t,c;e&&(w(),l((c=(t=e.getFormValues)==null?void 0:t.call(e))!=null?c:{}))},{immediate:!0}),C({getFormRef:()=>s.value,validateForm:()=>{var e,t;return((t=(e=s.value)==null?void 0:e.validateForm)==null?void 0:t.call(e))||null},getFormValues:()=>{var e,t;return((t=(e=s.value)==null?void 0:e.getFormValues)==null?void 0:t.call(e))||{}}}),(e,t)=>(d(),f("div",ha,[q(pe,{formData:b(F),ref_key:"formRef",ref:s},{prescriptions:Q(({formValues:c,updateValue:D})=>[q(ga,{config:b(Ue),allFormValues:c,modelValue:c.prescriptions||[],"onUpdate:modelValue":r=>D("prescriptions",r)},null,8,["config","allFormValues","modelValue","onUpdate:modelValue"])]),_:1},8,["formData"])]))}}),me=Z(va,[["__scopeId","data-v-452decb0"]]),ya={class:"summary-container"},_a=H({__name:"NonPharmacologicalSummary",setup(S,{expose:C}){const s=se(Y),g=B[1],F=O(()=>g.formData.find(l=>l.componentType==="Alert")),n=O(()=>g.formData.find(l=>l.componentType==="summaryField"));return C({getFormRef:()=>null,validateForm:()=>null,getFormValues:()=>({...s||{}})}),(l,w)=>(d(),f("div",ya,[F.value?(d(),X(_e,{key:0,config:F.value,allFormValues:b(s)||{}},null,8,["config","allFormValues"])):x("",!0),n.value?(d(),X(De,{key:1,config:n.value,allFormValues:b(s)||{}},null,8,["config","allFormValues"])):x("",!0)]))}}),Da=Z(_a,[["__scopeId","data-v-6a82d4ab"]]),ba=Ee("treatmentPlan",()=>{const S=V({incubator:"",treatments:[],thermalCareDetails:[],oxygenTherapyDetails:[],feedingSupportDetails:[],admissionDetails:""}),C=V({prescription:[]});function s(t){S.value=t}function g(t,c){S.value[t]=c}function F(){S.value={incubator:"",treatments:[],thermalCareDetails:[],oxygenTherapyDetails:[],feedingSupportDetails:[],admissionDetails:""}}function n(t){C.value.prescription.push(t)}function l(t){C.value.prescription.splice(t,1)}function w(){C.value.prescription=[]}function e(){F(),w()}return{pharmacological:S,nonPharmacological:C,setPharmacological:s,updatePharmacologicalField:g,resetPharmacological:F,addPrescription:n,removePrescription:l,resetNonPharmacological:w,resetTreatmentPlan:e}}),xa=H({__name:"TreatmentPlan",setup(S){const C=V("1"),s=ba(),g=be(),{patient:F}=qe(g),n=Re(),l=oe({...Le,treatments:[...s.pharmacological.treatments],thermalCareDetails:s.pharmacological.thermalCareDetails,oxygenTherapyDetails:s.pharmacological.oxygenTherapyDetails,feedingSupportDetails:s.pharmacological.feedingSupportDetails,admissionDetails:s.pharmacological.admissionDetails,incubator:s.pharmacological.incubator,prescriptions:s.nonPharmacological.prescription});Me(Y,l),U(()=>({treatments:l.treatments,thermalCareDetails:l.thermalCareDetails,oxygenTherapyDetails:l.oxygenTherapyDetails,feedingSupportDetails:l.feedingSupportDetails,admissionDetails:l.admissionDetails,incubator:l.incubator}),r=>{s.setPharmacological({incubator:r.incubator||"",treatments:Array.isArray(r.treatments)?r.treatments:[],thermalCareDetails:Array.isArray(r.thermalCareDetails)?r.thermalCareDetails:[],oxygenTherapyDetails:Array.isArray(r.oxygenTherapyDetails)?r.oxygenTherapyDetails:[],feedingSupportDetails:Array.isArray(r.feedingSupportDetails)?r.feedingSupportDetails:[],admissionDetails:r.admissionDetails||""})},{deep:!0}),U(()=>l.prescriptions,r=>{s.nonPharmacological.prescription=r||[]},{deep:!0});const w=[je,Da,me],e=B.map((r,u)=>({title:r.title,subtitle:r.subtitle,value:String(u+1),component:w[u]||me,configIndex:u})),t=V(B.map((r,u)=>({title:r.title,number:u+1,checked:!1,class:u===0?"open_step common_step":"common_step",last_step:u===B.length-1?"last_step":""}))),c=r=>{r&&r.value&&t.value.forEach((u,v)=>{r.value===(v+1).toString()?(u.class="open_step common_step",u.checked=!1):v<parseInt(r.value)-1?(u.class="common_step color_white",u.checked=!0):(u.class="common_step",u.checked=!1)})},D=async r=>{var u,v;if(r!==0&&r===e.length-1)try{const y=(u=F.value)==null?void 0:u.patientID;if(!y){ae("Patient ID is missing. Cannot save treatment plan.");return}const h=i=>typeof i=="string"&&i.trim().length>0,P=i=>Array.isArray(i)&&i.length>0,R=l.treatments,k=l.thermalCareDetails,A=l.oxygenTherapyDetails,N=l.feedingSupportDetails,E=l.admissionDetails;console.log({treatments:R,thermalCareDetails:k,oxygenTherapyDetails:A,feedingSupportDetails:N,admissionDetails:E});const T=[];if(h(l.incubator)&&T.push(await K.buildValueText("notes",l.incubator.trim())),P(k))for(const i of k)h(i)&&T.push(await K.buildValueCoded("thermal care",i.trim()));if(P(A))for(const i of A)h(i)&&T.push(await K.buildValueCoded("Oxygen Therapy (Supportive, Non-Drug)",i.trim()));if(P(N))for(const i of N)h(i)&&T.push(await K.buildValueCoded("feeding support",i.trim()));if(h(E)&&T.push(await K.buildValueCoded("admission",E.trim())),P(R))for(const i of R)h(i)&&T.push(await K.buildValueText("treatment",i.trim()));if(T.length===0){ae("No treatment details selected to save.");return}const $=await Fe(y,25,T);let z;$&&Be.isArray($)&&$.length>0&&(z=$[0].encounter_id);const L=(((v=s.nonPharmacological)==null?void 0:v.prescription)||[]).filter(i=>i&&i.drug_id&&i.name).map(i=>({dose:Number(i.dosage),frequency:i.frequency,drug:i.name,start_date:Ve.getSessionDate(),auto_expire_date:"",drug_inventory_id:Number(i.drug_id),equivalent_daily_dose:6,units:"",instructions:""}));z&&L.length>0&&await Ce.create({encounter_id:z,drug_orders:L}),ie("Treatment plan saved successfully."),await new Promise(i=>setTimeout(i,800)),ie("Treatment plan saved successfully."),await new Promise(i=>setTimeout(i,800)),n.push({path:"/neonatal/checkpoint"})}catch(y){ae("Error saving treatment plan. Please try again.")}};return(r,u)=>(d(),X(b(ze),{class:"neonatal-enrollment-page"},{default:Q(()=>[q(Se),q(b($e),{fullscreen:!0},{default:Q(()=>[q(Oe,{wizardData:t.value,StepperData:b(e),stepperTitle:"Treatment Plan",openStepper:C.value,backUrl:"/patientProfile",getSaveFunction:D,onUpdateStatus:c,"flow-type":"treatmentPlan","show-componet-title":!0,sectionsConfig:b(B)},null,8,["wizardData","StepperData","openStepper","sectionsConfig"])]),_:1})]),_:1}))}});export{xa as default};

System.register(["./vendor-legacy-BV-WGgzk.js","../index-legacy-DsbY9ARX.js","./ImmunizationGroupGraph-legacy-Culzyt-K.js","./StockStore-legacy-DtoMLiDO.js","./BasicForm-legacy-BgBljros.js","./customDatePicker-legacy-CKU3mlk7.js","./group_validation-legacy-DD3q4VXD.js","./stock_service-legacy-CjK47xl3.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-CgZ9vWXi.js","./DateInputField-legacy-Cu3mSvmb.js"],function(t,e){"use strict";var a,n,i,o,s,d,c,l,r,u,p,h,m,g,f,x,b,v,y,w,k,_,D,S,B,I,C,z,T,P,M,j,q,N,V,F,A,E,H,L,O,U,R,G,$,Q,W,K,Y,J,Z,X,tt,et,at,nt,it,ot,st,dt,ct,lt,rt,ut,pt,ht,mt,gt,ft,xt,bt,vt,yt,wt,kt,_t,Dt,St,Bt;return{setters:[t=>{a=t.d,n=t.ah,i=t.b1,o=t.G,s=t.E,d=t.ai,c=t.aj,l=t._,r=t.I,u=t.a3,p=t.R,h=t.am,m=t.be,g=t.aS,f=t.H,x=t.e,b=t.f,v=t.l,y=t.J,w=t.Q,k=t.K,_=t.k,D=t.F,S=t.D,B=t.b4,I=t.N,C=t.dt,z=t.du,T=t.dv,P=t.L,M=t.bp,j=t.a5,q=t.a4,N=t.a6,V=t.cn,F=t.r,A=t.cZ,E=t.c_,H=t.cd,L=t.c$,O=t.d0,U=t.d1,R=t.d2,G=t.d3,$=t.d4,Q=t.d5,W=t.bL,K=t.O,Y=t.m,J=t.P,Z=t.p},t=>{X=t.J,tt=t.j,et=t.B,at=t.K,nt=t.M,it=t.N,ot=t.H,st=t.t,dt=t.G,ct=t.v,lt=t.u,rt=t.l,ut=t._,pt=t.Q,ht=t.T,mt=t.c,gt=t.m,ft=t.o,xt=t.V,bt=t.e},t=>{vt=t.I,yt=t.a},t=>{wt=t.u},t=>{kt=t.B},t=>{_t=t.c},t=>{Dt=t.v},t=>{St=t.S},t=>{Bt=t.l},null,null],execute:function(){var e=O.createElement("style");e.textContent=".OtherVitalsTitle[data-v-88dde239]{font-style:normal;font-weight:600;font-size:20px;color:#00190e}.drug_container[data-v-8ab089ec]{justify-content:center;flex-wrap:wrap;gap:30px;margin:20px}ion-row[data-v-8ab089ec]{line-height:10px}.content[data-v-8ab089ec]{font-size:14px;color:#939393}.contentBold[data-v-8ab089ec]{font-weight:700;font-size:14px;color:gray;line-height:16px}.container[data-v-8ab089ec]{display:block;align-content:center;align-items:center}.drug_content[data-v-8ab089ec]{padding-bottom:10px;margin-bottom:10px;border-bottom:1px solid #f2f2f2;position:relative;overflow:hidden}.watermark[data-v-8ab089ec]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-45deg);font-size:4em;color:rgba(255,110,110,.2);white-space:nowrap;pointer-events:none;z-index:0}.bigGroupButton[data-v-8ab089ec]{margin-top:10px}#container[data-v-8ab089ec]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container strong[data-v-8ab089ec]{font-size:20px;line-height:26px}#container p[data-v-8ab089ec]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container a[data-v-8ab089ec]{text-decoration:none}.centered-content[data-v-8ab089ec]{display:flex;justify-content:center;align-items:center}.graphBackground[data-v-8ab089ec]{position:absolute;width:100vw;height:62vh;left:0;top:23vh;background:linear-gradient(158.66deg,#d6d5d6 .36%,#f8f8f8 40.1%);border-radius:22px}.total[data-v-8ab089ec]{position:absolute;width:251px;height:128px;top:25px;left:50%;transform:translate(-50%,10%);text-align:center;background:rgba(237,235,238,.95);opacity:.8;border-radius:6px}.totalNumber[data-v-8ab089ec]{height:77px;font-style:normal;font-weight:700;font-size:60px;line-height:77px;color:#5d5d5d}.totalText[data-v-8ab089ec]{width:229px;height:48px;font-style:normal;font-weight:700;font-size:15px;line-height:150%;display:flex;align-items:center;text-align:center;color:#08475e}.dueMiss[data-v-8ab089ec]{display:flex;justify-content:space-around;margin-top:10px}.missed[data-v-8ab089ec],.due[data-v-8ab089ec]{width:187px;height:90px;left:14px;background:#fff;border-radius:6px;text-align:center}.dueMissText[data-v-8ab089ec]{font-style:normal;font-weight:700;font-size:14px;line-height:17px;display:flex;align-items:center;text-align:center;padding:7px;color:#004d4d}.dueNumber[data-v-8ab089ec]{font-style:normal;font-weight:700;font-size:36px;line-height:30px;margin-top:10px;color:#016302}.missedNumber[data-v-8ab089ec]{font-style:normal;font-weight:700;font-size:36px;line-height:30px;margin-top:10px;color:#b42318}.clientSeen[data-v-8ab089ec]{height:120px;margin-top:15px;background:#fff}.clientSeenTitle[data-v-8ab089ec]{padding-top:10px;margin-left:10px;font-style:normal;font-weight:400;font-size:16px;color:#2d3648}.clientSeenBoxChild[data-v-8ab089ec]{background:#2d3648!important}.clientSeenBoxMen[data-v-8ab089ec]{background:#004d4d!important}.clientSeenBoxWomen[data-v-8ab089ec]{background:#556080!important}.clientSeenBox[data-v-8ab089ec]{width:68px;height:68px;background:#006401;border-radius:7px;padding-top:8px}.clientSeenBoxes[data-v-8ab089ec]{display:flex;justify-content:space-around;margin-top:10px}.clientSeenBoxText[data-v-8ab089ec]{font-style:normal;font-weight:400;font-size:14px;line-height:150%;align-items:center;text-align:center;color:#fff}.clientSeenBoxNumber[data-v-8ab089ec]{font-style:normal;font-weight:700;font-size:24px;line-height:29px;text-align:center;color:#fff}.graphCard[data-v-8ab089ec]{width:98vw;margin:10px auto 0}.modal_wrapper[data-v-8ab089ec]{border-radius:8px}.bigButton[data-v-8ab089ec]{font-weight:500;height:180px}.centerBigBtnContain[data-v-8ab089ec]{align-items:center;align-content:center}.bigBtnHeader[data-v-8ab089ec]{font-weight:700;font-size:20px;margin-bottom:10px}ion-button[data-v-8ab089ec]{margin-right:10px}.addBtn[data-v-8ab089ec]{height:50px;align-items:center}.example-one .pagination-container{column-gap:10px}.example-one .paginate-buttons{height:40px;width:40px;border-radius:20px;cursor:pointer;background-color:#f2f2f2;border:1px solid rgb(217,217,217);color:#000}.example-one .paginate-buttons:hover{background-color:#d8d8d8}.example-one .active-page{background-color:#3498db;border:1px solid #3498db;color:#fff}.example-one .active-page:hover{background-color:#2988c8}.example-one .back-button:active,.example-one .next-button:active{background-color:#c4c4c4}.drug_container[data-v-95dfeb9e]{justify-content:center;flex-wrap:wrap;gap:30px;margin:20px}ion-row[data-v-95dfeb9e]{line-height:10px}.content[data-v-95dfeb9e]{font-size:14px;color:#939393}.contentBold[data-v-95dfeb9e]{font-weight:700;font-size:14px;color:gray;line-height:16px}.container[data-v-95dfeb9e]{display:block;align-content:center;align-items:center;max-width:500px}.drug_content[data-v-95dfeb9e]{padding-bottom:10px;margin-bottom:10px;border-bottom:1px solid #f2f2f2}.bigGroupButton[data-v-95dfeb9e]{margin-top:10px}#container[data-v-95dfeb9e]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container strong[data-v-95dfeb9e]{font-size:20px;line-height:26px}#container p[data-v-95dfeb9e]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container a[data-v-95dfeb9e]{text-decoration:none}.centered-content[data-v-95dfeb9e]{display:flex;justify-content:center;align-items:center}.graphBackground[data-v-95dfeb9e]{position:absolute;width:100vw;height:62vh;left:0;top:23vh;background:linear-gradient(158.66deg,#d6d5d6 .36%,#f8f8f8 40.1%);border-radius:22px}.total[data-v-95dfeb9e]{position:absolute;width:251px;height:128px;top:25px;left:50%;transform:translate(-50%,10%);text-align:center;background:rgba(237,235,238,.95);opacity:.8;border-radius:6px}.totalNumber[data-v-95dfeb9e]{height:77px;font-style:normal;font-weight:700;font-size:60px;line-height:77px;color:#5d5d5d}.totalText[data-v-95dfeb9e]{width:229px;height:48px;font-style:normal;font-weight:700;font-size:15px;line-height:150%;display:flex;align-items:center;text-align:center;color:#08475e}.dueMiss[data-v-95dfeb9e]{display:flex;justify-content:space-around;margin-top:10px}.missed[data-v-95dfeb9e],.due[data-v-95dfeb9e]{width:187px;height:90px;left:14px;background:#fff;border-radius:6px;text-align:center}.dueMissText[data-v-95dfeb9e]{font-style:normal;font-weight:700;font-size:14px;line-height:17px;display:flex;align-items:center;text-align:center;padding:7px;color:#004d4d}.dueNumber[data-v-95dfeb9e]{font-style:normal;font-weight:700;font-size:36px;line-height:30px;margin-top:10px;color:#016302}.missedNumber[data-v-95dfeb9e]{font-style:normal;font-weight:700;font-size:36px;line-height:30px;margin-top:10px;color:#b42318}.clientSeen[data-v-95dfeb9e]{height:120px;margin-top:15px;background:#fff}.clientSeenTitle[data-v-95dfeb9e]{padding-top:10px;margin-left:10px;font-style:normal;font-weight:400;font-size:16px;color:#2d3648}.clientSeenBoxChild[data-v-95dfeb9e]{background:#2d3648!important}.clientSeenBoxMen[data-v-95dfeb9e]{background:#004d4d!important}.clientSeenBoxWomen[data-v-95dfeb9e]{background:#556080!important}.clientSeenBox[data-v-95dfeb9e]{width:68px;height:68px;background:#006401;border-radius:7px;padding-top:8px}.clientSeenBoxes[data-v-95dfeb9e]{display:flex;justify-content:space-around;margin-top:10px}.clientSeenBoxText[data-v-95dfeb9e]{font-style:normal;font-weight:400;font-size:14px;line-height:150%;align-items:center;text-align:center;color:#fff}.clientSeenBoxNumber[data-v-95dfeb9e]{font-style:normal;font-weight:700;font-size:24px;line-height:29px;text-align:center;color:#fff}.graphCard[data-v-95dfeb9e]{width:98vw;margin:10px auto 0}.modal_wrapper[data-v-95dfeb9e]{border-radius:8px}.bigButton[data-v-95dfeb9e]{font-weight:500;height:180px}.centerBigBtnContain[data-v-95dfeb9e]{align-items:center;align-content:center}.bigBtnHeader[data-v-95dfeb9e]{font-weight:700;font-size:20px;margin-bottom:10px}ion-button[data-v-95dfeb9e]{margin-right:10px}.addBtn[data-v-95dfeb9e]{height:50px;align-items:center}\n/*$vite$:1*/",O.head.appendChild(e);const It=a({components:{IonContent:u,IonHeader:r,IonItem:l,IonList:c,IonMenu:d,IonTitle:s,IonToolbar:o,IonInput:i,BasicInputField:et,BasicForm:kt,PreviousVitals:tt,customDatePicker:_t,DynamicButton:X},data:()=>({iconsContent:rt,BMI:{},BPStatus:{},vValidations:"",title:"",relationships:"",hasValidationErrors:[],vitalsInstance:{},validationStatus:{heightWeight:!1,bloodPressure:!1},showPD:!1,stockService:{}}),computed:{...n(lt,["patient"]),...n(wt,["stock"])},props:{data:{default:{}}},created(){this.stockService=new St},async mounted(){this.resetData(),this.data?(this.modifyFieldValue(),this.title="Edit Stock"):this.title="Add Stock",await this.getDrugs()},setup:()=>({checkmark:g,pulseOutline:m}),methods:{modifyFieldValue(){nt(this.stock,"product name","value",{id:"",name:this.data.drug_legacy_name}),nt(this.stock,"batch","value",this.data.batch_number),nt(this.stock,"manufacture","value",this.data.manufacture),nt(this.stock,"doses_wasted","value",this.data.doses_wasted),nt(this.stock,"expire date","value",this.data.expiry_date),nt(this.stock,"quantity","value",this.data.delivered_quantity),nt(this.stock,"delivery_date","value",this.data.delivery_date),nt(this.stock,"product name","disabled","true"),nt(this.stock,"batch","disabled","true"),nt(this.stock,"manufacture","disabled","true"),nt(this.stock,"expire date","disabled","true"),nt(this.stock,"quantity","disabled","true"),nt(this.stock,"delivery_date","disabled","true")},async handleBatch(){this.data?await this.updateBatch():await this.createBatch(),ct().postData("SYNC_STOCK_RECORD")},async createBatch(){if(!Dt(this.stock))return st("Batch not save"),!1;{const t=it(this.stock,"product name","value").drug_id,e=[{batch_number:it(this.stock,"batch","value"),location_id:"",vvm_stage:"",items:[{barcode:"",drug_id:t,expiry_date:it(this.stock,"expire date","value"),manufacture:it(this.stock,"manufacture","value"),quantity:it(this.stock,"quantity","value"),delivery_date:it(this.stock,"delivery_date","value")||ot.sessionDate(),product_code:"",pack_size:""}]}],a=await this.stockService.postItems(e);await this.handleWaste(a[0].items[0].id),dt("Batch save successfully"),p.dismiss("dismiss")}},async updateBatch(){const t=parseInt(it(this.stock,"doses_wasted","value")),e=parseInt(it(this.stock,"quantity","value"));if(this.data.current_quantity,e<this.data.dispensed_quantity+this.data.doses_wasted+t)return st("Quantity delivered can not be greater than quantity wasted and dispensed"),!1;if(!Dt(this.stock))return st("Batch not save"),!1;{const e={doses_wasted:t,drug_id:it(this.stock,"product name","value").drug_id,reallocation_code:"MA20",waste_reason:"Something wrong with the drug",date:ot.sessionDate(),reason:"Mistake Entirely"};try{await this.stockService.updateItem(this.data.id,e),dt("Batch save successfully"),p.dismiss("dismiss")}catch(a){st(a)}}},async handleWaste(t){const e=it(this.stock,"doses_wasted","value");if(e){const a={reallocation_code:"MA20",quantity:e,date:ot.sessionDate(),reason:"Something wrong with the drug"};await this.stockService.disposeItems(t,a)}},navigationMenu(t){h.close(),this.$router.push(t)},resetData(){const t=wt();t.setStock(t.getInitialStock())},async getDrugs(t=""){const e=await at.getDrugs({name:t,page:1,page_size:10,concept_set:"Immunizations"});nt(this.stock,"product name","multiSelectData",e)},async handleInputData(t){"Product Name *"==t.inputHeader&&await this.getDrugs("")},dismiss(){p.dismiss()}}}),Ct={class:"modal_wrapper"},zt={class:"ion-padding",slot:"content",style:{"padding-bottom":"200px"}},Tt=ut(It,[["render",function(t,e,a,n,i,o){const s=f("ion-title"),d=f("ion-icon"),c=f("ion-header"),l=f("basic-form"),r=f("ion-content"),u=f("DynamicButton"),p=f("ion-col"),h=f("ion-row"),m=f("ion-footer");return b(),x(D,null,[v(c,{style:{display:"flex","justify-content":"space-between"}},{default:y(()=>[v(s,{class:"modalTitle"},{default:y(()=>[w(k(t.title),1)]),_:1}),v(d,{onClick:e[0]||(e[0]=e=>t.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:t.iconsContent.cancel},null,8,["icon"])]),_:1}),v(r,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:y(()=>[_("div",Ct,[_("div",zt,[_("div",null,[v(l,{contentData:t.stock,"onUpdate:inputValue":t.handleInputData,onSearchChange:t.getDrugs},null,8,["contentData","onUpdate:inputValue","onSearchChange"])])])])]),_:1}),v(m,{collapse:"fade",class:"ion-no-border"},{default:y(()=>[v(h,null,{default:y(()=>[v(p,null,{default:y(()=>[v(u,{onClick:e[1]||(e[1]=e=>t.handleBatch()),name:"Save",fill:"solid",style:{float:"right",margin:"2%",width:"130px"}})]),_:1})]),_:1})]),_:1})],64)}],["__scopeId","data-v-88dde239"]]),Pt=[{data:{rowData:[{colData:[{inputHeader:"Search",icon:rt.search,value:"",name:"search",eventType:"input",alertsErrorMassage:"",selectedID:""}]}]}}],Mt=S("searchName",{state:()=>({searchName:[...Pt]}),actions:{setsearchName(t){this.searchName=t},getInitialName:()=>[...Bt.cloneDeep(Pt)]}}),jt=[{data:{rowData:[{colData:[{inputHeader:"Quantity*",icon:rt.weight,valueType:"number",value:"",name:"quantity",eventType:"input",alertsErrorMassage:"",required:!0,validationFunctionName:"isNumber"}]}]}},{data:{rowData:[{colData:[{inputHeader:"Reason *",icon:rt.search,valueType:"text",isSingleSelect:!0,popOver:!0,value:"",name:"reason",validationFunctionName:"required",trackBy:"id",multiSelectData:[],eventType:"input",required:!0,alertsErrorMassage:"",id:""}]}]}}],qt=S("stockDiscard",{state:()=>({stockDiscard:[...jt]}),actions:{setStockDiscard(t){this.stockDiscard=t},getInitialStockDiscard:()=>[...Bt.cloneDeep(jt)]},persist:!0}),Nt=a({name:"StockManagementModal",mixins:[mt],components:{IonContent:u,IonHeader:r,IonMenuButton:V,IonPage:N,IonTitle:s,IonToolbar:o,Toolbar:ht,ToolbarSearch:pt,IonRow:q,IonCol:j,ImmunizationTrendsGraph:yt,ImmunizationGroupGraph:vt,IonCard:M,DynamicButton:X,BasicForm:kt,IonIcon:P,IonFab:T,IonFabButton:z,IonFabList:C,IonButton:I,IonPopover:B},data:()=>({iconsContent:rt,reportData:[],currentStock:[],stockData:[],allStock:[],outStock:[],filter:"",startDate:ot.sessionDate(),endDate:ot.sessionDate(),options:{responsive:!0,select:!0},selectedButton:"all",isLoading:!1,popoverOpen:!1,popoverName:"",event:null,stockService:{},disabled:!1,totalPages:0}),setup:()=>({currentPage:F(1),chevronBackOutline:W,checkmark:g,grid:Q,chevronDownCircle:$,chevronForwardCircle:G,chevronUpCircle:R,colorPalette:U,document:O,globe:L,medkit:H,add:E,person:A}),created(){this.stockService=new St},props:{data:{default:{}}},computed:{...n(wt,["stock"]),...n(Mt,["searchName"]),...n(qt,["stockDiscard"]),...n(bt,["apiStatus"])},$route:{async handler(){await this.buildTableData()},deep:!0},watch:{stock:{async handler(){},deep:!0}},async mounted(){await this.buildTableData()},methods:{checkExpired(t){const e=new Date(t.expiry_date);return!(new Date(ot.sessionDate())>=e)},async updateBatch(){const t=parseInt(it(this.stockDiscard,"quantity","value")),e=it(this.stockDiscard,"reason","value").name,a=parseInt(this.stockData.delivered_quantity);if(this.stockData.current_quantity,a<this.stockData.dispensed_quantity+this.stockData.doses_wasted+t)return st("Quantity delivered can not be greater than quantity wasted and dispensed"),!1;if(!Dt(this.stockDiscard))return st("Failing to discard"),!1;{const a={doses_wasted:t,drug_id:this.stockData.drug_id,reallocation_code:"MA20",waste_reason:e,date:ot.sessionDate(),reason:e};try{await this.stockService.updateItem(this.stockData.id,a),dt("Discard successfully"),await this.buildTableData(),this.closePopover()}catch(n){st(n)}}},async adjustStock(){let t=parseInt(it(this.stockDiscard,"quantity","value")),e=it(this.stockDiscard,"reason","value").name;if("Negative Adjustment"==e||"Negative Mathematical Error"==e){if(t>this.stockData.current_quantity)return st("Quantity Available can not be greater than adjustment quantity"),!1;t=-t}if(!Dt(this.stockDiscard))return st("Failing to adjust"),!1;{const n={adjust_stock:t,drug_id:this.stockData.drug_id,reallocation_code:"MA20",waste_reason:e,date:ot.sessionDate(),reason:e};try{await this.stockService.updateItem(this.stockData.id,n),dt("Adjust successfully"),await this.buildTableData(),this.closePopover()}catch(a){st(a)}}},whichPopover(t,e,a){this.popoverName=a,qt().setStockDiscard(qt().getInitialStockDiscard()),nt(this.stockDiscard,"reason","multiSelectData","adjust"==a?[{id:1,name:"Positive Adjustment"},{id:2,name:"Negative Adjustment"},{id:3,name:"Negative Mathematical Error"},{id:4,name:"Positive Mathematical Error"}]:[{id:1,name:"VVM stage > 2"},{id:2,name:"Frozen"},{id:3,name:"Damage"},{id:4,name:"Wastage"}]),this.openPopover(t,e)},openPopover(t,e){this.stockData=e,this.event=t,this.popoverOpen=!0},closePopover(){this.event=null,this.popoverOpen=!1},dismiss(){p.dismiss("dismiss")},async onClickHandler(t){await this.buildTableData(t)},formatDate:t=>ot.toStandardHisDisplayFormat(t),async handleInputData(t){"Search"==t.inputHeader&&(this.filter=t.value,await this.buildTableData())},async voidStock(t,e){if(await xt(`Do you want to void "${e.drug_legacy_name}", batch: ${e.batch_number} ?`,t,{confirmBtnLabel:"Void"})){const t=new St;await t.deleteItem(e.id,{reason:"voided"}),await this.buildTableData()}},async buildTableData(t=1){this.isLoading=!0,ct().postData("SYNC_STOCK_RECORD");try{if(this.apiStatus){var e,a;const n=new St;this.reportData={records:await n.getItems({start_date:"2000-01-01",end_date:this.endDate,drug_name:this.data.drug_legacy_name,page:t,page_size:4})},null!==(e=this.reportData)&&void 0!==e&&e.records&&(this.totalPages=null===(a=this.reportData)||void 0===a||null===(a=a.records[0])||void 0===a?void 0:a.total_count)}else this.reportData=await ft("stock",{selector:{drug_legacy_name:this.data.drug_legacy_name},currentPage:this.currentPage,itemsPerPage:4}),this.totalPages=this.reportData.totalCount}catch(n){st("An error occurred while loading data.")}finally{this.isLoading=!1}},async selectButton(t){this.selectedButton=t,await this.buildTableData()},async openAddStockModal(t){"dismiss"==await gt(Tt,{class:"fullScreenModal"},!0,{data:t})&&await this.buildTableData()}}}),Vt={key:0,class:"spinner-overlay"},Ft={class:"container"},At={style:{width:"70vw",top:"-2px",position:"relative","margin-right":"10px"}},Et={class:"drug_container"},Ht={key:0,class:"watermark"},Lt={key:1,class:"watermark"},Ot={style:{"font-weight":"700","font-size":"16px",color:"#939393"}},Ut={key:2},Rt={class:"example-one"},Gt={style:{"margin-bottom":"160px"}},$t={style:{display:"flex","justify-content":"space-between",padding:"10px"}},Qt=ut(Nt,[["render",function(t,e,a,n,i,o){const s=f("ion-spinner"),d=f("ion-title"),c=f("ion-icon"),l=f("ion-header"),r=f("basic-form"),u=f("ion-col"),p=f("ion-row"),h=f("ion-button"),m=f("vue-awesome-paginate"),g=f("ion-popover"),S=f("ion-content"),B=f("ion-page");return b(),K(B,{class:Z({loading:t.isLoading})},{default:y(()=>[t.isLoading?(b(),x("div",Vt,[v(s,{name:"bubbles"}),e[6]||(e[6]=_("div",{class:"loading-text"},"Please wait...",-1))])):Y("",!0),v(l,{style:{display:"flex","justify-content":"space-between"}},{default:y(()=>[v(d,{class:"modalTitle"},{default:y(()=>[...e[7]||(e[7]=[w("Inventory Management ",-1)])]),_:1}),v(c,{onClick:e[0]||(e[0]=e=>t.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:t.iconsContent.cancel},null,8,["icon"])]),_:1}),v(S,{style:{"--background":"#fff"}},{default:y(()=>[_("div",Ft,[_("div",At,[v(r,{contentData:t.searchName,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:inputValue"])]),_("div",Et,[(b(!0),x(D,null,J(t.reportData.records,(a,n)=>(b(),x("div",{class:"drug_content",key:n},[t.checkExpired(a)?Y("",!0):(b(),x("div",Ht,"EXPIRED")),a.current_quantity<=0?(b(),x("div",Lt,"Stock out")):Y("",!0),v(p,{class:"search_header"},{default:y(()=>[v(u,{class:""},{default:y(()=>[_("span",Ot,k(a.drug_legacy_name),1)]),_:2},1024)]),_:2},1024),v(p,{class:"search_header"},{default:y(()=>[v(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:y(()=>[...e[8]||(e[8]=[w("Batch/Lot Number",-1)])]),_:1}),v(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:y(()=>[w(k(a.batch_number),1)]),_:2},1024)]),_:2},1024),v(p,{class:"search_header"},{default:y(()=>[v(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:y(()=>[...e[9]||(e[9]=[w("Manufacturer",-1)])]),_:1}),v(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:y(()=>[w(k(a.manufacture),1)]),_:2},1024)]),_:2},1024),v(p,{class:"search_header"},{default:y(()=>[v(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:y(()=>[...e[10]||(e[10]=[w("Expiration date ",-1)])]),_:1}),v(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:y(()=>[w(k(t.formatDate(a.expiry_date)),1)]),_:2},1024)]),_:2},1024),v(p,{class:"search_header"},{default:y(()=>[v(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:y(()=>[...e[11]||(e[11]=[w("Date received",-1)])]),_:1}),v(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:y(()=>[w(k(t.formatDate(a.delivery_date)),1)]),_:2},1024)]),_:2},1024),v(p,{class:"search_header"},{default:y(()=>[v(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:y(()=>[...e[12]||(e[12]=[w("Doses Received",-1)])]),_:1}),v(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:y(()=>[w(k(a.delivered_quantity),1)]),_:2},1024)]),_:2},1024),v(p,{class:"search_header"},{default:y(()=>[v(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:y(()=>[...e[13]||(e[13]=[w("Doses wasted",-1)])]),_:1}),v(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:y(()=>[w(k(a.doses_wasted),1)]),_:2},1024)]),_:2},1024),v(p,{class:"search_header"},{default:y(()=>[v(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:y(()=>[...e[14]||(e[14]=[w("Doses Issued",-1)])]),_:1}),v(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:y(()=>[w(k(a.dispensed_quantity),1)]),_:2},1024)]),_:2},1024),v(p,{class:"search_header"},{default:y(()=>[v(u,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:y(()=>[...e[15]||(e[15]=[w("Doses Available",-1)])]),_:1}),v(u,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:y(()=>[w(k(a.current_quantity),1)]),_:2},1024)]),_:2},1024),t.apiStatus?(b(),x("div",Ut,[t.checkExpired(a)&&a.current_quantity>0?(b(),K(h,{key:0,size:"small",color:"danger",name:"Discard Stock",style:{"font-size":"12px"},onClick:e=>t.whichPopover(e,a,"discard")},{default:y(()=>[...e[16]||(e[16]=[w(" Discard Stock ",-1)])]),_:1},8,["onClick"])):(b(),K(h,{key:1,size:"small",color:"danger",name:"Discard Stock",style:{"font-size":"12px"},onClick:e=>t.voidStock(e,a)},{default:y(()=>[...e[17]||(e[17]=[w(" Void Stock ",-1)])]),_:1},8,["onClick"])),v(h,{color:"success",size:"small",name:"Update Stock",style:{"font-size":"12px"},onClick:e=>t.whichPopover(e,a,"adjust")},{default:y(()=>[...e[18]||(e[18]=[w("Adjust Stock",-1)])]),_:1},8,["onClick"])])):Y("",!0)]))),128))]),_("div",Rt,[t.totalPages>0?(b(),K(m,{key:0,"total-items":t.totalPages,"items-per-page":4,"max-pages-shown":2,modelValue:t.currentPage,"onUpdate:modelValue":e[1]||(e[1]=e=>t.currentPage=e),onClick:t.onClickHandler},null,8,["total-items","modelValue","onClick"])):Y("",!0)])]),v(g,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!1,event:t.event,onDidDismiss:e[5]||(e[5]=e=>t.popoverOpen=!1)},{default:y(()=>[_("div",Gt,[v(r,{contentData:t.stockDiscard,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:inputValue"])]),_("div",$t,[v(h,{size:"small",color:"danger",name:"Discard Stock",style:{"font-size":"14px"},onClick:e[2]||(e[2]=e=>t.closePopover())},{default:y(()=>[...e[19]||(e[19]=[w("Cancel",-1)])]),_:1}),"adjust"==t.popoverName?(b(),K(h,{key:0,color:"success",size:"small",name:"Update Stock",style:{"font-size":"14px"},onClick:e[3]||(e[3]=e=>t.adjustStock())},{default:y(()=>[...e[20]||(e[20]=[w("Save",-1)])]),_:1})):Y("",!0),"discard"==t.popoverName?(b(),K(h,{key:1,color:"success",size:"small",name:"Update Stock",style:{"font-size":"14px"},onClick:e[4]||(e[4]=e=>t.updateBatch())},{default:y(()=>[...e[21]||(e[21]=[w("Save",-1)])]),_:1})):Y("",!0)])]),_:1},8,["is-open","event"])]),_:1})]),_:1},8,["class"])}],["__scopeId","data-v-8ab089ec"]]),Wt=a({name:"StockManagement",mixins:[mt],components:{IonContent:u,IonHeader:r,IonMenuButton:V,IonPage:N,IonTitle:s,IonToolbar:o,Toolbar:ht,ToolbarSearch:pt,IonRow:q,IonCol:j,ImmunizationTrendsGraph:yt,ImmunizationGroupGraph:vt,IonCard:M,DynamicButton:X,BasicForm:kt,IonIcon:P,IonFab:T,IonFabButton:z,IonFabList:C,IonButton:I},data:()=>({reportData:[],currentStock:[],allStock:[],outStock:[],filter:"",startDate:ot.sessionDate(),endDate:ot.sessionDate(),options:{responsive:!0,select:!0},selectedButton:"all",isLoading:!1,combinedBatches:[],stockData:[],totalPages:0}),setup:()=>({currentPage:F(1),chevronBackOutline:W,checkmark:g,grid:Q,chevronDownCircle:$,chevronForwardCircle:G,chevronUpCircle:R,colorPalette:U,document:O,globe:L,medkit:H,add:E,person:A}),computed:{...n(wt,["stock"]),...n(Mt,["searchName"]),...n(bt,["apiStatus"])},watch:{stock:{async handler(){},deep:!0},$route:{async handler(t){"stockManagement"==t.name&&await this.updateBuildStockData()},deep:!0}},async mounted(){await this.updateBuildStockData()},methods:{combineDrugBatches(t){const e=t.reduce((t,e)=>{const a=e.drug_legacy_name;return t[a]||(t[a]=[]),t[a].push(e),t},{});return this.combinedBatches=Object.keys(e).map(t=>{const a=e[t];return{drug_legacy_name:t,delivered_quantity:a.reduce((t,e)=>t+e.delivered_quantity,0),current_quantity:a.reduce((t,e)=>t+e.current_quantity,0),dispensed_quantity:a.reduce((t,e)=>t+e.dispensed_quantity,0),doses_wasted:a.reduce((t,e)=>t+e.doses_wasted,0)}}),this.combinedBatches},async onClickHandler(t){await this.buildTableData(t)},formatDate:t=>ot.toStandardHisDisplayFormat(t),async handleInputData(t){"Search"==t.inputHeader&&(this.filter=t.value,await this.buildTableData())},async discardStock(t,e){if(await xt(`Do you want to void "${e.drug_legacy_name}", batch: ${e.batch_number} ?`,t,{confirmBtnLabel:"Void"})){const t=new St;await t.deleteItem(e.id,{reason:"voided"}),await this.buildTableData()}},async updateBuildStockData(){ct().postData("SYNC_STOCK_RECORD"),this.buildTableData()},async buildTableData(t=1){this.isLoading=!0;try{if(this.apiStatus){var e,a;const n=new St;this.reportData={items:await n.getItems({start_date:"2000-01-01",end_date:this.endDate,drug_name:this.filter,page:t,page_size:4,display_details:"true"})},null!==(e=this.reportData)&&void 0!==e&&e.items&&(this.totalPages=null===(a=this.reportData)||void 0===a||null===(a=a.items[0])||void 0===a?void 0:a.total_count)}else{var n;this.stockData=await ft("stock"),console.log("ðŸš€ ~ this.stockData:",this.stockData),this.reportData=this.paginateArray(this.combineDrugBatches(this.stockData),this.currentPage),this.totalPages=null===(n=this.combinedBatches)||void 0===n?void 0:n.length}}catch(i){st("An error occurred while loading data.")}finally{this.isLoading=!1}},paginateArray(t,e){if(!Array.isArray(t))throw new Error("Input must be an array");const a=Math.max(1,Number(e)||1),n=4*(a-1),i=n+4,o=t.slice(n,i);return{currentPage:a,totalPages:Math.ceil(t.length/4),totalItems:t.length,items:o}},async selectButton(t){this.selectedButton=t,await this.buildTableData()},async openMoreDetailsModal(t){"dismiss"==await gt(Qt,{class:"fullScreenModal"},!0,{data:t})&&await this.buildTableData()},async openAddStockModal(t){"dismiss"==await gt(Tt,{class:"fullScreenModal"},!0,{data:t})&&await this.buildTableData()}}}),Kt={key:0,class:"spinner-overlay"},Yt={class:"container"},Jt={style:{width:"80vw",top:"-10px",position:"relative","margin-right":"10px"}},Zt={class:"drug_container"},Xt={style:{"font-weight":"700","font-size":"16px",color:"#939393"}},te={class:"example-one"};t("default",ut(Wt,[["render",function(t,e,a,n,i,o){const s=f("ion-spinner"),d=f("Toolbar"),c=f("basic-form"),l=f("ion-col"),r=f("ion-row"),u=f("ion-button"),p=f("vue-awesome-paginate"),h=f("ion-icon"),m=f("ion-fab-button"),g=f("ion-fab"),S=f("ion-content"),B=f("ion-page");return b(),K(B,{class:Z({loading:t.isLoading}),"keep-alive":!1},{default:y(()=>[t.isLoading?(b(),x("div",Kt,[v(s,{name:"bubbles"}),e[2]||(e[2]=_("div",{class:"loading-text"},"Please wait...",-1))])):Y("",!0),v(d),v(S,{style:{"--background":"#fff",margin:"0 auto"}},{default:y(()=>{var a;return[_("div",Yt,[e[8]||(e[8]=_("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Inventory Management",-1)),_("div",Jt,[v(c,{contentData:t.searchName,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:inputValue"])]),_("div",Zt,[(b(!0),x(D,null,J(null===(a=t.reportData)||void 0===a?void 0:a.items,(a,n)=>(b(),x("div",{class:"drug_content",key:n},[v(r,{class:"search_header"},{default:y(()=>[v(l,{class:""},{default:y(()=>[_("span",Xt,k(a.drug_legacy_name),1)]),_:2},1024)]),_:2},1024),v(r,{class:"search_header"},{default:y(()=>[v(l,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:y(()=>[...e[3]||(e[3]=[w("Doses Received",-1)])]),_:1}),v(l,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:y(()=>[w(k(a.delivered_quantity),1)]),_:2},1024)]),_:2},1024),v(r,{class:"search_header"},{default:y(()=>[v(l,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:y(()=>[...e[4]||(e[4]=[w("Doses wasted",-1)])]),_:1}),v(l,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:y(()=>[w(k(a.doses_wasted),1)]),_:2},1024)]),_:2},1024),v(r,{class:"search_header"},{default:y(()=>[v(l,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:y(()=>[...e[5]||(e[5]=[w("Doses Issued",-1)])]),_:1}),v(l,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:y(()=>[w(k(a.dispensed_quantity),1)]),_:2},1024)]),_:2},1024),v(r,{class:"search_header"},{default:y(()=>[v(l,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:y(()=>[...e[6]||(e[6]=[w("Doses Available",-1)])]),_:1}),v(l,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:y(()=>[w(k(a.current_quantity),1)]),_:2},1024)]),_:2},1024),_("div",null,[v(u,{color:"success",size:"small",name:"Update Stock",style:{"font-size":"12px"},onClick:e=>t.openMoreDetailsModal(a)},{default:y(()=>[...e[7]||(e[7]=[w(" More Stock Details ",-1)])]),_:1},8,["onClick"])])]))),128))]),_("div",te,[t.totalPages>0?(b(),K(p,{key:0,"total-items":t.totalPages,"items-per-page":4,"max-pages-shown":2,modelValue:t.currentPage,"onUpdate:modelValue":e[0]||(e[0]=e=>t.currentPage=e),onClick:t.onClickHandler},null,8,["total-items","modelValue","onClick"])):Y("",!0)])]),t.apiStatus?(b(),K(g,{key:0,slot:"fixed",vertical:"bottom",horizontal:"end",onClick:e[1]||(e[1]=e=>t.openAddStockModal(""))},{default:y(()=>[v(m,{color:"primary"},{default:y(()=>[v(h,{icon:t.add},null,8,["icon"])]),_:1})]),_:1})):Y("",!0)]}),_:1})]),_:1},8,["class"])}],["__scopeId","data-v-95dfeb9e"]]))}}});

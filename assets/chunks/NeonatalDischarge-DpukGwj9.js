import{d as V,b2 as oe,r as D,c as I,a as ee,e as f,f as h,k as e,p as B,l as S,u as v,d1 as De,L as O,K as w,Q as K,bH as M,w as H,m as x,bx as _e,F as L,P as U,ff as Se,bz as ye,O as j,ba as Q,i as X,b9 as ne,b8 as Fe,bp as we,at as ie,aM as le,bj as ke,D as $e,v as Ce,cx as Ie,cy as z,J as Z,N as Ne,aF as Oe,ab as Pe,ae as Te,am as Ve,eV as Re,H as Y}from"./vendor-Do41i3tR.js";import{u as te,H as G,ci as xe,P as Ae,_ as A,J as re,z as ae,cj as ce,aa as Ee,T as Me,t as se,ch as He,b as qe,F as Le,w as Ue}from"../index-DmWNBpr9.js";import{N as be}from"./neonatal_service-BhATEAP8.js";import{D as ze}from"./DemographicBar-BkCJgdeB.js";import{g as q,h as P,i as Ge,j as Be,k as Ye,N as je}from"./NeonatalStepper-DUriSxpM.js";import{u as We}from"./useAdmissionSignOff-CzGEC4mL.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-DB4uOJSt.js";import"./SaveProgressModal-CyRzXU-6.js";import"./enrollment-DU-PLRUa.js";import"./images-142qstiX.js";const Je={class:"profile-card"},Ke={class:"profile-content"},Qe={class:"avatar-column"},Xe={class:"details-column"},Ze={class:"patient-name"},et={class:"bio-line"},tt={key:0,class:"info-row"},at={class:"value"},st={class:"info-row"},nt={class:"value"},ot={class:"mother-name-section"},it=V({__name:"ProfileInformation",setup(_){const y=te(),{patient:t}=oe(y),d=D(""),u=D(""),m=I(()=>{var i,a;return((a=(i=t.value)==null?void 0:i.personInformation)==null?void 0:a.gender)==="M"?"male-bg":"female-bg"}),r=I(()=>{var a,l;const i=(l=(a=t.value)==null?void 0:a.personInformation)==null?void 0:l.gender;return i==="M"?"Male":i==="F"?"Female":i}),c=I(()=>{var a,l;const i=(l=(a=t.value)==null?void 0:a.personInformation)==null?void 0:l.birthdate;return i?G.calculateDisplayAge(G.toStandardHisFormat(i)):""}),p=I(()=>{var a,l;const i=(l=(a=t.value)==null?void 0:a.personInformation)==null?void 0:l.birthdate;return i?G.toStandardHisDisplayFormat(i):""}),s=I(()=>({header:"Mother's Full Name",value:u.value,disabled:!0,type:"text",placeholder:"Searching..."})),o=async()=>{var a,l;const i=(a=t.value)==null?void 0:a.patientID;if(i)try{const F=await be.checkEnrollment(i);F&&((l=F.enrollment_data)!=null&&l.date_enrolled)&&(d.value=G.toStandardHisDisplayFormat(F.enrollment_data.date_enrolled))}catch(F){console.error("Failed to fetch admission date",F)}},n=async()=>{try{const a=await new Ae().getGuardian();if(a&&a.length>0){const l=a.find(F=>{var b;const N=((b=F.type)==null?void 0:b.b_is_to_a)||"";return N==="Mother"||N==="Parent"});if(l&&l.relation&&l.relation.names&&l.relation.names.length>0){const F=l.relation.names[0];u.value=[F.given_name,F.middle_name,F.family_name].filter(Boolean).join(" ")}else u.value="N/A"}else u.value="N/A"}catch(i){console.error("Failed to fetch mother's name",i),u.value="Unknown"}};return ee(()=>{o(),n()}),(i,a)=>{var l,F,N,b,C;return h(),f("div",Je,[e("div",Ke,[e("div",Qe,[e("div",{class:B(["avatar-box",m.value])},[S(v(O),{icon:v(De),class:"avatar-icon"},null,8,["icon"])],2)]),e("div",Xe,[e("div",Ze,[e("div",null,w((F=(l=v(t))==null?void 0:l.personInformation)==null?void 0:F.given_name),1),e("div",null,w((b=(N=v(t))==null?void 0:N.personInformation)==null?void 0:b.family_name),1)]),e("div",et,[K(w(r.value)+" ",1),a[0]||(a[0]=e("span",{class:"bullet"},"•",-1)),K(" "+w(c.value)+" ",1),a[1]||(a[1]=e("span",{class:"bullet"},"•",-1)),K(" "+w(p.value),1)]),(h(),f("div",tt,[a[2]||(a[2]=e("span",{class:"label"},"Admission Date:",-1)),e("span",at,w(d.value),1)])),e("div",st,[a[3]||(a[3]=e("span",{class:"label"},"MRN:",-1)),e("span",nt,w((C=v(t))==null?void 0:C.ID),1)])])]),a[4]||(a[4]=e("div",{class:"form-title"},"DISCHARGE FORM",-1)),e("div",ot,[S(xe,{config:s.value,allFormValues:{}},null,8,["config"])])])}}}),lt=A(it,[["__scopeId","data-v-de193189"]]),rt={class:"vitals-header"},ct={class:"detail-row"},dt={class:"detail-value status-value"},ut={class:"detail-row"},mt={class:"weight-box"},pt={class:"weight-value"},ht={class:"weight-date"},vt={class:"section-subtitle"},ft=0,gt=V({__name:"DischargeVitals",setup(_,{expose:y}){const t=P[ft],d=D(null),u=M(q),m=te(),r=D(""),c=D(""),p=D("");ee(async()=>{var n,i;const o=(n=m.patient)==null?void 0:n.patientID;if(o)try{const a=await re.getFirstObs(o,"Mother HIV status");if(a){let F=a.value_text;!F&&a.value_coded&&(F=String(a.value_coded)),r.value=F||"Unknown"}else r.value="Unknown";const l=await re.getFirstObs(o,"Birth weight");l&&(c.value=((i=l.value_numeric)==null?void 0:i.toString())||"",l.obs_datetime&&(p.value=G.toStandardHisDisplayFormat(l.obs_datetime)))}catch(a){console.error("Error fetching vitals details",a)}});const s=o=>{u&&(u.weight=o.weight,u.heartRate=o.heartRate,u.respiratoryRate=o.respiratoryRate,u.oxygenSaturation=o.oxygenSaturation,u.temperature=o.temperature)};return H(()=>{var o;return(o=d.value)==null?void 0:o.formValues},o=>{o&&s(o)},{deep:!0}),H(()=>d.value,o=>{o!=null&&o.getFormValues&&s(o.getFormValues())},{immediate:!0}),y({getFormValues:()=>{var o,n;return((n=(o=d.value)==null?void 0:o.getFormValues)==null?void 0:n.call(o))||{}},validateForm:()=>{var o,n;return((n=(o=d.value)==null?void 0:o.validateForm)==null?void 0:n.call(o))||null}}),(o,n)=>(h(),f("div",null,[e("div",rt,[e("div",ct,[n[0]||(n[0]=e("span",{class:"detail-label"},"HIV status",-1)),e("span",dt,w(r.value||"Loading..."),1)]),e("div",ut,[n[2]||(n[2]=e("span",{class:"detail-label"},"Birth Weight",-1)),e("div",mt,[e("span",pt,w(c.value?c.value+" kg":"..."),1),n[1]||(n[1]=e("span",{class:"weight-separator"},"|",-1)),e("span",ht,"Date: "+w(p.value||"..."),1)])]),e("div",vt,w(v(t).subtitle),1)]),S(ae,{formData:v(t).formData,ref_key:"formRef",ref:d},null,8,["formData"])]))}}),de=A(gt,[["__scopeId","data-v-c63c7f2d"]]),_t={class:"discharge-diagnosis-wrapper"},yt={class:"diagnosis-section"},bt={class:"diagnosis-section"},Dt={key:0,class:"validation-error"},St=V({__name:"DischargeDiagnosis",setup(_,{expose:y}){const t=M(q),d=D(null),u=D(null),m=D(null),r=[{label:"Hypoglycaemia (symptomatic)",value:"Hypoglycaemia1"},{label:"Abscess",value:"Abscess"},{label:"Fever",value:"Fever"},{label:"Birth Asphyxia",value:"Asphyxia"},{label:"Neonatal Sepsis (Early onset - Symptomatic)",value:"Neonatal Sepsis - Early Onset"},{label:"Prematurity with Respiratory Distress",value:"Prematurity with RDS"},{label:"Suspected Neonatal Sepsis",value:"Sepsis_Sus"},{label:"Possible Meconium Aspiration",value:"Meconium Aspiration"}],c=I(()=>({componentType:"searchableDropdown",header:"Select the Discharge Diagnosis",name:"mainDiagnosis",placeholder:"Search",dropdownHeader:"Select ONE",options:r,multiple:!1,bold:!0,initialValue:(t==null?void 0:t.mainDiagnosis)||null,validation:i=>i?null:"A main Discharge Diagnosis is required."})),p=I(()=>({componentType:"searchableDropdown",header:"Other problems (If any)",name:"otherProblems",placeholder:"Search",dropdownHeader:"Select problems",options:r,multiple:!0,bold:!0,initialValue:(t==null?void 0:t.otherProblems)||[]})),s=i=>{t&&(t.mainDiagnosis=i.value,d.value=null)},o=i=>{t&&(t.otherProblems=i.value)};return y({validateForm:()=>t!=null&&t.mainDiagnosis?(d.value=null,null):(d.value="A main Discharge Diagnosis is required.",{mainDiagnosis:"Required"}),getFormValues:()=>({})}),(i,a)=>(h(),f("div",_t,[e("div",yt,[S(ce,{config:c.value,allFormValues:{},onFieldChanged:s,ref_key:"mainDiagnosisRef",ref:u},null,8,["config"])]),e("div",bt,[S(ce,{config:p.value,allFormValues:{},onFieldChanged:o,ref_key:"otherProblemsRef",ref:m},null,8,["config"])]),d.value?(h(),f("div",Dt,w(d.value),1)):x("",!0)]))}}),ue=A(St,[["__scopeId","data-v-fe875052"]]),Ft={class:"discharge-medications-wrapper"},wt={class:"section"},kt={key:0,class:"past-history-list"},$t={key:1,class:"empty-message"},Ct={class:"section"},It={key:0,class:"final-medications-list"},Nt={class:"med-name"},Ot=["onClick"],Pt={key:1,class:"empty-message"},Tt={key:0,class:"section"},Vt={class:"prescription-table"},Rt={class:"med-name-cell"},xt={class:"frequency-cell"},At=["onClick"],Et=["value"],Mt={key:0,class:"frequency-dropdown-container"},Ht=["onClick"],qt={class:"dosage-cell"},Lt=["onUpdate:modelValue"],Ut=["onClick"],zt={class:"section"},Gt={class:"search-wrapper"},Bt={key:0,class:"dropdown-container"},Yt=["onClick"],jt=V({__name:"DischargeMedications",setup(_,{expose:y}){const t=M(q),d=["Paracetamol","Gentamicin","Wrapped","KMC","Resuscitaire","BVM Ventilation","Nasal Cannulae Oxygen","Amoxicillin","Ampicillin","Penicillin","Ceftriaxone","Nevirapine","Zidovudine","Multivitamin"],u=D(["Gentamicin"]),m=D([]),r=["once a day","twice a day","3 times a day","4 times a day"],c=D(null),p=I(()=>!t||!t.medications?[]:t.medications),s=D(""),o=D(!1),n=D([...d]),i=()=>{const k=s.value.toLowerCase();k?n.value=d.filter(g=>g.toLowerCase().includes(k)):n.value=[...d]},a=k=>m.value.some(g=>g.name===k),l=k=>{a(k)||(m.value.push({name:k,frequency:"once a day",dosage:""}),o.value=!1,s.value="",n.value=[...d])},F=k=>{c.value===k?c.value=null:c.value=k},N=(k,g)=>{m.value[k].frequency=g,c.value=null},b=k=>{const g=m.value[k];if(!g.dosage||g.dosage.trim()===""){alert("Please enter dosage before adding");return}if(!t){console.error("Discharge form not found");return}t.medications||(t.medications=[]),t.medications.push({name:g.name,frequency:g.frequency,dosage:g.dosage}),console.log("Added medication:",g.name),console.log("Total medications:",t.medications.length),console.log("Medications array:",t.medications),m.value.splice(k,1)},C=k=>{t&&t.medications&&t.medications.splice(k,1)},E=k=>{const g=k.target;!g.closest(".search-wrapper")&&!g.closest(".dropdown-container")&&(o.value=!1),!g.closest(".custom-frequency-wrapper")&&!g.closest(".frequency-dropdown-container")&&(c.value=null)};return ee(()=>{document.addEventListener("click",E)}),_e(()=>{document.removeEventListener("click",E)}),y({validateForm:()=>null,getFormValues:()=>({})}),(k,g)=>(h(),f("div",Ft,[e("div",wt,[g[2]||(g[2]=e("h3",{class:"section-title"},"Past Medical History",-1)),u.value.length>0?(h(),f("div",kt,[(h(!0),f(L,null,U(u.value,($,T)=>(h(),f("div",{key:T,class:"history-item"},w($),1))),128))])):(h(),f("div",$t,"No past medical history"))]),e("div",Ct,[g[3]||(g[3]=e("h3",{class:"section-title"},"Medications given on discharge",-1)),p.value.length>0?(h(),f("div",It,[(h(!0),f(L,null,U(p.value,($,T)=>(h(),f("div",{key:T,class:"final-med-item"},[e("span",Nt,w($.name),1),e("button",{onClick:R=>C(T),class:"delete-btn",type:"button"},[S(v(O),{icon:v(Se),class:"trash-icon"},null,8,["icon"])],8,Ot)]))),128))])):(h(),f("div",Pt,"No medications added yet"))]),m.value.length>0?(h(),f("div",Tt,[g[5]||(g[5]=e("h3",{class:"section-title"},"Prescription Details",-1)),e("div",Vt,[g[4]||(g[4]=e("div",{class:"table-header"},[e("span",null,"Name"),e("span",null,"Frequency"),e("span",null,"Dosage")],-1)),(h(!0),f(L,null,U(m.value,($,T)=>(h(),f("div",{key:T,class:"table-row"},[e("span",Rt,w($.name),1),e("div",xt,[e("div",{class:"custom-frequency-wrapper",onClick:R=>F(T)},[e("input",{type:"text",value:$.frequency,readonly:"",class:"frequency-select"},null,8,Et),S(v(O),{icon:v(ye),class:"dropdown-icon"},null,8,["icon"])],8,At),c.value===T?(h(),f("div",Mt,[(h(),f(L,null,U(r,R=>e("div",{key:R,class:B(["frequency-dropdown-item",{selected:$.frequency===R}]),onClick:Na=>N(T,R)},[e("span",null,w(R),1),$.frequency===R?(h(),j(v(O),{key:0,icon:v(Q),class:"check-icon"},null,8,["icon"])):x("",!0)],10,Ht)),64))])):x("",!0)]),e("div",qt,[X(e("input",{type:"text","onUpdate:modelValue":R=>$.dosage=R,placeholder:"Enter dosage",class:"dosage-input"},null,8,Lt),[[ne,$.dosage]]),e("button",{onClick:R=>b(T),class:"add-btn",type:"button"},[S(v(O),{icon:v(Fe),class:"add-icon"},null,8,["icon"])],8,Ut)])]))),128))])])):x("",!0),e("div",zt,[e("div",Gt,[S(v(O),{icon:v(we),class:"search-icon"},null,8,["icon"]),X(e("input",{type:"text","onUpdate:modelValue":g[0]||(g[0]=$=>s.value=$),placeholder:"Search",class:"search-input",onInput:i,onFocus:g[1]||(g[1]=$=>o.value=!0)},null,544),[[ne,s.value]])]),o.value&&n.value.length>0?(h(),f("div",Bt,[(h(!0),f(L,null,U(n.value,$=>(h(),f("div",{key:$,class:B(["dropdown-item",{selected:a($)}]),onClick:T=>l($)},[e("span",null,w($),1),a($)?(h(),j(v(O),{key:0,icon:v(Q),class:"check-icon"},null,8,["icon"])):x("",!0)],10,Yt))),128))])):x("",!0)])]))}}),me=A(jt,[["__scopeId","data-v-5243432a"]]),Wt={class:"clinic-follow-up-wrapper"},Jt={key:0,class:"saved-appointments"},Kt={class:"appointment-header"},Qt={class:"clinic-info"},Xt={class:"clinic-name"},Zt={class:"appointment-date"},ea={class:"clinic-type"},ta={class:"add-clinic-section"},aa={class:"form-container"},sa={class:"clinic-label"},na={class:"form-field"},oa=["value"],ia={key:0,class:"dropdown-container"},la=["onClick"],ra={class:"form-field date-field"},ca=["disabled"],da=V({__name:"ClinicFollowUp",setup(_,{expose:y}){const t=M(q),d=I(()=>!t||!t.appointments?[]:t.appointments),u=I(()=>d.value.length+1),m=I(()=>"Clinic ".concat(u.value)),r=["Health Center follow up","Specialist Clinic","General Outpatient","Immunization"],c=D(!1),p=D({clinicName:"",clinicType:"",date:""}),s=()=>{c.value=!c.value},o=N=>{p.value.clinicType=N,c.value=!1},n=I(()=>p.value.clinicType!==""&&p.value.date!==""),i=N=>{if(!N)return"";const b=new Date(N),C=b.getDate(),E=b.toLocaleString("en-US",{month:"short"}),W=b.getFullYear();return"".concat(C," ").concat(E," ").concat(W)},a=()=>{!n.value||!t||(t.appointments||(t.appointments=[]),t.appointments.push({clinicName:m.value,clinicType:p.value.clinicType,date:p.value.date}),p.value={clinicName:"",clinicType:"",date:""})},l=N=>{const b=N.target;!b.closest(".custom-select-wrapper")&&!b.closest(".dropdown-container")&&(c.value=!1)};return ee(()=>{document.addEventListener("click",l)}),_e(()=>{document.removeEventListener("click",l)}),y({validateForm:()=>null,getFormValues:()=>({})}),(N,b)=>(h(),f("div",Wt,[b[3]||(b[3]=e("div",{class:"info-banner"},"You can assign clinic days for the baby.",-1)),d.value.length>0?(h(),f("div",Jt,[b[1]||(b[1]=e("h3",{class:"section-title"},"Saved Appointments",-1)),(h(!0),f(L,null,U(d.value,(C,E)=>(h(),f("div",{key:E,class:"appointment-item"},[e("div",Kt,[e("div",Qt,[S(v(O),{icon:v(ie),class:"clinic-icon"},null,8,["icon"]),e("span",Xt,w(C.clinicName),1)]),e("div",Zt,[e("span",null,w(i(C.date)),1),S(v(O),{icon:v(le),class:"calendar-icon"},null,8,["icon"])])]),e("div",ea,w(C.clinicType),1)]))),128))])):x("",!0),e("div",ta,[b[2]||(b[2]=e("h3",{class:"section-title"},"Add a clinic day",-1)),e("div",aa,[e("div",sa,[S(v(O),{icon:v(ie),class:"label-icon"},null,8,["icon"]),e("span",null,w(m.value),1)]),e("div",na,[e("div",{class:"custom-select-wrapper",onClick:s},[e("input",{type:"text",value:p.value.clinicType||"Select clinic type",readonly:"",class:B(["clinic-select",{placeholder:!p.value.clinicType}])},null,10,oa),S(v(O),{icon:v(ye),class:"dropdown-icon"},null,8,["icon"])]),c.value?(h(),f("div",ia,[(h(),f(L,null,U(r,C=>e("div",{key:C,class:B(["dropdown-item",{selected:p.value.clinicType===C}]),onClick:E=>o(C)},[e("span",null,w(C),1),p.value.clinicType===C?(h(),j(v(O),{key:0,icon:v(Q),class:"check-icon"},null,8,["icon"])):x("",!0)],10,la)),64))])):x("",!0)]),e("div",ra,[X(e("input",{type:"date","onUpdate:modelValue":b[0]||(b[0]=C=>p.value.date=C),placeholder:"Clinic date",class:"date-input"},null,512),[[ne,p.value.date]]),S(v(O),{icon:v(le),class:"date-icon"},null,8,["icon"])]),e("button",{onClick:a,disabled:!n.value,class:"save-button",type:"button"},"save appointment",8,ca)])])]))}}),pe=A(da,[["__scopeId","data-v-ed7c5ffd"]]),ua={class:"health-education-content"},ma=V({__name:"HealthEducation",setup(_,{expose:y}){const t=D(null),d=P[4].formData,u=M(q),m=r=>{u&&(u.healthEducationGiven=r.healthEducationGiven||"",u.insecticideTreatedNetGiven=r.insecticideTreatedNetGiven||"")};return H(()=>{var r;return(r=t.value)==null?void 0:r.formValues},r=>{r&&m(r)},{deep:!0}),H(()=>t.value,r=>{r!=null&&r.getFormValues&&m(r.getFormValues())},{immediate:!0}),y({getFormRef:()=>t.value,validateForm:()=>{var r,c;return((c=(r=t.value)==null?void 0:r.validateForm)==null?void 0:c.call(r))||null},getFormValues:()=>{var r,c;return((c=(r=t.value)==null?void 0:r.getFormValues)==null?void 0:c.call(r))||{}}}),(r,c)=>(h(),f("div",ua,[c[0]||(c[0]=ke('<div class="info-banner" data-v-ab0717a9>Please educate the mother on the following:</div><div class="education-section" data-v-ab0717a9><h3 class="section-title" data-v-ab0717a9>1. Danger Signs</h3><ul class="education-list" data-v-ab0717a9><li data-v-ab0717a9>Jaundice</li><li data-v-ab0717a9>Convulsions</li><li data-v-ab0717a9>Not able to breast feed</li><li data-v-ab0717a9>Difficulties in breathing</li><li data-v-ab0717a9>Lethargic</li><li data-v-ab0717a9>Fever</li><li data-v-ab0717a9>Hypothermia</li><li data-v-ab0717a9>Abdominal distention</li><li data-v-ab0717a9>Bleeding from the cord and what to do if any</li></ul></div><div class="education-section" data-v-ab0717a9><h3 class="section-title" data-v-ab0717a9>1. GENERAL EDUCATION</h3><ul class="education-list" data-v-ab0717a9><li data-v-ab0717a9>Immunization</li><li data-v-ab0717a9>Family planning</li><li data-v-ab0717a9>Hygiene</li><li data-v-ab0717a9>Keeping baby warm</li><li data-v-ab0717a9>Malaria Prevention</li></ul></div>',3)),S(ae,{formData:v(d),ref_key:"formRef",ref:t},null,8,["formData"])]))}}),he=A(ma,[["__scopeId","data-v-ab0717a9"]]),pa={class:"discharge-outcome-wrapper"},ha={class:"outcome-list padding"},va=["onClick"],fa={class:"option-text"},ga=V({__name:"DischargeOutcome",setup(_,{expose:y}){const t=M(q),d=["Discharged","Death (at LESS than 24 hours of age)","Death (at MORE than 24 hours of age)","Died during Admission","Absconded","Transferred to another ward","Transferred to another hospital","Discharged on request","Discharged on palliative care","Brought in dead - BID","Stillbirth"],u=D("");t&&(u.value=t.outcome||"");const m=c=>{u.value=c};return H(u,c=>{t&&(t.outcome=c)}),y({validateForm:()=>u.value?null:{outcome:"Please select an outcome"},getFormValues:()=>({outcome:u.value})}),(c,p)=>(h(),f("div",pa,[p[0]||(p[0]=e("div",{class:"question-banner"},"What happened to the baby?",-1)),p[1]||(p[1]=e("div",{class:"select-label padding"},"Select one",-1)),e("div",ha,[(h(),f(L,null,U(d,s=>e("div",{key:s,class:B(["outcome-option",{selected:u.value===s}]),onClick:o=>m(s)},[e("span",fa,w(s),1),u.value===s?(h(),j(v(O),{key:0,icon:v(Q),class:"check-icon"},null,8,["icon"])):x("",!0)],10,va)),64))])]))}}),ve=A(ga,[["__scopeId","data-v-da5e6123"]]),J=()=>JSON.parse(JSON.stringify(Ge)),_a=$e("neonatalDischargeStore",{state:()=>({activePatientId:null,dischargeForm:J(),dischargeFormCache:{}}),actions:{initializeDischargeForm(_){if(_==null){this.activePatientId=null,Object.assign(this.dischargeForm,J());return}this.activePatientId=_;const y=this.dischargeFormCache[String(_)];y?Object.assign(this.dischargeForm,y):Object.assign(this.dischargeForm,J()),this.saveDischargeSnapshot()},saveDischargeSnapshot(){this.activePatientId!=null&&(this.dischargeFormCache[String(this.activePatientId)]=JSON.parse(JSON.stringify(this.dischargeForm)))},resetDischargeForm(){Object.assign(this.dischargeForm,J()),this.saveDischargeSnapshot()},clearDischargeForm(_){delete this.dischargeFormCache[String(_)],this.activePatientId===_&&this.resetDischargeForm()}},persist:{paths:["activePatientId","dischargeForm","dischargeFormCache"]}}),ya={class:"signoff-wrapper"},ba=V({__name:"SignOff",setup(_,{expose:y}){const t=D(null),d=M(Be,null),u=M(q,null),m=I(()=>u?{form:u,config:P[6]}:{form:d,config:Ye[0]}),r=I(()=>{var s;return((s=m.value.config)==null?void 0:s.formData)||[]}),c=I(()=>{var s;return((s=m.value.config)==null?void 0:s.subtitle)||""});We(t);const p=s=>{const o=m.value.form;o&&(o.healthcareWorkerId=s.healthcareWorkerId||"",o.electronicSignature=s.electronicSignature||"",o.userRole=s.userRole||"",o.signOffDate=s.signOffDate||"")};return H(()=>{var s;return(s=t.value)==null?void 0:s.formValues},s=>{s&&p(s)},{deep:!0}),H(()=>t.value,s=>{s!=null&&s.getFormValues&&p(s.getFormValues())},{immediate:!0}),y({getFormRef:()=>t.value,validateForm:()=>{var s,o;return((o=(s=t.value)==null?void 0:s.validateForm)==null?void 0:o.call(s))||null},getFormValues:()=>{var s,o;return((o=(s=t.value)==null?void 0:s.getFormValues)==null?void 0:o.call(s))||{}}}),(s,o)=>(h(),f("div",ya,[S(ae,{formData:r.value,subtitle:c.value,ref_key:"formRef",ref:t,class:"main-form"},null,8,["formData","subtitle"])]))}}),fe=A(ba,[["__scopeId","data-v-0462b6f8"]]),Da={class:"printable-discharge-form"},Sa=V({__name:"PrintableDischargeForm",setup(_,{expose:y}){const t=te(),{patient:d}=oe(t),u=Ee(),m=M(q,{}),r=I(()=>{var i;const n=(i=d.value)==null?void 0:i.personInformation;return n&&"".concat(n.given_name||""," ").concat(n.family_name||"").trim()||"N/A"}),c=I(()=>{var n,i;return((n=d.value)==null?void 0:n.nationalId)||((i=d.value)==null?void 0:i.patientID)||"N/A"}),p=I(()=>u.userFacilityName||localStorage.getItem("facilityName")||"Healthcare Facility"),s=n=>n==null||n===""?"-":Array.isArray(n)?n.length?n.join(", "):"-":typeof n=="object"&&n.label?n.label:typeof n=="object"&&n.value?n.value:String(n);return y({exportPdf:async()=>{var g;const n=new Ie({orientation:"portrait",unit:"pt",format:"a4"}),i=n.internal.pageSize.getWidth(),a=28;let l=a+20;n.setFontSize(16),n.setFont("helvetica","bold"),n.text("Neonatal Discharge Summary",i/2,l,{align:"center"}),l+=20,n.setFontSize(12),n.setFont("helvetica","normal"),n.text(String(p.value),i/2,l,{align:"center"}),l+=30;const F=[["Patient Name",r.value],["NPID",c.value],["Date of Discharge",m.signOffDate||new Date().toISOString().split("T")[0]]];z(n,{startY:l,head:[["Patient Details",""]],body:F,theme:"grid",headStyles:{fillColor:[1,99,2],textColor:255},margin:{left:a,right:a}}),l=n.lastAutoTable.finalY+20;const N=[["Main Diagnosis",s(m.mainDiagnosis)],["Other Problems",(g=m.otherProblems)==null?void 0:g.map($=>s($)).join(", ")]];z(n,{startY:l,head:[["Diagnosis",""]],body:N,theme:"grid",headStyles:{fillColor:[230,230,230],textColor:0},margin:{left:a,right:a}}),l=n.lastAutoTable.finalY+20;const b=[["Weight (g)",s(m.weight)],["Heart Rate",s(m.heartRate)],["Resp Rate",s(m.respiratoryRate)],["O2 Sat",s(m.oxygenSaturation)],["Temp",s(m.temperature)]];z(n,{startY:l,head:[["Discharge Vitals",""]],body:b,theme:"grid",headStyles:{fillColor:[230,230,230],textColor:0},margin:{left:a,right:a}}),l=n.lastAutoTable.finalY+20;const C=[["Outcome",s(m.outcome)]];z(n,{startY:l,head:[["Outcome",""]],body:C,theme:"grid",headStyles:{fillColor:[230,230,230],textColor:0},margin:{left:a,right:a}}),l=n.lastAutoTable.finalY+20;const E=[["Health Education Given",s(m.healthEducationGiven)],["Insecticide Treated Net Given",s(m.insecticideTreatedNetGiven)]];z(n,{startY:l,head:[["Health Education",""]],body:E,theme:"grid",headStyles:{fillColor:[230,230,230],textColor:0},margin:{left:a,right:a}}),l=n.lastAutoTable.finalY+20;const W=[["Healthcare Worker ID",s(m.healthcareWorkerId)],["Signature",s(m.electronicSignature)],["Role",s(m.userRole)],["Sign Off Date",s(m.signOffDate)]];z(n,{startY:l,head:[["Sign Off",""]],body:W,theme:"grid",headStyles:{fillColor:[230,230,230],textColor:0},margin:{left:a,right:a}});const k="discharge-summary-".concat(c.value,".pdf");n.save(k)}}),(n,i)=>X((h(),f("div",Da,null,512)),[[Ce,!1]])}}),Fa={class:"print-summary-wrapper"},wa={class:"print-content"},ka={class:"print-actions"},$a=V({__name:"DischargePrint",setup(_,{expose:y}){const t=D(null),d=D(null),u=P[7],m=u.formData,r=u.subtitle,c=async()=>{var p;(p=d.value)!=null&&p.exportPdf&&await d.value.exportPdf()};return y({getFormRef:()=>t.value,validateForm:()=>null,getFormValues:()=>({})}),(p,s)=>(h(),f("div",Fa,[S(ae,{formData:v(m),subtitle:v(r),ref_key:"formRef",ref:t,class:"main-form"},{printSection:Z(()=>[e("div",wa,[e("div",ka,[S(v(Ne),{expand:"block",color:"primary",onClick:c,class:"print-button"},{default:Z(()=>[S(v(O),{icon:v(Oe),slot:"start"},null,8,["icon"]),s[0]||(s[0]=K(" Print Discharge Summary ",-1))]),_:1})])])]),_:1},8,["formData","subtitle"]),S(Sa,{ref_key:"printablePrintRef",ref:d},null,512)]))}}),ge=A($a,[["__scopeId","data-v-e4ae595a"]]),Ca=V({name:"NeonatalDischarge",components:{IonPage:Te,IonContent:Pe,Toolbar:Me,DemographicBar:ze,ProfileInformation:lt,NeonatalStepper:je,DischargeVitals:de,DischargeDiagnosis:ue,DischargeMedications:me,ClinicFollowUp:pe,HealthEducation:he,DischargeOutcome:ve,SignOff:fe,DischargePrint:ge},setup(){const _=Ve(),y=te(),{patient:t}=oe(y),d=D(!1),u=_a(),m=i=>{const a=Number(i);return Number.isFinite(a)?a:null},r=()=>{var a;const i=m((a=t.value)==null?void 0:a.patientID);u.initializeDischargeForm(i)};r(),H(()=>{var i;return(i=t.value)==null?void 0:i.patientID},()=>r());const c=u.dischargeForm;Re(q,c),H(()=>u.dischargeForm,()=>u.saveDischargeSnapshot(),{deep:!0});const p=D(P.map((i,a)=>({title:i.title,number:a+1,checked:!1,class:a===0?"open_step common_step":"common_step",last_step:a===P.length-1?"last_step":""}))),s=[{title:P[0].title,value:"1",component:de},{title:P[1].title,value:"2",component:ue},{title:P[2].title,value:"3",component:me},{title:P[3].title,value:"4",component:pe},{title:P[4].title,value:"5",component:he},{title:P[5].title,value:"6",component:ve},{title:P[6].title,value:"7",component:fe},{title:P[7].title,value:"8",component:ge}];return{router:_,patient:t,dischargeFormData:c,stepperTitle:"Neonatal Discharge",currentOpenStepper:"1",wizardData:p,stepperData:s,updateStatus:i=>{i&&i.value&&p.value.forEach((a,l)=>{i.value===(l+1).toString()?(a.class="open_step common_step",a.checked=!1):l<parseInt(i.value)-1?(a.class="common_step color_white",a.checked=!0):(a.class="common_step",a.checked=!1)})},getSaveFunction:i=>i===6?async()=>{var a;if(!((a=t.value)!=null&&a.patientID)){se("No patient selected");return}if(!d.value)try{if(d.value=!0,!c.mainDiagnosis){se("Please select a discharge diagnosis"),d.value=!1;return}if(!c.outcome){se("Please select a discharge outcome"),d.value=!1;return}const l=await be.buildDischargeObservations(c,G.sessionDate());await He(t.value.patientID,qe.DISCHARGE_PATIENT,l),Le("Neonate discharged successfully"),d.value=!1}catch(l){throw console.error("Neonatal discharge failed",l),Ue("Failed to discharge neonate. Please try again."),d.value=!1,l}}:i===7?async()=>{u.clearDischargeForm(t.value.patientID),_.push("/patientProfile")}:null,isDischarging:d}}});function Ia(_,y,t,d,u,m){const r=Y("Toolbar"),c=Y("ProfileInformation"),p=Y("NeonatalStepper"),s=Y("ion-content"),o=Y("ion-page");return h(),j(o,{class:"neonatal-discharge-page"},{default:Z(()=>[S(r),S(s,{fullscreen:!0},{default:Z(()=>[S(c),S(p,{wizardData:_.wizardData,StepperData:_.stepperData,stepperTitle:_.stepperTitle,openStepper:_.currentOpenStepper,backUrl:"/patientProfile",getSaveFunction:_.getSaveFunction,flowType:"discharge",headerStyle:"discharge-header",onUpdateStatus:_.updateStatus},null,8,["wizardData","StepperData","stepperTitle","openStepper","getSaveFunction","onUpdateStatus"])]),_:1})]),_:1})}const La=A(Ca,[["render",Ia],["__scopeId","data-v-fe55d434"]]);export{La as default};

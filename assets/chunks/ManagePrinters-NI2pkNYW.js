import{d as M,c as D,O as y,f as m,J as l,l as a,u as r,I as ae,G as ne,k as d,E as se,Q as k,a4 as K,a5 as E,a6 as R,a7 as G,R as q,cr as H,r as P,w as z,a as Q,e as S,b7 as re,n as oe,m as A,V as le,$ as J,X as U,bF as ie,ak as de,F as ue,P as ce,K as fe,N as W,p as me}from"./vendor-BataJFSH.js";import{aE as pe,n as j,aF as B,M as $,aG as Y,t as ve,S as x,Y as Z,_ as L,g as _e,w as F,o as ge,K as X,aH as Pe,T as be}from"../index-CYcjB3lE.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-BVd6_RNM.js";const ye={style:{display:"flex","justify-content":"space-between"}},Ie={style:{"max-width":"500px",margin:"auto"}},De=M({__name:"AddWebPrinter",setup(V){const{formRef:c}=pe(),p=D(()=>[{componentType:"inputField",header:"Print name",name:"printer_name",icon:j.print,validation:i=>B.required(i)},{componentType:"inputField",header:"Printer IP address",name:"ip_address",icon:j.networkBarDark,validation:i=>B.required(i)},{componentType:"inputField",header:"Port",name:"port",validation:i=>B.required(i)}]),f=()=>{q.dismiss()},u=async()=>{var _,b;const i=(_=c.value)==null?void 0:_.getFormValues();if(((b=c.value)==null?void 0:b.validateForm())!=null){ve("Please fill in all required fields");return}const o=x.getUserLocationId();i._id="".concat(o,"_").concat(new Date().getTime()),i.location_id=o,i.created_at=x.getSessionDate(),await Z({data:i,storeName:"printer_configurations",command:"upsertDocument"}),q.dismiss()};return(i,o)=>(m(),y(r(G),null,{default:l(()=>[a(r(ae),null,{default:l(()=>[a(r(ne),null,{default:l(()=>[d("div",ye,[a(r(se),null,{default:l(()=>[...o[2]||(o[2]=[k("Add Web Printer",-1)])]),_:1}),a($,{name:"X",style:{"margin-right":"10px"},onClick:o[0]||(o[0]=_=>f())})])]),_:1})]),_:1}),a(r(K),{class:"ion-padding"},{default:l(()=>[d("div",Ie,[a(r(E),null,{default:l(()=>[a(r(R),{size:"12"},{default:l(()=>[a(Y,{formData:p.value,ref_key:"formRef",ref:c},null,8,["formData"])]),_:1})]),_:1}),a(r(E),{class:"ion-justify-content-end ion-margin-top"},{default:l(()=>[a(r(R),{size:"auto"},{default:l(()=>[a($,{name:"Add printer",onClick:o[1]||(o[1]=_=>u())})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),ke=L(De,[["__scopeId","data-v-66b9d9c4"]]),Se={class:"page-wrapper"},he={class:"table-header"},we={class:"default-printer"},Te={class:"table-responsive"},Ce={key:0,class:"loading-state"},Fe={key:1,class:"empty-state"},$e=M({__name:"ManageIPPrinters",setup(V){const c=H(),p=P([]),f=P(!1),u=P(null),i=D(()=>({paging:!0,searching:!1,ordering:!0,responsive:!0,pageLength:8,rowId:"_id"})),o=D(()=>[{data:0,title:"Printer name"},{data:1,title:"IP address"},{data:2,title:"Port"},{data:3,title:"Date"},{data:4,title:"Actions",orderable:!1}]),_=D(()=>[{componentType:"multiSelectInputField",value:x.getDefaultPrinter()||"",trackBy:"id",options:p.value.map(e=>({id:e._id,name:e.printer_name,ip_address:e.ip_address})),onChange:e=>{localStorage.setItem("defaultPrinter",JSON.stringify(e))}}]),b=D(()=>p.value.map(e=>[e.printer_name,e.ip_address,e.port,h(e),I(e._id)])),h=e=>e.created_at?new Date(e.created_at).toLocaleDateString():"—",I=e=>'\n    <div class="action-buttons">\n        <button\n            class="btn btn-sm btn-primary edit-btn"\n            data-action="test"\n            data-id="'.concat(e,'"\n        >\n            Test\n        </button>\n        <button\n            class="btn btn-sm btn-danger delete-btn"\n            data-action="delete"\n            data-id="').concat(e,'"\n        >\n            Delete\n        </button>\n    </div>\n'),w=()=>{oe(()=>{var s;const e=(s=u.value)==null?void 0:s.dt;e&&(e.off("click","button[data-action]"),e.on("click","button[data-action]",g=>{const C=g.target,O=C.dataset.action,ee=C.dataset.id,N=p.value.find(te=>te._id===ee);N&&(O==="test"&&n(N),O==="delete"&&t(N))}))})},v=async()=>{f.value=!0;try{const e=await _e("printer_configurations",{selector:{location_id:{$eq:x.getUserLocationId()}}});p.value=e,w()}catch(e){console.error(e),F("Failed to load printers")}finally{f.value=!1}},T=async()=>{await ge(ke,{class:"large-modal"},!0),await v()},t=async e=>{if(confirm("Delete printer ".concat(e.printer_name,"?")))try{await Z({data:{_id:e._id},storeName:"printer_configurations",command:"deleteData"}),X("Printer deleted"),await v()}catch(s){F("Delete failed")}},n=async e=>{const s="^XA\n^FO50,50^A0N,40,40^FDTest Print^FS\n^FO50,100^FD".concat(e.printer_name,"^FS\n^XZ");try{(await fetch("http://".concat(e.ip_address,":").concat(e.port,"/print"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({zpl:s})})).ok?X("Test print sent"):F("Printer rejected request")}catch(g){F("Printer not reachable")}};return z(c,v),z(b,w),Q(v),(e,s)=>(m(),S("div",Se,[d("div",he,[s[1]||(s[1]=d("h3",{class:"encounter-title"},"Manage Web Printers",-1)),d("div",we,[s[0]||(s[0]=d("span",{class:"label"},"Default Printer",-1)),a(Y,{formData:_.value},null,8,["formData"])]),a($,{name:"Add printer",fill:"solid",disabled:f.value,onClick:T},null,8,["disabled"])]),d("div",Te,[f.value?(m(),S("div",Ce,"Loading printers…")):p.value.length===0?(m(),S("div",Fe,[s[2]||(s[2]=d("p",null,"No printers configured",-1)),a($,{name:"Add printer",onClick:T})])):(m(),y(r(re),{key:2,ref_key:"dataTableRef",ref:u,class:"display nowrap modern-table",width:"100%",data:b.value,columns:o.value,options:i.value},{default:l(()=>[...s[3]||(s[3]=[d("thead",null,[d("tr",null,[d("th",null,"Printer name"),d("th",null,"IP address"),d("th",null,"Port"),d("th",null,"Date"),d("th",null,"Actions")])],-1)])]),_:1},8,["data","columns","options"]))])]))}}),xe=L($e,[["__scopeId","data-v-70782a29"]]),Ne={key:0,class:"spinner-overlay"},Ae={class:"container"},Be=M({__name:"ManagePrinters",setup(V){H();const c=P(!1),p=P(Math.random()),f=P([]),u=P({}),i=new Pe,o=P(!1);function _(){try{localStorage.setItem("isIpPrinters",JSON.stringify(o.value)),console.log("isIpPrinters state saved:",o.value)}catch(t){console.error("Error saving isIpPrinters state to localStorage:",t)}}function b(){try{const t=localStorage.getItem("isIpPrinters");t!==null&&(o.value=JSON.parse(t),console.log("isIpPrinters state loaded:",o.value))}catch(t){console.error("Error loading isIpPrinters state from localStorage:",t)}}async function h(){if(!c.value){c.value=!0;try{const t=await i.getAllPrinters();console.log("Discovered printers",JSON.stringify(t)),f.value=T(t)}catch(t){console.error("Error loading printers:",t)}finally{c.value=!1,p.value=Math.random()}}}function I(t,n){const e=t.name||"",s=n.name||"",g=t.address||"",C=n.address||"";return e!==s?e.localeCompare(s):g.localeCompare(C)}function w(t){i.setDefaultPrinter(t),u.value=t,p.value=Math.random(),h()}function v(t){return I(t,u.value)===0}function T(t){return t.sort((n,e)=>{const s=v(n),g=v(e);return s&&!g?-1:!s&&g?1:I(n,e)})}return Q(async()=>{b(),u.value=await i.getDefaultPrinter()||{},u.value&&(u.value.name||u.value.address)&&(f.value.some(n=>I(n,u.value)===0)||f.value.push(u.value)),h()}),(t,n)=>(m(),y(r(G),{class:me({loading:c.value})},{default:l(()=>[c.value?(m(),S("div",Ne,[a(r(le),{name:"bubbles"}),n[1]||(n[1]=d("div",{class:"loading-text"},"Please wait...",-1))])):A("",!0),a(be),a(r(K),null,{default:l(()=>[d("div",Ae,[n[5]||(n[5]=d("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Printer Management",-1)),a(r(J),null,{default:l(()=>[a(r(U),null,{default:l(()=>[...n[2]||(n[2]=[k("Use IP Printers",-1)])]),_:1}),a(r(ie),{modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=e=>o.value=e),onIonChange:_},null,8,["modelValue"])]),_:1}),o.value?A("",!0):(m(),y(r(de),{key:0},{default:l(()=>[(m(!0),S(ue,null,ce(f.value,e=>(m(),y(r(J),{key:e.name||e.address||"unknown-printer"},{default:l(()=>[a(r(U),null,{default:l(()=>[k(fe(e.name||e.address||"Unnamed Printer"),1)]),_:2},1024),a(r(W),{size:"small",color:v(e)?"success":"primary",onClick:s=>w(e),disabled:v(e)},{default:l(()=>[...n[3]||(n[3]=[k(" Set as Default ",-1)])]),_:1},8,["color","onClick","disabled"]),a(r(W),{onClick:s=>r(i).printTestLbl(e),size:"small"},{default:l(()=>[...n[4]||(n[4]=[k(" Test Print ",-1)])]),_:1},8,["onClick"])]),_:2},1024))),128))]),_:1})),o.value?(m(),y(xe,{key:1,style:{"margin-top":"10px"}})):A("",!0)])]),_:1})]),_:1},8,["class"]))}}),Ee=L(Be,[["__scopeId","data-v-8151b8bf"]]);export{Ee as default};

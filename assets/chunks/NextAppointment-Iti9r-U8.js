import{d as H,aV as At,r as F,a as nt,H as b,O as z,f as l,J as i,l as s,k as r,e as v,P as st,F as X,m as k,u as _,ah as W,b5 as bt,b2 as mt,G as ht,E as gt,ai as ft,aj as _t,_ as Q,I as vt,a3 as yt,bf as Ct,aU as wt,Q as x,L as tt,W as at,a5 as Lt,p as G,K as L,c as q,aS as Et,aR as kt,aw as Ot,aP as Bt,N as it,a2 as Nt,w as $t,bv as Pt,bo as Rt,bQ as Mt,aN as Ft}from"./vendor-ypQu15BZ.js";import{O as U,bm as ot,t as rt,aW as xt,S as w,l as j,_ as K,J as Dt,b5 as Tt,B as It,bd as Ht,M as R,o as lt,aQ as et,aH as dt,H as A,u as J,V as Vt,aR as Ut,bn as zt,bo as qt,aq as Gt,bp as M,A as Y,bq as Wt,m as Kt,b8 as Yt,e as Xt,ay as Z,y as Qt,az as jt,P as Jt,a as ct}from"../index-BSR37024.js";import{D as Zt}from"./DashBox-BBus9pOg.js";import{B as T}from"./BasicForm-BeHwFu0x.js";import te from"./LabOrdersList-BZZI_2TE.js";import{v as ut}from"./group_validation-CMgtbVup.js";import{u as ee}from"./RadiologyStore-CTyTGBx5.js";import{b as ne,d as pt}from"./useFormWizard-s4iaG4AA.js";import{A as se}from"./ncd_appointment_service-C8UsdkHO.js";import{D as ae}from"./DateInputField-Cg8v3fJ0.js";class ie extends U{constructor(){super()}async postActivities(e,n){const p=n.location_id,m=await new ot(parseInt(e),-1,p).createEncounter();if(m){const g=await U.buildLabOrders(m,n.orders||n);if(!await U.saveOrdersArray(m.encounter_id,g))return rt("Unable to save lab orders")}}async postAHDActivities(e,n){const p=n.location_id,m=await new ot(parseInt(e),-1,p).createEncounter(xt.AHD_LAB_ORDERS);if(m){const g=await U.buildLabOrders(m,n.orders||n);if(!await U.saveOrdersArray(m.encounter_id,g))return rt("Unable to save lab orders")}}}const oe=H({data:()=>({userRole:"",ready:!1,userRoleSettings:{}}),watch:{$route:{async handler(t){this.userRole=w.getUserRoles();const e=w.getProgramID(),n=w.getProgramName();this.userRole=="Lab"&&e==14&&(this.userRoleSettings={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}),e==14&&this.userRole!="Lab"&&(this.userRoleSettings={url:"home",btnName:"Go to waiting list",stepperTitle:"Consultation Plan"}),e==12&&(this.userRoleSettings={url:"contact",btnName:"Back"}),n=="LABOUR AND DELIVERY PROGRAM"&&(this.userRoleSettings={url:"labour/labourHome",btnName:"Back to home"}),n=="PNC PROGRAM"&&(this.userRoleSettings={url:"pnc/home",btnName:"Back to home"})},immediate:!0,deep:!0}}}),re=["innerHTML"],le={class:"scrollable-container"},de={key:0,class:"form-section"},ce={key:1,class:"form-section"},ue={key:2,class:"form-section"},pe={key:3,class:"form-section"},me={key:4,class:"form-section"},he={key:5,class:"form-section"},ge={key:6,class:"form-section"},fe={key:7,class:"form-section"},_e=H({__name:"RadiologyInvestigation",setup(t){const e=ee(),{head:n,neck:p,chest:y,abdomen:m,upper_extremity:g,spine:c,pelvis:D,lower_extremity:f}=At(e),I=F(j),S=F([]),h=(E,d,O)=>{document.querySelectorAll("#".concat(E," path")).forEach(a=>{a.classList.toggle("white-fill")}),document.querySelectorAll("#".concat(d," line")).forEach(a=>{a.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(d," rect")).forEach(a=>{a.classList.toggle("bright-green-fill"),a.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(d," path")).forEach(a=>{a.classList.toggle("dark-green-fill")}),document.querySelectorAll("#".concat(d," circle")).forEach(a=>{a.classList.toggle("bright-green-fill")});const B=S.value.findIndex(a=>a.id===O);B>=0?S.value.splice(B,1):S.value.unshift({id:O,active:!0})},V=()=>{const E=document.getElementById("SPINE");E.style.display==="none"||E.style.display==""?E.style.display="block":E.style.display="none",h("SPINE","SPINE_LABEL-2","spine")};return nt(()=>{const E=document.getElementById("HEAD");E&&E.addEventListener("click",()=>{h("HEAD","LABEL-6","head")});const d=document.getElementById("NECK");d&&d.addEventListener("click",()=>{h("NECK","LABEL-5","neck")});const O=document.getElementById("CHEST");O&&O.addEventListener("click",()=>{h("CHEST","LABEL-4","chest")});const B=document.getElementById("ABDOMEN_LABEL");B&&B.addEventListener("click",()=>{const P=document.getElementById("ABDOMEN-2");P.style.display==="none"||P.style.display==""?P.style.display="block":P.style.display="none",h("ABDOMEN","ABDOMEN_LABEL-2","abdomen")});const a=document.getElementById("UPPER_EXTRMITY");a&&a.addEventListener("click",()=>{h("UPPER_EXTRMITY","LABEL-3","upper_extremity")});const o=document.getElementById("SPINE"),u=document.getElementById("SPINE_LABEL"),C=document.getElementById("LOWER_SPINE_INACTIVE");o&&o.addEventListener("click",()=>{V()}),u&&u.addEventListener("click",()=>{V()}),C&&C.addEventListener("click",()=>{V()});const N=document.getElementById("PELVIS");N&&N.addEventListener("click",()=>{h("PELVIS","LABEL-2","pelvis")});const $=document.getElementById("LOWER_EXTREMITY");$&&$.addEventListener("click",()=>{h("LOWER_EXTREMITY","LABEL","lower_extremity")})}),(E,d)=>{const O=b("ion-col"),B=b("ion-row");return l(),z(B,null,{default:i(()=>[s(O,{size:"7"},{default:i(()=>[r("div",{innerHTML:I.value.full_body_sk},null,8,re)]),_:1}),s(O,{size:"5",class:"form-column"},{default:i(()=>[r("div",le,[(l(!0),v(X,null,st(S.value,a=>(l(),v(X,null,[a.id==="head"?(l(),v("div",de,[d[0]||(d[0]=r("h6",null,"Body Part: Head",-1)),s(T,{contentData:_(n)},null,8,["contentData"])])):a.id==="neck"?(l(),v("div",ce,[d[1]||(d[1]=r("h6",null,"Body Part: Neck",-1)),s(T,{contentData:_(p)},null,8,["contentData"])])):a.id==="chest"?(l(),v("div",ue,[d[2]||(d[2]=r("h6",null,"Body Part: Chest",-1)),s(T,{contentData:_(y)},null,8,["contentData"])])):a.id==="abdomen"?(l(),v("div",pe,[d[3]||(d[3]=r("h6",null,"Body Part: Abdomen",-1)),s(T,{contentData:_(m)},null,8,["contentData"])])):a.id==="upper_extremity"?(l(),v("div",me,[d[4]||(d[4]=r("h6",null,"Body Part: Upper Extremity",-1)),s(T,{contentData:_(g)},null,8,["contentData"])])):a.id==="spine"?(l(),v("div",he,[d[5]||(d[5]=r("h6",null,"Body Part: Spine",-1)),s(T,{contentData:_(c)},null,8,["contentData"])])):a.id==="pelvis"?(l(),v("div",ge,[d[6]||(d[6]=r("h6",null,"Body Part: Pelvis",-1)),s(T,{contentData:_(D)},null,8,["contentData"])])):a.id==="lower_extremity"?(l(),v("div",fe,[d[7]||(d[7]=r("h6",null,"Body Part: Lower Extremity",-1)),s(T,{contentData:_(f)},null,8,["contentData"])])):k("",!0)],64))),256))])]),_:1})]),_:1})}}}),ve=K(_e,[["__scopeId","data-v-5ab54fe8"]]),ye=H({name:"Menu",mixins:[oe],components:{IonContent:yt,IonHeader:vt,IonItem:Q,IonList:_t,IonMenu:ft,IonTitle:gt,IonToolbar:ht,IonInput:mt,IonPopover:bt,DashBox:Zt,SelectionPopover:Ht,BasicInputField:It,BasicForm:T,List:Tt,DynamicButton:Dt,LabOrdersList:te,RadiologyInvestigation:ve},data(){return{segmentContent:"Lab Investigations",iconsContent:j,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",testResult:"",test:"",labOrders:"",filteredSpecimen:"",testData:[],popoverOpen:!1,labOrderStatus:!1,event:"",specimen:"",radiologyOrdersStatus:!1,otherOrdersStatus:!1}},setup(){return{checkmark:wt,pulseOutline:Ct}},computed:{...W(dt,["investigations"]),...W(J,["patient"]),inputFields(){return this.investigations[0].data.rowData[0].colData}},watch:{investigations:{handler(){this.setDashedBox()},deep:!0},patient:{async handler(){var t;(t=this.patient)!=null&&t.labOrders&&(this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved])},deep:!0},$route:{async handler(){await this.getTests()},deep:!0}},async mounted(){await this.getTests(),this.updateInvestigationsStores(),this.setDashedBox(),this.updateInvestigationWizard()},methods:{setSegmentContent(t){this.segmentContent=t},async getTests(){let t;w.getPouchDbStatus()&&w.getLanConnectionStatus()?t=await lt("test_types"):t=await U.getTestTypes(),R(this.investigations,"test","multiSelectData",t)},toggleLabOrderStatus(){this.labOrderStatus=!this.labOrderStatus},async updateInvestigationWizard(){var e;if(!((e=this.patient)!=null&&e.labOrders))return;this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved];const t=await this.labOrders.filter(n=>A.toStandardHisFormat(A.sessionDate())===A.toStandardHisFormat(n.order_date));t.length>0?this.investigations[0].selectedData=t:this.investigations[0].selectedData=""},async updateInvestigationsStores(){await this.updateInvestigationWizard(),dt().setInvestigations(this.investigations)},displayInputFields(){this.testResult="",this.selectedText="",this.no_item=!1,this.addItemButton=!1,this.search_item=!0},async validateRowData(){return ut(this.investigations)},async checkTest(){return await this.isNameInData(this.inputFields[0].value.name,await this.investigations[0].selectedData)?(R(this.investigations,"test","alertsErrorMassage","Lab order already selected"),!1):(R(this.investigations,"test","alertsErrorMassage",""),!0)},async addNewRow(){ut(this.investigations)&&await this.checkTest()&&(await this.saveTest(),this.investigations[0].data.rowData[0].colData[0].value="",this.investigations[0].data.rowData[0].colData[1].value="",this.search_item=!1,this.display_item=!0,this.addItemButton=!0),this.updateInvestigationWizard()},isNameInData(t,e){for(let n of e)for(let p of n.tests)if(p.name===t)return!0;return!1},async saveTest(){await new ie().postActivities(this.patient.patientID,[{concept_id:this.inputFields[0].value.concept_id,name:this.inputFields[0].value.name,specimen:this.inputFields[1].value.name,reason:"Routine",specimenConcept:await et.getConceptID(this.inputFields[1].value.name,!0)}]),R(this.investigations,"specimen","disabled",!0),this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved]},async handleInputData(t){if(t.inputHeader=="Test"&&this.checkTest(),R(this.investigations,"specimen","alertsErrorMassage",""),t.inputHeader=="Test"&&t.value){let e;w.getPouchDbStatus()&&w.getLanConnectionStatus()?e=await lt("specimens"):e=await U.getSpecimens("",1e3),this.specimen=await et.getConceptSet(t.value.name,"",{names:e.map(n=>n.name)}),this.specimen.length==1?(R(this.investigations,"specimen","value",this.specimen[0]),R(this.investigations,"specimen","disabled",!0)):(R(this.investigations,"specimen","value",""),R(this.investigations,"specimen","disabled",!1)),R(this.investigations,"specimen","multiSelectData",this.specimen)}},async filterTest(t){return await this.labOrders.filter(e=>e.name.toLowerCase().includes(t.toLowerCase()))},async filterSpecimen(t){var e;return(e=this.specimen[0])!=null&&e.name&&t?await this.specimen.filter(n=>n==null?void 0:n.name.toLowerCase().includes(t.toLowerCase())):[]},setTest(t){this.selectedText=t.name,this.inputFields[1].inputHeader=="Test"?this.investigations[0].data.rowData[0].colData[0].value=t.name:this.investigations[0].data.rowData[0].colData[1].value=t.name,this.updateInvestigationsStores()},setDashedBox(){(this.inputFields[1].value||this.inputFields[0].value)&&(this.addItemButton=!1,this.search_item=!0,this.no_item=!1),this.investigations[0].selectedData.length>0?(this.display_item=!0,this.no_item=!1):this.search_item||(this.no_item=!0)}}}),De={class:"background"},Ie={key:0},Se={key:1},Ae={key:2},be={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},Ce={key:3},we={class:"ion-padding",slot:"content"},Le={key:4};function Ee(t,e,n,p,y,m){const g=b("ion-label"),c=b("ion-segment-button"),D=b("ion-segment"),f=b("VisitsHistory"),I=b("LabOrdersList"),S=b("RadiologyInvestigation");return l(),v("div",De,[s(D,{value:t.segmentContent,style:{"margin-top":"5px"}},{default:i(()=>[s(c,{value:"Lab Investigations",onClick:e[0]||(e[0]=h=>t.setSegmentContent("Lab Investigations"))},{default:i(()=>[s(g,null,{default:i(()=>[...e[3]||(e[3]=[x("Lab Investigations",-1)])]),_:1})]),_:1}),s(c,{value:"Radiology Investigation",onClick:e[1]||(e[1]=h=>t.setSegmentContent("Radiology Investigation"))},{default:i(()=>[s(g,null,{default:i(()=>[...e[4]||(e[4]=[x("Radiology Investigation",-1)])]),_:1})]),_:1}),s(c,{value:"Other Investigation",onClick:e[2]||(e[2]=h=>t.setSegmentContent("Other Investigation"))},{default:i(()=>[s(g,null,{default:i(()=>[...e[5]||(e[5]=[x("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),t.segmentContent=="Radiology Investigation"?(l(),v("div",Ie,[s(f)])):k("",!0),t.segmentContent=="Other Investigation"?(l(),v("div",Se)):k("",!0),t.segmentContent=="Lab Investigations"?(l(),v("div",Ae,[r("div",be,[r("span",null,[s(I,{propOrders:t.labOrders},null,8,["propOrders"])])])])):k("",!0),t.segmentContent=="Radiology Investigation"?(l(),v("div",Ce,[r("div",we,[s(S)])])):k("",!0),t.segmentContent=="Other Investigation"?(l(),v("div",Le)):k("",!0)])}const dn=K(ye,[["render",Ee],["__scopeId","data-v-0803dcda"]]),ke=H({created(){},components:{IonItem:Q,IonCol:Lt,IonLabel:at,IonIcon:tt},data(){return{iconsContent:j,localMedicalDrugsList:[...this.$props._selectedMedicalDrugsList]}},props:{_selectedMedicalDrugsList:{type:Array,default:[]},show_actions_buttons:{type:Boolean,default:!0},highLightBackground:{type:String,default:"item-native"}},watch:{},methods:{highlightItem(t){const e=document.getElementById(t+"_lbl");e&&(e.style.color="#006401"),this.highlightActionBtns(t)},undoHighlightItem(t){const e=document.getElementById(t+"_lbl");e&&(e.style.color="#636363"),this.undohighlightActionBtns(t)},highlightActionBtns(t){const e=document.getElementsByClassName(t+"_spanlbl");for(let n=0;n<e.length;n++)e[n].style.display="inline-block"},undohighlightActionBtns(t){const e=document.getElementsByClassName(t+"_spanlbl");for(let n=0;n<e.length;n++)e[n].style.display="none"},asignLblID(t){return t+"_lbl"},asignSpanLblID(t){return t+"_spanlbl"},async removeItemAtIndex(t,e){await Vt("Do you want to delete it?",e)&&this.$emit("remove-item",t)},editItemAtIndex(t){this.$emit("edit-item",t)},highLightBnd(t){if(t){if(t.highlightbackground!==void 0&&t.highlightbackground==!0)return this.$props.highLightBackground}else return!1}}}),Oe=["onMousemove","onMouseout"],Be={class:"route-label"};function Ne(t,e,n,p,y,m){const g=b("ion-label"),c=b("ion-col"),D=b("ion-row"),f=b("ion-icon");return l(!0),v(X,null,st(t.localMedicalDrugsList,(I,S)=>(l(),v("div",{id:"df",class:"medication-item",key:S,onMousemove:h=>t.highlightItem(S),onMouseout:h=>t.undoHighlightItem(S)},[s(D,{class:"medication-header"},{default:i(()=>[s(c,{class:G(["ion-text-wrap",t.highLightBnd(I)])},{default:i(()=>[s(g,{id:t.asignLblID(S),class:"medication-name"},{default:i(()=>[x(L(I.drugName),1)]),_:2},1032,["id"])]),_:2},1032,["class"])]),_:2},1024),s(D,{class:"medication-details"},{default:i(()=>[s(c,{size:"10",class:G(["ion-text-wrap details-col",t.highLightBnd(I)])},{default:i(()=>[s(g,{class:"details-text"},{default:i(()=>[x(L(I.dose)+" / "+L(I.frequency)+" / daily / "+L(I.duration)+" / until "+L(I.prescription)+" ",1),r("span",Be,L(I.route_name),1)]),_:2},1024)]),_:2},1032,["class"]),t.show_actions_buttons?(l(),z(c,{key:0,class:G([t.highLightBnd(I),"actions-col"]),size:"2"},{default:i(()=>[s(g,{class:G(["action-button",t.asignSpanLblID(S)]),onClick:h=>t.editItemAtIndex(S)},{default:i(()=>[s(f,{icon:t.iconsContent.edit},null,8,["icon"])]),_:1},8,["class","onClick"]),s(g,{class:G(["action-button",t.asignSpanLblID(S)]),onClick:h=>t.removeItemAtIndex(S,h)},{default:i(()=>[s(f,{icon:t.iconsContent.delete},null,8,["icon"])]),_:1},8,["class","onClick"])]),_:2},1032,["class"])):k("",!0)]),_:2},1024)],40,Oe))),128)}const cn=K(ke,[["render",Ne],["__scopeId","data-v-01c693a3"]]),$e={key:0,class:"custom-allergy-container"},Pe={class:"button-group"},Re=H({watch:{},name:"AllergiesComponent"}),Me=H({...Re,setup(t){const e=Ut(),n=J(),p=q(()=>e.selectedMedicalAllergiesList),y=q(()=>n.patient),m=q(()=>e.medicalAllergiesList),g=F(d(8,"item-")),c=F(""),D=F(!1),f=[{multi_Selection:!0,show_list_label:!0,unqueId:g.value,name_of_list:"Add/Remove allergies",placeHolder:"Search for an allergy",items:[],listUpdatedFN:h,listFilteredFN:()=>{},searchTextFN:V,use_internal_filter:!0,show_error:F(!1),error_message:"please select a User",disabled:F(!1)}],I=F(!1);nt(async()=>{S()});const S=()=>{e.current_patient.ID!=y.value.ID&&(e.clearSelectedMedicalAllergiesList(),e.setCurrentPatient(y.value))};function h(a){a.forEach(o=>{o.selected==!0&&o.name==="Other"&&(D.value=o.name==="Other"),o.selected==!1&&o.name==="Other"&&B()}),e.setSelectedMedicalAllergiesList(a),E()}async function V(a){const o=a,u=await et.getConceptSet("OPD Medication",o);if(!u)return;u.map(P=>({label:P.name,value:P.name,other:P}));const C=zt(o),$=qt(C,u).sort((P,St)=>P.name.localeCompare(St.name));e.setMedicalAllergiesList($),E()}function E(){const a=m.value;p.value.forEach(u=>{let C=!1;a.forEach((N,$)=>{N.concept_id==u.concept_id&&u.selected===!0&&(a[$]=u,C=!0)}),!C&&u.selected===!0&&a.push(u)});const o=a.filter((u,C,N)=>C===N.findIndex($=>($==null?void 0:$.concept_id)===(u==null?void 0:u.concept_id)));e.setMedicalAllergiesList(o)}function d(a=8,o=""){const u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let C=o;for(let N=0;N<a;N++)C+=u.charAt(Math.floor(Math.random()*u.length));return C+="-".concat(Date.now()),C}async function O(a){try{const o=a.trim();if(o){const u={name:o,selected:!0,concept_id:d(8,"12"),concept_name_id:d(8,"34")};e.setMedicalAllergiesList([...m.value,u]),e.setSelectedMedicalAllergiesList(u),D.value=!1,I.value=!0,c.value="";const C=e.findSelectedAllergyByName("Other");e.unselectOther(C)}}catch(o){console.error(o)}}const B=()=>{D.value=!1,c.value="",I.value=!1;const a=e.findSelectedAllergyByName("Other");a&&e.unselectOther(a)};return(a,o)=>(l(),z(_(Et),null,{default:i(()=>[s(_(kt),null,{default:i(()=>[s(_(at),{class:"header-container"},{default:i(()=>[s(_(tt),{icon:_(Ot),class:"allergy-icon"},null,8,["icon"]),o[3]||(o[3]=r("span",{style:{"font-size":"16px","font-weight":"600"}}," Allergies (Medication, Healthcare items, Environment and Food) ",-1))]),_:1})]),_:1}),s(_(Bt),null,{default:i(()=>[s(Gt,{multiSelection:f[0].multi_Selection,show_label:f[0].show_list_label,uniqueId:f[0].unqueId,name_of_list:f[0].name_of_list,choose_place_holder:f[0].placeHolder,"items_-list":m.value,use_internal_filter:f[0].use_internal_filter,disabled:f[0].disabled.value,onItemListUpDated:f[0].listUpdatedFN,onItemListFiltered:f[0].listFilteredFN,onItemSearchText:f[0].searchTextFN},null,8,["multiSelection","show_label","uniqueId","name_of_list","choose_place_holder","items_-list","use_internal_filter","disabled","onItemListUpDated","onItemListFiltered","onItemSearchText"]),D.value?(l(),v("div",$e,[s(_(mt),{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=u=>c.value=u),placeholder:"Please specify the allergy",fill:"outline",class:"custom-input"},null,8,["modelValue"]),r("div",Pe,[s(_(it),{onClick:o[1]||(o[1]=u=>O(c.value)),class:"addCustomAllergyBtn"},{default:i(()=>[...o[4]||(o[4]=[x(" Add Allergy ",-1)])]),_:1}),s(_(it),{onClick:o[2]||(o[2]=u=>B()),fill:"clear",class:"cancelBtn"},{default:i(()=>[s(_(tt),{icon:_(Nt),slot:"icon-only"},null,8,["icon"])]),_:1})])])):k("",!0)]),_:1})]),_:1}))}}),un=K(Me,[["__scopeId","data-v-3314535a"]]),Fe={class:"checklist-container"},xe=H({watch:{},name:"xxxComponent"}),Te=H({...xe,setup(t){const e=J(),n=q(()=>e.patient),p=ne(),y=p.items;nt(async()=>{m()});const m=()=>{p.current_patient.ID!=n.value.ID&&(p.clearSelectednonPharmaTherapyStore(),p.setCurrentPatient(n.value))};return $t(()=>n.value,async g=>{}),(g,c)=>(l(),v("div",Fe,[(l(!0),v(X,null,st(_(y),D=>(l(),z(_(Q),{key:D.id,class:"no-border"},{default:i(()=>[s(_(Pt),{id:D.id,modelValue:D.checked,"onUpdate:modelValue":f=>D.checked=f,slot:"start"},null,8,["id","modelValue","onUpdate:modelValue"]),s(_(at),{style:{"font-size":"16px","font-weight":"600"}},{default:i(()=>[x(L(D.label),1)]),_:2},1024)]),_:2},1024))),128))]))}}),pn=K(Te,[["__scopeId","data-v-371e920f"]]),He=H({components:{IonContent:yt,IonHeader:vt,IonItem:Q,IonList:_t,IonMenu:ft,IonTitle:gt,IonToolbar:ht,BasicInputField:It,IonDatetime:Mt,IonBadge:Rt,DateInputField:ae,DynamicButton:Dt},props:{showPeripheral:{type:Boolean,default:!0}},setup(t){const e=Z(),n=F(0),p=q(()=>e.getDisabledDates()),y=q(()=>e.getAssignedAppointments()),m=F(),g=q(()=>t.showPeripheral);return{disabledDates:p,datesCounts:y,appointment_count:n,calendarOutline:Ft,inputPRDate:m,show_peripheral:g}},data(){return M(),ct(),{iconsContent:j,date:new Date(w.getSessionDate()),tomorrow:new Date(w.getSessionDate()).getDate()+1,appointment:"",drugRunoutDate:"",nextAppointmentDate:"",minDate:new Date(w.getSessionDate())}},computed:{...W(M,["nextAppointment","appointmentCountsCache","currentSelectedNextAppointmentDate"]),...W(Z,["maximumNumberOfDaysForEachDay","assignedAppointmentsDates"]),...W(J,["patient"]),...W(ct,["activeProgram"]),calendarDate(){const t=M();return t.currentSelectedNextAppointmentDate?A.toStandardHisDisplayFormat(t.currentSelectedNextAppointmentDate):""},runOutDate(){var e;const t=M();return((e=this.activeProgram)==null?void 0:e.program_id)===14?pt():t.getAppointmentMedicationRunOutDate()}},watch:{calendarDate:{handler(){this.updateNextAppointment()},deep:!0},"$service.sessionDate":{handler(){this.updateMinDate()},immediate:!0},"patient.ID":{async handler(t,e){t!==e&&(this.cleanCurrentNextAppointmentDate(),this.checkIfSamePatientInContext(),this.clearNextAppointment())}}},async mounted(){this.checkIfSamePatientInContext(),await this.getAppointmentMents(this.runOutDate.date),await Qt().loadGlobalProperty(),this.validateAppointmentCountsCache(),await this.preloadAppointmentCounts(),jt();const t=w.getUserID(),e=new Jt;this.appointment=new Y(e.getID(),t),this.nextAppointmentDate=this.appointment.date,this.supposedRunOutDate(),window.addEventListener("storage",this.handleStorageChange),pt()},beforeUnmount(){window.removeEventListener("storage",this.handleStorageChange)},methods:{handleStorageChange(t){t.key==="sessionDate"&&this.updateMinDate()},updateMinDate(){this.date=new Date(w.getSessionDate()),this.minDate=new Date(w.getSessionDate())},updateNextAppointment(){M().setNextAppointment(this.calendarDate)},async handleDateUpdate(t){t&&(Z().setAssignedAppointmentsDates(t,!0),this.calendarDate=A.toStandardHisDisplayFormat(t),await this.save(),await this.getAppointmentMents(t),await this.updateAppointmentCache(t),M().setCurrentSelectedNextAppointmentDate(t,this.patient.ID))},async getAppointmentMents(t){if(Xt().apiStatus)try{const n=await Y.getDailyAppointments(A.toStandardHisFormat(t),A.toStandardHisFormat(t));this.appointment_count=n.length}catch(n){}},getCounter(t){const e=A.toStandardHisFormat(t);return this.appointmentCountsCache[e]||""},async save(){if(this.assignedAppointmentsDates.length>0)try{const e=await new se().createOfflineAppointment()}catch(t){}},async openCornfirmModal(t){this.calendarDate=A.toStandardHisDisplayFormat(t),await this.getAppointmentMents(t),Kt(Yt,{class:"otherVitalsModal"},!0,{message:"Are you sure you want to add this Appointment?"},{cancel:y=>{},confirm:async y=>{y.detail==!0&&await this.handleDateUpdate(t)}})},async handleInput(t){this.inputPRDate=A.toStandardHisDisplayFormat(t),await this.openCornfirmModal(t)},async supposedRunOutDate(){await Wt.getLastDrugsReceived(this.patient.patientID)},async preloadAppointmentCounts(){try{const t=new Date(w.getSessionDate());t.setDate(1);const e=new Date(w.getSessionDate());e.setMonth(e.getMonth()+2),e.setDate(0);try{const n=await Y.getDailyAppointments(A.toStandardHisFormat(t),A.toStandardHisFormat(e));if(!n)return;const p=this.filterUniqueAppointments(n),y={};p.forEach(m=>{const g=new Date(m.appointment_date),c=A.toStandardHisFormat(g);y[c]||(y[c]=0),y[c]++}),Object.keys(y).forEach(m=>{this.appointmentCountsCache[m]=y[m]})}catch(n){console.error("Error fetching appointments for date range:",n)}}catch(t){console.error("Error in preload process:",t)}},filterUniqueAppointments(t){const e=new Map;return t.forEach(n=>{const p="".concat(n.given_name,"_").concat(n.family_name,"_").concat(n.birthdate,"_").concat(n.appointment_date);e.has(p)||e.set(p,n)}),Array.from(e.values())},async updateAppointmentCache(t){try{const e=A.toStandardHisFormat(t),n=await Y.getDailyAppointments(A.toStandardHisFormat(t),A.toStandardHisFormat(t));if(!n)return;this.appointmentCountsCache[e]=n.length}catch(e){console.error("Error updating appointment cache:",e)}},validateAppointmentCountsCache(){M().checkCurrentLocationIfInContext()},isRunOutDate(t){return!this.runOutDate||!this.runOutDate.date?!1:A.toStandardHisFormat(t)===A.toStandardHisFormat(this.runOutDate.date)},cleanCurrentNextAppointmentDate(){M().cleanCurrentSelectedNextAppointmentDate()},checkIfSamePatientInContext(){const t=M();t.current_patient.ID!=this.patient.ID&&(this.cleanCurrentNextAppointmentDate(),t.setCurrentPatient(this.patient))},clearNextAppointment(){M().clearAppointmentMedicationRunOutDate()}}}),Ve={class:"card_content"},Ue={class:"count-badge"},ze={class:"dates_title"},qe={class:"sub_data"},Ge={class:"dates_title"},We={class:"sub_data"},Ke={class:"dates_title"},Ye={class:"sub_data"},Xe={class:"dates_title"},Qe={class:"sub_data"};function je(t,e,n,p,y,m){const g=b("VueDatePicker"),c=b("ion-col"),D=b("DynamicButton"),f=b("ion-item"),I=b("ion-row"),S=b("DateInputField");return l(),v("div",Ve,[s(I,null,{default:i(()=>[s(c,{"size-sm":"12","size-md":"12","size-lg":"12","size-xl":"8"},{default:i(()=>[s(g,{class:"calender",onDateUpdate:t.openCornfirmModal,inline:"","auto-apply":"","enable-time-picker":!1,"disabled-dates":t.disabledDates,"min-date":t.minDate,modelValue:t.runOutDate.date,"onUpdate:modelValue":e[0]||(e[0]=h=>t.runOutDate.date=h)},{day:i(({day:h,date:V})=>[(l(),v("p",{key:0,class:G({"run-out-date":t.isRunOutDate(V)}),style:{"font-weight":"600","font-size":"20px"}},[r("span",null,[x(L(h),1),r("sup",Ue,L(t.getCounter(V)),1)])],2))]),_:1},8,["onDateUpdate","disabled-dates","min-date","modelValue"])]),_:1}),t.show_peripheral?(l(),z(c,{key:0},{default:i(()=>[s(f,null,{default:i(()=>[r("div",ze,[e[3]||(e[3]=r("div",null,[x("Suggested Next Appointment Date "),r("span",{style:{"font-size":"16px"}},"(Medication run out date)")],-1)),r("div",qe,[x(L(t.runOutDate.formattedDate||"No run out date available")+" ",1),t.runOutDate.formattedDate?(l(),z(D,{key:0,onClick:e[1]||(e[1]=h=>t.handleDateUpdate(t.runOutDate.date)),name:"Set Next Appt.",fill:"solid",iconSlot:"icon-only",style:{float:"right"}})):k("",!0)])])]),_:1}),s(f,null,{default:i(()=>[r("div",Ge,[e[4]||(e[4]=r("div",null,"User set appointment date",-1)),r("div",We,L(t.calendarDate),1)])]),_:1}),s(f,null,{default:i(()=>[r("div",Ke,[e[5]||(e[5]=r("div",null,"Appointments",-1)),r("div",Ye,L(t.appointment_count),1)])]),_:1}),s(f,null,{default:i(()=>[r("div",Xe,[e[6]||(e[6]=r("div",null,"Appointment limit (per/day)",-1)),r("div",Qe,L(t.appointment_count)+"/"+L(t.maximumNumberOfDaysForEachDay),1)])]),_:1})]),_:1})):k("",!0)]),_:1}),t.show_peripheral?(l(),z(I,{key:0},{default:i(()=>[s(c,{size:"4"},{default:i(()=>[s(S,{inputHeader:"Preferred Next Appointment Date",bold:"600",fontSize:"17px",placeholderFontSize:"17px",placeholderFontWeight:"600",unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.inputPRDate,eventType:"",minDate:t.minDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e[2]||(e[2]=h=>t.handleInput(h))},null,8,["icon","inputValue","minDate"])]),_:1})]),_:1})):k("",!0)])}const mn=K(He,[["render",je],["__scopeId","data-v-4e58e0bc"]]);export{un as A,cn as D,dn as I,ie as L,mn as N,ve as R,oe as _,pn as a};

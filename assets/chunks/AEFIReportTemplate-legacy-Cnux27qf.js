System.register(["./vendor-legacy-dVheaJN3.js","../index-legacy-BH8Nn179.js","./vaccines_service-legacy-DV3tvFTq.js","./EIRreportsStore-legacy-BFBab53j.js","./bottomNavBar-legacy-MsAwJaq5.js"],function(e,t){"use strict";var a,n,i,o,r,l,s,c,d,p,u,g,f,m,h,v,y,b,w,_,x,I,P,C,E,k,D,T,A,z,F,R,O,S,B,j,U,L,$,N,V,G,M,H,K,Q,q,W,J,Z,X,Y,ee,te,ae;return{setters:[e=>{a=e.d,n=e.bR,i=e.L,o=e.W,r=e._,l=e.aj,s=e.cv,c=e.aQ,d=e.aP,p=e.E,u=e.M,g=e.I,f=e.aS,m=e.a3,h=e.a5,v=e.a4,y=e.bm,b=e.r,w=e.bw,_=e.c,x=e.a,I=e.w,P=e.aw,C=e.bj,E=e.db,k=e.aF,D=e.aE,T=e.aN,A=e.R,z=e.H,F=e.e,R=e.f,O=e.l,S=e.J,B=e.Q,j=e.K,U=e.k,L=e.O,$=e.m,N=e.F,V=e.P,G=e.ah,M=e.a6,H=e.V},e=>{K=e.B,Q=e.H,q=e._,W=e.P,J=e.u,Z=e.m,X=e.aQ},e=>{Y=e.f,ee=e.h},e=>{te=e.E},e=>{ae=e.B}],execute:function(){var t=document.createElement("style");t.textContent=".person-card[data-v-4ec49661]{border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1);margin-bottom:16px}.card-header[data-v-4ec49661]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}ion-card-title[data-v-4ec49661]{font-size:1.2rem;font-weight:700;margin-bottom:4px}ion-card-subtitle[data-v-4ec49661]{font-size:.9rem;color:var(--ion-color-medium)}.eye-icon[data-v-4ec49661]{font-size:1.5rem;cursor:pointer}ion-icon[data-v-4ec49661]{color:var(--ion-color-primary)}ion-item[data-v-4ec49661]{--padding-start: 0}.error-label[data-v-4ec49661]{color:#b42318;text-transform:none;float:right}.p-inf[data-v-4ec49661]{margin-left:30px}.solid-line[data-v-4ec49661]{border:none;border-top:1px solid black;width:90%;margin:0 10px}.s-inf[data-v-4ec49661]{font-size:16px;color:gray}.loading-spinner[data-v-4ec49661],.error-message[data-v-4ec49661],.no-results[data-v-4ec49661]{display:flex;justify-content:center;align-items:center;height:200px;flex-direction:column}.error-message ion-icon[data-v-4ec49661]{font-size:48px;color:var(--ion-color-danger)}@media(max-width:768px){.person-card[data-v-4ec49661]{margin-bottom:8px}ion-card-title[data-v-4ec49661]{font-size:1rem}.s-inf[data-v-4ec49661]{font-size:14px}}.person-card-23[data-v-4ec49661]{min-width:100%;width:100%;box-sizing:border-box}@media(min-width:768px){.person-card-23[data-v-4ec49661]{min-width:30rem}}@media(min-width:1024px){.person-card-23[data-v-4ec49661]{min-width:30rem}}@media(min-width:1440px){.person-card-23[data-v-4ec49661]{min-width:30rem}}.modalTitle[data-v-4ec49661]{font-size:17px;padding:0;margin-left:16px}[data-v-704cfbc0] ion-content{--background: white}table[data-v-704cfbc0]{width:100%;border-collapse:collapse}th[data-v-704cfbc0],td[data-v-704cfbc0]{padding:8px;text-align:center;border-bottom:1px solid #006401}thead th[data-v-704cfbc0]{background-color:#f3f3f3}th[data-v-704cfbc0]:nth-child(1),td[data-v-704cfbc0]:nth-child(1){border-right:1px solid #006401}#hugo[data-v-704cfbc0]{border-right:0px;text-align:left;background-color:#f3f3f3}tbody td[data-v-704cfbc0]:first-child{border-right:1px solid #006401}tbody td[data-v-704cfbc0]{border-left:none;border-right:none}tbody td[data-v-704cfbc0]{border-bottom:1px solid #acabab}th[data-v-704cfbc0]{background-color:#f2f2f2}tr[data-v-704cfbc0]:nth-child(2n){background-color:#fff}\n/*$vite$:1*/",document.head.appendChild(t);const ne=a({name:"PersonCardComponent",components:{IonGrid:y,IonRow:v,bottomNavBar:ae,IonCol:h,BasicInputField:K,IonContent:m,IonCard:f,IonHeader:g,IonFooter:u,IonTitle:p,IonCardContent:d,IonCardTitle:c,IonCardSubtitle:s,IonList:l,IonItem:r,IonLabel:o,IonIcon:i,IonSpinner:n},props:{people:{type:Array,required:!0},headingText:{type:String,required:!0,default:"Provide heading text"}},setup(e){const t=b(""),a=b(!1),n=b(!1),i=b(""),o=w({page:1,itemsPerPage:6}),r=_(()=>{if(!t.value)return e.people;const a=new RegExp(t.value,"i");return e.people.filter(e=>a.test(e.given_name)||a.test(e.family_name))}),l=_(()=>{const e=(o.page-1)*o.itemsPerPage,t=e+o.itemsPerPage;return r.value.slice(e,t)});return x(()=>{(async()=>{n.value=!0,i.value="";try{await new Promise(e=>setTimeout(e,1e3)),n.value=!1}catch(e){n.value=!1,i.value="Failed to fetch data. Please try again.",console.error("Error fetching data:",e)}})()}),I(t,()=>{o.page=1}),{calendarOutline:T,personOutline:D,locationOutline:k,eyeOutline:E,searchOutline:C,alertCircleOutline:P,searchText:t,searchTextError:a,isLoading:n,error:i,displayPeople:r,paginatedItems:l,getBirthdateAge:Q.getBirthdateAge,searchTextUpdated:e=>{const n=e.target;var i;t.value=n.value,a.value=(i=t.value,!/^[a-zA-Z\s]*$/.test(i)),o.page=1},viewPatientProfile:async e=>{try{const t=await A.getTop();t&&t.dispatchEvent(new CustomEvent("view-client",{detail:{client_id:e}}))}catch(t){console.error("Error viewing patient profile:",t)}},dismiss:async()=>{try{await A.dismiss()}catch(e){console.error("Error dismissing modal:",e)}},handlePaginationUpdate:({page:e,itemsPerPage:t})=>{o.page=e,o.itemsPerPage=t},pagination:o}}}),ie={key:0,class:"loading-spinner"},oe={key:1,class:"error-message"},re={key:2,class:"no-results"},le={key:3,style:{"overflow-y":"auto"}},se={class:"card-header"},ce=e("P",q(ne,[["render",function(e,t,a,n,i,o){const r=z("ion-title"),l=z("ion-col"),s=z("ion-row"),c=z("BasicInputField"),d=z("ion-label"),p=z("ion-header"),u=z("ion-spinner"),g=z("ion-icon"),f=z("ion-card-title"),m=z("ion-item"),h=z("ion-list"),v=z("ion-card-content"),y=z("ion-card"),b=z("ion-content"),w=z("bottomNavBar"),_=z("ion-button"),x=z("ion-footer");return R(),F(N,null,[O(p,null,{default:S(()=>[O(s,null,{default:S(()=>[O(l,{style:{padding:"1px"}},{default:S(()=>[O(r,{class:"modalTitle"},{default:S(()=>[B(j(e.headingText),1)]),_:1})]),_:1})]),_:1}),O(s,null,{default:S(()=>[O(l,{style:{"margin-left":"10px","margin-right":"10px"}},{default:S(()=>[O(c,{placeholder:"Find client",icon:e.searchOutline,inputValue:e.searchText,"onUpdate:inputValue":e.searchTextUpdated,minHeight:40},null,8,["icon","inputValue","onUpdate:inputValue"]),U("div",null,[e.searchTextError?(R(),L(d,{key:0,class:"error-label"},{default:S(()=>[...t[1]||(t[1]=[B(" Only letters allowed ",-1)])]),_:1})):$("",!0)])]),_:1})]),_:1})]),_:1}),O(b,{fullscreen:!0,class:"ion-padding"},{default:S(()=>[e.isLoading?(R(),F("div",ie,[O(u,{name:"crescent"})])):e.error?(R(),F("div",oe,[O(g,{icon:e.alertCircleOutline},null,8,["icon"]),U("p",null,j(e.error),1)])):0===e.paginatedItems.length?(R(),F("div",re,[...t[2]||(t[2]=[U("p",null,"No results found",-1)])])):(R(),F("div",le,[O(s,null,{default:S(()=>[(R(!0),F(N,null,V(e.paginatedItems,a=>(R(),L(l,{style:{width:"900px"},key:a.id},{default:S(()=>[O(y,{class:"person-card"},{default:S(()=>[O(v,{class:"person-card-23"},{default:S(()=>[U("div",se,[U("div",null,[O(f,{style:{"font-size":"16px"}},{default:S(()=>[B(j(a.given_name)+" "+j(a.family_name),1)]),_:2},1024),O(d,{style:{"font-size":"17px"}},{default:S(()=>[B(j(e.getBirthdateAge(a.birthdate)),1)]),_:2},1024)]),O(g,{icon:e.eyeOutline,onClick:t=>e.viewPatientProfile(a.patient_id),class:"eye-icon","aria-label":"View patient profile"},null,8,["icon","onClick"])]),O(h,{lines:"none",style:{"border-radius":"6px"}},{default:S(()=>[O(m,{class:"p-inf"},{default:S(()=>[O(g,{class:"eye-icon",icon:e.personOutline,slot:"start","aria-hidden":"true"},null,8,["icon"]),O(d,null,{default:S(()=>[t[3]||(t[3]=U("span",{class:"s-inf"},"Gender:",-1)),B(" "+j(a.gender),1)]),_:2},1024)]),_:2},1024),t[5]||(t[5]=U("hr",{class:"solid-line"},null,-1)),O(m,{class:"p-inf"},{default:S(()=>[O(g,{class:"eye-icon",icon:e.locationOutline,slot:"start","aria-hidden":"true"},null,8,["icon"]),O(d,null,{default:S(()=>[t[4]||(t[4]=U("span",{class:"s-inf"},"Village:",-1)),B(" "+j(a.city_village),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1}),O(x,{collapse:"fade",class:"ion-no-border"},{default:S(()=>[O(s,null,{default:S(()=>[O(l,null,{default:S(()=>[e.displayPeople.length>0?(R(),L(w,{key:0,style:{"margin-left":"20px","margin-right":"20px"},totalItems:e.displayPeople.length,currentPage:e.pagination.page,itemsPerPage:e.pagination.itemsPerPage,"onUpdate:pagination":e.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])):$("",!0)]),_:1})]),_:1}),O(s,null,{default:S(()=>[O(l,null,{default:S(()=>[O(_,{id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px","margin-left":"20px"},onClick:t[0]||(t[0]=t=>e.dismiss())},{default:S(()=>[...t[6]||(t[6]=[B(" Cancel ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})],64)}],["__scopeId","data-v-4ec49661"]])),de=a({name:"TableComponent",components:{IonContent:m,IonPage:M,IonRow:v,IonCol:h},data:()=>({route:"",vaccines:[],categories:[{name:"Minor AEFIs",cases:[]},{name:"Serious AEFIs",cases:[]}],personsDemoData:b([])}),watch:{$route:{async handler(e){"EIRReport"==e.name&&await this.initReport()},deep:!0}},computed:{...G(te,["start_date","end_date","navigationPayload"])},async mounted(){await this.initReport()},methods:{async initReport(){this.vaccines=await this.UnderFiveImmunizations(),this.categories[0].cases=await this.getAEFIKnownList(this.categories[0].name,this.vaccines),this.categories[1].cases=await this.getAEFIKnownList(this.categories[1].name,this.vaccines),await this.initAefiReport(this.categories)},async initAefiReport(e){try{const t=await ee(this.start_date,this.end_date),a=new Map;t.data.forEach(e=>{const t=a.get(e.concept_id)||new Map;e.drugs.forEach(a=>{const n=t.get(a.drug_inventory_id)||{count:0,personIds:new Set};t.set(a.drug_inventory_id,{count:n.count+1,personIds:new Set(n.personIds).add(e.person_id)})}),a.set(e.concept_id,t)}),e.forEach(e=>{e.cases.forEach(e=>{const t=a.get(e.concept_id);t&&e.data.forEach(e=>{const a=t.get(e.drug_id);a&&(e.count+=a.count,e.personIds=new Set([...e.personIds||[],...a.personIds]))})})}),te().setAEFIReportData({vaccines:this.vaccines,categories:this.categories})}catch(t){console.error("Error in initAefiReport:",t)}},async UnderFiveImmunizations(){const e=[];return(await Y()).forEach(t=>{e.push(t)}),e},async getAEFIKnownList(e,t){const a=[];return(await X.getConceptSet(e)).forEach(e=>{const n=t.map(e=>({...e,count:0}));a.push({concept_id:e.concept_id,name:e.name,data:n})}),a.sort((e,t)=>e.name.localeCompare(t.name)),a},async openPersonCardComponent(e){this.personsDemoData.value=await this.getClientsDemoGraphicData(e);const t=[];this.personsDemoData.value.forEach(e=>{const a={...e[0].person,...e[0].person.addresses[0],...e[0].person.names[0],patient_id:e[0].patient_id};t.push(a)});const a={people:t,headingText:`Immunization (Client Drill Down | ${this.navigationPayload.subTxt})`};Z(ce,{class:"large-modal"},!0,a,{"view-client":e=>{this.openPatientProfile(e.detail.client_id)}})},async openPatientProfile(e){this.personsDemoData.value.forEach(async t=>{if(t[0].patient_id==e)return await J().setPatientRecord(t[0]),void this.$router.push("patientProfile")})},async getClientsDemoGraphicData(e){try{const t=Array.from(e).map(async e=>{try{const t=await W.findByID(e);return t&&t.patient_identifiers&&0!==t.patient_identifiers.length?await W.findByNpid(t.patient_identifiers[0].identifier):(console.warn(`No patient data or identifiers found for client ID: ${e}`),null)}catch(t){return console.error(`Error processing client ID ${e}:`,t),null}});return(await Promise.all(t)).filter(e=>null!==e)}catch(t){throw console.error("Error in getClientsDemoGraphicData:",t),t}}}}),pe=["colspan"],ue=["onClick"],ge=e("A",q(de,[["render",function(e,t,a,n,i,o){const r=z("ion-col"),l=z("ion-row");return R(),F(N,null,[O(l,null,{default:S(()=>[O(r,null,{default:S(()=>[...t[0]||(t[0]=[U("h1",{style:{width:"100%","text-align":"left","font-weight":"400"}},"Adverse Events Following Immunization - AEFI",-1)])]),_:1})]),_:1}),U("table",null,[(R(!0),F(N,null,V(e.vaccines,(t,a)=>(R(),F("colgroup",{key:a},[U("col",{style:H({width:100/e.vaccines.length+"%"})},null,4)]))),128)),U("thead",null,[U("tr",null,[t[1]||(t[1]=U("th",null,"Cases",-1)),(R(!0),F(N,null,V(e.vaccines,e=>(R(),F("th",{key:e},j(e.name),1))),128))])]),U("tbody",null,[(R(!0),F(N,null,V(e.categories,t=>(R(),F(N,{key:t.name},[U("tr",null,[U("td",{colspan:e.vaccines.length+1,id:"hugo"},[U("strong",null,j(t.name),1)],8,pe)]),(R(!0),F(N,null,V(t.cases,t=>(R(),F("tr",{key:t.name},[U("td",null,j(t.name),1),(R(!0),F(N,null,V(t.data,t=>(R(),F("td",{key:t},[U("div",{style:{cursor:"pointer"},onClick:a=>e.openPersonCardComponent(t.personIds)},j(t.count),9,ue)]))),128))]))),128))],64))),128))])])],64)}],["__scopeId","data-v-704cfbc0"]])),fe=Object.freeze(Object.defineProperty({__proto__:null,default:ge},Symbol.toStringTag,{value:"Module"}));e("a",fe)}}});

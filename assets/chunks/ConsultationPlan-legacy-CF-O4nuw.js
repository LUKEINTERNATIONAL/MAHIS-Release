System.register(["./vendor-legacy-BV-WGgzk.js","./nonPharmaTherapyStore-legacy-Dide5aYZ.js","../index-legacy-BjCoULK2.js","./DemographicBar-legacy-DLgbbY27.js","./OPDOutcome-legacy-CoHkR7Bm.js","./NextAppointment-legacy-CmCn77ih.js","./OPDDiagnosis-legacy-DWUA651u.js","./OPDPrintingModal-legacy-Dsl0h9MJ.js","./lodash-legacy-pOOc9Efu.js","./usePatientProfile-legacy-D2rMc8Bi.js","./useUserActivities-legacy-Cjr44ZV1.js","./drug_prescription_service-legacy-D3aBZmyS.js","./patient_diagnosis_service-legacy-Tyc3rEvj.js","./apexcharts-legacy-CgZ9vWXi.js","./LevelOfConsciousness.vue_vue_type_script_setup_true_lang-legacy-DvFKD6z_.js","./previousComplaints-legacy-CVUimPux.js","./patient_complaints_service-legacy-DRDjU-CR.js","./DashBox-legacy-CfHxN6BJ.js","./BasicForm-legacy-2lkhPati.js","./DateInputField-legacy-CF2vHm9k.js","./formatServerData-legacy-3I1UGkvW.js","./LabOrdersList-legacy-DASlGKFu.js","./group_validation-legacy-BXChYdKY.js","./RadiologyStore-legacy-Bsbn4jyZ.js","./ncd_appointment_service-legacy-MWvtJCe0.js","./Registration-legacy-D0BCFyTC.js","./useLocation-legacy-BQvq23NU.js","./vaccines_service-legacy-BhlUawKT.js","./sms_service-legacy-B9h22baM.js","./EIRreportsStore-legacy-3Y83EF5Q.js","./Export-legacy-CFvsfYDf.js","./useNeonatalEnrollmentStore-legacy-BHOsgqmj.js","./enrollment-legacy-BWFKsMdA.js"],function(e,a){"use strict";var t,n,l,i,s,o,u,c,r,v,d,g,m,p,y,f,h,b,w,_,P,D,x,O,j,S,T,C,A,I,k,N,L,F,R,E,B,M,H,J,U,W,z,G,q,V,Z,Y,$,Q,X,K,ee,ae,te,ne,le,ie,se,oe,ue,ce,re,ve,de,ge,me,pe;return{setters:[e=>{t=e.d,n=e.an,l=e.cG,i=e.r,s=e.c,o=e.aU,u=e.a,c=e.w,r=e.O,v=e.f,d=e.J,g=e.l,m=e.e,p=e.m,y=e.k,f=e.u,h=e.bw,b=e.dx,w=e.a3,_=e.i,P=e.bL,D=e.v,x=e.a6,O=e.eH,j=e.b8},e=>{S=e.u,T=e._,C=e.s,A=e.e,I=e.b},e=>{k=e.u,N=e.aH,L=e.bV,F=e.aJ,R=e.d,E=e.aL,B=e.a0,M=e.aW,H=e.bF,J=e.bq,U=e.aS,W=e.T,z=e.J,G=e.G,q=e.s,V=e.af,Z=e.aX,Y=e.H,$=e.aM,Q=e.aO,X=e.bZ,K=e.S,ee=e.t,ae=e.bI,te=e.q,ne=e.n,le=e._},e=>{ie=e.D},e=>{se=e.C,oe=e.b,ue=e.O},e=>{ce=e.I,re=e.N},e=>{ve=e.O},e=>{de=e.O},e=>{ge=e.l},e=>{me=e.u},e=>{pe=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".disabled[data-v-b127b560]{color:red}.spinner-overlay[data-v-b127b560]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-b127b560]{width:80px;height:80px}.loading-text[data-v-b127b560]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-b127b560]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-b127b560]{pointer-events:none}.back_profile[data-v-b127b560]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(a);const ye={key:0,class:"spinner-overlay"},fe={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},he={class:"back_profile"};e("default",le(t({__name:"ConsultationPlan",setup(e){const{currentTabIndex:a}=S(),{printVisitSummary:t}=me(),{hasWaitingList:le}=pe(),be=n(),we=l(),_e=i(!1),Pe=i(!0),De=i(!1),xe=i(!1),Oe=i(!0),je=i(!1),Se=i(!1),Te=i(!1),Ce=k(),Ae=N(),Ie=L(),ke=F(),Ne=R(),Le=E(),Fe=B(),Re=M(),Ee=H(),Be=J(),Me=U(),He=i(!1),Je=i(!1),Ue=s(()=>({text:Je.value?"Saving...":"Finish",icon:Je.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:He.value||Je.value})),{patient:We}=o(Ce),{investigations:ze}=o(Ae),{OPDdiagnosis:Ge}=o(Ie),{selectedMedicalDrugsList:qe}=o(ke),{OPDActivities:Ve}=o(Ne),{outcomes:Ze}=o(Le),{currentSelectedNextAppointmentDate:Ye}=o(Ee),{presentingComplaints:$e}=o(Be),{vitals:Qe}=o(Re),Xe=s(()=>Me.selectedMedicalAllergiesList),Ke=i(null),ea=i(null),aa=i(null),ta=i(null),na=i(null),la=i(null),ia=i(null),sa=i(),oa=()=>Ve.value.map(e=>({title:e,icon:""})),ua=async(e,t,n)=>{var l;0===t&&await pa(),await da()&&(await ga(),e%1==0&&(a.value=e),ia.value&&n&&ia.value.changeTab(e),"Investigations"===(null===(l=sa.value[e])||void 0===l?void 0:l.title)&&ea.value&&await ea.value.openAHDModal())},ca=()=>{var e;if(!sa.value||0===sa.value.length)return null;const t=a.value>=0&&a.value<sa.value.length?a.value:0;switch(null===(e=sa.value[t])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(Ve.value.length>0)switch(Ve.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},ra=async()=>{xe.value=!0,G("Printing consultation summary... Please wait.");try{await t(),G("Consultation summary printed successfully!"),setTimeout(()=>{be.push("home")},3500)}catch(e){q("Failed to print consultation summary.")}finally{xe.value=!1}},va=()=>{G("Patient has finished consultation!"),be.push("home")},da=async()=>{const e=await V.getObsByEncounterIdAndDate(Z.PRESENTING_COMPLAINTS);return!!(e&&e.length>0)},ga=async()=>{const e=Y.sessionDate();for(let t=0;t<sa.value.length;t++)if(await da()){Pe.value=!0,De.value=!1;const n=sa.value[t];if("Clinical Assessment"===n.title){const a=$("presentingComplaints");sa.value[t].icon=ma(e,a)?j:""}else if("Investigations"===n.title){var a;const n=null===(a=We.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,l=null==n?void 0:n.filter(a=>Y.toStandardHisFormat(e)===Y.toStandardHisFormat(a.order_date));sa.value[t].icon=(null==l?void 0:l.length)>0?j:""}else if("Diagnosis"===n.title){const a=$("diagnosis");sa.value[t].icon=ma(e,a)?j:""}else if("Treatment Plan"===n.title){const e=$("treatment");sa.value[t].icon=(null==e?void 0:e.length)>0?j:""}else if("Next Appointment"===n.title){const a=$("appointments");sa.value[t].icon=ma(e,a)?j:""}else if("Outcome"===n.title){const e=$("outcomes");sa.value[t].icon=(null==e?void 0:e.length)>0?j:""}}else Pe.value=!1,"Clinical Assessment"!==sa.value[t].title&&(sa.value[t].icon=O);Pa()},ma=(e,a)=>{if(!a)return!1;const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime||e.order_date);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},pa=async()=>{_e.value=!0;try{var e;await ya(),await(null===(e=Ke.value)||void 0===e?void 0:e.onSubmit()),await Q(We.value),X()}catch(a){throw q("Failed to save clinical assessment"),a}finally{_e.value=!1}},ya=async()=>{try{if(ge.isEmpty(Xe.value))return;const e=Xe.value.map(e=>({concept_id:e.concept_id,obs_datetime:K.getSessionDate(),value_coded:e.concept_id,location_id:Fe.facilityLocation.code,value_text:e.name})),a=await C(e);Ce.setPatientRecord(a)}catch{ee("Failed to save allergies")}},fa=async()=>{try{var e;Je.value=!0,await(null===(e=aa.value)||void 0===e?void 0:e.onSubmit()),await(async()=>{try{const e=await A();We.value={...We.value,...e};const a=await I().saveNonPharmaTherapyPatientData();We.value={...We.value,...a}}catch{ee("Failed to save treatment plan")}})(),await Le.saveOutcomPatientData(),await Q(We.value);const a=localStorage.getItem("locationID");if(!a)return void q("Location ID missing.");const t=(()=>{const e=qe.value;return console.log("Checking prescribed medications:",{medicationsCount:e.length,medications:e}),e.length>0})();if(le("Waiting for Laboratory"))return await ba(a),void G("Patient moved to Consultation for Lab follow-up.");t?le("Waiting for Dispensation")?await ha(a):await wa(a):await _a(a)}catch(a){q("Failed to save consultation.")}finally{Je.value=!1}},ha=async e=>{try{await ae.addPatientToStage(We.value,"DISPENSATION"),await te().refresh(e),ke.clearSelectedMedicalDrugsList(),G("Patient moved to Dispensation."),be.push("home")}catch(a){throw q("Failed to move patient to dispensation"),a}},ba=async e=>{try{await ae.addPatientToStage(We.value,"CONSULTATION"),await te().refresh(e),be.push("home")}catch(a){throw q("Failed to move patient to consultation"),a}},wa=async e=>{try{await ae.addPatientToStage(We.value,"DISPENSATION"),await te().refresh(e),ke.clearSelectedMedicalDrugsList(),ee("Patient moved to dispensation queue. You lack access to dispense."),be.push("home")}catch(a){throw q("Failed to move patient to dispensation"),a}},_a=async e=>{try{await ne(We.value),await te().refresh(e),be.push("home")}catch(a){console.error("Failed to close visit:",a),q("Failed to close visit.")}};u(async()=>{0!==Ve.value.length?(sa.value=oa(),await ga(),(void 0===a.value||a.value<0)&&(a.value=0),He.value=!1,Pa()):await be.push("home")}),c(a,async()=>{await Pa()}),c(Qe,async()=>{await ga()},{deep:!0}),c(We,async()=>{await ga()},{deep:!0}),c(ze,async()=>{await ga()},{deep:!0}),c(Ge,async()=>{await ga()},{deep:!0}),c(qe,async()=>{await ga()},{deep:!0}),c(Ze,async()=>{await ga()},{deep:!0}),c(Ye,async()=>{await ga()}),c($e,async()=>{await ga()},{deep:!0}),c(we,async()=>{Oe.value=!1,sa.value=oa(),setTimeout(()=>{a.value=0,Oe.value=!0},0)},{deep:!0}),c(Te,e=>{Se.value=e,Se.value&&setTimeout(()=>{Se.value=!1},15e3)}),c(Ue,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:a.value,tabsLength:sa.value.length})},{deep:!0});const Pa=()=>{let e=!1;return Je.value&&(e=!0),He.value=e,!e};return(e,a)=>(v(),r(f(x),null,{default:d(()=>[g(de,{onYes:ra,onNo:va,isOpen:je.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),_e.value?(v(),m("div",ye,[g(f(h),{name:"bubbles"}),a[3]||(a[3]=y("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),g(f(b),{"is-open":xe.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),g(W),g(f(w),{fullscreen:!0},{default:d(()=>[g(ie),y("div",fe,[Oe.value?(v(),r(T,{key:0,ref_key:"wizard",ref:ia,headingTitle:"Consultation Plan","vertical-tabs":"","navigable-tabs":Pe.value,"scrollable-tabs":"",startIndex:0,doneButton:Ue.value,nextButton:{disabled:De.value},"custom-tabs":sa.value,tabs:sa.value,onChange:ua,"onComplete:wizard":a[2]||(a[2]=e=>fa())},{default:d(()=>[y("div",null,[y("div",he,[g(z,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:f(P),"font-weight":"600",onClick:a[0]||(a[0]=e=>{be.push("home")})},null,8,["icon"]),g(z,{name:"Back to Profile",iconSlot:"start",fill:"clear",icon:f(P),"font-weight":"600",onClick:a[1]||(a[1]=e=>{be.push("patientProfile")}),style:{"margin-left":"15px"}},null,8,["icon"])])]),_(y("div",null,[g(se,{ref_key:"clinicalAssessmentRef",ref:Ke},null,512)],512),[[D,"ClinicalAssessment"===ca()]]),_(y("div",null,[g(ce,{ref_key:"investigationsRef",ref:ea},null,512)],512),[[D,"Investigations"===ca()]]),_(y("div",null,[g(ve,{ref_key:"diagnosisRef",ref:aa},null,512)],512),[[D,"OPDDiagnosis"===ca()]]),_(y("div",null,[g(oe,{ref_key:"treatmentPlanRef",ref:ta},null,512)],512),[[D,"OPDTreatmentPlan"===ca()]]),_(y("div",null,[g(re,{ref_key:"nextAppointmentRef",ref:na},null,512)],512),[[D,"NextAppointment"===ca()]]),_(y("div",null,[g(ue,{ref_key:"outcomeRef",ref:la},null,512)],512),[[D,"Outcome"===ca()]])]),_:1},8,["navigable-tabs","doneButton","nextButton","custom-tabs","tabs"])):p("",!0)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-b127b560"]]))}}});

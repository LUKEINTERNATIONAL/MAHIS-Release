import{d as Se,ap as De,cp as Ae,r as v,c as ye,b2 as d,w as c,a as we,O as H,f as W,J as N,l as g,u as _,a4 as _e,k as p,m as Ce,i as D,bM as xe,v as A,a7 as Be,ba as S}from"./vendor-CzFJ4KTZ.js";import{aJ as j,u as Te,aK as ke,aL as Pe,aM as Re,aN as Ie,d as Ne,aO as $e,g as Ve,$ as Ee,e as Fe,T as Me,J as Le,N as ze,H as $,aP as C,aQ as He,aR as G,aS as We,t as J,af as x,G as je,aV as Ge,a1 as Je,S as Ue}from"../index-EMelXwFr.js";import{D as Ke}from"./DemographicBar-C0o06bJr.js";import{u as Qe,_ as qe,s as Xe,c as Ye,a as Ze}from"./nonPharmaTherapyStore-JV5fgaS0.js";import{u as V}from"./ComplicationsStore-vWj5ws2Z.js";import{l as Oe}from"./lodash-NJiRuGo9.js";import{a as U,b as et}from"./formatServerData-BHhKHlBc.js";import{u as tt}from"./usePatientProfile-BpbG25LD.js";import{_ as st,B as at,a as nt,b as it,c as ot}from"./ExposureAssessment.vue_vue_type_script_setup_true_lang-B4OIshZI.js";import"./apexcharts-C9muk_WD.js";import"./drug_prescription_service-LhjlhRDB.js";import"./patient_diagnosis_service-DjR0Shth.js";import"./Registration-BTsrz9g6.js";import"./useLocation-CCK1pvvH.js";import"./vaccines_service-BR90rr2T.js";import"./sms_service-Be7iHRKf.js";import"./EIRreportsStore-Bm2_2gSo.js";import"./Export-CAqQLGrN.js";import"./user_role_management-BVBDTelk.js";import"./useNeonatalEnrollmentStore-gP4YJ0fZ.js";import"./enrollment-DU-PLRUa.js";import"./Outcome-OguHaY4Z.js";import"./wardsStore-ChFadsU2.js";import"./DisplaySelectedBodyParts.vue_vue_type_script_setup_true_lang-BP4PJIBh.js";import"./ReusableDataTable-Cp1MI_Mt.js";const rt={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},lt={class:"back_profile"},Et=Se({__name:"PrimarySurvey",setup(ct,{expose:K}){const{onTabBeforeChange:Q,currentTabIndex:u}=Qe();tt();const B=De(),q=Ae();v([]),v([]),v(!1);const T=v(!0),k=v(!1),f=v(!1),E=ye(()=>({text:f.value?"Saving...":"Finish",icon:f.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:k.value||f.value})),X=j(),Y=Te(),Z=ke(),O=Pe();Re();const ee=Ie(),P=Ne();$e();const te=Ve(),se=V(),ae=Ee(),{patient:i}=d(Y),{vitals:ne}=d(X),{investigations:ie}=d(Z),{diagnosis:oe}=d(O),{substance:re}=d(te),{selectedNCDMedicationList:F}=d(ee),{FootScreening:le,visualScreening:ce,cvScreening:ue}=d(se),{sessionDate:M}=d(ae),{apiStatus:ut}=d(Fe());c(E,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:u.value,tabsLength:n.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),c(f,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const me=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},y=()=>{let e=!1;return h(),f.value&&(e=!0),k.value=e,!e},ve=()=>{B.push("/patientProfile")},R=()=>[{title:"Airway Assessment",icon:""},{title:"Breathing Assessment",icon:""},{title:"Circulation Assessment",icon:""},{title:"Disability Assessment",icon:""},{title:"Exposure Assessment",icon:""}],n=v(R()),de=v(null),ge=v(null),h=()=>{var a;if(!n.value||n.value.length===0)return console.log("Tabs not yet initialized"),null;const e=u.value>=0&&u.value<n.value.length?u.value:0;switch((a=n.value[e])==null?void 0:a.title){case"Airway Assessment":return"AirwayAssessment";case"Breathing Assessment":return"BreathingAssessment";case"Circulation Assessment":return"CirculationAssessment";case"Disability Assessment":return"DisabilityAssessment";case"Exposure Assessment":return"ExposureAssessment";default:if(P.NCDActivities.length>0)switch(P.NCDActivities[0]){case"Airway Assessment":return"AirwayAssessment";case"Breathing Assessment":return"BreathingAssessment";case"Circulation Assessment":return"CirculationAssessment";case"Disability Assessment":return"DisabilityAssessment";case"Exposure Assessment":return"ExposureAssessment"}return null}},I=()=>{T.value=!1,setTimeout(()=>{u.value=0,T.value=!0},0)},L=()=>{const e=j();e.setVitals(e.getInitialVitals(i.value.ID))},m=async()=>{var a,l;const e=ze(M.value,"sessionDate","value")||$.sessionDate(),t=C("vitals");for(let s=0;s<n.value.length;s++){const r=n.value[s];if(r.title==="Vital Signs")n.value[s].icon=w(e,t)?S:"";else if(r.title==="Risk Assessment"){const o=C("substanceAbuse");n.value[s].icon=w(e,o)?S:""}else if(r.title==="Investigations"){const o=(l=(a=i==null?void 0:i.value)==null?void 0:a.labOrders)==null?void 0:l.saved,b=o==null?void 0:o.filter(be=>$.toStandardHisFormat(e)===$.toStandardHisFormat(be.order_date));n.value[s].icon=(b==null?void 0:b.length)>0?S:""}else if(r.title==="Diagnosis"){const o=C("diagnosis");n.value[s].icon=w(e,o)?S:""}else if(r.title==="Complications Screening"){const o=C("screening");n.value[s].icon=w(e,o)?S:""}else r.title==="Treatment Plan"&&(F.value.length>0?n.value[s].icon=He()?S:"":n.value[s].icon="")}y()},w=(e,t)=>{const a=new Date(e);return a.setHours(0,0,0,0),t.some(l=>{const s=new Date(l.obs_datetime);return s.setHours(0,0,0,0),s.getTime()===a.getTime()})},fe=async()=>{var s,r,o,b;const e=[],t=await U(ce.value),a=await et(le.value),l=await U(ue.value);t.length>0&&e.push({concept_id:await x.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:x.getSessionDate(),child:t}),a.length>0&&e.push({concept_id:await x.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:x.getSessionDate(),child:a}),l.length>0&&e.push(...l),e.length>0?((b=(o=(r=(s=i.value).screening)!=null?r:s.screening={}).unsaved)!=null||(o.unsaved=[]),i.value.screening.unsaved.push(...e),je("Complications saved successfully")):J("No complications data to save")},pe=async()=>{const e=Ge();if(!Oe.isEmpty(e.selectedMedicalAllergiesList)){const l=Je(),s=e.selectedMedicalAllergiesList.map(o=>({concept_id:o.concept_id,obs_datetime:Ue.getSessionDate(),value_coded:o.concept_id,location_id:l.facilityLocation.code,value_text:o.name})),r=await Xe(s);i.value=Object.assign(i.value,r),console.log("Allergies staged successfully:",i.value),e.clearSelectedMedicalAllergiesList()}const t=await Ye();i.value=Object.assign(i.value,t);const a=await Ze().saveNonPharmaTherapyPatientData();i.value=Object.assign(i.value,a)},he=async(e,t)=>{var l,s,r;const a=(l=n.value[t])==null?void 0:l.title;e%1===0&&(u.value=e),a=="Vital Signs"&&((s=de.value)==null||s.onSubmit()),a=="Risk Assessment"&&((r=ge.value)==null||r.onSubmit()),a=="Complications Screening"&&await fe(),a=="Treatment Plan"&&await pe(),await G(i.value)},z=async()=>{f.value=!0;try{await We(),await G(i.value),B.push("/triageList")}catch(e){console.error("Error saving data:",e),J("Error occurred while saving data. Please try again.")}finally{f.value=!1}};return we(async()=>{if(P.NCDActivities.length===0){B.push("patientProfile");return}V().resetScreening(),n.value=R(),await m(),(u.value===void 0||u.value<0)&&(u.value=0,console.log("Setting initial tab index to 0")),k.value=!1,f.value=!1,y()}),c(u,async()=>{await y()}),c(ne,async()=>{await m()},{deep:!0}),c(i,async()=>{V().resetScreening(),await m()},{deep:!0}),c(M,async()=>{await m()},{deep:!0}),c(ie,async()=>{await m()},{deep:!0}),c(oe,async()=>{await m()},{deep:!0}),c(re,async()=>{await m()},{deep:!0}),c(F,async()=>{await m()},{deep:!0}),c(q,async e=>{I(),L(),n.value=R()},{deep:!0}),c(i,async(e,t)=>{e.ID!=t.ID&&(I(),L())},{deep:!0}),K({saveData:z,markWizard:m,refreshWizard:I,validateDoneButtonState:y}),(e,t)=>(W(),H(_(Be),null,{default:N(()=>[g(Me),g(_(_e),{fullscreen:!0},{default:N(()=>[g(Ke),p("div",rt,[T.value?(W(),H(qe,{key:0,ref:"wizard",headingTitle:"Primary Survey","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:E.value,"custom-tabs":n.value,beforeChange:_(Q),onChange:he,"onComplete:wizard":t[1]||(t[1]=a=>z()),onDoneButtonChanged:me},{default:N(()=>[p("div",null,[p("div",lt,[g(Le,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:_(xe),"font-weight":"600",onClick:t[0]||(t[0]=a=>ve())},null,8,["icon"])])]),D(p("div",null,[g(st,{ref:"airwayAssessmentRef"},null,512)],512),[[A,h()=="AirwayAssessment"]]),D(p("div",null,[g(at,{ref:"breathingAssessmentRef"},null,512)],512),[[A,h()=="BreathingAssessment"]]),D(p("div",null,[g(nt,{ref:"circulationAssessmentRef"},null,512)],512),[[A,h()=="CirculationAssessment"]]),D(p("div",null,[g(it,{ref:"disabilityAssessmentRef"},null,512)],512),[[A,h()=="DisabilityAssessment"]]),D(p("div",null,[g(ot,{ref:"exposureAssessmentRef"},null,512)],512),[[A,h()=="ExposureAssessment"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Ce("",!0)])]),_:1})]),_:1}))}});export{Et as default};

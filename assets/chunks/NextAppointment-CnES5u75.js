var Nt=Object.defineProperty;var Bt=(e,t,a)=>t in e?Nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var Ke=(e,t,a)=>Bt(e,typeof t!="symbol"?t+"":t,a);import{O as fe,bm as rt,t as Le,b2 as he,l as _e,_ as ge,bn as Rt,bo as Mt,aZ as Pe,M as V,a$ as Qe,af as de,G as Ne,S as q,J as Ge,b4 as gt,B as vt,bd as $t,o as We,aS as W,aI as ze,H as x,u as Te,bp as Vt,aB as $e,aA as Ft,aC as xt,b0 as Xe,L as Ut,bq as Gt,br as Wt,bs as zt,bt as qt,bu as Yt,bv as jt,bw as Kt,P as ft,bx as Je,by as Qt,bz as Xt,bA as Jt,bB as Zt,s as en,aH as lt,aJ as tn,aK as nn,aL as an,d as sn,aM as on,g as rn,Z as ln,e as ht,N as dn,aN as Ve,aO as cn,aQ as un,aP as pn,bc as mn,m as _t,V as gn,aT as vn,bC as fn,bD as hn,aq as _n,bE as ue,A as Fe,bF as yn,aR as Dn,ay as Ze,y as bn,az as In,a as dt}from"../index-BkjNye1H.js";import{d as se,aV as ne,r as I,a as Ie,H as N,O as ae,f as _,J as o,l as n,k as f,e as P,F as be,P as Be,m as G,u as v,w as Y,ah as Ee,b5 as Sn,b2 as qe,G as yt,E as Dt,ai as bt,aj as st,_ as Ce,I as It,a3 as it,bf as Cn,aT as An,Q,c as me,bA as ct,aU as St,bm as et,a4 as ke,a5 as ve,al as wn,ak as On,W as Re,K as j,bD as En,bw as Ct,Z as Ln,bq as At,z as He,ao as wt,cp as Ot,a2 as Et,R as ut,i as xe,v as Ue,b9 as we,L as at,p as Oe,aR as Tn,ax as Pn,N as pt,bo as kn,bS as Hn,aO as Nn}from"./vendor-hvlGrBh_.js";import Lt from"./LabOrdersList-BQzwPFiA.js";import{v as Ye}from"./group_validation-B0qz1DR6.js";import{u as Bn}from"./RadiologyStore-DBerA0_J.js";import{B as pe}from"./BasicForm-CWLgEKIN.js";import{c as Rn,f as Mn,a as $n}from"./formatServerData-C-gRfS2w.js";import{D as Tt}from"./DashBox-Bul-Qm58.js";import{p as Vn}from"./previousComplaints-C5diZl-f.js";import{P as Fn}from"./patient_complaints_service-CjIb_aSc.js";import{u as xn,a as tt,_ as Un,b as Gn,d as mt}from"./nonPharmaTherapyStore-DDUektVb.js";import{u as Wn}from"./usePatientProfile-BIP3Q7Zv.js";import{i as zn}from"./Registration-7lOkot5e.js";import{u as qn}from"./useUserActivities-DZVIC-h6.js";import{A as Yn}from"./ncd_appointment_service-DFrda4Jk.js";import{D as jn}from"./DateInputField-CLyok2we.js";class Pt extends fe{constructor(){super()}async postActivities(t,a){const l=a.location_id,r=await new rt(parseInt(t),-1,l).createEncounter();if(r){const y=await fe.buildLabOrders(r,a.orders||a);if(!await fe.saveOrdersArray(r.encounter_id,y))return Le("Unable to save lab orders")}}async postAHDActivities(t,a){const l=a.location_id,r=await new rt(parseInt(t),-1,l).createEncounter(he.AHD_LAB_ORDERS);if(r){const y=await fe.buildLabOrders(r,a.orders||a);if(!await fe.saveOrdersArray(r.encounter_id,y))return Le("Unable to save lab orders")}}}const Kn=["innerHTML"],Qn={class:"scrollable-container"},Xn={key:0,class:"form-section"},Jn={key:1,class:"form-section"},Zn={key:2,class:"form-section"},ea={key:3,class:"form-section"},ta={key:4,class:"form-section"},na={key:5,class:"form-section"},aa={key:6,class:"form-section"},sa={key:7,class:"form-section"},ia=se({__name:"RadiologyInvestigation",setup(e){const t=Bn(),{head:a,neck:l,chest:d,abdomen:r,upper_extremity:y,spine:s,pelvis:b,lower_extremity:p}=ne(t),D=I(_e),E=I([]),T=(S,h,R)=>{document.querySelectorAll("#".concat(S," path")).forEach(m=>{m.classList.toggle("white-fill")}),document.querySelectorAll("#".concat(h," line")).forEach(m=>{m.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(h," rect")).forEach(m=>{m.classList.toggle("bright-green-fill"),m.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(h," path")).forEach(m=>{m.classList.toggle("dark-green-fill")}),document.querySelectorAll("#".concat(h," circle")).forEach(m=>{m.classList.toggle("bright-green-fill")});const z=E.value.findIndex(m=>m.id===R);z>=0?E.value.splice(z,1):E.value.unshift({id:R,active:!0})},U=()=>{const S=document.getElementById("SPINE");S.style.display==="none"||S.style.display==""?S.style.display="block":S.style.display="none",T("SPINE","SPINE_LABEL-2","spine")};return Ie(()=>{const S=document.getElementById("HEAD");S&&S.addEventListener("click",()=>{T("HEAD","LABEL-6","head")});const h=document.getElementById("NECK");h&&h.addEventListener("click",()=>{T("NECK","LABEL-5","neck")});const R=document.getElementById("CHEST");R&&R.addEventListener("click",()=>{T("CHEST","LABEL-4","chest")});const z=document.getElementById("ABDOMEN_LABEL");z&&z.addEventListener("click",()=>{const M=document.getElementById("ABDOMEN-2");M.style.display==="none"||M.style.display==""?M.style.display="block":M.style.display="none",T("ABDOMEN","ABDOMEN_LABEL-2","abdomen")});const m=document.getElementById("UPPER_EXTRMITY");m&&m.addEventListener("click",()=>{T("UPPER_EXTRMITY","LABEL-3","upper_extremity")});const C=document.getElementById("SPINE"),A=document.getElementById("SPINE_LABEL"),u=document.getElementById("LOWER_SPINE_INACTIVE");C&&C.addEventListener("click",()=>{U()}),A&&A.addEventListener("click",()=>{U()}),u&&u.addEventListener("click",()=>{U()});const w=document.getElementById("PELVIS");w&&w.addEventListener("click",()=>{T("PELVIS","LABEL-2","pelvis")});const O=document.getElementById("LOWER_EXTREMITY");O&&O.addEventListener("click",()=>{T("LOWER_EXTREMITY","LABEL","lower_extremity")})}),(S,h)=>{const R=N("ion-col"),z=N("ion-row");return _(),ae(z,null,{default:o(()=>[n(R,{size:"7"},{default:o(()=>[f("div",{innerHTML:D.value.full_body_sk},null,8,Kn)]),_:1}),n(R,{size:"5",class:"form-column"},{default:o(()=>[f("div",Qn,[(_(!0),P(be,null,Be(E.value,m=>(_(),P(be,null,[m.id==="head"?(_(),P("div",Xn,[h[0]||(h[0]=f("h6",null,"Body Part: Head",-1)),n(pe,{contentData:v(a)},null,8,["contentData"])])):m.id==="neck"?(_(),P("div",Jn,[h[1]||(h[1]=f("h6",null,"Body Part: Neck",-1)),n(pe,{contentData:v(l)},null,8,["contentData"])])):m.id==="chest"?(_(),P("div",Zn,[h[2]||(h[2]=f("h6",null,"Body Part: Chest",-1)),n(pe,{contentData:v(d)},null,8,["contentData"])])):m.id==="abdomen"?(_(),P("div",ea,[h[3]||(h[3]=f("h6",null,"Body Part: Abdomen",-1)),n(pe,{contentData:v(r)},null,8,["contentData"])])):m.id==="upper_extremity"?(_(),P("div",ta,[h[4]||(h[4]=f("h6",null,"Body Part: Upper Extremity",-1)),n(pe,{contentData:v(y)},null,8,["contentData"])])):m.id==="spine"?(_(),P("div",na,[h[5]||(h[5]=f("h6",null,"Body Part: Spine",-1)),n(pe,{contentData:v(s)},null,8,["contentData"])])):m.id==="pelvis"?(_(),P("div",aa,[h[6]||(h[6]=f("h6",null,"Body Part: Pelvis",-1)),n(pe,{contentData:v(b)},null,8,["contentData"])])):m.id==="lower_extremity"?(_(),P("div",sa,[h[7]||(h[7]=f("h6",null,"Body Part: Lower Extremity",-1)),n(pe,{contentData:v(p)},null,8,["contentData"])])):G("",!0)],64))),256))])]),_:1})]),_:1})}}}),kt=ge(ia,[["__scopeId","data-v-5ab54fe8"]]),oa={class:"modal_wrapper"},ra={class:"uniform_columns"},la=se({__name:"AHDPastMedicalHistory",setup(e,{expose:t}){const a=Rt(),{pastMedicalHistory:l}=ne(a),d=I([]);Ie(()=>{d.value=a.getInitial(),r()}),Y(l,()=>{r()},{deep:!0});const r=()=>{var D;const p=["TB","Chronic Obstructive Pulmonary Disease (COPD)","Asthma","Epilepsy","Previous stroke","Peptic Ulcer Disease (PUD)","Mental disorder","Bleeding disorders","Hypertension","HIV Positive","Diabetes Mellitus"];(D=Mt(l.value,"None"))!=null&&D.checked?p.forEach(E=>{Pe(l.value,"TB treatment","displayNone",!0),V(l.value,"TB drugs","displayNone",!0),V(l.value,"TB drug start date","displayNone",!0),Pe(l.value,"Hypertension medication","displayNone",!0),V(l.value,"Current hypertension treatment regimen","displayNone",!0),Pe(l.value,"HIV status","displayNone",!0),V(l.value,"ARV start date","displayNone",!0),Pe(l.value,"Diabetes","displayNone",!0),Pe(l.value,"Controlled by","displayNone",!0),Qe(l.value,E,"checked",!1),Qe(l.value,E,"disabled",!0)}):p.forEach(E=>{Qe(l.value,E,"disabled",!1)})},y=p=>{V(l.value,"TB drugs","popOverData",{filterData:!0,data:[{name:"Auramine 'O' (C.I. 41000) 50g"},{name:"Bedaquilline 100mg"},{name:"Clofazimine 100mg"},{name:"Clofazimine 50mg"},{name:"Cycloserine 125mg"},{name:"Cycloserine 250mg"},{name:"Delamanid 50mg"},{name:"Ethambutol 100mg"},{name:"Ethambutol 400mg"},{name:"Ethionamide 250mg"},{name:"Isoniazid 100mg "},{name:"Isoniazid 300mg"},{name:"Isoniazid / Rifapentine 300mg / 300mg"},{name:"Levofloxacin 100mg"},{name:"Levofloxacin 250mg"},{name:"Linezolid 600mg"},{name:"Moxifloxacin 400mg"},{name:"Pyrazinamide 400mg"},{name:"Rifabutin 150mg Capsules"},{name:"Rifampicin 150mg/isoniazid 75mg"},{name:"Rifampicin 75mg+INH 50mg dispersible"},{name:"Rifampicin 75mg+INH 50mg+Pyrazinamide 150mg dispersible"},{name:"Rifampicin150mg/Isoniazid75mg/Pyrazinamide 400mg/Ethambutol"}]}),V(l.value,"Current hypertension treatment regimen","popOverData",{filterData:!0,data:[{name:"Captopril 12.5mg"},{name:"Aspirin 75mg"},{name:"Hydrochlorothiazide 25mg"},{name:"Enalapril Meleate 5mg"},{name:"Enalapril Maleate 10mg"}]})},s=async()=>[...await Rn(l.value),...await Mn(l.value),...await $n(l.value)];return t({onSubmit:async()=>{const p=await s();if(p.length===0){Le("No past medical history data to save");return}await de.addObsToEncounterPatient(p,he.AHD_PAST_MEDICAL_HISTORY),Ne("Past medical history saved successful")}}),(p,D)=>(_(),P("div",oa,[f("div",ra,[n(pe,{contentData:v(l),initialData:d.value,"onUpdate:inputValue":y,"onUpdate:selected":y},null,8,["contentData","initialData"])])]))}}),da=ge(la,[["__scopeId","data-v-e5153372"]]),ca=se({data:()=>({userRole:"",ready:!1,userRoleSettings:{}}),watch:{$route:{async handler(e){this.userRole=q.getUserRoles();const t=q.getProgramID(),a=q.getProgramName();this.userRole=="Lab"&&t==14&&(this.userRoleSettings={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}),t==14&&this.userRole!="Lab"&&(this.userRoleSettings={url:"home",btnName:"Go to waiting list",stepperTitle:"Consultation Plan"}),t==12&&(this.userRoleSettings={url:"contact",btnName:"Back"}),a=="LABOUR AND DELIVERY PROGRAM"&&(this.userRoleSettings={url:"labour/labourHome",btnName:"Back to home"}),a=="PNC PROGRAM"&&(this.userRoleSettings={url:"pnc/home",btnName:"Back to home"})},immediate:!0,deep:!0}}}),ua=se({name:"Menu",mixins:[ca],components:{IonContent:it,IonHeader:It,IonItem:Ce,IonList:st,IonMenu:bt,IonTitle:Dt,IonToolbar:yt,IonInput:qe,IonPopover:Sn,DashBox:Tt,SelectionPopover:$t,BasicInputField:vt,BasicForm:pe,List:gt,DynamicButton:Ge,LabOrdersList:Lt,RadiologyInvestigation:kt},data(){return{segmentContent:"Lab Investigations",iconsContent:_e,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",testResult:"",test:"",labOrders:"",filteredSpecimen:"",testData:[],popoverOpen:!1,labOrderStatus:!1,event:"",specimen:"",radiologyOrdersStatus:!1,otherOrdersStatus:!1}},setup(){return{checkmark:An,pulseOutline:Cn}},computed:{...Ee(ze,["investigations"]),...Ee(Te,["patient"]),inputFields(){return this.investigations[0].data.rowData[0].colData}},watch:{investigations:{handler(){this.setDashedBox()},deep:!0},patient:{async handler(){var e;(e=this.patient)!=null&&e.labOrders&&(this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved])},deep:!0},$route:{async handler(){await this.getTests()},deep:!0}},async mounted(){await this.getTests(),this.updateInvestigationsStores(),this.setDashedBox(),this.updateInvestigationWizard()},methods:{setSegmentContent(e){this.segmentContent=e},async getTests(){let e;q.getPouchDbStatus()&&q.getLanConnectionStatus()?e=await We("test_types"):e=await fe.getTestTypes(),V(this.investigations,"test","multiSelectData",e)},toggleLabOrderStatus(){this.labOrderStatus=!this.labOrderStatus},async updateInvestigationWizard(){var t;if(!((t=this.patient)!=null&&t.labOrders))return;this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved];const e=await this.labOrders.filter(a=>x.toStandardHisFormat(x.sessionDate())===x.toStandardHisFormat(a.order_date));e.length>0?this.investigations[0].selectedData=e:this.investigations[0].selectedData=""},async updateInvestigationsStores(){await this.updateInvestigationWizard(),ze().setInvestigations(this.investigations)},displayInputFields(){this.testResult="",this.selectedText="",this.no_item=!1,this.addItemButton=!1,this.search_item=!0},async validateRowData(){return Ye(this.investigations)},async checkTest(){return await this.isNameInData(this.inputFields[0].value.name,await this.investigations[0].selectedData)?(V(this.investigations,"test","alertsErrorMassage","Lab order already selected"),!1):(V(this.investigations,"test","alertsErrorMassage",""),!0)},async addNewRow(){Ye(this.investigations)&&await this.checkTest()&&(await this.saveTest(),this.investigations[0].data.rowData[0].colData[0].value="",this.investigations[0].data.rowData[0].colData[1].value="",this.search_item=!1,this.display_item=!0,this.addItemButton=!0),this.updateInvestigationWizard()},isNameInData(e,t){for(let a of t)for(let l of a.tests)if(l.name===e)return!0;return!1},async saveTest(){await new Pt().postAHDActivities(this.patient.patientID,[{concept_id:this.inputFields[0].value.concept_id,name:this.inputFields[0].value.name,specimen:this.inputFields[1].value.name,reason:"Routine",specimenConcept:await W.getConceptID(this.inputFields[1].value.name,!0)}]),V(this.investigations,"specimen","disabled",!0),this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved]},async handleInputData(e){if(e.inputHeader=="Test"&&this.checkTest(),V(this.investigations,"specimen","alertsErrorMassage",""),e.inputHeader=="Test"&&e.value){let t;q.getPouchDbStatus()&&q.getLanConnectionStatus()?t=await We("specimens"):t=await fe.getSpecimens("",1e3),this.specimen=await W.getConceptSet(e.value.name,"",{names:t.map(a=>a.name)}),this.specimen.length==1?(V(this.investigations,"specimen","value",this.specimen[0]),V(this.investigations,"specimen","disabled",!0)):(V(this.investigations,"specimen","value",""),V(this.investigations,"specimen","disabled",!1)),V(this.investigations,"specimen","multiSelectData",this.specimen)}},async filterTest(e){return await this.labOrders.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()))},async filterSpecimen(e){var t;return(t=this.specimen[0])!=null&&t.name&&e?await this.specimen.filter(a=>a==null?void 0:a.name.toLowerCase().includes(e.toLowerCase())):[]},setTest(e){this.selectedText=e.name,this.inputFields[1].inputHeader=="Test"?this.investigations[0].data.rowData[0].colData[0].value=e.name:this.investigations[0].data.rowData[0].colData[1].value=e.name,this.updateInvestigationsStores()},setDashedBox(){(this.inputFields[1].value||this.inputFields[0].value)&&(this.addItemButton=!1,this.search_item=!0,this.no_item=!1),this.investigations[0].selectedData.length>0?(this.display_item=!0,this.no_item=!1):this.search_item||(this.no_item=!0)}}}),pa={class:"background"},ma={key:0},ga={key:1},va={key:2},fa={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},ha={key:3},_a={class:"ion-padding",slot:"content"},ya={key:4};function Da(e,t,a,l,d,r){const y=N("ion-label"),s=N("ion-segment-button"),b=N("ion-segment"),p=N("VisitsHistory"),D=N("LabOrdersList"),E=N("RadiologyInvestigation");return _(),P("div",pa,[n(b,{value:e.segmentContent,style:{"margin-top":"5px"}},{default:o(()=>[n(s,{value:"Lab Investigations",onClick:t[0]||(t[0]=T=>e.setSegmentContent("Lab Investigations"))},{default:o(()=>[n(y,null,{default:o(()=>[...t[3]||(t[3]=[Q("Lab Investigations",-1)])]),_:1})]),_:1}),n(s,{value:"Radiology Investigation",onClick:t[1]||(t[1]=T=>e.setSegmentContent("Radiology Investigation"))},{default:o(()=>[n(y,null,{default:o(()=>[...t[4]||(t[4]=[Q("Radiology Investigation",-1)])]),_:1})]),_:1}),n(s,{value:"Other Investigation",onClick:t[2]||(t[2]=T=>e.setSegmentContent("Other Investigation"))},{default:o(()=>[n(y,null,{default:o(()=>[...t[5]||(t[5]=[Q("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),e.segmentContent=="Radiology Investigation"?(_(),P("div",ma,[n(p)])):G("",!0),e.segmentContent=="Other Investigation"?(_(),P("div",ga)):G("",!0),e.segmentContent=="Lab Investigations"?(_(),P("div",va,[f("div",fa,[f("span",null,[n(D,{propOrders:e.labOrders},null,8,["propOrders"])])])])):G("",!0),e.segmentContent=="Radiology Investigation"?(_(),P("div",ha,[f("div",_a,[n(E)])])):G("",!0),e.segmentContent=="Other Investigation"?(_(),P("div",ya)):G("",!0)])}const ba=ge(ua,[["render",Da],["__scopeId","data-v-67ff1a61"]]),Ia={key:0},Sa={style:{"align-content":"center"}},Ca={class:"ion-padding",slot:"content"},Aa=se({__name:"AHDPresentingComplaints",setup(e,{expose:t}){const a=Vt(),{presentingComplaints:l}=ne(a),d=I(_e),r=I(!0),y=I(!1),s=I(!0),b=I(!1),p=I([]),D=I([]),E=I(),T=me(()=>[{componentType:"multiSelectInputField",header:"Presenting Complaints",name:"PresentingComplaints",trackBy:"concept_id",icon:_e.search,hideSelected:!0,validation:u=>m(u==null?void 0:u.name,p.value)?"Presenting complaint already added":$e.required(u),options:D.value,grid:{s:"6"}},{componentType:"inputField",header:"Duration",name:"duration",icon:_e.time,validation:u=>$e.isNotEmptyandNumber(u),grid:{s:"6"},unitOptions:[{label:"Hours",value:"Hours"},{label:"Days",value:"Days"},{label:"Weeks",value:"Weeks"},{label:"Months",value:"Months"},{label:"Years",value:"Years"}],unitValidation:u=>!u||u===""?"Please select a unit.":null},{componentType:"inputField",header:"Specify the presenting complaint(s)",name:"Other (specify)",icon:_e.editPen,validation:u=>m(u,p.value)?"Presenting complaint already added":$e.required(u),condition:u=>{var w;return((w=u==null?void 0:u.PresentingComplaints)==null?void 0:w.name)==="Other"}},{componentType:"Alert",condition:u=>{var w;return $e.required((w=u==null?void 0:u.PresentingComplaints)==null?void 0:w.name)!=null},backgroundColor:"lightyellow",textColor:"black",value:"Please search thoroughly for the complaint. If it is not listed, search and select the 'Other' option to specify the complaint.",name:"noMatchAlert"}]),{formRef:U}=Ft(),S=async()=>{D.value=await Fn.getComplaintsList("Presenting complaint"),V(l.value,"PresentingComplaints","multiSelectData",D.value)},h=()=>{r.value=!1,s.value=!1,y.value=!0},R=async()=>{var O,M;const u=(O=U.value)==null?void 0:O.getFormValues();((M=U.value)==null?void 0:M.validateForm())==null&&(z(u),y.value=!1,s.value=!0)},z=u=>{var Z;const w=u.duration+" "+u.duration_unit,O=u.PresentingComplaints,M=O.name==="Other"?u["Other (specify)"]:O.name;p.value.push({actionBtn:!0,btn:["delete"],name:M,concept_id:O.concept_id,duration:O.duration,durationUnits:O.duration_unit,display:[M,w],data:[{concept_id:8578,value_coded:O.concept_id,obs_datetime:q.getSessionDate(),child:[{concept_id:O.concept_id,value_text:w,obs_datetime:q.getSessionDate()}]}]}),(Z=U.value)==null||Z.resetForm(),b.value=!0},m=(u,w)=>w.some(O=>O.name===u),C=u=>{p.value=p.value.filter(w=>w.display[0]!==u.name)},A=async()=>{const u=p.value.flatMap(w=>w.data);if(u.length<=0)return Le("Presenting complaints is required");u.length<=0||(await de.addObsToEncounterPatient(u,he.AHD_PRESENTING_COMPLAINTS),Ne("Presenting complaints saved successful"),p.value=[])};return Ie(async()=>{await S()}),t({onSubmit:A}),(u,w)=>{const O=N("ion-row"),M=N("ion-label"),Z=N("ion-accordion"),ye=N("ion-accordion-group");return _(),P(be,null,[n(Tt,{status:r.value,content:"No presenting complaints added"},null,8,["status"]),b.value?(_(),P("span",Ia,[n(gt,{listData:p.value,"onClicked:delete":C},null,8,["listData"])])):G("",!0),y.value?(_(),ae(O,{key:1},{default:o(()=>[n(xt,{formData:T.value,ref_key:"formRef",ref:U},null,8,["formData"]),f("div",Sa,[n(Ge,{fill:"clear",icon:d.value.plus,iconSlot:"icon-only","onClicked:btn":w[0]||(w[0]=i=>R()),name:"Save"},null,8,["icon"])])]),_:1})):G("",!0),s.value?(_(),ae(O,{key:2,style:{"margin-top":"10px"}},{default:o(()=>[n(Ge,{fill:"clear",icon:d.value.plus,iconSlot:"icon-only","onClicked:btn":w[1]||(w[1]=i=>h()),name:"Add new presenting complaints"},null,8,["icon"])]),_:1})):G("",!0),n(O,null,{default:o(()=>[n(ye,{ref_key:"accordionGroup",ref:E,class:"previousView"},{default:o(()=>[n(Z,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:o(()=>[n(v(Ce),{slot:"header",color:"light"},{default:o(()=>[n(M,{class:"previousLabel"},{default:o(()=>[...w[2]||(w[2]=[Q("Previous presenting complaints",-1)])]),_:1})]),_:1}),f("div",Ca,[n(Vn)])]),_:1})]),_:1},512)]),_:1})],64)}}}),wa=ge(Aa,[["__scopeId","data-v-04755951"]]);class nt extends Xe{constructor(a,l,d){super(a,he.AHD_HIV_STAGING,d);Ke(this,"age");Ke(this,"confirmatoryTest");this.age=l,this.confirmatoryTest=null}isAdult(){return this.age>=15}isPedaid(){return this.age<=14}setAge(a){this.age=a}getFacilities(a=""){return Ut.getFacilities({name:a})}getConfirmatoryTestType(){return this.confirmatoryTest}cd4CountIsValid(a){try{return!!a.match(/^(=|<|>)([0-9]*)$/m)}catch(l){return!1}}getAlertGuidelines(){return Gt}getWhoStageGuidelines(){return this.isAdult()?Wt:zt}getProgramEligibilityGuidelines(){return this.isAdult()?qt:Yt}getRecommendedConditionGuidelines(){return this.isAdult()?jt:Kt}getStagingConditions(a){const l=this.getStagingCategoryByNum(a);return Xe.getConceptsByCategory(l)}buildWhoStageObs(a){return this.buildValueCoded("Who stage",a)}buildWhoCriteriaObs(a){return this.buildValueCoded("Who stages criteria present",a)}buildReasonForArtObs(a){return this.buildValueCoded("Reason for ART eligibility",a)}getStagingCategoryByNum(a){switch(a){case 1:return this.isAdult()?"stage_1_conditions_adults":"stage_1_conditions_pedaids";case 2:return this.isAdult()?"stage_2_conditions_adults":"stage_2_conditions_pedaids";case 3:return this.isAdult()?"stage_3_conditions_adults":"stage_3_conditions_pedaids";case 4:return this.isAdult()?"stage_4_conditions_adults":"stage_4_conditions_pedaids";default:return""}}async loadHivConfirmatoryTestType(){const a=await Xe.getFirstValueCoded(this.patientID,"Confirmatory hiv test type");a&&(this.confirmatoryTest=a)}}const Oa={key:0,class:"ion-padding"},Ea={class:"accordion_group ion-padding"},La={style:{"font-weight":"bold"}},Ta={class:"error"},Pa={class:"ion-padding",slot:"content"},ka={class:"ion-padding"},Ha={class:"ion-padding"},Na={key:0,class:"ion-padding"},Ba={class:"ion-padding",style:{"border-bottom":"dashed #ccc"}},Ra=se({__name:"AHDStaging",props:{hideSubmit:{type:Boolean,default:!1},date:{default:nt.getSessionDate()}},setup(e,{expose:t}){const a=e,l=new ft,d=I({}),r=new nt(l.getID(),l.getAge(),-1);Y(()=>a.date,i=>{var F;const c=(F=i==null?void 0:i.standardDate)!=null?F:nt.getSessionDate(),g=He(c).diff(l.getBirthdate(),"years");r.setAge(g),r.setDate(c)},{deep:!0,immediate:!0});const y=ct({stage_4_conditions:{title:"Stage 4 Conditions",options:[]},stage_3_conditions:{title:"Stage 3 Conditions",options:[]},stage_2_conditions:{title:"Stage 2 Conditions",options:[]},stage_1_conditions:{title:"Stage 1 Conditions",options:[]}}),s=ct({cd4:"",cd4Date:"",isChildBearing:!1,reasonForArt:"",pregnant:"",breastFeeding:"",cd4Available:"",cd4Modifier:"",cd4Location:"",whoStage:"",staging:[],confirmatoryTest:""}),b={reasonForArt:{buildObs:()=>r.buildReasonForArtObs(s.reasonForArt),suggestAvalue:()=>({"PRESUMED SEVERE HIV":{priority:1,condition:()=>l.getAgeInMonths()<12&&s.confirmatoryTest==="HIV rapid test"&&W.getConceptsByCategory("pshd_condition").some(i=>z().includes(i.name))},"WHO STAGE IV PEDS":{priority:2,condition:()=>r.isPedaid()&&D(["stage_4_conditions"])},"WHO STAGE III PEDS":{priority:3,condition:()=>r.isPedaid()&&D(["stage_3_conditions"])},"HIV DNA polymerase chain reaction":{priority:4,condition:()=>l.getAgeInMonths()<12&&s.confirmatoryTest==="HIV DNA polymerase chain reaction"},"CD4 COUNT LESS THAN OR EQUAL TO 750":{priority:5,condition:()=>h(750)&&R()&&E()&&l.ageInMonths()>=24&&l.ageInMonths()<=56},"CD4 COUNT LESS THAN OR EQUAL TO 500":{priority:6,condition:()=>r.isPedaid()&&h(500)&&R()&&E()},"HIV infected":{priority:7,condition:()=>l.getAgeInMonths()<24||l.getAge()<=5},"WHO STAGE IV ADULT":{priority:1,condition:()=>{const i=W.getConceptsByCategory("severe_hiv_wasting_syndrome");return r.isAdult()&&(D(["stage_4_conditions"])||i.filter(c=>z().includes(c.name)).length>=2)}},"WHO STAGE III ADULT":{priority:2,condition:()=>r.isAdult()&&D(["stage_3_conditions"])},"cd4 less than or equal to 350":{priority:3,condition:()=>r.isAdult()&&h(350)&&E()},"cd4 less than or equal to 250":{priority:4,condition:()=>r.isAdult()&&h(250)&&E()},"cd4 less than or equal to 500":{priority:4,condition:()=>r.isAdult()&&h(500)&&E()},BREASTFEEDING:{priority:5,condition:()=>r.isAdult()&&s.breastFeeding==="Yes"&&R()},"PATIENT PREGNANT":{priority:6,condition:()=>r.isAdult()&&s.pregnant==="Yes"&&R()},Asymptomatic:{priority:7,condition:()=>R()}})},whoStage:{buildObs:()=>r.buildWhoStageObs(s.whoStage),suggestAvalue:()=>({"WHO STAGE IV ADULT":{priority:1,condition:()=>r.isAdult()&&D(["stage_4_conditions"])},"WHO STAGE III ADULT":{priority:2,condition:()=>r.isAdult()&&D(["stage_3_conditions"])},"WHO STAGE II ADULT":{priority:3,condition:()=>r.isAdult()&&D(["stage_2_conditions"])},"WHO STAGE I ADULT":{priority:4,condition:()=>r.isAdult()&&D(["stage_1_conditions"])},"WHO STAGE IV PEDS":{priority:1,condition:()=>r.isPedaid()&&(D(["stage_4_conditions"])||s.reasonForArt==="WHO STAGE IV PEDS")},"WHO STAGE III PEDS":{priority:2,condition:()=>r.isPedaid()&&D(["stage_3_conditions"])},"WHO STAGE II PEDS":{priority:3,condition:()=>r.isPedaid()&&D(["stage_2_conditions"])},"WHO STAGE I PEDS":{priority:4,condition:()=>r.isPedaid()&&D(["stage_1_conditions"])}})},cd4Available:{required:()=>!0,dataHandler:i=>{i!="Yes"&&(s.cd4="",s.cd4Date=""),d.value.cd4="",d.value.cd4Modifier="",d.value.cd4Date="",d.value.cd4Location=""}},pregnant:{required:()=>s.isChildBearing,buildObs:()=>r.buildValueCoded("Is patient pregnant?",s.pregnant)},breastFeeding:{required:()=>s.isChildBearing,buildObs:()=>r.buildValueCoded("Is patient breast feeding?",s.breastFeeding)},cd4:{required:()=>s.cd4Available==="Yes",validation:()=>{if(!S()){d.value.cd4="A number is required";return}U()>1e4&&(d.value.cd4="CD4 value cannot exceed 10,000")},buildObs:()=>r.buildValueNumber("CD4 count",U(),T())},cd4Modifier:{required:()=>s.cd4Available==="Yes",validation:()=>{s.cd4Modifier||(d.value.cd4Modifier="Please select modifier")},dataHandler:i=>s.cd4Modifier=i,options:[{label:"=",value:"="},{label:">",value:">"},{label:"<",value:"<"}]},cd4Date:{required:()=>s.cd4Available==="Yes",dataHandler:i=>{i&&(s.cd4Date=He(i).format("YYYY-MM-DD"))},validation:()=>{if(isNaN(new Date(s.cd4Date).getTime())){d.value.cd4Date="Invalid CD4 date";return}const i=He(s.cd4Date);if(i.isAfter(He(r.getDate()))){d.value.cd4Date="Cd4 result date can't be greater than ".concat(r.getDate());return}i.isBefore(He(l.getBirthdate()))&&(d.value.cd4Date="CD4 date must not be earlier than birthdate")},buildObs:()=>r.buildValueDate("Cd4 count datetime",s.cd4Date)},cd4Location:{required:()=>s.cd4Available==="Yes",dataHandler:i=>s.cd4Location=i,buildObs:()=>r.buildValueText("Cd4 count location",s.cd4Location)},staging:{validation:()=>{if(Object.keys(y).every(F=>u(F)<=0)){d.value.staging="Please select one or more staging conditions";return}const c=["stage_4_conditions","stage_3_conditions","stage_2_conditions"].some(F=>u(F)>0);y.stage_1_conditions.options.some(F=>/asymptomatic/i.test(F.name)&&F.checked)&&c&&(d.value.staging="Asymptomatic cannot be selected with other staging conditions")},buildObs:()=>Object.keys(y).reduce((c,g)=>(y[g].options.forEach(F=>{F.checked&&c.push(F.name)}),c),[]).map(c=>r.buildWhoCriteriaObs(c))}};function p(){Object.keys(s).forEach(i=>{typeof s[i]=="boolean"?s[i]=!1:Array.isArray(s[i])?s[i]=[]:s[i]=""}),Object.keys(d.value).forEach(i=>d.value[i]=""),M()}function D(i){return i.some(c=>u(c)>0)}function E(){return new Date(s.cd4Date)<=new Date("2016-04-30")}function T(){return s.cd4Modifier}function U(){return parseInt("".concat(s.cd4))}function S(){return/^\d+$/i.test("".concat(s.cd4))}function h(i){if(!S())return!1;const c=T(),g=U();return c==="="&&i===g||c==="<"&&g<=i||c===">"&&g>=i}function R(){return D(["stage_2_conditions","stage_1_conditions"])}function z(){return Object.keys(y).reduce((i,c)=>(y[c].options.forEach(g=>g.checked&&i.push(g.name)),i),[])}function m(i){if(d.value[i]="",typeof b[i].required=="function"&&b[i].required()&&!s[i]){d.value[i]="This field is required";return}s[i]&&typeof b[i].validation=="function"&&b[i].validation()}function C(i){var c,g,F;if(b[i]&&"suggestAvalue"in b[i]){s[i]="";const X=b[i].suggestAvalue(),ie=Object.keys(X).reduce((ee,$)=>{const Se=X[$];return typeof Se.condition=="function"&&Se.condition()?[...ee,{value:$,priority:Se.priority}]:ee},[]);s[i]=(F=(g=(c=ie.sort((ee,$)=>ee.priority-$.priority))==null?void 0:c[0])==null?void 0:g.value)!=null?F:""}}function A(){return Object.keys(s).reduce((i,c)=>{if(c in b&&s[c]&&typeof b[c].buildObs=="function"){const g=b[c].buildObs();return Array.isArray(g)?[...i,...g]:[...i,g]}return i},[])}function u(i){return y[i].options.filter(c=>c.checked).length}async function w(){await r.loadHivConfirmatoryTestType(),s.confirmatoryTest=r.getConfirmatoryTestType(),s.isChildBearing=l.isChildBearing()}function O(i,c){i in b&&typeof b[i].dataHandler=="function"&&b[i].dataHandler(c),m(i),Object.keys(b).forEach(g=>C(g))}function M(){Object.keys(y).forEach(i=>{var F,X;const c=Number((X=(F=i.match(/\d+/))==null?void 0:F[0])!=null?X:0),g=r.getStagingConditions(c);y[i].options=g.map(ie=>({checked:!1,name:ie.name,concept_id:ie.concept_id}))})}function Z(){return Object.keys(b).forEach(i=>m(i)),Object.keys(d.value).every(i=>"".concat(d.value[i]).length<=0)}async function ye(){if(console.log("Submitting staging"),!Z())return Le("Please review form for errors"),!1;try{const i=await Promise.all(A());return await r.createEncounter(),await r.saveObservationList(i),Ne("Staging Observations saved!"),!0}catch(i){return console.error(i),en("Error has occured while saving observations"),!1}}return Y(()=>a.date,i=>{r.setDate(i),l.date=i,p()}),Ie(async()=>{await w(),M()}),t({validateStagingForm:Z,buildPayload:A,onSubmit:ye}),(i,c)=>(_(),ae(v(At),null,{default:o(()=>[n(v(St),null,{default:o(()=>[s.isChildBearing?(_(),P("div",Oa,[n(v(et),null,{default:o(()=>[n(v(ke),null,{default:o(()=>[n(v(ve),null,{default:o(()=>[n(Je,{label:"Pregnant?",modelValue:s.pregnant,"onUpdate:modelValue":c[0]||(c[0]=g=>s.pregnant=g),onIonChange:c[1]||(c[1]=g=>O("pregnant",g)),"error-message":d.value.pregnant},null,8,["modelValue","error-message"])]),_:1}),n(v(ve),null,{default:o(()=>[n(Je,{label:"Breastfeeding?",modelValue:s.breastFeeding,"onUpdate:modelValue":c[2]||(c[2]=g=>s.breastFeeding=g),onOnChange:c[3]||(c[3]=g=>O("breastFeeding",g)),"error-message":d.value.breastFeeding},null,8,["modelValue","error-message"])]),_:1})]),_:1})]),_:1})])):G("",!0),f("div",Ea,[n(v(wn),{color:"light"},{default:o(()=>[(_(!0),P(be,null,Be(y,(g,F)=>(_(),ae(v(On),{key:F},{default:o(()=>[n(v(Ce),{color:"light",slot:"header"},{default:o(()=>[n(v(Re),{style:{color:"grey","font-size":"17px"},class:"ion-padding"},{default:o(()=>[f("b",La,[Q(j(g.title)+" ",1),n(v(En),{color:u("".concat(F))>0?"primary":void 0},{default:o(()=>[Q(" Selected: "+j(u("".concat(F))),1)]),_:2},1032,["color"])]),f("p",Ta,j(d.value.staging),1)]),_:2},1024)]),_:2},1024),f("div",Pa,[n(v(st),null,{default:o(()=>[(_(!0),P(be,null,Be(g.options,(X,ie)=>(_(),ae(v(Ce),{key:ie},{default:o(()=>[n(v(Ct),{modelValue:X.checked,"onUpdate:modelValue":ee=>X.checked=ee,onIonChange:ee=>O("staging",{stage_type:F,raw:ee,option:X})},null,8,["modelValue","onUpdate:modelValue","onIonChange"]),n(v(Re),{style:{margin:"13px"}},{default:o(()=>[Q(j(X.name),1)]),_:2},1024),c[15]||(c[15]=f("p",null,null,-1)),X.description?(_(),ae(v(Ln),{key:0,color:X.color},{default:o(()=>[Q(j(X.text),1)]),_:2},1032,["color"])):G("",!0)]),_:2},1024))),128))]),_:2},1024)])]),_:2},1024))),128))]),_:1})]),f("div",ka,[f("div",Ha,[n(Je,{label:"Recent CD4 count results available?",modelValue:s.cd4Available,"onUpdate:modelValue":c[4]||(c[4]=g=>s.cd4Available=g),onOnChange:c[5]||(c[5]=g=>O("cd4Available",g)),"error-message":d.value.cd4Available},null,8,["modelValue","error-message"])]),s.cd4Available==="Yes"?(_(),P("div",Na,[n(v(et),{class:"ion-padding"},{default:o(()=>[n(v(ke),null,{default:o(()=>[n(v(ve),null,{default:o(()=>[n(Qt,{label:"CD4 Count Date",modelValue:s.cd4Date,"onUpdate:modelValue":c[6]||(c[6]=g=>s.cd4Date=g),required:s.cd4Available==="Yes","error-message":d.value.cd4Date,onOnChange:c[7]||(c[7]=g=>O("cd4Date",g))},null,8,["modelValue","required","error-message"])]),_:1})]),_:1}),n(v(ke),null,{default:o(()=>[n(v(ve),{size:"2"},{default:o(()=>[n(Xt,{label:"CD4 Result Modifier",required:s.cd4Available==="Yes","error-message":d.value.cd4Modifier,options:b.cd4Modifier.options,onOnChange:c[8]||(c[8]=g=>O("cd4Modifier",g.value))},null,8,["required","error-message","options"])]),_:1}),n(v(ve),{size:"10"},{default:o(()=>[n(Jt,{label:"CD4 Count",modelValue:s.cd4,"onUpdate:modelValue":c[9]||(c[9]=g=>s.cd4=g),type:"number",onOnChange:c[10]||(c[10]=g=>O("cd4",g)),placeholder:"Enter CD4 Count","error-message":d.value.cd4},null,8,["modelValue","error-message"])]),_:1})]),_:1}),n(v(ke),{style:{"margin-top":"15px"}},{default:o(()=>[n(v(ve),null,{default:o(()=>[n(Zt,{label:"CD4 Count Location",modelValue:s.cd4Location,"onUpdate:modelValue":c[11]||(c[11]=g=>s.cd4Location=g),required:s.cd4Available==="Yes","error-message":d.value.cd4Location,show_error:!1,selected_district_ids:[],selected_location:s.cd4Location,onOnChange:c[12]||(c[12]=g=>{O("cd4Location",g)})},null,8,["modelValue","required","error-message","selected_location"])]),_:1})]),_:1})]),_:1})])):G("",!0)]),f("div",Ba,[n(v(et),null,{default:o(()=>[n(v(ke),null,{default:o(()=>[n(v(ve),null,{default:o(()=>[n(v(qe),{readonly:"",placeholder:"N/A",label:"REASON FOR ART:",modelValue:s.reasonForArt,"onUpdate:modelValue":c[13]||(c[13]=g=>s.reasonForArt=g)},null,8,["modelValue"])]),_:1}),n(v(ve),null,{default:o(()=>[n(v(qe),{readonly:"",placeholder:"N/A",label:"WHO STAGE:",modelValue:s.whoStage,"onUpdate:modelValue":c[14]||(c[14]=g=>s.whoStage=g)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),Ma=ge(Ra,[["__scopeId","data-v-1fe6c93a"]]),$a={style:{display:"flex","align-items":"center"}},Va={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},Fa=se({__name:"AHDWorkflow",props:{closeModalOnFinish:{type:Boolean,default:!1}},setup(e,{expose:t}){const a=e,{onTabBeforeChange:l,currentTabIndex:d}=xn();Wn();const r=wt(),y=Ot();I([]),I([]),I(!1);const s=I(!0),b=I(!1),p=I(!1),D=me(()=>({text:p.value?"Saving...":"Finish",icon:p.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:b.value||p.value})),E=lt(),T=Te(),U=ze(),S=tn();nn();const h=an(),R=sn();on();const z=rn(),m=tt(),C=ln(),{patient:A}=ne(T),{vitals:u}=ne(E),{investigations:w}=ne(U),{diagnosis:O}=ne(S),{substance:M}=ne(z),{selectedNCDMedicationList:Z}=ne(h),{FootScreening:ye,visualScreening:i,cvScreening:c}=ne(m),{sessionDate:g}=ne(C),{apiStatus:F}=ne(ht());Y(D,(L,B)=>{console.log("Done button options changed:",{from:B,to:L,currentStep:d.value,tabsLength:$.value.length}),L.disabled!==(B==null?void 0:B.disabled)&&console.log("Done button ".concat(L.disabled?"disabled":"enabled")),L.text!==(B==null?void 0:B.text)&&console.log('Done button text changed from "'.concat(B==null?void 0:B.text,'" to "').concat(L.text,'"'))},{deep:!0}),Y(p,(L,B)=>{L!==B&&(console.log("Saving state changed: ".concat(B," -> ").concat(L)),console.log(L?"Starting save process...":"Save process completed"))});const X=L=>{console.log("Done button change received from wizard:",L),L.newOptions.disabled&&console.log("Done button has been disabled"),L.isLastStep&&console.log("User is on the last step, done button should be visible")},ie=()=>{let L=!1;return H(),p.value&&(L=!0),b.value=L,!L},ee=()=>[{title:"Presenting Complaints",icon:""},{title:"Past Medical History",icon:""},{title:"WHO",icon:""},{title:"Investigation",icon:""}],$=I(ee()),Se=I(null),k=I(null),H=()=>{var te;if(!$.value||$.value.length===0)return console.log("Tabs not yet initialized"),null;const L=d.value>=0&&d.value<$.value.length?d.value:0;switch((te=$.value[L])==null?void 0:te.title){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation";default:if(R.NCDActivities.length>0)switch(R.NCDActivities[0]){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation"}return null}},J=()=>{s.value=!1,setTimeout(()=>{d.value=0,s.value=!0},0)},De=()=>{const L=lt();L.setVitals(L.getInitialVitals(A.value.ID))},oe=async()=>{var te,ce;const L=dn(g.value,"sessionDate","value")||x.sessionDate(),B=Ve("vitals");for(let K=0;K<$.value.length;K++){const re=$.value[K];if(re.title==="Vital Signs")$.value[K].icon=Ae(L,B)?we:"";else if(re.title==="Risk Assessment"){const le=Ve("substanceAbuse");$.value[K].icon=Ae(L,le)?we:""}else if(re.title==="Investigations"){const le=(ce=(te=A==null?void 0:A.value)==null?void 0:te.labOrders)==null?void 0:ce.saved,je=le==null?void 0:le.filter(Ht=>x.toStandardHisFormat(L)===x.toStandardHisFormat(Ht.order_date));$.value[K].icon=(je==null?void 0:je.length)>0?we:""}else if(re.title==="Diagnosis"){const le=Ve("diagnosis");$.value[K].icon=Ae(L,le)?we:""}else if(re.title==="Complications Screening"){const le=Ve("screening");$.value[K].icon=Ae(L,le)?we:""}else re.title==="Treatment Plan"&&(Z.value.length>0?$.value[K].icon=cn()?we:"":$.value[K].icon="")}ie()},Ae=(L,B)=>{const te=new Date(L);return te.setHours(0,0,0,0),B.some(ce=>{const K=new Date(ce.obs_datetime);return K.setHours(0,0,0,0),K.getTime()===te.getTime()})},Me=async(L,B)=>{var ce,K,re;const te=(ce=$.value[B])==null?void 0:ce.title;L%1===0&&(d.value=L),te=="Vital Signs"&&((K=Se.value)==null||K.onSubmit()),te=="Risk Assessment"&&((re=k.value)==null||re.onSubmit())},ot=async()=>{p.value=!0;try{await un(),await pn(A.value),a.closeModalOnFinish?(await ut.dismiss(),Ne("All data saved successfully")):(Ne("All data saved successfully"),r.push("/triageList"))}catch(L){console.error("Error saving data:",L),Le("Error occurred while saving data. Please try again.")}finally{p.value=!1}};return Ie(async()=>{if(R.NCDActivities.length===0){r.push("patientProfile");return}tt().resetScreening(),$.value=ee(),await oe(),(d.value===void 0||d.value<0)&&(d.value=0,console.log("Setting initial tab index to 0")),b.value=!1,p.value=!1,ie()}),Y(d,async()=>{await ie()}),Y(u,async()=>{await oe()},{deep:!0}),Y(A,async()=>{tt().resetScreening(),await oe()},{deep:!0}),Y(g,async()=>{await oe()},{deep:!0}),Y(w,async()=>{await oe()},{deep:!0}),Y(O,async()=>{await oe()},{deep:!0}),Y(M,async()=>{await oe()},{deep:!0}),Y(Z,async()=>{await oe()},{deep:!0}),Y(y,async L=>{J(),De(),$.value=ee()},{deep:!0}),Y(A,async(L,B)=>{L.ID!=B.ID&&(J(),De())},{deep:!0}),t({saveData:ot,markWizard:oe,refreshWizard:J,validateDoneButtonState:ie}),(L,B)=>{const te=N("ion-icon"),ce=N("ion-title"),K=N("ion-toolbar"),re=N("ion-header");return _(),P(be,null,[n(re,null,{default:o(()=>[n(K,{class:"modal-title"},{default:o(()=>[n(ce,null,{default:o(()=>[f("div",$a,[n(te,{icon:v(_e).demographics,class:"sub-menu-icon",style:{"font-size":"1.4rem"}},null,8,["icon"]),B[2]||(B[2]=f("b",{style:{"margin-left":"6px"}},"Advance HIV Disease",-1))])]),_:1}),n(te,{slot:"end",onClick:B[0]||(B[0]=le=>v(ut).dismiss()),style:{"font-size":"30px","padding-right":"10px"},icon:v(Et)},null,8,["icon"])]),_:1})]),_:1}),n(v(it),{class:"ion-padding"},{default:o(()=>[f("div",Va,[s.value?(_(),ae(Un,{key:0,ref:"wizard",headingTitle:"AHD Screening","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:D.value,"custom-tabs":$.value,beforeChange:v(l),onChange:Me,"onComplete:wizard":B[1]||(B[1]=le=>ot()),onDoneButtonChanged:X},{default:o(()=>[xe(f("div",null,[n(wa,{ref:"observationsRef"},null,512)],512),[[Ue,H()=="Presenting Complaints"]]),xe(f("div",null,[n(da,{ref:"interventionsRef"},null,512)],512),[[Ue,H()=="Past Medical History"]]),xe(f("div",null,[n(Ma,{ref:"medicationsRef"},null,512)],512),[[Ue,H()=="WHO"]]),xe(f("div",null,[n(ba,{ref:"medicationsRef"},null,512)],512),[[Ue,H()=="Investigation"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):G("",!0)])]),_:1})],64)}}}),xa=async()=>{const{hasWaitingList:e}=qn(),t=await de.getObsByEncounterIdAndDate(he.PRESENTING_COMPLAINTS),a=await de.getObsByEncounterId(he.HIV_CLINIC_REGISTRATION),l=await de.getObsByEncounterId(he.PAST_MEDICAL_HISTORY),d=await de.getObsByEncounterId(he.HIV_STATUS_AT_ENROLLMENT),r=await de.getObsByEncounterId(he.PATIENT_OUTCOME),y=await W.getConceptID("Slow onset severe headache"),s=await W.getConceptID("Confusion"),b=await W.getConceptID("+/- Fever"),p=await W.getConceptID("Neck stiffness"),D=await W.getConceptID("Persistent fever/drenching night sweats"),E=await W.getConceptID("Weight loss or failure to thrive"),T=await W.getConceptID("Anaemia<8gdl"),U=await W.getConceptID("Enlarged nodes"),S=await W.getConceptID("Meningits signs"),h=await W.getConceptID("Cough"),R=await W.getConceptID("Yes"),z=await W.getConceptID("Reactive"),m=await W.getConceptID("New Positive"),C=await W.getConceptID("HIV status"),A=await W.getConceptID("Presenting complaint"),u=de.isValueCodedAvailable(t,[y,s,b,p,D,E,T,U,S,h],A),w=de.isValueCodedAvailable(l,[R],C),O=de.isValueCodedAvailable(d,[z],C),M=de.isValueCodedAvailable(r,[R],m);return(zn()||e("Waiting for Consultation"))&&u&&(w||M||O||a.length>0)},Ua={class:"background"},Ga={key:0},Wa={key:1},za={key:2},qa={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},Ya={key:3},ja={class:"ion-padding",slot:"content"},Ka={key:4},Qa=se({__name:"Investigations",setup(e,{expose:t}){const a=I("Lab Investigations"),l=I(!1);I(!0);const d=I(!1),r=I(!1),y=I(!0),s=I(""),b=I("");I("");const p=I("");I(""),I([]),I(!1);const D=I(!1);I("");const E=I("");I(!1),I(!1);const T=ze(),U=Te(),{investigations:S}=ne(T),{patient:h}=ne(U),R=Ot(),z=wt(),m=me(()=>S.value[0].data.rowData[0].colData),C=k=>{a.value=k},A=async()=>{let k;q.getPouchDbStatus()&&q.getLanConnectionStatus()?k=await We("test_types"):k=await fe.getTestTypes(),V(S.value,"test","multiSelectData",k)},u=()=>{D.value=!D.value},w=async()=>{var H;if(!((H=h.value)!=null&&H.labOrders))return;p.value=[...h.value.labOrders.saved,...h.value.labOrders.unsaved];const k=await p.value.filter(J=>x.toStandardHisFormat(x.sessionDate())===x.toStandardHisFormat(J.order_date));k.length>0?S.value[0].selectedData=k:S.value[0].selectedData=""},O=async()=>{await w(),T.setInvestigations(S.value)},M=()=>{b.value="",s.value="",l.value=!1,y.value=!1,d.value=!0},Z=async()=>Ye(S.value),ye=async()=>await c(m.value[0].value.name,await S.value[0].selectedData)?(V(S.value,"test","alertsErrorMassage","Lab order already selected"),!1):(V(S.value,"test","alertsErrorMassage",""),!0),i=async()=>{Ye(S.value)&&await ye()&&(await g(),S.value[0].data.rowData[0].colData[0].value="",S.value[0].data.rowData[0].colData[1].value="",d.value=!1,r.value=!0,y.value=!0),w()},c=(k,H)=>{for(let J of H)for(let De of J.tests)if(De.name===k)return!0;return!1},g=async()=>{await new Pt().postActivities(h.value.patientID,[{concept_id:m.value[0].value.concept_id,name:m.value[0].value.name,specimen:m.value[1].value.name,reason:"Routine",specimenConcept:await W.getConceptID(m.value[1].value.name,!0)}]),V(S.value,"specimen","disabled",!0),p.value=[...h.value.labOrders.saved,...h.value.labOrders.unsaved]},F=async k=>{if(k.inputHeader=="Test"&&ye(),V(S.value,"specimen","alertsErrorMassage",""),k.inputHeader=="Test"&&k.value){let H;q.getPouchDbStatus()&&q.getLanConnectionStatus()?H=await We("specimens"):H=await fe.getSpecimens("",1e3),E.value=await W.getConceptSet(k.value.name,"",{names:H.map(J=>J.name)}),E.value.length==1?(V(S.value,"specimen","value",E.value[0]),V(S.value,"specimen","disabled",!0)):(V(S.value,"specimen","value",""),V(S.value,"specimen","disabled",!1)),V(S.value,"specimen","multiSelectData",E.value)}},X=async k=>await p.value.filter(H=>H.name.toLowerCase().includes(k.toLowerCase())),ie=async k=>{var H;return(H=E.value[0])!=null&&H.name&&k?await E.value.filter(J=>J==null?void 0:J.name.toLowerCase().includes(k.toLowerCase())):[]},ee=k=>{s.value=k.name,m.value[1].inputHeader=="Test"?S.value[0].data.rowData[0].colData[0].value=k.name:S.value[0].data.rowData[0].colData[1].value=k.name,O()},$=()=>{(m.value[1].value||m.value[0].value)&&(y.value=!1,d.value=!0,l.value=!1),S.value[0].selectedData.length>0?(r.value=!0,l.value=!1):d.value||(l.value=!0)},Se=async()=>{await xa()&&z.currentRoute.value.name=="OPDConsultationPlan"&&await mn("Do you want to do AHD screening?")&&await _t(Fa,{class:"fullScreenModal"})};return Y(S,()=>{$()},{deep:!0}),Y(h,async()=>{var k;(k=h.value)!=null&&k.labOrders&&(p.value=[...h.value.labOrders.saved,...h.value.labOrders.unsaved])},{deep:!0}),Y(R,async()=>{await A()},{deep:!0}),Ie(async()=>{await A(),O(),$(),w()}),t({openAHDModal:Se,setSegmentContent:C,getTests:A,toggleLabOrderStatus:u,updateInvestigationWizard:w,updateInvestigationsStores:O,displayInputFields:M,validateRowData:Z,checkTest:ye,addNewRow:i,isNameInData:c,saveTest:g,handleInputData:F,filterTest:X,filterSpecimen:ie,setTest:ee,setDashedBox:$}),(k,H)=>{const J=N("ion-label"),De=N("ion-segment-button"),oe=N("ion-segment"),Ae=N("VisitsHistory");return _(),P("div",Ua,[n(oe,{value:a.value,style:{"margin-top":"5px"}},{default:o(()=>[n(De,{value:"Lab Investigations",onClick:H[0]||(H[0]=Me=>C("Lab Investigations"))},{default:o(()=>[n(J,null,{default:o(()=>[...H[3]||(H[3]=[Q("Lab Investigations",-1)])]),_:1})]),_:1}),n(De,{value:"Radiology Investigation",onClick:H[1]||(H[1]=Me=>C("Radiology Investigation"))},{default:o(()=>[n(J,null,{default:o(()=>[...H[4]||(H[4]=[Q("Radiology Investigation",-1)])]),_:1})]),_:1}),n(De,{value:"Other Investigation",onClick:H[2]||(H[2]=Me=>C("Other Investigation"))},{default:o(()=>[n(J,null,{default:o(()=>[...H[5]||(H[5]=[Q("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),a.value=="Radiology Investigation"?(_(),P("div",Ga,[n(Ae)])):G("",!0),a.value=="Other Investigation"?(_(),P("div",Wa)):G("",!0),a.value=="Lab Investigations"?(_(),P("div",za,[f("div",qa,[f("span",null,[n(Lt,{propOrders:p.value},null,8,["propOrders"])])])])):G("",!0),a.value=="Radiology Investigation"?(_(),P("div",Ya,[f("div",ja,[n(kt)])])):G("",!0),a.value=="Other Investigation"?(_(),P("div",Ka)):G("",!0)])}}}),Ms=ge(Qa,[["__scopeId","data-v-e8e6ecbb"]]),Xa=se({created(){},components:{IonItem:Ce,IonCol:ve,IonLabel:Re,IonIcon:at},data(){return{iconsContent:_e,localMedicalDrugsList:[...this.$props._selectedMedicalDrugsList]}},props:{_selectedMedicalDrugsList:{type:Array,default:[]},show_actions_buttons:{type:Boolean,default:!0},highLightBackground:{type:String,default:"item-native"}},watch:{},methods:{highlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#006401"),this.highlightActionBtns(e)},undoHighlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#636363"),this.undohighlightActionBtns(e)},highlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let a=0;a<t.length;a++)t[a].style.display="inline-block"},undohighlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let a=0;a<t.length;a++)t[a].style.display="none"},asignLblID(e){return e+"_lbl"},asignSpanLblID(e){return e+"_spanlbl"},async removeItemAtIndex(e,t){await gn("Do you want to delete it?",t)&&this.$emit("remove-item",e)},editItemAtIndex(e){this.$emit("edit-item",e)},highLightBnd(e){if(e){if(e.highlightbackground!==void 0&&e.highlightbackground==!0)return this.$props.highLightBackground}else return!1}}}),Ja=["onMousemove","onMouseout"],Za={class:"route-label"};function es(e,t,a,l,d,r){const y=N("ion-label"),s=N("ion-col"),b=N("ion-row"),p=N("ion-icon");return _(!0),P(be,null,Be(e.localMedicalDrugsList,(D,E)=>(_(),P("div",{id:"df",class:"medication-item",key:E,onMousemove:T=>e.highlightItem(E),onMouseout:T=>e.undoHighlightItem(E)},[n(b,{class:"medication-header"},{default:o(()=>[n(s,{class:Oe(["ion-text-wrap",e.highLightBnd(D)])},{default:o(()=>[n(y,{id:e.asignLblID(E),class:"medication-name"},{default:o(()=>[Q(j(D.drugName),1)]),_:2},1032,["id"])]),_:2},1032,["class"])]),_:2},1024),n(b,{class:"medication-details"},{default:o(()=>[n(s,{size:"10",class:Oe(["ion-text-wrap details-col",e.highLightBnd(D)])},{default:o(()=>[n(y,{class:"details-text"},{default:o(()=>[Q(j(D.dose)+" / "+j(D.frequency)+" / daily / "+j(D.duration)+" / until "+j(D.prescription)+" ",1),f("span",Za,j(D.route_name),1)]),_:2},1024)]),_:2},1032,["class"]),e.show_actions_buttons?(_(),ae(s,{key:0,class:Oe([e.highLightBnd(D),"actions-col"]),size:"2"},{default:o(()=>[n(y,{class:Oe(["action-button",e.asignSpanLblID(E)]),onClick:T=>e.editItemAtIndex(E)},{default:o(()=>[n(p,{icon:e.iconsContent.edit},null,8,["icon"])]),_:1},8,["class","onClick"]),n(y,{class:Oe(["action-button",e.asignSpanLblID(E)]),onClick:T=>e.removeItemAtIndex(E,T)},{default:o(()=>[n(p,{icon:e.iconsContent.delete},null,8,["icon"])]),_:1},8,["class","onClick"])]),_:2},1032,["class"])):G("",!0)]),_:2},1024)],40,Ja))),128)}const $s=ge(Xa,[["render",es],["__scopeId","data-v-01c693a3"]]),ts={key:0,class:"custom-allergy-container"},ns={class:"button-group"},as=se({watch:{},name:"AllergiesComponent"}),ss=se({...as,setup(e){const t=vn(),a=Te(),l=me(()=>t.selectedMedicalAllergiesList),d=me(()=>a.patient),r=me(()=>t.medicalAllergiesList),y=I(h(8,"item-")),s=I(""),b=I(!1),p=[{multi_Selection:!0,show_list_label:!0,unqueId:y.value,name_of_list:"Add/Remove allergies",placeHolder:"Search for an allergy",items:[],listUpdatedFN:T,listFilteredFN:()=>{},searchTextFN:U,use_internal_filter:!0,show_error:I(!1),error_message:"please select a User",disabled:I(!1)}],D=I(!1);Ie(async()=>{E()});const E=()=>{t.current_patient.ID!=d.value.ID&&(t.clearSelectedMedicalAllergiesList(),t.setCurrentPatient(d.value))};function T(m){m.forEach(C=>{C.selected==!0&&C.name==="Other"&&(b.value=C.name==="Other"),C.selected==!1&&C.name==="Other"&&z()}),t.setSelectedMedicalAllergiesList(m),S()}async function U(m){const C=m,A=await W.getConceptSet("OPD Medication",C);if(!A)return;A.map(M=>({label:M.name,value:M.name,other:M}));const u=fn(C),O=hn(u,A).sort((M,Z)=>M.name.localeCompare(Z.name));t.setMedicalAllergiesList(O),S()}function S(){const m=r.value;l.value.forEach(A=>{let u=!1;m.forEach((w,O)=>{w.concept_id==A.concept_id&&A.selected===!0&&(m[O]=A,u=!0)}),!u&&A.selected===!0&&m.push(A)});const C=m.filter((A,u,w)=>u===w.findIndex(O=>(O==null?void 0:O.concept_id)===(A==null?void 0:A.concept_id)));t.setMedicalAllergiesList(C)}function h(m=8,C=""){const A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let u=C;for(let w=0;w<m;w++)u+=A.charAt(Math.floor(Math.random()*A.length));return u+="-".concat(Date.now()),u}async function R(m){try{const C=m.trim();if(C){const A={name:C,selected:!0,concept_id:h(8,"12"),concept_name_id:h(8,"34")};t.setMedicalAllergiesList([...r.value,A]),t.setSelectedMedicalAllergiesList(A),b.value=!1,D.value=!0,s.value="";const u=t.findSelectedAllergyByName("Other");t.unselectOther(u)}}catch(C){console.error(C)}}const z=()=>{b.value=!1,s.value="",D.value=!1;const m=t.findSelectedAllergyByName("Other");m&&t.unselectOther(m)};return(m,C)=>(_(),ae(v(At),null,{default:o(()=>[n(v(Tn),null,{default:o(()=>[n(v(Re),{class:"header-container"},{default:o(()=>[n(v(at),{icon:v(Pn),class:"allergy-icon"},null,8,["icon"]),C[3]||(C[3]=f("span",{style:{"font-size":"16px","font-weight":"600"}}," Allergies (Medication, Healthcare items, Environment and Food) ",-1))]),_:1})]),_:1}),n(v(St),null,{default:o(()=>[n(_n,{multiSelection:p[0].multi_Selection,show_label:p[0].show_list_label,uniqueId:p[0].unqueId,name_of_list:p[0].name_of_list,choose_place_holder:p[0].placeHolder,"items_-list":r.value,use_internal_filter:p[0].use_internal_filter,disabled:p[0].disabled.value,onItemListUpDated:p[0].listUpdatedFN,onItemListFiltered:p[0].listFilteredFN,onItemSearchText:p[0].searchTextFN},null,8,["multiSelection","show_label","uniqueId","name_of_list","choose_place_holder","items_-list","use_internal_filter","disabled","onItemListUpDated","onItemListFiltered","onItemSearchText"]),b.value?(_(),P("div",ts,[n(v(qe),{modelValue:s.value,"onUpdate:modelValue":C[0]||(C[0]=A=>s.value=A),placeholder:"Please specify the allergy",fill:"outline",class:"custom-input"},null,8,["modelValue"]),f("div",ns,[n(v(pt),{onClick:C[1]||(C[1]=A=>R(s.value)),class:"addCustomAllergyBtn"},{default:o(()=>[...C[4]||(C[4]=[Q(" Add Allergy ",-1)])]),_:1}),n(v(pt),{onClick:C[2]||(C[2]=A=>z()),fill:"clear",class:"cancelBtn"},{default:o(()=>[n(v(at),{icon:v(Et),slot:"icon-only"},null,8,["icon"])]),_:1})])])):G("",!0)]),_:1})]),_:1}))}}),Vs=ge(ss,[["__scopeId","data-v-3314535a"]]),is={class:"checklist-container"},os=se({watch:{},name:"xxxComponent"}),rs=se({...os,setup(e){const t=Te(),a=me(()=>t.patient),l=Gn(),d=l.items;Ie(async()=>{r()});const r=()=>{l.current_patient.ID!=a.value.ID&&(l.clearSelectednonPharmaTherapyStore(),l.setCurrentPatient(a.value))};return Y(()=>a.value,async y=>{}),(y,s)=>(_(),P("div",is,[(_(!0),P(be,null,Be(v(d),b=>(_(),ae(v(Ce),{key:b.id,class:"no-border"},{default:o(()=>[n(v(Ct),{id:b.id,modelValue:b.checked,"onUpdate:modelValue":p=>b.checked=p,slot:"start"},null,8,["id","modelValue","onUpdate:modelValue"]),n(v(Re),{style:{"font-size":"16px","font-weight":"600"}},{default:o(()=>[Q(j(b.label),1)]),_:2},1024)]),_:2},1024))),128))]))}}),Fs=ge(rs,[["__scopeId","data-v-371e920f"]]),ls=se({components:{IonContent:it,IonHeader:It,IonItem:Ce,IonList:st,IonMenu:bt,IonTitle:Dt,IonToolbar:yt,BasicInputField:vt,IonDatetime:Hn,IonBadge:kn,DateInputField:jn,DynamicButton:Ge},props:{showPeripheral:{type:Boolean,default:!0}},setup(e){const t=Ze(),a=I(0),l=me(()=>t.getDisabledDates()),d=me(()=>t.getAssignedAppointments()),r=I(),y=me(()=>e.showPeripheral);return{disabledDates:l,datesCounts:d,appointment_count:a,calendarOutline:Nn,inputPRDate:r,show_peripheral:y}},data(){return ue(),dt(),{iconsContent:_e,date:new Date(q.getSessionDate()),tomorrow:new Date(q.getSessionDate()).getDate()+1,appointment:"",drugRunoutDate:"",nextAppointmentDate:"",minDate:new Date(q.getSessionDate())}},computed:{...Ee(ue,["nextAppointment","appointmentCountsCache","currentSelectedNextAppointmentDate"]),...Ee(Ze,["maximumNumberOfDaysForEachDay","assignedAppointmentsDates"]),...Ee(Te,["patient"]),...Ee(dt,["activeProgram"]),calendarDate(){const e=ue();return e.currentSelectedNextAppointmentDate?x.toStandardHisDisplayFormat(e.currentSelectedNextAppointmentDate):""},runOutDate(){var t;const e=ue();return((t=this.activeProgram)==null?void 0:t.program_id)===14?mt():e.getAppointmentMedicationRunOutDate()}},watch:{calendarDate:{handler(){this.updateNextAppointment()},deep:!0},"$service.sessionDate":{handler(){this.updateMinDate()},immediate:!0},"patient.ID":{async handler(e,t){e!==t&&(this.cleanCurrentNextAppointmentDate(),this.checkIfSamePatientInContext(),this.clearNextAppointment())}}},async mounted(){this.checkIfSamePatientInContext(),await this.getAppointmentMents(this.runOutDate.date),await bn().loadGlobalProperty(),this.validateAppointmentCountsCache(),await this.preloadAppointmentCounts(),In();const e=q.getUserID(),t=new ft;this.appointment=new Fe(t.getID(),e),this.nextAppointmentDate=this.appointment.date,this.supposedRunOutDate(),window.addEventListener("storage",this.handleStorageChange),mt()},beforeUnmount(){window.removeEventListener("storage",this.handleStorageChange)},methods:{handleStorageChange(e){e.key==="sessionDate"&&this.updateMinDate()},updateMinDate(){this.date=new Date(q.getSessionDate()),this.minDate=new Date(q.getSessionDate())},updateNextAppointment(){ue().setNextAppointment(this.calendarDate)},async handleDateUpdate(e){e&&(Ze().setAssignedAppointmentsDates(e,!0),this.calendarDate=x.toStandardHisDisplayFormat(e),await this.save(),await this.getAppointmentMents(e),await this.updateAppointmentCache(e),ue().setCurrentSelectedNextAppointmentDate(e,this.patient.ID))},async getAppointmentMents(e){if(ht().apiStatus)try{const a=await Fe.getDailyAppointments(x.toStandardHisFormat(e),x.toStandardHisFormat(e));this.appointment_count=a.length}catch(a){}},getCounter(e){const t=x.toStandardHisFormat(e);return this.appointmentCountsCache[t]||""},async save(){if(this.assignedAppointmentsDates.length>0)try{const t=await new Yn().createOfflineAppointment()}catch(e){}},async openCornfirmModal(e){this.calendarDate=x.toStandardHisDisplayFormat(e),await this.getAppointmentMents(e),_t(Dn,{class:"otherVitalsModal"},!0,{message:"Are you sure you want to add this Appointment?"},{cancel:d=>{},confirm:async d=>{d.detail==!0&&await this.handleDateUpdate(e)}})},async handleInput(e){this.inputPRDate=x.toStandardHisDisplayFormat(e),await this.openCornfirmModal(e)},async supposedRunOutDate(){await yn.getLastDrugsReceived(this.patient.patientID)},async preloadAppointmentCounts(){try{const e=new Date(q.getSessionDate());e.setDate(1);const t=new Date(q.getSessionDate());t.setMonth(t.getMonth()+2),t.setDate(0);try{const a=await Fe.getDailyAppointments(x.toStandardHisFormat(e),x.toStandardHisFormat(t));if(!a)return;const l=this.filterUniqueAppointments(a),d={};l.forEach(r=>{const y=new Date(r.appointment_date),s=x.toStandardHisFormat(y);d[s]||(d[s]=0),d[s]++}),Object.keys(d).forEach(r=>{this.appointmentCountsCache[r]=d[r]})}catch(a){console.error("Error fetching appointments for date range:",a)}}catch(e){console.error("Error in preload process:",e)}},filterUniqueAppointments(e){const t=new Map;return e.forEach(a=>{const l="".concat(a.given_name,"_").concat(a.family_name,"_").concat(a.birthdate,"_").concat(a.appointment_date);t.has(l)||t.set(l,a)}),Array.from(t.values())},async updateAppointmentCache(e){try{const t=x.toStandardHisFormat(e),a=await Fe.getDailyAppointments(x.toStandardHisFormat(e),x.toStandardHisFormat(e));if(!a)return;this.appointmentCountsCache[t]=a.length}catch(t){console.error("Error updating appointment cache:",t)}},validateAppointmentCountsCache(){ue().checkCurrentLocationIfInContext()},isRunOutDate(e){return!this.runOutDate||!this.runOutDate.date?!1:x.toStandardHisFormat(e)===x.toStandardHisFormat(this.runOutDate.date)},cleanCurrentNextAppointmentDate(){ue().cleanCurrentSelectedNextAppointmentDate()},checkIfSamePatientInContext(){const e=ue();e.current_patient.ID!=this.patient.ID&&(this.cleanCurrentNextAppointmentDate(),e.setCurrentPatient(this.patient))},clearNextAppointment(){ue().clearAppointmentMedicationRunOutDate()}}}),ds={class:"card_content"},cs={class:"count-badge"},us={class:"dates_title"},ps={class:"sub_data"},ms={class:"dates_title"},gs={class:"sub_data"},vs={class:"dates_title"},fs={class:"sub_data"},hs={class:"dates_title"},_s={class:"sub_data"};function ys(e,t,a,l,d,r){const y=N("VueDatePicker"),s=N("ion-col"),b=N("DynamicButton"),p=N("ion-item"),D=N("ion-row"),E=N("DateInputField");return _(),P("div",ds,[n(D,null,{default:o(()=>[n(s,{"size-sm":"12","size-md":"12","size-lg":"12","size-xl":"8"},{default:o(()=>[n(y,{class:"calender",onDateUpdate:e.openCornfirmModal,inline:"","auto-apply":"","enable-time-picker":!1,"disabled-dates":e.disabledDates,"min-date":e.minDate,modelValue:e.runOutDate.date,"onUpdate:modelValue":t[0]||(t[0]=T=>e.runOutDate.date=T)},{day:o(({day:T,date:U})=>[(_(),P("p",{key:0,class:Oe({"run-out-date":e.isRunOutDate(U)}),style:{"font-weight":"600","font-size":"20px"}},[f("span",null,[Q(j(T),1),f("sup",cs,j(e.getCounter(U)),1)])],2))]),_:1},8,["onDateUpdate","disabled-dates","min-date","modelValue"])]),_:1}),e.show_peripheral?(_(),ae(s,{key:0},{default:o(()=>[n(p,null,{default:o(()=>[f("div",us,[t[3]||(t[3]=f("div",null,[Q("Suggested Next Appointment Date "),f("span",{style:{"font-size":"16px"}},"(Medication run out date)")],-1)),f("div",ps,[Q(j(e.runOutDate.formattedDate||"No run out date available")+" ",1),e.runOutDate.formattedDate?(_(),ae(b,{key:0,onClick:t[1]||(t[1]=T=>e.handleDateUpdate(e.runOutDate.date)),name:"Set Next Appt.",fill:"solid",iconSlot:"icon-only",style:{float:"right"}})):G("",!0)])])]),_:1}),n(p,null,{default:o(()=>[f("div",ms,[t[4]||(t[4]=f("div",null,"User set appointment date",-1)),f("div",gs,j(e.calendarDate),1)])]),_:1}),n(p,null,{default:o(()=>[f("div",vs,[t[5]||(t[5]=f("div",null,"Appointments",-1)),f("div",fs,j(e.appointment_count),1)])]),_:1}),n(p,null,{default:o(()=>[f("div",hs,[t[6]||(t[6]=f("div",null,"Appointment limit (per/day)",-1)),f("div",_s,j(e.appointment_count)+"/"+j(e.maximumNumberOfDaysForEachDay),1)])]),_:1})]),_:1})):G("",!0)]),_:1}),e.show_peripheral?(_(),ae(D,{key:0},{default:o(()=>[n(s,{size:"4"},{default:o(()=>[n(E,{inputHeader:"Preferred Next Appointment Date",bold:"600",fontSize:"17px",placeholderFontSize:"17px",placeholderFontWeight:"600",unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.inputPRDate,eventType:"",minDate:e.minDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t[2]||(t[2]=T=>e.handleInput(T))},null,8,["icon","inputValue","minDate"])]),_:1})]),_:1})):G("",!0)])}const xs=ge(ls,[["render",ys],["__scopeId","data-v-4e58e0bc"]]);export{Vs as A,$s as D,Ms as I,Pt as L,xs as N,Fa as _,Fs as a,ca as b,xa as i};

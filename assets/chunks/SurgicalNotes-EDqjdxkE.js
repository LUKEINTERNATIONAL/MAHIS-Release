import{d as Se,am as De,cr as Ae,r as v,c as ye,b2 as d,w as c,a as we,O as H,f as W,J as N,l as g,u as C,ab as Ce,k as p,m as _e,i as D,bT as xe,v as A,ae as Be,ba as S}from"./vendor-CAxM8KGs.js";import{b8 as j,u as Te,b9 as ke,ba as Pe,b0 as Re,bb as Ie,e as Ne,b1 as $e,i as Ee,a7 as Ve,f as Fe,T as ze,D as Le,a1 as Me,H as $,b3 as _,bc as He,C as U,bd as We,t as G,an as x,Z as je,be as Ue,a9 as Ge,S as Je}from"../index-CSiBRz_H.js";import{D as Ze}from"./DemographicBar-Bk6HKvtx.js";import{u as qe,_ as Ke}from"./useFormWizard-C1Sj9LRM.js";import{u as E}from"./ComplicationsStore-D7KGR3rm.js";import{s as Qe,c as Xe,u as Ye}from"./nonPharmaTherapyStore-6O0q0--b.js";import{l as Oe}from"./lodash-NJiRuGo9.js";import{f as J,a as et}from"./formatServerData-CZ0pe3c6.js";import{u as tt}from"./usePatientProfile-BXsxACiG.js";import{_ as st,B as at,a as nt,b as it,c as ot}from"./ExposureAssessment.vue_vue_type_script_setup_true_lang-CHPXPqu2.js";import"./apexcharts-y0ZeiY9V.js";import"./drug_prescription_service-BpOUSuyE.js";import"./patient_diagnosis_service-Dowtzk-J.js";import"./Registration-A3alq7rv.js";import"./useSetRegistrationValues-BNfjRcAu.js";import"./useLocation-D_307qAD.js";import"./vaccines_service-DyZF96zW.js";import"./sms_service-BvInbP--.js";import"./EIRreportsStore-Cbu3hXyV.js";import"./Export-Lk5QPSux.js";import"./user_role_management-yQPm8pMt.js";import"./useNeonatalEnrollmentStore-Dr5mQm84.js";import"./enrollment-DU-PLRUa.js";import"./Outcome-CZvR2Jgw.js";import"./wardsStore-DDFY9PR2.js";import"./DisplaySelectedBodyParts.vue_vue_type_script_setup_true_lang-Css5sGwo.js";import"./ReusableDataTable-Css8mBqM.js";const rt={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},lt={class:"back_profile"},zt=Se({__name:"SurgicalNotes",setup(ct,{expose:Z}){const{onTabBeforeChange:q,currentTabIndex:u}=qe();tt();const B=De(),K=Ae();v([]),v([]),v(!1);const T=v(!0),k=v(!1),f=v(!1),V=ye(()=>({text:f.value?"Saving...":"Finish",icon:f.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:k.value||f.value})),Q=j(),X=Te(),Y=ke(),O=Pe();Re();const ee=Ie(),P=Ne();$e();const te=Ee(),se=E(),ae=Ve(),{patient:i}=d(X),{vitals:ne}=d(Q),{investigations:ie}=d(Y),{diagnosis:oe}=d(O),{substance:re}=d(te),{selectedNCDMedicationList:F}=d(ee),{FootScreening:le,visualScreening:ce,cvScreening:ue}=d(se),{sessionDate:z}=d(ae),{apiStatus:ut}=d(Fe());c(V,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:u.value,tabsLength:n.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),c(f,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const me=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},y=()=>{let e=!1;return b(),f.value&&(e=!0),k.value=e,!e},ve=()=>{B.push("/patientProfile")},R=()=>[{title:"Airway Assessment",icon:""},{title:"Breathing Assessment",icon:""},{title:"Circulation Assessment",icon:""},{title:"Disability Assessment",icon:""},{title:"Exposure Assessment",icon:""}],n=v(R()),de=v(null),ge=v(null),b=()=>{var a;if(!n.value||n.value.length===0)return console.log("Tabs not yet initialized"),null;const e=u.value>=0&&u.value<n.value.length?u.value:0;switch((a=n.value[e])==null?void 0:a.title){case"Airway Assessment":return"AirwayAssessment";case"Breathing Assessment":return"BreathingAssessment";case"Circulation Assessment":return"CirculationAssessment";case"Disability Assessment":return"DisabilityAssessment";case"Exposure Assessment":return"ExposureAssessment";default:if(P.NCDActivities.length>0)switch(P.NCDActivities[0]){case"Airway Assessment":return"AirwayAssessment";case"Breathing Assessment":return"BreathingAssessment";case"Circulation Assessment":return"CirculationAssessment";case"Disability Assessment":return"DisabilityAssessment";case"Exposure Assessment":return"ExposureAssessment"}return null}},I=()=>{T.value=!1,setTimeout(()=>{u.value=0,T.value=!0},0)},L=()=>{const e=j();e.setVitals(e.getInitialVitals(i.value.ID))},m=async()=>{var a,l;const e=Me(z.value,"sessionDate","value")||$.sessionDate(),t=_("vitals");for(let s=0;s<n.value.length;s++){const r=n.value[s];if(r.title==="Vital Signs")n.value[s].icon=w(e,t)?S:"";else if(r.title==="Risk Assessment"){const o=_("substanceAbuse");n.value[s].icon=w(e,o)?S:""}else if(r.title==="Investigations"){const o=(l=(a=i==null?void 0:i.value)==null?void 0:a.labOrders)==null?void 0:l.saved,h=o==null?void 0:o.filter(he=>$.toStandardHisFormat(e)===$.toStandardHisFormat(he.order_date));n.value[s].icon=(h==null?void 0:h.length)>0?S:""}else if(r.title==="Diagnosis"){const o=_("diagnosis");n.value[s].icon=w(e,o)?S:""}else if(r.title==="Complications Screening"){const o=_("screening");n.value[s].icon=w(e,o)?S:""}else r.title==="Treatment Plan"&&(F.value.length>0?n.value[s].icon=He()?S:"":n.value[s].icon="")}y()},w=(e,t)=>{const a=new Date(e);return a.setHours(0,0,0,0),t.some(l=>{const s=new Date(l.obs_datetime);return s.setHours(0,0,0,0),s.getTime()===a.getTime()})},fe=async()=>{var s,r,o,h;const e=[],t=await J(ce.value),a=await et(le.value),l=await J(ue.value);t.length>0&&e.push({concept_id:await x.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:x.getSessionDate(),child:t}),a.length>0&&e.push({concept_id:await x.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:x.getSessionDate(),child:a}),l.length>0&&e.push(...l),e.length>0?((h=(o=(r=(s=i.value).screening)!=null?r:s.screening={}).unsaved)!=null||(o.unsaved=[]),i.value.screening.unsaved.push(...e),je("Complications saved successfully")):G("No complications data to save")},pe=async()=>{const e=Ue();if(!Oe.isEmpty(e.selectedMedicalAllergiesList)){const l=Ge(),s=e.selectedMedicalAllergiesList.map(o=>({concept_id:o.concept_id,obs_datetime:Je.getSessionDate(),value_coded:o.concept_id,location_id:l.facilityLocation.code,value_text:o.name})),r=await Qe(s);i.value=Object.assign(i.value,r),console.log("Allergies staged successfully:",i.value),e.clearSelectedMedicalAllergiesList()}const t=await Xe();i.value=Object.assign(i.value,t);const a=await Ye().saveNonPharmaTherapyPatientData();i.value=Object.assign(i.value,a)},be=async(e,t)=>{var l,s,r;const a=(l=n.value[t])==null?void 0:l.title;e%1===0&&(u.value=e),a=="Vital Signs"&&((s=de.value)==null||s.onSubmit()),a=="Risk Assessment"&&((r=ge.value)==null||r.onSubmit()),a=="Complications Screening"&&await fe(),a=="Treatment Plan"&&await pe(),await U(i.value)},M=async()=>{f.value=!0;try{await We(),await U(i.value),B.push("/triageList")}catch(e){console.error("Error saving data:",e),G("Error occurred while saving data. Please try again.")}finally{f.value=!1}};return we(async()=>{if(P.NCDActivities.length===0){B.push("patientProfile");return}E().resetScreening(),n.value=R(),await m(),(u.value===void 0||u.value<0)&&(u.value=0,console.log("Setting initial tab index to 0")),k.value=!1,f.value=!1,y()}),c(u,async()=>{await y()}),c(ne,async()=>{await m()},{deep:!0}),c(i,async()=>{E().resetScreening(),await m()},{deep:!0}),c(z,async()=>{await m()},{deep:!0}),c(ie,async()=>{await m()},{deep:!0}),c(oe,async()=>{await m()},{deep:!0}),c(re,async()=>{await m()},{deep:!0}),c(F,async()=>{await m()},{deep:!0}),c(K,async e=>{I(),L(),n.value=R()},{deep:!0}),c(i,async(e,t)=>{e.ID!=t.ID&&(I(),L())},{deep:!0}),Z({saveData:M,markWizard:m,refreshWizard:I,validateDoneButtonState:y}),(e,t)=>(W(),H(C(Be),null,{default:N(()=>[g(ze),g(C(Ce),{fullscreen:!0},{default:N(()=>[g(Ze),p("div",rt,[T.value?(W(),H(Ke,{key:0,ref:"wizard",headingTitle:"Primary Survey","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:V.value,"custom-tabs":n.value,beforeChange:C(q),onChange:be,"onComplete:wizard":t[1]||(t[1]=a=>M()),onDoneButtonChanged:me},{default:N(()=>[p("div",null,[p("div",lt,[g(Le,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:C(xe),"font-weight":"600",onClick:t[0]||(t[0]=a=>ve())},null,8,["icon"])])]),D(p("div",null,[g(st,{ref:"airwayAssessmentRef"},null,512)],512),[[A,b()=="AirwayAssessment"]]),D(p("div",null,[g(at,{ref:"breathingAssessmentRef"},null,512)],512),[[A,b()=="BreathingAssessment"]]),D(p("div",null,[g(nt,{ref:"circulationAssessmentRef"},null,512)],512),[[A,b()=="CirculationAssessment"]]),D(p("div",null,[g(it,{ref:"disabilityAssessmentRef"},null,512)],512),[[A,b()=="DisabilityAssessment"]]),D(p("div",null,[g(ot,{ref:"exposureAssessmentRef"},null,512)],512),[[A,b()=="ExposureAssessment"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):_e("",!0)])]),_:1})]),_:1}))}});export{zt as default};

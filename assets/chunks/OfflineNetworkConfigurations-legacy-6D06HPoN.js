System.register(["./vendor-legacy-BwtHwPGM.js","../index-legacy-SP2_GhB-.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-DbU8KA5u.js"],function(e,t){"use strict";var a,o,r,n,c,i,s,d,l,u,f,p,g,h,b,m,v,x,y,w,$,_,C,k,P,S,T,U,j,z,F,A,E,N,D;return{setters:[e=>{a=e.d,o=e.r,r=e.c,n=e.a,c=e.O,i=e.f,s=e.J,d=e.e,l=e.m,u=e.l,f=e.k,p=e.u,g=e.bx,h=e.a3,b=e.a4,m=e.a5,v=e.p,x=e.Q,y=e.L,w=e.cj,$=e.ck,_=e.K,C=e.N,k=e.a6,P=e.U},e=>{S=e.y,T=e.aA,U=e.aB,j=e.T,z=e.aC,F=e.G,A=e.s,E=e.S,N=e.aE,D=e._},null,null],execute:function(){var t=document.createElement("style");t.textContent=".spinner-overlay[data-v-9cd15011]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999}.loading-text[data-v-9cd15011]{color:#fff;margin-top:16px;font-size:1.1rem}.positionCenter[data-v-9cd15011]{width:100%;margin-top:20px;display:flex;justify-content:center;align-items:center}.registration_ion_card[data-v-9cd15011]{width:100%}._card_content[data-v-9cd15011]{max-width:700px;padding:0}.card_header_main[data-v-9cd15011]{display:flex;justify-content:center;align-items:flex-start;margin-bottom:20px;flex-wrap:wrap;gap:12px}.card_hearder[data-v-9cd15011]{font-weight:700;font-size:24px;margin:0 0 12px;color:#2c3e50}.config-source-badge[data-v-9cd15011]{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:20px;font-size:.85rem;font-weight:600}.config-source-badge.source-global[data-v-9cd15011]{background:#e3f2fd;color:#1976d2}.config-source-badge.source-local[data-v-9cd15011]{background:#fff3e0;color:#f57c00}.super-user-badge[data-v-9cd15011]{display:flex;align-items:center;gap:6px;padding:8px 16px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:20px;font-weight:600;font-size:.9rem}.info-banner[data-v-9cd15011]{display:flex;align-items:flex-start;gap:12px;padding:16px;border-radius:12px;margin-bottom:20px}.info-banner.success[data-v-9cd15011]{background:#e8f5e8;color:#2e7d32;border-left:4px solid #4caf50}.info-banner.warning[data-v-9cd15011]{background:#fff3e0;color:#ef6c00;border-left:4px solid #ff9800}.info-banner ion-icon[data-v-9cd15011]{font-size:1.5rem;flex-shrink:0;margin-top:2px}.info-banner strong[data-v-9cd15011]{display:block;margin-bottom:4px;font-size:1rem}.info-banner p[data-v-9cd15011]{margin:0;font-size:.9rem;line-height:1.5}.card-header[data-v-9cd15011]{margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid #f5f5f5}.card-header p[data-v-9cd15011]{margin:0;color:#6c757d;font-size:.95rem}.connection-status-section[data-v-9cd15011]{margin:20px 0}.connection-result[data-v-9cd15011]{padding:16px;border-radius:8px;border:1px solid}.connection-result.available[data-v-9cd15011]{background:#e8f5e8;border-color:#4caf50;color:#2e7d32}.connection-result.error[data-v-9cd15011]{background:#ffebee;border-color:#f44336;color:#c62828}.status-indicator[data-v-9cd15011]{display:flex;align-items:center;gap:8px;font-weight:600;margin-bottom:4px}.status-indicator ion-icon[data-v-9cd15011]{font-size:1.2rem}.timestamp[data-v-9cd15011]{font-size:.9rem;color:#6c757d;font-weight:500}.action-buttons[data-v-9cd15011]{display:flex;flex-direction:column;gap:12px;max-width:300px;margin:0 auto}.action-buttons ion-button[data-v-9cd15011]{height:48px;font-weight:600;text-transform:none}.primary-btn[data-v-9cd15011]{--background: #42b983}.secondary-btn[data-v-9cd15011]{--border-color: #42b983;--color: #42b983}.super-user-btn[data-v-9cd15011]{--background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)}.help-text[data-v-9cd15011]{display:flex;align-items:flex-start;gap:10px;margin-top:16px;padding:12px;background:#f8f9fa;border-radius:8px;border-left:3px solid #667eea}.help-text ion-icon[data-v-9cd15011]{color:#667eea;font-size:1.2rem;flex-shrink:0;margin-top:2px}.help-text p[data-v-9cd15011]{margin:0;font-size:.9rem;color:#495057;line-height:1.5}@media(max-width:768px){.action-buttons[data-v-9cd15011]{flex-direction:column}._card_content[data-v-9cd15011]{padding:10px}.card_header_main[data-v-9cd15011]{flex-direction:column;align-items:flex-start}}\n/*$vite$:1*/",document.head.appendChild(t);const H={key:0,class:"spinner-overlay"},I={class:"positionCenter"},B={class:"registration_ion_card"},O={class:"_card_content"},R={key:0,class:"connection-status-section"},L={class:"status-indicator"},J={key:0,class:"timestamp"},q={class:"action-buttons"},G="network_last_test_result";e("default",D(a({__name:"OfflineNetworkConfigurations",setup(e){const t=S(),a=o(t.getFacilityNetworkConfig()),D=o(!1),K=o(!1),Q=o(null),V=o(null),W=N(),{formRef:M,getFormValues:X}=T(),Y=r(()=>[{componentType:"inputField",header:"Username",name:"couchdbUsername",value:a.value.couchdbUsername,validation:U.required,grid:{s:"6"}},{componentType:"inputField",header:"Password",name:"couchdbPassword",type:"password",value:a.value.couchdbPassword,validation:U.required,grid:{s:"6"}},{componentType:"inputField",header:"IP Address",name:"couchdbHost",value:a.value.couchdbHost,validation:U.required,grid:{s:"6"}},{componentType:"inputField",header:"Port Number",name:"couchdbPort",value:a.value.couchdbPort,validation:U.required,grid:{s:"6"}},{componentType:"Heading",name:"Protocol",grid:{s:"4"}},{componentType:"radioButtonField",name:"couchdbProtocol",validation:U.required,type:"inline",grid:{s:"6"},value:a.value.couchdbProtocol,options:[{label:"https",value:"https"},{label:"http",value:"http"}]}]),Z=async()=>{K.value=!0,Q.value=null,V.value=null;try{const e=X(),{couchdbUsername:t,couchdbPassword:a,couchdbHost:o,couchdbPort:r,couchdbProtocol:n}=e;if(!(t&&a&&o&&n))throw new Error("Please fill in all required fields");const c=t.trim(),i=a.trim(),s=o.trim(),d=n.trim(),l=btoa(`${c}:${i}`),u=`${d}://${s}${r?`:${r}`:""}`;console.log("Testing connection to:",u);const f=await fetch(`${u}/`,{method:"GET",headers:{Authorization:`Basic ${l}`,"Content-Type":"application/json"},signal:AbortSignal.timeout(1e4)});if(!f.ok){let e="Connection failed";switch(f.status){case 401:e="Authentication failed - Invalid username or password";break;case 403:e="Access forbidden - Check user permissions";break;case 404:e="CouchDB server not found at this address";break;case 500:e="CouchDB server error";break;default:e=`Connection failed with status: ${f.status}`}throw new Error(e)}{const e=await f.json();if("Welcome"!==e.couchdb)throw new Error("Server responded but is not CouchDB");Q.value="available",V.value=(new Date).toLocaleString(),localStorage.setItem(G,JSON.stringify({status:"available",timestamp:V.value,version:e.version})),F(`Connected successfully! CouchDB version: ${e.version}`,3e3),await ee()}}catch(e){console.error("Connection test failed:",e),Q.value="error",V.value=(new Date).toLocaleString(),localStorage.setItem(G,JSON.stringify({status:"error",timestamp:V.value,error:e.message})),"AbortError"===e.name||"TimeoutError"===e.name?A("Connection timeout - Check your network and server address",5e3):e.message.includes("fetch")?A("Network error - Cannot reach the server",5e3):A(e.message,5e3)}finally{K.value=!1}},ee=async()=>{const e=await P.create({header:"Save as Facility Default",message:"This will save the configuration for all users at this facility. Other users will automatically use these settings when they log in. Continue?",buttons:[{text:"Cancel",role:"cancel"},{text:"Save for All Users",handler:async()=>{D.value=!0;try{const e=X(),{couchdbHostRemote:a}=E.getCouchdbConfigRemote(),{couchdbHost:o}=E.getCouchdbConfig(),r={couchdbUsername:e.couchdbUsername,couchdbPassword:e.couchdbPassword,couchdbHost:e.couchdbHost,couchdbPort:e.couchdbPort||"",couchdbProtocol:e.couchdbProtocol,locationId:E.getUserLocationId(),facilityName:"",configuredBy:E.getUserName(),configuredAt:(new Date).toISOString(),configSource:"global_property"};await t.setGlobalProperty("facility_network_config",JSON.stringify(r)),W.setConfig(r),a!=o&&await te(),F("Facility configuration saved successfully",3e3)}catch(e){console.error("Save error:",e),A("Failed to save facility configuration",3e3)}finally{D.value=!1}}}]});await e.present()},te=async()=>{await(async()=>{const{couchdbUsername:e,couchdbPassword:t,couchdbPort:a,couchdbHost:o,couchdbProtocol:r}=E.getCouchdbConfig();console.log("ðŸš€ ~ ensureReplicatorDatabase ~ couchdbHost:",o);const n=btoa(`${e}:${t}`),c=a?`:${a}`:"";if(404===(await fetch(`${r}://${o}${c}/_replicator`,{method:"HEAD",headers:{Authorization:`Basic ${n}`}})).status){const e=a?`:${a}`:"",t=await fetch(`${r}://${o}${e}/_replicator`,{method:"PUT",headers:{Authorization:`Basic ${n}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to create _replicator database: ${t.status}`);console.log("_replicator database created successfully")}})();const{couchdbUsername:e,couchdbPassword:t,couchdbPort:a,couchdbHost:o,couchdbProtocol:r}=E.getCouchdbConfig(),n=ae(),c=btoa(`${e}:${t}`),i=`${r}://${o}${a?`:${a}`:""}/_replicator`,s=n.map(async e=>{try{const t=await fetch(`${i}/${e._id}`,{method:"GET",headers:{Authorization:`Basic ${c}`,"Content-Type":"application/json"}});if(t.ok){const a=await t.json(),o={...e,_rev:a._rev},r=await fetch(`${i}/${e._id}`,{method:"PUT",headers:{Authorization:`Basic ${c}`,"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok)throw new Error(`Failed to update replication job ${e._id}: ${r.status} - ${await r.text()}`);return r.json()}if(404===t.status){const t=await fetch(i,{method:"POST",headers:{Authorization:`Basic ${c}`,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`Failed to create replication job ${e._id}: ${t.status} - ${await t.text()}`);return t.json()}throw new Error(`Error checking existing replication ${e._id}: ${t.status} - ${await t.text()}`)}catch(t){throw console.error(`Error processing replication job ${e._id}:`,t),t}});await Promise.all(s)},ae=()=>{const{couchdbHostRemote:e,couchdbPortRemote:t,couchdbUsernameRemote:a,couchdbPasswordRemote:o,couchdbProtocolRemote:r}=E.getCouchdbConfigRemote(),{couchdbUsername:n,couchdbPassword:c,couchdbPort:i,couchdbHost:s,couchdbProtocol:d}=E.getCouchdbConfig(),l=[...databaseConfig.liveSyncDatabases,...databaseConfig.periodicSyncDatabases];let u=[];const f=E.getUserLocationId();for(const p of l){const l=i?`:${i}`:"",g=t?`:${t}`:"";let h={_id:`pull_${f}_${p}`,source:`${r}://${a}:${o}@${e}${g}/${p}`,target:`${d}://${n}:${c}@${s}${l}/${p}`,create_target:!0,continuous:!0},b={_id:`push_${f}_${p}`,target:`${r}://${a}:${o}@${e}${g}/${p}`,source:`${d}://${n}:${c}@${s}${l}/${p}`,create_target:!0,continuous:!0};"patients_records"===p&&(h.selector={location_id:E.getUserLocationId()},b.selector={location_id:E.getUserLocationId()}),"dde"===p&&(h.selector={facility_code:E.getUserLocationId()},b.selector={facility_code:E.getUserLocationId()}),u.push(h),u.push(b)}return u};return n(async()=>{(()=>{const e=localStorage.getItem(G);if(e)try{const t=JSON.parse(e);Q.value=t.status,V.value=t.timestamp}catch(t){console.error("Failed to parse last test result:",t)}})(),await t.loadFacilityNetworkConfig(),a.value=t.getFacilityNetworkConfig()}),(e,t)=>(i(),c(p(k),{class:v({loading:D.value})},{default:s(()=>[D.value?(i(),d("div",H,[u(p(g),{name:"bubbles"}),t[0]||(t[0]=f("div",{class:"loading-text"},"Please wait...",-1))])):l("",!0),u(j),u(p(h),{fullscreen:!0},{default:s(()=>[f("div",I,[f("div",B,[f("div",O,[t[1]||(t[1]=f("div",{class:"card_header_main"},[f("div",null,[f("h2",{class:"card_hearder"},"Set Offline Network Configurations")])],-1)),u(p(b),null,{default:s(()=>[u(p(m),{size:"12"},{default:s(()=>[f("div",null,[u(z,{formData:Y.value,ref_key:"formRef",ref:M},null,8,["formData"]),Q.value?(i(),d("div",R,[f("div",{class:v(["connection-result",Q.value])},[f("div",L,[u(p(y),{icon:"available"===Q.value?p(w):p($)},null,8,["icon"]),x(" "+_("available"===Q.value?"Connection Successful":"Connection Failed"),1)]),V.value?(i(),d("div",J,_(V.value),1)):l("",!0)],2)])):l("",!0),f("div",q,[u(p(C),{onClick:Z,disabled:K.value,class:"primary-btn",expand:"block",fill:"solid"},{default:s(()=>[x(_(K.value?"Testing Connection...":"Test And Save Connection"),1)]),_:1},8,["disabled"])])])]),_:1})]),_:1})])])])]),_:1})]),_:1},8,["class"]))}}),[["__scopeId","data-v-9cd15011"]]))}}});

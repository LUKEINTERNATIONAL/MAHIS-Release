System.register(["./vendor-legacy-DWjfM6CY.js","./NavigationMenu-legacy-CaMw91lX.js","./EIRreportsStore-legacy-XTlL5gug.js","./bottomNavBar-legacy-CpZmHp-9.js","../index-legacy-Bd70Iz8m.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-DV2yaYXq.js"],function(e,a){"use strict";var l,t,r,s,i,o,n,u,d,c,m,v,p,f,g,h,y,x,_,b,w,U,k,N,S,C,F,B,O,E,D,V,P,A,I,M,T,z,L,q,j,R,$,Y,H,G,J,K,Z,Q,W,X,ee,ae,le,te,re,se,ie,oe,ne,ue,de,ce,me,ve,pe,fe,ge,he,ye,xe,_e,be,we,Ue,ke,Ne,Se,Ce,Fe,Be,Oe,Ee,De,Ve;return{setters:[e=>{l=e.e4,t=e.e5,r=e.d,s=e.r,i=e.w,o=e.a,n=e.O,u=e.f,d=e.u,c=e.bo,m=e.J,v=e.l,p=e.I,f=e.G,g=e.E,h=e.Q,y=e.K,x=e.aW,_=e.N,b=e.L,w=e.aa,U=e.ab,k=e.k,N=e.e,S=e.m,C=e.a6,F=e.p,B=e.b3,O=e.bC,E=e.a2,D=e.a8,V=e.a7,P=e.bJ,A=e.F,I=e.P,M=e.bI,T=e.by,z=e.M,L=e.a0,q=e.z,j=e.c,R=e.bw,$=e.aS,Y=e.e0,H=e.aR,G=e.cB,J=e.d1,K=e.dq,Z=e.bK,Q=e.cl,W=e.cM,X=e.aV,ee=e.e6,ae=e.e7,le=e.e8,te=e.e9,re=e.ea,se=e.eb,ie=e.ec,oe=e.bG,ne=e.ao,ue=e.cz,de=e.U,ce=e.ad,me=e.bO,ve=e.dm,pe=e.ac,fe=e.df,ge=e.dg,he=e.bx,ye=e.ae},e=>{xe=e.N},e=>{_e=e.E},e=>{be=e.B},e=>{we=e.ah,Ue=e.aF,ke=e.U,Ne=e.ab,Se=e.aG,Ce=e.aH,Fe=e.Z,Be=e.H,Oe=e.w,Ee=e._,De=e.aI},e=>{Ve=e.l},null],execute:function(){var a=document.createElement("style");a.textContent="ion-modal[data-v-9408bf7e]{--width: 90%;--height: 94%;--border-radius: 12px;--box-shadow: 0 28px 48px rgba(0, 0, 0, .4);--backdrop-opacity: var(--ion-backdrop-opacity, .32);--box-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1)}ion-radio-group[data-v-9408bf7e]{width:100%}.form_el[data-v-9408bf7e]{margin-right:10px;margin-left:10px;max-width:600px}.error-item[data-v-9408bf7e]{--border-color: #ff4444 !important;--highlight-color: #ff4444 !important}.error-input[data-v-9408bf7e]{--border-color: #ff4444 !important;--color: #ff4444 !important}.error-label[data-v-9408bf7e]{color:#f44!important}.error-section[data-v-9408bf7e]{border:1px solid #ff4444;border-radius:8px;padding:8px;margin-bottom:16px}.error-message[data-v-9408bf7e]{color:#f44;font-size:14px;margin-left:16px;margin-top:4px;margin-bottom:12px}ion-item[data-v-9408bf7e]{margin-bottom:8px}.search-section[data-v-deaf844d]{margin-bottom:16px}.search-section ion-segment[data-v-deaf844d]{margin-top:12px}.users-grid[data-v-deaf844d]{display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr));gap:16px;margin-bottom:20px}.user-card[data-v-deaf844d]{margin:0;box-shadow:0 2px 8px rgba(0,0,0,.1);transition:transform .2s ease,box-shadow .2s ease}.user-card[data-v-deaf844d]:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.15)}.user-header[data-v-deaf844d]{display:flex;align-items:flex-start;gap:12px}.user-info[data-v-deaf844d]{flex:1}.user-meta[data-v-deaf844d]{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px;font-size:12px}.meta-item[data-v-deaf844d]{display:flex;align-items:center;gap:4px}.meta-icon[data-v-deaf844d]{font-size:14px}.status-chip[data-v-deaf844d]{margin:4px 0 0}.user-details[data-v-deaf844d]{margin:16px 0;display:flex;flex-direction:column;gap:8px}.detail-item[data-v-deaf844d]{display:flex;align-items:flex-start;gap:8px;font-size:14px;line-height:1.4}.detail-icon[data-v-deaf844d]{font-size:16px;color:var(--ion-color-primary);margin-top:2px;flex-shrink:0}.action-buttons[data-v-deaf844d]{display:flex;gap:8px;flex-wrap:wrap;margin-top:16px}.action-buttons ion-button[data-v-deaf844d]{flex:1;min-width:80px}.empty-state[data-v-deaf844d]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:64px 32px;text-align:center}.empty-icon[data-v-deaf844d]{font-size:64px;margin-bottom:16px;opacity:.5}@media(max-width:768px){.users-grid[data-v-deaf844d]{grid-template-columns:1fr;gap:12px}.action-buttons[data-v-deaf844d]{flex-direction:column}.action-buttons ion-button[data-v-deaf844d]{width:100%}.user-header[data-v-deaf844d]{flex-direction:column;align-items:flex-start;gap:8px}.status-chip[data-v-deaf844d]{align-self:flex-end}.user-meta[data-v-deaf844d]{flex-direction:column;gap:4px}}.sticky-user-nav[data-v-5071b8a1]{position:sticky;top:0;z-index:1000;background:var(--ion-background-color, #ffffff);box-shadow:0 2px 4px rgba(0,0,0,.1);border-bottom:1px solid var(--ion-color-light, #e0e0e0)}\n/*$vite$:1*/",document.head.appendChild(a);const Pe=(()=>{const e=Ue;return{getPrograms:async function(a){const l=await e.getAll("programs",a);if(null!=l&&l.ok)return await l.json();throw new Error("Failed to retrieve programs.")},getEMRPrograms:async function(){const e=await we.getAllPrograms(),a=[];return e.forEach(e=>{a.push({name:e.name,other:e,selected:!1})}),e}}})(),Ae=(()=>{const e=Ue;return{getUserRoles:async function(a){const l=await e.getAll("roles",a);if(null!=l&&l.ok)return await l.json();throw new Error("Failed to retrieve user roles.")},getEMRUserRoles:async function(){return await ke.getAllRoles()}}})(),Ie={key:0,class:"error-message"},Me={key:1,class:"error-message"},Te={key:2,class:"error-message"},ze={key:3,class:"error-message"},Le={key:5,class:"password-section"},qe={class:"ion-padding",slot:"content",style:{background:"rgba(255, 255, 255, 0.5)","border-bottom-left-radius":"10px","border-bottom-right-radius":"10px"}},je={key:0},Re={key:1},$e={key:0,class:"error-message"},Ye={style:{display:"flex",gap:"20px","margin-top":"8px"}},He={key:6,class:"error-message"},Ge={key:7,class:"error-message"},Je={key:8,class:"error-message"},Ke={class:"form_el"},Ze=r({__name:"UserFormModal",props:{isOpen:{type:Boolean},editingUser:{},isSaving:{type:Boolean}},emits:["save","close"],setup(e,{emit:a}){const l=e,t=a,r=s(!1),R=s(null),$=s([]),Y=s({}),H=s(),G=s(),J=s(!1),K=s({name:!1,firstName:!1,lastName:!1,dateOfBirth:!1,gender:!1,roles:!1,programs:!1,usernameExists:!1}),Z=s({name:"",firstName:"",lastName:"",password:"",gender:"",roles:[],programs:[]}),Q=s([]),W=s([]);function X(e){const a=e.value.formattedDate,l=q(Be.toStandardHisFormat(a));H.value=l.toISOString(),console.log(H.value),K.value.dateOfBirth=!1}function ee(){R.value&&["MZ161098","BT241293","LL040529","MG200829"].includes(R.value.code)?r.value=!1:(r.value=!0,Oe("Please select a valid facility"))}const ae=e=>{R.value=e.selected_location,ee()},le=()=>{if(!l.editingUser){const e=Q.value.find(e=>36===e.program_id);e&&(Z.value.programs=[e.name],K.value.programs=!1)}},te=async e=>{const a=!l.editingUser||l.editingUser.name!==e;if(!e.trim()||!a)return K.value.usernameExists=!1,!0;try{const a=!0===(await ke.doesUsernameExist(e)).exists;return K.value.usernameExists=a,!a}catch(t){return console.error("Error checking username existence:",t),Oe("Failed to verify username availability. Proceeding with caution."),K.value.usernameExists=!1,!0}};i(()=>Z.value.name,async e=>{e.trim()?(K.value.name=!1,await te(e)):(K.value.name=!0,K.value.usernameExists=!1)}),i(()=>Z.value.firstName,()=>{Z.value.firstName.trim()&&(K.value.firstName=!1)}),i(()=>Z.value.lastName,()=>{Z.value.lastName.trim()&&(K.value.lastName=!1)}),i(()=>Z.value.gender,()=>{Z.value.gender&&(K.value.gender=!1)}),i(()=>Z.value.roles,()=>{Z.value.roles.length>0&&(K.value.roles=!1)}),i(()=>Z.value.programs,()=>{Z.value.programs.length>0&&(K.value.programs=!1)}),i(()=>l.isOpen,e=>{e&&!l.editingUser&&(ue(),le())});const re=()=>{t("close")},se=["Password must be at least 8 characters long and include at least one uppercase letter, one number, and one special character (@#$%^&+=*!-), without spaces","Password does not match"],ie=[{placeHolder:"new password",dataHandler:function(e){try{const a=e.target.value;ie[0].dataValue.value=a,oe()}catch(a){}},dataValue:s(),show_error:s(!1),error_message:se[0]},{placeHolder:"repeat password",dataHandler:function(e){try{const a=e.target.value;ie[1].dataValue.value=a,oe()}catch(a){}},dataValue:s(),show_error:s(!1),error_message:se[0]}];function oe(){const[e,a]=ie.map(e=>e.dataValue.value),l=se[0],t=se[1];return ie.forEach(e=>{e.error_message=l,e.show_error.value=!1}),!ie.map((e,a)=>{const l=!e.dataValue.value;return e.show_error.value=l,l}).some(e=>e)&&!(ie.map((e,a)=>{const l=Ne(e.dataValue.value);return e.show_error.value=!l,l}).some(e=>!e)||e!==a&&(ie.forEach(e=>{e.error_message=t,e.show_error.value=!0}),1))}const ne=async()=>{const e=(()=>{K.value.name=!1,K.value.firstName=!1,K.value.lastName=!1,K.value.dateOfBirth=!1,K.value.gender=!1,K.value.roles=!1,K.value.programs=!1;let e=!0;return Z.value.name.trim()||(K.value.name=!0,e=!1),Z.value.firstName.trim()||(K.value.firstName=!0,e=!1),Z.value.lastName.trim()||(K.value.lastName=!0,e=!1),H.value||(K.value.dateOfBirth=!0,e=!1),Z.value.gender||(K.value.gender=!0,e=!1),Z.value.roles.length||(K.value.roles=!0,e=!1),Z.value.programs.length||(K.value.programs=!0,e=!1),e})();ee();const a=await te(Z.value.name),s=!l.editingUser||J.value;let i=!0;if(s&&(i=oe()),!e||r.value||!a||!i)return void(!e||r.value?Oe("Please fill out all required fields."):a?i||Oe("Please check the password requirements."):Oe("The chosen username is already taken."));const o=Z.value.programs.map(e=>{const a=Q.value.find(a=>a.name===e);return a?a.program_id:null}).filter(e=>null!==e),n={...Z.value,dateOfBirth:H.value,facility:R.value,programIDs:o,...s?{password:ie[0].dataValue.value}:{}};t("save",n)},ue=()=>{Z.value={name:"",firstName:"",lastName:"",password:"",dateOfBirth:"",gender:"",facility:null,roles:[],programs:[]},H.value=null,G.value=null,R.value=null,Y.value={},r.value=!1,J.value=!1,Object.keys(K.value).forEach(e=>{K.value[e]=!1}),ie.forEach(e=>{e.dataValue.value="",e.show_error.value=!1})};return i(()=>l.editingUser,e=>{if(e){ue(),J.value=!1,Z.value={name:e.name,firstName:e.firstName||"",lastName:e.lastName||"",dateOfBirth:e.dateOfBirth||"",gender:(e.gender||"").toLowerCase(),roles:[...e.roles],programs:[...e.programs]},e.facility&&(R.value={code:e.facility.code,name:e.facility.name},console.log(">>: ",e.facility),Y.value=e.facility);const a=j(()=>{if(!Ve.isPlainObject(Z.value.dateOfBirth)){const a=q(e.dateOfBirth);return{day:a.date(),month:a.month()+1,year:a.year(),formattedDate:a.format("DD/MMM/YYYY"),standardDate:a.format("YYYY-MM-DD"),miumformattedDate:a.toISOString()}}return e.dateOfBirth});G.value=a.value,H.value=a.value.miumformattedDate}else ue()},{immediate:!0}),o(()=>{ue(),(async()=>{try{const e=Pe,a=(await e.getEMRPrograms()).filter(e=>36===e.program_id);Q.value=a.map(e=>({program_id:e.program_id,name:e.name})),le()}catch(e){console.error("Failed to fetch programs:",e),Oe("Failed to load programs.")}})(),(async()=>{try{const e=Ae,a=await e.getUserRoles();W.value=a.map(e=>e.name)}catch(e){Oe("Failed to load roles.")}})()}),(a,l)=>(u(),n(d(c),{"is-open":e.isOpen,onDidDismiss:re},{default:m(()=>[v(d(p),null,{default:m(()=>[v(d(f),null,{default:m(()=>[v(d(g),null,{default:m(()=>[h(y(e.editingUser?"Edit User":"Add New User"),1)]),_:1}),v(d(x),{slot:"end"},{default:m(()=>[v(d(_),{onClick:re,fill:"clear"},{default:m(()=>[v(d(b),{style:{"font-size":"35px"},icon:d(w)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),v(d(U),{class:"ion-padding"},{default:m(()=>[k("form",{id:"user-form",onSubmit:T(ne,["prevent"])},[v(d(C),{class:F({"error-item":K.value.name||K.value.usernameExists})},{default:m(()=>[v(d(B),{modelValue:Z.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>Z.value.name=e),label:"Username","label-placement":"stacked",placeholder:"Enter username",required:"",class:F({"error-input":K.value.name||K.value.usernameExists})},null,8,["modelValue","class"])]),_:1},8,["class"]),K.value.name?(u(),N("div",Ie," Username is required ")):K.value.usernameExists?(u(),N("div",Me," This username is already taken. ")):S("",!0),v(d(C),{class:F({"error-item":K.value.firstName})},{default:m(()=>[v(d(B),{modelValue:Z.value.firstName,"onUpdate:modelValue":l[1]||(l[1]=e=>Z.value.firstName=e),label:"First Name","label-placement":"stacked",placeholder:"Enter first name",required:"",class:F({"error-input":K.value.firstName})},null,8,["modelValue","class"])]),_:1},8,["class"]),K.value.firstName?(u(),N("div",Te," First name is required ")):S("",!0),v(d(C),{class:F({"error-item":K.value.lastName})},{default:m(()=>[v(d(B),{modelValue:Z.value.lastName,"onUpdate:modelValue":l[2]||(l[2]=e=>Z.value.lastName=e),label:"Last Name","label-placement":"stacked",placeholder:"Enter last name",required:"",class:F({"error-input":K.value.lastName})},null,8,["modelValue","class"])]),_:1},8,["class"]),K.value.lastName?(u(),N("div",ze," Last name is required ")):S("",!0),e.editingUser?(u(),n(d(C),{key:4,lines:"none",class:"toggle-item"},{default:m(()=>[v(d(O),{slot:"start",modelValue:J.value,"onUpdate:modelValue":l[3]||(l[3]=e=>J.value=e)},null,8,["modelValue"]),v(d(E),null,{default:m(()=>[...l[7]||(l[7]=[h("Update User Password?",-1)])]),_:1})]),_:1})):S("",!0),!e.editingUser||J.value?(u(),N("div",Le,[v(d(C),{slot:"header",style:{"--background":"rgba(255, 255, 255, 0.5)"}},{default:m(()=>[v(d(E),{class:"previousLabel"},{default:m(()=>[...l[8]||(l[8]=[h("Password",-1)])]),_:1})]),_:1}),k("div",qe,[v(Se,{placeholder:ie[0].placeHolder,"new-password":ie[0].dataValue.value,"repeat-password":ie[1].dataValue.value,onUpdate_newPassword:ie[0].dataHandler,onUpdate_repeatPassword:ie[1].dataHandler},null,8,["placeholder","new-password","repeat-password","onUpdate_newPassword","onUpdate_repeatPassword"]),ie[0].show_error.value&&ie[1].show_error.value&&ie[0].error_message===ie[1].error_message?(u(),N("div",je,[v(d(E),{class:"error-label"},{default:m(()=>[h(y(ie[0].error_message),1)]),_:1})])):(u(),N("div",Re,[ie[0].show_error.value?(u(),n(d(E),{key:0,class:"error-label"},{default:m(()=>[h(y(ie[0].error_message),1)]),_:1})):S("",!0),ie[1].show_error.value?(u(),n(d(E),{key:1,class:"error-label"},{default:m(()=>[h(y(ie[1].error_message),1)]),_:1})):S("",!0)]))])])):S("",!0),k("div",{class:F(["form_el",{"error-section":K.value.dateOfBirth}])},[k("h6",{style:{"font-size":"16px","font-weight":"400"},class:F({"error-label":K.value.dateOfBirth})}," Date Of Birth ",2),v(Ce,{place_holder:"Date Of Birth",onDateUpDated:X,date_prop:G.value},null,8,["date_prop"]),K.value.dateOfBirth?(u(),N("div",$e," Date of birth is required ")):S("",!0)],2),v(d(C),{class:F({"error-item":K.value.gender})},{default:m(()=>[v(d(E),{position:"stacked",class:F({"error-label":K.value.gender})},{default:m(()=>[...l[9]||(l[9]=[h("Gender",-1)])]),_:1},8,["class"]),v(d(D),{modelValue:Z.value.gender,"onUpdate:modelValue":l[4]||(l[4]=e=>Z.value.gender=e)},{default:m(()=>[k("div",Ye,[v(d(C),{lines:"none",style:{"--padding-start":"0"}},{default:m(()=>[v(d(V),{slot:"start",value:"male"}),v(d(E),null,{default:m(()=>[...l[10]||(l[10]=[h("Male",-1)])]),_:1})]),_:1}),v(d(C),{lines:"none",style:{"--padding-start":"0"}},{default:m(()=>[v(d(V),{slot:"start",value:"female"}),v(d(E),null,{default:m(()=>[...l[11]||(l[11]=[h("Female",-1)])]),_:1})]),_:1})])]),_:1},8,["modelValue"])]),_:1},8,["class"]),K.value.gender?(u(),N("div",He," Gender is required ")):S("",!0),v(d(C),{class:F({"error-item":K.value.roles})},{default:m(()=>[v(d(P),{modelValue:Z.value.roles,"onUpdate:modelValue":l[5]||(l[5]=e=>Z.value.roles=e),label:"Roles","label-placement":"stacked",placeholder:"Select roles",multiple:"",class:F({"error-input":K.value.roles})},{default:m(()=>[(u(!0),N(A,null,I(W.value,e=>(u(),n(d(M),{key:e,value:e},{default:m(()=>[h(y(e),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","class"])]),_:1},8,["class"]),K.value.roles?(u(),N("div",Ge," At least one role is required ")):S("",!0),v(d(C),{class:F({"error-item":K.value.programs})},{default:m(()=>[v(d(P),{modelValue:Z.value.programs,"onUpdate:modelValue":l[6]||(l[6]=e=>Z.value.programs=e),label:"Programs","label-placement":"stacked",placeholder:"Select programs",multiple:"",class:F({"error-input":K.value.programs})},{default:m(()=>[(u(!0),N(A,null,I(Q.value,e=>(u(),n(d(M),{key:e.id,value:e.name},{default:m(()=>[h(y(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","class"])]),_:1},8,["class"]),K.value.programs?(u(),N("div",Je," At least one program is required ")):S("",!0),k("div",Ke,[l[12]||(l[12]=k("h6",{style:{"font-size":"16px","font-weight":"400"}},"Facility",-1)),v(Fe,{show_error:r.value,onFacilitySelected:ae,selected_district_ids:$.value,selected_location:Y.value},null,8,["show_error","selected_district_ids","selected_location"])])],32)]),_:1}),v(d(z),null,{default:m(()=>[v(d(f),null,{default:m(()=>[v(d(x),{slot:"end"},{default:m(()=>[k("div",null,[v(d(_),{onClick:re,fill:"solid",disabled:e.isSaving},{default:m(()=>[...l[13]||(l[13]=[h(" Cancel ",-1)])]),_:1},8,["disabled"]),v(d(_),{onClick:ne,fill:"solid",disabled:e.isSaving,style:{"margin-left":"10px","margin-right":"10px"}},{default:m(()=>[e.isSaving?(u(),n(d(L),{key:0,style:{height:"36px"},name:"crescent",slot:"start"})):S("",!0),h(" "+y(e.editingUser?"Update":"Create")+" User ",1)]),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"]))}}),Qe=Ee(Ze,[["__scopeId","data-v-9408bf7e"]]),We={class:"users-grid"},Xe={class:"user-header"},ea=["src","alt"],aa={class:"user-info"},la={key:0,class:"user-meta"},ta={key:0,class:"meta-item"},ra={key:1,class:"meta-item"},sa={class:"user-details"},ia={key:0,class:"detail-item"},oa={key:1,class:"detail-item"},na={key:2,class:"detail-item"},ua={class:"detail-item"},da={class:"detail-item"},ca={class:"action-buttons"},ma={key:0,class:"empty-state"},va=r({__name:"miUsersTemplate",props:{initialSearchTerm:{default:""},initialStatusFilter:{default:"all"},initialItemsPerPage:{default:6},enableSearch:{type:Boolean,default:!0},enableStatusFilter:{type:Boolean,default:!0},enablePagination:{type:Boolean,default:!0},searchPlaceholder:{default:"Search users..."},searchDebounceTime:{default:300}},emits:["search-changed","status-filter-changed","users-filtered","user-edited","user-deleted","user-status-changed","user-created"],setup(e,{expose:a,emit:r}){const c=e,p=r,f=s([]),g=s(c.initialSearchTerm),x=s(c.initialStatusFilter),w=s(1),C=s(c.initialItemsPerPage),F=s(!1),B=s(null);let O=null;const D=e=>{var a,r,s,i,o,n,u;const{getAvatarUrl:d}=function(){const e=()=>{let e="";for(let a=0;a<6;a++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e};return{getAvatarUrl:(a,r=128)=>{const s=l(t,{seed:`${a}`,size:r,backgroundColor:[e()]}).toString(),i=unescape(encodeURIComponent(s));return`data:image/svg+xml;base64,${btoa(i)}`}}}();return{id:e.id,name:e.username,email:e.username,firstName:null===(a=e.profile)||void 0===a?void 0:a.firstName,lastName:null===(r=e.profile)||void 0===r?void 0:r.lastName,dateOfBirth:null===(s=e.profile)||void 0===s?void 0:s.dateOfBirth,gender:null===(i=e.profile)||void 0===i?void 0:i.gender,facility:null!==(o=e.facilities)&&void 0!==o&&null!==(o=o[0])&&void 0!==o&&o.facility?{name:e.facilities[0].facility.facility_name,code:e.facilities[0].facility.facility_code}:null,roles:(null===(n=e.roles)||void 0===n?void 0:n.map(e=>e.role.name))||[],programs:(null===(u=e.programs)||void 0===u?void 0:u.map(e=>e.program.name))||[],status:"active",avatar:d(e.username),createdAt:new Date(e.createdAt),lastActive:new Date(e.updatedAt)}},V=j(()=>{let e=f.value;if(c.enableSearch&&g.value){const a=g.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(a)||e.email.toLowerCase().includes(a)||e.roles&&e.roles.some(e=>e.toLowerCase().includes(a))||e.programs&&e.programs.some(e=>e.toLowerCase().includes(a))||e.gender&&e.gender.toLowerCase().includes(a)||e.facility&&e.facility.name&&e.facility.name.toLowerCase().includes(a))}return c.enableStatusFilter&&"all"!==x.value&&(e=e.filter(e=>e.status===x.value)),e}),P=j(()=>{if(!c.enablePagination)return V.value;const e=(w.value-1)*C.value,a=e+C.value;return V.value.slice(e,a)});i(()=>g.value,e=>{O&&clearTimeout(O),O=setTimeout(()=>{p("search-changed",e),w.value=1},c.searchDebounceTime)},{immediate:!1}),i(()=>x.value,e=>{p("status-filter-changed",e),w.value=1},{immediate:!1}),i(()=>V.value,e=>{p("users-filtered",e)},{deep:!0,immediate:!0});const M=e=>{w.value=e.page,C.value=e.itemsPerPage},T=e=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(e),L=e=>{const a=new Date,l=new Date(e);let t=a.getFullYear()-l.getFullYear();const r=a.getMonth()-l.getMonth();return(r<0||0===r&&a.getDate()<l.getDate())&&t--,t},q=()=>{F.value=!1,B.value=null},ce=s(!1),me=async e=>{try{if(ce.value=!0,B.value){var a;const l={roles:e.roles,programs:e.programs,facilities:[null===(a=e.facility)||void 0===a?void 0:a.code],profile:{firstName:e.firstName,lastName:e.lastName,gender:e.gender,dateOfBirth:e.dateOfBirth}};e.password&&(l.password=e.password);const t=await De.updateUser(B.value.id,l),r=f.value.findIndex(e=>e.id===B.value.id);-1!==r&&(f.value[r]=D(t)),ue.create({message:"User updated successfully",duration:2e3,color:"success"}).then(e=>e.present())}else{const a=await ve(e),l=await De.register(a),t=D(l);t&&(f.value.push(t),p("user-created",t),(await ue.create({message:"User created successfully",duration:2e3,color:"success"})).present())}q()}catch(l){(await ue.create({message:`Error saving user: ${l}`,duration:2e3,color:"danger"})).present()}finally{ce.value=!1}},ve=async e=>{if(!e||!e.facility)throw new Error("Invalid user data. 'facility' is required.");return{username:e.name,password:e.password,roles:e.roles,programs:e.programs,programIds:e.programIDs,facilities:[e.facility.code],profile:{firstName:e.firstName,lastName:e.lastName,gender:e.gender,dateOfBirth:e.dateOfBirth}}},pe=async()=>{try{const e=await De.getUsers();f.value=e.map(D)}catch(e){console.error("Failed to fetch MIUM users:",e),ue.create({message:"Failed to load users.",duration:2e3,color:"danger"}).then(e=>e.present())}};return o(async()=>{await pe()}),a({setSearchTerm:e=>{g.value=e},setStatusFilter:e=>{x.value=e},refreshUsers:pe,cleanup:()=>{O&&clearTimeout(O)},openAddUserModal:()=>{B.value=null,F.value=!0},users:f.value,filteredUsers:V,paginatedUsers:P}),(e,a)=>(u(),N(A,null,[v(d(U),{class:"ion-padding",style:{height:"80vh"}},{default:m(()=>[k("div",We,[(u(!0),N(A,null,I(P.value,e=>(u(),n(d(R),{key:e.id,class:"user-card"},{default:m(()=>[v(d($),null,{default:m(()=>[k("div",Xe,[v(d(Y),null,{default:m(()=>[k("img",{src:e.avatar,alt:e.name},null,8,ea)]),_:2},1024),k("div",aa,[v(d(H),null,{default:m(()=>[h(y(e.name),1)]),_:2},1024),v(d(G),null,{default:m(()=>[h(y(e.email),1)]),_:2},1024),e.gender||e.dateOfBirth?(u(),N("div",la,[e.gender?(u(),N("span",ta,[v(d(b),{icon:d(J),class:"meta-icon"},null,8,["icon"]),h(" "+y(e.gender),1)])):S("",!0),e.dateOfBirth?(u(),N("span",ra,[v(d(b),{icon:d(K),class:"meta-icon"},null,8,["icon"]),h(" "+y(L(e.dateOfBirth))+" years old ",1)])):S("",!0)])):S("",!0)]),v(d(Z),{color:"active"===e.status?"success":"medium",class:"status-chip"},{default:m(()=>[v(d(b),{icon:"active"===e.status?d(Q):d(W),slot:"start"},null,8,["icon"]),v(d(E),null,{default:m(()=>[h(y(e.status),1)]),_:2},1024)]),_:2},1032,["color"])])]),_:2},1024),v(d(X),null,{default:m(()=>[k("div",sa,[e.roles&&e.roles.length?(u(),N("div",ia,[v(d(b),{icon:d(ee),class:"detail-icon"},null,8,["icon"]),k("span",null,y(e.roles.join(", ")),1)])):S("",!0),e.programs&&e.programs.length?(u(),N("div",oa,[v(d(b),{icon:d(ae),class:"detail-icon"},null,8,["icon"]),k("span",null,y(e.programs.join(", ")),1)])):S("",!0),e.facility?(u(),N("div",na,[v(d(b),{icon:d(le),class:"detail-icon"},null,8,["icon"]),k("span",null,y(e.facility.name||"Assigned Facility"),1)])):S("",!0),k("div",ua,[v(d(b),{icon:d(K),class:"detail-icon"},null,8,["icon"]),k("span",null,"Joined "+y(T(e.createdAt)),1)]),k("div",da,[v(d(b),{icon:d(te),class:"detail-icon"},null,8,["icon"]),k("span",null,"Last active "+y(T(e.lastActive)),1)])]),k("div",ca,[v(d(_),{onClick:a=>(e=>{B.value=e,F.value=!0})(e),fill:"outline",size:"small",color:"primary"},{default:m(()=>[v(d(b),{icon:d(re),slot:"start"},null,8,["icon"]),a[0]||(a[0]=h(" Edit ",-1))]),_:1},8,["onClick"]),v(d(_),{onClick:a=>(async e=>{(await de.create({header:"Confirm Status Change",message:`Are you sure you want to ${"active"===e.status?"deactivate":"activate"} ${e.name}?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Confirm",handler:()=>{e.status="active"===e.status?"inactive":"active",p("user-status-changed",e),ue.create({message:`User ${"active"===e.status?"activated":"deactivated"} successfully`,duration:2e3,color:"success"}).then(e=>e.present())}}]})).present()})(e),fill:"outline",size:"small",color:"active"===e.status?"warning":"success"},{default:m(()=>[v(d(b),{icon:"active"===e.status?d(se):d(ie),slot:"start"},null,8,["icon"]),h(" "+y("active"===e.status?"Deactivate":"Activate"),1)]),_:2},1032,["onClick","color"]),v(d(_),{onClick:a=>(async e=>{(await de.create({header:"Confirm Delete",message:`Are you sure you want to delete ${e.name}? This action cannot be undone.`,buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",role:"destructive",handler:()=>{const a=f.value.findIndex(a=>a.id===e.id);-1!==a&&(f.value.splice(a,1),p("user-deleted",e.id),ue.create({message:"User deleted successfully",duration:2e3,color:"success"}).then(e=>e.present()))}}]})).present()})(e),fill:"outline",size:"small",color:"danger"},{default:m(()=>[v(d(b),{icon:d(oe),slot:"start"},null,8,["icon"]),a[1]||(a[1]=h(" Delete ",-1))]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),0===V.value.length?(u(),N("div",ma,[v(d(b),{icon:d(ne),class:"empty-icon"},null,8,["icon"]),a[2]||(a[2]=k("h3",null,"No users found",-1)),a[3]||(a[3]=k("p",null,"Try adjusting your search or filter criteria",-1))])):S("",!0)]),_:1}),v(d(z),null,{default:m(()=>[v(be,{"total-items":V.value.length,"current-page":w.value,"items-per-page":C.value,"onUpdate:pagination":M},null,8,["total-items","current-page","items-per-page"])]),_:1}),v(Qe,{"is-open":F.value,"editing-user":B.value,"is-saving":ce.value,onSave:me,onClose:q},null,8,["is-open","editing-user","is-saving"])],64))}}),pa=Ee(va,[["__scopeId","data-v-deaf844d"]]),fa=r({__name:"UserNav",props:{searchTerm:{type:String,required:!0},statusFilter:{type:String,required:!0}},emits:["update:searchTerm","update:statusFilter","openAddUserModal"],setup:(e,{emit:a})=>(a,l)=>(u(),N(A,null,[v(d(pe),{class:"ion-align-items-center"},{default:m(()=>[v(d(ce),{size:"8"},{default:m(()=>[v(d(me),{value:e.searchTerm,onIonInput:l[0]||(l[0]=e=>a.$emit("update:searchTerm",e.detail.value)),placeholder:"Search users...","show-clear-button":"focus",debounce:"300"},null,8,["value"])]),_:1}),v(d(ce),{size:"4",class:"ion-text-right"},{default:m(()=>[v(d(_),{onClick:l[1]||(l[1]=e=>a.$emit("openAddUserModal")),fill:"solid"},{default:m(()=>[v(d(b),{icon:d(ve),slot:"start"},null,8,["icon"]),l[3]||(l[3]=h(" Add User ",-1))]),_:1})]),_:1})]),_:1}),v(d(pe),{class:"ion-padding-start ion-padding-end"},{default:m(()=>[v(d(ce),{size:"12"},{default:m(()=>[v(d(fe),{value:e.statusFilter,onIonChange:l[2]||(l[2]=e=>a.$emit("update:statusFilter",e.detail.value))},{default:m(()=>[v(d(ge),{value:"all"},{default:m(()=>[v(d(E),null,{default:m(()=>[...l[4]||(l[4]=[h("All",-1)])]),_:1})]),_:1}),v(d(ge),{value:"active"},{default:m(()=>[v(d(E),null,{default:m(()=>[...l[5]||(l[5]=[h("Active",-1)])]),_:1})]),_:1}),v(d(ge),{value:"inactive"},{default:m(()=>[v(d(E),null,{default:m(()=>[...l[6]||(l[6]=[h("Inactive",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})],64))}),ga={class:"sticky-user-nav"};e("default",Ee(r({__name:"miusers",setup(e,{expose:a}){const l=s(""),t=s("all"),r=s([]),i=s(0),c=s();j(()=>l.value),j(()=>t.value);const p=e=>{l.value=e,console.log("Search term updated:",e)},f=e=>{t.value=e,console.log("Status filter updated:",e)},g=e=>{l.value!==e&&(l.value=e),console.log("Internal search changed:",e)},h=e=>{t.value!==e&&(t.value=e),console.log("Internal filter changed:",e)},y=e=>{i.value=e.length},x=e=>{console.log("User created:",e)},_=e=>{console.log("User edited:",e)},b=e=>{console.log("User deleted:",e)},w=e=>{console.log("User status changed:",e)},N=()=>{c.value?c.value.openAddUserModal():console.log("usersTemplateRef is not yet available.")},S=async()=>{try{console.log("Loading users...")}catch(e){console.error("Error loading users:",e)}};return o(async()=>{await(async()=>{_e().setNavigationPayload("Manage Integrated Users",!0,!1,"/","home","")})(),await S()}),he(()=>{c.value&&"function"==typeof c.value.cleanup&&c.value.cleanup()}),a({refreshUsers:()=>{c.value&&c.value.refreshUsers(),S()},setSearch:e=>{l.value=e,c.value&&c.value.setSearchTerm(e)},setFilter:e=>{t.value=e,c.value&&c.value.setStatusFilter(e)},searchTerm:l,statusFilter:t,usersList:r,filteredUsersCount:i}),(e,a)=>(u(),n(d(ye),null,{default:m(()=>[v(xe),v(d(U),{fullscreen:!0},{default:m(()=>[k("div",ga,[v(fa,{fullscreen:!0,searchTerm:l.value,statusFilter:t.value,"onUpdate:searchTerm":p,"onUpdate:statusFilter":f,onOpenAddUserModal:N},null,8,["searchTerm","statusFilter"])]),v(pa,{ref_key:"usersTemplateRef",ref:c,"initial-users":r.value,"initial-search-term":l.value,"initial-status-filter":t.value,"search-debounce-time":500,"enable-search":!0,"enable-status-filter":!0,"enable-pagination":!0,onSearchChanged:g,onStatusFilterChanged:h,onUsersFiltered:y,onUserCreated:x,onUserEdited:_,onUserDeleted:b,onUserStatusChanged:w},null,8,["initial-users","initial-search-term","initial-status-filter"])]),_:1})]),_:1}))}}),[["__scopeId","data-v-5071b8a1"]]))}}});

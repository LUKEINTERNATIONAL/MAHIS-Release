import{d as ce,aV as pe,r as s,a as Te,w as te,e as I,f as u,k as l,l as e,u as a,ah as Ct,b5 as Ea,b2 as rt,G as Ha,E as Ta,ai as Na,aj as dt,_ as ve,I as Va,a3 as ea,bf as St,aU as xa,H as X,m as b,J as t,Q as R,c as fe,F as de,O as H,bw as $t,aP as $a,bm as ft,a4 as ge,a5 as J,al as ut,P as Ee,ak as Re,W as Se,K as V,bz as Ma,bv as ta,Z as La,aS as Ra,z as Xe,an as Fa,cE as Ba,a2 as It,R as Ua,i as nt,v as st,b9 as Ke,au as Qe,es as qa,et as Wa,eu as Ga,az as za,aF as aa,aw as na,bU as Ya,aN as ja,p as Ze,bs as Ka,L as it,ev as Mt,ew as Lt,bk as lt,ex as Rt,ey as Ft,d6 as Bt,ez as Ut,eA as qt,eB as Wt,db as Gt,bT as Qa,ay as Ja,b$ as Xa,N as Pe,br as Ae,bl as et,bn as sa,bZ as Za,bu as en,c5 as zt,dm as tn,e5 as Yt}from"./vendor-yRLTeOJQ.js";import{bE as oa,bv as ia,a$ as Ie,M as ae,b1 as Ne,t as ke,af as De,aW as re,G as ze,_ as Oe,J as xe,b5 as kt,B as qe,bd as an,S as He,o as jt,O as Kt,aQ as _e,aH as wt,H as Le,u as Je,l as Ve,bF as la,aB as Ge,aA as ra,aC as ua,bG as gt,P as Ot,bH as _t,bI as nn,bJ as sn,bK as on,bL as ln,s as rn,aG as Qt,aI as un,aJ as Ye,aK as dn,d as cn,aL as da,g as mn,Z as pn,e as vn,N as fn,aM as ot,aN as gn,aO as Jt,aP as _n,aR as Pt,a0 as hn,m as ca,bM as yn,bN as bn,aT as Dn,b8 as Cn,K as Sn,aw as Xt,an as ht,ar as yt,aq as wn}from"../index-DZfKDOkt.js";import{p as ma,e as In,a as kn,m as On,b as Pn,v as An,c as En,_ as Hn}from"./LevelOfConsciousness.vue_vue_type_script_setup_true_lang-DgxzEk-B.js";import{P as pa}from"./patient_complaints_service-s8LKwOLA.js";import{D as At}from"./DashBox-CCObOZCR.js";import{B as at}from"./BasicForm-BdUUZra0.js";import{c as Et,f as ct,a as tt,b as Tn}from"./formatServerData-Bzd28LzX.js";import Nn from"./LabOrdersList-CjDWeSBB.js";import{R as Vn,_ as xn,L as $n,A as Mn,D as Ln,a as Rn}from"./NextAppointment-zNuV76bc.js";import{v as Zt}from"./group_validation-BB0xGjs8.js";import{u as Fn,a as bt,_ as Bn,s as Un,c as qn,b as Wn,P as Gn}from"./useFormWizard-BhVOnad0.js";import{l as We}from"./lodash-NJiRuGo9.js";import{u as zn,_ as Dt,D as Yn,A as jn,R as Kn,a as Qn,b as Jn}from"./usePatientProfile-B_0PdpHT.js";import{a as Xn,b as Zn}from"./drug_prescription_service-C6Iddj0c.js";const es={class:"modal_wrapper"},ts={class:"uniform_columns"},as=ce({__name:"AHDPastMedicalHistory",setup(n,{expose:d}){const v=oa(),{pastMedicalHistory:c}=pe(v),g=s([]);Te(()=>{g.value=v.getInitial(),f()}),te(c,()=>{f()},{deep:!0});const f=()=>{var m;const S=["TB","Chronic Obstructive Pulmonary Disease (COPD)","Asthma","Epilepsy","Previous stroke","Peptic Ulcer Disease (PUD)","Mental disorder","Bleeding disorders","Hypertension","HIV Positive","Diabetes Mellitus"];(m=ia(c.value,"None"))!=null&&m.checked?S.forEach(O=>{Ie(c.value,"TB treatment","displayNone",!0),ae(c.value,"TB drugs","displayNone",!0),ae(c.value,"TB drug start date","displayNone",!0),Ie(c.value,"Hypertension medication","displayNone",!0),ae(c.value,"Current hypertension treatment regimen","displayNone",!0),Ie(c.value,"HIV status","displayNone",!0),ae(c.value,"ARV start date","displayNone",!0),Ie(c.value,"Diabetes","displayNone",!0),Ie(c.value,"Controlled by","displayNone",!0),Ne(c.value,O,"checked",!1),Ne(c.value,O,"disabled",!0)}):S.forEach(O=>{Ne(c.value,O,"disabled",!1)})},k=S=>{ae(c.value,"TB drugs","popOverData",{filterData:!0,data:[{name:"Auramine 'O' (C.I. 41000) 50g"},{name:"Bedaquilline 100mg"},{name:"Clofazimine 100mg"},{name:"Clofazimine 50mg"},{name:"Cycloserine 125mg"},{name:"Cycloserine 250mg"},{name:"Delamanid 50mg"},{name:"Ethambutol 100mg"},{name:"Ethambutol 400mg"},{name:"Ethionamide 250mg"},{name:"Isoniazid 100mg "},{name:"Isoniazid 300mg"},{name:"Isoniazid / Rifapentine 300mg / 300mg"},{name:"Levofloxacin 100mg"},{name:"Levofloxacin 250mg"},{name:"Linezolid 600mg"},{name:"Moxifloxacin 400mg"},{name:"Pyrazinamide 400mg"},{name:"Rifabutin 150mg Capsules"},{name:"Rifampicin 150mg/isoniazid 75mg"},{name:"Rifampicin 75mg+INH 50mg dispersible"},{name:"Rifampicin 75mg+INH 50mg+Pyrazinamide 150mg dispersible"},{name:"Rifampicin150mg/Isoniazid75mg/Pyrazinamide 400mg/Ethambutol"}]}),ae(c.value,"Current hypertension treatment regimen","popOverData",{filterData:!0,data:[{name:"Captopril 12.5mg"},{name:"Aspirin 75mg"},{name:"Hydrochlorothiazide 25mg"},{name:"Enalapril Meleate 5mg"},{name:"Enalapril Maleate 10mg"}]})},r=async()=>[...await Et(c.value),...await ct(c.value),...await tt(c.value)];return d({onSubmit:async()=>{const S=await r();if(S.length===0){ke("No past medical history data to save");return}await De.addObsToEncounterPatient(S,re.PAST_MEDICAL_HISTORY),ze("Past medical history saved successful")}}),(S,m)=>(u(),I("div",es,[l("div",ts,[e(at,{contentData:a(c),initialData:g.value,"onUpdate:inputValue":k,"onUpdate:selected":k},null,8,["contentData","initialData"])])]))}}),ns=Oe(as,[["__scopeId","data-v-a04ad8c8"]]),ss=ce({name:"Menu",mixins:[xn],components:{IonContent:ea,IonHeader:Va,IonItem:ve,IonList:dt,IonMenu:Na,IonTitle:Ta,IonToolbar:Ha,IonInput:rt,IonPopover:Ea,DashBox:At,SelectionPopover:an,BasicInputField:qe,BasicForm:at,List:kt,DynamicButton:xe,LabOrdersList:Nn,RadiologyInvestigation:Vn},data(){return{segmentContent:"Lab Investigations",iconsContent:Ve,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",testResult:"",test:"",labOrders:"",filteredSpecimen:"",testData:[],popoverOpen:!1,labOrderStatus:!1,event:"",specimen:"",radiologyOrdersStatus:!1,otherOrdersStatus:!1}},setup(){return{checkmark:xa,pulseOutline:St}},computed:{...Ct(wt,["investigations"]),...Ct(Je,["patient"]),inputFields(){return this.investigations[0].data.rowData[0].colData}},watch:{investigations:{handler(){this.setDashedBox()},deep:!0},patient:{async handler(){var n;(n=this.patient)!=null&&n.labOrders&&(this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved])},deep:!0},$route:{async handler(){await this.getTests()},deep:!0}},async mounted(){await this.getTests(),this.updateInvestigationsStores(),this.setDashedBox(),this.updateInvestigationWizard()},methods:{setSegmentContent(n){this.segmentContent=n},async getTests(){let n;He.getPouchDbStatus()&&He.getLanConnectionStatus()?n=await jt("test_types"):n=await Kt.getTestTypes(),ae(this.investigations,"test","multiSelectData",n)},toggleLabOrderStatus(){this.labOrderStatus=!this.labOrderStatus},async updateInvestigationWizard(){var d;if(!((d=this.patient)!=null&&d.labOrders))return;this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved];const n=await this.labOrders.filter(v=>Le.toStandardHisFormat(Le.sessionDate())===Le.toStandardHisFormat(v.order_date));n.length>0?this.investigations[0].selectedData=n:this.investigations[0].selectedData=""},async updateInvestigationsStores(){await this.updateInvestigationWizard(),wt().setInvestigations(this.investigations)},displayInputFields(){this.testResult="",this.selectedText="",this.no_item=!1,this.addItemButton=!1,this.search_item=!0},async validateRowData(){return Zt(this.investigations)},async checkTest(){return await this.isNameInData(this.inputFields[0].value.name,await this.investigations[0].selectedData)?(ae(this.investigations,"test","alertsErrorMassage","Lab order already selected"),!1):(ae(this.investigations,"test","alertsErrorMassage",""),!0)},async addNewRow(){Zt(this.investigations)&&await this.checkTest()&&(await this.saveTest(),this.investigations[0].data.rowData[0].colData[0].value="",this.investigations[0].data.rowData[0].colData[1].value="",this.search_item=!1,this.display_item=!0,this.addItemButton=!0),this.updateInvestigationWizard()},isNameInData(n,d){for(let v of d)for(let c of v.tests)if(c.name===n)return!0;return!1},async saveTest(){await new $n().postActivities(this.patient.patientID,[{concept_id:this.inputFields[0].value.concept_id,name:this.inputFields[0].value.name,specimen:this.inputFields[1].value.name,reason:"Routine",specimenConcept:await _e.getConceptID(this.inputFields[1].value.name,!0)}]),ae(this.investigations,"specimen","disabled",!0),this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved]},async handleInputData(n){if(n.inputHeader=="Test"&&this.checkTest(),ae(this.investigations,"specimen","alertsErrorMassage",""),n.inputHeader=="Test"&&n.value){let d;He.getPouchDbStatus()&&He.getLanConnectionStatus()?d=await jt("specimens"):d=await Kt.getSpecimens("",1e3),this.specimen=await _e.getConceptSet(n.value.name,"",{names:d.map(v=>v.name)}),this.specimen.length==1?(ae(this.investigations,"specimen","value",this.specimen[0]),ae(this.investigations,"specimen","disabled",!0)):(ae(this.investigations,"specimen","value",""),ae(this.investigations,"specimen","disabled",!1)),ae(this.investigations,"specimen","multiSelectData",this.specimen)}},async filterTest(n){return await this.labOrders.filter(d=>d.name.toLowerCase().includes(n.toLowerCase()))},async filterSpecimen(n){var d;return(d=this.specimen[0])!=null&&d.name&&n?await this.specimen.filter(v=>v==null?void 0:v.name.toLowerCase().includes(n.toLowerCase())):[]},setTest(n){this.selectedText=n.name,this.inputFields[1].inputHeader=="Test"?this.investigations[0].data.rowData[0].colData[0].value=n.name:this.investigations[0].data.rowData[0].colData[1].value=n.name,this.updateInvestigationsStores()},setDashedBox(){(this.inputFields[1].value||this.inputFields[0].value)&&(this.addItemButton=!1,this.search_item=!0,this.no_item=!1),this.investigations[0].selectedData.length>0?(this.display_item=!0,this.no_item=!1):this.search_item||(this.no_item=!0)}}}),os={class:"background"},is={key:0},ls={key:1},rs={key:2},us={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},ds={key:3},cs={class:"ion-padding",slot:"content"},ms={key:4};function ps(n,d,v,c,g,f){const k=X("ion-label"),r=X("ion-segment-button"),_=X("ion-segment"),S=X("VisitsHistory"),m=X("LabOrdersList"),O=X("RadiologyInvestigation");return u(),I("div",os,[e(_,{value:n.segmentContent,style:{"margin-top":"5px"}},{default:t(()=>[e(r,{value:"Lab Investigations",onClick:d[0]||(d[0]=G=>n.setSegmentContent("Lab Investigations"))},{default:t(()=>[e(k,null,{default:t(()=>[...d[3]||(d[3]=[R("Lab Investigations",-1)])]),_:1})]),_:1}),e(r,{value:"Radiology Investigation",onClick:d[1]||(d[1]=G=>n.setSegmentContent("Radiology Investigation"))},{default:t(()=>[e(k,null,{default:t(()=>[...d[4]||(d[4]=[R("Radiology Investigation",-1)])]),_:1})]),_:1}),e(r,{value:"Other Investigation",onClick:d[2]||(d[2]=G=>n.setSegmentContent("Other Investigation"))},{default:t(()=>[e(k,null,{default:t(()=>[...d[5]||(d[5]=[R("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),n.segmentContent=="Radiology Investigation"?(u(),I("div",is,[e(S)])):b("",!0),n.segmentContent=="Other Investigation"?(u(),I("div",ls)):b("",!0),n.segmentContent=="Lab Investigations"?(u(),I("div",rs,[l("div",us,[l("span",null,[e(m,{propOrders:n.labOrders},null,8,["propOrders"])])])])):b("",!0),n.segmentContent=="Radiology Investigation"?(u(),I("div",ds,[l("div",cs,[e(O)])])):b("",!0),n.segmentContent=="Other Investigation"?(u(),I("div",ms)):b("",!0)])}const vs=Oe(ss,[["render",ps],["__scopeId","data-v-4e674e67"]]),fs={key:0},gs={style:{"align-content":"center"}},_s={class:"ion-padding",slot:"content"},hs=ce({__name:"AHDPresentingComplaints",setup(n,{expose:d}){const v=la(),{presentingComplaints:c}=pe(v),g=s(Ve),f=s(!0),k=s(!1),r=s(!0),_=s(!1),S=s([]),m=s([]),O=s(),G=fe(()=>[{componentType:"multiSelectInputField",header:"Presenting Complaints",name:"PresentingComplaints",trackBy:"concept_id",icon:Ve.search,hideSelected:!0,validation:P=>q(P==null?void 0:P.name,S.value)?"Presenting complaint already added":Ge.required(P),options:m.value,grid:{s:"6"}},{componentType:"inputField",header:"Duration",name:"duration",icon:Ve.time,validation:P=>Ge.isNotEmptyandNumber(P),grid:{s:"6"},unitOptions:[{label:"Hours",value:"Hours"},{label:"Days",value:"Days"},{label:"Weeks",value:"Weeks"},{label:"Months",value:"Months"},{label:"Years",value:"Years"}],unitValidation:P=>!P||P===""?"Please select a unit.":null},{componentType:"inputField",header:"Specify the presenting complaint(s)",name:"Other (specify)",icon:Ve.editPen,validation:P=>q(P,S.value)?"Presenting complaint already added":Ge.required(P),condition:P=>{var B;return((B=P==null?void 0:P.PresentingComplaints)==null?void 0:B.name)==="Other"}},{componentType:"Alert",condition:P=>{var B;return Ge.required((B=P==null?void 0:P.PresentingComplaints)==null?void 0:B.name)!=null},backgroundColor:"lightyellow",textColor:"black",value:"Please search thoroughly for the complaint. If it is not listed, search and select the 'Other' option to specify the complaint.",name:"noMatchAlert"}]),{formRef:p}=ra(),C=async()=>{m.value=await pa.getComplaintsList("Presenting complaint"),ae(c.value,"PresentingComplaints","multiSelectData",m.value)},U=()=>{f.value=!1,r.value=!1,k.value=!0},T=async()=>{var W,y;const P=(W=p.value)==null?void 0:W.getFormValues();((y=p.value)==null?void 0:y.validateForm())==null&&(F(P),k.value=!1,r.value=!0)},F=P=>{var o;const B=P.duration+" "+P.duration_unit,W=P.PresentingComplaints,y=W.name==="Other"?P["Other (specify)"]:W.name;S.value.push({actionBtn:!0,btn:["delete"],name:y,concept_id:W.concept_id,duration:W.duration,durationUnits:W.duration_unit,display:[y,B],data:[{concept_id:8578,value_coded:W.concept_id,obs_datetime:He.getSessionDate(),child:[{concept_id:W.concept_id,value_text:B,obs_datetime:He.getSessionDate()}]}]}),(o=p.value)==null||o.resetForm(),_.value=!0},q=(P,B)=>B.some(W=>W.name===P),M=P=>{S.value=S.value.filter(B=>B.display[0]!==P.name)},K=async()=>{const P=await De.getObsByEncounterIdAndDate(re.PRESENTING_COMPLAINTS),B=S.value.flatMap(W=>W.data);if(B.length<=0&&P.length<=0)return ke("Presenting complaints is required");B.length<=0||(await De.addObsToEncounterPatient(B,re.PRESENTING_COMPLAINTS),ze("Presenting complaints saved successful"),S.value=[])};return Te(async()=>{await C()}),d({onSubmit:K}),(P,B)=>{const W=X("ion-row"),y=X("ion-label"),o=X("ion-accordion"),$=X("ion-accordion-group");return u(),I(de,null,[e(At,{status:f.value,content:"No presenting complaints added"},null,8,["status"]),_.value?(u(),I("span",fs,[e(kt,{listData:S.value,"onClicked:delete":M},null,8,["listData"])])):b("",!0),k.value?(u(),H(W,{key:1},{default:t(()=>[e(ua,{formData:G.value,ref_key:"formRef",ref:p},null,8,["formData"]),l("div",gs,[e(xe,{fill:"clear",icon:g.value.plus,iconSlot:"icon-only","onClicked:btn":B[0]||(B[0]=i=>T()),name:"Save"},null,8,["icon"])])]),_:1})):b("",!0),r.value?(u(),H(W,{key:2,style:{"margin-top":"10px"}},{default:t(()=>[e(xe,{fill:"clear",icon:g.value.plus,iconSlot:"icon-only","onClicked:btn":B[1]||(B[1]=i=>U()),name:"Add new presenting complaints"},null,8,["icon"])]),_:1})):b("",!0),e(W,null,{default:t(()=>[e($,{ref_key:"accordionGroup",ref:O,class:"previousView"},{default:t(()=>[e(o,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:t(()=>[e(a(ve),{slot:"header",color:"light"},{default:t(()=>[e(y,{class:"previousLabel"},{default:t(()=>[...B[2]||(B[2]=[R("Previous presenting complaints",-1)])]),_:1})]),_:1}),l("div",_s,[e(ma)])]),_:1})]),_:1},512)]),_:1})],64)}}}),ys=Oe(hs,[["__scopeId","data-v-4a3757d3"]]),bs={key:0,class:"ion-padding"},Ds={class:"accordion_group ion-padding"},Cs={style:{"font-weight":"bold"}},Ss={class:"error"},ws={class:"ion-padding",slot:"content"},Is={class:"ion-padding"},ks={class:"ion-padding"},Os={key:0,class:"ion-padding"},Ps={class:"ion-padding",style:{"border-bottom":"dashed #ccc"}},As=ce({__name:"AHDStaging",props:{hideSubmit:{type:Boolean,default:!1},date:{default:gt.getSessionDate()}},setup(n,{expose:d}){const v=n,c=new Ot,g=s({}),f=new gt(c.getID(),c.getAge(),-1);te(()=>v.date,i=>{var j;const h=(j=i==null?void 0:i.standardDate)!=null?j:gt.getSessionDate(),w=Xe(h).diff(c.getBirthdate(),"years");f.setAge(w),f.setDate(h)},{deep:!0,immediate:!0});const k=$t({stage_4_conditions:{title:"Stage 4 Conditions",options:[]},stage_3_conditions:{title:"Stage 3 Conditions",options:[]},stage_2_conditions:{title:"Stage 2 Conditions",options:[]},stage_1_conditions:{title:"Stage 1 Conditions",options:[]}}),r=$t({cd4:"",cd4Date:"",isChildBearing:!1,reasonForArt:"",pregnant:"",breastFeeding:"",cd4Available:"",cd4Modifier:"",cd4Location:"",whoStage:"",staging:[],confirmatoryTest:""}),_={reasonForArt:{buildObs:()=>f.buildReasonForArtObs(r.reasonForArt),suggestAvalue:()=>({"PRESUMED SEVERE HIV":{priority:1,condition:()=>c.getAgeInMonths()<12&&r.confirmatoryTest==="HIV rapid test"&&_e.getConceptsByCategory("pshd_condition").some(i=>F().includes(i.name))},"WHO STAGE IV PEDS":{priority:2,condition:()=>f.isPedaid()&&m(["stage_4_conditions"])},"WHO STAGE III PEDS":{priority:3,condition:()=>f.isPedaid()&&m(["stage_3_conditions"])},"HIV DNA polymerase chain reaction":{priority:4,condition:()=>c.getAgeInMonths()<12&&r.confirmatoryTest==="HIV DNA polymerase chain reaction"},"CD4 COUNT LESS THAN OR EQUAL TO 750":{priority:5,condition:()=>U(750)&&T()&&O()&&c.ageInMonths()>=24&&c.ageInMonths()<=56},"CD4 COUNT LESS THAN OR EQUAL TO 500":{priority:6,condition:()=>f.isPedaid()&&U(500)&&T()&&O()},"HIV infected":{priority:7,condition:()=>c.getAgeInMonths()<24||c.getAge()<=5},"WHO STAGE IV ADULT":{priority:1,condition:()=>{const i=_e.getConceptsByCategory("severe_hiv_wasting_syndrome");return f.isAdult()&&(m(["stage_4_conditions"])||i.filter(h=>F().includes(h.name)).length>=2)}},"WHO STAGE III ADULT":{priority:2,condition:()=>f.isAdult()&&m(["stage_3_conditions"])},"cd4 less than or equal to 350":{priority:3,condition:()=>f.isAdult()&&U(350)&&O()},"cd4 less than or equal to 250":{priority:4,condition:()=>f.isAdult()&&U(250)&&O()},"cd4 less than or equal to 500":{priority:4,condition:()=>f.isAdult()&&U(500)&&O()},BREASTFEEDING:{priority:5,condition:()=>f.isAdult()&&r.breastFeeding==="Yes"&&T()},"PATIENT PREGNANT":{priority:6,condition:()=>f.isAdult()&&r.pregnant==="Yes"&&T()},Asymptomatic:{priority:7,condition:()=>T()}})},whoStage:{buildObs:()=>f.buildWhoStageObs(r.whoStage),suggestAvalue:()=>({"WHO STAGE IV ADULT":{priority:1,condition:()=>f.isAdult()&&m(["stage_4_conditions"])},"WHO STAGE III ADULT":{priority:2,condition:()=>f.isAdult()&&m(["stage_3_conditions"])},"WHO STAGE II ADULT":{priority:3,condition:()=>f.isAdult()&&m(["stage_2_conditions"])},"WHO STAGE I ADULT":{priority:4,condition:()=>f.isAdult()&&m(["stage_1_conditions"])},"WHO STAGE IV PEDS":{priority:1,condition:()=>f.isPedaid()&&(m(["stage_4_conditions"])||r.reasonForArt==="WHO STAGE IV PEDS")},"WHO STAGE III PEDS":{priority:2,condition:()=>f.isPedaid()&&m(["stage_3_conditions"])},"WHO STAGE II PEDS":{priority:3,condition:()=>f.isPedaid()&&m(["stage_2_conditions"])},"WHO STAGE I PEDS":{priority:4,condition:()=>f.isPedaid()&&m(["stage_1_conditions"])}})},cd4Available:{required:()=>!0,dataHandler:i=>{i!="Yes"&&(r.cd4="",r.cd4Date=""),g.value.cd4="",g.value.cd4Modifier="",g.value.cd4Date="",g.value.cd4Location=""}},pregnant:{required:()=>r.isChildBearing,buildObs:()=>f.buildValueCoded("Is patient pregnant?",r.pregnant)},breastFeeding:{required:()=>r.isChildBearing,buildObs:()=>f.buildValueCoded("Is patient breast feeding?",r.breastFeeding)},cd4:{required:()=>r.cd4Available==="Yes",validation:()=>{if(!C()){g.value.cd4="A number is required";return}p()>1e4&&(g.value.cd4="CD4 value cannot exceed 10,000")},buildObs:()=>f.buildValueNumber("CD4 count",p(),G())},cd4Modifier:{required:()=>r.cd4Available==="Yes",validation:()=>{r.cd4Modifier||(g.value.cd4Modifier="Please select modifier")},dataHandler:i=>r.cd4Modifier=i,options:[{label:"=",value:"="},{label:">",value:">"},{label:"<",value:"<"}]},cd4Date:{required:()=>r.cd4Available==="Yes",dataHandler:i=>{i&&(r.cd4Date=Xe(i).format("YYYY-MM-DD"))},validation:()=>{if(isNaN(new Date(r.cd4Date).getTime())){g.value.cd4Date="Invalid CD4 date";return}const i=Xe(r.cd4Date);if(i.isAfter(Xe(f.getDate()))){g.value.cd4Date="Cd4 result date can't be greater than ".concat(f.getDate());return}i.isBefore(Xe(c.getBirthdate()))&&(g.value.cd4Date="CD4 date must not be earlier than birthdate")},buildObs:()=>f.buildValueDate("Cd4 count datetime",r.cd4Date)},cd4Location:{required:()=>r.cd4Available==="Yes",dataHandler:i=>r.cd4Location=i,buildObs:()=>f.buildValueText("Cd4 count location",r.cd4Location)},staging:{validation:()=>{if(Object.keys(k).every(j=>P(j)<=0)){g.value.staging="Please select one or more staging conditions";return}const h=["stage_4_conditions","stage_3_conditions","stage_2_conditions"].some(j=>P(j)>0);k.stage_1_conditions.options.some(j=>/asymptomatic/i.test(j.name)&&j.checked)&&h&&(g.value.staging="Asymptomatic cannot be selected with other staging conditions")},buildObs:()=>Object.keys(k).reduce((h,w)=>(k[w].options.forEach(j=>{j.checked&&h.push(j.name)}),h),[]).map(h=>f.buildWhoCriteriaObs(h))}};function S(){Object.keys(r).forEach(i=>{typeof r[i]=="boolean"?r[i]=!1:Array.isArray(r[i])?r[i]=[]:r[i]=""}),Object.keys(g.value).forEach(i=>g.value[i]=""),y()}function m(i){return i.some(h=>P(h)>0)}function O(){return new Date(r.cd4Date)<=new Date("2016-04-30")}function G(){return r.cd4Modifier}function p(){return parseInt("".concat(r.cd4))}function C(){return/^\d+$/i.test("".concat(r.cd4))}function U(i){if(!C())return!1;const h=G(),w=p();return h==="="&&i===w||h==="<"&&w<=i||h===">"&&w>=i}function T(){return m(["stage_2_conditions","stage_1_conditions"])}function F(){return Object.keys(k).reduce((i,h)=>(k[h].options.forEach(w=>w.checked&&i.push(w.name)),i),[])}function q(i){if(g.value[i]="",typeof _[i].required=="function"&&_[i].required()&&!r[i]){g.value[i]="This field is required";return}r[i]&&typeof _[i].validation=="function"&&_[i].validation()}function M(i){var h,w,j;if(_[i]&&"suggestAvalue"in _[i]){r[i]="";const ne=_[i].suggestAvalue(),Ce=Object.keys(ne).reduce((z,we)=>{const $e=ne[we];return typeof $e.condition=="function"&&$e.condition()?[...z,{value:we,priority:$e.priority}]:z},[]);r[i]=(j=(w=(h=Ce.sort((z,we)=>z.priority-we.priority))==null?void 0:h[0])==null?void 0:w.value)!=null?j:""}}function K(){return Object.keys(r).reduce((i,h)=>{if(h in _&&r[h]&&typeof _[h].buildObs=="function"){const w=_[h].buildObs();return Array.isArray(w)?[...i,...w]:[...i,w]}return i},[])}function P(i){return k[i].options.filter(h=>h.checked).length}async function B(){await f.loadHivConfirmatoryTestType(),r.confirmatoryTest=f.getConfirmatoryTestType(),r.isChildBearing=c.isChildBearing()}function W(i,h){i in _&&typeof _[i].dataHandler=="function"&&_[i].dataHandler(h),q(i),Object.keys(_).forEach(w=>M(w))}function y(){Object.keys(k).forEach(i=>{var j,ne;const h=Number((ne=(j=i.match(/\d+/))==null?void 0:j[0])!=null?ne:0),w=f.getStagingConditions(h);k[i].options=w.map(Ce=>({checked:!1,name:Ce.name,concept_id:Ce.concept_id}))})}function o(){return Object.keys(_).forEach(i=>q(i)),Object.keys(g.value).every(i=>"".concat(g.value[i]).length<=0)}async function $(){if(console.log("Submitting staging"),!o())return ke("Please review form for errors"),!1;try{const i=await Promise.all(K());return await f.createEncounter(),await f.saveObservationList(i),ze("Staging Observations saved!"),!0}catch(i){return console.error(i),rn("Error has occured while saving observations"),!1}}return te(()=>v.date,i=>{f.setDate(i),c.date=i,S()}),Te(async()=>{await B(),y()}),d({validateStagingForm:o,buildPayload:K,onSubmit:$}),(i,h)=>(u(),H(a(Ra),null,{default:t(()=>[e(a($a),null,{default:t(()=>[r.isChildBearing?(u(),I("div",bs,[e(a(ft),null,{default:t(()=>[e(a(ge),null,{default:t(()=>[e(a(J),null,{default:t(()=>[e(_t,{label:"Pregnant?",modelValue:r.pregnant,"onUpdate:modelValue":h[0]||(h[0]=w=>r.pregnant=w),onIonChange:h[1]||(h[1]=w=>W("pregnant",w)),"error-message":g.value.pregnant},null,8,["modelValue","error-message"])]),_:1}),e(a(J),null,{default:t(()=>[e(_t,{label:"Breastfeeding?",modelValue:r.breastFeeding,"onUpdate:modelValue":h[2]||(h[2]=w=>r.breastFeeding=w),onOnChange:h[3]||(h[3]=w=>W("breastFeeding",w)),"error-message":g.value.breastFeeding},null,8,["modelValue","error-message"])]),_:1})]),_:1})]),_:1})])):b("",!0),l("div",Ds,[e(a(ut),{color:"light"},{default:t(()=>[(u(!0),I(de,null,Ee(k,(w,j)=>(u(),H(a(Re),{key:j},{default:t(()=>[e(a(ve),{color:"light",slot:"header"},{default:t(()=>[e(a(Se),{style:{color:"grey","font-size":"17px"},class:"ion-padding"},{default:t(()=>[l("b",Cs,[R(V(w.title)+" ",1),e(a(Ma),{color:P("".concat(j))>0?"primary":void 0},{default:t(()=>[R(" Selected: "+V(P("".concat(j))),1)]),_:2},1032,["color"])]),l("p",Ss,V(g.value.staging),1)]),_:2},1024)]),_:2},1024),l("div",ws,[e(a(dt),null,{default:t(()=>[(u(!0),I(de,null,Ee(w.options,(ne,Ce)=>(u(),H(a(ve),{key:Ce},{default:t(()=>[e(a(ta),{modelValue:ne.checked,"onUpdate:modelValue":z=>ne.checked=z,onIonChange:z=>W("staging",{stage_type:j,raw:z,option:ne})},null,8,["modelValue","onUpdate:modelValue","onIonChange"]),e(a(Se),{style:{margin:"13px"}},{default:t(()=>[R(V(ne.name),1)]),_:2},1024),h[15]||(h[15]=l("p",null,null,-1)),ne.description?(u(),H(a(La),{key:0,color:ne.color},{default:t(()=>[R(V(ne.text),1)]),_:2},1032,["color"])):b("",!0)]),_:2},1024))),128))]),_:2},1024)])]),_:2},1024))),128))]),_:1})]),l("div",Is,[l("div",ks,[e(_t,{label:"Recent CD4 count results available?",modelValue:r.cd4Available,"onUpdate:modelValue":h[4]||(h[4]=w=>r.cd4Available=w),onOnChange:h[5]||(h[5]=w=>W("cd4Available",w)),"error-message":g.value.cd4Available},null,8,["modelValue","error-message"])]),r.cd4Available==="Yes"?(u(),I("div",Os,[e(a(ft),{class:"ion-padding"},{default:t(()=>[e(a(ge),null,{default:t(()=>[e(a(J),null,{default:t(()=>[e(nn,{label:"CD4 Count Date",modelValue:r.cd4Date,"onUpdate:modelValue":h[6]||(h[6]=w=>r.cd4Date=w),required:r.cd4Available==="Yes","error-message":g.value.cd4Date,onOnChange:h[7]||(h[7]=w=>W("cd4Date",w))},null,8,["modelValue","required","error-message"])]),_:1})]),_:1}),e(a(ge),null,{default:t(()=>[e(a(J),{size:"2"},{default:t(()=>[e(sn,{label:"CD4 Result Modifier",required:r.cd4Available==="Yes","error-message":g.value.cd4Modifier,options:_.cd4Modifier.options,onOnChange:h[8]||(h[8]=w=>W("cd4Modifier",w.value))},null,8,["required","error-message","options"])]),_:1}),e(a(J),{size:"10"},{default:t(()=>[e(on,{label:"CD4 Count",modelValue:r.cd4,"onUpdate:modelValue":h[9]||(h[9]=w=>r.cd4=w),type:"number",onOnChange:h[10]||(h[10]=w=>W("cd4",w)),placeholder:"Enter CD4 Count","error-message":g.value.cd4},null,8,["modelValue","error-message"])]),_:1})]),_:1}),e(a(ge),{style:{"margin-top":"15px"}},{default:t(()=>[e(a(J),null,{default:t(()=>[e(ln,{label:"CD4 Count Location",modelValue:r.cd4Location,"onUpdate:modelValue":h[11]||(h[11]=w=>r.cd4Location=w),required:r.cd4Available==="Yes","error-message":g.value.cd4Location,show_error:!1,selected_district_ids:[],selected_location:r.cd4Location,onOnChange:h[12]||(h[12]=w=>{W("cd4Location",w)})},null,8,["modelValue","required","error-message","selected_location"])]),_:1})]),_:1})]),_:1})])):b("",!0)]),l("div",Ps,[e(a(ft),null,{default:t(()=>[e(a(ge),null,{default:t(()=>[e(a(J),null,{default:t(()=>[e(a(rt),{readonly:"",placeholder:"N/A",label:"REASON FOR ART:",modelValue:r.reasonForArt,"onUpdate:modelValue":h[13]||(h[13]=w=>r.reasonForArt=w)},null,8,["modelValue"])]),_:1}),e(a(J),null,{default:t(()=>[e(a(rt),{readonly:"",placeholder:"N/A",label:"WHO STAGE:",modelValue:r.whoStage,"onUpdate:modelValue":h[14]||(h[14]=w=>r.whoStage=w)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),Es=Oe(As,[["__scopeId","data-v-b5f8fd52"]]),Hs={style:{display:"flex","align-items":"center"}},Ts={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},Ns=ce({__name:"AHDWorkflow",setup(n,{expose:d}){const{onTabBeforeChange:v,currentTabIndex:c}=Fn();zn();const g=Fa(),f=Ba();s([]),s([]),s(!1);const k=s(!0),r=s(!1),_=s(!1),S=fe(()=>({text:_.value?"Saving...":"Finish",icon:_.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:r.value||_.value})),m=Qt(),O=Je(),G=wt(),p=un();Ye();const C=dn(),U=cn();da();const T=mn(),F=bt(),q=pn(),{patient:M}=pe(O),{vitals:K}=pe(m),{investigations:P}=pe(G),{diagnosis:B}=pe(p),{substance:W}=pe(T),{selectedNCDMedicationList:y}=pe(C),{FootScreening:o,visualScreening:$,cvScreening:i}=pe(F),{sessionDate:h}=pe(q),{apiStatus:w}=pe(vn());te(S,(N,Y)=>{console.log("Done button options changed:",{from:Y,to:N,currentStep:c.value,tabsLength:z.value.length}),N.disabled!==(Y==null?void 0:Y.disabled)&&console.log("Done button ".concat(N.disabled?"disabled":"enabled")),N.text!==(Y==null?void 0:Y.text)&&console.log('Done button text changed from "'.concat(Y==null?void 0:Y.text,'" to "').concat(N.text,'"'))},{deep:!0}),te(_,(N,Y)=>{N!==Y&&(console.log("Saving state changed: ".concat(Y," -> ").concat(N)),console.log(N?"Starting save process...":"Save process completed"))});const j=N=>{console.log("Done button change received from wizard:",N),N.newOptions.disabled&&console.log("Done button has been disabled"),N.isLastStep&&console.log("User is on the last step, done button should be visible")},ne=()=>{let N=!1;return A(),_.value&&(N=!0),r.value=N,!N},Ce=()=>[{title:"Presenting Complaints",icon:""},{title:"Past Medical History",icon:""},{title:"WHO",icon:""},{title:"Investigation",icon:""}],z=s(Ce()),we=s(null),$e=s(null),A=()=>{var se;if(!z.value||z.value.length===0)return console.log("Tabs not yet initialized"),null;const N=c.value>=0&&c.value<z.value.length?c.value:0;switch((se=z.value[N])==null?void 0:se.title){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation";default:if(U.NCDActivities.length>0)switch(U.NCDActivities[0]){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation"}return null}},L=()=>{k.value=!1,setTimeout(()=>{c.value=0,k.value=!0},0)},Q=()=>{const N=Qt();N.setVitals(N.getInitialVitals(M.value.ID))},oe=async()=>{var se,me;const N=fn(h.value,"sessionDate","value")||Le.sessionDate(),Y=ot("vitals");for(let ee=0;ee<z.value.length;ee++){const ue=z.value[ee];if(ue.title==="Vital Signs")z.value[ee].icon=Fe(N,Y)?Ke:"";else if(ue.title==="Risk Assessment"){const ie=ot("substanceAbuse");z.value[ee].icon=Fe(N,ie)?Ke:""}else if(ue.title==="Investigations"){const ie=(me=(se=M==null?void 0:M.value)==null?void 0:se.labOrders)==null?void 0:me.saved,Ue=ie==null?void 0:ie.filter(mt=>Le.toStandardHisFormat(N)===Le.toStandardHisFormat(mt.order_date));z.value[ee].icon=(Ue==null?void 0:Ue.length)>0?Ke:""}else if(ue.title==="Diagnosis"){const ie=ot("diagnosis");z.value[ee].icon=Fe(N,ie)?Ke:""}else if(ue.title==="Complications Screening"){const ie=ot("screening");z.value[ee].icon=Fe(N,ie)?Ke:""}else ue.title==="Treatment Plan"&&(y.value.length>0?z.value[ee].icon=gn()?Ke:"":z.value[ee].icon="")}ne()},Fe=(N,Y)=>{const se=new Date(N);return se.setHours(0,0,0,0),Y.some(me=>{const ee=new Date(me.obs_datetime);return ee.setHours(0,0,0,0),ee.getTime()===se.getTime()})},he=async()=>{var ee,ue,ie,Ue;const N=[],Y=await tt($.value),se=await Tn(o.value),me=await tt(i.value);Y.length>0&&N.push({concept_id:await _e.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:_e.getSessionDate(),child:Y}),se.length>0&&N.push({concept_id:await _e.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:_e.getSessionDate(),child:se}),me.length>0&&N.push(...me),N.length>0?((Ue=(ie=(ue=(ee=M.value).screening)!=null?ue:ee.screening={}).unsaved)!=null||(ie.unsaved=[]),M.value.screening.unsaved.push(...N),ze("Complications saved successfully")):ke("No complications data to save")},ye=async()=>{const N=Pt();if(!We.isEmpty(N.selectedMedicalAllergiesList)){const me=hn(),ee=N.selectedMedicalAllergiesList.map(ie=>({concept_id:ie.concept_id,obs_datetime:He.getSessionDate(),value_coded:ie.concept_id,location_id:me.facilityLocation.code,value_text:ie.name})),ue=await Un(ee);M.value=Object.assign(M.value,ue),console.log("Allergies staged successfully:",M.value),N.clearSelectedMedicalAllergiesList()}const Y=await qn();M.value=Object.assign(M.value,Y);const se=await Wn().saveNonPharmaTherapyPatientData();M.value=Object.assign(M.value,se)},Me=async(N,Y)=>{var me,ee,ue;const se=(me=z.value[Y])==null?void 0:me.title;N%1===0&&(c.value=N),se=="Vital Signs"&&((ee=we.value)==null||ee.onSubmit()),se=="Risk Assessment"&&((ue=$e.value)==null||ue.onSubmit()),se=="Complications Screening"&&await he(),se=="Treatment Plan"&&await ye(),await Jt(M.value)},Be=async()=>{_.value=!0;try{await _n(),await Jt(M.value),g.push("/triageList")}catch(N){console.error("Error saving data:",N),ke("Error occurred while saving data. Please try again.")}finally{_.value=!1}};return Te(async()=>{if(U.NCDActivities.length===0){g.push("patientProfile");return}bt().resetScreening(),z.value=Ce(),await oe(),(c.value===void 0||c.value<0)&&(c.value=0,console.log("Setting initial tab index to 0")),r.value=!1,_.value=!1,ne()}),te(c,async()=>{await ne()}),te(K,async()=>{await oe()},{deep:!0}),te(M,async()=>{bt().resetScreening(),await oe()},{deep:!0}),te(h,async()=>{await oe()},{deep:!0}),te(P,async()=>{await oe()},{deep:!0}),te(B,async()=>{await oe()},{deep:!0}),te(W,async()=>{await oe()},{deep:!0}),te(y,async()=>{await oe()},{deep:!0}),te(f,async N=>{L(),Q(),z.value=Ce()},{deep:!0}),te(M,async(N,Y)=>{N.ID!=Y.ID&&(L(),Q())},{deep:!0}),d({saveData:Be,markWizard:oe,refreshWizard:L,validateDoneButtonState:ne}),(N,Y)=>{const se=X("ion-icon"),me=X("ion-title"),ee=X("ion-toolbar"),ue=X("ion-header");return u(),I(de,null,[e(ue,null,{default:t(()=>[e(ee,{class:"modal-title"},{default:t(()=>[e(me,null,{default:t(()=>[l("div",Hs,[e(se,{icon:a(Ve).demographics,class:"sub-menu-icon",style:{"font-size":"1.4rem"}},null,8,["icon"]),Y[2]||(Y[2]=l("b",{style:{"margin-left":"6px"}},"Advance HIV Disease",-1))])]),_:1}),e(se,{slot:"end",onClick:Y[0]||(Y[0]=ie=>a(Ua).dismiss()),style:{"font-size":"30px","padding-right":"10px"},icon:a(It)},null,8,["icon"])]),_:1})]),_:1}),e(a(ea),{class:"ion-padding"},{default:t(()=>[l("div",Ts,[k.value?(u(),H(Bn,{key:0,ref:"wizard",headingTitle:"AHD Screening","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:S.value,"custom-tabs":z.value,beforeChange:a(v),onChange:Me,"onComplete:wizard":Y[1]||(Y[1]=ie=>Be()),onDoneButtonChanged:j},{default:t(()=>[nt(l("div",null,[e(ys,{ref:"observationsRef"},null,512)],512),[[st,A()=="Presenting Complaints"]]),nt(l("div",null,[e(ns,{ref:"interventionsRef"},null,512)],512),[[st,A()=="Past Medical History"]]),nt(l("div",null,[e(Es,{ref:"medicationsRef"},null,512)],512),[[st,A()=="WHO"]]),nt(l("div",null,[e(vs,{ref:"medicationsRef"},null,512)],512),[[st,A()=="Investigation"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):b("",!0)])]),_:1})],64)}}}),Vs={key:0},xs={style:{"align-content":"center"}},$s={class:"ion-padding",slot:"content"},Ms=ce({__name:"PresentingComplaints",setup(n,{expose:d}){const v=la(),{presentingComplaints:c}=pe(v),g=s(Ve),f=s(!0),k=s(!1),r=s(!1),_=s(!0),S=s(!1),m=s([]),O=s([]),G=s(),p=fe(()=>[{componentType:"multiSelectInputField",header:"Presenting Complaints",name:"PresentingComplaints",trackBy:"concept_id",icon:Ve.search,hideSelected:!0,validation:y=>P(y==null?void 0:y.name,m.value)?"Presenting complaint already added":Ge.required(y),options:O.value,grid:{s:"6"}},{componentType:"inputField",header:"Duration",name:"duration",icon:Ve.time,validation:y=>Ge.isNotEmptyandNumber(y),grid:{s:"6"},unitOptions:[{label:"Hours",value:"Hours"},{label:"Days",value:"Days"},{label:"Weeks",value:"Weeks"},{label:"Months",value:"Months"},{label:"Years",value:"Years"}],unitValidation:y=>!y||y===""?"Please select a unit.":null},{componentType:"inputField",header:"Specify the presenting complaint(s)",name:"Other (specify)",icon:Ve.editPen,validation:y=>P(y,m.value)?"Presenting complaint already added":Ge.required(y),condition:y=>{var o;return((o=y==null?void 0:y.PresentingComplaints)==null?void 0:o.name)==="Other"}},{componentType:"Alert",condition:y=>{var o;return Ge.required((o=y==null?void 0:y.PresentingComplaints)==null?void 0:o.name)!=null},backgroundColor:"lightyellow",textColor:"black",value:"Please search thoroughly for the complaint. If it is not listed, search and select the 'Other' option to specify the complaint.",name:"noMatchAlert"}]),{formRef:C}=ra(),U=async()=>{ca(Ns,{class:"fullScreenModal"})},T=async()=>{O.value=await pa.getComplaintsList("Presenting complaint"),ae(c.value,"PresentingComplaints","multiSelectData",O.value)},F=()=>{f.value=!1,_.value=!1,r.value=!0},q=async()=>{var $,i;const y=($=C.value)==null?void 0:$.getFormValues();((i=C.value)==null?void 0:i.validateForm())==null&&(M(y),r.value=!1,_.value=!0)},M=y=>{var h;const o=y.duration+" "+y.duration_unit,$=y.PresentingComplaints,i=$.name==="Other"?y["Other (specify)"]:$.name;m.value.push({actionBtn:!0,btn:["delete"],name:i,concept_id:$.concept_id,duration:$.duration,durationUnits:$.duration_unit,display:[i,o],data:[{concept_id:8578,value_coded:$.concept_id,obs_datetime:He.getSessionDate(),child:[{concept_id:$.concept_id,value_text:o,obs_datetime:He.getSessionDate()}]}]}),(h=C.value)==null||h.resetForm(),S.value=!0,K()},K=()=>{const y=["Cough","Convulsions"];k.value=m.value.some(o=>y.includes(o.name))},P=(y,o)=>o.some($=>$.name===y),B=y=>{m.value=m.value.filter(o=>o.display[0]!==y.name)},W=async()=>{const y=await De.getObsByEncounterIdAndDate(re.PRESENTING_COMPLAINTS),o=m.value.flatMap($=>$.data);if(o.length<=0&&y.length<=0)return ke("Presenting complaints is required");o.length<=0||(await De.addObsToEncounterPatient(o,re.PRESENTING_COMPLAINTS),ze("Presenting complaints saved successful"),m.value=[])};return Te(async()=>{await T()}),d({onSubmit:W}),(y,o)=>{const $=X("ion-row"),i=X("ion-label"),h=X("ion-accordion"),w=X("ion-accordion-group");return u(),I(de,null,[e(At,{status:f.value,content:"No presenting complaints added"},null,8,["status"]),S.value?(u(),I("span",Vs,[e(kt,{listData:m.value,"onClicked:delete":B},null,8,["listData"])])):b("",!0),r.value?(u(),H($,{key:1},{default:t(()=>[e(ua,{formData:p.value,ref_key:"formRef",ref:C},null,8,["formData"]),l("div",xs,[e(xe,{fill:"clear",icon:g.value.plus,iconSlot:"icon-only","onClicked:btn":o[0]||(o[0]=j=>q()),name:"Save"},null,8,["icon"])])]),_:1})):b("",!0),_.value?(u(),H($,{key:2,style:{"margin-top":"10px"}},{default:t(()=>[e(xe,{fill:"clear",icon:g.value.plus,iconSlot:"icon-only","onClicked:btn":o[1]||(o[1]=j=>F()),name:"Add new presenting complaints"},null,8,["icon"])]),_:1})):b("",!0),k.value?(u(),H($,{key:3,class:"ion-float-right"},{default:t(()=>[e(xe,{color:"danger","onClicked:btn":o[2]||(o[2]=j=>U()),name:"AHD Screening"})]),_:1})):b("",!0),e($,null,{default:t(()=>[e(w,{ref_key:"accordionGroup",ref:G,class:"previousView"},{default:t(()=>[e(h,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:t(()=>[e(a(ve),{slot:"header",color:"light"},{default:t(()=>[e(i,{class:"previousLabel"},{default:t(()=>[...o[3]||(o[3]=[R("Previous presenting complaints",-1)])]),_:1})]),_:1}),l("div",$s,[e(ma)])]),_:1})]),_:1},512)]),_:1})],64)}}}),Ls=Oe(Ms,[["__scopeId","data-v-0aa2f61c"]]),Rs={class:"allergies-container"},Fs={key:0,class:"no-allergies"},Bs={key:1,class:"date-groups"},Us=["onClick"],qs={class:"date-info"},Ws={class:"date-text"},Gs={class:"allergy-count"},zs={class:"card-header"},Ys={class:"allergy-type"},js={class:"card-content"},Ks=ce({__name:"AllergiesListing",setup(n){const d=Je(),{patient:v}=pe(d),c=s({}),g={antiviral:/abacavir|lamivudine|lopinavir|ritonavir|zidovudine|efavirenz|tenofovir/i,antibiotic:/penicillin|amoxicillin|cephalexin|azithromycin|ciprofloxacin|doxycycline/i,analgesic:/aspirin|ibuprofen|acetaminophen|morphine|codeine|tramadol/i,cardiac:/metoprolol|lisinopril|amlodipine|atorvastatin|warfarin/i,activated:/activated\s+charcoal/i},f={985:{name:"Other",icon:Qe,severity:"danger"},7759:{name:"Location/Environmental",icon:aa,severity:"info"},7579:{name:"Medical Condition",icon:za,severity:"warning"},drug:{name:"Drug Allergy",icon:Qe,severity:"danger"},food:{name:"Food Allergy",icon:Ga,severity:"danger"},environmental:{name:"Environmental",icon:Wa,severity:"warning"},contact:{name:"Contact Allergy",icon:qa,severity:"warning"},unknown:{name:"Drug Allergy",icon:Qe,severity:"danger"}},k=p=>{const C=p.toLowerCase();return g.antiviral.test(C)?{type:"Antiviral Medication",icon:"shield-outline"}:g.antibiotic.test(C)?{type:"Antibiotic",icon:"bandage-outline"}:g.analgesic.test(C)?{type:"Pain Medication",icon:"fitness-outline"}:g.cardiac.test(C)?{type:"Cardiac Medication",icon:"heart-outline"}:g.activated.test(C)?{type:"Detoxification Agent",icon:"flask-outline"}:{type:"Medication",icon:"medical-outline"}},r=fe(()=>{var p,C,U;return((U=(C=(p=v.value)==null?void 0:p.allergies)==null?void 0:C.saved)==null?void 0:U.length)>0}),_=fe(()=>r.value?v.value.allergies.saved.map(p=>{var M;const C=((M=p.concept_id)==null?void 0:M.toString())||"unknown";console.log("###########: ",p);const U=f[C]||f.unknown;let T="Unknown",F=null;return p.value_text&&p.value_text!=="Unknown"&&p.value_text!==""?(T=p.value_text,C==="985###"&&(F=k(p.value_text))):p.concept_name&&(T=p.concept_name),{...F?{...U,name:F.type,icon:F.icon}:U,displayValue:T,conceptId:p.concept_id,date:p.obs_datetime||p.encounter_datetime,providerId:p.provider_id,locationId:p.location_id,encounterId:p.encounter_id,isDrug:C==="985",raw:p}}):[]),S=fe(()=>{const p={};_.value.forEach(T=>{const F=T.date?O(T.date):"Unknown Date";p[F]||(p[F]=[]),p[F].push(T)});const C={};return Object.keys(p).sort((T,F)=>T==="Unknown Date"?1:F==="Unknown Date"?-1:new Date(F).getTime()-new Date(T).getTime()).forEach(T=>{C[T]=p[T]}),C}),m=p=>{c.value[p]=!c.value[p]},O=p=>{if(!p)return"Unknown Date";try{return new Date(p).toISOString().split("T")[0]}catch(C){return"Unknown Date"}},G=p=>{if(p==="Unknown Date")return"Unknown Date";try{const C=new Date(p),U=Le.sessionDate(),T=new Date(U),F=new Date(T);F.setDate(F.getDate()-1);const q=C.toDateString(),M=T.toDateString(),K=F.toDateString();return q===M?"Today":q===K?"Yesterday":C.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch(C){return p}};return te(()=>S.value,p=>{const C=Object.keys(p);C.length>0&&(c.value[C[0]]=!0)},{immediate:!0}),te(()=>{var p;return(p=v.value)==null?void 0:p.allergies},p=>{console.log("Allergies updated:",p)},{deep:!0}),Te(()=>{var p;console.log("Allergies component mounted",(p=v.value)==null?void 0:p.allergies)}),(p,C)=>{const U=X("ion-icon"),T=X("ion-label");return u(),I("div",Rs,[e(T,{class:"section-title"},{default:t(()=>[e(U,{icon:a(na),class:"alert-icon"},null,8,["icon"]),e(T,null,{default:t(()=>[...C[0]||(C[0]=[R("Allergies (Medication, Healthcare items, Environment and Food)",-1)])]),_:1})]),_:1}),r.value?(u(),I("div",Bs,[(u(!0),I(de,null,Ee(S.value,(F,q)=>(u(),I("div",{key:q,class:"date-group"},[l("div",{class:Ze(["date-header",{expanded:c.value[q]}]),onClick:M=>m(q)},[l("div",qs,[e(U,{icon:a(ja),class:"date-icon"},null,8,["icon"]),l("span",Ws,V(G(q)),1),l("span",Gs,"("+V(F.length)+" "+V(F.length===1?"allergy":"allergies")+")",1)]),e(U,{icon:a(Ka),class:Ze(["expand-icon",{rotated:c.value[q]}])},null,8,["icon","class"])],10,Us),l("div",{class:Ze(["allergies-grid",{collapsed:!c.value[q]}])},[(u(!0),I(de,null,Ee(F,(M,K)=>(u(),I("div",{key:K,class:Ze(["allergy-card",M.severity])},[l("div",zs,[e(U,{icon:M.icon,class:"allergy-icon"},null,8,["icon"]),l("span",Ys,V(M.name),1)]),l("div",js,[l("div",{class:Ze(["allergy-value",{"drug-name":M.isDrug}])},V(M.displayValue),3)])],2))),128))],2)]))),128))])):(u(),I("div",Fs,[e(U,{icon:a(Ya),class:"no-allergies-icon"},null,8,["icon"]),C[1]||(C[1]=l("p",null,"No known allergies",-1))]))])}}}),va=Oe(Ks,[["__scopeId","data-v-4451d7ce"]]),Qs=ce({name:"VisitHistory",components:{AllergiesListing:va,IonIcon:it},setup(){const n=Pt();return{selectedAllergiesList2:fe(()=>n.selectedMedicalAllergiesList),alertCircleOutline:na,documentTextOutline:Xa,femaleOutline:Ja,medicalOutline:Qe,warningOutline:Qa,bodyOutline:Mt,eyeOutline:Gt,nutritionOutline:Wt,fitnessOutline:Ft,pulseOutline:St,earOutline:qt,happyOutline:Ut,manOutline:Bt,moveOutline:Rt,addOutline:lt,scanOutline:Lt}},data(){return{presentingComplaintsWithDuration:[],pastMedicalHistory:[],levelOfConsciousness:{eyeResponse:null,verbalResponse:null,motorResponse:null},pregnancy:{patientPregnant:null,breastFeeding:null},physicalExamCategories:{Eyes:{icon:Gt,abnormalities:[],normal:!1},Mouth:{icon:Wt,abnormalities:[],normal:!1},Ears:{icon:qt,abnormalities:[],normal:!1},Face:{icon:Ut,abnormalities:[],normal:!1},Neck:{icon:Bt,abnormalities:[],normal:!1},Chest:{icon:Ft,abnormalities:[],normal:!1},"Chest Movement":{icon:Rt,abnormalities:[],normal:!1},"Heart Sounds":{icon:St,abnormalities:[],normal:!1},"Breath Sounds":{icon:lt,abnormalities:[],normal:!1},"Added Breath Sounds":{icon:lt,abnormalities:[],normal:!1},"Abdominal Inspection":{icon:Lt,abnormalities:[],normal:!1},"Genital Examination":{icon:Mt,abnormalities:[],normal:!1}}}},computed:{...Ct(Je,["patient"]),hasLevelOfConsciousness(){return this.levelOfConsciousness.eyeResponse||this.levelOfConsciousness.verbalResponse||this.levelOfConsciousness.motorResponse},hasPresentingComplaints(){var n;return((n=this.presentingComplaintsWithDuration)==null?void 0:n.length)>0},hasPregnancyData(){return this.pregnancy.patientPregnant||this.pregnancy.breastFeeding},hasPastMedicalHistory(){var n;return((n=this.uniquePastMedicalHistory)==null?void 0:n.length)>0},hasAllergies(){var n,d;return((d=(n=this.selectedAllergiesList2)==null?void 0:n.filter(v=>v.selected))==null?void 0:d.length)>0},hasPhysicalExam(){return Object.values(this.physicalExamCategories).some(n=>n.abnormalities.length>0||n.normal)},uniquePastMedicalHistory(){return[...new Set(this.pastMedicalHistory)]},uniquePresentingComplaints(){return[...new Set(this.presentingComplaintsWithDuration.map(n=>n.name))]},isMinor(){var n,d;return Le.getAgeInYears((d=(n=this.patient)==null?void 0:n.personInformation)==null?void 0:d.birthdate)<18},gcsScore(){var r,_,S;if(!this.hasLevelOfConsciousness)return null;const n=this.levelOfConsciousness.eyeResponse,d=this.levelOfConsciousness.motorResponse,v=this.levelOfConsciousness.verbalResponse,c=n&&(r=(this.isMinor?In:kn)[n])!=null?r:0,g=d&&(_=(this.isMinor?On:Pn)[d])!=null?_:0,f=v&&(S=(this.isMinor?An:En)[v])!=null?S:0,k=c+g+f;return"(M ".concat(g," V ").concat(f," E ").concat(c,") ").concat(k,"/").concat(this.isMinor?5:15)}},methods:{async updateData(){var n;(n=this.patient)!=null&&n.patientID&&(await this.loadPresentingComplaints(),await this.loadPastMedicalHistory(),await this.loadLevelOfConsciousness(),await this.loadPregnancyStatus(),await this.loadPhysicalExam())},async loadPresentingComplaints(){try{const n=await De.getObsByEncounterIdAndDate(re.PRESENTING_COMPLAINTS);this.presentingComplaintsWithDuration=[];const d=n.filter(v=>v.concept_name==="Presenting complaint");for(const v of d){const c=n.find(f=>f.concept_id===v.value_coded&&f.concept_name!=="Presenting complaint"),g=await _e.getConceptName(v.value_coded);this.presentingComplaintsWithDuration.push({name:g,duration:(c==null?void 0:c.value_text)||"Duration not specified"})}}catch(n){console.error("Error loading presenting complaints:",n)}},async loadPastMedicalHistory(){try{const d=(await De.getObsByEncounterIdAndDate(re.PAST_MEDICAL_HISTORY)).filter(v=>v.concept_name==="Chronic disease");this.pastMedicalHistory=await Promise.all(d.map(async v=>await _e.getConceptName(v.value_coded)))}catch(n){console.error("Error loading past medical history:",n)}},async loadLevelOfConsciousness(){try{const n=await De.getObsByEncounterIdAndDate(re.ASSESSMENT);if(n&&Array.isArray(n)){const d=n.find(g=>g.concept_name==="Eye opening response");this.levelOfConsciousness.eyeResponse=d!=null&&d.value_coded?await _e.getConceptName(d.value_coded):null;const v=n.find(g=>g.concept_name==="Best verbal response");this.levelOfConsciousness.verbalResponse=v!=null&&v.value_coded?await _e.getConceptName(v.value_coded):null;const c=n.find(g=>g.concept_name==="Best motor response");this.levelOfConsciousness.motorResponse=c!=null&&c.value_coded?await _e.getConceptName(c.value_coded):null}}catch(n){console.error("Error loading level of consciousness:",n)}},async loadPregnancyStatus(){try{const n=await De.getObsByEncounterIdAndDate(re.PREGNANCY_STATUS);if(n&&Array.isArray(n)){const d=n.find(c=>c.concept_name==="Patient pregnant");this.pregnancy.patientPregnant=d!=null&&d.value_coded?await _e.getConceptName(d.value_coded):null;const v=n.find(c=>c.concept_name==="Is patient breast feeding?");this.pregnancy.breastFeeding=v!=null&&v.value_coded?await _e.getConceptName(v.value_coded):null}}catch(n){console.error("Error loading pregnancy status:",n)}},async loadPhysicalExam(){try{const n=await De.getObsByEncounterIdAndDate(re.PHYSICAL_EXAMINATION);Object.values(this.physicalExamCategories).forEach(d=>{d.abnormalities=[],d.normal=!1});for(const d of n)if(d.concept_id){if(d.value_coded===1065)switch(d.concept_id){case 10837:this.physicalExamCategories.Eyes.normal=!0;break;case 10842:this.physicalExamCategories.Mouth.normal=!0;break;case 11028:this.physicalExamCategories.Ears.normal=!0;break;case 10854:this.physicalExamCategories.Face.normal=!0;break;case 10858:this.physicalExamCategories.Neck.normal=!0;break;case 10894:this.physicalExamCategories.Chest.normal=!0;break;case 10903:this.physicalExamCategories["Heart Sounds"].normal=!0;break;case 10909:this.physicalExamCategories["Breath Sounds"].normal=!0;break;case 10919:case 10928:case 10939:this.physicalExamCategories["Abdominal Inspection"].normal=!0;break;case 10803:case 10946:this.physicalExamCategories["Genital Examination"].normal=!0;break}if(d.value_coded){const v=await _e.getConceptName(d.value_coded);switch(d.concept_id){case 10838:this.physicalExamCategories.Eyes.abnormalities.push(v);break;case 10843:this.physicalExamCategories.Mouth.abnormalities.push(v);break;case 10852:this.physicalExamCategories.Ears.abnormalities.push(v);break;case 10855:this.physicalExamCategories.Face.abnormalities.push(v);break;case 10859:this.physicalExamCategories.Neck.abnormalities.push(v);break;case 10897:this.physicalExamCategories.Chest.abnormalities.push(v);break;case 10904:this.physicalExamCategories["Heart Sounds"].abnormalities.push(v);break;case 10910:this.physicalExamCategories["Breath Sounds"].abnormalities.push(v);break;case 10920:case 10929:case 10939:this.physicalExamCategories["Abdominal Inspection"].abnormalities.push(v);break;case 10797:case 10804:case 10947:this.physicalExamCategories["Genital Examination"].abnormalities.push(v);break}}}}catch(n){console.error("Error loading physical exam:",n)}}},watch:{patient:{async handler(){await this.updateData()},deep:!0}},async mounted(){await this.updateData()}}),Js={class:"visit-container"},Xs={class:"visit-sections"},Zs={key:0,class:"visit-section"},eo={class:"section-header"},to={class:"section-content"},ao={key:0,class:"info-item"},no={class:"info-value"},so={key:1,class:"info-item"},oo={class:"info-value"},io={key:2,class:"info-item"},lo={class:"info-value"},ro={key:3,class:"info-item"},uo={class:"info-value highlight"},co={key:1,class:"visit-section"},mo={class:"section-header"},po={class:"complaints-container"},vo={class:"complaint-name"},fo={class:"complaint-duration"},go={key:2,class:"visit-section"},_o={class:"section-header"},ho={class:"section-content"},yo={key:0,class:"info-item"},bo={class:"info-value highlight"},Do={key:1,class:"info-item"},Co={class:"info-value highlight"},So={key:3,class:"visit-section"},wo={class:"section-header"},Io={class:"tags-container"},ko={class:"allergies-section"},Oo={class:"allergies-container"},Po={key:4,class:"visit-section"},Ao={class:"section-header"},Eo={class:"exam-section"},Ho={key:0,class:"exam-category"},To={class:"exam-category-header"},No={class:"exam-items"},Vo={key:1,class:"exam-item normal"};function xo(n,d,v,c,g,f){const k=X("ion-icon"),r=X("AllergiesListing");return u(),I("div",Js,[d[11]||(d[11]=l("div",{class:"visit-header"},[l("h5",null,"Patient's Clinical Assessment Summary")],-1)),l("div",Xs,[n.hasLevelOfConsciousness?(u(),I("div",Zs,[l("div",eo,[e(k,{icon:n.alertCircleOutline,class:"section-icon"},null,8,["icon"]),d[0]||(d[0]=l("h3",null,"Level of Consciousness",-1))]),l("div",to,[n.levelOfConsciousness.eyeResponse?(u(),I("div",ao,[d[1]||(d[1]=l("span",{class:"info-label"},"Eye Response:",-1)),l("span",no,V(n.levelOfConsciousness.eyeResponse),1)])):b("",!0),n.levelOfConsciousness.verbalResponse?(u(),I("div",so,[d[2]||(d[2]=l("span",{class:"info-label"},"Verbal Response:",-1)),l("span",oo,V(n.levelOfConsciousness.verbalResponse),1)])):b("",!0),n.levelOfConsciousness.motorResponse?(u(),I("div",io,[d[3]||(d[3]=l("span",{class:"info-label"},"Motor Response:",-1)),l("span",lo,V(n.levelOfConsciousness.motorResponse),1)])):b("",!0),n.gcsScore?(u(),I("div",ro,[d[4]||(d[4]=l("span",{class:"info-label"},"Score:",-1)),l("span",uo,V(n.gcsScore),1)])):b("",!0)])])):b("",!0),n.hasPresentingComplaints?(u(),I("div",co,[l("div",mo,[e(k,{icon:n.documentTextOutline,class:"section-icon"},null,8,["icon"]),d[5]||(d[5]=l("h3",null,"Presenting Complaints",-1))]),l("div",po,[(u(!0),I(de,null,Ee(n.presentingComplaintsWithDuration,(_,S)=>(u(),I("div",{class:"complaint-item",key:S},[l("div",vo,V(_.name),1),l("div",fo,V(_.duration),1)]))),128))])])):b("",!0),n.hasPregnancyData?(u(),I("div",go,[l("div",_o,[e(k,{icon:n.femaleOutline,class:"section-icon"},null,8,["icon"]),d[6]||(d[6]=l("h3",null,"Pregnancy Status",-1))]),l("div",ho,[n.pregnancy.patientPregnant?(u(),I("div",yo,[d[7]||(d[7]=l("span",{class:"info-label"},"Pregnant:",-1)),l("span",bo,V(n.pregnancy.patientPregnant),1)])):b("",!0),n.pregnancy.breastFeeding?(u(),I("div",Do,[d[8]||(d[8]=l("span",{class:"info-label"},"Breastfeeding:",-1)),l("span",Co,V(n.pregnancy.breastFeeding),1)])):b("",!0)])])):b("",!0),n.hasPastMedicalHistory?(u(),I("div",So,[l("div",wo,[e(k,{icon:n.medicalOutline,class:"section-icon"},null,8,["icon"]),d[9]||(d[9]=l("h3",null,"Medical History",-1))]),l("div",Io,[(u(!0),I(de,null,Ee(n.uniquePastMedicalHistory,(_,S)=>(u(),I("div",{class:"medical-tag",key:S},V(_),1))),128))])])):b("",!0),l("div",ko,[l("div",Oo,[e(r)])]),n.hasPhysicalExam?(u(),I("div",Po,[l("div",Ao,[e(k,{icon:n.bodyOutline,class:"section-icon"},null,8,["icon"]),d[10]||(d[10]=l("h3",null,"Physical Examination",-1))]),l("div",Eo,[(u(!0),I(de,null,Ee(n.physicalExamCategories,(_,S)=>(u(),I(de,{key:S},[_.abnormalities.length>0||_.normal?(u(),I("div",Ho,[l("div",To,[e(k,{icon:_.icon},null,8,["icon"]),l("h4",null,V(S),1)]),l("div",No,[_.abnormalities.length>0?(u(!0),I(de,{key:0},Ee(_.abnormalities,(m,O)=>(u(),I("div",{class:"exam-item abnormal",key:O},V(m),1))),128)):_.normal?(u(),I("div",Vo," Normal examination ")):b("",!0)])])):b("",!0)],64))),128))])])):b("",!0)])])}const $o=Oe(Qs,[["render",xo],["__scopeId","data-v-795e1865"]]),Mo={class:"modal_wrapper"},Lo=ce({__name:"PregnancyBreastfeeding",setup(n,{expose:d}){const v=yn(),{pregnancy:c}=pe(v),g=()=>{};return d({onSubmit:async()=>{const k=await ct(c.value);k.length>0?(await De.addObsToEncounterPatient(k,re.PREGNANCY_STATUS),ze("Pregnancy status saved successfully")):ke("No pregnancy status data to save ")}}),(k,r)=>(u(),I("div",Mo,[e(at,{contentData:a(c),"onUpdate:inputValue":g},null,8,["contentData"])]))}}),Ro={class:"modal_wrapper"},Fo={class:"uniform_columns"},Bo=ce({__name:"PastMedicalHistory",setup(n,{expose:d}){const v=oa(),{pastMedicalHistory:c}=pe(v),g=s([]);Te(()=>{g.value=v.getInitial(),f()}),te(c,()=>{f()},{deep:!0});const f=()=>{var m;const S=["TB","Chronic Obstructive Pulmonary Disease (COPD)","Asthma","Epilepsy","Previous stroke","Peptic Ulcer Disease (PUD)","Mental disorder","Bleeding disorders","Hypertension","HIV Positive","Diabetes Mellitus"];(m=ia(c.value,"None"))!=null&&m.checked?S.forEach(O=>{Ie(c.value,"TB treatment","displayNone",!0),ae(c.value,"TB drugs","displayNone",!0),ae(c.value,"TB drug start date","displayNone",!0),Ie(c.value,"Hypertension medication","displayNone",!0),ae(c.value,"Current hypertension treatment regimen","displayNone",!0),Ie(c.value,"HIV status","displayNone",!0),ae(c.value,"ARV start date","displayNone",!0),Ie(c.value,"Diabetes","displayNone",!0),Ie(c.value,"Controlled by","displayNone",!0),Ne(c.value,O,"checked",!1),Ne(c.value,O,"disabled",!0)}):S.forEach(O=>{Ne(c.value,O,"disabled",!1)})},k=S=>{ae(c.value,"TB drugs","popOverData",{filterData:!0,data:[{name:"Auramine 'O' (C.I. 41000) 50g"},{name:"Bedaquilline 100mg"},{name:"Clofazimine 100mg"},{name:"Clofazimine 50mg"},{name:"Cycloserine 125mg"},{name:"Cycloserine 250mg"},{name:"Delamanid 50mg"},{name:"Ethambutol 100mg"},{name:"Ethambutol 400mg"},{name:"Ethionamide 250mg"},{name:"Isoniazid 100mg "},{name:"Isoniazid 300mg"},{name:"Isoniazid / Rifapentine 300mg / 300mg"},{name:"Levofloxacin 100mg"},{name:"Levofloxacin 250mg"},{name:"Linezolid 600mg"},{name:"Moxifloxacin 400mg"},{name:"Pyrazinamide 400mg"},{name:"Rifabutin 150mg Capsules"},{name:"Rifampicin 150mg/isoniazid 75mg"},{name:"Rifampicin 75mg+INH 50mg dispersible"},{name:"Rifampicin 75mg+INH 50mg+Pyrazinamide 150mg dispersible"},{name:"Rifampicin150mg/Isoniazid75mg/Pyrazinamide 400mg/Ethambutol"}]}),ae(c.value,"Current hypertension treatment regimen","popOverData",{filterData:!0,data:[{name:"Captopril 12.5mg"},{name:"Aspirin 75mg"},{name:"Hydrochlorothiazide 25mg"},{name:"Enalapril Meleate 5mg"},{name:"Enalapril Maleate 10mg"}]})},r=async()=>[...await Et(c.value),...await ct(c.value),...await tt(c.value)];return d({onSubmit:async()=>{const S=await r();if(S.length===0){ke("No past medical history data to save");return}await De.addObsToEncounterPatient(S,re.PAST_MEDICAL_HISTORY),ze("Past medical history saved successful")}}),(S,m)=>(u(),I("div",Ro,[l("div",Fo,[e(at,{contentData:a(c),initialData:g.value,"onUpdate:inputValue":k,"onUpdate:selected":k},null,8,["contentData","initialData"])])]))}}),Uo=Oe(Bo,[["__scopeId","data-v-49fdce72"]]),qo={class:"container"},Wo=ce({__name:"PhysicalExamination",setup(n,{expose:d}){const v=bn(),c=Je(),{physicalExam:g}=pe(v),{patient:f}=pe(c),k=s([]);Te(()=>{k.value=v.getInitial(),r(),_()}),te(g,()=>{r(),_()},{deep:!0});const r=()=>{Dn(g.value,"Physical examination")=="No"?Ie(g.value,"Reason why physical examination not done","displayNone",!1):(Ie(g.value,"Reason why physical examination not done","displayNone",!0),Ie(g.value,"Reason why physical examination not done","selectedValue",""))},_=()=>{var G,p;const O=(p=(G=f.value)==null?void 0:G.personInformation)==null?void 0:p.gender;O=="M"&&(Ne(g.value,"Vulva examination","disabled",!0),Ne(g.value,"Visible bleeding","disabled",!0)),O=="F"&&(Ne(g.value,"Urethral meatus abnormal","disabled",!0),Ne(g.value,"Scrotal swelling","disabled",!0),Ne(g.value,"Tastes swelling","disabled",!0))},S=async()=>[...await Et(g.value),...await ct(g.value),...await tt(g.value)];return d({onSubmit:async()=>{const O=await S();if(console.log("Selected physical data is",O),O.length===0){ke("No physical examination data to save");return}await De.addObsToEncounterPatient(O,re.PHYSICAL_EXAMINATION),console.log(De.getObsByEncounterIdAndDate(re.PHYSICAL_EXAMINATION)),ze("Physical examination saved successful")}}),(O,G)=>{const p=X("ion-card-content"),C=X("ion-card");return u(),I("div",qo,[e(C,{class:"section"},{default:t(()=>[e(p,null,{default:t(()=>[e(at,{contentData:a(g),initialData:k.value},null,8,["contentData","initialData"])]),_:1})]),_:1})])}}}),Go=Oe(Wo,[["__scopeId","data-v-0d34c6dd"]]),zo={key:0},Yo={class:"ion-padding",slot:"content"},jo={class:"nav-buttons"},Ko={class:"ion-padding",slot:"content"},Qo={class:"nav-buttons"},Jo={class:"ion-padding",slot:"content"},Xo={class:"nav-buttons"},Zo={class:"ion-padding",slot:"content"},ei={class:"nav-buttons"},ti={class:"ion-padding",slot:"content"},ai={class:"nav-buttons"},ni={class:"ion-padding",slot:"content"},si={class:"nav-buttons"},oi=ce({__name:"ClinicalAssessment",setup(n,{expose:d}){const v=s("loc"),c=s(0),g=s(!1),f=s(!1),k=new Ot,r=Je(),_=()=>{c.value++},S=s(null),m=s(null),O=s(null),G=s(null),p=s(null),C=s(null),U=[{id:"loc",label:"Level of consciousness",show:!0},{id:"pc",label:"Presenting complaints",show:!0},{id:"pbs",label:"Pregnancy and breastfeeding status",show:()=>k.isChildBearing()},{id:"pmh",label:"Past medical history",show:!0},{id:"al",label:"Allergies",show:!0},{id:"pe",label:"Physical examination",show:!0}];async function T(){const y=He.getSessionDate(),o=[re.ASSESSMENT,re.PRESENTING_COMPLAINTS,re.PAST_MEDICAL_HISTORY,re.PHYSICAL_EXAMINATION,re.PREGNANCY_STATUS];let $=!1;for(const i of o)try{const h=await De.getObsByEncounterIdAndDate(i);if(h&&h.some(w=>w.obs_datetime?Le.toStandardHisFormat(w.obs_datetime)===Le.toStandardHisFormat(y):!1)){$=!0;break}}catch(h){console.error("Error checking observations for encounter type ".concat(i,":"),h)}g.value=$}Te(T),te(()=>r.patient,T);const F=fe(()=>g.value),q=fe(()=>U.filter(y=>typeof y.show=="function"?y.show():y.show)),M=y=>{const o=U.find($=>$.id===y);return o?typeof o.show=="function"?o.show():o.show:!1},K=y=>q.value.findIndex(o=>o.id===y),P=y=>{const o=K(y);o>0&&(v.value=q.value[o-1].id)},B=y=>{const $=K(y)+1;$<q.value.length?v.value=q.value[$].id:(v.value="",_())};return d({onSubmit:async()=>{const y=[{ref:S,name:"PresentingComplaints"},{ref:m,name:"LevelOfConsciousness"},{ref:O,name:"PastMedicalHistory"},{ref:p,name:"PregnancyBreastfeeding"},{ref:C,name:"PhysicalExamination"}];for(const o of y)if(o.ref.value&&typeof o.ref.value.onSubmit=="function")try{await o.ref.value.onSubmit()}catch($){console.error("Error calling ".concat(o.name," onSubmit:"),$)}else console.log("".concat(o.name," component ref not available or no onSubmit method"))}}),(y,o)=>{const $=X("ion-toggle");return u(),I(de,null,[F.value?(u(),I("div",zo,[e(a(ve),{lines:"none"},{default:t(()=>[e(a(Se),null,{default:t(()=>[...o[14]||(o[14]=[R("Switch between Capture Mode and Summary Mode",-1)])]),_:1}),e($,{checked:f.value,onIonChange:o[0]||(o[0]=i=>f.value=i.detail.checked),slot:"end"},null,8,["checked"])]),_:1}),f.value?b("",!0):(u(),H($o,{key:c.value}))])):b("",!0),!F.value||f.value?(u(),H(a(ge),{key:1,style:{width:"100%"}},{default:t(()=>[e(a(ut),{value:v.value,"onUpdate:value":o[13]||(o[13]=i=>v.value=i),ref:"accordionGroup",class:"previousView"},{default:t(()=>[M("loc")?(u(),H(a(Re),{key:0,value:"loc",class:"_card"},{default:t(()=>[e(a(ve),{slot:"header",color:"light"},{default:t(()=>[e(a(Se),{class:"previousLabel"},{default:t(()=>[...o[15]||(o[15]=[R("Level of consciousness",-1)])]),_:1})]),_:1}),l("div",Yo,[e(Hn,{"is-active":v.value==="loc",ref_key:"levelOfConsciousnessFormRef",ref:m,onDataSaved:_},null,8,["is-active"]),l("div",jo,[K("loc")>0?(u(),H(a(Pe),{key:0,fill:"outline",onClick:o[1]||(o[1]=Ae(i=>P("loc"),["stop"]))},{default:t(()=>[...o[16]||(o[16]=[R(" Back ",-1)])]),_:1})):b("",!0),e(a(Pe),{fill:"outline",onClick:o[2]||(o[2]=Ae(i=>B("loc"),["stop"]))},{default:t(()=>[R(V(K("loc")<q.value.length-1?"Next":"Finish"),1)]),_:1})])])]),_:1})):b("",!0),M("pc")?(u(),H(a(Re),{key:1,value:"pc",class:"_card"},{default:t(()=>[e(a(ve),{slot:"header",color:"light"},{default:t(()=>[e(a(Se),{class:"previousLabel"},{default:t(()=>[...o[17]||(o[17]=[R("Presenting complaints",-1)])]),_:1})]),_:1}),l("div",Ko,[e(Ls,{"is-active":v.value==="pc",onDataSaved:_,ref_key:"presentingComplaintsFormRef",ref:S},null,8,["is-active"]),l("div",Qo,[K("pc")>0?(u(),H(a(Pe),{key:0,fill:"outline",onClick:o[3]||(o[3]=Ae(i=>P("pc"),["stop"]))},{default:t(()=>[...o[18]||(o[18]=[R(" Back ",-1)])]),_:1})):b("",!0),e(a(Pe),{fill:"outline",onClick:o[4]||(o[4]=Ae(i=>B("pc"),["stop"]))},{default:t(()=>[R(V(K("pc")<q.value.length-1?"Next":"Finish"),1)]),_:1})])])]),_:1})):b("",!0),M("pbs")?(u(),H(a(Re),{key:2,value:"pbs",class:"_card"},{default:t(()=>[e(a(ve),{slot:"header",color:"light"},{default:t(()=>[e(a(Se),{class:"previousLabel"},{default:t(()=>[...o[19]||(o[19]=[R("Pregnancy and breastfeeding status",-1)])]),_:1})]),_:1}),l("div",Jo,[e(Lo,{"is-active":v.value==="pbs",ref_key:"pregnancyBreastfeedingFormRef",ref:p,onDataSaved:_},null,8,["is-active"]),l("div",Xo,[K("pbs")>0?(u(),H(a(Pe),{key:0,fill:"outline",onClick:o[5]||(o[5]=Ae(i=>P("pbs"),["stop"]))},{default:t(()=>[...o[20]||(o[20]=[R(" Back ",-1)])]),_:1})):b("",!0),e(a(Pe),{fill:"outline",onClick:o[6]||(o[6]=Ae(i=>B("pbs"),["stop"]))},{default:t(()=>[R(V(K("pbs")<q.value.length-1?"Next":"Finish"),1)]),_:1})])])]),_:1})):b("",!0),M("pmh")?(u(),H(a(Re),{key:3,value:"pmh",class:"_card"},{default:t(()=>[e(a(ve),{slot:"header",color:"light"},{default:t(()=>[e(a(Se),{class:"previousLabel"},{default:t(()=>[...o[21]||(o[21]=[R("Past medical history",-1)])]),_:1})]),_:1}),l("div",Zo,[e(Uo,{"is-active":v.value==="pmh",ref_key:"pastMedicalHistoryFormRef",ref:O,onDataSaved:_},null,8,["is-active"]),l("div",ei,[K("pmh")>0?(u(),H(a(Pe),{key:0,fill:"outline",onClick:o[7]||(o[7]=Ae(i=>P("pmh"),["stop"]))},{default:t(()=>[...o[22]||(o[22]=[R(" Back ",-1)])]),_:1})):b("",!0),e(a(Pe),{fill:"outline",onClick:o[8]||(o[8]=Ae(i=>B("pmh"),["stop"]))},{default:t(()=>[R(V(K("pmh")<q.value.length-1?"Next":"Finish"),1)]),_:1})])])]),_:1})):b("",!0),M("al")?(u(),H(a(Re),{key:4,value:"al",class:"_card"},{default:t(()=>[e(a(ve),{slot:"header",color:"light"},{default:t(()=>[e(a(Se),{class:"previousLabel"},{default:t(()=>[...o[23]||(o[23]=[R("Allergies",-1)])]),_:1})]),_:1}),l("div",ti,[e(Mn,{"is-active":v.value==="al",ref_key:"allergiesFormRef",ref:G,onDataSaved:_},null,8,["is-active"]),l("div",ai,[K("al")>0?(u(),H(a(Pe),{key:0,fill:"outline",onClick:o[9]||(o[9]=Ae(i=>P("al"),["stop"]))},{default:t(()=>[...o[24]||(o[24]=[R(" Back ",-1)])]),_:1})):b("",!0),e(a(Pe),{fill:"outline",onClick:o[10]||(o[10]=Ae(i=>B("al"),["stop"]))},{default:t(()=>[R(V(K("al")<q.value.length-1?"Next":"Finish"),1)]),_:1})])])]),_:1})):b("",!0),M("pe")?(u(),H(a(Re),{key:5,value:"pe",class:"_card"},{default:t(()=>[e(a(ve),{slot:"header",color:"light"},{default:t(()=>[e(a(Se),{class:"previousLabel"},{default:t(()=>[...o[25]||(o[25]=[R("Physical examination",-1)])]),_:1})]),_:1}),l("div",ni,[e(Go,{"is-active":v.value==="pe",ref_key:"physicalExaminationFormRef",ref:C,onDataSaved:_},null,8,["is-active"]),l("div",si,[K("pe")>0?(u(),H(a(Pe),{key:0,fill:"outline",onClick:o[11]||(o[11]=Ae(i=>P("pe"),["stop"]))},{default:t(()=>[...o[26]||(o[26]=[R(" Back ",-1)])]),_:1})):b("",!0),e(a(Pe),{fill:"outline",onClick:o[12]||(o[12]=Ae(i=>B("pe"),["stop"]))},{default:t(()=>[R(V(K("pe")<q.value.length-1?"Next":"Finish"),1)]),_:1})])])]),_:1})):b("",!0)]),_:1},8,["value"])]),_:1})):b("",!0)],64)}}}),tl=Oe(oi,[["__scopeId","data-v-597092a6"]]),ii={class:"allergies-section"},li={class:"allergies-container"},ri={class:"medication-section"},ui={class:"medication-content"},di={key:0,class:"add-medication-form"},ci={class:"form-group"},mi={class:"option-label"},pi={key:0,class:"error-message"},vi={class:"form-row"},fi={class:"form-group"},gi={key:0,class:"error-message"},_i={class:"form-group"},hi={key:0,class:"error-message"},yi={class:"form-group"},bi={key:0,class:"error-message"},Di={class:"action-buttons"},Ci={class:"notes-section"},Si={class:"notes-content"},wi={class:"notes-input-container"},Ii={class:"ion-padding",slot:"content"},ki={class:"notes-timeline"},Oi={class:"note-date"},Pi={class:"note-content"},Ai={class:"ion-padding",slot:"content"},Ei={class:"note-date"},Hi={class:"note-content"},Ti=ce({watch:{},name:"xxxComponent"}),Ni=ce({...Ti,setup(n){const d=Ve,v=Xn,c=s(!1),g=s(!1),f=s(!0),k=s(0),r=s(""),_=s(!1),S=s(),m=s(!1),O=s(""),G=s(""),p=s(""),C=s(""),U=s(""),T=s(""),F="Add new medication",q=Ye(),M=Pt(),K=fe(()=>M.selectedMedicalAllergiesList),P=fe(()=>q.selectedMedicalDrugsList),B=fe(()=>q.partialOPDdrugList),W=fe(()=>q.nonPharmalogicalTherapyAndOtherNotes),y=["first","second","third"],o=s(),$=s(),i=s(),h=s(!1),w=s(!1),j=s("Show more notes"),ne=s(),Ce=s(),z=s(),we=fe(()=>q.editingDrugItem),$e=s("Select a route"),A=s(!1),L=s("Select frequency"),Q=s(!1),oe=s("Select drug"),Fe=s(!1),he=s(),ye=s(),Me=s(),Be=s([]),N=s([{concept_id:11797,name:"Buccal",concept_name_id:null,id:1769},{concept_id:11794,name:"Intradermal",concept_name_id:null,id:6284},{concept_id:11795,name:"Intramuscular (IM)",concept_name_id:null,id:6285},{concept_id:11799,name:"Intraosseous",concept_name_id:null,id:6286},{concept_id:11793,name:"Intravenous (IV)",concept_name_id:null,id:6295},{concept_id:3327,name:"Oral",concept_name_id:null,id:8686},{concept_id:11800,name:"Other method of prescription",concept_name_id:null,id:8920},{concept_id:11792,name:"Rectally",concept_name_id:null,id:10785},{concept_id:11798,name:"Subcutaneous",concept_name_id:null,id:12342},{concept_id:11796,name:"Sublingual",concept_name_id:null,id:12344},{concept_id:11792,name:"Rectally",concept_name_id:null,id:14078},{concept_id:11793,name:"Intravenous (IV)",concept_name_id:null,id:14079},{concept_id:11794,name:"Intradermal",concept_name_id:null,id:14080},{concept_id:11795,name:"Intramuscular (IM)",concept_name_id:null,id:14081},{concept_id:11796,name:"Sublingual",concept_name_id:null,id:14082},{concept_id:11797,name:"Buccal",concept_name_id:null,id:14083},{concept_id:11798,name:"Subcutaneous",concept_name_id:null,id:14084},{concept_id:11799,name:"Intraosseous",concept_name_id:null,id:14085},{concept_id:11800,name:"Other method of prescription",concept_name_id:null,id:14086}]),Y=fe(()=>Be.value.length?Be.value:N.value);function se(E){he.value=E}async function me(){return await Zn()}async function ee(E=5,D=1e3){let x=0;for(;x<E&&(Be.value=await me(),!(Be.value.length>0));)x++,await new Promise(Z=>setTimeout(Z,D));Be.value.length===0&&console.warn("Failed to fetch route list after maximum retries.")}Te(async()=>{const E=new Gn,{previousDrugPrescriptions:D,previousClinicalNotes:x,previousDrugAllergies:Z}=await E.getPatientEncounters();o.value=D,$.value=Object.entries(x)[0];const[,...le]=Object.entries(x);i.value=le,ne.value=Object.entries(Z)[0];const[,...be]=Object.entries(Z);Ce.value=be,await ee()}),te(()=>G.value,async E=>{fa()}),te(()=>p.value,async E=>{Ht()});function ue(){if(We.isEmpty(he.value)==!0)return A.value=!0,!1;if(We.isEmpty(he.value)==!1)return A.value=!1,!0}function ie(){if(We.isEmpty(ye.value)==!0)return Q.value=!0,!1;if(We.isEmpty(ye.value)==!1)return Q.value=!1,!0}function Ue(){if(We.isEmpty(Me.value)==!0)return Fe.value=!0,!1;if(We.isEmpty(Me.value)==!1)return Fe.value=!1,!0}function mt(){f.value=!f.value,c.value=!0,_.value=!1,m.value=!1}async function fa(){return Vt(G.value)?_.value=!1:(r.value="please enter a number",_.value=!0),_.value}async function Ht(){return Vt(p.value)?m.value=!1:(S.value="please enter a number",m.value=!0),m.value}async function Tt(){const E=await Ht(),D=ie(),x=Ue(),Z=ue();return!E&&D==!0&&x==!0&&Z==!0}function ga(E){ye.value=E}async function Nt(){try{const E=()=>z.value.dose_strength!=null&&z.value.dose_strength?Math.trunc(z.value.dose_strength):1;if(we.value!==null){if(!await Tt()){ke("Please enter correct data values",4e3);return}const x=He.getSessionDate(),Z=xt(x,parseInt(p.value));let le=!1;pt(z.value)==!0&&(le=!0);const be={drugName:O.value,dose:E(),frequency:ye.value.label,frequency_code:ye.value.code,duration:p.value,prescription:Z,drug_id:T.value,units:U.value,route_concept_id:he.value.concept_id,route_name:he.value.name,highlightbackground:le},vt=Ye();console.log(vt.setSelectedMedicalDrugsList([be])),vt.editingDrugItem=null,f.value=!0}else{if(!await Tt()){ke("Please enter correct data values",4e3);return}Ia();const x=He.getSessionDate(),Z=xt(x,parseInt(p.value));let le=!1;pt(z.value)==!0&&(le=!0);const be={drugName:O.value,dose:E(),frequency:ye.value.label,frequency_code:ye.value.code,duration:p.value,prescription:Z,drug_id:T.value,units:U.value,route_concept_id:he.value.concept_id,route_name:he.value.name,highlightbackground:le};Ye().setSelectedMedicalDrugsList([be])}T.value="",O.value="",G.value="",ye.value=null,p.value="",C.value="",k.value++,Me.value=null,he.value=null}catch(E){console.error("Error saving data:",E)}}async function _a(E){const D=E,le=await Sn.getOfflineOPDDrugs({name:D,page:1,page_size:10});le.map(be=>({label:be.name,value:be.name,other:be})),q.setPartialOPDdrugList(le)}function pt(E){const D=[];return K.value.forEach(Z=>{Z.selected&&D.push(Z.concept_id)}),ha([E],D)==!0?(ke("Client is allergic to the selected medication",4e6),!0):!1}function ha(E,D){try{return E.some(x=>D.includes(x.concept_id))}catch(x){return!1}}function ya(E){E&&(O.value=E.name,T.value=E.drug_id,U.value=E.units,z.value=E,pt(E))}function ba(E){const D=P.value[E],x=Ye();x.removeDrugById(D.drug_id),x.editingDrugItem=D,T.value="",O.value="",G.value="",ye.value=null,p.value="",C.value="",Me.value=null,he.value=null,T.value=D.drug_id,O.value=D.drugName,G.value=D.dose,ye.value={label:D.frequency,code:D.frequency_code},p.value=D.duration,C.value=D.prescription;const Z=B.value.find(le=>le.name===D.drugName);Z&&(Me.value=Z),he.value={concept_id:D.route_concept_id,name:D.route_name},f.value=!1,k.value++}function Da(){if(we.value!==null){T.value="",O.value="",G.value="",ye.value=null,p.value="",C.value="",Me.value=null,he.value=null;const E=Ye();E.setSelectedMedicalDrugsList([we.value]),E.editingDrugItem=null}f.value=!0,k.value++}function Ca(E){P.value.splice(E,1),k.value++,ke("you have removed a drug from list",6e3)}function Sa(E){let D=E.target.value;wa(D)}function wa(E){Ye().setNonPharmalogicalTherapyAndOtherNotes(E)}function Vt(E){return/^[0-9]+$/.test(E)}function xt(E,D){const x=new Date(E);x.setDate(x.getDate()+D);const Z=x.getFullYear(),le=String(x.getMonth()+1).padStart(2,"0"),be=String(x.getDate()).padStart(2,"0");return"".concat(Z,"-").concat(le,"-").concat(be)}function Ia(){c.value=!1,g.value=!0,f.value=!0}function ka(E){y.filter(x=>x!==E.detail.value);const D=E.detail.value;D!==void 0?D=="third"&&(j.value="Show less notes",w.value=!h.value):(j.value="Show more notes",w.value=!h.value)}function Oa(E){return E[1]}function Pa(E){(E.key==="Enter"||E.key==="ArrowDown")&&(E.preventDefault(),Nt())}const je=fe(()=>[{showAddItemButton:!0,addItemButton:!0,name:we.value!==null?"Update":"ADD",fn:Nt},{showAddItemButton:!0,addItemButton:!0,name:"CANCEL",fn:Aa}]),Aa=async()=>{ca(Cn,{class:"otherVitalsModal"},!0,{message:"Are you sure you want to cancle?"},{cancel:Z=>{},confirm:async Z=>{Z.detail==!0&&Da()}})};return(E,D)=>(u(),H(a(dt),null,{default:t(()=>[l("div",ii,[l("div",li,[e(va)])]),l("div",ri,[e(a(ve),{lines:"none",class:"section-header"},{default:t(()=>[e(a(it),{icon:a(Qe),class:"section-icon"},null,8,["icon"]),e(a(Se),{class:"section-title",style:{"margin-top":"12px"}},{default:t(()=>[...D[9]||(D[9]=[R("Medication",-1)])]),_:1})]),_:1}),l("div",ui,[(u(),H(Ln,{_selectedMedicalDrugsList:P.value,onEditItem:ba,onRemoveItem:Ca,key:k.value,class:"medication-list"},null,8,["_selectedMedicalDrugsList"])),f.value?b("",!0):(u(),I("div",di,[l("div",ci,[D[10]||(D[10]=l("label",{class:"input-label"},"Medication",-1)),e(a(et),{modelValue:Me.value,"onUpdate:modelValue":[D[0]||(D[0]=x=>Me.value=x),D[1]||(D[1]=x=>ya(x))],options:B.value,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Select medication",label:"name","track-by":"drug_id",onSearchChange:D[2]||(D[2]=x=>_a(x))},{option:t(x=>[l("div",mi,V(x.option.name),1)]),_:1},8,["modelValue","options"]),Fe.value?(u(),I("div",pi,V(oe.value),1)):b("",!0)]),l("div",vi,[l("div",fi,[D[11]||(D[11]=l("label",{class:"input-label"},"Route",-1)),e(a(et),{modelValue:he.value,"onUpdate:modelValue":[D[3]||(D[3]=x=>he.value=x),D[4]||(D[4]=x=>se(x))],options:Y.value,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Select route",label:"name","track-by":"concept_id",disabled:!1},null,8,["modelValue","options"]),A.value?(u(),I("div",gi,V($e.value),1)):b("",!0)]),l("div",_i,[D[12]||(D[12]=l("label",{class:"input-label"},"Frequency",-1)),e(a(et),{modelValue:ye.value,"onUpdate:modelValue":[D[5]||(D[5]=x=>ye.value=x),D[6]||(D[6]=x=>ga(x))],options:a(v),searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Select frequency",label:"label","track-by":"code"},null,8,["modelValue","options"]),Q.value?(u(),I("div",hi,V(L.value),1)):b("",!0)]),l("div",yi,[D[13]||(D[13]=l("label",{class:"input-label"},"Duration (days)",-1)),e(a(rt),{modelValue:p.value,"onUpdate:modelValue":D[7]||(D[7]=x=>p.value=x),type:"number",inputmode:"numeric",pattern:"[0-9]*",fill:"outline",placeholder:"Enter duration",onKeydown:Pa},null,8,["modelValue"]),m.value?(u(),I("div",bi,V(S.value),1)):b("",!0)])]),l("div",Di,[je.value[0].addItemButton?(u(),H(xe,{key:0,name:je.value[0].name,icon:a(sa),"onClicked:btn":je.value[0].fn,class:"save-button"},null,8,["name","icon","onClicked:btn"])):b("",!0),je.value[1].addItemButton?(u(),H(xe,{key:1,name:je.value[1].name,icon:a(It),"onClicked:btn":je.value[1].fn,class:"cancel-button"},null,8,["name","icon","onClicked:btn"])):b("",!0)])])),f.value?(u(),H(xe,{key:1,name:F,icon:a(lt),fontWeight:"600","onClicked:btn":mt,class:"add-new-button"},null,8,["icon"])):b("",!0)])]),l("div",Ci,[e(a(ve),{lines:"none",class:"section-header"},{default:t(()=>[e(a(it),{icon:a(Za),class:"section-icon"},null,8,["icon"]),e(a(Se),{class:"section-title"},{default:t(()=>[...D[14]||(D[14]=[R("Non-pharmacological therapy and other notes",-1)])]),_:1})]),_:1}),l("div",Si,[e(Rn,{class:"intervention-component"}),l("div",wi,[e(a(ve),{class:"notes-input-item"},{default:t(()=>[e(a(it),{slot:"start",icon:a(d).editPen,class:"edit-icon","aria-hidden":"true"},null,8,["icon"]),e(a(en),{modelValue:W.value,"onUpdate:modelValue":D[8]||(D[8]=x=>W.value=x),onIonInput:Sa,placeholder:"Enter notes here...","auto-grow":!0,class:"notes-textarea",fill:"outline",style:{"--padding-start":"16px"}},null,8,["modelValue"])]),_:1})]),e(a(ut),{ref:"accordionGroup",class:"previous-notes"},{default:t(()=>[e(a(Re),{value:"fourth","toggle-icon-slot":"start"},{default:t(()=>[e(a(ve),{slot:"header",color:"light",class:"previous-notes-header"},{default:t(()=>[e(a(Se),null,{default:t(()=>[...D[15]||(D[15]=[R("Previous visit notes",-1)])]),_:1})]),_:1}),l("div",Ii,[l("div",ki,[E.index===1?(u(!0),I(de,{key:0},Ee($.value,(x,Z)=>(u(),I("div",{key:Z,class:"note-entry"},[(u(!0),I(de,null,Ee(x,(le,be)=>(u(),I("div",{key:be},[l("div",Oi,V(le.date),1),l("div",Pi,V(le.notes),1)]))),128))]))),128)):b("",!0),e(a(ut),{onIonChange:ka},{default:t(()=>[e(a(Re),{value:"third","toggle-icon-slot":"start"},{default:t(()=>[e(a(ve),{slot:"header",color:"light",class:"show-more-header"},{default:t(()=>[e(a(Se),{color:"primary"},{default:t(()=>[R(V(j.value),1)]),_:1})]),_:1}),l("div",Ai,[(u(!0),I(de,null,Ee(i.value,(x,Z)=>(u(),I("div",{key:Z,class:"note-entry"},[(u(!0),I(de,null,Ee(Oa(x),(le,be)=>(u(),I("div",{key:be},[l("div",Ei,V(le.date),1),l("div",Hi,V(le.notes),1)]))),128))]))),128))])]),_:1})]),_:1})])])]),_:1})]),_:1},512)])])]),_:1}))}}),al=Oe(Ni,[["__scopeId","data-v-928c62f1"]]),Vi=ce({name:"xxxComponent"}),xi=ce({...Vi,emits:["dataSaved"],setup(n,{emit:d}){const v=s(),c=s("gurdian phone number");s(!0),s(!0);const g=s(!0),f=s(),k=s();Te(async()=>{Ce()});const r=[{placeHolder:{default:"Enter time of death if known"},property_name:"timeOfDeath",dataHandler:q,dataValue:s(),show_error:s(!1),error_message:"Time required",type:"time",skip_validation:!1},{placeHolder:{default:"Enter time arrived"},property_name:"timeArrived",dataHandler:M,dataValue:s(),show_error:s(!1),error_message:"Time required",type:"time",skip_validation:!1},{placeHolder:{default:"Enter time confirming death"},property_name:"timeOfDeathConfirmation",dataHandler:K,dataValue:s(),show_error:s(!1),error_message:"Time required",skip_validation:!1}],_=[{placeHolder:{default:"Enter date of death"},property_name:"dateOfDeath",dataHandler:P,dataValue:s(),show_error:s(!1),error_message:"Date required",type:"date",skip_validation:!1},{placeHolder:{default:"Enter date arrived"},property_name:"dateArrived",dataHandler:B,dataValue:s(),show_error:s(!1),error_message:"Date required",type:"date",skip_validation:!1},{placeHolder:{default:"Enter date confirming death"},property_name:"dateOfDeathConfirmation",dataHandler:W,dataValue:s(),show_error:s(!1),error_message:"Date required",type:"date",skip_validation:!1}],S=[{lblTxt:"Was the individual pregnant at the time of death?",value:s(!1),disable_checkbox:s(!0)}],m=[{placeHolder:"Enter place of death",property_name:"placeOfDeath",dataHandler:y,dataValue:s(),show_error:s(!1),error_message:"Input required, Only letters allowed",type:"text",skip_validation:!1},{placeHolder:"Enter name of guardian",property_name:"nameOfGuardian",dataHandler:o,dataValue:s(),show_error:s(!1),error_message:"Input required, Only letters allowed",type:"text",skip_validation:!1},{placeHolder:"Enter name of person confirming death",property_name:"nameOfPersonConfirmindDeath",dataHandler:$,dataValue:s(),show_error:s(!1),error_message:"Input required, Only letters allowed",type:"text",skip_validation:!1},{placeHolder:"Enter position of the person confirming death",property_name:"positionOfthePersonConfirmingDeath",dataHandler:i,dataValue:s(),show_error:s(!1),error_message:"Input required, Only letters allowed",type:"text",skip_validation:!1},{placeHolder:"Enter medical council registration number of the person confirming death",property_name:"medicalConcilRegistrationNumberOfThePersonConfirmingDeath",dataHandler:h,dataValue:s(),show_error:s(!1),error_message:"Input required, Only letters and numbers are allowed",type:"alphanumeric",skip_validation:!1},{placeHolder:"Other (specify)",property_name:"otherNotes",dataHandler:w,dataValue:s(),show_error:s(!1),error_message:"Input required, Only letters allowed",dissabled:g.value,type:"text",skip_validation:!0}],O=[{showAddItemButton:!0,addItemButton:!0,name:"save",btnFill:"clear",fn:z},{showAddItemButton:!0,addItemButton:!0,name:"cancel",btnFill:"clear",fn:U}],G=s([{id:1,name:"Natural",selected:!1},{id:2,name:"Accident",selected:!1},{id:3,name:"Homicide",selected:!1},{id:4,name:"Suicide",selected:!1},{id:5,name:"Pending investigation",selected:!1},{id:6,name:"Could not be determined",selected:!1},{id:7,name:"Other - specify",selected:!1}]),p=s([{id:1,name:"Motor vehicle (passenger)",selected:!1},{id:2,name:"Motor vehicle (pedestrian)",selected:!1},{id:3,name:"Drowning",selected:!1},{id:4,name:"Other - specify",selected:!1}]),C=[{multi_Selection:!1,manner_of_death_Selection_value:s(),show_list_label:!0,unqueId:"qwerty",name_of_list:"Manner of death ",property_name:"mannerOfDeath",placeHolder:"Choose one",items:G.value,listUpdatedFN:j,listFilteredFN:()=>{},use_internal_filter:!0,disabled:s(!1),show_error:s(!1),error_message:"selection required"},{multi_Selection:!1,show_list_label:!0,unqueId:"qwerty1hjkn",name_of_list:"How did it occur?",property_name:"howDiditOccur",placeHolder:"Choose one",items:p.value,listUpdatedFN:ne,listFilteredFN:()=>{},use_internal_filter:!0,disabled:s(!0),show_error:s(!1),error_message:"selection required"}];function U(){F()}const T=d;function F(A={dataSaved:!0}){T("dataSaved",A)}function q(A){r[0].dataValue.value=A}function M(A){r[1].dataValue.value=A}function K(A){r[2].dataValue.value=A}function P(A){const L={day:A.value.day,month:A.value.month,year:A.value.year,formattedDate:A.value.formattedDate};_[0].dataValue.value=L}function B(A){const L={day:A.value.day,month:A.value.month,year:A.value.year,formattedDate:A.value.formattedDate};_[1].dataValue.value=L,console.log(_[2].dataValue.value)}function W(A){const L={day:A.value.day,month:A.value.month,year:A.value.year,formattedDate:A.value.formattedDate};_[2].dataValue.value=L,console.log(_[2].dataValue.value)}function y(A){const L=A.target.value;m[0].dataValue.value=L}function o(A){const L=A.target.value;m[1].dataValue.value=L}function $(A){const L=A.target.value;m[2].dataValue.value=L}function i(A){const L=A.target.value;m[3].dataValue.value=L}function h(A){const L=A.target.value;m[4].dataValue.value=L}function w(A){const L=A.target.value;m[5].dataValue.value=L}function j(A){G.value.forEach(Q=>Q.selected=!1);const L=G.value.find(Q=>Q.id==A.id);C[1].disabled.value=A.name!="Accident",L.selected=!0}function ne(A){console.log("listUpdated",A),p.value.forEach(Q=>Q.selected=!1);const L=p.value.find(Q=>Q.id==A.id);L.selected=!0}function Ce(){const L=new Ot().isChildBearing;L==!0&&(S[0].disable_checkbox.value=!1),L==!1&&(S[0].disable_checkbox.value=!0)}function z(){ht(m),ht(_),ht(r),we();const A=We.merge(yt(m),yt(_),yt(r),$e(C[0]),$e(C[1]));console.log(A)}function we(){const A=G.value.filter(L=>L.selected);if(A.length==0)C[0].show_error.value=!0;else if(C[0].show_error.value=!1,A[0].name=="Accident"){const L=p.value.filter(Q=>Q.selected);C[1].show_error.value=L.length==0}}function $e(A){const L=[];let Q={};return A.items.forEach(oe=>{oe.selected==!0&&L.push({property_name:A.property_name,name:oe.name})}),L.length>0&&(Q[L[0].property_name]=L[0].name),Q}return(A,L)=>{const Q=X("ion-label");return u(),I(de,null,[e(a(ge),{class:"checkbox_content md"},{default:t(()=>[e(a(J),null,{default:t(()=>[e(qe,{placeholder:m[0].placeHolder,icon:a(aa),inputValue:m[0].dataValue.value,"onUpdate:inputValue":m[0].dataHandler},null,8,["placeholder","icon","inputValue","onUpdate:inputValue"]),l("div",null,[m[0].show_error.value?(u(),H(Q,{key:0,class:"error-label"},{default:t(()=>[R(V(m[0].error_message),1)]),_:1})):b("",!0)])]),_:1}),e(a(J),null,{default:t(()=>[e(Xt,{place_holder:_[0].placeHolder,onDateUpDated:_[0].dataHandler,date_prop:""},null,8,["place_holder","onDateUpDated"]),l("div",null,[_[0].show_error.value?(u(),H(Q,{key:0,class:"error-label"},{default:t(()=>[R(V(_[0].error_message),1)]),_:1})):b("",!0)])]),_:1})]),_:1}),e(a(ge),null,{default:t(()=>[e(a(J),null,{default:t(()=>[e(Dt,{place_holder:r[0].placeHolder,onTimeUpDated:r[0].dataHandler,time_prop:""},null,8,["place_holder","onTimeUpDated"]),l("div",null,[r[0].show_error.value?(u(),H(Q,{key:0,class:"error-label"},{default:t(()=>[R(V(r[0].error_message),1)]),_:1})):b("",!0)])]),_:1}),e(a(J))]),_:1}),e(a(ge),{class:"checkbox_content md"},{default:t(()=>[e(a(J),null,{default:t(()=>[e(qe,{placeholder:m[1].placeHolder,icon:a(zt),inputValue:m[1].dataValue.value,"onUpdate:inputValue":m[1].dataHandler},null,8,["placeholder","icon","inputValue","onUpdate:inputValue"]),l("div",null,[m[1].show_error.value?(u(),H(Q,{key:0,class:"error-label"},{default:t(()=>[R(V(m[1].error_message),1)]),_:1})):b("",!0)])]),_:1}),e(a(J),null,{default:t(()=>[e(a(ta),{value:S[0].value,alignment:"start",class:"ion-lblCls",disabled:S[0].disable_checkbox.value},{default:t(()=>[R(V(S[0].lblTxt),1)]),_:1},8,["value","disabled"])]),_:1})]),_:1}),e(a(ge),null,{default:t(()=>[e(a(J),null,{default:t(()=>[e(qe,{placeholder:c.value,icon:a(tn),inputValue:v.value},null,8,["placeholder","icon","inputValue"])]),_:1}),e(a(J))]),_:1}),e(a(ge),null,{default:t(()=>[e(a(J),null,{default:t(()=>[e(Xt,{place_holder:_[1].placeHolder,onDateUpDated:_[1].dataHandler,date_prop:""},null,8,["place_holder","onDateUpDated"]),l("div",null,[_[1].show_error.value?(u(),H(Q,{key:0,class:"error-label"},{default:t(()=>[R(V(_[1].error_message),1)]),_:1})):b("",!0)])]),_:1}),e(a(J),null,{default:t(()=>[e(Dt,{place_holder:r[1].placeHolder,onTimeUpDated:r[1].dataHandler,time_prop:""},null,8,["place_holder","onTimeUpDated"]),l("div",null,[r[1].show_error.value?(u(),H(Q,{key:0,class:"error-label"},{default:t(()=>[R(V(r[1].error_message),1)]),_:1})):b("",!0)])]),_:1})]),_:1}),e(a(ge),null,{default:t(()=>[e(a(J),null,{default:t(()=>[e(a(et),{modelValue:f.value,"onUpdate:modelValue":[L[0]||(L[0]=oe=>f.value=oe),L[1]||(L[1]=oe=>j(oe))],multiple:!1,taggable:!1,"hide-selected":!0,"close-on-select":!0,openDirection:"bottom","tag-placeholder":"Manner of death",placeholder:"Manner of death",selectLabel:"",label:"name",searchable:!0,"track-by":"id",options:G.value},null,8,["modelValue","options"]),l("div",null,[C[0].show_error.value?(u(),H(Q,{key:0,class:"error-label"},{default:t(()=>[R(V(C[0].error_message),1)]),_:1})):b("",!0)])]),_:1}),e(a(J),null,{default:t(()=>[e(a(et),{modelValue:k.value,"onUpdate:modelValue":[L[2]||(L[2]=oe=>k.value=oe),L[3]||(L[3]=oe=>ne(oe))],multiple:!1,taggable:!1,"hide-selected":!0,"close-on-select":!0,openDirection:"bottom","tag-placeholder":"How did it occur?",placeholder:"How did it occur?",selectLabel:"",label:"name",disabled:C[1].disabled.value,searchable:!0,"track-by":"id",options:p.value},null,8,["modelValue","disabled","options"]),l("div",null,[C[1].show_error.value?(u(),H(Q,{key:0,class:"error-label"},{default:t(()=>[R(V(C[1].error_message),1)]),_:1})):b("",!0)])]),_:1})]),_:1}),e(a(ge),null,{default:t(()=>[e(a(J),null,{default:t(()=>[e(qe,{placeholder:m[5].placeHolder,icon:a(Yt),inputValue:m[5].dataValue.value,disabled:g.value,"onUpdate:inputValue":m[5].dataHandler},null,8,["placeholder","icon","inputValue","disabled","onUpdate:inputValue"]),l("div",null,[m[5].show_error.value?(u(),H(Q,{key:0,class:"error-label"},{default:t(()=>[R(V(m[5].error_message),1)]),_:1})):b("",!0)])]),_:1})]),_:1}),e(a(ge),null,{default:t(()=>[e(a(J),null,{default:t(()=>[e(Dt,{place_holder:r[2].placeHolder,onTimeUpDated:r[2].dataHandler,time_prop:""},null,8,["place_holder","onTimeUpDated"]),l("div",null,[r[2].show_error.value?(u(),H(Q,{key:0,class:"error-label"},{default:t(()=>[R(V(r[2].error_message),1)]),_:1})):b("",!0)])]),_:1}),e(a(J),null,{default:t(()=>[e(qe,{placeholder:m[2].placeHolder,icon:a(zt),inputValue:m[2].dataValue.value,"onUpdate:inputValue":m[2].dataHandler},null,8,["placeholder","icon","inputValue","onUpdate:inputValue"]),l("div",null,[m[2].show_error.value?(u(),H(Q,{key:0,class:"error-label"},{default:t(()=>[R(V(m[2].error_message),1)]),_:1})):b("",!0)])]),_:1})]),_:1}),e(a(ge),null,{default:t(()=>[e(a(J),null,{default:t(()=>[e(qe,{placeholder:m[3].placeHolder,icon:a(Qe),inputValue:m[3].dataValue.value,"onUpdate:inputValue":m[3].dataHandler},null,8,["placeholder","icon","inputValue","onUpdate:inputValue"]),l("div",null,[m[3].show_error.value?(u(),H(Q,{key:0,class:"error-label"},{default:t(()=>[R(V(m[3].error_message),1)]),_:1})):b("",!0)])]),_:1}),e(a(J),null,{default:t(()=>[e(qe,{placeholder:m[4].placeHolder,icon:a(Yt),inputValue:m[4].dataValue.value,"onUpdate:inputValue":m[4].dataHandler},null,8,["placeholder","icon","inputValue","onUpdate:inputValue"]),l("div",null,[m[4].show_error.value?(u(),H(Q,{key:0,class:"error-label"},{default:t(()=>[R(V(m[4].error_message),1)]),_:1})):b("",!0)])]),_:1})]),_:1}),(u(),H(a(ge),{key:0,class:"spc_btwn"},{default:t(()=>[O[0].addItemButton?(u(),H(xe,{key:0,name:O[0].name,fill:O[0].btnFill,icon:a(sa),"onClicked:btn":O[0].fn},null,8,["name","fill","icon","onClicked:btn"])):b("",!0),O[1].addItemButton?(u(),H(xe,{key:1,name:O[1].name,fill:O[1].btnFill,icon:a(It),"onClicked:btn":O[1].fn},null,8,["name","fill","icon","onClicked:btn"])):b("",!0)]),_:1}))],64)}}}),$i=Oe(xi,[["__scopeId","data-v-0aad2f08"]]),Mi={class:"dash_box"},Li={key:1},Ri=ce({name:"xxxComponent"}),Fi=ce({...Ri,setup(n){const d=s("No outcome created yet"),v=s(!1),c=s("please select a type"),g=s(!0),f=s(""),k=s(!0),r=s(!1),_=da(),S=fe(()=>_.outcomes),m=s(!1),O=s(!1),G=s(!1),p=s(!1),C=s(!1),U=s(!1),T=s([{name:"Admitted for short stay",selected:!1},{name:"Referred out",selected:!1},{name:"Discharged Home",selected:!1},{name:"Send to Another Clinic",selected:!1}]),F=[{multi_Selection:!1,show_list_label:!0,unqueId:"qwerty2",name_of_list:"Add new outcome",placeHolder:"Choose one",items:T.value,listUpdatedFN:q,listFilteredFN:()=>{},use_internal_filter:!0,disabled:s(!1)}];function q(o){T.value=o,T.value.forEach($=>{$.selected==!0&&(f.value=$.name)})}Te(async()=>{K()}),te(()=>f.value,async o=>{m.value==!0?m.value=!1:W()}),te(()=>S.value.length,async o=>{K()});function M(){T.value.forEach(o=>{o.selected=!1}),f.value=""}function K(){S.value.length>0?k.value=!1:S.value.length==0&&r.value==!1&&(k.value=!0)}function P(o){S.value.splice(o,1)}const B=o=>{};async function W(o=!0){const $=f.value;console.log($),f.value=$;const i=f.value;i==T.value[0].name?G.value=!0:G.value=!1,i==T.value[1].name?(p.value=!0,console.log("show_discharged_options is set to true")):p.value=!1,i==T.value[2].name?(C.value=!0,console.log("show_discharged_options is set to true")):C.value=!1,i==T.value[3].name?U.value=!0:U.value=!1}function y(){O.value=!1,G.value=!1,p.value=!1,C.value=!1,M()}return(o,$)=>{const i=X("ion-row");return u(),H(a(dt),null,{default:t(()=>[e(i,null,{default:t(()=>[e(a(J),null,{default:t(()=>[(u(),H(Yn,{key:0,"onUpdate:removeItem":P,"onUpdate:editItem":B,displayData:S.value},null,8,["displayData"]))]),_:1})]),_:1}),k.value?(u(),H(i,{key:0},{default:t(()=>[l("span",Mi,V(d.value),1)]),_:1})):b("",!0),g.value?(u(),I("div",Li,[e(i,null,{default:t(()=>[e(a(J),null,{default:t(()=>[e(wn,{multiSelection:F[0].multi_Selection,show_label:F[0].show_list_label,uniqueId:F[0].unqueId,name_of_list:F[0].name_of_list,choose_place_holder:F[0].placeHolder,"items_-list":F[0].items,use_internal_filter:F[0].use_internal_filter,disabled:F[0].disabled.value,onItemListUpDated:F[0].listUpdatedFN,onItemListFiltered:F[0].listFilteredFN},null,8,["multiSelection","show_label","uniqueId","name_of_list","choose_place_holder","items_-list","use_internal_filter","disabled","onItemListUpDated","onItemListFiltered"]),l("div",null,[v.value?(u(),H(a(Se),{key:0,class:"error-label"},{default:t(()=>[R(V(c.value),1)]),_:1})):b("",!0)])]),_:1})]),_:1})])):b("",!0),G.value?(u(),H(jn,{key:2,onDataSaved:y,selected_ward_prop:"",admitted_other_props:""})):b("",!0),p.value?(u(),H(Kn,{key:3,onDataSaved:y,selected_referral_data:"",selected_other_referral_data:""})):b("",!0),C.value?(u(),H(Qn,{key:4,onDataSaved:y,selected_discharged_prop:"",selected_discharged_data:""})):b("",!0),O.value?(u(),H($i,{key:5,onDataSaved:y})):b("",!0),U.value?(u(),H(Jn,{key:6,onDataSaved:y})):b("",!0)]),_:1})}}}),nl=Oe(Fi,[["__scopeId","data-v-fc637de7"]]);export{tl as C,nl as O,Ls as P,Lo as _,Go as a,al as b};

var Ct=Object.defineProperty;var It=(e,a,t)=>a in e?Ct(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t;var Ne=(e,a,t)=>It(e,typeof a!="symbol"?a+"":a,t);import{O as de,bp as Ye,t as me,b as te,n as ee,_ as le,bq as St,aU as be,a0 as N,aW as Me,J,F as Pe,S as U,D as Le,aZ as tt,B as at,bg as At,g as ke,ao as $,ba as ze,H as z,u as _e,x as we,y as wt,z as Et,aX as Re,V as Ot,br as Tt,bs as Lt,bt as kt,bu as Ht,bv as Bt,bw as Pt,bx as Nt,P as nt,by as Ve,bz as Mt,bA as Rt,bB as Vt,bC as xt,w as $t,e as Ft,a8 as zt,a1 as Ut,b4 as Gt,G as Wt,o as st,I as qt,a3 as Yt,bf as jt,aa as Qt,bD as Kt,bE as Xt,aA as Jt,bF as ie,A as Ee,bG as Zt,b8 as ea,f as ta,aJ as xe,Q as aa,aK as na,a as je}from"../index-DFvmUOLO.js";import{d as K,b2 as ge,r as w,a as pe,H,O as Q,f as y,J as r,l as s,k as _,e as L,F as ue,P as Se,m as F,u as g,D as sa,w as Z,af as fe,b6 as ia,b3 as He,G as it,E as ot,ag as lt,ah as Ge,a6 as he,I as rt,ab as We,bb as oa,aU as la,Q as Y,c as ae,bE as Qe,aV as dt,bs as $e,ac as Ce,ad as re,aj as ra,ai as da,a2 as Ae,K as q,bK as ca,bC as ct,a5 as ua,bw as ut,z as Ie,am as pt,cr as mt,aa as gt,R as Ke,i as Oe,v as Te,L as Ue,p as ve,aS as pa,av as ma,N as Xe,bu as ga,bZ as ha,aM as va}from"./vendor-DXMRec6a.js";import ht from"./LabOrdersList-qPw6RnkE.js";import{v as Be}from"./group_validation-C3AnbAEA.js";import{u as fa}from"./RadiologyStore-CM1EZYki.js";import{B as oe}from"./BasicForm-D5UMe3eL.js";import{l as vt}from"./lodash-NJiRuGo9.js";import{b as _a,c as ya,f as Da}from"./formatServerData-BHR-Wtd3.js";import{D as ft}from"./DashBox-CUlDocb0.js";import{u as ba,p as Ca}from"./previousComplaints-CxWaFupd.js";import{P as Ia}from"./patient_complaints_service-DP-NXI2a.js";import{u as Sa,_ as Aa}from"./useFormWizard-B5Cjgitc.js";import{a as Je}from"./user_role_management-Df9T0mSB.js";import{u as wa}from"./useUserActivities-1k2n1pGK.js";import{u as Ea,a as Ze}from"./nonPharmaTherapyStore-GyZ201Hh.js";import{A as Oa}from"./ncd_appointment_service-CvO0hVBq.js";import{D as Ta}from"./DateInputField-DRs0HpkJ.js";class _t extends de{constructor(){super()}async postActivities(a,t){const l=t.location_id,d=await new Ye(parseInt(a),-1,l).createEncounter();if(d){const v=await de.buildLabOrders(d,t.orders||t);if(!await de.saveOrdersArray(d.encounter_id,v))return me("Unable to save lab orders")}}async postAHDActivities(a,t){const l=t.location_id,d=await new Ye(parseInt(a),-1,l).createEncounter(te.AHD_LAB_ORDERS);if(d){const v=await de.buildLabOrders(d,t.orders||t);if(!await de.saveOrdersArray(d.encounter_id,v))return me("Unable to save lab orders")}}}const La=["innerHTML"],ka={class:"scrollable-container"},Ha={key:0,class:"form-section"},Ba={key:1,class:"form-section"},Pa={key:2,class:"form-section"},Na={key:3,class:"form-section"},Ma={key:4,class:"form-section"},Ra={key:5,class:"form-section"},Va={key:6,class:"form-section"},xa={key:7,class:"form-section"},$a=K({__name:"RadiologyInvestigation",setup(e){const a=fa(),{head:t,neck:l,chest:u,abdomen:d,upper_extremity:v,spine:i,pelvis:T,lower_extremity:S}=ge(a),f=w(ee),A=w([]),E=(O,D,M)=>{document.querySelectorAll("#".concat(O," path")).forEach(b=>{b.classList.toggle("white-fill")}),document.querySelectorAll("#".concat(D," line")).forEach(b=>{b.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(D," rect")).forEach(b=>{b.classList.toggle("bright-green-fill"),b.classList.toggle("dark-green-stroke")}),document.querySelectorAll("#".concat(D," path")).forEach(b=>{b.classList.toggle("dark-green-fill")}),document.querySelectorAll("#".concat(D," circle")).forEach(b=>{b.classList.toggle("bright-green-fill")});const G=A.value.findIndex(b=>b.id===M);G>=0?A.value.splice(G,1):A.value.unshift({id:M,active:!0})},V=()=>{const O=document.getElementById("SPINE");O.style.display==="none"||O.style.display==""?O.style.display="block":O.style.display="none",E("SPINE","SPINE_LABEL-2","spine")};return pe(()=>{const O=document.getElementById("HEAD");O&&O.addEventListener("click",()=>{E("HEAD","LABEL-6","head")});const D=document.getElementById("NECK");D&&D.addEventListener("click",()=>{E("NECK","LABEL-5","neck")});const M=document.getElementById("CHEST");M&&M.addEventListener("click",()=>{E("CHEST","LABEL-4","chest")});const G=document.getElementById("ABDOMEN_LABEL");G&&G.addEventListener("click",()=>{const I=document.getElementById("ABDOMEN-2");I.style.display==="none"||I.style.display==""?I.style.display="block":I.style.display="none",E("ABDOMEN","ABDOMEN_LABEL-2","abdomen")});const b=document.getElementById("UPPER_EXTRMITY");b&&b.addEventListener("click",()=>{E("UPPER_EXTRMITY","LABEL-3","upper_extremity")});const W=document.getElementById("SPINE"),B=document.getElementById("SPINE_LABEL"),h=document.getElementById("LOWER_SPINE_INACTIVE");W&&W.addEventListener("click",()=>{V()}),B&&B.addEventListener("click",()=>{V()}),h&&h.addEventListener("click",()=>{V()});const m=document.getElementById("PELVIS");m&&m.addEventListener("click",()=>{E("PELVIS","LABEL-2","pelvis")});const c=document.getElementById("LOWER_EXTREMITY");c&&c.addEventListener("click",()=>{E("LOWER_EXTREMITY","LABEL","lower_extremity")})}),(O,D)=>{const M=H("ion-col"),G=H("ion-row");return y(),Q(G,null,{default:r(()=>[s(M,{size:"7"},{default:r(()=>[_("div",{innerHTML:f.value.full_body_sk},null,8,La)]),_:1}),s(M,{size:"5",class:"form-column"},{default:r(()=>[_("div",ka,[(y(!0),L(ue,null,Se(A.value,b=>(y(),L(ue,null,[b.id==="head"?(y(),L("div",Ha,[D[0]||(D[0]=_("h6",null,"Body Part: Head",-1)),s(oe,{contentData:g(t)},null,8,["contentData"])])):b.id==="neck"?(y(),L("div",Ba,[D[1]||(D[1]=_("h6",null,"Body Part: Neck",-1)),s(oe,{contentData:g(l)},null,8,["contentData"])])):b.id==="chest"?(y(),L("div",Pa,[D[2]||(D[2]=_("h6",null,"Body Part: Chest",-1)),s(oe,{contentData:g(u)},null,8,["contentData"])])):b.id==="abdomen"?(y(),L("div",Na,[D[3]||(D[3]=_("h6",null,"Body Part: Abdomen",-1)),s(oe,{contentData:g(d)},null,8,["contentData"])])):b.id==="upper_extremity"?(y(),L("div",Ma,[D[4]||(D[4]=_("h6",null,"Body Part: Upper Extremity",-1)),s(oe,{contentData:g(v)},null,8,["contentData"])])):b.id==="spine"?(y(),L("div",Ra,[D[5]||(D[5]=_("h6",null,"Body Part: Spine",-1)),s(oe,{contentData:g(i)},null,8,["contentData"])])):b.id==="pelvis"?(y(),L("div",Va,[D[6]||(D[6]=_("h6",null,"Body Part: Pelvis",-1)),s(oe,{contentData:g(T)},null,8,["contentData"])])):b.id==="lower_extremity"?(y(),L("div",xa,[D[7]||(D[7]=_("h6",null,"Body Part: Lower Extremity",-1)),s(oe,{contentData:g(S)},null,8,["contentData"])])):F("",!0)],64))),256))])]),_:1})]),_:1})}}}),yt=le($a,[["__scopeId","data-v-5ab54fe8"]]),et=[{selectedData:[],initial:[],isFinishBtn:!1,classDash:"dashed_bottom_border",checkboxBtnContent:{header:{title:"Existing Chronic Health Conditions",class:"bold",selectedValue:"",name:"Chronic disease"},data:[{name:"TB",value:"TB",checked:!1}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"TB",radioBtnContent:{header:{title:"On TB medication",name:"TB treatment",selectedValue:"",displayNext:"Yes",displayNone:!0,class:"bold"},data:[{name:"Yes",value:"Yes",colSize:3},{name:"No",value:"No",colSize:3}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"TB treatment",data:{rowData:[{colData:[{displayNone:!0,inputHeader:"Select medication",class:"bold",icon:ee.search,popOver:!0,value:"",valueType:"text",name:"TB drugs",eventType:"input",required:!0,alertsErrorMassage:"",popOverData:{filterData:!0,data:[]},id:"",idName:"medication"},{inputHeader:"Start date",class:"bold",icon:ee.calendar,popOver:!0,value:"",valueType:"text",name:"TB drug start date",eventType:"input",required:!0,alertsErrorMassage:"",id:"",idName:"startDate",placeholder:"Pick the date",isDatePopover:!0}]}]}},{selectedData:[],isFinishBtn:!1,classDash:"dashed_bottom_border",checkboxBtnContent:{header:{title:"",selectedValue:"",name:"Chronic disease"},data:[{name:"Chronic Obstructive Pulmonary Disease (COPD)",value:"Chronic obstructive pulmonary disease",checked:!1}]}},{selectedData:[],classDash:"dashed_bottom_border",checkboxBtnContent:{header:{title:"",selectedValue:"",name:"Chronic disease"},data:[{name:"Asthma",value:"Asthma",checked:!1}]}},{selectedData:[],classDash:"dashed_bottom_border",checkboxBtnContent:{header:{title:"",selectedValue:"",name:"Chronic disease"},data:[{name:"Epilepsy",value:"Epilepsy",checked:!1}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"Previous stroke",value:"Stroke",checked:!1}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"Peptic Ulcer Disease (PUD)",value:"Peptic ulcer disease",checked:!1}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"Mental disorder",value:"Mental disorders",checked:!1}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{colSize:4.8,name:"Bleeding disorders",value:"Bleeding disorders",checked:!1}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"Hypertension",value:"Hypertension",checked:!1}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"Hypertension",radioBtnContent:{header:{title:"On medication",name:"Hypertension medication",class:"bold",selectedValue:"",displayNext:"Yes",displayNone:!0},data:[{name:"Yes",value:"Yes",colSize:3},{name:"No",value:"No",colSize:3}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"Hypertension medication",data:{rowData:[{colData:[{inputHeader:"Select medication",icon:ee.search,class:"bold",popOver:!0,displayNone:!0,value:"",valueType:"text",name:"Current hypertension treatment regimen",eventType:"input",required:!0,alertsErrorMassage:"",popOverData:{filterData:!1,data:[]},id:"",idName:"medication"}]}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"HIV Positive",value:"HIV pos",checked:!1}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"HIV Positive",radioBtnContent:{header:{title:"Is the patient on ART",name:"HIV status",selectedValue:"",class:"bold",displayNone:!0,displayNext:"Yes"},data:[{name:"Yes",value:"Yes",colSize:3},{name:"No",value:"No",colSize:3}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"HIV status",data:{rowData:[{colData:[{class:"bold",inputHeader:"Enter ARV start date",icon:ee.calendar,popOver:!0,displayNone:!0,value:"",valueType:"text",name:"ARV start date",eventType:"input",required:!0,alertsErrorMassage:"",idName:"medication",placeholder:"Pick the date",isDatePopover:!0}]}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"Diabetes Mellitus",value:"Diabetes Mellitus",checked:!1}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"Diabetes Mellitus",radioBtnContent:{header:{class:"bold",title:"Type",name:"Diabetes",selectedValue:"",displayNone:!0},data:[{name:"Type I",value:"Type 1 diabetes",colSize:4},{name:"Type II",value:"Type 2 diabetes",colSize:4},{name:"Unsure",value:"Unknown",colSize:4}]}},{selectedData:[],isFinishBtn:!1,sideColSize:1,childName:"Diabetes Mellitus",radioBtnContent:{header:{class:"bold",title:"Controlled by",name:"Controlled by",selectedValue:"",displayNone:!0},data:[{name:"Diet",value:"Diet",colSize:4},{name:"Tablets",value:"Tablets",colSize:4},{name:"Insulin",value:"Insulin",colSize:4}]}},{classDash:"dashed_bottom_border",checkboxBtnContent:{header:{selectedValue:"",name:"Chronic disease"},data:[{name:"None",value:"None"}]}}],Fa=sa("pastMedicalHistoryStore",{state:()=>({pastMedicalHistory:[...et]}),actions:{setPastMedicalHistory(e){this.pastMedicalHistory=e},getInitial(){return[...vt.cloneDeep(et)]}},persist:!0}),za={class:"modal_wrapper"},Ua={class:"uniform_columns"},Ga=K({__name:"AHDPastMedicalHistory",setup(e,{expose:a}){const t=Fa(),{pastMedicalHistory:l}=ge(t),u=w([]);pe(()=>{u.value=t.getInitial(),d()}),Z(l,()=>{d()},{deep:!0});const d=()=>{var f;const S=["TB","Chronic Obstructive Pulmonary Disease (COPD)","Asthma","Epilepsy","Previous stroke","Peptic Ulcer Disease (PUD)","Mental disorder","Bleeding disorders","Hypertension","HIV Positive","Diabetes Mellitus"];(f=St(l.value,"None"))!=null&&f.checked?S.forEach(A=>{be(l.value,"TB treatment","displayNone",!0),N(l.value,"TB drugs","displayNone",!0),N(l.value,"TB drug start date","displayNone",!0),be(l.value,"Hypertension medication","displayNone",!0),N(l.value,"Current hypertension treatment regimen","displayNone",!0),be(l.value,"HIV status","displayNone",!0),N(l.value,"ARV start date","displayNone",!0),be(l.value,"Diabetes","displayNone",!0),be(l.value,"Controlled by","displayNone",!0),Me(l.value,A,"checked",!1),Me(l.value,A,"disabled",!0)}):S.forEach(A=>{Me(l.value,A,"disabled",!1)})},v=S=>{N(l.value,"TB drugs","popOverData",{filterData:!0,data:[{name:"Auramine 'O' (C.I. 41000) 50g"},{name:"Bedaquilline 100mg"},{name:"Clofazimine 100mg"},{name:"Clofazimine 50mg"},{name:"Cycloserine 125mg"},{name:"Cycloserine 250mg"},{name:"Delamanid 50mg"},{name:"Ethambutol 100mg"},{name:"Ethambutol 400mg"},{name:"Ethionamide 250mg"},{name:"Isoniazid 100mg "},{name:"Isoniazid 300mg"},{name:"Isoniazid / Rifapentine 300mg / 300mg"},{name:"Levofloxacin 100mg"},{name:"Levofloxacin 250mg"},{name:"Linezolid 600mg"},{name:"Moxifloxacin 400mg"},{name:"Pyrazinamide 400mg"},{name:"Rifabutin 150mg Capsules"},{name:"Rifampicin 150mg/isoniazid 75mg"},{name:"Rifampicin 75mg+INH 50mg dispersible"},{name:"Rifampicin 75mg+INH 50mg+Pyrazinamide 150mg dispersible"},{name:"Rifampicin150mg/Isoniazid75mg/Pyrazinamide 400mg/Ethambutol"}]}),N(l.value,"Current hypertension treatment regimen","popOverData",{filterData:!0,data:[{name:"Captopril 12.5mg"},{name:"Aspirin 75mg"},{name:"Hydrochlorothiazide 25mg"},{name:"Enalapril Meleate 5mg"},{name:"Enalapril Maleate 10mg"}]})},i=async()=>[...await _a(l.value),...await ya(l.value),...await Da(l.value)];return a({onSubmit:async()=>{const S=await i();if(S.length===0){me("No past medical history data to save");return}await J.addObsToEncounterPatient(S,te.AHD_PAST_MEDICAL_HISTORY),Pe("Past medical history saved successful")}}),(S,f)=>(y(),L("div",za,[_("div",Ua,[s(oe,{contentData:g(l),initialData:u.value,"onUpdate:inputValue":v,"onUpdate:selected":v},null,8,["contentData","initialData"])])]))}}),Wa=le(Ga,[["__scopeId","data-v-e5153372"]]),qa=K({data:()=>({userRole:"",ready:!1,userRoleSettings:{}}),watch:{$route:{async handler(e){this.userRole=U.getUserRoles();const a=U.getProgramID(),t=U.getProgramName();this.userRole=="Lab"&&a==14&&(this.userRoleSettings={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}),a==14&&this.userRole!="Lab"&&(this.userRoleSettings={url:"home",btnName:"Go to waiting list",stepperTitle:"Consultation Plan"}),a==12&&(this.userRoleSettings={url:"contact",btnName:"Back"}),t=="LABOUR AND DELIVERY PROGRAM"&&(this.userRoleSettings={url:"labour/labourHome",btnName:"Back to home"}),t=="PNC PROGRAM"&&(this.userRoleSettings={url:"pnc/home",btnName:"Back to home"})},immediate:!0,deep:!0}}}),Ya=K({name:"Menu",mixins:[qa],components:{IonContent:We,IonHeader:rt,IonItem:he,IonList:Ge,IonMenu:lt,IonTitle:ot,IonToolbar:it,IonInput:He,IonPopover:ia,DashBox:ft,SelectionPopover:At,BasicInputField:at,BasicForm:oe,List:tt,DynamicButton:Le,LabOrdersList:ht,RadiologyInvestigation:yt},data(){return{segmentContent:"Lab Investigations",iconsContent:ee,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",testResult:"",test:"",labOrders:"",filteredSpecimen:"",testData:[],popoverOpen:!1,labOrderStatus:!1,event:"",specimen:"",radiologyOrdersStatus:!1,otherOrdersStatus:!1}},setup(){return{checkmark:la,pulseOutline:oa}},computed:{...fe(ze,["investigations"]),...fe(_e,["patient"]),inputFields(){return this.investigations[0].data.rowData[0].colData}},watch:{investigations:{handler(){this.setDashedBox()},deep:!0},patient:{async handler(){var e;(e=this.patient)!=null&&e.labOrders&&(this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved])},deep:!0},$route:{async handler(){await this.getTests()},deep:!0}},async mounted(){await this.getTests(),this.updateInvestigationsStores(),this.setDashedBox(),this.updateInvestigationWizard()},methods:{setSegmentContent(e){this.segmentContent=e},async getTests(){let e;U.getPouchDbStatus()&&U.getLanConnectionStatus()?e=await ke("test_types"):e=await de.getTestTypes(),N(this.investigations,"test","multiSelectData",e)},toggleLabOrderStatus(){this.labOrderStatus=!this.labOrderStatus},async updateInvestigationWizard(){var a;if(!((a=this.patient)!=null&&a.labOrders))return;this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved];const e=await this.labOrders.filter(t=>z.toStandardHisFormat(z.sessionDate())===z.toStandardHisFormat(t.order_date));e.length>0?this.investigations[0].selectedData=e:this.investigations[0].selectedData=""},async updateInvestigationsStores(){await this.updateInvestigationWizard(),ze().setInvestigations(this.investigations)},displayInputFields(){this.testResult="",this.selectedText="",this.no_item=!1,this.addItemButton=!1,this.search_item=!0},async validateRowData(){return Be(this.investigations)},async checkTest(){return await this.isNameInData(this.inputFields[0].value.name,await this.investigations[0].selectedData)?(N(this.investigations,"test","alertsErrorMassage","Lab order already selected"),!1):(N(this.investigations,"test","alertsErrorMassage",""),!0)},async addNewRow(){Be(this.investigations)&&await this.checkTest()&&(await this.saveTest(),this.investigations[0].data.rowData[0].colData[0].value="",this.investigations[0].data.rowData[0].colData[1].value="",this.search_item=!1,this.display_item=!0,this.addItemButton=!0),this.updateInvestigationWizard()},isNameInData(e,a){for(let t of a)for(let l of t.tests)if(l.name===e)return!0;return!1},async saveTest(){await new _t().postAHDActivities(this.patient.patientID,[{concept_id:this.inputFields[0].value.concept_id,name:this.inputFields[0].value.name,specimen:this.inputFields[1].value.name,reason:"Routine",specimenConcept:await $.getConceptID(this.inputFields[1].value.name,!0)}]),N(this.investigations,"specimen","disabled",!0),this.labOrders=[...this.patient.labOrders.saved,...this.patient.labOrders.unsaved]},async handleInputData(e){if(e.inputHeader=="Test"&&this.checkTest(),N(this.investigations,"specimen","alertsErrorMassage",""),e.inputHeader=="Test"&&e.value){let a;U.getPouchDbStatus()&&U.getLanConnectionStatus()?a=await ke("specimens"):a=await de.getSpecimens("",1e3),this.specimen=await $.getConceptSet(e.value.name,"",{names:a.map(t=>t.name)}),this.specimen.length==1?(N(this.investigations,"specimen","value",this.specimen[0]),N(this.investigations,"specimen","disabled",!0)):(N(this.investigations,"specimen","value",""),N(this.investigations,"specimen","disabled",!1)),N(this.investigations,"specimen","multiSelectData",this.specimen)}},async filterTest(e){return await this.labOrders.filter(a=>a.name.toLowerCase().includes(e.toLowerCase()))},async filterSpecimen(e){var a;return(a=this.specimen[0])!=null&&a.name&&e?await this.specimen.filter(t=>t==null?void 0:t.name.toLowerCase().includes(e.toLowerCase())):[]},setTest(e){this.selectedText=e.name,this.inputFields[1].inputHeader=="Test"?this.investigations[0].data.rowData[0].colData[0].value=e.name:this.investigations[0].data.rowData[0].colData[1].value=e.name,this.updateInvestigationsStores()},setDashedBox(){(this.inputFields[1].value||this.inputFields[0].value)&&(this.addItemButton=!1,this.search_item=!0,this.no_item=!1),this.investigations[0].selectedData.length>0?(this.display_item=!0,this.no_item=!1):this.search_item||(this.no_item=!0)}}}),ja={class:"background"},Qa={key:0},Ka={key:1},Xa={key:2},Ja={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},Za={key:3},en={class:"ion-padding",slot:"content"},tn={key:4};function an(e,a,t,l,u,d){const v=H("ion-label"),i=H("ion-segment-button"),T=H("ion-segment"),S=H("VisitsHistory"),f=H("LabOrdersList"),A=H("RadiologyInvestigation");return y(),L("div",ja,[s(T,{value:e.segmentContent,style:{"margin-top":"5px"}},{default:r(()=>[s(i,{value:"Lab Investigations",onClick:a[0]||(a[0]=E=>e.setSegmentContent("Lab Investigations"))},{default:r(()=>[s(v,null,{default:r(()=>[...a[3]||(a[3]=[Y("Lab Investigations",-1)])]),_:1})]),_:1}),s(i,{value:"Radiology Investigation",onClick:a[1]||(a[1]=E=>e.setSegmentContent("Radiology Investigation"))},{default:r(()=>[s(v,null,{default:r(()=>[...a[4]||(a[4]=[Y("Radiology Investigation",-1)])]),_:1})]),_:1}),s(i,{value:"Other Investigation",onClick:a[2]||(a[2]=E=>e.setSegmentContent("Other Investigation"))},{default:r(()=>[s(v,null,{default:r(()=>[...a[5]||(a[5]=[Y("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),e.segmentContent=="Radiology Investigation"?(y(),L("div",Qa,[s(S)])):F("",!0),e.segmentContent=="Other Investigation"?(y(),L("div",Ka)):F("",!0),e.segmentContent=="Lab Investigations"?(y(),L("div",Xa,[_("div",Ja,[_("span",null,[s(f,{propOrders:e.labOrders},null,8,["propOrders"])])])])):F("",!0),e.segmentContent=="Radiology Investigation"?(y(),L("div",Za,[_("div",en,[s(A)])])):F("",!0),e.segmentContent=="Other Investigation"?(y(),L("div",tn)):F("",!0)])}const nn=le(Ya,[["render",an],["__scopeId","data-v-67ff1a61"]]),sn={key:0},on={style:{"align-content":"center"}},ln={class:"ion-padding",slot:"content"},rn=K({__name:"AHDPresentingComplaints",setup(e,{expose:a}){const t=ba(),{presentingComplaints:l}=ge(t),u=w(ee),d=w(!0),v=w(!1),i=w(!0),T=w(!1),S=w([]),f=w([]),A=w(),E=ae(()=>[{componentType:"multiSelectInputField",header:"Presenting Complaints",name:"PresentingComplaints",trackBy:"concept_id",icon:ee.search,hideSelected:!0,validation:h=>b(h==null?void 0:h.name,S.value)?"Presenting complaint already added":we.required(h),options:f.value,grid:{s:"6"}},{componentType:"inputField",header:"Duration",name:"duration",icon:ee.time,validation:h=>we.isNotEmptyandNumber(h),grid:{s:"6"},unitOptions:[{label:"Hours",value:"Hours"},{label:"Days",value:"Days"},{label:"Weeks",value:"Weeks"},{label:"Months",value:"Months"},{label:"Years",value:"Years"}],unitValidation:h=>!h||h===""?"Please select a unit.":null},{componentType:"inputField",header:"Specify the presenting complaint(s)",name:"Other (specify)",icon:ee.editPen,validation:h=>b(h,S.value)?"Presenting complaint already added":we.required(h),condition:h=>{var m;return((m=h==null?void 0:h.PresentingComplaints)==null?void 0:m.name)==="Other"}},{componentType:"Alert",condition:h=>{var m;return we.required((m=h==null?void 0:h.PresentingComplaints)==null?void 0:m.name)!=null},backgroundColor:"lightyellow",textColor:"black",value:"Please search thoroughly for the complaint. If it is not listed, search and select the 'Other' option to specify the complaint.",name:"noMatchAlert"}]),{formRef:V}=wt(),O=async()=>{f.value=await Ia.getComplaintsList("Presenting complaint"),N(l.value,"PresentingComplaints","multiSelectData",f.value)},D=()=>{d.value=!1,i.value=!1,v.value=!0},M=async()=>{var c,I;const h=(c=V.value)==null?void 0:c.getFormValues();((I=V.value)==null?void 0:I.validateForm())==null&&(G(h),v.value=!1,i.value=!0)},G=h=>{var x;const m=h.duration+" "+h.duration_unit,c=h.PresentingComplaints,I=c.name==="Other"?h["Other (specify)"]:c.name;S.value.push({actionBtn:!0,btn:["delete"],name:I,concept_id:c.concept_id,duration:c.duration,durationUnits:c.duration_unit,display:[I,m],data:[{concept_id:8578,value_coded:c.concept_id,obs_datetime:U.getSessionDate(),child:[{concept_id:c.concept_id,value_text:m,obs_datetime:U.getSessionDate()}]}]}),(x=V.value)==null||x.resetForm(),T.value=!0},b=(h,m)=>m.some(c=>c.name===h),W=h=>{S.value=S.value.filter(m=>m.display[0]!==h.name)},B=async()=>{const h=S.value.flatMap(m=>m.data);if(h.length<=0)return me("Presenting complaints is required");h.length<=0||(await J.addObsToEncounterPatient(h,te.AHD_PRESENTING_COMPLAINTS),Pe("Presenting complaints saved successful"),S.value=[])};return pe(async()=>{await O()}),a({onSubmit:B}),(h,m)=>{const c=H("ion-row"),I=H("ion-label"),x=H("ion-accordion"),C=H("ion-accordion-group");return y(),L(ue,null,[s(ft,{status:d.value,content:"No presenting complaints added"},null,8,["status"]),T.value?(y(),L("span",sn,[s(tt,{listData:S.value,"onClicked:delete":W},null,8,["listData"])])):F("",!0),v.value?(y(),Q(c,{key:1},{default:r(()=>[s(Et,{formData:E.value,ref_key:"formRef",ref:V},null,8,["formData"]),_("div",on,[s(Le,{fill:"clear",icon:u.value.plus,iconSlot:"icon-only","onClicked:btn":m[0]||(m[0]=n=>M()),name:"Save"},null,8,["icon"])])]),_:1})):F("",!0),i.value?(y(),Q(c,{key:2,style:{"margin-top":"10px"}},{default:r(()=>[s(Le,{fill:"clear",icon:u.value.plus,iconSlot:"icon-only","onClicked:btn":m[1]||(m[1]=n=>D()),name:"Add new presenting complaints"},null,8,["icon"])]),_:1})):F("",!0),s(c,null,{default:r(()=>[s(C,{ref_key:"accordionGroup",ref:A,class:"previousView"},{default:r(()=>[s(x,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:r(()=>[s(g(he),{slot:"header",color:"light"},{default:r(()=>[s(I,{class:"previousLabel"},{default:r(()=>[...m[2]||(m[2]=[Y("Previous presenting complaints",-1)])]),_:1})]),_:1}),_("div",ln,[s(Ca)])]),_:1})]),_:1},512)]),_:1})],64)}}}),dn=le(rn,[["__scopeId","data-v-04755951"]]);class Fe extends Re{constructor(t,l,u){super(t,te.AHD_HIV_STAGING,u);Ne(this,"age");Ne(this,"confirmatoryTest");this.age=l,this.confirmatoryTest=null}isAdult(){return this.age>=15}isPedaid(){return this.age<=14}setAge(t){this.age=t}getFacilities(t=""){return Ot.getFacilities({name:t})}getConfirmatoryTestType(){return this.confirmatoryTest}cd4CountIsValid(t){try{return!!t.match(/^(=|<|>)([0-9]*)$/m)}catch(l){return!1}}getAlertGuidelines(){return Tt}getWhoStageGuidelines(){return this.isAdult()?Lt:kt}getProgramEligibilityGuidelines(){return this.isAdult()?Ht:Bt}getRecommendedConditionGuidelines(){return this.isAdult()?Pt:Nt}getStagingConditions(t){const l=this.getStagingCategoryByNum(t);return Re.getConceptsByCategory(l)}buildWhoStageObs(t){return this.buildValueCoded("Who stage",t)}buildWhoCriteriaObs(t){return this.buildValueCoded("Who stages criteria present",t)}buildReasonForArtObs(t){return this.buildValueCoded("Reason for ART eligibility",t)}getStagingCategoryByNum(t){switch(t){case 1:return this.isAdult()?"stage_1_conditions_adults":"stage_1_conditions_pedaids";case 2:return this.isAdult()?"stage_2_conditions_adults":"stage_2_conditions_pedaids";case 3:return this.isAdult()?"stage_3_conditions_adults":"stage_3_conditions_pedaids";case 4:return this.isAdult()?"stage_4_conditions_adults":"stage_4_conditions_pedaids";default:return""}}async loadHivConfirmatoryTestType(){const t=await Re.getFirstValueCoded(this.patientID,"Confirmatory hiv test type");t&&(this.confirmatoryTest=t)}}const cn={key:0,class:"ion-padding"},un={class:"accordion_group ion-padding"},pn={style:{"font-weight":"bold"}},mn={class:"error"},gn={class:"ion-padding",slot:"content"},hn={class:"ion-padding"},vn={class:"ion-padding"},fn={key:0,class:"ion-padding"},_n={class:"ion-padding",style:{"border-bottom":"dashed #ccc"}},yn=K({__name:"AHDStaging",props:{hideSubmit:{type:Boolean,default:!1},date:{default:Fe.getSessionDate()}},setup(e,{expose:a}){const t=e,l=new nt,u=w({}),d=new Fe(l.getID(),l.getAge(),-1);Z(()=>t.date,n=>{var P;const o=(P=n==null?void 0:n.standardDate)!=null?P:Fe.getSessionDate(),p=Ie(o).diff(l.getBirthdate(),"years");d.setAge(p),d.setDate(o)},{deep:!0,immediate:!0});const v=Qe({stage_4_conditions:{title:"Stage 4 Conditions",options:[]},stage_3_conditions:{title:"Stage 3 Conditions",options:[]},stage_2_conditions:{title:"Stage 2 Conditions",options:[]},stage_1_conditions:{title:"Stage 1 Conditions",options:[]}}),i=Qe({cd4:"",cd4Date:"",isChildBearing:!1,reasonForArt:"",pregnant:"",breastFeeding:"",cd4Available:"",cd4Modifier:"",cd4Location:"",whoStage:"",staging:[],confirmatoryTest:""}),T={reasonForArt:{buildObs:()=>d.buildReasonForArtObs(i.reasonForArt),suggestAvalue:()=>({"PRESUMED SEVERE HIV":{priority:1,condition:()=>l.getAgeInMonths()<12&&i.confirmatoryTest==="HIV rapid test"&&$.getConceptsByCategory("pshd_condition").some(n=>G().includes(n.name))},"WHO STAGE IV PEDS":{priority:2,condition:()=>d.isPedaid()&&f(["stage_4_conditions"])},"WHO STAGE III PEDS":{priority:3,condition:()=>d.isPedaid()&&f(["stage_3_conditions"])},"HIV DNA polymerase chain reaction":{priority:4,condition:()=>l.getAgeInMonths()<12&&i.confirmatoryTest==="HIV DNA polymerase chain reaction"},"CD4 COUNT LESS THAN OR EQUAL TO 750":{priority:5,condition:()=>D(750)&&M()&&A()&&l.ageInMonths()>=24&&l.ageInMonths()<=56},"CD4 COUNT LESS THAN OR EQUAL TO 500":{priority:6,condition:()=>d.isPedaid()&&D(500)&&M()&&A()},"HIV infected":{priority:7,condition:()=>l.getAgeInMonths()<24||l.getAge()<=5},"WHO STAGE IV ADULT":{priority:1,condition:()=>{const n=$.getConceptsByCategory("severe_hiv_wasting_syndrome");return d.isAdult()&&(f(["stage_4_conditions"])||n.filter(o=>G().includes(o.name)).length>=2)}},"WHO STAGE III ADULT":{priority:2,condition:()=>d.isAdult()&&f(["stage_3_conditions"])},"cd4 less than or equal to 350":{priority:3,condition:()=>d.isAdult()&&D(350)&&A()},"cd4 less than or equal to 250":{priority:4,condition:()=>d.isAdult()&&D(250)&&A()},"cd4 less than or equal to 500":{priority:4,condition:()=>d.isAdult()&&D(500)&&A()},BREASTFEEDING:{priority:5,condition:()=>d.isAdult()&&i.breastFeeding==="Yes"&&M()},"PATIENT PREGNANT":{priority:6,condition:()=>d.isAdult()&&i.pregnant==="Yes"&&M()},Asymptomatic:{priority:7,condition:()=>M()}})},whoStage:{buildObs:()=>d.buildWhoStageObs(i.whoStage),suggestAvalue:()=>({"WHO STAGE IV ADULT":{priority:1,condition:()=>d.isAdult()&&f(["stage_4_conditions"])},"WHO STAGE III ADULT":{priority:2,condition:()=>d.isAdult()&&f(["stage_3_conditions"])},"WHO STAGE II ADULT":{priority:3,condition:()=>d.isAdult()&&f(["stage_2_conditions"])},"WHO STAGE I ADULT":{priority:4,condition:()=>d.isAdult()&&f(["stage_1_conditions"])},"WHO STAGE IV PEDS":{priority:1,condition:()=>d.isPedaid()&&(f(["stage_4_conditions"])||i.reasonForArt==="WHO STAGE IV PEDS")},"WHO STAGE III PEDS":{priority:2,condition:()=>d.isPedaid()&&f(["stage_3_conditions"])},"WHO STAGE II PEDS":{priority:3,condition:()=>d.isPedaid()&&f(["stage_2_conditions"])},"WHO STAGE I PEDS":{priority:4,condition:()=>d.isPedaid()&&f(["stage_1_conditions"])}})},cd4Available:{required:()=>!0,dataHandler:n=>{n!="Yes"&&(i.cd4="",i.cd4Date=""),u.value.cd4="",u.value.cd4Modifier="",u.value.cd4Date="",u.value.cd4Location=""}},pregnant:{required:()=>i.isChildBearing,buildObs:()=>d.buildValueCoded("Is patient pregnant?",i.pregnant)},breastFeeding:{required:()=>i.isChildBearing,buildObs:()=>d.buildValueCoded("Is patient breast feeding?",i.breastFeeding)},cd4:{required:()=>i.cd4Available==="Yes",validation:()=>{if(!O()){u.value.cd4="A number is required";return}V()>1e4&&(u.value.cd4="CD4 value cannot exceed 10,000")},buildObs:()=>d.buildValueNumber("CD4 count",V(),E())},cd4Modifier:{required:()=>i.cd4Available==="Yes",validation:()=>{i.cd4Modifier||(u.value.cd4Modifier="Please select modifier")},dataHandler:n=>i.cd4Modifier=n,options:[{label:"=",value:"="},{label:">",value:">"},{label:"<",value:"<"}]},cd4Date:{required:()=>i.cd4Available==="Yes",dataHandler:n=>{n&&(i.cd4Date=Ie(n).format("YYYY-MM-DD"))},validation:()=>{if(isNaN(new Date(i.cd4Date).getTime())){u.value.cd4Date="Invalid CD4 date";return}const n=Ie(i.cd4Date);if(n.isAfter(Ie(d.getDate()))){u.value.cd4Date="Cd4 result date can't be greater than ".concat(d.getDate());return}n.isBefore(Ie(l.getBirthdate()))&&(u.value.cd4Date="CD4 date must not be earlier than birthdate")},buildObs:()=>d.buildValueDate("Cd4 count datetime",i.cd4Date)},cd4Location:{required:()=>i.cd4Available==="Yes",dataHandler:n=>i.cd4Location=n,buildObs:()=>d.buildValueText("Cd4 count location",i.cd4Location)},staging:{validation:()=>{if(Object.keys(v).every(P=>h(P)<=0)){u.value.staging="Please select one or more staging conditions";return}const o=["stage_4_conditions","stage_3_conditions","stage_2_conditions"].some(P=>h(P)>0);v.stage_1_conditions.options.some(P=>/asymptomatic/i.test(P.name)&&P.checked)&&o&&(u.value.staging="Asymptomatic cannot be selected with other staging conditions")},buildObs:()=>Object.keys(v).reduce((o,p)=>(v[p].options.forEach(P=>{P.checked&&o.push(P.name)}),o),[]).map(o=>d.buildWhoCriteriaObs(o))}};function S(){Object.keys(i).forEach(n=>{typeof i[n]=="boolean"?i[n]=!1:Array.isArray(i[n])?i[n]=[]:i[n]=""}),Object.keys(u.value).forEach(n=>u.value[n]=""),I()}function f(n){return n.some(o=>h(o)>0)}function A(){return new Date(i.cd4Date)<=new Date("2016-04-30")}function E(){return i.cd4Modifier}function V(){return parseInt("".concat(i.cd4))}function O(){return/^\d+$/i.test("".concat(i.cd4))}function D(n){if(!O())return!1;const o=E(),p=V();return o==="="&&n===p||o==="<"&&p<=n||o===">"&&p>=n}function M(){return f(["stage_2_conditions","stage_1_conditions"])}function G(){return Object.keys(v).reduce((n,o)=>(v[o].options.forEach(p=>p.checked&&n.push(p.name)),n),[])}function b(n){if(u.value[n]="",typeof T[n].required=="function"&&T[n].required()&&!i[n]){u.value[n]="This field is required";return}i[n]&&typeof T[n].validation=="function"&&T[n].validation()}function W(n){var o,p,P;if(T[n]&&"suggestAvalue"in T[n]){i[n]="";const j=T[n].suggestAvalue(),ne=Object.keys(j).reduce((se,ce)=>{const ye=j[ce];return typeof ye.condition=="function"&&ye.condition()?[...se,{value:ce,priority:ye.priority}]:se},[]);i[n]=(P=(p=(o=ne.sort((se,ce)=>se.priority-ce.priority))==null?void 0:o[0])==null?void 0:p.value)!=null?P:""}}function B(){return Object.keys(i).reduce((n,o)=>{if(o in T&&i[o]&&typeof T[o].buildObs=="function"){const p=T[o].buildObs();return Array.isArray(p)?[...n,...p]:[...n,p]}return n},[])}function h(n){return v[n].options.filter(o=>o.checked).length}async function m(){await d.loadHivConfirmatoryTestType(),i.confirmatoryTest=d.getConfirmatoryTestType(),i.isChildBearing=l.isChildBearing()}function c(n,o){n in T&&typeof T[n].dataHandler=="function"&&T[n].dataHandler(o),b(n),Object.keys(T).forEach(p=>W(p))}function I(){Object.keys(v).forEach(n=>{var P,j;const o=Number((j=(P=n.match(/\d+/))==null?void 0:P[0])!=null?j:0),p=d.getStagingConditions(o);v[n].options=p.map(ne=>({checked:!1,name:ne.name,concept_id:ne.concept_id}))})}function x(){return Object.keys(T).forEach(n=>b(n)),Object.keys(u.value).every(n=>"".concat(u.value[n]).length<=0)}async function C(){if(console.log("Submitting staging"),!x())return me("Please review form for errors"),!1;try{const n=await Promise.all(B());return await J.addObsToEncounterPatient(n,te.AHD_HIV_STAGING),Pe("Staging Observations saved!"),!0}catch(n){return console.error(n),$t("Error has occured while saving observations"),!1}}return Z(()=>t.date,n=>{d.setDate(n),l.date=n,S()}),pe(async()=>{await m(),I()}),a({validateStagingForm:x,buildPayload:B,onSubmit:C}),(n,o)=>(y(),Q(g(ut),null,{default:r(()=>[s(g(dt),null,{default:r(()=>[i.isChildBearing?(y(),L("div",cn,[s(g($e),null,{default:r(()=>[s(g(Ce),null,{default:r(()=>[s(g(re),null,{default:r(()=>[s(Ve,{label:"Pregnant?",modelValue:i.pregnant,"onUpdate:modelValue":o[0]||(o[0]=p=>i.pregnant=p),onIonChange:o[1]||(o[1]=p=>c("pregnant",p)),"error-message":u.value.pregnant},null,8,["modelValue","error-message"])]),_:1}),s(g(re),null,{default:r(()=>[s(Ve,{label:"Breastfeeding?",modelValue:i.breastFeeding,"onUpdate:modelValue":o[2]||(o[2]=p=>i.breastFeeding=p),onOnChange:o[3]||(o[3]=p=>c("breastFeeding",p)),"error-message":u.value.breastFeeding},null,8,["modelValue","error-message"])]),_:1})]),_:1})]),_:1})])):F("",!0),_("div",un,[s(g(ra),{color:"light"},{default:r(()=>[(y(!0),L(ue,null,Se(v,(p,P)=>(y(),Q(g(da),{key:P},{default:r(()=>[s(g(he),{color:"light",slot:"header"},{default:r(()=>[s(g(Ae),{style:{color:"grey","font-size":"17px"},class:"ion-padding"},{default:r(()=>[_("b",pn,[Y(q(p.title)+" ",1),s(g(ca),{color:h("".concat(P))>0?"primary":void 0},{default:r(()=>[Y(" Selected: "+q(h("".concat(P))),1)]),_:2},1032,["color"])]),_("p",mn,q(u.value.staging),1)]),_:2},1024)]),_:2},1024),_("div",gn,[s(g(Ge),null,{default:r(()=>[(y(!0),L(ue,null,Se(p.options,(j,ne)=>(y(),Q(g(he),{key:ne},{default:r(()=>[s(g(ct),{modelValue:j.checked,"onUpdate:modelValue":se=>j.checked=se,onIonChange:se=>c("staging",{stage_type:P,raw:se,option:j})},null,8,["modelValue","onUpdate:modelValue","onIonChange"]),s(g(Ae),{style:{margin:"13px"}},{default:r(()=>[Y(q(j.name),1)]),_:2},1024),o[15]||(o[15]=_("p",null,null,-1)),j.description?(y(),Q(g(ua),{key:0,color:j.color},{default:r(()=>[Y(q(j.text),1)]),_:2},1032,["color"])):F("",!0)]),_:2},1024))),128))]),_:2},1024)])]),_:2},1024))),128))]),_:1})]),_("div",hn,[_("div",vn,[s(Ve,{label:"Recent CD4 count results available?",modelValue:i.cd4Available,"onUpdate:modelValue":o[4]||(o[4]=p=>i.cd4Available=p),onOnChange:o[5]||(o[5]=p=>c("cd4Available",p)),"error-message":u.value.cd4Available},null,8,["modelValue","error-message"])]),i.cd4Available==="Yes"?(y(),L("div",fn,[s(g($e),{class:"ion-padding"},{default:r(()=>[s(g(Ce),null,{default:r(()=>[s(g(re),null,{default:r(()=>[s(Mt,{label:"CD4 Count Date",modelValue:i.cd4Date,"onUpdate:modelValue":o[6]||(o[6]=p=>i.cd4Date=p),required:i.cd4Available==="Yes","error-message":u.value.cd4Date,onOnChange:o[7]||(o[7]=p=>c("cd4Date",p))},null,8,["modelValue","required","error-message"])]),_:1})]),_:1}),s(g(Ce),null,{default:r(()=>[s(g(re),{size:"2"},{default:r(()=>[s(Rt,{label:"CD4 Result Modifier",required:i.cd4Available==="Yes","error-message":u.value.cd4Modifier,options:T.cd4Modifier.options,onOnChange:o[8]||(o[8]=p=>c("cd4Modifier",p.value))},null,8,["required","error-message","options"])]),_:1}),s(g(re),{size:"10"},{default:r(()=>[s(Vt,{label:"CD4 Count",modelValue:i.cd4,"onUpdate:modelValue":o[9]||(o[9]=p=>i.cd4=p),type:"number",onOnChange:o[10]||(o[10]=p=>c("cd4",p)),placeholder:"Enter CD4 Count","error-message":u.value.cd4},null,8,["modelValue","error-message"])]),_:1})]),_:1}),s(g(Ce),{style:{"margin-top":"15px"}},{default:r(()=>[s(g(re),null,{default:r(()=>[s(xt,{label:"CD4 Count Location",modelValue:i.cd4Location,"onUpdate:modelValue":o[11]||(o[11]=p=>i.cd4Location=p),required:i.cd4Available==="Yes","error-message":u.value.cd4Location,show_error:!1,selected_district_ids:[],selected_location:i.cd4Location,onOnChange:o[12]||(o[12]=p=>{c("cd4Location",p)})},null,8,["modelValue","required","error-message","selected_location"])]),_:1})]),_:1})]),_:1})])):F("",!0)]),_("div",_n,[s(g($e),null,{default:r(()=>[s(g(Ce),null,{default:r(()=>[s(g(re),null,{default:r(()=>[s(g(He),{readonly:"",placeholder:"N/A",label:"REASON FOR ART:",modelValue:i.reasonForArt,"onUpdate:modelValue":o[13]||(o[13]=p=>i.reasonForArt=p)},null,8,["modelValue"])]),_:1}),s(g(re),null,{default:r(()=>[s(g(He),{readonly:"",placeholder:"N/A",label:"WHO STAGE:",modelValue:i.whoStage,"onUpdate:modelValue":o[14]||(o[14]=p=>i.whoStage=p)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),Dn=le(yn,[["__scopeId","data-v-f482cf99"]]),bn={style:{display:"flex","align-items":"center"}},Cn={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},In=K({__name:"AHDWorkflow",props:{closeModalOnFinish:{type:Boolean,default:!1}},setup(e,{expose:a}){const{onTabBeforeChange:t,currentTabIndex:l}=Sa();pt();const u=mt(),d=w(!0),v=w(!1),i=w(!1),T=w(null),S=w(null),f=w(null),A=ae(()=>({text:i.value?"Saving...":"Finish",icon:i.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:v.value||i.value})),E=_e(),V=Ft(),O=zt(),{patient:D}=ge(E),{sessionDate:M}=ge(O);Z(A,(C,n)=>{console.log("Done button options changed:",{from:n,to:C,currentStep:l.value,tabsLength:B.value.length}),C.disabled!==(n==null?void 0:n.disabled)&&console.log("Done button ".concat(C.disabled?"disabled":"enabled")),C.text!==(n==null?void 0:n.text)&&console.log('Done button text changed from "'.concat(n==null?void 0:n.text,'" to "').concat(C.text,'"'))},{deep:!0}),Z(i,(C,n)=>{C!==n&&(console.log("Saving state changed: ".concat(n," -> ").concat(C)),console.log(C?"Starting save process...":"Save process completed"))});const G=C=>{console.log("Done button change received from wizard:",C),C.newOptions.disabled&&console.log("Done button has been disabled"),C.isLastStep&&console.log("User is on the last step, done button should be visible")},b=()=>{let C=!1;return h(),i.value&&(C=!0),v.value=C,!C},W=()=>[{title:"Presenting Complaints",icon:""},{title:"Past Medical History",icon:""},{title:"WHO",icon:""},{title:"Investigation",icon:""}],B=w(W());w(null),w(null);const h=()=>{var o;if(!B.value||B.value.length===0)return console.log("Tabs not yet initialized"),null;const C=l.value>=0&&l.value<B.value.length?l.value:0;switch((o=B.value[C])==null?void 0:o.title){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation";default:if(V.NCDActivities.length>0)switch(V.NCDActivities[0]){case"Presenting Complaints":return"Presenting Complaints";case"Past Medical History":return"Past Medical History";case"WHO":return"WHO";case"Investigation":return"Investigation"}return null}},m=()=>{d.value=!1,setTimeout(()=>{l.value=0,d.value=!0},0)},c=async()=>{Ut(M.value,"sessionDate","value")||z.sessionDate(),Gt("vitals");for(let C=0;C<B.value.length;C++)B.value[C];b()},I=async(C,n)=>{var o;(o=B.value[n])==null||o.title,C%1===0&&(l.value=C)},x=async()=>{var C,n,o;i.value=!0;try{(C=T.value)==null||C.onSubmit(),(n=S.value)==null||n.onSubmit(),(o=f.value)==null||o.onSubmit(),Ke.dismiss()}catch(p){console.error("Error saving data:",p),me("Error occurred while saving data. Please try again.")}finally{i.value=!1}};return pe(async()=>{B.value=W(),await c(),(l.value===void 0||l.value<0)&&(l.value=0,console.log("Setting initial tab index to 0")),v.value=!1,i.value=!1,b()}),Z(l,async()=>{await b()}),Z(M,async()=>{await c()},{deep:!0}),Z(u,async C=>{m(),B.value=W()},{deep:!0}),Z(D,async(C,n)=>{await c(),C.ID!=n.ID&&m()},{deep:!0}),a({saveData:x,markWizard:c,refreshWizard:m,validateDoneButtonState:b}),(C,n)=>{const o=H("ion-icon"),p=H("ion-title"),P=H("ion-toolbar"),j=H("ion-header");return y(),L(ue,null,[s(j,null,{default:r(()=>[s(P,{class:"modal-title"},{default:r(()=>[s(p,null,{default:r(()=>[_("div",bn,[s(o,{icon:g(ee).demographics,class:"sub-menu-icon",style:{"font-size":"1.4rem"}},null,8,["icon"]),n[2]||(n[2]=_("b",{style:{"margin-left":"6px"}},"Advance HIV Disease",-1))])]),_:1}),s(o,{slot:"end",onClick:n[0]||(n[0]=ne=>g(Ke).dismiss()),style:{"font-size":"30px","padding-right":"10px"},icon:g(gt)},null,8,["icon"])]),_:1})]),_:1}),s(g(We),{class:"ion-padding"},{default:r(()=>[_("div",Cn,[d.value?(y(),Q(Aa,{key:0,ref:"wizard",headingTitle:"AHD Screening","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:A.value,"custom-tabs":B.value,beforeChange:g(t),onChange:I,"onComplete:wizard":n[1]||(n[1]=ne=>x()),onDoneButtonChanged:G},{default:r(()=>[Oe(_("div",null,[s(dn,{ref_key:"AHDPresentingComplaintsRef",ref:T},null,512)],512),[[Te,h()=="Presenting Complaints"]]),Oe(_("div",null,[s(Wa,{ref_key:"AHDPastMedicalHistoryRef",ref:S},null,512)],512),[[Te,h()=="Past Medical History"]]),Oe(_("div",null,[s(Dn,{ref_key:"AHDStagingRef",ref:f},null,512)],512),[[Te,h()=="WHO"]]),Oe(_("div",null,[s(nn,{ref:"investigationRef"},null,512)],512),[[Te,h()=="Investigation"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):F("",!0)])]),_:1})],64)}}}),Sn=async()=>{const{hasWaitingList:e}=wa(),a=await J.getObsByEncounterIdAndDate(te.PRESENTING_COMPLAINTS),t=await J.getObsByEncounterId(te.HIV_CLINIC_REGISTRATION),l=await J.getObsByEncounterId(te.PAST_MEDICAL_HISTORY),u=await J.getObsByEncounterId(te.HIV_STATUS_AT_ENROLLMENT),d=await J.getObsByEncounterId(te.PATIENT_OUTCOME),v=await $.getConceptID("Slow onset severe headache"),i=await $.getConceptID("Confusion"),T=await $.getConceptID("Fever"),S=await $.getConceptID("Neck stiffness"),f=await $.getConceptID("Persistent fever/drenching night sweats"),A=await $.getConceptID("Weight loss or failure to thrive"),E=await $.getConceptID("Anaemia<8gdl"),V=await $.getConceptID("Enlarged nodes"),O=await $.getConceptID("Meningits signs"),D=await $.getConceptID("Cough"),M=await $.getConceptID("Yes"),G=await $.getConceptID("Reactive"),b=await $.getConceptID("New Positive"),W=await $.getConceptID("HIV status"),B=await $.getConceptID("Presenting complaint"),h=J.isValueCodedAvailable(a,[v,i,T,S,f,A,E,V,O,D],B),m=J.isValueCodedAvailable(l,[M],W),c=J.isValueCodedAvailable(u,[G],W),I=J.isValueCodedAvailable(d,[M],b);return console.log("ðŸš€ ~ isQualifiedAHD ~ hasCoughComplaint:",h),console.log("ðŸš€ ~ isQualifiedAHD ~ isClinician():",Je()),console.log('ðŸš€ ~ isQualifiedAHD ~ hasWaitingList("Waiting for Consultation")) :',e("Waiting for Consultation")),console.log("ðŸš€ ~ isQualifiedAHD ~ hasHIVHistory:",m),(Je()||e("Waiting for Consultation"))&&h&&(m||I||c||t.length>0)},An={class:"background"},wn={key:0},En={key:1},On={key:2},Tn={class:"",slot:"content",style:{"margin-bottom":"125px","margin-top":"2px"}},Ln={key:3},kn={class:"ion-padding",slot:"content"},Hn={key:4},Bn=K({__name:"Investigations",setup(e,{expose:a}){const t=w("Lab Investigations"),l=w(!1);w(!0);const u=w(!1),d=w(!1),v=w(!0),i=w(""),T=w("");w("");const S=w("");w(""),w([]),w(!1);const f=w(!1);w("");const A=w("");w(!1),w(!1);const E=ze(),V=_e(),{investigations:O}=ge(E),{patient:D}=ge(V),M=mt(),G=pt(),b=ae(()=>O.value[0].data.rowData[0].colData),W=k=>{t.value=k},B=async()=>{let k;U.getPouchDbStatus()&&U.getLanConnectionStatus()?k=await ke("test_types"):k=await de.getTestTypes(),N(O.value,"test","multiSelectData",k)},h=()=>{f.value=!f.value},m=async()=>{var R;if(!((R=D.value)!=null&&R.labOrders))return;S.value=[...D.value.labOrders.saved,...D.value.labOrders.unsaved];const k=await S.value.filter(X=>z.toStandardHisFormat(z.sessionDate())===z.toStandardHisFormat(X.order_date));k.length>0?O.value[0].selectedData=k:O.value[0].selectedData=""},c=async()=>{await m(),E.setInvestigations(O.value)},I=()=>{T.value="",i.value="",l.value=!1,v.value=!1,u.value=!0},x=async()=>Be(O.value),C=async()=>await o(b.value[0].value.name,await O.value[0].selectedData)?(N(O.value,"test","alertsErrorMassage","Lab order already selected"),!1):(N(O.value,"test","alertsErrorMassage",""),!0),n=async()=>{Be(O.value)&&await C()&&(await p(),O.value[0].data.rowData[0].colData[0].value="",O.value[0].data.rowData[0].colData[1].value="",u.value=!1,d.value=!0,v.value=!0),m()},o=(k,R)=>{for(let X of R)for(let De of X.tests)if(De.name===k)return!0;return!1},p=async()=>{await new _t().postActivities(D.value.patientID,[{concept_id:b.value[0].value.concept_id,name:b.value[0].value.name,specimen:b.value[1].value.name,reason:"Routine",specimenConcept:await $.getConceptID(b.value[1].value.name,!0)}]),N(O.value,"specimen","disabled",!0),S.value=[...D.value.labOrders.saved,...D.value.labOrders.unsaved]},P=async k=>{if(k.inputHeader=="Test"&&C(),N(O.value,"specimen","alertsErrorMassage",""),k.inputHeader=="Test"&&k.value){let R;U.getPouchDbStatus()&&U.getLanConnectionStatus()?R=await ke("specimens"):R=await de.getSpecimens("",1e3),A.value=await $.getConceptSet(k.value.name,"",{names:R.map(X=>X.name)}),A.value.length==1?(N(O.value,"specimen","value",A.value[0]),N(O.value,"specimen","disabled",!0)):(N(O.value,"specimen","value",""),N(O.value,"specimen","disabled",!1)),N(O.value,"specimen","multiSelectData",A.value)}},j=async k=>await S.value.filter(R=>R.name.toLowerCase().includes(k.toLowerCase())),ne=async k=>{var R;return(R=A.value[0])!=null&&R.name&&k?await A.value.filter(X=>X==null?void 0:X.name.toLowerCase().includes(k.toLowerCase())):[]},se=k=>{i.value=k.name,b.value[1].inputHeader=="Test"?O.value[0].data.rowData[0].colData[0].value=k.name:O.value[0].data.rowData[0].colData[1].value=k.name,c()},ce=()=>{(b.value[1].value||b.value[0].value)&&(v.value=!1,u.value=!0,l.value=!1),O.value[0].selectedData.length>0?(d.value=!0,l.value=!1):u.value||(l.value=!0)},ye=async()=>{await Sn()&&G.currentRoute.value.name=="OPDConsultationPlan"&&await Wt("Do you want to do AHD screening?")&&(await st(In,{class:"fullScreenModal"}),await qt(D.value))};return Z(O,()=>{ce()},{deep:!0}),Z(D,async()=>{var k;(k=D.value)!=null&&k.labOrders&&(S.value=[...D.value.labOrders.saved,...D.value.labOrders.unsaved])},{deep:!0}),Z(M,async()=>{await B()},{deep:!0}),pe(async()=>{await B(),c(),ce(),m()}),a({openAHDModal:ye,setSegmentContent:W,getTests:B,toggleLabOrderStatus:h,updateInvestigationWizard:m,updateInvestigationsStores:c,displayInputFields:I,validateRowData:x,checkTest:C,addNewRow:n,isNameInData:o,saveTest:p,handleInputData:P,filterTest:j,filterSpecimen:ne,setTest:se,setDashedBox:ce}),(k,R)=>{const X=H("ion-label"),De=H("ion-segment-button"),Dt=H("ion-segment"),bt=H("VisitsHistory");return y(),L("div",An,[s(Dt,{value:t.value,style:{"margin-top":"5px"}},{default:r(()=>[s(De,{value:"Lab Investigations",onClick:R[0]||(R[0]=qe=>W("Lab Investigations"))},{default:r(()=>[s(X,null,{default:r(()=>[...R[3]||(R[3]=[Y("Lab Investigations",-1)])]),_:1})]),_:1}),s(De,{value:"Radiology Investigation",onClick:R[1]||(R[1]=qe=>W("Radiology Investigation"))},{default:r(()=>[s(X,null,{default:r(()=>[...R[4]||(R[4]=[Y("Radiology Investigation",-1)])]),_:1})]),_:1}),s(De,{value:"Other Investigation",onClick:R[2]||(R[2]=qe=>W("Other Investigation"))},{default:r(()=>[s(X,null,{default:r(()=>[...R[5]||(R[5]=[Y("Other Investigation",-1)])]),_:1})]),_:1})]),_:1},8,["value"]),t.value=="Radiology Investigation"?(y(),L("div",wn,[s(bt)])):F("",!0),t.value=="Other Investigation"?(y(),L("div",En)):F("",!0),t.value=="Lab Investigations"?(y(),L("div",On,[_("div",Tn,[_("span",null,[s(ht,{propOrders:S.value},null,8,["propOrders"])])])])):F("",!0),t.value=="Radiology Investigation"?(y(),L("div",Ln,[_("div",kn,[s(yt)])])):F("",!0),t.value=="Other Investigation"?(y(),L("div",Hn)):F("",!0)])}}}),bs=le(Bn,[["__scopeId","data-v-a8c898e3"]]),Pn=K({created(){},components:{IonItem:he,IonCol:re,IonLabel:Ae,IonIcon:Ue},data(){return{iconsContent:ee,localMedicalDrugsList:[...this.$props._selectedMedicalDrugsList]}},props:{_selectedMedicalDrugsList:{type:Array,default:[]},show_actions_buttons:{type:Boolean,default:!0},highLightBackground:{type:String,default:"item-native"}},watch:{},methods:{highlightItem(e){const a=document.getElementById(e+"_lbl");a&&(a.style.color="#006401"),this.highlightActionBtns(e)},undoHighlightItem(e){const a=document.getElementById(e+"_lbl");a&&(a.style.color="#636363"),this.undohighlightActionBtns(e)},highlightActionBtns(e){const a=document.getElementsByClassName(e+"_spanlbl");for(let t=0;t<a.length;t++)a[t].style.display="inline-block"},undohighlightActionBtns(e){const a=document.getElementsByClassName(e+"_spanlbl");for(let t=0;t<a.length;t++)a[t].style.display="none"},asignLblID(e){return e+"_lbl"},asignSpanLblID(e){return e+"_spanlbl"},async removeItemAtIndex(e,a){await Yt("Do you want to delete it?",a)&&this.$emit("remove-item",e)},editItemAtIndex(e){this.$emit("edit-item",e)},highLightBnd(e){if(e){if(e.highlightbackground!==void 0&&e.highlightbackground==!0)return this.$props.highLightBackground}else return!1}}}),Nn=["onMousemove","onMouseout"],Mn={class:"route-label"};function Rn(e,a,t,l,u,d){const v=H("ion-label"),i=H("ion-col"),T=H("ion-row"),S=H("ion-icon");return y(!0),L(ue,null,Se(e.localMedicalDrugsList,(f,A)=>(y(),L("div",{id:"df",class:"medication-item",key:A,onMousemove:E=>e.highlightItem(A),onMouseout:E=>e.undoHighlightItem(A)},[s(T,{class:"medication-header"},{default:r(()=>[s(i,{class:ve(["ion-text-wrap",e.highLightBnd(f)])},{default:r(()=>[s(v,{id:e.asignLblID(A),class:"medication-name"},{default:r(()=>[Y(q(f.drugName),1)]),_:2},1032,["id"])]),_:2},1032,["class"])]),_:2},1024),s(T,{class:"medication-details"},{default:r(()=>[s(i,{size:"10",class:ve(["ion-text-wrap details-col",e.highLightBnd(f)])},{default:r(()=>[s(v,{class:"details-text"},{default:r(()=>[Y(q(f.dose)+" / "+q(f.frequency)+" / daily / "+q(f.duration)+" / until "+q(f.prescription)+" ",1),_("span",Mn,q(f.route_name),1)]),_:2},1024)]),_:2},1032,["class"]),e.show_actions_buttons?(y(),Q(i,{key:0,class:ve([e.highLightBnd(f),"actions-col"]),size:"2"},{default:r(()=>[s(v,{class:ve(["action-button",e.asignSpanLblID(A)]),onClick:E=>e.editItemAtIndex(A)},{default:r(()=>[s(S,{icon:e.iconsContent.edit},null,8,["icon"])]),_:1},8,["class","onClick"]),s(v,{class:ve(["action-button",e.asignSpanLblID(A)]),onClick:E=>e.removeItemAtIndex(A,E)},{default:r(()=>[s(S,{icon:e.iconsContent.delete},null,8,["icon"])]),_:1},8,["class","onClick"])]),_:2},1032,["class"])):F("",!0)]),_:2},1024)],40,Nn))),128)}const Cs=le(Pn,[["render",Rn],["__scopeId","data-v-01c693a3"]]),Vn={key:0,class:"custom-allergy-container"},xn={class:"button-group"},$n=K({watch:{},name:"AllergiesComponent"}),Fn=K({...$n,setup(e,{expose:a}){const t=jt(),l=_e(),u=Qt(),d=ae(()=>t.selectedMedicalAllergiesList),v=ae(()=>l.patient),i=ae(()=>t.medicalAllergiesList),T=w(b(8,"item-")),S=ae(()=>t.selectedMedicalAllergiesList),f=w(""),A=w(!1),E=[{multi_Selection:!0,show_list_label:!0,unqueId:T.value,name_of_list:"Add/Remove allergies",placeHolder:"Search for an allergy",items:[],listUpdatedFN:D,listFilteredFN:()=>{},searchTextFN:M,use_internal_filter:!0,show_error:w(!1),error_message:"please select a User",disabled:w(!1)}],V=w(!1);pe(async()=>{O()});const O=()=>{t.current_patient.ID!=v.value.ID&&(t.clearSelectedMedicalAllergiesList(),t.setCurrentPatient(v.value))};function D(m){m.forEach(c=>{c.selected==!0&&c.name==="Other"&&(A.value=c.name==="Other"),c.selected==!1&&c.name==="Other"&&B()}),t.setSelectedMedicalAllergiesList(m),G()}async function M(m){const c=m,I=await $.getConceptSet("OPD Medication",c);if(!I)return;I.map(o=>({label:o.name,value:o.name,other:o}));const x=Kt(c),n=Xt(x,I).sort((o,p)=>o.name.localeCompare(p.name));t.setMedicalAllergiesList(n),G()}function G(){const m=i.value;d.value.forEach(I=>{let x=!1;m.forEach((C,n)=>{C.concept_id==I.concept_id&&I.selected===!0&&(m[n]=I,x=!0)}),!x&&I.selected===!0&&m.push(I)});const c=m.filter((I,x,C)=>x===C.findIndex(n=>(n==null?void 0:n.concept_id)===(I==null?void 0:I.concept_id)));t.setMedicalAllergiesList(c)}function b(m=8,c=""){const I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let x=c;for(let C=0;C<m;C++)x+=I.charAt(Math.floor(Math.random()*I.length));return x+="-".concat(Date.now()),x}async function W(m){try{const c=m.trim();if(c){const I={name:c,selected:!0,concept_id:b(8,"12"),concept_name_id:b(8,"34")};t.setMedicalAllergiesList([...i.value,I]),t.setSelectedMedicalAllergiesList(I),A.value=!1,V.value=!0,f.value="";const x=t.findSelectedAllergyByName("Other");t.unselectOther(x)}}catch(c){console.error(c)}}const B=()=>{A.value=!1,f.value="",V.value=!1;const m=t.findSelectedAllergyByName("Other");m&&t.unselectOther(m)};return a({onSubmit:async()=>{try{if(vt.isEmpty(S.value))return;const m=await $.getConceptID("Allergic"),c=S.value.map(I=>({concept_id:m,obs_datetime:U.getSessionDate(),value_coded:I.concept_id,location_id:u.facilityLocation.code,value_text:I.name}));await J.addObsToEncounterPatient(c,te.MEDICAL_HISTORY),Pe("Allergies appended to patient record successfully")}catch(m){me("Failed to save allergies")}}}),(m,c)=>(y(),Q(g(ut),null,{default:r(()=>[s(g(pa),null,{default:r(()=>[s(g(Ae),{class:"header-container"},{default:r(()=>[s(g(Ue),{icon:g(ma),class:"allergy-icon"},null,8,["icon"]),c[3]||(c[3]=_("span",{style:{"font-size":"16px","font-weight":"600"}}," Allergies (Medication, Healthcare items, Environment and Food) ",-1))]),_:1})]),_:1}),s(g(dt),null,{default:r(()=>[s(Jt,{multiSelection:E[0].multi_Selection,show_label:E[0].show_list_label,uniqueId:E[0].unqueId,name_of_list:E[0].name_of_list,choose_place_holder:E[0].placeHolder,"items_-list":i.value,use_internal_filter:E[0].use_internal_filter,disabled:E[0].disabled.value,onItemListUpDated:E[0].listUpdatedFN,onItemListFiltered:E[0].listFilteredFN,onItemSearchText:E[0].searchTextFN},null,8,["multiSelection","show_label","uniqueId","name_of_list","choose_place_holder","items_-list","use_internal_filter","disabled","onItemListUpDated","onItemListFiltered","onItemSearchText"]),A.value?(y(),L("div",Vn,[s(g(He),{modelValue:f.value,"onUpdate:modelValue":c[0]||(c[0]=I=>f.value=I),placeholder:"Please specify the allergy",fill:"outline",class:"custom-input"},null,8,["modelValue"]),_("div",xn,[s(g(Xe),{onClick:c[1]||(c[1]=I=>W(f.value)),class:"addCustomAllergyBtn"},{default:r(()=>[...c[4]||(c[4]=[Y(" Add Allergy ",-1)])]),_:1}),s(g(Xe),{onClick:c[2]||(c[2]=I=>B()),fill:"clear",class:"cancelBtn"},{default:r(()=>[s(g(Ue),{icon:g(gt),slot:"icon-only"},null,8,["icon"])]),_:1})])])):F("",!0)]),_:1})]),_:1}))}}),Is=le(Fn,[["__scopeId","data-v-d63cacc6"]]),zn={class:"checklist-container"},Un=K({watch:{},name:"xxxComponent"}),Gn=K({...Un,setup(e){const a=_e(),t=ae(()=>a.patient),l=Ea(),u=l.items;pe(async()=>{d()});const d=()=>{l.current_patient.ID!=t.value.ID&&(l.clearSelectednonPharmaTherapyStore(),l.setCurrentPatient(t.value))};return Z(()=>t.value,async v=>{}),(v,i)=>(y(),L("div",zn,[(y(!0),L(ue,null,Se(g(u),T=>(y(),Q(g(he),{key:T.id,class:"no-border"},{default:r(()=>[s(g(ct),{id:T.id,modelValue:T.checked,"onUpdate:modelValue":S=>T.checked=S,slot:"start"},null,8,["id","modelValue","onUpdate:modelValue"]),s(g(Ae),{style:{"font-size":"16px","font-weight":"600"}},{default:r(()=>[Y(q(T.label),1)]),_:2},1024)]),_:2},1024))),128))]))}}),Ss=le(Gn,[["__scopeId","data-v-371e920f"]]),Wn=K({components:{IonContent:We,IonHeader:rt,IonItem:he,IonList:Ge,IonMenu:lt,IonTitle:ot,IonToolbar:it,BasicInputField:at,IonDatetime:ha,IonBadge:ga,DateInputField:Ta,DynamicButton:Le},props:{showPeripheral:{type:Boolean,default:!0}},setup(e){const a=xe(),t=w(0),l=ae(()=>a.getDisabledDates()),u=ae(()=>a.getAssignedAppointments()),d=w(),v=ae(()=>e.showPeripheral);return{disabledDates:l,datesCounts:u,appointment_count:t,calendarOutline:va,inputPRDate:d,show_peripheral:v}},data(){return ie(),je(),{iconsContent:ee,date:new Date(U.getSessionDate()),tomorrow:new Date(U.getSessionDate()).getDate()+1,appointment:"",drugRunoutDate:"",nextAppointmentDate:"",minDate:new Date(U.getSessionDate())}},computed:{...fe(ie,["nextAppointment","appointmentCountsCache","currentSelectedNextAppointmentDate"]),...fe(xe,["maximumNumberOfDaysForEachDay","assignedAppointmentsDates"]),...fe(_e,["patient"]),...fe(je,["activeProgram"]),calendarDate(){const e=ie();return e.currentSelectedNextAppointmentDate?z.toStandardHisDisplayFormat(e.currentSelectedNextAppointmentDate):""},runOutDate(){var a;const e=ie();return((a=this.activeProgram)==null?void 0:a.program_id)===14?Ze():e.getAppointmentMedicationRunOutDate()}},watch:{calendarDate:{handler(){this.updateNextAppointment()},deep:!0},"$service.sessionDate":{handler(){this.updateMinDate()},immediate:!0},"patient.ID":{async handler(e,a){e!==a&&(this.cleanCurrentNextAppointmentDate(),this.checkIfSamePatientInContext(),this.clearNextAppointment())}}},async mounted(){this.checkIfSamePatientInContext(),await this.getAppointmentMents(this.runOutDate.date),await aa().loadGlobalProperty(),this.validateAppointmentCountsCache(),await this.preloadAppointmentCounts(),na();const e=U.getUserID(),a=new nt;this.appointment=new Ee(a.getID(),e),this.nextAppointmentDate=this.appointment.date,this.supposedRunOutDate(),window.addEventListener("storage",this.handleStorageChange),Ze()},beforeUnmount(){window.removeEventListener("storage",this.handleStorageChange)},methods:{handleStorageChange(e){e.key==="sessionDate"&&this.updateMinDate()},updateMinDate(){this.date=new Date(U.getSessionDate()),this.minDate=new Date(U.getSessionDate())},updateNextAppointment(){ie().setNextAppointment(this.calendarDate)},async handleDateUpdate(e){e&&(xe().setAssignedAppointmentsDates(e,!0),this.calendarDate=z.toStandardHisDisplayFormat(e),await this.save(),await this.getAppointmentMents(e),await this.updateAppointmentCache(e),ie().setCurrentSelectedNextAppointmentDate(e,this.patient.ID))},async getAppointmentMents(e){if(ta().apiStatus)try{const t=await Ee.getDailyAppointments(z.toStandardHisFormat(e),z.toStandardHisFormat(e));this.appointment_count=t.length}catch(t){}},getCounter(e){const a=z.toStandardHisFormat(e);return this.appointmentCountsCache[a]||""},async save(){if(this.assignedAppointmentsDates.length>0)try{const a=await new Oa().createOfflineAppointment()}catch(e){}},async openCornfirmModal(e){this.calendarDate=z.toStandardHisDisplayFormat(e),await this.getAppointmentMents(e),st(ea,{class:"otherVitalsModal"},!0,{message:"Are you sure you want to add this Appointment?"},{cancel:u=>{},confirm:async u=>{u.detail==!0&&await this.handleDateUpdate(e)}})},async handleInput(e){this.inputPRDate=z.toStandardHisDisplayFormat(e),await this.openCornfirmModal(e)},async supposedRunOutDate(){await Zt.getLastDrugsReceived(this.patient.patientID)},async preloadAppointmentCounts(){try{const e=new Date(U.getSessionDate());e.setDate(1);const a=new Date(U.getSessionDate());a.setMonth(a.getMonth()+2),a.setDate(0);try{const t=await Ee.getDailyAppointments(z.toStandardHisFormat(e),z.toStandardHisFormat(a));if(!t)return;const l=this.filterUniqueAppointments(t),u={};l.forEach(d=>{const v=new Date(d.appointment_date),i=z.toStandardHisFormat(v);u[i]||(u[i]=0),u[i]++}),Object.keys(u).forEach(d=>{this.appointmentCountsCache[d]=u[d]})}catch(t){console.error("Error fetching appointments for date range:",t)}}catch(e){console.error("Error in preload process:",e)}},filterUniqueAppointments(e){const a=new Map;return e.forEach(t=>{const l="".concat(t.given_name,"_").concat(t.family_name,"_").concat(t.birthdate,"_").concat(t.appointment_date);a.has(l)||a.set(l,t)}),Array.from(a.values())},async updateAppointmentCache(e){try{const a=z.toStandardHisFormat(e),t=await Ee.getDailyAppointments(z.toStandardHisFormat(e),z.toStandardHisFormat(e));if(!t)return;this.appointmentCountsCache[a]=t.length}catch(a){console.error("Error updating appointment cache:",a)}},validateAppointmentCountsCache(){ie().checkCurrentLocationIfInContext()},isRunOutDate(e){return!this.runOutDate||!this.runOutDate.date?!1:z.toStandardHisFormat(e)===z.toStandardHisFormat(this.runOutDate.date)},cleanCurrentNextAppointmentDate(){ie().cleanCurrentSelectedNextAppointmentDate()},checkIfSamePatientInContext(){const e=ie();e.current_patient.ID!=this.patient.ID&&(this.cleanCurrentNextAppointmentDate(),e.setCurrentPatient(this.patient))},clearNextAppointment(){ie().clearAppointmentMedicationRunOutDate()}}}),qn={class:"card_content"},Yn={class:"count-badge"},jn={class:"dates_title"},Qn={class:"sub_data"},Kn={class:"dates_title"},Xn={class:"sub_data"},Jn={class:"dates_title"},Zn={class:"sub_data"},es={class:"dates_title"},ts={class:"sub_data"};function as(e,a,t,l,u,d){const v=H("VueDatePicker"),i=H("ion-col"),T=H("DynamicButton"),S=H("ion-item"),f=H("ion-row"),A=H("DateInputField");return y(),L("div",qn,[s(f,null,{default:r(()=>[s(i,{"size-sm":"12","size-md":"12","size-lg":"12","size-xl":"8"},{default:r(()=>[s(v,{class:"calender",onDateUpdate:e.openCornfirmModal,inline:"","auto-apply":"","enable-time-picker":!1,"disabled-dates":e.disabledDates,"min-date":e.minDate,modelValue:e.runOutDate.date,"onUpdate:modelValue":a[0]||(a[0]=E=>e.runOutDate.date=E)},{day:r(({day:E,date:V})=>[(y(),L("p",{key:0,class:ve({"run-out-date":e.isRunOutDate(V)}),style:{"font-weight":"600","font-size":"20px"}},[_("span",null,[Y(q(E),1),_("sup",Yn,q(e.getCounter(V)),1)])],2))]),_:1},8,["onDateUpdate","disabled-dates","min-date","modelValue"])]),_:1}),e.show_peripheral?(y(),Q(i,{key:0},{default:r(()=>[s(S,null,{default:r(()=>[_("div",jn,[a[3]||(a[3]=_("div",null,[Y("Suggested Next Appointment Date "),_("span",{style:{"font-size":"16px"}},"(Medication run out date)")],-1)),_("div",Qn,[Y(q(e.runOutDate.formattedDate||"No run out date available")+" ",1),e.runOutDate.formattedDate?(y(),Q(T,{key:0,onClick:a[1]||(a[1]=E=>e.handleDateUpdate(e.runOutDate.date)),name:"Set Next Appt.",fill:"solid",iconSlot:"icon-only",style:{float:"right"}})):F("",!0)])])]),_:1}),s(S,null,{default:r(()=>[_("div",Kn,[a[4]||(a[4]=_("div",null,"User set appointment date",-1)),_("div",Xn,q(e.calendarDate),1)])]),_:1}),s(S,null,{default:r(()=>[_("div",Jn,[a[5]||(a[5]=_("div",null,"Appointments",-1)),_("div",Zn,q(e.appointment_count),1)])]),_:1}),s(S,null,{default:r(()=>[_("div",es,[a[6]||(a[6]=_("div",null,"Appointment limit (per/day)",-1)),_("div",ts,q(e.appointment_count)+"/"+q(e.maximumNumberOfDaysForEachDay),1)])]),_:1})]),_:1})):F("",!0)]),_:1}),e.show_peripheral?(y(),Q(f,{key:0},{default:r(()=>[s(i,{size:"4"},{default:r(()=>[s(A,{inputHeader:"Preferred Next Appointment Date",bold:"600",fontSize:"17px",placeholderFontSize:"17px",placeholderFontWeight:"600",unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.inputPRDate,eventType:"",minDate:e.minDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":a[2]||(a[2]=E=>e.handleInput(E))},null,8,["icon","inputValue","minDate"])]),_:1})]),_:1})):F("",!0)])}const As=le(Wn,[["render",as],["__scopeId","data-v-4e58e0bc"]]);export{Is as A,Cs as D,bs as I,_t as L,As as N,In as _,Ss as a,qa as b,Sn as i};

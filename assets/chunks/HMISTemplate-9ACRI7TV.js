var b=Object.defineProperty;var w=(o,t,e)=>t in o?b(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var u=(o,t,e)=>w(o,typeof t!="symbol"?t+"":t,e);import{O as S,H as R,t as a}from"./ReportMixin.vue_vue_type_script_lang-DMYHGfm7.js";import{S as c,_}from"../index-D3-FX8uE.js";import{d as D,z as v,H as C,e as I,f as $,l as y}from"./vendor-BthE7zCk.js";class h extends S{constructor(){super();u(this,"regenerate");this.regenerate=!1}setRegenerate(e){this.regenerate=e}requestHMIS15(){return this.getReport("generate_hmis_15_report",{request:"true"})}requestHMIS17(){return this.getReport("generate_hmis_17_report",{request:"true"})}renderResults(e){const r=[];let n=1;for(const[s,d]of Object.entries(e)){const m=[],f=d,i={id:0,name:"",total:0,totalPatientIds:""};i.name=s;let p=0;i.id=n,n+=1;for(const[x,g]of Object.entries(f)){const l=g;l!=null&&(p+=l.length,i.total=p,l.length&&(m.push(...l),i.totalPatientIds=m))}r.push(i)}return r}getCSVString(e){let r="Diseases/Events/Conditions, #,\n";for(const n of e){const s="".concat(n.name,",").concat(n.total,",\n");r+=s}return{CSVString:r}}}const H=D({components:{ReportTable:R},data:function(){return{conditions:[],tableCssTheme:"opd-report-theme",total:" Total ",rows:[],columns:[[a.thTxt(""),a.thTxt("Diseases/Events/Conditions"),a.thTxt("UNVERIFIED"),a.thTxt("VERIFIED")]]}},props:["params","periodDates","quarter","onDrillDown","reportName"],methods:{renderResults(){const t=new h().renderResults(this.params);t.length&&(this.conditions=t,this.rows=this.buildRows(t))},onDownload(o=""){const t=new h;let{CSVString:e}=t.getCSVString(this.conditions);e+="\n          Date Created: ".concat(v().format("DD/MMM/YYYY HH:MM:ss"),"\n          MaHIS Version: ").concat(c.getCoreVersion(),"\n          API Version: ").concat(c.getApiVersion(),"\n          Report Period: ").concat(this.periodDates,"\n          Site: ").concat(c.getLocationName(),"\n          Site UUID: ").concat(c.getSiteUUID());const r=new Blob([e],{type:"text/csv;charset=utf-8;"}),n=navigator;if(n.msSaveBlob)n.msSaveBlob(r,"exportFilename");else{const s=document.createElement("a");s.href=window.URL.createObjectURL(r),s.setAttribute("download","".concat(o,".csv")),document.body.appendChild(s),s.click(),document.body.removeChild(s)}},buildRows(o){const t=[];return o.forEach(e=>{t.push([a.td(e.id,{style:{textAlign:"left"}}),a.td(e.name,{style:{textAlign:"left"}}),this.buildRow(this.total+"("+e.name+")",e.total,e.totalPatientIds),a.td("")])}),t},buildRow(o,t,e){return t>0?a.tdLink(t,async()=>this.onDrillDown(o,e)):a.td(0)}},watch:{params:{immediate:!0,handler(){this.renderResults()}}}}),T={class:"my-table",style:{margin:"auto",width:"95%","margin-top":"3%","margin-bottom":"3%"}};function V(o,t,e,r,n,s){const d=C("report-table");return $(),I("div",T,[y(d,{columns:o.columns,rows:o.rows,config:{tableCssTheme:o.tableCssTheme}},null,8,["columns","rows","config"])])}const q=_(H,[["render",V]]);export{h as H,q as a};

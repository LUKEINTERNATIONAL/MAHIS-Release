import{d as Te,am as _e,b2 as Oe,r as y,a as he,w as ne,e as ae,f as C,k as s,l as a,u as e,bs as Se,J as o,ac as j,ad as Y,bw as F,O as oe,m as q,bu as be,Q as N,K as p,aV as W,dt as H,a5 as z,c as Ie,H as we,p as Ee,d1 as Me,d_ as ke,aj as De,ai as R,a6 as T,a2 as x,ah as Pe,bF as Z,b6 as Re}from"./vendor-Do1wNTJR.js";import{l as xe}from"./lodash-NJiRuGo9.js";import{u as Ve}from"./usePatientProfile-C9a_G02H.js";import Ge from"./WeightHeightChart-DrqYHv3r.js";import{u as ye,b as h,t as ee,_ as Le,l as Be,bp as Ue,S as $e,J as Ye,H as O,P as Fe}from"../index-DK7ddGbV.js";import{N as te}from"./neonatal_service-DSXI8_VZ.js";import{g as ge}from"./admissionWorkflow-C1e4oic-.js";import{I as X}from"./images-142qstiX.js";import"./Registration-1MFJK0jS.js";import"./useSetRegistrationValues-D7sKflMp.js";import"./useLocation-BZMmhlfy.js";import"./vaccines_service-BgOa9qQ3.js";import"./sms_service-BZW-8Vxs.js";import"./EIRreportsStore-CnL9gIOz.js";import"./Export-BJXvCqY9.js";import"./user_role_management-HwR9C51A.js";import"./useNeonatalEnrollmentStore-D2AuqvtG.js";import"./enrollment-DU-PLRUa.js";import"./Outcome-CbamtO0B.js";import"./wardsStore-DL64Ki9G.js";import"./chartjs-CO8SDpjp.js";import"./apexcharts-CCt-rnNp.js";const We={class:"neonatal-home-component"},He={class:"icon-container"},ze={class:"icon-container"},Xe={class:"icon-container"},qe={class:"icon-container"},Ke=Te({__name:"NeonatalCare",setup(Ce){const m=_e(),K=ye(),{patient:f}=Oe(K),_=y(""),A=y(""),b=l=>{const i={discharge:{path:"/neonatal/discharge"},"neonatal-opd":{path:"/neonatal/opd"},"in-patient":{path:"/neonatal/in-patient"},"emergency-triage":{path:"/neonatal/triage",query:{source:"profile"}},"instruction-guides":{path:"/neonatal/guides"},checkpoint:{path:"/neonatal/checkpoint"}}[l];i?m.push({path:i.path,query:i.query}):console.warn("Route not found for: ".concat(l))},d=l=>(l!=null?l:"").trim().toUpperCase(),v=[{encounterType:h.NEONATAL_SIGNS_SYMPTOMS,route:"/neonatal/signs-symptoms",encounterNames:["NEONATAL SIGNS & SYMPTOMS"],title:"Signs & Symptoms"},{encounterType:h.NEONATAL_REVIEW_OF_SYSTEMS,route:"/neonatal/review-of-systems",encounterNames:["NEONATAL REVIEW OF SYSTEMS"],title:"Review of Systems"},{encounterType:h.PHYSICAL_EXAMINATION_BABY,route:"/neonatal/general-examination",encounterNames:["PHYSICAL EXAMINATION BABY","NEONATAL GENERAL EXAMINATION"],title:"General Exam"},{encounterType:h.VITALS,route:"/neonatal/vitals",encounterNames:["VITALS","NEONATAL VITALS"],title:"Vitals"},{encounterType:h.NEONATAL_SYSTEMIC_EXAMINATION,route:"/neonatal/SystemicExamination",encounterNames:["NEONATAL SYSTEMIC EXAMINATION"],title:"Systemic Exam"},{encounterType:h.NEONATAL_ADMISSION_OUTCOMES,route:"/neonatal/admission-outcomes",encounterNames:["NEONATAL ADMISSION OUTCOMES"],title:"Outcomes"}],V=v[0].route,S=v[v.length-1].route,J=l=>{const n=ge(l,v),i=v[n];return i?i.route:S},Q=l=>{const n=ge(l,v),i=v[n];return i?i.title:""},G=async l=>{try{const n=await te.getSavedEncounters(l),i=Array.isArray(n==null?void 0:n.encounters)?n.encounters:[],I=J(i);await m.push(I)}catch(n){console.error("Error determining neonatal admission workflow:",n),ee("Unable to determine next admission step. Starting from Signs & Symptoms."),await m.push(V)}},B=l=>{const n=d("NEONATAL ENROLLMENT");return l.some(i=>d(i)===n)},U=l=>{const n=d("NEONATAL TRIAGE");return l.some(i=>d(i)===n)},$=[{title:"Triage",encounterNames:["NEONATAL TRIAGE"]},{title:"Profiling",encounterNames:["NEONATAL ENROLLMENT"]},{title:"Signs & Symptoms",encounterNames:["NEONATAL SIGNS & SYMPTOMS","NEONATAL SIGNS SYMPTOMS"]},{title:"Review of Systems",encounterNames:["NEONATAL REVIEW OF SYSTEMS"]},{title:"General Exam",encounterNames:["PHYSICAL EXAMINATION BABY","NEONATAL GENERAL EXAMINATION"]},{title:"Vitals",encounterNames:["VITALS","NEONATAL VITALS"]},{title:"Systemic Exam",encounterNames:["NEONATAL SYSTEMIC EXAMINATION"]},{title:"Diagnosis",encounterNames:["DIAGNOSIS","NEONATAL DIAGNOSIS"]},{title:"Investigations",encounterNames:["INVESTIGATION","NEONATAL INVESTIGATION","LAB ORDERS","LAB RESULTS"]},{title:"Treatment",encounterNames:["TREATMENT","NEONATAL TREATMENT PLAN"]},{title:"Outcomes",encounterNames:["NEONATAL ADMISSION OUTCOMES","ADMISSION OUTCOMES"]}],u=async()=>{var l;if(!((l=f.value)!=null&&l.patientID)){_.value="",A.value="";return}try{const n=await te.getSavedEncounters(f.value.patientID),i=Array.isArray(n==null?void 0:n.encounters)?n.encounters:[],I=new Set(i.map(c=>d(c))),M=c=>c.some(r=>I.has(d(r)));let L=null;for(const c of $)if(!M(c.encounterNames)){L=c;break}L?A.value=L.title:A.value="Complete";const k=B(i),D=U(i);if(!k)_.value="Enrollment";else if(!D)_.value="Triage";else{const c=Q(i);_.value=c||"Completed"}}catch(n){console.error("Error loading next encounter badge:",n),_.value="",A.value=""}},w=async()=>{var l;if(!((l=f.value)!=null&&l.patientID)){ee("No patient selected");return}try{const n=await te.getSavedEncounters(f.value.patientID),i=Array.isArray(n==null?void 0:n.encounters)?n.encounters:[],I=new Set(i.map(c=>d(c))),M=c=>c.some(r=>I.has(d(r)));if($.every(c=>M(c.encounterNames))){m.push("/neonatal/checkpoint");return}if(!U(i)){m.push("/neonatal/triage");return}if(!B(i)){m.push("/neonatal/enrollment");return}await G(f.value.patientID)}catch(n){console.error("Error in handleAdmit:",n),ee("Unable to check admission status")}};return he(()=>{u()}),ne(()=>{var l;return(l=f.value)==null?void 0:l.patientID},()=>{u()}),(l,n)=>(C(),ae("div",We,[n[7]||(n[7]=s("div",{class:"section-header"},[s("h2",null,"Activities")],-1)),a(e(Se),null,{default:o(()=>[a(e(j),null,{default:o(()=>[a(e(Y),{size:"6"},{default:o(()=>[a(e(F),{button:"",onClick:w,class:"activity-card admit-card"},{default:o(()=>[A.value?(C(),oe(e(be),{key:0,class:"admit-badge",color:"primary"},{default:o(()=>[N(p(A.value),1)]),_:1})):q("",!0),a(e(W),{class:"card-content"},{default:o(()=>[s("div",He,[a(e(H),{src:e(X).patientProfile.cryBaby,alt:"Admit",class:"activity-icon"},null,8,["src"])]),a(e(z),{class:"card-label"},{default:o(()=>[...n[3]||(n[3]=[s("p",null,"Clinical Review",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(e(Y),{size:"6"},{default:o(()=>[a(e(F),{button:"",onClick:n[0]||(n[0]=i=>b("discharge")),class:"activity-card"},{default:o(()=>[a(e(W),{class:"card-content"},{default:o(()=>[s("div",ze,[a(e(H),{src:e(X).patientProfile.babyTransport,alt:"Discharge",class:"activity-icon"},null,8,["src"])]),a(e(z),{class:"card-label"},{default:o(()=>[...n[4]||(n[4]=[s("p",null,"Discharge",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(e(j),null,{default:o(()=>[a(e(Y),{size:"6"},{default:o(()=>[a(e(F),{button:"",onClick:n[1]||(n[1]=i=>b("in-patient")),class:"activity-card"},{default:o(()=>[a(e(W),{class:"card-content"},{default:o(()=>[s("div",Xe,[a(e(H),{src:e(X).patientProfile.medClinic,alt:"Clinical Review",class:"activity-icon"},null,8,["src"])]),a(e(z),{class:"card-label"},{default:o(()=>[...n[5]||(n[5]=[s("p",null,"In-Patient",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n[8]||(n[8]=s("div",{class:"section-header",style:{"margin-top":"24px"}},[s("h2",null,"Quick Actions")],-1)),a(e(Se),null,{default:o(()=>[a(e(j),null,{default:o(()=>[a(e(Y),{size:"6"},{default:o(()=>[a(e(F),{button:"",onClick:n[2]||(n[2]=i=>b("instruction-guides")),class:"activity-card"},{default:o(()=>[a(e(W),{class:"card-content"},{default:o(()=>[s("div",qe,[a(e(H),{src:e(X).patientProfile.info,alt:"Instruction Guides",class:"activity-icon"},null,8,["src"])]),a(e(z),{class:"card-label"},{default:o(()=>[...n[6]||(n[6]=[s("p",null,"Instruction Guides",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]))}}),Je=Le(Ke,[["__scopeId","data-v-0f9809b1"]]),Qe={class:"profile-container"},je={class:"profile-wrapper"},Ze={class:"demographics-card"},et={class:"profile-content"},tt={class:"avatar-section"},nt={class:"info-section"},at={class:"name-row"},ot={class:"patient-name"},st={class:"name-line"},rt={class:"name-line"},it={class:"meta-row"},lt={key:0,class:"detail-row"},ut={class:"field-value scrollable-address"},ct={class:"detail-row"},dt={class:"field-value"},pt={class:"detail-row"},mt={class:"graphSection"},ft={style:{width:"100%","min-width":"0"}},vt={class:"ion-padding",slot:"content"},Nt=Te({__name:"NeonatalPatientProfile",setup(Ce){const m=_e(),{event:K,popoverOpen:f,openPopover:_,openPIM:A,printVisitSummary:b,printID:d,formatCurrentAddress:v}=Ve(),V=y(!1),S=y(7),J=y([]),Q=y([]),G=y([]),B=Ie(()=>{switch(S.value){case 7:return"Admitted";case 6:return"Discharged";case 3:return"Died";default:return"Unknown"}}),U=Ie(()=>{switch(S.value){case 7:return"status-admitted";case 6:return"status-discharged";case 3:return"status-died";default:return"status-unknown"}}),$=ye(),{patient:u}=Oe($),w=async r=>{S.value=r},l=()=>{var t,E;if(!((E=(t=u.value)==null?void 0:t.personInformation)!=null&&E.birthdate))return!1;const r=O.dateDiffInDays(O.sessionDate(),u.value.personInformation.birthdate);return r>=0&&r<=28},n=()=>{if(!l()){console.warn("[NeonatalPatientProfile] Patient is not a neonate, redirecting to home"),m.push("/home");return}},i=async()=>{try{const r=await Ue.getLabResults(u.value);G.value=(r==null?void 0:r.results)||[]}catch(r){console.error("Error fetching lab results:",r),G.value=[]}},I=async()=>{var r;Q.value=await $e.getJson("/hts_referral_orders",{patient_id:(r=u.value)==null?void 0:r.patientID,filter_by_lab_result:!0})},M=async()=>{var t;const r=await Ye.getObsByEncounterId(h.REFERRAL);J.value=((t=r[0])==null?void 0:t.obs)||[]},L=r=>O.calculateDisplayAge(O.toStandardHisFormat(r)),k=()=>{var r,t,E,P;xe.isEmpty((t=(r=u.value)==null?void 0:r.personInformation)==null?void 0:t.birthdate)||(V.value=O.dateDiffInDays(O.sessionDate(),(P=(E=u.value)==null?void 0:E.personInformation)==null?void 0:P.birthdate)<42)},D=()=>!!new Fe().isUnderFive(),c=()=>{var r,t;return O.toStandardHisDisplayFormat((t=(r=u.value)==null?void 0:r.personInformation)==null?void 0:t.birthdate)};return ne(()=>m.currentRoute.value,async r=>{(r.name=="patientProfile"||r.name=="neonatalPatientProfile")&&u.value.patientID&&n()}),ne(()=>{var r;return(r=u.value)==null?void 0:r.patientID},async(r,t)=>{r&&t!==void 0&&r!==t&&(k(),n(),await i(),await I())}),he(async()=>{k(),n(),await M(),await I(),await i()}),(r,t)=>{var P,se,re,ie,le,ue,ce,de,pe,me,fe,ve,Ne,Ae;const E=we("ion-icon");return C(),ae("div",Qe,[s("div",je,[s("div",Ze,[s("div",et,[s("div",tt,[s("div",{class:Ee(["avatar-box",((se=(P=e(u))==null?void 0:P.personInformation)==null?void 0:se.gender)=="M"?"male-avatar":"female-avatar"])},[a(E,{icon:e(Me),class:"avatar-icon"},null,8,["icon"])],2)]),s("div",nt,[s("div",at,[s("h2",ot,[s("span",st,p((ie=(re=e(u))==null?void 0:re.personInformation)==null?void 0:ie.given_name)+" "+p((ue=(le=e(u))==null?void 0:le.personInformation)==null?void 0:ue.middle_name),1),s("span",rt,p((de=(ce=e(u))==null?void 0:ce.personInformation)==null?void 0:de.family_name),1)]),s("div",{class:"menu-trigger",onClick:t[0]||(t[0]=g=>e(_)(g))},[a(E,{icon:e(ke)},null,8,["icon"])])]),s("div",it,[s("span",null,p(((me=(pe=e(u))==null?void 0:pe.personInformation)==null?void 0:me.gender)=="M"?"Male":"Female"),1),t[9]||(t[9]=s("span",{class:"separator"},"•",-1)),s("span",null,p(L((ve=(fe=e(u))==null?void 0:fe.personInformation)==null?void 0:ve.birthdate))+" old",1),t[10]||(t[10]=s("span",{class:"separator"},"•",-1)),s("span",null,p(c()),1)]),(Ae=(Ne=e(u))==null?void 0:Ne.personInformation)!=null&&Ae.current_district?(C(),ae("div",lt,[t[11]||(t[11]=s("span",{class:"field-label"},"Current Address:",-1)),s("span",ut,p(e(v)(e(u))),1)])):q("",!0),s("div",ct,[t[12]||(t[12]=s("span",{class:"field-label"},"MRN:",-1)),s("span",dt,p(e(u).ID),1)]),s("div",pt,[t[13]||(t[13]=s("span",{class:"field-label"},"Outcome:",-1)),s("span",{class:Ee(["outcome-badge",U.value])},p(B.value),3)])])])]),s("div",mt,[s("div",ft,[D()?(C(),oe(Ge,{key:0,checkUnderSixWeeks:V.value,showHeightWeight:!0},null,8,["checkUnderSixWeeks"])):q("",!0),D()?q("",!0):(C(),oe(Be,{key:1}))])]),a(Je),a(e(Re),{class:"menu-popover","is-open":e(f),"show-backdrop":!1,event:e(K),onDidDismiss:t[8]||(t[8]=g=>f.value=!1)},{default:o(()=>[s("div",null,[a(e(De),{multiple:!0},{default:o(()=>[a(e(R),{value:"first","toggle-icon":"",onClick:t[1]||(t[1]=g=>e(A)())},{default:o(()=>[a(e(T),{slot:"header",color:"light"},{default:o(()=>[a(e(x),null,{default:o(()=>[...t[14]||(t[14]=[N("Update demographics",-1)])]),_:1})]),_:1})]),_:1}),a(e(R),{value:"first","toggle-icon":"",onClick:t[2]||(t[2]=()=>{})},{default:o(()=>[a(e(T),{slot:"header",color:"light"},{default:o(()=>[a(e(x),null,{default:o(()=>[...t[15]||(t[15]=[N("Follow up visits",-1)])]),_:1})]),_:1})]),_:1}),a(e(R),{value:"second","toggle-icon":"",onClick:t[3]||(t[3]=g=>e(b)())},{default:o(()=>[a(e(T),{slot:"header",color:"light"},{default:o(()=>[a(e(x),null,{default:o(()=>[...t[16]||(t[16]=[N("Print visit summary",-1)])]),_:1})]),_:1})]),_:1}),a(e(R),{value:"third","toggle-icon":"",onClick:t[4]||(t[4]=g=>e(d)())},{default:o(()=>[a(e(T),{slot:"header",color:"light"},{default:o(()=>[a(e(x),null,{default:o(()=>[...t[17]||(t[17]=[N("Print client identifier",-1)])]),_:1})]),_:1})]),_:1}),a(e(R),{value:"fourth"},{default:o(()=>[a(e(T),{slot:"header",color:"light"},{default:o(()=>[a(e(x),null,{default:o(()=>[...t[18]||(t[18]=[N("Update outcome",-1)])]),_:1})]),_:1}),s("div",vt,[a(e(Pe),null,{default:o(()=>[a(e(T),null,{default:o(()=>[a(e(Z),{checked:S.value==7,value:"active",onIonChange:t[5]||(t[5]=g=>w(7))},{default:o(()=>[...t[19]||(t[19]=[N(" Active ",-1)])]),_:1},8,["checked"])]),_:1}),a(e(T),null,{default:o(()=>[a(e(Z),{checked:S.value==6,value:"inactive",onIonChange:t[6]||(t[6]=g=>w(6))},{default:o(()=>[...t[20]||(t[20]=[N(" Inactive ",-1)])]),_:1},8,["checked"])]),_:1}),a(e(T),null,{default:o(()=>[a(e(Z),{checked:S.value==3,value:"died",onIonChange:t[7]||(t[7]=g=>w(3))},{default:o(()=>[...t[21]||(t[21]=[N(" Died ",-1)])]),_:1},8,["checked"])]),_:1})]),_:1})])]),_:1})]),_:1})])]),_:1},8,["is-open","event"])])])}}}),Bt=Le(Nt,[["__scopeId","data-v-410d2fd4"]]);export{Bt as default};

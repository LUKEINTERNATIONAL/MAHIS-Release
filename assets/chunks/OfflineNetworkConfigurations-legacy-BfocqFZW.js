System.register(["./vendor-legacy-Bsps4SCm.js","../index-legacy-BIZtHDNd.js","./useNetworkConfig-legacy-BvLlKAjL.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-DDz6mLj4.js"],function(e,a){"use strict";var o,t,n,r,i,l,s,c,d,u,f,g,p,v,b,m,h,x,y,w,C,k,_,S,P,z,T,D,F,N,U,$,j,A,I,B,O,q,E,H,L;return{setters:[e=>{o=e.d,t=e.aV,n=e.c,r=e.r,i=e.cn,l=e.d2,s=e.cl,c=e.a,d=e.O,u=e.f,f=e.J,g=e.e,p=e.m,v=e.l,b=e.k,m=e.u,h=e.bx,x=e.a3,y=e.bq,w=e.p,C=e.L,k=e.K,_=e.cj,S=e.a4,P=e.a5,z=e.Q,T=e.ck,D=e.N,F=e.ed,N=e.a6,U=e.U},e=>{$=e.a1,j=e.aB,A=e.aC,I=e.T,B=e.aD,O=e.G,q=e.s,E=e.S,H=e._},e=>{L=e.u},null,null],execute:function(){var a=l.createElement("style");a.textContent=".spinner-overlay[data-v-e5323f06]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999}.loading-text[data-v-e5323f06]{color:#fff;margin-top:16px;font-size:1.1rem}.positionCenter[data-v-e5323f06]{width:100%;margin-top:20px;display:flex;justify-content:center;align-items:center}.registration_ion_card[data-v-e5323f06]{width:100%;max-width:1000px}.card_content[data-v-e5323f06]{padding:0}.card_header_main[data-v-e5323f06]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;flex-wrap:wrap;gap:12px}.card_hearder[data-v-e5323f06]{font-weight:700;font-size:24px;margin:0 0 12px;color:#2c3e50}.config-source-badge[data-v-e5323f06]{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:20px;font-size:.85rem;font-weight:600}.config-source-badge.source-global[data-v-e5323f06]{background:#e3f2fd;color:#1976d2}.config-source-badge.source-local[data-v-e5323f06]{background:#fff3e0;color:#f57c00}.super-user-badge[data-v-e5323f06]{display:flex;align-items:center;gap:6px;padding:8px 16px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:20px;font-weight:600;font-size:.9rem}.info-banner[data-v-e5323f06]{display:flex;align-items:flex-start;gap:12px;padding:16px;border-radius:12px;margin-bottom:20px}.info-banner.success[data-v-e5323f06]{background:#e8f5e8;color:#2e7d32;border-left:4px solid #4caf50}.info-banner.warning[data-v-e5323f06]{background:#fff3e0;color:#ef6c00;border-left:4px solid #ff9800}.info-banner ion-icon[data-v-e5323f06]{font-size:1.5rem;flex-shrink:0;margin-top:2px}.info-banner strong[data-v-e5323f06]{display:block;margin-bottom:4px;font-size:1rem}.info-banner p[data-v-e5323f06]{margin:0;font-size:.9rem;line-height:1.5}.card-header[data-v-e5323f06]{margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid #f5f5f5}.card-header p[data-v-e5323f06]{margin:0;color:#6c757d;font-size:.95rem}.connection-status-section[data-v-e5323f06]{margin:20px 0}.connection-result[data-v-e5323f06]{padding:16px;border-radius:8px;border:1px solid}.connection-result.available[data-v-e5323f06]{background:#e8f5e8;border-color:#4caf50;color:#2e7d32}.connection-result.error[data-v-e5323f06]{background:#ffebee;border-color:#f44336;color:#c62828}.status-indicator[data-v-e5323f06]{display:flex;align-items:center;gap:8px;font-weight:600;margin-bottom:4px}.status-indicator ion-icon[data-v-e5323f06]{font-size:1.2rem}.timestamp[data-v-e5323f06]{font-size:.9rem;color:#6c757d;font-weight:500}.action-buttons[data-v-e5323f06]{display:flex;flex-direction:column;gap:12px;margin-top:24px}.action-buttons ion-button[data-v-e5323f06]{height:48px;font-weight:600;text-transform:none}.primary-btn[data-v-e5323f06]{--background: #42b983}.secondary-btn[data-v-e5323f06]{--border-color: #42b983;--color: #42b983}.super-user-btn[data-v-e5323f06]{--background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)}.help-text[data-v-e5323f06]{display:flex;align-items:flex-start;gap:10px;margin-top:16px;padding:12px;background:#f8f9fa;border-radius:8px;border-left:3px solid #667eea}.help-text ion-icon[data-v-e5323f06]{color:#667eea;font-size:1.2rem;flex-shrink:0;margin-top:2px}.help-text p[data-v-e5323f06]{margin:0;font-size:.9rem;color:#495057;line-height:1.5}@media(max-width:768px){.action-buttons[data-v-e5323f06]{flex-direction:column}.card_content[data-v-e5323f06]{padding:10px}.card_header_main[data-v-e5323f06]{flex-direction:column;align-items:flex-start}}\n/*$vite$:1*/",l.head.appendChild(a);const J={key:0,class:"spinner-overlay"},G={class:"positionCenter"},R={class:"card_content"},V={class:"card_header_main"},K={key:0,class:"connection-status-section"},Q={class:"status-indicator"},W={key:0,class:"timestamp"},Y={class:"action-buttons"},M={key:0,style:{"font-size":"0.8rem","margin-left":"8px"}},X={class:"help-text"},Z="network_last_test_result";e("default",H(o({__name:"OfflineNetworkConfigurations",setup(e){const a=$(),{config:o,isConfigured:H}=t(a),ee=n(()=>o.value.configSource),ae=r(!1),oe=r(!1),te=r(null),ne=r(null);r(!0);const re=r(null),ie=r("none"),le=L(),{formRef:se,getFormValues:ce}=j();n(()=>a.config);const de=n(()=>[{componentType:"inputField",header:"Username",name:"couchdbUsername",value:o.value.couchdbUsername,validation:A.required,grid:{s:"6"}},{componentType:"inputField",header:"Password",name:"couchdbPassword",type:"password",value:o.value.couchdbPassword,validation:A.required,grid:{s:"6"}},{componentType:"inputField",header:"IP Address",name:"couchdbHost",value:o.value.couchdbHost,validation:A.required,grid:{s:"6"}},{componentType:"inputField",header:"Port Number",name:"couchdbPort",value:o.value.couchdbPort,validation:A.required,grid:{s:"6"}},{componentType:"Heading",name:"Protocol",grid:{s:"4"}},{componentType:"radioButtonField",name:"couchdbProtocol",validation:A.required,type:"inline",grid:{s:"6"},value:o.value.couchdbProtocol,options:[{label:"https",value:"https"},{label:"http",value:"http"}]}]),ue=n(()=>{const e=ee.value||ie.value;return"global_property"===e?"source-global":"local_storage"===e?"source-local":""}),fe=n(()=>{const e=ee.value||ie.value;return"global_property"===e?i:"local_storage"===e?l:s}),ge=n(()=>{const e=ee.value||ie.value;return"global_property"===e?"Using Facility Default Configuration":"local_storage"===e?"Using Local Configuration":"No Configuration"}),pe=n(()=>re.value?re.value.success?"global_property"===re.value.source?"Configuration loaded from facility settings. You can use these settings or modify them.":"Configuration loaded from your local storage.":"Please configure your network settings below.":""),ve=async()=>{oe.value=!0,te.value=null,ne.value=null;try{const e=ce(),{couchdbUsername:a,couchdbPassword:o,couchdbHost:t,couchdbPort:n,couchdbProtocol:r}=e;if(!(a&&o&&t&&r))throw new Error("Please fill in all required fields");const i=a.trim(),l=o.trim(),s=t.trim(),c=r.trim(),d=btoa(`${i}:${l}`),u=`${c}://${s}${n?`:${n}`:""}`;console.log("Testing connection to:",u);const f=await fetch(`${u}/`,{method:"GET",headers:{Authorization:`Basic ${d}`,"Content-Type":"application/json"},signal:AbortSignal.timeout(1e4)});if(!f.ok){let e="Connection failed";switch(f.status){case 401:e="Authentication failed - Invalid username or password";break;case 403:e="Access forbidden - Check user permissions";break;case 404:e="CouchDB server not found at this address";break;case 500:e="CouchDB server error";break;default:e=`Connection failed with status: ${f.status}`}throw new Error(e)}{const e=await f.json();if("Welcome"!==e.couchdb)throw new Error("Server responded but is not CouchDB");te.value="available",ne.value=(new Date).toLocaleString(),localStorage.setItem(Z,JSON.stringify({status:"available",timestamp:ne.value,version:e.version})),O(`Connected successfully! CouchDB version: ${e.version}`,3e3)}}catch(e){console.error("Connection test failed:",e),te.value="error",ne.value=(new Date).toLocaleString(),localStorage.setItem(Z,JSON.stringify({status:"error",timestamp:ne.value,error:e.message})),"AbortError"===e.name||"TimeoutError"===e.name?q("Connection timeout - Check your network and server address",5e3):e.message.includes("fetch")?q("Network error - Cannot reach the server",5e3):q(e.message,5e3)}finally{oe.value=!1}},be=async()=>{const e=await U.create({header:"Save as Facility Default",message:"This will save the configuration for all users at this facility. Other users will automatically use these settings when they log in. Continue?",buttons:[{text:"Cancel",role:"cancel"},{text:"Save for All Users",handler:async()=>{ae.value=!0;try{const e=ce(),o={couchdbUsername:e.couchdbUsername,couchdbPassword:e.couchdbPassword,couchdbHost:e.couchdbHost,couchdbPort:e.couchdbPort||"",couchdbProtocol:e.couchdbProtocol,locationId:E.getUserLocationId(),facilityName:"",configuredBy:E.getUserName(),configuredAt:(new Date).toISOString(),configSource:"global_property"};await le.saveAsGlobalProperty(o)&&(a.setConfig(o),ie.value="global_property")}catch(e){console.error("Save error:",e),q("Failed to save facility configuration",3e3)}finally{ae.value=!1}}}]});await e.present()};return c(async()=>{if((()=>{const e=localStorage.getItem(Z);if(e)try{const a=JSON.parse(e);te.value=a.status,ne.value=a.timestamp}catch(a){console.error("Failed to parse last test result:",a)}})(),a.isConfigured)return console.log("Configuration already in store"),ie.value=ee.value||"local_storage",void(re.value={success:!0,source:ee.value});const e=await le.autoDiscoverConfig();re.value=e,e.success&&e.config?(a.setConfig({...e.config,configSource:e.source}),ie.value=e.source):ie.value=le.getConfigSource()}),(e,a)=>(u(),d(m(N),{class:w({loading:ae.value})},{default:f(()=>[ae.value?(u(),g("div",J,[v(m(h),{name:"bubbles"}),a[0]||(a[0]=b("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),v(I),v(m(x),{fullscreen:!0},{default:f(()=>[b("div",G,[v(m(y),{class:"registration_ion_card"},{default:f(()=>[b("div",R,[b("div",V,[b("div",null,[a[1]||(a[1]=b("h2",{class:"card_hearder"},"Set Offline Network Configurations",-1)),"none"!==ie.value?(u(),g("div",{key:0,class:w(["config-source-badge",ue.value])},[v(m(C),{icon:fe.value},null,8,["icon"]),b("span",null,k(ge.value),1)],2)):p("",!0)])]),re.value?(u(),g("div",{key:0,class:w(["info-banner",re.value.success?"success":"warning"])},[v(m(C),{icon:re.value.success?m(_):m(s)},null,8,["icon"]),b("div",null,[b("strong",null,k(re.value.success?"Configuration Found!":"No Configuration Found"),1),b("p",null,k(pe.value),1)])],2)):p("",!0),v(m(S),null,{default:f(()=>[v(m(P),{size:"12"},{default:f(()=>[b("div",null,[v(B,{formData:de.value,ref_key:"formRef",ref:se},null,8,["formData"]),te.value?(u(),g("div",K,[b("div",{class:w(["connection-result",te.value])},[b("div",Q,[v(m(C),{icon:"available"===te.value?m(_):m(T)},null,8,["icon"]),z(" "+k("available"===te.value?"Connection Successful":"Connection Failed"),1)]),ne.value?(u(),g("div",W,k(ne.value),1)):p("",!0)],2)])):p("",!0),b("div",Y,[v(m(D),{onClick:ve,disabled:oe.value,class:"primary-btn",expand:"block",fill:"solid"},{default:f(()=>[z(k(oe.value?"Testing Connection...":"Test Connection"),1)]),_:1},8,["disabled"]),v(m(D),{onClick:be,class:"super-user-btn",expand:"block",fill:"solid",disabled:"available"!==te.value},{default:f(()=>[v(m(C),{icon:m(F),slot:"start"},null,8,["icon"]),a[2]||(a[2]=z(" Save as Facility Default ",-1)),"available"!==te.value?(u(),g("span",M," (Test connection first) ")):p("",!0)]),_:1},8,["disabled"])]),b("div",X,[v(m(C),{icon:m(s)},null,8,["icon"]),a[3]||(a[3]=b("p",null," Save this configuration as the facility default for other users to automatically use these settings when they log in. ",-1))])])]),_:1})]),_:1})])]),_:1})])]),_:1})]),_:1},8,["class"]))}}),[["__scopeId","data-v-e5323f06"]]))}}});

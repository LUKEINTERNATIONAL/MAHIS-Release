System.register(["./vendor-legacy-ChYl72f1.js","./nonPharmaTherapyStore-legacy-BGjpb72U.js","../index-legacy-fCduv3Pp.js","./DemographicBar-legacy-RZpKz_aq.js","./OPDOutcome-legacy-CzdCLUKj.js","./NextAppointment-legacy-BnjiT_A-.js","./OPDDiagnosis-legacy-BXbmsLi-.js","./OPDPrintingModal-legacy-Dygz-C35.js","./ClientUtils-legacy-oCy3VGsg.js","./usePatientProfile-legacy-BpJFMlcO.js","./useUserActivities-legacy-eQuxRCF_.js","./lodash-legacy-pOOc9Efu.js","./drug_prescription_service-legacy-BxxBmyVc.js","./patient_diagnosis_service-legacy-C4BOBXCy.js","./apexcharts-legacy-D41zp1db.js","./LevelOfConsciousness.vue_vue_type_script_setup_true_lang-legacy-CxlNKMjo.js","./previousComplaints-legacy-O8AePzV1.js","./patient_complaints_service-legacy-KcDTzcaz.js","./DashBox-legacy-CetnUXZO.js","./BasicForm-legacy-DcmhpoZC.js","./DateInputField-legacy-Pmuas-qy.js","./formatServerData-legacy-BqC53A6i.js","./Outcome-legacy-IrwmuX3q.js","./wardsStore-legacy-DNoloCxh.js","./LabOrdersList-legacy-h4Oxp_98.js","./group_validation-legacy-BdjD3kDs.js","./RadiologyStore-legacy-D_G915om.js","./user_role_management-legacy-C8U8jV7r.js","./ncd_appointment_service-legacy-D04xBPjp.js","./Registration-legacy-DTVI5GFH.js","./useLocation-legacy-D5qm-Q24.js","./vaccines_service-legacy-Dl0Iv0Rz.js","./sms_service-legacy-DckX0E8S.js","./EIRreportsStore-legacy-DjZU5rSb.js","./Export-legacy-D7EhCICi.js","./useNeonatalEnrollmentStore-legacy-g7zlZ9Jd.js","./enrollment-legacy-BWFKsMdA.js"],function(e,t){"use strict";var a,n,l,i,s,o,u,r,c,d,v,g,m,p,y,f,h,w,b,P,D,_,j,x,O,C,S,I,T,A,k,N,L,F,R,E,B,M,H,W,z,U,V,Y,G,J,$,q,X,Z,K,Q,ee,te,ae,ne,le,ie,se,oe,ue,re,ce,de;return{setters:[e=>{a=e.d,n=e.ap,l=e.cp,i=e.r,s=e.c,o=e.b2,u=e.a,r=e.w,c=e.O,d=e.f,v=e.J,g=e.l,m=e.e,p=e.m,y=e.k,f=e.u,h=e.V,w=e.dz,b=e.a4,P=e.i,D=e.bM,_=e.v,j=e.a7,x=e.eG,O=e.ba},e=>{C=e.u,S=e._,I=e.d,T=e.a},e=>{A=e.u,k=e.aK,N=e.bV,L=e.aM,F=e.d,R=e.aO,E=e.b7,B=e.bE,M=e.bp,H=e.T,W=e.J,z=e.G,U=e.s,V=e.ag,Y=e.aU,G=e.H,J=e.aP,$=e.aR,q=e.bZ,X=e.bH,Z=e.q,K=e.t,Q=e.n,ee=e._},e=>{te=e.D},e=>{ae=e.C,ne=e.b,le=e.O},e=>{ie=e.I,se=e.N},e=>{oe=e.O},e=>{ue=e.O},e=>{re=e.p},e=>{ce=e.u},e=>{de=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent=".disabled[data-v-d7d4c5f1]{color:red}.spinner-overlay[data-v-d7d4c5f1]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-d7d4c5f1]{width:80px;height:80px}.loading-text[data-v-d7d4c5f1]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-d7d4c5f1]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-d7d4c5f1]{pointer-events:none}.back_profile[data-v-d7d4c5f1]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(t);const ve={key:0,class:"spinner-overlay"},ge={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},me={class:"back_profile"};e("default",ee(a({__name:"ConsultationPlan",setup(e){const{currentTabIndex:t}=C(),{printVisitSummary:a}=ce(),{hasWaitingList:ee}=de(),pe=n(),ye=l(),fe=i(!1),he=i(!0),we=i(!1),be=i(!1),Pe=i(!0),De=i(!1),_e=i(!1),je=i(!1),xe=A(),Oe=k(),Ce=N(),Se=L(),Ie=F(),Te=R(),Ae=E(),ke=B(),Ne=M(),Le=i(!1),Fe=i(!1),Re=s(()=>({text:Fe.value?"Saving...":"Finish",icon:Fe.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:Le.value||Fe.value})),{patient:Ee}=o(xe),{investigations:Be}=o(Oe),{OPDdiagnosis:Me}=o(Ce),{selectedMedicalDrugsList:He}=o(Se),{OPDActivities:We}=o(Ie),{outcomes:ze}=o(Te),{currentSelectedNextAppointmentDate:Ue}=o(ke),{presentingComplaints:Ve}=o(Ne),{vitals:Ye}=o(Ae),Ge=i(null),Je=i(null),$e=i(null),qe=i(null),Xe=i(null),Ze=i(null),Ke=i(null),Qe=i(),et=()=>We.value.map(e=>({title:e,icon:""})),tt=async(e,a,n)=>{var l;0===a&&await ut(),await it()&&(await st(),e%1==0&&(t.value=e),Ke.value&&n&&Ke.value.changeTab(e),"Investigations"===(null===(l=Qe.value[e])||void 0===l?void 0:l.title)&&Je.value&&await Je.value.openAHDModal())},at=()=>{var e;if(!Qe.value||0===Qe.value.length)return null;const a=t.value>=0&&t.value<Qe.value.length?t.value:0;switch(null===(e=Qe.value[a])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(We.value.length>0)switch(We.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},nt=async()=>{be.value=!0,z("Printing consultation summary... Please wait.");try{await a(),z("Consultation summary printed successfully!"),setTimeout(()=>{pe.push("home")},3500)}catch(e){U("Failed to print consultation summary.")}finally{be.value=!1}},lt=()=>{z("Patient has finished consultation!"),pe.push("home")},it=async()=>{const e=await V.getObsByEncounterIdAndDate(Y.PRESENTING_COMPLAINTS);return!!(e&&e.length>0)},st=async()=>{const e=G.sessionDate();for(let a=0;a<Qe.value.length;a++)if(await it()){he.value=!0,we.value=!1;const n=Qe.value[a];if("Clinical Assessment"===n.title){const t=J("presentingComplaints");Qe.value[a].icon=ot(e,t)?O:""}else if("Investigations"===n.title){var t;const n=null===(t=Ee.value)||void 0===t||null===(t=t.labOrders)||void 0===t?void 0:t.saved,l=null==n?void 0:n.filter(t=>G.toStandardHisFormat(e)===G.toStandardHisFormat(t.order_date));Qe.value[a].icon=(null==l?void 0:l.length)>0?O:""}else if("Diagnosis"===n.title){const t=J("diagnosis");Qe.value[a].icon=ot(e,t)?O:""}else if("Treatment Plan"===n.title){const e=J("treatment");Qe.value[a].icon=(null==e?void 0:e.length)>0?O:""}else if("Next Appointment"===n.title){const t=J("appointments");Qe.value[a].icon=ot(e,t)?O:""}else if("Outcome"===n.title){const e=J("outcomes");Qe.value[a].icon=(null==e?void 0:e.length)>0?O:""}}else he.value=!1,"Clinical Assessment"!==Qe.value[a].title&&(Qe.value[a].icon=x);mt()},ot=(e,t)=>{if(!t)return!1;const a=new Date(e);return a.setHours(0,0,0,0),t.some(e=>{const t=new Date(e.obs_datetime||e.order_date);return t.setHours(0,0,0,0),t.getTime()===a.getTime()})},ut=async()=>{fe.value=!0;try{var e;await Promise.all([null===(e=Ge.value)||void 0===e?void 0:e.onSubmit()]),await $(Ee.value),q()}catch(t){throw U("Failed to save clinical assessment"),t}finally{fe.value=!1}},rt=async()=>{try{var e;Fe.value=!0,await(null===(e=$e.value)||void 0===e?void 0:e.onSubmit()),await(async()=>{try{const e=await I();Ee.value={...Ee.value,...e},await T().saveNonPharmaTherapyPatientData()}catch{K("Failed to save treatment plan")}})(),await Te.saveOutcomPatientData(),await $(Ee.value);const t=localStorage.getItem("locationID");if(!t)return void U("Location ID missing.");const a=(()=>{const e=He.value;return console.log("Checking prescribed medications:",{medicationsCount:e.length,medications:e}),e.length>0})();if(ee("Waiting for Laboratory"))return await dt(t),void z("Patient moved to Consultation for Lab follow-up.");if(a&&ee("Waiting for Consultation"))return void(ee("Waiting for Dispensation")?await ct(t):await vt(t));if(!a&&ee("Waiting for Consultation"))return void(await gt(t))}catch(t){U("Failed to save consultation.")}finally{Fe.value=!1}},ct=async e=>{try{await X.addPatientToStage(Ee.value,"DISPENSATION"),await Z().refresh(e),Se.clearSelectedMedicalDrugsList(),z("Patient moved to Dispensation."),pe.push("home")}catch(t){throw U("Failed to move patient to dispensation"),t}},dt=async e=>{try{await X.addPatientToStage(Ee.value,"CONSULTATION"),await Z().refresh(e),Se.clearSelectedMedicalDrugsList(),pe.push("home")}catch(t){throw U("Failed to move patient to consultation"),t}},vt=async e=>{try{await X.addPatientToStage(Ee.value,"DISPENSATION"),await Z().refresh(e),Se.clearSelectedMedicalDrugsList(),K("Patient moved to dispensation queue. You lack access to dispense."),pe.push("home")}catch(t){throw U("Failed to move patient to dispensation"),t}},gt=async e=>{try{await Q(Ee.value),await Z().refresh(e),pe.push("home")}catch(t){console.error("Failed to close visit:",t),U("Failed to close visit.")}};u(async()=>{try{var e;if(0===We.value.length)return void(await pe.push("home"));Qe.value=et(),re.setCurrentPatientID(null===(e=Ee.value)||void 0===e?void 0:e.patientID),await st(),(void 0===t.value||t.value<0)&&(t.value=0),Le.value=!1,mt()}catch(a){console.error("Error: ",a)}}),r(t,async()=>{await mt()}),r(Ye,async()=>{await st()},{deep:!0}),r(Ee,async()=>{var e;await st(),re.setCurrentPatientID(null===(e=Ee.value)||void 0===e?void 0:e.patientID)},{deep:!0}),r(Be,async()=>{await st()},{deep:!0}),r(Me,async()=>{await st()},{deep:!0}),r(He,async()=>{await st()},{deep:!0}),r(ze,async()=>{await st()},{deep:!0}),r(Ue,async()=>{await st()}),r(Ve,async()=>{await st()},{deep:!0}),r(ye,async()=>{Pe.value=!1,Qe.value=et(),setTimeout(()=>{t.value=0,Pe.value=!0},0)},{deep:!0}),r(je,e=>{_e.value=e,_e.value&&setTimeout(()=>{_e.value=!1},15e3)}),r(Re,(e,a)=>{console.log("Done button options changed:",{from:a,to:e,currentStep:t.value,tabsLength:Qe.value.length})},{deep:!0});const mt=()=>{let e=!1;return Fe.value&&(e=!0),Le.value=e,!e};return(e,t)=>(d(),c(f(j),null,{default:v(()=>[g(ue,{onYes:nt,onNo:lt,isOpen:De.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),fe.value?(d(),m("div",ve,[g(f(h),{name:"bubbles"}),t[3]||(t[3]=y("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),g(f(w),{"is-open":be.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),g(H),g(f(b),{fullscreen:!0},{default:v(()=>[g(te),y("div",ge,[Pe.value?(d(),c(S,{key:0,ref_key:"wizard",ref:Ke,headingTitle:"Consultation Plan","vertical-tabs":"","navigable-tabs":he.value,"scrollable-tabs":"",startIndex:0,doneButton:Re.value,nextButton:{disabled:we.value},"custom-tabs":Qe.value,tabs:Qe.value,onChange:tt,"onComplete:wizard":t[2]||(t[2]=e=>rt())},{default:v(()=>[y("div",null,[y("div",me,[g(W,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:f(D),"font-weight":"600",onClick:t[0]||(t[0]=e=>{pe.push("home")})},null,8,["icon"]),g(W,{name:"Back to Profile",iconSlot:"start",fill:"clear",icon:f(D),"font-weight":"600",onClick:t[1]||(t[1]=e=>{pe.push("patientProfile")}),style:{"margin-left":"15px"}},null,8,["icon"])])]),P(y("div",null,[g(ae,{ref_key:"clinicalAssessmentRef",ref:Ge},null,512)],512),[[_,"ClinicalAssessment"===at()]]),P(y("div",null,[g(ie,{ref_key:"investigationsRef",ref:Je},null,512)],512),[[_,"Investigations"===at()]]),P(y("div",null,[g(oe,{ref_key:"diagnosisRef",ref:$e},null,512)],512),[[_,"OPDDiagnosis"===at()]]),P(y("div",null,[g(ne,{ref_key:"treatmentPlanRef",ref:qe},null,512)],512),[[_,"OPDTreatmentPlan"===at()]]),P(y("div",null,[g(se,{ref_key:"nextAppointmentRef",ref:Xe},null,512)],512),[[_,"NextAppointment"===at()]]),P(y("div",null,[g(le,{ref_key:"outcomeRef",ref:Ze},null,512)],512),[[_,"Outcome"===at()]])]),_:1},8,["navigable-tabs","doneButton","nextButton","custom-tabs","tabs"])):p("",!0)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-d7d4c5f1"]]))}}});

System.register(["./vendor-legacy-h4cyiMXU.js","../index-legacy-CKWeKl88.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-CRcfwVwU.js"],function(e,a){"use strict";var t,o,r,n,i,c,s,d,l,u,f,p,g,h,b,m,v,x,y,w,$,_,C,k,P,S,T,z,U,j,F,N,A,E,D;return{setters:[e=>{t=e.d,o=e.r,r=e.c,n=e.a,i=e.O,c=e.f,s=e.J,d=e.e,l=e.m,u=e.l,f=e.k,p=e.u,g=e.a0,h=e.ab,b=e.ac,m=e.ad,v=e.p,x=e.Q,y=e.L,w=e.cl,$=e.cm,_=e.K,C=e.N,k=e.ae,P=e.U},e=>{S=e.Q,T=e.y,z=e.x,U=e.T,j=e.z,F=e.F,N=e.w,A=e.S,E=e.aM,D=e._},null,null],execute:function(){var a=document.createElement("style");a.textContent=".spinner-overlay[data-v-67d0a193]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999}.loading-text[data-v-67d0a193]{color:#fff;margin-top:16px;font-size:1.1rem}.positionCenter[data-v-67d0a193]{width:100%;margin-top:20px;display:flex;justify-content:center;align-items:center}.registration_ion_card[data-v-67d0a193]{width:100%}._card_content[data-v-67d0a193]{max-width:700px;padding:0}.card_header_main[data-v-67d0a193]{display:flex;justify-content:center;align-items:flex-start;margin-bottom:20px;flex-wrap:wrap;gap:12px}.card_hearder[data-v-67d0a193]{font-weight:700;font-size:24px;margin:0 0 12px;color:#2c3e50}.config-source-badge[data-v-67d0a193]{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:20px;font-size:.85rem;font-weight:600}.config-source-badge.source-global[data-v-67d0a193]{background:#e3f2fd;color:#1976d2}.config-source-badge.source-local[data-v-67d0a193]{background:#fff3e0;color:#f57c00}.super-user-badge[data-v-67d0a193]{display:flex;align-items:center;gap:6px;padding:8px 16px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:20px;font-weight:600;font-size:.9rem}.info-banner[data-v-67d0a193]{display:flex;align-items:flex-start;gap:12px;padding:16px;border-radius:12px;margin-bottom:20px}.info-banner.success[data-v-67d0a193]{background:#e8f5e8;color:#2e7d32;border-left:4px solid #4caf50}.info-banner.warning[data-v-67d0a193]{background:#fff3e0;color:#ef6c00;border-left:4px solid #ff9800}.info-banner ion-icon[data-v-67d0a193]{font-size:1.5rem;flex-shrink:0;margin-top:2px}.info-banner strong[data-v-67d0a193]{display:block;margin-bottom:4px;font-size:1rem}.info-banner p[data-v-67d0a193]{margin:0;font-size:.9rem;line-height:1.5}.card-header[data-v-67d0a193]{margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid #f5f5f5}.card-header p[data-v-67d0a193]{margin:0;color:#6c757d;font-size:.95rem}.connection-status-section[data-v-67d0a193]{margin:20px 0}.connection-result[data-v-67d0a193]{padding:16px;border-radius:8px;border:1px solid}.connection-result.available[data-v-67d0a193]{background:#e8f5e8;border-color:#4caf50;color:#2e7d32}.connection-result.error[data-v-67d0a193]{background:#ffebee;border-color:#f44336;color:#c62828}.status-indicator[data-v-67d0a193]{display:flex;align-items:center;gap:8px;font-weight:600;margin-bottom:4px}.status-indicator ion-icon[data-v-67d0a193]{font-size:1.2rem}.timestamp[data-v-67d0a193]{font-size:.9rem;color:#6c757d;font-weight:500}.action-buttons[data-v-67d0a193]{display:flex;flex-direction:column;gap:12px;max-width:300px;margin:0 auto}.action-buttons ion-button[data-v-67d0a193]{height:48px;font-weight:600;text-transform:none}.primary-btn[data-v-67d0a193]{--background: #42b983}.secondary-btn[data-v-67d0a193]{--border-color: #42b983;--color: #42b983}.super-user-btn[data-v-67d0a193]{--background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)}.help-text[data-v-67d0a193]{display:flex;align-items:flex-start;gap:10px;margin-top:16px;padding:12px;background:#f8f9fa;border-radius:8px;border-left:3px solid #667eea}.help-text ion-icon[data-v-67d0a193]{color:#667eea;font-size:1.2rem;flex-shrink:0;margin-top:2px}.help-text p[data-v-67d0a193]{margin:0;font-size:.9rem;color:#495057;line-height:1.5}@media(max-width:768px){.action-buttons[data-v-67d0a193]{flex-direction:column}._card_content[data-v-67d0a193]{padding:10px}.card_header_main[data-v-67d0a193]{flex-direction:column;align-items:flex-start}}\n/*$vite$:1*/",document.head.appendChild(a);const H={key:0,class:"spinner-overlay"},I={class:"positionCenter"},B={class:"registration_ion_card"},O={class:"_card_content"},R={key:0,class:"connection-status-section"},L={class:"status-indicator"},J={key:0,class:"timestamp"},q={class:"action-buttons"},G="network_last_test_result";e("default",D(t({__name:"OfflineNetworkConfigurations",setup(e){const a=S(),t=o(a.getFacilityNetworkConfig()),D=o(!1),Q=o(!1),K=o(null),M=o(null),V=E(),{formRef:W,getFormValues:X}=T(),Y=r(()=>{var e,a,o,r,n;return[{componentType:"inputField",header:"Username",name:"couchdbUsername",value:null===(e=t.value)||void 0===e?void 0:e.couchdbUsername,validation:z.required,grid:{s:"6"}},{componentType:"inputField",header:"Password",name:"couchdbPassword",type:"password",value:null===(a=t.value)||void 0===a?void 0:a.couchdbPassword,validation:z.required,grid:{s:"6"}},{componentType:"inputField",header:"IP Address",name:"couchdbHost",value:null===(o=t.value)||void 0===o?void 0:o.couchdbHost,validation:z.required,grid:{s:"6"}},{componentType:"inputField",header:"Port Number",name:"couchdbPort",value:null===(r=t.value)||void 0===r?void 0:r.couchdbPort,validation:z.required,grid:{s:"6"}},{componentType:"Heading",name:"Protocol",grid:{s:"4"}},{componentType:"radioButtonField",name:"couchdbProtocol",validation:z.required,type:"inline",grid:{s:"6"},value:null===(n=t.value)||void 0===n?void 0:n.couchdbProtocol,options:[{label:"https",value:"https"},{label:"http",value:"http"}]}]}),Z=async()=>{Q.value=!0,K.value=null,M.value=null;try{const e=X(),{couchdbUsername:a,couchdbPassword:t,couchdbHost:o,couchdbPort:r,couchdbProtocol:n}=e;if(!(a&&t&&o&&n))throw new Error("Please fill in all required fields");const i=a.trim(),c=t.trim(),s=o.trim(),d=n.trim(),l=btoa(`${i}:${c}`),u=`${d}://${s}${r?`:${r}`:""}`;console.log("Testing connection to:",u);const f=await fetch(`${u}/`,{method:"GET",headers:{Authorization:`Basic ${l}`,"Content-Type":"application/json"},signal:AbortSignal.timeout(1e4)});if(!f.ok){let e="Connection failed";switch(f.status){case 401:e="Authentication failed - Invalid username or password";break;case 403:e="Access forbidden - Check user permissions";break;case 404:e="CouchDB server not found at this address";break;case 500:e="CouchDB server error";break;default:e=`Connection failed with status: ${f.status}`}throw new Error(e)}{const e=await f.json();if("Welcome"!==e.couchdb)throw new Error("Server responded but is not CouchDB");K.value="available",M.value=(new Date).toLocaleString(),localStorage.setItem(G,JSON.stringify({status:"available",timestamp:M.value,version:e.version})),F(`Connected successfully! CouchDB version: ${e.version}`,3e3),await ee()}}catch(e){console.error("Connection test failed:",e),K.value="error",M.value=(new Date).toLocaleString(),localStorage.setItem(G,JSON.stringify({status:"error",timestamp:M.value,error:e.message})),"AbortError"===e.name||"TimeoutError"===e.name?N("Connection timeout - Check your network and server address",5e3):e.message.includes("fetch")?N("Network error - Cannot reach the server",5e3):N(e.message,5e3)}finally{Q.value=!1}},ee=async()=>{const e=await P.create({header:"Save as Facility Default",message:"This will save the configuration for all users at this facility. Other users will automatically use these settings when they log in. Continue?",buttons:[{text:"Cancel",role:"cancel"},{text:"Save for All Users",handler:async()=>{D.value=!0;try{const e=X(),{couchdbHostRemote:t}=A.getCouchdbConfigRemote(),{couchdbHost:o}=A.getCouchdbConfig(),r={couchdbUsername:e.couchdbUsername,couchdbPassword:e.couchdbPassword,couchdbHost:e.couchdbHost,couchdbPort:e.couchdbPort||"",couchdbProtocol:e.couchdbProtocol,locationId:A.getUserLocationId(),facilityName:"",configuredBy:A.getUserName(),configuredAt:(new Date).toISOString(),configSource:"global_property"};await a.setGlobalProperty("facility_network_config",JSON.stringify(r)),V.setConfig(r),t!=o&&await ae(),F("Facility configuration saved successfully",3e3)}catch(e){console.error("Save error:",e),N("Failed to save facility configuration",3e3)}finally{D.value=!1}}}]});await e.present()},ae=async()=>{await(async()=>{const{couchdbUsername:e,couchdbPassword:a,couchdbPort:t,couchdbHost:o,couchdbProtocol:r}=A.getCouchdbConfig();console.log("ðŸš€ ~ ensureReplicatorDatabase ~ couchdbHost:",o);const n=btoa(`${e}:${a}`),i=t?`:${t}`:"";if(404===(await fetch(`${r}://${o}${i}/_replicator`,{method:"HEAD",headers:{Authorization:`Basic ${n}`}})).status){const e=t?`:${t}`:"",a=await fetch(`${r}://${o}${e}/_replicator`,{method:"PUT",headers:{Authorization:`Basic ${n}`,"Content-Type":"application/json"}});if(!a.ok)throw new Error(`Failed to create _replicator database: ${a.status}`);console.log("_replicator database created successfully")}})();const{couchdbUsername:e,couchdbPassword:a,couchdbPort:t,couchdbHost:o,couchdbProtocol:r}=A.getCouchdbConfig(),n=te(),i=btoa(`${e}:${a}`),c=`${r}://${o}${t?`:${t}`:""}/_replicator`,s=n.map(async e=>{try{const a=await fetch(`${c}/${e._id}`,{method:"GET",headers:{Authorization:`Basic ${i}`,"Content-Type":"application/json"}});if(a.ok){const t=await a.json(),o={...e,_rev:t._rev},r=await fetch(`${c}/${e._id}`,{method:"PUT",headers:{Authorization:`Basic ${i}`,"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok)throw new Error(`Failed to update replication job ${e._id}: ${r.status} - ${await r.text()}`);return r.json()}if(404===a.status){const a=await fetch(c,{method:"POST",headers:{Authorization:`Basic ${i}`,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw new Error(`Failed to create replication job ${e._id}: ${a.status} - ${await a.text()}`);return a.json()}throw new Error(`Error checking existing replication ${e._id}: ${a.status} - ${await a.text()}`)}catch(a){throw console.error(`Error processing replication job ${e._id}:`,a),a}});await Promise.all(s)},te=()=>{const{couchdbHostRemote:e,couchdbPortRemote:a,couchdbUsernameRemote:t,couchdbPasswordRemote:o,couchdbProtocolRemote:r}=A.getCouchdbConfigRemote(),{couchdbUsername:n,couchdbPassword:i,couchdbPort:c,couchdbHost:s,couchdbProtocol:d}=A.getCouchdbConfig(),l=[...databaseConfig.liveSyncDatabases,...databaseConfig.periodicSyncDatabases];let u=[];const f=A.getUserLocationId();for(const p of l){const l=c?`:${c}`:"",g=a?`:${a}`:"";let h={_id:`pull_${f}_${p}`,source:`${r}://${t}:${o}@${e}${g}/${p}`,target:`${d}://${n}:${i}@${s}${l}/${p}`,create_target:!0,continuous:!0},b={_id:`push_${f}_${p}`,target:`${r}://${t}:${o}@${e}${g}/${p}`,source:`${d}://${n}:${i}@${s}${l}/${p}`,create_target:!0,continuous:!0};"patients_records"===p&&(h.selector={location_id:A.getUserLocationId()},b.selector={location_id:A.getUserLocationId()}),"dde"===p&&(h.selector={facility_code:A.getUserLocationId()},b.selector={facility_code:A.getUserLocationId()}),u.push(h),u.push(b)}return u};return n(async()=>{(()=>{const e=localStorage.getItem(G);if(e)try{const a=JSON.parse(e);K.value=a.status,M.value=a.timestamp}catch(a){console.error("Failed to parse last test result:",a)}})(),await a.loadFacilityNetworkConfig(),t.value=a.getFacilityNetworkConfig()}),(e,a)=>(c(),i(p(k),{class:v({loading:D.value})},{default:s(()=>[D.value?(c(),d("div",H,[u(p(g),{name:"bubbles"}),a[0]||(a[0]=f("div",{class:"loading-text"},"Please wait...",-1))])):l("",!0),u(U),u(p(h),{fullscreen:!0},{default:s(()=>[f("div",I,[f("div",B,[f("div",O,[a[1]||(a[1]=f("div",{class:"card_header_main"},[f("div",null,[f("h2",{class:"card_hearder"},"Set Offline Network Configurations")])],-1)),u(p(b),null,{default:s(()=>[u(p(m),{size:"12"},{default:s(()=>[f("div",null,[u(j,{formData:Y.value,ref_key:"formRef",ref:W},null,8,["formData"]),K.value?(c(),d("div",R,[f("div",{class:v(["connection-result",K.value])},[f("div",L,[u(p(y),{icon:"available"===K.value?p(w):p($)},null,8,["icon"]),x(" "+_("available"===K.value?"Connection Successful":"Connection Failed"),1)]),M.value?(c(),d("div",J,_(M.value),1)):l("",!0)],2)])):l("",!0),f("div",q,[u(p(C),{onClick:Z,disabled:Q.value,class:"primary-btn",expand:"block",fill:"solid"},{default:s(()=>[x(_(Q.value?"Testing Connection...":"Test And Save Connection"),1)]),_:1},8,["disabled"])])])]),_:1})]),_:1})])])])]),_:1})]),_:1},8,["class"]))}}),[["__scopeId","data-v-67d0a193"]]))}}});

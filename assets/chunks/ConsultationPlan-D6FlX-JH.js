import{d as Ie,aF as Re,cr as xe,r as l,c as Ne,bh as g,w as u,a as Ve,Q,f as U,H as V,l as m,u as A,L as Be,k as f,m as Me,i as h,bU as Fe,v as D,bq as He,a9 as C}from"./vendor-CJ2tyHrn.js";import{ba as j,u as Ee,bb as $e,bc as ze,b2 as Le,bd as We,e as Ge,b3 as Qe,i as Ue,a9 as je,f as qe,T as Je,F as Ke,a2 as Ye,H as B,b5 as k,be as Xe,o as q,J,bf as Ze,t as K,k as Oe,b9 as et,aq as T,K as tt,b as at,G as st,bg as nt,ab as it,S as ot}from"../index-CPIhguZJ.js";import{D as rt}from"./DemographicBar-CMCjh8ca.js";import{D as lt,C as ct,T as ut}from"./TreatmentPlan-DPtio9gL.js";import{I as mt,N as dt,_ as ft,i as vt}from"./NextAppointment-B2xGYVAH.js";import{_ as pt}from"./RiskAssessment.vue_vue_type_script_setup_true_lang-DgZoeOfH.js";import{V as gt}from"./Vitals-B1XSjluv.js";import{u as bt,_ as St}from"./useFormWizard-CAiBa2il.js";import{u as M}from"./ComplicationsStore-Ibxa1dsq.js";import{s as ht,c as Dt,u as Ct}from"./nonPharmaTherapyStore-CAVSqzBF.js";import{l as yt}from"./lodash-NJiRuGo9.js";import{f as Y,a as _t}from"./formatServerData-C4-2caW3.js";import{u as wt}from"./usePatientProfile-Bjyh6yGB.js";import{p as X}from"./ClientUtils-CFfri-Em.js";import"./apexcharts-BtvCa6MI.js";import"./patient_diagnosis_service-DTN-hwjk.js";import"./DashBox-6RT18Q5Q.js";import"./BasicForm-BEa7BD3q.js";import"./DateInputField-BPowwEHU.js";import"./group_validation-Crr58cZF.js";import"./LabOrdersList-DT-nxfOM.js";import"./EnterLabResultsModal-BmOe-JXc.js";import"./useUserActivities-DlNwy1Si.js";import"./RadiologyStore-BdyLHyrH.js";import"./previousComplaints-yArM2eha.js";import"./patient_complaints_service-4HB_6iqv.js";import"./user_role_management-C_d1iPJp.js";import"./ncd_appointment_service-BMjAPhMQ.js";import"./drug_prescription_service-DiJpwuPJ.js";import"./Registration-F5RJpZPr.js";import"./useSetRegistrationValues-CWxNfeBu.js";import"./useLocation-BxHWO3Ky.js";import"./vaccines_service-CFrWoT5a.js";import"./sms_service-ba9KXWCi.js";import"./EIRreportsStore-COMUTdOQ.js";import"./Export-CZmpfP5c.js";import"./useNeonatalEnrollmentStore--u9Qw-om.js";import"./enrollment-DU-PLRUa.js";import"./Outcome-BVD9d5EL.js";import"./wardsStore-DRE4cKPY.js";const At={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},kt={class:"back_profile"},pa=Ie({__name:"ConsultationPlan",setup(Tt,{expose:Z}){const{onTabBeforeChange:O,currentTabIndex:d}=bt(),{printVisitSummary:ee}=wt(),P=Re(),te=xe();l([]),l([]),l(!1);const I=l(!0),R=l(!1),b=l(!1),F=Ne(()=>({text:b.value?"Saving...":"Finish",icon:b.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:R.value||b.value})),ae=j(),se=Ee(),ne=$e(),ie=ze();Le();const oe=We(),y=Ge();Qe();const re=Ue(),le=M(),ce=je(),{patient:o}=g(se),{vitals:ue}=g(ae),{investigations:me}=g(ne),{diagnosis:de}=g(ie),{substance:fe}=g(re),{selectedNCDMedicationList:H}=g(oe),{FootScreening:ve,visualScreening:pe,cvScreening:ge}=g(le),{sessionDate:E}=g(ce),{apiStatus:Pt}=g(qe());l(!1);const be=async()=>{let e=!1;const t=a=>{e=!1},n=async a=>{a.detail==!0&&(e=!0)};return await vt()==!0?await q(et,{class:"otherVitalsModal"},!0,{message:"You can screen the patient for AHD, do you want to proceed?"},{cancel:t,confirm:n}):e=!1,e};u(F,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:d.value,tabsLength:s.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),u(b,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const Se=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},_=()=>{let e=!1;return S(),b.value&&(e=!0),R.value=e,!e},he=()=>{P.push("patientProfile")},x=()=>y.NCDActivities.map(e=>({title:e,icon:""})),s=l(x()),$=l(null),z=l(null),De=l(null),Ce=l(null),ye=l(null),_e=l(null),we=l(null),S=()=>{var n;if(!s.value||s.value.length===0)return console.log("Tabs not yet initialized"),null;const e=d.value>=0&&d.value<s.value.length?d.value:0;switch((n=s.value[e])==null?void 0:n.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(y.NCDActivities.length>0)switch(y.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},N=()=>{I.value=!1,setTimeout(()=>{d.value=0,I.value=!0},0)},L=()=>{const e=j();e.setVitals(e.getInitialVitals(o.value.ID))},v=async()=>{var n,r;const e=Ye(E.value,"sessionDate","value")||B.sessionDate(),t=k("vitals");for(let a=0;a<s.value.length;a++){const c=s.value[a];if(c.title==="Vital Signs")s.value[a].icon=w(e,t)?C:"";else if(c.title==="Risk Assessment"){const i=k("substanceAbuse");s.value[a].icon=w(e,i)?C:""}else if(c.title==="Investigations"){const i=(r=(n=o==null?void 0:o.value)==null?void 0:n.labOrders)==null?void 0:r.saved,p=i==null?void 0:i.filter(G=>B.toStandardHisFormat(e)===B.toStandardHisFormat(G.order_date));s.value[a].icon=(p==null?void 0:p.length)>0?C:""}else if(c.title==="Diagnosis"){const i=k("diagnosis");s.value[a].icon=w(e,i)?C:""}else if(c.title==="Complications Screening"){const i=k("screening");s.value[a].icon=w(e,i)?C:""}else c.title==="Treatment Plan"&&(H.value.length>0?s.value[a].icon=Xe()?C:"":s.value[a].icon="")}_()},w=(e,t)=>{const n=new Date(e);return n.setHours(0,0,0,0),t.some(r=>{const a=new Date(r.obs_datetime);return a.setHours(0,0,0,0),a.getTime()===n.getTime()})},Ae=async()=>{var a,c,i,p;const e=[],t=await Y(pe.value),n=await _t(ve.value),r=await Y(ge.value);t.length>0&&e.push({concept_id:await T.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:T.getSessionDate(),child:t}),n.length>0&&e.push({concept_id:await T.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:T.getSessionDate(),child:n}),r.length>0&&e.push(...r),e.length>0?((p=(i=(c=(a=o.value).screening)!=null?c:a.screening={}).unsaved)!=null||(i.unsaved=[]),await tt.addObsToEncounterPatient(e,at.SCREENING),st("Complications saved successfully")):K("No complications data to save")},ke=async()=>{const e=nt();if(!yt.isEmpty(e.selectedMedicalAllergiesList)){const r=it(),a=e.selectedMedicalAllergiesList.map(i=>({concept_id:i.concept_id,obs_datetime:ot.getSessionDate(),value_coded:i.concept_id,location_id:r.facilityLocation.code,value_text:i.name})),c=await ht(a);o.value=Object.assign(o.value,c),console.log("Allergies staged successfully:",o.value),e.clearSelectedMedicalAllergiesList()}const t=await Dt();o.value=Object.assign(o.value,t);const n=await Ct().saveNonPharmaTherapyPatientData();o.value=Object.assign(o.value,n)},Te=async(e,t)=>{var a,c,i,p;const n=(a=s.value[e])==null?void 0:a.title,r=(c=s.value[t])==null?void 0:c.title;e%1===0&&(d.value=e),r=="Vital Signs"&&((i=$.value)==null||i.onSubmit()),r=="Risk Assessment"&&((p=z.value)==null||p.onSubmit()),r=="Complications Screening"&&await Ae(),r=="Treatment Plan"&&await ke(),n=="Investigations"&&await be()==!0&&await q(ft,{class:"fullScreenModal"},!0,{closeModalOnFinish:!0}),await J(o.value)},W=async()=>{b.value=!0;try{await Ze(),await J(o.value),await Pe(),P.push("patientProfile")}catch(e){console.error("Error saving data:",e),K("Error occurred while saving data. Please try again.")}finally{b.value=!1}},Pe=async()=>{await Oe("Do you want to print a barcode?",{header:"Printer"})==="Confirm"&&await ee()};return Ve(async()=>{var e;try{if(y.NCDActivities.length===0){P.push("patientProfile");return}M().resetScreening(),s.value=x(),X.setCurrentPatientID((e=o.value)==null?void 0:e.patientID),await v(),(d.value===void 0||d.value<0)&&(d.value=0,console.log("Setting initial tab index to 0")),R.value=!1,b.value=!1,_()}catch(t){console.error("Error: ",t)}}),u(d,async()=>{await _()}),u(ue,async()=>{await v()},{deep:!0}),u(o,async()=>{var e;try{M().resetScreening(),X.setCurrentPatientID((e=o.value)==null?void 0:e.patientID),await v()}catch(t){console.error("Error updating patient data: ",t)}},{deep:!0}),u(E,async()=>{await v()},{deep:!0}),u(me,async()=>{await v()},{deep:!0}),u(de,async()=>{await v()},{deep:!0}),u(fe,async()=>{await v()},{deep:!0}),u(H,async()=>{await v()},{deep:!0}),u(te,async e=>{N(),L(),s.value=x()},{deep:!0}),u(o,async(e,t)=>{e.ID!=t.ID&&(N(),L())},{deep:!0}),Z({saveData:W,markWizard:v,refreshWizard:N,validateDoneButtonState:_}),(e,t)=>(U(),Q(A(He),null,{default:V(()=>[m(Je),m(A(Be),{fullscreen:!0},{default:V(()=>[m(rt),f("div",At,[I.value?(U(),Q(St,{key:0,ref:"wizard",headingTitle:"Consultation Plan","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:F.value,"custom-tabs":s.value,beforeChange:A(O),onChange:Te,"onComplete:wizard":t[1]||(t[1]=n=>W()),onDoneButtonChanged:Se},{default:V(()=>[f("div",null,[f("div",kt,[m(Ke,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:A(Fe),"font-weight":"600",onClick:t[0]||(t[0]=n=>he())},null,8,["icon"])])]),h(f("div",null,[m(gt,{ref_key:"vitalsRef",ref:$},null,512)],512),[[D,S()=="Vitals"]]),h(f("div",null,[m(pt,{ref_key:"riskAssessmentRef",ref:z},null,512)],512),[[D,S()=="RiskAssessment"]]),h(f("div",null,[m(mt,{ref_key:"investigationsRef",ref:De},null,512)],512),[[D,S()=="Investigations"]]),h(f("div",null,[m(lt,{ref_key:"diagnosisRef",ref:Ce},null,512)],512),[[D,S()=="DiagnosisComponent"]]),h(f("div",null,[m(ct,{ref_key:"complicationsRef",ref:ye},null,512)],512),[[D,S()=="ComplicationsScreening"]]),h(f("div",null,[m(ut,{ref_key:"treatmentPlanRef",ref:_e},null,512)],512),[[D,S()=="TreatmentPlan"]]),h(f("div",null,[m(dt,{ref_key:"nextAppointmentRef",ref:we},null,512)],512),[[D,S()=="NextAppointment"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Me("",!0)])]),_:1})]),_:1}))}});export{pa as default};

!function(){function e(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}System.register(["./vendor-legacy-Bsps4SCm.js","../index-legacy-ClOtzPja.js","./Img-legacy-BNmikZ_d.js","./userService-legacy-hjbos3y-.js","./useNetworkConfig-legacy-CiWb3UOh.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-DDz6mLj4.js"],function(t,a){"use strict";var o,l,n,r,s,i,u,c,d,f,p,v,m,g,w,h,y,b,P,x,k,A,I,S,_,C,z,U,M,E,N,q,L,j,R,H,D,F,O,$,T,K,B,G,J,Q,W,Y,Z,V,X,ee,te;return{setters:[e=>{o=e.D,l=e.d,n=e.r,r=e.ao,s=e.c,i=e.a,u=e.H,c=e.O,d=e.f,f=e.J,p=e.l,v=e.u,m=e.a3,g=e.k,w=e.bq,h=e.aU,y=e.e,b=e.m,P=e.dn,x=e.E,k=e.Q,A=e.K,I=e.b2,S=e.W,_=e.c$,C=e.bF,z=e.c6,U=e.c5,M=e.N,E=e.bs,N=e.p,q=e.a6},e=>{L=e.a1,j=e.y,R=e.G,H=e.S,D=e.v,F=e.a0,O=e.a2,$=e.t,T=e.U,K=e.a3,B=e.s,G=e.a4,J=e.a5,Q=e.a6,W=e.a,Y=e.a7,Z=e._},e=>{V=e.i},e=>{X=e.p,ee=e.g},e=>{te=e.u},null,null],execute:function(){var a=document.createElement("style");a.textContent='.login-page[data-v-414576a7]{background-color:#fff}.login-container[data-v-414576a7]{display:flex;justify-content:center;align-items:center;text-align:center;height:90vh}.login-title[data-v-414576a7]{font-size:24px;margin-bottom:30px;font-weight:700;margin-top:20px}.input-fields[data-v-414576a7]{margin-bottom:35px}.invalid-input[data-v-414576a7]{--border-color: #ff4444 !important;--color: #ff4444 !important}.password-requirements[data-v-414576a7]{text-align:left;margin-bottom:20px;padding:15px;background-color:#f8f9fa;border-radius:8px;border-left:4px solid #34af4d}.requirements-title[data-v-414576a7]{margin:0 0 10px;font-weight:600;color:#333;font-size:14px}.requirements-list[data-v-414576a7]{margin:0;padding-left:20px;list-style:none}.requirements-list li[data-v-414576a7]{margin-bottom:5px;font-size:13px;color:#666;position:relative}.requirements-list li[data-v-414576a7]:before{content:"✗";color:#f44;font-weight:700;position:absolute;left:-20px}.requirements-list li.valid[data-v-414576a7]:before{content:"✓";color:#34af4d}.requirements-list li.valid[data-v-414576a7]{color:#34af4d}.password-toggle[data-v-414576a7]{cursor:pointer;position:absolute;margin-top:-73px;margin-left:130px;z-index:1000}.login-button[data-v-414576a7]{color:#fff;margin-top:30px}.login-button[data-v-414576a7]:disabled{opacity:.5;cursor:not-allowed}.signup-link[data-v-414576a7]{margin-top:50px}.signup-link a[data-v-414576a7]{text-decoration:underline;color:#34af4d;cursor:pointer}.signup-link a[data-v-414576a7]:hover{color:#2d8f3f}.password-toggle[data-v-414576a7]{font-size:20px}.login_img[data-v-414576a7]{width:90px;margin:auto}ion-card[data-v-414576a7]{min-width:330px}@media(max-width:902px){.login-page[data-v-414576a7]{--ion-background-color: #ffffff}ion-card[data-v-414576a7]{box-shadow:unset}}\n/*$vite$:1*/',document.head.appendChild(a);const ae=o("authStatusStore",{state:()=>({emrAuthenticated:!1,miumAuthenticated:!1,lastLoginAttempt:null,loginTimestamp:null,username:""}),getters:{isPartiallyAuthenticated:e=>e.emrAuthenticated||e.miumAuthenticated,isFullyAuthenticated:e=>e.emrAuthenticated&&e.miumAuthenticated,authenticationStatus:e=>e.emrAuthenticated&&e.miumAuthenticated?"full":e.emrAuthenticated||e.miumAuthenticated?"partial":"none",authenticatedSystems:e=>{const t=[];return e.emrAuthenticated&&t.push("EMR"),e.miumAuthenticated&&t.push("MIUM"),t},failedSystems:e=>{const t=[];return e.emrAuthenticated||t.push("EMR"),e.miumAuthenticated||t.push("MIUM"),t}},actions:{setEMRAuthenticated(e){this.emrAuthenticated=e,e&&(this.loginTimestamp=new Date)},setMIUMAuthenticated(e){this.miumAuthenticated=e},setUsername(e){this.username=e},recordLoginAttempt(){this.lastLoginAttempt=new Date},clearAuthStatus(){this.emrAuthenticated=!1,this.miumAuthenticated=!1,this.loginTimestamp=null,this.lastLoginAttempt=null,this.username=""},hasSystemAccess(e){return"EMR"===e?this.emrAuthenticated:this.miumAuthenticated}},persist:!0});class oe{static async initialize(){if(this.initialized)return!0;try{const e=te(),t=L();j();if(t.isConfigured)return console.log("Network configuration already in store"),this.initialized=!0,!0;if(t.loadFromLocalStorage())return console.log("Network configuration loaded from localStorage to store"),this.initialized=!0,!0;console.log("No local config found, attempting auto-discovery...");const a=await e.autoDiscoverConfig();return a.success&&a.config?(console.log(`Network configuration loaded from ${a.source}`),this.applyConfiguration(a.config),"global_property"===a.source&&R("Network settings loaded automatically from facility configuration",4e3),this.initialized=!0,!0):(console.log("No facility network configuration found, user needs to configure manually"),this.initialized=!0,!1)}catch(e){return console.error("Error during network auto-configuration:",e),this.initialized=!0,!1}}static applyConfiguration(e){L().setConfig({couchdbUsername:e.couchdbUsername,couchdbPassword:e.couchdbPassword,couchdbHost:e.couchdbHost,couchdbPort:e.couchdbPort||"",couchdbProtocol:e.couchdbProtocol,locationId:e.locationId||H.getUserLocationId(),facilityName:e.facilityName||"",configuredBy:e.configuredBy||"",configuredAt:e.configuredAt||(new Date).toISOString(),configSource:"global_property"}),localStorage.setItem("couchdbPassword",e.couchdbPassword),localStorage.setItem("couchdbUsername",e.couchdbUsername),localStorage.setItem("couchdbPort",e.couchdbPort),localStorage.setItem("couchdbHost",e.couchdbHost),localStorage.setItem("couchdbProtocol",e.couchdbProtocol),console.log("Network configuration applied to store and localStorage")}static reset(){this.initialized=!1}static isInitialized(){return this.initialized}static async forceRefresh(){return this.reset(),await this.initialize()}static clearConfiguration(){L().clearConfig(),this.reset(),console.log("Network configuration cleared")}}e(oe,"initialized",!1);const le={class:"login-container"},ne={key:0,style:{"justify-content":"center",display:"block"}},re={style:{"font-size":"15px"}},se={style:{"font-size":"12px",color:"#34af4d"}},ie={key:1},ue={style:{"font-size":"15px"}},ce={key:0},de={style:{"text-align":"left"}},fe={class:"signup-link"},pe={style:{display:"flex","justify-content":"center","align-items":"center"}},ve={key:1},me={style:{"text-align":"left"}},ge={key:0,class:"password-requirements"},we={class:"requirements-list"},he={class:"signup-link"};t("default",Z(l({__name:"Login",setup(e){const t=n(""),a=n(""),o=n(""),l=n(!1),L=n(!1),Z=n("test"),te=n(new Y),ye=n({username:"",currentPassword:"",newPassword:"",confirmPassword:""}),be=n(!1),Pe=n(!1),xe=n(!1),ke=r(),Ae=D(),Ie=F(),Se=j(),_e=s(()=>""!==ye.value.username.trim()&&""!==ye.value.currentPassword.trim()&&""!==ye.value.newPassword.trim()&&""!==ye.value.confirmPassword.trim()&&O(ye.value.newPassword)&&ye.value.newPassword===ye.value.confirmPassword&&ye.value.newPassword!==ye.value.currentPassword),Ce=()=>{L.value=!L.value,L.value&&(ye.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""})},ze=()=>{$("Help functionality to be implemented")},Ue=async()=>{if(!_e.value)return $("Please complete all fields correctly"),void $("Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character.");try{const e=await te.value.requestLogin(ye.value.currentPassword,ye.value.username);if(e){const{authorization:t}=e,{token:a,user:o}=t;o&&(localStorage.setItem("apiKey",a),await T.updateUser(o.user_id,{password:ye.value.newPassword}),R("Password changed successfully!"),await te.value.requestLogin(ye.value.newPassword,ye.value.username),ye.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""},L.value=!1,localStorage.setItem("apiKey",""))}}catch(e){B(e instanceof K?"Current password is incorrect":`Error changing password: ${e}`)}},Me=async()=>{const e=ae();if(!t.value||!a.value)return{success:!1,error:null,validationError:!0};te.value.setUsername(t.value),e.setUsername(t.value);try{return await te.value.login(a.value),await(async()=>{const e=F(),t=await ee();t&&(e.setUserFacilityName(t.name),e.setFacilityLocation(t),localStorage.setItem("facility_code",t.code))})(),await(async()=>{const e=await te.value.checkUserPrograms(void 0);null!=e&&e.programs&&W().setAuthorizedPrograms(null==e?void 0:e.programs)})(),await Q(),await X(),e.setEMRAuthenticated(!0),Ie.setLoginStatus(!0),{success:!0,error:null}}catch(o){return e.setEMRAuthenticated(!1),Ie.setLoginStatus(!1),{success:!1,error:o}}},Ee=async()=>{if(H.getLanConnectionStatus()||H.getPouchDbStatus())return{success:!0,error:null};const e=ae();if(!t.value||!a.value)return{success:!1,error:null,validationError:!0};te.value.setUsername(t.value);try{return await te.value.loginToMIUM(a.value),e.setMIUMAuthenticated(!0),{success:!0,error:null}}catch(o){return e.setMIUMAuthenticated(!1),{success:!1,error:o}}},Ne=async()=>{const e=ae();if(!t.value||!a.value)return void $("Complete form to log in");e.recordLoginAttempt();const[o,l]=await Promise.allSettled([Me(),Ee()]),n="fulfilled"===o.status&&o.value.success,r="fulfilled"===l.status&&l.value.success;if(n)await(async()=>{try{await Se.loadGlobalProperty(),await oe.initialize()?console.log("Network auto-configuration completed successfully"):console.log("No facility network configuration found, user will need to configure manually")}catch(e){console.error("Error during post-login initialization:",e)}})(),ke.push("/home");else if(n||r)!n&&r&&("fulfilled"===o.status?o.value.error:o.reason);else{const e="fulfilled"===o.status?o.value.error:o.reason;e instanceof K?B("Invalid username or password"):e instanceof G?(Ce(),B("Please change your password",5e4)):e instanceof J?(Ce(),B("Your password has expired. Please change your password",5e4)):B(`${e}`,5e4)}};return i(async()=>{Ie.checkLoginStatus()&&ke.push("/home"),Ie.setLoginStatus(!1),await te.value.loadConfig(),o.value=localStorage.getItem("core_version")||"",await(async()=>{Ae.terminate(),await D().postData("SET_OFFLINE_PROGRAMS")})()}),(e,n)=>{const r=u("ion-icon");return d(),c(v(q),null,{default:f(()=>[p(v(m),{class:"ion-padding login-page"},{default:f(()=>[g("div",le,[p(v(w),{style:{"background-color":"#fff"}},{default:f(()=>[p(v(h),null,{default:f(()=>[p(v(P),{class:"login_img",src:v(V)("mw.png"),id:"logo"},null,8,["src"]),p(v(x),{class:"login-title"},{default:f(()=>["development"===Z.value||"test"===Z.value?(d(),y("span",ne,[g("div",null,[n[11]||(n[11]=k(" MaHIS ",-1)),g("small",re,"(v"+A(o.value)+")",1)]),g("div",se,"("+A(Z.value)+")",1)])):(d(),y("span",ie,[n[12]||(n[12]=k(" MaHIS ",-1)),g("small",ue,"(v"+A(o.value)+")",1)]))]),_:1}),L.value?b("",!0):(d(),y("div",ce,[g("span",de,[p(v(I),{value:t.value,onIonInput:n[0]||(n[0]=e=>t.value=e.target.value||""),type:"text",label:"Username",ref:"usernameRef","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:f(()=>[p(v(S),{slot:"end"},{default:f(()=>[p(r,{icon:v(_)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),p(v(I),{value:a.value,onIonInput:n[2]||(n[2]=e=>a.value=e.target.value||""),type:l.value?"text":"password",label:"Password",ref:"passwordRef","label-placement":"floating",fill:"outline",placeholder:"Enter Password",class:"input-fields",required:"",onKeydown:C(Ne,["enter"])},{default:f(()=>[p(v(S),{slot:"end"},{default:f(()=>[p(r,{icon:l.value?v(z):v(U),onClick:n[1]||(n[1]=e=>l.value=!l.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"])]),p(v(M),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:Ne,class:"login-button"},{default:f(()=>[...n[13]||(n[13]=[k(" Login ",-1)])]),_:1}),g("p",fe,[n[17]||(n[17]=k(" For help click ",-1)),g("a",{href:"#",onClick:E(ze,["prevent"])},"Here"),n[18]||(n[18]=k()),n[19]||(n[19]=g("br",null,null,-1)),g("div",pe,[p(v(M),{fill:"clear",size:"small",onClick:Ce,style:{display:"inline","--padding-start":"2px","--padding-end":"2px"}},{default:f(()=>[...n[14]||(n[14]=[g("span",{style:{"text-decoration":"underline",color:"#34af4d",cursor:"pointer"}}," Change Password ",-1)])]),_:1}),n[16]||(n[16]=k(" | ",-1)),p(v(M),{fill:"clear",size:"small",onClick:n[3]||(n[3]=e=>{return t="/downloads",void ke.push(t);var t}),style:{display:"inline","--padding-start":"2px","--padding-end":"2px"}},{default:f(()=>[...n[15]||(n[15]=[g("span",{style:{"text-decoration":"underline",color:"#34af4d",cursor:"pointer"}}," Download MaHIS ",-1)])]),_:1})])])])),L.value?(d(),y("div",ve,[n[22]||(n[22]=g("h3",{style:{"text-align":"center","margin-bottom":"20px",color:"#34af4d"}},"Change Password",-1)),g("span",me,[p(v(I),{value:ye.value.username,onIonInput:n[4]||(n[4]=e=>ye.value.username=e.target.value||""),type:"text",label:"Username","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:f(()=>[p(v(S),{slot:"end"},{default:f(()=>[p(r,{icon:v(_)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),p(v(I),{value:ye.value.currentPassword,onIonInput:n[6]||(n[6]=e=>ye.value.currentPassword=e.target.value||""),type:be.value?"text":"password",label:"Current Password","label-placement":"floating",fill:"outline",placeholder:"Enter Current Password",class:"input-fields",required:""},{default:f(()=>[p(v(S),{slot:"end"},{default:f(()=>[p(r,{icon:be.value?v(z):v(U),onClick:n[5]||(n[5]=e=>be.value=!be.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"]),p(v(I),{value:ye.value.newPassword,onIonInput:n[8]||(n[8]=e=>ye.value.newPassword=e.target.value||""),type:Pe.value?"text":"password",label:"New Password","label-placement":"floating",fill:"outline",placeholder:"Enter New Password",class:N(["input-fields",{"invalid-input":ye.value.newPassword&&!v(O)(ye.value.newPassword)}]),required:""},{default:f(()=>[p(v(S),{slot:"end"},{default:f(()=>[p(r,{icon:Pe.value?v(z):v(U),onClick:n[7]||(n[7]=e=>Pe.value=!Pe.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"]),p(v(I),{value:ye.value.confirmPassword,onIonInput:n[10]||(n[10]=e=>ye.value.confirmPassword=e.target.value||""),type:xe.value?"text":"password",label:"Confirm New Password","label-placement":"floating",fill:"outline",placeholder:"Confirm New Password",class:N(["input-fields",{"invalid-input":ye.value.confirmPassword&&ye.value.newPassword!==ye.value.confirmPassword}]),required:""},{default:f(()=>[p(v(S),{slot:"end"},{default:f(()=>[p(r,{icon:xe.value?v(z):v(U),onClick:n[9]||(n[9]=e=>xe.value=!xe.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"])]),ye.value.newPassword?(d(),y("div",ge,[n[20]||(n[20]=g("p",{class:"requirements-title"},"Password Requirements:",-1)),g("ul",we,[g("li",{class:N({valid:ye.value.newPassword.length>=8})},"At least 8 characters",2),g("li",{class:N({valid:/[A-Z]/.test(ye.value.newPassword)})},"One uppercase letter",2),g("li",{class:N({valid:/[0-9]/.test(ye.value.newPassword)})},"One number",2),g("li",{class:N({valid:/[@#$%^&+=*!-]/.test(ye.value.newPassword)})}," One special character (@#$%^&+=*!-) ",2),g("li",{class:N({valid:ye.value.newPassword!==ye.value.currentPassword&&""!==ye.value.currentPassword})}," Different from current password ",2)])])):b("",!0),p(v(M),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:Ue,class:"login-button",disabled:!_e.value},{default:f(()=>[...n[21]||(n[21]=[k(" Change Password ",-1)])]),_:1},8,["disabled"]),g("p",he,[g("a",{href:"#",onClick:E(Ce,["prevent"])},"Back to Login")])])):b("",!0)]),_:1})]),_:1})])]),_:1})]),_:1})}}}),[["__scopeId","data-v-414576a7"]]))}}})}();

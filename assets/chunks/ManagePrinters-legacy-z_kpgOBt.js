System.register(["./vendor-legacy-h4cyiMXU.js","../index-legacy-BOBcaga6.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-CRcfwVwU.js"],function(e,a){"use strict";var t,n,r,i,l,o,d,s,c,u,p,f,v,m,b,g,y,_,h,x,P,w,k,D,I,S,F,C,T,z,$,j,A,N,O,L,M,q,J,E,U,R,V,W,X,B,G,K,Q,Z;return{setters:[e=>{t=e.d,n=e.c,r=e.O,i=e.f,l=e.J,o=e.l,d=e.u,s=e.I,c=e.G,u=e.k,p=e.E,f=e.Q,v=e.ab,m=e.ac,b=e.ad,g=e.ae,y=e.R,_=e.cr,h=e.r,x=e.w,P=e.a,w=e.e,k=e.b7,D=e.n,I=e.m,S=e.a0,F=e.a6,C=e.a2,T=e.bF,z=e.ah,$=e.F,j=e.P,A=e.K,N=e.N,O=e.p},e=>{L=e.y,M=e.n,q=e.x,J=e.D,E=e.z,U=e.t,R=e.S,V=e.a4,W=e._,X=e.g,B=e.w,G=e.o,K=e.F,Q=e.aL,Z=e.T},null,null],execute:function(){var a=document.createElement("style");a.textContent=".table-header[data-v-70782a29]{display:flex;justify-content:space-between;align-items:center;gap:16px}.default-printer[data-v-70782a29]{display:flex;align-items:center;gap:8px;min-width:400px}.label[data-v-70782a29]{font-weight:600;min-width:120px}.action-buttons[data-v-70782a29]{display:flex;gap:8px}.action-button[data-v-70782a29]{padding:6px 12px;font-size:13px;font-weight:500;border-radius:6px;cursor:pointer;border:none;transition:background .2s ease}.action-button.primary[data-v-70782a29]{background:#0d6efd;color:#fff}.action-button.primary[data-v-70782a29]:hover{background:#0b5ed7}.action-button.danger[data-v-70782a29]{background:#dc3545;color:#fff}.action-button.danger[data-v-70782a29]:hover{background:#bb2d3b}.spinner-overlay[data-v-8151b8bf]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(255,255,255,.8);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:1000}.spinner-overlay ion-spinner[data-v-8151b8bf]{width:50px;height:50px;color:var(--ion-color-primary, #006401)}.spinner-overlay .loading-text[data-v-8151b8bf]{margin-top:10px;font-size:1.1em;color:#333}.container[data-v-8151b8bf]{text-align:center;padding:20px;box-sizing:border-box}ion-list[data-v-8151b8bf]{margin-top:20px;background:var(--ion-background-color, #fff);border-radius:8px;overflow:hidden}ion-item[data-v-8151b8bf]{--padding-start: 16px;--inner-padding-end: 16px;--background: var(--ion-item-background, #fff);border-bottom:1px solid var(--ion-item-border-color, #eee)}ion-item[data-v-8151b8bf]:last-child{border-bottom:none}ion-label[data-v-8151b8bf]{flex-grow:1;font-size:1em;color:var(--ion-text-color, #000);text-align:left}ion-button[data-v-8151b8bf]{margin-left:8px;--border-radius: 20px;--box-shadow: 0 2px 4px rgba(0, 0, 0, .1)}@media(max-width:768px){.container[data-v-8151b8bf]{padding:10px}ion-item[data-v-8151b8bf]{--padding-start: 10px;--inner-padding-end: 10px}ion-button[data-v-8151b8bf]{--padding-start: 12px;--padding-end: 12px;font-size:.8em}}\n/*$vite$:1*/",document.head.appendChild(a);const H={style:{display:"flex","justify-content":"space-between"}},Y={style:{"max-width":"500px",margin:"auto"}},ee=W(t({__name:"AddWebPrinter",setup(e){const{formRef:a}=L(),t=n(()=>[{componentType:"inputField",header:"Print name",name:"printer_name",icon:M.print,validation:e=>q.required(e)},{componentType:"inputField",header:"Printer IP address",name:"ip_address",icon:M.networkBarDark,validation:e=>q.required(e)},{componentType:"inputField",header:"Port",name:"port",validation:e=>q.required(e)}]);return(e,n)=>(i(),r(d(g),null,{default:l(()=>[o(d(s),null,{default:l(()=>[o(d(c),null,{default:l(()=>[u("div",H,[o(d(p),null,{default:l(()=>[...n[2]||(n[2]=[f("Add Web Printer",-1)])]),_:1}),o(J,{name:"X",style:{"margin-right":"10px"},onClick:n[0]||(n[0]=e=>{y.dismiss()})})])]),_:1})]),_:1}),o(d(v),{class:"ion-padding"},{default:l(()=>[u("div",Y,[o(d(m),null,{default:l(()=>[o(d(b),{size:"12"},{default:l(()=>[o(E,{formData:t.value,ref_key:"formRef",ref:a},null,8,["formData"])]),_:1})]),_:1}),o(d(m),{class:"ion-justify-content-end ion-margin-top"},{default:l(()=>[o(d(b),{size:"auto"},{default:l(()=>[o(J,{name:"Add printer",onClick:n[1]||(n[1]=e=>(async()=>{var e,t;const n=null===(e=a.value)||void 0===e?void 0:e.getFormValues();if(null!=(null===(t=a.value)||void 0===t?void 0:t.validateForm()))return void U("Please fill in all required fields");const r=R.getUserLocationId();n._id=`${r}_${(new Date).getTime()}`,n.location_id=r,n.created_at=R.getSessionDate(),await V({data:n,storeName:"printer_configurations",command:"upsertDocument"}),y.dismiss()})())})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),[["__scopeId","data-v-66b9d9c4"]]),ae={class:"page-wrapper"},te={class:"table-header"},ne={class:"default-printer"},re={class:"table-responsive"},ie={key:0,class:"loading-state"},le={key:1,class:"empty-state"},oe=W(t({__name:"ManageIPPrinters",setup(e){const a=_(),t=h([]),s=h(!1),c=h(null),p=n(()=>({paging:!0,searching:!1,ordering:!0,responsive:!0,pageLength:8,rowId:"_id"})),f=n(()=>[{data:0,title:"Printer name"},{data:1,title:"IP address"},{data:2,title:"Port"},{data:3,title:"Date"},{data:4,title:"Actions",orderable:!1}]),v=n(()=>[{componentType:"multiSelectInputField",value:R.getDefaultPrinter()||"",trackBy:"id",options:t.value.map(e=>({id:e._id,name:e.printer_name,ip_address:e.ip_address})),onChange:e=>{localStorage.setItem("defaultPrinter",JSON.stringify(e))}}]),m=n(()=>t.value.map(e=>[e.printer_name,e.ip_address,e.port,b(e),g(e._id)])),b=e=>e.created_at?new Date(e.created_at).toLocaleDateString():"—",g=e=>`\n    <div class="action-buttons">\n        <button\n            class="btn btn-sm btn-primary edit-btn"\n            data-action="test"\n            data-id="${e}"\n        >\n            Test\n        </button>\n        <button\n            class="btn btn-sm btn-danger delete-btn"\n            data-action="delete"\n            data-id="${e}"\n        >\n            Delete\n        </button>\n    </div>\n`,y=()=>{D(()=>{var e;const a=null===(e=c.value)||void 0===e?void 0:e.dt;a&&(a.off("click","button[data-action]"),a.on("click","button[data-action]",e=>{const a=e.target,n=a.dataset.action,r=a.dataset.id,i=t.value.find(e=>e._id===r);i&&("test"===n&&C(i),"delete"===n&&F(i))}))})},I=async()=>{s.value=!0;try{const e=await X("printer_configurations",{selector:{location_id:{$eq:R.getUserLocationId()}}});t.value=e,y()}catch(e){console.error(e),B("Failed to load printers")}finally{s.value=!1}},S=async()=>{await G(ee,{class:"large-modal"},!0),await I()},F=async e=>{if(confirm(`Delete printer ${e.printer_name}?`))try{await V({data:{_id:e._id},storeName:"printer_configurations",command:"deleteData"}),K("Printer deleted"),await I()}catch{B("Delete failed")}},C=async e=>{const a=`^XA\n^FO50,50^A0N,40,40^FDTest Print^FS\n^FO50,100^FD${e.printer_name}^FS\n^XZ`;try{(await fetch(`http://${e.ip_address}:${e.port}/print`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({zpl:a})})).ok?K("Test print sent"):B("Printer rejected request")}catch{B("Printer not reachable")}};return x(a,I),x(m,y),P(I),(e,a)=>(i(),w("div",ae,[u("div",te,[a[1]||(a[1]=u("h3",{class:"encounter-title"},"Manage Web Printers",-1)),u("div",ne,[a[0]||(a[0]=u("span",{class:"label"},"Default Printer",-1)),o(E,{formData:v.value},null,8,["formData"])]),o(J,{name:"Add printer",fill:"solid",disabled:s.value,onClick:S},null,8,["disabled"])]),u("div",re,[s.value?(i(),w("div",ie,"Loading printers…")):0===t.value.length?(i(),w("div",le,[a[2]||(a[2]=u("p",null,"No printers configured",-1)),o(J,{name:"Add printer",onClick:S})])):(i(),r(d(k),{key:2,ref_key:"dataTableRef",ref:c,class:"display nowrap modern-table",width:"100%",data:m.value,columns:f.value,options:p.value},{default:l(()=>[...a[3]||(a[3]=[u("thead",null,[u("tr",null,[u("th",null,"Printer name"),u("th",null,"IP address"),u("th",null,"Port"),u("th",null,"Date"),u("th",null,"Actions")])],-1)])]),_:1},8,["data","columns","options"]))])]))}}),[["__scopeId","data-v-70782a29"]]),de={key:0,class:"spinner-overlay"},se={class:"container"};e("default",W(t({__name:"ManagePrinters",setup(e){_();const a=h(!1),t=h(Math.random()),n=h([]),s=h({}),c=new Q,p=h(!1);function m(){try{localStorage.setItem("isIpPrinters",JSON.stringify(p.value)),console.log("isIpPrinters state saved:",p.value)}catch(e){console.error("Error saving isIpPrinters state to localStorage:",e)}}async function b(){if(!a.value){a.value=!0;try{const e=await c.getAllPrinters();console.log("Discovered printers",JSON.stringify(e)),n.value=e.sort((e,a)=>{const t=x(e),n=x(a);return t&&!n?-1:!t&&n?1:y(e,a)})}catch(e){console.error("Error loading printers:",e)}finally{a.value=!1,t.value=Math.random()}}}function y(e,a){const t=e.name||"",n=a.name||"",r=e.address||"",i=a.address||"";return t!==n?t.localeCompare(n):r.localeCompare(i)}function x(e){return 0===y(e,s.value)}return P(async()=>{(function(){try{const e=localStorage.getItem("isIpPrinters");null!==e&&(p.value=JSON.parse(e),console.log("isIpPrinters state loaded:",p.value))}catch(e){console.error("Error loading isIpPrinters state from localStorage:",e)}})(),s.value=await c.getDefaultPrinter()||{},s.value&&(s.value.name||s.value.address)&&(n.value.some(e=>0===y(e,s.value))||n.value.push(s.value)),b()}),(e,y)=>(i(),r(d(g),{class:O({loading:a.value})},{default:l(()=>[a.value?(i(),w("div",de,[o(d(S),{name:"bubbles"}),y[1]||(y[1]=u("div",{class:"loading-text"},"Please wait...",-1))])):I("",!0),o(Z),o(d(v),null,{default:l(()=>[u("div",se,[y[5]||(y[5]=u("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Printer Management",-1)),o(d(F),null,{default:l(()=>[o(d(C),null,{default:l(()=>[...y[2]||(y[2]=[f("Use IP Printers",-1)])]),_:1}),o(d(T),{modelValue:p.value,"onUpdate:modelValue":y[0]||(y[0]=e=>p.value=e),onIonChange:m},null,8,["modelValue"])]),_:1}),p.value?I("",!0):(i(),r(d(z),{key:0},{default:l(()=>[(i(!0),w($,null,j(n.value,e=>(i(),r(d(F),{key:e.name||e.address||"unknown-printer"},{default:l(()=>[o(d(C),null,{default:l(()=>[f(A(e.name||e.address||"Unnamed Printer"),1)]),_:2},1024),o(d(N),{size:"small",color:x(e)?"success":"primary",onClick:a=>function(e){c.setDefaultPrinter(e),s.value=e,t.value=Math.random(),b()}(e),disabled:x(e)},{default:l(()=>[...y[3]||(y[3]=[f(" Set as Default ",-1)])]),_:1},8,["color","onClick","disabled"]),o(d(N),{onClick:a=>d(c).printTestLbl(e),size:"small"},{default:l(()=>[...y[4]||(y[4]=[f(" Test Print ",-1)])]),_:1},8,["onClick"])]),_:2},1024))),128))]),_:1})),p.value?(i(),r(oe,{key:1,style:{"margin-top":"10px"}})):I("",!0)])]),_:1})]),_:1},8,["class"]))}}),[["__scopeId","data-v-8151b8bf"]]))}}});

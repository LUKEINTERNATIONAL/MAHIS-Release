!function(){function e(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}System.register(["./vendor-legacy-BwtHwPGM.js","./lodash-legacy-pOOc9Efu.js","../index-legacy-BAoIuAAl.js","./drug_prescription_service-legacy-AWVXzfs4.js","./patient_diagnosis_service-legacy-CMMyA8Nn.js"],function(t,a){"use strict";var n,i,s,o,r,l,d,c,u,p,g,v,h,f,b,y,m,D,S,_,w,N,P,T,O,k,C,x,I,B,$,E,F,j,M,q,z,V,A,H,L,U;return{setters:[e=>{n=e.D,i=e.d,s=e.c,o=e.H,r=e.e,l=e.f,d=e.m,c=e.k,u=e.p,p=e.j,g=e.l,v=e.K,h=e.r,f=e.w,b=e.a,y=e.F,m=e.P,D=e.O,S=e.u,_=e.J,w=e.n,N=e.aV},e=>{P=e.l},e=>{T=e.b0,O=e.u,k=e.af,C=e.S,x=e.E,I=e.H,B=e.aS,$=e.bF,E=e.P,F=e.a7,j=e.G,M=e.t,q=e.aK,z=e.aL,V=e.a0},e=>{A=e.g,H=e.D,L=e.a},e=>{U=e.P}],execute:function(){t({c:async function(){try{const n=O(),{patient:i}=N(n),s=ge(),o=JSON.parse(JSON.stringify(i.value));if(s.length>0){var e,t,a;null!==(t=(e=null!==(a=o.MedicationOrder)&&void 0!==a?a:o.MedicationOrder={}).unsaved)&&void 0!==t||(e.unsaved=[]),o.MedicationOrder.unsaved=[...o.MedicationOrder.unsaved,...s];const n=z();return n.setMedicationRunOutDate(function(){try{const e=new Date(C.getSessionDate()),t=z().selectedNCDMedicationList;let a=0;if(t.forEach(e=>{const t=parseInt(e.duration,10);!isNaN(t)&&t>a&&(a=t)}),a<=0)return{date:null,formattedDate:null};const n=new Date(e);n.setDate(e.getDate()+a);const i=String(n.getDate()).padStart(2,"0"),s=String(n.getMonth()+1).padStart(2,"0"),o=n.getFullYear();return{date:n,formattedDate:`${i}/${s}/${o}`}}catch(e){return console.error("Error calculating medication run out date:",e),{date:null,formattedDate:null}}}()),n.clearMedicationDataStores(),j("Drug order(s) has been created"),o}M("Unable to create drug orders!")}catch(n){M("Unable to create drug orders!")}},d:function(){try{const e=new Date(C.getSessionDate()),t=q().selectedMedicalDrugsList;let a=0;if(t.forEach(e=>{const t=parseInt(e.duration,10);!isNaN(t)&&t>a&&(a=t)}),a<=0)return{date:null,formattedDate:null};const n=new Date(e);n.setDate(e.getDate()+a);const i=String(n.getDate()).padStart(2,"0"),s=String(n.getMonth()+1).padStart(2,"0"),o=n.getFullYear();return{date:n,formattedDate:`${i}/${s}/${o}`}}catch(e){return console.error("Error calculating OPD medication run out date:",e),{date:null,formattedDate:null}}},e:async function(){try{const n=O(),{patient:i}=N(n),s=he(),o=JSON.parse(JSON.stringify(i.value));var e,t,a;if(s.length>0)return null!==(t=(e=null!==(a=o.MedicationOrder)&&void 0!==a?a:o.MedicationOrder={}).unsaved)&&void 0!==t||(e.unsaved=[]),o.MedicationOrder.unsaved=[...o.MedicationOrder.unsaved,...s],j("Drug order(s) has been created"),o}catch(n){M("Unable to create drug orders!")}},g:async function(){const e=O(),{patient:t}=N(e),a=t.value,n=[8809,903,6410,6409];let i;i=C.getLanConnectionStatus()||C.getPouchDbStatus()?await U.getDiagnosis("",1,15):await C.getJson("diagnosis",{id:7409,page_size:2e3});const s=i.filter(e=>n.includes(e.concept_id));s.push({concept_id:8809,concept_name_id:926,concept_name_type:"FULLY_SPECIFIED",creator:1,date_created:"2004-06-25T00:00:00.000+02:00",date_voided:null,id:72,locale:"en",locale_preferred:0,name:"Hypertension",uuid:"b99faa1e-8d80-11d8-abbb-0024217bb78e",void_reason:null,voided:0,voided_by:null});const o=a.diagnosis.saved.map(e=>e.value_coded),r=a.diagnosis.unsaved.map(e=>e.value_coded),l=[...o,...r],d=s.filter(e=>l.includes(e.concept_id));return d.map(e=>e.name)},s:async function(e){try{var t,a,n;const i=O(),{patient:s}=N(i),o=JSON.parse(JSON.stringify(s.value));return null!==(a=(t=null!==(n=o.allergies)&&void 0!==n?n:o.allergies={}).unsaved)&&void 0!==a||(t.unsaved=[]),o.allergies.unsaved.push(...e),j("Allergies appended to patient record successfully"),o}catch(i){M("Unable to save Allegies!")}}});const a=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"Visual acuity test",data:{rowData:[{colData:[{inputHeader:"Left Eye",value:"",name:"Left eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"},{inputHeader:"Right Eye",value:"",name:"Right eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"}]}]}}],J=[{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Peripheral neuropathy"},data:[{name:"Neuropathy/PVO",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Deformity"},data:[{name:"Deformities",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Ulcers"},data:[{name:"Ulcers",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}}],Y=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"CV Risk %",data:{rowData:[{colData:[{inputHeader:"",value:"",name:"CVD",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,valueType:"text",validationFunctionName:"isNumber"}]}]}}],R=(t("a",n("complicationsStore",{state:()=>({visualScreening:[...a],FootScreening:[...J],cvScreening:[...Y]}),actions:{setCvScreening(e){this.cvScreening=e},setVisualScreening(e){this.visualScreening=e},setFootScreening(e){this.FootScreening=e},getInitialCvScreening:()=>[...P.cloneDeep(Y)],getInitialVisualScreening:()=>[...P.cloneDeep(a)],getInitialFootScreening:()=>[...P.cloneDeep(J)],resetScreening(){this.setCvScreening(this.getInitialCvScreening()),this.setFootScreening(this.getInitialFootScreening()),this.setVisualScreening(this.getInitialVisualScreening())}},persist:!0})),{class:"fw-list-wrapper"}),W=["id"],K={class:"fw-step-container"},Q={key:0},G={key:1},X=i({__name:"WizardStep",props:{tab:{type:Object,default:()=>{}},index:{type:Number,default:0},currentIndex:{type:Number,default:0},squaredTab:{type:Boolean,default:!1},showProgress:{type:Boolean,default:!0}},setup(e){const t=e,a=s(()=>t.currentIndex>t.index);s(()=>`pi pi-${t.tab.icon}`);const n=s(()=>["fw-list-wrapper-icon",{"fw-step-active":t.tab.active,"fw-step-checked":t.tab.checked,"fw-squared-tab":t.squaredTab}]);return(t,i)=>{const s=o("ion-icon");return l(),r("li",null,[e.showProgress?(l(),r("div",{key:0,class:u(["fw-list-progress",{"fw-list-progress-active":a.value}])},null,2)):d("",!0),c("div",R,[c("div",{id:`step-${e.tab.id}`,role:"tab",class:u(n.value)},[c("div",K,[p(t.$slots,"active-step",{},()=>[e.tab.icon?(l(),r("i",Q,[g(s,{icon:e.tab.icon,style:{"font-size":"16px"}},null,8,["icon"])])):(l(),r("i",G,v(e.index+1),1))])])],10,W),p(t.$slots,"title",{},()=>[c("span",{class:u(["fw-step-title",{active:e.tab.active}])},v(e.tab.title),3)])])])}}}),Z=["disabled"],ee={key:0},te=i({__name:"Button",props:{options:{type:Object,default:function(){return{}}}},setup(e){const t=e,a=s(()=>["fw-btn",{"fw-btn-disabled":t.options.disabled}]);return(t,n)=>{return l(),r("button",{class:u(a.value),disabled:e.options.disabled},[e.options.hideText?d("",!0):(l(),r("span",ee,v(e.options.text),1)),e.options.hideIcon?d("",!0):(l(),r("i",{key:1,class:u((i=e.options.icon,`pi pi-${i}`))},null,2))],10,Z);var i}}}),ae=["id"],ne={key:0,class:"fw-body-list",role:"tablist"},ie={class:"fw-body"},se={class:"fw-body-content"},oe={class:"fw-body-container"},re={key:0,class:"fw-footer"},le={class:"fw-footer-left"},de={class:"fw-footer-right"};t("_",i({__name:"Wizard",props:{id:{type:String,default:"fw-"+(new Date).valueOf()},headingTitle:{type:String,default:""},customTabs:{type:Array,default:()=>[{id:0,title:"Step 1",icon:"map"},{id:1,title:"Step 2",icon:"check"},{id:2,title:"Step 3",icon:"pencil"}]},nextButton:{type:Object,default:function(){return{}}},backButton:{type:Object,default:function(){return{}}},doneButton:{type:Object,default:function(){return{}}},hideButtons:{type:Boolean,default:!1},startIndex:{type:Number,default:0,validator:e=>e>=0},verticalTabs:{type:Boolean,default:!1},beforeChange:{type:Function,default:()=>{}},beforeMount:{type:Function,default:()=>{}},navigableTabs:{type:Boolean,default:!1},scrollableTabs:{type:Boolean,default:!1},cardBackground:{type:Boolean,default:!1},squaredTabs:{type:Boolean,default:!1},showProgress:{type:Boolean,default:!0},showWizard:{type:Boolean,default:!0}},emits:["change","complete:wizard","updated:tabs","onValidateTabs","done-button-changed"],setup(e,{expose:t,emit:a}){const n=a,i=e;let o=h(0);const N=s(()=>[...i.customTabs].map((e,t)=>({...e,checked:t<o.value,active:t===o.value}))),P=s(()=>N.value.length-1),T=s(()=>Object.assign({text:"Back",icon:"arrow-left",hideText:!1,hideIcon:!1,disabled:!1},i.backButton)),O=s(()=>Object.assign({text:"Next",icon:"arrow-right",hideText:!1,hideIcon:!1,disabled:!1},i.nextButton)),k=s(()=>Object.assign({text:"Done",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},i.doneButton));f(()=>i.doneButton,(e,t)=>{n("done-button-changed",{newOptions:k.value,oldOptions:t?Object.assign({text:"Done",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},t):null,currentTabIndex:o.value,isLastStep:x.value})},{deep:!0,immediate:!1}),f(k,(e,t)=>{console.log("Done button options changed:",{new:e,old:t,currentStep:o.value})},{deep:!0}),b(()=>{o.value=i.startIndex,B(),n("change",o.value)});const C=s(()=>0!==o.value),x=s(()=>o.value===P.value),I=s(()=>["form-wizard-vue",{"fw-vertical":i.verticalTabs},{"fw-overflow-scroll":i.scrollableTabs},{"fw-card":i.cardBackground}]),B=()=>{n("updated:tabs",N.value,o.value)},$=async()=>{if(o.value===P.value)return void(k.value.disabled||F());if(O.value.disabled)return;const e=o.value+1,t=o.value;i.navigableTabs?(n("change",e,t),await i.beforeChange(),M(e)):n("change",e,t,!0)},E=async()=>{if(0===o.value||T.value.disabled)return;const e=o.value-1,t=o.value;n("change",e,t),await i.beforeChange(),M(e)},F=()=>{const e=o.value,t=o.value-1;n("complete:wizard",e,t)},j=async e=>{if(!i.navigableTabs)return;const t=e,a=o.value;n("change",t,a),await i.beforeChange(),M(t)},M=async e=>{o.value=e,B(),await w(),await i.beforeMount()};return t({changeTab:M}),(t,a)=>(l(),r("div",{id:e.id,class:u(I.value)},[e.showWizard?(l(),r("ul",ne,[c("h4",null,v(e.headingTitle),1),(l(!0),r(y,null,m(N.value,(a,n)=>p(t.$slots,"wizard-step",{tab:a,index:n,navigateToTab:j},()=>[(l(),D(X,{key:a.id,tab:a,index:n,currentIndex:S(o),squaredTab:e.squaredTabs,showProgress:e.showProgress,onClick:e=>j(n)},{"active-step":_(()=>[p(t.$slots,"active-step")]),title:_(()=>[p(t.$slots,"title")]),_:3},8,["tab","index","currentIndex","squaredTab","showProgress","onClick"]))])),256))])):d("",!0),c("div",ie,[c("div",se,[c("div",oe,[p(t.$slots,"default")])]),e.hideButtons?d("",!0):(l(),r("div",re,[p(t.$slots,"footer",{},()=>[c("div",le,[C.value?(l(),r("span",{key:0,role:"button",onClick:E},[p(t.$slots,"back",{},()=>[g(te,{options:T.value},null,8,["options"])])])):d("",!0),p(t.$slots,"custom-buttons-left")]),c("div",de,[p(t.$slots,"custom-buttons-right"),x.value?(l(),r("span",{key:0,role:"button",onClick:$},[p(t.$slots,"done",{},()=>[g(te,{options:k.value},null,8,["options"])])])):(l(),r("div",{key:1,role:"button",onClick:$},[p(t.$slots,"next",{},()=>[g(te,{options:O.value},null,8,["options"])])]))])])]))])],10,ae))}})),t("u",()=>{const e=h(""),t=t=>{t%1==0&&(e.value=t)};return{currentTabIndex:e,onChangeCurrentTab:t,onTabBeforeChange:a=>{0===e.value&&console.log("First Tab"),t(a)},changeBtnIconPosition:()=>{w(()=>{const e=document.querySelector(".fw-footer-left .fw-btn");if(!e)return;const t=e.querySelector("span"),a=e.querySelector("i");t&&a&&(e.removeChild(t),e.removeChild(a),e.appendChild(a),e.appendChild(t))})}}});class ce extends T{constructor(e,t){super(e,105,t)}}class ue extends T{constructor(e,t){super(e,25,t)}static async get_____(e="",t=1,a=10){}}t("T",class{async onSubmitNotes(e,t,a){const n=new ce(e,t);await n.createEncounter(),await n.saveObservationList(a)}async onSubmitAllergies(e,t,a){try{const n=new ue(e,t);await n.createEncounter(),await n.saveObservationList(a),j("Allergies saved successfully")}catch(n){console.error("Error saving allergies:",n),M("Failed to save allergies")}}});function pe(e){const t=e.match(/(\d+)\s+days/i);return t&&t.length>1?parseInt(t[1]):null}t("P",class{constructor(){e(this,"programID",void 0),e(this,"providerID",void 0),e(this,"patientID",void 0),e(this,"date",void 0),e(this,"demographics",void 0),e(this,"previousDrugPrescriptions",[]),e(this,"previousClinicalNotes",void 0),e(this,"previousDrugAllergies",void 0);const t=O();this.demographics=t.patient,this.patientID=this.demographics.patientID,this.date=k.getSessionDate(),this.providerID=C.getUserID(),this.programID=k.getProgramID(),this.previousClinicalNotes={},this.previousDrugAllergies={}}async getPatientEncounters(){const e=await this.getPatientVisitDates(),t=e.map(async e=>{const t=e.value,a=await x.getEncounters(this.patientID,{date:t});await Promise.all(a.map(async e=>{if("NOTES"==e.type.name){const{observations:t}=e;P.isEmpty(t)||t.forEach(e=>{if("2688"==e.concept_id){const t=I.toStandardHisDisplayFormat(e.obs_datetime);P.isEmpty(this.previousClinicalNotes.hasOwnProperty(t))&&(this.previousClinicalNotes[t]=[]),this.previousClinicalNotes[t].push({date:t,notes:e.value_text})}})}if("TREATMENT"==e.type.name){const{observations:n}=e;if(!P.isEmpty(n))for(const e in n){let i="<UNKNOWN CONCEPT>";const s=n[e];try{var t;i=null!=s&&null!==(t=s.concept)&&void 0!==t&&t.concept_names?s.concept.concept_names[0].name:await B.getConceptName(s.concept_id)}catch(a){console.error(s,a)}const o=await k.resolvePrimaryValue(s),r=I.toStandardHisDisplayFormat(s.date_created);"Allergic"==i&&(this.previousDrugAllergies.hasOwnProperty(r)||(this.previousDrugAllergies[r]=[]),this.previousDrugAllergies[r].push({date:r,value:o}))}}}))});await Promise.all(t);const a=e.map(async e=>{const t=await $.getOrderByPatient(this.patientID,{start_date:e.value});if(!P.isEmpty(t)){const a=t.map(e=>({drugName:e.drug.name,value:I.toStandardHisTimeFormat(e.order.start_date),dose:e.dose,frequency:A(e.frequency),prescription:I.toStandardHisFormat(e.order.auto_expire_date),duration:pe(e.order.instructions),other:e}));this.previousDrugPrescriptions.push({prescriptionDate:I.toStandardHisDisplayFormat(e.value),previousPrescriptions:a})}});return await Promise.all(a),{previousDrugPrescriptions:this.previousDrugPrescriptions,previousClinicalNotes:this.previousClinicalNotes,previousDrugAllergies:this.previousDrugAllergies}}async getPatientVisitDates(){return(await E.getPatientVisits(this.patientID,!1)).map(e=>({label:I.toStandardHisDisplayFormat(e),value:e,other:{isActive:e===F.getSessionDate()}}))}});const ge=()=>{const e=z();return e.selectedNCDMedicationList.map(t=>{t.frequency=e.frequency_selections[t.drug_id]||"",t.totalDosage=Object.values(t.dosage).reduce((e,t)=>e+Number(t),0);const a=H.getSessionDate(),n=fe(t.drug_id);return{drug_inventory_id:t.drug_id,equivalent_daily_dose:"Unknown"==t.totalDosage?0:t.totalDosage*(null==n?void 0:n.value)||0,start_date:a,auto_expire_date:be(a,t.duration),units:t.units,instructions:`${t.name} ${t.totalDosage} ${t.units} ${(null==n?void 0:n.code)||""} for ${t.duration} days`,dose:ve(t),frequency:(null==n?void 0:n.code)||"",drug_name:t.drugName,offline_id:C.generateId(C.getUserName()),program_id:C.getProgramID()}})},ve=e=>null!=e.dose_strength&&e.dose_strength?Math.trunc(e.dose_strength):1;const he=()=>q().selectedMedicalDrugsList.map(e=>{const t=H.getSessionDate(),a=L.find(t=>t.label===e.frequency)||{};return{drug_inventory_id:e.drug_id,equivalent_daily_dose:"Unknown"==e.dose?0:e.dose*(null==a?void 0:a.value)||0,start_date:t,auto_expire_date:be(t,e.duration),units:e.units,instructions:`${e.drugName}: ${e.dose} ${e.units} ${(null==a?void 0:a.code)||""} for ${e.duration} days`,dose:e.dose,frequency:(null==a?void 0:a.code)||"",drug_name:e.drugName,offline_id:C.generateId(C.getUserName()),program_id:C.getProgramID()}}),fe=e=>{const t=z().selectedNCDMedicationList.find(t=>t.drug_id===e);if(!t||!t.dosage)return null;switch(["morning","afternoon","evening"].reduce((e,a)=>e+(t.dosage[a]?1:0),0)){case 1:return t.dosage.morning?L.find(e=>"QAM"===e.code):t.dosage.afternoon?L.find(e=>"QNOON"===e.code):t.dosage.evening?L.find(e=>"QPM"===e.code):L.find(e=>"OD"===e.code);case 2:return L.find(e=>"BD"===e.code);case 3:return L.find(e=>"TDS"===e.code);default:return L.find(e=>"Unknown"===e.code)}},be=(e,t)=>{const a=new Date(e);return a.setDate(a.getDate()+parseInt(t)),I.toStandardHisFormat(a)};t("b",n("nonPharmaTherapyStore",{state:()=>({items:[{id:"wound-dressing",label:"Wound dressing",checked:!1},{id:"patient-education",label:"Patient education",checked:!1},{id:"counseling",label:"Counseling",checked:!1},{id:"minor-surgery",label:"Minor Surgery",checked:!1}],current_patient:{}}),actions:{async saveNonPharmaTherapyPatientData(){const e=V(),t=[];this.items.forEach(a=>{1==a.checked&&t.push({concept_id:11023,value_text:a.label,obs_datetime:I.toStandardHisFormat(C.getSessionDate()),location_id:e.facilityLocation.code})});const a=q().nonPharmalogicalTherapyAndOtherNotes;a&&t.push({concept_id:2592,obs_datetime:C.getSessionDate(),value_text:a,location_id:e.facilityLocation.code});try{if(t.length>0)return this.clearSelectednonPharmaTherapyStore(),j("Non Pharma Therapy staged successfully!"),await async function(e){try{var t,a,n;const i=O(),{patient:s}=N(i),o=JSON.parse(JSON.stringify(s.value));return null!==(a=(t=null!==(n=o.notes)&&void 0!==n?n:o.notes={}).unsaved)&&void 0!==a||(t.unsaved=[]),o.notes.unsaved.push(...e),o}catch(i){M("Unable to create non pharmalogical notes!")}}(t)}catch(n){M("Unable to update Non Pharma Therapy!")}},clearSelectednonPharmaTherapyStore(){this.items.forEach(e=>{e.checked=!1})},setCurrentPatient(e){this.current_patient=e}},persist:!0}))}}})}();

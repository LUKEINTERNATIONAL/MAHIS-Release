import{e3 as Ee,e4 as xe,d as re,r as g,w as B,a as ve,O as R,f as m,u as t,bo as Oe,J as o,l,I as Be,G as _e,E as Ve,Q as h,K as C,aW as ye,N as Y,L as P,aa as Ae,ab as ge,k as w,e as U,m as I,a6 as T,p as k,b3 as ue,bC as $e,a2 as E,a8 as De,a7 as we,bJ as Ue,F as te,P as fe,bI as be,by as Te,M as Pe,a0 as Re,z as Ie,c as se,bw as Le,aS as qe,d$ as He,aR as ze,cB as Ye,d1 as je,dp as Ce,bK as Ge,cl as Je,cM as Ke,aV as Qe,e5 as We,e6 as Ze,e7 as Xe,e8 as ea,e9 as aa,ea as ta,eb as sa,bG as la,ao as ra,cz as X,U as Se,ad as de,bO as oa,ec as na,ac as Ne,df as ia,dg as ce,bx as ua,ae as da}from"./vendor-CAxM8KGs.js";import{N as ca}from"./NavigationMenu-CNwdTwUf.js";import{E as ma}from"./EIRreportsStore-Cbu3hXyV.js";import{B as fa}from"./bottomNavBar-DZviqoa9.js";import{ag as va,aE as Me,U as Fe,aa as ga,aF as pa,aG as ha,Y as _a,H as ya,w as z,_ as pe,aH as me}from"../index-CSiBRz_H.js";import{l as wa}from"./lodash-NJiRuGo9.js";import"./apexcharts-y0ZeiY9V.js";function Ua(){const b=()=>{const v="0123456789ABCDEF";let i="";for(let c=0;c<6;c++)i+=v[Math.floor(Math.random()*16)];return i};return{getAvatarUrl:(v,i=128)=>{const c="".concat(v),_=Ee(xe,{seed:c,size:i,backgroundColor:[b()]}).toString(),F=unescape(encodeURIComponent(_));return"data:image/svg+xml;base64,".concat(btoa(F))}}}const ba=()=>{const b="programs",x=Me;async function v(c){const f=await x.getAll(b,c);if(f!=null&&f.ok)return await f.json();throw new Error("Failed to retrieve programs.")}async function i(){const c=await va.getAllPrograms(),f=[];return c.forEach(_=>{f.push({name:_.name,other:_,selected:!1})}),c}return{getPrograms:v,getEMRPrograms:i}},Ia=ba(),Ca=()=>{const b="roles",x=Me;async function v(c){const f=await x.getAll(b,c);if(f!=null&&f.ok)return await f.json();throw new Error("Failed to retrieve user roles.")}async function i(){return await Fe.getAllRoles()}return{getUserRoles:v,getEMRUserRoles:i}},Sa=Ca(),Na={key:0,class:"error-message"},ka={key:1,class:"error-message"},Pa={key:2,class:"error-message"},Ma={key:3,class:"error-message"},Fa={key:5,class:"password-section"},Ea={class:"ion-padding",slot:"content",style:{background:"rgba(255, 255, 255, 0.5)","border-bottom-left-radius":"10px","border-bottom-right-radius":"10px"}},xa={key:0},Oa={key:1},Ba={key:0,class:"error-message"},Va={style:{display:"flex",gap:"20px","margin-top":"8px"}},Aa={key:6,class:"error-message"},$a={key:7,class:"error-message"},Da={key:8,class:"error-message"},Ta={class:"form_el"},ke=36,Ra=re({__name:"UserFormModal",props:{isOpen:{type:Boolean},editingUser:{},isSaving:{type:Boolean}},emits:["save","close"],setup(b,{emit:x}){const v=b,i=x,c=g(!1),f=g(null),_=g([]),F=g({}),N=g(),V=g(),M=g(!1),r=g({name:!1,firstName:!1,lastName:!1,dateOfBirth:!1,gender:!1,roles:!1,programs:!1,usernameExists:!1}),n=g({name:"",firstName:"",lastName:"",password:"",gender:"",roles:[],programs:[]}),A=g([]),O=g([]);function j(e){const s=e.value.formattedDate,a=Ie(ya.toStandardHisFormat(s));N.value=a.toISOString(),console.log(N.value),r.value.dateOfBirth=!1}function G(){const e=["MZ161098","BT241293","LL040529","MG200829"];f.value&&e.includes(f.value.code)?c.value=!1:(c.value=!0,z("Please select a valid facility"))}const L=e=>{f.value=e.selected_location,G()},ee=()=>{r.value.name=!1,r.value.firstName=!1,r.value.lastName=!1,r.value.dateOfBirth=!1,r.value.gender=!1,r.value.roles=!1,r.value.programs=!1;let e=!0;return n.value.name.trim()||(r.value.name=!0,e=!1),n.value.firstName.trim()||(r.value.firstName=!0,e=!1),n.value.lastName.trim()||(r.value.lastName=!0,e=!1),N.value||(r.value.dateOfBirth=!0,e=!1),n.value.gender||(r.value.gender=!0,e=!1),n.value.roles.length||(r.value.roles=!0,e=!1),n.value.programs.length||(r.value.programs=!0,e=!1),e},J=()=>{if(!v.editingUser){const e=A.value.find(s=>s.program_id===ke);e&&(n.value.programs=[e.name],r.value.programs=!1)}},K=async()=>{try{const a=(await Ia.getEMRPrograms()).filter(d=>d.program_id===ke);A.value=a.map(d=>({program_id:d.program_id,name:d.name})),J()}catch(e){console.error("Failed to fetch programs:",e),z("Failed to load programs.")}},q=async()=>{try{const s=await Sa.getUserRoles();O.value=s.map(a=>a.name)}catch(e){z("Failed to load roles.")}},u=async e=>{const s=v.editingUser?v.editingUser.name!==e:!0;if(!e.trim()||!s)return r.value.usernameExists=!1,!0;try{const d=(await Fe.doesUsernameExist(e)).exists===!0;return r.value.usernameExists=d,!d}catch(a){return console.error("Error checking username existence:",a),z("Failed to verify username availability. Proceeding with caution."),r.value.usernameExists=!1,!0}};B(()=>n.value.name,async e=>{e.trim()?(r.value.name=!1,await u(e)):(r.value.name=!0,r.value.usernameExists=!1)}),B(()=>n.value.firstName,()=>{n.value.firstName.trim()&&(r.value.firstName=!1)}),B(()=>n.value.lastName,()=>{n.value.lastName.trim()&&(r.value.lastName=!1)}),B(()=>n.value.gender,()=>{n.value.gender&&(r.value.gender=!1)}),B(()=>n.value.roles,()=>{n.value.roles.length>0&&(r.value.roles=!1)}),B(()=>n.value.programs,()=>{n.value.programs.length>0&&(r.value.programs=!1)}),B(()=>v.isOpen,e=>{e&&!v.editingUser&&(ae(),J())});const Q=()=>{i("close")},W=["Password must be at least 8 characters long and include at least one uppercase letter, one number, and one special character (@#$%^&+=*!-), without spaces","Password does not match"],p=[{placeHolder:"new password",dataHandler:oe,dataValue:g(),show_error:g(!1),error_message:W[0]},{placeHolder:"repeat password",dataHandler:ne,dataValue:g(),show_error:g(!1),error_message:W[0]}];function oe(e){try{const s=e.target.value;p[0].dataValue.value=s,Z()}catch(s){}}function ne(e){try{const s=e.target.value;p[1].dataValue.value=s,Z()}catch(s){}}function Z(){const[e,s]=p.map(y=>y.dataValue.value),a=W[0],d=W[1];return p.forEach(y=>{y.error_message=a,y.show_error.value=!1}),p.map((y,H)=>{const D=!y.dataValue.value;return y.show_error.value=D,D}).some(y=>y)||p.map((y,H)=>{const D=ga(y.dataValue.value);return y.show_error.value=!D,D}).some(y=>!y)?!1:e!==s?(p.forEach(y=>{y.error_message=d,y.show_error.value=!0}),!1):!0}const le=async()=>{const e=ee();G();const s=await u(n.value.name),a=!v.editingUser||M.value;let d=!0;if(a&&(d=Z()),!e||c.value||!s||!d){!e||c.value?z("Please fill out all required fields."):s?d||z("Please check the password requirements."):z("The chosen username is already taken.");return}const S=n.value.programs.map(y=>{const H=A.value.find(D=>D.name===y);return H?H.program_id:null}).filter(y=>y!==null),$={...n.value,dateOfBirth:N.value,facility:f.value,programIDs:S,...a?{password:p[0].dataValue.value}:{}};i("save",$)},ae=()=>{n.value={name:"",firstName:"",lastName:"",password:"",dateOfBirth:"",gender:"",facility:null,roles:[],programs:[]},N.value=null,V.value=null,f.value=null,F.value={},c.value=!1,M.value=!1,Object.keys(r.value).forEach(e=>{r.value[e]=!1}),p.forEach(e=>{e.dataValue.value="",e.show_error.value=!1})};return B(()=>v.editingUser,e=>{if(e){ae(),M.value=!1,n.value={name:e.name,firstName:e.firstName||"",lastName:e.lastName||"",dateOfBirth:e.dateOfBirth||"",gender:(e.gender||"").toLowerCase(),roles:[...e.roles],programs:[...e.programs]},e.facility&&(f.value={code:e.facility.code,name:e.facility.name},console.log(">>: ",e.facility),F.value=e.facility);const s=se(()=>{if(!wa.isPlainObject(n.value.dateOfBirth)){const a=Ie(e.dateOfBirth);return{day:a.date(),month:a.month()+1,year:a.year(),formattedDate:a.format("DD/MMM/YYYY"),standardDate:a.format("YYYY-MM-DD"),miumformattedDate:a.toISOString()}}return e.dateOfBirth});V.value=s.value,N.value=s.value.miumformattedDate}else ae()},{immediate:!0}),ve(()=>{ae(),K(),q()}),(e,s)=>(m(),R(t(Oe),{"is-open":b.isOpen,onDidDismiss:Q},{default:o(()=>[l(t(Be),null,{default:o(()=>[l(t(_e),null,{default:o(()=>[l(t(Ve),null,{default:o(()=>[h(C(b.editingUser?"Edit User":"Add New User"),1)]),_:1}),l(t(ye),{slot:"end"},{default:o(()=>[l(t(Y),{onClick:Q,fill:"clear"},{default:o(()=>[l(t(P),{style:{"font-size":"35px"},icon:t(Ae)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),l(t(ge),{class:"ion-padding"},{default:o(()=>[w("form",{id:"user-form",onSubmit:Te(le,["prevent"])},[l(t(T),{class:k({"error-item":r.value.name||r.value.usernameExists})},{default:o(()=>[l(t(ue),{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.name=a),label:"Username","label-placement":"stacked",placeholder:"Enter username",required:"",class:k({"error-input":r.value.name||r.value.usernameExists})},null,8,["modelValue","class"])]),_:1},8,["class"]),r.value.name?(m(),U("div",Na," Username is required ")):r.value.usernameExists?(m(),U("div",ka," This username is already taken. ")):I("",!0),l(t(T),{class:k({"error-item":r.value.firstName})},{default:o(()=>[l(t(ue),{modelValue:n.value.firstName,"onUpdate:modelValue":s[1]||(s[1]=a=>n.value.firstName=a),label:"First Name","label-placement":"stacked",placeholder:"Enter first name",required:"",class:k({"error-input":r.value.firstName})},null,8,["modelValue","class"])]),_:1},8,["class"]),r.value.firstName?(m(),U("div",Pa," First name is required ")):I("",!0),l(t(T),{class:k({"error-item":r.value.lastName})},{default:o(()=>[l(t(ue),{modelValue:n.value.lastName,"onUpdate:modelValue":s[2]||(s[2]=a=>n.value.lastName=a),label:"Last Name","label-placement":"stacked",placeholder:"Enter last name",required:"",class:k({"error-input":r.value.lastName})},null,8,["modelValue","class"])]),_:1},8,["class"]),r.value.lastName?(m(),U("div",Ma," Last name is required ")):I("",!0),b.editingUser?(m(),R(t(T),{key:4,lines:"none",class:"toggle-item"},{default:o(()=>[l(t($e),{slot:"start",modelValue:M.value,"onUpdate:modelValue":s[3]||(s[3]=a=>M.value=a)},null,8,["modelValue"]),l(t(E),null,{default:o(()=>[...s[7]||(s[7]=[h("Update User Password?",-1)])]),_:1})]),_:1})):I("",!0),!b.editingUser||M.value?(m(),U("div",Fa,[l(t(T),{slot:"header",style:{"--background":"rgba(255, 255, 255, 0.5)"}},{default:o(()=>[l(t(E),{class:"previousLabel"},{default:o(()=>[...s[8]||(s[8]=[h("Password",-1)])]),_:1})]),_:1}),w("div",Ea,[l(pa,{placeholder:p[0].placeHolder,"new-password":p[0].dataValue.value,"repeat-password":p[1].dataValue.value,onUpdate_newPassword:p[0].dataHandler,onUpdate_repeatPassword:p[1].dataHandler},null,8,["placeholder","new-password","repeat-password","onUpdate_newPassword","onUpdate_repeatPassword"]),p[0].show_error.value&&p[1].show_error.value&&p[0].error_message===p[1].error_message?(m(),U("div",xa,[l(t(E),{class:"error-label"},{default:o(()=>[h(C(p[0].error_message),1)]),_:1})])):(m(),U("div",Oa,[p[0].show_error.value?(m(),R(t(E),{key:0,class:"error-label"},{default:o(()=>[h(C(p[0].error_message),1)]),_:1})):I("",!0),p[1].show_error.value?(m(),R(t(E),{key:1,class:"error-label"},{default:o(()=>[h(C(p[1].error_message),1)]),_:1})):I("",!0)]))])])):I("",!0),w("div",{class:k(["form_el",{"error-section":r.value.dateOfBirth}])},[w("h6",{style:{"font-size":"16px","font-weight":"400"},class:k({"error-label":r.value.dateOfBirth})}," Date Of Birth ",2),l(ha,{place_holder:"Date Of Birth",onDateUpDated:j,date_prop:V.value},null,8,["date_prop"]),r.value.dateOfBirth?(m(),U("div",Ba," Date of birth is required ")):I("",!0)],2),l(t(T),{class:k({"error-item":r.value.gender})},{default:o(()=>[l(t(E),{position:"stacked",class:k({"error-label":r.value.gender})},{default:o(()=>[...s[9]||(s[9]=[h("Gender",-1)])]),_:1},8,["class"]),l(t(De),{modelValue:n.value.gender,"onUpdate:modelValue":s[4]||(s[4]=a=>n.value.gender=a)},{default:o(()=>[w("div",Va,[l(t(T),{lines:"none",style:{"--padding-start":"0"}},{default:o(()=>[l(t(we),{slot:"start",value:"male"}),l(t(E),null,{default:o(()=>[...s[10]||(s[10]=[h("Male",-1)])]),_:1})]),_:1}),l(t(T),{lines:"none",style:{"--padding-start":"0"}},{default:o(()=>[l(t(we),{slot:"start",value:"female"}),l(t(E),null,{default:o(()=>[...s[11]||(s[11]=[h("Female",-1)])]),_:1})]),_:1})])]),_:1},8,["modelValue"])]),_:1},8,["class"]),r.value.gender?(m(),U("div",Aa," Gender is required ")):I("",!0),l(t(T),{class:k({"error-item":r.value.roles})},{default:o(()=>[l(t(Ue),{modelValue:n.value.roles,"onUpdate:modelValue":s[5]||(s[5]=a=>n.value.roles=a),label:"Roles","label-placement":"stacked",placeholder:"Select roles",multiple:"",class:k({"error-input":r.value.roles})},{default:o(()=>[(m(!0),U(te,null,fe(O.value,a=>(m(),R(t(be),{key:a,value:a},{default:o(()=>[h(C(a),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","class"])]),_:1},8,["class"]),r.value.roles?(m(),U("div",$a," At least one role is required ")):I("",!0),l(t(T),{class:k({"error-item":r.value.programs})},{default:o(()=>[l(t(Ue),{modelValue:n.value.programs,"onUpdate:modelValue":s[6]||(s[6]=a=>n.value.programs=a),label:"Programs","label-placement":"stacked",placeholder:"Select programs",multiple:"",class:k({"error-input":r.value.programs})},{default:o(()=>[(m(!0),U(te,null,fe(A.value,a=>(m(),R(t(be),{key:a.id,value:a.name},{default:o(()=>[h(C(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","class"])]),_:1},8,["class"]),r.value.programs?(m(),U("div",Da," At least one program is required ")):I("",!0),w("div",Ta,[s[12]||(s[12]=w("h6",{style:{"font-size":"16px","font-weight":"400"}},"Facility",-1)),l(_a,{show_error:c.value,onFacilitySelected:L,selected_district_ids:_.value,selected_location:F.value},null,8,["show_error","selected_district_ids","selected_location"])])],32)]),_:1}),l(t(Pe),null,{default:o(()=>[l(t(_e),null,{default:o(()=>[l(t(ye),{slot:"end"},{default:o(()=>[w("div",null,[l(t(Y),{onClick:Q,fill:"solid",disabled:b.isSaving},{default:o(()=>[...s[13]||(s[13]=[h(" Cancel ",-1)])]),_:1},8,["disabled"]),l(t(Y),{onClick:le,fill:"solid",disabled:b.isSaving,style:{"margin-left":"10px","margin-right":"10px"}},{default:o(()=>[b.isSaving?(m(),R(t(Re),{key:0,style:{height:"36px"},name:"crescent",slot:"start"})):I("",!0),h(" "+C(b.editingUser?"Update":"Create")+" User ",1)]),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"]))}}),La=pe(Ra,[["__scopeId","data-v-9408bf7e"]]),qa={class:"users-grid"},Ha={class:"user-header"},za=["src","alt"],Ya={class:"user-info"},ja={key:0,class:"user-meta"},Ga={key:0,class:"meta-item"},Ja={key:1,class:"meta-item"},Ka={class:"user-details"},Qa={key:0,class:"detail-item"},Wa={key:1,class:"detail-item"},Za={key:2,class:"detail-item"},Xa={class:"detail-item"},et={class:"detail-item"},at={class:"action-buttons"},tt={key:0,class:"empty-state"},st=re({__name:"miUsersTemplate",props:{initialSearchTerm:{default:""},initialStatusFilter:{default:"all"},initialItemsPerPage:{default:6},enableSearch:{type:Boolean,default:!0},enableStatusFilter:{type:Boolean,default:!0},enablePagination:{type:Boolean,default:!0},searchPlaceholder:{default:"Search users..."},searchDebounceTime:{default:300}},emits:["search-changed","status-filter-changed","users-filtered","user-edited","user-deleted","user-status-changed","user-created"],setup(b,{expose:x,emit:v}){const i=b,c=v,f=g([]),_=g(i.initialSearchTerm),F=g(i.initialStatusFilter),N=g(1),V=g(i.initialItemsPerPage),M=g(!1),r=g(null);let n=null;const A=e=>{var a,d,S,$,y,H,D,he;const{getAvatarUrl:s}=Ua();return{id:e.id,name:e.username,email:e.username,firstName:(a=e.profile)==null?void 0:a.firstName,lastName:(d=e.profile)==null?void 0:d.lastName,dateOfBirth:(S=e.profile)==null?void 0:S.dateOfBirth,gender:($=e.profile)==null?void 0:$.gender,facility:(H=(y=e.facilities)==null?void 0:y[0])!=null&&H.facility?{name:e.facilities[0].facility.facility_name,code:e.facilities[0].facility.facility_code}:null,roles:((D=e.roles)==null?void 0:D.map(ie=>ie.role.name))||[],programs:((he=e.programs)==null?void 0:he.map(ie=>ie.program.name))||[],status:"active",avatar:s(e.username),createdAt:new Date(e.createdAt),lastActive:new Date(e.updatedAt)}},O=se(()=>{let e=f.value;if(i.enableSearch&&_.value){const s=_.value.toLowerCase();e=e.filter(a=>a.name.toLowerCase().includes(s)||a.email.toLowerCase().includes(s)||a.roles&&a.roles.some(d=>d.toLowerCase().includes(s))||a.programs&&a.programs.some(d=>d.toLowerCase().includes(s))||a.gender&&a.gender.toLowerCase().includes(s)||a.facility&&a.facility.name&&a.facility.name.toLowerCase().includes(s))}return i.enableStatusFilter&&F.value!=="all"&&(e=e.filter(s=>s.status===F.value)),e}),j=se(()=>{if(!i.enablePagination)return O.value;const e=(N.value-1)*V.value,s=e+V.value;return O.value.slice(e,s)});B(()=>_.value,e=>{n&&clearTimeout(n),n=setTimeout(()=>{c("search-changed",e),N.value=1},i.searchDebounceTime)},{immediate:!1}),B(()=>F.value,e=>{c("status-filter-changed",e),N.value=1},{immediate:!1}),B(()=>O.value,e=>{c("users-filtered",e)},{deep:!0,immediate:!0});const G=e=>{N.value=e.page,V.value=e.itemsPerPage},L=e=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(e),ee=e=>{const s=new Date,a=new Date(e);let d=s.getFullYear()-a.getFullYear();const S=s.getMonth()-a.getMonth();return(S<0||S===0&&s.getDate()<a.getDate())&&d--,d},J=e=>{r.value=e,M.value=!0},K=()=>{M.value=!1,r.value=null},q=g(!1),u=async e=>{var s;try{if(q.value=!0,r.value){const a={roles:e.roles,programs:e.programs,facilities:[(s=e.facility)==null?void 0:s.code],profile:{firstName:e.firstName,lastName:e.lastName,gender:e.gender,dateOfBirth:e.dateOfBirth}};e.password&&(a.password=e.password);const d=await me.updateUser(r.value.id,a),S=f.value.findIndex($=>$.id===r.value.id);S!==-1&&(f.value[S]=A(d)),X.create({message:"User updated successfully",duration:2e3,color:"success"}).then($=>$.present())}else{const a=await Q(e),d=await me.register(a),S=A(d);S&&(f.value.push(S),c("user-created",S),(await X.create({message:"User created successfully",duration:2e3,color:"success"})).present())}K()}catch(a){(await X.create({message:"Error saving user: ".concat(a),duration:2e3,color:"danger"})).present()}finally{q.value=!1}},Q=async e=>{if(!e||!e.facility)throw new Error("Invalid user data. 'facility' is required.");return{username:e.name,password:e.password,roles:e.roles,programs:e.programs,programIds:e.programIDs,facilities:[e.facility.code],profile:{firstName:e.firstName,lastName:e.lastName,gender:e.gender,dateOfBirth:e.dateOfBirth}}},W=async e=>{(await Se.create({header:"Confirm Status Change",message:"Are you sure you want to ".concat(e.status==="active"?"deactivate":"activate"," ").concat(e.name,"?"),buttons:[{text:"Cancel",role:"cancel"},{text:"Confirm",handler:()=>{e.status=e.status==="active"?"inactive":"active",c("user-status-changed",e),X.create({message:"User ".concat(e.status==="active"?"activated":"deactivated"," successfully"),duration:2e3,color:"success"}).then(a=>a.present())}}]})).present()},p=async e=>{(await Se.create({header:"Confirm Delete",message:"Are you sure you want to delete ".concat(e.name,"? This action cannot be undone."),buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",role:"destructive",handler:()=>{const a=f.value.findIndex(d=>d.id===e.id);a!==-1&&(f.value.splice(a,1),c("user-deleted",e.id),X.create({message:"User deleted successfully",duration:2e3,color:"success"}).then(d=>d.present()))}}]})).present()},oe=e=>{_.value=e},ne=e=>{F.value=e},Z=async()=>{try{const e=await me.getUsers();f.value=e.map(A)}catch(e){console.error("Failed to fetch MIUM users:",e),X.create({message:"Failed to load users.",duration:2e3,color:"danger"}).then(s=>s.present())}},le=()=>{r.value=null,M.value=!0};return ve(async()=>{await Z()}),x({setSearchTerm:oe,setStatusFilter:ne,refreshUsers:Z,cleanup:()=>{n&&clearTimeout(n)},openAddUserModal:le,users:f.value,filteredUsers:O,paginatedUsers:j}),(e,s)=>(m(),U(te,null,[l(t(ge),{class:"ion-padding",style:{height:"80vh"}},{default:o(()=>[w("div",qa,[(m(!0),U(te,null,fe(j.value,a=>(m(),R(t(Le),{key:a.id,class:"user-card"},{default:o(()=>[l(t(qe),null,{default:o(()=>[w("div",Ha,[l(t(He),null,{default:o(()=>[w("img",{src:a.avatar,alt:a.name},null,8,za)]),_:2},1024),w("div",Ya,[l(t(ze),null,{default:o(()=>[h(C(a.name),1)]),_:2},1024),l(t(Ye),null,{default:o(()=>[h(C(a.email),1)]),_:2},1024),a.gender||a.dateOfBirth?(m(),U("div",ja,[a.gender?(m(),U("span",Ga,[l(t(P),{icon:t(je),class:"meta-icon"},null,8,["icon"]),h(" "+C(a.gender),1)])):I("",!0),a.dateOfBirth?(m(),U("span",Ja,[l(t(P),{icon:t(Ce),class:"meta-icon"},null,8,["icon"]),h(" "+C(ee(a.dateOfBirth))+" years old ",1)])):I("",!0)])):I("",!0)]),l(t(Ge),{color:a.status==="active"?"success":"medium",class:"status-chip"},{default:o(()=>[l(t(P),{icon:a.status==="active"?t(Je):t(Ke),slot:"start"},null,8,["icon"]),l(t(E),null,{default:o(()=>[h(C(a.status),1)]),_:2},1024)]),_:2},1032,["color"])])]),_:2},1024),l(t(Qe),null,{default:o(()=>[w("div",Ka,[a.roles&&a.roles.length?(m(),U("div",Qa,[l(t(P),{icon:t(We),class:"detail-icon"},null,8,["icon"]),w("span",null,C(a.roles.join(", ")),1)])):I("",!0),a.programs&&a.programs.length?(m(),U("div",Wa,[l(t(P),{icon:t(Ze),class:"detail-icon"},null,8,["icon"]),w("span",null,C(a.programs.join(", ")),1)])):I("",!0),a.facility?(m(),U("div",Za,[l(t(P),{icon:t(Xe),class:"detail-icon"},null,8,["icon"]),w("span",null,C(a.facility.name||"Assigned Facility"),1)])):I("",!0),w("div",Xa,[l(t(P),{icon:t(Ce),class:"detail-icon"},null,8,["icon"]),w("span",null,"Joined "+C(L(a.createdAt)),1)]),w("div",et,[l(t(P),{icon:t(ea),class:"detail-icon"},null,8,["icon"]),w("span",null,"Last active "+C(L(a.lastActive)),1)])]),w("div",at,[l(t(Y),{onClick:d=>J(a),fill:"outline",size:"small",color:"primary"},{default:o(()=>[l(t(P),{icon:t(aa),slot:"start"},null,8,["icon"]),s[0]||(s[0]=h(" Edit ",-1))]),_:1},8,["onClick"]),l(t(Y),{onClick:d=>W(a),fill:"outline",size:"small",color:a.status==="active"?"warning":"success"},{default:o(()=>[l(t(P),{icon:a.status==="active"?t(ta):t(sa),slot:"start"},null,8,["icon"]),h(" "+C(a.status==="active"?"Deactivate":"Activate"),1)]),_:2},1032,["onClick","color"]),l(t(Y),{onClick:d=>p(a),fill:"outline",size:"small",color:"danger"},{default:o(()=>[l(t(P),{icon:t(la),slot:"start"},null,8,["icon"]),s[1]||(s[1]=h(" Delete ",-1))]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),O.value.length===0?(m(),U("div",tt,[l(t(P),{icon:t(ra),class:"empty-icon"},null,8,["icon"]),s[2]||(s[2]=w("h3",null,"No users found",-1)),s[3]||(s[3]=w("p",null,"Try adjusting your search or filter criteria",-1))])):I("",!0)]),_:1}),l(t(Pe),null,{default:o(()=>[l(fa,{"total-items":O.value.length,"current-page":N.value,"items-per-page":V.value,"onUpdate:pagination":G},null,8,["total-items","current-page","items-per-page"])]),_:1}),l(La,{"is-open":M.value,"editing-user":r.value,"is-saving":q.value,onSave:u,onClose:K},null,8,["is-open","editing-user","is-saving"])],64))}}),lt=pe(st,[["__scopeId","data-v-deaf844d"]]),rt=re({__name:"UserNav",props:{searchTerm:{type:String,required:!0},statusFilter:{type:String,required:!0}},emits:["update:searchTerm","update:statusFilter","openAddUserModal"],setup(b,{emit:x}){return(v,i)=>(m(),U(te,null,[l(t(Ne),{class:"ion-align-items-center"},{default:o(()=>[l(t(de),{size:"8"},{default:o(()=>[l(t(oa),{value:b.searchTerm,onIonInput:i[0]||(i[0]=c=>v.$emit("update:searchTerm",c.detail.value)),placeholder:"Search users...","show-clear-button":"focus",debounce:"300"},null,8,["value"])]),_:1}),l(t(de),{size:"4",class:"ion-text-right"},{default:o(()=>[l(t(Y),{onClick:i[1]||(i[1]=c=>v.$emit("openAddUserModal")),fill:"solid"},{default:o(()=>[l(t(P),{icon:t(na),slot:"start"},null,8,["icon"]),i[3]||(i[3]=h(" Add User ",-1))]),_:1})]),_:1})]),_:1}),l(t(Ne),{class:"ion-padding-start ion-padding-end"},{default:o(()=>[l(t(de),{size:"12"},{default:o(()=>[l(t(ia),{value:b.statusFilter,onIonChange:i[2]||(i[2]=c=>v.$emit("update:statusFilter",c.detail.value))},{default:o(()=>[l(t(ce),{value:"all"},{default:o(()=>[l(t(E),null,{default:o(()=>[...i[4]||(i[4]=[h("All",-1)])]),_:1})]),_:1}),l(t(ce),{value:"active"},{default:o(()=>[l(t(E),null,{default:o(()=>[...i[5]||(i[5]=[h("Active",-1)])]),_:1})]),_:1}),l(t(ce),{value:"inactive"},{default:o(()=>[l(t(E),null,{default:o(()=>[...i[6]||(i[6]=[h("Inactive",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})],64))}}),ot={class:"sticky-user-nav"},nt=re({__name:"miusers",setup(b,{expose:x}){const v=g(""),i=g("all"),c=g([]),f=g(0),_=g();se(()=>v.value),se(()=>i.value);const F=u=>{v.value=u,console.log("Search term updated:",u)},N=u=>{i.value=u,console.log("Status filter updated:",u)},V=u=>{v.value!==u&&(v.value=u),console.log("Internal search changed:",u)},M=u=>{i.value!==u&&(i.value=u),console.log("Internal filter changed:",u)},r=u=>{f.value=u.length},n=u=>{console.log("User created:",u)},A=u=>{console.log("User edited:",u)},O=u=>{console.log("User deleted:",u)},j=u=>{console.log("User status changed:",u)},G=()=>{_.value?_.value.openAddUserModal():console.log("usersTemplateRef is not yet available.")},L=async()=>{try{console.log("Loading users...")}catch(u){console.error("Error loading users:",u)}},ee=async()=>{ma().setNavigationPayload("Manage Integrated Users",!0,!1,"/","home","")},J=()=>{_.value&&_.value.refreshUsers(),L()},K=u=>{v.value=u,_.value&&_.value.setSearchTerm(u)},q=u=>{i.value=u,_.value&&_.value.setStatusFilter(u)};return ve(async()=>{await ee(),await L()}),ua(()=>{_.value&&typeof _.value.cleanup=="function"&&_.value.cleanup()}),x({refreshUsers:J,setSearch:K,setFilter:q,searchTerm:v,statusFilter:i,usersList:c,filteredUsersCount:f}),(u,Q)=>(m(),R(t(da),null,{default:o(()=>[l(ca),l(t(ge),{fullscreen:!0},{default:o(()=>[w("div",ot,[l(rt,{fullscreen:!0,searchTerm:v.value,statusFilter:i.value,"onUpdate:searchTerm":F,"onUpdate:statusFilter":N,onOpenAddUserModal:G},null,8,["searchTerm","statusFilter"])]),l(lt,{ref_key:"usersTemplateRef",ref:_,"initial-users":c.value,"initial-search-term":v.value,"initial-status-filter":i.value,"search-debounce-time":500,"enable-search":!0,"enable-status-filter":!0,"enable-pagination":!0,onSearchChanged:V,onStatusFilterChanged:M,onUsersFiltered:r,onUserCreated:n,onUserEdited:A,onUserDeleted:O,onUserStatusChanged:j},null,8,["initial-users","initial-search-term","initial-status-filter"])]),_:1})]),_:1}))}}),gt=pe(nt,[["__scopeId","data-v-5071b8a1"]]);export{gt as default};

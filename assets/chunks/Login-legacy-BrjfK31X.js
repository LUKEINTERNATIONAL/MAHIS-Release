System.register(["./vendor-legacy-D3PRHnoP.js","../index-legacy-B1Y8M3LU.js","./Img-legacy-BNmikZ_d.js","./userService-legacy-H6OhlSfE.js","./wardsStore-legacy-C7KHJiM4.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-BGLXb50r.js"],function(e,a){"use strict";var t,l,s,n,r,o,i,u,c,d,v,p,m,f,g,w,h,y,P,x,b,A,k,_,I,S,C,M,q,E,U,L,z,R,j,D,F,N,$,H,O,T,K,G,B,J,Q,V,W,X,Y;return{setters:[e=>{t=e.D,l=e.d,s=e.r,n=e.ap,r=e.c,o=e.a,i=e.H,u=e.O,c=e.f,d=e.J,v=e.l,p=e.u,m=e.a4,f=e.k,g=e.br,w=e.aV,h=e.e,y=e.m,P=e.dn,x=e.E,b=e.Q,A=e.K,k=e.b3,_=e.X,I=e.c$,S=e.bF,C=e.c6,M=e.c5,q=e.N,E=e.bt,U=e.p,L=e.a7},e=>{z=e.v,R=e.a1,j=e.a2,D=e.t,F=e.U,N=e.G,$=e.a3,H=e.s,O=e.a4,T=e.a5,K=e.a6,G=e.S,B=e.a,J=e.a7,Q=e._},e=>{V=e.i},e=>{W=e.p,X=e.g},e=>{Y=e.u},null,null],execute:function(){var a=document.createElement("style");a.textContent='.login-page[data-v-8e33c718]{background-color:#fff}.login-container[data-v-8e33c718]{display:flex;justify-content:center;align-items:center;text-align:center;height:90vh}.login-title[data-v-8e33c718]{font-size:24px;margin-bottom:30px;font-weight:700;margin-top:20px}.input-fields[data-v-8e33c718]{margin-bottom:35px}.invalid-input[data-v-8e33c718]{--border-color: #ff4444 !important;--color: #ff4444 !important}.password-requirements[data-v-8e33c718]{text-align:left;margin-bottom:20px;padding:15px;background-color:#f8f9fa;border-radius:8px;border-left:4px solid #34af4d}.requirements-title[data-v-8e33c718]{margin:0 0 10px;font-weight:600;color:#333;font-size:14px}.requirements-list[data-v-8e33c718]{margin:0;padding-left:20px;list-style:none}.requirements-list li[data-v-8e33c718]{margin-bottom:5px;font-size:13px;color:#666;position:relative}.requirements-list li[data-v-8e33c718]:before{content:"✗";color:#f44;font-weight:700;position:absolute;left:-20px}.requirements-list li.valid[data-v-8e33c718]:before{content:"✓";color:#34af4d}.requirements-list li.valid[data-v-8e33c718]{color:#34af4d}.password-toggle[data-v-8e33c718]{cursor:pointer;position:absolute;margin-top:-73px;margin-left:130px;z-index:1000}.login-button[data-v-8e33c718]{color:#fff;margin-top:30px}.login-button[data-v-8e33c718]:disabled{opacity:.5;cursor:not-allowed}.signup-link[data-v-8e33c718]{margin-top:50px}.signup-link a[data-v-8e33c718]{text-decoration:underline;color:#34af4d;cursor:pointer}.signup-link a[data-v-8e33c718]:hover{color:#2d8f3f}.password-toggle[data-v-8e33c718]{font-size:20px}.login_img[data-v-8e33c718]{width:90px;margin:auto}ion-card[data-v-8e33c718]{min-width:330px}@media(max-width:902px){.login-page[data-v-8e33c718]{--ion-background-color: #ffffff}ion-card[data-v-8e33c718]{box-shadow:unset}}\n/*$vite$:1*/',document.head.appendChild(a);const Z=t("authStatusStore",{state:()=>({emrAuthenticated:!1,miumAuthenticated:!1,lastLoginAttempt:null,loginTimestamp:null,username:""}),getters:{isPartiallyAuthenticated:e=>e.emrAuthenticated||e.miumAuthenticated,isFullyAuthenticated:e=>e.emrAuthenticated&&e.miumAuthenticated,authenticationStatus:e=>e.emrAuthenticated&&e.miumAuthenticated?"full":e.emrAuthenticated||e.miumAuthenticated?"partial":"none",authenticatedSystems:e=>{const a=[];return e.emrAuthenticated&&a.push("EMR"),e.miumAuthenticated&&a.push("MIUM"),a},failedSystems:e=>{const a=[];return e.emrAuthenticated||a.push("EMR"),e.miumAuthenticated||a.push("MIUM"),a}},actions:{setEMRAuthenticated(e){this.emrAuthenticated=e,e&&(this.loginTimestamp=new Date)},setMIUMAuthenticated(e){this.miumAuthenticated=e},setUsername(e){this.username=e},recordLoginAttempt(){this.lastLoginAttempt=new Date},clearAuthStatus(){this.emrAuthenticated=!1,this.miumAuthenticated=!1,this.loginTimestamp=null,this.lastLoginAttempt=null,this.username=""},hasSystemAccess(e){return"EMR"===e?this.emrAuthenticated:this.miumAuthenticated}},persist:!0}),ee={class:"login-container"},ae={key:0,style:{"justify-content":"center",display:"block"}},te={style:{"font-size":"15px"}},le={style:{"font-size":"12px",color:"#34af4d"}},se={key:1},ne={style:{"font-size":"15px"}},re={key:0},oe={style:{"text-align":"left"}},ie={class:"signup-link"},ue={style:{display:"flex","justify-content":"center","align-items":"center"}},ce={key:1},de={style:{"text-align":"left"}},ve={key:0,class:"password-requirements"},pe={class:"requirements-list"},me={class:"signup-link"};e("default",Q(l({__name:"Login",setup(e){const a=s(""),t=s(""),l=s(""),Q=s(!1),fe=s(!1),ge=s("test"),we=s(new J),he=s({username:"",currentPassword:"",newPassword:"",confirmPassword:""}),ye=s(!1),Pe=s(!1),xe=s(!1),be=n(),Ae=z(),ke=R(),_e=r(()=>""!==he.value.username.trim()&&""!==he.value.currentPassword.trim()&&""!==he.value.newPassword.trim()&&""!==he.value.confirmPassword.trim()&&j(he.value.newPassword)&&he.value.newPassword===he.value.confirmPassword&&he.value.newPassword!==he.value.currentPassword),Ie=()=>{fe.value=!fe.value,fe.value&&(he.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""})},Se=()=>{D("Help functionality to be implemented")},Ce=async()=>{if(!_e.value)return D("Please complete all fields correctly"),void D("Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character.");try{const e=await we.value.requestLogin(he.value.currentPassword,he.value.username);if(e){const{authorization:a}=e,{token:t,user:l}=a;l&&(localStorage.setItem("apiKey",t),await F.updateUser(l.user_id,{password:he.value.newPassword}),N("Password changed successfully!"),await we.value.requestLogin(he.value.newPassword,he.value.username),he.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""},fe.value=!1,localStorage.setItem("apiKey",""))}}catch(e){H(e instanceof $?"Current password is incorrect":`Error changing password: ${e}`)}},Me=async()=>{const e=Z();if(!a.value||!t.value)return{success:!1,error:null,validationError:!0};we.value.setUsername(a.value),e.setUsername(a.value);try{return await we.value.login(t.value),await(async()=>{const e=R(),a=await X();a&&(e.setUserFacilityName(a.name),e.setFacilityLocation(a),localStorage.setItem("facility_code",a.code))})(),await(async()=>{const e=await we.value.checkUserPrograms(void 0);null!=e&&e.programs&&B().setAuthorizedPrograms(null==e?void 0:e.programs)})(),await K(),await W(),await Y().fetchWards(),e.setEMRAuthenticated(!0),ke.setLoginStatus(!0),{success:!0,error:null}}catch(l){return e.setEMRAuthenticated(!1),ke.setLoginStatus(!1),{success:!1,error:l}}},qe=async()=>{if(G.getLanConnectionStatus()||G.getPouchDbStatus())return{success:!0,error:null};const e=Z();if(!a.value||!t.value)return{success:!1,error:null,validationError:!0};we.value.setUsername(a.value);try{return await we.value.loginToMIUM(t.value),e.setMIUMAuthenticated(!0),{success:!0,error:null}}catch(l){return e.setMIUMAuthenticated(!1),{success:!1,error:l}}},Ee=async()=>{const e=Z();if(!a.value||!t.value)return void D("Complete form to log in");e.recordLoginAttempt();const[l,s]=await Promise.allSettled([Me(),qe()]),n="fulfilled"===l.status&&l.value.success,r="fulfilled"===s.status&&s.value.success;if(n)be.push("/home");else if(n||r)!n&&r&&("fulfilled"===l.status?l.value.error:l.reason);else{const e="fulfilled"===l.status?l.value.error:l.reason;e instanceof $?H("Invalid username or password"):e instanceof O?(Ie(),H("Please change your password",5e4)):e instanceof T?(Ie(),H("Your password has expired. Please change your password",5e4)):H(`${e}`,5e4)}};return o(async()=>{ke.checkLoginStatus()&&be.push("/home"),ke.setLoginStatus(!1),await we.value.loadConfig(),l.value=localStorage.getItem("core_version")||"",await(async()=>{Ae.terminate(),await z().postData("SET_OFFLINE_PROGRAMS")})()}),(e,s)=>{const n=i("ion-icon");return c(),u(p(L),null,{default:d(()=>[v(p(m),{class:"ion-padding login-page"},{default:d(()=>[f("div",ee,[v(p(g),{style:{"background-color":"#fff"}},{default:d(()=>[v(p(w),null,{default:d(()=>[v(p(P),{class:"login_img",src:p(V)("mw.png"),id:"logo"},null,8,["src"]),v(p(x),{class:"login-title"},{default:d(()=>["development"===ge.value||"test"===ge.value?(c(),h("span",ae,[f("div",null,[s[11]||(s[11]=b(" MaHIS ",-1)),f("small",te,"(v"+A(l.value)+")",1)]),f("div",le,"("+A(ge.value)+")",1)])):(c(),h("span",se,[s[12]||(s[12]=b(" MaHIS ",-1)),f("small",ne,"(v"+A(l.value)+")",1)]))]),_:1}),fe.value?y("",!0):(c(),h("div",re,[f("span",oe,[v(p(k),{value:a.value,onIonInput:s[0]||(s[0]=e=>a.value=e.target.value||""),type:"text",label:"Username",ref:"usernameRef","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:d(()=>[v(p(_),{slot:"end"},{default:d(()=>[v(n,{icon:p(I)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),v(p(k),{value:t.value,onIonInput:s[2]||(s[2]=e=>t.value=e.target.value||""),type:Q.value?"text":"password",label:"Password",ref:"passwordRef","label-placement":"floating",fill:"outline",placeholder:"Enter Password",class:"input-fields",required:"",onKeydown:S(Ee,["enter"])},{default:d(()=>[v(p(_),{slot:"end"},{default:d(()=>[v(n,{icon:Q.value?p(C):p(M),onClick:s[1]||(s[1]=e=>Q.value=!Q.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"])]),v(p(q),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:Ee,class:"login-button"},{default:d(()=>[...s[13]||(s[13]=[b(" Login ",-1)])]),_:1}),f("p",ie,[s[17]||(s[17]=b(" For help click ",-1)),f("a",{href:"#",onClick:E(Se,["prevent"])},"Here"),s[18]||(s[18]=b()),s[19]||(s[19]=f("br",null,null,-1)),f("div",ue,[v(p(q),{fill:"clear",size:"small",onClick:Ie,style:{display:"inline","--padding-start":"2px","--padding-end":"2px"}},{default:d(()=>[...s[14]||(s[14]=[f("span",{style:{"text-decoration":"underline",color:"#34af4d",cursor:"pointer"}}," Change Password ",-1)])]),_:1}),s[16]||(s[16]=b(" | ",-1)),v(p(q),{fill:"clear",size:"small",onClick:s[3]||(s[3]=e=>{return a="/downloads",void be.push(a);var a}),style:{display:"inline","--padding-start":"2px","--padding-end":"2px"}},{default:d(()=>[...s[15]||(s[15]=[f("span",{style:{"text-decoration":"underline",color:"#34af4d",cursor:"pointer"}}," Download MaHIS ",-1)])]),_:1})])])])),fe.value?(c(),h("div",ce,[s[22]||(s[22]=f("h3",{style:{"text-align":"center","margin-bottom":"20px",color:"#34af4d"}},"Change Password",-1)),f("span",de,[v(p(k),{value:he.value.username,onIonInput:s[4]||(s[4]=e=>he.value.username=e.target.value||""),type:"text",label:"Username","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:d(()=>[v(p(_),{slot:"end"},{default:d(()=>[v(n,{icon:p(I)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),v(p(k),{value:he.value.currentPassword,onIonInput:s[6]||(s[6]=e=>he.value.currentPassword=e.target.value||""),type:ye.value?"text":"password",label:"Current Password","label-placement":"floating",fill:"outline",placeholder:"Enter Current Password",class:"input-fields",required:""},{default:d(()=>[v(p(_),{slot:"end"},{default:d(()=>[v(n,{icon:ye.value?p(C):p(M),onClick:s[5]||(s[5]=e=>ye.value=!ye.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"]),v(p(k),{value:he.value.newPassword,onIonInput:s[8]||(s[8]=e=>he.value.newPassword=e.target.value||""),type:Pe.value?"text":"password",label:"New Password","label-placement":"floating",fill:"outline",placeholder:"Enter New Password",class:U(["input-fields",{"invalid-input":he.value.newPassword&&!p(j)(he.value.newPassword)}]),required:""},{default:d(()=>[v(p(_),{slot:"end"},{default:d(()=>[v(n,{icon:Pe.value?p(C):p(M),onClick:s[7]||(s[7]=e=>Pe.value=!Pe.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"]),v(p(k),{value:he.value.confirmPassword,onIonInput:s[10]||(s[10]=e=>he.value.confirmPassword=e.target.value||""),type:xe.value?"text":"password",label:"Confirm New Password","label-placement":"floating",fill:"outline",placeholder:"Confirm New Password",class:U(["input-fields",{"invalid-input":he.value.confirmPassword&&he.value.newPassword!==he.value.confirmPassword}]),required:""},{default:d(()=>[v(p(_),{slot:"end"},{default:d(()=>[v(n,{icon:xe.value?p(C):p(M),onClick:s[9]||(s[9]=e=>xe.value=!xe.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"])]),he.value.newPassword?(c(),h("div",ve,[s[20]||(s[20]=f("p",{class:"requirements-title"},"Password Requirements:",-1)),f("ul",pe,[f("li",{class:U({valid:he.value.newPassword.length>=8})},"At least 8 characters",2),f("li",{class:U({valid:/[A-Z]/.test(he.value.newPassword)})},"One uppercase letter",2),f("li",{class:U({valid:/[0-9]/.test(he.value.newPassword)})},"One number",2),f("li",{class:U({valid:/[@#$%^&+=*!-]/.test(he.value.newPassword)})}," One special character (@#$%^&+=*!-) ",2),f("li",{class:U({valid:he.value.newPassword!==he.value.currentPassword&&""!==he.value.currentPassword})}," Different from current password ",2)])])):y("",!0),v(p(q),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:Ce,class:"login-button",disabled:!_e.value},{default:d(()=>[...s[21]||(s[21]=[b(" Change Password ",-1)])]),_:1},8,["disabled"]),f("p",me,[f("a",{href:"#",onClick:E(Ie,["prevent"])},"Back to Login")])])):y("",!0)]),_:1})]),_:1})])]),_:1})]),_:1})}}}),[["__scopeId","data-v-8e33c718"]]))}}});

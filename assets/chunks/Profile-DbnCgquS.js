import{c as z,d as ee,r as _,b2 as M,w as I,a as te,n as $,e as de,f as R,l as w,J as O,u as B,aV as ue,O as J,bw as ce,aS as Be,aR as xe,Q as Oe,ap as ke,cr as Le,a4 as qe,k as q,m as $e,i as U,bT as Re,v as F,a7 as Ee,ba as Y}from"./vendor-BataJFSH.js";import{n as v,u as ne,aG as le,t as E,ai as A,b as me,K as ae,_ as fe,aF as He,b7 as ve,b8 as ze,b9 as We,a_ as Ue,ba as Fe,e as Ye,a$ as Ke,i as je,a1 as Je,f as Qe,T as Xe,M as Ze,V as Ve,H as se,b1 as Z,bb as et,aU as be,bc as tt,ah as V,bd as nt,a3 as at,S as it}from"../index-BPAV0PIM.js";import{D as ot}from"./DemographicBar-moo3cMAH.js";import{u as st,_ as rt}from"./useFormWizard-WA0BdVFf.js";import{M as dt,a as ut,W as ct}from"./MedicalHistory-CpWOsws9.js";import{u as re}from"./ComplicationsStore-BbalwQUK.js";import{s as lt,c as mt,u as ft}from"./nonPharmaTherapyStore-3IJdi0FN.js";import{l as pt}from"./lodash-NJiRuGo9.js";import{a as Te,b as gt}from"./formatServerData-CbmK6vhK.js";import{u as ht}from"./usePatientProfile-bz2A3efD.js";import"./apexcharts-BVd6_RNM.js";import"./drug_prescription_service-BAhzFmOz.js";import"./patient_diagnosis_service-DYgFUTEi.js";import"./Registration-D0rECIgN.js";import"./useLocation-rHj0LctY.js";import"./vaccines_service-CGrLV3TL.js";import"./sms_service-BFtMRkZ8.js";import"./EIRreportsStore-DPBsJTJR.js";import"./Export-BAdyAmdU.js";import"./user_role_management-BvjpEsZZ.js";import"./useNeonatalEnrollmentStore-eD5cG8pe.js";import"./enrollment-DU-PLRUa.js";import"./Outcome-YCiaWoXd.js";import"./wardsStore-DR-px5YM.js";const yt=()=>{const k=()=>{},S=[{id:1,name:"Caesarean section"},{id:2,name:"Vacuum extraction delivery"},{id:3,name:"Breech delivery"},{id:4,name:"SVD"},{id:5,name:"Other"}],c=[{id:1,name:"Asphyxia"},{id:2,name:"Pre-eclampsia"},{id:3,name:"Eclampsia"},{id:4,name:"Puerperal Sepsis"},{id:5,name:"Baby died within 24hrs of birth"},{id:6,name:"Convulsions"},{id:7,name:"Gestational diabetes mellitus"},{id:8,name:"Heavy bleeding"},{id:9,name:"Macrosomia"},{id:10,name:"Perineal tear (3rd or 4th degree)"},{id:11,name:"Other"},{id:12,name:"None"}],r=y=>{const i=[];for(let n=0;n<y;n++)i.push({componentType:"multiSelectInputField",header:"Specify mode of delivery (child ".concat(n+1,")"),name:"Mode of delivery ".concat(n),trackBy:"id",isMultiple:!1,required:!0,options:S,grid:{s:"12",md:"6"},validation:(e,a)=>{const t=parseInt(a==null?void 0:a.LiveBirths)||0;return n>=t?null:!e||e===""?"Mode of delivery for child ".concat(n+1," is required"):null},condition:e=>{const a=parseInt(e.LiveBirths)||0;return a>0&&a>n},onChange:(e,a)=>{const t={},o=S.find(u=>u.id===e),s=(o==null?void 0:o.name)||"";return s!=="Caesarean section"&&s!=="Other"&&(t["Specify ".concat(n)]=""),t}});i.push({grid:{s:"12"},componentType:"Dashes",condition:n=>(parseInt(n.LiveBirths)||0)>0});for(let n=0;n<y;n++)i.push({componentType:"inputField",header:"Specify delivery details (child ".concat(n+1,")"),name:"Specify ".concat(n),icon:v.editPen,required:!0,grid:{s:"12",md:"6"},validation:(e,a)=>{const t=parseInt(a==null?void 0:a.LiveBirths)||0;if(n>=t)return null;const o=a==null?void 0:a["Mode of delivery ".concat(n)],s=S.find(f=>f.id===o),u=(s==null?void 0:s.name)||"";return(u==="Caesarean section"||u==="Other")&&(!e||e==="")?"Please specify details for child ".concat(n+1):null},condition:e=>{const a=parseInt(e.LiveBirths)||0,t=e["Mode of delivery ".concat(n)],o=S.find(u=>u.id===t),s=(o==null?void 0:o.name)||"";return a>0&&a>n&&(s==="Caesarean section"||s==="Other")}});return i},m=z(()=>{const y=[{componentType:"inputField",header:"Gravida",name:"Gravida",icon:v.editPen,required:!0,grid:{s:"12"},validation:n=>{if(!n||n==="")return"Gravida is required";const e=Number(n);return isNaN(e)?"Gravida can only be number":e<0?"Gravida must be 0 or greater":e>30?"Gravida must be 30 or less":null},onChange:(n,e)=>{if(!e)return{};const a=n?parseInt(n):null,t={};if(a===null||a===0||n==="")t["Abortions/Miscarriages"]="",t.Stillbirths="",t.LiveBirths="",t.Parity="";else if(a===1){t["Abortions/Miscarriages"]="",t.Stillbirths="",t.LiveBirths="",t.Parity="",t["Gestational age at last live birth"]="",t["Last live birth had congenital abnormalities"]="",t["past pregnancies complications"]=[];for(let o=0;o<30;o++)t["Mode of delivery ".concat(o)]="",t["Specify ".concat(o)]=""}else{const o=parseInt(e["Abortions/Miscarriages"])||0;if(!isNaN(a)&&!isNaN(o)){t.Parity=Math.max(0,a-o-1);const s=parseInt(e.Stillbirths)||0;if(!isNaN(s)){const u=a-o-1;t.LiveBirths=Math.max(0,u-s)}}}return t}},{componentType:"inputField",header:"Abortions/Miscarriages",name:"Abortions/Miscarriages",icon:v.editPen,required:!0,grid:{s:"12",md:"6"},validation:(n,e)=>{const a=parseInt(e==null?void 0:e.Gravida)||0;if(a<=1)return null;if(!n||n==="")return"Abortions/Miscarriages is required";const t=Number(n);return isNaN(t)?"Abortions/Miscarriages can only be number":t<0?"Abortions/Miscarriages must be 0 or greater":a>0&&t>=a?"Abortions/Miscarriages cannot be equal to or greater than Gravida":null},condition:n=>parseInt(n.Gravida)>1,onChange:(n,e)=>{if(!e)return{};const a=parseInt(e.Gravida)||0,t=n?parseInt(n):0,o={};if(!isNaN(a)&&!isNaN(t)&&a>1){const s=Math.max(0,a-t-1);o.Parity=s;const u=parseInt(e.Stillbirths)||0;isNaN(u)||(o.LiveBirths=Math.max(0,s-u))}else o.Parity="",o.LiveBirths="";return o}},{componentType:"inputField",header:"Stillbirths",name:"Stillbirths",icon:v.editPen,required:!0,grid:{s:"12",md:"6"},validation:(n,e)=>{if((parseInt(e==null?void 0:e.Gravida)||0)<=1)return null;if(!n||n==="")return"Stillbirths is required";const t=Number(n);if(isNaN(t))return"Stillbirths can only be number";if(t<0)return"Stillbirths must be 0 or greater";const o=parseInt(e==null?void 0:e.Parity)||0;return o>0&&t>o?"Stillbirths cannot exceed Parity":null},condition:n=>parseInt(n.Gravida)>1,onChange:(n,e)=>{if(!e)return{};const a=parseInt(e.Parity)||0,t=n?parseInt(n):0;return!isNaN(a)&&!isNaN(t)?{LiveBirths:Math.max(0,a-t)}:{LiveBirths:""}}},{componentType:"inputField",header:"Live births",name:"LiveBirths",disabled:!0,grid:{s:"12",md:"6"},condition:n=>parseInt(n.Gravida)>1},{componentType:"inputField",header:"Parity",name:"Parity",required:!1,disabled:!0,grid:{s:"12",md:"6"},condition:n=>parseInt(n.Gravida)>1},{grid:{s:"12"},componentType:"Dashes"}],i=r(30);return y.push(...i),y.push({componentType:"Alert",name:"FirstPregnancyAlert",backgroundColor:"#FFD700",status:"info",icon:"info-circle",textColor:"#000000",value:"First pregnancy, proceed.",grid:{s:"12"},condition:n=>parseInt(n.Gravida)===1},{componentType:"radioButtonField",header:"What was the gestational age at last live birth?",name:"Gestational age at last live birth",options:[{value:"<28 weeks",label:"<28 weeks"},{value:"28–34 weeks",label:"28–34 weeks"},{value:"35–36 weeks",label:"35–36 weeks"},{value:"≥37 weeks (Full term)",label:"≥37 weeks (Full term)"}],grid:{s:"12"},condition:n=>parseInt(n.Gravida)>1},{grid:{s:"12"},componentType:"Dashes"},{componentType:"radioButtonField",header:"Last live birth had congenital abnormalities?",name:"Last live birth had congenital abnormalities",options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],grid:{s:"12"},condition:n=>parseInt(n.Gravida)>1},{grid:{s:"12"},componentType:"Dashes"},{componentType:"Heading",name:"Past Pregnancy Complications",grid:{s:"12"},condition:n=>parseInt(n.Gravida)>1},{componentType:"multiSelectInputField",header:"Did the woman have any of the complications during the past pregnancies?",name:"past pregnancies complications",isMultiple:!0,trackBy:"id",grid:{s:"12"},options:c,validation:n=>{if(!n||n.length===0)return"Please select at least one option or 'None'";if(Array.isArray(n)){const e=n.some(t=>t.name==="None"),a=n.some(t=>t.name!=="None");if(e&&a)return"'None' cannot be selected with other complications"}return null},condition:n=>parseInt(n.Gravida)>1,onChange:(n,e)=>{if(!e||!Array.isArray(n))return{};const a={};if(Array.isArray(n)){const t=n.some(s=>s.name==="None"),o=n.some(s=>s.name==="Other");if(t){const s=n.find(u=>u.name==="None");a["past pregnancies complications"]=[s],a["Other complications notes"]=""}o||(a["Other complications notes"]="")}return a}},{grid:{s:"12"},componentType:"Dashes"},{componentType:"inputField",header:"Specify other complications*",name:"Other complications notes",icon:v.editPen,required:!0,grid:{s:"12"},validation:(n,e)=>{const a=e==null?void 0:e["past pregnancies complications"];if(Array.isArray(a)){const t=a.some(s=>s.name==="Other"),o=a.some(s=>s.name==="None");if(t&&!o&&(!n||n===""))return"Please specify other complications"}return null},condition:n=>{const e=parseInt(n.Gravida),a=n["past pregnancies complications"];if(e<=1||!Array.isArray(a))return!1;const t=a.some(s=>s.name==="Other"),o=a.some(s=>s.name==="None");return t&&!o}}),y});return{resetForm:k,pastObstetricHistoryFormSection:m}},vt={class:"container"},bt=ee({__name:"PastObstetricHistory",setup(k,{expose:S}){const c=yt(),r=_(null),m=_(0),y=ne(),{patient:i}=M(y);I(()=>{var t;return(t=i.value)==null?void 0:t.patientID},async(t,o)=>{t&&t!==o&&(m.value++,await $())});const n=async()=>{if(!r.value)return console.error("Form reference is not available"),!1;const t=r.value.validateForm();if(t)return E("Please fix validation errors before submitting"),console.log("Validation errors:",t),!1;const o=r.value.getFormValues(),s=await e(o);return s.length===0?(E("No past obstetric history data to save"),!1):(await A.addObsToEncounterPatient(s,me.PAST_OBSTETRIC_HISTORY),m.value++,await $(),ae("Past obstetric history saved successfully"),!0)},e=async t=>{const o=[],s=["Gravida","Abortions/Miscarriages","Stillbirths","LiveBirths","Parity","Was last live birth preterm?","Last live birth preterm was full term","Last live birth had congenital abnormalities","Other complications notes"];for(const g of s){const G=t[g];G&&G!==""&&G!==!1&&o.push(await A.buildValueText(g,String(G)))}const u=t["past pregnancies complications"];if(Array.isArray(u)&&u.length>0)for(const g of u)g&&g!==""&&o.push(await A.buildValueText("Past pregnancy complication",g));const f=[{id:1,name:"Caesarean section"},{id:2,name:"Vacuum extraction delivery"},{id:3,name:"Breech delivery"},{id:4,name:"SVD"},{id:5,name:"Other"}],h=parseInt(t.LiveBirths)||0;for(let g=0;g<h;g++){const G=t["Mode of delivery ".concat(g)];if(G){const N=f.find(j=>j.id===G),p=(N==null?void 0:N.name)||"";p&&o.push(await A.buildValueText("Mode of delivery (child ".concat(g+1,")"),p));const K=t["Specify ".concat(g)];if((p==="Caesarean section"||p==="Other")&&K&&K!==""){const j=p==="Caesarean section"?"Caesarean section details (child ".concat(g+1,")"):"Other mode of delivery details (child ".concat(g+1,")");o.push(await A.buildValueText(j,K))}}}return o};te(async()=>{await $()});const a=z(()=>c.pastObstetricHistoryFormSection.value);return S({validateForm:()=>{var t;return(t=r.value)==null?void 0:t.validateForm()},onSubmit:n,resetForm:()=>{m.value++}}),(t,o)=>(R(),de("div",vt,[w(B(ce),{class:"section"},{default:O(()=>[w(B(ue),null,{default:O(()=>[(R(),J(le,{formData:a.value,ref_key:"formRef",ref:r,key:m.value},null,8,["formData"]))]),_:1})]),_:1})]))}}),Tt=fe(bt,[["__scopeId","data-v-fccd9042"]]),Dt=()=>{const k=()=>{},S=(r,m,y=1)=>{const i=[];for(let n=0;n<r;n++){const e=y+n,a="".concat(m).concat(e);i.push({componentType:"dateInputField",header:"TTV ".concat(e," immunisation date*"),name:a,icon:v.calenderPrimary,required:!0,grid:{s:"12",md:(r<=2,"6"),lg:r>=3?"4":"6"},validation:(t,o)=>{const s=o==null?void 0:o["The woman received tetanus doses for immunization?"],u=o==null?void 0:o["Number of tetanus doses"];return s==="fully immunised"&&(!t||t==="")||s==="under immunised"&&(u==="one dose"&&e===1||u==="two doses"&&e<=2||u==="three doses"&&e<=3||u==="four doses"&&e<=4)&&(!t||t==="")?"TTV ".concat(e," date is required"):null},condition:t=>{const o=t["The woman received tetanus doses for immunization?"],s=t==null?void 0:t["Number of tetanus doses"];if(o==="fully immunised")return!0;if(o==="under immunised"){if(s==="one dose")return e===1;if(s==="two doses")return e<=2;if(s==="three doses")return e<=3;if(s==="four doses")return e<=4}return!1}})}return i},c=z(()=>{const r=[{componentType:"radioButtonField",header:"Gestation age to be used*",name:"Gestation age to be used",required:!0,options:[{value:"GA by LNMP",label:"GA by LNMP"},{value:"GA by ultrasound",label:"GA by ultrasound"},{value:"GA by palpation",label:"GA by palpation"}],grid:{s:"12"},validation:i=>!i||i===""?"Gestation age to be used is required":null,onChange:(i,n)=>{const e={};return e.lmnpDate="",e.lmnpGestationAge="",e["Estimated date of delivery"]="",e.Ultrasound="",e.specify="",e["ultrasound lmnp date"]="",e["Estimated date of delivery from ultrasound"]="",e["Gestation age by palpation"]="",e["date of delivery"]="",e}},{componentType:"dateInputField",header:"LNMP date*",name:"lmnpDate",icon:v.calenderPrimary,required:!0,grid:{s:"12",md:"6"},validation:(i,n)=>(n==null?void 0:n["Gestation age to be used"])==="GA by LNMP"&&(!i||i==="")?"LNMP date is required":null,condition:i=>i["Gestation age to be used"]==="GA by LNMP",onChange:(i,n)=>{const e={};if(!i||i==="")return e.lmnpGestationAge="",e["Estimated date of delivery"]="",e;const a=Date.parse(i);if(!isNaN(a)){const o=(new Date().getTime()-a)/(1e3*60*60*24),s=Math.floor(o/7);e.lmnpGestationAge=s;const u=new Date(a+280*24*60*60*1e3);e["Estimated date of delivery"]=u.toISOString().split("T")[0]}return e}},{componentType:"inputField",header:"Gestation age (weeks)",name:"lmnpGestationAge",disabled:!0,grid:{s:"12",md:"3"},condition:i=>i["Gestation age to be used"]==="GA by LNMP"},{componentType:"dateInputField",header:"EDD",name:"Estimated date of delivery",icon:v.calenderPrimary,disabled:!0,grid:{s:"12",md:"3"},condition:i=>i["Gestation age to be used"]==="GA by LNMP"},{componentType:"dateInputField",header:"Date for ultrasound",name:"Ultrasound",icon:v.calenderPrimary,required:!0,grid:{s:"12",md:"6"},validation:(i,n)=>(n==null?void 0:n["Gestation age to be used"])==="GA by ultrasound"&&(!i||i==="")?"Ultrasound date is required":null,condition:i=>i["Gestation age to be used"]==="GA by ultrasound"},{componentType:"inputField",header:"Gestation age from ultrasound (weeks)*",name:"specify",icon:v.editPen,required:!0,grid:{s:"12",md:"6"},validation:(i,n)=>{if((n==null?void 0:n["Gestation age to be used"])==="GA by ultrasound"){if(!i||i==="")return"Gestation age from ultrasound is required";const a=Number(i);if(isNaN(a))return"Gestation age must be a number";if(a<0||a>42)return"Gestation age must be between 0 and 42 weeks"}return null},condition:i=>i["Gestation age to be used"]==="GA by ultrasound",onChange:(i,n)=>{const e={};if(!i||i==="")return e["ultrasound lmnp date"]="",e["Estimated date of delivery from ultrasound"]="",e;const a=parseInt(i);if(!isNaN(a)){const t=new Date,o=new Date(t.getTime()-a*7*24*60*60*1e3);e["ultrasound lmnp date"]=o.toISOString().split("T")[0];const s=new Date(t.getTime()-a*7*24*60*60*1e3),u=new Date(s.getTime()+280*24*60*60*1e3);e["Estimated date of delivery from ultrasound"]=u.toISOString().split("T")[0]}return e}},{componentType:"dateInputField",header:"LMNP date from ultrasound",name:"ultrasound lmnp date",icon:v.calenderPrimary,disabled:!0,grid:{s:"12",md:"6"},condition:i=>i["Gestation age to be used"]==="GA by ultrasound"},{componentType:"dateInputField",header:"EDD",name:"Estimated date of delivery from ultrasound",icon:v.calenderPrimary,disabled:!0,grid:{s:"12",md:"6"},condition:i=>i["Gestation age to be used"]==="GA by ultrasound"},{componentType:"inputField",header:"Enter gestation age by palpation (weeks)",name:"Gestation age by palpation",icon:v.editPen,required:!0,grid:{s:"12",md:"6"},validation:(i,n)=>{if((n==null?void 0:n["Gestation age to be used"])==="GA by palpation"){if(!i||i==="")return"Gestation age by palpation is required";const a=Number(i);if(isNaN(a))return"Gestation age must be a number";if(a<0||a>42)return"Gestation age must be between 0 and 42 weeks"}return null},condition:i=>i["Gestation age to be used"]==="GA by palpation",onChange:(i,n)=>{const e={};if(!i||i==="")return e["date of delivery"]="",e;const a=parseInt(i);if(!isNaN(a)){const t=new Date,o=new Date(t.getTime()-a*7*24*60*60*1e3),s=new Date(o.getTime()+280*24*60*60*1e3);e["date of delivery"]=s.toISOString().split("T")[0]}return e}},{componentType:"dateInputField",header:"EDD",name:"date of delivery",icon:v.calenderPrimary,disabled:!0,grid:{s:"12",md:"6"},condition:i=>i["Gestation age to be used"]==="GA by palpation"},{grid:{s:"12"},componentType:"Dashes"},{componentType:"radioButtonField",header:"The woman received tetanus doses for immunization*",name:"The woman received tetanus doses for immunization?",required:!0,options:[{value:"fully immunised",label:"Fully Immunised (5 doses)"},{value:"under immunised",label:"Under Immunised (1-4 doses)"},{value:"no doses",label:"No doses"},{value:"unknown doses",label:"Unknown doses"}],grid:{s:"12"},validation:i=>!i||i===""?"Tetanus immunization status is required":null,onChange:(i,n)=>{const e={};for(let a=1;a<=5;a++)e["ttFullyImmunised".concat(a)]="",e["ttUnderImmunised".concat(a)]="";return e["Number of tetanus doses"]="",e["Reason Tetanus toxoid (TT) was not conducted"]="",e.Other="",e}}],m=S(5,"ttFullyImmunised");m.forEach(i=>{i.condition=n=>n["The woman received tetanus doses for immunization?"]==="fully immunised",i.validation=(n,e)=>{var t;if((e==null?void 0:e["The woman received tetanus doses for immunization?"])==="fully immunised"&&(!n||n==="")){const o=(t=i.name)==null?void 0:t.replace("ttFullyImmunised","");return"TTV ".concat(o," date is required")}return null}}),r.push(...m),r.push({grid:{s:"12"},componentType:"Dashes"}),r.push({componentType:"radioButtonField",header:"Number of under immunised tetanus doses*",name:"Number of tetanus doses",required:!0,options:[{value:"one dose",label:"One dose"},{value:"two doses",label:"Two doses"},{value:"three doses",label:"Three doses"},{value:"four doses",label:"Four doses"}],grid:{s:"12"},validation:(i,n)=>(n==null?void 0:n["The woman received tetanus doses for immunization?"])==="under immunised"&&(!i||i==="")?"Number of tetanus doses is required":null,condition:i=>i["The woman received tetanus doses for immunization?"]==="under immunised",onChange:(i,n)=>{const e={};for(let a=1;a<=4;a++)e["ttUnderImmunised".concat(a)]="";return e}}),r.push({grid:{s:"12"},componentType:"Dashes"});const y=S(4,"ttUnderImmunised");return y.forEach((i,n)=>{const e=n+1;i.condition=a=>{const t=a["The woman received tetanus doses for immunization?"],o=a==null?void 0:a["Number of tetanus doses"];return t!=="under immunised"?!1:o==="one dose"?e===1:o==="two doses"?e<=2:o==="three doses"?e<=3:o==="four doses"?e<=4:!1},i.validation=(a,t)=>{const o=t==null?void 0:t["The woman received tetanus doses for immunization?"],s=t==null?void 0:t["Number of tetanus doses"];return o==="under immunised"&&(s==="one dose"&&e===1||s==="two doses"&&e<=2||s==="three doses"&&e<=3||s==="four doses"&&e<=4)&&(!a||a==="")?"TTV ".concat(e," date is required"):null}}),r.push(...y),r.push({grid:{s:"12"},componentType:"Dashes"}),r.push({componentType:"radioButtonField",header:"Reason Tetanus toxoid (TT) was not conducted*",name:"Reason Tetanus toxoid (TT) was not conducted",required:!0,options:[{value:"stockout",label:"Stockout"},{value:"client is ill",label:"Client is ill"},{value:"client refused",label:"Client refused"},{value:"allergy",label:"Allergy to vaccine"},{value:"other",label:"Other"}],grid:{s:"12"},validation:(i,n)=>(n==null?void 0:n["The woman received tetanus doses for immunization?"])==="no doses"&&(!i||i==="")?"Reason TT not conducted is required":null,condition:i=>i["The woman received tetanus doses for immunization?"]==="no doses",onChange:(i,n)=>{const e={};return i!=="other"&&(e.Other=""),e}},{grid:{s:"12"},componentType:"Dashes"},{componentType:"inputField",header:"Specify other reasons*",name:"Other",icon:v.editPen,required:!0,grid:{s:"12"},validation:(i,n)=>(n==null?void 0:n["Reason Tetanus toxoid (TT) was not conducted"])==="other"&&(!i||i==="")?"Please specify other reasons":null,condition:i=>i["Reason Tetanus toxoid (TT) was not conducted"]==="other"},{grid:{s:"12"},componentType:"Dashes"},{componentType:"radioButtonField",header:"TTV started at the gestation age at",name:"Counselling on Hep B negative",obsValueType:"value_text",validation:He.required,type:"standard",grid:{s:"6"},options:[{label:"0. Schedule first",value:"0. Schedule first"},{label:"4 Weeks",value:"4 Weeks"},{label:"6 Months",value:"6 Months"},{label:"1 yr",value:"1 yr"},{label:"> 1 yr",value:"> 1 yr"}]}),r});return{resetForm:k,currentPregnancyFormSection:c}},wt={class:"container"},St=ee({__name:"CurrentPregnancy",setup(k,{expose:S}){const c=Dt(),r=_(null),m=_(0),y=ne(),{patient:i}=M(y);I(()=>{var t;return(t=i.value)==null?void 0:t.patientID},async(t,o)=>{t&&t!==o&&(m.value++,await $())});const n=async()=>{if(!r.value)return console.error("Form reference is not available"),!1;const t=r.value.validateForm();if(t)return E("Please fix validation errors before submitting"),console.log("Validation errors:",t),!1;const o=r.value.getFormValues(),s=await e(o);return s.length===0?(E("No current pregnancy data to save"),!1):(await A.addObsToEncounterPatient(s,me.CURRENT_PREGNANCY),m.value++,await $(),ae("Current pregnancy data saved successfully"),!0)},e=async t=>{const o=[],s=["LNMP Known?","lmnpDate","lmnpGestationAge","Estimated date of delivery","Ultrasound done?","Ultrasound","specify","ultrasound lmnp date","Estimated date of delivery from ultrasound","Gestation","Gestation age by palpation","date of delivery","Gestation age to be used","The woman received tetanus doses for immunization?","Number of tetanus doses","Reason Tetanus toxoid (TT) was not conducted","Other"];for(const f of s){const h=t[f];h&&h!==""&&h!==!1&&o.push(await A.buildValueText(f,String(h)))}const u=t["The woman received tetanus doses for immunization?"];if(u==="fully immunised")for(let f=1;f<=5;f++){const h=t["tt".concat(f,"Date")];h&&h!==""&&o.push(await A.buildValueText("TTV ".concat(f," immunisation date"),h))}if(u==="under immunised"){const f=t["Number of tetanus doses"];if(f==="one dose"){const h=t.tt6Date;h&&h!==""&&o.push(await A.buildValueText("TTV 1 immunisation date",h))}else f==="two doses"?["tt7Date","tt8Date"].forEach((g,G)=>{const N=t[g];N&&N!==""&&o.push(A.buildValueText("TTV ".concat(G+1," immunisation date"),N))}):f==="three doses"?["tt9Date","tt10Date","tt11Date"].forEach((g,G)=>{const N=t[g];N&&N!==""&&o.push(A.buildValueText("TTV ".concat(G+1," immunisation date"),N))}):f==="four doses"&&["12","13","14","15"].forEach((g,G)=>{const N=t[g];N&&N!==""&&o.push(A.buildValueText("TTV ".concat(G+1," immunisation date"),N))})}return o};te(async()=>{await $()});const a=z(()=>c.currentPregnancyFormSection.value);return S({validateForm:()=>{var t;return(t=r.value)==null?void 0:t.validateForm()},onSubmit:n,resetForm:()=>{m.value++}}),(t,o)=>(R(),de("div",wt,[w(B(ce),{class:"section"},{default:O(()=>[w(B(ue),null,{default:O(()=>[(R(),J(le,{formData:a.value,ref_key:"formRef",ref:r,key:m.value},null,8,["formData"]))]),_:1})]),_:1})]))}}),Nt=fe(St,[["__scopeId","data-v-b1ea2a46"]]),Pt=()=>{const k=()=>{},S=z(()=>[{componentType:"inputField",header:"Age at menarche",name:"Age at menarche",icon:v.editPen,required:!0,grid:{s:"12"},validation:c=>{if(!c||c==="")return"Age at menarche is required";const r=Number(c);return isNaN(r)?"Age at menarche must be a number":r<8?"Age at menarche must be at least 8 years":r>20?"Age at menarche cannot exceed 20 years":null}},{grid:{s:"12"},componentType:"Dashes"},{componentType:"inputField",header:"Length of menstrual flow (days)",name:"Length of menstrual flow days",icon:v.editPen,required:!0,grid:{s:"12",md:"6"},validation:c=>{if(!c||c==="")return"Length of menstrual flow is required";const r=Number(c);return isNaN(r)?"Length of menstrual flow must be a number":r<1?"Length of menstrual flow must be at least 1 day":r>15?"Length of menstrual flow cannot exceed 15 days":null}},{componentType:"inputField",header:"Length of menstrual flow (weeks)",name:"Length of menstrual flow weeks",icon:v.editPen,required:!1,grid:{s:"12",md:"6"},validation:c=>{if(!c||c==="")return null;const r=Number(c);return isNaN(r)?"Length of menstrual flow must be a number":r<0?"Length of menstrual flow cannot be negative":r>4?"Length of menstrual flow cannot exceed 4 weeks":null}},{grid:{s:"12"},componentType:"Dashes"},{componentType:"radioButtonField",header:"Regularity of menstrual flow",name:"Regularity of menstrual flow",required:!0,type:"inline",options:[{value:"Regular",label:"Regular"},{value:"Irregular",label:"Irregular"}],grid:{s:"12"},validation:c=>!c||c===""?"Regularity of menstrual flow is required":null},{grid:{s:"12"},componentType:"Dashes"},{componentType:"radioButtonField",header:"Amount of flow",name:"Amount of flow",required:!0,type:"inline",options:[{value:"Light",label:"Light"},{value:"Moderate",label:"Moderate"},{value:"Heavy",label:"Heavy"}],grid:{s:"12"},validation:c=>!c||c===""?"Amount of flow is required":null},{grid:{s:"12"},componentType:"Dashes"},{componentType:"radioButtonField",header:"Dysmenorrhea",name:"Dysmenorrhea",required:!0,type:"inline",options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],grid:{s:"12"},validation:c=>!c||c===""?"Dysmenorrhea is required":null},{grid:{s:"12"},componentType:"Dashes"},{componentType:"inputField",header:"Gynaecological surgery",name:"Gynaecological surgery",icon:v.editPen,required:!1,grid:{s:"12"}},{grid:{s:"12"},componentType:"Dashes"},{componentType:"inputField",header:"Other",name:"Other gynaecological notes",required:!1,grid:{s:"12"},rows:4}]);return{resetForm:k,gynaecologyFormSection:S}},Gt={class:"container"},It=ee({__name:"Gynaecology",setup(k,{expose:S}){const c=Pt(),r=_(null),m=_(0),y=ne(),{patient:i}=M(y);I(()=>{var t;return(t=i.value)==null?void 0:t.patientID},async(t,o)=>{t&&t!==o&&(m.value++,await $())});const n=async()=>{if(!r.value)return console.error("Form reference is not available"),!1;const t=r.value.validateForm();if(t)return E("Please fix validation errors before submitting"),console.log("Validation errors:",t),!1;const o=r.value.getFormValues(),s=await e(o);return s.length===0?(E("No gynaecological history data to save"),!1):(await A.addObsToEncounterPatient(s,me.GYNAECOLOGICAL_HISTORY),m.value++,await $(),ae("Gynaecological history saved successfully"),!0)},e=async t=>{const o=[],s=["Age at menarche","Length of menstrual flow days","Length of menstrual flow weeks","Regularity of menstrual flow","Amount of flow","Dysmenorrhea","Abortions","STIs","Gynaecological surgery","Other gynaecological notes"];for(const u of s){const f=t[u];f&&f!==""&&f!==!1&&o.push(await A.buildValueText(u,String(f)))}return o};te(async()=>{await $()});const a=z(()=>c.gynaecologyFormSection.value);return S({validateForm:()=>{var t;return(t=r.value)==null?void 0:t.validateForm()},onSubmit:n,resetForm:()=>{m.value++}}),(t,o)=>(R(),de("div",Gt,[w(B(ce),{class:"section"},{default:O(()=>[w(B(Be),null,{default:O(()=>[w(B(xe),null,{default:O(()=>[...o[0]||(o[0]=[Oe("Gynaecological History",-1)])]),_:1})]),_:1}),w(B(ue),null,{default:O(()=>[(R(),J(le,{formData:a.value,ref_key:"formRef",ref:r,key:m.value},null,8,["formData"]))]),_:1})]),_:1})]))}}),At=fe(It,[["__scopeId","data-v-d1de511a"]]),Ct={style:{width:"90vw",margin:"0 auto","margin-top":"10px"}},_t={class:"back_profile"},nn=ee({__name:"Profile",setup(k,{expose:S}){const{onTabBeforeChange:c,currentTabIndex:r}=st();ht();const m=ke(),y=Le();_([]),_([]),_(!1);const i=_(!0),n=_(!1),e=_(!1),a=z(()=>({text:e.value?"Saving...":"Finish",icon:e.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:n.value||e.value})),t=ve(),o=ne(),s=ze(),u=We();Ue();const f=Fe(),h=Ye();Ke();const g=je(),G=re(),N=Je(),{patient:p}=M(o),{vitals:K}=M(t),{investigations:j}=M(s),{diagnosis:De}=M(u),{substance:we}=M(g),{selectedNCDMedicationList:pe}=M(f),{FootScreening:Se,visualScreening:Ne,cvScreening:Pe}=M(G),{sessionDate:ge}=M(N),{apiStatus:Mt}=M(Qe());I(a,(d,l)=>{console.log("Done button options changed:",{from:l,to:d,currentStep:r.value,tabsLength:b.value.length}),d.disabled!==(l==null?void 0:l.disabled)&&console.log("Done button ".concat(d.disabled?"disabled":"enabled")),d.text!==(l==null?void 0:l.text)&&console.log('Done button text changed from "'.concat(l==null?void 0:l.text,'" to "').concat(d.text,'"'))},{deep:!0}),I(e,(d,l)=>{d!==l&&(console.log("Saving state changed: ".concat(l," -> ").concat(d)),console.log(d?"Starting save process...":"Save process completed"))});const Ge=d=>{console.log("Done button change received from wizard:",d),d.newOptions.disabled&&console.log("Done button has been disabled"),d.isLastStep&&console.log("User is on the last step, done button should be visible")},Q=()=>{let d=!1;return H(),e.value&&(d=!0),n.value=d,!d},Ie=()=>{m.push("/patientProfile")},ie=()=>[{title:"Past Obstetric History",icon:""},{title:"Medical History",icon:""},{title:"Current Pregnancy",icon:""},{title:"Gynaecology",icon:""},{title:"Medications",icon:""},{title:"Woman Behaviour",icon:""}],b=_(ie()),H=()=>{var T;if(!b.value||b.value.length===0)return console.log("Tabs not yet initialized"),null;const d=r.value>=0&&r.value<b.value.length?r.value:0;switch((T=b.value[d])==null?void 0:T.title){case"Past Obstetric History":return"PastObstetricHistory";case"Medical History":return"MedicalHistory";case"Current Pregnancy":return"CurrentPregnancy";case"Gynaecology":return"Gynaecology";case"Medications":return"Medications";case"Woman Behaviour":return"WomanBehaviour";default:if(h.NCDActivities.length>0)switch(h.NCDActivities[0]){case"Past Obstetric History":return"PastObstetricHistory";case"Medical History":return"MedicationHistory";case"Current Pregnancy":return"CurrentPregnancy";case"Gynaecology":return"Gynaecology";case"Medications":return"Medications";case"Woman Behaviour":return"WomanBehaviour"}return null}},oe=()=>{i.value=!1,setTimeout(()=>{r.value=0,i.value=!0},0)},he=()=>{const d=ve();d.setVitals(d.getInitialVitals(p.value.ID))},L=async()=>{var T,C;const d=Ve(ge.value,"sessionDate","value")||se.sessionDate(),l=Z("vitals");for(let D=0;D<b.value.length;D++){const x=b.value[D];if(x.title==="Vital Signs")b.value[D].icon=X(d,l)?Y:"";else if(x.title==="Risk Assessment"){const P=Z("substanceAbuse");b.value[D].icon=X(d,P)?Y:""}else if(x.title==="Investigations"){const P=(C=(T=p==null?void 0:p.value)==null?void 0:T.labOrders)==null?void 0:C.saved,W=P==null?void 0:P.filter(Me=>se.toStandardHisFormat(d)===se.toStandardHisFormat(Me.order_date));b.value[D].icon=(W==null?void 0:W.length)>0?Y:""}else if(x.title==="Diagnosis"){const P=Z("diagnosis");b.value[D].icon=X(d,P)?Y:""}else if(x.title==="Complications Screening"){const P=Z("screening");b.value[D].icon=X(d,P)?Y:""}else x.title==="Treatment Plan"&&(pe.value.length>0?b.value[D].icon=et()?Y:"":b.value[D].icon="")}Q()},X=(d,l)=>{const T=new Date(d);return T.setHours(0,0,0,0),l.some(C=>{const D=new Date(C.obs_datetime);return D.setHours(0,0,0,0),D.getTime()===T.getTime()})},Ae=async()=>{var D,x,P,W;const d=[],l=await Te(Ne.value),T=await gt(Se.value),C=await Te(Pe.value);l.length>0&&d.push({concept_id:await V.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:V.getSessionDate(),child:l}),T.length>0&&d.push({concept_id:await V.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:V.getSessionDate(),child:T}),C.length>0&&d.push(...C),d.length>0?((W=(P=(x=(D=p.value).screening)!=null?x:D.screening={}).unsaved)!=null||(P.unsaved=[]),p.value.screening.unsaved.push(...d),ae("Complications saved successfully")):E("No complications data to save")},Ce=async()=>{const d=nt();if(!pt.isEmpty(d.selectedMedicalAllergiesList)){const C=at(),D=d.selectedMedicalAllergiesList.map(P=>({concept_id:P.concept_id,obs_datetime:it.getSessionDate(),value_coded:P.concept_id,location_id:C.facilityLocation.code,value_text:P.name})),x=await lt(D);p.value=Object.assign(p.value,x),console.log("Allergies staged successfully:",p.value),d.clearSelectedMedicalAllergiesList()}const l=await mt();p.value=Object.assign(p.value,l);const T=await ft().saveNonPharmaTherapyPatientData();p.value=Object.assign(p.value,T)},_e=async(d,l)=>{var C;const T=(C=b.value[l])==null?void 0:C.title;d%1===0&&(r.value=d),T=="Complications Screening"&&await Ae(),T=="Treatment Plan"&&await Ce(),await be(p.value)},ye=async()=>{e.value=!0;try{await tt(),await be(p.value),m.push("/quickCheck")}catch(d){console.error("Error saving data:",d),E("Error occurred while saving data. Please try again.")}finally{e.value=!1}};return te(async()=>{if(h.NCDActivities.length===0){m.push("patientProfile");return}re().resetScreening(),b.value=ie(),await L(),(r.value===void 0||r.value<0)&&(r.value=0,console.log("Setting initial tab index to 0")),n.value=!1,e.value=!1,Q()}),I(r,async()=>{await Q()}),I(K,async()=>{await L()},{deep:!0}),I(p,async()=>{re().resetScreening(),await L()},{deep:!0}),I(ge,async()=>{await L()},{deep:!0}),I(j,async()=>{await L()},{deep:!0}),I(De,async()=>{await L()},{deep:!0}),I(we,async()=>{await L()},{deep:!0}),I(pe,async()=>{await L()},{deep:!0}),I(y,async d=>{oe(),he(),b.value=ie()},{deep:!0}),I(p,async(d,l)=>{d.ID!=l.ID&&(oe(),he())},{deep:!0}),S({saveData:ye,markWizard:L,refreshWizard:oe,validateDoneButtonState:Q}),(d,l)=>(R(),J(B(Ee),null,{default:O(()=>[w(Xe),w(B(qe),{fullscreen:!0},{default:O(()=>[w(ot),q("div",Ct,[i.value?(R(),J(rt,{key:0,ref:"wizard",headingTitle:"ANC Profile","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:a.value,"custom-tabs":b.value,beforeChange:B(c),onChange:_e,"onComplete:wizard":l[1]||(l[1]=T=>ye()),onDoneButtonChanged:Ge},{default:O(()=>[q("div",null,[q("div",_t,[w(Ze,{name:"Back to Profile",iconSlot:"start",fill:"clear",icon:B(Re),"font-weight":"600",onClick:l[0]||(l[0]=T=>Ie())},null,8,["icon"])])]),U(q("div",null,[w(Tt,{ref:"pastObstetricHistoryRef"},null,512)],512),[[F,H()=="PastObstetricHistory"]]),U(q("div",null,[w(dt,{ref:"medicalHistoryRef"},null,512)],512),[[F,H()=="MedicalHistory"]]),U(q("div",null,[w(Nt,{ref:"currentPregnancyRef"},null,512)],512),[[F,H()=="CurrentPregnancy"]]),U(q("div",null,[w(At,{ref:"gynaecologyRef"},null,512)],512),[[F,H()=="Gynaecology"]]),U(q("div",null,[w(ut,{ref:"medicationsRef"},null,512)],512),[[F,H()=="Medications"]]),U(q("div",null,[w(ct,{ref:"womanBehaviourRef"},null,512)],512),[[F,H()=="WomanBehaviour"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):$e("",!0)])]),_:1})]),_:1}))}});export{nn as default};

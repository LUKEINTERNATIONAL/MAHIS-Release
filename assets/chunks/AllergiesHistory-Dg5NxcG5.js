import{d as S,b2 as A,cr as D,r as n,w as u,e as i,f as c,l as E,J as k,k as p,F as x,P as H,K as B,u as N,b7 as _,cY as T}from"./vendor-Do1wNTJR.js";import{u as F,J as O,H as V,_ as q}from"../index-BqlopBXU.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-CCt-rnNp.js";const C={class:"table-responsive"},I=S({__name:"AllergiesHistory",setup(J){const f=F(),{patient:b}=A(f),y=D(),v=n(null),r=n([]),g=n(["Allergy","Date","Status"]),m=n({responsive:!0,select:!1,layout:{topStart:"",topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1}),h=s=>{const a=new Map;return s.forEach(t=>{const e="".concat(t.value_coded,"_").concat(t.value_text);if(!a.has(e))a.set(e,t);else{const o=a.get(e);t.obs_id&&o.obs_id?t.obs_id>o.obs_id&&a.set(e,t):t.obs_datetime&&o.obs_datetime&&new Date(t.obs_datetime)>new Date(o.obs_datetime)&&a.set(e,t)}}),Array.from(a.values())},d=async()=>{try{r.value=[];const s=await O.getObsByEncounterId(30);if(s&&Array.isArray(s)){let a=[];s.forEach(e=>{if(e.obs&&Array.isArray(e.obs)){const o=e.obs.map(l=>({...l,encounterStatus:e.status}));a=a.concat(o)}}),h(a).forEach(e=>{const o=e.value_text||"Unknown Allergy",l=e.obs_datetime?V.toStandardHisDisplayFormat(e.obs_datetime):"N/A",w=e.encounterStatus==="saved"||e.obs_id!==void 0&&e.obs_id!==null?'<span style="color: #046c04; font-weight: bold;">Saved</span>':'<span style="color: #ff9800; font-weight: bold;">Unsaved</span>';r.value.push([o,l,w])})}}catch(s){console.error("Error updating allergy data:",s),r.value=[]}_.use(T)};return u(()=>y,async()=>{await d()},{deep:!0}),u(b,async()=>{await d()},{deep:!0,immediate:!0}),(s,a)=>(c(),i("div",C,[E(N(_),{ref_key:"dataTable",ref:v,options:m.value,data:r.value,class:"display nowrap modern-table",width:"100%"},{default:k(()=>[p("thead",null,[p("tr",null,[(c(!0),i(x,null,H(g.value,t=>(c(),i("th",{key:t},B(t),1))),128))])])]),_:1},8,["options","data"])]))}}),M=q(I,[["__scopeId","data-v-d41a33e8"]]);export{M as default};

import{d as U,b2 as se,am as ae,r as g,c as D,w as Y,a as _e,e as d,f as o,k as u,l as s,m as h,J as a,u as t,ad as f,Q as p,ac as M,F as k,P as C,O as W,K as v,N as L,L as ne,dh as ge,I as Se,G as ye,E as be,aW as he,ab as le,bo as we,p as ke,da as Ie,ae as ze}from"./vendor-BTebhqHt.js";import{u as oe,n as X,x as Z,S as B,g as ee,O as G,z as Ce,ao as H,o as De,I as Oe,t as Te,_ as re,T as Re}from"../index-BpQfAx9h.js";import{y as V,N as $e}from"./NeonatalStepper-CJdKAZd5.js";import{E as Le}from"./EnterLabResultsModal-CxAjhQ3S.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-no8IW45T.js";import"./SaveProgressModal-BE8xJoFQ.js";import"./images-Zb0Yk5XL.js";import"./enrollment-DU-PLRUa.js";const Ne={class:"lab-orders"},Fe={class:"ion-padding"},Pe={key:0,class:"lab-orders__section"},Me={key:0},Ae={key:1,class:"result-text-value"},xe={key:0,class:"see-more-container"},Be={key:1,class:"lab-orders__section"},Ve={key:0,class:"see-more-container"},We={class:"lab-orders__section"},Ee={key:0,class:"report-card"},Je={class:"report-header"},qe={class:"report-title-row"},Ge={class:"report-meta"},He={key:0},Ue={class:"results-table"},je={class:"indicator-name"},Ke={class:"indicator-value"},Qe=U({__name:"Investigation",setup(j){const N=oe(),{patient:w}=se(N),T=ae(),I=g([]),S=g(),R=g([]),z=g([]),_=g(""),n=g(!1),c=g(!1),m=g(null),y=g(null),b=g({}),A=g(!1),x=g(!1),F=D(()=>I.value?I.value.filter(l=>{var e;return(e=l.tests)==null?void 0:e.some(i=>i.result&&i.result.length>0)}):[]),P=D(()=>I.value?I.value.filter(l=>{var e;return(e=l.tests)==null?void 0:e.every(i=>!i.result||i.result.length===0)}):[]),ie=D(()=>A.value?F.value:F.value.slice(0,3)),ue=D(()=>x.value?P.value:P.value.slice(0,3)),de=D(()=>[{componentType:"multiSelectInputField",name:"test",header:"Test",options:R.value,grid:{s:"6"},openDirection:"top",validation:Z.required,icon:X.search,onChange:l=>_.value=(l==null?void 0:l.name)||""},{componentType:"multiSelectInputField",name:"specimen",header:"Specimen",obsValueType:"value_text",grid:{s:"6"},icon:X.search,openDirection:"top",validation:Z.required,value:z.value.length===1?z.value[0]:"",options:z.value.length>1?z.value:[]}]);function E(l){if(!l)return"N/A";const e=new Date(l);return"".concat(String(e.getDate()).padStart(2,"0"),"/").concat(String(e.getMonth()+1).padStart(2,"0"),"/").concat(String(e.getFullYear()).slice(-2)," ").concat(String(e.getHours()).padStart(2,"0"),":").concat(String(e.getMinutes()).padStart(2,"0"))}async function ce(l,e){if(m.value=l,y.value=e,c.value=!0,e.result)for(const i of e.result){const r=i.indicator.concept_id;if(!b.value[r]){const O=await H.getConceptName(r);b.value[r]=typeof O=="object"?O.name||O.display:O}}}function K(){c.value=!1,m.value=null,y.value=null}const pe=async l=>{await De(Le,{class:"large-modal-x10"},!0,{test_data:l})},ve=async()=>{if(!S.value||S.value.validateForm())return;const l=S.value.getFormValues(),e=[{concept_id:l.test.concept_id,name:l.test.name,specimen:l.specimen.name,reason:"Routine",specimenConcept:await H.getConceptID(l.specimen.name,!0)}];await me(e)},me=async l=>{var e,i,r,O,Q;try{n.value=!0;const q=await G.buildLabOrders("",l);console.log("ðŸš€ ~ saveTest ~ patient.value:",w.value);const $=JSON.parse(JSON.stringify(w.value));(r=(i=(e=$.labOrders)!=null?e:$.labOrders={}).unsaved)!=null||(i.unsaved=[]),$.labOrders.unsaved.push(...q),console.log("ðŸš€ ~ saveTest ~ patientData.labOrders.unsaved:",$.labOrders.unsaved),await Oe($),await J(),await T.push("/neonatal/checkpoint"),S.value&&((Q=(O=S.value).resetForm)==null||Q.call(O))}catch(q){console.log("ðŸš€ ~ saveTest ~ error:",q),Te("Failed to save test")}finally{n.value=!1}};async function J(){const l=w.value;I.value=l!=null&&l.labOrders?[...l.labOrders.saved||[],...l.labOrders.unsaved||[]]:[]}async function fe(l){const i=B.getPouchDbStatus()||B.getLanConnectionStatus()?await ee("specimens"):await G.getSpecimens("",1e3);return await H.getConceptSet(l,"",{names:i.map(r=>r.name)})}return Y(_,async l=>{z.value=l?await fe(l):[]}),Y(()=>w,async()=>{await J()},{deep:!0}),_e(async()=>{const l=B.getPouchDbStatus()||B.getLanConnectionStatus();R.value=l?await ee("test_types"):await G.getTestTypes(),await J()}),(l,e)=>(o(),d("div",Ne,[e[21]||(e[21]=u("header",{class:"lab-orders__header"},"Lab Orders",-1)),u("div",Fe,[F.value&&F.value.length>0?(o(),d("section",Pe,[e[6]||(e[6]=u("h6",{class:"section-title"},"Past Investigations",-1)),s(t(M),{class:"table-header"},{default:a(()=>[s(t(f),{size:"3"},{default:a(()=>[...e[2]||(e[2]=[p("Date",-1)])]),_:1}),s(t(f),{size:"3"},{default:a(()=>[...e[3]||(e[3]=[p("Test",-1)])]),_:1}),s(t(f),{size:"3"},{default:a(()=>[...e[4]||(e[4]=[p("Specimen",-1)])]),_:1}),s(t(f),{size:"3"},{default:a(()=>[...e[5]||(e[5]=[p("Result",-1)])]),_:1})]),_:1}),(o(!0),d(k,null,C(ie.value,i=>(o(),W(t(M),{key:"past-".concat(i.order_id),class:"table-row table-row--completed"},{default:a(()=>[s(t(f),{size:"3"},{default:a(()=>[p(v(E(i.order_date)),1)]),_:2},1024),s(t(f),{size:"3"},{default:a(()=>[(o(!0),d(k,null,C(i.tests,r=>(o(),d("div",{key:r.id,class:"test-item"},v(r.name),1))),128))]),_:2},1024),s(t(f),{size:"3"},{default:a(()=>{var r;return[p(v(((r=i.specimen)==null?void 0:r.name)||"N/A"),1)]}),_:2},1024),s(t(f),{size:"3"},{default:a(()=>[(o(!0),d(k,null,C(i.tests,r=>(o(),d("div",{key:r.id},[r.result&&r.result.length>0?(o(),d("div",Me,[r.result.length>1?(o(),W(t(L),{key:0,fill:"clear",size:"small",onClick:O=>ce(i,r),class:"view-results-btn"},{default:a(()=>[s(t(ne),{icon:t(ge),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])):(o(),d("div",Ae,v(r.result[0].value),1))])):h("",!0)]))),128))]),_:2},1024)]),_:2},1024))),128)),F.value.length>3?(o(),d("div",xe,[s(t(L),{fill:"clear",size:"small",onClick:e[0]||(e[0]=i=>A.value=!A.value)},{default:a(()=>[p(v(A.value?"See Less":"See More"),1)]),_:1})])):h("",!0)])):h("",!0),P.value&&P.value.length>0?(o(),d("section",Be,[e[13]||(e[13]=u("h6",{class:"section-title"},"Investigations Waiting Results",-1)),s(t(M),{class:"table-header"},{default:a(()=>[s(t(f),{size:"2.4"},{default:a(()=>[...e[7]||(e[7]=[p("Date",-1)])]),_:1}),s(t(f),{size:"2.4"},{default:a(()=>[...e[8]||(e[8]=[p("Test",-1)])]),_:1}),s(t(f),{size:"2.4"},{default:a(()=>[...e[9]||(e[9]=[p("Specimen",-1)])]),_:1}),s(t(f),{size:"2.4"},{default:a(()=>[...e[10]||(e[10]=[p("Accession #",-1)])]),_:1}),s(t(f),{size:"2.4"},{default:a(()=>[...e[11]||(e[11]=[p("Action",-1)])]),_:1})]),_:1}),(o(!0),d(k,null,C(ue.value,i=>(o(),W(t(M),{key:"pending-".concat(i.order_id),class:"table-row"},{default:a(()=>[s(t(f),{size:"2.4"},{default:a(()=>[p(v(E(i.order_date)),1)]),_:2},1024),s(t(f),{size:"2.4"},{default:a(()=>[(o(!0),d(k,null,C(i.tests,r=>(o(),d("div",{key:r.id,class:"test-item"},v(r.name),1))),128))]),_:2},1024),s(t(f),{size:"2.4"},{default:a(()=>{var r;return[p(v(((r=i.specimen)==null?void 0:r.name)||"N/A"),1)]}),_:2},1024),s(t(f),{size:"2.4"},{default:a(()=>[p(v(i.accession_number),1)]),_:2},1024),s(t(f),{size:"2.4"},{default:a(()=>[s(t(L),{size:"small",onClick:r=>pe(i)},{default:a(()=>[...e[12]||(e[12]=[p(" Add Results ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),P.value.length>3?(o(),d("div",Ve,[s(t(L),{fill:"clear",size:"small",onClick:e[1]||(e[1]=i=>x.value=!x.value)},{default:a(()=>[p(v(x.value?"See Less":"See More"),1)]),_:1})])):h("",!0)])):h("",!0),u("section",We,[e[14]||(e[14]=u("h6",{class:"section-title"},"Current Investigations",-1)),s(t(M),{class:"form-row"},{default:a(()=>[s(t(f),{size:"12","size-md":"9"},{default:a(()=>[s(Ce,{formData:de.value,ref_key:"formRef",ref:S},null,8,["formData"])]),_:1}),s(t(f),{size:"12","size-md":"3",class:"form-actions"},{default:a(()=>[s(t(L),{expand:"block",onClick:ve,disabled:n.value},{default:a(()=>[p(v(n.value?"Sending...":"Send Test"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})])]),s(t(we),{"is-open":c.value,onDidDismiss:K,class:"medium-modal"},{default:a(()=>[s(t(Se),null,{default:a(()=>[s(t(ye),{color:"light"},{default:a(()=>[s(t(be),null,{default:a(()=>[...e[15]||(e[15]=[p("Laboratory Report",-1)])]),_:1}),s(t(he),{slot:"end"},{default:a(()=>[s(t(L),{onClick:K},{default:a(()=>[...e[16]||(e[16]=[p("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(t(le),{class:"ion-padding report-content"},{default:a(()=>{var i;return[m.value&&y.value?(o(),d("div",Ee,[u("div",Je,[u("div",qe,[u("h3",null,v(y.value.name),1)]),u("div",Ge,[u("p",null,[e[17]||(e[17]=u("strong",null,"Date:",-1)),p(" "+v(E(m.value.order_date)),1)]),u("p",null,[e[18]||(e[18]=u("strong",null,"Specimen:",-1)),p(" "+v(((i=m.value.specimen)==null?void 0:i.name)||"N/A"),1)]),m.value.accession_number?(o(),d("p",He,[e[19]||(e[19]=u("strong",null,"Accession #:",-1)),p(" "+v(m.value.accession_number),1)])):h("",!0)])]),u("div",Ue,[e[20]||(e[20]=u("div",{class:"results-table-header"},[u("span",{class:"col-indicator"},"Indicator"),u("span",{class:"col-value"},"Result")],-1)),(o(!0),d(k,null,C(y.value.result,r=>(o(),d("div",{key:r.id,class:"results-table-row"},[u("span",je,v(b.value[r.indicator.concept_id]||"Loading..."),1),u("span",Ke,v(r.value),1)]))),128))])])):h("",!0)]}),_:1})]),_:1},8,["is-open"])]))}}),te=re(Qe,[["__scopeId","data-v-8cc78aa7"]]),Ye={key:0,class:"custom_card summary-card"},Xe={class:"investigation-list"},Ze={class:"item-main"},et={class:"test-name"},tt={class:"test-date"},st={class:"item-results"},at={key:0},nt={key:0,class:"more-results"},lt={key:1,class:"custom_card waiting-card"},ot={class:"waiting-grid"},rt={class:"waiting-test-name"},it=U({__name:"InvestigationSummary",setup(j){const N=oe(),{patient:w}=se(N),T=D(()=>{var n;return(n=w.value)!=null&&n.labOrders?[...w.value.labOrders.saved||[],...w.value.labOrders.unsaved||[]]:[]}),I=D(()=>T.value.filter(n=>{var c;return(c=n.tests)==null?void 0:c.some(m=>m.result&&m.result.length>0)})),S=D(()=>T.value.filter(n=>{var c;return(c=n.tests)==null?void 0:c.every(m=>!m.result||m.result.length===0)})),R=D(()=>I.value.sort((n,c)=>new Date(c.order_date).getTime()-new Date(n.order_date).getTime()).slice(0,5));function z(n){return new Date(n).toLocaleDateString("en-GB",{day:"2-digit",month:"short"})}function _(n){const c=n.toLowerCase();return c.includes("pos")||c.includes("+")?"result-pos":c.includes("neg")||c.includes("-")?"result-neg":"result-neutral"}return(n,c)=>(o(),d(k,null,[R.value.length>0?(o(),d("div",Ye,[c[0]||(c[0]=u("h6",{class:"section-title"},"Past 5 Investigations",-1)),u("div",Xe,[(o(!0),d(k,null,C(R.value,m=>{var y;return o(),d("div",{key:m.order_id,class:"investigation-item"},[u("div",Ze,[u("span",et,v((y=m.tests[0])==null?void 0:y.name),1),u("span",tt,v(z(m.order_date)),1)]),u("div",st,[(o(!0),d(k,null,C(m.tests,b=>(o(),d("div",{key:b.id},[b.result&&b.result.length>0?(o(),d("div",at,[u("span",{class:ke(["result-badge",_(b.result[0].value)])},v(b.result[0].value),3),b.result.length>1?(o(),d("span",nt," +"+v(b.result.length-1)+" more ",1)):h("",!0)])):h("",!0)]))),128))])])}),128))])])):h("",!0),S.value.length>0?(o(),d("div",lt,[c[1]||(c[1]=u("h6",{class:"section-title"},"Investigations Waiting Results",-1)),u("div",ot,[(o(!0),d(k,null,C(S.value,m=>{var y;return o(),d("div",{key:m.order_id,class:"waiting-item"},[s(t(ne),{icon:t(Ie),class:"pending-icon"},null,8,["icon"]),u("span",rt,v((y=m.tests[0])==null?void 0:y.name),1)])}),128))])])):h("",!0)],64))}}),ut=re(it,[["__scopeId","data-v-5b0664b2"]]),dt="Investigations",bt=U({__name:"Investigation",setup(j){const N=g("1"),w=ae(),T=g(V.map((_,n)=>({title:_.title,number:n+1,checked:!1,class:n===0?"open_step common_step":"common_step",last_step:n===V.length-1?"last_step":""}))),I=[te,ut],S=V.map((_,n)=>({title:_.title,subtitle:_.subtitle,value:(n+1).toString(),component:I[n]||te,configIndex:n})),R=_=>{_&&_.value&&T.value.forEach((n,c)=>{_.value===(c+1).toString()?(n.class="open_step common_step",n.checked=!1):c<parseInt(_.value)-1?(n.class="common_step color_white",n.checked=!0):(n.class="common_step",n.checked=!1)})},z=_=>{const n=S.length-1;return _===n?async()=>{w.push("/neonatal/checkpoint")}:()=>Promise.resolve()};return(_,n)=>(o(),W(t(ze),{class:"neonatal-enrollment-page"},{default:a(()=>[s(Re),s(t(le),{fullscreen:!0},{default:a(()=>[s($e,{wizardData:T.value,StepperData:t(S),stepperTitle:dt,openStepper:N.value,backUrl:"/patientProfile",getSaveFunction:z,sectionsConfig:t(V),flowType:"investigation","show-componet-title":!0,onUpdateStatus:R},null,8,["wizardData","StepperData","openStepper","sectionsConfig"])]),_:1})]),_:1}))}});export{bt as default};

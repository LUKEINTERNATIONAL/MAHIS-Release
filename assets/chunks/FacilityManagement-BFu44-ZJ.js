import{d as S,cG as k,r as i,a as F,b6 as _,cU as B,n as C,H as P,O as M,f as v,J as p,e as R,m as A,l as r,k as a,u as f,a3 as O,p as $,a6 as I}from"./vendor-mfJAYm71.js";import{o as y,l as L,T as V,W as j,G as H,t as b,_ as J}from"../index-DXPfJgrE.js";import{B as U}from"./BasicForm-DWrsAPAV.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-Cv72TtBb.js";import"./DateInputField-BB0feQkW.js";const z={key:0,class:"spinner-overlay"},G={class:"container"},W={style:{display:"flex","justify-content":"space-between"}},Y={style:{width:"50%","max-width":"350px"}},q={class:"table-responsive"},K=S({__name:"FacilityManagement",setup(Q){k();const d=i(null),l=i(!1),u=i(""),g=i([]),m=async e=>Promise.all(e.map(async t=>{const s=t.dde_activated===!0||t.dde_activated==="true",n=s?"btn-danger":"btn-primary",o=s?" Deactivated DDE":"Activate DDE";return{code:t.code,name:t.name,ownership:t.ownership,facility_type:t.facility_type,status:t.status,district:t.district,date_opened:t.date_opened,dde_activated:s?'<span style="display: inline-block;\n                                    background: linear-gradient(135deg, #4caf50, #2e7d32);\n                                    border-radius: 20px; \n                                    padding: 4px 12px; \n                                    color: #fff;\n                                    line-height: 1;\n                                    text-align: center;\n                                    transition: all 0.3s ease;\n                                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15)">\n                        Yes\n                        </span>':'<span style="display: inline-block;\n                                    background: linear-gradient(135deg, #e53935, #b71c1c);\n                                    border-radius: 20px; \n                                    padding: 4px 12px; \n                                    color: #fff;\n                                    line-height: 1;\n                                    text-align: center;\n                                    transition: all 0.3s ease;\n                                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15)">\n                        No\n                        </span>',type:t.type,actions:'\n                    <button class="btn btn-sm '.concat(n," activate-btn\" \n                            data-id='").concat(JSON.stringify(t),"' \n                            data-facility-id=\"").concat(t._id||t.id,'">\n                        ').concat(o,"\n                    </button>\n                ")}})),h=(e=!0)=>{d.value.dt.ajax.reload(null,e)},D=i({responsive:!0,select:!1,processing:!0,serverSide:!0,pageLength:10,searching:!0,ajax:async function(e,t){var s;try{l.value=!0;const n=Math.floor(e.start/e.length)+1;let o={};u.value&&(o.name=u.value),(s=e.search)!=null&&s.value&&(o.name={$regex:new RegExp(e.search.value,"i")});const E={currentPage:n,itemsPerPage:e.length,selector:o},c=await y("facilities",E);console.log("ðŸš€ ~ facilities:........",c);const N=await m(c.records);t({draw:e.draw,recordsTotal:c.totalCount,recordsFiltered:c.totalCount,data:N})}catch(n){console.error("Error fetching data:",n),b("An error occurred while loading data."),t({draw:e.draw,recordsTotal:0,recordsFiltered:0,data:[]})}finally{l.value=!1}},columns:[{data:"code"},{data:"name"},{data:"ownership"},{data:"facility_type"},{data:"status"},{data:"district"},{data:"date_opened"},{data:"dde_activated"},{data:"type"},{data:"actions"}],language:{processing:"Loading...",emptyTable:"No data available",info:"Showing _START_ to _END_ of _TOTAL_ entries",infoEmpty:"Showing 0 to 0 of 0 entries",lengthMenu:"Show _MENU_ entries",loadingRecords:"Loading...",search:"Search:",zeroRecords:"No matching records found"}}),x=async e=>{var t;u.value=(t=e==null?void 0:e.value)==null?void 0:t.name,h()},w=async e=>{try{const t={...e,dde_activated:!e.dde_activated};j({storeName:"facilities",data:t,command:"upsertDocument"}),H("DDE has been successfully activated for this facility."),h(!1)}catch(t){console.error("Error activating DDE:",t),b("Failed to activate DDE. Please try again.")}},T=()=>{d.value.dt.on("click",".activate-btn",t=>{const n=t.target.getAttribute("data-id");n&&w(JSON.parse(n))})};return F(async()=>{g.value=[{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"Filter by districts",popOver:!0,icon:L.search,value:"",name:"filter_district",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,trackBy:"district_id",multiSelectData:await y("districts",{selector:{region_id:{$ne:4}}}),id:"",idName:"district_id"}]}]}}],_.use(B),C(()=>{T()})}),(e,t)=>{const s=P("ion-spinner");return v(),M(f(I),{class:$({loading:l.value})},{default:p(()=>[l.value?(v(),R("div",z,[r(s,{name:"bubbles"}),t[0]||(t[0]=a("div",{class:"loading-text"},"Please wait...",-1))])):A("",!0),r(V),r(f(O),null,{default:p(()=>[a("div",G,[t[2]||(t[2]=a("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Facility Management",-1)),a("div",W,[a("div",Y,[r(U,{contentData:g.value,"onUpdate:inputValue":x},null,8,["contentData"])])]),a("div",q,[r(f(_),{ref_key:"dataTableRef",ref:d,options:D.value,class:"display nowrap modern-table",width:"100%"},{default:p(()=>[...t[1]||(t[1]=[a("thead",null,[a("tr",null,[a("th",null,"Code"),a("th",null,"Name"),a("th",null,"Ownership"),a("th",null,"Facility type"),a("th",null,"Status"),a("th",null,"District"),a("th",null,"Date opened"),a("th",null,"Dde activated"),a("th",null,"Type"),a("th",null,"Action")])],-1)])]),_:1},8,["options"])])])]),_:1})]),_:1},8,["class"])}}}),nt=J(K,[["__scopeId","data-v-6b784efc"]]);export{nt as default};

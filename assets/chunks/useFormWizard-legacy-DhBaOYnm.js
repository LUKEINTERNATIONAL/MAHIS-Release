!function(){function e(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}System.register(["./vendor-legacy-DgG2u0XE.js","./lodash-legacy-pOOc9Efu.js","../index-legacy-CgbzJMav.js","./drug_prescription_service-legacy-BU6kLGe2.js","./patient_diagnosis_service-legacy-HuHvrYzv.js"],function(t,a){"use strict";var n,i,s,o,r,l,d,c,u,p,g,v,h,f,b,y,m,D,S,_,w,N,P,T,O,k,C,x,I,B,$,E,j,F,M,q,z,A,L,V,H,U;return{setters:[e=>{n=e.D,i=e.aV,s=e.d,o=e.c,r=e.H,l=e.e,d=e.f,c=e.m,u=e.k,p=e.p,g=e.j,v=e.l,h=e.K,f=e.r,b=e.w,y=e.a,m=e.F,D=e.P,S=e.O,_=e.u,w=e.J,N=e.n},e=>{P=e.l},e=>{T=e.b2,O=e.u,k=e.af,C=e.S,x=e.E,I=e.H,B=e.aQ,$=e.bq,E=e.P,j=e.a7,F=e.G,M=e.t,q=e.aJ,z=e.aK,A=e.a0},e=>{L=e.g,V=e.D,H=e.a},e=>{U=e.P}],execute:function(){t({c:async function(){try{const n=O(),{patient:s}=i(n),o=K(),r=JSON.parse(JSON.stringify(s.value));if(o.length>0){var e,t,a;null!==(t=(e=null!==(a=r.MedicationOrder)&&void 0!==a?a:r.MedicationOrder={}).unsaved)&&void 0!==t||(e.unsaved=[]),r.MedicationOrder.unsaved=[...r.MedicationOrder.unsaved,...o];const n=z();return n.setMedicationRunOutDate(function(){try{const e=new Date(C.getSessionDate()),t=z().selectedNCDMedicationList;let a=0;if(t.forEach(e=>{const t=parseInt(e.duration,10);!isNaN(t)&&t>a&&(a=t)}),a<=0)return{date:null,formattedDate:null};const n=new Date(e);n.setDate(e.getDate()+a);const i=String(n.getDate()).padStart(2,"0"),s=String(n.getMonth()+1).padStart(2,"0"),o=n.getFullYear();return{date:n,formattedDate:`${i}/${s}/${o}`}}catch(e){return console.error("Error calculating medication run out date:",e),{date:null,formattedDate:null}}}()),n.clearMedicationDataStores(),F("Drug order(s) has been created"),r}M("Unable to create drug orders!")}catch(n){M("Unable to create drug orders!")}},d:function(){try{const e=new Date(C.getSessionDate()),t=q().selectedMedicalDrugsList;let a=0;if(t.forEach(e=>{const t=parseInt(e.duration,10);!isNaN(t)&&t>a&&(a=t)}),a<=0)return{date:null,formattedDate:null};const n=new Date(e);n.setDate(e.getDate()+a);const i=String(n.getDate()).padStart(2,"0"),s=String(n.getMonth()+1).padStart(2,"0"),o=n.getFullYear();return{date:n,formattedDate:`${i}/${s}/${o}`}}catch(e){return console.error("Error calculating OPD medication run out date:",e),{date:null,formattedDate:null}}},e:async function(){try{const n=O(),{patient:s}=i(n),o=X(),r=JSON.parse(JSON.stringify(s.value));if(o.length>0){var e,t,a;null!==(t=(e=null!==(a=r.MedicationOrder)&&void 0!==a?a:r.MedicationOrder={}).unsaved)&&void 0!==t||(e.unsaved=[]),r.MedicationOrder.unsaved=[...r.MedicationOrder.unsaved,...o];return q().clearSelectedMedicalDrugsList(),F("Drug order(s) has been created"),r}}catch(n){M("Unable to create drug orders!")}},g:async function(){const e=O(),{patient:t}=i(e),a=t.value,n=[8809,903,6410,6409];let s;s=C.getLanConnectionStatus()||C.getPouchDbStatus()?await U.getDiagnosis("",1,15):await C.getJson("diagnosis",{id:7409,page_size:2e3});const o=s.filter(e=>n.includes(e.concept_id));o.push({concept_id:8809,concept_name_id:926,concept_name_type:"FULLY_SPECIFIED",creator:1,date_created:"2004-06-25T00:00:00.000+02:00",date_voided:null,id:72,locale:"en",locale_preferred:0,name:"Hypertension",uuid:"b99faa1e-8d80-11d8-abbb-0024217bb78e",void_reason:null,voided:0,voided_by:null});const r=a.diagnosis.saved.map(e=>e.value_coded),l=a.diagnosis.unsaved.map(e=>e.value_coded),d=[...r,...l],c=o.filter(e=>d.includes(e.concept_id));return c.map(e=>e.name)},s:async function(e){try{var t,a,n;const s=O(),{patient:o}=i(s),r=JSON.parse(JSON.stringify(o.value));return null!==(a=(t=null!==(n=r.allergies)&&void 0!==n?n:r.allergies={}).unsaved)&&void 0!==a||(t.unsaved=[]),r.allergies.unsaved.push(...e),F("Allergies appended to patient record successfully"),r}catch(s){M("Unable to save Allegies!")}}});const a=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"Visual acuity test",data:{rowData:[{colData:[{inputHeader:"Left Eye",value:"",name:"Left eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"},{inputHeader:"Right Eye",value:"",name:"Right eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"}]}]}}],J=[{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Peripheral neuropathy"},data:[{name:"Neuropathy/PVO",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Deformity"},data:[{name:"Deformities",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Ulcers"},data:[{name:"Ulcers",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}}],Y=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"CV Risk %",data:{rowData:[{colData:[{inputHeader:"",value:"",name:"CVD",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,valueType:"text",validationFunctionName:"isNumber"}]}]}}];t("a",n("complicationsStore",{state:()=>({visualScreening:[...a],FootScreening:[...J],cvScreening:[...Y]}),actions:{setCvScreening(e){this.cvScreening=e},setVisualScreening(e){this.visualScreening=e},setFootScreening(e){this.FootScreening=e},getInitialCvScreening:()=>[...P.cloneDeep(Y)],getInitialVisualScreening:()=>[...P.cloneDeep(a)],getInitialFootScreening:()=>[...P.cloneDeep(J)],resetScreening(){this.setCvScreening(this.getInitialCvScreening()),this.setFootScreening(this.getInitialFootScreening()),this.setVisualScreening(this.getInitialVisualScreening())}},persist:!0}));class R extends T{constructor(e,t){super(e,105,t)}}class W extends T{constructor(e,t){super(e,25,t)}static async get_____(e="",t=1,a=10){}}t("T",class{async onSubmitNotes(e,t,a){const n=new R(e,t);await n.createEncounter(),await n.saveObservationList(a)}async onSubmitAllergies(e,t,a){try{const n=new W(e,t);await n.createEncounter(),await n.saveObservationList(a),F("Allergies saved successfully")}catch(n){console.error("Error saving allergies:",n),M("Failed to save allergies")}}});function Q(e){const t=e.match(/(\d+)\s+days/i);return t&&t.length>1?parseInt(t[1]):null}t("P",class{constructor(){e(this,"programID",void 0),e(this,"providerID",void 0),e(this,"patientID",void 0),e(this,"date",void 0),e(this,"demographics",void 0),e(this,"previousDrugPrescriptions",[]),e(this,"previousClinicalNotes",void 0),e(this,"previousDrugAllergies",void 0);const t=O();this.demographics=t.patient,this.patientID=this.demographics.patientID,this.date=k.getSessionDate(),this.providerID=C.getUserID(),this.programID=k.getProgramID(),this.previousClinicalNotes={},this.previousDrugAllergies={}}async getPatientEncounters(){const e=await this.getPatientVisitDates(),t=e.map(async e=>{const t=e.value,a=await x.getEncounters(this.patientID,{date:t});await Promise.all(a.map(async e=>{if("NOTES"==e.type.name){const{observations:t}=e;P.isEmpty(t)||t.forEach(e=>{if("2688"==e.concept_id){const t=I.toStandardHisDisplayFormat(e.obs_datetime);P.isEmpty(this.previousClinicalNotes.hasOwnProperty(t))&&(this.previousClinicalNotes[t]=[]),this.previousClinicalNotes[t].push({date:t,notes:e.value_text})}})}if("TREATMENT"==e.type.name){const{observations:n}=e;if(!P.isEmpty(n))for(const e in n){let i="<UNKNOWN CONCEPT>";const s=n[e];try{var t;i=null!=s&&null!==(t=s.concept)&&void 0!==t&&t.concept_names?s.concept.concept_names[0].name:await B.getConceptName(s.concept_id)}catch(a){console.error(s,a)}const o=await k.resolvePrimaryValue(s),r=I.toStandardHisDisplayFormat(s.date_created);"Allergic"==i&&(this.previousDrugAllergies.hasOwnProperty(r)||(this.previousDrugAllergies[r]=[]),this.previousDrugAllergies[r].push({date:r,value:o}))}}}))});await Promise.all(t);const a=e.map(async e=>{const t=await $.getOrderByPatient(this.patientID,{start_date:e.value});if(!P.isEmpty(t)){const a=t.map(e=>({drugName:e.drug.name,value:I.toStandardHisTimeFormat(e.order.start_date),dose:e.dose,frequency:L(e.frequency),prescription:I.toStandardHisFormat(e.order.auto_expire_date),duration:Q(e.order.instructions),other:e}));this.previousDrugPrescriptions.push({prescriptionDate:I.toStandardHisDisplayFormat(e.value),previousPrescriptions:a})}});return await Promise.all(a),{previousDrugPrescriptions:this.previousDrugPrescriptions,previousClinicalNotes:this.previousClinicalNotes,previousDrugAllergies:this.previousDrugAllergies}}async getPatientVisitDates(){return(await E.getPatientVisits(this.patientID,!1)).map(e=>({label:I.toStandardHisDisplayFormat(e),value:e,other:{isActive:e===j.getSessionDate()}}))}});const K=()=>{const e=z();return e.selectedNCDMedicationList.map(t=>{t.frequency=e.frequency_selections[t.drug_id]||"",t.totalDosage=Object.values(t.dosage).reduce((e,t)=>e+Number(t),0);const a=V.getSessionDate(),n=Z(t.drug_id);return{drug_inventory_id:t.drug_id,equivalent_daily_dose:"Unknown"==t.totalDosage?0:t.totalDosage*(null==n?void 0:n.value)||0,start_date:a,auto_expire_date:ee(a,t.duration),units:t.units,instructions:`${t.name} ${t.totalDosage} ${t.units} ${(null==n?void 0:n.code)||""} for ${t.duration} days`,dose:G(t),frequency:(null==n?void 0:n.code)||"",drug_name:t.drugName,offline_id:C.generateId(C.getUserName()),program_id:C.getProgramID()}})},G=e=>null!=e.dose_strength&&e.dose_strength?Math.trunc(e.dose_strength):1;const X=()=>q().selectedMedicalDrugsList.map(e=>{const t=V.getSessionDate(),a=H.find(t=>t.label===e.frequency)||{};return{drug_inventory_id:e.drug_id,equivalent_daily_dose:"Unknown"==e.dose?0:e.dose*(null==a?void 0:a.value)||0,start_date:t,auto_expire_date:ee(t,e.duration),units:e.units,instructions:`${e.drugName}: ${e.dose} ${e.units} ${(null==a?void 0:a.code)||""} for ${e.duration} days`,dose:e.dose,frequency:(null==a?void 0:a.code)||"",drug_name:e.drugName,offline_id:C.generateId(C.getUserName()),program_id:C.getProgramID()}}),Z=e=>{const t=z().selectedNCDMedicationList.find(t=>t.drug_id===e);if(!t||!t.dosage)return null;switch(["morning","afternoon","evening"].reduce((e,a)=>e+(t.dosage[a]?1:0),0)){case 1:return t.dosage.morning?H.find(e=>"QAM"===e.code):t.dosage.afternoon?H.find(e=>"QNOON"===e.code):t.dosage.evening?H.find(e=>"QPM"===e.code):H.find(e=>"OD"===e.code);case 2:return H.find(e=>"BD"===e.code);case 3:return H.find(e=>"TDS"===e.code);default:return H.find(e=>"Unknown"===e.code)}},ee=(e,t)=>{const a=new Date(e);return a.setDate(a.getDate()+parseInt(t)),I.toStandardHisFormat(a)};t("b",n("nonPharmaTherapyStore",{state:()=>({items:[{id:"wound-dressing",label:"Wound dressing",checked:!1},{id:"patient-education",label:"Patient education",checked:!1},{id:"counseling",label:"Counseling",checked:!1},{id:"minor-surgery",label:"Minor Surgery",checked:!1}],current_patient:{}}),actions:{async saveNonPharmaTherapyPatientData(){const e=A(),t=[];this.items.forEach(a=>{1==a.checked&&t.push({concept_id:11023,value_text:a.label,obs_datetime:I.toStandardHisFormat(C.getSessionDate()),location_id:e.facilityLocation.code})});const a=q().nonPharmalogicalTherapyAndOtherNotes;a&&t.push({concept_id:2592,obs_datetime:C.getSessionDate(),value_text:a,location_id:e.facilityLocation.code});try{if(t.length>0)return this.clearSelectednonPharmaTherapyStore(),F("Non Pharma Therapy staged successfully!"),await async function(e){try{var t,a,n;const s=O(),{patient:o}=i(s),r=JSON.parse(JSON.stringify(o.value));return null!==(a=(t=null!==(n=r.notes)&&void 0!==n?n:r.notes={}).unsaved)&&void 0!==a||(t.unsaved=[]),r.notes.unsaved.push(...e),r}catch(s){M("Unable to create non pharmalogical notes!")}}(t)}catch(n){M("Unable to update Non Pharma Therapy!")}},clearSelectednonPharmaTherapyStore(){this.items.forEach(e=>{e.checked=!1})},setCurrentPatient(e){this.current_patient=e}},persist:!0}));const te={class:"fw-list-wrapper"},ae=["id"],ne={class:"fw-step-container"},ie={key:0},se={key:1},oe=s({__name:"WizardStep",props:{tab:{type:Object,default:()=>{}},index:{type:Number,default:0},currentIndex:{type:Number,default:0},squaredTab:{type:Boolean,default:!1},showProgress:{type:Boolean,default:!0}},setup(e){const t=e,a=o(()=>t.currentIndex>t.index);o(()=>`pi pi-${t.tab.icon}`);const n=o(()=>["fw-list-wrapper-icon",{"fw-step-active":t.tab.active,"fw-step-checked":t.tab.checked,"fw-squared-tab":t.squaredTab}]);return(t,i)=>{const s=r("ion-icon");return d(),l("li",null,[e.showProgress?(d(),l("div",{key:0,class:p(["fw-list-progress",{"fw-list-progress-active":a.value}])},null,2)):c("",!0),u("div",te,[u("div",{id:`step-${e.tab.id}`,role:"tab",class:p(n.value)},[u("div",ne,[g(t.$slots,"active-step",{},()=>[e.tab.icon?(d(),l("i",ie,[v(s,{icon:e.tab.icon,style:{"font-size":"16px"}},null,8,["icon"])])):(d(),l("i",se,h(e.index+1),1))])])],10,ae),g(t.$slots,"title",{},()=>[u("span",{class:p(["fw-step-title",{active:e.tab.active}])},h(e.tab.title),3)])])])}}}),re=["disabled"],le={key:0},de=s({__name:"Button",props:{options:{type:Object,default:function(){return{}}}},setup(e){const t=e,a=o(()=>["fw-btn",{"fw-btn-disabled":t.options.disabled}]);return(t,n)=>{return d(),l("button",{class:p(a.value),disabled:e.options.disabled},[e.options.hideText?c("",!0):(d(),l("span",le,h(e.options.text),1)),e.options.hideIcon?c("",!0):(d(),l("i",{key:1,class:p((i=e.options.icon,`pi pi-${i}`))},null,2))],10,re);var i}}}),ce=["id"],ue={key:0,class:"fw-body-list",role:"tablist"},pe={class:"fw-body"},ge={class:"fw-body-content"},ve={class:"fw-body-container"},he={key:0,class:"fw-footer"},fe={class:"fw-footer-left"},be={class:"fw-footer-right"};t("_",s({__name:"Wizard",props:{id:{type:String,default:"fw-"+(new Date).valueOf()},headingTitle:{type:String,default:""},customTabs:{type:Array,default:()=>[{id:0,title:"Step 1",icon:"map"},{id:1,title:"Step 2",icon:"check"},{id:2,title:"Step 3",icon:"pencil"}]},nextButton:{type:Object,default:function(){return{}}},backButton:{type:Object,default:function(){return{}}},doneButton:{type:Object,default:function(){return{}}},hideButtons:{type:Boolean,default:!1},startIndex:{type:Number,default:0,validator:e=>e>=0},verticalTabs:{type:Boolean,default:!1},beforeChange:{type:Function,default:()=>{}},beforeMount:{type:Function,default:()=>{}},navigableTabs:{type:Boolean,default:!1},scrollableTabs:{type:Boolean,default:!1},cardBackground:{type:Boolean,default:!1},squaredTabs:{type:Boolean,default:!1},showProgress:{type:Boolean,default:!0},showWizard:{type:Boolean,default:!0}},emits:["change","complete:wizard","updated:tabs","onValidateTabs","done-button-changed"],setup(e,{expose:t,emit:a}){const n=a,i=e;let s=f(0);const r=o(()=>[...i.customTabs].map((e,t)=>({...e,checked:t<s.value,active:t===s.value}))),P=o(()=>r.value.length-1),T=o(()=>Object.assign({text:"Back",icon:"arrow-left",hideText:!1,hideIcon:!1,disabled:!1},i.backButton)),O=o(()=>Object.assign({text:"Next",icon:"arrow-right",hideText:!1,hideIcon:!1,disabled:!1},i.nextButton)),k=o(()=>Object.assign({text:"Done",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},i.doneButton));b(()=>i.doneButton,(e,t)=>{n("done-button-changed",{newOptions:k.value,oldOptions:t?Object.assign({text:"Done",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},t):null,currentTabIndex:s.value,isLastStep:x.value})},{deep:!0,immediate:!1}),b(k,(e,t)=>{console.log("Done button options changed:",{new:e,old:t,currentStep:s.value})},{deep:!0}),y(()=>{s.value=i.startIndex,B(),n("change",s.value)});const C=o(()=>0!==s.value),x=o(()=>s.value===P.value),I=o(()=>["form-wizard-vue",{"fw-vertical":i.verticalTabs},{"fw-overflow-scroll":i.scrollableTabs},{"fw-card":i.cardBackground}]),B=()=>{n("updated:tabs",r.value,s.value)},$=async()=>{if(s.value===P.value)return void(k.value.disabled||j());if(O.value.disabled)return;const e=s.value+1,t=s.value;i.navigableTabs?(n("change",e,t),await i.beforeChange(),M(e)):n("change",e,t,!0)},E=async()=>{if(0===s.value||T.value.disabled)return;const e=s.value-1,t=s.value;n("change",e,t),await i.beforeChange(),M(e)},j=()=>{const e=s.value,t=s.value-1;n("complete:wizard",e,t)},F=async e=>{if(!i.navigableTabs)return;const t=e,a=s.value;n("change",t,a),await i.beforeChange(),M(t)},M=async e=>{s.value=e,B(),await N(),await i.beforeMount()};return t({changeTab:M}),(t,a)=>(d(),l("div",{id:e.id,class:p(I.value)},[e.showWizard?(d(),l("ul",ue,[u("h4",null,h(e.headingTitle),1),(d(!0),l(m,null,D(r.value,(a,n)=>g(t.$slots,"wizard-step",{tab:a,index:n,navigateToTab:F},()=>[(d(),S(oe,{key:a.id,tab:a,index:n,currentIndex:_(s),squaredTab:e.squaredTabs,showProgress:e.showProgress,onClick:e=>F(n)},{"active-step":w(()=>[g(t.$slots,"active-step")]),title:w(()=>[g(t.$slots,"title")]),_:3},8,["tab","index","currentIndex","squaredTab","showProgress","onClick"]))])),256))])):c("",!0),u("div",pe,[u("div",ge,[u("div",ve,[g(t.$slots,"default")])]),e.hideButtons?c("",!0):(d(),l("div",he,[g(t.$slots,"footer",{},()=>[u("div",fe,[C.value?(d(),l("span",{key:0,role:"button",onClick:E},[g(t.$slots,"back",{},()=>[v(de,{options:T.value},null,8,["options"])])])):c("",!0),g(t.$slots,"custom-buttons-left")]),u("div",be,[g(t.$slots,"custom-buttons-right"),x.value?(d(),l("span",{key:0,role:"button",onClick:$},[g(t.$slots,"done",{},()=>[v(de,{options:k.value},null,8,["options"])])])):(d(),l("div",{key:1,role:"button",onClick:$},[g(t.$slots,"next",{},()=>[v(de,{options:O.value},null,8,["options"])])]))])])]))])],10,ce))}})),t("u",()=>{const e=f(""),t=t=>{t%1==0&&(e.value=t)};return{currentTabIndex:e,onChangeCurrentTab:t,onTabBeforeChange:a=>{0===e.value&&console.log("First Tab"),t(a)},changeBtnIconPosition:()=>{N(()=>{const e=document.querySelector(".fw-footer-left .fw-btn");if(!e)return;const t=e.querySelector("span"),a=e.querySelector("i");t&&a&&(e.removeChild(t),e.removeChild(a),e.appendChild(a),e.appendChild(t))})}}})}}})}();

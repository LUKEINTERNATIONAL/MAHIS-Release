import{cm as p,cn as w,aG as c,aF as R}from"../index-DySoFw7y.js";import{T as D}from"./tx_report_service-D37f1SGz.js";import{l as v}from"./lodash-NJiRuGo9.js";import{d as T,r as i,O as F,f as G}from"./vendor-ChpUWbYC.js";import"./apexcharts-Cj7xBElI.js";import"./age_groups-BkW1n_F5.js";const P=T({__name:"TxRTT",setup(A){const d=i("-"),g=i([]),u=i(),r=new D,_=[{path:"ageGroup",label:"Age group"},{path:"gender",label:"Gender",formatter:p},{path:"cd4_less_than_200",label:"CD4 <200",drillable:!0},{path:"cd4_greater_than_or_equal_to_200",label:"CD4 >=200",drillable:!0},{path:"unknown_cd4_count",label:"Unknown CD4",drillable:!0},{path:"not_eligible_for_cd4",label:"Not Eligible for CD4",drillable:!0},{path:"returned_less_than_3_months",label:"Returned <3 mo",drillable:!0},{path:"returned_greater_than_3_months_and_less_than_6_months",label:"Returned 3-5 mo",drillable:!0},{path:"returned_greater_than_or_equal_to_6_months",label:"Returned 6+ mo",drillable:!0}];function h(e){const o={M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}};return e.reduce((a,t)=>{if(t.age_group!=="Unknown"){const l=t.gender;a[l].rows.push({...t,ageGroup:t.age_group}),a[l].aggregate=Object.keys(t).reduce((s,n)=>Array.isArray(t[n])?{...s,[n]:[...s[n]||[],...t[n]]}:s,a[l].aggregate)}return a},o)}function b(e){const o=Object.values(e.F.aggregate).flat(1),a=Object.values(e.M.aggregate).flat(1);u.value=v.uniq([...o,...a])}async function f(e,o=!1){try{await c.show(),r.setStartDate(e.dateRange.startDate),r.setEndDate(e.dateRange.endDate),r.setOccupation(e.occupation),d.value=r.getDateIntervalPeriod();const a=await r.getTxRttReport(o),t=h(a);g.value=[...t.F.rows,...t.M.rows,{ageGroup:"All",gender:"Male",...t.M.aggregate},...await r.buildMaternityAgreggateRows(t.F.aggregate)],b(t)}catch(a){R("ERROR! Unable to load report data"),console.error(a)}await c.hide()}function m(e){return"".concat(e.column.label," | ").concat(e.row.ageGroup," | ").concat(p(e.row.gender),"s")}return(e,o)=>(G(),F(w,{title:"PEPFAR TX RTT Report",subtitle:"Clients that have their clinical dispensation visit falling \n      in the reporting period and there is a difference of 30 or more days \n      between their visit date and their previous appointment date / runout date","report-type":"PEPFAR",columns:_,rows:g.value,period:d.value,"total-clients":u.value,"drill-title":m,useDateRangeFilter:"",showIndices:"",onGenerate:f},null,8,["rows","period","total-clients"]))}});export{P as default};

import{d as y,ah as T,aS as B,b6 as m,a5 as I,a4 as $,G as S,E as k,a6 as C,cm as E,I as H,a3 as V,cS as x,H as n,O as h,f as u,J as d,e as F,m as b,l as r,k as e,p as P}from"./vendor-BDGIuVwJ.js";import{J as U,Q as L,T as O,c as R,t as A,H as c,P as G,u as N,_ as z}from"../index-lAUB1meQ.js";import{I as J,a as M}from"./ImmunizationGroupGraph-D3sBxc9P.js";import{g as j}from"./dashboard_service-CQdZmR1k.js";import{u as Q}from"./StartEndDate-DR0_bNLV.js";import{B as W}from"./BasicForm-DUnfo8vp.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-XnpXrK8U.js";import"./DateInputField-CdOLGRjF.js";const q=y({name:"Home",mixins:[R],components:{IonContent:V,IonHeader:H,IonMenuButton:E,IonPage:C,IonTitle:k,IonToolbar:S,Toolbar:O,ToolbarSearch:L,IonRow:$,IonCol:I,ImmunizationTrendsGraph:M,ImmunizationGroupGraph:J,DataTable:m,IonCard:B,DynamicButton:U,BasicForm:W},data(){return{reportData:[],startDate:c.sessionDate(),endDate:c.sessionDate(),options:{responsive:!0,select:!1},selectButton:"all",isLoading:!1}},computed:{...T(Q,["startEndDate"])},watch:{$route:{async handler(t){t.name=="OverDueReport"&&await this.buildTableData().then(()=>{var s;((s=this.$refs.dataTable)==null?void 0:s.dt).on("click",".follow-up-btn",o=>{const i=o.target.getAttribute("data-id");this.handleFollowUp(i)})})},deep:!0}},async mounted(){await this.buildTableData().then(()=>{var a;((a=this.$refs.dataTable)==null?void 0:a.dt).on("click",".follow-up-btn",s=>{const o=s.target.getAttribute("data-id");this.handleFollowUp(o)})})},methods:{async handleFollowUp(t){const a=await G.findByID(t);await N().setPatientRecord(a),this.$router.push("patientProfile")},async handleInputData(t){t.inputHeader=="Start date"&&(this.startDate=c.toStandardHisFormat(t.value)),t.inputHeader=="End date"&&(this.endDate=c.toStandardHisFormat(t.value)),await this.buildTableData()},async buildTableData(){this.isLoading=!0;try{this.reportData=[],(await j()).forEach(a=>{a.value.under_five_missed_visits.concat(a.value.over_five_missed_visits).forEach(o=>{let i=0,l=o.client.table;o.missed_visits.forEach(p=>{i+=p.antigens.length}),this.reportData.push(["".concat(l.given_name," ").concat(l.family_name),l.birthdate,i,'<button class="btn btn-sm btn-primary follow-up-btn" data-id="'.concat(l.patient_id,'">Follow UP</button>')])})}),m.use(x)}catch(t){A("An error occure while loading data."),console.log(t)}finally{this.isLoading=!1}},async selectedButton(t){this.selectButton=t,await this.buildTableData()},async selectButton(t){this.selectedButton=t,await this.buildTableData()}}}),K={key:0,class:"spinner-overlay"},X={class:"container"},Y={style:{display:"flex","justify-content":"space-between"}},Z={style:{display:"inline-block","vertical-align":"top","max-width":"400px",top:"-10px",position:"relative","margin-right":"10px"}},tt={style:{display:"inline-block","vertical-align":"top","margin-top":"10px",float:"right"}};function at(t,a,s,o,i,l){const p=n("ion-spinner"),f=n("Toolbar"),_=n("basic-form"),D=n("ion-button"),g=n("DataTable"),v=n("ion-content"),w=n("ion-page");return u(),h(w,{class:P({loading:t.isLoading})},{default:d(()=>[t.isLoading?(u(),F("div",K,[r(p,{name:"bubles"}),a[0]||(a[0]=e("div",{class:"loading-text"},"Please wait...",-1))])):b("",!0),r(f),r(v,null,{default:d(()=>[e("div",X,[a[3]||(a[3]=e("h1",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Overdue Report",-1)),e("div",Y,[e("div",Z,[r(_,{contentData:t.startEndDate,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:inputValue"])]),e("div",tt,[r(D,{class:"addBtn",color:"primary"},{default:d(()=>[...a[1]||(a[1]=[e("div",null,[e("div",{class:"centerBigBtnContain"},"Export To CSV")],-1)])]),_:1})])]),t.reportData.length>0?(u(),h(g,{key:0,ref:"dataTable",options:t.options,data:t.reportData,class:"display nowrap",width:"100%"},{default:d(()=>[...a[2]||(a[2]=[e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Date Of Birth"),e("th",null,"Missed Doses"),e("th",null,"Action")])],-1)])]),_:1},8,["options","data"])):b("",!0)])]),_:1})]),_:1},8,["class"])}const pt=z(q,[["render",at],["__scopeId","data-v-c8399978"]]);export{pt as default};

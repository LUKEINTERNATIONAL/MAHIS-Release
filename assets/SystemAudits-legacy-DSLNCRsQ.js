System.register(["./vendor-legacy-aFxqAHge.js","./index-legacy-DJgBI0ZS.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-Drh6JTfI.js"],function(e,a){"use strict";var t,l,d,n,u,i,r,o,s,c,v,p,b,g,m,f,h,y,_,x,w,k,S,C,A,D,$,z,j,T,U,E,I,N,O,P,V,F,B,G,H;return{setters:[e=>{t=e.d,l=e.r,d=e.c,n=e.w,u=e.a,i=e.y,r=e.f,o=e.z,s=e.l,c=e.u,v=e.a9,p=e.bp,b=e.aa,g=e.ab,m=e.k,f=e.b0,h=e.a$,y=e.m,_=e.a_,x=e.A,w=e.B,k=e.ca,S=e.aZ,C=e.e,A=e.i,D=e.bf,$=e.W,z=e.F,j=e.L,T=e.b8,U=e.S,E=e.U,I=e.T,N=e.aU,O=e.af},e=>{P=e.T,V=e.au,F=e.av,B=e.U,G=e.H,H=e._},null,null],execute:function(){var a=document.createElement("style");a.textContent="ion-card[data-v-bde1132c]{margin:16px}.table-responsive[data-v-bde1132c]{overflow-x:auto}.audits-table[data-v-bde1132c],.changes-table[data-v-bde1132c]{width:100%;border-collapse:collapse;margin-bottom:1rem}.audits-table th[data-v-bde1132c],.audits-table td[data-v-bde1132c],.changes-table th[data-v-bde1132c],.changes-table td[data-v-bde1132c]{padding:.75rem;text-align:left;border-bottom:1px solid #dee2e6}.audits-table th[data-v-bde1132c],.changes-table th[data-v-bde1132c]{font-weight:600;background-color:#f8f9fa}.audits-table tr[data-v-bde1132c]:hover,.changes-table tr[data-v-bde1132c]:hover{background-color:rgba(0,0,0,.03)}.pagination-container[data-v-bde1132c]{display:flex;justify-content:center;align-items:center;gap:1rem;margin-top:1rem}.page-info[data-v-bde1132c]{font-size:.9rem;color:var(--ion-color-medium)}.date-controls[data-v-bde1132c]{margin-bottom:1rem}.date-inputs[data-v-bde1132c]{display:flex;align-items:end;gap:1rem;flex-wrap:wrap}.date-input-group[data-v-bde1132c]{display:flex;flex-direction:column;gap:.25rem}.date-input-group label[data-v-bde1132c]{font-size:.875rem;font-weight:500;color:var(--ion-color-medium)}.date-input[data-v-bde1132c]{padding:.5rem;border:1px solid #d1d5db;border-radius:4px;font-size:.875rem;background-color:#fff;min-width:140px}.date-input[data-v-bde1132c]:focus{outline:none;border-color:var(--ion-color-primary);box-shadow:0 0 0 2px rgba(var(--ion-color-primary-rgb),.2)}@media (max-width: 768px){.date-inputs[data-v-bde1132c]{flex-direction:column;align-items:stretch}.date-input[data-v-bde1132c]{min-width:auto}}ion-modal[data-v-bde1132c]{--width: 80%;--height: 70%;--border-radius: 8px}@media (max-width: 768px){ion-modal[data-v-bde1132c]{--width: 95%;--height: 80%}}.card-wrapper[data-v-bde1132c]{display:flex;justify-content:center}ion-card[data-v-bde1132c]{max-width:1000px;width:100%}\n/*$vite$:1*/",document.head.appendChild(a);const L={class:"card-wrapper"},R={class:"date-controls"},M={class:"date-inputs"},W={class:"date-input-group"},Z=["max"],q={class:"date-input-group"},J=["min","max"],K={key:0,class:"table-responsive"},Q={class:"audits-table"},X={key:0,class:"pagination-container"},Y={class:"page-info"},ee={key:1,class:"ion-text-center ion-padding"},ae={key:2,class:"ion-text-center ion-padding"},te={class:"table-responsive"},le={class:"changes-table"};e("default",H(t({__name:"SystemAudits",setup(e){const a=l("System Audits"),t=l([]),H=l("");l(""),l("");const de=l(""),ne=l(""),ue=l(!1),ie=l(1),re=l(!1),oe=l(""),se=l([]),ce=d(()=>Math.ceil(t.value.length/20)),ve=d(()=>{const e=20*(ie.value-1),a=e+20;return t.value.slice(e,a)});n([de,ne],([e,a])=>{e&&a&&(H.value=`${be(e)} - ${be(a)}`)}),u(()=>{const e=new Date;ne.value=e.toISOString().split("T")[0],de.value=e.toISOString().split("T")[0]});const pe=()=>(new Date).toISOString().split("T")[0],be=e=>new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),ge=async()=>{if(de.value&&ne.value){await F.show();try{t.value=await B.getAuditReports(de.value,ne.value),ue.value=!0,ie.value=1}catch(e){console.error("Error generating audit report:",e),V("Failed to generate audit report"),t.value=[]}finally{await F.hide()}}else V("Please select both start and end dates")},me=()=>{re.value=!1,oe.value="",se.value=[]},fe=()=>{ie.value<ce.value&&ie.value++},he=()=>{ie.value>1&&ie.value--};return(e,l)=>(r(),i(c(O),null,{default:o(()=>[s(P,{title:"System Audits"}),s(c(v),null,{default:o(()=>[s(c(p),null,{default:o(()=>[s(c(b),null,{default:o(()=>[s(c(g),{size:"12","size-md":"12","size-lg":"12"},{default:o(()=>[m("div",L,[s(c(f),null,{default:o(()=>[s(c(h),null,{default:o(()=>[s(c(_),null,{default:o(()=>[x(w(a.value),1)]),_:1}),H.value?(r(),i(c(k),{key:0},{default:o(()=>[x(w(H.value),1)]),_:1})):y("",!0)]),_:1}),s(c(S),null,{default:o(()=>[m("div",R,[m("div",M,[m("div",W,[l[2]||(l[2]=m("label",null,"Start Date:",-1)),A(m("input",{type:"date","onUpdate:modelValue":l[0]||(l[0]=e=>de.value=e),max:ne.value||pe(),class:"date-input"},null,8,Z),[[D,de.value]])]),m("div",q,[l[3]||(l[3]=m("label",null,"End Date:",-1)),A(m("input",{type:"date","onUpdate:modelValue":l[1]||(l[1]=e=>ne.value=e),min:de.value,max:pe(),class:"date-input"},null,8,J),[[D,ne.value]])]),s(c($),{fill:"solid",onClick:ge,disabled:!de.value||!ne.value},{default:o(()=>l[4]||(l[4]=[x(" Generate Report ")])),_:1,__:[4]},8,["disabled"])])]),t.value.length>0?(r(),C("div",K,[m("table",Q,[l[5]||(l[5]=m("thead",null,[m("tr",null,[m("th",null,"Encounter"),m("th",null,"Action Type"),m("th",null,"User"),m("th",null,"Timestamp"),m("th",null,"Changes")])],-1)),m("tbody",null,[(r(!0),C(z,null,j(ve.value,e=>{return r(),C("tr",{key:e.id},[m("td",null,w(e.auditable_type),1),m("td",null,w(e.action),1),m("td",null,w((t=e.user,t?`${t.username} (${t.name})`:"")),1),m("td",null,w((a=e.created_at,G.toStandardHisDisplayFormat(a))),1),m("td",null,[s(c($),{size:"small",fill:"outline",onClick:a=>(async e=>{if(!e.changes||0===e.changes.length)return;const a=e.changes.map(e=>{const[a,t]=Object.entries(e)[0]||[];return a?/password/i.test(a)?{attribute:a,previous:"*******",current:"*******"}:{attribute:a,...t}:null}).filter(e=>null!==e);oe.value=`Changes made by ${e.user.name} on ${e.auditable_type}`,se.value=a,re.value=!0})(e),disabled:!e.changes||0===e.changes.length},{default:o(()=>{var a,t;return[x(w(null!==(a=null===(t=e.changes)||void 0===t?void 0:t.length)&&void 0!==a?a:0)+" Changes ",1)]}),_:2},1032,["onClick","disabled"])])]);var a,t}),128))])]),ce.value>1?(r(),C("div",X,[s(c($),{fill:"clear",onClick:he,disabled:1===ie.value},{default:o(()=>l[6]||(l[6]=[x(" Previous ")])),_:1,__:[6]},8,["disabled"]),m("span",Y," Page "+w(ie.value)+" of "+w(ce.value),1),s(c($),{fill:"clear",onClick:fe,disabled:ie.value===ce.value},{default:o(()=>l[7]||(l[7]=[x(" Next ")])),_:1,__:[7]},8,["disabled"])])):y("",!0)])):0===t.value.length&&ue.value?(r(),C("div",ee,l[8]||(l[8]=[m("p",null,"No audit records found for the selected period",-1)]))):(r(),C("div",ae,l[9]||(l[9]=[m("p",null,"Select date range and generate report to view audit data",-1)])))]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),s(c(T),{"is-open":re.value,onDidDismiss:me},{default:o(()=>[s(c(U),null,{default:o(()=>[s(c(E),null,{default:o(()=>[s(c(I),null,{default:o(()=>[x(w(oe.value),1)]),_:1}),s(c(N),{slot:"end"},{default:o(()=>[s(c($),{onClick:me},{default:o(()=>l[10]||(l[10]=[x("Close")])),_:1,__:[10]})]),_:1})]),_:1})]),_:1}),s(c(v),null,{default:o(()=>[s(c(f),null,{default:o(()=>[s(c(S),null,{default:o(()=>[m("div",te,[m("table",le,[l[11]||(l[11]=m("thead",null,[m("tr",null,[m("th",null,"Attribute"),m("th",null,"Previous Value"),m("th",null,"Current Value")])],-1)),m("tbody",null,[(r(!0),C(z,null,j(se.value,(e,a)=>(r(),C("tr",{key:a},[m("td",null,w(e.attribute),1),m("td",null,w(e.previous||"N/A"),1),m("td",null,w(e.current||"N/A"),1)]))),128))])])])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])]),_:1}))}}),[["__scopeId","data-v-bde1132c"]]))}}});

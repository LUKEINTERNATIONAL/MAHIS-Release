System.register(["./index-legacy-BKn2OBE1.js","./ReportTable-legacy-BIgtqtdW.js","./report_service-legacy-DssYG6bu.js","./age_groups-legacy-PcrIMUD9.js","./lodash-legacy-C-x9g9Na.js","./vendor-legacy-BH_DPLXA.js","./apexcharts-legacy-Ddll0ZEF.js","./chartjs-legacy-DsDMQJGb.js","./barcode-qrcode-reader-legacy-1bXfHeGc.js"],(function(e,a){"use strict";var t,r,l,s,u,i,o,n,d,p,g,c,b,v,h,m;return{setters:[e=>{t=e.d,r=e.p,l=e.e,s=e.l,u=e.a},e=>{i=e.g,o=e.R},e=>{n=e.R,d=e.L},e=>{p=e.A},e=>{g=e.l},e=>{c=e.d,b=e.r,v=e.c,h=e.y,m=e.f},null,null,null],execute:function(){class a extends n{constructor(){super(),this.programId=d}buildLabPatientLevelData(e){return e.flatMap((e=>e.measures.map((a=>({...e,test_name:a.name,result:`${a.modifier} ${a.value}`})))))}buildLabResultRowData(e,a,t){const r=e.filter((e=>e.gender===t&&e.age_group===a)).map((({patient_id:e})=>e));return{ageGroup:a,gender:t,viral_load:r}}buildLabDisaggregatedData(e){const a=[],t=[];return p.forEach((r=>{a.push(this.buildLabResultRowData(e,r,"M")),t.push(this.buildLabResultRowData(e,r,"F"))})),[...t,...a]}async getLabResultReport(){const e=await this.getReport("lab_test_results");if(!e)return{};const a=this.buildLabPatientLevelData(e);return{patientLevelData:a,disaggregatedData:this.buildLabDisaggregatedData(a)}}}e("default",c({__name:"LabResultsReport",setup(e){const n=b("-"),d=b(""),p=[i("patient_id")],c=b({}),R=v((()=>g.isEmpty(c.value)?[]:"disaggregated"===d.value?c.value.disaggregatedData:c.value.patientLevelData)),y=v((()=>"disaggregated"===d.value?[{path:"ageGroup",label:"Age Group"},{path:"gender",label:"Gender",formatter:t},{path:"viral_load",label:"HIV viral load",drillable:!0}]:[{path:"arv_number",label:"ARV Number",preSort:r,initialSort:!0},{path:"gender",label:"Gender",formatter:t},{path:"birthdate",label:"Birthdate",formatter:l},{path:"order_date",label:"Ordered",formatter:l},{path:"test",label:"Specimen"},{path:"test_name",label:"Test"},{path:"result",label:"Result"},{path:"result_date",label:"Released",formatter:l}])),D=v((()=>[{id:"type",label:"Select report type",required:!1,type:"select",options:[{label:"Disaggregated",value:"disaggregated"},{label:"Patient level",value:"patient_level"}],onUpdate:e=>{d.value=e.value}}]));async function f(e){await s.show();try{const t=new a;t.setStartDate(e.dateRange.startDate),t.setEndDate(e.dateRange.endDate),t.setOccupation(e.occupation),n.value=t.getDateIntervalPeriod(),c.value=await t.getLabResultReport()}catch(t){u("Unable to load report data"),console.error(t)}await s.hide()}return(e,a)=>(m(),h(o,{"report-type":"Clinic",title:"Lab Test Result(s) Report",columns:y.value,rows:R.value,period:n.value,"row-action-buttons":p,"custom-filters":D.value,"use-date-range-filter":"","use-secure-export":"",onGenerate:f},null,8,["columns","rows","period","custom-filters"]))}}))}}}));

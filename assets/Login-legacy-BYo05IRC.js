System.register(["./vendor-legacy-DdA49bfy.js","./index-legacy-CWsSMmEJ.js","./Img-legacy-BNmikZ_d.js","./userService-legacy-C7qnpuhl.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-GlXIQsEy.js"],function(e,a){"use strict";var t,l,s,n,r,o,i,u,d,c,f,v,p,m,w,g,h,y,P,x,b,A,k,_,I,C,S,q,E,M,U,z,L,R,j,N,O,F,K,$,D,H,T,B,J,G,Q,X,Y;return{setters:[e=>{t=e.D,l=e.d,s=e.r,n=e.aO,r=e.c,o=e.a,i=e.H,u=e.O,d=e.f,c=e.J,f=e.l,v=e.u,p=e.a4,m=e.k,w=e.aS,g=e.aP,h=e.e,y=e.m,P=e.dB,x=e.E,b=e.Q,A=e.K,k=e.b2,_=e.X,I=e.cP,C=e.bx,S=e.c1,q=e.c0,E=e.N,M=e.bs,U=e.p,z=e.a7},e=>{L=e.x,R=e.a2,j=e.t,N=e.U,O=e.K,F=e.a3,K=e.s,$=e.a4,D=e.a5,H=e.a6,T=e.a1,B=e.y,J=e.a7,G=e._},e=>{Q=e.i},e=>{X=e.p,Y=e.g},null,null],execute:function(){var a=document.createElement("style");a.textContent='.login-page[data-v-ffa40062]{background-color:#fff}.login-container[data-v-ffa40062]{display:flex;justify-content:center;align-items:center;text-align:center;height:90vh}.login-title[data-v-ffa40062]{font-size:24px;margin-bottom:30px;font-weight:700;margin-top:20px}.input-fields[data-v-ffa40062]{margin-bottom:35px}.invalid-input[data-v-ffa40062]{--border-color: #ff4444 !important;--color: #ff4444 !important}.password-requirements[data-v-ffa40062]{text-align:left;margin-bottom:20px;padding:15px;background-color:#f8f9fa;border-radius:8px;border-left:4px solid #34af4d}.requirements-title[data-v-ffa40062]{margin:0 0 10px;font-weight:600;color:#333;font-size:14px}.requirements-list[data-v-ffa40062]{margin:0;padding-left:20px;list-style:none}.requirements-list li[data-v-ffa40062]{margin-bottom:5px;font-size:13px;color:#666;position:relative}.requirements-list li[data-v-ffa40062]:before{content:"✗";color:#f44;font-weight:700;position:absolute;left:-20px}.requirements-list li.valid[data-v-ffa40062]:before{content:"✓";color:#34af4d}.requirements-list li.valid[data-v-ffa40062]{color:#34af4d}.password-toggle[data-v-ffa40062]{cursor:pointer;position:absolute;margin-top:-73px;margin-left:130px;z-index:1000}.login-button[data-v-ffa40062]{color:#fff;margin-top:30px}.login-button[data-v-ffa40062]:disabled{opacity:.5;cursor:not-allowed}.signup-link[data-v-ffa40062]{margin-top:50px}.signup-link a[data-v-ffa40062]{text-decoration:underline;color:#34af4d;cursor:pointer}.signup-link a[data-v-ffa40062]:hover{color:#2d8f3f}.password-toggle[data-v-ffa40062]{font-size:20px}.login_img[data-v-ffa40062]{width:90px;margin:auto}ion-card[data-v-ffa40062]{min-width:330px}@media(max-width:902px){.login-page[data-v-ffa40062]{--ion-background-color: #ffffff}ion-card[data-v-ffa40062]{box-shadow:unset}}\n/*$vite$:1*/',document.head.appendChild(a);const Z=t("authStatusStore",{state:()=>({emrAuthenticated:!1,miumAuthenticated:!1,lastLoginAttempt:null,loginTimestamp:null,username:""}),getters:{isPartiallyAuthenticated:e=>e.emrAuthenticated||e.miumAuthenticated,isFullyAuthenticated:e=>e.emrAuthenticated&&e.miumAuthenticated,authenticationStatus:e=>e.emrAuthenticated&&e.miumAuthenticated?"full":e.emrAuthenticated||e.miumAuthenticated?"partial":"none",authenticatedSystems:e=>{const a=[];return e.emrAuthenticated&&a.push("EMR"),e.miumAuthenticated&&a.push("MIUM"),a},failedSystems:e=>{const a=[];return e.emrAuthenticated||a.push("EMR"),e.miumAuthenticated||a.push("MIUM"),a}},actions:{setEMRAuthenticated(e){this.emrAuthenticated=e,e&&(this.loginTimestamp=new Date)},setMIUMAuthenticated(e){this.miumAuthenticated=e},setUsername(e){this.username=e},recordLoginAttempt(){this.lastLoginAttempt=new Date},clearAuthStatus(){this.emrAuthenticated=!1,this.miumAuthenticated=!1,this.loginTimestamp=null,this.lastLoginAttempt=null,this.username=""},hasSystemAccess(e){return"EMR"===e?this.emrAuthenticated:this.miumAuthenticated}},persist:!0}),V={class:"login-container"},W={key:0,style:{"justify-content":"center",display:"block"}},ee={style:{"font-size":"15px"}},ae={style:{"font-size":"12px",color:"#34af4d"}},te={key:1},le={style:{"font-size":"15px"}},se={key:0},ne={style:{"text-align":"left"}},re={class:"signup-link"},oe={key:1},ie={style:{"text-align":"left"}},ue={key:0,class:"password-requirements"},de={class:"requirements-list"},ce={class:"signup-link"};e("default",G(l({__name:"Login",setup(e){const a=s(""),t=s(""),l=s(""),G=s(!1),fe=s(!1),ve=s("test"),pe=s(new J),me=s({username:"",currentPassword:"",newPassword:"",confirmPassword:""}),we=s(!1),ge=s(!1),he=s(!1),ye=n(),Pe=L(),xe=r(()=>""!==me.value.username.trim()&&""!==me.value.currentPassword.trim()&&""!==me.value.newPassword.trim()&&""!==me.value.confirmPassword.trim()&&R(me.value.newPassword)&&me.value.newPassword===me.value.confirmPassword&&me.value.newPassword!==me.value.currentPassword),be=()=>{fe.value=!fe.value,fe.value&&(me.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""})},Ae=()=>{j("Help functionality to be implemented")},ke=async()=>{if(!xe.value)return j("Please complete all fields correctly"),void j("Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character.");try{const e=await pe.value.requestLogin(me.value.currentPassword,me.value.username);if(e){const{authorization:a}=e,{token:t,user:l}=a;l&&(localStorage.setItem("apiKey",t),await N.updateUser(l.user_id,{password:me.value.newPassword}),O("Password changed successfully!"),await pe.value.requestLogin(me.value.newPassword,me.value.username),me.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""},fe.value=!1,localStorage.setItem("apiKey",""))}}catch(e){K(e instanceof F?"Current password is incorrect":`Error changing password: ${e}`)}},_e=async()=>{const e=Z();if(!a.value||!t.value)return{success:!1,error:null,validationError:!0};pe.value.setUsername(a.value),e.setUsername(a.value);try{return await pe.value.login(t.value),await(async()=>{const e=T(),a=await Y();a&&(e.setUserFacilityName(a.name),e.setFacilityLocation(a),localStorage.setItem("facility_code",a.code))})(),await(async()=>{const e=await pe.value.checkUserPrograms(void 0);null!=e&&e.programs&&B().setAuthorizedPrograms(null==e?void 0:e.programs)})(),await H(),await X(),e.setEMRAuthenticated(!0),{success:!0,error:null}}catch(l){return e.setEMRAuthenticated(!1),{success:!1,error:l}}},Ie=async()=>(Z(),{success:!1,error:""}),Ce=async()=>{const e=Z();if(!a.value||!t.value)return void j("Complete form to log in");e.recordLoginAttempt();const[l,s]=await Promise.allSettled([_e(),Ie()]),n="fulfilled"===l.status&&l.value.success,r="fulfilled"===s.status&&s.value.success;if(n)ye.push("/home");else if(n||r)!n&&r&&("fulfilled"===l.status?l.value.error:l.reason);else{const e="fulfilled"===l.status?l.value.error:l.reason;e instanceof F?K("Invalid username or password"):e instanceof $?(be(),K("Please change your password",5e4)):e instanceof D?(be(),K("Your password has expired. Please change your password",5e4)):K(`${e}`,5e4)}};return o(async()=>{localStorage.setItem("apiKey",""),await pe.value.loadConfig(),l.value=localStorage.getItem("core_version")||"",await(async()=>{Pe.terminate(),await L().postData("SET_OFFLINE_PROGRAMS")})()}),(e,s)=>{const n=i("ion-icon");return d(),u(v(z),null,{default:c(()=>[f(v(p),{class:"ion-padding login-page"},{default:c(()=>[m("div",V,[f(v(w),{style:{"background-color":"#fff"}},{default:c(()=>[f(v(g),null,{default:c(()=>[f(v(P),{class:"login_img",src:v(Q)("mw.png"),id:"logo"},null,8,["src"]),f(v(x),{class:"login-title"},{default:c(()=>["development"===ve.value||"test"===ve.value?(d(),h("span",W,[m("div",null,[s[10]||(s[10]=b(" MaHIS ",-1)),m("small",ee,"(v"+A(l.value)+")",1)]),m("div",ae,"("+A(ve.value)+")",1)])):(d(),h("span",te,[s[11]||(s[11]=b(" MaHIS ",-1)),m("small",le,"(v"+A(l.value)+")",1)]))]),_:1}),fe.value?y("",!0):(d(),h("div",se,[m("span",ne,[f(v(k),{value:a.value,onIonInput:s[0]||(s[0]=e=>a.value=e.target.value||""),type:"text",label:"Username",ref:"usernameRef","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:c(()=>[f(v(_),{slot:"end"},{default:c(()=>[f(n,{icon:v(I)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),f(v(k),{value:t.value,onIonInput:s[2]||(s[2]=e=>t.value=e.target.value||""),type:G.value?"text":"password",label:"Password",ref:"passwordRef","label-placement":"floating",fill:"outline",placeholder:"Enter Password",class:"input-fields",required:"",onKeydown:C(Ce,["enter"])},{default:c(()=>[f(v(_),{slot:"end"},{default:c(()=>[f(n,{icon:G.value?v(S):v(q),onClick:s[1]||(s[1]=e=>G.value=!G.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"])]),f(v(E),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:Ce,class:"login-button"},{default:c(()=>[...s[12]||(s[12]=[b(" Login ",-1)])]),_:1}),m("p",re,[s[13]||(s[13]=b(" For help click ",-1)),m("a",{href:"#",onClick:M(Ae,["prevent"])},"Here"),s[14]||(s[14]=b(" | ",-1)),m("a",{href:"#",onClick:M(be,["prevent"])},"Change Password")])])),fe.value?(d(),h("div",oe,[s[17]||(s[17]=m("h3",{style:{"text-align":"center","margin-bottom":"20px",color:"#34af4d"}},"Change Password",-1)),m("span",ie,[f(v(k),{value:me.value.username,onIonInput:s[3]||(s[3]=e=>me.value.username=e.target.value||""),type:"text",label:"Username","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:c(()=>[f(v(_),{slot:"end"},{default:c(()=>[f(n,{icon:v(I)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),f(v(k),{value:me.value.currentPassword,onIonInput:s[5]||(s[5]=e=>me.value.currentPassword=e.target.value||""),type:we.value?"text":"password",label:"Current Password","label-placement":"floating",fill:"outline",placeholder:"Enter Current Password",class:"input-fields",required:""},{default:c(()=>[f(v(_),{slot:"end"},{default:c(()=>[f(n,{icon:we.value?v(S):v(q),onClick:s[4]||(s[4]=e=>we.value=!we.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"]),f(v(k),{value:me.value.newPassword,onIonInput:s[7]||(s[7]=e=>me.value.newPassword=e.target.value||""),type:ge.value?"text":"password",label:"New Password","label-placement":"floating",fill:"outline",placeholder:"Enter New Password",class:U(["input-fields",{"invalid-input":me.value.newPassword&&!v(R)(me.value.newPassword)}]),required:""},{default:c(()=>[f(v(_),{slot:"end"},{default:c(()=>[f(n,{icon:ge.value?v(S):v(q),onClick:s[6]||(s[6]=e=>ge.value=!ge.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"]),f(v(k),{value:me.value.confirmPassword,onIonInput:s[9]||(s[9]=e=>me.value.confirmPassword=e.target.value||""),type:he.value?"text":"password",label:"Confirm New Password","label-placement":"floating",fill:"outline",placeholder:"Confirm New Password",class:U(["input-fields",{"invalid-input":me.value.confirmPassword&&me.value.newPassword!==me.value.confirmPassword}]),required:""},{default:c(()=>[f(v(_),{slot:"end"},{default:c(()=>[f(n,{icon:he.value?v(S):v(q),onClick:s[8]||(s[8]=e=>he.value=!he.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"])]),me.value.newPassword?(d(),h("div",ue,[s[15]||(s[15]=m("p",{class:"requirements-title"},"Password Requirements:",-1)),m("ul",de,[m("li",{class:U({valid:me.value.newPassword.length>=8})},"At least 8 characters",2),m("li",{class:U({valid:/[A-Z]/.test(me.value.newPassword)})},"One uppercase letter",2),m("li",{class:U({valid:/[0-9]/.test(me.value.newPassword)})},"One number",2),m("li",{class:U({valid:/[@#$%^&+=*!-]/.test(me.value.newPassword)})}," One special character (@#$%^&+=*!-) ",2),m("li",{class:U({valid:me.value.newPassword!==me.value.currentPassword&&""!==me.value.currentPassword})}," Different from current password ",2)])])):y("",!0),f(v(E),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:ke,class:"login-button",disabled:!xe.value},{default:c(()=>[...s[16]||(s[16]=[b(" Change Password ",-1)])]),_:1},8,["disabled"]),m("p",ce,[m("a",{href:"#",onClick:M(be,["prevent"])},"Back to Login")])])):y("",!0)]),_:1})]),_:1})])]),_:1})]),_:1})}}}),[["__scopeId","data-v-ffa40062"]]))}}});

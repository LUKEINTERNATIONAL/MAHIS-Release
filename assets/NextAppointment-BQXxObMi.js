var Dt=Object.defineProperty;var yt=(e,t,o)=>t in e?Dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var Y=(e,t,o)=>yt(e,typeof t!="symbol"?t+"":t,o);import{R as De,d as T,ar as Q,b$ as Ie,a0 as Ze,a3 as ue,U as pe,T as ye,as as Ee,ac as ne,G as J,S as me,a9 as re,X as et,a1 as St,a2 as tt,E as h,e as C,f,l as n,z as i,A as O,k as d,F as V,b2 as X,r as N,bQ as nt,w as Te,a as le,n as ot,L as B,B as P,u as _,c2 as Ct,au as bt,I as Z,D as F,d4 as Mt,ab as ge,aa as _e,af as Oe,ba as Nt,aI as wt,m as R,y as z,p as W,b0 as ce,c6 as It,bJ as xe,aZ as Ae,a_ as st,W as Pe,a$ as ke,c as K,aQ as $t,df as Ot,aB as at,du as At,dT as Pt,dU as kt,dV as Lt,cc as Ve,bm as Ft,V as Tt,M as fe,J as ve,c7 as Et,d1 as xt,dh as Le,dg as Vt,d3 as Ht,a6 as Bt,aS as Ut}from"./vendor-BzS-GRGX.js";import{i as se,D as it,B as He,aq as Rt,w as Ce,am as he,j as de,z as rt,u as G,_ as H,ar as zt,f as Be,A as lt,a4 as Me,H as k,an as Ue,l as ct,S as q,aK as Jt,az as dt,P as ut,W as jt,t as oe,a0 as ie,a as Gt,T as qt,av as Wt,bi as Qt,bj as Kt,ae as Yt,I as Xt,aD as ee,bk as Zt,b as en,q as tn,o as Je}from"./index-TGgrguwo.js";import{D as nn}from"./DashBox-CGjCuPOh.js";import{L as on}from"./SvgDynamicColor-CKO9UwFV.js";import{B as Ne}from"./BasicForm-D1bDQLWE.js";import{p as sn}from"./previousDiagnosis-DKQR1IJI.js";import{a as an}from"./formatServerData-D-j-MK35.js";import{v as rn}from"./group_validation-BR-lnozB.js";import{l as ae}from"./lodash-Dt8AsbQm.js";import{A as pt}from"./app_encounter_service-1D5RNuZY.js";import{g as ln,a as mt,D as te}from"./drug_prescription_service-FUoKWuPH.js";import{D as Re}from"./drug_service-CM40nAlw.js";import{A as be}from"./appointment_service-B7NjCYmj.js";import{u as Fe,s as cn}from"./clinicalDaysStore-Ca2J5cRy.js";import{A as dn}from"./ncd_appointment_service-P9JEcsdW.js";import{D as un}from"./DateInputField-Dk6pJa3t.js";const je=De("NCDDiagnosisStore",{state:()=>({diagnosis:[{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"Diagnosis",icon:se.search,value:"",name:"diagnosis",eventType:"input",required:!0,alertsErrorMassage:"",isSingleSelect:!0,trackBy:"concept_id",valueType:"coded",multiSelectData:[],id:"",validationFunctionName:"required"}]}]}}]}),actions:{setDiagnosis(e){this.diagnosis=e}}}),pn=T({name:"Menu",components:{IonContent:re,IonHeader:me,IonItem:J,IonList:ne,IonMenu:Ee,IonTitle:ye,IonToolbar:pe,IonInput:ue,IonPopover:Ze,DashBox:nn,SelectionPopover:Rt,BasicInputField:He,List:on,BasicForm:Ne,DynamicButton:it,previousDiagnosis:sn,DataTable:Ie},data(){return{iconsContent:se,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",conditionStatus:"",data:[],diagnosisData:[],popoverOpen:!1,event:"",selectedCondition:""}},setup(){return{checkmark:tt,pulseOutline:St}},computed:{...Q(je,["diagnosis"]),...Q(G,["patient"])},async mounted(){await this.getDiagnosis("")},methods:{async getDiagnosis(e){const t=await rt("diagnosis",{likeClause:e?{name:"%".concat(e,"%")}:"",currentPage:1,itemsPerPage:5}).then(o=>o.records);Ce(this.diagnosis,"diagnosis","multiSelectData",t)},dismiss(){et.dismiss()},async addNewRow(){var e,t,o;if(await rn(this.diagnosis)){Ce(this.diagnosis,"diagnosis","alertsErrorMassage","");const s=await an(this.diagnosis),a=JSON.parse(JSON.stringify(this.patient));(o=(t=(e=a.diagnosis)!=null?e:a.diagnosis={}).unsaved)!=null||(t.unsaved=[]),a.diagnosis.unsaved.push(...s),await he(a),de("Diagnosis successfully saved"),this.dismiss()}else Ce(this.diagnosis,"diagnosis","alertsErrorMassage","Please select diagnosis from the list")},updateDiagnosisStores(){je().setDiagnosis(this.diagnosis)},async handleInputData(e){Ce(this.diagnosis,"diagnosis","alertsErrorMassage","")}}}),mn={class:"modal_wrapper"},gn={class:""};function _n(e,t,o,s,a,l){const r=h("ion-title"),c=h("ion-icon"),p=h("ion-header"),u=h("basic-form"),m=h("ion-content"),g=h("DynamicButton"),D=h("ion-col"),w=h("ion-row"),b=h("ion-footer");return f(),C(V,null,[n(p,{style:{display:"flex","justify-content":"space-between"}},{default:i(()=>[n(r,{class:"modalTitle"},{default:i(()=>t[2]||(t[2]=[O("Add Diagnosis")])),_:1,__:[2]}),n(c,{onClick:t[0]||(t[0]=M=>e.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:e.iconsContent.cancel},null,8,["icon"])]),_:1}),n(m,{fullscreen:!0,style:{"--background":"#fff"}},{default:i(()=>[d("div",mn,[d("div",gn,[n(u,{contentData:e.diagnosis,onSearchChange:e.getDiagnosis,"onUpdate:inputValue":e.handleInputData},null,8,["contentData","onSearchChange","onUpdate:inputValue"])])])]),_:1}),n(b,{collapse:"fade",class:"ion-no-border"},{default:i(()=>[n(w,null,{default:i(()=>[n(D,null,{default:i(()=>[n(g,{onClick:t[1]||(t[1]=M=>e.addNewRow()),name:"Save",fill:"solid",style:{float:"right",margin:"2%",width:"130px"}})]),_:1})]),_:1})]),_:1})],64)}const hn=H(pn,[["render",_n],["__scopeId","data-v-d1f1c034"]]),fn={class:"table-responsive"},vn=T({__name:"Diagnosis",setup(e){const t=zt(),o=G(),{diagnosis:s}=X(t),{patient:a}=X(o),l=N(null),r=N([]),c=N(se),p=["Diagnosis","Date","Action"],u={responsive:!0,select:!1,layout:{topStart:"buttons",topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1,buttons:[{text:" <b>+ Add diagnosis </b>",className:"add-test text-white",action:async()=>{await m()}}]},m=async()=>{await Be(hn,{class:"lab-results-modal"},!0),await w()},g=async M=>M.length>0?await Promise.all(M.map(async A=>{const $=await Me.getConceptName(A.value_coded),S=A.obs_datetime;return[$,k.toStandardHisFormat(S),'<button class="btn btn-outline-danger btn-sm delete-btn" data-id=\''.concat(JSON.stringify({id:A.obs_id,value_coded:A.value_coded,name:$,obs_date:S}),"'>").concat(c.value.delete2,"</button>")]})):[],D=async(M,A)=>{var S;if(await lt("Do you want to delete ".concat(M.name," ?"),A)){const v=JSON.parse(JSON.stringify(a.value)),y=v.diagnosis;M!=null&&M.id?(y.saved=y.saved.filter(I=>!(I.value_coded===M.value_coded&&I.obs_datetime===M.obs_date)),(S=y.voided)!=null||(y.voided=[]),y.voided.push(M)):y.unsaved=y.unsaved.filter(I=>!(I.value_coded===M.value_coded&&I.obs_datetime===M.obs_date)),await he(v)}},w=async()=>{var $,S;const M=JSON.parse(JSON.stringify(a.value)),A=[...(($=M==null?void 0:M.diagnosis)==null?void 0:$.unsaved)||[],...((S=M==null?void 0:M.diagnosis)==null?void 0:S.saved)||[]];r.value=await g(A),Ie.use(Ct)},b=nt();return Te(()=>b,async()=>{await w()},{deep:!0}),Te(()=>a,async()=>{await w()},{deep:!0}),le(async()=>{await w(),ot(()=>{const M=l.value.dt;M.columns.adjust().draw(),M.on("click",".delete-btn",A=>{const $=A.target.getAttribute("data-id");D(JSON.parse($),A)})})}),(M,A)=>(f(),C("div",fn,[n(_(Ie),{ref_key:"dataTableRef",ref:l,options:u,data:r.value,class:"display nowrap",width:"100%"},{default:i(()=>[d("thead",null,[d("tr",null,[(f(),C(V,null,B(p,$=>d("th",{key:$},P($),1)),64))])])]),_:1},8,["data"])]))}}),qs=H(vn,[["__scopeId","data-v-a9f02349"]]),Ge=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"Visual acuity test",data:{rowData:[{colData:[{inputHeader:"Left Eye",value:"",name:"Left eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"},{inputHeader:"Right Eye",value:"",name:"Right eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"}]}]}}],qe=[{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Peripheral neuropathy"},data:[{name:"Neuropathy/PVO",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Deformity"},data:[{name:"Deformities",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Ulcers"},data:[{name:"Ulcers",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}}],We=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"CV Risk %",data:{rowData:[{colData:[{inputHeader:"",value:"",name:"CVD",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,valueType:"text",validationFunctionName:"isNumber"}]}]}}],Dn=De("complicationsStore",{state:()=>({visualScreening:[...Ge],FootScreening:[...qe],cvScreening:[...We]}),actions:{setCvScreening(e){this.cvScreening=e},setVisualScreening(e){this.visualScreening=e},setFootScreening(e){this.FootScreening=e},getInitialCvScreening(){return[...ae.cloneDeep(We)]},getInitialVisualScreening(){return[...ae.cloneDeep(Ge)]},getInitialFootScreening(){return[...ae.cloneDeep(qe)]},resetScreening(){this.setCvScreening(this.getInitialCvScreening()),this.setFootScreening(this.getInitialFootScreening()),this.setVisualScreening(this.getInitialVisualScreening())}},persist:!0}),yn={class:"sub_item_body"},Sn={class:"ion-padding",slot:"content"},Cn={class:"table-responsive"},bn=T({__name:"ComplicationsScreening",setup(e){bt();const t=Dn(),{FootScreening:o,visualScreening:s,cvScreening:a}=X(t),l=G(),{patient:r}=X(l);nt();const c=N(null),p=N([]);N(!1),N(!1),N("");const u=N("");N({btnColor:"secondary",btnName:"No risk"});const m=N(se),g=["Condition","Result","Date","Action"],D={responsive:!0,select:!1,layout:{topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1},w=async()=>{var S,v;const A=JSON.parse(JSON.stringify(r.value)),$=[...((S=A==null?void 0:A.screening)==null?void 0:S.unsaved)||[],...((v=A==null?void 0:A.screening)==null?void 0:v.saved)||[]];p.value=await b($)},b=async A=>A.length===0?[]:(await Promise.all(A.map(async S=>S.concept_name==="Visual acuity"?S.children.map(v=>[v.concept_name,v.value_text,k.toStandardHisFormat(v.obs_datetime),'<button class="btn btn-outline-danger btn-sm delete-btn" data-id=\''.concat(JSON.stringify(v),"'>\n                        ").concat(m.value.delete2,"</button>")]):S.concept_name==="Foot check"?Promise.all(S.children.map(async v=>[v.concept_name,await Ue.getConceptName(v.value_coded),k.toStandardHisFormat(v.obs_datetime),'<button class="btn btn-outline-danger btn-sm delete-btn" data-id=\''.concat(JSON.stringify(v),"'>\n                            ").concat(m.value.delete2,"</button>")])):S.concept_name==="Cardiovascular disease"?[["CVD %",S.value_text,k.toStandardHisFormat(S.obs_datetime),'<button class="btn btn-outline-danger btn-sm delete-btn" data-id=\''.concat(JSON.stringify(S),"'>\n                            ").concat(m.value.delete2,"</button>")]]:[]))).flat(),M=A=>{console.log("🚀 ~ voidScreening ~ data:",A)};return le(async()=>{await w(),ot(()=>{const A=c.value.dt;A.columns.adjust().draw(),A.on("click",".delete-btn",$=>{const S=$.target.getAttribute("data-id");M(JSON.parse(S))})})}),(A,$)=>{const S=h("ion-label"),v=h("ion-accordion"),y=h("ion-accordion-group"),I=h("ion-row");return f(),C(V,null,[n(Ne,{contentData:_(s)},null,8,["contentData"]),n(_(ne),null,{default:i(()=>[n(_(J),{lines:u.value,class:"dashed_bottom_border textSectionFormat"},{default:i(()=>$[0]||($[0]=[d("span",{style:{display:"flex","align-items":"center",gap:"10px"}}," Foot screening ",-1)])),_:1,__:[0]},8,["lines"]),d("div",yn,[n(Ne,{contentData:_(o)},null,8,["contentData"])])]),_:1}),n(Ne,{contentData:_(a)},null,8,["contentData"]),n(I,null,{default:i(()=>[n(y,{ref:"accordionGroup",class:"previousView"},{default:i(()=>[n(v,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(_(J),{slot:"header",color:"light"},{default:i(()=>[n(S,{class:"previousLabel"},{default:i(()=>$[1]||($[1]=[O("Previous Visits")])),_:1,__:[1]})]),_:1}),d("div",Sn,[d("div",Cn,[n(_(Ie),{ref_key:"dataTableRef",ref:c,options:D,data:p.value,class:"display nowrap",width:"100%"},{default:i(()=>[d("thead",null,[d("tr",null,[(f(),C(V,null,B(g,L=>d("th",{key:L},P(L),1)),64))])])]),_:1},8,["data"])])])]),_:1})]),_:1},512)]),_:1})],64)}}}),Ws=H(bn,[["__scopeId","data-v-127f623c"]]),gt=(e,t,o,s={})=>({drug_id:e,name:t,category:o,...s}),$e=De("OtherNCDMedicationsStore",{state:()=>({otherNCDMedications:[],selectedOtherNCDMedicationList:[]}),actions:{setSelectedNCDMedicationList(e){this.selectedOtherNCDMedicationList.push(e)},getSelectedNCDMedicationList(){return this.selectedOtherNCDMedicationList},addSearchedDrug(e){const t=gt(e.drug_id,e.name,"Other",e);if(t.units=e.units,!this.otherNCDMedications.some(s=>s.drug_id===t.drug_id)){this.otherNCDMedications.unshift(t);const s={dosage:{morning:null,afternoon:null,evening:null},duration:null,...t};this.setSelectedNCDMedicationList(s)}},clearOtherNCDMedications(){this.otherNCDMedications=[],this.selectedOtherNCDMedicationList=[]}},persist:!0}),j=De("NCDmedicationsStore",{state:()=>({medications:[],filteredMedications:[],selectedNCDMedicationList:[],frequency_selections:N({}),currentPatientID:""}),actions:{setMedications(e){this.medications=e,this.filteredMedications=e},setFilteredMedications(e){this.filteredMedications=e},initMedications(){},setSelectedNCDMedicationList(e){this.selectedNCDMedicationList.push(e)},getSelectedNCDMedicationList(){return this.selectedNCDMedicationList},clearMedicationDataStores(){this.medications=[],this.filteredMedications=[],this.selectedNCDMedicationList=[],this.frequency_selections=[]},setCurrentPatientID(e){this.currentPatientID=e}},persist:!0});function Mn(){try{const e=j(),t=$e();e.medications=[...t.otherNCDMedications,...e.medications],e.medications=e.medications.reduce((o,s)=>(o.some(a=>a.drug_id===s.drug_id)||o.push(s),o),[]),e.selectedNCDMedicationList=[...t.selectedOtherNCDMedicationList,...e.selectedNCDMedicationList],e.filteredMedications=e.medications,de("Medication added successfully")}catch(e){}}const Nn={name:"DiabetesMedication",ids:[337,336,280,410,729,263,812,265,264,240,266,726,728,223]},Qe={name:"AntiHypertensivesMedication",ids:[]},wn={ids:[274,168,648,289,286,164,287,288,672,257,1233,671]},In={ids:[559,1236,1234,558,1235,1211,276,277,278,279]},$n={ids:[556,653,557,652,943,1238,1240,1237,942,1239,946,1503,944,1504,945,1505]},On={ids:[116,85,117,1232,936,1364,937,1365,1366]};async function _t(e){const t=j(),o=e.ids.map(async s=>{try{const a=await Re.getOfflineDrugById(s);if(a){const l=t.medications.findIndex(c=>c.drug_id===a.drug_id),r=gt(a.drug_id,a.name,e.name,a);l!==-1?t.medications[l]=r:t.medications.push(r)}}catch(a){console.error("Error fetching drug ID ".concat(s,":"),a)}});return t.filteredMedications=t.medications,Promise.all(o)}async function An(e){try{const t=await Re.getOfflineDrugById(e);return{drug_id:e,dosage:{morning:null,afternoon:null,evening:null},duration:null,...t}}catch(t){ct("Error fetching drug details. Please try again."),console.error("Error fetching drug details:",t)}}function Ke(){return _t(Nn)}function Ye(){return Qe.ids=[...wn.ids,...In.ids,...$n.ids,...On.ids],_t(Qe)}function we(){j().clearMedicationDataStores()}function ht(e){j().setCurrentPatientID(e)}function Pn(e){j().currentPatientID!=e&&(we(),ht(e))}function Qs(){return j().selectedNCDMedicationList.some(t=>{const{morning:o,afternoon:s,evening:a}=t.dosage,l=typeof o=="string"?Number(o):o,r=typeof s=="string"?Number(s):s,c=typeof a=="string"?Number(a):a;return typeof l=="number"&&l>0||typeof r=="number"&&r>0||typeof c=="number"&&c>0})}class kn extends pt{constructor(t,o){super(t,105,o)}}class Ln extends pt{constructor(t,o){super(t,25,o)}static async get_____(t="",o=1,s=10){}}async function Ks(e){var t,o,s;try{const a=G(),{patient:l}=X(a),r=JSON.parse(JSON.stringify(l.value));(s=(o=(t=r.allergies)!=null?t:r.allergies={}).unsaved)!=null||(o.unsaved=[]),r.allergies.unsaved.push(...e),await he(r),de("Allergies saved successfully")}catch(a){oe("Unable to save Allegies!")}}class Ys{async onSubmitNotes(t,o,s){const a=new kn(t,o);await a.createEncounter(),await a.saveObservationList(s)}async onSubmitAllergies(t,o,s){try{const a=new Ln(t,o);await a.createEncounter(),await a.saveObservationList(s),de("Allergies saved successfully")}catch(a){console.error("Error saving allergies:",a),oe("Failed to save allergies")}}}class ze{constructor(){Y(this,"programID");Y(this,"providerID");Y(this,"patientID");Y(this,"date");Y(this,"demographics");Y(this,"previousDrugPrescriptions",[]);Y(this,"previousClinicalNotes");Y(this,"previousDrugAllergies");const t=G();this.demographics=t.patient,this.patientID=this.demographics.patientID,this.date=Me.getSessionDate(),this.providerID=q.getUserID(),this.programID=Me.getProgramID(),this.previousClinicalNotes={},this.previousDrugAllergies={}}async getPatientEncounters(){const t=await this.getPatientVisitDates(),o=t.map(async a=>{const l=a.value,r=await Jt.getEncounters(this.patientID,{date:l});await Promise.all(r.map(async c=>{var p;if(c.type.name=="NOTES"){const{observations:u}=c;ae.isEmpty(u)||u.forEach(m=>{if(m.concept_id=="2688"){const g=k.toStandardHisDisplayFormat(m.obs_datetime);ae.isEmpty(this.previousClinicalNotes.hasOwnProperty(g))&&(this.previousClinicalNotes[g]=[]),this.previousClinicalNotes[g].push({date:g,notes:m.value_text})}})}if(c.type.name=="TREATMENT"){const{observations:u}=c;if(!ae.isEmpty(u))for(const m in u){let g="<UNKNOWN CONCEPT>";const D=u[m];try{(p=D==null?void 0:D.concept)!=null&&p.concept_names?g=D.concept.concept_names[0].name:g=await Ue.getConceptName(D.concept_id)}catch(M){console.error(D,M)}const w=await Me.resolvePrimaryValue(D),b=k.toStandardHisDisplayFormat(D.date_created);g=="Allergic"&&(this.previousDrugAllergies.hasOwnProperty(b)||(this.previousDrugAllergies[b]=[]),this.previousDrugAllergies[b].push({date:b,value:w}))}}}))});await Promise.all(o);const s=t.map(async a=>{const l=await dt.getOrderByPatient(this.patientID,{start_date:a.value});if(!ae.isEmpty(l)){const r=l.map(c=>({drugName:c.drug.name,value:k.toStandardHisTimeFormat(c.order.start_date),dose:c.dose,frequency:ln(c.frequency),prescription:k.toStandardHisFormat(c.order.auto_expire_date),duration:Fn(c.order.instructions),other:c}));this.previousDrugPrescriptions.push({prescriptionDate:k.toStandardHisDisplayFormat(a.value),previousPrescriptions:r})}});return await Promise.all(s),{previousDrugPrescriptions:this.previousDrugPrescriptions,previousClinicalNotes:this.previousClinicalNotes,previousDrugAllergies:this.previousDrugAllergies}}async getPatientVisitDates(){return(await ut.getPatientVisits(this.patientID,!1)).map(t=>({label:k.toStandardHisDisplayFormat(t),value:t,other:{isActive:t===jt.getSessionDate()}}))}}function Fn(e){const t=/(\d+)\s+days/i,o=e.match(t);return o&&o.length>1?parseInt(o[1]):null}async function Tn(){const e=G(),{patient:t}=X(e),o=t.value,s=[8809,903,6410,6409],l=(await rt("diagnosis",{likeClause:"",currentPage:1,itemsPerPage:2e3}).then(g=>g.records)).filter(g=>s.includes(g.concept_id)),r=o.diagnosis.saved.map(g=>g.value_coded),c=o.diagnosis.unsaved.map(g=>g.value_coded),p=[...r,...c];return l.filter(g=>p.includes(g.concept_id)).map(g=>g.name)}const En=T({name:"Home",components:{IonContent:re,IonHeader:me,IonMenuButton:Nt,IonPage:Oe,IonTitle:ye,IonToolbar:pe,IonRow:_e,IonCol:ge,IonChip:Mt,IonLabel:F,IonIcon:Z},computed:{...Q(G,["patient"])},data(){const e=N([]),t=N([]),o=async()=>{try{const l=this.patient;ht(l.ID);const r=N(!1),c=m=>{r.value=m};e.value=await Tn();const p=e.value.some(m=>m.toLowerCase().includes("hypertension")),u=e.value.some(m=>m.toLowerCase().includes("diabetes"));p&&(c(!0),Ye()),u&&(c(!0),Ke()),r.value==!1}catch(l){}},s=async()=>{const l=t.value.some(c=>c.toLowerCase().includes("hypertension")),r=t.value.some(c=>c.toLowerCase().includes("diabetes"));l&&await Ye(),r&&await Ke()};return{diagnoses:e,selectedDiagnoses:t,medkitOutline:wt,initC:o,toggleDiagnosisSelection:l=>{const r=t.value.indexOf(l);r===-1?(t.value.push(l),we(),s()):(t.value.splice(r,1),we(),s()),t.value.length===0&&(we(),o())}}},async mounted(){this.initC()},watch:{patient:{handler(){Pn(this.patient.ID),this.initC()},deep:!0}}}),xn={key:0,class:"diagnosis-container"},Vn={class:"heading"},Hn={class:"diagnosis-list"};function Bn(e,t,o,s,a,l){const r=h("ion-icon"),c=h("ion-label"),p=h("ion-chip"),u=h("ion-col"),m=h("ion-row");return e.diagnoses.length>0?(f(),C("div",xn,[d("div",Vn,[n(r,{icon:e.medkitOutline,class:"diagnosis-icon"},null,8,["icon"]),t[0]||(t[0]=d("h2",null,"Diagnosis",-1))]),n(m,null,{default:i(()=>[n(u,null,{default:i(()=>[d("div",Hn,[(f(!0),C(V,null,B(e.diagnoses,(g,D)=>(f(),z(p,{key:D,class:W({"diagnosis-chip-selected":e.selectedDiagnoses.includes(g)}),onClick:w=>e.toggleDiagnosisSelection(g)},{default:i(()=>[n(c,null,{default:i(()=>[O(P(g),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})])):R("",!0)}const Un=H(En,[["render",Bn],["__scopeId","data-v-2bd0f8ca"]]),Rn=T({name:"MedicationSearch",components:{IonContent:re,IonPage:Oe,IonItem:J,IonLabel:F,IonInput:ue,IonIcon:Z,BasicInputField:He,IonCard:ce},setup(){const e=N(""),t=j();return{searchText:e,searchTextUpdated:s=>{const a=s.target;e.value=a.value;const l=t.medications.filter(r=>r.name.toLowerCase().includes(e.value.toLowerCase()));t.setFilteredMedications(l)},searchOutline:It}}});function zn(e,t,o,s,a,l){const r=h("BasicInputField"),c=h("ion-card");return f(),C("div",null,[d("div",null,[n(c,null,{default:i(()=>[n(r,{placeholder:"Filter medication list by name",icon:e.searchOutline,inputValue:e.searchText,"onUpdate:inputValue":e.searchTextUpdated,minHeight:50},null,8,["icon","inputValue","onUpdate:inputValue"])]),_:1})])])}const Jn=H(Rn,[["render",zn]]),jn=T({name:"medication",components:{IonCard:ce,IonCardHeader:ke,IonButton:Pe,IonCardTitle:st,IonCardContent:Ae,IonInput:ue,IonIcon:Z,IonCol:ge,IonRow:_e,IonCheckbox:xe,PreviousNCDDiagnosis:Un,MedicationSearchInput:Jn},computed:{...Q(j,["medications","filteredMedications"]),...Q($e,["otherNCDMedications"]),activeMedications(){return this.useDefaultStores?this.filteredMedications:this.otherNCDMedications}},props:{useDefaultStores:{type:Boolean,default:!0}},setup(e){const t=j();t.initMedications();const o=K(()=>t.selectedNCDMedicationList),s=$e(),a=K(()=>s.selectedOtherNCDMedicationList),l=K(()=>e.useDefaultStores?o.value:a.value),r=N(!1),c=N({});let p=null;const u=()=>{r.value=!1,p&&(clearTimeout(p),p=null)},m=v=>{c.value={...c.value,[v]:!0},r.value=!0,p&&clearTimeout(p),p=window.setTimeout(()=>{r.value=!1,p=null},3e3),window.setTimeout(()=>{const y={...c.value};delete y[v],c.value=y},3e3)},g=v=>/^\d*$/.test(v),D=(v,y,I)=>{let L=I.target.value;const U="".concat(v,"-").concat(y);if(L!==""&&!g(L)){m(U);const x=l.value.find(Se=>Se.drug_id===v);L=(x==null?void 0:x.dosage[y])||"",setTimeout(()=>{const Se=I.target;Se&&(Se.value=L)},0);return}if(L!==""){const x=parseInt(L);isNaN(x)||x<0?L="0":L=Math.floor(x).toString()}const E=l.value.findIndex(x=>x.drug_id===v);if(E>-1){const x={...l.value[E]};x.dosage={...x.dosage,[y]:L},l.value[E]=x}},w=(v,y)=>{let I=y.target.value;const L="".concat(v,"-duration");if(I!==""&&!g(I)){m(L);const E=l.value.find(x=>x.drug_id===v);I=(E==null?void 0:E.duration)||"",setTimeout(()=>{const x=y.target;x&&(x.value=I)},0);return}if(I!==""){const E=parseInt(I);isNaN(E)||E<1?I="1":I=Math.floor(E).toString()}const U=l.value.findIndex(E=>E.drug_id===v);if(U>-1){const E={...l.value[U]};E.duration=I,l.value[U]=E}},b=v=>l.value.some(y=>y.drug_id===v);return{medkit:Ve,sunny:Lt,partlySunny:kt,moon:Pt,timeOutline:At,alertCircleOutline:at,closeCircleOutline:Ot,updateDosage:D,updateDuration:w,getDosage:(v,y)=>{const I=l.value.find(L=>L.drug_id===v);return(I==null?void 0:I.dosage[y])||""},getDuration:v=>{const y=l.value.find(I=>I.drug_id===v);return(y==null?void 0:y.duration)||""},calculateQuantity:v=>{const y=l.value.find(U=>U.drug_id===v);if(!y||!y.dosage||!y.duration)return"";const I=["morning","afternoon","evening"].reduce((U,E)=>{const x=parseInt(y.dosage[E])||0;return U+x},0),L=parseInt(y.duration)||0;return(I*L).toString()},isActive:b,toggleMedication:async v=>{try{if(b(v)){const y=l.value.findIndex(I=>I.drug_id===v);y>-1&&l.value.splice(y,1)}else{const y=await An(v);e.useDefaultStores==!1?s.setSelectedNCDMedicationList(y):t.setSelectedNCDMedicationList(y)}}catch(y){ct("Error toggling medication: "+y)}},cubeOutline:$t,showErrorMessage:r,errorFields:c,hideErrorMessage:u}}}),Gn={key:0},qn={key:0,class:"error-message"},Wn={class:"table-container"},Qn={class:"prescription-table"},Kn={class:"checkbox-col"},Yn={style:{cursor:"pointer"}},Xn=["onClick"];function Zn(e,t,o,s,a,l){const r=h("PreviousNCDDiagnosis"),c=h("ion-col"),p=h("MedicationSearchInput"),u=h("ion-row"),m=h("ion-icon"),g=h("ion-button"),D=h("ion-checkbox"),w=h("ion-input");return f(),C(V,null,[n(u,null,{default:i(()=>[n(c,{size:"5"},{default:i(()=>[e.useDefaultStores?(f(),z(r,{key:0})):R("",!0)]),_:1}),n(c,null,{default:i(()=>[e.useDefaultStores&&e.medications.length>0?(f(),z(p,{key:0,style:{"margin-top":"0px","font-weight":"600","font-size":"16px"}})):R("",!0)]),_:1})]),_:1}),e.activeMedications.length>0?(f(),C("div",Gn,[e.showErrorMessage?(f(),C("div",qn,[n(m,{icon:e.alertCircleOutline,color:"danger"},null,8,["icon"]),t[0]||(t[0]=d("span",{style:{"font-size":"16px","font-weight":"600px",color:"red"}},"Only numbers are allowed",-1)),n(g,{fill:"clear",size:"small",onClick:e.hideErrorMessage},{default:i(()=>[n(m,{icon:e.closeCircleOutline},null,8,["icon"])]),_:1},8,["onClick"])])):R("",!0),d("div",Wn,[d("table",Qn,[d("thead",null,[d("tr",null,[t[6]||(t[6]=d("th",{class:"checkbox-col"},"Select",-1)),t[7]||(t[7]=d("th",null,"Medication",-1)),d("th",null,[n(m,{icon:e.partlySunny},null,8,["icon"]),t[1]||(t[1]=O(" Morning"))]),d("th",null,[n(m,{icon:e.sunny},null,8,["icon"]),t[2]||(t[2]=O(" Noon"))]),d("th",null,[n(m,{icon:e.moon},null,8,["icon"]),t[3]||(t[3]=O(" Night"))]),d("th",null,[n(m,{icon:e.timeOutline},null,8,["icon"]),t[4]||(t[4]=O(" Duration"))]),d("th",null,[n(m,{icon:e.cubeOutline},null,8,["icon"]),t[5]||(t[5]=O(" Quantity"))])])]),d("tbody",null,[(f(!0),C(V,null,B(e.activeMedications,b=>(f(),C("tr",{key:b.id,class:W({"active-row":e.isActive(b.drug_id)})},[d("td",Kn,[n(D,{checked:e.isActive(b.drug_id),onIonChange:M=>e.toggleMedication(b.drug_id)},null,8,["checked","onIonChange"])]),d("td",Yn,[d("span",{class:"med-kit-font",onClick:M=>e.toggleMedication(b.drug_id)},P(b.name),9,Xn)]),d("td",null,[n(w,{type:"text",class:W(["dose-input bordered-input med-kit-font",{"error-input":e.errorFields["".concat(b.drug_id,"-morning")]}]),disabled:!e.isActive(b.drug_id),value:e.getDosage(b.drug_id,"morning"),onIonInput:M=>e.updateDosage(b.drug_id,"morning",M),placeholder:"0",inputmode:"numeric"},null,8,["class","disabled","value","onIonInput"])]),d("td",null,[n(w,{type:"text",class:W(["dose-input bordered-input med-kit-font",{"error-input":e.errorFields["".concat(b.drug_id,"-afternoon")]}]),disabled:!e.isActive(b.drug_id),value:e.getDosage(b.drug_id,"afternoon"),onIonInput:M=>e.updateDosage(b.drug_id,"afternoon",M),placeholder:"0",inputmode:"numeric"},null,8,["class","disabled","value","onIonInput"])]),d("td",null,[n(w,{type:"text",class:W(["dose-input bordered-input med-kit-font",{"error-input":e.errorFields["".concat(b.drug_id,"-evening")]}]),disabled:!e.isActive(b.drug_id),value:e.getDosage(b.drug_id,"evening"),onIonInput:M=>e.updateDosage(b.drug_id,"evening",M),placeholder:"0",inputmode:"numeric"},null,8,["class","disabled","value","onIonInput"])]),d("td",null,[n(w,{type:"text",class:W(["dose-input bordered-input med-kit-font",{"error-input":e.errorFields["".concat(b.drug_id,"-duration")]}]),disabled:!e.isActive(b.drug_id),value:e.getDuration(b.drug_id),onIonInput:M=>e.updateDuration(b.drug_id,M),placeholder:"0",inputmode:"numeric"},null,8,["class","disabled","value","onIonInput"])]),d("td",null,[n(w,{type:"text",class:"dose-input bordered-input med-kit-font",readonly:"",value:e.calculateQuantity(b.drug_id),placeholder:"0"},null,8,["value"])])],2))),128))])])])])):R("",!0)],64)}const ft=H(jn,[["render",Zn],["__scopeId","data-v-601894a0"]]),eo=T({name:"DrugSelector",components:{IonContent:re,IonHeader:me,IonItem:J,IonList:ne,IonMenu:Ee,IonTitle:ye,IonToolbar:pe,IonInput:ue,IonPopover:Ze,VueMultiselect:Ft,IonLabel:F,IonCol:ge,IonRow:_e},emits:["drug-selected"],data(){const e=a=>{this.$emit("drug-selected",a)},t=async a=>{const l=ie(),r=a,m=(await Re.getOfflineOPDDrugs({name:r,page:1,page_size:20})).map(g=>({label:g.name,value:g.name,other:g,...g}));l.setPartialOPDdrugList(m)},o=K(()=>this.partialOPDdrugList);return{selected_drug:N(null),selectedDrugName:e,FindDrugName:t,OPDDrugList:o}},computed:{...Q(ie,["partialOPDdrugList"])}});function to(e,t,o,s,a,l){const r=h("VueMultiselect"),c=h("ion-col"),p=h("ion-row");return f(),C("div",null,[n(p,null,{default:i(()=>[n(c,null,{default:i(()=>[n(r,{modelValue:e.selected_drug,"onUpdate:modelValue":[t[0]||(t[0]=u=>e.selected_drug=u),e.selectedDrugName],multiple:!1,taggable:!1,"hide-selected":!1,"close-on-select":!0,openDirection:"bottom","tag-placeholder":"Select medication",placeholder:"Select medication",selectLabel:"",label:"name",searchable:!0,onSearchChange:e.FindDrugName,"track-by":"uuid",options:e.OPDDrugList},null,8,["modelValue","onUpdate:modelValue","onSearchChange","options"])]),_:1})]),_:1})])}const no=H(eo,[["render",to],["__scopeId","data-v-e4d309dd"]]),oo=T({name:"Home",mixins:[Gt],components:{IonContent:re,IonHeader:me,IonPage:Oe,IonToolbar:pe,IonRow:_e,IonTitle:ye,IonIcon:Z,IonFooter:Tt,OPDMedications:no,Medication:ft,IonCol:ge,IonButton:Pe},data(){const e=$e(),t=()=>{et.dismiss()};return{iconsContent:se,dismiss:t,addSearchedDrug:a=>{e.addSearchedDrug(a)},medkit:Ve,checkmark:tt,onAdd:()=>{Mn(),e.clearOtherNCDMedications(),t()}}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){},methods:{}}),so={class:"medication-list"},ao={class:"modal_wrapper"},io={class:""};function ro(e,t,o,s,a,l){const r=h("ion-icon"),c=h("ion-title"),p=h("ion-header"),u=h("OPDMedications"),m=h("Medication"),g=h("ion-content"),D=h("ion-button"),w=h("ion-col"),b=h("ion-row"),M=h("ion-footer");return f(),C(V,null,[n(p,{style:{display:"flex","justify-content":"space-between"}},{default:i(()=>[n(c,{class:"modalTitle"},{default:i(()=>[d("div",so,[n(r,{icon:e.medkit,class:"ion-margin-end"},null,8,["icon"]),t[1]||(t[1]=d("span",null,"Add Other Medication",-1))])]),_:1}),n(r,{onClick:t[0]||(t[0]=A=>e.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:e.iconsContent.cancel},null,8,["icon"])]),_:1}),n(g,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:i(()=>[d("div",ao,[d("div",io,[n(u,{onDrugSelected:e.addSearchedDrug},null,8,["onDrugSelected"]),n(m,{"use-default-stores":!1})])])]),_:1}),n(M,{collapse:"fade",class:"ion-no-border"},{default:i(()=>[n(b,null,{default:i(()=>[n(w,null,{default:i(()=>[n(D,{onClick:e.onAdd,color:"primary",style:{float:"right","margin-bottom":"20px","margin-right":"20px"}},{default:i(()=>[n(r,{icon:e.checkmark,slot:"start"},null,8,["icon"]),t[2]||(t[2]=O(" Add "))]),_:1,__:[2]},8,["onClick"])]),_:1})]),_:1})]),_:1})],64)}const lo=H(oo,[["render",ro],["__scopeId","data-v-dee50533"]]),co=T({created(){},components:{IonItem:J,IonCol:ge,IonLabel:F,IonIcon:Z},data(){return{iconsContent:se,localMedicalDrugsList:[...this.$props._selectedMedicalDrugsList]}},props:{_selectedMedicalDrugsList:{type:Array,default:[]},show_actions_buttons:{type:Boolean,default:!0},highLightBackground:{type:String,default:"item-native"}},watch:{},methods:{highlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#006401"),this.highlightActionBtns(e)},undoHighlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#636363"),this.undohighlightActionBtns(e)},highlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let o=0;o<t.length;o++)t[o].style.display="inline-block"},undohighlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let o=0;o<t.length;o++)t[o].style.display="none"},asignLblID(e){return e+"_lbl"},asignSpanLblID(e){return e+"_spanlbl"},async removeItemAtIndex(e,t){await lt("Do you want to delete it?",t)&&this.$emit("remove-item",e)},editItemAtIndex(e){this.$emit("edit-item",e)},highLightBnd(e){if(e){if(e.highlightbackground!==void 0&&e.highlightbackground==!0)return this.$props.highLightBackground}else return!1}}}),uo=["onMousemove","onMouseout"],po={class:"route-label"};function mo(e,t,o,s,a,l){const r=h("ion-label"),c=h("ion-col"),p=h("ion-row"),u=h("ion-icon");return f(!0),C(V,null,B(e.localMedicalDrugsList,(m,g)=>(f(),C("div",{id:"df",class:"medication-item",key:g,onMousemove:D=>e.highlightItem(g),onMouseout:D=>e.undoHighlightItem(g)},[n(p,{class:"medication-header"},{default:i(()=>[n(c,{class:W(["ion-text-wrap",e.highLightBnd(m)])},{default:i(()=>[n(r,{id:e.asignLblID(g),class:"medication-name"},{default:i(()=>[O(P(m.drugName),1)]),_:2},1032,["id"])]),_:2},1032,["class"])]),_:2},1024),n(p,{class:"medication-details"},{default:i(()=>[n(c,{size:"10",class:W(["ion-text-wrap details-col",e.highLightBnd(m)])},{default:i(()=>[n(r,{class:"details-text"},{default:i(()=>[O(P(m.dose)+" / "+P(m.frequency)+" / daily / "+P(m.duration)+" / until "+P(m.prescription)+" ",1),d("span",po,P(m.route_name),1)]),_:2},1024)]),_:2},1032,["class"]),e.show_actions_buttons?(f(),z(c,{key:0,class:W([e.highLightBnd(m),"actions-col"]),size:"2"},{default:i(()=>[n(r,{class:W(["action-button",e.asignSpanLblID(g)]),onClick:D=>e.editItemAtIndex(g)},{default:i(()=>[n(u,{icon:e.iconsContent.edit},null,8,["icon"])]),_:2},1032,["class","onClick"]),n(r,{class:W(["action-button",e.asignSpanLblID(g)]),onClick:D=>e.removeItemAtIndex(g,D)},{default:i(()=>[n(u,{icon:e.iconsContent.delete},null,8,["icon"])]),_:2},1032,["class","onClick"])]),_:2},1032,["class"])):R("",!0)]),_:2},1024)],40,uo))),128)}const go=H(co,[["render",mo],["__scopeId","data-v-01c693a3"]]),_o=T({name:"Home",components:{IonContent:re,IonHeader:me,IonPage:Oe,IonToolbar:pe,Toolbar:qt,IonRow:_e,IonAccordion:ve,IonAccordionGroup:fe,IonItem:J,IonLabel:F,DynamicList:go,IonCard:ce},data(){const e=N(0),t=N("Show more medications"),o=N(!1),s=N();return{componentKey:e,accordionGroupChange:c=>{const p=c.detail.value;p!==void 0?p=="second"&&(t.value="Show less medications",o.value=!o.value):(t.value="Show more medications",o.value=!o.value)},showMoreMedicationsMsg:t,itemWasExpanded:o,accordionGroupChangeFn1:c=>{},PreviuosSelectedMedicalDrugsList:s,loadPreviousMedications:async()=>{const c=new ze,{previousDrugPrescriptions:p}=await c.getPatientEncounters();s.value=p}}},computed:{...Q(G,["patient"]),...Q(j,["selectedNCDMedicationList"])},$route:{async handler(){},deep:!0},watch:{patient:{handler(){this.loadPreviousMedications()},deep:!0},selectedNCDMedicationList:{handler(){this.loadPreviousMedications()},deep:!0}},async mounted(){this.loadPreviousMedications()}}),ho={style:{}},fo={class:"ion-padding",slot:"content"},vo={key:0},Do={class:"previousSecDrgs"},yo={class:"ion-padding",slot:"content"},So={key:0},Co={class:"previousSecDrgs"};function bo(e,t,o,s,a,l){const r=h("ion-label"),c=h("ion-item"),p=h("dynamic-list"),u=h("ion-accordion"),m=h("ion-accordion-group"),g=h("ion-card");return f(),z(g,null,{default:i(()=>[d("div",ho,[n(m,{ref:"accordionGroup",class:"previousView",onIonChange:e.accordionGroupChangeFn1},{default:i(()=>[n(u,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(c,{slot:"header",color:"light"},{default:i(()=>[n(r,{class:"previousLabel"},{default:i(()=>t[0]||(t[0]=[O("Documented medications timeline")])),_:1,__:[0]})]),_:1}),d("div",fo,[(f(!0),C(V,null,B(e.PreviuosSelectedMedicalDrugsList,(D,w)=>(f(),C("div",{class:"ionLbltp",key:w},[w==0?(f(),C("div",vo,[d("div",null,[n(r,{class:"previousLabelDate"},{default:i(()=>[O(P(D.prescriptionDate),1)]),_:2},1024)]),d("div",Do,[(f(),z(p,{_selectedMedicalDrugsList:D.previousPrescriptions,show_actions_buttons:!1,key:e.componentKey},null,8,["_selectedMedicalDrugsList"]))])])):R("",!0)]))),128)),n(m,{onIonChange:e.accordionGroupChange},{default:i(()=>[n(u,{value:"second","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(c,{slot:"header",color:"light"},{default:i(()=>[n(r,{class:"",color:"primary"},{default:i(()=>[O(P(e.showMoreMedicationsMsg),1)]),_:1})]),_:1}),d("div",yo,[(f(!0),C(V,null,B(e.PreviuosSelectedMedicalDrugsList,(D,w)=>(f(),C("div",{class:"ionLbltp",key:w},[e.itemWasExpanded&&w>0?(f(),C("div",So,[d("div",null,[n(r,{class:"previousLabelDate"},{default:i(()=>[O(P(D.prescriptionDate),1)]),_:2},1024)]),d("div",Co,[(f(),z(p,{_selectedMedicalDrugsList:D.previousPrescriptions,show_actions_buttons:!1,key:e.componentKey},null,8,["_selectedMedicalDrugsList"]))])])):R("",!0)]))),128))])]),_:1})]),_:1},8,["onIonChange"])])]),_:1})]),_:1},8,["onIonChange"])])]),_:1})}const Mo=H(_o,[["render",bo],["__scopeId","data-v-1db96250"]]),No=T({name:"PrescriptionTable",components:{IonCard:ce,IonCardHeader:ke,IonButton:Pe,IonCardTitle:st,IonCardContent:Ae,IonInput:ue,IonIcon:Z,IonCol:ge,IonRow:_e,IonCheckbox:xe,Medication:ft,MedicationHistory:Mo},setup(){return{openAddOtherOPDMedicationModal:async()=>{await Be(lo,{class:"large-modal"},!0,{})},medkit:Ve}}});function wo(e,t,o,s,a,l){const r=h("Medication"),c=h("ion-icon"),p=h("ion-button"),u=h("ion-col"),m=h("ion-row"),g=h("MedicationHistory"),D=h("IonCol"),w=h("ion-card-content"),b=h("ion-card");return f(),z(b,null,{default:i(()=>[n(w,null,{default:i(()=>[n(r),n(m,null,{default:i(()=>[n(u,null,{default:i(()=>[n(p,{onClick:e.openAddOtherOPDMedicationModal,color:"primary",style:{float:"right"}},{default:i(()=>[n(c,{icon:e.medkit,slot:"start"},null,8,["icon"]),t[0]||(t[0]=d("span",{style:{"margin-left":"10px","font-size":"16px","font-weight":"600"}}," ADD Other Medication",-1))]),_:1,__:[0]},8,["onClick"])]),_:1})]),_:1}),n(m,null,{default:i(()=>[n(D,null,{default:i(()=>[n(g)]),_:1})]),_:1})]),_:1})]),_:1})}const Io=H(No,[["render",wo],["__scopeId","data-v-a4ad7088"]]),$o={key:0,class:"custom-allergy-container"},Oo=T({watch:{},name:"AllergiesComponent"}),Ao=T({...Oo,setup(e){const t=Wt(),o=G(),s=K(()=>t.selectedMedicalAllergiesList),a=K(()=>o.patient),l=K(()=>t.medicalAllergiesList),r=N(M(8,"item-")),c=N(),p=N(!1),u=[{multi_Selection:!0,show_list_label:!0,unqueId:r.value,name_of_list:"Add/Remove allergies",placeHolder:"Search for an allergy",items:[],listUpdatedFN:D,listFilteredFN:()=>{},searchTextFN:w,use_internal_filter:!0,show_error:N(!1),error_message:"please select a User",disabled:N(!1)}],m=N(!1);le(async()=>{g()});const g=()=>{t.current_patient.ID!=a.value.ID&&(t.clearSelectedMedicalAllergiesList(),t.setCurrentPatient(a.value))};function D($){$.forEach(S=>{S.selected==!0&&S.name==="Other"&&(p.value=S.name==="Other")}),t.setSelectedMedicalAllergiesList($),b()}async function w($){const S=$,v=await Ue.getConceptSet("OPD Medication",S);v.map(U=>({label:U.name,value:U.name,other:U}));const y=Qt(S),L=Kt(y,v).sort((U,E)=>U.name.localeCompare(E.name));t.setMedicalAllergiesList(L),b()}function b(){const $=l.value;s.value.forEach(v=>{let y=!1;$.forEach((I,L)=>{I.concept_id==v.concept_id&&v.selected===!0&&($[L]=v,y=!0)}),!y&&v.selected===!0&&$.push(v)});const S=$.filter((v,y,I)=>y===I.findIndex(L=>L.concept_id===v.concept_id));t.setMedicalAllergiesList(S)}function M($=8,S=""){const v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let y=S;for(let I=0;I<$;I++)y+=v.charAt(Math.floor(Math.random()*v.length));return y+="-".concat(Date.now()),y}async function A($){try{const S=$.trim();if(S){const v={name:S,selected:!0};t.setMedicalAllergiesList([...l.value,v]),t.setSelectedMedicalAllergiesList(v),p.value=!1,m.value=!0,c.value="";const y=t.findSelectedAllergyByName("Other");t.removeSelectedAllergy(y)}}catch(S){console.error(S)}}return($,S)=>(f(),z(_(ce),null,{default:i(()=>[n(_(ke),null,{default:i(()=>[n(_(F),{class:"header-container"},{default:i(()=>[n(_(Z),{icon:_(at),class:"allergy-icon"},null,8,["icon"]),S[2]||(S[2]=d("span",{style:{"font-size":"16px","font-weight":"600"}}," Allergies (Medication, Healthcare items, Environment and Food) ",-1))]),_:1,__:[2]})]),_:1}),n(_(Ae),null,{default:i(()=>[n(Yt,{multiSelection:u[0].multi_Selection,show_label:u[0].show_list_label,uniqueId:u[0].unqueId,name_of_list:u[0].name_of_list,choose_place_holder:u[0].placeHolder,"items_-list":l.value,use_internal_filter:u[0].use_internal_filter,disabled:u[0].disabled.value,onItemListUpDated:u[0].listUpdatedFN,onItemListFiltered:u[0].listFilteredFN,onItemSearchText:u[0].searchTextFN},null,8,["multiSelection","show_label","uniqueId","name_of_list","choose_place_holder","items_-list","use_internal_filter","disabled","onItemListUpDated","onItemListFiltered","onItemSearchText"]),p.value?(f(),C("div",$o,[n(_(ue),{modelValue:c.value,"onUpdate:modelValue":S[0]||(S[0]=v=>c.value=v),placeholder:"Please specify the allergy",fill:"outline",class:"custom-input"},null,8,["modelValue"]),n(_(Pe),{onClick:S[1]||(S[1]=v=>A(c.value)),class:"addCustomAllergyBtn"},{default:i(()=>S[3]||(S[3]=[O(" Add Allergy ")])),_:1,__:[3]})])):R("",!0)]),_:1})]),_:1}))}}),Po=H(Ao,[["__scopeId","data-v-8aa98f55"]]),ko=De("nonPharmaTherapyStore",{state:()=>({items:[{id:"wound-dressing",label:"Wound dressing",checked:!1},{id:"patient-education",label:"Patient education",checked:!1},{id:"counseling",label:"Counseling",checked:!1},{id:"minor-surgery",label:"Minor Surgery",checked:!1}],current_patient:{}}),actions:{async saveNonPharmaTherapyPatientData(){const e=Xt(),t=[];this.items.forEach(o=>{o.checked==!0&&t.push({concept_id:11023,value_coded:2592,value_text:JSON.stringify(o),obs_datetime:k.toStandardHisFormat(q.getSessionDate()),location_id:e.facilityLocation.code})});try{t.length>0&&Lo(t)}catch(o){oe("Unable to update Non Pharma Therapy!")}this.clearSelectednonPharmaTherapyStore()},clearSelectednonPharmaTherapyStore(){this.items.forEach(e=>{e.checked=!1})},setCurrentPatient(e){this.current_patient=e}},persist:!0});async function Lo(e){var t,o,s;try{const a=G(),{patient:l}=X(a),r=JSON.parse(JSON.stringify(l.value));(s=(o=(t=r.notes)!=null?t:r.notes={}).unsaved)!=null||(o.unsaved=[]),r.notes.unsaved.push(...e),await he(r),de("Non Pharma Therapy has been saved")}catch(a){oe("Unable to create non pharmalogical notes!")}}const Fo={class:"checklist-container"},To=T({watch:{},name:"xxxComponent"}),Eo=T({...To,setup(e){const t=G(),o=K(()=>t.patient),s=ko(),a=s.items;le(async()=>{l()});const l=()=>{s.current_patient.ID!=o.value.ID&&(s.clearSelectednonPharmaTherapyStore(),s.setCurrentPatient(o.value))};return Te(()=>o.value,async r=>{}),(r,c)=>(f(),C("div",Fo,[(f(!0),C(V,null,B(_(a),p=>(f(),z(_(J),{key:p.id,class:"no-border"},{default:i(()=>[n(_(xe),{id:p.id,modelValue:p.checked,"onUpdate:modelValue":u=>p.checked=u,slot:"start"},null,8,["id","modelValue","onUpdate:modelValue"]),n(_(F),{style:{"font-size":"16px","font-weight":"600"}},{default:i(()=>[O(P(p.label),1)]),_:2},1024)]),_:2},1024))),128))]))}}),xo=H(Eo,[["__scopeId","data-v-371e920f"]]),Vo={style:{"margin-top":"14px","margin-left":"10px"}},Ho={class:"ion-padding",slot:"content"},Bo={key:0},Uo={class:"previousSecDrgs"},Ro={class:"ion-padding",slot:"content"},zo={class:"previousSecDrgs"},Jo=T({watch:{},name:"xxxComponent"}),jo=T({...Jo,setup(e){const t=N(),o=N(),s=N(!1),a=N(!1),l=N("Show more notes");le(async()=>{const p=new ze,{previousClinicalNotes:u}=await p.getPatientEncounters();t.value=Object.entries(u)[0];const[,...m]=Object.entries(u);o.value=m});function r(p){const u=p.detail.value;u!==void 0?u=="third"&&(l.value="Show less notes",a.value=!s.value):(l.value="Show more notes",a.value=!s.value)}function c(p){return p[1]}return(p,u)=>(f(),z(_(ce),null,{default:i(()=>[d("div",Vo,[n(_(fe),{ref:"accordionGroup",class:"previousView"},{default:i(()=>[n(_(ve),{value:"fourth","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(_(J),{slot:"header",color:"light"},{default:i(()=>[n(_(F),{class:"previousLabel"},{default:i(()=>u[0]||(u[0]=[O("Previous visits notes")])),_:1,__:[0]})]),_:1}),d("div",Ho,[(f(!0),C(V,null,B(t.value,(m,g)=>(f(),C("div",{class:"ionLbltp",key:g},[g==1?(f(),C("div",Bo,[(f(!0),C(V,null,B(m,(D,w)=>(f(),C("div",{key:w},[d("div",null,[n(_(F),{class:"previousLabelDate"},{default:i(()=>[O(P(D.date),1)]),_:2},1024)]),d("div",Uo,[n(_(ne),null,{default:i(()=>[n(_(F),{class:"notes_p"},{default:i(()=>[O(P(D.notes),1)]),_:2},1024)]),_:2},1024)])]))),128))])):R("",!0)]))),128)),n(_(fe),{onIonChange:r},{default:i(()=>[n(_(ve),{value:"third","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(_(J),{slot:"header",color:"light"},{default:i(()=>[n(_(F),{class:"",color:"primary"},{default:i(()=>[O(P(l.value),1)]),_:1})]),_:1}),d("div",Ro,[(f(!0),C(V,null,B(o.value,(m,g)=>(f(),C("div",{class:"ionLbltp",key:g},[(f(!0),C(V,null,B(c(m),(D,w)=>(f(),C("div",{key:w},[d("div",null,[n(_(F),{class:"previousLabelDate"},{default:i(()=>[O(P(D.date),1)]),_:2},1024)]),d("div",zo,[n(_(ne),null,{default:i(()=>[n(_(F),{class:"notes_p"},{default:i(()=>[O(P(D.notes),1)]),_:2},1024)]),_:2},1024)])]))),128))]))),128))])]),_:1})]),_:1})])]),_:1})]),_:1},512)])]),_:1}))}}),Go=H(jo,[["__scopeId","data-v-994df42d"]]),qo={style:{"margin-top":"14px","margin-left":"10px"}},Wo=T({watch:{},name:"xxxComponent"}),Qo=T({...Wo,setup(e){const t=ie(),o=se,s=K(()=>t.nonPharmalogicalTherapyAndOtherNotes);function a(r){let c=r.target.value;l(c)}function l(r){ie().setNonPharmalogicalTherapyAndOtherNotes(r)}return(r,c)=>(f(),z(_(ce),null,{default:i(()=>[n(_(ke),null,{default:i(()=>[n(_(F),{class:"tpStndCls"},{default:i(()=>[n(_(Z),{icon:_(Et),class:"header-icon","aria-hidden":"true"},null,8,["icon"]),c[1]||(c[1]=O(" Non-pharmalogical therapy and other notes "))]),_:1,__:[1]})]),_:1}),n(_(Ae),null,{default:i(()=>[d("div",null,[n(xo),n(_(J),{class:"input_item",style:{"min-height":"120px","margin-top":"14px"}},{default:i(()=>[n(_(F),null,{default:i(()=>[n(_(Z),{slot:"start",icon:_(o).editPen,"aria-hidden":"true"},null,8,["icon"])]),_:1}),n(_(xt),{onIonInput:a,modelValue:s.value,"onUpdate:modelValue":c[0]||(c[0]=p=>s.value=p),style:{"min-height":"120px"},class:"inputTpln","auto-grow":!0,fill:"outline"},null,8,["modelValue"])]),_:1})]),d("div",qo,[n(Go)])]),_:1})]),_:1}))}}),Ko=H(Qo,[["__scopeId","data-v-fd19ec21"]]),Yo={class:"ion-padding",slot:"content"},Xo={key:0},Zo={class:"previousSecDrgs"},es={class:"ion-padding",slot:"content"},ts={class:"previousSecDrgs"},ns=T({watch:{},name:"xxxComponent"}),os=T({...ns,setup(e){const t=N(!1),o=N(!1),s=N("Show more allergies"),a=N(),l=N();le(async()=>{const p=new ze,{previousDrugAllergies:u}=await p.getPatientEncounters();a.value=Object.entries(u)[0];const[,...m]=Object.entries(u);l.value=m});function r(p){const u=p.detail.value;u!==void 0?u=="fith"&&(s.value="Show less allegies",o.value=!t.value):(s.value="Show more allegies",o.value=!t.value)}function c(p){return p[1]}return(p,u)=>{const m=h("ion-card");return f(),z(m,null,{default:i(()=>[n(_(fe),{ref:"accordionGroup",class:"previousView"},{default:i(()=>[n(_(ve),{value:"fourth","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(_(J),{slot:"header",color:"light"},{default:i(()=>[n(_(F),{class:"previousLabel"},{default:i(()=>u[0]||(u[0]=[O("Documented allergies timeline")])),_:1,__:[0]})]),_:1}),d("div",Yo,[(f(!0),C(V,null,B(a.value,(g,D)=>(f(),C("div",{class:"ionLbltp",key:D},[D==1?(f(),C("div",Xo,[d("div",null,[n(_(F),{class:"previousLabelDate"},{default:i(()=>[O(P(g[0].date),1)]),_:2},1024)]),(f(!0),C(V,null,B(g,(w,b)=>(f(),C("div",{key:b},[d("div",Zo,[n(_(ne),null,{default:i(()=>[n(_(F),{class:"notes_p"},{default:i(()=>[O(P(w.value),1)]),_:2},1024)]),_:2},1024)])]))),128))])):R("",!0)]))),128)),n(_(fe),{onIonChange:r},{default:i(()=>[n(_(ve),{value:"fith","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(_(J),{slot:"header",color:"light"},{default:i(()=>[n(_(F),{class:"",color:"primary"},{default:i(()=>[O(P(s.value),1)]),_:1})]),_:1}),d("div",es,[(f(!0),C(V,null,B(l.value,(g,D)=>(f(),C("div",{class:"ionLbltp",key:D},[d("div",null,[n(_(F),{class:"previousLabelDate"},{default:i(()=>[O(P(g[0]),1)]),_:2},1024)]),(f(!0),C(V,null,B(c(g),(w,b)=>(f(),C("div",{key:b},[d("div",ts,[n(_(ne),null,{default:i(()=>[n(_(F),{class:"notes_p"},{default:i(()=>[O(P(w.value),1)]),_:2},1024)]),_:2},1024)])]))),128))]))),128))])]),_:1})]),_:1})])]),_:1})]),_:1},512)]),_:1})}}}),ss=H(os,[["__scopeId","data-v-358c5959"]]),as={class:"background"},is={key:0},rs={style:{margin:"10px"}},ls={key:1},cs={style:{margin:"10px"}},ds={key:2},us={style:{margin:"10px"}},ps=T({__name:"TreatmentPlan",setup(e){const t=N(["medications","allergies","other_notes"]),o=N(t.value[0]);le(()=>{s(t.value[0])});function s(a){o.value=a}return(a,l)=>(f(),C("div",as,[n(_(Vt),{value:o.value,style:{"margin-top":"5px"}},{default:i(()=>[n(_(Le),{value:"medications",onClick:l[0]||(l[0]=r=>s(t.value[0]))},{default:i(()=>[n(_(F),null,{default:i(()=>l[3]||(l[3]=[O("Medications")])),_:1,__:[3]})]),_:1}),n(_(Le),{value:"allergies",onClick:l[1]||(l[1]=r=>s(t.value[1]))},{default:i(()=>[n(_(F),null,{default:i(()=>l[4]||(l[4]=[O("Allergies")])),_:1,__:[4]})]),_:1}),n(_(Le),{value:"other_notes",onClick:l[2]||(l[2]=r=>s(t.value[2]))},{default:i(()=>[n(_(F),null,{default:i(()=>l[5]||(l[5]=[O("Non-pharmalogical therapy and other notes")])),_:1,__:[5]})]),_:1})]),_:1},8,["value"]),o.value===t.value[0]?(f(),C("div",is,[d("div",rs,[n(Io)])])):R("",!0),o.value===t.value[1]?(f(),C("div",ls,[d("div",cs,[n(Po),n(ss,{style:{"margin-top":"10px"}})])])):R("",!0),o.value===t.value[2]?(f(),C("div",ds,[d("div",us,[n(Ko)])])):R("",!0)]))}}),Xs=H(ps,[["__scopeId","data-v-d844be41"]]);async function Zs(){var e,t,o;try{const s=G(),{patient:a}=X(s),l=gs(),r=JSON.parse(JSON.stringify(a.value));if(l.length>0){(o=(t=(e=r.MedicationOrder)!=null?e:r.MedicationOrder={}).unsaved)!=null||(t.unsaved=[]);const c=r.MedicationOrder.unsaved.findIndex(u=>u.NCD_Drug_Orders);if(c>=0)r.MedicationOrder.unsaved[c].NCD_Drug_Orders=[...r.MedicationOrder.unsaved[c].NCD_Drug_Orders,...l];else{const u={NCD_Drug_Orders:l};r.MedicationOrder.unsaved.push(u)}await he(r),j().clearMedicationDataStores(),de("Drug order(s) has been created")}else oe("Unable to create drug orders!")}catch(s){oe("Unable to create drug orders!")}}function Xe(){try{const e=new Date(q.getSessionDate()),o=ie().selectedMedicalDrugsList;let s=0;if(o.forEach(u=>{const m=parseInt(u.duration,10);!isNaN(m)&&m>s&&(s=m)}),s<=0)return{date:null,formattedDate:null};const a=new Date(e);a.setDate(e.getDate()+s);const l=String(a.getDate()).padStart(2,"0"),r=String(a.getMonth()+1).padStart(2,"0"),c=a.getFullYear(),p="".concat(l,"/").concat(r,"/").concat(c);return{date:a,formattedDate:p}}catch(e){return console.error("Error calculating OPD medication run out date:",e),{date:null,formattedDate:null}}}function ms(){try{const e=new Date(q.getSessionDate()),o=j().selectedNCDMedicationList;let s=0;if(o.forEach(u=>{const m=parseInt(u.duration,10);!isNaN(m)&&m>s&&(s=m)}),s<=0)return{date:null,formattedDate:null};const a=new Date(e);a.setDate(e.getDate()+s);const l=String(a.getDate()).padStart(2,"0"),r=String(a.getMonth()+1).padStart(2,"0"),c=a.getFullYear(),p="".concat(l,"/").concat(r,"/").concat(c);return{date:a,formattedDate:p}}catch(e){return console.error("Error calculating medication run out date:",e),{date:null,formattedDate:null}}}const gs=()=>{const e=j();return e.selectedNCDMedicationList.map(t=>{t.frequency=e.frequency_selections[t.drug_id]||"",t.totalDosage=Object.values(t.dosage).reduce((a,l)=>a+Number(l),0);const o=mt.getSessionDate(),s=fs(t.drug_id);return{drug_inventory_id:t.drug_id,equivalent_daily_dose:t.totalDosage=="Unknown"?0:t.totalDosage*(s==null?void 0:s.value)||0,start_date:o,auto_expire_date:vt(o,t.duration),units:t.units,instructions:"".concat(t.name," ").concat(t.totalDosage," ").concat(t.units," ").concat((s==null?void 0:s.code)||""," for ").concat(t.duration," days"),dose:_s(t),frequency:(s==null?void 0:s.code)||""}})},_s=e=>e.dose_strength!=null&&e.dose_strength?Math.trunc(e.dose_strength):1;async function ea(){var e,t,o;try{const s=G(),{patient:a}=X(s),l=hs(),r=JSON.parse(JSON.stringify(a.value));if(l.length>0){(o=(t=(e=r.MedicationOrder)!=null?e:r.MedicationOrder={}).unsaved)!=null||(t.unsaved=[]);const c=r.MedicationOrder.unsaved.findIndex(u=>u.NCD_Drug_Orders);if(c>=0)r.MedicationOrder.unsaved[c].NCD_Drug_Orders=[...r.MedicationOrder.unsaved[c].NCD_Drug_Orders,...l];else{const u={NCD_Drug_Orders:l};r.MedicationOrder.unsaved.push(u)}await he(r),ie().clearSelectedMedicalDrugsList(),de("Drug order(s) has been created")}else oe("Unable to create drug orders!")}catch(s){oe("Unable to create drug orders!")}}const hs=()=>ie().selectedMedicalDrugsList.map(t=>{const o=mt.getSessionDate(),s=te.find(a=>a.label===t.frequency)||{};return{drug_inventory_id:t.drug_id,equivalent_daily_dose:t.dose=="Unknown"?0:t.dose*(s==null?void 0:s.value)||0,start_date:o,auto_expire_date:vt(o,t.duration),units:t.units,instructions:"".concat(t.drugName,": ").concat(t.dose," ").concat(t.units," ").concat((s==null?void 0:s.code)||""," for ").concat(t.duration," days"),dose:t.dose,frequency:(s==null?void 0:s.code)||""}}),fs=e=>{const o=j().selectedNCDMedicationList.find(a=>a.drug_id===e);if(!o||!o.dosage)return null;switch(["morning","afternoon","evening"].reduce((a,l)=>a+(o.dosage[l]?1:0),0)){case 1:return o.dosage.morning?te.find(a=>a.code==="QAM"):o.dosage.afternoon?te.find(a=>a.code==="QNOON"):o.dosage.evening?te.find(a=>a.code==="QPM"):te.find(a=>a.code==="OD");case 2:return te.find(a=>a.code==="BD");case 3:return te.find(a=>a.code==="TDS");default:return te.find(a=>a.code==="Unknown")}},vt=(e,t)=>{const o=new Date(e);return o.setDate(o.getDate()+parseInt(t)),k.toStandardHisFormat(o)},vs=T({components:{IonContent:re,IonHeader:me,IonItem:J,IonList:ne,IonMenu:Ee,IonTitle:ye,IonToolbar:pe,BasicInputField:He,IonDatetime:Bt,IonBadge:Ht,DateInputField:un,DynamicButton:it},setup(){const e=Fe(),t=N(0),o=K(()=>e.getDisabledDates()),s=K(()=>e.getAssignedAppointments()),a=N();return{disabledDates:o,datesCounts:s,appointment_count:t,calendarOutline:Ut,inputPRDate:a}},data(){return ee(),Je(),{iconsContent:se,date:new Date(q.getSessionDate()),tomorrow:new Date(q.getSessionDate()).getDate()+1,appointment:"",drugRunoutDate:"",nextAppointmentDate:"",minDate:new Date(q.getSessionDate())}},computed:{...Q(ee,["nextAppointment","appointmentCountsCache","currentSelectedNextAppointmentDate"]),...Q(Fe,["maximumNumberOfDaysForEachDay","assignedAppointmentsDates"]),...Q(G,["patient"]),...Q(Je,["activeProgram"]),calendarDate(){const e=ee();return e.currentSelectedNextAppointmentDate?k.toStandardHisDisplayFormat(e.currentSelectedNextAppointmentDate):""},runOutDate(){var e;return((e=this.activeProgram)==null?void 0:e.program_id)===14?Xe():ms()}},watch:{calendarDate:{handler(){this.updateNextAppointment()},deep:!0},"$service.sessionDate":{handler(){this.updateMinDate()},immediate:!0},"patient.ID":{async handler(e,t){e!==t&&(this.cleanCurrentNextAppointmentDate(),this.checkIfSamePatientInContext())}}},async mounted(){this.checkIfSamePatientInContext(),await this.getAppointmentMents(this.runOutDate.date),await tn().loadGlobalProperty(),this.validateAppointmentCountsCache(),await this.preloadAppointmentCounts(),cn();const e=q.getUserID(),t=new ut;this.appointment=new be(t.getID(),e),this.nextAppointmentDate=this.appointment.date,this.supposedRunOutDate(),window.addEventListener("storage",this.handleStorageChange),Xe()},beforeUnmount(){window.removeEventListener("storage",this.handleStorageChange)},methods:{handleStorageChange(e){e.key==="sessionDate"&&this.updateMinDate()},updateMinDate(){this.date=new Date(q.getSessionDate()),this.minDate=new Date(q.getSessionDate())},updateNextAppointment(){ee().setNextAppointment(this.calendarDate)},async handleDateUpdate(e){e&&(Fe().setsssignedAppointmentsDates(e,!0),this.calendarDate=k.toStandardHisDisplayFormat(e),await this.save(),await this.getAppointmentMents(e),await this.updateAppointmentCache(e),ee().setCurrentSelectedNextAppointmentDate(e,this.patient.ID))},async getAppointmentMents(e){if(en().apiStatus)try{const o=await be.getDailiyAppointments(k.toStandardHisFormat(e),k.toStandardHisFormat(e));this.appointment_count=o.length}catch(o){}},getCounter(e){const t=k.toStandardHisFormat(e);return this.appointmentCountsCache[t]||""},async save(){if(this.assignedAppointmentsDates.length>0)try{const t=await new dn().createOfflineAppointment()}catch(e){}},async openCornfirmModal(e){this.calendarDate=k.toStandardHisDisplayFormat(e),await this.getAppointmentMents(e),Be(Zt,{class:"otherVitalsModal"},!0,{message:"Are you sure you want to add this Appointment?"},{cancel:a=>{},confirm:async a=>{a.detail==!0&&await this.handleDateUpdate(e)}})},async handleInput(e){this.inputPRDate=k.toStandardHisDisplayFormat(e),await this.openCornfirmModal(e)},async supposedRunOutDate(){await dt.getLastDrugsReceived(this.patient.patientID)},async preloadAppointmentCounts(){try{const e=new Date(q.getSessionDate());e.setDate(1);const t=new Date(q.getSessionDate());t.setMonth(t.getMonth()+2),t.setDate(0);const o=this.generateDateRange(e,t);for(const s of o)try{const a=await be.getDailiyAppointments(k.toStandardHisFormat(s),k.toStandardHisFormat(s)),l=k.toStandardHisFormat(s);this.appointmentCountsCache[l]=a.length}catch(a){console.error("Error fetching appointments for ".concat(s,":"),a);const l=k.toStandardHisFormat(s);this.appointmentCountsCache[l]=0}}catch(e){console.error("Error in preload process:",e)}},generateDateRange(e,t){const o=[],s=new Date(e);for(;s<=t;)o.push(new Date(s)),s.setDate(s.getDate()+1);return o},async updateAppointmentCache(e){try{const t=k.toStandardHisFormat(e),o=await be.getDailiyAppointments(k.toStandardHisFormat(e),k.toStandardHisFormat(e));this.appointmentCountsCache[t]=o.length}catch(t){console.error("Error updating appointment cache:",t)}},validateAppointmentCountsCache(){ee().checkCurrentLocationIfInContext()},isRunOutDate(e){return!this.runOutDate||!this.runOutDate.date?!1:k.toStandardHisFormat(e)===k.toStandardHisFormat(this.runOutDate.date)},cleanCurrentNextAppointmentDate(){ee().cleanCurrentSelectedNextAppointmentDate()},checkIfSamePatientInContext(){const e=ee();e.current_patient.ID!=this.patient.ID&&(this.cleanCurrentNextAppointmentDate(),e.setCurrentPatient(this.patient))}}}),Ds={class:"card_content"},ys={class:"count-badge"},Ss={class:"dates_title"},Cs={class:"sub_data"},bs={class:"dates_title"},Ms={class:"sub_data"},Ns={class:"dates_title"},ws={class:"sub_data"},Is={class:"dates_title"},$s={class:"sub_data"};function Os(e,t,o,s,a,l){const r=h("VueDatePicker"),c=h("ion-col"),p=h("DynamicButton"),u=h("ion-item"),m=h("ion-row"),g=h("DateInputField");return f(),C("div",Ds,[n(m,null,{default:i(()=>[n(c,{"size-sm":"12","size-md":"12","size-lg":"12","size-xl":"8"},{default:i(()=>[n(r,{class:"calender",onDateUpdate:e.openCornfirmModal,inline:"","auto-apply":"","enable-time-picker":!1,"disabled-dates":e.disabledDates,"min-date":e.minDate,modelValue:e.runOutDate.date,"onUpdate:modelValue":t[0]||(t[0]=D=>e.runOutDate.date=D)},{day:i(({day:D,date:w})=>[(f(),C("p",{key:0,class:W({"run-out-date":e.isRunOutDate(w)}),style:{"font-weight":"600","font-size":"20px"}},[d("span",null,[O(P(D),1),d("sup",ys,P(e.getCounter(w)),1)])],2))]),_:1},8,["onDateUpdate","disabled-dates","min-date","modelValue"])]),_:1}),n(c,null,{default:i(()=>[n(u,null,{default:i(()=>[d("div",Ss,[t[3]||(t[3]=d("div",null,[O("Suggested Next Appointment Date "),d("span",{style:{"font-size":"16px"}},"(Medication run out date)")],-1)),d("div",Cs,[O(P(e.runOutDate.formattedDate||"No run out date available")+" ",1),e.runOutDate.formattedDate?(f(),z(p,{key:0,onClick:t[1]||(t[1]=D=>e.handleDateUpdate(e.runOutDate.date)),name:"Set Next Appt.",fill:"solid",iconSlot:"icon-only",style:{float:"right"}})):R("",!0)])])]),_:1}),n(u,null,{default:i(()=>[d("div",bs,[t[4]||(t[4]=d("div",null,"User set appointment date",-1)),d("div",Ms,P(e.calendarDate),1)])]),_:1}),n(u,null,{default:i(()=>[d("div",Ns,[t[5]||(t[5]=d("div",null,"Appointments",-1)),d("div",ws,P(e.appointment_count),1)])]),_:1}),n(u,null,{default:i(()=>[d("div",Is,[t[6]||(t[6]=d("div",null,"Appointment limit (per/day)",-1)),d("div",$s,P(e.appointment_count)+"/"+P(e.maximumNumberOfDaysForEachDay),1)])]),_:1})]),_:1})]),_:1}),n(m,null,{default:i(()=>[n(c,{size:"4"},{default:i(()=>[n(g,{inputHeader:"Preferred Next Appointment Date",bold:"600",fontSize:"17px",placeholderFontSize:"17px",placeholderFontWeight:"600",unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.inputPRDate,eventType:"",minDate:e.minDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t[2]||(t[2]=D=>e.handleInput(D))},null,8,["icon","inputValue","minDate"])]),_:1})]),_:1})])}const ta=H(vs,[["render",Os],["__scopeId","data-v-b92d422a"]]);export{Po as A,Ws as C,qs as D,Qs as M,ta as N,ze as P,Xs as T,Dn as a,Lo as b,Zs as c,ko as d,Ys as e,ea as f,go as g,xo as h,Ks as s,j as u};

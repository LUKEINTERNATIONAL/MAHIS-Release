import{d as N,c as D,y as h,f,u as a,af as R,z as i,l as o,U as G,k as l,T as K,A as k,S as Z,aa as L,ab as M,a9 as W,X as V,cl as U,r as I,n as Q,w as Y,a as X,e as S,cw as ee,m as x,bM as te,G as z,D as O,d3 as ne,ac as ae,F as se,L as re,B as oe,W as J,p as ie}from"./vendor-CDoWWVkO.js";import{i as $,ar as F,D as A,as as le,S as E,_ as q,j as de,z as j,n as C,at as ue,T as ce}from"./index-D8BILC_J.js";import{u as pe}from"./useExposeFromStandardForm-FW92qusl.js";import{u as me}from"./useLocation-MFHi6kGl.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-BHjAlFBS.js";const fe={style:{display:"flex","justify-content":"space-between"}},_e={style:{"max-width":"500px",margin:"auto"}},ve=N({__name:"AddWebPrinter",setup(B){const{formRef:_}=pe(),{facilityList:P,getFacilities:v}=me();v();const m=D(()=>[{componentType:"inputField",header:"Print name",name:"printer_name",icon:$.print,validation:d=>F.required(d)},{componentType:"inputField",header:"Printer IP address",name:"ip_address",icon:$.networkBarDark,validation:d=>F.required(d)},{componentType:"multiSelectInputField",header:"Facility",name:"location_id",trackBy:"facility_id",openDirection:"auto",icon:$.search,validation:d=>F.required(d),options:P.value.facilities}]),b=()=>{V.dismiss()},u=()=>{var c;const d=(c=_.value)==null?void 0:c.getFormValues();d.location_id=d.location_id.code,E.postJson("/printer_configurations",d),V.dismiss()};return(d,c)=>(f(),h(a(R),null,{default:i(()=>[o(a(Z),null,{default:i(()=>[o(a(G),null,{default:i(()=>[l("div",fe,[o(a(K),null,{default:i(()=>c[2]||(c[2]=[k("Add Web Printer")])),_:1,__:[2]}),o(A,{name:"X",style:{"margin-right":"10px"},onClick:c[0]||(c[0]=g=>b())})])]),_:1})]),_:1}),o(a(W),{class:"ion-padding"},{default:i(()=>[l("div",_e,[o(a(L),null,{default:i(()=>[o(a(M),{size:"12"},{default:i(()=>[o(le,{formData:m.value,ref_key:"formRef",ref:_},null,8,["formData"])]),_:1})]),_:1}),o(a(L),{class:"ion-justify-content-end ion-margin-top"},{default:i(()=>[o(a(M),{size:"auto"},{default:i(()=>[o(A,{name:"Add printer",onClick:c[1]||(c[1]=g=>u())})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),ge=q(ve,[["__scopeId","data-v-bce6abd1"]]),ye={class:""},Pe={class:"table-header"},be={class:"table-responsive"},Ie={key:0,class:"loading-state"},we={key:1,class:"empty-state"},he=N({__name:"ManageIPPrinters",setup(B){const _=U(),P=I([]),v=I(!1);I(null);const m=D(()=>({paging:!0,lengthChange:!1,searching:!1,ordering:!0,info:!0,autoWidth:!0,responsive:!0,pageLength:8,createdRow:(n,s,p)=>{Q(()=>{const y=n.lastElementChild;if(y){y.innerHTML="";const e=document.createElement("button");e.innerText="Test Print",e.className="test-print-button action-button",e.onclick=()=>c(s),y.appendChild(e);const t=document.createElement("button");t.innerText="Edit",t.className="edit-button action-button",t.onclick=()=>u(s),y.appendChild(t);const r=document.createElement("button");r.innerText="Delete",r.className="delete-button action-button",r.onclick=()=>d(s),y.appendChild(r)}})}})),b=D(()=>[{data:"printer_name",title:"Printer name"},{data:"ip_address",title:"Ip address"},{data:"location_id",title:"Location ID"},{data:"created_at",title:"Date"},{data:null,title:"Actions",orderable:!1,render:function(n,s,p){return""}}]),u=async(n=null)=>{await de(ge,{class:"large-modal"},!0),await g()},d=async n=>{if(confirm("Are you sure you want to delete printer: ".concat(n.printer_name,"?")))try{console.log("ðŸš€ ~ deletePrinter ~ printerData:",n),await E.delete("/printer_configurations/".concat(n._id),{id:n._id}),j("Printer ".concat(n.printer_name," deleted successfully! (Simulated)")),await g()}catch(s){console.error("Error deleting printer:",s),C("Failed to delete printer ".concat(n.printer_name,"."))}},c=async n=>{const s="^XA\n        ^FO50,50^A0N,60,60^FDTest Print from Vue App!^FS\n        ^FO50,150^A0N,30,30^FDPrinter: ".concat(n.printer_name,"^FS\n        ^FO50,200^A0N,30,30^FDIP Address: ").concat(n.ip_address,"^FS\n        ^XZ");try{const p=await fetch("https://".concat(n.ip_address,"/print"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({zpl:s})});if(p.ok)j("Test print sent successfully to ".concat(n.printer_name));else{const y=await p.json();C("Failed to send test print to ".concat(n.printer_name,". Error: ").concat(y.message||p.statusText))}}catch(p){console.error("Error sending test print:",p),C("Error sending test print to ".concat(n.printer_name,". Please check your network or server connection."))}},g=async()=>{v.value=!0;try{P.value=await E.getJson("/printer_configurations")}catch(n){console.error("Error loading printer configurations:",n),C("Failed to load printer configurations.")}finally{v.value=!1}};return Y(_,async()=>{await g()},{deep:!0}),X(async()=>{await g()}),(n,s)=>(f(),S("div",ye,[l("div",null,[l("div",Pe,[s[1]||(s[1]=l("h3",{class:"encounter-title"},"Manage web printers",-1)),o(A,{name:"Add printer",fill:"solid",onClick:s[0]||(s[0]=p=>u())})]),l("div",be,[v.value?(f(),S("div",Ie,s[2]||(s[2]=[l("p",null,"Loading observations...",-1)]))):P.value.length===0?(f(),S("div",we,s[3]||(s[3]=[l("p",null,"No observations found for",-1)]))):(f(),h(a(ee),{key:2,ref:"dataTable",class:"display nowrap modern-table",width:"100%",data:P.value,columns:b.value,options:m.value},{default:i(()=>s[4]||(s[4]=[l("thead",null,[l("tr",null,[l("th",null,"Printer name"),l("th",null,"Ip address"),l("th",null,"Date"),l("th",null,"Actions")])],-1)])),_:1,__:[4]},8,["data","columns","options"]))])])]))}}),ke={key:0,class:"spinner-overlay"},Se={class:"container"},Te=N({__name:"ManagePrinters",setup(B){U();const _=I(!1),P=I(Math.random()),v=I([]),m=I({}),b=new ue,u=I(!1);function d(){try{localStorage.setItem("isIpPrinters",JSON.stringify(u.value)),console.log("isIpPrinters state saved:",u.value)}catch(e){console.error("Error saving isIpPrinters state to localStorage:",e)}}function c(){try{const e=localStorage.getItem("isIpPrinters");e!==null&&(u.value=JSON.parse(e),console.log("isIpPrinters state loaded:",u.value))}catch(e){console.error("Error loading isIpPrinters state from localStorage:",e)}}async function g(){if(!_.value){_.value=!0;try{const e=await b.getAllPrinters();console.log("Discovered printers",JSON.stringify(e)),v.value=y(e)}catch(e){console.error("Error loading printers:",e)}finally{_.value=!1,P.value=Math.random()}}}function n(e,t){const r=e.name||"",w=t.name||"",T=e.address||"",H=t.address||"";return r!==w?r.localeCompare(w):T.localeCompare(H)}function s(e){b.setDefaultPrinter(e),m.value=e,P.value=Math.random(),g()}function p(e){return n(e,m.value)===0}function y(e){return e.sort((t,r)=>{const w=p(t),T=p(r);return w&&!T?-1:!w&&T?1:n(t,r)})}return X(async()=>{c(),m.value=await b.getDefaultPrinter()||{},m.value&&(m.value.name||m.value.address)&&(v.value.some(t=>n(t,m.value)===0)||v.value.push(m.value)),g()}),(e,t)=>(f(),h(a(R),{class:ie({loading:_.value})},{default:i(()=>[_.value?(f(),S("div",ke,[o(a(te),{name:"bubbles"}),t[1]||(t[1]=l("div",{class:"loading-text"},"Please wait...",-1))])):x("",!0),o(ce),o(a(W),null,{default:i(()=>[l("div",Se,[t[5]||(t[5]=l("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Printer Management",-1)),o(a(z),null,{default:i(()=>[o(a(O),null,{default:i(()=>t[2]||(t[2]=[k("Use IP Printers")])),_:1,__:[2]}),o(a(ne),{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=r=>u.value=r),onIonChange:d},null,8,["modelValue"])]),_:1}),u.value?x("",!0):(f(),h(a(ae),{key:0},{default:i(()=>[(f(!0),S(se,null,re(v.value,r=>(f(),h(a(z),{key:r.name||r.address||"unknown-printer"},{default:i(()=>[o(a(O),null,{default:i(()=>[k(oe(r.name||r.address||"Unnamed Printer"),1)]),_:2},1024),o(a(J),{size:"small",color:p(r)?"success":"primary",onClick:w=>s(r),disabled:p(r)},{default:i(()=>t[3]||(t[3]=[k(" Set as Default ")])),_:2,__:[3]},1032,["color","onClick","disabled"]),o(a(J),{onClick:w=>a(b).printTestLbl(r),size:"small"},{default:i(()=>t[4]||(t[4]=[k(" Test Print ")])),_:2,__:[4]},1032,["onClick"])]),_:2},1024))),128))]),_:1})),u.value?(f(),h(he,{key:1,style:{"margin-top":"10px"}})):x("",!0)])]),_:1})]),_:1},8,["class"]))}}),Ee=q(Te,[["__scopeId","data-v-94d8d5a1"]]);export{Ee as default};

import{d as Z,cp as H,b2 as ee,ar as ne,r as u,w as te,y as c,f as o,z as l,l as a,u as n,ew as ae,k as m,ap as oe,ah as le,e as w,ak as se,F as re,L as ie,G as ue,I as v,ex as ce,dO as de,es as fe,B as L,bY as ve,V as O,U as W,W as D,A as B,dY as pe,bQ as me,b0 as ye,aZ as ge,m as $,eb as _e,bR as be,bT as ke,cK as we,ey as Ie,an as xe,X as Te}from"./vendor-DL4WTsfb.js";import{S as Y,u as he,P as V,T as Ce,bJ as Se,q as R,bj as Ne,ai as M,W as Pe,bK as De,m as Be,bL as Re,a4 as Ee,_ as Ae}from"./index-Clz-c05R.js";import{i as Fe,a as Le}from"./tasks-CqQsm7KN.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-a8xXIU8b.js";class h extends Y{constructor(){super()}static nextTask(y){return super.getJson("/workflows/".concat(super.getProgramID(),"/").concat(y),{date:super.getSessionDate()})}static async getNextTaskParams(y,C=""){let f=C;try{if(!f){const{name:_}=await h.nextTask(y);f=_}}catch(_){f=""}return{name:f.toLowerCase(),params:{patient_id:y}}}}const Oe={key:1,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},We={class:"ion-page",id:"main"},$e={key:0,class:"placeholder-content"},Ve={style:{margin:"0px auto"},class:"ion-text-center"},Me={key:1},Ye={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}},ze={style:{color:"black"}},Ge=Z({__name:"ARTVisit",setup(Ue){const y=H(),C=he(),{patient:f}=ee(C),_=new V,E=ne(),d=u(-1),I=u(null),r=u([]),A=u([]),b=u(!1),S=u(-1),g=u(""),k=u(""),z=u(""),N=u(!1),x=u(null);function G(t){var e;return A.value.includes((e=t==null?void 0:t.encounterTypeID)!=null?e:0)}function T(t){var e;return t?!b.value&&S.value===(t==null?void 0:t.encounterTypeID)||((e=t==null?void 0:t.otherWorkflowNames)!=null?e:[]).includes(g.value):!1}function U(){if(r.value.length===0||d.value===r.value.length-1)return!1;const t=r.value[d.value];return t&&T(t)}async function K(){const t=await Ne.getEncounters(f.value.patientID,{date:h.getSessionDate()});A.value=t.map(e=>e.encounter_type)}async function F(){var t,e;N.value=(t=Y.isBDE())!=null?t:!1,z.value="",b.value=!0,k.value="",g.value="";try{const i=await h.nextTask(f.value.patientID);if(!i){k.value="No workflows found. You may exit this page or refresh",b.value=!1,d.value=-1;return}g.value=i.name,S.value=(e=i==null?void 0:i.encounter_type_id)!=null?e:-1;const s=r.value.findIndex(p=>{var P;return(p==null?void 0:p.encounterTypeID)===S.value||((P=p.otherWorkflowNames)!=null?P:[]).includes(g.value)});s!==-1||(k.value=g.value?'"'.concat(g.value,'" is not available in the current workflow. Contact your administrator or update ART activity selection'):"No next task found"),d.value=s}catch(i){k.value="An error has occured while loading next task: "+i,console.error(i)}finally{await K(),b.value=!1}}async function J(){d.value=-1,r.value=[];try{const t=M.map(async e=>{if(!(typeof e.disabled=="function"&&e.disabled(M))){if(e.workflowID&&e.component){if(!await Fe(e.workflowID)||!await Le(e.workflowID))return}else return;return e}});r.value=(await Promise.all(t)).filter(e=>e!==void 0),j()}catch(t){R("Unable to load activities"),console.error(t)}}async function j(){if(await Pe.isProp("".concat(De.FILING_NUMBERS,"=true"))){if(_.patient=await V.findByID(f.value.patientID),!/n\/a/i.test(_.getFilingNumber()))return;Be(Ee,{},!1,{title:"New filing number assignment",useComponent:Re,onClose:()=>{Te.dismiss()}})}}function q(){if(N.value)if(x.value){if(!x.value.isProviderSelected()){R("Please select a provider"),x.value.openModal();return}}else{R("BDE Provider component is not available");return}return I.value&&typeof I.value.onSubmit=="function"?I.value.onSubmit():Promise.resolve(!0)}function Q(){q().then(t=>t&&F())}function X(t){if(t<0||t>=r.value.length)return;const e=r.value[t];e&&T(e)&&(d.value=t)}return te(()=>y.fullPath,()=>{J().then(F)},{immediate:!0,deep:!0}),(t,e)=>(o(),c(n(xe),null,{default:l(()=>[a(Ce),a(n(ae),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:l(()=>{var i;return[a(n(oe),{contentId:"main"},{default:l(()=>[a(n(le),null,{default:l(()=>[r.value.length>0?(o(),c(n(se),{key:0},{default:l(()=>[(o(!0),w(re,null,ie(r.value,(s,p)=>(o(),c(n(ue),{onClick:P=>X(p),lines:"none",key:p,disabled:!T(s),button:""},{default:l(()=>[G(s)?(o(),c(n(v),{key:0,icon:n(ce),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):T(s)?(o(),c(n(v),{key:2,icon:n(fe),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(o(),c(n(v),{key:1,icon:n(de),style:{padding:"10px"},slot:"start"},null,8,["icon"])),m("b",null,L(s.name),1)]),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(o(),w("div",Oe,[a(n(v),{style:{"font-size":"2rem"},icon:n(ve)},null,8,["icon"]),e[2]||(e[2]=m("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),a(n(O),null,{default:l(()=>[a(n(W),{color:"light"},{default:l(()=>[a(n(D),{onClick:e[0]||(e[0]=s=>n(E).back())},{default:l(()=>[a(n(v),{icon:n(pe),slot:"start"},null,8,["icon"]),e[3]||(e[3]=B(" Back to dashboard ",-1))]),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),m("div",We,[b.value?(o(),w("div",$e,[m("div",Ve,[a(n(me),{name:"bubbles"}),e[4]||(e[4]=m("p",null,[m("h1",null,"Please wait...")],-1))])])):(i=r.value[d.value])!=null&&i.component?(o(),w("div",Me,[a(n(ye),null,{default:l(()=>[a(n(ge),null,{default:l(()=>{var s;return[N.value?(o(),c(Se,{key:0,ref_key:"bdeProviderComponent",ref:x},null,512)):$("",!0),(o(),c(_e,null,[(o(),c(be((s=r.value[d.value])==null?void 0:s.component),{ref_key:"formRef",ref:I},null,512))],1024))]}),_:1})]),_:1})])):(o(),w("div",Ye,[a(n(v),{style:{color:"green","font-size":"80px"},icon:n(ke)},null,8,["icon"]),m("h2",ze,L(k.value),1),a(n(D),{size:"large",fill:"clear",onClick:e[1]||(e[1]=s=>n(E).back())},{default:l(()=>[a(n(v),{slot:"start",icon:n(we)},null,8,["icon"]),e[5]||(e[5]=B(" Exit page ",-1))]),_:1,__:[5]})])),a(n(O),null,{default:l(()=>[a(n(W),{color:"light"},{default:l(()=>[U()?(o(),c(n(D),{key:0,onClick:Q,color:"primary",style:{padding:"4px"},slot:"end"},{default:l(()=>[e[6]||(e[6]=B(" Save and continue ",-1)),a(n(v),{style:{padding:"4px"},icon:n(Ie),slot:"end"},null,8,["icon"])]),_:1,__:[6]})):$("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),Xe=Ae(Ge,[["__scopeId","data-v-a0dffc3d"]]);export{Xe as default};

System.register(["./index-legacy-Dt4cfYEV.js","./age_groups-legacy-CH396_d_.js","./lodash-legacy-pOOc9Efu.js","./vendor-legacy-Hbu-Y7YT.js","./apexcharts-legacy-Dd_FFT9W.js"],function(e,t){"use strict";var a,r,l,s,u,i,o,n,d,p,g,b,c,v,h,m;return{setters:[e=>{a=e.bT,r=e.c8,l=e.bU,s=e.bS,u=e.bV,i=e.bQ,o=e.bR,n=e.av,d=e.au},e=>{p=e.A},e=>{g=e.l},e=>{b=e.d,c=e.r,v=e.c,h=e.y,m=e.f},null],execute:function(){class t extends a{constructor(){super(),this.programId=r}buildLabPatientLevelData(e){return e.flatMap(e=>e.measures.map(t=>({...e,test_name:t.name,result:`${t.modifier} ${t.value}`})))}buildLabResultRowData(e,t,a){const r=e.filter(e=>e.gender===a&&e.age_group===t).map(({patient_id:e})=>e);return{ageGroup:t,gender:a,viral_load:r}}buildLabDisaggregatedData(e){const t=[],a=[];return p.forEach(r=>{t.push(this.buildLabResultRowData(e,r,"M")),a.push(this.buildLabResultRowData(e,r,"F"))}),[...a,...t]}async getLabResultReport(){const e=await this.getReport("lab_test_results");if(!e)return{};const t=this.buildLabPatientLevelData(e);return{patientLevelData:t,disaggregatedData:this.buildLabDisaggregatedData(t)}}}e("default",b({__name:"LabResultsReport",setup(e){const a=c("-"),r=c(""),p=[l("patient_id")],b=c({}),R=v(()=>g.isEmpty(b.value)?[]:"disaggregated"===r.value?b.value.disaggregatedData:b.value.patientLevelData),D=v(()=>"disaggregated"===r.value?[{path:"ageGroup",label:"Age Group"},{path:"gender",label:"Gender",formatter:s},{path:"viral_load",label:"HIV viral load",drillable:!0}]:[{path:"arv_number",label:"ARV Number",preSort:u,initialSort:!0},{path:"gender",label:"Gender",formatter:s},{path:"birthdate",label:"Birthdate",formatter:i},{path:"order_date",label:"Ordered",formatter:i},{path:"test",label:"Specimen"},{path:"test_name",label:"Test"},{path:"result",label:"Result"},{path:"result_date",label:"Released",formatter:i}]),f=v(()=>[{id:"type",label:"Select report type",required:!1,type:"select",options:[{label:"Disaggregated",value:"disaggregated"},{label:"Patient level",value:"patient_level"}],onUpdate:e=>{r.value=e.value}}]);async function _(e){await n.show();try{const r=new t;r.setStartDate(e.dateRange.startDate),r.setEndDate(e.dateRange.endDate),r.setOccupation(e.occupation),a.value=r.getDateIntervalPeriod(),b.value=await r.getLabResultReport()}catch(r){d("Unable to load report data"),console.error(r)}await n.hide()}return(e,t)=>(m(),h(o,{"report-type":"Clinic",title:"Lab Test Result(s) Report",columns:D.value,rows:R.value,period:a.value,"row-action-buttons":p,"custom-filters":f.value,"use-date-range-filter":"","use-secure-export":"",onGenerate:_},null,8,["columns","rows","period","custom-filters"]))}}))}}});

import{d as F,a$ as V,r as d,c as A,a as R,E as l,e as _,f as b,k as o,l as a,z as n,u as B,G as C,A as x,F as f,L as O,B as H}from"./vendor-BILEn1wR.js";import{u as I,as as M,t as $,a8 as c,E as v,z as L,ay as z,H as G,i as P}from"./index-CIPCnU0Y.js";const W={class:"card-container"},J={class:"custom-card"},j={class:"ion-padding",slot:"content"},q={class:"table-responsive"},Y=F({__name:"RiskAssessment",setup(K,{expose:g}){const S=I(),{patient:Q}=V(S),u=d([]),h=d(P),y=["Substance","Answer","Date","Action"],k={responsive:!0,select:!1,layout:{topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1},w=A(()=>[{componentType:"Heading",name:"Substance use / Consumption",position:"center"},{componentType:"radioButtonField",header:"Smoking",name:"Smoking history",grid:{s:"3"},obsValueType:"value_coded",options:[{label:"Smoking",value:"Smoking"},{label:"Never",value:"Never"},{label:"Stopped",value:"Stopped"}]},{grid:{s:"2"}},{componentType:"radioButtonField",header:"Drinking alcohol",name:"Does the patient drink alcohol?",grid:{s:"3"},obsValueType:"value_coded",options:[{label:"Drinking",value:"Drinking"},{label:"Never",value:"Never"},{label:"Stopped",value:"Stopped"}]}]),r=d(null),D=async()=>{if(!r.value){console.error("Form reference is not available");return}const e=r.value.getFormValues();if(!(e["Smoking history"]&&e["Does the patient drink alcohol?"])){$("Risk assessment not saved");return}const t=await c.obsValuesWithEncounterType(e,v.ASSESSMENT),i=await c.buildObsValues(t);await c.buildSaveObs(i),r.value.resetForm(),L("Risk assessment saved successful"),p()},p=async()=>{const e=await c.getObsByEncounterId(v.ASSESSMENT);if(!e||e.length===0)return[];const t=await Promise.all(e.flatMap(i=>i.obs.map(async s=>[s.concept_name||"",await z.getConceptName(s.value_coded)||"",G.toStandardHisFormat(s.obs_datetime),'<button class="btn btn-outline-danger btn-sm delete-btn" data-id=\''.concat(JSON.stringify(s),"'>\n            ").concat(h.value.delete2,"</button>")])));u.value=t};return R(async()=>{await p()}),g({validateForm:()=>{var e;return(e=r.value)==null?void 0:e.validateForm()},onSubmit:D}),(e,t)=>{const i=l("ion-label"),s=l("DataTable"),T=l("ion-accordion"),E=l("ion-accordion-group"),N=l("ion-row");return b(),_(f,null,[o("div",W,[o("div",J,[a(M,{formData:w.value,ref_key:"formRef",ref:r},null,8,["formData"])])]),a(N,null,{default:n(()=>[a(E,{ref:"accordionGroup",class:"previousView"},{default:n(()=>[a(T,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:n(()=>[a(B(C),{slot:"header",color:"light"},{default:n(()=>[a(i,{class:"previousLabel"},{default:n(()=>t[0]||(t[0]=[x("Previous Visits")])),_:1,__:[0]})]),_:1}),o("div",j,[o("div",q,[a(s,{ref:"dataTableRef",options:k,data:u.value,class:"display nowrap modern-table",width:"100%"},{default:n(()=>[o("thead",null,[o("tr",null,[(b(),_(f,null,O(y,m=>o("th",{key:m},H(m),1)),64))])])]),_:1},8,["data"])])])]),_:1})]),_:1},512)]),_:1})],64)}}});export{Y as _};

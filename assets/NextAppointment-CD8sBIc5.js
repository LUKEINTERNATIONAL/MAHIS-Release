var Dt=Object.defineProperty;var yt=(e,t,o)=>t in e?Dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var Y=(e,t,o)=>yt(e,typeof t!="symbol"?t+"":t,o);import{R as De,d as E,ar as Q,cw as Ie,a0 as Ze,a3 as ue,U as pe,T as ye,as as Te,ac as ne,G as j,S as ge,a9 as re,X as et,a1 as St,a2 as tt,E as h,e as b,f,l as n,z as i,A as O,k as d,F as V,b2 as X,r as N,cl as nt,w as Ee,a as le,n as ot,L as U,B as P,u as _,cz as bt,au as Ct,I as Z,D as F,bz as Mt,ab as me,aa as _e,af as Oe,ba as Nt,aI as wt,m as z,y as J,p as W,b0 as ce,bn as It,bw as xe,aZ as Ae,a_ as st,W as Pe,a$ as ke,c as K,aQ as $t,dr as Ot,aB as at,dE as At,dS as Pt,dT as kt,dU as Lt,cG as Ve,bo as Ft,V as Et,M as fe,J as ve,bS as Tt,bI as xt,dt as Le,ds as Vt,br as Bt,a6 as Ht,aS as Ut}from"./vendor-Oa4k5SKv.js";import{i as se,D as it,aE as Rt,B as Be,aF as zt,x as be,ax as he,k as de,S as B,C as rt,u as q,_ as H,aI as Jt,g as He,F as lt,a8 as Me,H as k,ay as Ue,m as ct,aP as dt,b0 as jt,aR as ut,P as pt,a7 as Gt,t as oe,a2 as ie,a as qt,T as Wt,aM as Qt,bj as Kt,bk as Yt,ak as Xt,N as Zt,aV as ee,A as Ce,bl as en,b as tn,ap as Fe,s as nn,aq as on,p as Je}from"./index-BdhC1is7.js";import{D as sn}from"./DashBox-9Mj3niSm.js";import{B as Ne}from"./BasicForm-B6ipZRal.js";import{p as an}from"./previousDiagnosis-B1Nug-YA.js";import{a as rn}from"./formatServerData-ClxbfvSJ.js";import{v as ln}from"./group_validation-tm_CyvCS.js";import{l as ae}from"./lodash-Dt8AsbQm.js";import{g as cn,a as gt,D as te}from"./drug_prescription_service-CtO8PPzb.js";import{D as Re}from"./drug_service-RcB_GVA0.js";import{A as dn}from"./ncd_appointment_service-DlLsT7ZK.js";import{D as un}from"./DateInputField-CI9dtAgA.js";const je=De("NCDDiagnosisStore",{state:()=>({diagnosis:[{selectedData:[],isFinishBtn:!1,data:{rowData:[{colData:[{inputHeader:"Diagnosis",icon:se.search,value:"",name:"diagnosis",eventType:"input",required:!0,alertsErrorMassage:"",isSingleSelect:!0,trackBy:"concept_id",valueType:"coded",multiSelectData:[],id:"",validationFunctionName:"required"}]}]}}]}),actions:{setDiagnosis(e){this.diagnosis=e}}}),pn=E({name:"Menu",components:{IonContent:re,IonHeader:ge,IonItem:j,IonList:ne,IonMenu:Te,IonTitle:ye,IonToolbar:pe,IonInput:ue,IonPopover:Ze,DashBox:sn,SelectionPopover:zt,BasicInputField:Be,List:Rt,BasicForm:Ne,DynamicButton:it,previousDiagnosis:an,DataTable:Ie},data(){return{iconsContent:se,no_item:!1,search_item:!1,display_item:!1,addItemButton:!0,selectedText:"",conditionStatus:"",data:[],diagnosisData:[],popoverOpen:!1,event:"",selectedCondition:""}},setup(){return{checkmark:tt,pulseOutline:St}},computed:{...Q(je,["diagnosis"]),...Q(q,["patient"])},async mounted(){await this.getDiagnosis("")},methods:{async getDiagnosis(e){let t;B.getModsStatus()||B.getUseIndexDBStatus()?t=await rt("diagnosis",{likeClause:e?{name:"%".concat(e,"%")}:"",currentPage:1,itemsPerPage:20}).then(o=>o.records):t=await B.getJson("diagnosis",{id:7409,page_size:10}),be(this.diagnosis,"diagnosis","multiSelectData",t)},dismiss(){et.dismiss()},async addNewRow(){var e,t,o;if(await ln(this.diagnosis)){be(this.diagnosis,"diagnosis","alertsErrorMassage","");const a=await rn(this.diagnosis),s=JSON.parse(JSON.stringify(this.patient));(o=(t=(e=s.diagnosis)!=null?e:s.diagnosis={}).unsaved)!=null||(t.unsaved=[]),s.diagnosis.unsaved.push(...a),await he(s),de("Diagnosis successfully saved"),this.dismiss()}else be(this.diagnosis,"diagnosis","alertsErrorMassage","Please select diagnosis from the list")},updateDiagnosisStores(){je().setDiagnosis(this.diagnosis)},async handleInputData(e){be(this.diagnosis,"diagnosis","alertsErrorMassage","")}}}),gn={class:"modal_wrapper"},mn={class:""};function _n(e,t,o,a,s,l){const r=h("ion-title"),c=h("ion-icon"),p=h("ion-header"),u=h("basic-form"),g=h("ion-content"),m=h("DynamicButton"),D=h("ion-col"),w=h("ion-row"),C=h("ion-footer");return f(),b(V,null,[n(p,{style:{display:"flex","justify-content":"space-between"}},{default:i(()=>[n(r,{class:"modalTitle"},{default:i(()=>t[2]||(t[2]=[O("Add Diagnosis")])),_:1,__:[2]}),n(c,{onClick:t[0]||(t[0]=M=>e.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:e.iconsContent.cancel},null,8,["icon"])]),_:1}),n(g,{fullscreen:!0,style:{"--background":"#fff"}},{default:i(()=>[d("div",gn,[d("div",mn,[n(u,{contentData:e.diagnosis,onSearchChange:e.getDiagnosis,"onUpdate:inputValue":e.handleInputData},null,8,["contentData","onSearchChange","onUpdate:inputValue"])])])]),_:1}),n(C,{collapse:"fade",class:"ion-no-border"},{default:i(()=>[n(w,null,{default:i(()=>[n(D,null,{default:i(()=>[n(m,{onClick:t[1]||(t[1]=M=>e.addNewRow()),name:"Save",fill:"solid",style:{float:"right",margin:"2%",width:"130px"}})]),_:1})]),_:1})]),_:1})],64)}const hn=H(pn,[["render",_n],["__scopeId","data-v-b6148238"]]),fn={class:"table-responsive"},vn=E({__name:"Diagnosis",setup(e){const t=Jt(),o=q(),{diagnosis:a}=X(t),{patient:s}=X(o),l=N(null),r=N([]),c=N(se),p=["Diagnosis","Date","Action"],u={responsive:!0,select:!1,layout:{topStart:"buttons",topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1,buttons:[{text:" <b>+ Add diagnosis </b>",className:"add-test text-white",action:async()=>{await g()}}]},g=async()=>{await He(hn,{class:"lab-results-modal"},!0),await w()},m=async M=>M.length>0?await Promise.all(M.map(async A=>{const $=await Me.getConceptName(A.value_coded),S=A.obs_datetime;return[$,k.toStandardHisFormat(S),'<button class="btn btn-outline-danger btn-sm delete-btn" data-id=\''.concat(JSON.stringify({id:A.obs_id,value_coded:A.value_coded,name:$,obs_date:S}),"'>").concat(c.value.delete2,"</button>")]})):[],D=async(M,A)=>{var S;if(await lt("Do you want to delete ".concat(M.name," ?"),A)){const v=JSON.parse(JSON.stringify(s.value)),y=v.diagnosis;M!=null&&M.id?(y.saved=y.saved.filter(I=>!(I.value_coded===M.value_coded&&I.obs_datetime===M.obs_date)),(S=y.voided)!=null||(y.voided=[]),y.voided.push(M)):y.unsaved=y.unsaved.filter(I=>!(I.value_coded===M.value_coded&&I.obs_datetime===M.obs_date)),await he(v)}},w=async()=>{var $,S;const M=JSON.parse(JSON.stringify(s.value)),A=[...(($=M==null?void 0:M.diagnosis)==null?void 0:$.unsaved)||[],...((S=M==null?void 0:M.diagnosis)==null?void 0:S.saved)||[]];r.value=await m(A),Ie.use(bt)},C=nt();return Ee(()=>C,async()=>{await w()},{deep:!0}),Ee(()=>s,async()=>{await w()},{deep:!0}),le(async()=>{await w(),ot(()=>{const M=l.value.dt;M.columns.adjust().draw(),M.on("click",".delete-btn",A=>{const $=A.target.getAttribute("data-id");D(JSON.parse($),A)})})}),(M,A)=>(f(),b("div",fn,[n(_(Ie),{ref_key:"dataTableRef",ref:l,options:u,data:r.value,class:"display nowrap",width:"100%"},{default:i(()=>[d("thead",null,[d("tr",null,[(f(),b(V,null,U(p,$=>d("th",{key:$},P($),1)),64))])])]),_:1},8,["data"])]))}}),zs=H(vn,[["__scopeId","data-v-a9f02349"]]),Ge=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"Visual acuity test",data:{rowData:[{colData:[{inputHeader:"Left Eye",value:"",name:"Left eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"},{inputHeader:"Right Eye",value:"",name:"Right eye visual acuity",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,validationFunctionName:"",valueType:"text"}]}]}}],qe=[{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Peripheral neuropathy"},data:[{name:"Neuropathy/PVO",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Deformity"},data:[{name:"Deformities",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}},{selectedData:[],classDash:"dashed_bottom_border",groupedRadioBtnContent:{groupedData:[{header:{selectedValue:"",name:"Ulcers"},data:[{name:"Ulcers",labelPlacement:"start",colSize:"3",justify:"space-between",header:!0,headClassName:"bold"},{name:"Yes",value:"Yes",checked:!1,colSize:"3",justify:"end"},{name:"No",value:"No",checked:!1,colSize:"3",justify:"end"}]}]}}],We=[{isFinishBtn:!1,validationStatus:"",sectionHeader:"CV Risk %",data:{rowData:[{colData:[{inputHeader:"",value:"",name:"CVD",required:!0,eventType:"input",alertsErrorMassage:"",disabled:!1,valueType:"text",validationFunctionName:"isNumber"}]}]}}],Dn=De("complicationsStore",{state:()=>({visualScreening:[...Ge],FootScreening:[...qe],cvScreening:[...We]}),actions:{setCvScreening(e){this.cvScreening=e},setVisualScreening(e){this.visualScreening=e},setFootScreening(e){this.FootScreening=e},getInitialCvScreening(){return[...ae.cloneDeep(We)]},getInitialVisualScreening(){return[...ae.cloneDeep(Ge)]},getInitialFootScreening(){return[...ae.cloneDeep(qe)]},resetScreening(){this.setCvScreening(this.getInitialCvScreening()),this.setFootScreening(this.getInitialFootScreening()),this.setVisualScreening(this.getInitialVisualScreening())}},persist:!0}),yn={class:"sub_item_body"},Sn={class:"ion-padding",slot:"content"},bn={class:"table-responsive"},Cn=E({__name:"ComplicationsScreening",setup(e){Ct();const t=Dn(),{FootScreening:o,visualScreening:a,cvScreening:s}=X(t),l=q(),{patient:r}=X(l);nt();const c=N(null),p=N([]);N(!1),N(!1),N("");const u=N("");N({btnColor:"secondary",btnName:"No risk"});const g=N(se),m=["Condition","Result","Date","Action"],D={responsive:!0,select:!1,layout:{topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1},w=async()=>{var S,v;const A=JSON.parse(JSON.stringify(r.value)),$=[...((S=A==null?void 0:A.screening)==null?void 0:S.unsaved)||[],...((v=A==null?void 0:A.screening)==null?void 0:v.saved)||[]];p.value=await C($)},C=async A=>A.length===0?[]:(await Promise.all(A.map(async S=>S.concept_name==="Visual acuity"?S.children.map(v=>[v.concept_name,v.value_text,k.toStandardHisFormat(v.obs_datetime),'<button class="btn btn-outline-danger btn-sm delete-btn" data-id=\''.concat(JSON.stringify(v),"'>\n                        ").concat(g.value.delete2,"</button>")]):S.concept_name==="Foot check"?Promise.all(S.children.map(async v=>[v.concept_name,await Ue.getConceptName(v.value_coded),k.toStandardHisFormat(v.obs_datetime),'<button class="btn btn-outline-danger btn-sm delete-btn" data-id=\''.concat(JSON.stringify(v),"'>\n                            ").concat(g.value.delete2,"</button>")])):S.concept_name==="Cardiovascular disease"?[["CVD %",S.value_text,k.toStandardHisFormat(S.obs_datetime),'<button class="btn btn-outline-danger btn-sm delete-btn" data-id=\''.concat(JSON.stringify(S),"'>\n                            ").concat(g.value.delete2,"</button>")]]:[]))).flat(),M=A=>{console.log("🚀 ~ voidScreening ~ data:",A)};return le(async()=>{await w(),ot(()=>{const A=c.value.dt;A.columns.adjust().draw(),A.on("click",".delete-btn",$=>{const S=$.target.getAttribute("data-id");M(JSON.parse(S))})})}),(A,$)=>{const S=h("ion-label"),v=h("ion-accordion"),y=h("ion-accordion-group"),I=h("ion-row");return f(),b(V,null,[n(Ne,{contentData:_(a)},null,8,["contentData"]),n(_(ne),null,{default:i(()=>[n(_(j),{lines:u.value,class:"dashed_bottom_border textSectionFormat"},{default:i(()=>$[0]||($[0]=[d("span",{style:{display:"flex","align-items":"center",gap:"10px"}}," Foot screening ",-1)])),_:1,__:[0]},8,["lines"]),d("div",yn,[n(Ne,{contentData:_(o)},null,8,["contentData"])])]),_:1}),n(Ne,{contentData:_(s)},null,8,["contentData"]),n(I,null,{default:i(()=>[n(y,{ref:"accordionGroup",class:"previousView"},{default:i(()=>[n(v,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(_(j),{slot:"header",color:"light"},{default:i(()=>[n(S,{class:"previousLabel"},{default:i(()=>$[1]||($[1]=[O("Previous Visits")])),_:1,__:[1]})]),_:1}),d("div",Sn,[d("div",bn,[n(_(Ie),{ref_key:"dataTableRef",ref:c,options:D,data:p.value,class:"display nowrap",width:"100%"},{default:i(()=>[d("thead",null,[d("tr",null,[(f(),b(V,null,U(m,L=>d("th",{key:L},P(L),1)),64))])])]),_:1},8,["data"])])])]),_:1})]),_:1},512)]),_:1})],64)}}}),Js=H(Cn,[["__scopeId","data-v-127f623c"]]),mt=(e,t,o,a={})=>({drug_id:e,name:t,category:o,...a}),$e=De("OtherNCDMedicationsStore",{state:()=>({otherNCDMedications:[],selectedOtherNCDMedicationList:[]}),actions:{setSelectedNCDMedicationList(e){this.selectedOtherNCDMedicationList.push(e)},getSelectedNCDMedicationList(){return this.selectedOtherNCDMedicationList},addSearchedDrug(e){const t=mt(e.drug_id,e.name,"Other",e);if(t.units=e.units,!this.otherNCDMedications.some(a=>a.drug_id===t.drug_id)){this.otherNCDMedications.unshift(t);const a={dosage:{morning:null,afternoon:null,evening:null},duration:null,...t};this.setSelectedNCDMedicationList(a)}},clearOtherNCDMedications(){this.otherNCDMedications=[],this.selectedOtherNCDMedicationList=[]}},persist:!0}),G=De("NCDmedicationsStore",{state:()=>({medications:[],filteredMedications:[],selectedNCDMedicationList:[],frequency_selections:N({}),currentPatientID:""}),actions:{setMedications(e){this.medications=e,this.filteredMedications=e},setFilteredMedications(e){this.filteredMedications=e},initMedications(){},setSelectedNCDMedicationList(e){this.selectedNCDMedicationList.push(e)},getSelectedNCDMedicationList(){return this.selectedNCDMedicationList},clearMedicationDataStores(){this.medications=[],this.filteredMedications=[],this.selectedNCDMedicationList=[],this.frequency_selections=[]},setCurrentPatientID(e){this.currentPatientID=e}},persist:!0});function Mn(){try{const e=G(),t=$e();e.medications=[...t.otherNCDMedications,...e.medications],e.medications=e.medications.reduce((o,a)=>(o.some(s=>s.drug_id===a.drug_id)||o.push(a),o),[]),e.selectedNCDMedicationList=[...t.selectedOtherNCDMedicationList,...e.selectedNCDMedicationList],e.filteredMedications=e.medications,de("Medication added successfully")}catch(e){}}const Nn={name:"DiabetesMedication",ids:[337,336,280,410,729,263,812,265,264,240,266,726,728,223]},Qe={name:"AntiHypertensivesMedication",ids:[]},wn={ids:[274,168,648,289,286,164,287,288,672,257,1233,671]},In={ids:[559,1236,1234,558,1235,1211,276,277,278,279]},$n={ids:[556,653,557,652,943,1238,1240,1237,942,1239,946,1503,944,1504,945,1505]},On={ids:[116,85,117,1232,936,1364,937,1365,1366]};async function _t(e){const t=G(),o=e.ids.map(async a=>{try{const s=await Re.getOfflineDrugById(a);if(s){const l=t.medications.findIndex(c=>c.drug_id===s.drug_id),r=mt(s.drug_id,s.name,e.name,s);l!==-1?t.medications[l]=r:t.medications.push(r)}}catch(s){console.error("Error fetching drug ID ".concat(a,":"),s)}});return t.filteredMedications=t.medications,Promise.all(o)}async function An(e){try{const t=await Re.getOfflineDrugById(e);return{drug_id:e,dosage:{morning:null,afternoon:null,evening:null},duration:null,...t}}catch(t){ct("Error fetching drug details. Please try again."),console.error("Error fetching drug details:",t)}}function Ke(){return _t(Nn)}function Ye(){return Qe.ids=[...wn.ids,...In.ids,...$n.ids,...On.ids],_t(Qe)}function we(){G().clearMedicationDataStores()}function ht(e){G().setCurrentPatientID(e)}function Pn(e){G().currentPatientID!=e&&(we(),ht(e))}function js(){return G().selectedNCDMedicationList.some(t=>{const{morning:o,afternoon:a,evening:s}=t.dosage,l=typeof o=="string"?Number(o):o,r=typeof a=="string"?Number(a):a,c=typeof s=="string"?Number(s):s;return typeof l=="number"&&l>0||typeof r=="number"&&r>0||typeof c=="number"&&c>0})}class kn extends dt{constructor(t,o){super(t,105,o)}}class Ln extends dt{constructor(t,o){super(t,25,o)}static async get_____(t="",o=1,a=10){}}async function Gs(e){var t,o,a;try{const s=q(),{patient:l}=X(s),r=JSON.parse(JSON.stringify(l.value));(a=(o=(t=r.allergies)!=null?t:r.allergies={}).unsaved)!=null||(o.unsaved=[]),r.allergies.unsaved.push(...e),await he(r),de("Allergies saved successfully")}catch(s){oe("Unable to save Allegies!")}}class qs{async onSubmitNotes(t,o,a){const s=new kn(t,o);await s.createEncounter(),await s.saveObservationList(a)}async onSubmitAllergies(t,o,a){try{const s=new Ln(t,o);await s.createEncounter(),await s.saveObservationList(a),de("Allergies saved successfully")}catch(s){console.error("Error saving allergies:",s),oe("Failed to save allergies")}}}class ze{constructor(){Y(this,"programID");Y(this,"providerID");Y(this,"patientID");Y(this,"date");Y(this,"demographics");Y(this,"previousDrugPrescriptions",[]);Y(this,"previousClinicalNotes");Y(this,"previousDrugAllergies");const t=q();this.demographics=t.patient,this.patientID=this.demographics.patientID,this.date=Me.getSessionDate(),this.providerID=B.getUserID(),this.programID=Me.getProgramID(),this.previousClinicalNotes={},this.previousDrugAllergies={}}async getPatientEncounters(){const t=await this.getPatientVisitDates(),o=t.map(async s=>{const l=s.value,r=await jt.getEncounters(this.patientID,{date:l});await Promise.all(r.map(async c=>{var p;if(c.type.name=="NOTES"){const{observations:u}=c;ae.isEmpty(u)||u.forEach(g=>{if(g.concept_id=="2688"){const m=k.toStandardHisDisplayFormat(g.obs_datetime);ae.isEmpty(this.previousClinicalNotes.hasOwnProperty(m))&&(this.previousClinicalNotes[m]=[]),this.previousClinicalNotes[m].push({date:m,notes:g.value_text})}})}if(c.type.name=="TREATMENT"){const{observations:u}=c;if(!ae.isEmpty(u))for(const g in u){let m="<UNKNOWN CONCEPT>";const D=u[g];try{(p=D==null?void 0:D.concept)!=null&&p.concept_names?m=D.concept.concept_names[0].name:m=await Ue.getConceptName(D.concept_id)}catch(M){console.error(D,M)}const w=await Me.resolvePrimaryValue(D),C=k.toStandardHisDisplayFormat(D.date_created);m=="Allergic"&&(this.previousDrugAllergies.hasOwnProperty(C)||(this.previousDrugAllergies[C]=[]),this.previousDrugAllergies[C].push({date:C,value:w}))}}}))});await Promise.all(o);const a=t.map(async s=>{const l=await ut.getOrderByPatient(this.patientID,{start_date:s.value});if(!ae.isEmpty(l)){const r=l.map(c=>({drugName:c.drug.name,value:k.toStandardHisTimeFormat(c.order.start_date),dose:c.dose,frequency:cn(c.frequency),prescription:k.toStandardHisFormat(c.order.auto_expire_date),duration:Fn(c.order.instructions),other:c}));this.previousDrugPrescriptions.push({prescriptionDate:k.toStandardHisDisplayFormat(s.value),previousPrescriptions:r})}});return await Promise.all(a),{previousDrugPrescriptions:this.previousDrugPrescriptions,previousClinicalNotes:this.previousClinicalNotes,previousDrugAllergies:this.previousDrugAllergies}}async getPatientVisitDates(){return(await pt.getPatientVisits(this.patientID,!1)).map(t=>({label:k.toStandardHisDisplayFormat(t),value:t,other:{isActive:t===Gt.getSessionDate()}}))}}function Fn(e){const t=/(\d+)\s+days/i,o=e.match(t);return o&&o.length>1?parseInt(o[1]):null}async function En(){const e=q(),{patient:t}=X(e),o=t.value,a=[8809,903,6410,6409];let s;B.getModsStatus()||B.getUseIndexDBStatus()?s=await rt("diagnosis",{likeClause:"",currentPage:1,itemsPerPage:2e3}).then(m=>m.records):s=await B.getJson("diagnosis",{id:7409,page_size:2e3});const l=s.filter(m=>a.includes(m.concept_id)),r=o.diagnosis.saved.map(m=>m.value_coded),c=o.diagnosis.unsaved.map(m=>m.value_coded),p=[...r,...c];return l.filter(m=>p.includes(m.concept_id)).map(m=>m.name)}const Tn=E({name:"Home",components:{IonContent:re,IonHeader:ge,IonMenuButton:Nt,IonPage:Oe,IonTitle:ye,IonToolbar:pe,IonRow:_e,IonCol:me,IonChip:Mt,IonLabel:F,IonIcon:Z},computed:{...Q(q,["patient"])},data(){const e=N([]),t=N([]),o=async()=>{try{const l=this.patient;ht(l.ID);const r=N(!1),c=g=>{r.value=g};e.value=await En();const p=e.value.some(g=>g.toLowerCase().includes("hypertension")),u=e.value.some(g=>g.toLowerCase().includes("diabetes"));p&&(c(!0),Ye()),u&&(c(!0),Ke()),r.value==!1}catch(l){}},a=async()=>{const l=t.value.some(c=>c.toLowerCase().includes("hypertension")),r=t.value.some(c=>c.toLowerCase().includes("diabetes"));l&&await Ye(),r&&await Ke()};return{diagnoses:e,selectedDiagnoses:t,medkitOutline:wt,initC:o,toggleDiagnosisSelection:l=>{const r=t.value.indexOf(l);r===-1?(t.value.push(l),we(),a()):(t.value.splice(r,1),we(),a()),t.value.length===0&&(we(),o())}}},async mounted(){this.initC()},watch:{patient:{handler(){Pn(this.patient.ID),this.initC()},deep:!0}}}),xn={key:0,class:"diagnosis-container"},Vn={class:"heading"},Bn={class:"diagnosis-list"};function Hn(e,t,o,a,s,l){const r=h("ion-icon"),c=h("ion-label"),p=h("ion-chip"),u=h("ion-col"),g=h("ion-row");return e.diagnoses.length>0?(f(),b("div",xn,[d("div",Vn,[n(r,{icon:e.medkitOutline,class:"diagnosis-icon"},null,8,["icon"]),t[0]||(t[0]=d("h2",null,"Diagnosis",-1))]),n(g,null,{default:i(()=>[n(u,null,{default:i(()=>[d("div",Bn,[(f(!0),b(V,null,U(e.diagnoses,(m,D)=>(f(),J(p,{key:D,class:W({"diagnosis-chip-selected":e.selectedDiagnoses.includes(m)}),onClick:w=>e.toggleDiagnosisSelection(m)},{default:i(()=>[n(c,null,{default:i(()=>[O(P(m),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})])):z("",!0)}const Un=H(Tn,[["render",Hn],["__scopeId","data-v-2bd0f8ca"]]),Rn=E({name:"MedicationSearch",components:{IonContent:re,IonPage:Oe,IonItem:j,IonLabel:F,IonInput:ue,IonIcon:Z,BasicInputField:Be,IonCard:ce},setup(){const e=N(""),t=G();return{searchText:e,searchTextUpdated:a=>{const s=a.target;e.value=s.value;const l=t.medications.filter(r=>r.name.toLowerCase().includes(e.value.toLowerCase()));t.setFilteredMedications(l)},searchOutline:It}}});function zn(e,t,o,a,s,l){const r=h("BasicInputField"),c=h("ion-card");return f(),b("div",null,[d("div",null,[n(c,null,{default:i(()=>[n(r,{placeholder:"Filter medication list by name",icon:e.searchOutline,inputValue:e.searchText,"onUpdate:inputValue":e.searchTextUpdated,minHeight:50},null,8,["icon","inputValue","onUpdate:inputValue"])]),_:1})])])}const Jn=H(Rn,[["render",zn]]),jn=E({name:"medication",components:{IonCard:ce,IonCardHeader:ke,IonButton:Pe,IonCardTitle:st,IonCardContent:Ae,IonInput:ue,IonIcon:Z,IonCol:me,IonRow:_e,IonCheckbox:xe,PreviousNCDDiagnosis:Un,MedicationSearchInput:Jn},computed:{...Q(G,["medications","filteredMedications"]),...Q($e,["otherNCDMedications"]),activeMedications(){return this.useDefaultStores?this.filteredMedications:this.otherNCDMedications}},props:{useDefaultStores:{type:Boolean,default:!0}},setup(e){const t=G();t.initMedications();const o=K(()=>t.selectedNCDMedicationList),a=$e(),s=K(()=>a.selectedOtherNCDMedicationList),l=K(()=>e.useDefaultStores?o.value:s.value),r=N(!1),c=N({});let p=null;const u=()=>{r.value=!1,p&&(clearTimeout(p),p=null)},g=v=>{c.value={...c.value,[v]:!0},r.value=!0,p&&clearTimeout(p),p=window.setTimeout(()=>{r.value=!1,p=null},3e3),window.setTimeout(()=>{const y={...c.value};delete y[v],c.value=y},3e3)},m=v=>/^\d*$/.test(v),D=(v,y,I)=>{let L=I.target.value;const R="".concat(v,"-").concat(y);if(L!==""&&!m(L)){g(R);const x=l.value.find(Se=>Se.drug_id===v);L=(x==null?void 0:x.dosage[y])||"",setTimeout(()=>{const Se=I.target;Se&&(Se.value=L)},0);return}if(L!==""){const x=parseInt(L);isNaN(x)||x<0?L="0":L=Math.floor(x).toString()}const T=l.value.findIndex(x=>x.drug_id===v);if(T>-1){const x={...l.value[T]};x.dosage={...x.dosage,[y]:L},l.value[T]=x}},w=(v,y)=>{let I=y.target.value;const L="".concat(v,"-duration");if(I!==""&&!m(I)){g(L);const T=l.value.find(x=>x.drug_id===v);I=(T==null?void 0:T.duration)||"",setTimeout(()=>{const x=y.target;x&&(x.value=I)},0);return}if(I!==""){const T=parseInt(I);isNaN(T)||T<1?I="1":I=Math.floor(T).toString()}const R=l.value.findIndex(T=>T.drug_id===v);if(R>-1){const T={...l.value[R]};T.duration=I,l.value[R]=T}},C=v=>l.value.some(y=>y.drug_id===v);return{medkit:Ve,sunny:Lt,partlySunny:kt,moon:Pt,timeOutline:At,alertCircleOutline:at,closeCircleOutline:Ot,updateDosage:D,updateDuration:w,getDosage:(v,y)=>{const I=l.value.find(L=>L.drug_id===v);return(I==null?void 0:I.dosage[y])||""},getDuration:v=>{const y=l.value.find(I=>I.drug_id===v);return(y==null?void 0:y.duration)||""},calculateQuantity:v=>{const y=l.value.find(R=>R.drug_id===v);if(!y||!y.dosage||!y.duration)return"";const I=["morning","afternoon","evening"].reduce((R,T)=>{const x=parseInt(y.dosage[T])||0;return R+x},0),L=parseInt(y.duration)||0;return(I*L).toString()},isActive:C,toggleMedication:async v=>{try{if(C(v)){const y=l.value.findIndex(I=>I.drug_id===v);y>-1&&l.value.splice(y,1)}else{const y=await An(v);e.useDefaultStores==!1?a.setSelectedNCDMedicationList(y):t.setSelectedNCDMedicationList(y)}}catch(y){ct("Error toggling medication: "+y)}},cubeOutline:$t,showErrorMessage:r,errorFields:c,hideErrorMessage:u}}}),Gn={key:0},qn={key:0,class:"error-message"},Wn={class:"table-container"},Qn={class:"prescription-table"},Kn={class:"checkbox-col"},Yn={style:{cursor:"pointer"}},Xn=["onClick"];function Zn(e,t,o,a,s,l){const r=h("PreviousNCDDiagnosis"),c=h("ion-col"),p=h("MedicationSearchInput"),u=h("ion-row"),g=h("ion-icon"),m=h("ion-button"),D=h("ion-checkbox"),w=h("ion-input");return f(),b(V,null,[n(u,null,{default:i(()=>[n(c,{size:"5"},{default:i(()=>[e.useDefaultStores?(f(),J(r,{key:0})):z("",!0)]),_:1}),n(c,null,{default:i(()=>[e.useDefaultStores&&e.medications.length>0?(f(),J(p,{key:0,style:{"margin-top":"0px","font-weight":"600","font-size":"16px"}})):z("",!0)]),_:1})]),_:1}),e.activeMedications.length>0?(f(),b("div",Gn,[e.showErrorMessage?(f(),b("div",qn,[n(g,{icon:e.alertCircleOutline,color:"danger"},null,8,["icon"]),t[0]||(t[0]=d("span",{style:{"font-size":"16px","font-weight":"600px",color:"red"}},"Only numbers are allowed",-1)),n(m,{fill:"clear",size:"small",onClick:e.hideErrorMessage},{default:i(()=>[n(g,{icon:e.closeCircleOutline},null,8,["icon"])]),_:1},8,["onClick"])])):z("",!0),d("div",Wn,[d("table",Qn,[d("thead",null,[d("tr",null,[t[6]||(t[6]=d("th",{class:"checkbox-col"},"Select",-1)),t[7]||(t[7]=d("th",null,"Medication",-1)),d("th",null,[n(g,{icon:e.partlySunny},null,8,["icon"]),t[1]||(t[1]=O(" Morning"))]),d("th",null,[n(g,{icon:e.sunny},null,8,["icon"]),t[2]||(t[2]=O(" Noon"))]),d("th",null,[n(g,{icon:e.moon},null,8,["icon"]),t[3]||(t[3]=O(" Night"))]),d("th",null,[n(g,{icon:e.timeOutline},null,8,["icon"]),t[4]||(t[4]=O(" Duration"))]),d("th",null,[n(g,{icon:e.cubeOutline},null,8,["icon"]),t[5]||(t[5]=O(" Quantity"))])])]),d("tbody",null,[(f(!0),b(V,null,U(e.activeMedications,C=>(f(),b("tr",{key:C.id,class:W({"active-row":e.isActive(C.drug_id)})},[d("td",Kn,[n(D,{checked:e.isActive(C.drug_id),onIonChange:M=>e.toggleMedication(C.drug_id)},null,8,["checked","onIonChange"])]),d("td",Yn,[d("span",{class:"med-kit-font",onClick:M=>e.toggleMedication(C.drug_id)},P(C.name),9,Xn)]),d("td",null,[n(w,{type:"text",class:W(["dose-input bordered-input med-kit-font",{"error-input":e.errorFields["".concat(C.drug_id,"-morning")]}]),disabled:!e.isActive(C.drug_id),value:e.getDosage(C.drug_id,"morning"),onIonInput:M=>e.updateDosage(C.drug_id,"morning",M),placeholder:"0",inputmode:"numeric"},null,8,["class","disabled","value","onIonInput"])]),d("td",null,[n(w,{type:"text",class:W(["dose-input bordered-input med-kit-font",{"error-input":e.errorFields["".concat(C.drug_id,"-afternoon")]}]),disabled:!e.isActive(C.drug_id),value:e.getDosage(C.drug_id,"afternoon"),onIonInput:M=>e.updateDosage(C.drug_id,"afternoon",M),placeholder:"0",inputmode:"numeric"},null,8,["class","disabled","value","onIonInput"])]),d("td",null,[n(w,{type:"text",class:W(["dose-input bordered-input med-kit-font",{"error-input":e.errorFields["".concat(C.drug_id,"-evening")]}]),disabled:!e.isActive(C.drug_id),value:e.getDosage(C.drug_id,"evening"),onIonInput:M=>e.updateDosage(C.drug_id,"evening",M),placeholder:"0",inputmode:"numeric"},null,8,["class","disabled","value","onIonInput"])]),d("td",null,[n(w,{type:"text",class:W(["dose-input bordered-input med-kit-font",{"error-input":e.errorFields["".concat(C.drug_id,"-duration")]}]),disabled:!e.isActive(C.drug_id),value:e.getDuration(C.drug_id),onIonInput:M=>e.updateDuration(C.drug_id,M),placeholder:"0",inputmode:"numeric"},null,8,["class","disabled","value","onIonInput"])]),d("td",null,[n(w,{type:"text",class:"dose-input bordered-input med-kit-font",readonly:"",value:e.calculateQuantity(C.drug_id),placeholder:"0"},null,8,["value"])])],2))),128))])])])])):z("",!0)],64)}const ft=H(jn,[["render",Zn],["__scopeId","data-v-601894a0"]]),eo=E({name:"DrugSelector",components:{IonContent:re,IonHeader:ge,IonItem:j,IonList:ne,IonMenu:Te,IonTitle:ye,IonToolbar:pe,IonInput:ue,IonPopover:Ze,VueMultiselect:Ft,IonLabel:F,IonCol:me,IonRow:_e},emits:["drug-selected"],data(){const e=s=>{this.$emit("drug-selected",s)},t=async s=>{const l=ie(),r=s,g=(await Re.getOfflineOPDDrugs({name:r,page:1,page_size:20})).map(m=>({label:m.name,value:m.name,other:m,...m}));l.setPartialOPDdrugList(g)},o=K(()=>this.partialOPDdrugList);return{selected_drug:N(null),selectedDrugName:e,FindDrugName:t,OPDDrugList:o}},computed:{...Q(ie,["partialOPDdrugList"])}});function to(e,t,o,a,s,l){const r=h("VueMultiselect"),c=h("ion-col"),p=h("ion-row");return f(),b("div",null,[n(p,null,{default:i(()=>[n(c,null,{default:i(()=>[n(r,{modelValue:e.selected_drug,"onUpdate:modelValue":[t[0]||(t[0]=u=>e.selected_drug=u),e.selectedDrugName],multiple:!1,taggable:!1,"hide-selected":!1,"close-on-select":!0,openDirection:"bottom","tag-placeholder":"Select medication",placeholder:"Select medication",selectLabel:"",label:"name",searchable:!0,onSearchChange:e.FindDrugName,"track-by":"uuid",options:e.OPDDrugList},null,8,["modelValue","onUpdate:modelValue","onSearchChange","options"])]),_:1})]),_:1})])}const no=H(eo,[["render",to],["__scopeId","data-v-e4d309dd"]]),oo=E({name:"Home",mixins:[qt],components:{IonContent:re,IonHeader:ge,IonPage:Oe,IonToolbar:pe,IonRow:_e,IonTitle:ye,IonIcon:Z,IonFooter:Et,OPDMedications:no,Medication:ft,IonCol:me,IonButton:Pe},data(){const e=$e(),t=()=>{et.dismiss()};return{iconsContent:se,dismiss:t,addSearchedDrug:s=>{e.addSearchedDrug(s)},medkit:Ve,checkmark:tt,onAdd:()=>{Mn(),e.clearOtherNCDMedications(),t()}}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){},methods:{}}),so={class:"medication-list"},ao={class:"modal_wrapper"},io={class:""};function ro(e,t,o,a,s,l){const r=h("ion-icon"),c=h("ion-title"),p=h("ion-header"),u=h("OPDMedications"),g=h("Medication"),m=h("ion-content"),D=h("ion-button"),w=h("ion-col"),C=h("ion-row"),M=h("ion-footer");return f(),b(V,null,[n(p,{style:{display:"flex","justify-content":"space-between"}},{default:i(()=>[n(c,{class:"modalTitle"},{default:i(()=>[d("div",so,[n(r,{icon:e.medkit,class:"ion-margin-end"},null,8,["icon"]),t[1]||(t[1]=d("span",null,"Add Other Medication",-1))])]),_:1}),n(r,{onClick:t[0]||(t[0]=A=>e.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:e.iconsContent.cancel},null,8,["icon"])]),_:1}),n(m,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:i(()=>[d("div",ao,[d("div",io,[n(u,{onDrugSelected:e.addSearchedDrug},null,8,["onDrugSelected"]),n(g,{"use-default-stores":!1})])])]),_:1}),n(M,{collapse:"fade",class:"ion-no-border"},{default:i(()=>[n(C,null,{default:i(()=>[n(w,null,{default:i(()=>[n(D,{onClick:e.onAdd,color:"primary",style:{float:"right","margin-bottom":"20px","margin-right":"20px"}},{default:i(()=>[n(r,{icon:e.checkmark,slot:"start"},null,8,["icon"]),t[2]||(t[2]=O(" Add "))]),_:1,__:[2]},8,["onClick"])]),_:1})]),_:1})]),_:1})],64)}const lo=H(oo,[["render",ro],["__scopeId","data-v-dee50533"]]),co=E({created(){},components:{IonItem:j,IonCol:me,IonLabel:F,IonIcon:Z},data(){return{iconsContent:se,localMedicalDrugsList:[...this.$props._selectedMedicalDrugsList]}},props:{_selectedMedicalDrugsList:{type:Array,default:[]},show_actions_buttons:{type:Boolean,default:!0},highLightBackground:{type:String,default:"item-native"}},watch:{},methods:{highlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#006401"),this.highlightActionBtns(e)},undoHighlightItem(e){const t=document.getElementById(e+"_lbl");t&&(t.style.color="#636363"),this.undohighlightActionBtns(e)},highlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let o=0;o<t.length;o++)t[o].style.display="inline-block"},undohighlightActionBtns(e){const t=document.getElementsByClassName(e+"_spanlbl");for(let o=0;o<t.length;o++)t[o].style.display="none"},asignLblID(e){return e+"_lbl"},asignSpanLblID(e){return e+"_spanlbl"},async removeItemAtIndex(e,t){await lt("Do you want to delete it?",t)&&this.$emit("remove-item",e)},editItemAtIndex(e){this.$emit("edit-item",e)},highLightBnd(e){if(e){if(e.highlightbackground!==void 0&&e.highlightbackground==!0)return this.$props.highLightBackground}else return!1}}}),uo=["onMousemove","onMouseout"],po={class:"route-label"};function go(e,t,o,a,s,l){const r=h("ion-label"),c=h("ion-col"),p=h("ion-row"),u=h("ion-icon");return f(!0),b(V,null,U(e.localMedicalDrugsList,(g,m)=>(f(),b("div",{id:"df",class:"medication-item",key:m,onMousemove:D=>e.highlightItem(m),onMouseout:D=>e.undoHighlightItem(m)},[n(p,{class:"medication-header"},{default:i(()=>[n(c,{class:W(["ion-text-wrap",e.highLightBnd(g)])},{default:i(()=>[n(r,{id:e.asignLblID(m),class:"medication-name"},{default:i(()=>[O(P(g.drugName),1)]),_:2},1032,["id"])]),_:2},1032,["class"])]),_:2},1024),n(p,{class:"medication-details"},{default:i(()=>[n(c,{size:"10",class:W(["ion-text-wrap details-col",e.highLightBnd(g)])},{default:i(()=>[n(r,{class:"details-text"},{default:i(()=>[O(P(g.dose)+" / "+P(g.frequency)+" / daily / "+P(g.duration)+" / until "+P(g.prescription)+" ",1),d("span",po,P(g.route_name),1)]),_:2},1024)]),_:2},1032,["class"]),e.show_actions_buttons?(f(),J(c,{key:0,class:W([e.highLightBnd(g),"actions-col"]),size:"2"},{default:i(()=>[n(r,{class:W(["action-button",e.asignSpanLblID(m)]),onClick:D=>e.editItemAtIndex(m)},{default:i(()=>[n(u,{icon:e.iconsContent.edit},null,8,["icon"])]),_:2},1032,["class","onClick"]),n(r,{class:W(["action-button",e.asignSpanLblID(m)]),onClick:D=>e.removeItemAtIndex(m,D)},{default:i(()=>[n(u,{icon:e.iconsContent.delete},null,8,["icon"])]),_:2},1032,["class","onClick"])]),_:2},1032,["class"])):z("",!0)]),_:2},1024)],40,uo))),128)}const mo=H(co,[["render",go],["__scopeId","data-v-01c693a3"]]),_o=E({name:"Home",components:{IonContent:re,IonHeader:ge,IonPage:Oe,IonToolbar:pe,Toolbar:Wt,IonRow:_e,IonAccordion:ve,IonAccordionGroup:fe,IonItem:j,IonLabel:F,DynamicList:mo,IonCard:ce},data(){const e=N(0),t=N("Show more medications"),o=N(!1),a=N();return{componentKey:e,accordionGroupChange:c=>{const p=c.detail.value;p!==void 0?p=="second"&&(t.value="Show less medications",o.value=!o.value):(t.value="Show more medications",o.value=!o.value)},showMoreMedicationsMsg:t,itemWasExpanded:o,accordionGroupChangeFn1:c=>{},PreviuosSelectedMedicalDrugsList:a,loadPreviousMedications:async()=>{const c=new ze,{previousDrugPrescriptions:p}=await c.getPatientEncounters();a.value=p}}},computed:{...Q(q,["patient"]),...Q(G,["selectedNCDMedicationList"])},$route:{async handler(){},deep:!0},watch:{patient:{handler(){this.loadPreviousMedications()},deep:!0},selectedNCDMedicationList:{handler(){this.loadPreviousMedications()},deep:!0}},async mounted(){this.loadPreviousMedications()}}),ho={style:{}},fo={class:"ion-padding",slot:"content"},vo={key:0},Do={class:"previousSecDrgs"},yo={class:"ion-padding",slot:"content"},So={key:0},bo={class:"previousSecDrgs"};function Co(e,t,o,a,s,l){const r=h("ion-label"),c=h("ion-item"),p=h("dynamic-list"),u=h("ion-accordion"),g=h("ion-accordion-group"),m=h("ion-card");return f(),J(m,null,{default:i(()=>[d("div",ho,[n(g,{ref:"accordionGroup",class:"previousView",onIonChange:e.accordionGroupChangeFn1},{default:i(()=>[n(u,{value:"first","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(c,{slot:"header",color:"light"},{default:i(()=>[n(r,{class:"previousLabel"},{default:i(()=>t[0]||(t[0]=[O("Documented medications timeline")])),_:1,__:[0]})]),_:1}),d("div",fo,[(f(!0),b(V,null,U(e.PreviuosSelectedMedicalDrugsList,(D,w)=>(f(),b("div",{class:"ionLbltp",key:w},[w==0?(f(),b("div",vo,[d("div",null,[n(r,{class:"previousLabelDate"},{default:i(()=>[O(P(D.prescriptionDate),1)]),_:2},1024)]),d("div",Do,[(f(),J(p,{_selectedMedicalDrugsList:D.previousPrescriptions,show_actions_buttons:!1,key:e.componentKey},null,8,["_selectedMedicalDrugsList"]))])])):z("",!0)]))),128)),n(g,{onIonChange:e.accordionGroupChange},{default:i(()=>[n(u,{value:"second","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(c,{slot:"header",color:"light"},{default:i(()=>[n(r,{class:"",color:"primary"},{default:i(()=>[O(P(e.showMoreMedicationsMsg),1)]),_:1})]),_:1}),d("div",yo,[(f(!0),b(V,null,U(e.PreviuosSelectedMedicalDrugsList,(D,w)=>(f(),b("div",{class:"ionLbltp",key:w},[e.itemWasExpanded&&w>0?(f(),b("div",So,[d("div",null,[n(r,{class:"previousLabelDate"},{default:i(()=>[O(P(D.prescriptionDate),1)]),_:2},1024)]),d("div",bo,[(f(),J(p,{_selectedMedicalDrugsList:D.previousPrescriptions,show_actions_buttons:!1,key:e.componentKey},null,8,["_selectedMedicalDrugsList"]))])])):z("",!0)]))),128))])]),_:1})]),_:1},8,["onIonChange"])])]),_:1})]),_:1},8,["onIonChange"])])]),_:1})}const Mo=H(_o,[["render",Co],["__scopeId","data-v-1db96250"]]),No=E({name:"PrescriptionTable",components:{IonCard:ce,IonCardHeader:ke,IonButton:Pe,IonCardTitle:st,IonCardContent:Ae,IonInput:ue,IonIcon:Z,IonCol:me,IonRow:_e,IonCheckbox:xe,Medication:ft,MedicationHistory:Mo},setup(){return{openAddOtherOPDMedicationModal:async()=>{await He(lo,{class:"large-modal"},!0,{})},medkit:Ve}}});function wo(e,t,o,a,s,l){const r=h("Medication"),c=h("ion-icon"),p=h("ion-button"),u=h("ion-col"),g=h("ion-row"),m=h("MedicationHistory"),D=h("IonCol"),w=h("ion-card-content"),C=h("ion-card");return f(),J(C,null,{default:i(()=>[n(w,null,{default:i(()=>[n(r),n(g,null,{default:i(()=>[n(u,null,{default:i(()=>[n(p,{onClick:e.openAddOtherOPDMedicationModal,color:"primary",style:{float:"right"}},{default:i(()=>[n(c,{icon:e.medkit,slot:"start"},null,8,["icon"]),t[0]||(t[0]=d("span",{style:{"margin-left":"10px","font-size":"16px","font-weight":"600"}}," ADD Other Medication",-1))]),_:1,__:[0]},8,["onClick"])]),_:1})]),_:1}),n(g,null,{default:i(()=>[n(D,null,{default:i(()=>[n(m)]),_:1})]),_:1})]),_:1})]),_:1})}const Io=H(No,[["render",wo],["__scopeId","data-v-a4ad7088"]]),$o={key:0,class:"custom-allergy-container"},Oo=E({watch:{},name:"AllergiesComponent"}),Ao=E({...Oo,setup(e){const t=Qt(),o=q(),a=K(()=>t.selectedMedicalAllergiesList),s=K(()=>o.patient),l=K(()=>t.medicalAllergiesList),r=N(M(8,"item-")),c=N(),p=N(!1),u=[{multi_Selection:!0,show_list_label:!0,unqueId:r.value,name_of_list:"Add/Remove allergies",placeHolder:"Search for an allergy",items:[],listUpdatedFN:D,listFilteredFN:()=>{},searchTextFN:w,use_internal_filter:!0,show_error:N(!1),error_message:"please select a User",disabled:N(!1)}],g=N(!1);le(async()=>{m()});const m=()=>{t.current_patient.ID!=s.value.ID&&(t.clearSelectedMedicalAllergiesList(),t.setCurrentPatient(s.value))};function D($){$.forEach(S=>{S.selected==!0&&S.name==="Other"&&(p.value=S.name==="Other")}),t.setSelectedMedicalAllergiesList($),C()}async function w($){const S=$,v=await Ue.getConceptSet("OPD Medication",S);v.map(R=>({label:R.name,value:R.name,other:R}));const y=Kt(S),L=Yt(y,v).sort((R,T)=>R.name.localeCompare(T.name));t.setMedicalAllergiesList(L),C()}function C(){const $=l.value;a.value.forEach(v=>{let y=!1;$.forEach((I,L)=>{I.concept_id==v.concept_id&&v.selected===!0&&($[L]=v,y=!0)}),!y&&v.selected===!0&&$.push(v)});const S=$.filter((v,y,I)=>y===I.findIndex(L=>L.concept_id===v.concept_id));t.setMedicalAllergiesList(S)}function M($=8,S=""){const v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let y=S;for(let I=0;I<$;I++)y+=v.charAt(Math.floor(Math.random()*v.length));return y+="-".concat(Date.now()),y}async function A($){try{const S=$.trim();if(S){const v={name:S,selected:!0};t.setMedicalAllergiesList([...l.value,v]),t.setSelectedMedicalAllergiesList(v),p.value=!1,g.value=!0,c.value="";const y=t.findSelectedAllergyByName("Other");t.removeSelectedAllergy(y)}}catch(S){console.error(S)}}return($,S)=>(f(),J(_(ce),null,{default:i(()=>[n(_(ke),null,{default:i(()=>[n(_(F),{class:"header-container"},{default:i(()=>[n(_(Z),{icon:_(at),class:"allergy-icon"},null,8,["icon"]),S[2]||(S[2]=d("span",{style:{"font-size":"16px","font-weight":"600"}}," Allergies (Medication, Healthcare items, Environment and Food) ",-1))]),_:1,__:[2]})]),_:1}),n(_(Ae),null,{default:i(()=>[n(Xt,{multiSelection:u[0].multi_Selection,show_label:u[0].show_list_label,uniqueId:u[0].unqueId,name_of_list:u[0].name_of_list,choose_place_holder:u[0].placeHolder,"items_-list":l.value,use_internal_filter:u[0].use_internal_filter,disabled:u[0].disabled.value,onItemListUpDated:u[0].listUpdatedFN,onItemListFiltered:u[0].listFilteredFN,onItemSearchText:u[0].searchTextFN},null,8,["multiSelection","show_label","uniqueId","name_of_list","choose_place_holder","items_-list","use_internal_filter","disabled","onItemListUpDated","onItemListFiltered","onItemSearchText"]),p.value?(f(),b("div",$o,[n(_(ue),{modelValue:c.value,"onUpdate:modelValue":S[0]||(S[0]=v=>c.value=v),placeholder:"Please specify the allergy",fill:"outline",class:"custom-input"},null,8,["modelValue"]),n(_(Pe),{onClick:S[1]||(S[1]=v=>A(c.value)),class:"addCustomAllergyBtn"},{default:i(()=>S[3]||(S[3]=[O(" Add Allergy ")])),_:1,__:[3]})])):z("",!0)]),_:1})]),_:1}))}}),Po=H(Ao,[["__scopeId","data-v-8aa98f55"]]),ko=De("nonPharmaTherapyStore",{state:()=>({items:[{id:"wound-dressing",label:"Wound dressing",checked:!1},{id:"patient-education",label:"Patient education",checked:!1},{id:"counseling",label:"Counseling",checked:!1},{id:"minor-surgery",label:"Minor Surgery",checked:!1}],current_patient:{}}),actions:{async saveNonPharmaTherapyPatientData(){const e=Zt(),t=[];this.items.forEach(o=>{o.checked==!0&&t.push({concept_id:11023,value_coded:2592,value_text:JSON.stringify(o),obs_datetime:k.toStandardHisFormat(B.getSessionDate()),location_id:e.facilityLocation.code})});try{t.length>0&&Lo(t)}catch(o){oe("Unable to update Non Pharma Therapy!")}this.clearSelectednonPharmaTherapyStore()},clearSelectednonPharmaTherapyStore(){this.items.forEach(e=>{e.checked=!1})},setCurrentPatient(e){this.current_patient=e}},persist:!0});async function Lo(e){var t,o,a;try{const s=q(),{patient:l}=X(s),r=JSON.parse(JSON.stringify(l.value));(a=(o=(t=r.notes)!=null?t:r.notes={}).unsaved)!=null||(o.unsaved=[]),r.notes.unsaved.push(...e),await he(r),de("Non Pharma Therapy has been saved")}catch(s){oe("Unable to create non pharmalogical notes!")}}const Fo={class:"checklist-container"},Eo=E({watch:{},name:"xxxComponent"}),To=E({...Eo,setup(e){const t=q(),o=K(()=>t.patient),a=ko(),s=a.items;le(async()=>{l()});const l=()=>{a.current_patient.ID!=o.value.ID&&(a.clearSelectednonPharmaTherapyStore(),a.setCurrentPatient(o.value))};return Ee(()=>o.value,async r=>{}),(r,c)=>(f(),b("div",Fo,[(f(!0),b(V,null,U(_(s),p=>(f(),J(_(j),{key:p.id,class:"no-border"},{default:i(()=>[n(_(xe),{id:p.id,modelValue:p.checked,"onUpdate:modelValue":u=>p.checked=u,slot:"start"},null,8,["id","modelValue","onUpdate:modelValue"]),n(_(F),{style:{"font-size":"16px","font-weight":"600"}},{default:i(()=>[O(P(p.label),1)]),_:2},1024)]),_:2},1024))),128))]))}}),xo=H(To,[["__scopeId","data-v-371e920f"]]),Vo={style:{"margin-top":"14px","margin-left":"10px"}},Bo={class:"ion-padding",slot:"content"},Ho={key:0},Uo={class:"previousSecDrgs"},Ro={class:"ion-padding",slot:"content"},zo={class:"previousSecDrgs"},Jo=E({watch:{},name:"xxxComponent"}),jo=E({...Jo,setup(e){const t=N(),o=N(),a=N(!1),s=N(!1),l=N("Show more notes");le(async()=>{const p=new ze,{previousClinicalNotes:u}=await p.getPatientEncounters();t.value=Object.entries(u)[0];const[,...g]=Object.entries(u);o.value=g});function r(p){const u=p.detail.value;u!==void 0?u=="third"&&(l.value="Show less notes",s.value=!a.value):(l.value="Show more notes",s.value=!a.value)}function c(p){return p[1]}return(p,u)=>(f(),J(_(ce),null,{default:i(()=>[d("div",Vo,[n(_(fe),{ref:"accordionGroup",class:"previousView"},{default:i(()=>[n(_(ve),{value:"fourth","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(_(j),{slot:"header",color:"light"},{default:i(()=>[n(_(F),{class:"previousLabel"},{default:i(()=>u[0]||(u[0]=[O("Previous visits notes")])),_:1,__:[0]})]),_:1}),d("div",Bo,[(f(!0),b(V,null,U(t.value,(g,m)=>(f(),b("div",{class:"ionLbltp",key:m},[m==1?(f(),b("div",Ho,[(f(!0),b(V,null,U(g,(D,w)=>(f(),b("div",{key:w},[d("div",null,[n(_(F),{class:"previousLabelDate"},{default:i(()=>[O(P(D.date),1)]),_:2},1024)]),d("div",Uo,[n(_(ne),null,{default:i(()=>[n(_(F),{class:"notes_p"},{default:i(()=>[O(P(D.notes),1)]),_:2},1024)]),_:2},1024)])]))),128))])):z("",!0)]))),128)),n(_(fe),{onIonChange:r},{default:i(()=>[n(_(ve),{value:"third","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(_(j),{slot:"header",color:"light"},{default:i(()=>[n(_(F),{class:"",color:"primary"},{default:i(()=>[O(P(l.value),1)]),_:1})]),_:1}),d("div",Ro,[(f(!0),b(V,null,U(o.value,(g,m)=>(f(),b("div",{class:"ionLbltp",key:m},[(f(!0),b(V,null,U(c(g),(D,w)=>(f(),b("div",{key:w},[d("div",null,[n(_(F),{class:"previousLabelDate"},{default:i(()=>[O(P(D.date),1)]),_:2},1024)]),d("div",zo,[n(_(ne),null,{default:i(()=>[n(_(F),{class:"notes_p"},{default:i(()=>[O(P(D.notes),1)]),_:2},1024)]),_:2},1024)])]))),128))]))),128))])]),_:1})]),_:1})])]),_:1})]),_:1},512)])]),_:1}))}}),Go=H(jo,[["__scopeId","data-v-994df42d"]]),qo={style:{"margin-top":"14px","margin-left":"10px"}},Wo=E({watch:{},name:"xxxComponent"}),Qo=E({...Wo,setup(e){const t=ie(),o=se,a=K(()=>t.nonPharmalogicalTherapyAndOtherNotes);function s(r){let c=r.target.value;l(c)}function l(r){ie().setNonPharmalogicalTherapyAndOtherNotes(r)}return(r,c)=>(f(),J(_(ce),null,{default:i(()=>[n(_(ke),null,{default:i(()=>[n(_(F),{class:"tpStndCls"},{default:i(()=>[n(_(Z),{icon:_(Tt),class:"header-icon","aria-hidden":"true"},null,8,["icon"]),c[1]||(c[1]=O(" Non-pharmalogical therapy and other notes "))]),_:1,__:[1]})]),_:1}),n(_(Ae),null,{default:i(()=>[d("div",null,[n(xo),n(_(j),{class:"input_item",style:{"min-height":"120px","margin-top":"14px"}},{default:i(()=>[n(_(F),null,{default:i(()=>[n(_(Z),{slot:"start",icon:_(o).editPen,"aria-hidden":"true"},null,8,["icon"])]),_:1}),n(_(xt),{onIonInput:s,modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=p=>a.value=p),style:{"min-height":"120px"},class:"inputTpln","auto-grow":!0,fill:"outline"},null,8,["modelValue"])]),_:1})]),d("div",qo,[n(Go)])]),_:1})]),_:1}))}}),Ko=H(Qo,[["__scopeId","data-v-fd19ec21"]]),Yo={class:"ion-padding",slot:"content"},Xo={key:0},Zo={class:"previousSecDrgs"},es={class:"ion-padding",slot:"content"},ts={class:"previousSecDrgs"},ns=E({watch:{},name:"xxxComponent"}),os=E({...ns,setup(e){const t=N(!1),o=N(!1),a=N("Show more allergies"),s=N(),l=N();le(async()=>{const p=new ze,{previousDrugAllergies:u}=await p.getPatientEncounters();s.value=Object.entries(u)[0];const[,...g]=Object.entries(u);l.value=g});function r(p){const u=p.detail.value;u!==void 0?u=="fith"&&(a.value="Show less allegies",o.value=!t.value):(a.value="Show more allegies",o.value=!t.value)}function c(p){return p[1]}return(p,u)=>{const g=h("ion-card");return f(),J(g,null,{default:i(()=>[n(_(fe),{ref:"accordionGroup",class:"previousView"},{default:i(()=>[n(_(ve),{value:"fourth","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(_(j),{slot:"header",color:"light"},{default:i(()=>[n(_(F),{class:"previousLabel"},{default:i(()=>u[0]||(u[0]=[O("Documented allergies timeline")])),_:1,__:[0]})]),_:1}),d("div",Yo,[(f(!0),b(V,null,U(s.value,(m,D)=>(f(),b("div",{class:"ionLbltp",key:D},[D==1?(f(),b("div",Xo,[d("div",null,[n(_(F),{class:"previousLabelDate"},{default:i(()=>[O(P(m[0].date),1)]),_:2},1024)]),(f(!0),b(V,null,U(m,(w,C)=>(f(),b("div",{key:C},[d("div",Zo,[n(_(ne),null,{default:i(()=>[n(_(F),{class:"notes_p"},{default:i(()=>[O(P(w.value),1)]),_:2},1024)]),_:2},1024)])]))),128))])):z("",!0)]))),128)),n(_(fe),{onIonChange:r},{default:i(()=>[n(_(ve),{value:"fith","toggle-icon-slot":"start",style:{"border-radius":"10px","background-color":"#fff"}},{default:i(()=>[n(_(j),{slot:"header",color:"light"},{default:i(()=>[n(_(F),{class:"",color:"primary"},{default:i(()=>[O(P(a.value),1)]),_:1})]),_:1}),d("div",es,[(f(!0),b(V,null,U(l.value,(m,D)=>(f(),b("div",{class:"ionLbltp",key:D},[d("div",null,[n(_(F),{class:"previousLabelDate"},{default:i(()=>[O(P(m[0]),1)]),_:2},1024)]),(f(!0),b(V,null,U(c(m),(w,C)=>(f(),b("div",{key:C},[d("div",ts,[n(_(ne),null,{default:i(()=>[n(_(F),{class:"notes_p"},{default:i(()=>[O(P(w.value),1)]),_:2},1024)]),_:2},1024)])]))),128))]))),128))])]),_:1})]),_:1})])]),_:1})]),_:1},512)]),_:1})}}}),ss=H(os,[["__scopeId","data-v-358c5959"]]),as={class:"background"},is={key:0},rs={style:{margin:"10px"}},ls={key:1},cs={style:{margin:"10px"}},ds={key:2},us={style:{margin:"10px"}},ps=E({__name:"TreatmentPlan",setup(e){const t=N(["medications","allergies","other_notes"]),o=N(t.value[0]);le(()=>{a(t.value[0])});function a(s){o.value=s}return(s,l)=>(f(),b("div",as,[n(_(Vt),{value:o.value,style:{"margin-top":"5px"}},{default:i(()=>[n(_(Le),{value:"medications",onClick:l[0]||(l[0]=r=>a(t.value[0]))},{default:i(()=>[n(_(F),null,{default:i(()=>l[3]||(l[3]=[O("Medications")])),_:1,__:[3]})]),_:1}),n(_(Le),{value:"allergies",onClick:l[1]||(l[1]=r=>a(t.value[1]))},{default:i(()=>[n(_(F),null,{default:i(()=>l[4]||(l[4]=[O("Allergies")])),_:1,__:[4]})]),_:1}),n(_(Le),{value:"other_notes",onClick:l[2]||(l[2]=r=>a(t.value[2]))},{default:i(()=>[n(_(F),null,{default:i(()=>l[5]||(l[5]=[O("Non-pharmalogical therapy and other notes")])),_:1,__:[5]})]),_:1})]),_:1},8,["value"]),o.value===t.value[0]?(f(),b("div",is,[d("div",rs,[n(Io)])])):z("",!0),o.value===t.value[1]?(f(),b("div",ls,[d("div",cs,[n(Po),n(ss,{style:{"margin-top":"10px"}})])])):z("",!0),o.value===t.value[2]?(f(),b("div",ds,[d("div",us,[n(Ko)])])):z("",!0)]))}}),Ws=H(ps,[["__scopeId","data-v-d844be41"]]);async function Qs(){var e,t,o;try{const a=q(),{patient:s}=X(a),l=ms(),r=JSON.parse(JSON.stringify(s.value));if(l.length>0){(o=(t=(e=r.MedicationOrder)!=null?e:r.MedicationOrder={}).unsaved)!=null||(t.unsaved=[]);const c=r.MedicationOrder.unsaved.findIndex(u=>u.NCD_Drug_Orders);if(c>=0)r.MedicationOrder.unsaved[c].NCD_Drug_Orders=[...r.MedicationOrder.unsaved[c].NCD_Drug_Orders,...l];else{const u={NCD_Drug_Orders:l};r.MedicationOrder.unsaved.push(u)}await he(r),G().clearMedicationDataStores(),de("Drug order(s) has been created")}else oe("Unable to create drug orders!")}catch(a){oe("Unable to create drug orders!")}}function Xe(){try{const e=new Date(B.getSessionDate()),o=ie().selectedMedicalDrugsList;let a=0;if(o.forEach(u=>{const g=parseInt(u.duration,10);!isNaN(g)&&g>a&&(a=g)}),a<=0)return{date:null,formattedDate:null};const s=new Date(e);s.setDate(e.getDate()+a);const l=String(s.getDate()).padStart(2,"0"),r=String(s.getMonth()+1).padStart(2,"0"),c=s.getFullYear(),p="".concat(l,"/").concat(r,"/").concat(c);return{date:s,formattedDate:p}}catch(e){return console.error("Error calculating OPD medication run out date:",e),{date:null,formattedDate:null}}}function gs(){try{const e=new Date(B.getSessionDate()),o=G().selectedNCDMedicationList;let a=0;if(o.forEach(u=>{const g=parseInt(u.duration,10);!isNaN(g)&&g>a&&(a=g)}),a<=0)return{date:null,formattedDate:null};const s=new Date(e);s.setDate(e.getDate()+a);const l=String(s.getDate()).padStart(2,"0"),r=String(s.getMonth()+1).padStart(2,"0"),c=s.getFullYear(),p="".concat(l,"/").concat(r,"/").concat(c);return{date:s,formattedDate:p}}catch(e){return console.error("Error calculating medication run out date:",e),{date:null,formattedDate:null}}}const ms=()=>{const e=G();return e.selectedNCDMedicationList.map(t=>{t.frequency=e.frequency_selections[t.drug_id]||"",t.totalDosage=Object.values(t.dosage).reduce((s,l)=>s+Number(l),0);const o=gt.getSessionDate(),a=fs(t.drug_id);return{drug_inventory_id:t.drug_id,equivalent_daily_dose:t.totalDosage=="Unknown"?0:t.totalDosage*(a==null?void 0:a.value)||0,start_date:o,auto_expire_date:vt(o,t.duration),units:t.units,instructions:"".concat(t.name," ").concat(t.totalDosage," ").concat(t.units," ").concat((a==null?void 0:a.code)||""," for ").concat(t.duration," days"),dose:_s(t),frequency:(a==null?void 0:a.code)||""}})},_s=e=>e.dose_strength!=null&&e.dose_strength?Math.trunc(e.dose_strength):1;async function Ks(){var e,t,o;try{const a=q(),{patient:s}=X(a),l=hs(),r=JSON.parse(JSON.stringify(s.value));if(l.length>0){(o=(t=(e=r.MedicationOrder)!=null?e:r.MedicationOrder={}).unsaved)!=null||(t.unsaved=[]);const c=r.MedicationOrder.unsaved.findIndex(u=>u.NCD_Drug_Orders);if(c>=0)r.MedicationOrder.unsaved[c].NCD_Drug_Orders=[...r.MedicationOrder.unsaved[c].NCD_Drug_Orders,...l];else{const u={NCD_Drug_Orders:l};r.MedicationOrder.unsaved.push(u)}await he(r),ie().clearSelectedMedicalDrugsList(),de("Drug order(s) has been created")}else oe("Unable to create drug orders!")}catch(a){oe("Unable to create drug orders!")}}const hs=()=>ie().selectedMedicalDrugsList.map(t=>{const o=gt.getSessionDate(),a=te.find(s=>s.label===t.frequency)||{};return{drug_inventory_id:t.drug_id,equivalent_daily_dose:t.dose=="Unknown"?0:t.dose*(a==null?void 0:a.value)||0,start_date:o,auto_expire_date:vt(o,t.duration),units:t.units,instructions:"".concat(t.drugName,": ").concat(t.dose," ").concat(t.units," ").concat((a==null?void 0:a.code)||""," for ").concat(t.duration," days"),dose:t.dose,frequency:(a==null?void 0:a.code)||""}}),fs=e=>{const o=G().selectedNCDMedicationList.find(s=>s.drug_id===e);if(!o||!o.dosage)return null;switch(["morning","afternoon","evening"].reduce((s,l)=>s+(o.dosage[l]?1:0),0)){case 1:return o.dosage.morning?te.find(s=>s.code==="QAM"):o.dosage.afternoon?te.find(s=>s.code==="QNOON"):o.dosage.evening?te.find(s=>s.code==="QPM"):te.find(s=>s.code==="OD");case 2:return te.find(s=>s.code==="BD");case 3:return te.find(s=>s.code==="TDS");default:return te.find(s=>s.code==="Unknown")}},vt=(e,t)=>{const o=new Date(e);return o.setDate(o.getDate()+parseInt(t)),k.toStandardHisFormat(o)},vs=E({components:{IonContent:re,IonHeader:ge,IonItem:j,IonList:ne,IonMenu:Te,IonTitle:ye,IonToolbar:pe,BasicInputField:Be,IonDatetime:Ht,IonBadge:Bt,DateInputField:un,DynamicButton:it},setup(){const e=Fe(),t=N(0),o=K(()=>e.getDisabledDates()),a=K(()=>e.getAssignedAppointments()),s=N();return{disabledDates:o,datesCounts:a,appointment_count:t,calendarOutline:Ut,inputPRDate:s}},data(){return ee(),Je(),{iconsContent:se,date:new Date(B.getSessionDate()),tomorrow:new Date(B.getSessionDate()).getDate()+1,appointment:"",drugRunoutDate:"",nextAppointmentDate:"",minDate:new Date(B.getSessionDate())}},computed:{...Q(ee,["nextAppointment","appointmentCountsCache","currentSelectedNextAppointmentDate"]),...Q(Fe,["maximumNumberOfDaysForEachDay","assignedAppointmentsDates"]),...Q(q,["patient"]),...Q(Je,["activeProgram"]),calendarDate(){const e=ee();return e.currentSelectedNextAppointmentDate?k.toStandardHisDisplayFormat(e.currentSelectedNextAppointmentDate):""},runOutDate(){var e;return((e=this.activeProgram)==null?void 0:e.program_id)===14?Xe():gs()}},watch:{calendarDate:{handler(){this.updateNextAppointment()},deep:!0},"$service.sessionDate":{handler(){this.updateMinDate()},immediate:!0},"patient.ID":{async handler(e,t){e!==t&&(this.cleanCurrentNextAppointmentDate(),this.checkIfSamePatientInContext())}}},async mounted(){this.checkIfSamePatientInContext(),await this.getAppointmentMents(this.runOutDate.date),await nn().loadGlobalProperty(),this.validateAppointmentCountsCache(),on();const e=B.getUserID(),t=new pt;this.appointment=new Ce(t.getID(),e),this.nextAppointmentDate=this.appointment.date,this.supposedRunOutDate(),window.addEventListener("storage",this.handleStorageChange),Xe()},beforeUnmount(){window.removeEventListener("storage",this.handleStorageChange)},methods:{handleStorageChange(e){e.key==="sessionDate"&&this.updateMinDate()},updateMinDate(){this.date=new Date(B.getSessionDate()),this.minDate=new Date(B.getSessionDate())},updateNextAppointment(){ee().setNextAppointment(this.calendarDate)},async handleDateUpdate(e){e&&(Fe().setsssignedAppointmentsDates(e,!0),this.calendarDate=k.toStandardHisDisplayFormat(e),await this.save(),await this.getAppointmentMents(e),await this.updateAppointmentCache(e),ee().setCurrentSelectedNextAppointmentDate(e,this.patient.ID))},async getAppointmentMents(e){if(tn().apiStatus)try{const o=await Ce.getDailiyAppointments(k.toStandardHisFormat(e),k.toStandardHisFormat(e));this.appointment_count=o.length}catch(o){}},getCounter(e){const t=k.toStandardHisFormat(e);return this.appointmentCountsCache[t]||""},async save(){if(this.assignedAppointmentsDates.length>0)try{const t=await new dn().createOfflineAppointment()}catch(e){}},async openCornfirmModal(e){this.calendarDate=k.toStandardHisDisplayFormat(e),await this.getAppointmentMents(e),He(en,{class:"otherVitalsModal"},!0,{message:"Are you sure you want to add this Appointment?"},{cancel:s=>{},confirm:async s=>{s.detail==!0&&await this.handleDateUpdate(e)}})},async handleInput(e){this.inputPRDate=k.toStandardHisDisplayFormat(e),await this.openCornfirmModal(e)},async supposedRunOutDate(){await ut.getLastDrugsReceived(this.patient.patientID)},async preloadAppointmentCounts(){try{const e=new Date(B.getSessionDate());e.setDate(1);const t=new Date(B.getSessionDate());t.setMonth(t.getMonth()+2),t.setDate(0);const o=this.generateDateRange(e,t);for(const a of o)try{const s=await Ce.getDailiyAppointments(k.toStandardHisFormat(a),k.toStandardHisFormat(a)),l=k.toStandardHisFormat(a);this.appointmentCountsCache[l]=s.length}catch(s){console.error("Error fetching appointments for ".concat(a,":"),s);const l=k.toStandardHisFormat(a);this.appointmentCountsCache[l]=0}}catch(e){console.error("Error in preload process:",e)}},generateDateRange(e,t){const o=[],a=new Date(e);for(;a<=t;)o.push(new Date(a)),a.setDate(a.getDate()+1);return o},async updateAppointmentCache(e){try{const t=k.toStandardHisFormat(e),o=await Ce.getDailiyAppointments(k.toStandardHisFormat(e),k.toStandardHisFormat(e));this.appointmentCountsCache[t]=o.length}catch(t){console.error("Error updating appointment cache:",t)}},validateAppointmentCountsCache(){ee().checkCurrentLocationIfInContext()},isRunOutDate(e){return!this.runOutDate||!this.runOutDate.date?!1:k.toStandardHisFormat(e)===k.toStandardHisFormat(this.runOutDate.date)},cleanCurrentNextAppointmentDate(){ee().cleanCurrentSelectedNextAppointmentDate()},checkIfSamePatientInContext(){const e=ee();e.current_patient.ID!=this.patient.ID&&(this.cleanCurrentNextAppointmentDate(),e.setCurrentPatient(this.patient))}}}),Ds={class:"card_content"},ys={class:"count-badge"},Ss={class:"dates_title"},bs={class:"sub_data"},Cs={class:"dates_title"},Ms={class:"sub_data"},Ns={class:"dates_title"},ws={class:"sub_data"},Is={class:"dates_title"},$s={class:"sub_data"};function Os(e,t,o,a,s,l){const r=h("VueDatePicker"),c=h("ion-col"),p=h("DynamicButton"),u=h("ion-item"),g=h("ion-row"),m=h("DateInputField");return f(),b("div",Ds,[n(g,null,{default:i(()=>[n(c,{"size-sm":"12","size-md":"12","size-lg":"12","size-xl":"8"},{default:i(()=>[n(r,{class:"calender",onDateUpdate:e.openCornfirmModal,inline:"","auto-apply":"","enable-time-picker":!1,"disabled-dates":e.disabledDates,"min-date":e.minDate,modelValue:e.runOutDate.date,"onUpdate:modelValue":t[0]||(t[0]=D=>e.runOutDate.date=D)},{day:i(({day:D,date:w})=>[(f(),b("p",{key:0,class:W({"run-out-date":e.isRunOutDate(w)}),style:{"font-weight":"600","font-size":"20px"}},[d("span",null,[O(P(D),1),d("sup",ys,P(e.getCounter(w)),1)])],2))]),_:1},8,["onDateUpdate","disabled-dates","min-date","modelValue"])]),_:1}),n(c,null,{default:i(()=>[n(u,null,{default:i(()=>[d("div",Ss,[t[3]||(t[3]=d("div",null,[O("Suggested Next Appointment Date "),d("span",{style:{"font-size":"16px"}},"(Medication run out date)")],-1)),d("div",bs,[O(P(e.runOutDate.formattedDate||"No run out date available")+" ",1),e.runOutDate.formattedDate?(f(),J(p,{key:0,onClick:t[1]||(t[1]=D=>e.handleDateUpdate(e.runOutDate.date)),name:"Set Next Appt.",fill:"solid",iconSlot:"icon-only",style:{float:"right"}})):z("",!0)])])]),_:1}),n(u,null,{default:i(()=>[d("div",Cs,[t[4]||(t[4]=d("div",null,"User set appointment date",-1)),d("div",Ms,P(e.calendarDate),1)])]),_:1}),n(u,null,{default:i(()=>[d("div",Ns,[t[5]||(t[5]=d("div",null,"Appointments",-1)),d("div",ws,P(e.appointment_count),1)])]),_:1}),n(u,null,{default:i(()=>[d("div",Is,[t[6]||(t[6]=d("div",null,"Appointment limit (per/day)",-1)),d("div",$s,P(e.appointment_count)+"/"+P(e.maximumNumberOfDaysForEachDay),1)])]),_:1})]),_:1})]),_:1}),n(g,null,{default:i(()=>[n(c,{size:"4"},{default:i(()=>[n(m,{inputHeader:"Preferred Next Appointment Date",bold:"600",fontSize:"17px",placeholderFontSize:"17px",placeholderFontWeight:"600",unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.inputPRDate,eventType:"",minDate:e.minDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t[2]||(t[2]=D=>e.handleInput(D))},null,8,["icon","inputValue","minDate"])]),_:1})]),_:1})])}const Ys=H(vs,[["render",Os],["__scopeId","data-v-2f8d4519"]]);export{Po as A,Js as C,zs as D,js as M,Ys as N,ze as P,Ws as T,Dn as a,Lo as b,Qs as c,ko as d,qs as e,Ks as f,mo as g,xo as h,Gs as s,G as u};

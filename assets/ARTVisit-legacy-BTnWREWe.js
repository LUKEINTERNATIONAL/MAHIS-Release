System.register(["./vendor-legacy-CFX0KWSj.js","./index-legacy-D84VBdSl.js","./lodash-legacy-pOOc9Efu.js"],function(e,n){"use strict";var t,l,a,o,i,r,u,s,c,p,d,v,g,m,y,b,f,h,D,_,k,T,x,I,w,P,F,A,j,C,R,S,V,N,E,W,$,H,L,z,U,Y,M,B,J,q,G,O,X;return{setters:[e=>{t=e.d,l=e.bU,a=e.b1,o=e.au,i=e.r,r=e.w,u=e.y,s=e.f,c=e.z,p=e.l,d=e.u,v=e.eu,g=e.k,m=e.as,y=e.a9,b=e.e,f=e.ac,h=e.F,D=e.L,_=e.G,k=e.I,T=e.ev,x=e.ew,I=e.eq,w=e.B,P=e.cm,F=e.V,A=e.U,j=e.W,C=e.A,R=e.dP,S=e.bO,V=e.a$,N=e.aY,E=e.e6,W=e.cs,$=e.dr,H=e.ex,L=e.m,z=e.ey,U=e.af,Y=e.bW,M=e.an},e=>{B=e.S,J=e.u,q=e.T,G=e.W,O=e.l,X=e._},null],execute:function(){var Z=document.createElement("style");Z.textContent="#main[data-v-5180e530]{height:calc(100vh - 69px);overflow-y:auto}.placeholder-content[data-v-5180e530]{padding:20px}\n/*$vite$:1*/",document.head.appendChild(Z);class K extends B{constructor(){super()}static nextTask(e){return super.getJson(`/workflows/${super.getProgramID()}/${e}`,{date:super.getSessionDate()})}static async getNextTaskParams(e,n=""){let t=n;try{if(!t){const{name:n}=await K.nextTask(e);t=n}}catch(l){t=""}return{name:t.toLowerCase(),params:{patient_id:e}}}}const Q={key:1,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},ee={class:"ion-page",id:"main"},ne={key:0,class:"placeholder-content"},te={style:{margin:"0px auto"},class:"ion-text-center"},le={key:1},ae={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}};e("default",X(t({__name:"ARTVisit",setup(e){const t=l(),X=J(),{patient:Z}=a(X),oe=[{label:"Emergency Refill",enableForDebugging:!1,component:Y(()=>M(()=>n.import("./EmergencyRefill-legacy-B6vdauvq.js"),void 0,n.meta.url))},{encounterTypeID:5,userProp:"patient type",label:"Patient Type",enableForDebugging:!1,component:Y(()=>M(()=>n.import("./ARTPatientType-legacy-BLd3065K.js"),void 0,n.meta.url))},{label:"Filing Number Management",enableForDebugging:!1,component:Y(()=>M(()=>n.import("./FilingNumberManagement-legacy-BaSwQcX0.js"),void 0,n.meta.url))},{encounterTypeID:9,userProp:"HIV first visits",enableForDebugging:!1,label:"HIV Clinic Registration",component:Y(()=>M(()=>n.import("./ArtClinicRegistration-legacy-3GJKLG3x.js"),void 0,n.meta.url))},{encounterTypeID:51,userProp:"HIV reception visits",label:"Reception",enableForDebugging:!1,component:Y(()=>M(()=>n.import("./Reception-legacy-C3NUyHV5.js"),void 0,n.meta.url))},{encounterTypeID:6,otherWorkflowNames:["htn_vitals"],userProp:"vitals",label:"Vitals",enableForDebugging:!1,component:Y(()=>M(()=>n.import("./Vitals-legacy-Bnh_lxDz.js"),void 0,n.meta.url))},{encounterTypeID:52,userProp:"HIV staging visits",label:"Staging",enableForDebugging:!1,component:Y(()=>M(()=>n.import("./Staging-legacy-CZUuoWaq.js"),void 0,n.meta.url))},{encounterTypeID:53,userProp:"HIV clinic consultations",label:"Consultation",enableForDebugging:!1,component:Y(()=>M(()=>n.import("./ARTConsultation-legacy-jxI95bMC.js").then(e=>e.b),void 0,n.meta.url))},{encounterTypeID:68,userProp:"ART adherence",label:"ART Adherence",enableForDebugging:!1,component:Y(()=>M(()=>n.import("./ARTAdherence-legacy-DsrNAxg5.js"),void 0,n.meta.url))},{encounterTypeID:25,userProp:"Prescriptions",label:"Prescription",enableForDebugging:!1,component:Y(()=>M(()=>n.import("./Prescription-legacy-B8-nlS2z.js"),void 0,n.meta.url))},{encounterTypeID:54,userProp:"Drug Dispensations",label:"Dispense drugs",enableForDebugging:!1,component:Y(()=>M(()=>n.import("./ArtDispensation-legacy-3Kr7KQwM.js"),void 0,n.meta.url))},{encounterTypeID:7,userProp:"Manage Appointments",label:"Appointment",enableForDebugging:!1,component:Y(()=>M(()=>n.import("./ARTAppointment-legacy-DhSFhHQl.js"),void 0,n.meta.url))}],ie=o(),re=i(-1),ue=i(null),se=i([]),ce=i([]),pe=i(!1),de=i(-1),ve=i(""),ge=i(""),me=i("");function ye(e){var n;return!!e.enableForDebugging||!!e&&(!pe.value&&de.value===(null==e?void 0:e.encounterTypeID)||(null!==(n=null==e?void 0:e.otherWorkflowNames)&&void 0!==n?n:[]).includes(ve.value))}function be(){if(0===se.value.length||re.value===se.value.length-1)return!1;const e=se.value[re.value];return e&&ye(e)}async function fe(){me.value="",pe.value=!0,ge.value="",ve.value="";try{var e;const n=await K.nextTask(Z.value.patientID);if(!n)return ge.value="No workflows found. You may exit this page or refresh",pe.value=!1,void(re.value=-1);ve.value=n.name,de.value=null!==(e=null==n?void 0:n.encounter_type_id)&&void 0!==e?e:-1;const t=se.value.findIndex(e=>{var n;return(null==e?void 0:e.encounterTypeID)===de.value||(null!==(n=e.otherWorkflowNames)&&void 0!==n?n:[]).includes(ve.value)});if(-1!==t){me.value=n.description;const e=[...se.value.slice(t),...se.value.slice(0,t)];se.value=e,re.value=0}else ge.value="Error loading workflow task",re.value=t}catch(n){ge.value="An error has occured while loading next task: "+n,console.error(n)}finally{await async function(){const e=await G.getEncounters(Z.value.patientID,{date:K.getSessionDate()});ce.value=e.map(e=>e.encounter_type)}(),pe.value=!1}}function he(){(ue.value&&"function"==typeof ue.value.onSubmit?ue.value.onSubmit():Promise.resolve(!0)).then(e=>e&&fe())}return r(()=>t.fullPath,()=>{(async function(){re.value=-1,se.value=[];const e=await B.getJson("user_properties",{property:"activities"});try{if(!e.property_value)return void(se.value=oe);const n=e.property_value.split(",").map(e=>e.toLowerCase());se.value=oe.filter(e=>{var t;return e.enableForDebugging||n.includes(null===(t=e.userProp)||void 0===t?void 0:t.toLowerCase())})}catch(n){O("Unable to load activities"),console.error(n)}})().then(fe)},{immediate:!0,deep:!0}),(e,n)=>(s(),u(d(U),null,{default:c(()=>[p(q),p(d(v),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:c(()=>{var e;return[p(d(m),{contentId:"main"},{default:c(()=>[p(d(y),null,{default:c(()=>[se.value.length>0?(s(),u(d(f),{key:0},{default:c(()=>[(s(!0),b(h,null,D(se.value,(e,n)=>(s(),u(d(_),{onClick:e=>function(e){if(e<0||e>=se.value.length)return;const n=se.value[e];n&&ye(n)&&(re.value=e)}(n),lines:"none",key:n,disabled:!ye(e),button:""},{default:c(()=>{return[(n=e,ce.value.includes(null!==(t=null==n?void 0:n.encounterTypeID)&&void 0!==t?t:0)?(s(),u(d(k),{key:0,icon:d(T),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):ye(e)?(s(),u(d(k),{key:2,icon:d(I),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(s(),u(d(k),{key:1,icon:d(x),style:{padding:"10px"},slot:"start"},null,8,["icon"]))),g("b",null,w(e.label),1)];var n,t}),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(s(),b("div",Q,[p(d(k),{style:{"font-size":"2rem"},icon:d(P)},null,8,["icon"]),n[2]||(n[2]=g("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),p(d(F),null,{default:c(()=>[p(d(A),{color:"light"},{default:c(()=>[p(d(j),{onClick:n[0]||(n[0]=e=>d(ie).back())},{default:c(()=>[p(d(k),{icon:d(R),slot:"start"},null,8,["icon"]),n[3]||(n[3]=C(" Back to dashboard "))]),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),g("div",ee,[pe.value?(s(),b("div",ne,[g("div",te,[p(d(S),{name:"bubbles"}),n[4]||(n[4]=g("p",null,[g("h1",null,"Please wait...")],-1))])])):null!==(e=se.value[re.value])&&void 0!==e&&e.component?(s(),b("div",le,[p(d(V),null,{default:c(()=>[p(d(N),null,{default:c(()=>{var e;return[(s(),u(E,null,[(s(),u(W(null===(e=se.value[re.value])||void 0===e?void 0:e.component),{ref_key:"formRef",ref:ue},null,512))],1024))]}),_:1})]),_:1})])):(s(),b("div",ae,[p(d(k),{style:{color:"green","font-size":"80px"},icon:d($)},null,8,["icon"]),g("h2",null,w(ge.value),1),p(d(j),{size:"large",fill:"clear",onClick:n[1]||(n[1]=e=>d(ie).back())},{default:c(()=>[p(d(k),{slot:"start",icon:d(H)},null,8,["icon"]),n[5]||(n[5]=C(" Exit page "))]),_:1,__:[5]})])),p(d(F),null,{default:c(()=>[p(d(A),{color:"light"},{default:c(()=>[be()?(s(),u(d(j),{key:0,onClick:he,color:"primary",style:{padding:"4px"},slot:"end"},{default:c(()=>[n[6]||(n[6]=C(" Save and continue ")),p(d(k),{style:{padding:"4px"},icon:d(z),slot:"end"},null,8,["icon"])]),_:1,__:[6]})):L("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),[["__scopeId","data-v-5180e530"]]))}}});

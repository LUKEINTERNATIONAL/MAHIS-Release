System.register(["./index-legacy-D5NHGThA.js","./ConfirmPrinting-legacy-BtCsuC1P.js","./vendor-legacy-BTbHWMAP.js","./BirthRegistration-legacy-DFkmGXZd.js","./ARTPatientType-legacy-Di4KkhT7.js","./ncd_appointment_service-legacy-B1-HHTYg.js","./lodash-legacy-pOOc9Efu.js","./SaveProgressModal-legacy-DgxV7EeG.js","./group_validation-legacy-aDYnLo5z.js","./vaccines_service-legacy-Pctwohux.js","./OutcomeModal-legacy-CGfRRZ5C.js","./SetRelationship.vue_vue_type_script_lang-legacy-Cse-Lv4L.js","./relations_service-legacy-CZfQ61mK.js","./relationship_service-legacy-BdBLMuv4.js","./AddVillage-legacy-C1hyXksm.js","./DemographicBar-legacy-C9EDSr8n.js","./Stepper-legacy-CzX_LNsm.js","./app_encounter_service-legacy-DaUekosL.js","./previousVitals-legacy-DEKBS18-.js","./apexcharts-legacy-CrGmkQaL.js","./SvgDynamicColor-legacy-Bv_mwPBF.js","./patient_complaints_service-legacy-DJgv7ioY.js","./lab_order-legacy-C5Lk_xw8.js","./UpcomingFeature-legacy-BZwgGHu1.js","./DatePicker.vue_vue_type_script_setup_true_lang-legacy-CdwcWXHF.js","./SelectFacility-legacy-BLj5qcFJ.js","./drug_service-legacy-D1T5yXvT.js","./drug_prescription_service-legacy-CNHFJwRZ.js","./appointment_service-legacy-Cq9khjdt.js","./clinicalDaysStore-legacy-CxSFzuaK.js","./FeatusModal-legacy-C_xiYZv3.js","./vitals_service-legacy-dxypgIrt.js","./diagnosis-legacy-CpJr4T_r.js","./NCDNumber-legacy-CxRnZ5T3.js","./patient_type_service-legacy-DsxC5oJJ.js","./BasicRadioSelect-legacy-cuxmMt6c.js","./sms_service-legacy-DngMemRD.js","./EIRreportsStore-legacy-C7BQpZRo.js","./Export-legacy-BNqBNH71.js"],function(t,e){"use strict";var i,a,n,o,r,s,l,c,d,u,h,p,v,g,m,y,f,_,b,I,D,S,w,x,k,C,L,P,T,R,j,N,H,O,B,A,M,F,U,G,E,W,z,$,q,V,Y,J,X,K,Q,Z,tt,et,it,at,nt,ot,rt,st,lt,ct,dt,ut,ht,pt,vt,gt,mt,yt,ft,_t,bt,It,Dt,St,wt,xt,kt,Ct,Lt,Pt,Tt,Rt,jt,Nt,Ht,Ot,Bt,At;return{setters:[t=>{i=t.o,a=t.ai,n=t.x,o=t.y,r=t.u,s=t._,l=t.i,c=t.H,d=t.w,u=t.ab,h=t.aj,p=t.ac,v=t.ae,g=t.S,m=t.g,y=t.a4,f=t.m,_=t.b,b=t.ak,I=t.al,D=t.t,S=t.am,w=t.an,x=t.ao,k=t.A,C=t.F,L=t.E,P=t.P,T=t.C,R=t.r,j=t.I,N=t.ap,H=t.s,O=t.p,B=t.n},t=>{A=t.C},t=>{M=t.d,F=t.al,U=t.U,G=t.T,E=t.am,W=t.an,z=t.G,$=t.S,q=t.ao,V=t.E,Y=t.y,J=t.f,X=t.W,K=t.I,Q=t.ab,Z=t.d0,tt=t.ac,et=t.dq,it=t.D,at=t.X,nt=t.e,ot=t.m,rt=t.l,st=t.k,lt=t.z,ct=t.B,dt=t.F,ut=t.L,ht=t.A,pt=t.au,vt=t.bj,gt=t.dt,mt=t.du,yt=t.dv,ft=t.O,_t=t.dw,bt=t.cj,It=t.dx,Dt=t.p},t=>{St=t._,wt=t.B,xt=t.S,kt=t.H,Ct=t.C,Lt=t.G,Pt=t.P},t=>{Tt=t.default},t=>{Rt=t.B,jt=t._,Nt=t.u},t=>{Ht=t.l},t=>{Ot=t.f},t=>{Bt=t.v},t=>{At=t.g},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var e=document.createElement("style");e.textContent=".demographics_title[data-v-490af540]{font-weight:700;font-size:24px}.gender[data-v-490af540]{display:flex;justify-content:space-between;max-width:170px;padding-top:10px}.gender_title[data-v-490af540]{margin-top:30px}.large-card[data-v-ffb46cdd]{padding:5%;border-radius:15px;border:1px solid #ccc;height:82vh;background-color:#fff;overflow-y:auto;-webkit-box-shadow:0px -2px 19px -2px rgba(196,190,196,1);-moz-box-shadow:0px -2px 19px -2px rgba(196,190,196,1);box-shadow:0 -2px 19px -2px #c4bec4}.header[data-v-ffb46cdd]{display:flex;gap:20px;padding:10px 20px}.position_content[data-v-ffb46cdd]{max-width:100vw}.accordion-expanded[data-v-ffb46cdd]{background-color:#ded}button[aria-expanded=false][data-v-ffb46cdd]{background:rgba(var(--ion-color-rose-rgb),.25)}ion-accordion.accordion-expanding ion-item[slot=header][data-v-ffb46cdd],ion-accordion.accordion-expanded ion-item[slot=header][data-v-ffb46cdd]{--background: #ddeedd}.breadcrumbs[data-v-a90896a5]{font-weight:400;font-size:14px;cursor:pointer}ion-toolbar[data-v-a90896a5]{--opacity: .5;--background: var(--ion-background-color, #fff)}.header[data-v-a90896a5]{color:#000;display:flex;justify-content:space-between;padding:10px 20px}.footer[data-v-a90896a5]{color:#000;display:flex;justify-content:space-between;padding:5px 0}ion-breadcrumb ion-icon[data-v-a90896a5]{margin-inline:30px}.breadcrumb-active[data-v-a90896a5]{color:var(--color)}.active[data-v-a90896a5]{color:#00190e;display:flex;height:40px;padding:0 16px;align-items:center;gap:8px}.active .breadcrumb-text[data-v-a90896a5]{border-bottom:1px solid #00190e}ion-footer[data-v-a90896a5]{border-top:1px solid #e6e6e6}.icon_div[data-v-a90896a5]{display:flex;justify-content:space-between;width:70px;position:absolute;right:70px;top:20px}.active_icon[data-v-a90896a5]{font-size:25px;background-color:#ded;color:#6fbd70;border-radius:5px}.inactive_icon[data-v-a90896a5]{font-size:25px;color:#ccc}.container[data-v-a90896a5]{position:relative}.title[data-v-a90896a5]{text-align:center;margin-bottom:10px}.demographics_title[data-v-a90896a5]{font-weight:700;font-size:22px;padding-top:20px}.demographics[data-v-a90896a5]{display:flex;width:unset;justify-content:center}.center_content[data-v-a90896a5]{display:flex;justify-content:center}.flex-container[data-v-a90896a5]{display:flex;flex-wrap:wrap;gap:10px;padding:10px}.flex-item[data-v-a90896a5]{color:#fff;flex:1 1 100px;text-align:center;border-radius:5px;box-sizing:border-box}\n/*$vite$:1*/",document.head.appendChild(e);const Mt=M({name:"Menu",mixins:[St],components:{IonContent:q,IonHeader:$,IonItem:z,IonList:W,IonMenu:E,IonTitle:G,IonToolbar:U,BasicCard:Rt},data:()=>({cardData:{},inputField:"",setName:"",locationData:[]}),computed:{...F(a,["currentLocation","country"]),...F(r,["patient"]),selected_country(){var t;return null===(t=o(this.country,"country","value"))||void 0===t?void 0:t.name},current_district(){var t;return null===(t=o(this.currentLocation,"current_district","value"))||void 0===t?void 0:t.name},current_traditional_authority(){var t;return null===(t=o(this.currentLocation,"current_traditional_authority","value"))||void 0===t?void 0:t.name},current_village(){var t;return null===(t=o(this.currentLocation,"current_village","value"))||void 0===t?void 0:t.name},"Other (specify)"(){return o(this.currentLocation,"Other (specify)","value")}},watch:{currentLocation:{handler(){this.buildCards()},deep:!0},countriesList:{handler(){this.countriesList.length>0&&n(this.country,"country","multiSelectData",this.countriesList)},deep:!0},$route:{async handler(){await this.buildCards(),this.setData()}}},props:{editable:{default:!1}},async mounted(){await this.buildCards(),this.setData()},methods:{setData(){this.setSelectedCountry(),this.editable&&n(this.country,"country","value",{name:"Malawi",district_id:""})},setSelectedCountry(){if(i().setRegSelectedCountry(this.selected_country),"Malawi"===this.selected_country){const t=a();t.setHomeLocation(t.getInitialHomeLocation()),t.setCurrentLocation(t.getInitialCurrentLocation())}},async buildCards(){this.cardData={mainTitle:"Demographics",cards:[{cardTitle:"Country",content:this.country}]}},async handleInputData(t){this.setSelectedCountry()}}}),Ft=s(Mt,[["render",function(t,e,i,a,n,o){const r=V("basic-card");return J(),Y(r,{content:t.cardData,editable:t.editable,"onUpdate:selected":t.handleInputData,"onUpdate:inputValue":t.handleInputData},null,8,["content","editable","onUpdate:selected","onUpdate:inputValue"])}],["__scopeId","data-v-490af540"]]),Ut=M({components:{IonLabel:it,IonAvatar:et,IonRow:tt,IonImg:Z,IonCol:Q,IonList:W,IonItem:z,IonIcon:K,IonButton:X},data:()=>({selectedResult:{},iconsContent:l,isAnyAccordionOpen:!0,isLoading:!1}),methods:{updateAccordionState(t){const e=this.$refs.accordionGroup;this.isAnyAccordionOpen=void 0!==e.value},dismiss(t){at.dismiss(t)},async init(){this.setData(this.deduplicationData[0]||{})},async onSelect(){at.dismiss(this.selectedResult)},setData(t){this.selectedResult=t},dateFormat:t=>c.toStandardHisDisplayFormat(t),probabilityToPercentage:t=>(100*t).toFixed(2)+"%"},props:{deduplicationData:{default:[]},to_be_registered:{default:[]}},mounted(){this.init()},activated(){this.init()}}),Gt={key:0,class:"spinner-overlay"},Et={class:"header position_content"},Wt={style:{"font-size":"1.2em","font-weight":"700"}},zt={class:"due_date"},$t={class:"ion-padding",slot:"content"},qt={style:{display:"flex","justify-content":"end",gap:"10px"}},Vt=s(Ut,[["render",function(t,e,i,a,n,o){const r=V("ion-spinner"),s=V("ion-icon"),l=V("ion-header"),c=V("ion-label"),d=V("ion-item"),u=V("ion-col"),h=V("ion-row"),p=V("ion-accordion"),v=V("ion-accordion-group"),g=V("ion-content"),m=V("ion-button"),y=V("ion-footer");return J(),nt(dt,null,[t.isLoading?(J(),nt("div",Gt,[rt(r,{name:"bubbles"}),e[3]||(e[3]=st("div",{class:"loading-text"},"Please wait...",-1))])):ot("",!0),rt(l,null,{default:lt(()=>[st("div",Et,[st("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=e=>t.dismiss("back"))},[rt(s,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeft},null,8,["icon"])]),st("div",Wt,"Matches found: ("+ct(t.deduplicationData.length)+")",1)])]),_:1}),rt(g,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:lt(()=>[rt(v,{ref:"accordionGroup",class:"previousView",value:"0",onIonChange:t.updateAccordionState},{default:lt(()=>[(J(!0),nt(dt,null,ut(t.deduplicationData,(i,a)=>(J(),Y(p,{style:{"margin-bottom":"15px"},value:a,"toggle-icon-slot":"start",class:"custom_card",button:"",key:a,detail:!0,color:i.value===t.selectedResult.value?"light":"",onClick:e=>t.setData(i)},{default:lt(()=>[rt(d,{slot:"header"},{default:lt(()=>[rt(c,{class:"previousLabel"},{default:lt(()=>{var t,e;return[ht(ct(null==i||null===(t=i.person)||void 0===t?void 0:t.given_name)+" "+ct(null==i||null===(e=i.person)||void 0===e?void 0:e.family_name),1)]}),_:2},1024),st("div",zt,[e[4]||(e[4]=ht(" Score: ")),st("b",null,ct(t.probabilityToPercentage(null==i?void 0:i.score)||"-"),1)])]),_:2},1024),st("div",$t,[rt(h,null,{default:lt(()=>[rt(u,null,{default:lt(()=>e[5]||(e[5]=[st("b",null,"To be Registered",-1)])),_:1,__:[5]}),rt(u,null,{default:lt(()=>e[6]||(e[6]=[st("b",null,"Already Registered",-1)])),_:1,__:[6]})]),_:1}),rt(h,null,{default:lt(()=>[rt(u,null,{default:lt(()=>[rt(h,null,{default:lt(()=>{var i,a;return[e[7]||(e[7]=ht(" Name: ")),st("b",null,ct(null===(i=t.to_be_registered)||void 0===i?void 0:i.given_name)+" "+ct(null===(a=t.to_be_registered)||void 0===a?void 0:a.family_name),1)]}),_:1,__:[7]}),rt(h,null,{default:lt(()=>{var i;return[e[8]||(e[8]=ht("Gender: ")),st("b",null,ct(null===(i=t.to_be_registered)||void 0===i?void 0:i.gender),1)]}),_:1,__:[8]}),rt(h,null,{default:lt(()=>{var i;return[e[9]||(e[9]=ht("Birthdate: ")),st("b",null,ct(null===(i=t.to_be_registered)||void 0===i?void 0:i.birthdate),1)]}),_:1,__:[9]}),rt(h,null,{default:lt(()=>{var i;return[e[10]||(e[10]=ht("Home District: ")),st("b",null,ct(null===(i=t.to_be_registered)||void 0===i?void 0:i.home_district),1)]}),_:1,__:[10]}),rt(h,null,{default:lt(()=>{var i;return[e[11]||(e[11]=ht("Home TA: ")),st("b",null,ct(null===(i=t.to_be_registered)||void 0===i?void 0:i.home_traditional_authority),1)]}),_:1,__:[11]})]),_:1}),rt(u,null,{default:lt(()=>[rt(h,null,{default:lt(()=>{var t,a;return[e[12]||(e[12]=ht(" Name: ")),st("b",null,ct(null==i||null===(t=i.person)||void 0===t?void 0:t.given_name)+" "+ct(null==i||null===(a=i.person)||void 0===a?void 0:a.family_name),1)]}),_:2,__:[12]},1024),rt(h,null,{default:lt(()=>{var t;return[e[13]||(e[13]=ht("Gender: ")),st("b",null,ct(null==i||null===(t=i.person)||void 0===t?void 0:t.gender),1)]}),_:2,__:[13]},1024),rt(h,null,{default:lt(()=>{var a;return[e[14]||(e[14]=ht("Birthdate: ")),st("b",null,ct(t.dateFormat(null==i||null===(a=i.person)||void 0===a?void 0:a.birthdate)),1)]}),_:2,__:[14]},1024),rt(h,null,{default:lt(()=>{var t;return[e[15]||(e[15]=ht("Home District: ")),st("b",null,ct(null==i||null===(t=i.person)||void 0===t?void 0:t.home_district),1)]}),_:2,__:[15]},1024),rt(h,null,{default:lt(()=>{var t;return[e[16]||(e[16]=ht("Home TA: ")),st("b",null,ct(null==i||null===(t=i.person)||void 0===t?void 0:t.home_traditional_authority),1)]}),_:2,__:[16]},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["value","color","onClick"]))),128))]),_:1},8,["onIonChange"])]),_:1}),rt(y,{collapse:"fade",class:"ion-no-border"},{default:lt(()=>[st("div",qt,[rt(m,{fill:"solid",color:"secondary",onClick:e[1]||(e[1]=e=>t.dismiss("dismiss"))},{default:lt(()=>e[17]||(e[17]=[ht(" Not Duplicate ")])),_:1,__:[17]}),rt(m,{onClick:e[2]||(e[2]=e=>t.onSelect()),fill:"solid",disabled:!t.isAnyAccordionOpen},{default:lt(()=>e[18]||(e[18]=[ht("Select ")])),_:1,__:[18]},8,["disabled"])])]),_:1})],64)}],["__scopeId","data-v-ffb46cdd"]]),Yt=M({mixins:[jt,St],components:{PatientType:Tt,IonBreadcrumb:mt,IonBreadcrumbs:gt,IonIcon:K,IonContent:q,IonHeader:$,IonMenuButton:vt,IonPage:pt,IonTitle:G,DynamicButton:d,PersonalInformation:Pt,GuardianInformation:Lt,CurrentLocation:Ct,Country:Ft,HomeLocation:kt,SocialHistory:xt,BirthRegistration:wt},data:()=>({patientTypeComponent:null,isMilitarySite:!1,ddeId:null,iconListStatus:"active_icon",deduplicationData:"active_icon",iconGridStatus:"inactive_icon",iconsContent:l,demographic:!0,currentStep:"Personal Information",scanner:!1,checkUnderOne:!1,isLoading:!1,checkUnderFourteen:!0,checkUnderNine:!1,checkUnderFive:!1,checkUnderSixWeeks:!1,steps:["Personal Information","Location","Patient Type","Social History","Guardian Information"],disableSaveBtn:!1,workerStore:B()}),props:["registrationType"],computed:{...F(O,["activeProgram"]),...F(i,["NCDUserActions","regSelectedCountry"]),...F(H,["globalPropertyStore"]),...F(a,["personInformation","socialHistory","currentLocation","homeLocation","guardianInformation","country","patientType"]),...F(Nt,["registrationDisplayType"]),...F(N,["birthRegistration"]),...F(_,["apiStatus"]),isPatientTypeRequired(){return 1===this.activeProgram.program_id},patientTypeIsset(){const t=u(this.patientType,"patientType");return`${null!=t?t:""}`.length>=1},nationalID(){return o(this.personInformation,"nationalID","value")},birthID(){return o(this.birthRegistration,"Serial Number","value")},firstname(){return o(this.personInformation,"firstname","value")},lastname(){return o(this.personInformation,"lastname","value")},phoneNumber(){return o(this.personInformation,"phoneNumber","value")},gender(){return u(this.personInformation,"gender")},birthdate(){return c.toStandardHisFormat(o(this.personInformation,"birthdate","value"))},guardianFirstname(){return o(this.guardianInformation,"guardianFirstname","value")},guardianLastname(){return o(this.guardianInformation,"guardianLastname","value")},guardianMiddleName(){return o(this.guardianInformation,"guardianMiddleName","value")},guardianPhoneNumber(){return o(this.guardianInformation,"guardianPhoneNumber","value")},relationship(){return o(this.guardianInformation,"relationship","value")},current_district(){var t;return null===(t=o(this.currentLocation,"current_district","value"))||void 0===t?void 0:t.name},current_traditional_authority(){var t;return null===(t=o(this.currentLocation,"current_traditional_authority","value"))||void 0===t?void 0:t.name},current_village(){var t;return null===(t=o(this.currentLocation,"current_village","value"))||void 0===t?void 0:t.name},"Other (specify)"(){return o(this.currentLocation,"Other (specify)","value")}},async mounted(){R(),this.setIconClass(),this.disableNationalIDInput(),this.checkAge()},watch:{personInformation:{handler(){const t=a();t.setPersonalInformation(this.personInformation),t.setSocialHistory(this.socialHistory),t.setHomeLocation(this.homeLocation),t.setCurrentLocation(this.currentLocation),t.setGuardianInformation(this.guardianInformation),this.checkAge(),this.disableNationalIDInput();const e=a();1===this.programID()&&(t.clearSocialHistoryOccupations(),j.isProp("military_site=true").then(t=>{this.isMilitarySite=t,this.isMilitarySite?(e.setOccupationAsMandatory(),e.setSocialHistoryMilitaryOccupations()):(e.setOccupationNotMandatory(),e.setSocialHistoryOccupations())}))},deep:!0},$route:{async handler(t){this.currentStep="Personal Information",t.name.includes("registration")&&(R(),a().setGuardianInformation(this.guardianInformation)),await this.getLocationData(),n(this.country,"country","multiSelectData",this.countriesList),n(this.currentLocation,"current_district","multiSelectData",this.districtList),n(this.homeLocation,"home_district","multiSelectData",this.districtList)},deep:!0}},setup:()=>({arrowForwardCircle:It,grid:bt,list:_t}),methods:{async cancel(t){await T("Do you want to cancel registration?","",{confirmBtnLabel:"Yes",icon:"",showBackdrop:!0})&&this.nav("/home")},programID:()=>g.getProgramID(),isEligibleForOccupation(){return ft(g.getSessionDate()).diff(this.birthdate,"years")>=18},async getRegion(t){if(t){let e=[];for(let i of[1,2,3]){if((i=1)&&(e=await this.getDistricts(i)),e.some(e=>e.name.trim()===t))return"Central Region";if((i=2)&&(e=await this.getDistricts(i)),e.some(e=>e.name.trim()===t))return"Northern Region";if((i=3)&&(e=await this.getDistricts(i)),e.some(e=>e.name.trim()===t))return"Southern Region";if((i=4)&&(e=await this.getDistricts(i)),e.some(e=>e.name.trim()===t))return"Foreign"}}},checkAge(){Ht.isEmpty(this.birthdate)||(this.checkUnderFourteen=c.getAgeInYears(this.birthdate)>=14,this.checkUnderNine=c.ageInMonths(this.birthdate)<9,this.checkUnderFive=c.getAgeInYears(this.birthdate)<5,this.checkUnderSixWeeks=c.dateDiffInDays(c.sessionDate(),this.birthdate)<42)},disableNationalIDInput(){"manual"==this.registrationType?n(this.personInformation,"nationalID","displayNone",!0):n(this.personInformation,"nationalID","displayNone",!1)},setCurrentStep(t){this.currentStep=t},nav(t){this.$router.push(t)},async nextStep(){this.checkUnderFourteen||this.checkUnderFive?this.steps=["Personal Information","Location","Patient Type","Social History","Guardian Information"]:this.steps=["Personal Information","Location","Patient Type","Guardian Information"],this.steps=this.steps.reduce((t,e)=>"Patient Type"!==e||this.isPatientTypeRequired?[...t,e]:t,[]);const t=this.steps.indexOf(this.currentStep);if(t<this.steps.length-1)if("Personal Information"===this.currentStep){const e=["nationalID","firstname","lastname","birthdate","gender"];await this.validations(this.personInformation,e)?this.currentStep=this.steps[t+1]:D("Please fill fileds correctly before you proceed!")}else if("Location"===this.currentStep){const e=["current_district","current_traditional_authority","current_village"];await this.validations(this.currentLocation,e)&&await Bt(this.homeLocation)||"Malawi"!=this.regSelectedCountry?this.currentStep=this.steps[t+1]:D("Please fill fileds correctly before you proceed!")}else if("Social History"===this.currentStep&&this.isMilitarySite&&this.isEligibleForOccupation()){if(!u(this.socialHistory,"occupation"))return D("Occupation is required");this.currentStep=this.steps[t+1]}else if("Patient Type"===this.currentStep&&this.isPatientTypeRequired){if(!this.patientTypeIsset)return D("Patient type is required!");this.currentStep=this.steps[t+1]}else"Social History"===this.currentStep&&(this.checkUnderFive||this.checkUnderOne?await Bt(this.birthRegistration)?this.currentStep=this.steps[t+1]:D("Please fill fileds correctly before you proceed!"):this.currentStep=this.steps[t+1])},previousStep(){const t=this.steps.indexOf(this.currentStep);t>0&&(this.currentStep=this.steps[t-1])},async findPatient(t){const e=await P.findByID(t);await r().setPatientRecord(e),this.setURLs(t)},validateGaudiarnInfo(){return!!this.checkUnderFourteen||Bt(this.guardianInformation)},async validations(t,e){return e.every(e=>L(t,e,this[e]))},async validateLocation(){return"Malawi"!=this.regSelectedCountry||!(!(await Bt(this.homeLocation))||!(await Bt(this.currentLocation)))},async possibleDuplicates(){try{const e=new C;if(this.deduplicationData=await e.checkPotentialDuplicates(yt(this.personInformation[0].selectedData)),this.deduplicationData.length>0){const i=await m(Vt,{class:"fullScreenModal"},!0,{to_be_registered:yt(this.personInformation[0].selectedData),deduplicationData:this.deduplicationData});if("dismiss"!=i&&"back"!=i){var t;const a=await e.importPatient(null==i||null===(t=i.person)||void 0===t?void 0:t.id);return await this.findPatient(a.patient_id),!0}return"back"==i}return!1}catch(e){return!1}},patientTypeOk(){return!this.isPatientTypeRequired||(this.$refs.patientTypeComponent?this.$refs.patientTypeComponent.validateAll():(D("Patient type form not fully initialised, please try again"),!1))},async createPatient(){var t;if(!0===I()){const t=["nationalID","firstname","lastname","birthdate","gender"],e=o(this.currentLocation,"closestLandmark","value");if(null==e||e.name,!this.patientTypeOk())return;if(!u(this.socialHistory,"occupation")&&this.isMilitarySite&&this.isEligibleForOccupation())return D("Occupation is required");if(await this.validations(this.personInformation,t)&&await this.validateLocation()&&await this.validateBirthData()&&this.validateGaudiarnInfo())try{const t=await S();if(!t){if(0==await w())return;D("DDE IDs are not available in MODS.");const t=await x();return"Up"==(null==t?void 0:t.status)?(D("Proceeding with MODS without DDE IDs."),void(await this.proceedWithPatientCreation(!0))):void 0}this.ddeId=t.npid,await this.proceedWithPatientCreation(!0)}catch(n){return void f("DDE IDs are not available. Please connect to the server to sync the IDs.")}else D("Please complete all required fields");return}const e=await k("dde").then(t=>null==t?void 0:t[0]);let i=!1;var a;if(((null==e||null===(t=e.ids)||void 0===t?void 0:t.length)>0||this.apiStatus)&&(this.ddeId=(null==e||null===(a=e.ids[0])||void 0===a?void 0:a.npid)||"",i=!0),i){const t=["nationalID","firstname","lastname","birthdate","gender"],i=o(this.currentLocation,"closestLandmark","value");if(null==i||i.name,u(this.socialHistory,"occupation"),!this.patientTypeOk())return;await this.validations(this.personInformation,t)&&await this.validateLocation()&&await this.validateBirthData()&&this.validateGaudiarnInfo()?await this.proceedWithPatientCreation(!1,e):D("Please complete all required fields")}else f("DDE IDs are not available. Please connect to the server to sync the IDs.")},async proceedWithPatientCreation(t=!1,e=null){var i,a;if(await this.buildPersonalInformation(),this.disableSaveBtn=!0,this.isLoading=!0,!t&&"true"===this.globalPropertyStore.dde_enabled&&this.apiStatus&&await this.possibleDuplicates())return this.disableSaveBtn=!1,void(this.isLoading=!1);if(0===Object.keys(this.personInformation[0].selectedData).length)return;const n=await this.buildPatientRecord();if(!t&&(null==e||null===(i=e.ids)||void 0===i?void 0:i.length)>0&&(e.ids=e.ids.slice(1),this.workerStore.postData("OVERRIDE_OBJECT_STORE",{storeName:"dde",data:e})),!t&&(this.apiStatus&&33!=this.programID()&&32!=this.programID()||this.apiStatus&&(null==e||!e.ids))){this.workerStore.postData("SYNC_DDE");const t=await g.postJson("/save_patient_record",{record:n});await r().setPatientRecord(t),this.workerStore.postData("SYNC_ALL_DATA"),this.disableSaveBtn=!1,this.$refs.patientTypeComponent&&(await this.$refs.patientTypeComponent.onSubmit(t.patientID)||f("Unable to save patient type.. You can try saving manually in ART tasks")),await this.printBarcode(),await this.setURLs(t.patientID)}else t||!t&&(null==e||null===(a=e.ids)||void 0===a?void 0:a.length)>0?(_().syncingTotal=_().syncingTotal+1,r().setRecord(n),await this.workerStore.postData("ADD_OBJECT_STORE",{storeName:"patientRecords",data:n}),this.isLoading=!1,this.disableSaveBtn=!1,await this.printBarcode(),t&&(null==n.patientID&&b({record:n}),this.workerStore.postData("SYNC_ALL_DATA")),32==this.programID()?this.$router.push("/NCDEnrollment"):this.$router.push("/patientProfile")):f("DDE IDs are not available. Please connect to the server to sync the IDs.")},async printBarcode(){"dismiss"!==await m(A,{class:"small-confirm-modal "})&&(new y).printData("barcode")},async buildPatientRecord(){var t;const e=o(this.birthRegistration,"Weight","value");let i={saved:[],unsaved:[]};e&&(i.unsaved=[{concept_id:5089,obs_datetime:c.sessionDate(),value_numeric:e}]);const a=this.personInformation[0].selectedData.birthdate,n=this.personInformation[0].selectedData.gender;return{patientID:this.ddeId,ID:this.ddeId,NcdID:"",program_id:g.getProgramID()||null,location_id:localStorage.getItem("locationID"),provider_id:localStorage.getItem("userID"),encounter_datetime:(new Date).toISOString(),personInformation:yt(this.personInformation[0].selectedData),guardianInformation:{saved:[],unsaved:[yt(this.guardianInformation[0].selectedData)]},birthRegistration:yt(await Ot(this.birthRegistration)),otherPersonInformation:{nationalID:this.validatedNationalID(),birthID:this.validatedBirthID(),relationshipID:null===(t=o(this.guardianInformation,"relationship","value"))||void 0===t?void 0:t.id},vitals:i,vaccineSchedule:await At(n,a),vaccineAdministration:{orders:[],obs:[],voided:[]},appointments:{saved:[],unsaved:[]},saveStatusPersonInformation:"pending",saveStatusGuardianInformation:"pending",saveStatusBirthRegistration:"pending",saveStatusVitals:"pending",date_created:"",creator:"",sync_status:"unsynced"}},checkWeightForAge(t,e){let i=!1;return(t>=0&&t<1&&e>=.5&&e<=13.1||t>=1&&t<2&&e>13.1&&e<=15||t>=2&&t<3&&e>15&&e<=20.9||t>=3&&t<4&&e>20.9&&e<=24.1||t>=4&&t<5&&e>24.1&&e<=28)&&(i=!0),i},async validateBirthData(){return!this.checkUnderNine||(this.checkWeightForAge(c.getAgeInYears(this.birthdate),o(this.birthRegistration,"Weight","value"))?Bt(this.birthRegistration):!!(await v(`Do you want to continue with this weight (${o(this.birthRegistration,"Weight","value")}) for age (${c.getAgeInYears(this.birthdate)})`)))},validatedNationalID(){return""==this.nationalID||o(this.personInformation,"nationalID","alertsErrorMassage")?"":this.nationalID},validatedBirthID(){return""==this.birthID||o(this.birthRegistration,"Serial Number","alertsErrorMassage")?"":this.birthID},async setURLs(t=""){await h(),this.isLoading=!1,this.disableSaveBtn=!1;let e="";e=32==this.programID()&&this.apiStatus?(await p.userProgramData(t)).url:"/patientProfile",this.$router.push(e)},patientIdentifier(t){const e=t.patient_identifiers.length-1;return e>=0?t.patient_identifiers[e].identifier:""},async buildPersonalInformation(){var t,e,i,a,n,r,s,l;const c=null===(t=o(this.currentLocation,"closestLandmark","value"))||void 0===t?void 0:t.name,d=o(this.currentLocation,"Other (specify)","value"),h="Other"===c?d:c;this.personInformation[0].selectedData={given_name:o(this.personInformation,"firstname","value"),middle_name:o(this.personInformation,"middleName","value"),family_name:o(this.personInformation,"lastname","value"),gender:this.gender,birthdate:o(this.personInformation,"birthdate","value"),birthdate_estimated:"false",home_region:await this.getRegion(null===(e=o(this.homeLocation,"home_district","value"))||void 0===e?void 0:e.name)||await this.getRegion(null===(i=o(this.country,"country","value"))||void 0===i?void 0:i.name),home_district:null===(a=o(this.homeLocation,"home_district","value"))||void 0===a?void 0:a.name,home_traditional_authority:null===(n=o(this.homeLocation,"home_traditional_authority","value"))||void 0===n?void 0:n.name,home_village:null===(r=o(this.homeLocation,"home_village","value"))||void 0===r?void 0:r.name,current_region:await this.getRegion(this.current_district),current_district:this.current_district,current_traditional_authority:this.current_traditional_authority,current_village:this.current_village,country:null===(s=o(this.country,"country","value"))||void 0===s?void 0:s.name,landmark:h,cell_phone_number:o(this.personInformation,"phoneNumber","value"),occupation:u(this.socialHistory,"occupation"),marital_status:u(this.socialHistory,"maritalStatus"),religion:null===(l=o(this.socialHistory,"religion","value"))||void 0===l?void 0:l.name,education_level:u(this.socialHistory,"highestLevelOfEducation")}},setDisplayType(t){Nt().setRegistrationDisplayType(t),this.setIconClass()},setIconClass(){this.iconListStatus="inactive_icon",this.iconGridStatus="inactive_icon","list"==this.registrationDisplayType?this.iconListStatus="active_icon":"grid"==this.registrationDisplayType&&(this.iconGridStatus="active_icon")}}}),Jt={key:0,class:"spinner-overlay"},Xt={class:"header position_content"},Kt={style:{display:"flex","align-items":"center"}},Qt={class:"container"},Zt={class:"title"},te={class:"demographics_title"},ee={class:"icon_div displayNoneMobile"},ie={key:0,class:"center_content"},ae={key:0,class:"flex-container"},ne={class:"flex-item"},oe={class:"flex-item"},re={class:"flex-item"},se={key:1},le={key:0},ce={key:1},de={style:{"justify-content":"center"}},ue={key:0},he={key:1},pe={key:2},ve={key:3},ge={key:4},me={key:1,class:"footer2"},ye={class:"footer position_content"};t("default",s(Yt,[["render",function(t,e,i,a,n,o){const r=V("ion-spinner"),s=V("ion-icon"),l=V("ion-header"),c=V("PersonalInformation"),d=V("Country"),u=V("CurrentLocation"),h=V("HomeLocation"),p=V("PatientType"),v=V("SocialHistory"),g=V("BirthRegistration"),m=V("GuardianInformation"),y=V("ion-content"),f=V("DynamicButton"),_=V("ion-breadcrumb"),b=V("ion-breadcrumbs"),I=V("ion-footer"),D=V("ion-page");return J(),Y(D,{class:Dt({loading:t.isLoading})},{default:lt(()=>[t.isLoading?(J(),nt("div",Jt,[rt(r,{name:"bubbles"}),e[11]||(e[11]=st("div",{class:"loading-text"},"Please wait...",-1))])):ot("",!0),rt(l,null,{default:lt(()=>[st("div",Xt,[st("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=e=>t.nav("/home"))},[rt(s,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeft},null,8,["icon"]),e[12]||(e[12]=st("span",{style:{"padding-left":"10px"}},"Go back",-1))]),e[14]||(e[14]=st("div",null,null,-1)),st("div",Kt,[rt(s,{slot:"separator",size:"large",icon:t.iconsContent.help},null,8,["icon"]),e[13]||(e[13]=st("span",{style:{"padding-left":"10px"}}," Need any help?",-1))])])]),_:1}),rt(y,null,{default:lt(()=>[st("div",Qt,[st("div",Zt,[st("div",te,"New "+ct(33!=t.programID()?"patient":"client")+" registration ",1)]),st("div",ee,[rt(s,{class:Dt(t.iconListStatus),icon:t.list,onClick:e[1]||(e[1]=e=>t.setDisplayType("list"))},null,8,["class","icon"]),rt(s,{class:Dt(t.iconGridStatus),style:{"font-size":"21px","margin-top":"1.5px"},icon:t.grid,onClick:e[2]||(e[2]=e=>t.setDisplayType("grid"))},null,8,["class","icon"])])]),"grid"==t.registrationDisplayType&&t.screenWidth>991?(J(),nt("div",ie,["grid"==t.registrationDisplayType?(J(),nt("div",ae,[st("div",ne,[rt(c)]),st("div",oe,[rt(d),"Malawi"==t.regSelectedCountry?(J(),Y(u,{key:0})):ot("",!0),"Malawi"==t.regSelectedCountry?(J(),Y(h,{key:1})):ot("",!0)]),st("div",re,[t.isPatientTypeRequired?(J(),Y(p,{key:0,ref:"patientTypeComponent"},null,512)):ot("",!0),t.checkUnderFourteen?(J(),Y(v,{key:1})):ot("",!0),t.checkUnderNine?(J(),Y(g,{key:2})):ot("",!0),rt(m)])])):ot("",!0)])):ot("",!0),"list"==t.registrationDisplayType||t.screenWidth<=991?(J(),nt("div",se,["Personal Information"==t.currentStep?(J(),nt("div",le,[rt(c)])):ot("",!0),"Location"==t.currentStep?(J(),nt("div",ce,[st("div",de,[st("div",null,[rt(d)]),"Malawi"==t.regSelectedCountry?(J(),nt("div",ue,[rt(u)])):ot("",!0),"Malawi"==t.regSelectedCountry?(J(),nt("div",he,[rt(h)])):ot("",!0)])])):ot("",!0),"Patient Type"==t.currentStep&&t.isPatientTypeRequired?(J(),nt("div",pe,[rt(p,{ref:"patientTypeComponent"},null,512)])):ot("",!0),"Social History"==t.currentStep?(J(),nt("div",ve,[t.checkUnderFourteen?(J(),Y(v,{key:0})):ot("",!0),t.checkUnderFive?(J(),Y(g,{key:1})):ot("",!0)])):ot("",!0),"Guardian Information"==t.currentStep?(J(),nt("div",ge,[rt(m)])):ot("",!0)])):ot("",!0)]),_:1}),"grid"==t.registrationDisplayType&&t.screenWidth>991?(J(),nt("div",me,[rt(f,{name:"Save",iconSlot:"end",icon:t.iconsContent.saveWhite,disabledValue:t.disableSaveBtn,onClick:e[3]||(e[3]=e=>t.createPatient())},null,8,["icon","disabledValue"])])):ot("",!0),"list"==t.registrationDisplayType||t.screenWidth<=991?(J(),Y(I,{key:2},{default:lt(()=>[st("div",ye,["Personal Information"==t.currentStep?(J(),Y(f,{key:0,name:"Cancel",color:"danger",onClick:e[4]||(e[4]=e=>t.cancel(e))})):(J(),Y(f,{key:1,name:"Previous",icon:t.iconsContent.arrowLeftWhite,color:"medium",onClick:t.previousStep},null,8,["icon","onClick"])),rt(b,{class:"breadcrumbs displayNoneMobile"},{default:lt(()=>[rt(_,{onClick:e[5]||(e[5]=e=>t.setCurrentStep("Personal Information")),class:Dt({active:"Personal Information"===t.currentStep})},{separator:lt(()=>[rt(s,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:lt(()=>[e[15]||(e[15]=st("span",{class:"breadcrumb-text"},"Personal Information",-1))]),_:1,__:[15]},8,["class"]),rt(_,{onClick:e[6]||(e[6]=e=>t.setCurrentStep("Location")),class:Dt({active:"Location"===t.currentStep})},{separator:lt(()=>[rt(s,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:lt(()=>[e[16]||(e[16]=st("span",{class:"breadcrumb-text"},"Location",-1))]),_:1,__:[16]},8,["class"]),t.isPatientTypeRequired?(J(),Y(_,{key:0,onClick:e[7]||(e[7]=e=>t.setCurrentStep("Patient Type")),class:Dt({active:"Patient Type"===t.currentStep})},{separator:lt(()=>[rt(s,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:lt(()=>[e[17]||(e[17]=st("span",{class:"breadcrumb-text"},"Patient Type",-1))]),_:1,__:[17]},8,["class"])):ot("",!0),rt(_,{onClick:e[8]||(e[8]=e=>t.setCurrentStep("Social History")),class:Dt({active:"Social History"===t.currentStep})},{separator:lt(()=>[rt(s,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:lt(()=>[e[18]||(e[18]=st("span",{class:"breadcrumb-text"},"Social History",-1))]),_:1,__:[18]},8,["class"]),rt(_,{onClick:e[9]||(e[9]=e=>t.setCurrentStep("Guardian Information")),class:Dt({active:"Guardian Information"===t.currentStep})},{separator:lt(()=>[rt(s,{size:"large",icon:t.iconsContent.arrowRight},null,8,["icon"])]),default:lt(()=>[e[19]||(e[19]=st("span",{class:"breadcrumb-text"},"Guardian Information",-1))]),_:1,__:[19]},8,["class"])]),_:1}),"Guardian Information"==t.currentStep?(J(),Y(f,{key:2,name:"Save",iconSlot:"end",icon:t.iconsContent.saveWhite,onClick:e[10]||(e[10]=e=>t.createPatient())},null,8,["icon"])):(J(),Y(f,{key:3,name:"Next",disabledValue:!1,iconSlot:"end",icon:t.iconsContent.arrowRightWhite,onClick:t.nextStep},null,8,["icon","onClick"]))])]),_:1})):ot("",!0)]),_:1},8,["class"])}],["__scopeId","data-v-a90896a5"]]))}}});

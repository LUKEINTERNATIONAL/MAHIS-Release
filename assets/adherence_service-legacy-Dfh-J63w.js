!function(){function e(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}System.register(["./app_encounter_service-legacy-LJRPnsbp.js","./index-legacy-CAqY44sk.js","./lodash-legacy-C-x9g9Na.js","./vendor-legacy-PwJwfeg2.js"],(function(t,n){"use strict";var r,a,i,s,u;return{setters:[e=>{r=e.A},e=>{a=e.Q,i=e.H},e=>{s=e.l},e=>{u=e.O}],execute:function(){class n extends r{constructor(e,t){super(e,48,t)}static getAllBpDrugs(){return r.getJson("bp_drugs")}static getBpGrade(e,t){return e<140&&t<90?"normal":e>=140&&e<160||t>=100&&t<110?"grade 1":e>=180&&t>110||e>=180?"grade 3":e>=160&&e<180||t>=110?"grade 2":"N/A"}static isBpNormotensive(e){const[t,n]=Object.values(e).sort(((e,t)=>e.date<t.date?1:0)).map((e=>this.getBpGrade(e.sbp,e.dbp)));return"normal"===t&&"normal"===n}getSystolicBp(){return a.getFirstValueNumber(this.patientID,"Systolic blood pressure")}getDiastolicBp(){return a.getFirstValueNumber(this.patientID,"Diastolic blood pressure")}async onBpDrugs(){const e=await a.getFirstValueCoded(this.patientID,"Treatment status");return!!e&&"Yes"===e}async getBPTrail(){return await r.getJson(`/patients/${this.patientID}/bp_trail`)}async getCurrentDrugs(){return await r.getJson(`/patients/${this.patientID}/current_bp_drugs`)}async getLastDrugs(){return await r.getJson(`/patients/${this.patientID}/last_bp_drugs_dispensation`)}async getAdherence(e,t){return await r.postJson(`/patients/${this.patientID}/remaining_bp_drugs`,{drug_id:e,pills:t})}async enrollPatient(e){return await r.postJson(`/patients/${this.patientID}/update_or_create_htn_state`,e)}static htnDrugReferences(){return[{drug_id:275,drug_name:"HCTZ (25mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:942,drug_name:"Enalapril (5mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:943,drug_name:"Enalapril (10mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:558,drug_name:"Amlodipine (5mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:559,drug_name:"Amlodipine (10mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:117,drug_name:"Atenolol (50mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:116,drug_name:"Atenolol(100mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"}]}getDrugs(){return{HCTZ:{drugs:[{drugName:"HCTZ (25mg tablet)",drugID:275,amount:"25mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null}],selected:null,notes:[]},Enalapril:{drugs:[{drugName:"Enalapril (5mg tablet)",drugID:942,amount:"5mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Enalapril (10mg tablet)",drugID:943,amount:"10mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]},Amlodipine:{drugs:[{drugName:"Amlodipine (5mg tablet)",drugID:558,amount:"5mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Amlodipine (10mg tablet)",drugID:559,amount:"10mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]},Atenolol:{drugs:[{drugName:"Atenolol (50mg tablet)",drugID:117,amount:"50mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Atenolol(100mg tablet)",drugID:116,amount:"100mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]}}}}t("A",class extends r{constructor(t,n){super(t,68,n),e(this,"lastDrugs",void 0),e(this,"lastReceiptDate",void 0),this.lastDrugs=[],this.lastReceiptDate=""}async loadPreviousDrugs(e=!1){const t=new Date(this.date);t.setDate(t.getDate()-1);const a=e=>i.toStandardHisFormat(e),u=await r.getJson(`patients/${this.patientID}/drugs_received`,{date:a(t)});if(!s.isEmpty(u)){this.lastReceiptDate=u.reduce(((e,t)=>!e||new Date(a(t.order.start_date))>new Date(e)?a(t.order.start_date):e),null);const t=n.htnDrugReferences().map((e=>e.drug_id));if(this.lastDrugs=u.filter((e=>!t.includes(e.drug.drug_id)&&a(e.order.start_date)===this.lastReceiptDate)),e){const e=await this.getPreviousDrugPillCount()||{};this.lastDrugs=this.lastDrugs.map((t=>(e[t.drug.drug_id]&&t.quantity&&(t.quantity+=e[t.drug.drug_id]),t)))}}}getReceiptDate(){return this.lastReceiptDate}getLastDrugs(){return this.lastDrugs}receivedDrugsBefore(){return!0;/*!isEmpty(this.lastDrugs)*/}buildPillCountObs(e,t){return this.buildValueNumber("Number of tablets brought to clinic",t,null,e)}getPreviousDrugPillCount(){return r.getJson("last_drugs_pill_count",{patient_id:this.patientID,program_id:this.programID,date:this.lastReceiptDate})}async buildAdherenceObs(e,t,n,a=r.getSessionDate()){return{concept_id:await r.getConceptID("Drug order adherence",!0),value_numeric:n,value_drug:t,value_modifier:"%",order_id:e,person_id:this.patientID,obs_datetime:a}}isAdherenceGood(e){return e>=95&&e<=105}calculateAdherence(e,t,n){return Math.round(100*(e-t)/(e-n))}calculateExpected(e,t,n,r){const a="QW"===r?"week":"day";return e-this.calcTimeElapsed(n,a)*parseFloat(t.toString())}calcTimeElapsed(e,t){return u(i.toStandardHisFormat(this.date)).diff(i.toStandardHisFormat(e),t)+1}calculateUnaccountedOrMissed(e,t){const n=parseFloat(e)-parseFloat(t);return n<0?-1*n+" missed":n+" unacc"}})}}}))}();

import{d as z,aI as A,O as C,f as u,J as e,l,u as t,G as O,E as Q,Q as c,K as f,aY as U,N as w,bj as P,a8 as B,a9 as R,aP as S,aM as x,k as a,e as m,F as k,P as T,a7 as F,R as $,r as _,a as j,w as H,aO as J,aN as K,m as W,ad as Y,a2 as q,_ as X,bn as Z,bo as ee,aa as te}from"./vendor-DfayhWEV.js";import{aQ as ae,u as le,_ as L,I as V,aD as y,aC as D,T as ne,bU as ie}from"./index-3VO6Sqm_.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-CMSjZAwK.js";const se={class:"appointments-table"},oe=z({__name:"DuplicateDetailsModal",props:{patients:{},identifierLabel:{}},setup(g){const h=A();function I(){$.dismiss()}async function p(r){await ae(),await le().setPatientRecord(r),h.replace({path:"/patientProfile"}),I()}return(r,o)=>(u(),C(t(F),null,{default:e(()=>[l(t(O),null,{default:e(()=>[l(t(Q),null,{default:e(()=>[c("Duplicate Details for "+f(g.identifierLabel),1)]),_:1}),l(t(U),{slot:"end"},{default:e(()=>[l(t(w),{onClick:I},{default:e(()=>[...o[0]||(o[0]=[c("Close",-1)])]),_:1})]),_:1})]),_:1}),l(t(P),null,{default:e(()=>[l(t(B),null,{default:e(()=>[l(t(R),{size:"12","size-md":"10","offset-md":"1"},{default:e(()=>[l(t(S),null,{default:e(()=>[l(t(x),{class:"table-responsive"},{default:e(()=>[a("table",se,[o[2]||(o[2]=a("thead",null,[a("tr",null,[a("th",null,"Given Name"),a("th",null,"Family Name"),a("th",null,"Gender"),a("th",null,"Birth Date"),a("th",null,"Action")])],-1)),a("tbody",null,[(u(!0),m(k,null,T(g.patients,d=>(u(),m("tr",{key:d.person_id},[a("td",null,f(d.given_name),1),a("td",null,f(d.family_name),1),a("td",null,f(d.gender),1),a("td",null,f(d.birthdate),1),a("td",null,[l(t(w),{size:"small",fill:"clear",onClick:b=>p(d.patient)},{default:e(()=>[...o[1]||(o[1]=[c(" View Details ",-1)])]),_:1},8,["onClick"])])]))),128))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),re=L(oe,[["__scopeId","data-v-0a1b5e58"]]),ue={key:0,class:"table-responsive"},de={class:"appointments-table"},fe={key:1,class:"ion-text-center ion-padding"},ce=z({__name:"ARTDuplicates",setup(g){const h=A(),I=_("Duplicate Identifiers"),p=_([]),r=_(null),o=_([]),d=_(!1),b=_(new V);j(async()=>{await y.show();try{const i=await V.getIdentifierTypes();p.value=i.map(n=>({label:n.name,value:n.patient_identifier_type_id})),p.value.length>0&&(r.value=p.value[0].value)}catch(i){console.error("Error initializing:",i),D("Failed to load identifier types")}finally{await y.hide()}}),H(r,async i=>{i&&await E()});async function E(){if(r.value){await y.show();try{const i=p.value.find(s=>s.value===r.value);I.value=i?"".concat(i.label," Duplicates"):"Duplicate Identifiers",b.value.setIdentifierType(r.value);const n=await b.value.getDuplicateIndentifiers();o.value=Array.isArray(n)?n:[],d.value=!0}catch(i){console.error("Error fetching duplicates:",i),D("Failed to fetch duplicate identifiers"),o.value=[]}finally{await y.hide()}}}async function G(i){await y.show();try{const s=(await b.value.getPatientsByIdentifier(i)).map(v=>{try{return{person_id:v.patient_id,given_name:v.person.names[0].given_name,family_name:v.person.names[0].family_name,gender:v.person.gender,birthdate:ie(v.person.birthdate),patient:v}}catch(pe){return{person_id:0,given_name:"N/A",family_name:"N/A",gender:"N/A",birthdate:"N/A",patient:{}}}});await(await $.create({component:re,componentProps:{patients:s,identifierLabel:i},cssClass:"large-modal"})).present()}catch(n){console.error("Error viewing duplicate details:",n),D("Failed to load patient details")}finally{await y.hide()}}function M(i){h.push("/npid/duplicates/".concat(i))}return(i,n)=>(u(),C(t(te),null,{default:e(()=>[l(ne,{title:"Duplicate Identifiers"}),l(t(F),null,{default:e(()=>[l(t(P),null,{default:e(()=>[l(t(B),null,{default:e(()=>[l(t(R),{size:"12","size-md":"10","size-lg":"8","offset-md":"1","offset-lg":"2"},{default:e(()=>[l(t(S),null,{default:e(()=>[l(t(J),null,{default:e(()=>[l(t(K),null,{default:e(()=>[c(f(I.value),1)]),_:1})]),_:1}),l(t(x),null,{default:e(()=>[l(t(Y),null,{default:e(()=>[l(t(q),null,{default:e(()=>[l(t(X),{position:"stacked"},{default:e(()=>[...n[1]||(n[1]=[c("Select Identifier Type",-1)])]),_:1}),l(t(Z),{modelValue:r.value,"onUpdate:modelValue":n[0]||(n[0]=s=>r.value=s)},{default:e(()=>[(u(!0),m(k,null,T(p.value,s=>(u(),C(t(ee),{key:s.value,value:s.value},{default:e(()=>[c(f(s.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o.value.length>0?(u(),m("div",ue,[a("table",de,[n[4]||(n[4]=a("thead",null,[a("tr",null,[a("th",null,"Identifier"),a("th",null,"Count"),a("th",null,"View"),a("th",null,"Resolve")])],-1)),a("tbody",null,[(u(!0),m(k,null,T(o.value,s=>(u(),m("tr",{key:s.identifier},[a("td",null,f(s.identifier),1),a("td",null,f(s.count),1),a("td",null,[l(t(w),{size:"small",fill:"outline",onClick:N=>G(s.identifier)},{default:e(()=>[...n[2]||(n[2]=[c(" View ",-1)])]),_:1},8,["onClick"])]),a("td",null,[l(t(w),{size:"small",color:"danger",fill:"outline",onClick:N=>M(s.identifier),disabled:r.value!==3},{default:e(()=>[...n[3]||(n[3]=[c(" Resolve ",-1)])]),_:1},8,["onClick","disabled"])])]))),128))])])])):o.value.length===0&&d.value?(u(),m("div",fe,[...n[5]||(n[5]=[a("p",null,"No duplicate identifiers found",-1)])])):W("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),Ie=L(ce,[["__scopeId","data-v-f930c1ab"]]);export{Ie as default};

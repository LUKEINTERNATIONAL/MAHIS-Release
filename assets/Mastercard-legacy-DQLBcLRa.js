!function(){function e(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var l=t.call(e,a||"default");if("object"!=typeof l)return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}System.register(["./vendor-legacy-B0gGlx_-.js","./index-legacy-BSH1ooKF.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-CsrryGpD.js"],function(a,t){"use strict";var l,n,i,r,o,u,s,d,c,v,b,p,m,g,f,y,h,V,x,_,w,A,I,k,N,R,D,C,P,T,S,E,F,H,B,O,$,M,j,z,G,L,U,K,W,q,Y,J,Q,X,Z,ee,ae,te;return{setters:[e=>{l=e.d,n=e.r,i=e.c,r=e.w,o=e.a,u=e.O,s=e.f,d=e.u,c=e.bg,v=e.J,b=e.l,p=e.G,m=e.E,g=e.Q,f=e.aY,y=e.N,h=e.I,V=e.k,x=e.m,_=e._,w=e.p,A=e.i,I=e.K,k=e.b6,N=e.a0,R=e.e,D=e.bM,C=e.a7,P=e.L,T=e.e4,S=e.bj,E=e.a8,F=e.F,H=e.P,B=e.a9,O=e.aP,$=e.aM,M=e.ad,j=e.a2,z=e.bm,G=e.aa},e=>{L=e.P,U=e.u,K=e.a7,W=e.D,q=e.t,Y=e.I,J=e.K,Q=e._,X=e.bT,Z=e.af,ee=e.bN,ae=e.H},e=>{te=e.l},null],execute:function(){var t=document.createElement("style");t.textContent=".arv-number-modal[data-v-9e415ee0]{--width: 100%;--max-width: 500px;--height: 400px;--max-height: 80vh;--border-radius: 8px}.modal-content[data-v-9e415ee0]{--padding-top: 16px;--padding-bottom: 16px;height:100%;display:flex;flex-direction:column}.modal-title[data-v-9e415ee0]{font-size:1.3rem;font-weight:500;padding-left:15px}.close-button[data-v-9e415ee0]{--color: var(--ion-color-primary)}.form-container[data-v-9e415ee0]{padding:16px}.arv-input-section[data-v-9e415ee0]{margin-bottom:32px}.form-label[data-v-9e415ee0]{font-size:1rem;font-weight:600;color:#333;margin-bottom:12px;display:block}.required[data-v-9e415ee0]{color:#dc3545}.arv-input-container[data-v-9e415ee0]{width:100%}.input-group[data-v-9e415ee0]{display:flex;width:100%;border:1px solid #ddd;border-radius:4px;overflow:hidden;transition:border-color .3s ease}.input-group[data-v-9e415ee0]:focus-within{border-color:var(--ion-color-primary);box-shadow:0 0 0 2px rgba(var(--ion-color-primary-rgb),.2)}.input-group-error[data-v-9e415ee0]{border-color:#dc3545!important;box-shadow:0 0 0 2px rgba(220,53,69,.2)!important}.input-group-text[data-v-9e415ee0]{background-color:#f8f9fa;border:none;padding:12px 16px;color:#6c757d;font-weight:500;font-size:.95rem;display:flex;align-items:center;white-space:nowrap}.form-control[data-v-9e415ee0]{flex:1;border:none;padding:12px 16px;font-size:1rem;outline:none;background:#fff}.form-control[data-v-9e415ee0]:focus{outline:none}.has-error[data-v-9e415ee0]{background-color:#fff5f5}.error-label[data-v-9e415ee0]{color:#dc3545;font-size:.875rem;margin-top:8px;display:block;font-weight:500}.success-label[data-v-9e415ee0]{color:#28a745;font-size:.875rem;margin-top:8px;display:block;font-weight:500}.action-buttons[data-v-9e415ee0]{display:flex;gap:12px;justify-content:flex-end;padding-top:16px;border-top:1px solid #eee}.cancel-button[data-v-9e415ee0]{--padding-start: 20px;--padding-end: 20px;--padding-top: 12px;--padding-bottom: 12px}.save-button[data-v-9e415ee0]{--padding-start: 20px;--padding-end: 20px;--padding-top: 12px;--padding-bottom: 12px;--background: var(--ion-color-primary);min-width:80px}.save-button[data-v-9e415ee0]:disabled{--background: #ccc;--color: #666}@media (max-width: 768px){.arv-number-modal[data-v-9e415ee0]{--width: 95%;--max-width: none}.action-buttons[data-v-9e415ee0]{flex-direction:column-reverse}.cancel-button[data-v-9e415ee0],.save-button[data-v-9e415ee0]{width:100%}}.styled-table[data-v-c750c358]{width:100%;border-collapse:collapse;margin:20px 0;font-size:16px;text-align:left}.styled-table tr>th[data-v-c750c358]{border:1px solid black;padding:10px;color:#fff!important;background-color:#006400;font-weight:700}.styled-table td[data-v-c750c358]{border:1px solid black;padding:10px}.styled-table tr[data-v-c750c358]:nth-child(2n){background-color:#f9f9f9}.styled-table tr[data-v-c750c358]:hover{background-color:#f1f1f1}.modal-content[data-v-c750c358]{padding:20px;text-align:left}.modal-content h3[data-v-c750c358]{margin-bottom:20px}.modal-content ul[data-v-c750c358]{list-style-type:none;padding:0}.modal-content ul li[data-v-c750c358]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(t);class le extends L{constructor(...a){super(...a),e(this,"suggestedNextARVNumber",void 0),e(this,"patientHasARVNumber",!1),e(this,"prependValue","")}async _getArvNumber_(){try{var e;const a=null===(e=U().$state)||void 0===e?void 0:e.patient.patientID;if(!a)return"";const t=await L.findByID(a);if(null==t||!t.patient_identifiers)return"";const l=t.patient_identifiers.find(e=>4==e.identifier_type);return(null==l?void 0:l.identifier)||""}catch(a){return""}}async getARVnumber(){try{const e=await this._getArvNumber_();if("Unknown"!==e){const a=e.split("-");this.suggestedNextARVNumber=a[2].replace(/^\D+|\s/g,""),this.prependValue=`${a[0]}-${a[1]}-`,this.patientHasARVNumber=!0}else{const e=await K.getNextSuggestedARVNumber();this.suggestedNextARVNumber=e.arv_number.replace(/^\D+|\s/g,"")}}catch(e){const a=await K.getNextSuggestedARVNumber();this.suggestedNextARVNumber=a.arv_number.replace(/^\D+|\s/g,"")}return this.suggestedNextARVNumber}async saveARVNumber(e){const a=`${W().$state.globalPropertyStore.sitePrefix}-ARV-${e}`;if(a===await this._getArvNumber_())return void q("ARV number is the same as the current one",5e3);if(await Y.arvNumberExists(a))q("ARV number already exists",5e3);else try{this.patientHasARVNumber?(await this.updateARVNumber(a),J("ARV number updated successfully")):(await this.createArvNumber(a),J("ARV number created successfully"))}catch(t){q(`${t}`)}}}const ne={class:"form-container"},ie={class:"arv-input-section"},re={class:"arv-input-container"},oe={class:"input-group-text"},ue={class:"action-buttons"},se={key:1},de=l({__name:"ArvNumberModal",props:{isOpen:{type:Boolean,required:!0}},emits:["close","arvNumberSaved"],setup(e,{emit:a}){const t=e,l=a,P=W(),T=U(),S=n(""),E=n(""),F=n(""),H=n(!1),B=new le,O=i(()=>P.globalPropertyStore.sitePrefix||"SITE"),$=i(()=>`${O.value}-ARV-${S.value}`),M=()=>{j(),l("close")},j=()=>{S.value="",E.value="",F.value="",H.value=!1},z=e=>{const a=e.target.value.replace(/[^0-9]/g,"");S.value=a,E.value="",F.value="",G()},G=()=>S.value?/^\d+$/.test(S.value)?parseInt(S.value)<=0?(E.value="Number must be positive",!1):(E.value="",!0):(E.value="Only numbers are allowed",!1):(E.value="ARV number is required",!1),K=async()=>{if(G()){H.value=!0,E.value="";try{const t=await B._getArvNumber_(),n=$.value;if(t!==n){if(await Y.arvNumberExists(n))return E.value="ARV number already exists",void(H.value=!1)}await B.saveARVNumber(S.value);try{var e;const a=await L.findByID(null===(e=T.$state)||void 0===e?void 0:e.patient.patientID);a&&await T.setRecord(a)}catch(a){console.warn("Could not update demographics store:",a)}F.value="ARV number saved successfully",J("ARV number updated successfully"),l("arvNumberSaved",n),setTimeout(()=>{M()},1e3)}catch(t){console.error("Error saving ARV number:",t),E.value="Error saving ARV number. Please try again.",q("Failed to save ARV number")}finally{H.value=!1}}};return r(()=>t.isOpen,e=>{e&&(async()=>{try{const e=await B._getArvNumber_();if(e&&"Unknown"!==e&&""!==e){const a=e.split("-");a.length>=3&&(S.value=a[2],B.patientHasARVNumber=!0)}else{const e=await B.getARVnumber();S.value=e,B.patientHasARVNumber=!1}}catch(e){console.error("Error loading current ARV number:",e);try{const e=await B.getARVnumber();S.value=e,B.patientHasARVNumber=!1}catch(a){console.error("Error getting suggested ARV number:",a)}}})()}),o(()=>{P.loadSitePrefix()}),(a,t)=>(s(),u(d(c),{"is-open":e.isOpen,onDidDismiss:M,class:"arv-number-modal"},{default:v(()=>[b(d(h),null,{default:v(()=>[b(d(p),null,{default:v(()=>[b(d(m),{class:"modal-title"},{default:v(()=>[...t[1]||(t[1]=[g("Update ARV Number",-1)])]),_:1}),b(d(f),{slot:"end"},{default:v(()=>[b(d(y),{onClick:M,class:"close-button"},{default:v(()=>[...t[2]||(t[2]=[g("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),b(d(C),{class:"ion-padding modal-content"},{default:v(()=>[V("div",ne,[V("div",ie,[b(d(_),{class:"form-label"},{default:v(()=>[...t[3]||(t[3]=[g("ARV Number ",-1),V("span",{class:"required"},"*",-1)])]),_:1}),V("div",re,[V("div",{class:w(["input-group",{"input-group-error":E.value}])},[V("span",oe,I(O.value)+"-ARV- ",1),A(V("input",{type:"text",class:w(["form-control",{"has-error":E.value}]),"onUpdate:modelValue":t[0]||(t[0]=e=>S.value=e),onInput:z,placeholder:"Enter number",inputmode:"numeric",pattern:"[0-9]*"},null,34),[[k,S.value]])],2)]),E.value?(s(),u(d(N),{key:0,class:"error-label"},{default:v(()=>[g(I(E.value),1)]),_:1})):x("",!0),F.value?(s(),u(d(N),{key:1,class:"success-label"},{default:v(()=>[g(I(F.value),1)]),_:1})):x("",!0)]),V("div",ue,[b(d(y),{color:"danger",fill:"outline",onClick:M,class:"cancel-button"},{default:v(()=>[...t[4]||(t[4]=[g(" Cancel ",-1)])]),_:1}),b(d(y),{onClick:K,disabled:!S.value||!!E.value||H.value,class:"save-button"},{default:v(()=>[H.value?(s(),u(d(D),{key:0,name:"crescent"})):(s(),R("span",se,"Save"))]),_:1},8,["disabled"])])])]),_:1})]),_:1},8,["is-open"]))}}),ce=Q(de,[["__scopeId","data-v-9e415ee0"]]),ve={class:"styled-table"},be={key:0},pe=["innerHTML"],me={key:1},ge={class:"modal-content"};a("default",Q(l({__name:"Mastercard",setup(e){const a=n([]),t=n([]),l=new L,r=n([]),w=n(!1),A=n([]),k=n(!1),N=n(!1),D=i(()=>te.chunk(t.value,7)),U=n(!1),W=n(!1);function q(e){return a.value.includes(e)?"Yes":"No"}async function Y(){for(const a of t.value){if("function"==typeof a.init)try{await a.init()}catch(e){a.value="Error occurred",console.error("Error initializing card item",a,e)}"function"==typeof a.condition?a.visible=a.condition():a.visible=!0,"function"==typeof a.asyncValue?a.asyncValue(a).then(e=>a.value=e||"").catch(e=>{a.value="Error occurred",console.error("Error loading async value for card item",a,e)}):"function"==typeof a.staticValue&&(a.value=a.staticValue())}}function J(e){!function(e){const a=e=>e.map(([e,a])=>`${e} (${a})`).join("/");A.value=[{label:"Outcome",value:e.outcome},{label:"Outcome Date",value:e.outcome_date},{label:"Side effects",value:e.side_effects},{label:"Viral load",value:e.viral_load},{label:"Pills Brought",value:a(e.pills_brought)},{label:"Pills dispensed",value:a(e.pills_dispensed)},{label:"Visit by",value:e.visit_by},{label:"Regimen",value:e.regimen},{label:"Adherence",value:a(e.adherence)},{label:"TB Status",value:e.tb_status},{label:"Height (cm)",value:e.height},{label:"Weight (Kg)",value:e.weight},{label:"BMI",value:e.bmi},{label:"Is pregnant",value:e.isPregnant,visible:l.isFemale()},{label:"Is breastfeeding",value:e.isBreastfeeding,visible:l.isFemale()}]}(e),w.value=!0}function Q(){w.value=!1}function le(e){k.value=!1,Y()}function ne(e){k.value=!1,Y()}async function ie(e){var a;N.value=!1,(null!==(a=t.value)&&void 0!==a?a:[]).find(e=>"ARV Number"===e.label).value=e}return o(()=>{t.value=[{label:"ARV Number",value:"...",asyncValue:async()=>{var e,a,t;const n=await L.findByID(l.getID());return null!==(e=null===(a=(null!==(t=null==n?void 0:n.patient_identifiers)&&void 0!==t?t:[]).find(e=>"ARV Number"===e.type.name))||void 0===a?void 0:a.identifier)&&void 0!==e?e:"Add"},click:()=>{N.value=!0},other:{editable:!0}},{label:"National Patient ID",value:"...",staticValue:()=>l.getNationalID()},{label:"Given Name",value:"...",staticValue:()=>l.getGivenName(),other:{editable:!0,attribute:"given_name",category:"demographics"}},{label:"Family Name",value:"...",staticValue:()=>l.getFamilyName(),other:{editable:!0,attribute:"family_name",category:"demographics"}},{label:"Age",value:"...",staticValue:()=>l.getAge(),other:{editable:!0,attribute:"year_birth_date",category:"demographics"}},{label:"Sex",value:"...",staticValue:()=>l.getGender(),other:{editable:!0,attribute:"gender",category:"demographics"}},{label:"Location",value:"...",staticValue:()=>l.getCurrentVillage(),other:{editable:!0,attribute:"home_region",category:"demographics"}},{label:"Landmark",value:"..."},{label:"Guardian",value:"...",asyncValue:async e=>{const a=await ee.getGuardianDetails(l.getID());return te.isEmpty(a)?(e.other.editable=!0,"Add"):(e.other.editable=!1,a.map(e=>` ${e.name} (${e.relationshipType})`).join(" "))},click:()=>{k.value=!0},other:{editable:!1}},{label:"Init W(KG)",value:"...",asyncValue:()=>l.getInitialWeight()},{label:"Init H(CM)",value:"...",asyncValue:()=>l.getInitialHeight()},{label:"Init BMI",value:"...",asyncValue:()=>l.getInitialBMI()},{label:"init Preg",value:"...",condition:()=>l.isFemale(),asyncValue:()=>l.getInitialObs("Is patient pregnant","value_coded")},{label:"init Breastfeeding",value:"...",condition:()=>l.isFemale(),asyncValue:()=>l.getInitialObs("Is patient breast feeding","value_coded")},{label:"cur Preg",value:"...",condition:()=>l.isFemale(),asyncValue:async()=>await l.isPregnant()?"Yes":"No"},{label:"cur Breastfeeding",value:"...",condition:()=>l.isFemale(),asyncValue:async()=>await l.isBreastfeeding()?"Yes":"No"},{label:"TI",value:"...",asyncValue:()=>Z.getFirstValueCoded(l.getID(),"Ever received ART")},{label:"Agrees to follow up",value:"...",asyncValue:()=>Z.getFirstValueCoded(l.getID(),"Agrees to followup")},{label:"Reason for starting ART",value:"...",asyncValue:()=>Z.getFirstValueCoded(l.getID(),"Reason for ART eligibility")},{label:"HIV test date",value:"...",asyncValue:async()=>{const e=await Z.getFirstValueDatetime(l.getID(),"Confirmatory HIV test date");return e?ae.toStandardHisDisplayFormat(e):""}},{label:"HIV test place",value:"...",asyncValue:()=>Z.getFirstValueText(l.getID(),"Confirmatory HIV test location")},{label:"Date of starting first line ART",value:"...",asyncValue:async()=>{const e=await Z.getFirstValueDatetime(l.getID(),"Date ART started");return e?ae.toStandardHisDisplayFormat(e):""}},{label:"Pulmonary TB within the last 2 years",value:"...",init:async()=>{a.value=await Z.getAllValueCoded(l.getID(),"Who stages criteria present")||[]},staticValue:()=>q("Tuberculosis (PTB or EPTB) within the last 2 years")},{label:"Extra pulmonary TB (EPTB)",value:"...",staticValue:()=>q("Extrapulmonary tuberculosis (EPTB)")},{label:"Pulmonary TB (current)",value:"...",staticValue:()=>q("Pulmonary tuberculosis (current)")},{label:"Kaposis sarcoma",value:"...",staticValue:()=>q("Kaposis sarcoma")}],Y(),(U.value=!1,W.value=!0,L.getPatientVisits(l.getID(),!0).then(e=>{r.value=e.map(e=>[{val:ae.toStandardHisDisplayFormat(e),actualDate:e},{val:"..."},{val:"..."},{val:"..."},{val:"..."},{val:"..."},{val:"..."},{btn:{label:"More"}}])}).finally(()=>{U.value=!0,W.value=!1})).then(()=>async function(){W.value=!0;for(let e=0;e<r.value.length;++e){const a=r.value[e],t=a[0].actualDate,n=l.getID(),i=await K.getCurrentProgramInformation(n,t),o=await K.getMastercardDrugInformation(n,t),u=((null==o?void 0:o.pills_given)||[]).map(e=>`${e.short_name||e.name} <b>(${e.quantity||"?"})</b>`).join("<br/>");if(l.isFemale()){const e=await Z.getFirstObs(n,"Is patient pregnant",t);e&&ae.toStandardHisDisplayFormat(e.obs_datetime)===t&&e.value_coded;const a=await Z.getFirstObs(n,"Is patient breast feeding",t);a&&ae.toStandardHisDisplayFormat(a.obs_datetime)===t&&a.value_coded}a[1].val=i.weight,a[2].val=i.regimen,a[3].val=i.viral_load,a[4].val=i.tb_status,a[5].val=i.outcome.match(/Unk/i)?"Unknown":i.outcome,a[6].val=u,a[7].btn={label:"More",onClick:()=>J(i)}}W.value=!0}()).finally(()=>W.value=!1)}),(e,a)=>(s(),u(d(G),null,{default:v(()=>[b(d(h),null,{default:v(()=>[b(d(p),null,{default:v(()=>[b(d(f),{slot:"start"},{default:v(()=>[b(d(y),{onClick:a[0]||(a[0]=a=>e.$router.back())},{default:v(()=>[b(d(P),{icon:d(T)},null,8,["icon"])]),_:1})]),_:1}),b(d(m),{class:"ion-text-center"},{default:v(()=>[...a[3]||(a[3]=[g("Patient Mastercard",-1)])]),_:1})]),_:1})]),_:1}),b(d(C),null,{default:v(()=>[b(d(S),null,{default:v(()=>[b(d(E),null,{default:v(()=>[(s(!0),R(F,null,H(D.value,(e,a)=>(s(),u(d(B),{"size-lg":"3","size-md":"4","size-sm":"12",key:a},{default:v(()=>[b(d(O),null,{default:v(()=>[b(d($),null,{default:v(()=>[b(d(M),null,{default:v(()=>[(s(!0),R(F,null,H(e,(e,a)=>(s(),u(d(j),{key:a},{default:v(()=>{var a;return[b(d(_),null,{default:v(()=>[g(I(e.label),1)]),_:2},1024),null!=e&&null!==(a=e.other)&&void 0!==a&&a.editable&&e.click?(s(),u(d(y),{key:0,style:{"font-size":"1.2rem","font-weight":"bold"},fill:"clear",slot:"end",onClick:e.click},{default:v(()=>[g(I(e.value||"Edit"),1)]),_:2},1032,["onClick"])):(s(),u(d(_),{key:1,style:{"font-weight":"bold"},slot:"end"},{default:v(()=>[g(I(e.value),1)]),_:2},1024))]}),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),W.value?(s(),u(d(z),{key:0,type:"indeterminate"})):x("",!0),V("table",ve,[a[5]||(a[5]=V("thead",null,[V("tr",null,[V("th",null,"VISIT DATE"),V("th",null,"WEIGHT (Kg)"),V("th",null,"REG"),V("th",null,"VIRAL LOAD"),V("th",null,"TB STATUS"),V("th",null,"OUTCOME"),V("th",null,"PILLS DISPENSED"),V("th",null,"ACTIONS")])],-1)),U.value?(s(),R("tbody",be,[(s(!0),R(F,null,H(r.value,(e,a)=>(s(),R("tr",{key:a},[(s(!0),R(F,null,H(e,(e,a)=>(s(),R("td",{key:a},[e.val?(s(),R("span",{key:0,innerHTML:e.val},null,8,pe)):e.btn&&"function"==typeof(null==e?void 0:e.btn.onClick)?(s(),u(d(y),{key:1,onClick:e.btn.onClick},{default:v(()=>[g(I(e.btn.label),1)]),_:2},1032,["onClick"])):x("",!0)]))),128))]))),128))])):(s(),R("tbody",me,[(s(),R(F,null,H(6,e=>V("tr",{key:e},[...a[4]||(a[4]=[V("td",null,"...",-1),V("td",null,"...",-1),V("td",null,"...",-1),V("td",null,"...",-1),V("td",null,"...",-1),V("td",null,"...",-1),V("td",null,"...",-1),V("td",null,"...",-1)])])),64))]))]),b(d(c),{"is-open":w.value,onIonModalDidDismiss:Q},{default:v(()=>[V("div",ge,[a[7]||(a[7]=V("h3",null,"Details",-1)),V("ul",null,[(s(!0),R(F,null,H(A.value,e=>(s(),R("li",{key:e.label},[V("strong",null,I(e.label)+":",1),g(" "+I(e.value),1)]))),128))]),b(d(y),{expand:"block",onClick:Q},{default:v(()=>[...a[6]||(a[6]=[g("Close",-1)])]),_:1})])]),_:1},8,["is-open"]),b(X,{isOpen:k.value,onClose:a[1]||(a[1]=e=>k.value=!1),onGuardianSelected:le,onWhenSaved:ne},null,8,["isOpen"]),b(ce,{isOpen:N.value,onClose:a[2]||(a[2]=e=>N.value=!1),onArvNumberSaved:ie},null,8,["isOpen"])]),_:1})]),_:1}))}}),[["__scopeId","data-v-c750c358"]]))}}})}();

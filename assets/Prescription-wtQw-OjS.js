import{d as j,d6 as K,ad as X,ae as J,M as Z,J as ee,W as te,bN as ie,d7 as ne,cu as se,ct as ae,D as oe,G as re,I as le,d$ as H,K as ce,e0 as de,e1 as A,E as S,e as u,f as l,k as n,i as O,l as g,v as R,z as y,F as I,L as P,A as _,B as c,y as U,m as T,p as V,d2 as ue}from"./vendor--FxeD1z3.js";import{C as me,P as E,R as B}from"./prescription_service-BJ-la-KK.js";import{cp as C,cn as he,cr as pe,cs as ge,I as fe,u as ve,ct as be,l as $,a2 as ye,cu as Se,cv as x,cw as Ie,_ as Pe}from"./index-BwanHY4k.js";import{u as Ce}from"./Arrays-CfBll-2n.js";import{P as _e}from"./patient_type_service-CxLb0Ljb.js";import{l as L}from"./lodash-Dt8AsbQm.js";import"./app_encounter_service-Btkwsnyb.js";var G=(e=>(e.ARV_REGIMENS="arv_regimens",e.INTERVAL_SELECTION="next_visit_interval",e))(G||{}),z=(e=>(e.EXIT="exit",e.CONTINUE="continue",e))(z||{}),W=(e=>(e.ON_VALUE="onValue",e.ON_BUILD="onBuild",e.BEFORE_NEXT="beforeNext",e))(W||{});const we={"Do not prescribe LPV regimens together with 3HP":{priority:1,actions:{alert:async({regimenName:e})=>(await C("3HP - LPV/r conflict",e,"Regimens containing LPV/r <b>cannot</b> be prescribed together with 3HP",[{name:"Close",slot:"end",color:"danger"}],"his-danger-color"),"exit")},target:"arv_regimens",targetEvent:"onValue",conditions:{regimenCode(e){return[7,8,9,10,11,12].includes(e)},medicationOrders(e){return e.filter(t=>!!"".concat(t).match(/3hp/i)).length>=1}}},"Check for any adverse effects or contraindications associated with the regimen":{priority:1,actions:{alert:async({regimenCodeStr:e,sideEffectsTable:t})=>{const{columns:i,rows:o}=t;return await ge("Contraindications / Side effects for ".concat(e),"",i,o,[{name:"Select other regimen",slot:"start"},{name:"Keep selected regimen",slot:"end",color:"danger"}],"his-danger-color")==="Select other regimen"?"exit":"continue"}},target:"arv_regimens",targetEvent:"beforeNext",conditions:{hasSideEffects(e){return e},lastSideEffectDate(e,{currentDate:t}){return e>=t}}},"Recommend 2nd line regimen to children under 3":{priority:1,actions:{alert:async()=>await pe("Recommendation","",["Children under 3 years often have a high viral load and may be infected with drug-resistant HIV from previous exposure to ARVs (mother's ART and/or infant nevirapine prophylaxis)","Therefore, children under <b>3 years</b> respond better when <b>started immediately on 2nd line regimen</b> (Regimen <b>11</b>)"],[{name:"Select another regimen",slot:"start"},{name:"Keep selected regimen",slot:"end",color:"danger"}],"his-warning-color")==="Select another regimen"?"exit":"continue"},target:"arv_regimens",targetEvent:"beforeNext",conditions:{age(e){return e<3},regimenCode(e){return e!=11}}},"Provide a reason for switching regimens when patient already has one":{priority:1,actions:{alert:async e=>{const t=await he("Are you sure you want to replace ".concat(e.currentRegimenStr,"?"),"Specify reason for switching regimen",["Policy change","Ease of administration (pill burden, swallowing)","Drug drug interaction","Pregnancy intention","Side effects","Treatment failure","Weight Change","Other"],[{name:"Cancel",slot:"start",color:"danger"},{name:"Continue",slot:"end",role:"action"}]);return t.selection&&t.action!="Cancel"?(e.reasonForSwitch=t.selection,"continue"):"exit"}},target:"arv_regimens",targetEvent:"onValue",conditions:{regimenCode(e,{currentRegimenCode:t}){return t!=-1&&e!=t}}},"Provide 14 day starter pack for LPV regimens for children under 3 years old":{priority:3,actions:{alert:async e=>await C("Starter pack needed for 14 days","".concat(e.treatmentInitiationState),"".concat(e.regimenName),[{name:"Cancel",slot:"start",color:"danger"},{name:"Prescribe starter pack",slot:"end"}],"his-info-color")==="Prescribe starter pack"?(e.starterPackNeeded=!0,"continue"):"exit"},target:"arv_regimens",targetEvent:"beforeNext",conditions:{age(e){return e<3},regimenCode(e){return e===11},treatmentInitiationState(e){return["Initiation","Re-initiation"].includes(e)}}},"Provide 14 day starter pack for NVP based regimens on newly initiated/re-initiation patients":{priority:3,actions:{alert:async e=>await C("Starter pack needed for 14 days","".concat(e.treatmentInitiationState),"".concat(e.regimenName),[{name:"Cancel",slot:"start",color:"danger"},{name:"Prescribe starter pack",slot:"end"}],"his-info-color")==="Prescribe starter pack"?(e.starterPackNeeded=!0,"continue"):"exit"},target:"arv_regimens",targetEvent:"beforeNext",conditions:{regimenCode(e){return[0,2,6].includes(e)},treatmentInitiationState(e){return["Initiation","Re-initiation"].includes(e)}}},"Ask to reuse hanging pills if any":{priority:5,actions:{alert:async e=>(await C("Hanging pills recommendation","Add hanging pills?","",[{name:"No",slot:"start",color:"warning"},{name:"Yes",slot:"end"}],"his-info-color")==="Yes"?e.hangingPillsStatus="Optimize - including hanging pills":e.hangingPillsStatus="Exact - excluding hanging pills","continue")},target:"next_visit_interval",targetEvent:"beforeNext",conditions:{drugs(e,{hangingPills:t}){return e.map(o=>t.includes(o)).some(Boolean)}}},"Provide warning of use of DTG regimen to women of reproductive age":{priority:2,actions:{alert:async({regimenName:e})=>await C("Use of DTG or EFV in women of reproductive age",e,["There is currently <u>no confirmation</u>","that <b>DTG</b> is safe in <u>very early pregnancy</u>","DTG-based regimens are therefore not used as standard 1st line regimens for","<u>girls and women</u> who may get pregnancy"].join(" "),[{name:"Select another regimen",slot:"start"},{name:"Continue with regimen",slot:"end",color:"danger"}],"his-danger-color")==="Select another regimen"?"exit":"continue"},target:"arv_regimens",targetEvent:"beforeNext",conditions:{regimenCode(e){return e>=12},isChildBearing(e){return e}}},"Provide pallet options for LPV regimens for patient's whose weight is between 3 and 25 kgs":{priority:6,actions:{alert:async e=>{const t=await C("Pellets (cups) / Tabs","","Prescribe LPV/r in <b>Pellets (cups)</b> or <b>Tablets</b>?",[{name:"Granules",slot:"start"},{name:"Pellets",slot:"end"},{name:"Tabs",slot:"end"}],"his-info-color");return e.lpvType=t.toLowerCase(),"continue"}},target:"arv_regimens",targetEvent:"beforeNext",conditions:{weight(e){return e>=3&&e<=25},regimenCode(e){return e===11||e===9}}},"Provide 14 day interval for NVP or LVP Regimen starter pack":{priority:1,data:{enabled:!1},target:"next_visit_interval",targetEvent:"onBuild",conditions:{prescriptionType(e){return e==="Regimen"},selectedInterval(e){return e>14},starterPackNeeded(e){return e},regimenCode(e){return[0,2,6,11].includes(e)}}},"Restrict Emergency supply prescription to 1 month":{priority:1,data:{enabled:!1},target:"next_visit_interval",targetEvent:"onBuild",conditions:{selectedInterval:e=>e>28,patientType:e=>e==="Emergency supply"}},"Provide intervals upto 1 month, 2nd up to 2 months, and 3rd up to 6 months for Patients receiving TPT":{priority:2,data:{enabled:!1},target:"next_visit_interval",targetEvent:"onBuild",conditions:{prescriptionType(e){return e==="Regimen"},medicationOrders(e){return e.map(t=>!!"".concat(t).match(/3hp/i)).some(Boolean)},tptPrescriptionCount(e,{selectedInterval:t}){return Math.round(t/30)>e}}}},ke={"Rifapentine or isoniazid should be taken weekly":{concept:"Weekly (QW)",priority:1,conditions:{drug(e){return"".concat(e).match(/Rifapentine|Isoniazid/i)}}},"Use daily frequency for any other drugs":{concept:"Daily (QOD)",priority:2,conditions:{drug(e){return!"".concat(e).match(/Rifapentine|Isoniazid/i)}}}};function Oe(e,t){const i=[],o=[-1,"",null,void 0];for(const d in t){if(!(d in e))continue;const m=e[d];if(o.includes(m)){i.push(!1);continue}i.push(t[d](m,e))}return i.every(Boolean)}function Re(e){return e.sort((t,i)=>t.priority&&i.priority&&t.priority<i.priority?-1:1)}function Ve(e){return e.sort((t,i)=>t.weight&&i.weight&&t.weight>i.weight?-1:1)}function q(e,t,i="",o="",d="priority"){const m=[];for(const a in t){const h=t[a];[h.target&&i&&h.target!=i,h.targetEvent&&o&&h.targetEvent!=o].some(Boolean)||Oe(e,h.conditions)&&(h.title=a,h.description&&(h.description.text=h.description.info(e)),m.push(h))}return d==="priority"?Re(m):Ve(m)}const De=j({name:"Prescription",data(){return{toDisplayFmt:x,toDisplayGenderFmt:Ie,accordionState:{allergySection:!0,medicationSection:!1,arvRegimensSection:!1,nextVisitSection:!1},consultation:A({}),prescription:A({}),chevronUp:de,chevronDown:ce,reasonsForOver6Months:"",route:"",providerID:1,patientID:-1,facts:{age:-1,gender:"",weight:50,currentDate:"",isChildBearing:!1,isPregnant:!1,isBreastfeeding:!1,prescriptionType:"",patientType:"",tbStatus:"",tptStatus:{},tptPrescriptionCount:0,currentRegimenCode:-1,currentRegimenStr:"",drug:"",drugs:[],contraindications:{},hasSideEffects:!1,sideEffectsTable:{},lastSideEffectDate:"",regimenCode:-1,regimenCodeStr:"",regimenName:"",regimenDrugs:[],hangingPills:[],reasonForSwitch:"",starterPackNeeded:!1,hangingPillsStatus:"",treatmentInitiationState:"",lpvType:"",medicationOrders:[],selectedInterval:0,isEligibleForTpt:!1,customDrugs:[]},arvRegimens:[],medicationOptions:[],selectedRegimen:{},customRegimen:!1,allergyOption:"",Intervaloptions:[{label:"2 weeks",value:14},{label:"1 month",value:28},{label:"2 months",value:56},{label:"3 months",value:84},{label:"4 months",value:112},{label:"5 months",value:140},{label:"6 months",value:168},{label:"7 months",value:196},{label:"8 months",value:224},{label:"9 months",value:252},{label:"10 months",value:280},{label:"11 months",value:308},{label:"12 months",value:336}],allergyOptions:[{label:"Yes",value:"Yes"},{label:"No",value:"No"},{label:"Unknown",value:"Unknown"}],nextVisitInterval:1,selectedMedications:[],medicationRunOutDate:E.getSessionDate(),estimatedPacks:[],customIngredients:[],editableMedication:!1,customIngredientSearch:""}},components:{IonIcon:le,IonItem:re,IonLabel:oe,IonSelect:ae,IonSelectOption:se,IonTextarea:ne,IonCheckbox:ie,IonButton:te,IonAccordion:ee,IonAccordionGroup:Z,IonRadio:J,IonRadioGroup:X,IonNote:K},computed:{prescriptionIntervalSelection(){return this.facts.patientType==="Emergency supply"?this.Intervaloptions.filter(e=>e.value<=28):this.Intervaloptions},noDispensation(){return this.medicationOptions.some(e=>e.value==="none"&&e.isChecked)},over6monthsMedication(){return this.nextVisitInterval>168},filteredIngredients(){if(!this.customIngredientSearch)return this.customIngredients;const e=this.customIngredientSearch.toLowerCase();return this.customIngredients.filter(t=>t.name.toLowerCase().includes(e))}},methods:{isChildBearing(){return this.facts.gender==="F"&&this.facts.age>=12&&this.facts.age<=50},toggleAccordion(e){this.accordionState[e]=!this.accordionState[e]},async onEvent(e,t){var o,d;const i=q(this.facts,we,e,t);for(const m in i){const a=i[m];if((o=a==null?void 0:a.actions)!=null&&o.alert&&await((d=a==null?void 0:a.actions)==null?void 0:d.alert(this.facts))===z.EXIT)return!1}return!0},formatDrugs(e){return e.map(t=>t.alternative_drug_name).join(" + ")},getDrugFrequency(e){this.facts.drug=e;const t=q(this.facts,ke);if(!L.isEmpty(t))return t[0].concept},extractRegimenCode(e){try{return e.match(/n\/a/i)?-1:parseInt(e.substring(0,e.length))}catch(t){return console.warn(t),-1}},buildSideEffectsTable(e){const t=["Date","Contraindication(s)","Side effect(s)"],i=[];for(const o in e){const d=this.facts.contraindications[o]||[];i.push([x(o),d.join(", "),e[o].join(", ")])}return{columns:t,rows:i}},async toggleRegimen(e){if(this.selectedRegimen.name!==e.name){this.facts.lpvType="",this.facts.hangingPillsStatus="",this.facts.starterPackNeeded=!1,this.facts.regimenName="".concat(e.name," (").concat(this.formatDrugs(e.drugs),")"),this.facts.regimenCodeStr=e.name,this.facts.regimenCode=this.extractRegimenCode(e.name),this.facts.regimenDrugs=e.drugs,this.facts.drugs=e.drugs.map(i=>i.drug_id);const t=this.prescription.findAndGroupDrugSideEffects(this.facts.drugs);if(this.facts.hasSideEffects=!L.isEmpty(t),this.facts.sideEffectsTable=this.buildSideEffectsTable(t),!this.onEvent(G.ARV_REGIMENS,W.ON_VALUE))return;this.selectedRegimen=e,this.selectedMedications=e.drugs,this.updateEstimatedPacks()}else this.selectedRegimen={},this.selectedMedications=[]},disableOption(e,t=!0){return{disabled:t,description:{color:"danger",show:"always",text:e}}},validateTPTOption(e){return this.facts.tptStatus.completed?this.disableOption("Completed TPT treatment"):this.facts.tptStatus.tb_treatment?this.disableOption("Completed/on TB treatment"):this.facts.isPregnant?this.disableOption("Pregnant patient"):!this.facts.tptStatus.eligible["3HP"]&&!this.facts.tptStatus.eligible["6H"]?this.disableOption("Not eligible to start or re-start TPT"):this.facts.tptStatus.tpt!==null&&this.facts.tptStatus.tpt!==e?this.disableOption("On ".concat(this.facts.tptStatus.tpt," treatment")):(this.facts.isEligibleForTpt=e.includes("3HP")?this.facts.tptStatus.eligible["3HP"]:this.facts.tptStatus.eligible["6H"],this.facts.isBreastfeeding?this.disableOption("Breastfeeding patient",!1):this.facts.isEligibleForTpt&&this.facts.tptStatus.tpt===e&&!this.facts.tptStatus.completed?{isChecked:!0}:{})},buildTPTOption(e,t,i=0){const o={label:e,value:t,isChecked:!1,disabled:!1};if(i>0&&this.facts.weight<i)return{...o,...this.disableOption("Weight below regulation")};const d=this.validateTPTOption(e);return{...o,...d}},buildMedicationOptions(){this.medicationOptions=[{label:"ARVs",value:"arvs",isChecked:!1},{label:"CPT",value:"cpt",isChecked:!1,...this.allergyOption==="Yes"?this.disableOption("Allergic to sulphur"):{}},this.buildTPTOption("3HP (RFP + INH)","3hp",20),this.buildTPTOption("INH 300 / RFP 300 (3HP)","inh300",30),this.buildTPTOption("IPT","ipt",30),{label:"None",value:"none",isChecked:!1}]},async allergyChange(e){this.allergyOption=e.detail.value},nextVisitIntervalChange(e){const t=new Date;this.nextVisitInterval=e.detail.value,this.medicationRunOutDate=Se(t,this.nextVisitInterval,"days"),this.updateEstimatedPacks()},async onSubmit(){try{const e=[await this.createbuildValueCoded("Allergic to sulphur",this.allergyOption.toString())];this.noDispensation?e.push(await this.consultation.buildValueCoded("Prescribe drugs","No")):(e.push(await this.consultation.buildValueCoded("Prescribe drugs","Yes")),this.medicationOptions.forEach(async i=>{i.isChecked&&e.push(await this.consultation.buildValueCoded("Medication orders",i.label))})),await this.consultation.saveObservationList(e),await this.prescription.createEncounter(),this.prescription.setNextVisitInterval(this.nextVisitInterval);const t=this.selectedMedications.map(i=>this.prescription.toOrderObj(i.drug_id,i.alternative_drug_name||i.drug_name,i.units,i.am,i.pm,i.frequency||this.getDrugFrequency(i.drug_name)));if(await this.prescription.createDrugOrder(t),this.over6monthsMedication){const i=await this.consultation.buildValueCoded("Why prescribe medication for more than 6 months?",this.reasonsForOver6Months);await this.prescription.saveObservationList([i])}return!0}catch(e){return console.error("Error saving prescription:",e),$("Failed to save prescription"),!1}},async createbuildValueCoded(e,t){return await this.consultation.buildValueCoded(e,t)},async handleMedicationSelection(e,t,i){const o=e.detail.checked;if(i.value==="none"){o&&(this.medicationOptions=this.medicationOptions.map((a,h)=>({...a,isChecked:h===t}))),await this.updateSelectedMedications();return}i.value==="arvs"&&(o?(this.accordionState.arvRegimensSection=!0,this.accordionState.nextVisitSection=!0):(this.accordionState.arvRegimensSection=!1,this.accordionState.nextVisitSection=!1));const d=a=>!!a.label.match(/IPT|3HP|INH/i),m=this.medicationOptions.filter(d);if(d(i)){const a=p=>p.label==="3HP (RFP + INH)"||p.label==="INH 300 / RFP 300 (3HP)",h=m.some(p=>p.label==="IPT"&&p.isChecked);if(a(i)&&h&&o){const p=await this.showTPTConflictDialog();p==="Prescribe IPT"?this.medicationOptions=this.medicationOptions.map(r=>({...r,isChecked:a(r)?!1:r.isChecked})):p==="Prescribe 3HP"&&(this.medicationOptions=this.medicationOptions.map(r=>({...r,isChecked:r.label==="IPT"?!1:a(r)?r.label===i.label:r.isChecked}))),await this.updateSelectedMedications();return}if(a(i)&&o&&(this.medicationOptions=this.medicationOptions.map(p=>({...p,isChecked:a(p)?p.label===i.label:p.isChecked}))),i.label==="IPT"&&o&&m.some(r=>a(r)&&r.isChecked)){const r=await this.showTPTConflictDialog();r==="Prescribe IPT"?this.medicationOptions=this.medicationOptions.map(v=>({...v,isChecked:a(v)?!1:v.isChecked})):r==="Prescribe 3HP"&&(this.medicationOptions=this.medicationOptions.map(v=>({...v,isChecked:v.label==="IPT"?!1:v.isChecked}))),await this.updateSelectedMedications();return}}o&&i.value!=="none"&&(this.medicationOptions=this.medicationOptions.map(a=>({...a,isChecked:a.value==="none"?!1:a.isChecked}))),this.medicationOptions[t].isChecked=o,await this.updateSelectedMedications()},isCustomMedicationSelected(e){return this.selectedMedications.some(t=>t.drug_name===e.name)},toggleCustomMedication(e){const t=this.selectedMedications.findIndex(i=>i.drug_name===e.name);if(t>=0)this.selectedMedications.splice(t,1);else{const i={drug_id:e.drug_id,concept_id:e.concept_id,drug_name:e.name,concept_name:e.name,alternative_drug_name:e.name,units:e.units,am:0,noon:0,pm:0,frequency:"Daily (QOD)",pack_size:30,barcodes:[],regimen_category:"Custom"};this.selectedMedications.push(i)}this.updateEstimatedPacks()},addCustomMedication(e){const t={drug_id:e.drug_id,concept_id:e.concept_id,drug_name:e.name,concept_name:e.name,alternative_drug_name:e.name,units:e.units,am:0,noon:0,pm:0,frequency:"Daily (QOD)",pack_size:30,barcodes:[],regimen_category:"Custom"};this.selectedMedications.some(i=>i.drug_name===e.name)||(this.selectedMedications.push(t),this.updateEstimatedPacks())},async updateSelectedMedications(){this.selectedMedications=[];const e=async(t,i,o)=>{if(this.medicationOptions.find(m=>m.value===t&&m.isChecked)){const m=await B.getRegimenExtras(i,this.facts.weight),a=Ce(o?m.filter(o):m,"concept_name");this.selectedMedications.push(...a)}};this.medicationOptions.find(t=>t.value==="arvs"&&t.isChecked)&&this.selectedRegimen.drugs&&this.selectedMedications.push(...this.selectedRegimen.drugs),await e("cpt","Cotrimoxazole",t=>t.frequency==="Daily (QOD)"),await e("3hp","INH / RFP"),await e("inh300","INH / RFP"),await e("ipt","INH",t=>t.frequency==="Daily (QOD)"),this.updateEstimatedPacks()},updateEstimatedPacks(){this.prescription.setNextVisitInterval(this.nextVisitInterval),this.estimatedPacks=this.selectedMedications.map(e=>{const t=this.prescription.getDrugPackSize(e),i=this.prescription.calculatePillsPerDay(e.am,e.noon,e.pm),o=this.prescription.estimatePackSize(i,t);return{name:e.drug_name,quantity:o}})},async initFacts(){const e=await ye.getProgramInformation(this.patientID);this.facts.hangingPills=this.prescription.getHangingPills(),this.facts.treatmentInitiationState=this.prescription.getTreatmentState(),this.facts.currentRegimenStr=e.current_regimen,this.facts.currentRegimenCode=this.extractRegimenCode(e.current_regimen),this.facts.medicationOrders=this.prescription.getMedicationOrders(),this.facts.contraindications=this.prescription.getContraindications(),this.facts.tptPrescriptionCount=this.prescription.getTptPrescriptionCount(),this.facts.lastSideEffectDate=this.prescription.getLastSideEffectDate(),this.facts.currentDate=E.getSessionDate(),this.facts.isChildBearing=this.isChildBearing(),this.facts.tptStatus=await this.consultation.getTptTreatmentStatus(),this.facts.customDrugs=await this.prescription.getCustomIngridients();const t=new _e(this.patientID,this.providerID);await t.loadPatientType(),this.facts.patientType=t.patientType},async showTPTConflictDialog(){return await C("TPT Conflict","You cannot prescribe IPT and 3HP together","Please choose one option",[{name:"Prescribe 3HP",slot:"start",color:"primary"},{name:"Prescribe IPT",slot:"end",color:"primary"}])},async fetchCustomIngredients(){try{const e=new Set;this.customIngredients=this.facts.customDrugs.filter(t=>e.has(t.name)?!1:(e.add(t.name),!0))}catch(e){console.error("Error fetching custom ingredients:",e),$("Failed to load custom ingredients")}}},watch:{nextVisitInterval:{handler(){this.updateEstimatedPacks()}},allergyOption:{handler(){this.buildMedicationOptions()}},medicationOptions:{handler(){this.updateSelectedMedications()},deep:!0},customRegimen:{async handler(e){e?(await this.fetchCustomIngredients(),this.selectedRegimen={},this.selectedMedications=[],this.editableMedication=!0,this.estimatedPacks=[]):(this.editableMedication=!1,this.selectedMedications=[],this.estimatedPacks=[])}}},async mounted(){var a,h,p;const e=fe();this.providerID=Number(H(e.$state).user_ID)||1;const t=ve(),i=H(t.$state).patient;if(this.patientID=(i==null?void 0:i.patientID)||25,this.facts.gender=(i==null?void 0:i.personInformation.gender)||"",this.facts.age=be(i==null?void 0:i.personInformation.birthdate),(h=(a=i==null?void 0:i.vitals)==null?void 0:a.saved)==null?void 0:h[0]){const r=i.vitals.saved.find(v=>v.concept_name==="Weight (kg)");r&&(this.facts.weight=r.value_numeric)}const d=(p=i==null?void 0:i.activePrograms)==null?void 0:p.find(r=>r.program.name==="HIV PROGRAM");d&&(this.facts.currentRegimenStr=d.program.name,this.facts.currentRegimenCode=this.extractRegimenCode(d.program.name)),this.consultation=new me(this.patientID,this.providerID),this.prescription=new E(this.patientID,this.providerID);const m=await B.getRegimens(this.patientID);Object.entries(m).forEach(([r,v])=>{this.arvRegimens.push({name:r,drugs:v})}),await this.prescription.loadHangingPills(),await this.prescription.loadRegimenExtras(),await this.initFacts(),this.buildMedicationOptions()}}),Te={class:"prescription-container h-full"},Ee={class:"accordion-section"},Ne={class:"expand-btn"},Me={class:"accordion-content"},Fe={class:"allergy-section"},He={class:"accordion-section"},Ae={class:"expand-btn"},Ue={class:"accordion-content"},Be={class:"medication-options"},$e={class:"option-grid"},xe={class:"checkbox-text"},Le={class:"accordion-section"},qe={class:"expand-btn"},Ge={class:"accordion-content"},ze={class:"patient-info"},We={class:"info-item"},Ye={class:"info-value"},Qe={class:"info-item"},je={class:"info-value"},Ke={class:"info-item"},Xe={class:"info-value"},Je={class:"info-item"},Ze={class:"info-value"},et={class:"info-item"},tt={class:"info-value"},it={key:0},nt={class:"regimen-grid"},st=["onClick"],at={class:"regimen-id"},ot={class:"regimen-name"},rt=["onClick"],lt={class:"regimen-id"},ct={class:"regimen-name"},dt={key:1,class:"custom-regimen-scroll",style:{display:"grid","grid-template-columns":"repeat(2, 1fr)",gap:"0.5rem"}},ut=["onClick"],mt={class:"regimen-name"},ht={class:"regimen-units"},pt={class:"custom-regimen"},gt={class:"selected-medication-section"},ft={class:"medication-table"},vt={class:"row-cell drug-name"},bt={class:"row-cell units"},yt={class:"row-cell am"},St={class:"row-cell noon"},It={class:"row-cell pm"},Pt={class:"row-cell frequency"},Ct={class:"row-cell am"},_t={class:"row-cell noon"},wt={class:"row-cell pm"},kt={class:"row-cell frequency"},Ot={class:"accordion-section"},Rt={class:"expand-btn"},Vt={class:"accordion-content"},Dt={class:"next-visit-interval"},Tt={class:"medication-run-out"},Et={class:"estimated-packs"},Nt={class:"pack-name"},Mt={class:"pack-quantity"},Ft={key:0,class:"over-6-months-medication"};function Ht(e,t,i,o,d,m){const a=S("ion-icon"),h=S("ion-radio"),p=S("ion-radio-group"),r=S("ion-checkbox"),v=S("ion-note"),w=S("ion-input"),D=S("ion-select-option"),N=S("ion-select"),M=S("ion-item"),Y=S("ion-label"),Q=S("ion-textarea");return l(),u("div",Te,[n("div",Ee,[n("div",{class:"accordion-header",onClick:t[0]||(t[0]=s=>e.toggleAccordion("allergySection"))},[t[10]||(t[10]=n("h3",null,"Allergy Information",-1)),n("button",Ne,[g(a,{icon:e.accordionState.allergySection?e.chevronUp:e.chevronDown},null,8,["icon"])])]),O(n("div",Me,[n("div",Fe,[t[11]||(t[11]=n("div",{class:"allergy-label"},"Allergic to cotrimoxazole",-1)),g(p,{modelValue:e.allergyOption,"onUpdate:modelValue":t[1]||(t[1]=s=>e.allergyOption=s),onIonChange:e.allergyChange,class:"horizontal-options"},{default:y(()=>[(l(!0),u(I,null,P(e.allergyOptions,s=>(l(),u("div",{key:s.value,class:"horizontal-item"},[g(h,{value:s.value},{default:y(()=>[_(c(s.label),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["modelValue","onIonChange"])])],512),[[R,e.accordionState.allergySection]])]),n("div",He,[n("div",{class:"accordion-header",onClick:t[2]||(t[2]=s=>e.toggleAccordion("medicationSection"))},[t[12]||(t[12]=n("h3",null,"Medication to prescribe during this visit",-1)),n("button",Ae,[g(a,{icon:e.accordionState.medicationSection?e.chevronUp:e.chevronDown},null,8,["icon"])])]),O(n("div",Ue,[n("div",Be,[n("div",$e,[(l(!0),u(I,null,P(e.medicationOptions,(s,b)=>{var f,F;return l(),u("div",{key:s.value,class:"option-item"},[g(r,{checked:s.isChecked,disabled:s.disabled,"label-placement":"end",onIonChange:k=>e.handleMedicationSelection(k,b,s)},{default:y(()=>[n("span",xe,c(s.label),1)]),_:2},1032,["checked","disabled","onIonChange"]),t[13]||(t[13]=n("br",null,null,-1)),((f=s.description)==null?void 0:f.show)==="always"?(l(),U(v,{key:0,color:(F=s.description)==null?void 0:F.color},{default:y(()=>{var k;return[_(c((k=s.description)==null?void 0:k.text),1)]}),_:2},1032,["color"])):T("",!0)])}),128))])])],512),[[R,e.accordionState.medicationSection]])]),n("div",Le,[n("div",{class:"accordion-header",onClick:t[3]||(t[3]=s=>e.toggleAccordion("arvRegimensSection"))},[t[14]||(t[14]=n("h3",null,"ARV Regimens",-1)),n("button",qe,[g(a,{icon:e.accordionState.arvRegimensSection?e.chevronUp:e.chevronDown},null,8,["icon"])])]),O(n("div",Ge,[n("div",ze,[n("div",We,[t[15]||(t[15]=n("span",{class:"info-label"},"Age:",-1)),n("span",Ye,c(e.facts.age)+" Years",1)]),n("div",Qe,[t[16]||(t[16]=n("span",{class:"info-label"},"Gender:",-1)),n("span",je,c(e.toDisplayGenderFmt(e.facts.gender)),1)]),n("div",Ke,[t[17]||(t[17]=n("span",{class:"info-label"},"Current Regimen:",-1)),n("span",Xe,c(e.facts.currentRegimenStr),1)]),n("div",Je,[t[18]||(t[18]=n("span",{class:"info-label"},"Current Weight:",-1)),n("span",Ze,c(e.facts.weight),1)]),n("div",et,[t[19]||(t[19]=n("span",{class:"info-label"},"Reason for change:",-1)),n("span",tt,c(e.facts.reasonForSwitch),1)])]),e.customRegimen?(l(),u("div",it,[g(w,{modelValue:e.customIngredientSearch,"onUpdate:modelValue":t[4]||(t[4]=s=>e.customIngredientSearch=s),onInput:t[5]||(t[5]=s=>{var b;return e.customIngredientSearch=(b=s.target)==null?void 0:b.value}),placeholder:" Search medications...",class:"custom-search","clear-input":""},null,8,["modelValue"])])):T("",!0),n("div",nt,[e.customRegimen?(l(),u("div",dt,[(l(!0),u(I,null,P(e.filteredIngredients,s=>(l(),u("div",{key:s.name,class:V(["regimen-item",{selected:e.isCustomMedicationSelected(s)}]),onClick:b=>e.toggleCustomMedication(s)},[n("span",mt,c(s.name),1),n("span",ht,"("+c(s.units)+")",1)],10,ut))),128))])):(l(),u(I,{key:0},[(l(!0),u(I,null,P(e.arvRegimens.slice(0,5),s=>(l(),u("div",{key:s.name,class:V(["regimen-item",{selected:e.selectedRegimen.name===s.name}]),onClick:b=>e.toggleRegimen(s)},[n("span",at,c(s.name),1),n("span",ot,c(e.formatDrugs(s.drugs)),1)],10,st))),128)),(l(!0),u(I,null,P(e.arvRegimens.slice(5),s=>(l(),u("div",{key:s.name,class:V(["regimen-item",{selected:e.selectedRegimen.name===s.name}]),onClick:b=>e.toggleRegimen(s)},[n("span",lt,c(s.name),1),n("span",ct,c(e.formatDrugs(s.drugs)),1)],10,rt))),128))],64))]),n("div",pt,[t[20]||(t[20]=n("span",null,"Set custom regimen",-1)),g(r,{modelValue:e.customRegimen,"onUpdate:modelValue":t[6]||(t[6]=s=>e.customRegimen=s)},null,8,["modelValue"])]),n("div",gt,[t[24]||(t[24]=n("h3",null,"Selected medication",-1)),n("div",ft,[t[23]||(t[23]=ue('<div class="table-header" data-v-9a4b7fa9><div class="header-cell drug-name" data-v-9a4b7fa9>Drug name</div><div class="header-cell units" data-v-9a4b7fa9>Units</div><div class="header-cell am" data-v-9a4b7fa9>AM</div><div class="header-cell noon" data-v-9a4b7fa9>Noon</div><div class="header-cell pm" data-v-9a4b7fa9>PM</div><div class="header-cell frequency" data-v-9a4b7fa9>Frequency</div></div>',1)),(l(!0),u(I,null,P(e.selectedMedications,(s,b)=>(l(),u("div",{key:b,class:V(["table-row",{highlighted:b===0}])},[n("div",vt,c(s.drug_name),1),n("div",bt,c(s.units),1),e.editableMedication?(l(),u(I,{key:0},[n("div",yt,[g(w,{onIonInput:f=>s.am=parseFloat(f.target.value),type:"number",modelValue:s.am,"onUpdate:modelValue":f=>s.am=f,min:"0",class:"editable-input",style:{"background-color":"#f0f9ff",border:"1px solid #90caf9","border-radius":"4px"}},null,8,["onIonInput","modelValue","onUpdate:modelValue"])]),n("div",St,[g(w,{onIonInput:f=>s.noon=parseFloat(f.target.value),type:"number",modelValue:s.noon,"onUpdate:modelValue":f=>s.noon=f,min:"0",class:"editable-input",style:{"background-color":"#f0f9ff",border:"1px solid #90caf9","border-radius":"4px"}},null,8,["onIonInput","modelValue","onUpdate:modelValue"])]),n("div",It,[g(w,{onIonInput:f=>s.pm=parseFloat(f.target.value),type:"number",modelValue:s.pm,"onUpdate:modelValue":f=>s.pm=f,min:"0",class:"editable-input",style:{"background-color":"#f0f9ff",border:"1px solid #90caf9","border-radius":"4px"}},null,8,["onIonInput","modelValue","onUpdate:modelValue"])]),n("div",Pt,[g(N,{modelValue:s.frequency,"onUpdate:modelValue":f=>s.frequency=f,onIonChange:f=>{s.frequency=f.detail.value,e.updateEstimatedPacks()}},{default:y(()=>[g(D,{value:"Daily (QOD)"},{default:y(()=>t[21]||(t[21]=[_("Daily")])),_:1,__:[21]}),g(D,{value:"Weekly"},{default:y(()=>t[22]||(t[22]=[_("Weekly")])),_:1,__:[22]})]),_:2},1032,["modelValue","onUpdate:modelValue","onIonChange"])])],64)):(l(),u(I,{key:1},[n("div",Ct,c(s.am),1),n("div",_t,c(s.noon),1),n("div",wt,c(s.pm),1),n("div",kt,c(s.frequency),1)],64))],2))),128))])])],512),[[R,e.accordionState.arvRegimensSection]])]),n("div",Ot,[n("div",{class:"accordion-header",onClick:t[7]||(t[7]=s=>e.toggleAccordion("nextVisitSection"))},[t[25]||(t[25]=n("h3",null,"Next Visit Information",-1)),n("button",Rt,[g(a,{icon:e.accordionState.nextVisitSection?e.chevronUp:e.chevronDown},null,8,["icon"])])]),O(n("div",Vt,[n("div",Dt,[g(M,null,{default:y(()=>[g(N,{modelValue:e.nextVisitInterval,"onUpdate:modelValue":t[8]||(t[8]=s=>e.nextVisitInterval=s),interface:"popover",onIonChange:e.nextVisitIntervalChange,placeholder:"Select interval",label:"Interval to next visit","label-placement":"stacked"},{default:y(()=>[(l(!0),u(I,null,P(e.prescriptionIntervalSelection,s=>(l(),U(D,{key:s.value,value:s.value},{default:y(()=>[_(c(s.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","onIonChange"])]),_:1})]),n("div",Tt,[t[26]||(t[26]=n("label",null,"Medication run out date:",-1)),n("span",null,c(e.toDisplayFmt(e.medicationRunOutDate)),1)]),n("div",Et,[t[27]||(t[27]=n("h4",null,"Estimated packs/tins:",-1)),(l(!0),u(I,null,P(e.estimatedPacks,(s,b)=>(l(),u("div",{key:b,class:"pack-item"},[n("span",Nt,c(s.name),1),n("div",Mt,c(s.quantity),1)]))),128))]),e.over6monthsMedication?(l(),u("div",Ft,[g(M,null,{default:y(()=>[g(Y,{position:"stacked"},{default:y(()=>t[28]||(t[28]=[_("Specify reason for prescribing medication over 6 months "),n("span",{class:"required"},"*",-1)])),_:1,__:[28]}),g(Q,{modelValue:e.reasonsForOver6Months,"onUpdate:modelValue":t[9]||(t[9]=s=>e.reasonsForOver6Months=s),placeholder:"Enter reason for over 6 months medication"},null,8,["modelValue"])]),_:1})])):T("",!0)],512),[[R,e.accordionState.nextVisitSection]])])])}const Gt=Pe(De,[["render",Ht],["__scopeId","data-v-9a4b7fa9"]]);export{Gt as default};

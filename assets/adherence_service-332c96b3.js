var m=Object.defineProperty;var p=(u,t,e)=>t in u?m(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var o=(u,t,e)=>(p(u,typeof t!="symbol"?t+"":t,e),e);import{A as s,o as g,H as c}from"./index-d92f7182.js";import{l as D}from"./lodash-7be49fbd.js";import{N as h}from"./vendor-65256339.js";class f extends s{constructor(t,e){super(t,48,e)}static getAllBpDrugs(){return s.getJson("bp_drugs")}static getBpGrade(t,e){return t<140&&e<90?"normal":t>=140&&t<160||e>=100&&e<110?"grade 1":t>=180&&e>110||t>=180?"grade 3":t>=160&&t<180||e>=110?"grade 2":"N/A"}static isBpNormotensive(t){const[e,a]=Object.values(t).sort((n,l)=>n.date<l.date?1:0).map(n=>this.getBpGrade(n.sbp,n.dbp));return e==="normal"&&a==="normal"}getSystolicBp(){return g.getFirstValueNumber(this.patientID,"Systolic blood pressure")}getDiastolicBp(){return g.getFirstValueNumber(this.patientID,"Diastolic blood pressure")}async onBpDrugs(){const t=await g.getFirstValueCoded(this.patientID,"Treatment status");return t?t==="Yes":!1}async getBPTrail(){return await s.getJson("/patients/".concat(this.patientID,"/bp_trail"))}async getCurrentDrugs(){return await s.getJson("/patients/".concat(this.patientID,"/current_bp_drugs"))}async getLastDrugs(){return await s.getJson("/patients/".concat(this.patientID,"/last_bp_drugs_dispensation"))}async getAdherence(t,e){return await s.postJson("/patients/".concat(this.patientID,"/remaining_bp_drugs"),{drug_id:t,pills:e})}async enrollPatient(t){return await s.postJson("/patients/".concat(this.patientID,"/update_or_create_htn_state"),t)}static htnDrugReferences(){return[{drug_id:275,drug_name:"HCTZ (25mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:942,drug_name:"Enalapril (5mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:943,drug_name:"Enalapril (10mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:558,drug_name:"Amlodipine (5mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:559,drug_name:"Amlodipine (10mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:117,drug_name:"Atenolol (50mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:116,drug_name:"Atenolol(100mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"}]}getDrugs(){return{HCTZ:{drugs:[{drugName:"HCTZ (25mg tablet)",drugID:275,amount:"25mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null}],selected:null,notes:[]},Enalapril:{drugs:[{drugName:"Enalapril (5mg tablet)",drugID:942,amount:"5mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Enalapril (10mg tablet)",drugID:943,amount:"10mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]},Amlodipine:{drugs:[{drugName:"Amlodipine (5mg tablet)",drugID:558,amount:"5mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Amlodipine (10mg tablet)",drugID:559,amount:"10mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]},Atenolol:{drugs:[{drugName:"Atenolol (50mg tablet)",drugID:117,amount:"50mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Atenolol(100mg tablet)",drugID:116,amount:"100mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]}}}}class I extends s{constructor(e,a){super(e,68,a);o(this,"lastDrugs");o(this,"lastReceiptDate");this.lastDrugs=[],this.lastReceiptDate=""}async loadPreviousDrugs(e=!1){const a=new Date(this.date);a.setDate(a.getDate()-1);const n=d=>c.toStandardHisFormat(d),l=await s.getJson("patients/".concat(this.patientID,"/drugs_received"),{date:n(a)});if(!D.isEmpty(l)){this.lastReceiptDate=l.reduce((r,i)=>!r||new Date(n(i.order.start_date))>new Date(r)?n(i.order.start_date):r,null);const d=f.htnDrugReferences().map(r=>r.drug_id);if(this.lastDrugs=l.filter(r=>!d.includes(r.drug.drug_id)&&n(r.order.start_date)===this.lastReceiptDate),e){const r=await this.getPreviousDrugPillCount()||{};this.lastDrugs=this.lastDrugs.map(i=>(r[i.drug.drug_id]&&i.quantity&&(i.quantity+=r[i.drug.drug_id]),i))}}}getReceiptDate(){return this.lastReceiptDate}getLastDrugs(){return this.lastDrugs}receivedDrugsBefore(){return!0;/*!isEmpty(this.lastDrugs)*/}buildPillCountObs(e,a){return this.buildValueNumber("Number of tablets brought to clinic",a,null,e)}getPreviousDrugPillCount(){return s.getJson("last_drugs_pill_count",{patient_id:this.patientID,program_id:this.programID,date:this.lastReceiptDate})}async buildAdherenceObs(e,a,n,l=s.getSessionDate()){return{concept_id:await s.getConceptID("Drug adherence",!0),value_numeric:n,value_drug:a,value_modifier:"%",order_id:e,person_id:this.patientID,obs_datetime:l}}isAdherenceGood(e){return e>=95&&e<=105}calculateAdherence(e,a,n){return Math.round(100*(e-a)/(e-n))}calculateExpected(e,a,n,l){const d=l==="QW"?"week":"day",r=this.calcTimeElapsed(n,d);return e-r*parseFloat(a.toString())}calcTimeElapsed(e,a){return h(c.toStandardHisFormat(this.date)).diff(c.toStandardHisFormat(e),a)+1}calculateUnaccountedOrMissed(e,a){const n=parseFloat(e)-parseFloat(a);return n<0?n*-1+" missed":n+" unacc"}}export{I as A};

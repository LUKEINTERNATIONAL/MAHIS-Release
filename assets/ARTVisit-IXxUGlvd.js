import{d as ae,ck as oe,aT as le,ak as se,r as i,w as ie,O as u,f as o,J as l,l as a,u as e,eD as re,k as T,ag as ue,a8 as ce,e as v,F as $,P as M,eh as g,ab as de,a1 as fe,L as m,eE as me,dK as pe,ez as ve,K as V,bS as ge,M as W,G as z,N as E,Q as B,dU as ye,aR as G,aO as U,m as K,ei as be,bL as ke,bN as _e,cD as he,eF as xe,ae as we,R as Ie}from"./vendor-BOD1af1U.js";import{S as j,u as Te,P as Y,T as Ce,bN as Se,s as F,bn as Ne,aj as J,$ as Pe,bO as De,n as Re,bP as Ee,a8 as Be,_ as Fe}from"./index-DPgL8VFP.js";import{i as Ae,a as Oe}from"./tasks-ABvj39kg.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-DLDowtkW.js";class C extends j{constructor(){super()}static nextTask(y){return super.getJson("/workflows/".concat(super.getProgramID(),"/").concat(y),{date:super.getSessionDate()})}static async getNextTaskParams(y,S=""){let d=S;try{if(!d){const{name:k}=await C.nextTask(y);d=k}}catch(k){d=""}return{name:d.toLowerCase(),params:{patient_id:y}}}}const Le={key:0,class:"ion-padding"},$e={key:2,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},Me={class:"ion-page",id:"main"},Ve={key:0,class:"ion-padding"},We={key:1},ze={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}},Ge={style:{color:"black"}},Ue=ae({__name:"ARTVisit",setup(Ke){const y=oe(),S=Te(),{patient:d}=le(S),k=new Y,A=se(),f=i(-1),x=i(null),c=i([]),O=i([]),w=i(!1),_=i(!1),N=i(-1),b=i(""),h=i(""),Q=i(""),P=i(!1),I=i(null);function q(n){var t;return O.value.includes((t=n==null?void 0:n.encounterTypeID)!=null?t:0)}function D(n){var t;return n?!_.value&&N.value===(n==null?void 0:n.encounterTypeID)||((t=n==null?void 0:n.otherWorkflowNames)!=null?t:[]).includes(b.value):!1}async function H(){const n=await Ne.getEncounters(d.value.patientID,{date:C.getSessionDate()});O.value=n.map(t=>t.encounter_type)}async function L(){var n,t;P.value=(n=j.isBDE())!=null?n:!1,Q.value="",_.value=!0,h.value="",b.value="";try{const r=await C.nextTask(d.value.patientID);if(!r){h.value="No workflows found. You may exit this page or refresh",_.value=!1,f.value=-1;return}b.value=r.name,N.value=(t=r==null?void 0:r.encounter_type_id)!=null?t:-1;const s=c.value.findIndex(p=>{var R;return(p==null?void 0:p.encounterTypeID)===N.value||((R=p.otherWorkflowNames)!=null?R:[]).includes(b.value)});s!==-1||(h.value=b.value?'"'.concat(b.value,'" is not available in the current workflow. Contact your administrator or update ART activity selection'):"No next task found"),f.value=s}catch(r){h.value="An error has occured while loading next task: "+r,console.error(r)}finally{await H(),_.value=!1}}async function X(){f.value=-1,c.value=[],w.value=!0;try{const n=J.map(async t=>{if(!(typeof t.disabled=="function"&&t.disabled(J))){if(t.workflowID&&t.component){if(!await Ae(t.workflowID)||!await Oe(t.workflowID))return}else return;return t}});c.value=(await Promise.all(n)).filter(t=>t!==void 0),Z()}catch(n){F("Unable to load activities"),console.error(n)}finally{w.value=!1}}async function Z(){if(await Pe.isProp("".concat(De.FILING_NUMBERS,"=true"))){if(k.patient=await Y.findByID(d.value.patientID),!/n\/a/i.test(k.getFilingNumber()))return;Re(Be,{},!1,{title:"New filing number assignment",useComponent:Ee,onClose:()=>{Ie.dismiss()}})}}function ee(){if(P.value)if(I.value){if(!I.value.isProviderSelected()){F("Please select a provider"),I.value.openModal();return}}else{F("BDE Provider component is not available");return}return x.value&&typeof x.value.onSubmit=="function"?x.value.onSubmit():Promise.resolve(!0)}function te(){ee().then(n=>n&&L())}function ne(n){if(n<0||n>=c.value.length)return;const t=c.value[n];t&&D(t)&&(f.value=n)}return ie(()=>y.fullPath,()=>{X().then(L)},{immediate:!0,deep:!0}),(n,t)=>(o(),u(e(we),null,{default:l(()=>[a(Ce),a(e(re),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:l(()=>{var r;return[a(e(ue),{contentId:"main"},{default:l(()=>[a(e(ce),null,{default:l(()=>[w.value?(o(),v("div",Le,[(o(),v($,null,M(5,s=>a(e(g),{key:s,animated:"",style:{height:"60px","margin-bottom":"10px","border-radius":"8px"}})),64))])):c.value.length>0?(o(),u(e(de),{key:1},{default:l(()=>[(o(!0),v($,null,M(c.value,(s,p)=>(o(),u(e(fe),{onClick:R=>ne(p),lines:"none",key:p,disabled:!D(s),button:""},{default:l(()=>[q(s)?(o(),u(e(m),{key:0,icon:e(me),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):D(s)?(o(),u(e(m),{key:2,icon:e(ve),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(o(),u(e(m),{key:1,icon:e(pe),style:{padding:"10px"},slot:"start"},null,8,["icon"])),T("b",null,V(s.name),1)]),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(o(),v("div",$e,[a(e(m),{style:{"font-size":"2rem"},icon:e(ge)},null,8,["icon"]),t[2]||(t[2]=T("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),a(e(W),null,{default:l(()=>[a(e(z),{color:"light"},{default:l(()=>[a(e(E),{onClick:t[0]||(t[0]=s=>e(A).back())},{default:l(()=>[a(e(m),{icon:e(ye),slot:"start"},null,8,["icon"]),t[3]||(t[3]=B(" Back to dashboard ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),T("div",Me,[_.value||w.value?(o(),v("div",Ve,[a(e(G),null,{default:l(()=>[a(e(U),null,{default:l(()=>[a(e(g),{animated:"",style:{height:"40px","margin-bottom":"20px"}}),a(e(g),{animated:"",style:{height:"20px",width:"80%","margin-bottom":"15px"}}),a(e(g),{animated:"",style:{height:"20px",width:"60%","margin-bottom":"15px"}}),a(e(g),{animated:"",style:{height:"60px","margin-bottom":"20px"}}),a(e(g),{animated:"",style:{height:"20px",width:"70%","margin-bottom":"15px"}}),a(e(g),{animated:"",style:{height:"20px",width:"50%","margin-bottom":"15px"}})]),_:1})]),_:1})])):(r=c.value[f.value])!=null&&r.component?(o(),v("div",We,[a(e(G),null,{default:l(()=>[a(e(U),null,{default:l(()=>{var s;return[P.value?(o(),u(Se,{key:0,ref_key:"bdeProviderComponent",ref:I},null,512)):K("",!0),(o(),u(be,null,[(o(),u(ke((s=c.value[f.value])==null?void 0:s.component),{ref_key:"formRef",ref:x},null,512))],1024))]}),_:1})]),_:1})])):(o(),v("div",ze,[a(e(m),{style:{color:"green","font-size":"80px"},icon:e(_e)},null,8,["icon"]),T("h2",Ge,V(h.value),1),a(e(E),{size:"large",fill:"clear",onClick:t[1]||(t[1]=s=>e(A).back())},{default:l(()=>[a(e(m),{slot:"start",icon:e(he)},null,8,["icon"]),t[4]||(t[4]=B(" Exit page ",-1))]),_:1})])),a(e(W),null,{default:l(()=>[a(e(z),{color:"light"},{default:l(()=>[f.value>=0?(o(),u(e(E),{key:0,onClick:te,color:"primary",style:{padding:"4px"},slot:"end"},{default:l(()=>[t[5]||(t[5]=B(" Save and continue ",-1)),a(e(m),{style:{padding:"4px"},icon:e(xe),slot:"end"},null,8,["icon"])]),_:1})):K("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),He=Fe(Ue,[["__scopeId","data-v-e818222c"]]);export{He as default};

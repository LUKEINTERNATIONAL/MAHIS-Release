var C=Object.defineProperty;var q=(a,t,e)=>t in a?C(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var m=(a,t,e)=>q(a,typeof t!="symbol"?t+"":t,e);import{dw as D,c as T,r as v,eD as A,bS as E,bT as O,O as S,d as k,y as U,f as Y,z as f,l as p,u,S as z,U as L,b2 as H,W as G,I as N,aQ as W,T as J,A as K,B as X,ad as Z,eE as tt,b7 as et,eF as at}from"./vendor-D6Lr62aq.js";import{A as M,d as P,e as st,s as Q,f as nt,g as rt,m as ot,_ as it,h as lt,i as w,c as I,j as F}from"./index-BhttymnP.js";import{l as y}from"./lodash-Dt8AsbQm.js";const At={async show(a){return(await D.create({message:a||"Loading...",spinner:"crescent",translucent:!0})).present()},async hide(){D.getTop().then(a=>a?D.dismiss():null)}},$=v(""),b=v(""),B=v(""),ct=T(()=>"".concat($.value||"-"," / ").concat(b.value||"-"));function ut(){$.value="v".concat(P.version),B.value=P.version}async function dt(){let t=await(await M.get("version")).json();b.value=t["System version"]||"-"}function pt(){const[a,t,e]=B.value.split("."),[r,n,s]=b.value.split(".");return!((parseInt(r)||0)<(parseInt(a)||0)||(parseInt(n)||0)<(parseInt(t)||0)||(parseInt(s)||0)<(parseInt(e)||0))}function ft(){return{appVersion:$,apiVersion:b,minApiVersion:B,fullVersion:ct,loadAppVersions:ut,loadApiVersion:dt,isValidApiVersion:pt}}const{appVersion:ht,apiVersion:mt}=ft(),{facilityUUID:gt}=nt();function bt(){const a=rt().getUser().username;return{encryption:{userPassword:a,ownerPassword:a,userPermissions:["print"]}}}function _(a,t){return t||a.exportable!==!1}function j(a,t=!1){return a.filter(e=>_(e,t)).map(e=>e.label)}function x(a,t,e=!1){return t.map(r=>a.filter(n=>_(n,e)).map(n=>{let s=y.get(r,n.path,"");return typeof n.formatter=="function"&&s&&(s=n.formatter(s,r)),Q("".concat(n.drillable&&Array.isArray(s)?s.length:s))}))}function Dt(a){const{columns:t,rows:e,quarter:r,period:n,filters:s,safeMode:i}=a,o=j(t,i),c=x(t,A(e,(s==null?void 0:s.sort)||[]),i);let l=o.join(",")+"\n";return l+=c.map(d=>d.join(",")).join("\n"),l+="\nDate Created:  ".concat(S().format("DD/MMM/YYYY HH:MM:ss")),r&&(l+="\nQuarter: ".concat(r)),n&&(l+="\nQuarter: ".concat(n)),l+="\ne-Mastercard Version : ".concat(ht.value),l+="\nAPI Version ".concat(mt.value),l+="\nSite UUID: ".concat(gt),l}function wt(a){const t=new Blob([Dt(a)],{type:"text/csv;charset=utf-8;"}),e=document.createElement("a");e.href=window.URL.createObjectURL(t),e.setAttribute("download","".concat(a.filename,".csv")),document.body.appendChild(e),e.click(),document.body.removeChild(e)}function yt(a){const{filename:t,canHorizontalPageBreak:e,columns:r,rows:n,filters:s,safeMode:i}=a,o=[j(r,i)],c=x(r,A(n,(s==null?void 0:s.sort)||[]),i),l=i?bt():{},d=new E({...l}),h=d.splitTextToSize(Q(t),180),R=h.length<=1?20:h.length*10;d.text(h,14,10);const g={startY:R,head:o,body:c};e&&(g.tableWidth="wrap",g.horizontalPageBreak=!0,g.horizontalPageBreakRepeat=0),O(d,g);const V="".concat(t,".pdf");d.save(V)}function St(a,t,e,r){return{label:"PDF",color:"primary",action:async(n,s,i,o)=>{let c=t&&await st("PDF may contain private data that will require a password to unlock, To access private data choose Secure PDF over Regular PDF",{header:"Security warning",confirmBtnLabel:"Secure PDF",cancelBtnLabel:"Regular PDF"});yt({rows:s,filters:i,columns:o,filename:a,safeMode:c})}}}function Mt(a,t,e){return{label:"CSV",color:"primary",action:async(r,n,s,i)=>{wt({rows:n,filters:s,columns:i,quarter:t,period:e,filename:a})}}}const vt=k({__name:"DrilldownTable",props:{title:{type:String,default:"Drill down table"},rows:{type:Array,required:!0},columns:{type:Array,required:!1},actionButtons:{type:Array},rowActionButtons:{type:Array},config:{type:Object,default:()=>({showSubmitButton:!1})}},setup(a){return(t,e)=>(Y(),U(u(et),null,{default:f(()=>[p(u(z),null,{default:f(()=>[p(u(L),null,{default:f(()=>[p(u(H),{slot:"end"},{default:f(()=>[p(u(G),{slot:"end",onClick:e[0]||(e[0]=r=>u(ot).hide()),"icon-only":""},{default:f(()=>[p(u(N),{icon:u(W)},null,8,["icon"])]),_:1})]),_:1}),p(u(J),null,{default:f(()=>[K(X(a.title),1)]),_:1})]),_:1})]),_:1}),p(u(Z),null,{default:f(()=>[p(u(tt),{rows:a.rows,columns:a.columns,config:a.config,"row-actions-buttons":a.rowActionButtons,"actions-buttons":a.actionButtons,color:"light"},null,8,["rows","columns","config","row-actions-buttons","actions-buttons"])]),_:1})]),_:1}))}}),Qt=it(vt,[["__scopeId","data-v-dd3e8006"]]),$t=1,_t=23;class jt{constructor(){m(this,"date");m(this,"startDate");m(this,"endDate");m(this,"programId");m(this,"useDefaultParams");this.programId=$t,this.date=lt(),this.endDate="",this.startDate="",this.useDefaultParams=!0}setDate(t){this.date=w(t)}setStartDate(t){this.startDate=w(t)}setEndDate(t){this.endDate=w(t)}getDateIntervalPeriod(){return this.startDate&&this.endDate?"".concat(I(this.startDate)," - ").concat(I(this.endDate)):"-"}buildParams(t){let e={};return this.useDefaultParams&&(e.date=this.date,e.program_id=this.programId),this.startDate&&(e.start_date=this.startDate),this.endDate&&(e.end_date=this.endDate),t&&(e={...e,...t}),e}async getReport(t,e){return(await M.get(F(t,this.buildParams(e)))).json()}static getReportQuarters(t=5){const e=[];let r=new Date,n=r.getFullYear();const s=n;r=new Date("".concat(s,"-").concat(r.getMonth()+1,"-").concat(r.getDate()," 00:00"));let o=this.getQtrByDate(r).qtr,c=0;for(o===4&&e.push(this.buildQtrObj("Q1",n+1));c<t;)c===0&&o<4&&e.push(this.buildQtrObj("Q".concat(o+1),n)),e.push(this.buildQtrObj("Q".concat(o),n)),o=o>0?o-=1:o,n=o==0?n-1:n,o=o==0?o+=4:o,c++;return e}static getQtrByDate(t){const e=this.getQuarterBounds(t.getFullYear());for(const r in e){const{start:n,end:s}=e[r];if(t>=new Date(n)&&t<=new Date(s))return e[r]}return null}static buildQtrObj(t,e){const r=this.getQuarterBounds(e),{start:n,end:s}=r[t];return{start:n,end:s,name:"".concat(t," ").concat(e)}}static getQuarterBounds(t){const e=s=>S("".concat(t,"-").concat(s,"-01")).daysInMonth(),r=s=>"".concat(t,"-").concat(s,"-01 00:00"),n=s=>"".concat(t,"-").concat(s,"-").concat(e(s)," 00:00");return{Q1:{qtr:1,start:r("01"),end:n("03")},Q2:{qtr:2,start:r("04"),end:n("06")},Q3:{qtr:3,start:r("07"),end:n("09")},Q4:{qtr:4,start:r("10"),end:n("12")}}}async getMaternalStatus(t,e="pepfar"){var s;if(y.isEmpty(t))return{FP:[],FBf:[]};const r=F("vl_maternal_status",this.buildParams({report_definition:e}));return(s=(await at.postJson(r,{patient_ids:t})).data)!=null?s:{FP:[],FBf:[]}}async buildMaternityAgreggateRows(t,e="pepfar"){const r=y.uniq(Object.values(t).flat(1).map(o=>o instanceof Object?o.patient_id:o)),n=Object.keys(t),s=await this.getMaternalStatus(r,e),i=s.FBf.concat(s.FP);return["FP","FNP","FBf"].map(o=>n.reduce((c,l)=>({[l]:t[l].filter(d=>{const h=d instanceof Object?d.patient_id:d;return o==="FNP"?!i.includes(h):s[o].includes(h)}),...c}),{ageGroup:"All",gender:o}))}}export{Qt as D,_t as L,jt as R,St as a,wt as e,Mt as g,At as l};

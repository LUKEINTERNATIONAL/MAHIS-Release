!function(){function t(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,e||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}System.register(["./index-legacy-D5NHGThA.js","./lodash-legacy-pOOc9Efu.js","./vendor-legacy-BTbHWMAP.js","./app_encounter_service-legacy-DaUekosL.js","./sms_service-legacy-DngMemRD.js","./appointment_service-legacy-Cq9khjdt.js","./EIRreportsStore-legacy-C7BQpZRo.js","./Export-legacy-BNqBNH71.js"],function(e,n){"use strict";var a,i,o,s,r,l,c,d,u,p,m,g,f,v,_,h,y,b,w,D,x,S,A,M,I,$,F,J,N,E,k,z,P,T,O,C,V,j,R,H,L,U,Y,B,q;return{setters:[t=>{a=t.H,i=t.u,o=t.S,s=t.a1,r=t.k,l=t._,c=t.P,d=t.t,u=t.g,p=t.f,m=t.J,g=t.A,f=t.b},t=>{v=t.l},t=>{_=t.R,h=t.d,y=t.ab,b=t.W,w=t.an,D=t.G,x=t.ac,S=t.X,A=t.E,M=t.e,I=t.f,$=t.l,F=t.k,J=t.z,N=t.A,E=t.F,k=t.r,z=t.a,P=t.y,T=t.m,O=t.u,C=t.D,V=t.B,j=t.da},t=>{R=t.A},t=>{H=t.S},t=>{L=t.A},t=>{U=t.E},t=>{Y=t.u,B=t.F,q=t.e}],execute:function(){var n=document.createElement("style");n.textContent=".saveBtn[data-v-2bafd924]{display:flex;justify-content:space-between;margin:20px;align-items:center}ion-row.centered-content[data-v-2bafd924]{display:flex;justify-content:center;align-items:center;border-radius:10px}.text-container[data-v-2bafd924]{text-align:center;padding:20px}.text-container div[data-v-2bafd924]{margin-bottom:10px;font-family:Arial,sans-serif;color:#333}.text-container div[data-v-2bafd924]:last-child{margin-bottom:0}.ilbl[data-v-1d22c524]{font-size:23px}.calender[data-v-1d22c524]{--dp-cell-padding: 30px;--dp-menu-padding: 20px 5px;--dp-font-size: 18px}.card_content[data-v-1d22c524]{width:100%}.dp__flex_display[data-v-1d22c524]{display:inherit}.toggle-green[data-v-1d22c524]{--toggle-bg-on: #006401;--toggle-border-on: #006401;--toggle-width: 6.3rem;--toggle-height: 1.9rem;--toggle-border: .525rem;--toggle-font-size: 1rem;margin-bottom:30px}.lbl-tl[data-v-1d22c524]{min-width:20px;color:#b3b3b3!important;white-space:nowrap}.lbl-ct[data-v-1d22c524]{white-space:nowrap;color:#08475e;font-size:14px}.btnText[data-v-1d22c524]{font-style:normal;font-weight:500;font-size:14px}\n/*$vite$:1*/",document.head.appendChild(n),e({b:async function(t,e,n){const a=JSON.parse(JSON.stringify(t));let i=null==a?void 0:a.vaccineAdministration;i.orders.some(t=>t.drug_name===e.drug.drug_name)?(i.orders=i.orders.filter(t=>t.drug_name!==e.drug.drug_name),i.obs=i.obs.filter(t=>t.value_text!==e.drug.drug_name)):i.voided=[...null==i?void 0:i.voided,{reason:n,order_id:e.drug.order_id,drug_name:e.drug.drug_name}];lt(a,e.drug.drug_name,"pending",""),await s(a)},c:function(t){return 1==function(t){const e=["Vit","Albendazole"],n=t.toLowerCase().split(/[\s,()]+/);return e.some(t=>t.toLowerCase().split(/[\s,()]+/).some(t=>n.some(e=>e.includes(t)||t.includes(e))))}(t.drug_name)},d:async function(){return await o.getJson("immunization/months_picker")},e:async function(){return await o.getJson("/immunization/vaccine_names")},f:async function(t,e){return await o.getJson("immunization/vaccines_administered",{start_date:t,end_date:e})},g:async function(t,e){const n=await async function(t){try{let e=await g("genericVaccineSchedule");if(e.length>0){if("M"==t)return e[0].genericVaccineSchedule.male_schedule;if("F"==t)return e[0].genericVaccineSchedule.female_schedule}else if(f().apiStatus){if(e=await o.getJson("eir/schedule/generic",{paginate:!1}),"M"==t)return e.male_schedule;if("F"==t)return e.female_schedule}}catch(e){return console.error("Error getting offline generic vaccine schedule",e),[]}}(t);return await async function(t,e){const n=new Date;return e.forEach(e=>{const a=e.age.toLowerCase();let i=null;if("at birth"===a)i=new Date(t);else if(a.includes("weeks")){const e=parseInt(a.split(" ")[0],10);i=new Date(t),i.setDate(t.getDate()+7*e)}else if(a.includes("months")){const e=parseInt(a.split(" ")[0],10);i=new Date(t),i.setMonth(t.getMonth()+e)}else if(a.includes("years")){const e=parseInt(a.split(" ")[0],10);i=new Date(t),i.setFullYear(t.getFullYear()+e)}i?i>n?e.milestone_status="upcoming":i.toDateString()===n.toDateString()?e.milestone_status="current":e.milestone_status="passed":e.milestone_status="unknown"}),{vaccine_schedule:e}}(new Date(e),n)},h:function(){try{const t=U(),e=m(),{activePlatformProfile:n}=Y();let a=function(t){let e="Category,Static <1y,Static >1y,Outreach <1y,Outreach >1y\n";for(const n of t){e+=[dt(n.label),n.fixed.lessThan1y,n.fixed.moreThan1y,n.outreach.lessThan1y,n.outreach.moreThan1y].join(",")+"\n"}return e}(t.$state.immunizationMonthlyRepoartData);a+="\n",a+=function(t){let e="Cases,"+t.vaccines.map(t=>dt(t.name)).join(",")+"\n";for(const n of t.categories){e+=dt(n.name)+"\n";for(const t of n.cases){e+=[dt(t.name),...t.data.map(t=>t.count)].join(",")+"\n"}}return e}(t.$state.AEFIReportData),a+="\n",a+=`\n        Date Created: ${(new Date).toISOString().split("T")[0]}\n        Report Period: ${t.$state.navigationPayload.subTxt}\n        Site: ${e.$state.userFacilityName}`;const i=new Blob([a],{type:"text/csv;charset=utf-8;"}),o=`${e.$state.userFacilityName}_${t.$state.navigationPayload.subTxt}_${t.$state.navigationPayload.title}`;if(n.value.fileExport===B.WEB){const t=document.createElement("a");t.href=window.URL.createObjectURL(i),t.setAttribute("download",`${o}.csv`),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}else n.value.fileExport===B.FILE_SYSTEM?q(`${o}.csv`,i,"blob"):d("Platform not supported")}catch(t){console.error("Error exporting CSV:",t)}},i:async function(){return await o.getJson("immunization/under_five_immunizations_drugs")},j:async function(t,e){return await o.getJson("immunization/aefi_report",{start_date:t,end_date:e})},s:async function(t){const e=JSON.parse(JSON.stringify(t)),n=p();if(!v.isEmpty(n.getAdministeredVaccines())){var a,i;const t=function(){const t=p();return t.getAdministeredVaccines().map(t=>{var e,n;return{drug_name:(null==t||null===(e=t.drug_)||void 0===e||null===(e=e.drug)||void 0===e?void 0:e.drug_name)||(null==t||null===(n=t.drug_)||void 0===n?void 0:n.drug_name),drug_inventory_id:t.drug_id,equivalent_daily_dose:1,start_date:t.date_administered,auto_expire_date:ct(t.date_administered,1),units:"ml",instructions:"",dose:1,frequency:"Unknown",batch_number:t.batch_number||"Unknown",prn:0}})}(),o=await async function(){const t=p(),e=t.getAdministeredVaccines();return await Promise.all(e.map(async t=>{var e,n;return{concept_id:2876,value_text:(null==t||null===(e=t.drug_)||void 0===e||null===(e=e.drug)||void 0===e?void 0:e.drug_name)||(null==t||null===(n=t.drug_)||void 0===n?void 0:n.drug_name),obs_datetime:t.date_administered}}))}();let l=null==e?void 0:e.vaccineAdministration;l.orders=[...null==l?void 0:l.orders,...t],l.voided=l.voided.filter(e=>{var n;return e.drug_name!==(null===(n=t[0])||void 0===n?void 0:n.drug_name)}),l.obs=[...null==l?void 0:l.obs,...o],n.setVaccineReload(!n.getVaccineReload()),l.orders.length>0&&n.setLastVaccineAdminstredOnschedule(l.orders),lt(e,null===(a=t[0])||void 0===a?void 0:a.drug_name,"administered",null===(i=o[0])||void 0===i?void 0:i.obs_datetime),await s(e),r("Saved successful"),await async function(t){const e=p(),n=e.getLastVaccineAdminstredOnschedule();var a;n.length>0&&(null==t||null===(a=t.vaccineSchedule)||void 0===a||null===(a=a.vaccine_schedule)||void 0===a||a.forEach(t=>{1==t.antigens.every(t=>"administered"===t.status)&&t.antigens.forEach(t=>{t.drug_id==n[0].drug_inventory_id&&u(rt,{class:"otherVitalsModal"},!1)})}));e.setLastVaccineAdminstredOnschedule([])}(e)}},v:async function(t,e){return o.void(`/encounters/${t}`,{reason:e})}});const Z=e("u",_("immunizationAppointMentStore",{state:()=>({selectedAppointmentMent:[],selectedAppointmentMentForAppointmentsPage:"",AppointmentsReload:!1,startDate:a.sessionDate(),endDate:a.sessionDate()}),actions:{getAppointmentMents(){return this.selectedAppointmentMent},setAppointmentMent(t){this.selectedAppointmentMent.length=0,this.selectedAppointmentMent.push(t)},clearAppointmentMent(){this.selectedAppointmentMent.length=0},getSelectedAppointmentMentForAppointmentsPage(){return this.selectedAppointmentMentForAppointmentsPage},setSelectedAppointmentMentForAppointmentsPage(t){this.selectedAppointmentMentForAppointmentsPage=t},setAppointmentsReload(t){this.AppointmentsReload=t},getAppointmentsReload(){return this.AppointmentsReload},setStartEndDate(t,e){this.startDate=t,this.endDate=e},getStartEndDate(){return{startDate:this.startDate,endDate:this.endDate}}}}));class W extends R{constructor(e){const n=void 0!==e?e:W.getPatientID(),a=W.getProviderID();super(n,7,a),t(this,"patientID",void 0),t(this,"providerID",void 0),this.patientID=n,this.providerID=a}static getPatientID(){return i().patient.patientID}static getProviderID(){return o.getUserID()}async setPatientID(t){this.patientID=t}async createAppointment(t){var e;let n=JSON.parse(JSON.stringify(t));const i=[];Z().selectedAppointmentMent.forEach(t=>{const e=a.toStandardHisFormat(t.date);i.push(e)});const o=await this.buildValueDate("Appointment date",i[0]);return null==n||null===(e=n.appointments.unsaved)||void 0===e||e.push(o),await s(n),r("next Appointment Set Successfully"),i[0]}async getNextAppointment(){if(this.programID&&this.patientID)return R.getJson(`/programs/${this.programID}/patients/${this.patientID}/next_appointment_date`,{date:this.date})}async getDailiyAppointments(t){const e=R.getProgramID();return R.getJson(`/programs/${e}/booked_appointments`,{date:t,paginate:!1})}}e("A",W);const G=h({components:{IonRow:x,IonItem:D,IonList:w,IonButton:b,IonCol:y},props:{date:{type:String,required:!0},patient:{type:Number,required:!0},modalaction:{type:String,required:!0}},data(){return{formattedDate:a.toStandardHisFormat(this.date)}},methods:{async dismissModal(){await S.dismiss()},async sendSMS(){await S.dismiss("send-SMS")}}}),X={class:"saveBtn"};const K=e("a",l(G,[["render",function(t,e,n,a,i,o){const s=A("ion-row"),r=A("ion-button"),l=A("ion-col");return I(),M(E,null,[$(s,{class:"centered-content"},{default:J(()=>e[0]||(e[0]=[F("div",{class:"text-container"},[F("div",null,"Do you want to send SMS reminder?")],-1)])),_:1,__:[0]}),F("div",X,[$(s,null,{default:J(()=>[$(l,null,{default:J(()=>[$(r,{onClick:t.dismissModal,id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"}},{default:J(()=>e[1]||(e[1]=[N(" No ")])),_:1,__:[1]},8,["onClick"])]),_:1}),$(l,null,{default:J(()=>[$(r,{onClick:t.sendSMS,class:"btnText",fill:"solid",style:{width:"130px","text-align":"right"}},{default:J(()=>e[2]||(e[2]=[N(" Yes ")])),_:1,__:[2]},8,["onClick"])]),_:1})]),_:1})])],64)}],["__scopeId","data-v-2bafd924"]])),Q={class:"lbl-ct"},tt={class:"lbl-ct"},et={style:{"margin-right":"20px",color:"black"}},nt={key:0},at={style:{color:"#999"}},it={style:{"font-size":"16px",color:"#666","margin-top":"5px"}},ot=h({watch:{},name:"xxxComponent"}),st=h({...ot,props:{patient_Id:{},encounter_Id:{}},setup(t){const e=i(),n=k(),r=k(),l=k(!1),m=k(!1),g=a.toStandardHisDisplayFormat(o.getSessionDate()),f=k(!1),v=k(),_=k(0),h=k([]),w=[];function D(t){const e=new Date(o.getSessionDate());return e.setHours(0,0,0,0),t<e}const R=t;async function U(){if(Z().selectedAppointmentMent.length>0)try{await async function(){var t,n;const a=JSON.parse(JSON.stringify(e.patient.guardianInformation)),i=[...null==a?void 0:a.unsaved,...null==a?void 0:a.saved];i.length>0&&null!==(t=i[0])&&void 0!==t&&t.cell_phone_number&&h.value.push(null===(n=i[0])||void 0===n?void 0:n.cell_phone_number);e.patient.personInformation.cell_phone_number&&h.value.push(e.patient.personInformation.cell_phone_number)}();const t=new W,n=await t.createAppointment(e.patient);await async function(){const t=p();t.setVaccineReload(!t.getVaccineReload())}(),await async function(){const t=Z();t.setAppointmentsReload(!t.getAppointmentsReload())}(),await B(),async function(t){if(0==h.value.length)return void d("No phone numbers available for sms reminder!");if(t){if("send-SMS"==await u(K,{class:"nationalIDModal"})){const n=JSON.parse(JSON.stringify(e.patient));n.sms={appointment_date:t},await s(n)}}}(n)}catch(t){}else d("please select next appointment date on the calendar")}function Y(t,e){const n=t.getFullYear(),a=t.getMonth(),i=t.getDate(),o=e.getFullYear(),s=e.getMonth(),r=e.getDate();return n!==o?n>o:a!==s?a>s:i>r}async function B(){try{await S.dismiss()}catch(t){console.error("Modal dismissal error:",t)}}async function q(t){const e={counter:1,date:t};Z().setAppointmentMent(e),f.value=!1,await async function(t){try{const e=await L.getDailiyAppointments(a.toStandardHisFormat(t),a.toStandardHisFormat(t));_.value=e.length}catch(e){}}(t),f.value=!0,v.value=a.toStandardHisDisplayFormat(t)}function G(t){const e=Z().getAppointmentMents(),n=t=>{const e=new Date(t);return e.setHours(0,0,0,0),e.getTime()},a=n(new Date(t)),i=e.find(t=>n(new Date(t.date))===a);return i?i.counter:null}function X(t){const e=t.match(/(\d+)\s*(week|month|year)s?/i);if(!e)return"Invalid input format";const n=parseInt(e[1]);switch(e[2].toLowerCase()){case"week":return 7*n;case"month":return 30*n;case"year":return 365*n;default:return"Invalid time unit"}}function ot(t,e){if("Invalid input format"==e)return"";let n;if(t instanceof Date)n=new Date(t);else{const[e,a]=t.split(" "),[i,o,s]=e.split("/"),[r,l,c]=a.split(":"),d={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};n=new Date(Number(s),d[o],Number(i),Number(r),Number(l),Number(c))}n.setDate(n.getDate()+e);const a=t=>String(t).padStart(2,"0"),i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n.getDay()],o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()],s=a(n.getDate()),r=n.getFullYear(),l=a(n.getHours()),c=a(n.getMinutes()),d=a(n.getSeconds()),u=-n.getTimezoneOffset(),p=Math.floor(Math.abs(u)/60),m=Math.abs(u)%60,g=`GMT${u>=0?"+":"-"}${a(p)}${a(m)}`,f=Intl.DateTimeFormat().resolvedOptions().timeZone;let v;try{const t=new Intl.DateTimeFormat("en",{timeZone:f,timeZoneName:"long"}).formatToParts(n).find(t=>"timeZoneName"===t.type);v=t?t.value:f}catch(_){console.error("Error getting localized time zone name:",_),v=f}return`Date ${i} ${o} ${s} ${r} ${l}:${c}:${d} ${g} (${v})`}return z(async()=>{Z().clearAppointmentMent(),await async function(){try{let t=await H.getConfigurations();m.value=t.show_sms_popup}catch(t){}}(),await async function(){try{const t=new c,i=(void 0!==R.patient_Id?R.patient_Id:t.getID(),await async function(){try{const t=e.patient.vaccineSchedule;t.vaccine_schedule.forEach(t=>{t.antigens.forEach(e=>{"administered"==e.status&&w.push({age:t.age,vaccine:e})})});for(const e of t.vaccine_schedule){if("current"===e.milestone_status)return e;if("upcoming"===e.milestone_status)return e}return null}catch(t){return null}}());if(w.length>0){const t=w[w.length-1];0==await async function(t){try{const n=ot(new Date(e.patient.personInformation.birthdate),X(t.age)),a=function(t){const e={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},n=t.split(/[:/ ]/),a=`${n[2]}-${e[n[1]]}-${n[0]}T${n[3]}:${n[4]}:${n[5]}`;return new Date(a)}(t.vaccine.date_administered),i=new Date(n);return console.log(Y(a,i)),Y(a,i)}catch(n){}}(t)&&(n.value=ot(t.vaccine.date_administered,X(i.age)),r.value=a.toStandardHisDisplayFormat(n.value),q(n.value),G(n.value),l.value=!0)}}catch(t){}}()}),(t,e)=>{const a=A("VueDatePicker");return I(),M(E,null,[$(O(x),{style:{"margin-top":"10px"}},{default:J(()=>[$(O(y),{style:{"margin-left":"-3px"}},{default:J(()=>e[1]||(e[1]=[F("div",{class:"om",style:{"font-weight":"600",color:"#8d8686"}},"Set Next Appointment Date",-1)])),_:1,__:[1]}),$(O(y),{size:"6",style:{"text-align":"right"}},{default:J(()=>[$(O(C),{class:"lbl-tl",style:{"font-size":"13"}},{default:J(()=>[e[2]||(e[2]=N(" Todays Date: ")),F("span",Q,V(O(g)),1)]),_:1,__:[2]})]),_:1})]),_:1}),$(O(x),{style:{"margin-top":"10px"}},{default:J(()=>[$(O(y),{style:{"margin-left":"-3px"}},{default:J(()=>e[3]||(e[3]=[F("div",{class:"om"},null,-1)])),_:1,__:[3]}),f.value?(I(),P(O(y),{key:0,size:"10",style:{"text-align":"right"}},{default:J(()=>[$(O(C),{class:"lbl-tl",style:{"font-size":"16","font-weight":"500"}},{default:J(()=>[e[4]||(e[4]=N(" Total Appointments ")),F("span",tt,"("+V(v.value)+")",1),e[5]||(e[5]=N(": ")),F("span",et,[$(O(j),{color:"primary",style:{"margin-bottom":"-5px","font-size":"15px"}},{default:J(()=>[N(V(_.value),1)]),_:1})])]),_:1,__:[4,5]})]),_:1})):T("",!0)]),_:1}),$(O(x),{style:{"margin-top":"20px"}},{default:J(()=>[$(O(y),null,{default:J(()=>[$(a,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value=t),onDateUpdate:q,"enable-time-picker":!1,inline:"","auto-apply":"","disabled-dates":D},{day:J(({day:t,date:e})=>[(I(),M("p",nt,[N(V(t),1),F("sup",at,V(G(e)),1)]))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l.value?(I(),P(O(x),{key:0,style:{"margin-top":"0px","margin-bottom":"0px"}},{default:J(()=>[$(O(y),{style:{"background-color":"#f0f0f0",padding:"15px","border-radius":"8px","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)"}},{default:J(()=>[e[6]||(e[6]=F("div",{style:{"font-size":"17px",color:"#333","font-weight":"bold"}},"Suggested Date:",-1)),F("div",it,V(r.value),1)]),_:1,__:[6]})]),_:1})):T("",!0),$(O(x),{style:{"margin-top":"10px","margin-bottom":"10px"}},{default:J(()=>[$(O(y),null,{default:J(()=>[$(O(b),{onClick:B,id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"}},{default:J(()=>e[7]||(e[7]=[N(" Cancel ")])),_:1,__:[7]})]),_:1}),$(O(y),{style:{"text-align":"right"}},{default:J(()=>[$(O(b),{onClick:U,class:"btnText",fill:"solid",style:{width:"130px"}},{default:J(()=>e[8]||(e[8]=[N(" save ")])),_:1,__:[8]})]),_:1})]),_:1})],64)}}}),rt=e("n",l(st,[["__scopeId","data-v-1d22c524"]]));function lt(t,e,n,a){t.vaccineSchedule.vaccine_schedule.forEach(t=>{t.antigens.forEach(t=>{t.drug_name===e&&(t.status=n,t.date_administered=a)})})}function ct(t,e){const n=new Date(t);return n.setDate(n.getDate()+parseInt(e)),a.toStandardHisFormat(n)}function dt(t){return/[,"\n]/.test(t)?`"${t.replace(/"/g,'""')}"`:t}}}})}();

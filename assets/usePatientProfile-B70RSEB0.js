import{d as S,y as ge,f as r,r as x,e as u,l as s,z as i,u as e,U as E,T as O,k as n,aU as q,W as V,I as $,a8 as le,S as re,aa as ye,ab as be,a9 as ue,V as de,F,X as ce,au as xe,b2 as _e,c as M,a as pe,w as he,ap as we,ac as Ie,m as c,G as se,D as Ne,B as m,aB as Ce,dr as De,a3 as ke,aY as Pe,aK as $e,bq as Se,A,L as Ve,$ as Me,dH as ae,b5 as Oe}from"./vendor-Oa4k5SKv.js";import{u as fe,P as oe,a7 as ze,ax as Te,_ as me,S as z,b4 as Ue,g as L,at as ie,b5 as Be}from"./index-BdhC1is7.js";import{R as Ae}from"./Registration-N_af85ht.js";import{O as Ee}from"./Outcome-BLoApgP0.js";const Le=S({__name:"personalInformationModal",setup(a){return(N,I)=>(r(),ge(Ae,{editMode:!0}))}}),qe={style:{"font-weight":"400","font-size":"19px"}},Fe={style:{display:"flex","align-items":"center"}},Re={class:""},je={class:"center text_12"},Ge=S({watch:{},name:"xxxComponent"}),He=S({...Ge,props:{is_open:{},user_id:{}},emits:["closePopoover","save"],setup(a,{emit:N}){x("");const I=N;function w(){I("closePopoover",!1),ce.dismiss()}return(v,p)=>(r(),u(F,null,[s(e(re),null,{default:i(()=>[s(e(E),null,{default:i(()=>[s(e(O),null,{default:i(()=>p[1]||(p[1]=[n("div",{style:{display:"flex","align-items":"center"}},[n("b",{style:{"margin-left":"6px"}},"Patient Outcome")],-1)])),_:1,__:[1]}),s(e(q),{slot:"end"},{default:i(()=>[s(e(O),null,{default:i(()=>[s(e(V),{onClick:p[0]||(p[0]=y=>w()),fill:"solid"},{default:i(()=>[n("span",qe,[n("div",Fe,[s(e($),{icon:e(le),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),p[2]||(p[2]=n("span",{style:{"margin-left":"6px"}},"Close",-1))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(e(ue),{class:"ion-padding"},{default:i(()=>[n("div",Re,[n("div",je,[s(e(ye),null,{default:i(()=>[s(e(be),null,{default:i(()=>[s(Ee)]),_:1})]),_:1})])])]),_:1}),s(e(de),null,{default:i(()=>[s(e(E))]),_:1})],64))}}),We={style:{display:"flex","align-items":"center"}},Ke={style:{"font-weight":"400","font-size":"19px"}},Qe={style:{display:"flex","align-items":"center"}},Xe={style:{"font-weight":"600","font-size":"17px"}},Ye={style:{"margin-top":"15px",width:"100%"}},Je={key:0,class:"error-message"},Ze={key:1},et={slot:"start",class:"prefix-container"},tt=["value"],nt={key:0,class:"error-message"},st={style:{"font-size":"16px","font-weight":"600px",color:"red"}},at={key:1},ot={style:{"font-weight":"400","font-size":"19px"}},it={style:{display:"flex","align-items":"center"}},lt={style:{"font-weight":"400","font-size":"20px"}},rt={style:{display:"flex","align-items":"center"}},ut=S({name:"UpdateNCDNumberModal"}),dt=S({...ut,emits:["closePopoover","save"],setup(a,{emit:N}){const I=xe(),w=fe(),{patient:v}=_e(w),p=x(""),y=x(""),g=x(""),C=x(!1),T=new oe;let _=null;const U=d=>{const o=d.target.value.replace(/[^0-9]/g,"");o!==d.target.value&&(C.value=!0,_&&clearTimeout(_),_=window.setTimeout(()=>{C.value=!1,_=null},3e3),p.value=o)},B=()=>{C.value=!1,_&&(clearTimeout(_),_=null)},l=M(()=>p.value&&p.value.trim()!==""),t=async()=>{try{const d=await ze.getNextSuggestedNCDNumber(),o=d.ncd_number.replace(/^\D+|\s/g,""),h=d.ncd_number.replace(/\d+/g,"")+"-NCD-";p.value=o,y.value=h}catch(d){console.error("Error fetching suggested NCD number:",d),g.value="Failed to fetch suggested NCD number (missing SITE Prefix)"}};pe(()=>{t()}),he(()=>v.value.ID,()=>{t()},{deep:!0});const f=N;function D(){f("closePopoover",!1),ce.dismiss()}function k(d){try{console.log(d),I.push(d)}catch(o){console.error(o)}}async function P(){try{if(g.value="",!l.value){g.value="Please enter a valid NCD number";return}const d="".concat(y.value).concat(p.value),o=await oe.findByID(v.value.patientID);for(const h of o.patient_identifiers)h.identifier_type===31&&(await T.updateNCDNumber(h.patient_identifier_id,d),f("save",{newNcdId:d}));await Te(v.value),D()}catch(d){console.error(d)}}return(d,o)=>(r(),u(F,null,[s(e(re),null,{default:i(()=>[s(e(E),null,{default:i(()=>[s(e(O),null,{default:i(()=>[n("div",We,[s(e($),{icon:e(we),class:"sub-menu-icon",style:{"font-size":"1.6rem"}},null,8,["icon"]),o[3]||(o[3]=n("b",{style:{"margin-left":"6px"}},"Update NCD Number",-1))])]),_:1}),s(e(q),{slot:"end"},{default:i(()=>[s(e(O),null,{default:i(()=>[s(e(V),{onClick:o[0]||(o[0]=h=>D()),fill:"solid"},{default:i(()=>[n("span",Ke,[n("div",Qe,[s(e($),{icon:e(le),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),o[4]||(o[4]=n("span",{style:{"margin-left":"6px"}},"Close",-1))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(e(ue),{class:"ion-padding"},{default:i(()=>[s(e(Ie),null,{default:i(()=>[s(e(se),{class:"current-ncd-item"},{default:i(()=>[s(e(Ne),null,{default:i(()=>[o[5]||(o[5]=n("h2",null,"Current NCD Number",-1)),n("p",Xe,m(e(v).NcdID||"Not assigned"),1)]),_:1,__:[5]})]),_:1}),s(e(se),null,{default:i(()=>[n("div",Ye,[C.value?(r(),u("div",Je,[s(e($),{icon:e(Ce),color:"danger"},null,8,["icon"]),o[6]||(o[6]=n("span",{style:{"font-size":"16px","font-weight":"600px",color:"red"}},"Only numbers are allowed",-1)),s(e(V),{fill:"clear",size:"small",onClick:B},{default:i(()=>[s(e($),{icon:e(De)},null,8,["icon"])]),_:1})])):c("",!0),g.value?c("",!0):(r(),u("div",Ze,[o[7]||(o[7]=n("span",{style:{"font-weight":"600","font-size":"17px",color:"grey"}},"New NCD Number",-1)),s(e(ke),{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=h=>p.value=h),placeholder:"Enter number",inputmode:"numeric",pattern:"[0-9]*",onInput:U,class:"custom-input"},{default:i(()=>[n("div",et,[n("input",{value:y.value,readonly:"",class:"prefix-part",type:"text"},null,8,tt)])]),_:1},8,["modelValue"])]))])]),_:1}),g.value?(r(),u("div",nt,[s(e(Pe),{color:"danger"},{default:i(()=>[n("span",st,m(g.value),1)]),_:1})])):c("",!0),g.value?(r(),u("div",at,[s(e(V),{onClick:o[2]||(o[2]=h=>k("setSitePrefix")),fill:"solid",style:{margin:"14px"}},{default:i(()=>[n("span",ot,[n("div",it,[s(e($),{icon:e($e),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),o[8]||(o[8]=n("span",{style:{"margin-left":"6px"}},"set Site Prefix",-1))])])]),_:1})])):c("",!0)]),_:1})]),_:1}),s(e(de),null,{default:i(()=>[s(e(E),null,{default:i(()=>[s(e(q),{slot:"end"},{default:i(()=>[s(e(O),null,{default:i(()=>[s(e(V),{onClick:P,fill:"solid",disabled:!l.value},{default:i(()=>[n("span",lt,[n("div",rt,[s(e($),{icon:e(Se),slot:"start",class:"sub-menu-icon"},null,8,["icon"]),o[9]||(o[9]=n("span",{style:{"margin-left":"6px"}},"Save",-1))])])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})],64))}}),ct=me(dt,[["__scopeId","data-v-28e133b4"]]),pt={key:0,style:{display:"flex","justify-content":"space-between",width:"100%"}},ft={key:0},mt={key:1,style:{"font-weight":"bold",padding:"1.7px"}},vt={key:1,style:{display:"flex","flex-wrap":"wrap",gap:"20px",width:"100%"}},gt={key:0},yt={key:1},bt={key:2},xt={key:2},_t={style:{display:"flex","flex-wrap":"wrap",gap:"8px",width:"100%"}},ht={key:3,style:{display:"flex","flex-wrap":"wrap",gap:"20px",width:"100%"}},wt={key:0},It={key:1},Nt={key:2},Ct={key:3},Dt={key:4,style:{width:"100%","text-align":"center","border-collapse":"collapse",border:"1px solid black"}},kt={key:0},Pt={style:{border:"1px solid black"}},$t={style:{border:"1px solid black"}},St={style:{border:"1px solid black"}},Vt={style:{border:"1px solid black"}},Mt=S({__name:"NCDVisitLbl",props:{imageOut:{type:Object},patient:{type:Object}},emits:["label-out"],setup(a,{emit:N}){const I=N,w=x(null),v=x(0),p=x(""),y=x(4),g=a,C=M(()=>{var l;return(l=g.patient)!=null&&l.medications?g.patient.medications.filter(t=>t&&(t.name||t.dose||t.frequency||t.quantity)):[]}),T=M(()=>{var t,f;const l=(t=g.patient)==null?void 0:t.vitals;return l&&(l.height||l.weight||l.bloodPressure||((f=g.patient)==null?void 0:f.bloodGlucose))}),_=M(()=>{const l=C.value;if(l.length===0)return[];if(v.value===0)return l.slice(0,2);{z.getIsIpPrintersStatus()?y.value=7:y.value=4;const t=2+(v.value-1)*y.value;return l.slice(t,t+y.value)}}),U=M(()=>{const l=C.value.length;if(l<=2)return 1;const t=l-2;return z.getIsIpPrintersStatus()?y.value=7:y.value=4,1+Math.ceil(t/y.value)}),B=async()=>{const l=[];for(let t=0;t<U.value;t++){v.value=t,await new Promise(f=>setTimeout(f,100));try{let f;z.getIsIpPrintersStatus()?(p.value="800px",f=await ae.toCanvas(w.value,{height:300,width:800})):f=await ae.toPng(w.value,{height:300,width:594}),l.push(f)}catch(f){console.error("Error generating image for page",t,f)}}return l};return pe(async()=>{try{const l=await B();I("label-out",l),typeof g.imageOut=="function"&&g.imageOut(l)}catch(l){console.error("Error generating patient labels:",l)}}),(l,t)=>{var f,D,k,P,d,o,h,R,j,G,H,W,K,Q,X,Y,J,Z,ee,te,ne;return r(),u("div",{ref_key:"lblComponent",ref:w,id:"container",style:Me("padding: 15px; width:"+p.value)},[v.value===0&&((f=a.patient)!=null&&f.latestVisitDate||(D=a.patient)!=null&&D.patientID)?(r(),u("div",pt,[(k=a.patient)!=null&&k.latestVisitDate?(r(),u("span",ft,[t[0]||(t[0]=n("b",null,"Visit:",-1)),A(" "+m(a.patient.latestVisitDate),1)])):c("",!0),(P=a.patient)!=null&&P.patientID?(r(),u("span",mt,m(a.patient.patientID),1)):c("",!0)])):c("",!0),v.value===0&&((d=a.patient)!=null&&d.patientName||(o=a.patient)!=null&&o.gender||(h=a.patient)!=null&&h.diagnoses&&a.patient.diagnoses.length>0)?(r(),u("div",vt,[(R=a.patient)!=null&&R.patientName||(j=a.patient)!=null&&j.gender?(r(),u("span",gt,[n("b",null,m((G=a.patient)==null?void 0:G.patientName)+m((H=a.patient)!=null&&H.gender?"(".concat(a.patient.gender,")"):""),1)])):c("",!0),(W=a.patient)!=null&&W.prescriber?(r(),u("span",yt,[t[1]||(t[1]=n("b",null,"Seen by:",-1)),A(m(a.patient.prescriber),1)])):c("",!0),(K=a.patient)!=null&&K.nextAppointment?(r(),u("span",bt,[t[2]||(t[2]=n("b",null,"Nxt App:",-1)),A(" "+m(a.patient.nextAppointment),1)])):c("",!0)])):c("",!0),v.value===0&&((Q=a.patient)!=null&&Q.diagnoses)&&a.patient.diagnoses.length>0?(r(),u("div",xt,[n("span",_t,[t[3]||(t[3]=n("b",null,"Diagnoses:",-1)),A(" "+m(a.patient.diagnoses.filter(b=>b).join(", ")),1)])])):c("",!0),v.value===0&&T.value?(r(),u("div",ht,[(Y=(X=a.patient)==null?void 0:X.vitals)!=null&&Y.height?(r(),u("span",wt,m(a.patient.vitals.height),1)):c("",!0),(Z=(J=a.patient)==null?void 0:J.vitals)!=null&&Z.weight?(r(),u("span",It,m(a.patient.vitals.weight),1)):c("",!0),(te=(ee=a.patient)==null?void 0:ee.vitals)!=null&&te.bloodPressure?(r(),u("span",Nt,m(a.patient.vitals.bloodPressure),1)):c("",!0),(ne=a.patient)!=null&&ne.bloodGlucose?(r(),u("span",Ct,m(a.patient.bloodGlucose),1)):c("",!0)])):c("",!0),_.value.length>0?(r(),u("table",Dt,[v.value===0?(r(),u("thead",kt,t[4]||(t[4]=[n("tr",null,[n("th",{style:{border:"1px solid black"}},"Drug"),n("th",{style:{border:"1px solid black"}},"Dose"),n("th",{style:{border:"1px solid black"}},"Freq"),n("th",{style:{border:"1px solid black"}},"Qty")],-1)]))):c("",!0),n("tbody",null,[(r(!0),u(F,null,Ve(_.value,(b,ve)=>(r(),u("tr",{key:ve},[n("td",Pt,m((b==null?void 0:b.name)||""),1),n("td",$t,m((b==null?void 0:b.dose)||""),1),n("td",St,m((b==null?void 0:b.frequency)||""),1),n("td",Vt,m((b==null?void 0:b.quantity)||""),1)]))),128))])])):c("",!0)],4)}}}),Ot=me(Mt,[["__scopeId","data-v-0b4f60f7"]]);async function zt(){await Ue(Ot,{copies:1})}function Et(){const a=x(Oe.isNativePlatform()),N=x([]),I=x(null),w=x(!1),v=x(null),y=fe().patient;return{isMobile:a,visits:N,event:I,popoverOpen:w,program:v,patient:y,openPopover:t=>{I.value=t,w.value=!0},openPIM:()=>{L(Le,{class:"fullScreenModal"})},openOutCome:()=>{L(He,{class:"large-modal-x10"})},printVisitSummary:async()=>{z.getProgramID()==1?await Be():z.getProgramID()==32?await zt():new ie().printData("visit")},printID:()=>{new ie().printData("barcode")},formatCurrentAddress:t=>{var D,k,P;return[(D=t==null?void 0:t.personInformation)==null?void 0:D.current_district,(k=t==null?void 0:t.personInformation)==null?void 0:k.current_traditional_authority,(P=t==null?void 0:t.personInformation)==null?void 0:P.current_village].filter(Boolean).join(",")},openUpdateNCDNUmbers:()=>{L(ct,{class:"large-modal-x10"})}}}export{Le as _,Et as u};

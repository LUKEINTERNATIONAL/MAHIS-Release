System.register(["./vendor-legacy-BH_ZsSq_.js","./index-legacy-BYpewox5.js","./DemographicBar-legacy-BsNbomNM.js","./TreatmentPlan-legacy-DNYr0sCh.js","./NextAppointment-legacy-BnezlFei.js","./RiskAssessment.vue_vue_type_script_setup_true_lang-legacy-BnO6GY2K.js","./Vitals.vue_vue_type_script_setup_true_lang-legacy-TyHkiEUe.js","./useFormWizard-legacy-bIYnYKbF.js","./lodash-legacy-pOOc9Efu.js","./formatServerData-legacy-8K567ytJ.js","./Registration-legacy-CCk_PWij.js","./usePatientProfile-legacy-C_dfvJCp.js","./apexcharts-legacy-BgAxpgBq.js","./DashBox-legacy-D5IQk4DE.js","./BasicForm-legacy-pIelPXPA.js","./DateInputField-legacy-C0FbpBAX.js","./previousDiagnosis-legacy-Dn0b56VP.js","./group_validation-legacy-B0z7rx7t.js","./drug_service-legacy-BZuokMW3.js","./lab_order-legacy-BcI1VISr.js","./stages-legacy-yLbZszij.js","./drug_prescription_service-legacy-DuFMcBwM.js","./ncd_appointment_service-legacy-BuGS-4On.js","./useLocation-legacy-DUQcaORm.js","./useExposeFromStandardForm-legacy-BqlK0Dv2.js","./vaccines_service-legacy-B4xOjHJd.js","./sms_service-legacy-DkL5W9i1.js","./EIRreportsStore-legacy-CTIKe383.js","./Export-legacy-Cj1XSZVz.js","./Outcome-legacy-BFmodtHN.js"],function(e,a){"use strict";var t,n,s,i,l,o,c,r,u,g,v,d,m,p,f,y,_,h,b,D,w,S,C,j,A,k,x,T,P,I,R,N,V,F,z,L,B,E,M,H,O,W,$,G,Z,K,U,X,Y,q,J,Q,ee,ae,te,ne,se,ie,le,oe,ce,re,ue,ge,ve,de;return{setters:[e=>{t=e.d,n=e.ar,s=e.cl,i=e.r,l=e.b2,o=e.a,c=e.w,r=e.y,u=e.f,g=e.z,v=e.l,d=e.u,m=e.ah,p=e.k,f=e.m,y=e.i,_=e.bG,h=e.v,b=e.an,D=e.bg},e=>{w=e.az,S=e.u,C=e.aA,j=e.aB,A=e.a3,k=e.c,x=e.aC,T=e.f,P=e.M,I=e.d,R=e.T,N=e.D,V=e.z,F=e.H,z=e.aD,L=e.aE,B=e.aF,E=e.j,M=e.aG,H=e.C,O=e.aH,W=e.O,$=e.S},e=>{G=e.D},e=>{Z=e.u,K=e.D,U=e.C,X=e.T},e=>{Y=e.u,q=e.I,J=e.N,Q=e.M,ee=e.s,ae=e.a,te=e.b,ne=e.c,se=e.d},e=>{ie=e._},e=>{le=e._},e=>{oe=e.u,ce=e._},e=>{re=e.l},e=>{ue=e.a,ge=e.b},e=>{ve=e.C},e=>{de=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){const a={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},me={class:"back_profile"};e("default",t({__name:"ConsultationPlan",setup(e,{expose:t}){const{onTabBeforeChange:pe,onChangeCurrentTab:fe,currentTabIndex:ye}=oe("Consultation Plan"),{printVisitSummary:_e}=de(),he=n(),be=s();i([]),i([]),i(!1);const De=i(!0),we=w(),Se=S(),Ce=C(),je=j(),Ae=A(),ke=Y(),xe=k();x();const Te=T(),Pe=Z(),Ie=P(),{patient:Re}=l(Se),{vitals:Ne}=l(we),{investigations:Ve}=l(Ce),{diagnosis:Fe}=l(je),{substance:ze}=l(Te),{selectedNCDMedicationList:Le}=l(ke),{FootScreening:Be,visualScreening:Ee,cvScreening:Me}=l(Pe),{sessionDate:He}=l(Ie),{apiStatus:Oe}=l(I()),We=()=>xe.NCDActivities.map(e=>({title:e,icon:""})),$e=i(We()),Ge=i(null),Ze=i(null),Ke=i(null),Ue=i(null),Xe=i(null),Ye=i(null),qe=i(null),Je=()=>{var e;if(!$e.value||0===$e.value.length)return console.log("Tabs not yet initialized"),null;const a=ye.value>=0&&ye.value<$e.value.length?ye.value:0;switch(null===(e=$e.value[a])||void 0===e?void 0:e.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(xe.NCDActivities.length>0)switch(xe.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},Qe=()=>{De.value=!1,setTimeout(()=>{ye.value=0,De.value=!0},0)},ea=()=>{const e=w();e.setVitals(e.getInitialVitals(Re.value.ID))},aa=async()=>{const e=V(He.value,"sessionDate","value")||F.sessionDate(),a=z("vitals");for(let n=0;n<$e.value.length;n++){const s=$e.value[n];if("Vital Signs"===s.title)$e.value[n].icon=ta(e,a)?D:"";else if("Risk Assessment"===s.title){const a=z("substanceAbuse");$e.value[n].icon=ta(e,a)?D:""}else if("Investigations"===s.title){var t;const a=null==Re||null===(t=Re.value)||void 0===t||null===(t=t.labOrders)||void 0===t?void 0:t.saved,s=null==a?void 0:a.filter(a=>F.toStandardHisFormat(e)===F.toStandardHisFormat(a.order_date));$e.value[n].icon=(null==s?void 0:s.length)>0?D:""}else if("Diagnosis"===s.title){const a=z("diagnosis");$e.value[n].icon=ta(e,a)?D:""}else if("Complications Screening"===s.title){const a=z("screening");$e.value[n].icon=ta(e,a)?D:""}else"Treatment Plan"===s.title&&(Le.value.length>0?$e.value[n].icon=Q()?D:"":$e.value[n].icon="")}},ta=(e,a)=>{const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},na=async()=>{const e=[{ref:Ge,name:"Vitals"},{ref:Ze,name:"Risk Assessment"},{ref:Ke,name:"Investigations"},{ref:Ue,name:"Diagnosis"},{ref:Xe,name:"Complications Screening"},{ref:Ye,name:"Treatment Plan"},{ref:qe,name:"Next Appointment"}];for(const t of e)if(t.ref.value&&"function"==typeof t.ref.value.onSubmit)try{await t.ref.value.onSubmit()}catch(a){console.error(`Error calling ${t.name} onSubmit:`,a)}else console.log(`${t.name} component ref not available or no onSubmit method`);await(async()=>{const e=O();if(!re.isEmpty(e.selectedMedicalAllergiesList)){const a=W(),t=e.selectedMedicalAllergiesList.map(e=>({concept_id:985,obs_datetime:$.getSessionDate(),value_coded:e.concept_id,location_id:a.facilityLocation.code})),n=await ee(t);await ae(n),e.clearSelectedMedicalAllergiesList()}if(!re.isEmpty(Ae.nonPharmalogicalTherapyAndOtherNotes)){const e=W(),a=[{concept_id:2688,obs_datetime:$.getSessionDate(),value_text:Ae.nonPharmalogicalTherapyAndOtherNotes,location_id:e.facilityLocation.code}];await te(a)}await ne(),await se().saveNonPharmaTherapyPatientData()})(),await(async()=>{const e=[],a=await ue(Ee.value),t=await ge(Be.value),n=await ue(Me.value);var s,i,l,o;a.length>0&&e.push({concept_id:await M.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:M.getSessionDate(),child:a}),t.length>0&&e.push({concept_id:await M.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:M.getSessionDate(),child:t}),n.length>0&&e.push(...n),e.length>0&&(null!==(i=(s=null!==(o=(l=Re.value).screening)&&void 0!==o?o:l.screening={}).unsaved)&&void 0!==i||(s.unsaved=[]),Re.value.screening.unsaved.push(...e),H("Complications saved successfully"))})(),await L(),await B(Re.value),await sa(),he.push("patientProfile")},sa=async()=>{"dismiss"!==await E(ve,{class:"small-confirm-modal "})&&await _e()};return o(async()=>{0!==xe.NCDActivities.length?(Z().resetScreening(),$e.value=We(),await aa(),(void 0===ye.value||ye.value<0)&&(ye.value=0,console.log("Setting initial tab index to 0"))):he.push("patientProfile")}),c(Ne,async()=>{await aa()},{deep:!0}),c(Re,async()=>{Z().resetScreening(),await aa()},{deep:!0}),c(He,async()=>{await aa()},{deep:!0}),c(Ve,async()=>{await aa()},{deep:!0}),c(Fe,async()=>{await aa()},{deep:!0}),c(ze,async()=>{await aa()},{deep:!0}),c(Le,async()=>{await aa()},{deep:!0}),c(be,async e=>{Qe(),ea(),$e.value=We()},{deep:!0}),c(Re,async(e,a)=>{e.ID!=a.ID&&(Qe(),ea())},{deep:!0}),t({saveData:na,markWizard:aa,refreshWizard:Qe}),(e,t)=>(u(),r(d(b),null,{default:g(()=>[v(R),v(d(m),{fullscreen:!0},{default:g(()=>[v(G),p("div",a,[De.value?(u(),r(ce,{key:0,ref:"wizard","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:{text:"Finish",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},"custom-tabs":$e.value,beforeChange:d(pe),onChange:d(fe),"onComplete:wizard":t[1]||(t[1]=e=>na())},{default:g(()=>[p("div",null,[p("div",me,[v(N,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:d(_),"font-weight":"600",onClick:t[0]||(t[0]=e=>{he.push("patientProfile")})},null,8,["icon"])])]),y(p("div",null,[v(le,{ref_key:"vitalsRef",ref:Ge},null,512)],512),[[h,"Vitals"==Je()]]),y(p("div",null,[v(ie,{ref_key:"riskAssessmentRef",ref:Ze},null,512)],512),[[h,"RiskAssessment"==Je()]]),y(p("div",null,[v(q,{ref_key:"investigationsRef",ref:Ke},null,512)],512),[[h,"Investigations"==Je()]]),y(p("div",null,[v(K,{ref_key:"diagnosisRef",ref:Ue},null,512)],512),[[h,"DiagnosisComponent"==Je()]]),y(p("div",null,[v(U,{ref_key:"complicationsRef",ref:Xe},null,512)],512),[[h,"ComplicationsScreening"==Je()]]),y(p("div",null,[v(X,{ref_key:"treatmentPlanRef",ref:Ye},null,512)],512),[[h,"TreatmentPlan"==Je()]]),y(p("div",null,[v(J,{ref_key:"nextAppointmentRef",ref:qe},null,512)],512),[[h,"NextAppointment"==Je()]])]),_:1},8,["custom-tabs","beforeChange","onChange"])):f("",!0)])]),_:1})]),_:1}))}}))}}});

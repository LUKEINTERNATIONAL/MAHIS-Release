var ye=Object.defineProperty;var be=(t,e,o)=>e in t?ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var X=(t,e,o)=>be(t,typeof e!="symbol"?e+"":e,o);import{d as x,cA as De,au as Gt,r as R,c as vt,w as at,a as yt,e as _,f as d,k as n,m as A,p as q,B as f,l as a,u as W,a3 as jt,A as T,I as G,F as M,L as z,cB as Ce,b_ as we,aB as Qt,bA as $e,bn as Se,bS as Yt,bX as ke,E as m,z as s,R as Ie,ar as Q,cC as Xt,cD as Zt,cE as qt,cF as Kt,bd as Ae,cG as te,cH as Pe,cI as Te,cJ as Ne,cK as Oe,cL as Ve,cM as Re,cN as Be,a2 as Fe,bG as Le,at as Me,n as ee,y as V,aZ as Rt,a_ as ne,a$ as ae,b0 as $t,ab as St,W as se,aa as kt,U as st,af as It,S as tt,a9 as et,a7 as Ee,cO as xe,aK as Ue,cP as We,cQ as ze,ap as He,aJ as Je,cR as oe,aS as lt,b2 as bt,$ as Dt,cS as ie,aO as re,cw as At,D as le,bo as Ge,T as dt,as as ct,ac as ot,G as it,X as Pt,a1 as je,cT as Qe,cU as Ye,cV as Xe,cW as Ze,bw as Tt,a0 as de,cX as qe,cY as Ke,cZ as tn,c_ as en,c$ as nn,cl as Bt,cm as an,bN as sn}from"./vendor-BBnHTtmR.js";import{S as J,u as K,_ as U,H as $,A as on,a as ce,b as Ot,P as ut,c as ue,d as rn,e as pt,E as Et,f as ln,B as dn,t as xt,g as Ut,i as Ft,h as ft,j as cn,V as un,k as Ct,l as Z,m as wt,T as pe,U as me,n as pn,o as mn,p as nt,r as Wt,q as zt,s as hn,v as Ht,L as gn}from"./index-53Jeodb6.js";import{m as he}from"./apexcharts-DmuMXiXt.js";import{A as ge}from"./ncd_appointment_service-CqWvWasq.js";import{D as Lt}from"./DateInputField-IBJdGgd7.js";import{V as fn}from"./ViewToggleComponent-C7l9dNDH.js";import{C as _n}from"./chartjs-OMOAOelT.js";import{B as mt}from"./BasicForm-DbOjOBd7.js";import{B as Nt}from"./BasicCard-wIQ3Q9mF.js";import{u as vn}from"./AdministerOtherVaccinesStore-BMHtEMf8.js";import{_ as yn}from"./customDatePicker.vue_vue_type_style_index_0_lang-D_HAuTsw.js";import{s as bn}from"./vaccines_service-CM8z_PIJ.js";import{l as _t}from"./lodash-Dt8AsbQm.js";import{g as Dn}from"./dashboard_service-B2HFoazg.js";import{i as Cn}from"./Img-CJEgX1Vr.js";import{M as wn,_ as $n}from"./ActionButtons.vue_vue_type_script_setup_true_lang-AFljBbZZ.js";import"./sms_service-DyYQl3Eg.js";import"./EIRreportsStore-4YHAzOgo.js";import"./Export-I9zsxihd.js";class Jt extends J{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(e){return await super.getJson("fhir/patient/".concat(e),{id:e})}static async getFhirObservations(e){return await super.getJson("fhir/patient/".concat(e,"/observations/"),{id:e})}}const Sn={class:"fhir-viewer"},kn={class:"container"},In={key:0,class:"main-header"},An={class:"header-line"},Pn={key:0,class:"last-updated-display"},Tn={key:1,class:"card initial-input-card"},Nn={class:"action-area-initial"},On={key:0,class:"card patient-card"},Vn={class:"card-title"},Rn={class:"patient-info-grid"},Bn={class:"info-item"},Fn={class:"info-value"},Ln={class:"info-item"},Mn={class:"info-value"},En={class:"info-item"},xn={class:"info-value"},Un={class:"info-item"},Wn={class:"info-value"},zn={class:"info-value"},Hn={class:"info-value"},Jn={class:"info-label"},Gn={class:"info-value"},jn={key:2,class:"card observations-card"},Qn={class:"card-title"},Yn={class:"observations-grid"},Xn={class:"obs-header"},Zn={class:"obs-title"},qn={class:"obs-details"},Kn={class:"obs-detail obs-value-highlight"},ta={class:"obs-value"},ea={class:"obs-detail"},na={class:"obs-value"},aa={key:0,class:"obs-detail"},sa={class:"obs-value"},oa={key:3,class:"no-data-found"},ia={key:4,class:"no-data-found"},ra={key:5,class:"main-footer"},la=x({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(t){De({"person-circle-outline":ke,"clipboard-outline":Yt,"search-outline":Se,"information-circle-outline":$e,"alert-circle-outline":Qt,"person-add-outline":we,"arrow-back-outline":Ce});const e=t,o=Gt(),i=R(!1),h=R([]),v=R(),c=R(),p=R(null),l=R([]),r=vt(()=>h.value.some(C=>C.resourceType==="Bundle"&&C.entry&&C.entry.some(u=>u.resource&&u.resource.resourceType==="Patient"))),g=vt(()=>l.value.length>0),D=async()=>{if(h.value=[],c.value=null,p.value=null,l.value=[],!v.value){console.error("Please enter a Patient Identifier.");return}i.value=!0;try{const C=await Jt.getFhirPatient(v.value);if(C&&C.entry&&C.entry.length>0){const u=C.entry[0].resource,L=u.id,B=await Jt.getFhirObservations(L);h.value=[C],B&&(h.value.push(B),l.value=B.entry.filter(H=>H.resource&&H.resource.resourceType==="Observation").map(H=>{const P=H.resource;return{id:P.id,display:gt(P),value:Mt(P),date:P.effectiveDateTime,category:P.category&&P.category[0]&&P.category[0].coding&&P.category[0].coding[0]?P.category[0].coding[0].display||P.category[0].coding[0].code:"N/A"}}));const N=u.name&&u.name[0];p.value={personInformation:{given_name:N&&N.given?N.given.join(" "):"",middle_name:N&&N.middle?N.middle.join(" "):"",family_name:N&&N.family?N.family:"",gender:u.gender=="male"?"M":(u==null?void 0:u.gender)=="female"?"F":"",birthdate:u.birthDate||"",cell_phone_number:u.telecom&&u.telecom[0]?u.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:u.contact&&u.contact[0]&&u.contact[0].telecom?u.contact[0].telecom[0].value:""}]}};const k=[C,B].filter(Boolean).reduce((H,P)=>{if(P.meta&&P.meta.lastUpdated){const Y=new Date(P.meta.lastUpdated);return H===null||Y>H?Y:H}return H},null);k&&(c.value=E(k.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch(C){console.error("Error loading FHIR data:",C),h.value=[],c.value=null,p.value=null,l.value=[]}finally{i.value=!1}},b=C=>{if(C.name&&C.name[0]){const u=C.name[0],L=u.given?u.given.join(" "):"",B=u.family||"";return"".concat(L," ").concat(B).trim()||"N/A"}return"N/A"},w=C=>C.identifier&&C.identifier.length>0?C.identifier.map(u=>{let L="Unknown System";if(u.type&&u.type.coding&&u.type.coding[0]&&u.type.coding[0].display)L=u.type.coding[0].display;else if(u.system){const N=u.system.split("/");L=N[N.length-1]||u.system,u.system==="urn:oid:2.16.840.1.113883.4.6"&&(L="Social Security Number")}sessionStorage.setItem(L,u.value);let B=null;return u.assigner&&u.assigner.display?B=u.assigner.display:u.assigner&&u.assigner.reference&&(B=u.assigner.reference.split("/").pop()||u.assigner.reference),{value:u.value||"N/A",systemDisplay:L,periodStart:u.period?u.period.start:null,periodEnd:u.period?u.period.end:null,assignerDisplay:B}}):[],I=C=>C.telecom&&C.telecom.length>0?C.telecom.filter(u=>u.system==="phone"&&u.value):[],y=C=>{if(C.contact&&C.contact.length>0){const u=C.contact.filter(B=>{var N;return(N=B.relationship)==null?void 0:N.some(O=>{var k;return(k=O.coding)==null?void 0:k.some(H=>H.code==="GUARD")})}),L=[];return u.forEach(B=>{B.telecom&&B.telecom.length>0&&B.telecom.filter(N=>N.system==="phone"&&N.value).forEach(N=>L.push(N))}),L}return[]},S=C=>{if(!C)return"N/A";try{return new Date(C).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(u){return console.error("Invalid date string for formatDate:",C,u),"Invalid Date"}},E=C=>{if(!C)return"N/A";try{return new Date(C).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(u){return console.error("Invalid date time string for formatDateTime:",C,u),"Invalid Date/Time"}},F=C=>{if(!C)return"N/A";try{const u=new Date,L=new Date(C);let B=u.getFullYear()-L.getFullYear();const N=u.getMonth()-L.getMonth();return(N<0||N===0&&u.getDate()<L.getDate())&&B--,B}catch(u){return console.error("Invalid birth date string for calculateAge:",C,u),"N/A"}},j=C=>{if(C.meta&&C.meta.tag){const u=C.meta.tag.find(L=>L.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return u?u.code:"Unknown"}return"Unknown"},gt=C=>C.code&&C.code.coding&&C.code.coding[0]&&(C.code.coding[0].display||C.code.coding[0].code)||"Unknown Observation",Mt=C=>C.valueQuantity?"".concat(C.valueQuantity.value," ").concat(C.valueQuantity.unit||"").trim():C.valueString?C.valueString:C.valueBoolean!==void 0?C.valueBoolean?"True":"False":"N/A",fe=()=>{K().setRecord(p.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(l.value)),ve("/registration/manual")},_e=()=>{h.value=[],v.value="",c.value=null,p.value=null,l.value=[]},ve=C=>{o.push({path:C})};return at(()=>o,async()=>{h.value=[],l.value=[]},{deep:!0}),yt(()=>{var C;if(e.initialData.length>0){h.value=e.initialData;const L=e.initialData.filter(Boolean).reduce((O,k)=>{if(k.meta&&k.meta.lastUpdated){const H=new Date(k.meta.lastUpdated);return O===null||H>O?H:O}return O},null);L&&(c.value=E(L.toISOString()));const B=e.initialData.find(O=>O.resourceType==="Bundle"&&O.entry&&O.entry.some(k=>k.resource&&k.resource.resourceType==="Patient"));if(B){const O=(C=B.entry.find(k=>k.resource&&k.resource.resourceType==="Patient"))==null?void 0:C.resource;if(O){const k=O.name&&O.name[0];p.value={personInformation:{given_name:k&&k.given?k.given.join(" "):"",middle_name:k&&k.middle?k.middle.join(" "):"",family_name:k&&k.family?k.family:"",gender:O.gender||"",birthdate:O.birthDate||""}}}}const N=e.initialData.find(O=>O.resourceType==="Bundle"&&O.entry&&O.entry.some(k=>k.resource&&k.resource.resourceType==="Observation"));N&&(l.value=N.entry.filter(O=>O.resource&&O.resource.resourceType==="Observation").map(O=>{const k=O.resource;return{id:k.id,display:gt(k),value:Mt(k),date:k.effectiveDateTime,category:k.category&&k.category[0]&&k.category[0].coding&&k.category[0].coding[0]?k.category[0].coding[0].display||k.category[0].coding[0].code:"N/A"}}))}}),(C,u)=>{var L,B,N,O,k,H;return d(),_("div",Sn,[n("div",kn,[(L=h.value)!=null&&L.length?(d(),_("header",In,[n("div",An,[u[1]||(u[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:q(["last-updated-display","status-"+j(h.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+f(j(h.value[0].entry[0].resource)),3),c.value?(d(),_("span",Pn,"Last Updated: "+f(c.value),1)):A("",!0)])])])):A("",!0),(B=h.value)!=null&&B.length?A("",!0):(d(),_("section",Tn,[a(W(jt),{modelValue:v.value,"onUpdate:modelValue":u[0]||(u[0]=P=>v.value=P),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",Nn,[n("button",{onClick:D,class:"load-data-btn"},[a(W(G),{name:"search-outline"}),u[2]||(u[2]=T(" Find Patient "))])])])),(d(!0),_(M,null,z(h.value,P=>(d(),_("div",{key:P.id},[P.resourceType==="Bundle"&&P.entry&&P.entry[0]&&P.entry[0].resource.resourceType==="Patient"?(d(),_("section",On,[n("h2",Vn,[a(W(G),{name:"person-circle-outline"}),u[3]||(u[3]=T(" Patient Demographics"))]),n("div",Rn,[n("div",Bn,[u[4]||(u[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",Fn,f(b(P.entry[0].resource)),1)]),n("div",Ln,[u[5]||(u[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",Mn,f(P.entry[0].resource.gender||"Not specified"),1)]),n("div",En,[u[6]||(u[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",xn,f(S(P.entry[0].resource.birthDate)),1)]),n("div",Un,[u[7]||(u[7]=n("span",{class:"info-label"},"Age",-1)),n("span",Wn,f(F(P.entry[0].resource.birthDate))+" years",1)]),I(P.entry[0].resource).length?(d(!0),_(M,{key:0},z(I(P.entry[0].resource),(Y,rt)=>(d(),_("div",{key:"patient-phone-".concat(rt),class:"info-item"},[u[8]||(u[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",zn,f(Y.value),1)]))),128)):A("",!0),y(P.entry[0].resource).length?(d(!0),_(M,{key:1},z(y(P.entry[0].resource),(Y,rt)=>(d(),_("div",{key:"guardian-phone-".concat(rt),class:"info-item"},[u[9]||(u[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",Hn,f(Y.value),1)]))),128)):A("",!0),(d(!0),_(M,null,z(w(P.entry[0].resource),(Y,rt)=>(d(),_("div",{key:Y.value||rt,class:"info-item"},[n("span",Jn,f(Y.systemDisplay),1),n("span",Gn,f(Y.value),1)]))),128))])])):A("",!0)]))),128)),((N=l.value)==null?void 0:N.length)>0?(d(),_("section",jn,[n("h2",Qn,[a(W(G),{name:"clipboard-outline"}),u[10]||(u[10]=T(" Clinical Observations"))]),n("div",Yn,[(d(!0),_(M,null,z(l.value,P=>(d(),_("div",{key:P.id,class:"observation-item"},[n("div",Xn,[n("h3",Zn,f(P.display),1)]),n("div",qn,[n("div",Kn,[u[11]||(u[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",ta,f(P.value),1)]),n("div",ea,[u[12]||(u[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",na,f(E(P.date)),1)]),P.category&&P.category!=="N/A"?(d(),_("div",aa,[u[13]||(u[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",sa,f(P.category),1)])):A("",!0)])]))),128))])])):A("",!0),(O=h.value)!=null&&O.length&&!r.value?(d(),_("div",oa,[n("p",null,[a(W(G),{name:"alert-circle-outline"}),u[14]||(u[14]=T(" No patient data found for the provided identifier. Please try again."))])])):(k=h.value)!=null&&k.length&&r.value&&!g.value?(d(),_("div",ia,[n("p",null,[a(W(G),{name:"information-circle-outline"}),u[15]||(u[15]=T(" No clinical observations found for this patient."))])])):A("",!0),(H=h.value)!=null&&H.length?(d(),_("footer",ra,[n("button",{onClick:_e,class:"back-to-search-btn small-btn"},[a(W(G),{name:"arrow-back-outline"}),u[16]||(u[16]=T(" Back to Search "))]),n("button",{onClick:fe,class:"register-btn small-btn"},[a(W(G),{name:"person-add-outline"}),u[17]||(u[17]=T(" Register New Patient "))])])):A("",!0)])])}}}),da=U(la,[["__scopeId","data-v-0dc329ef"]]),ca=x({name:"referrals",components:{ExternalReferrals:da},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){this.segmentContent=t}}}),ua={key:0},pa={style:{display:"flex","margin-top":"10px"}},ma={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},ha={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},ga={key:1};function fa(t,e,o,i,h,v){const c=m("ion-label"),p=m("ion-segment-button"),l=m("ion-segment"),r=m("ExternalReferrals");return d(),_(M,null,[n("div",null,[a(l,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:s(()=>[a(p,{value:"External referrals",onClick:e[0]||(e[0]=g=>t.setSegmentContent("External referrals"))},{default:s(()=>[a(c,null,{default:s(()=>e[2]||(e[2]=[T("External referrals")])),_:1,__:[2]})]),_:1}),a(p,{value:"Internal referrals",onClick:e[1]||(e[1]=g=>t.setSegmentContent("Internal referrals"))},{default:s(()=>[a(c,null,{default:s(()=>e[3]||(e[3]=[T("Internal referrals")])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(d(),_("div",ua,[n("div",pa,[t.checkUnderFive?(d(),_("div",ma)):A("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?A("",!0):(d(),_("div",ha))])])):A("",!0),t.segmentContent=="External referrals"?(d(),_("div",ga,[a(r)])):A("",!0)],64)}const _a=U(ca,[["render",fa],["__scopeId","data-v-e09d6a6b"]]),Vt=Ie("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(t){this.selectedItem=t},getSelectedItem(){return this.selectedItem}},persist:!0}),va=()=>{const t=R(null);return{activeIteminMixin:t,setActiveItem:o=>{t.value=o,console.log("lll: ",t.value)}}},ht=x({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:t,setActiveItem:e}=va();return{chevronBackOutline:Le,checkmark:Fe,grid:Be,chevronDownCircle:Re,chevronForwardCircle:Ve,chevronUpCircle:Oe,colorPalette:Ne,document:Te,globe:Pe,medkit:te,add:Ae,person:Kt,people:qt,thermometer:Zt,clipboard:Xt,activeIteminMixin:t,setActiveItem:e}},async mounted(){await this.setAppointments()},computed:{...Q(K,["patient"])},watch:{$route:{async handler(t){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await on.getDailiyAppointments($.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((t,e)=>t.given_name.localeCompare(e.given_name)))},formatBirthdate(t){return $.getBirthdateAge(t)},setActiveItemRefFN(t){Vt().setSelectedItem(t)}}}),ya=x({name:"NCDDashboard",mixins:[ht],components:{ApexChart:he},setup(){return{router:Gt()}},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await ee(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){try{return J.getJson("programs/32/reports/ncd_dashboard",{start_date:$.toStandardHisFormat($.sessionDate()),end_date:$.toStandardHisFormat($.sessionDate())})}catch(t){return[]}},navigationMenu(t){try{Me.close(),this.router.push(t).then(()=>{})}catch(e){console.error(e)}}}}),ba={class:"cards-container"},Da={class:"top-card-text"},Ca={class:"text-2xl font-bold"},wa={class:"top-card-text"},$a={class:"text-2xl font-bold"},Sa={class:"top-card-text"},ka={class:"text-2xl font-bold"},Ia={class:"top-card-text"},Aa={class:"text-2xl font-bold"},Pa={class:"top-card-text"},Ta={class:"text-2xl font-bold"},Na={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},Oa={ref:"chartRef1"},Va={ref:"chartRef2"};function Ra(t,e,o,i,h,v){const c=m("ion-card-content"),p=m("ion-card"),l=m("ApexChart");return d(),_(M,null,[n("div",ba,[a(p,{class:"top-card action-card",onClick:e[0]||(e[0]=r=>t.setActiveItemRefFN("appointments"))},{default:s(()=>[a(c,null,{default:s(()=>[n("div",Da,[n("div",Ca,f(t.appointments.length),1),e[2]||(e[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]),_:1})]),_:1}),a(p,{class:"top-card action-card"},{default:s(()=>[a(c,null,{default:s(()=>{var r;return[n("div",wa,[n("div",$a,f((r=t.dashboardData)==null?void 0:r.total_pending_dispensations),1),e[3]||(e[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]}),_:1})]),_:1}),a(p,{class:"top-card action-card"},{default:s(()=>[a(c,null,{default:s(()=>{var r;return[n("div",Sa,[n("div",ka,f((r=t.dashboardData)==null?void 0:r.total_defaulters),1),e[4]||(e[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]}),_:1})]),_:1}),a(p,{class:"top-card action-card"},{default:s(()=>[a(c,null,{default:s(()=>{var r;return[n("div",Ia,[n("div",Aa,f((r=t.dashboardData)==null?void 0:r.total_complications),1),e[5]||(e[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]}),_:1})]),_:1}),a(p,{class:"top-card action-card",onClick:e[1]||(e[1]=r=>t.navigationMenu("NCDActivePatients"))},{default:s(()=>[a(c,null,{default:s(()=>{var r;return[n("div",Pa,[n("div",Ta,f((r=t.dashboardData)==null?void 0:r.total_client_registered),1),e[6]||(e[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]}),_:1})]),_:1})]),n("div",Na,[a(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(c,null,{default:s(()=>[e[7]||(e[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",Oa,[t.isChartReady?(d(),V(l,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):A("",!0)],512)]),_:1,__:[7]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(c,null,{default:s(()=>[e[8]||(e[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",Va,[t.isChartReady?(d(),V(l,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):A("",!0)],512)]),_:1,__:[8]})]),_:1})])],64)}const Ba=U(ya,[["render",Ra],["__scopeId","data-v-18251377"]]),Fa=x({name:"Home",mixins:[ce,ht],components:{IonContent:et,IonHeader:tt,IonPage:It,IonToolbar:st,IonRow:kt,DateInputField:Lt,IonIcon:G,IonButton:se,IonCol:St,IonCard:$t,IonCardHeader:ae,IonCardTitle:ne,IonCardContent:Rt,ViewToggleComponent:fn},data(){const t=localStorage.getItem("ncdStartDate"),e=localStorage.getItem("ncdEndDate"),o=R(t||$.sessionDate()),i=R(e||$.sessionDate()),h=R($.sessionDate()),v=R($.sessionDate()),c=R([]);return{minDate:h,startDate:o,endDate:i,people:c,calendarOutline:lt,openOutline:oe,maxDate:v,alertCircleOutline:Qt,personOutline:Je,idCardOutline:He,manOutline:ze,womanOutline:We,locationOutline:Ue,timeOutline:xe,todayOutline:Ee}},computed:{...Q(Ot,["NCDAppointmentsTogglePreference"])},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{formatBirthdate(t){return $.getBirthdateAge(t)},async getAppointments(t=!1){if(ue().apiStatus){this.people=[];try{t==!0&&(this.startDate=$.sessionDate(),this.endDate=$.sessionDate(),this.getAppointmentsD1(this.startDate),this.getAppointmentsD2(this.endDate)),this.startDate>this.endDate&&(this.endDate=this.startDate),console.log(this.startDate,this.endDate),(await ge.getAppointments(this.startDate,this.endDate,"")).forEach(i=>{const h=$.toStandardHisDisplayFormat(i.appointment_date);if(!this.people.some(c=>c.person_id===i.person_id&&c.appointmentDate===h)){const c={person_id:i.person_id,npid:i.npid,appointment_id:103,encounter_id:i.encounter_id,name:i.given_name.concat(" ",i.family_name),gender:i.gender,ageDob:this.formatBirthdate(i.birthdate),village:i.city_village,appointmentDate:h};this.people.push(c)}})}catch(o){}}},async getAppointmentsD1(t){this.startDate=$.toStandardHisFormat(t),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=$.toStandardHisFormat(t),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(t){const e=await ut.findByNpid(t);K().setPatientRecord(e[0]),this.redirectUser()},handleViewChange(t){this.initTogglePreference(t,!0)},initTogglePreference(t="list",e=!1){const o={toggle_view:t},i=Ot();Object.keys(this.NCDAppointmentsTogglePreference).length===0&&(o.toggle_view="list",i.setNCDAppointmentsTogglePreference(o)),Object.keys(this.NCDAppointmentsTogglePreference).length>0&&e==!0&&i.setNCDAppointmentsTogglePreference(o)},redirectUser(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(o=>e.some(i=>i.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")}}}),La={class:"appointments-container"},Ma={class:"date-filter"},Ea={key:0,style:{margin:"20px"}},xa={key:1},Ua={class:"appointments-table"},Wa={key:2},za={class:"cards-container"},Ha={class:"card-details"},Ja={class:"detail-item"},Ga={class:"detail-value"},ja={class:"detail-item"},Qa={class:"detail-value"},Ya={class:"detail-item"},Xa={class:"detail-value"},Za={class:"detail-item"},qa={class:"detail-value"},Ka={class:"detail-item appointment-date"},ts={class:"detail-value"};function es(t,e,o,i,h,v){const c=m("DateInputField"),p=m("ion-col"),l=m("ion-icon"),r=m("ion-button"),g=m("ion-row"),D=m("ViewToggleComponent"),b=m("ion-card"),w=m("ion-card-title"),I=m("ion-card-header"),y=m("ion-card-content");return d(),_("div",La,[n("div",Ma,[a(g,null,{default:s(()=>[a(p,null,{default:s(()=>[a(c,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(p,null,{default:s(()=>[a(c,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1}),a(p,null,{default:s(()=>[a(r,{color:"primary",onClick:e[0]||(e[0]=S=>t.getAppointments(!0)),class:"apt-btn"},{default:s(()=>[a(l,{icon:t.todayOutline,slot:"start"},null,8,["icon"]),e[1]||(e[1]=n("span",{style:{margin:"5px"}}," Today ",-1))]),_:1,__:[1]})]),_:1})]),_:1})]),a(D,{"initial-view":t.NCDAppointmentsTogglePreference.toggle_view,onViewChanged:t.handleViewChange},null,8,["initial-view","onViewChanged"]),t.people.length===0?(d(),_("div",Ea,[a(l,{icon:t.alertCircleOutline,size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),e[2]||(e[2]=n("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Appointments for selected date range",-1))])):t.NCDAppointmentsTogglePreference.toggle_view==="list"&&t.people.length>0?(d(),_("div",xa,[a(b,null,{default:s(()=>[n("table",Ua,[e[3]||(e[3]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),_(M,null,z(t.people,S=>(d(),_("tr",{key:S.npid},[n("td",null,[a(g,null,{default:s(()=>[a(p,null,{default:s(()=>[T(f(S.name),1)]),_:2},1024),a(p,null,{default:s(()=>[a(r,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:E=>t.openClientProfile(S.npid),color:"primary",fill:"clear",size:"small"},{default:s(()=>[a(l,{icon:t.openOutline,style:{"font-size":"28px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,f(S.npid),1),n("td",null,f(S.ageDob),1),n("td",null,f(S.gender),1),n("td",null,f(S.village),1),n("td",null,f(S.appointmentDate),1)]))),128))])])]),_:1})])):t.NCDAppointmentsTogglePreference.toggle_view==="card"&&t.people.length>0?(d(),_("div",Wa,[n("div",za,[(d(!0),_(M,null,z(t.people,S=>(d(),V(b,{key:S.npid,class:"appointment-card"},{default:s(()=>[a(I,null,{default:s(()=>[a(g,{class:"ion-align-items-center"},{default:s(()=>[a(p,null,{default:s(()=>[a(w,{class:"card-name"},{default:s(()=>[a(l,{icon:t.personOutline,class:"name-icon"},null,8,["icon"]),T(" "+f(S.name),1)]),_:2},1024)]),_:2},1024),a(p,{size:"auto"},{default:s(()=>[a(r,{onClick:E=>t.openClientProfile(S.npid),color:"primary",fill:"clear",size:"small",class:"view-profile-btn"},{default:s(()=>[a(l,{icon:t.openOutline},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(y,null,{default:s(()=>[n("div",Ha,[n("div",Ja,[a(l,{icon:t.idCardOutline,class:"detail-icon"},null,8,["icon"]),e[4]||(e[4]=n("span",{class:"detail-label"},"NPID:",-1)),n("span",Ga,f(S.npid),1)]),n("div",ja,[a(l,{icon:t.calendarOutline,class:"detail-icon"},null,8,["icon"]),e[5]||(e[5]=n("span",{class:"detail-label"},"Age/DOB:",-1)),n("span",Qa,f(S.ageDob),1)]),n("div",Ya,[a(l,{icon:S.gender==="Male"?t.manOutline:t.womanOutline,class:"detail-icon"},null,8,["icon"]),e[6]||(e[6]=n("span",{class:"detail-label"},"Gender:",-1)),n("span",Xa,f(S.gender),1)]),n("div",Za,[a(l,{icon:t.locationOutline,class:"detail-icon"},null,8,["icon"]),e[7]||(e[7]=n("span",{class:"detail-label"},"Village:",-1)),n("span",qa,f(S.village),1)]),n("div",Ka,[a(l,{icon:t.timeOutline,class:"detail-icon"},null,8,["icon"]),e[8]||(e[8]=n("span",{class:"detail-label"},"Appointment:",-1)),n("span",ts,f(S.appointmentDate),1)])])]),_:2},1024)]),_:2},1024))),128))])])):A("",!0)])}const ns=U(Fa,[["render",es],["__scopeId","data-v-5f81568d"]]),as={key:0,class:"left_col"},ss={class:"nav-menu"},os=["onClick"],is={class:"ellipsis"},rs={key:1,style:{"padding-left":"20px","padding-right":"20px"}},ls=x({__name:"NCDDashboard",setup(t){const e=Vt(),o=vt(()=>e.selectedItem),{screenWidth:i}=rn(),h=R([{id:"dashboard",label:"Dashboard",icon:ie},{id:"referrals",label:"Referrals",icon:re},{id:"appointments",label:"Appointments",icon:lt}]),v=R("dashboard"),c=pt(),{substance:p}=bt(c);at(()=>p.value,(r,g)=>{r!==g&&console.log("Substance changed:",r)},{deep:!0,immediate:!0});const l=r=>{v.value=r,Vt().setSelectedItem(v.value)};return at(()=>o.value,r=>{console.log("Active item from mixin changed:",r),r&&r!=null&&l(r)},{immediate:!0}),(r,g)=>{const D=m("ion-segment-button"),b=m("ion-segment");return d(),_("div",{style:Dt(W(i)>940?"display: flex":"display: block")},[W(i)>940?(d(),_("div",as,[n("nav",ss,[n("ul",null,[(d(!0),_(M,null,z(h.value,w=>(d(),_("li",{key:w.id,class:q({active:v.value===w.id}),onClick:I=>l(w.id)},[a(W(G),{icon:w.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",is,f(w.label),1)],10,os))),128))])])])):A("",!0),W(i)<=940?(d(),_("div",rs,[a(b,{value:v.value,style:{"margin-top":"5px","justify-content":"left"}},{default:s(()=>[(d(!0),_(M,null,z(h.value,w=>(d(),V(D,{value:w.id,key:w.id,class:q({active:v.value===w.id}),onClick:I=>l(w.id)},{default:s(()=>[a(W(G),{icon:w.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,f(w.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):A("",!0),n("div",{class:"right_col",style:Dt(W(i)>940?"width: 85%":"width: 100%")},[n("div",null,[v.value==="referrals"?(d(),V(_a,{key:0})):A("",!0),v.value==="dashboard"?(d(),V(Ba,{key:1})):A("",!0),v.value==="appointments"?(d(),V(ns,{key:2})):A("",!0)])],4)],4)}}}),ds=U(ls,[["__scopeId","data-v-a1132315"]]),cs=""+new URL("icon/checklist.svg",import.meta.url).href,us=""+new URL("icon/dashboard.svg",import.meta.url).href,ps={name:"Dashboard",setup(){yt(async()=>{o.value=await p(),await l();const g=await r(),{labels:D,totalVisits:b,incompleteVisits:w}=t(g);e(D,b,w)});function t(g){if(!g)return{labels:[],totalVisits:[],incompleteVisits:[]};const D=[],b=[],w=[];return Object.entries(g).forEach(([I,y])=>{const E=new Date(I).toLocaleDateString("en-US",{weekday:"long"});D.push(E),b.push(y.complete),w.push(y.incomplete)}),{labels:D,totalVisits:b,incompleteVisits:w}}function e(g,D,b){const w=document.getElementById("myChart");new _n(w,{type:"bar",data:{labels:g,datasets:[{label:"Total visits",data:D,backgroundColor:"#5aa3b1"},{label:"Incomplete visits",data:b,backgroundColor:"#dba6a2"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}const o=R([]),i=R({}),h=g=>{const D=Object.entries(Et).find(([b,w])=>w===g);return D?D[0]:"Unknown (".concat(g,")")},v=g=>Object.keys(g).map(D=>{var S,E;const b=Number(D),w=h(b),I=((S=g[b])==null?void 0:S.F)||0,y=((E=g[b])==null?void 0:E.M)||0;return{encounter:c(w),female:I,male:y,me:I+y,facility:I+y}}),c=g=>g.toLowerCase().replace(/_/g," ").replace(/\b\w/g,D=>D.toUpperCase()),p=async()=>{try{const g=Object.values(Et).filter(y=>typeof y=="number"),[D,b]=await Promise.all([J.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:g}),J.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:[9,51,6,52,53,68,25,54,7],all:!0})]),w=v(b),I=v(D);return w.map(y=>{const S=I.find(E=>E.encounter===y.encounter);return{...y,me:S?S.female+S.male:0}})}catch(g){return console.error("Error fetching dashboard stats:",g),[]}},l=async()=>{try{const D=new Date().toISOString().split("T")[0],b=await J.getJson("programs/1/dashboard",{date:D});i.value=b}catch(g){console.error("Error fetching visits stats:",g)}},r=async()=>{try{const g=new Date,D=new Date;D.setDate(g.getDate()-5);const b=w=>w.toISOString().split("T")[0];return await J.getJson("programs/1/reports/visits",{name:"visits",end_date:b(g),start_date:b(D)})}catch(g){console.error("Error fetching visits stats:",g)}};return{checkListIcon:cs,dashboardIcon:us,rows:o,dashboardScoreStats:i}}},ms={class:"dashboard-container"},hs={class:"summary-cards"},gs={class:"card"},fs={class:"card"},_s={class:"card"},vs={class:"card"},ys={class:"main-section"},bs={class:"encounters-section"},Ds={class:"his-sm-text"},Cs={key:0},ws={class:"encounter-td"},$s={class:"other-td"},Ss={class:"other-td"},ks={class:"other-td"},Is={class:"other-td"},As={key:1};function Ps(t,e,o,i,h,v){var c,p,l,r,g,D,b,w;return d(),_("div",ms,[n("div",hs,[n("div",gs,[n("h2",null,f(((p=(c=i.dashboardScoreStats)==null?void 0:c.total_patients_today)!=null?p:[]).length||0),1),e[0]||(e[0]=n("p",null,"Total patients today",-1))]),n("div",fs,[n("h2",null,f(((r=(l=i.dashboardScoreStats)==null?void 0:l.waiting_for_vitals)!=null?r:[]).length||0),1),e[1]||(e[1]=n("p",null,"Waiting for vitals",-1))]),n("div",_s,[n("h2",null,f(((D=(g=i.dashboardScoreStats)==null?void 0:g.waiting_for_consultation)!=null?D:[]).length||0),1),e[2]||(e[2]=n("p",null,"Waiting for consultation",-1))]),n("div",vs,[n("h2",null,f(((w=(b=i.dashboardScoreStats)==null?void 0:b.waiting_for_dispensation)!=null?w:[]).length||0),1),e[3]||(e[3]=n("p",null,"Waiting for dispensation",-1))])]),n("div",ys,[e[7]||(e[7]=n("div",{class:"chart-section"},[n("h3",null,"Total visits/incomplete visits: last 5 days"),n("canvas",{id:"myChart"})],-1)),n("div",bs,[e[6]||(e[6]=n("h3",null,"Encounters created today",-1)),n("table",Ds,[e[5]||(e[5]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),i.rows.length?(d(),_("tbody",Cs,[(d(!0),_(M,null,z(i.rows,(I,y)=>(d(),_("tr",{key:y},[n("td",ws,f(I.encounter),1),n("td",$s,f(I.female),1),n("td",Ss,f(I.male),1),n("td",ks,f(I.me),1),n("td",Is,f(I.facility),1)]))),128))])):(d(),_("tbody",As,e[4]||(e[4]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])))])])])])}const Ts=U(ps,[["render",Ps]]);class Ns{constructor(){X(this,"socket",null);X(this,"channel","ImmunizationReportChannel");X(this,"isConnected",!1);X(this,"pendingFetch",null);X(this,"location_id");X(this,"initPromise");X(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});X(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});X(this,"onError",e=>{console.error("WebSocket error:",e),this.isConnected=!1});this.initPromise=this.init()}async init(){const e=localStorage.getItem("apiURL"),o=localStorage.getItem("apiPort"),i=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const h="".concat(i,"://").concat(e,"/api/v1/cable");this.socket=new WebSocket(h),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(h){console.error(h),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const e={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(e))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await J.getJson("immunization/stats",{start_date:$.getDateBeforeByDays($.sessionDate(),365),end_date:$.sessionDate()})}async setMessageHandler(e){await this.initPromise,this.socket?this.socket.onmessage=o=>{e(o)}:console.error("WebSocket connection not established.")}}const Os=x({components:{IonContent:et,IonHeader:tt,IonItem:it,IonList:ot,IonMenu:ct,IonTitle:dt,IonToolbar:st,IonInput:jt,BasicInputField:dn,BasicForm:mt,PreviousVitals:ln,customDatePicker:yn,IonCol:St,IonRow:kt,VueMultiselect:Ge,IonLabel:le,DataTable:At},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:Ft,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:$.toStandardHisDisplayFormat(J.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...Q(vn,["administerOtherVaccine"]),...Q(Ut,["tempScannedBatchNumber"]),...Q(K,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await Dn(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:Kt,pulseOutline:je,clipboardOutline:Yt}},methods:{formatBirthdate(t){return $.getBirthdateAge(t)},async openClientProfile(t){const e=await ut.findByID(t);await K().setPatientRecord(e),this.$router.push("patientProfile")},processData(){var e;return((e=this.data)==null?void 0:e.map(o=>{if(o.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let i=[];const h=v=>v.map(p=>{let l=0;return p.clients.map(r=>{(p.drug_name==this.drug_name&&(this.village==r.table.city_village||this.village=="All")||(p.drug_name==this.drug_name||this.village==r.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:r.table.given_name,family_name:r.table.family_name,patient_id:r.table.patient_id,birthdate:r.table.birthdate,city_village:r.table.city_village}),l++),this.villageList.push(r.table.city_village)}),[p.drug_name,l]}).filter(p=>p[1]!==0);return this.title=="Client due today"&&(i=h(o.value.due_today_antigens)),this.title=="Client due this week"&&(i=h(o.value.due_this_week_antigens)),this.title=="Client due this month"&&(i=h(o.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(i=h(o.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(i=h(o.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(v=>JSON.stringify(v)))].map(v=>JSON.parse(v)),this.villageList=[...new Set(this.villageList)],i}}))[0]},handleVillageClick(t){this.drug_name="",this.village=t,this.tableData=this.processData()},handleRowClick(t){var o;this.tableEvent=t.target;const e=this.tableEvent.closest("tr");if(e){const i=Array.from(((o=e.parentNode)==null?void 0:o.children)||[]).indexOf(e),h=this.tableData[i];this.drug_name=h[0],e.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(t){return $.calculateDisplayAge(t)},openPopover(t){this.event=t,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(t){var o;const e=t.target.value;this.batchNumber=e||((o=this.tempScannedBatchNumber)==null?void 0:o.text)||""},saveBatchWithTodayDate(){let t=J.getSessionDate();this.saveDta(t)},dismiss(){Pt.dismiss()},saveBatch(){let t;_t.isEmpty(this.vaccineDate)==!0?t=J.getSessionDate():t=this.vaccineDate,this.saveDta(t)},validateVaccineName(){if(_t.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(_t.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(t){this.currentDrugOb=t},isAlphaNumeric(t){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(t)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(t){this.batchNumber=t},saveDta(t){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){xt("Enter batch number!");return}if(this.batchNumber==""){xt("Enter batch number!");return}const e={batch_number:this.batchNumber,date_administered:t,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},o=Ut();o.setAdministeredVaccine(e),bn(this.patient),this.dismiss(),o.setTempScannedBatchNumber(null)}}}),Vs={key:0,class:"spinner-overlay"},Rs={class:"header position_content"},Bs={style:{"font-size":"1.2em","font-weight":"700"}},Fs={class:"dueCardContent"},Ls=["onClick"],Ms={style:{"margin-right":"15px"}},Es={style:{"align-items":"center",display:"flex"}},xs={style:{"line-height":"1"}},Us={class:"client_name"},Ws={class:"name"},zs={class:"demographicsOtherRow"},Hs={class:"demographicsText"};function Js(t,e,o,i,h,v){const c=m("ion-spinner"),p=m("ion-icon"),l=m("ion-header"),r=m("ion-card-title"),g=m("ion-card-header"),D=m("DataTable"),b=m("ion-card-content"),w=m("ion-card"),I=m("ion-item"),y=m("ion-list"),S=m("ion-popover"),E=m("ion-content");return d(),_(M,null,[t.isLoading?(d(),_("div",Vs,[a(c,{name:"bubbles"}),e[3]||(e[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):A("",!0),a(l,null,{default:s(()=>[n("div",Rs,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=F=>t.dismiss())},[a(p,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Bs,f(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=F=>t.openPopover(F))},[a(p,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(E,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:s(()=>[n("div",null,[a(w,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:s(()=>[a(g,null,{default:s(()=>[a(r,{class:"sectionTitle"},{default:s(()=>e[4]||(e[4]=[T(" Summary of required doses ")])),_:1,__:[4]})]),_:1}),a(b,null,{default:s(()=>[n("div",Fs,[a(D,{options:t.options,data:t.tableData,class:"display nowrap",width:"100%",onClick:t.handleRowClick},{default:s(()=>e[5]||(e[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])),_:1,__:[5]},8,["options","data","onClick"])])]),_:1})]),_:1}),a(w,{class:"section",style:{"margin-inline":"0px"}},{default:s(()=>[a(g,null,{default:s(()=>[a(r,{class:"sectionTitle"},{default:s(()=>e[6]||(e[6]=[T("Client Details ")])),_:1,__:[6]})]),_:1}),a(b,null,{default:s(()=>[(d(!0),_(M,null,z(t.clientDetails,(F,j)=>(d(),_("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:j,onClick:gt=>t.openClientProfile(F.patient_id)},[n("div",Ms,[n("div",{class:q((F==null?void 0:F.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(p,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),n("div",Es,[n("div",xs,[n("div",Us,[n("div",Ws,f(F.given_name)+" "+f(F.family_name),1)]),n("div",zs,[n("div",Hs,[T(f(F.gender=="M"?"Male":"Female")+" ",1),e[7]||(e[7]=n("span",{class:"dot"},".",-1)),T(f(t.formatBirthdate(F.birthdate)),1)])]),n("div",null,"Village: "+f(F.city_village),1)])])],8,Ls))),128))]),_:1})]),_:1})]),a(S,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:t.event,onDidDismiss:e[2]||(e[2]=F=>t.popoverOpen=!1)},{default:s(()=>[n("div",null,[e[8]||(e[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(d(!0),_(M,null,z(t.villageList,(F,j)=>(d(),V(y,{class:q(F==t.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:j},{default:s(()=>[a(I,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:gt=>t.handleVillageClick(F)},{default:s(()=>[T(f(F),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const Gs=U(Os,[["render",Js],["__scopeId","data-v-2b76e9ce"]]),js=x({name:"Menu",mixins:[ht],components:{IonContent:et,IonHeader:tt,IonItem:it,IonList:ot,IonMenu:ct,IonTitle:dt,IonToolbar:st,IonCheckbox:Tt,BasicForm:mt,BasicCard:Nt,Carousel:Ze,Slide:Xe,Pagination:Ye,Navigation:Qe},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},computed:{...Q(pt,["substance"]),backgroundStyle(){return{background:"linear-gradient(180deg, rgba(150, 152, 152, 0.7) 0%, rgba(255, 255, 255, 0.9) 100%), url(".concat(Cn("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",height:"22.8vh"}}},watch:{},async mounted(){new Ns().setMessageHandler(this.onMessage)},methods:{async onMessage(t){var o,i,h;const e=JSON.parse(t.data);e.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=e.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((o=this.reportData)==null?void 0:o.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((i=this.reportData)==null?void 0:i.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((h=this.reportData)==null?void 0:h.total_male_vaccinated_this_year)||0}])},openDueModal(t){const e={title:t,dashBoardData:this.reportData};ft(Gs,{class:"fullScreenModal"},!0,e)},async openClientProfile(t){const e=await ut.findByNpid(t);await K().setPatientRecord(e[0]),this.$router.push("patientProfile")}}}),Qs={class:"topStats"},Ys={class:"totalStats",style:{background:"linear-gradient(180deg, #20b2aa 0%, #40c0b0 50%, rgb(233, 233, 233) 100%)"}},Xs={class:"statsValue",style:{"font-size":"1.4em"}},Zs={class:"statsText",style:{"font-size":"0.9em"}},qs={class:"dueCardContent"},Ks={class:"statsValue"},to={class:"statsValue"},eo={class:"statsValue"},no={class:"overDueCardContent"},ao={class:"statsValue"},so={class:"statsValue"},oo=["onClick"],io={style:{"margin-right":"15px"}},ro={style:{"align-items":"center",display:"flex"}},lo={style:{"line-height":"1"}},co={class:"client_name"},uo={class:"name"},po={class:"demographicsOtherRow"},mo={class:"demographicsText"};function ho(t,e,o,i,h,v){const c=m("Slide"),p=m("Pagination"),l=m("Carousel"),r=m("ion-card-title"),g=m("ion-card-header"),D=m("ion-card-content"),b=m("ion-card"),w=m("ion-icon"),I=m("ion-content");return d(),V(I,{class:"content"},{default:s(()=>[n("div",Qs,[n("div",null,[n("div",{style:Dt(t.backgroundStyle)},[a(l,{autoplay:4e3,"wrap-around":!0,itemsToShow:1.2,transition:600,style:{"padding-top":"20px"}},{addons:s(()=>[a(p)]),default:s(()=>[(d(!0),_(M,null,z(t.totalStats,y=>(d(),V(c,{key:y},{default:s(()=>[n("div",Ys,[n("div",Xs,f(y.value),1),n("div",Zs,f(y.name),1)])]),_:2},1024))),128))]),_:1})],4)]),a(b,{class:"section"},{default:s(()=>[a(g,null,{default:s(()=>[a(r,{class:"cardTitle"},{default:s(()=>e[5]||(e[5]=[T(" Clients due ")])),_:1,__:[5]})]),_:1}),a(D,null,{default:s(()=>{var y,S,E;return[n("div",qs,[n("div",{class:"dueCard",onClick:e[0]||(e[0]=F=>t.openDueModal("Client due today")),style:{border:"1px solid rgb(158, 207, 136)"}},[n("div",Ks,f(((y=t.reportData)==null?void 0:y.due_today_count)||0),1),e[6]||(e[6]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(239, 221, 121)"},onClick:e[1]||(e[1]=F=>t.openDueModal("Client due this week"))},[n("div",to,f(((S=t.reportData)==null?void 0:S.due_this_week_count)||0),1),e[7]||(e[7]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(241, 154, 154)"},onClick:e[2]||(e[2]=F=>t.openDueModal("Client due this month"))},[n("div",eo,f(((E=t.reportData)==null?void 0:E.due_this_month_count)||0),1),e[8]||(e[8]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),a(b,{class:"section"},{default:s(()=>[a(g,null,{default:s(()=>[a(r,{class:"cardTitle"},{default:s(()=>e[9]||(e[9]=[T(" Clients overdue ")])),_:1,__:[9]})]),_:1}),a(D,null,{default:s(()=>{var y,S;return[n("div",no,[n("div",{class:"overDueCard",onClick:e[3]||(e[3]=E=>t.openDueModal("Client overdue under 5yrs"))},[n("div",ao,f(((y=t.reportData)==null?void 0:y.under_five_overdue)||0),1),e[10]||(e[10]=n("div",{class:"statsText"},"Under 5yrs",-1))]),n("div",{class:"overDueCard",onClick:e[4]||(e[4]=E=>t.openDueModal("Client overdue over 5yrs"))},[n("div",so,f(((S=t.reportData)==null?void 0:S.over_five_overdue)||0),1),e[11]||(e[11]=n("div",{class:"statsText"},"Over 5yrs",-1))])])]}),_:1})]),_:1}),a(b,{class:"section"},{default:s(()=>[a(g,null,{default:s(()=>[a(r,{class:"cardTitle"},{default:s(()=>{var y;return[T("Today's appointments("+f((y=t.appointments)==null?void 0:y.length)+") ",1)]}),_:1})]),_:1}),a(D,null,{default:s(()=>[(d(!0),_(M,null,z(t.appointments,(y,S)=>(d(),_("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:S,onClick:E=>t.openClientProfile(y.npid)},[n("div",io,[n("div",{class:q(y.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(w,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),n("div",ro,[n("div",lo,[n("div",co,[n("div",uo,f(y.given_name)+" "+f(y.family_name),1)]),n("div",po,[n("div",mo,[T(f(y.gender=="M"?"Male":"Female")+" ",1),e[12]||(e[12]=n("span",{class:"dot"},".",-1)),T(f(t.formatBirthdate(y.birthdate)),1)])]),n("div",null,"Village: "+f(y==null?void 0:y.city_village),1)])])],8,oo))),128))]),_:1})]),_:1})])]),_:1})}const go=U(js,[["render",ho],["__scopeId","data-v-a8eeb2dc"]]),fo=x({components:{DataTable:At},props:{title:{type:String,default:""},list:{type:String,default:""},buttonTitle:{type:String,default:""},buttonLink:{type:String,default:""}},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:t=>this.waitingTime(t),width:"15%"},{title:"Actions",data:null,render:(t,e,o)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px";const h="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",v=(c,p,l)=>{const r=document.createElement("ion-button");return r.innerText=c,r.size="small",r.fill="solid",r.color=p,r.style.cssText=h,r.addEventListener("click",l),r};return i.appendChild(v(this.buttonTitle,"primary",()=>this.navigateTo(o.patientId,this.buttonLink))),i.appendChild(v("Profile","warning",()=>this.navigateTo(o.patientId,"/patientProfile"))),i.appendChild(v("Abscond","danger",()=>this.handleAbscond(o))),i},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},computed:{...Q(Ct,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{patientsWaitingForConsultation:{handler(t){this.list==="CONSULTATION"&&(this.patients=t)},deep:!0},patientsWaitingForVitals:{handler(t){this.list==="VITALS"&&(this.patients=t)},deep:!0},patientsWaitingForLab:{handler(t){this.list==="LAB"&&(this.patients=t)},deep:!0},patientsWaitingForDispensation:{handler(t){this.list==="DISPENSATION"&&(this.patients=t)},deep:!0}},mounted(){this.setList()},methods:{setList(){const t={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation},e=this.list;this.patients=t[e]||[]},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),o=Math.floor(e/6e4);if(o<1)return"Just now";if(o<60)return"".concat(o," min").concat(o>1?"s":""," ago");const i=Math.floor(o/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const h=Math.floor(i/24);return"".concat(h," day").concat(h>1?"s":""," ago")},async navigateTo(t,e){try{const o=await Z("patientRecords",{whereClause:{patientID:t}});if(console.log("patientRecords:",o),!o||o.length===0){wt("Patient not found in offline records.");return}const i=o[0];await K().setPatientRecord(i),this.$router.push(e)}catch(o){console.error("Navigation error:",o),wt("Error occurred while loading patient.")}},async handleAbscond(t){try{console.log("The patient being absconded",t);const e=String(localStorage.getItem("locationID"));await cn.abscondPatient(t),await un.closePatientVisit({patientId:t.patientId,visit_id:t.visit_id}),await Ct().refresh(e)}catch(e){console.error("Failed to abscond patient:",e)}},dismiss(){Pt.dismiss()}}}),_o={class:"modal-container"},vo={class:"dueCardContent"};function yo(t,e,o,i,h,v){const c=m("ion-button"),p=m("ion-card-title"),l=m("ion-card-header"),r=m("DataTable"),g=m("ion-card-content"),D=m("ion-card");return d(),_("div",_o,[a(c,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:s(()=>e[0]||(e[0]=[T(" Close ")])),_:1,__:[0]},8,["onClick"]),a(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:s(()=>[a(l,null,{default:s(()=>[a(p,{class:"sectionTitle"},{default:s(()=>[T(f(t.title),1)]),_:1})]),_:1}),a(g,null,{default:s(()=>[n("div",vo,[a(r,{data:t.patients,columns:t.tableColumns,class:"display nowrap compact",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})])}const bo=U(fo,[["render",yo],["__scopeId","data-v-95acce1d"]]),Do=x({components:{IonContent:et,IonHeader:tt,IonItem:it,IonList:ot,IonIcon:G,IonCard:$t,IonCardHeader:ae,IonCardTitle:ne,IonCardContent:Rt,IonPopover:de,DataTable:At},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:Ft,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:t=>this.waitingTime(t),width:"20%"},{title:"Actions",data:null,render:(t,e,o)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px";const h="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",v=(c,p,l)=>{const r=document.createElement("ion-button");return r.innerText=c,r.size="small",r.fill="solid",r.color=p,r.style.cssText=h,r.addEventListener("click",l),r};return i.appendChild(v("Profile","warning",()=>this.navigateTo(o.patient_id,"/patientProfile"))),i},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const t=String(localStorage.getItem("locationID")),e=new Date().toISOString().split("T")[0],o=await Z("visits")||[],i=await Z("unsavedVisits")||[],v=[...o,...i.filter(l=>l.sync_status==="pending")].filter(l=>String(l.location_id)===t&&l.startDate>="".concat(e,"T00:00:00")&&l.startDate<="".concat(e,"T23:59:59")),c=await Z("patientRecords")||[],p={};c.forEach(l=>{p[l.patientID]=l,p[String(l.patientID)]=l}),this.patients=v.map(l=>{var D,b,w;const r=p[l.patientId]||{};return{fullName:[(D=r==null?void 0:r.personInformation)==null?void 0:D.given_name,(b=r==null?void 0:r.personInformation)==null?void 0:b.middle_name,(w=r==null?void 0:r.personInformation)==null?void 0:w.family_name].filter(Boolean).join(" ").trim()||"Unknown (ID: ".concat(l.patientId,")"),arrivalTime:l.startDate,patient_id:l.patientId}})},methods:{openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Pt.dismiss()},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),o=Math.floor(e/6e4);if(o<1)return"Just now";if(o<60)return"".concat(o," min").concat(o>1?"s":""," ago");const i=Math.floor(o/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const h=Math.floor(i/24);return"".concat(h," day").concat(h>1?"s":""," ago")},async navigateTo(t,e){const o=await ut.findByID(t);await K().setPatientRecord(o),this.$router.push(e)}}}),Co={class:"modal-container"},wo={class:"dueCardContent"};function $o(t,e,o,i,h,v){const c=m("ion-button"),p=m("ion-card-title"),l=m("ion-card-header"),r=m("DataTable"),g=m("ion-card-content"),D=m("ion-card");return d(),_("div",Co,[a(c,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:s(()=>e[0]||(e[0]=[T(" Close ")])),_:1,__:[0]},8,["onClick"]),a(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:s(()=>[a(l,null,{default:s(()=>[a(p,{class:"sectionTitle"},{default:s(()=>[T(f(t.title),1)]),_:1})]),_:1}),a(g,null,{default:s(()=>[n("div",wo,[a(r,{data:t.patients,columns:t.tableColumns,class:"display nowrap compact",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})])}const So=U(Do,[["render",$o],["__scopeId","data-v-447813b4"]]),ko=x({name:"OPDAppointmentsModal",components:{IonPage:It,IonHeader:tt,IonContent:et,IonItem:it,IonList:ot,IonIcon:G,IonCard:$t,IonCardContent:Rt,IonPopover:de,DataTable:At,IonSegment:Ke,IonSegmentButton:qe,IonLabel:le,IonRow:kt,IonCol:St,DateInputField:Lt},props:{title:{type:String,default:"OPD Appointments"},programType:{type:String,required:!0},programId:{type:Number,required:!0}},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:Ft,appointments:[],viewMode:"today",startDate:$.sessionDate(),endDate:$.sessionDate(),calendarOutline:lt,openOutline:oe,tableColumns:[{title:"Patient ID",data:"ID"},{title:"Name",data:"name"},{title:"Age/DOB",data:"ageDob"},{title:"Gender",data:"gender"},{title:"Village",data:"village"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(t,e,o)=>{const i=document.createElement("div"),h=document.createElement("ion-button");return h.innerText="Profile",h.size="small",h.style.color="#fff",h.style.padding="8px 12px",h.style.marginRight="8px",h.addEventListener("click",()=>this.openClientProfile(o.ID)),i.appendChild(h),i},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,dom:"Bfrtip",order:[[5,"asc"]]}}},async mounted(){await this.loadAppointments()},methods:{async loadAppointments(){var t,e;this.isLoading=!0;try{const o=$.sessionDate(),i=this.viewMode==="today"?o:this.startDate,h=this.viewMode==="today"?o:this.endDate,v=localStorage.getItem("locationID"),c=await Z("patientRecords"),p=[];for(const l of c)[...((t=l.appointments)==null?void 0:t.saved)||[],...((e=l.appointments)==null?void 0:e.unsaved)||[]].filter(D=>{if(D.concept_id!==5096||D.program_id!==14||D.location_id!==v)return!1;const b=D.value_datetime||D.obs_datetime;if(!b)return!1;const w=$.toStandardHisFormat(b),I=$.toStandardHisFormat(i),y=$.toStandardHisFormat(h);return w>=I&&w<=y}).forEach(D=>{var b,w,I,y,S;p.push({ID:l.ID,name:[(b=l.personInformation)==null?void 0:b.given_name,(w=l.personInformation)==null?void 0:w.family_name].filter(Boolean).join(" ")||"Unknown",ageDob:(I=l.personInformation)!=null&&I.birthdate?$.getBirthdateAge(l.personInformation.birthdate):"N/A",gender:((y=l.personInformation)==null?void 0:y.gender)||"Unknown",village:((S=l.personInformation)==null?void 0:S.home_village)||"Unknown",appointmentDate:$.toStandardHisDisplayFormat(D.value_datetime||D.obs_datetime),rawData:D})});this.appointments=p.sort((l,r)=>{const g=l.rawData.value_datetime||l.rawData.obs_datetime,D=r.rawData.value_datetime||r.rawData.obs_datetime;return new Date(g).getTime()-new Date(D).getTime()})}catch(o){console.error("Error loading appointments:",o),wt("Failed to load appointments")}finally{this.isLoading=!1}},async getAppointmentsD1(t){this.startDate=$.toStandardHisFormat(t),await this.loadAppointments()},async getAppointmentsD2(t){this.endDate=$.toStandardHisFormat(t),await this.loadAppointments()},onViewModeChange(){this.viewMode==="today"&&(this.startDate=$.sessionDate(),this.endDate=$.sessionDate()),this.loadAppointments()},async openClientProfile(t){try{const e=await Z("patientRecords",{whereClause:{ID:t}});await K().setPatientRecord(e[0]),this.$router.push("patientProfile")}catch(e){console.error("Error opening profile:",e),wt("Failed to open patient profile")}},openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Pt.dismiss()}}}),Io={class:"header position_content"},Ao={style:{"font-size":"1.2em","font-weight":"700"}},Po={key:0,class:"date-filter"},To={class:"dueCardContent"},No={key:1,class:"no-appointments"};function Oo(t,e,o,i,h,v){const c=m("ion-icon"),p=m("ion-header"),l=m("ion-label"),r=m("ion-segment-button"),g=m("ion-segment"),D=m("DateInputField"),b=m("ion-col"),w=m("ion-row"),I=m("DataTable"),y=m("ion-card-content"),S=m("ion-card"),E=m("ion-content"),F=m("ion-page");return d(),V(F,null,{default:s(()=>[a(p,null,{default:s(()=>[n("div",Io,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=(...j)=>t.dismiss&&t.dismiss(...j))},[a(c,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Ao,f(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=j=>t.openPopover(j))},[a(c,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(E,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:s(()=>[a(g,{modelValue:t.viewMode,"onUpdate:modelValue":e[2]||(e[2]=j=>t.viewMode=j),onIonChange:t.onViewModeChange},{default:s(()=>[a(r,{value:"today"},{default:s(()=>[a(l,null,{default:s(()=>e[3]||(e[3]=[T("Today's Appointments")])),_:1,__:[3]})]),_:1}),a(r,{value:"range"},{default:s(()=>[a(l,null,{default:s(()=>e[4]||(e[4]=[T("Date Range")])),_:1,__:[4]})]),_:1})]),_:1},8,["modelValue","onIonChange"]),t.viewMode==="range"?(d(),_("div",Po,[a(w,null,{default:s(()=>[a(b,null,{default:s(()=>[a(D,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:t.endDate,disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","maxDate","onUpdate:rawDateValue"])]),_:1}),a(b,null,{default:s(()=>[a(D,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):A("",!0),a(S,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:s(()=>[a(y,null,{default:s(()=>[n("div",To,[t.appointments.length>0?(d(),V(I,{key:0,data:t.appointments,columns:t.tableColumns,options:t.tableOptions,class:"display nowrap",width:"100%"},null,8,["data","columns","options"])):(d(),_("div",No," No appointments found for the selected "+f(t.viewMode==="today"?"day":"date range"),1))])]),_:1})]),_:1})]),_:1})]),_:1})}const Vo=U(ko,[["render",Oo],["__scopeId","data-v-aff82b51"]]),Ro={class:"card-count"},Bo={class:"card-label"},Fo="#ffffff",Lo=x({__name:"DashboardCard",props:{icon:{},count:{},label:{},color:{}},emits:["cardClick"],setup(t,{emit:e}){const h={success:"#A5D6A7",info:"#81D4FA",warning:"#FFF59D",danger:"#EF9A9A"}[t.color||"info"]||"#E0E0E0";return(v,c)=>(d(),V(W($t),{class:"dashboard-card",style:Dt({borderColor:W(h),backgroundColor:Fo}),onClick:c[0]||(c[0]=p=>v.$emit("cardClick"))},{default:s(()=>[a(W(G),{icon:v.icon,class:"card-icon"},null,8,["icon"]),n("div",Ro,f(v.count),1),n("div",Bo,f(v.label),1)]),_:1},8,["style"]))}}),Mo=U(Lo,[["__scopeId","data-v-84ad3c1b"]]),Eo=x({name:"OPDDashboard",components:{DashboardCard:Mo},data(){return{totalPatientsToday:0,todaysAppointmentsCount:0,canViewVitals:!1,canViewConsultation:!1,canViewLab:!1,canViewDispensation:!1,canViewAppointments:!1,userRoles:[]}},computed:{...Q(Ct,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{$route(t,e){this.reloadRolePermissions()}},async mounted(){const t=localStorage.getItem("locationID");if(!t)return;const e=await Z("visits")||[],i=(await Z("unsavedVisits")||[]).filter(c=>c.sync_status==="pending"),v=[...e,...i].filter(c=>String(c.location_id)===String(t));this.totalPatientsToday=v.length,await this.fetchTodaysAppointments(),await Ct().refresh(t),this.reloadRolePermissions()},methods:{medkit(){return te},flask(){return en},clipboard(){return Xt},thermometer(){return Zt},calendar(){return tn},people(){return qt},reloadRolePermissions(){this.loadUserRoles(),this.updateCardVisibility()},async fetchTodaysAppointments(){var h,v;const t=localStorage.getItem("sessionDate"),e=localStorage.getItem("locationID"),o=await Z("patientRecords")||[];let i=0;for(const c of o){const p=[...((h=c.appointments)==null?void 0:h.saved)||[],...((v=c.appointments)==null?void 0:v.unsaved)||[]];for(const l of p){const r=l.value_datetime&&$.toStandardHisFormat(l.value_datetime)===t;l.concept_id===5096&&l.program_id===14&&l.location_id===e&&r&&i++}}this.todaysAppointmentsCount=i},loadUserRoles(){try{const t=localStorage.getItem("userRoles")||"[]",e=JSON.parse(t);this.userRoles=e.map(o=>typeof o=="string"?o:o.role||o.name||"")}catch(t){this.userRoles=[]}},hasAnyRole(t){const e=this.userRoles.map(o=>o.toLowerCase());return t.some(o=>e.includes(o.toLowerCase()))},updateCardVisibility(){this.canViewVitals=this.hasAnyRole(["Clinician","Nurse","Superuser"]),this.canViewConsultation=this.hasAnyRole(["Clinician","Superuser"]),this.canViewLab=this.hasAnyRole(["Lab"]),this.canViewDispensation=this.hasAnyRole(["Clinician","Pharmacist","Superuser"]),this.canViewAppointments=this.hasAnyRole(["Clinician","Nurse","Superuser"])},openAllModal(t,e,o){ft(So,{class:"fullScreenModal"},!0,{title:t,buttonTitle:e,buttonLink:o})},openPatientsListModal(t,e,o,i){ft(bo,{class:"fullScreenModal"},!0,{title:t,list:e,buttonTitle:o,buttonLink:i})},openAppointmentsModal(t,e){ft(Vo,{class:"fullScreenModal"},!0,{title:t,programType:e,programId:14})}}}),xo={class:"dashboard-wrapper"};function Uo(t,e,o,i,h,v){const c=m("ion-icon"),p=m("ion-card-title"),l=m("ion-card-header"),r=m("DashboardCard"),g=m("ion-row"),D=m("ion-grid"),b=m("ion-card-content"),w=m("ion-card"),I=m("ion-content");return d(),V(I,{fullscreen:!0},{default:s(()=>[n("div",xo,[a(w,{class:"dashboard-card"},{default:s(()=>[a(l,{class:"dashboard-card-header"},{default:s(()=>[a(p,{class:"dashboard-title"},{default:s(()=>[a(c,{icon:t.people(),slot:"start",class:"dashboard-icon"},null,8,["icon"]),e[6]||(e[6]=T(" Today's Patients Overview "))]),_:1,__:[6]})]),_:1}),a(b,null,{default:s(()=>[a(D,{class:"centered-grid"},{default:s(()=>[a(g,{class:"centered-row"},{default:s(()=>[a(r,{icon:t.people(),color:"primary",count:t.totalPatientsToday,label:"Total patients today",onCardClick:e[0]||(e[0]=y=>t.openAllModal("All patients today","View profile","/patientProfile"))},null,8,["icon","count"]),t.canViewAppointments?(d(),V(r,{key:0,icon:t.calendar(),color:"primary",count:t.todaysAppointmentsCount,label:"Appointments",onCardClick:e[1]||(e[1]=y=>t.openAppointmentsModal("OPD Appointments","14"))},null,8,["icon","count"])):A("",!0),t.canViewVitals?(d(),V(r,{key:1,icon:t.thermometer(),color:"primary",count:t.patientsWaitingForVitals.length,label:"Waiting for vitals",onCardClick:e[2]||(e[2]=y=>t.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals"))},null,8,["icon","count"])):A("",!0),t.canViewConsultation?(d(),V(r,{key:2,icon:t.clipboard(),color:"primary",count:t.patientsWaitingForConsultation.length,label:"Waiting for consultation",onCardClick:e[3]||(e[3]=y=>t.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan"))},null,8,["icon","count"])):A("",!0),t.canViewLab?(d(),V(r,{key:3,icon:t.flask(),color:"primary",count:t.patientsWaitingForLab.length,label:"Waiting for lab",onCardClick:e[4]||(e[4]=y=>t.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan"))},null,8,["icon","count"])):A("",!0),t.canViewDispensation?(d(),V(r,{key:4,icon:t.medkit(),color:"primary",count:t.patientsWaitingForDispensation.length,label:"Waiting for dispensation",onCardClick:e[5]||(e[5]=y=>t.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations"))},null,8,["icon","count"])):A("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})}const Wo=U(Eo,[["render",Uo],["__scopeId","data-v-09af0498"]]),zo=x({name:"NCDDashboard",mixins:[ht],components:{ApexChart:he},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await ee(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return J.getJson("programs/32/reports/ncd_dashboard",{start_date:$.toStandardHisFormat($.sessionDate()),end_date:$.toStandardHisFormat($.sessionDate())})}}}),Ho={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},Jo={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},Go={ref:"chartRef1"},jo={ref:"chartRef2"};function Qo(t,e,o,i,h,v){const c=m("ion-card-content"),p=m("ion-card"),l=m("ApexChart");return d(),_(M,null,[n("div",Ho,[a(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(c,null,{default:s(()=>e[0]||(e[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])),_:1,__:[0]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(c,null,{default:s(()=>e[1]||(e[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])),_:1,__:[1]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(c,null,{default:s(()=>e[2]||(e[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])),_:1,__:[2]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(c,null,{default:s(()=>e[3]||(e[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])),_:1,__:[3]})]),_:1})]),n("div",Jo,[a(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(c,null,{default:s(()=>[e[4]||(e[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",Go,[t.isChartReady?(d(),V(l,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):A("",!0)],512)]),_:1,__:[4]})]),_:1}),a(p,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(c,null,{default:s(()=>[e[5]||(e[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",jo,[t.isChartReady?(d(),V(l,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):A("",!0)],512)]),_:1,__:[5]})]),_:1})])],64)}const Yo=U(zo,[["render",Qo],["__scopeId","data-v-58e2a3d8"]]),Xo=x({name:"Home",mixins:[ce,ht],components:{IonContent:et,IonHeader:tt,IonPage:It,IonToolbar:st,Toolbar:pe,IonRow:kt,DateInputField:Lt,IonIcon:G,IonButton:se,IonCol:St},data(){const t=R($.sessionDate()),e=R($.sessionDate()),o=R($.sessionDate()),i=R([]);return{segmentContent:"Today",minDate:o,startDate:t,endDate:e,people:i,calendarOutline:lt,eyeOutline:nn}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(t){this.segmentContent=t},formatBirthdate(t){return $.getBirthdateAge(t)},async getAppointments(){this.people=[],(await ge.getAppointments(this.startDate,this.endDate,"")).forEach(e=>{const o={person_id:e.person_id,npid:e.npid,appointment_id:103,encounter_id:e.encounter_id,name:e.given_name.concat(" ",e.family_name),gender:e.gender,ageDob:this.formatBirthdate(e.birthdate),village:e.city_village,appointmentDate:$.toStandardHisDisplayFormat(e.appointment_date)};this.people.push(o)})},async getAppointmentsD1(t){this.startDate=$.toStandardHisFormat(t),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=$.toStandardHisFormat(t),await this.getAppointments()},async openClientProfile(t){await ut.findByNpid(t),this.isPharmacist()},isPharmacist(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(o=>e.some(i=>i.role==="Pharmacist"))&&(this.$router.push("dispensation"),J.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),Zo={class:"appointments-container"},qo={key:0,class:"date-filter"},Ko={class:"appointments-table"};function ti(t,e,o,i,h,v){const c=m("ion-label"),p=m("ion-segment-button"),l=m("ion-segment"),r=m("DateInputField"),g=m("ion-col"),D=m("ion-row"),b=m("ion-icon"),w=m("ion-button"),I=m("ion-card");return d(),_("div",Zo,[n("div",null,[a(l,{value:t.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:s(()=>[a(p,{value:"Today",onClick:e[0]||(e[0]=y=>t.setSegmentContent("Today"))},{default:s(()=>[a(c,null,{default:s(()=>e[3]||(e[3]=[T("Today")])),_:1,__:[3]})]),_:1}),a(p,{value:"Tomorrow",onClick:e[1]||(e[1]=y=>t.setSegmentContent("Tomorrow"))},{default:s(()=>[a(c,null,{default:s(()=>e[4]||(e[4]=[T("Tomorrow")])),_:1,__:[4]})]),_:1}),a(p,{value:"Date range",onClick:e[2]||(e[2]=y=>t.setSegmentContent("Date range"))},{default:s(()=>[a(c,null,{default:s(()=>e[5]||(e[5]=[T("Date range")])),_:1,__:[5]})]),_:1})]),_:1},8,["value"])]),t.segmentContent==="Date range"?(d(),_("div",qo,[a(D,null,{default:s(()=>[a(g,null,{default:s(()=>[a(r,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(g,null,{default:s(()=>[a(r,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):A("",!0),t.people.length>0?(d(),V(I,{key:1},{default:s(()=>[n("table",Ko,[e[6]||(e[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(d(!0),_(M,null,z(t.people,y=>(d(),_("tr",{key:y.npid},[n("td",null,[a(D,null,{default:s(()=>[a(g,null,{default:s(()=>[T(f(y.name),1)]),_:2},1024),a(g,null,{default:s(()=>[a(w,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:S=>t.openClientProfile(y.npid),color:"primary",fill:"clear",size:"small"},{default:s(()=>[a(b,{icon:t.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,f(y.npid),1),n("td",null,f(y.ageDob),1),n("td",null,f(y.gender),1),n("td",null,f(y.village),1),n("td",null,f(y.appointmentDate),1)]))),128))])])]),_:1})):(d(),V(I,{key:2},{default:s(()=>e[7]||(e[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])),_:1,__:[7]}))])}const ei=U(Xo,[["render",ti],["__scopeId","data-v-c47f7768"]]),ni=x({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){}}}),ai={key:0},si={style:{display:"flex","margin-top":"10px"}},oi={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},ii={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},ri={key:1};function li(t,e,o,i,h,v){const c=m("ion-label"),p=m("ion-segment-button"),l=m("ion-segment"),r=m("VisitsHistory");return d(),_(M,null,[n("div",null,[a(l,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:s(()=>[a(p,{value:"Internal referrals",onClick:e[0]||(e[0]=g=>t.setSegmentContent("Internal referrals"))},{default:s(()=>[a(c,null,{default:s(()=>e[2]||(e[2]=[T("Internal referrals")])),_:1,__:[2]})]),_:1}),a(p,{value:"External referrals",onClick:e[1]||(e[1]=g=>t.setSegmentContent("External referrals"))},{default:s(()=>[a(c,null,{default:s(()=>e[3]||(e[3]=[T("External referrals")])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(d(),_("div",ai,[n("div",si,[t.checkUnderFive?(d(),_("div",oi)):A("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?A("",!0):(d(),_("div",ii))])])):A("",!0),t.segmentContent=="External referrals"?(d(),_("div",ri,[a(r)])):A("",!0)],64)}const di=U(ni,[["render",li],["__scopeId","data-v-faad8f8b"]]),ci=x({name:"Menu",components:{IonContent:et,IonHeader:tt,IonItem:it,IonList:ot,IonMenu:ct,IonTitle:dt,IonToolbar:st,IonCheckbox:Tt,IonIcon:G,BasicForm:mt,BasicCard:Nt,Referrals:di,Dashboard:Yo,ANCAppointments:ei},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:ie},{id:"referrals",label:"Referrals",icon:re},{id:"appointments",label:"Appointments",icon:lt}],activeItem:"dashboard"}},computed:{...Q(pt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),ui={style:{display:"flex"}},pi={class:"left_col"},mi={class:"nav-menu"},hi=["onClick"],gi={class:"right_col"};function fi(t,e,o,i,h,v){const c=m("ion-icon"),p=m("Dashboard"),l=m("ANCAppointments"),r=m("Referrals");return d(),_("div",ui,[n("div",pi,[n("nav",mi,[n("ul",null,[(d(!0),_(M,null,z(t.menuItems,g=>(d(),_("li",{key:g.id,class:q({active:t.activeItem===g.id}),onClick:D=>t.setActiveItem(g.id)},[a(c,{icon:g.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,f(g.label),1)],10,hi))),128))])])]),n("div",gi,[n("div",null,[t.activeItem==="dashboard"?(d(),V(p,{key:0})):A("",!0),t.activeItem==="appointments"?(d(),V(l,{key:1})):A("",!0),t.activeItem==="referrals"?(d(),V(r,{key:2})):A("",!0)])])])}const _i=U(ci,[["render",fi],["__scopeId","data-v-7e786ea4"]]),vi=x({name:"Menu",components:{IonContent:et,IonHeader:tt,IonItem:it,IonList:ot,IonMenu:ct,IonTitle:dt,IonToolbar:st,IonCheckbox:Tt,BasicForm:mt,BasicCard:Nt},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Q(pt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),yi={class:"left_col"},bi={class:"nav-menu"},Di=["onClick"];function Ci(t,e,o,i,h,v){return d(),_("div",null,[n("div",yi,[n("nav",bi,[n("ul",null,[(d(!0),_(M,null,z(t.menuItems,c=>(d(),_("li",{key:c.id,class:q({active:t.activeItem===c.id}),onClick:p=>t.setActiveItem(c.id)},f(c.label),11,Di))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const wi=U(vi,[["render",Ci],["__scopeId","data-v-32dd02d3"]]),$i=x({name:"Menu",components:{IonContent:et,IonHeader:tt,IonItem:it,IonList:ot,IonMenu:ct,IonTitle:dt,IonToolbar:st,IonCheckbox:Tt,BasicForm:mt,BasicCard:Nt},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Q(pt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Si={class:"left_col"},ki={class:"nav-menu"},Ii=["onClick"];function Ai(t,e,o,i,h,v){return d(),_("div",null,[n("div",Si,[n("nav",ki,[n("ul",null,[(d(!0),_(M,null,z(t.menuItems,c=>(d(),_("li",{key:c.id,class:q({active:t.activeItem===c.id}),onClick:p=>t.setActiveItem(c.id)},f(c.label),11,Ii))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const Pi=U($i,[["render",Ai],["__scopeId","data-v-b49d8600"]]);function Ti(){const t=Bt(),e=Ot(),o=R(!1),{OPDActivities:i,NCDActivities:h}=bt(e),v=async p=>{var l;try{const r=J.getUserID(),g=await me.getJson("user_properties",{user_id:r,property:p});return g!=null&&g.property_value?(l=g==null?void 0:g.property_value)==null?void 0:l.split(","):[]}catch(r){return console.error("Error fetching user activities:",r),[]}},c=async()=>{try{o.value=!1;const[p,l]=await Promise.all([v("OPD_activities"),v("NCD_activities")]);p.length>0&&e.setOPDActivity(p),l.length>0&&e.setNCDActivity(l)}catch(p){console.error("Error updating activities:",p)}finally{o.value=!0}};return at(()=>t.path,async()=>{await c()},{immediate:!0,deep:!0}),{ready:o,OPDActivities:i,NCDActivities:h,getUserActivities:v,updateActivities:c}}function Ni(){const t=Bt(),e=R(""),o=R(!1),i=R({}),h=()=>{const v=J.getUserRoles(),c=J.getProgramID(),p=J.getProgramName();e.value=v,o.value=!1,v==="Lab"&&c===14?i.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:c===14&&v!=="Lab"?i.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:c===12?i.value={url:"contact",btnName:"Back"}:p==="LABOUR AND DELIVERY PROGRAM"?i.value={url:"labour/labourHome",btnName:"Back to home"}:p==="PNC PROGRAM"?i.value={url:"pnc/home",btnName:"Back to home"}:i.value={url:"",btnName:""},o.value=!0};return at(()=>t.path,()=>{h()},{immediate:!0,deep:!0}),{userRole:e,ready:o,userRoleSettings:i,updateUserRoleSettings:h}}const Oi={key:0,class:"spinner-overlay"},Ki=x({__name:"HomePage",setup(t){const e=R(!0),o=Bt(),i=pn(),h=R(localStorage.getItem("sessionDate")||"");Ni();const v=mn(),{apiStatus:c}=bt(ue()),{activeProgram:p}=bt(v),l=vt(()=>{switch(p.value.program_id){case nt.IMMUNIZATION_PROGRAM:return go;case nt.OPD_PROGRAM:return Wo;case nt.NCD_PROGRAM:return ds;case nt.ANC_PROGRAM:return _i;case nt.PNC_PROGRAM:return Pi;case nt.LABOUR_AND_DELIVERY_PROGRAM:return wi;case nt.HIV_PROGRAM:return Ts;default:return null}}),r=()=>{const b=localStorage.getItem("sessionDate");(!b||b.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),Ht()),h.value=b||""};let g=null;yt(()=>{g=()=>r(),window.addEventListener("storage",g);const b=setInterval(r,1e3);an(()=>{clearInterval(b),g&&window.removeEventListener("storage",g)}),r()}),at(h,(b,w)=>{(!b||b.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),Ht())}),at(()=>o.name,async b=>{b==="Home"&&(Wt(),await zt().loadGlobalProperty(),i.initWorker(),i.postData("SYNC_ALL_DATA"))},{immediate:!0,deep:!0});const D=async()=>{try{const b=J.getUserID(),w=await me.getUserByID(b);if(w.location_id!=null){const I=await gn.getLocation(w.location_id);localStorage.setItem("locationData",JSON.stringify(I))}}catch(b){console.error("Failed to retrieve location data:",b)}};return c.value&&(Ti(),D()),yt(async()=>{try{e.value=!0,i.terminate(),Wt(),await zt().loadGlobalProperty(),_t.isEmpty(p.value)&&await hn.show(wn,{},"module-picker-modal")}catch(b){console.error("Error initializing component:",b)}finally{e.value=!1}}),(b,w)=>{const I=m("ion-spinner"),y=m("ion-content");return d(),V(W(It),null,{default:s(()=>[e.value?(d(),_("div",Oi,[a(I,{name:"bubbles"}),w[0]||(w[0]=n("div",{class:"loading-text"},"Please wait...",-1))])):A("",!0),a(pe),a($n),l.value?(d(),V(sn(l.value),{key:1})):(d(),V(y,{key:2},{default:s(()=>w[1]||(w[1]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])),_:1,__:[1]}))]),_:1})}}});export{Ki as default};

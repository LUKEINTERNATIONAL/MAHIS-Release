import{d as S,a0 as V,a8 as k,M as W,aZ as q,E as O,G as M,I as B,be as E,a7 as J,H as l,N as z,f as p,J as c,l as r,P as _,K as N,k as v,e as m,af as b,b4 as I,ag as G,ab as K,a1 as U,cG as Y,Q as j,_ as Q,$ as Z,m as w,F as X,O as x}from"./vendor-f_p5GZUu.js";import{J as $,_ as F,H as f,O as g,l as y,V as ee,ac as te,w as L,aI as C,N as ae,bm as ne,S as se,bf as ie,be as oe,aB as re,u as le}from"./index-BrtFwA6C.js";import{P as de,u as T,L as ce}from"./lab_order-C-M8cvzU.js";import{D as ue}from"./DashBox-D7g1wfnd.js";import{a as pe}from"./userService-DkGQ0LoP.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-Db13O_GS.js";const me=S({name:"CheckInConfirmationModal",components:{IonModal:E,IonHeader:B,IonToolbar:M,IonTitle:O,IonButtons:q,IonButton:W,IonContent:k,IonIcon:V,DynamicButton:$},props:{isOpen:{type:Boolean,required:!0},closeModalFunc:{type:Function,required:!0},onYes:{type:Function,required:!0},onNo:{type:Function,required:!0},title:{type:String,required:!0}},computed:{isCheckInPrompt(){return this.title==="Do you want to create visit or view profile?"},closeCircleOutline(){return J}},methods:{closeModal(){this.closeModalFunc()}}}),he={class:"modal-body"},be={key:0,class:"button-group"},fe={key:1,class:"button-group"};function ge(e,a,s,n,t,o){const i=l("ion-title"),u=l("ion-icon"),d=l("ion-button"),h=l("ion-buttons"),R=l("ion-toolbar"),H=l("ion-header"),D=l("DynamicButton"),P=l("ion-content"),A=l("ion-modal");return p(),z(A,{"is-open":e.isOpen,"show-backdrop":!0,onDidDismiss:e.closeModal},{default:c(()=>[r(H,{class:"modal-header"},{default:c(()=>[r(R,null,{default:c(()=>[r(i,{class:"modal-title"},{default:c(()=>[_(N(e.title),1)]),_:1}),r(h,{slot:"end"},{default:c(()=>[r(d,{onClick:e.closeModal},{default:c(()=>[r(u,{slot:"icon-only",icon:e.closeCircleOutline,class:"close-icon"},null,8,["icon"])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),r(P,{class:"modal-content"},{default:c(()=>[v("div",he,[e.isCheckInPrompt?(p(),m("div",be,[r(d,{class:"action-btn",fill:"solid",color:"danger",onClick:e.onYes},{default:c(()=>a[0]||(a[0]=[_("Create Visit",-1)])),_:1,__:[0]},8,["onClick"]),r(D,{class:"action-btn",name:"View Profile",fill:"solid",color:"secondary",onClick:e.onNo},null,8,["onClick"])])):(p(),m("div",fe,[r(d,{class:"action-btn",fill:"solid",color:"danger",onClick:e.onNo},{default:c(()=>a[1]||(a[1]=[_("No",-1)])),_:1,__:[1]},8,["onClick"]),r(D,{class:"action-btn",name:"Yes",fill:"solid",color:"primary",onClick:e.onYes},null,8,["onClick"])]))])]),_:1})]),_:1},8,["is-open","onDidDismiss"])}const ve=F(me,[["render",ge],["__scopeId","data-v-dc61f78a"]]),_e=S({name:"Menu",components:{CheckInConfirmationModal:ve,IonContent:k,IonHeader:B,IonItem:U,IonList:K,IonMenu:G,IonTitle:O,IonToolbar:M,DynamicButton:$,DashBox:ue,DataTable:I},computed:{...b(le,["patient"]),...b(T,["labResults"]),...b(re,["investigations"]),...b(L,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"]),hasEnterResults(){return this.listOrders.some(e=>e.btn&&e.btn.includes("enter_results"))}},props:{propOrders:{default:[]}},data(){return{loading:!1,tableData:[],options:{responsive:!0,select:!1,layout:{topStart:"",topEnd:"search",bottomStart:"info",bottomEnd:"paging"},ordering:!1,order:[[3,"desc"]]},header:["Lab Test","Specimen","Accession Number","Order Date","Result"],iconsContent:y,valueNumericArray:[],obsDatetime:[],graphIcon:oe(["#006401"]),listIcon:ie(["#636363"]),displayGraph:!0,sendToLabModalOpen:!1,orders:[],userRoles:[],height:[],BMI:[],iconBg:{},activeWeight:[],activeHeight:[],activeBMI:[],listOrders:[],listResults:[],hasPatientsWaitingForLab:!1,labResultsContent:"",listHeaderOrders:"",service:"",openModal:!1,openResultsModal:!1,series:[{name:"",data:[]}]}},setup(){return{checkmark:Z,pulseOutline:Q}},async mounted(){this.loading=!0,await this.updateInvestigationWizard(),await this.setListData(),this.loading=!1,this.$nextTick(()=>{const e=this.$refs.dataTable.dt;e.columns.adjust().draw(),e.on("click",".result-btn",a=>{const s=a.target.getAttribute("data-id");this.openResultsForm(JSON.parse(s))}),e.on("click",".view-btn",a=>{const s=a.target.getAttribute("data-id");this.viewLabOrder(JSON.parse(s))}),e.on("click",".delete-btn",a=>{const s=a.target.getAttribute("data-id");this.voidLabOrder(JSON.parse(s),a)}),e.on("click",".order-btn",a=>{const s=a.target.getAttribute("data-id");this.saveTest(JSON.parse(s))})}),this.orders=this.propOrders,this.service=new ne(this.patient.patientID),this.userRoles=await se.getUserRoles()},watch:{$route:{async handler(){await this.setListData()},deep:!0},patient:{async handler(e){e&&e.patientID&&await this.setListData()},immediate:!0},tableData:{handler(e){if(this.$refs.dataTable){const a=this.$refs.dataTable.dt;a.clear(),a.rows.add(e),a.draw()}},deep:!0}},methods:{async closeModal(){this.openModal=!1,await this.setListData()},async saveTest(e){await new ce().postActivities(this.patient.patientID,[{concept_id:await C.getConceptID(e.name,!0),name:e.name,specimen:e.specimen,reason:"Routine",specimenConcept:await C.getConceptID(e.specimen,!0)}]),ae("Successfully saved"),this.orders=await g.getOrders(this.patient.patientID),this.tableData=this.generateListItems(this.orders,"order"),this.tableData.sort((n,t)=>{const o=new Date(n[3]);return new Date(t[3]).getTime()-o.getTime()});const s=this.$refs.dataTable.dt;s.clear(),s.rows.add(this.tableData),s.draw()},toggleSendToLabModal(){this.sendToLabModalOpen=!this.sendToLabModalOpen},async fetchPatientLabStageData(){const e=await pe(),a=e?e.code:null;if(a){const s=await te.getPatientList("LAB",a);await L().refresh(a),this.patient.patientID&&(this.hasPatientsWaitingForLab=s.some(n=>n.patient_id===this.patient.patientID))}},async updateInvestigationWizard(){this.orders=await g.getOrders(this.patient.patientID);const e=await this.orders.filter(a=>f.toStandardHisFormat(f.sessionDate())===f.toStandardHisFormat(a.order_date));e.length>0?this.investigations[0].selectedData=e:this.investigations[0].selectedData=""},dismiss(){j.dismiss()},async voidLabOrder(e,a){await ee("Do you want to delete ".concat(e.tests[0].name," ?"),a)&&await this.service.voidOrder(e.id,"Mistake entry"),await this.setListData()},async openResultsForm(e){const a=await de.getTestIndicatorsWithID(e.concept_id);console.log({testIndicators:a});const s=[e,{validationStatus:"",data:{rowData:[{colData:[]}]}}];a.forEach(t=>{let o={inputHeader:t.name,value:"",colSize:3,id:t.concept_id,name:t.name,required:!0,eventType:"input",alertsErrorMassage:""};if(t.name=="RBS"&&(o={inputHeader:t.name,value:"",colSize:3,id:t.concept_id,name:t.name,required:!0,eventType:"input",alertsErrorMassage:"",validationFunctionName:"validateRBS",unit:"mg/dL"}),t.name=="FBS"&&(o={inputHeader:t.name,value:"",colSize:3,id:t.concept_id,name:t.name,required:!0,eventType:"input",alertsErrorMassage:"",validationFunctionName:"validateFBS",unit:"mg/dL"}),t.name=="MRDT"||t.name=="Tuberculosis program"||t.name=="Vdrl"||t.name=="Hepatitis B"||t.name=="Lam"||t.name=="CrAg"||t.name=="CD4 count"||t.name=="Leukocytes"||t.name=="Protein"||t.name=="Nitrite"||t.name=="Urine Ketones"||t.name=="HIV test"){let i=[];(t.name=="MRDT"||t.name=="Vdrl"||t.name=="Hepatitis B"||t.name=="CrAg"||t.name=="Lam")&&(i=[{id:"1",name:"Positive"},{id:"2",name:"Negative"},{id:"3",name:"Invalid"}]),t.name=="Tuberculosis program"&&(i=[{id:"1",name:"Scanty"},{id:"2",name:"Negative"},{id:"3",name:"1+"},{id:"4",name:"2+"},{id:"5",name:"3+"}]),t.name=="CD4 count"&&(i=[{id:"1",name:"below reference line"},{id:"2",name:"above reference line"}]),(t.name=="Leukocytes"||t.name=="Protein"||t.name=="Nitrite"||t.name=="Ketones"||t.name=="Urine Ketones")&&(i=[{id:"2",name:"Negative"},{id:"1",name:"Trace"},{id:"3",name:"1+"},{id:"4",name:"2+"},{id:"5",name:"3+"},{id:"6",name:"4+"}]),t.name=="HIV test"&&(i=[{id:"2",name:"Positive"},{id:"1",name:"Negative"},{id:"3",name:"Invalid"}]),o={inputHeader:t.name,icon:y.search,value:"",name:"units",eventType:"input",alertsErrorMassage:"",isSingleSelect:!0,trackBy:"id",multiSelectData:i,id:t.concept_id,idName:"district_id"}}s[1].data.rowData[0].colData.push(o)}),T().setLabResults(s),this.openModal=!0,this.orders=await g.getOrders(this.patient.patientID)},async viewLabOrder(e){this.labResultsContent=e,this.openResultsModal=!0},async setListData(){this.loading=!0,this.orders=await g.getOrders(this.patient.patientID);let e=this.generateListItems(this.orders,"order");e.sort((o,i)=>{const u=new Date(o[3]);return new Date(i[3]).getTime()-u.getTime()});const a=[],s=a.filter(o=>!e.some(i=>i[0]===o[0])),n=e.filter(o=>a.some(i=>i[0]===o[0])),t=e.filter(o=>!n.some(i=>i[0]===o[0]));this.tableData=[...n,...s,...t],await this.updateInvestigationWizard(),this.loading=!1,I.use(Y)},generateListItems(e,a){return e.length>0?e.flatMap(s=>s.tests.flatMap(n=>{var i,u,d,h;const t='<button class="btn btn-outline-secondary btn-sm view-btn" data-id=\''.concat(JSON.stringify(n),"'>").concat(this.iconsContent.view2,"</button> ");let o="";return((i=n==null?void 0:n.result)==null?void 0:i.length)==1?o=(n==null?void 0:n.result)!=null?((u=n==null?void 0:n.result[0])==null?void 0:u.value_modifier)+((d=n==null?void 0:n.result[0])==null?void 0:d.value):null:((h=n==null?void 0:n.result)==null?void 0:h.length)>1&&(n==null||n.result,o=t),[[n.name,s.specimen.name,s.accession_number,f.toStandardHisFormat(s.order_date),o]]})):[]}}}),De={class:"container"},Ie={key:0,class:"loading-container"},we={key:1,class:"table-responsive"};function ye(e,a,s,n,t,o){const i=l("ion-spinner"),u=l("DataTable");return p(),m("div",De,[e.loading?(p(),m("div",Ie,[r(i,{name:"crescent"}),a[0]||(a[0]=v("p",null,"Loading lab results...",-1))])):w("",!0),e.loading?w("",!0):(p(),m("div",we,[r(u,{ref:"dataTable",options:e.options,data:e.tableData,class:"display nowrap",width:"100%"},{default:c(()=>[v("thead",null,[v("tr",null,[(p(!0),m(X,null,x(e.header,d=>(p(),m("th",{key:d,"data-orderable":!0},N(d),1))),128))])])]),_:1},8,["options","data"])]))])}const Be=F(_e,[["render",ye],["__scopeId","data-v-3a0db2ef"]]);export{Be as default};

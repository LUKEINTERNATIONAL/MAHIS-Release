System.register(["./vendor-legacy-IknIjA4f.js","./index-legacy-DNaJqFx-.js","./ProviderFormOption-legacy-CSF2kUUA.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-BAwsNGQr.js"],function(e,l){"use strict";var n,a,t,o,u,i,r,c,s,d,v,f,p,y,m,g,k,h,_,x,w,b,I,D,P,T,C,S,j,N,$,z,E,A,B,M,R,W,F,L,U,V,Y,G,J,O,Z,q,H,K,Q;return{setters:[e=>{n=e.d,a=e.cj,t=e.b2,o=e.au,u=e.r,i=e.w,r=e.y,c=e.f,s=e.z,d=e.l,v=e.u,f=e.es,p=e.k,y=e.as,m=e.a9,g=e.e,k=e.ac,h=e.F,_=e.L,x=e.G,w=e.I,b=e.et,I=e.eu,D=e.eo,P=e.B,T=e.bN,C=e.V,S=e.U,j=e.W,N=e.A,$=e.dP,z=e.bM,E=e.b0,A=e.aZ,B=e.m,M=e.e4,R=e.cT,W=e.dv,F=e.cz,L=e.ev,U=e.af},e=>{V=e.S,Y=e.u,G=e.T,J=e.m,O=e.a$,Z=e.ac,q=e._},e=>{H=e.P,K=e.i,Q=e.a},null,null],execute:function(){var l=document.createElement("style");l.textContent="#main[data-v-b525e13c]{height:calc(100vh - 69px);overflow-y:auto}.placeholder-content[data-v-b525e13c]{padding:20px}\n/*$vite$:1*/",document.head.appendChild(l);class X extends V{constructor(){super()}static nextTask(e){return super.getJson(`/workflows/${super.getProgramID()}/${e}`,{date:super.getSessionDate()})}static async getNextTaskParams(e,l=""){let n=l;try{if(!n){const{name:l}=await X.nextTask(e);n=l}}catch(a){n=""}return{name:n.toLowerCase(),params:{patient_id:e}}}}const ee={key:1,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},le={class:"ion-page",id:"main"},ne={key:0,class:"placeholder-content"},ae={style:{margin:"0px auto"},class:"ion-text-center"},te={key:1},oe={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}},ue={style:{color:"black"}};e("default",q(n({__name:"ARTVisit",setup(e){const l=a(),n=Y(),{patient:q}=t(n),ie=o(),re=u(-1),ce=u(null),se=u([]),de=u([]),ve=u(!1),fe=u(-1),pe=u(""),ye=u(""),me=u(""),ge=u(!1),ke=u(null);function he(e){var l;return!!e&&(!ve.value&&fe.value===(null==e?void 0:e.encounterTypeID)||(null!==(l=null==e?void 0:e.otherWorkflowNames)&&void 0!==l?l:[]).includes(pe.value))}function _e(){if(0===se.value.length||re.value===se.value.length-1)return!1;const e=se.value[re.value];return e&&he(e)}async function xe(){var e;ge.value=null!==(e=V.isBDE())&&void 0!==e&&e,me.value="",ve.value=!0,ye.value="",pe.value="";try{var l;const e=await X.nextTask(q.value.patientID);if(!e)return ye.value="No workflows found. You may exit this page or refresh",ve.value=!1,void(re.value=-1);pe.value=e.name,fe.value=null!==(l=null==e?void 0:e.encounter_type_id)&&void 0!==l?l:-1;const n=se.value.findIndex(e=>{var l;return(null==e?void 0:e.encounterTypeID)===fe.value||(null!==(l=e.otherWorkflowNames)&&void 0!==l?l:[]).includes(pe.value)});if(-1!==n){me.value=e.description;const l=[...se.value.slice(n),...se.value.slice(0,n)];se.value=l,re.value=0}else ye.value=pe.value?`"${pe.value}" is not available in the current workflow. Contact your administrator or update ART activity selection`:"No next task found",re.value=n}catch(n){ye.value="An error has occured while loading next task: "+n,console.error(n)}finally{await async function(){const e=await O.getEncounters(q.value.patientID,{date:X.getSessionDate()});de.value=e.map(e=>e.encounter_type)}(),ve.value=!1}}function we(){(function(){if(ge.value){if(!ke.value)return void J("BDE Provider component is not available");if(!ke.value.isProviderSelected())return J("Please select a provider"),void ke.value.openModal()}return ce.value&&"function"==typeof ce.value.onSubmit?ce.value.onSubmit():Promise.resolve(!0)})().then(e=>e&&xe())}return i(()=>l.fullPath,()=>{(async function(){re.value=-1,se.value=[];try{const e=Z.map(async e=>{if(("function"!=typeof e.disabled||!e.disabled(Z))&&e.workflowID&&e.component&&await K(e.workflowID)&&await Q(e.workflowID))return e});se.value=(await Promise.all(e)).filter(e=>void 0!==e)}catch(e){J("Unable to load activities"),console.error(e)}})().then(xe)},{immediate:!0,deep:!0}),(e,l)=>(c(),r(v(U),null,{default:s(()=>[d(G),d(v(f),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:s(()=>{var e;return[d(v(y),{contentId:"main"},{default:s(()=>[d(v(m),null,{default:s(()=>[se.value.length>0?(c(),r(v(k),{key:0},{default:s(()=>[(c(!0),g(h,null,_(se.value,(e,l)=>(c(),r(v(x),{onClick:e=>function(e){if(e<0||e>=se.value.length)return;const l=se.value[e];l&&he(l)&&(re.value=e)}(l),lines:"none",key:l,disabled:!he(e),button:""},{default:s(()=>{return[(l=e,de.value.includes(null!==(n=null==l?void 0:l.encounterTypeID)&&void 0!==n?n:0)?(c(),r(v(w),{key:0,icon:v(b),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):he(e)?(c(),r(v(w),{key:2,icon:v(D),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(c(),r(v(w),{key:1,icon:v(I),style:{padding:"10px"},slot:"start"},null,8,["icon"]))),p("b",null,P(e.name),1)];var l,n}),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(c(),g("div",ee,[d(v(w),{style:{"font-size":"2rem"},icon:v(T)},null,8,["icon"]),l[2]||(l[2]=p("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),d(v(C),null,{default:s(()=>[d(v(S),{color:"light"},{default:s(()=>[d(v(j),{onClick:l[0]||(l[0]=e=>v(ie).back())},{default:s(()=>[d(v(w),{icon:v($),slot:"start"},null,8,["icon"]),l[3]||(l[3]=N(" Back to dashboard "))]),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),p("div",le,[ve.value?(c(),g("div",ne,[p("div",ae,[d(v(z),{name:"bubbles"}),l[4]||(l[4]=p("p",null,[p("h1",null,"Please wait...")],-1))])])):null!==(e=se.value[re.value])&&void 0!==e&&e.component?(c(),g("div",te,[d(v(E),null,{default:s(()=>[d(v(A),null,{default:s(()=>{var e;return[ge.value?(c(),r(H,{key:0,ref_key:"bdeProviderComponent",ref:ke},null,512)):B("",!0),(c(),r(M,null,[(c(),r(R(null===(e=se.value[re.value])||void 0===e?void 0:e.component),{ref_key:"formRef",ref:ce},null,512))],1024))]}),_:1})]),_:1})])):(c(),g("div",oe,[d(v(w),{style:{color:"green","font-size":"80px"},icon:v(W)},null,8,["icon"]),p("h2",ue,P(ye.value),1),d(v(j),{size:"large",fill:"clear",onClick:l[1]||(l[1]=e=>v(ie).back())},{default:s(()=>[d(v(w),{slot:"start",icon:v(F)},null,8,["icon"]),l[5]||(l[5]=N(" Exit page "))]),_:1,__:[5]})])),d(v(C),null,{default:s(()=>[d(v(S),{color:"light"},{default:s(()=>[_e()?(c(),r(v(j),{key:0,onClick:we,color:"primary",style:{padding:"4px"},slot:"end"},{default:s(()=>[l[6]||(l[6]=N(" Save and continue ")),d(v(w),{style:{padding:"4px"},icon:v(L),slot:"end"},null,8,["icon"])]),_:1,__:[6]})):B("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),[["__scopeId","data-v-b525e13c"]]))}}});

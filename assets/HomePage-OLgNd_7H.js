var ye=Object.defineProperty;var be=(t,e,o)=>e in t?ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var X=(t,e,o)=>be(t,typeof e!="symbol"?e+"":e,o);import{d as U,cC as De,ar as Qt,r as V,c as yt,w as st,a as bt,e as _,f as l,k as n,m as k,p as K,B as f,l as a,u as J,ab as Yt,A as P,I as j,F,L as W,cD as Ce,c1 as we,ay as qt,bA as $e,bn as Se,bV as Zt,b_ as ke,E as u,z as s,R as Ie,ao as Y,cE as Xt,cF as Kt,cG as te,cH as ee,bd as Ae,cI as ne,cJ as Pe,cK as Te,cL as Ne,cM as Oe,cN as Ve,cO as Re,cP as Be,aa as Le,bJ as Me,aq as Fe,n as ae,y as T,aZ as Lt,a_ as se,a$ as oe,b0 as St,aj as kt,W as ie,ai as It,U as ot,an as At,S as et,ah as nt,by as Ee,af as xe,cQ as Ue,aH as We,cR as He,cS as ze,a5 as Je,aG as Ge,cT as re,aP as ct,b2 as Dt,a7 as Ct,cU as le,aL as de,cy as Pt,D as ce,bo as je,T as ut,ap as pt,ak as it,G as rt,X as Tt,a9 as Qe,cV as Ye,cW as qe,cX as Ze,cY as Xe,bw as Nt,a8 as ue,cZ as Ke,c_ as tn,c$ as en,d0 as nn,d1 as an,cn as Mt,co as sn,bR as on}from"./vendor-DEsiqeFy.js";import{S as E,u as tt,_ as H,H as $,A as rn,a as ln,b as pe,c as Vt,P as mt,d as me,e as dn,f as ht,E as Ut,g as cn,B as un,t as Wt,h as Ht,i as Ft,j as _t,k as pn,l as wt,m as $t,n as Rt,o as mn,T as he,U as ge,p as hn,q as gn,r as at,s as zt,v as Jt,w as fn,x as Gt,L as _n}from"./index-Bf09rQ_Z.js";import{m as fe}from"./apexcharts-C3RKrXvH.js";import{A as _e}from"./ncd_appointment_service-vo11oT6o.js";import{D as Et}from"./DateInputField-CQYBpO8h.js";import{u as vn,M as yn,_ as bn}from"./ActionButtons.vue_vue_type_script_setup_true_lang-Dk-5lp9X.js";import{V as Dn}from"./ViewToggleComponent-DRdGWodH.js";import{b as Cn}from"./bottomNavBar-CNrTwmQE.js";import{C as wn}from"./chartjs-B3HVL0jJ.js";import{B as gt}from"./BasicForm-Cf2ieGGO.js";import{B as Ot}from"./BasicCard-CriPHY_Z.js";import{u as $n}from"./AdministerOtherVaccinesStore-CcnZ6W_V.js";import{_ as Sn}from"./customDatePicker.vue_vue_type_style_index_0_lang-Dqk5LXtU.js";import{s as kn}from"./vaccines_service-C0CsvusB.js";import{l as vt}from"./lodash-Dt8AsbQm.js";import{g as In}from"./dashboard_service-BN97qGcN.js";import{i as An}from"./Img-CJEgX1Vr.js";import"./sms_service-C8QktRih.js";import"./EIRreportsStore-CwUcHRkW.js";import"./Export-BxE0rJDm.js";class jt extends E{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(e){return await super.getJson("fhir/patient/".concat(e),{id:e})}static async getFhirObservations(e){return await super.getJson("fhir/patient/".concat(e,"/observations/"),{id:e})}}const Pn={class:"fhir-viewer"},Tn={class:"container"},Nn={key:0,class:"main-header"},On={class:"header-line"},Vn={key:0,class:"last-updated-display"},Rn={key:1,class:"card initial-input-card"},Bn={class:"action-area-initial"},Ln={key:0,class:"card patient-card"},Mn={class:"card-title"},Fn={class:"patient-info-grid"},En={class:"info-item"},xn={class:"info-value"},Un={class:"info-item"},Wn={class:"info-value"},Hn={class:"info-item"},zn={class:"info-value"},Jn={class:"info-item"},Gn={class:"info-value"},jn={class:"info-value"},Qn={class:"info-value"},Yn={class:"info-label"},qn={class:"info-value"},Zn={key:2,class:"card observations-card"},Xn={class:"card-title"},Kn={class:"observations-grid"},ta={class:"obs-header"},ea={class:"obs-title"},na={class:"obs-details"},aa={class:"obs-detail obs-value-highlight"},sa={class:"obs-value"},oa={class:"obs-detail"},ia={class:"obs-value"},ra={key:0,class:"obs-detail"},la={class:"obs-value"},da={key:3,class:"no-data-found"},ca={key:4,class:"no-data-found"},ua={key:5,class:"main-footer"},pa=U({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(t){De({"person-circle-outline":ke,"clipboard-outline":Zt,"search-outline":Se,"information-circle-outline":$e,"alert-circle-outline":qt,"person-add-outline":we,"arrow-back-outline":Ce});const e=t,o=Qt(),i=V(!1),p=V([]),y=V(),h=V(),r=V(null),m=V([]),d=yt(()=>p.value.some(C=>C.resourceType==="Bundle"&&C.entry&&C.entry.some(c=>c.resource&&c.resource.resourceType==="Patient"))),g=yt(()=>m.value.length>0),D=async()=>{if(p.value=[],h.value=null,r.value=null,m.value=[],!y.value){console.error("Please enter a Patient Identifier.");return}i.value=!0;try{const C=await jt.getFhirPatient(y.value);if(C&&C.entry&&C.entry.length>0){const c=C.entry[0].resource,M=c.id,L=await jt.getFhirObservations(M);p.value=[C],L&&(p.value.push(L),m.value=L.entry.filter(G=>G.resource&&G.resource.resourceType==="Observation").map(G=>{const A=G.resource;return{id:A.id,display:z(A),value:lt(A),date:A.effectiveDateTime,category:A.category&&A.category[0]&&A.category[0].coding&&A.category[0].coding[0]?A.category[0].coding[0].display||A.category[0].coding[0].code:"N/A"}}));const N=c.name&&c.name[0];r.value={personInformation:{given_name:N&&N.given?N.given.join(" "):"",middle_name:N&&N.middle?N.middle.join(" "):"",family_name:N&&N.family?N.family:"",gender:c.gender=="male"?"M":(c==null?void 0:c.gender)=="female"?"F":"",birthdate:c.birthDate||"",cell_phone_number:c.telecom&&c.telecom[0]?c.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:c.contact&&c.contact[0]&&c.contact[0].telecom?c.contact[0].telecom[0].value:""}]}};const S=[C,L].filter(Boolean).reduce((G,A)=>{if(A.meta&&A.meta.lastUpdated){const Z=new Date(A.meta.lastUpdated);return G===null||Z>G?Z:G}return G},null);S&&(h.value=x(S.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch(C){console.error("Error loading FHIR data:",C),p.value=[],h.value=null,r.value=null,m.value=[]}finally{i.value=!1}},b=C=>{if(C.name&&C.name[0]){const c=C.name[0],M=c.given?c.given.join(" "):"",L=c.family||"";return"".concat(M," ").concat(L).trim()||"N/A"}return"N/A"},w=C=>C.identifier&&C.identifier.length>0?C.identifier.map(c=>{let M="Unknown System";if(c.type&&c.type.coding&&c.type.coding[0]&&c.type.coding[0].display)M=c.type.coding[0].display;else if(c.system){const N=c.system.split("/");M=N[N.length-1]||c.system,c.system==="urn:oid:2.16.840.1.113883.4.6"&&(M="Social Security Number")}sessionStorage.setItem(M,c.value);let L=null;return c.assigner&&c.assigner.display?L=c.assigner.display:c.assigner&&c.assigner.reference&&(L=c.assigner.reference.split("/").pop()||c.assigner.reference),{value:c.value||"N/A",systemDisplay:M,periodStart:c.period?c.period.start:null,periodEnd:c.period?c.period.end:null,assignerDisplay:L}}):[],I=C=>C.telecom&&C.telecom.length>0?C.telecom.filter(c=>c.system==="phone"&&c.value):[],v=C=>{if(C.contact&&C.contact.length>0){const c=C.contact.filter(L=>{var N;return(N=L.relationship)==null?void 0:N.some(O=>{var S;return(S=O.coding)==null?void 0:S.some(G=>G.code==="GUARD")})}),M=[];return c.forEach(L=>{L.telecom&&L.telecom.length>0&&L.telecom.filter(N=>N.system==="phone"&&N.value).forEach(N=>M.push(N))}),M}return[]},R=C=>{if(!C)return"N/A";try{return new Date(C).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(c){return console.error("Invalid date string for formatDate:",C,c),"Invalid Date"}},x=C=>{if(!C)return"N/A";try{return new Date(C).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(c){return console.error("Invalid date time string for formatDateTime:",C,c),"Invalid Date/Time"}},B=C=>{if(!C)return"N/A";try{const c=new Date,M=new Date(C);let L=c.getFullYear()-M.getFullYear();const N=c.getMonth()-M.getMonth();return(N<0||N===0&&c.getDate()<M.getDate())&&L--,L}catch(c){return console.error("Invalid birth date string for calculateAge:",C,c),"N/A"}},Q=C=>{if(C.meta&&C.meta.tag){const c=C.meta.tag.find(M=>M.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return c?c.code:"Unknown"}return"Unknown"},z=C=>C.code&&C.code.coding&&C.code.coding[0]&&(C.code.coding[0].display||C.code.coding[0].code)||"Unknown Observation",lt=C=>C.valueQuantity?"".concat(C.valueQuantity.value," ").concat(C.valueQuantity.unit||"").trim():C.valueString?C.valueString:C.valueBoolean!==void 0?C.valueBoolean?"True":"False":"N/A",q=()=>{tt().setRecord(r.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(m.value)),ve("/registration/manual")},xt=()=>{p.value=[],y.value="",h.value=null,r.value=null,m.value=[]},ve=C=>{o.push({path:C})};return st(()=>o,async()=>{p.value=[],m.value=[]},{deep:!0}),bt(()=>{var C;if(e.initialData.length>0){p.value=e.initialData;const M=e.initialData.filter(Boolean).reduce((O,S)=>{if(S.meta&&S.meta.lastUpdated){const G=new Date(S.meta.lastUpdated);return O===null||G>O?G:O}return O},null);M&&(h.value=x(M.toISOString()));const L=e.initialData.find(O=>O.resourceType==="Bundle"&&O.entry&&O.entry.some(S=>S.resource&&S.resource.resourceType==="Patient"));if(L){const O=(C=L.entry.find(S=>S.resource&&S.resource.resourceType==="Patient"))==null?void 0:C.resource;if(O){const S=O.name&&O.name[0];r.value={personInformation:{given_name:S&&S.given?S.given.join(" "):"",middle_name:S&&S.middle?S.middle.join(" "):"",family_name:S&&S.family?S.family:"",gender:O.gender||"",birthdate:O.birthDate||""}}}}const N=e.initialData.find(O=>O.resourceType==="Bundle"&&O.entry&&O.entry.some(S=>S.resource&&S.resource.resourceType==="Observation"));N&&(m.value=N.entry.filter(O=>O.resource&&O.resource.resourceType==="Observation").map(O=>{const S=O.resource;return{id:S.id,display:z(S),value:lt(S),date:S.effectiveDateTime,category:S.category&&S.category[0]&&S.category[0].coding&&S.category[0].coding[0]?S.category[0].coding[0].display||S.category[0].coding[0].code:"N/A"}}))}}),(C,c)=>{var M,L,N,O,S,G;return l(),_("div",Pn,[n("div",Tn,[(M=p.value)!=null&&M.length?(l(),_("header",Nn,[n("div",On,[c[1]||(c[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:K(["last-updated-display","status-"+Q(p.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+f(Q(p.value[0].entry[0].resource)),3),h.value?(l(),_("span",Vn,"Last Updated: "+f(h.value),1)):k("",!0)])])])):k("",!0),(L=p.value)!=null&&L.length?k("",!0):(l(),_("section",Rn,[a(J(Yt),{modelValue:y.value,"onUpdate:modelValue":c[0]||(c[0]=A=>y.value=A),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",Bn,[n("button",{onClick:D,class:"load-data-btn"},[a(J(j),{name:"search-outline"}),c[2]||(c[2]=P(" Find Patient ",-1))])])])),(l(!0),_(F,null,W(p.value,A=>(l(),_("div",{key:A.id},[A.resourceType==="Bundle"&&A.entry&&A.entry[0]&&A.entry[0].resource.resourceType==="Patient"?(l(),_("section",Ln,[n("h2",Mn,[a(J(j),{name:"person-circle-outline"}),c[3]||(c[3]=P(" Patient Demographics",-1))]),n("div",Fn,[n("div",En,[c[4]||(c[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",xn,f(b(A.entry[0].resource)),1)]),n("div",Un,[c[5]||(c[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",Wn,f(A.entry[0].resource.gender||"Not specified"),1)]),n("div",Hn,[c[6]||(c[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",zn,f(R(A.entry[0].resource.birthDate)),1)]),n("div",Jn,[c[7]||(c[7]=n("span",{class:"info-label"},"Age",-1)),n("span",Gn,f(B(A.entry[0].resource.birthDate))+" years",1)]),I(A.entry[0].resource).length?(l(!0),_(F,{key:0},W(I(A.entry[0].resource),(Z,dt)=>(l(),_("div",{key:"patient-phone-".concat(dt),class:"info-item"},[c[8]||(c[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",jn,f(Z.value),1)]))),128)):k("",!0),v(A.entry[0].resource).length?(l(!0),_(F,{key:1},W(v(A.entry[0].resource),(Z,dt)=>(l(),_("div",{key:"guardian-phone-".concat(dt),class:"info-item"},[c[9]||(c[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",Qn,f(Z.value),1)]))),128)):k("",!0),(l(!0),_(F,null,W(w(A.entry[0].resource),(Z,dt)=>(l(),_("div",{key:Z.value||dt,class:"info-item"},[n("span",Yn,f(Z.systemDisplay),1),n("span",qn,f(Z.value),1)]))),128))])])):k("",!0)]))),128)),((N=m.value)==null?void 0:N.length)>0?(l(),_("section",Zn,[n("h2",Xn,[a(J(j),{name:"clipboard-outline"}),c[10]||(c[10]=P(" Clinical Observations",-1))]),n("div",Kn,[(l(!0),_(F,null,W(m.value,A=>(l(),_("div",{key:A.id,class:"observation-item"},[n("div",ta,[n("h3",ea,f(A.display),1)]),n("div",na,[n("div",aa,[c[11]||(c[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",sa,f(A.value),1)]),n("div",oa,[c[12]||(c[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",ia,f(x(A.date)),1)]),A.category&&A.category!=="N/A"?(l(),_("div",ra,[c[13]||(c[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",la,f(A.category),1)])):k("",!0)])]))),128))])])):k("",!0),(O=p.value)!=null&&O.length&&!d.value?(l(),_("div",da,[n("p",null,[a(J(j),{name:"alert-circle-outline"}),c[14]||(c[14]=P(" No patient data found for the provided identifier. Please try again.",-1))])])):(S=p.value)!=null&&S.length&&d.value&&!g.value?(l(),_("div",ca,[n("p",null,[a(J(j),{name:"information-circle-outline"}),c[15]||(c[15]=P(" No clinical observations found for this patient.",-1))])])):k("",!0),(G=p.value)!=null&&G.length?(l(),_("footer",ua,[n("button",{onClick:xt,class:"back-to-search-btn small-btn"},[a(J(j),{name:"arrow-back-outline"}),c[16]||(c[16]=P(" Back to Search ",-1))]),n("button",{onClick:q,class:"register-btn small-btn"},[a(J(j),{name:"person-add-outline"}),c[17]||(c[17]=P(" Register New Patient ",-1))])])):k("",!0)])])}}}),ma=H(pa,[["__scopeId","data-v-0dc329ef"]]),ha=U({name:"referrals",components:{ExternalReferrals:ma},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){this.segmentContent=t}}}),ga={key:0},fa={style:{display:"flex","margin-top":"10px"}},_a={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},va={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},ya={key:1};function ba(t,e,o,i,p,y){const h=u("ion-label"),r=u("ion-segment-button"),m=u("ion-segment"),d=u("ExternalReferrals");return l(),_(F,null,[n("div",null,[a(m,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:s(()=>[a(r,{value:"External referrals",onClick:e[0]||(e[0]=g=>t.setSegmentContent("External referrals"))},{default:s(()=>[a(h,null,{default:s(()=>e[2]||(e[2]=[P("External referrals",-1)])),_:1,__:[2]})]),_:1}),a(r,{value:"Internal referrals",onClick:e[1]||(e[1]=g=>t.setSegmentContent("Internal referrals"))},{default:s(()=>[a(h,null,{default:s(()=>e[3]||(e[3]=[P("Internal referrals",-1)])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(l(),_("div",ga,[n("div",fa,[t.checkUnderFive?(l(),_("div",_a)):k("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?k("",!0):(l(),_("div",va))])])):k("",!0),t.segmentContent=="External referrals"?(l(),_("div",ya,[a(d)])):k("",!0)],64)}const Da=H(ha,[["render",ba],["__scopeId","data-v-e09d6a6b"]]),Bt=Ie("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(t){this.selectedItem=t},getSelectedItem(){return this.selectedItem}},persist:!0}),Ca=()=>{const t=V(null);return{activeIteminMixin:t,setActiveItem:o=>{t.value=o,console.log("lll: ",t.value)}}},ft=U({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:t,setActiveItem:e}=Ca();return{chevronBackOutline:Me,checkmark:Le,grid:Be,chevronDownCircle:Re,chevronForwardCircle:Ve,chevronUpCircle:Oe,colorPalette:Ne,document:Te,globe:Pe,medkit:ne,add:Ae,person:ee,people:te,thermometer:Kt,clipboard:Xt,activeIteminMixin:t,setActiveItem:e}},async mounted(){await this.setAppointments()},computed:{...Y(tt,["patient"])},watch:{$route:{async handler(t){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await rn.getDailiyAppointments($.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((t,e)=>t.given_name.localeCompare(e.given_name)))},formatBirthdate(t){return $.getBirthdateAge(t)},setActiveItemRefFN(t){Bt().setSelectedItem(t)}}}),wa=U({name:"NCDDashboard",mixins:[ft],components:{ApexChart:fe},setup(){return{router:Qt()}},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await ae(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){try{return E.getJson("programs/32/reports/ncd_dashboard",{start_date:$.toStandardHisFormat($.sessionDate()),end_date:$.toStandardHisFormat($.sessionDate())})}catch(t){return[]}},navigationMenu(t){try{Fe.close(),this.router.push(t).then(()=>{})}catch(e){console.error(e)}}}}),$a={class:"cards-container"},Sa={class:"top-card-text"},ka={class:"text-2xl font-bold"},Ia={class:"top-card-text"},Aa={class:"text-2xl font-bold"},Pa={class:"top-card-text"},Ta={class:"text-2xl font-bold"},Na={class:"top-card-text"},Oa={class:"text-2xl font-bold"},Va={class:"top-card-text"},Ra={class:"text-2xl font-bold"},Ba={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},La={ref:"chartRef1"},Ma={ref:"chartRef2"};function Fa(t,e,o,i,p,y){const h=u("ion-card-content"),r=u("ion-card"),m=u("ApexChart");return l(),_(F,null,[n("div",$a,[a(r,{class:"top-card action-card",onClick:e[0]||(e[0]=d=>t.setActiveItemRefFN("appointments"))},{default:s(()=>[a(h,null,{default:s(()=>[n("div",Sa,[n("div",ka,f(t.appointments.length),1),e[2]||(e[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]),_:1})]),_:1}),a(r,{class:"top-card action-card"},{default:s(()=>[a(h,null,{default:s(()=>{var d;return[n("div",Ia,[n("div",Aa,f((d=t.dashboardData)==null?void 0:d.total_pending_dispensations),1),e[3]||(e[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]}),_:1})]),_:1}),a(r,{class:"top-card action-card"},{default:s(()=>[a(h,null,{default:s(()=>{var d;return[n("div",Pa,[n("div",Ta,f((d=t.dashboardData)==null?void 0:d.total_defaulters),1),e[4]||(e[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]}),_:1})]),_:1}),a(r,{class:"top-card action-card"},{default:s(()=>[a(h,null,{default:s(()=>{var d;return[n("div",Na,[n("div",Oa,f((d=t.dashboardData)==null?void 0:d.total_complications),1),e[5]||(e[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]}),_:1})]),_:1}),a(r,{class:"top-card action-card",onClick:e[1]||(e[1]=d=>t.navigationMenu("NCDActivePatients"))},{default:s(()=>[a(h,null,{default:s(()=>{var d;return[n("div",Va,[n("div",Ra,f((d=t.dashboardData)==null?void 0:d.total_client_registered),1),e[6]||(e[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]}),_:1})]),_:1})]),n("div",Ba,[a(r,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(h,null,{default:s(()=>[e[7]||(e[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",La,[t.isChartReady?(l(),T(m,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1,__:[7]})]),_:1}),a(r,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(h,null,{default:s(()=>[e[8]||(e[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",Ma,[t.isChartReady?(l(),T(m,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1,__:[8]})]),_:1})])],64)}const Ea=H(wa,[["render",Fa],["__scopeId","data-v-18251377"]]),xa=U({name:"Home",mixins:[pe,ft],components:{IonContent:nt,IonHeader:et,IonPage:At,IonToolbar:ot,IonRow:It,DateInputField:Et,IonIcon:j,IonButton:ie,IonCol:kt,IonCard:St,IonCardHeader:oe,IonCardTitle:se,IonCardContent:Lt,ViewToggleComponent:Dn,bottomNavBar:Cn,HorizontalLine:ln},data(){const t=localStorage.getItem("ncdStartDate"),e=localStorage.getItem("ncdEndDate"),o=V(t||$.sessionDate()),i=V(e||$.sessionDate()),p=V($.sessionDate()),y=V($.sessionDate()),h=V([]),r=Ee({page:1,itemsPerPage:10}),m=V(0),d=vn(),g=V("list");return{minDate:p,startDate:o,endDate:i,people:h,calendarOutline:ct,openOutline:re,maxDate:y,alertCircleOutline:qt,personOutline:Ge,idCardOutline:Je,manOutline:ze,womanOutline:He,locationOutline:We,timeOutline:Ue,todayOutline:xe,pagination:r,totalCount:m,actionButtonStore:d,currentToggleView:g}},computed:{...Y(Vt,["NCDAppointmentsTogglePreference"]),paginatedPeople(){const t=(this.pagination.page-1)*this.pagination.itemsPerPage,e=t+this.pagination.itemsPerPage;return this.people.slice(t,e)},groupedPaginatedPeople(){const t={};this.paginatedPeople.forEach(i=>{const p=i.appointmentDate;t[p]||(t[p]=[]),t[p].push(i)});const e=Object.keys(t).sort((i,p)=>new Date(i)-new Date(p)),o={};return e.forEach(i=>{o[i]=t[i]}),o}},$route:{async handler(){},deep:!0},watch:{NCDAppointmentsTogglePreference:{handler(t){t&&t.toggle_view&&(this.currentToggleView=t.toggle_view)},deep:!0,immediate:!0}},async mounted(){this.initTogglePreference(),this.getAppointments(),this.HideHomePageActionButton()},async unmounted(){this.actionButtonStore.resetShowActionButton()},methods:{formatBirthdate(t){return $.getBirthdateAge(t)},async getAppointments(t=!1){if(me().apiStatus){this.people=[],this.pagination.page=1;try{t==!0&&(this.startDate=$.sessionDate(),this.endDate=$.sessionDate(),this.getAppointmentsD1(this.startDate),this.getAppointmentsD2(this.endDate)),this.startDate>this.endDate&&(this.endDate=this.startDate),console.log(this.startDate,this.endDate),(await _e.getAppointments(this.startDate,this.endDate,"")).forEach(i=>{const p=$.toStandardHisDisplayFormat(i.appointment_date);if(!this.people.some(h=>h.person_id===i.person_id&&h.appointmentDate===p)){const h={person_id:i.person_id,npid:i.npid,appointment_id:103,encounter_id:i.encounter_id,name:i.given_name.concat(" ",i.family_name),gender:i.gender,ageDob:this.formatBirthdate(i.birthdate),village:i.city_village,appointmentDate:p};this.people.push(h)}}),this.totalCount=this.people.length}catch(o){}}},async getAppointmentsD1(t){this.startDate=$.toStandardHisFormat(t),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=$.toStandardHisFormat(t),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(t){const e=await mt.findByNpid(t);tt().setPatientRecord(e[0]),this.redirectUser()},handleViewChange(t){this.currentToggleView=t,this.initTogglePreference(t,!0)},initTogglePreference(t="list",e=!1){const o={toggle_view:t},i=Vt();Object.keys(this.NCDAppointmentsTogglePreference).length===0?(o.toggle_view="list",i.setNCDAppointmentsTogglePreference(o),this.currentToggleView="list"):e===!0?i.setNCDAppointmentsTogglePreference(o):this.currentToggleView=this.NCDAppointmentsTogglePreference.toggle_view||"list"},redirectUser(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(o=>e.some(i=>i.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")},handlePaginationUpdate({page:t,itemsPerPage:e}){if(e!==this.pagination.itemsPerPage){const o=(this.pagination.page-1)*this.pagination.itemsPerPage,i=Math.floor(o/e)+1,p=Math.ceil(this.totalCount/e);this.pagination.page=Math.min(i,p)||1,this.pagination.itemsPerPage=e}else this.pagination.page=t},HideHomePageActionButton(){this.actionButtonStore.setShowActionButton(!1)}}}),Ua={class:"appointments-container"},Wa={class:"date-filter"},Ha={key:0,style:{margin:"20px"}},za={key:1},Ja={class:"appointments-table"},Ga={key:2},ja={class:"date-group-header"},Qa={class:"date-header-title"},Ya={class:"date-header-count"},qa={class:"cards-container"},Za={class:"card-details"},Xa={class:"detail-item"},Ka={class:"detail-value"},ts={class:"detail-item"},es={class:"detail-value"},ns={class:"detail-item"},as={class:"detail-value"},ss={class:"detail-item"},os={class:"detail-value"};function is(t,e,o,i,p,y){const h=u("DateInputField"),r=u("ion-col"),m=u("ion-icon"),d=u("ion-button"),g=u("ViewToggleComponent"),D=u("ion-row"),b=u("ion-card"),w=u("HorizontalLine"),I=u("ion-card-title"),v=u("ion-card-header"),R=u("ion-card-content"),x=u("ion-content"),B=u("bottomNavBar"),Q=u("ion-footer");return l(),_("div",Ua,[n("div",Wa,[a(D,null,{default:s(()=>[a(r,null,{default:s(()=>[a(h,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(r,null,{default:s(()=>[a(h,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1}),a(r,null,{default:s(()=>[a(d,{color:"primary",onClick:e[0]||(e[0]=z=>t.getAppointments(!0)),class:"apt-btn"},{default:s(()=>[a(m,{icon:t.todayOutline,slot:"start"},null,8,["icon"]),e[1]||(e[1]=n("span",{style:{margin:"5px"}}," Today ",-1))]),_:1,__:[1]})]),_:1}),a(r,null,{default:s(()=>[a(g,{"initial-view":t.currentToggleView,onViewChanged:t.handleViewChange},null,8,["initial-view","onViewChanged"])]),_:1})]),_:1})]),a(x,{class:"scrollable-content"},{default:s(()=>[t.people.length===0?(l(),_("div",Ha,[a(m,{icon:t.alertCircleOutline,size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),e[2]||(e[2]=n("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Appointments for selected date range",-1))])):t.currentToggleView==="list"&&t.people.length>0?(l(),_("div",za,[a(b,null,{default:s(()=>[n("table",Ja,[e[3]||(e[3]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(l(!0),_(F,null,W(t.paginatedPeople,z=>(l(),_("tr",{key:z.npid},[n("td",null,[a(D,null,{default:s(()=>[a(r,null,{default:s(()=>[P(f(z.name),1)]),_:2},1024),a(r,null,{default:s(()=>[a(d,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:lt=>t.openClientProfile(z.npid),color:"primary",fill:"clear",size:"small"},{default:s(()=>[a(m,{icon:t.openOutline,style:{"font-size":"28px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,f(z.npid),1),n("td",null,f(z.ageDob),1),n("td",null,f(z.gender),1),n("td",null,f(z.village),1),n("td",null,f(z.appointmentDate),1)]))),128))])])]),_:1})])):t.currentToggleView==="card"&&t.people.length>0?(l(),_("div",Ga,[(l(!0),_(F,null,W(t.groupedPaginatedPeople,(z,lt)=>(l(),_("div",{key:lt,class:"date-group"},[n("div",ja,[a(m,{icon:t.calendarOutline,class:"date-header-icon"},null,8,["icon"]),n("h2",Qa,f(lt),1),n("div",Ya,f(z.length)+" appointment"+f(z.length!==1?"s":""),1)]),a(w,{color:"#006401",thickness:1,spacing:"sm"}),n("div",qa,[(l(!0),_(F,null,W(z,q=>(l(),T(b,{key:q.npid,class:"appointment-card"},{default:s(()=>[a(v,null,{default:s(()=>[a(D,{class:"ion-align-items-center"},{default:s(()=>[a(r,null,{default:s(()=>[a(I,{class:"card-name"},{default:s(()=>[a(m,{icon:t.personOutline,class:"name-icon"},null,8,["icon"]),P(" "+f(q.name),1)]),_:2},1024)]),_:2},1024),a(r,{size:"auto"},{default:s(()=>[a(d,{onClick:xt=>t.openClientProfile(q.npid),color:"primary",fill:"clear",size:"small",class:"view-profile-btn"},{default:s(()=>[a(m,{icon:t.openOutline},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(R,null,{default:s(()=>[n("div",Za,[n("div",Xa,[a(m,{icon:t.idCardOutline,class:"detail-icon"},null,8,["icon"]),e[4]||(e[4]=n("span",{class:"detail-label"},"NPID:",-1)),n("span",Ka,f(q.npid),1)]),n("div",ts,[a(m,{icon:t.calendarOutline,class:"detail-icon"},null,8,["icon"]),e[5]||(e[5]=n("span",{class:"detail-label"},"Age/DOB:",-1)),n("span",es,f(q.ageDob),1)]),n("div",ns,[a(m,{icon:q.gender==="Male"?t.manOutline:t.womanOutline,class:"detail-icon"},null,8,["icon"]),e[6]||(e[6]=n("span",{class:"detail-label"},"Gender:",-1)),n("span",as,f(q.gender),1)]),n("div",ss,[a(m,{icon:t.locationOutline,class:"detail-icon"},null,8,["icon"]),e[7]||(e[7]=n("span",{class:"detail-label"},"Village:",-1)),n("span",os,f(q.village),1)])])]),_:2},1024)]),_:2},1024))),128))])]))),128))])):k("",!0)]),_:1}),t.people.length>0?(l(),T(Q,{key:0,class:"sticky-footer"},{default:s(()=>[a(D,null,{default:s(()=>[a(r,{size:"12",style:{"max-width":"100%"}},{default:s(()=>[a(B,{totalItems:t.totalCount,currentPage:t.pagination.page,itemsPerPage:t.pagination.itemsPerPage,"onUpdate:pagination":t.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])]),_:1})]),_:1})]),_:1})):k("",!0)])}const rs=H(xa,[["render",is],["__scopeId","data-v-cbdb9bb6"]]),ls={key:0,class:"left_col"},ds={class:"nav-menu"},cs=["onClick"],us={class:"ellipsis"},ps={key:1,style:{"padding-left":"20px","padding-right":"20px"}},ms=U({__name:"NCDDashboard",setup(t){const e=Bt(),o=yt(()=>e.selectedItem),{screenWidth:i}=dn(),p=V([{id:"dashboard",label:"Dashboard",icon:le},{id:"referrals",label:"Referrals",icon:de},{id:"appointments",label:"Appointments",icon:ct}]),y=V("dashboard"),h=ht(),{substance:r}=Dt(h);st(()=>r.value,(d,g)=>{d!==g&&console.log("Substance changed:",d)},{deep:!0,immediate:!0});const m=d=>{y.value=d,Bt().setSelectedItem(y.value)};return st(()=>o.value,d=>{console.log("Active item from mixin changed:",d),d&&d!=null&&m(d)},{immediate:!0}),(d,g)=>{const D=u("ion-segment-button"),b=u("ion-segment");return l(),_("div",{style:Ct(J(i)>940?"display: flex":"display: block")},[J(i)>940?(l(),_("div",ls,[n("nav",ds,[n("ul",null,[(l(!0),_(F,null,W(p.value,w=>(l(),_("li",{key:w.id,class:K({active:y.value===w.id}),onClick:I=>m(w.id)},[a(J(j),{icon:w.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",us,f(w.label),1)],10,cs))),128))])])])):k("",!0),J(i)<=940?(l(),_("div",ps,[a(b,{value:y.value,style:{"margin-top":"5px","justify-content":"left"}},{default:s(()=>[(l(!0),_(F,null,W(p.value,w=>(l(),T(D,{value:w.id,key:w.id,class:K({active:y.value===w.id}),onClick:I=>m(w.id)},{default:s(()=>[a(J(j),{icon:w.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,f(w.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):k("",!0),n("div",{class:"right_col",style:Ct(J(i)>940?"width: 85%":"width: 100%")},[n("div",null,[y.value==="referrals"?(l(),T(Da,{key:0})):k("",!0),y.value==="dashboard"?(l(),T(Ea,{key:1})):k("",!0),y.value==="appointments"?(l(),T(rs,{key:2})):k("",!0)])],4)],4)}}}),hs=H(ms,[["__scopeId","data-v-a1132315"]]),gs=""+new URL("icon/checklist.svg",import.meta.url).href,fs=""+new URL("icon/dashboard.svg",import.meta.url).href,_s={name:"Dashboard",setup(){bt(async()=>{o.value=await r(),await m();const g=await d(),{labels:D,totalVisits:b,incompleteVisits:w}=t(g);e(D,b,w)});function t(g){if(!g)return{labels:[],totalVisits:[],incompleteVisits:[]};const D=[],b=[],w=[];return Object.entries(g).forEach(([I,v])=>{const x=new Date(I).toLocaleDateString("en-US",{weekday:"long"});D.push(x),b.push(v.complete),w.push(v.incomplete)}),{labels:D,totalVisits:b,incompleteVisits:w}}function e(g,D,b){const w=document.getElementById("myChart");new wn(w,{type:"bar",data:{labels:g,datasets:[{label:"Total visits",data:D,backgroundColor:"#5aa3b1"},{label:"Incomplete visits",data:b,backgroundColor:"#dba6a2"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}const o=V([]),i=V({}),p=g=>{const D=Object.entries(Ut).find(([b,w])=>w===g);return D?D[0]:"Unknown (".concat(g,")")},y=g=>Object.keys(g).map(D=>{var R,x;const b=Number(D),w=p(b),I=((R=g[b])==null?void 0:R.F)||0,v=((x=g[b])==null?void 0:x.M)||0;return{encounter:h(w),female:I,male:v,me:I+v,facility:I+v}}),h=g=>g.toLowerCase().replace(/_/g," ").replace(/\b\w/g,D=>D.toUpperCase()),r=async()=>{try{const g=Object.values(Ut).filter(v=>typeof v=="number"),[D,b]=await Promise.all([E.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:g}),E.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:[9,51,6,52,53,68,25,54,7],all:!0})]),w=y(b),I=y(D);return w.map(v=>{const R=I.find(x=>x.encounter===v.encounter);return{...v,me:R?R.female+R.male:0}})}catch(g){return console.error("Error fetching dashboard stats:",g),[]}},m=async()=>{try{const D=new Date().toISOString().split("T")[0],b=await E.getJson("programs/1/dashboard",{date:D});i.value=b}catch(g){console.error("Error fetching visits stats:",g)}},d=async()=>{try{const g=new Date,D=new Date;D.setDate(g.getDate()-5);const b=w=>w.toISOString().split("T")[0];return await E.getJson("programs/1/reports/visits",{name:"visits",end_date:b(g),start_date:b(D)})}catch(g){console.error("Error fetching visits stats:",g)}};return{checkListIcon:gs,dashboardIcon:fs,rows:o,dashboardScoreStats:i}}},vs={class:"dashboard-container"},ys={class:"summary-cards"},bs={class:"card"},Ds={class:"card"},Cs={class:"card"},ws={class:"card"},$s={class:"main-section"},Ss={class:"encounters-section"},ks={class:"his-sm-text"},Is={key:0},As={class:"encounter-td"},Ps={class:"other-td"},Ts={class:"other-td"},Ns={class:"other-td"},Os={class:"other-td"},Vs={key:1};function Rs(t,e,o,i,p,y){var h,r,m,d,g,D,b,w;return l(),_("div",vs,[n("div",ys,[n("div",bs,[n("h2",null,f(((r=(h=i.dashboardScoreStats)==null?void 0:h.total_patients_today)!=null?r:[]).length||0),1),e[0]||(e[0]=n("p",null,"Total patients today",-1))]),n("div",Ds,[n("h2",null,f(((d=(m=i.dashboardScoreStats)==null?void 0:m.waiting_for_vitals)!=null?d:[]).length||0),1),e[1]||(e[1]=n("p",null,"Waiting for vitals",-1))]),n("div",Cs,[n("h2",null,f(((D=(g=i.dashboardScoreStats)==null?void 0:g.waiting_for_consultation)!=null?D:[]).length||0),1),e[2]||(e[2]=n("p",null,"Waiting for consultation",-1))]),n("div",ws,[n("h2",null,f(((w=(b=i.dashboardScoreStats)==null?void 0:b.waiting_for_dispensation)!=null?w:[]).length||0),1),e[3]||(e[3]=n("p",null,"Waiting for dispensation",-1))])]),n("div",$s,[e[7]||(e[7]=n("div",{class:"chart-section"},[n("h3",null,"Total visits/incomplete visits: last 5 days"),n("canvas",{id:"myChart"})],-1)),n("div",Ss,[e[6]||(e[6]=n("h3",null,"Encounters created today",-1)),n("table",ks,[e[5]||(e[5]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),i.rows.length?(l(),_("tbody",Is,[(l(!0),_(F,null,W(i.rows,(I,v)=>(l(),_("tr",{key:v},[n("td",As,f(I.encounter),1),n("td",Ps,f(I.female),1),n("td",Ts,f(I.male),1),n("td",Ns,f(I.me),1),n("td",Os,f(I.facility),1)]))),128))])):(l(),_("tbody",Vs,e[4]||(e[4]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])))])])])])}const Bs=H(_s,[["render",Rs]]);class Ls{constructor(){X(this,"socket",null);X(this,"channel","ImmunizationReportChannel");X(this,"isConnected",!1);X(this,"pendingFetch",null);X(this,"location_id");X(this,"initPromise");X(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});X(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});X(this,"onError",e=>{console.error("WebSocket error:",e),this.isConnected=!1});this.initPromise=this.init()}async init(){const e=localStorage.getItem("apiURL"),o=localStorage.getItem("apiPort"),i=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const p="".concat(i,"://").concat(e,"/api/v1/cable");this.socket=new WebSocket(p),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(p){console.error(p),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const e={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(e))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await E.getJson("immunization/stats",{start_date:$.getDateBeforeByDays($.sessionDate(),365),end_date:$.sessionDate()})}async setMessageHandler(e){await this.initPromise,this.socket?this.socket.onmessage=o=>{e(o)}:console.error("WebSocket connection not established.")}}const Ms=U({components:{IonContent:nt,IonHeader:et,IonItem:rt,IonList:it,IonMenu:pt,IonTitle:ut,IonToolbar:ot,IonInput:Yt,BasicInputField:un,BasicForm:gt,PreviousVitals:cn,customDatePicker:Sn,IonCol:kt,IonRow:It,VueMultiselect:je,IonLabel:ce,DataTable:Pt},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:Ft,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:$.toStandardHisDisplayFormat(E.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...Y($n,["administerOtherVaccine"]),...Y(Ht,["tempScannedBatchNumber"]),...Y(tt,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await In(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:ee,pulseOutline:Qe,clipboardOutline:Zt}},methods:{formatBirthdate(t){return $.getBirthdateAge(t)},async openClientProfile(t){const e=await mt.findByID(t);await tt().setPatientRecord(e),this.$router.push("patientProfile")},processData(){var e;return((e=this.data)==null?void 0:e.map(o=>{if(o.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let i=[];const p=y=>y.map(r=>{let m=0;return r.clients.map(d=>{(r.drug_name==this.drug_name&&(this.village==d.table.city_village||this.village=="All")||(r.drug_name==this.drug_name||this.village==d.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:d.table.given_name,family_name:d.table.family_name,patient_id:d.table.patient_id,birthdate:d.table.birthdate,city_village:d.table.city_village}),m++),this.villageList.push(d.table.city_village)}),[r.drug_name,m]}).filter(r=>r[1]!==0);return this.title=="Client due today"&&(i=p(o.value.due_today_antigens)),this.title=="Client due this week"&&(i=p(o.value.due_this_week_antigens)),this.title=="Client due this month"&&(i=p(o.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(i=p(o.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(i=p(o.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(y=>JSON.stringify(y)))].map(y=>JSON.parse(y)),this.villageList=[...new Set(this.villageList)],i}}))[0]},handleVillageClick(t){this.drug_name="",this.village=t,this.tableData=this.processData()},handleRowClick(t){var o;this.tableEvent=t.target;const e=this.tableEvent.closest("tr");if(e){const i=Array.from(((o=e.parentNode)==null?void 0:o.children)||[]).indexOf(e),p=this.tableData[i];this.drug_name=p[0],e.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(t){return $.calculateDisplayAge(t)},openPopover(t){this.event=t,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(t){var o;const e=t.target.value;this.batchNumber=e||((o=this.tempScannedBatchNumber)==null?void 0:o.text)||""},saveBatchWithTodayDate(){let t=E.getSessionDate();this.saveDta(t)},dismiss(){Tt.dismiss()},saveBatch(){let t;vt.isEmpty(this.vaccineDate)==!0?t=E.getSessionDate():t=this.vaccineDate,this.saveDta(t)},validateVaccineName(){if(vt.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(vt.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(t){this.currentDrugOb=t},isAlphaNumeric(t){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(t)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(t){this.batchNumber=t},saveDta(t){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){Wt("Enter batch number!");return}if(this.batchNumber==""){Wt("Enter batch number!");return}const e={batch_number:this.batchNumber,date_administered:t,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},o=Ht();o.setAdministeredVaccine(e),kn(this.patient),this.dismiss(),o.setTempScannedBatchNumber(null)}}}),Fs={key:0,class:"spinner-overlay"},Es={class:"header position_content"},xs={style:{"font-size":"1.2em","font-weight":"700"}},Us={class:"dueCardContent"},Ws=["onClick"],Hs={style:{"margin-right":"15px"}},zs={style:{"align-items":"center",display:"flex"}},Js={style:{"line-height":"1"}},Gs={class:"client_name"},js={class:"name"},Qs={class:"demographicsOtherRow"},Ys={class:"demographicsText"};function qs(t,e,o,i,p,y){const h=u("ion-spinner"),r=u("ion-icon"),m=u("ion-header"),d=u("ion-card-title"),g=u("ion-card-header"),D=u("DataTable"),b=u("ion-card-content"),w=u("ion-card"),I=u("ion-item"),v=u("ion-list"),R=u("ion-popover"),x=u("ion-content");return l(),_(F,null,[t.isLoading?(l(),_("div",Fs,[a(h,{name:"bubbles"}),e[3]||(e[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):k("",!0),a(m,null,{default:s(()=>[n("div",Es,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=B=>t.dismiss())},[a(r,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",xs,f(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=B=>t.openPopover(B))},[a(r,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(x,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:s(()=>[n("div",null,[a(w,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:s(()=>[a(g,null,{default:s(()=>[a(d,{class:"sectionTitle"},{default:s(()=>e[4]||(e[4]=[P(" Summary of required doses ",-1)])),_:1,__:[4]})]),_:1}),a(b,null,{default:s(()=>[n("div",Us,[a(D,{options:t.options,data:t.tableData,class:"display nowrap",width:"100%",onClick:t.handleRowClick},{default:s(()=>e[5]||(e[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])),_:1,__:[5]},8,["options","data","onClick"])])]),_:1})]),_:1}),a(w,{class:"section",style:{"margin-inline":"0px"}},{default:s(()=>[a(g,null,{default:s(()=>[a(d,{class:"sectionTitle"},{default:s(()=>e[6]||(e[6]=[P("Client Details ",-1)])),_:1,__:[6]})]),_:1}),a(b,null,{default:s(()=>[(l(!0),_(F,null,W(t.clientDetails,(B,Q)=>(l(),_("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:Q,onClick:z=>t.openClientProfile(B.patient_id)},[n("div",Hs,[n("div",{class:K((B==null?void 0:B.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(r,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),n("div",zs,[n("div",Js,[n("div",Gs,[n("div",js,f(B.given_name)+" "+f(B.family_name),1)]),n("div",Qs,[n("div",Ys,[P(f(B.gender=="M"?"Male":"Female")+" ",1),e[7]||(e[7]=n("span",{class:"dot"},".",-1)),P(f(t.formatBirthdate(B.birthdate)),1)])]),n("div",null,"Village: "+f(B.city_village),1)])])],8,Ws))),128))]),_:1})]),_:1})]),a(R,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:t.event,onDidDismiss:e[2]||(e[2]=B=>t.popoverOpen=!1)},{default:s(()=>[n("div",null,[e[8]||(e[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(l(!0),_(F,null,W(t.villageList,(B,Q)=>(l(),T(v,{class:K(B==t.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:Q},{default:s(()=>[a(I,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:z=>t.handleVillageClick(B)},{default:s(()=>[P(f(B),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const Zs=H(Ms,[["render",qs],["__scopeId","data-v-2b76e9ce"]]),Xs=U({name:"Menu",mixins:[ft],components:{IonContent:nt,IonHeader:et,IonItem:rt,IonList:it,IonMenu:pt,IonTitle:ut,IonToolbar:ot,IonCheckbox:Nt,BasicForm:gt,BasicCard:Ot,Carousel:Xe,Slide:Ze,Pagination:qe,Navigation:Ye},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},computed:{...Y(ht,["substance"]),backgroundStyle(){return{background:"linear-gradient(180deg, rgba(150, 152, 152, 0.7) 0%, rgba(255, 255, 255, 0.9) 100%), url(".concat(An("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",height:"22.8vh"}}},watch:{},async mounted(){new Ls().setMessageHandler(this.onMessage)},methods:{async onMessage(t){var o,i,p;const e=JSON.parse(t.data);e.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=e.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((o=this.reportData)==null?void 0:o.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((i=this.reportData)==null?void 0:i.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((p=this.reportData)==null?void 0:p.total_male_vaccinated_this_year)||0}])},openDueModal(t){const e={title:t,dashBoardData:this.reportData};_t(Zs,{class:"fullScreenModal"},!0,e)},async openClientProfile(t){const e=await mt.findByNpid(t);await tt().setPatientRecord(e[0]),this.$router.push("patientProfile")}}}),Ks={class:"topStats"},to={class:"totalStats",style:{background:"linear-gradient(180deg, #20b2aa 0%, #40c0b0 50%, rgb(233, 233, 233) 100%)"}},eo={class:"statsValue",style:{"font-size":"1.4em"}},no={class:"statsText",style:{"font-size":"0.9em"}},ao={class:"dueCardContent"},so={class:"statsValue"},oo={class:"statsValue"},io={class:"statsValue"},ro={class:"overDueCardContent"},lo={class:"statsValue"},co={class:"statsValue"},uo=["onClick"],po={style:{"margin-right":"15px"}},mo={style:{"align-items":"center",display:"flex"}},ho={style:{"line-height":"1"}},go={class:"client_name"},fo={class:"name"},_o={class:"demographicsOtherRow"},vo={class:"demographicsText"};function yo(t,e,o,i,p,y){const h=u("Slide"),r=u("Pagination"),m=u("Carousel"),d=u("ion-card-title"),g=u("ion-card-header"),D=u("ion-card-content"),b=u("ion-card"),w=u("ion-icon"),I=u("ion-content");return l(),T(I,{class:"content"},{default:s(()=>[n("div",Ks,[n("div",null,[n("div",{style:Ct(t.backgroundStyle)},[a(m,{autoplay:4e3,"wrap-around":!0,itemsToShow:1.2,transition:600,style:{"padding-top":"20px"}},{addons:s(()=>[a(r)]),default:s(()=>[(l(!0),_(F,null,W(t.totalStats,v=>(l(),T(h,{key:v},{default:s(()=>[n("div",to,[n("div",eo,f(v.value),1),n("div",no,f(v.name),1)])]),_:2},1024))),128))]),_:1})],4)]),a(b,{class:"section"},{default:s(()=>[a(g,null,{default:s(()=>[a(d,{class:"cardTitle"},{default:s(()=>e[5]||(e[5]=[P(" Clients due ",-1)])),_:1,__:[5]})]),_:1}),a(D,null,{default:s(()=>{var v,R,x;return[n("div",ao,[n("div",{class:"dueCard",onClick:e[0]||(e[0]=B=>t.openDueModal("Client due today")),style:{border:"1px solid rgb(158, 207, 136)"}},[n("div",so,f(((v=t.reportData)==null?void 0:v.due_today_count)||0),1),e[6]||(e[6]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(239, 221, 121)"},onClick:e[1]||(e[1]=B=>t.openDueModal("Client due this week"))},[n("div",oo,f(((R=t.reportData)==null?void 0:R.due_this_week_count)||0),1),e[7]||(e[7]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(241, 154, 154)"},onClick:e[2]||(e[2]=B=>t.openDueModal("Client due this month"))},[n("div",io,f(((x=t.reportData)==null?void 0:x.due_this_month_count)||0),1),e[8]||(e[8]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),a(b,{class:"section"},{default:s(()=>[a(g,null,{default:s(()=>[a(d,{class:"cardTitle"},{default:s(()=>e[9]||(e[9]=[P(" Clients overdue ",-1)])),_:1,__:[9]})]),_:1}),a(D,null,{default:s(()=>{var v,R;return[n("div",ro,[n("div",{class:"overDueCard",onClick:e[3]||(e[3]=x=>t.openDueModal("Client overdue under 5yrs"))},[n("div",lo,f(((v=t.reportData)==null?void 0:v.under_five_overdue)||0),1),e[10]||(e[10]=n("div",{class:"statsText"},"Under 5yrs",-1))]),n("div",{class:"overDueCard",onClick:e[4]||(e[4]=x=>t.openDueModal("Client overdue over 5yrs"))},[n("div",co,f(((R=t.reportData)==null?void 0:R.over_five_overdue)||0),1),e[11]||(e[11]=n("div",{class:"statsText"},"Over 5yrs",-1))])])]}),_:1})]),_:1}),a(b,{class:"section"},{default:s(()=>[a(g,null,{default:s(()=>[a(d,{class:"cardTitle"},{default:s(()=>{var v;return[P("Today's appointments("+f((v=t.appointments)==null?void 0:v.length)+") ",1)]}),_:1})]),_:1}),a(D,null,{default:s(()=>[(l(!0),_(F,null,W(t.appointments,(v,R)=>(l(),_("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:R,onClick:x=>t.openClientProfile(v.npid)},[n("div",po,[n("div",{class:K(v.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(w,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),n("div",mo,[n("div",ho,[n("div",go,[n("div",fo,f(v.given_name)+" "+f(v.family_name),1)]),n("div",_o,[n("div",vo,[P(f(v.gender=="M"?"Male":"Female")+" ",1),e[12]||(e[12]=n("span",{class:"dot"},".",-1)),P(f(t.formatBirthdate(v.birthdate)),1)])]),n("div",null,"Village: "+f(v==null?void 0:v.city_village),1)])])],8,uo))),128))]),_:1})]),_:1})])]),_:1})}const bo=H(Xs,[["render",yo],["__scopeId","data-v-a8eeb2dc"]]),Do=U({components:{DataTable:Pt},props:{title:{type:String,default:""},list:{type:String,default:""},buttonTitle:{type:String,default:""},buttonLink:{type:String,default:""}},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:t=>this.waitingTime(t),width:"15%"},{title:"Actions",data:null,render:(t,e,o)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px";const p="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",y=(h,r,m)=>{const d=document.createElement("ion-button");return d.innerText=h,d.size="small",d.fill="solid",d.color=r,d.style.cssText=p,d.addEventListener("click",m),d};return i.appendChild(y(this.buttonTitle,"primary",()=>this.navigateTo(o.patient_id,this.buttonLink))),i.appendChild(y("Profile","warning",()=>this.navigateTo(o.patient_id,"/patientProfile"))),i.appendChild(y("Abscond","danger",()=>this.handleAbscond(o.patient_id))),i},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},computed:{...Y(wt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{patientsWaitingForConsultation:{handler(t){this.list==="CONSULTATION"&&(this.patients=t)},deep:!0},patientsWaitingForVitals:{handler(t){this.list==="VITALS"&&(this.patients=t)},deep:!0},patientsWaitingForLab:{handler(t){this.list==="LAB"&&(this.patients=t)},deep:!0},patientsWaitingForDispensation:{handler(t){this.list==="DISPENSATION"&&(this.patients=t)},deep:!0}},mounted(){this.setList()},methods:{setList(){const t={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation},e=this.list;this.patients=t[e]||[]},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),o=Math.floor(e/6e4);if(o<1)return"Just now";if(o<60)return"".concat(o," min").concat(o>1?"s":""," ago");const i=Math.floor(o/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const p=Math.floor(i/24);return"".concat(p," day").concat(p>1?"s":""," ago")},async navigateTo(t,e){console.log("Patient",t);let o=[];if(E.getUseIndexDBStatus()||E.getModsStatus()?(o=await $t("patientRecords",{whereClause:{patientID:t}}),o=o[0]):o=await E.getJson("/patients/".concat(t,"/get_patient_record")),!o||o.length===0){Rt("Patient not found in offline records.");return}const i=o;await tt().setPatientRecord(i),this.$router.push(e)},async handleAbscond(t){try{const e=String(localStorage.getItem("locationID"));await pn({patient_id:t}),await wt().refresh(e)}catch(e){console.error("Failed to abscond patient:",e)}},dismiss(){Tt.dismiss()}}}),Co={class:"modal-container"},wo={class:"dueCardContent"};function $o(t,e,o,i,p,y){const h=u("ion-button"),r=u("ion-card-title"),m=u("ion-card-header"),d=u("DataTable"),g=u("ion-card-content"),D=u("ion-card");return l(),_("div",Co,[a(h,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:s(()=>e[0]||(e[0]=[P(" Close ",-1)])),_:1,__:[0]},8,["onClick"]),a(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:s(()=>[a(m,null,{default:s(()=>[a(r,{class:"sectionTitle"},{default:s(()=>[P(f(t.title),1)]),_:1})]),_:1}),a(g,null,{default:s(()=>[n("div",wo,[a(d,{data:t.patients,columns:t.tableColumns,class:"display nowrap compact",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})])}const So=H(Do,[["render",$o],["__scopeId","data-v-6b4bbb15"]]),ko=U({components:{IonContent:nt,IonHeader:et,IonItem:rt,IonList:it,IonIcon:j,IonCard:St,IonCardHeader:oe,IonCardTitle:se,IonCardContent:Lt,IonPopover:ue,DataTable:Pt},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:Ft,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:t=>this.waitingTime(t),width:"20%"},{title:"Actions",data:null,render:(t,e,o)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px";const p="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",y=(h,r,m)=>{const d=document.createElement("ion-button");return d.innerText=h,d.size="small",d.fill="solid",d.color=r,d.style.cssText=p,d.addEventListener("click",m),d};return i.appendChild(y("Profile","warning",()=>this.navigateTo(o.patient_id,"/patientProfile"))),i},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const t=String(localStorage.getItem("locationID")),e=new Date().toISOString().split("T")[0],o=await mn(),i=o.filter(r=>String(r.location_id)===t&&r.startDate>="".concat(e,"T00:00:00")&&r.startDate<="".concat(e,"T23:59:59")),p=o.map(r=>r.patientId);let y=[];E.getModsStatus()||E.getUseIndexDBStatus()?y=await $t("patientRecords",{inClause:{patientID:p}})||[]:y=await E.getJson("get_patient_record",{patient_ids:p,paginate:!1});const h={};y.forEach(r=>{h[r.patientID]=r,h[String(r.patientID)]=r}),this.patients=i.map(r=>{var g,D,b;const m=h[r.patientId]||{};return{fullName:[(g=m==null?void 0:m.personInformation)==null?void 0:g.given_name,(D=m==null?void 0:m.personInformation)==null?void 0:D.middle_name,(b=m==null?void 0:m.personInformation)==null?void 0:b.family_name].filter(Boolean).join(" ").trim()||"Unknown (ID: ".concat(r.patientId,")"),arrivalTime:r.startDate,patient_id:r.patientId}})},methods:{openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Tt.dismiss()},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),o=Math.floor(e/6e4);if(o<1)return"Just now";if(o<60)return"".concat(o," min").concat(o>1?"s":""," ago");const i=Math.floor(o/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const p=Math.floor(i/24);return"".concat(p," day").concat(p>1?"s":""," ago")},async navigateTo(t,e){const o=await mt.findByID(t);await tt().setPatientRecord(o),this.$router.push(e)}}}),Io={class:"modal-container"},Ao={class:"dueCardContent"};function Po(t,e,o,i,p,y){const h=u("ion-button"),r=u("ion-card-title"),m=u("ion-card-header"),d=u("DataTable"),g=u("ion-card-content"),D=u("ion-card");return l(),_("div",Io,[a(h,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:s(()=>e[0]||(e[0]=[P(" Close ",-1)])),_:1,__:[0]},8,["onClick"]),a(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:s(()=>[a(m,null,{default:s(()=>[a(r,{class:"sectionTitle"},{default:s(()=>[P(f(t.title),1)]),_:1})]),_:1}),a(g,null,{default:s(()=>[n("div",Ao,[a(d,{data:t.patients,columns:t.tableColumns,class:"display nowrap compact",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})])}const To=H(ko,[["render",Po],["__scopeId","data-v-8b0a446b"]]),No=U({name:"OPDAppointmentsModal",components:{IonPage:At,IonHeader:et,IonContent:nt,IonItem:rt,IonList:it,IonIcon:j,IonCard:St,IonCardContent:Lt,IonPopover:ue,DataTable:Pt,IonSegment:tn,IonSegmentButton:Ke,IonLabel:ce,IonRow:It,IonCol:kt,DateInputField:Et},props:{title:{type:String,default:"OPD Appointments"},programType:{type:String,required:!0},programId:{type:Number,required:!0}},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:Ft,appointments:[],viewMode:"today",startDate:$.sessionDate(),endDate:$.sessionDate(),calendarOutline:ct,openOutline:re,tableColumns:[{title:"Patient ID",data:"ID"},{title:"Name",data:"name"},{title:"Age/DOB",data:"ageDob"},{title:"Gender",data:"gender"},{title:"Village",data:"village"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(t,e,o)=>{const i=document.createElement("div"),p=document.createElement("ion-button");return p.innerText="Profile",p.size="small",p.style.color="#fff",p.style.padding="8px 12px",p.style.marginRight="8px",p.addEventListener("click",()=>this.openClientProfile(o.ID)),i.appendChild(p),i},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,dom:"Bfrtip",order:[[5,"asc"]]}}},async mounted(){await this.loadAppointments()},methods:{async loadAppointments(){var t,e;this.isLoading=!0;try{const o=$.sessionDate(),i=this.viewMode==="today"?o:this.startDate,p=this.viewMode==="today"?o:this.endDate,y=localStorage.getItem("locationID"),h=await $t("patientRecords"),r=[];for(const m of h)[...((t=m.appointments)==null?void 0:t.saved)||[],...((e=m.appointments)==null?void 0:e.unsaved)||[]].filter(D=>{if(D.concept_id!==5096||D.program_id!==14||D.location_id!==y)return!1;const b=D.value_datetime||D.obs_datetime;if(!b)return!1;const w=$.toStandardHisFormat(b),I=$.toStandardHisFormat(i),v=$.toStandardHisFormat(p);return w>=I&&w<=v}).forEach(D=>{var b,w,I,v,R;r.push({ID:m.ID,name:[(b=m.personInformation)==null?void 0:b.given_name,(w=m.personInformation)==null?void 0:w.family_name].filter(Boolean).join(" ")||"Unknown",ageDob:(I=m.personInformation)!=null&&I.birthdate?$.getBirthdateAge(m.personInformation.birthdate):"N/A",gender:((v=m.personInformation)==null?void 0:v.gender)||"Unknown",village:((R=m.personInformation)==null?void 0:R.home_village)||"Unknown",appointmentDate:$.toStandardHisDisplayFormat(D.value_datetime||D.obs_datetime),rawData:D})});this.appointments=r.sort((m,d)=>{const g=m.rawData.value_datetime||m.rawData.obs_datetime,D=d.rawData.value_datetime||d.rawData.obs_datetime;return new Date(g).getTime()-new Date(D).getTime()})}catch(o){console.error("Error loading appointments:",o),Rt("Failed to load appointments")}finally{this.isLoading=!1}},async getAppointmentsD1(t){this.startDate=$.toStandardHisFormat(t),await this.loadAppointments()},async getAppointmentsD2(t){this.endDate=$.toStandardHisFormat(t),await this.loadAppointments()},onViewModeChange(){this.viewMode==="today"&&(this.startDate=$.sessionDate(),this.endDate=$.sessionDate()),this.loadAppointments()},async openClientProfile(t){try{const e=await $t("patientRecords",{whereClause:{ID:t}});await tt().setPatientRecord(e[0]),this.$router.push("patientProfile")}catch(e){console.error("Error opening profile:",e),Rt("Failed to open patient profile")}},openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Tt.dismiss()}}}),Oo={class:"header position_content"},Vo={style:{"font-size":"1.2em","font-weight":"700"}},Ro={key:0,class:"date-filter"},Bo={class:"dueCardContent"},Lo={key:1,class:"no-appointments"};function Mo(t,e,o,i,p,y){const h=u("ion-icon"),r=u("ion-header"),m=u("ion-label"),d=u("ion-segment-button"),g=u("ion-segment"),D=u("DateInputField"),b=u("ion-col"),w=u("ion-row"),I=u("DataTable"),v=u("ion-card-content"),R=u("ion-card"),x=u("ion-content"),B=u("ion-page");return l(),T(B,null,{default:s(()=>[a(r,null,{default:s(()=>[n("div",Oo,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=(...Q)=>t.dismiss&&t.dismiss(...Q))},[a(h,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Vo,f(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=Q=>t.openPopover(Q))},[a(h,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(x,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:s(()=>[a(g,{modelValue:t.viewMode,"onUpdate:modelValue":e[2]||(e[2]=Q=>t.viewMode=Q),onIonChange:t.onViewModeChange},{default:s(()=>[a(d,{value:"today"},{default:s(()=>[a(m,null,{default:s(()=>e[3]||(e[3]=[P("Today's Appointments",-1)])),_:1,__:[3]})]),_:1}),a(d,{value:"range"},{default:s(()=>[a(m,null,{default:s(()=>e[4]||(e[4]=[P("Date Range",-1)])),_:1,__:[4]})]),_:1})]),_:1},8,["modelValue","onIonChange"]),t.viewMode==="range"?(l(),_("div",Ro,[a(w,null,{default:s(()=>[a(b,null,{default:s(()=>[a(D,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:t.endDate,disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","maxDate","onUpdate:rawDateValue"])]),_:1}),a(b,null,{default:s(()=>[a(D,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):k("",!0),a(R,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:s(()=>[a(v,null,{default:s(()=>[n("div",Bo,[t.appointments.length>0?(l(),T(I,{key:0,data:t.appointments,columns:t.tableColumns,options:t.tableOptions,class:"display nowrap",width:"100%"},null,8,["data","columns","options"])):(l(),_("div",Lo," No appointments found for the selected "+f(t.viewMode==="today"?"day":"date range"),1))])]),_:1})]),_:1})]),_:1})]),_:1})}const Fo=H(No,[["render",Mo],["__scopeId","data-v-54fbae83"]]),Eo={class:"card-count"},xo={class:"card-label"},Uo="#ffffff",Wo=U({__name:"DashboardCard",props:{icon:{},count:{},label:{},color:{}},emits:["cardClick"],setup(t,{emit:e}){const p={success:"#A5D6A7",info:"#81D4FA",warning:"#FFF59D",danger:"#EF9A9A"}[t.color||"info"]||"#E0E0E0";return(y,h)=>(l(),T(J(St),{class:"dashboard-card",style:Ct({borderColor:J(p),backgroundColor:Uo}),onClick:h[0]||(h[0]=r=>y.$emit("cardClick"))},{default:s(()=>[a(J(j),{icon:y.icon,class:"card-icon"},null,8,["icon"]),n("div",Eo,f(y.count),1),n("div",xo,f(y.label),1)]),_:1},8,["style"]))}}),Ho=H(Wo,[["__scopeId","data-v-84ad3c1b"]]),zo=U({name:"OPDDashboard",components:{DashboardCard:Ho},data(){return{totalPatientsToday:0,canViewVitals:!1,canViewConsultation:!1,canViewLab:!1,canViewDispensation:!1,canViewAppointments:!1,userRoles:[]}},computed:{...Y(wt,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","patientsVisits","todaysAppointmentsCount"])},watch:{$route(t,e){this.reloadRolePermissions()}},async mounted(){this.reloadRolePermissions();const t=E.getUserLocationId();t&&await wt().refresh(t)},methods:{medkit(){return ne},flask(){return nn},clipboard(){return Xt},thermometer(){return Kt},calendar(){return en},people(){return te},reloadRolePermissions(){this.loadUserRoles(),this.updateCardVisibility()},loadUserRoles(){localStorage.getItem("userRoles");try{const t=localStorage.getItem("userRoles")||"[]",e=JSON.parse(t);this.userRoles=e.map(o=>typeof o=="string"?o:o.role||o.name||"")}catch(t){this.userRoles=[]}},hasAnyRole(t){const e=this.userRoles.map(o=>o.toLowerCase());return t.some(o=>e.includes(o.toLowerCase()))},updateCardVisibility(){this.canViewVitals=this.hasAnyRole(["Clinician","Nurse","Superuser"]),this.canViewConsultation=this.hasAnyRole(["Clinician","Superuser"]),this.canViewLab=this.hasAnyRole(["Lab"]),this.canViewDispensation=this.hasAnyRole(["Clinician","Pharmacist","Superuser"]),this.canViewAppointments=this.hasAnyRole(["Clinician","Nurse","Superuser"])},openAllModal(t,e,o){_t(To,{class:"fullScreenModal"},!0,{title:t,buttonTitle:e,buttonLink:o})},openPatientsListModal(t,e,o,i){_t(So,{class:"fullScreenModal"},!0,{title:t,list:e,buttonTitle:o,buttonLink:i})},openAppointmentsModal(t,e){_t(Fo,{class:"fullScreenModal"},!0,{title:t,programType:e,programId:14})}}}),Jo={class:"dashboard-wrapper"};function Go(t,e,o,i,p,y){const h=u("ion-icon"),r=u("ion-card-title"),m=u("ion-card-header"),d=u("DashboardCard"),g=u("ion-row"),D=u("ion-grid"),b=u("ion-card-content"),w=u("ion-card"),I=u("ion-content");return l(),T(I,{fullscreen:!0},{default:s(()=>[n("div",Jo,[a(w,{class:"dashboard-card"},{default:s(()=>[a(m,{class:"dashboard-card-header"},{default:s(()=>[a(r,{class:"dashboard-title"},{default:s(()=>[a(h,{icon:t.people(),slot:"start",class:"dashboard-icon"},null,8,["icon"]),e[6]||(e[6]=P(" Today's Patients Overview ",-1))]),_:1,__:[6]})]),_:1}),a(b,null,{default:s(()=>[a(D,{class:"centered-grid"},{default:s(()=>[a(g,{class:"centered-row"},{default:s(()=>[a(d,{icon:t.people(),color:"primary",count:t.patientsVisits.length,label:"Total patients today",onCardClick:e[0]||(e[0]=v=>t.openAllModal("All patients today","View profile","/patientProfile"))},null,8,["icon","count"]),t.canViewAppointments?(l(),T(d,{key:0,icon:t.calendar(),color:"primary",count:t.todaysAppointmentsCount.length,label:"Appointments",onCardClick:e[1]||(e[1]=v=>t.openAppointmentsModal("OPD Appointments","14"))},null,8,["icon","count"])):k("",!0),t.canViewVitals?(l(),T(d,{key:1,icon:t.thermometer(),color:"primary",count:t.patientsWaitingForVitals.length,label:"Waiting for vitals",onCardClick:e[2]||(e[2]=v=>t.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals"))},null,8,["icon","count"])):k("",!0),t.canViewConsultation?(l(),T(d,{key:2,icon:t.clipboard(),color:"primary",count:t.patientsWaitingForConsultation.length,label:"Waiting for consultation",onCardClick:e[3]||(e[3]=v=>t.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan"))},null,8,["icon","count"])):k("",!0),t.canViewLab?(l(),T(d,{key:3,icon:t.flask(),color:"primary",count:t.patientsWaitingForLab.length,label:"Waiting for lab",onCardClick:e[4]||(e[4]=v=>t.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan"))},null,8,["icon","count"])):k("",!0),t.canViewDispensation?(l(),T(d,{key:4,icon:t.medkit(),color:"primary",count:t.patientsWaitingForDispensation.length,label:"Waiting for dispensation",onCardClick:e[5]||(e[5]=v=>t.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations"))},null,8,["icon","count"])):k("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})}const jo=H(zo,[["render",Go],["__scopeId","data-v-07aedaee"]]),Qo=U({name:"NCDDashboard",mixins:[ft],components:{ApexChart:fe},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await ae(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return E.getJson("programs/32/reports/ncd_dashboard",{start_date:$.toStandardHisFormat($.sessionDate()),end_date:$.toStandardHisFormat($.sessionDate())})}}}),Yo={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},qo={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},Zo={ref:"chartRef1"},Xo={ref:"chartRef2"};function Ko(t,e,o,i,p,y){const h=u("ion-card-content"),r=u("ion-card"),m=u("ApexChart");return l(),_(F,null,[n("div",Yo,[a(r,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(h,null,{default:s(()=>e[0]||(e[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])),_:1,__:[0]})]),_:1}),a(r,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(h,null,{default:s(()=>e[1]||(e[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])),_:1,__:[1]})]),_:1}),a(r,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(h,null,{default:s(()=>e[2]||(e[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])),_:1,__:[2]})]),_:1}),a(r,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(h,null,{default:s(()=>e[3]||(e[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])),_:1,__:[3]})]),_:1})]),n("div",qo,[a(r,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(h,null,{default:s(()=>[e[4]||(e[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",Zo,[t.isChartReady?(l(),T(m,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1,__:[4]})]),_:1}),a(r,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(h,null,{default:s(()=>[e[5]||(e[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",Xo,[t.isChartReady?(l(),T(m,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):k("",!0)],512)]),_:1,__:[5]})]),_:1})])],64)}const ti=H(Qo,[["render",Ko],["__scopeId","data-v-58e2a3d8"]]),ei=U({name:"Home",mixins:[pe,ft],components:{IonContent:nt,IonHeader:et,IonPage:At,IonToolbar:ot,Toolbar:he,IonRow:It,DateInputField:Et,IonIcon:j,IonButton:ie,IonCol:kt},data(){const t=V($.sessionDate()),e=V($.sessionDate()),o=V($.sessionDate()),i=V([]);return{segmentContent:"Today",minDate:o,startDate:t,endDate:e,people:i,calendarOutline:ct,eyeOutline:an}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(t){this.segmentContent=t},formatBirthdate(t){return $.getBirthdateAge(t)},async getAppointments(){this.people=[],(await _e.getAppointments(this.startDate,this.endDate,"")).forEach(e=>{const o={person_id:e.person_id,npid:e.npid,appointment_id:103,encounter_id:e.encounter_id,name:e.given_name.concat(" ",e.family_name),gender:e.gender,ageDob:this.formatBirthdate(e.birthdate),village:e.city_village,appointmentDate:$.toStandardHisDisplayFormat(e.appointment_date)};this.people.push(o)})},async getAppointmentsD1(t){this.startDate=$.toStandardHisFormat(t),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=$.toStandardHisFormat(t),await this.getAppointments()},async openClientProfile(t){await mt.findByNpid(t),this.isPharmacist()},isPharmacist(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(o=>e.some(i=>i.role==="Pharmacist"))&&(this.$router.push("dispensation"),E.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),ni={class:"appointments-container"},ai={key:0,class:"date-filter"},si={class:"appointments-table"};function oi(t,e,o,i,p,y){const h=u("ion-label"),r=u("ion-segment-button"),m=u("ion-segment"),d=u("DateInputField"),g=u("ion-col"),D=u("ion-row"),b=u("ion-icon"),w=u("ion-button"),I=u("ion-card");return l(),_("div",ni,[n("div",null,[a(m,{value:t.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:s(()=>[a(r,{value:"Today",onClick:e[0]||(e[0]=v=>t.setSegmentContent("Today"))},{default:s(()=>[a(h,null,{default:s(()=>e[3]||(e[3]=[P("Today",-1)])),_:1,__:[3]})]),_:1}),a(r,{value:"Tomorrow",onClick:e[1]||(e[1]=v=>t.setSegmentContent("Tomorrow"))},{default:s(()=>[a(h,null,{default:s(()=>e[4]||(e[4]=[P("Tomorrow",-1)])),_:1,__:[4]})]),_:1}),a(r,{value:"Date range",onClick:e[2]||(e[2]=v=>t.setSegmentContent("Date range"))},{default:s(()=>[a(h,null,{default:s(()=>e[5]||(e[5]=[P("Date range",-1)])),_:1,__:[5]})]),_:1})]),_:1},8,["value"])]),t.segmentContent==="Date range"?(l(),_("div",ai,[a(D,null,{default:s(()=>[a(g,null,{default:s(()=>[a(d,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(g,null,{default:s(()=>[a(d,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):k("",!0),t.people.length>0?(l(),T(I,{key:1},{default:s(()=>[n("table",si,[e[6]||(e[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(l(!0),_(F,null,W(t.people,v=>(l(),_("tr",{key:v.npid},[n("td",null,[a(D,null,{default:s(()=>[a(g,null,{default:s(()=>[P(f(v.name),1)]),_:2},1024),a(g,null,{default:s(()=>[a(w,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:R=>t.openClientProfile(v.npid),color:"primary",fill:"clear",size:"small"},{default:s(()=>[a(b,{icon:t.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,f(v.npid),1),n("td",null,f(v.ageDob),1),n("td",null,f(v.gender),1),n("td",null,f(v.village),1),n("td",null,f(v.appointmentDate),1)]))),128))])])]),_:1})):(l(),T(I,{key:2},{default:s(()=>e[7]||(e[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])),_:1,__:[7]}))])}const ii=H(ei,[["render",oi],["__scopeId","data-v-c47f7768"]]),ri=U({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){}}}),li={key:0},di={style:{display:"flex","margin-top":"10px"}},ci={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},ui={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},pi={key:1};function mi(t,e,o,i,p,y){const h=u("ion-label"),r=u("ion-segment-button"),m=u("ion-segment"),d=u("VisitsHistory");return l(),_(F,null,[n("div",null,[a(m,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:s(()=>[a(r,{value:"Internal referrals",onClick:e[0]||(e[0]=g=>t.setSegmentContent("Internal referrals"))},{default:s(()=>[a(h,null,{default:s(()=>e[2]||(e[2]=[P("Internal referrals",-1)])),_:1,__:[2]})]),_:1}),a(r,{value:"External referrals",onClick:e[1]||(e[1]=g=>t.setSegmentContent("External referrals"))},{default:s(()=>[a(h,null,{default:s(()=>e[3]||(e[3]=[P("External referrals",-1)])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(l(),_("div",li,[n("div",di,[t.checkUnderFive?(l(),_("div",ci)):k("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?k("",!0):(l(),_("div",ui))])])):k("",!0),t.segmentContent=="External referrals"?(l(),_("div",pi,[a(d)])):k("",!0)],64)}const hi=H(ri,[["render",mi],["__scopeId","data-v-faad8f8b"]]),gi=U({name:"Menu",components:{IonContent:nt,IonHeader:et,IonItem:rt,IonList:it,IonMenu:pt,IonTitle:ut,IonToolbar:ot,IonCheckbox:Nt,IonIcon:j,BasicForm:gt,BasicCard:Ot,Referrals:hi,Dashboard:ti,ANCAppointments:ii},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:le},{id:"referrals",label:"Referrals",icon:de},{id:"appointments",label:"Appointments",icon:ct}],activeItem:"dashboard"}},computed:{...Y(ht,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),fi={style:{display:"flex"}},_i={class:"left_col"},vi={class:"nav-menu"},yi=["onClick"],bi={class:"right_col"};function Di(t,e,o,i,p,y){const h=u("ion-icon"),r=u("Dashboard"),m=u("ANCAppointments"),d=u("Referrals");return l(),_("div",fi,[n("div",_i,[n("nav",vi,[n("ul",null,[(l(!0),_(F,null,W(t.menuItems,g=>(l(),_("li",{key:g.id,class:K({active:t.activeItem===g.id}),onClick:D=>t.setActiveItem(g.id)},[a(h,{icon:g.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,f(g.label),1)],10,yi))),128))])])]),n("div",bi,[n("div",null,[t.activeItem==="dashboard"?(l(),T(r,{key:0})):k("",!0),t.activeItem==="appointments"?(l(),T(m,{key:1})):k("",!0),t.activeItem==="referrals"?(l(),T(d,{key:2})):k("",!0)])])])}const Ci=H(gi,[["render",Di],["__scopeId","data-v-7e786ea4"]]),wi=U({name:"Menu",components:{IonContent:nt,IonHeader:et,IonItem:rt,IonList:it,IonMenu:pt,IonTitle:ut,IonToolbar:ot,IonCheckbox:Nt,BasicForm:gt,BasicCard:Ot},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Y(ht,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),$i={class:"left_col"},Si={class:"nav-menu"},ki=["onClick"];function Ii(t,e,o,i,p,y){return l(),_("div",null,[n("div",$i,[n("nav",Si,[n("ul",null,[(l(!0),_(F,null,W(t.menuItems,h=>(l(),_("li",{key:h.id,class:K({active:t.activeItem===h.id}),onClick:r=>t.setActiveItem(h.id)},f(h.label),11,ki))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const Ai=H(wi,[["render",Ii],["__scopeId","data-v-32dd02d3"]]),Pi=U({name:"Menu",components:{IonContent:nt,IonHeader:et,IonItem:rt,IonList:it,IonMenu:pt,IonTitle:ut,IonToolbar:ot,IonCheckbox:Nt,BasicForm:gt,BasicCard:Ot},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...Y(ht,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Ti={class:"left_col"},Ni={class:"nav-menu"},Oi=["onClick"];function Vi(t,e,o,i,p,y){return l(),_("div",null,[n("div",Ti,[n("nav",Ni,[n("ul",null,[(l(!0),_(F,null,W(t.menuItems,h=>(l(),_("li",{key:h.id,class:K({active:t.activeItem===h.id}),onClick:r=>t.setActiveItem(h.id)},f(h.label),11,Oi))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const Ri=H(Pi,[["render",Vi],["__scopeId","data-v-b49d8600"]]);function Bi(){const t=Mt(),e=Vt(),o=V(!1),{OPDActivities:i,NCDActivities:p}=Dt(e),y=async r=>{var m;try{const d=E.getUserID(),g=await ge.getJson("user_properties",{user_id:d,property:r});return g!=null&&g.property_value?(m=g==null?void 0:g.property_value)==null?void 0:m.split(","):[]}catch(d){return console.error("Error fetching user activities:",d),[]}},h=async()=>{try{o.value=!1;const[r,m]=await Promise.all([y("OPD_activities"),y("NCD_activities")]);r.length>0&&e.setOPDActivity(r),m.length>0&&e.setNCDActivity(m)}catch(r){console.error("Error updating activities:",r)}finally{o.value=!0}};return st(()=>t.path,async()=>{await h()},{immediate:!0,deep:!0}),{ready:o,OPDActivities:i,NCDActivities:p,getUserActivities:y,updateActivities:h}}function Li(){const t=Mt(),e=V(""),o=V(!1),i=V({}),p=()=>{const y=E.getUserRoles(),h=E.getProgramID(),r=E.getProgramName();e.value=y,o.value=!1,y==="Lab"&&h===14?i.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:h===14&&y!=="Lab"?i.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:h===12?i.value={url:"contact",btnName:"Back"}:r==="LABOUR AND DELIVERY PROGRAM"?i.value={url:"labour/labourHome",btnName:"Back to home"}:r==="PNC PROGRAM"?i.value={url:"pnc/home",btnName:"Back to home"}:i.value={url:"",btnName:""},o.value=!0};return st(()=>t.path,()=>{p()},{immediate:!0,deep:!0}),{userRole:e,ready:o,userRoleSettings:i,updateUserRoleSettings:p}}const Mi={key:0,class:"spinner-overlay"},or=U({__name:"HomePage",setup(t){const e=V(!0),o=Mt(),i=hn(),p=V(localStorage.getItem("sessionDate")||"");Li();const y=gn(),{apiStatus:h}=Dt(me()),{activeProgram:r}=Dt(y),m=yt(()=>{switch(r.value.program_id){case at.IMMUNIZATION_PROGRAM:return bo;case at.OPD_PROGRAM:return jo;case at.NCD_PROGRAM:return hs;case at.ANC_PROGRAM:return Ci;case at.PNC_PROGRAM:return Ri;case at.LABOUR_AND_DELIVERY_PROGRAM:return Ai;case at.HIV_PROGRAM:return Bs;default:return null}}),d=()=>{const b=localStorage.getItem("sessionDate");(!b||b.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),Gt()),p.value=b||""};let g=null;bt(()=>{g=()=>d(),window.addEventListener("storage",g);const b=setInterval(d,1e3);sn(()=>{clearInterval(b),g&&window.removeEventListener("storage",g)}),d()}),st(p,(b,w)=>{(!b||b.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),Gt())}),st(()=>o.name,async b=>{b==="Home"&&(zt(),await Jt().loadGlobalProperty(),i.initWorker(),i.postData("SYNC_ALL_DATA"))},{immediate:!0,deep:!0});const D=async()=>{try{const b=E.getUserID(),w=await ge.getUserByID(b);if(w.location_id!=null){const I=await _n.getLocation(w.location_id);localStorage.setItem("locationData",JSON.stringify(I))}}catch(b){console.error("Failed to retrieve location data:",b)}};return h.value&&(Bi(),D()),bt(async()=>{try{e.value=!0,i.terminate(),zt(),await Jt().loadGlobalProperty(),vt.isEmpty(r.value)&&await fn.show(yn,{},"module-picker-modal")}catch(b){console.error("Error initializing component:",b)}finally{e.value=!1}}),(b,w)=>{const I=u("ion-spinner"),v=u("ion-content");return l(),T(J(At),null,{default:s(()=>[e.value?(l(),_("div",Mi,[a(I,{name:"bubbles"}),w[0]||(w[0]=n("div",{class:"loading-text"},"Please wait...",-1))])):k("",!0),a(he),a(bn),m.value?(l(),T(on(m.value),{key:1})):(l(),T(v,{key:2},{default:s(()=>w[1]||(w[1]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])),_:1,__:[1]}))]),_:1})}}});export{or as default};

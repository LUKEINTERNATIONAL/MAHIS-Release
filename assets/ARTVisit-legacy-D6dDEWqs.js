System.register(["./vendor-legacy-B0ctPPIE.js","./index-legacy-MuXwvuSb.js","./tasks-legacy-BJZH6eLE.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-BwM20G2n.js"],function(e,l){"use strict";var n,t,a,o,i,u,r,s,c,d,v,f,p,y,m,g,k,h,_,w,x,b,I,D,C,P,S,N,T,B,$,j,E,z,A,R,W,F,G,L,M,U,V,Y,H,J,K,O,X,Z,q,Q,ee,le,ne,te,ae,oe;return{setters:[e=>{n=e.d,t=e.cl,a=e.a$,o=e.ar,i=e.r,u=e.w,r=e.y,s=e.f,c=e.z,d=e.l,v=e.u,f=e.eB,p=e.k,y=e.ap,m=e.ah,g=e.e,k=e.ak,h=e.F,_=e.L,w=e.G,x=e.I,b=e.eC,I=e.dI,D=e.ex,C=e.B,P=e.bS,S=e.V,N=e.U,T=e.W,B=e.A,$=e.dS,j=e.bM,E=e.aZ,z=e.aW,A=e.m,R=e.ee,W=e.bN,F=e.dz,G=e.cB,L=e.eD,M=e.an,U=e.X},e=>{V=e.S,Y=e.u,H=e.P,J=e.T,K=e.bG,O=e.m,X=e.bg,Z=e.ae,q=e.K,Q=e.bH,ee=e.j,le=e.bI,ne=e.$,te=e._},e=>{ae=e.i,oe=e.a},null,null],execute:function(){var l=document.createElement("style");l.textContent="#main[data-v-f9671703]{height:calc(100vh - 69px);overflow-y:auto}.placeholder-content[data-v-f9671703]{padding:20px}\n/*$vite$:1*/",document.head.appendChild(l);class ie extends V{constructor(){super()}static nextTask(e){return super.getJson(`/workflows/${super.getProgramID()}/${e}`,{date:super.getSessionDate()})}static async getNextTaskParams(e,l=""){let n=l;try{if(!n){const{name:l}=await ie.nextTask(e);n=l}}catch(t){n=""}return{name:n.toLowerCase(),params:{patient_id:e}}}}const ue={key:1,style:{"margin-top":"10%"},class:"ion-padding ion-text-center"},re={class:"ion-page",id:"main"},se={key:0,class:"placeholder-content"},ce={style:{margin:"0px auto"},class:"ion-text-center"},de={key:1},ve={key:2,class:"ion-padding ion-text-center",style:{"margin-top":"15%"}},fe={style:{color:"black"}};e("default",te(n({__name:"ARTVisit",setup(e){const l=t(),n=Y(),{patient:te}=a(n),pe=new H,ye=o(),me=i(-1),ge=i(null),ke=i([]),he=i([]),_e=i(!1),we=i(-1),xe=i(""),be=i(""),Ie=i(""),De=i(!1),Ce=i(null);function Pe(e){var l;return!!e&&(!_e.value&&we.value===(null==e?void 0:e.encounterTypeID)||(null!==(l=null==e?void 0:e.otherWorkflowNames)&&void 0!==l?l:[]).includes(xe.value))}function Se(){if(0===ke.value.length||me.value===ke.value.length-1)return!1;const e=ke.value[me.value];return e&&Pe(e)}async function Ne(){var e;De.value=null!==(e=V.isBDE())&&void 0!==e&&e,Ie.value="",_e.value=!0,be.value="",xe.value="";try{var l;const e=await ie.nextTask(te.value.patientID);if(!e)return be.value="No workflows found. You may exit this page or refresh",_e.value=!1,void(me.value=-1);xe.value=e.name,we.value=null!==(l=null==e?void 0:e.encounter_type_id)&&void 0!==l?l:-1;const n=ke.value.findIndex(e=>{var l;return(null==e?void 0:e.encounterTypeID)===we.value||(null!==(l=e.otherWorkflowNames)&&void 0!==l?l:[]).includes(xe.value)});if(-1!==n){Ie.value=e.description;const l=[...ke.value.slice(n),...ke.value.slice(0,n)];ke.value=l,me.value=0}else be.value=xe.value?`"${xe.value}" is not available in the current workflow. Contact your administrator or update ART activity selection`:"No next task found",me.value=n}catch(n){be.value="An error has occured while loading next task: "+n,console.error(n)}finally{await async function(){const e=await X.getEncounters(te.value.patientID,{date:ie.getSessionDate()});he.value=e.map(e=>e.encounter_type)}(),_e.value=!1}}async function Te(){me.value=-1,ke.value=[];try{const e=Z.map(async e=>{if(("function"!=typeof e.disabled||!e.disabled(Z))&&e.workflowID&&e.component&&await ae(e.workflowID)&&await oe(e.workflowID))return e});ke.value=(await Promise.all(e)).filter(e=>void 0!==e),async function(){if(await q.isProp(`${Q.FILING_NUMBERS}=true`)){if(pe.patient=await H.findByID(te.value.patientID),!/n\/a/i.test(pe.getFilingNumber()))return;ee(ne,{},!1,{title:"New filing number assignment",useComponent:le,onClose:()=>{U.dismiss()}})}}()}catch(e){O("Unable to load activities"),console.error(e)}}function Be(){(function(){if(De.value){if(!Ce.value)return void O("BDE Provider component is not available");if(!Ce.value.isProviderSelected())return O("Please select a provider"),void Ce.value.openModal()}return ge.value&&"function"==typeof ge.value.onSubmit?ge.value.onSubmit():Promise.resolve(!0)})().then(e=>e&&Ne())}return u(()=>l.fullPath,()=>{Te().then(Ne)},{immediate:!0,deep:!0}),(e,l)=>(s(),r(v(M),null,{default:c(()=>[d(J),d(v(f),{style:{"margin-top":"70px"},when:"xs",contentId:"main"},{default:c(()=>{var e;return[d(v(y),{contentId:"main"},{default:c(()=>[d(v(m),null,{default:c(()=>[ke.value.length>0?(s(),r(v(k),{key:0},{default:c(()=>[(s(!0),g(h,null,_(ke.value,(e,l)=>(s(),r(v(w),{onClick:e=>function(e){if(e<0||e>=ke.value.length)return;const l=ke.value[e];l&&Pe(l)&&(me.value=e)}(l),lines:"none",key:l,disabled:!Pe(e),button:""},{default:c(()=>{return[(l=e,he.value.includes(null!==(n=null==l?void 0:l.encounterTypeID)&&void 0!==n?n:0)?(s(),r(v(x),{key:0,icon:v(b),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):Pe(e)?(s(),r(v(x),{key:2,icon:v(D),style:{padding:"10px",color:"green"},slot:"start"},null,8,["icon"])):(s(),r(v(x),{key:1,icon:v(I),style:{padding:"10px"},slot:"start"},null,8,["icon"]))),p("b",null,C(e.name),1)];var l,n}),_:2},1032,["onClick","disabled"]))),128))]),_:1})):(s(),g("div",ue,[d(v(x),{style:{"font-size":"2rem"},icon:v(P)},null,8,["icon"]),l[2]||(l[2]=p("h4",null,"You are not assigned to any activities",-1))]))]),_:1}),d(v(S),null,{default:c(()=>[d(v(N),{color:"light"},{default:c(()=>[d(v(T),{onClick:l[0]||(l[0]=e=>v(ye).back())},{default:c(()=>[d(v(x),{icon:v($),slot:"start"},null,8,["icon"]),l[3]||(l[3]=B(" Back to dashboard "))]),_:1,__:[3]})]),_:1})]),_:1})]),_:1}),p("div",re,[_e.value?(s(),g("div",se,[p("div",ce,[d(v(j),{name:"bubbles"}),l[4]||(l[4]=p("p",null,[p("h1",null,"Please wait...")],-1))])])):null!==(e=ke.value[me.value])&&void 0!==e&&e.component?(s(),g("div",de,[d(v(E),null,{default:c(()=>[d(v(z),null,{default:c(()=>{var e;return[De.value?(s(),r(K,{key:0,ref_key:"bdeProviderComponent",ref:Ce},null,512)):A("",!0),(s(),r(R,null,[(s(),r(W(null===(e=ke.value[me.value])||void 0===e?void 0:e.component),{ref_key:"formRef",ref:ge},null,512))],1024))]}),_:1})]),_:1})])):(s(),g("div",ve,[d(v(x),{style:{color:"green","font-size":"80px"},icon:v(F)},null,8,["icon"]),p("h2",fe,C(be.value),1),d(v(T),{size:"large",fill:"clear",onClick:l[1]||(l[1]=e=>v(ye).back())},{default:c(()=>[d(v(x),{slot:"start",icon:v(G)},null,8,["icon"]),l[5]||(l[5]=B(" Exit page "))]),_:1,__:[5]})])),d(v(S),null,{default:c(()=>[d(v(N),{color:"light"},{default:c(()=>[Se()?(s(),r(v(T),{key:0,onClick:Be,color:"primary",style:{padding:"4px"},slot:"end"},{default:c(()=>[l[6]||(l[6]=B(" Save and continue ")),d(v(x),{style:{padding:"4px"},icon:v(L),slot:"end"},null,8,["icon"])]),_:1,__:[6]})):A("",!0)]),_:1})]),_:1})])]}),_:1})]),_:1}))}}),[["__scopeId","data-v-f9671703"]]))}}});

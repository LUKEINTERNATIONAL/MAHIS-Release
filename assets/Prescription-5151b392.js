import{S as D,_ as N}from"./index-e9c24b53.js";import{d as w,e6 as A,K as $,E as u,e as l,f as d,j as n,l as c,i as f,v as b,z as p,F as m,J as g,y as M,A as y,B as s,p as I,cL as F}from"./vendor-65256339.js";import"./lodash-7be49fbd.js";import"./apexcharts-583f3fdc.js";import"./chartjs-bbe0813a.js";import"./barcode-qrcode-reader-d9469be9.js";class q extends D{constructor(){super()}static getAllArvRegimens(){return this.getJson("programs/".concat(this.getProgramID(),"/all_arv_regimens"))}static getRegimens(t){return this.getJson("programs/".concat(this.getProgramID(),"/regimens"),{patient_id:t})}static getCustomIngridients(){return this.getJson("programs/".concat(this.getProgramID(),"/custom_regimen_ingredients"))}static getCurrentRegimen(t,o=this.getSessionDate()){return this.getJson("programs/".concat(this.getProgramID(),"/").concat(t),{date:o})}}const U=w({name:"Prescription",setup(){return{arvRegimens:[]}},data(){return{accordionState:{allergySection:!1,medicationSection:!0,arvRegimensSection:!1,nextVisitSection:!1},chevronUp:A,chevronDown:$,route:"",patientInfo:{age:"34 Years",gender:"F",currentRegimen:"N/A",currentWeight:"60 Kg(s)",reasonForChange:"N/A",patientId:1},arvRegimens:[],medicationOptions:[{id:"arvs",label:"ARVs",selected:!1},{id:"cpt",label:"CPT",selected:!1},{id:"3hp",label:"3HP (RFP + INH)",selected:!1},{id:"inh300",label:"INH 300 / RFP 300 (3HP)",selected:!1},{id:"ipt",label:"IPT",selected:!1},{id:"none",label:"None",selected:!1}],selectedRegimens:[],customRegimen:!1,allergyOption:"",Intervaloptions:[{label:"1 month",value:"1"},{label:"2 months",value:"2"},{label:"3 months",value:"3"}],allergyOptions:[{label:"Yes",value:"Yes"},{label:"No",value:"No"},{label:"Unknown",value:"Unknown"}],months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],selectedMedications:[{drugName:"AZT 300 / 3TC 150",units:"tabs",am:1,noon:0,pm:1,frequency:"Daily (QOD)"}],nextVisitInterval:"1",medicationRunOutDate:"",estimatedPacks:[{name:"AZT 300 / 3TC 150",quantity:1},{name:"EFV 400",quantity:1}],formData:{selectedRegimen:""}}},methods:{toggleAccordion(e){this.accordionState[e]=!this.accordionState[e]},formatLabel(e){return e.split(/(?=[A-Z])/).join(" ")},toggleRegimen(e){const t=this.selectedRegimens.indexOf(e);t===-1?(this.selectedRegimens.push(e),this.addMedicationForRegimen(e)):(this.selectedRegimens.splice(t,1),this.removeMedicationByDrugId(e))},allergyChange(e){this.allergyOption=e.detail.value},nextVisitIntervalChange(e){const t=new Date,o=new Date(t.setMonth(t.getMonth()+parseInt(e.detail.value)));this.nextVisitInterval=e.detail.value;const a=String(o.getDate()).padStart(2,"0"),h=this.months[o.getMonth()],_=o.getFullYear();this.medicationRunOutDate="".concat(a,"-").concat(h,"-").concat(_),this.updateEstimatedPacks()},async savePrescription(){try{console.log("Saving prescription data:",{allergyOption:this.allergyOption,selectedRegimens:this.selectedRegimens,selectedMedications:this.selectedMedications,nextVisitInterval:this.nextVisitInterval}),alert("Prescription saved successfully")}catch(e){console.error("Error saving prescription:",e),alert("Failed to save prescription")}},updateSelectedMedications(){this.selectedMedications=[],this.medicationOptions.find(e=>e.id==="arvs"&&e.selected)&&this.selectedRegimens.forEach(e=>{this.addMedicationForRegimen(e)}),this.medicationOptions.find(e=>e.id==="cpt"&&e.selected)&&this.selectedMedications.push({drugName:"Cotrimoxazole 960mg",units:"tabs",am:1,noon:0,pm:0,frequency:"Daily"}),this.medicationOptions.find(e=>e.id==="3hp"&&e.selected)&&this.selectedMedications.push({drugName:"3HP (RFP + INH)",units:"tabs",am:1,noon:0,pm:0,frequency:"Weekly"}),this.medicationOptions.find(e=>e.id==="inh300"&&e.selected)&&this.selectedMedications.push({drugName:"INH 300 / RFP 300 (3HP)",units:"tabs",am:1,noon:0,pm:0,frequency:"Weekly"}),this.medicationOptions.find(e=>e.id==="ipt"&&e.selected)&&this.selectedMedications.push({drugName:"Isoniazid Preventive Therapy",units:"tabs",am:1,noon:0,pm:0,frequency:"Daily"}),this.updateEstimatedPacks()},addMedicationForRegimen(e){const t=this.arvRegimens.find(a=>a.drug_id===e);if(!t)return;this.selectedMedications.findIndex(a=>a.drugName===t.drug_name.drug_name)===-1&&(this.selectedMedications.push({drugName:t.drug_name.drug_name,units:t.drug_name.units,am:t.drug_name.am,noon:t.drug_name.noon,pm:t.drug_name.pm,frequency:t.drug_name.frequency}),this.updateEstimatedPacks())},removeMedication(e){const t=this.selectedMedications[e].drugName,o=this.arvRegimens.find(a=>a.drug_name.drug_name===t);if(o){const a=this.selectedRegimens.indexOf(o.drug_id);a!==-1&&this.selectedRegimens.splice(a,1)}this.selectedMedications.splice(e,1),this.updateEstimatedPacks()},removeMedicationByDrugId(e){const t=this.arvRegimens.find(a=>a.drug_id===e);if(!t)return;const o=this.selectedMedications.findIndex(a=>a.drugName===t.drug_name.drug_name);o!==-1&&(this.selectedMedications.splice(o,1),this.updateEstimatedPacks())},toggleMedication(e){if(this.medicationOptions[e].selected=!this.medicationOptions[e].selected,this.medicationOptions[e].id==="none"&&this.medicationOptions[e].selected)this.medicationOptions.forEach((t,o)=>{o!==e&&(this.medicationOptions[o].selected=!1)}),this.selectedRegimens=[],this.selectedMedications=[];else if(this.medicationOptions[e].id!=="none"&&this.medicationOptions[e].selected){const t=this.medicationOptions.findIndex(o=>o.id==="none");t>=0&&(this.medicationOptions[t].selected=!1)}this.updateSelectedMedications()},updateEstimatedPacks(){const e=parseInt(this.nextVisitInterval);this.estimatedPacks=this.selectedMedications.map(t=>({name:t.drugName,quantity:Math.ceil((t.am+t.noon+t.pm)*30*e/60)}))}},watch:{nextVisitInterval:{handler(){this.updateEstimatedPacks()}},medicationOptions:{handler(){this.updateSelectedMedications()},deep:!0}},async mounted(){const e=await q.getRegimens(this.patientInfo.patientId);for(const[_,v]of Object.entries(e))this.arvRegimens.push({drug_id:_,drug_name:v[0]});const t=new Date,o=String(t.getDate()).padStart(2,"0"),a=this.months[t.getMonth()],h=t.getFullYear();this.medicationRunOutDate="".concat(o,"-").concat(a,"-").concat(h)}});const E={class:"prescription-container"},H={class:"accordion-section"},J={class:"expand-btn"},T={class:"accordion-content"},z={class:"allergy-section"},B={class:"accordion-section"},W={class:"expand-btn"},Y={class:"accordion-content"},j={class:"medication-options"},L={class:"option-grid"},Z={class:"checkbox-option"},K={class:"checkbox-text"},G={class:"checkbox-option"},Q={class:"checkbox-text"},X={class:"accordion-section"},x={class:"expand-btn"},ee={class:"accordion-content"},te={class:"patient-info"},ne={class:"info-item"},ie={class:"info-value"},se={class:"info-item"},oe={class:"info-value"},ae={class:"info-item"},le={class:"info-value"},de={class:"info-item"},ce={class:"info-value"},re={class:"info-item"},ue={class:"info-value"},me={class:"regimen-grid"},ge=["onClick"],pe={class:"regimen-id"},ve={class:"regimen-name"},he=["onClick"],_e={class:"regimen-id"},fe={class:"regimen-name"},be={class:"custom-regimen"},ye={class:"selected-medication-section"},Re={class:"medication-table"},Ie={class:"row-cell drug-name"},ke={class:"row-cell units"},Se={class:"row-cell am"},Me={class:"row-cell noon"},Ve={class:"row-cell pm"},Oe={class:"row-cell frequency"},Pe={class:"row-cell action"},Ce=["onClick"],De={class:"accordion-section"},Ne={class:"expand-btn"},we={class:"accordion-content"},Ae={class:"next-visit-interval"},$e={class:"medication-run-out"},Fe={class:"estimated-packs"},qe={class:"pack-name"},Ue={class:"pack-quantity"},Ee={class:"save-section"};function He(e,t,o,a,h,_){const v=u("ion-icon"),k=u("ion-label"),V=u("ion-radio"),S=u("ion-item"),O=u("ion-radio-group"),R=u("ion-checkbox"),P=u("ion-select-option"),C=u("ion-select");return l(),d("div",E,[t[25]||(t[25]=n("div",{class:"header"},[n("h2",null,"Prescription")],-1)),n("div",H,[n("div",{class:"accordion-header",onClick:t[0]||(t[0]=i=>e.toggleAccordion("allergySection"))},[t[8]||(t[8]=n("h3",null,"Allergy Information",-1)),n("button",J,[c(v,{icon:e.accordionState.allergySection?e.chevronUp:e.chevronDown},null,8,["icon"])])]),f(n("div",T,[n("div",z,[t[10]||(t[10]=n("div",{class:"allergy-label"},"Allergic to cotrimoxazole",-1)),c(O,{modelValue:e.allergyOption,"onUpdate:modelValue":t[1]||(t[1]=i=>e.allergyOption=i),onIonChange:e.allergyChange,class:"horizontal-options"},{default:p(()=>[(l(!0),d(m,null,g(e.allergyOptions,i=>(l(),M(S,{key:i.value,class:"horizontal-item"},{default:p(()=>[c(k,null,{default:p(()=>[y(s(i.label),1)]),_:2},1024),t[9]||(t[9]=y(" Â ")),c(V,{slot:"end",value:i.value},null,8,["value"])]),_:2,__:[9]},1024))),128))]),_:1},8,["modelValue","onIonChange"])])],512),[[b,e.accordionState.allergySection]])]),n("div",B,[n("div",{class:"accordion-header",onClick:t[2]||(t[2]=i=>e.toggleAccordion("medicationSection"))},[t[11]||(t[11]=n("h3",null,"Medication to prescribe during this visit",-1)),n("button",W,[c(v,{icon:e.accordionState.medicationSection?e.chevronUp:e.chevronDown},null,8,["icon"])])]),f(n("div",Y,[n("div",j,[n("div",L,[(l(!0),d(m,null,g(e.medicationOptions.slice(0,3),i=>(l(),d("div",{key:i.id,class:"option-item"},[n("label",Z,[c(R,{modelValue:i.selected,"onUpdate:modelValue":r=>i.selected=r},null,8,["modelValue","onUpdate:modelValue"]),n("span",K,s(i.label),1)])]))),128)),(l(!0),d(m,null,g(e.medicationOptions.slice(3),i=>(l(),d("div",{key:i.id,class:"option-item"},[n("label",G,[c(R,{modelValue:i.selected,"onUpdate:modelValue":r=>i.selected=r},null,8,["modelValue","onUpdate:modelValue"]),n("span",Q,s(i.label),1)])]))),128))])])],512),[[b,e.accordionState.medicationSection]])]),n("div",X,[n("div",{class:"accordion-header",onClick:t[3]||(t[3]=i=>e.toggleAccordion("arvRegimensSection"))},[t[12]||(t[12]=n("h3",null,"ARV Regimens",-1)),n("button",x,[c(v,{icon:e.accordionState.arvRegimensSection?e.chevronUp:e.chevronDown},null,8,["icon"])])]),f(n("div",ee,[n("div",te,[n("div",ne,[t[13]||(t[13]=n("span",{class:"info-label"},"Age:",-1)),n("span",ie,s(e.patientInfo.age),1)]),n("div",se,[t[14]||(t[14]=n("span",{class:"info-label"},"Gender:",-1)),n("span",oe,s(e.patientInfo.gender),1)]),n("div",ae,[t[15]||(t[15]=n("span",{class:"info-label"},"Current Regimen:",-1)),n("span",le,s(e.patientInfo.currentRegimen),1)]),n("div",de,[t[16]||(t[16]=n("span",{class:"info-label"},"Current Weight:",-1)),n("span",ce,s(e.patientInfo.currentWeight),1)]),n("div",re,[t[17]||(t[17]=n("span",{class:"info-label"},"Reason for change:",-1)),n("span",ue,s(e.patientInfo.reasonForChange),1)])]),n("div",me,[(l(!0),d(m,null,g(e.arvRegimens.slice(0,5),i=>(l(),d("div",{key:i.drug_id,class:I(["regimen-item",{selected:e.selectedRegimens.includes(i.drug_id)}]),onClick:r=>e.toggleRegimen(i.drug_id)},[n("span",pe,s(i.drug_id),1),n("span",ve,s(i.drug_name.drug_name),1)],10,ge))),128)),(l(!0),d(m,null,g(e.arvRegimens.slice(5),i=>(l(),d("div",{key:i.drug_id,class:I(["regimen-item",{selected:e.selectedRegimens.includes(i.drug_id)}]),onClick:r=>e.toggleRegimen(i.drug_id)},[n("span",_e,s(i.drug_id),1),n("span",fe,s(i.drug_name.drug_name),1)],10,he))),128))]),n("div",be,[t[18]||(t[18]=n("span",null,"Set custom regimen",-1)),c(R,{modelValue:e.customRegimen,"onUpdate:modelValue":t[4]||(t[4]=i=>e.customRegimen=i)},null,8,["modelValue"])]),n("div",ye,[t[20]||(t[20]=n("h3",null,"Selected medication",-1)),n("div",Re,[t[19]||(t[19]=F('<div class="table-header" data-v-10a64b84><div class="header-cell drug-name" data-v-10a64b84>Drug name</div><div class="header-cell units" data-v-10a64b84>Units</div><div class="header-cell am" data-v-10a64b84>AM</div><div class="header-cell noon" data-v-10a64b84>Noon</div><div class="header-cell pm" data-v-10a64b84>PM</div><div class="header-cell frequency" data-v-10a64b84>Frequency</div><div class="header-cell action" data-v-10a64b84>Action</div></div>',1)),(l(!0),d(m,null,g(e.selectedMedications,(i,r)=>(l(),d("div",{key:r,class:I(["table-row",{highlighted:r===0}])},[n("div",Ie,s(i.drugName),1),n("div",ke,s(i.units),1),n("div",Se,s(i.am),1),n("div",Me,s(i.noon),1),n("div",Ve,s(i.pm),1),n("div",Oe,s(i.frequency),1),n("div",Pe,[n("button",{onClick:Je=>e.removeMedication(r),class:"remove-btn"},"Remove",8,Ce)])],2))),128))])])],512),[[b,e.accordionState.arvRegimensSection]])]),n("div",De,[n("div",{class:"accordion-header",onClick:t[5]||(t[5]=i=>e.toggleAccordion("nextVisitSection"))},[t[21]||(t[21]=n("h3",null,"Next Visit Information",-1)),n("button",Ne,[c(v,{icon:e.accordionState.nextVisitSection?e.chevronUp:e.chevronDown},null,8,["icon"])])]),f(n("div",we,[n("div",Ae,[c(S,null,{default:p(()=>[c(k,{position:"stacked"},{default:p(()=>t[22]||(t[22]=[y("Interval to next visit "),n("span",{class:"required"},"*",-1)])),_:1,__:[22]}),c(C,{modelValue:e.nextVisitInterval,"onUpdate:modelValue":t[6]||(t[6]=i=>e.nextVisitInterval=i),interface:"popover",onIonChange:e.nextVisitIntervalChange},{default:p(()=>[(l(!0),d(m,null,g(e.Intervaloptions,i=>(l(),M(P,{key:i.value,value:i.value},{default:p(()=>[y(s(i.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","onIonChange"])]),_:1})]),n("div",$e,[t[23]||(t[23]=n("label",null,"Medication run out date:",-1)),n("span",null,s(e.medicationRunOutDate),1)]),n("div",Fe,[t[24]||(t[24]=n("h4",null,"Estimated packs/tins:",-1)),(l(!0),d(m,null,g(e.estimatedPacks,(i,r)=>(l(),d("div",{key:r,class:"pack-item"},[n("span",qe,s(i.name),1),n("div",Ue,s(i.quantity),1)]))),128))])],512),[[b,e.accordionState.nextVisitSection]])]),n("div",Ee,[n("button",{class:"save-btn",onClick:t[7]||(t[7]=(...i)=>e.savePrescription&&e.savePrescription(...i))},"Save")])])}const Le=N(U,[["render",He],["__scopeId","data-v-10a64b84"]]);export{Le as default};

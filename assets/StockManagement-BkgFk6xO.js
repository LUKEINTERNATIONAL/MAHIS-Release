import{d as R,al as I,ar as jt,U as W,T as G,am as Ft,an as Lt,G as Ot,S as Q,ao as K,X as z,aD as Ut,ap as Ht,ai as Y,E as i,e as x,f as u,l as a,z as s,A as n,B as _,k as p,F as X,R as st,aq as Rt,W as ot,cw as nt,cx as it,cy as dt,I as rt,ag as lt,ab as ct,ac as ut,au as pt,bj as mt,r as ht,cb as _t,bm as ft,cc as yt,cd as gt,ce as kt,cf as vt,cg as wt,ch as Dt,ci as bt,cj as St,ck as xt,y as B,m as S,L as It,p as Bt}from"./vendor-IHO26Iap.js";import{w as J,B as Z,e as Wt,x as h,y as f,H as v,t as k,k as A,n as E,u as Gt,i as V,_ as tt,z as Ct,T as Pt,a as Mt,g as H,A as $t,C as qt,b as Tt}from"./index-tZ4yxjbt.js";import{I as Nt,a as Vt}from"./ImmunizationGroupGraph-Cfv32ce0.js";import{u as j}from"./StockStore-BwuSKYob.js";import{P as Qt}from"./previousVitals-ngsvXVI4.js";import{_ as Kt}from"./customDatePicker.vue_vue_type_style_index_0_lang-Bg-oewZ2.js";import{v as F}from"./group_validation-CN0eO-Fs.js";import{S as P}from"./stock_service-BS1leb3X.js";import{D as Yt}from"./drug_service-DcuEfQyA.js";import{l as zt}from"./lodash-Dt8AsbQm.js";import"./apexcharts-BRNTdOtj.js";import"./SvgDynamicColor-CDoNG9EN.js";const Xt=R({components:{IonContent:K,IonHeader:Q,IonItem:Ot,IonList:Lt,IonMenu:Ft,IonTitle:G,IonToolbar:W,IonInput:jt,BasicInputField:Wt,BasicForm:Z,PreviousVitals:Qt,customDatePicker:Kt,DynamicButton:J},data(){return{iconsContent:V,BMI:{},BPStatus:{},vValidations:"",title:"",relationships:"",hasValidationErrors:[],vitalsInstance:{},validationStatus:{heightWeight:!1,bloodPressure:!1},showPD:!1,stockService:{}}},computed:{...I(Gt,["patient"]),...I(j,["stock"])},props:{data:{default:{}}},created(){this.stockService=new P},async mounted(){this.resetData(),this.data?(this.modifyFieldValue(),this.title="Edit Stock"):this.title="Add Stock",await this.getDrugs()},setup(){return{checkmark:Y,pulseOutline:Ht}},methods:{modifyFieldValue(){h(this.stock,"product name","value",{id:"",name:this.data.drug_legacy_name}),h(this.stock,"batch","value",this.data.batch_number),h(this.stock,"manufacture","value",this.data.manufacture),h(this.stock,"doses_wasted","value",this.data.doses_wasted),h(this.stock,"expire date","value",this.data.expiry_date),h(this.stock,"quantity","value",this.data.delivered_quantity),h(this.stock,"delivery_date","value",this.data.delivery_date),h(this.stock,"product name","disabled","true"),h(this.stock,"batch","disabled","true"),h(this.stock,"manufacture","disabled","true"),h(this.stock,"expire date","disabled","true"),h(this.stock,"quantity","disabled","true"),h(this.stock,"delivery_date","disabled","true")},async handleBatch(){this.data?await this.updateBatch():await this.createBatch(),E().postData("SYNC_STOCK_RECORD")},async createBatch(){if(F(this.stock)){const t=f(this.stock,"product name","value").drug_id,o=[{batch_number:f(this.stock,"batch","value"),location_id:"",vvm_stage:"",items:[{barcode:"",drug_id:t,expiry_date:f(this.stock,"expire date","value"),manufacture:f(this.stock,"manufacture","value"),quantity:f(this.stock,"quantity","value"),delivery_date:f(this.stock,"delivery_date","value")||v.sessionDate(),product_code:"",pack_size:""}]}],d=await this.stockService.postItems(o);await this.handleWaste(d[0].items[0].id),A("Batch save successfully"),z.dismiss("dismiss")}else return k("Batch not save"),!1},async updateBatch(){const t=parseInt(f(this.stock,"doses_wasted","value")),e=parseInt(f(this.stock,"quantity","value"));this.data.current_quantity;const o=this.data.dispensed_quantity+this.data.doses_wasted+t;if(e<o)return k("Quantity delivered can not be greater than quantity wasted and dispensed"),!1;if(F(this.stock)){const d={doses_wasted:t,drug_id:f(this.stock,"product name","value").drug_id,reallocation_code:"MA20",waste_reason:"Something wrong with the drug",date:v.sessionDate(),reason:"Mistake Entirely"};try{await this.stockService.updateItem(this.data.id,d),A("Batch save successfully"),z.dismiss("dismiss")}catch(r){k(r)}}else return k("Batch not save"),!1},async handleWaste(t){const e=f(this.stock,"doses_wasted","value");if(e){const o={reallocation_code:"MA20",quantity:e,date:v.sessionDate(),reason:"Something wrong with the drug"};await this.stockService.disposeItems(t,o)}},navigationMenu(t){Ut.close(),this.$router.push(t)},resetData(){const t=j();t.setStock(t.getInitialStock())},async getDrugs(t=""){const e=await Yt.getDrugs({name:t,page:1,page_size:10,concept_set:"Immunizations"});h(this.stock,"product name","multiSelectData",e)},async handleInputData(t){t.inputHeader=="Product Name *"&&await this.getDrugs("")},dismiss(){z.dismiss()}}}),Jt={class:"modal_wrapper"},Zt={class:"ion-padding",slot:"content",style:{"padding-bottom":"200px"}};function te(t,e,o,d,r,m){const M=i("ion-title"),$=i("ion-icon"),q=i("ion-header"),y=i("basic-form"),D=i("ion-content"),c=i("DynamicButton"),g=i("ion-col"),b=i("ion-row"),T=i("ion-footer");return u(),x(X,null,[a(q,{style:{display:"flex","justify-content":"space-between"}},{default:s(()=>[a(M,{class:"modalTitle"},{default:s(()=>[n(_(t.title),1)]),_:1}),a($,{onClick:e[0]||(e[0]=N=>t.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:t.iconsContent.cancel},null,8,["icon"])]),_:1}),a(D,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:s(()=>[p("div",Jt,[p("div",Zt,[p("div",null,[a(y,{contentData:t.stock,"onUpdate:inputValue":t.handleInputData,onSearchChange:t.getDrugs},null,8,["contentData","onUpdate:inputValue","onSearchChange"])])])])]),_:1}),a(T,{collapse:"fade",class:"ion-no-border"},{default:s(()=>[a(b,null,{default:s(()=>[a(g,null,{default:s(()=>[a(c,{onClick:e[1]||(e[1]=N=>t.handleBatch()),name:"Save",fill:"solid",style:{float:"right",margin:"2%",width:"130px"}})]),_:1})]),_:1})]),_:1})],64)}const At=tt(Xt,[["render",te],["__scopeId","data-v-88dde239"]]),et=[{data:{rowData:[{colData:[{inputHeader:"Search",icon:V.search,value:"",name:"search",eventType:"input",alertsErrorMassage:"",selectedID:""}]}]}}],Et=st("searchName",{state:()=>({searchName:[...et]}),actions:{setsearchName(t){this.searchName=t},getInitialName(){return[...zt.cloneDeep(et)]}}}),at=[{data:{rowData:[{colData:[{inputHeader:"Quantity*",icon:V.weight,valueType:"number",value:"",name:"quantity",eventType:"input",alertsErrorMassage:"",required:!0,validationFunctionName:"isNumber"}]}]}},{data:{rowData:[{colData:[{inputHeader:"Reason *",icon:V.search,valueType:"text",isSingleSelect:!0,popOver:!0,value:"",name:"reason",validationFunctionName:"required",trackBy:"id",multiSelectData:[],eventType:"input",required:!0,alertsErrorMassage:"",id:""}]}]}}],U=st("stockDiscard",{state:()=>({stockDiscard:[...at]}),actions:{setStockDiscard(t){this.stockDiscard=t},getInitialStockDiscard(){return[...zt.cloneDeep(at)]}},persist:!0}),ee=R({name:"StockManagementModal",mixins:[Mt],components:{IonContent:K,IonHeader:Q,IonMenuButton:mt,IonPage:pt,IonTitle:G,IonToolbar:W,Toolbar:Pt,ToolbarSearch:Ct,IonRow:ut,IonCol:ct,ImmunizationTrendsGraph:Vt,ImmunizationGroupGraph:Nt,IonCard:lt,DynamicButton:J,BasicForm:Z,IonIcon:rt,IonFab:dt,IonFabButton:it,IonFabList:nt,IonButton:ot,IonPopover:Rt},data(){return{iconsContent:V,reportData:[],currentStock:[],stockData:[],allStock:[],outStock:[],filter:"",startDate:v.sessionDate(),endDate:v.sessionDate(),options:{responsive:!0,select:!0},selectedButton:"all",isLoading:!1,popoverOpen:!1,popoverName:"",event:null,stockService:{},disabled:!1,totalPages:0}},setup(){return{currentPage:ht(1),chevronBackOutline:xt,checkmark:Y,grid:St,chevronDownCircle:bt,chevronForwardCircle:Dt,chevronUpCircle:wt,colorPalette:vt,document:kt,globe:gt,medkit:yt,add:ft,person:_t}},created(){this.stockService=new P},props:{data:{default:{}}},computed:{...I(j,["stock"]),...I(Et,["searchName"]),...I(U,["stockDiscard"]),...I(Tt,["apiStatus"])},$route:{async handler(){await this.buildTableData()},deep:!0},watch:{stock:{async handler(){},deep:!0}},async mounted(){await this.buildTableData()},methods:{checkExpired(t){const e=new Date(t.expiry_date);return!(new Date(v.sessionDate())>=e)},async updateBatch(){const t=parseInt(f(this.stockDiscard,"quantity","value")),e=f(this.stockDiscard,"reason","value").name,o=parseInt(this.stockData.delivered_quantity);this.stockData.current_quantity;const d=this.stockData.dispensed_quantity+this.stockData.doses_wasted+t;if(o<d)return k("Quantity delivered can not be greater than quantity wasted and dispensed"),!1;if(F(this.stockDiscard)){const r={doses_wasted:t,drug_id:this.stockData.drug_id,reallocation_code:"MA20",waste_reason:e,date:v.sessionDate(),reason:e};try{await this.stockService.updateItem(this.stockData.id,r),A("Discard successfully"),await this.buildTableData(),this.closePopover()}catch(m){k(m)}}else return k("Failing to discard"),!1},async adjustStock(){let t=parseInt(f(this.stockDiscard,"quantity","value")),e=f(this.stockDiscard,"reason","value").name;if((e=="Positive Adjustment"||e=="Positive Mathematical Error")&&(t=t),e=="Negative Adjustment"||e=="Negative Mathematical Error"){if(t>this.stockData.current_quantity)return k("Quantity Available can not be greater than adjustment quantity"),!1;t=-t}if(F(this.stockDiscard)){const o={adjust_stock:t,drug_id:this.stockData.drug_id,reallocation_code:"MA20",waste_reason:e,date:v.sessionDate(),reason:e};try{await this.stockService.updateItem(this.stockData.id,o),A("Adjust successfully"),await this.buildTableData(),this.closePopover()}catch(d){k(d)}}else return k("Failing to adjust"),!1},whichPopover(t,e,o){this.popoverName=o,U().setStockDiscard(U().getInitialStockDiscard()),o=="adjust"?h(this.stockDiscard,"reason","multiSelectData",[{id:1,name:"Positive Adjustment"},{id:2,name:"Negative Adjustment"},{id:3,name:"Negative Mathematical Error"},{id:4,name:"Positive Mathematical Error"}]):h(this.stockDiscard,"reason","multiSelectData",[{id:1,name:"VVM stage > 2"},{id:2,name:"Frozen"},{id:3,name:"Damage"},{id:4,name:"Wastage"}]),this.openPopover(t,e)},openPopover(t,e){this.stockData=e,this.event=t,this.popoverOpen=!0},closePopover(){this.event=null,this.popoverOpen=!1},dismiss(){z.dismiss("dismiss")},async onClickHandler(t){await this.buildTableData(t)},formatDate(t){return v.toStandardHisDisplayFormat(t)},async handleInputData(t){t.inputHeader=="Search"&&(this.filter=t.value,await this.buildTableData())},async voidStock(t,e){await qt('Do you want to void "'.concat(e.drug_legacy_name,'", batch: ').concat(e.batch_number," ?"),t,{confirmBtnLabel:"Void"})&&(await new P().deleteItem(e.id,{reason:"voided"}),await this.buildTableData())},async buildTableData(t=1){var e,o,d;this.isLoading=!0,E().postData("SYNC_STOCK_RECORD");try{if(this.apiStatus){const r=new P;this.reportData={records:await r.getItems({start_date:"2000-01-01",end_date:this.endDate,drug_name:this.data.drug_legacy_name,page:t,page_size:4})},(e=this.reportData)!=null&&e.records&&(this.totalPages=(d=(o=this.reportData)==null?void 0:o.records[0])==null?void 0:d.total_count)}else this.reportData=await $t("stock",{whereClause:{drug_legacy_name:this.data.drug_legacy_name},currentPage:this.currentPage,itemsPerPage:4}),this.totalPages=this.reportData.totalCount}catch(r){k("An error occurred while loading data.")}finally{this.isLoading=!1}},async selectButton(t){this.selectedButton=t,await this.buildTableData()},async openAddStockModal(t){await H(At,{class:"fullScreenModal"},!0,{data:t})=="dismiss"&&await this.buildTableData()}}}),ae={key:0,class:"spinner-overlay"},se={class:"container"},oe={style:{width:"70vw",top:"-2px",position:"relative","margin-right":"10px"}},ne={class:"drug_container"},ie={key:0,class:"watermark"},de={key:1,class:"watermark"},re={style:{"font-weight":"700","font-size":"16px",color:"#939393"}},le={key:2},ce={class:"example-one"},ue={style:{"margin-bottom":"160px"}},pe={style:{display:"flex","justify-content":"space-between",padding:"10px"}};function me(t,e,o,d,r,m){const M=i("ion-spinner"),$=i("ion-title"),q=i("ion-icon"),y=i("ion-header"),D=i("basic-form"),c=i("ion-col"),g=i("ion-row"),b=i("ion-button"),T=i("vue-awesome-paginate"),N=i("ion-popover"),L=i("ion-content"),O=i("ion-page");return u(),B(O,{class:Bt({loading:t.isLoading})},{default:s(()=>[t.isLoading?(u(),x("div",ae,[a(M,{name:"bubbles"}),e[6]||(e[6]=p("div",{class:"loading-text"},"Please wait...",-1))])):S("",!0),a(y,{style:{display:"flex","justify-content":"space-between"}},{default:s(()=>[a($,{class:"modalTitle"},{default:s(()=>e[7]||(e[7]=[n("Inventory Management ")])),_:1,__:[7]}),a(q,{onClick:e[0]||(e[0]=l=>t.dismiss()),style:{"padding-top":"10px","padding-right":"10px"},icon:t.iconsContent.cancel},null,8,["icon"])]),_:1}),a(L,{style:{"--background":"#fff"}},{default:s(()=>[p("div",se,[p("div",oe,[a(D,{contentData:t.searchName,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:inputValue"])]),p("div",ne,[(u(!0),x(X,null,It(t.reportData.records,(l,w)=>(u(),x("div",{class:"drug_content",key:w},[t.checkExpired(l)?S("",!0):(u(),x("div",ie,"EXPIRED")),l.current_quantity<=0?(u(),x("div",de,"Stock out")):S("",!0),a(g,{class:"search_header"},{default:s(()=>[a(c,{class:""},{default:s(()=>[p("span",re,_(l.drug_legacy_name),1)]),_:2},1024)]),_:2},1024),a(g,{class:"search_header"},{default:s(()=>[a(c,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:s(()=>e[8]||(e[8]=[n("Batch/Lot Number")])),_:1,__:[8]}),a(c,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:s(()=>[n(_(l.batch_number),1)]),_:2},1024)]),_:2},1024),a(g,{class:"search_header"},{default:s(()=>[a(c,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:s(()=>e[9]||(e[9]=[n("Manufacturer")])),_:1,__:[9]}),a(c,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:s(()=>[n(_(l.manufacture),1)]),_:2},1024)]),_:2},1024),a(g,{class:"search_header"},{default:s(()=>[a(c,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:s(()=>e[10]||(e[10]=[n("Expiration date ")])),_:1,__:[10]}),a(c,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:s(()=>[n(_(t.formatDate(l.expiry_date)),1)]),_:2},1024)]),_:2},1024),a(g,{class:"search_header"},{default:s(()=>[a(c,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:s(()=>e[11]||(e[11]=[n("Date received")])),_:1,__:[11]}),a(c,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:s(()=>[n(_(t.formatDate(l.delivery_date)),1)]),_:2},1024)]),_:2},1024),a(g,{class:"search_header"},{default:s(()=>[a(c,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:s(()=>e[12]||(e[12]=[n("Doses Received")])),_:1,__:[12]}),a(c,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:s(()=>[n(_(l.delivered_quantity),1)]),_:2},1024)]),_:2},1024),a(g,{class:"search_header"},{default:s(()=>[a(c,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:s(()=>e[13]||(e[13]=[n("Doses wasted")])),_:1,__:[13]}),a(c,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:s(()=>[n(_(l.doses_wasted),1)]),_:2},1024)]),_:2},1024),a(g,{class:"search_header"},{default:s(()=>[a(c,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:s(()=>e[14]||(e[14]=[n("Doses Issued")])),_:1,__:[14]}),a(c,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:s(()=>[n(_(l.dispensed_quantity),1)]),_:2},1024)]),_:2},1024),a(g,{class:"search_header"},{default:s(()=>[a(c,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:s(()=>e[15]||(e[15]=[n("Doses Available")])),_:1,__:[15]}),a(c,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:s(()=>[n(_(l.current_quantity),1)]),_:2},1024)]),_:2},1024),t.apiStatus?(u(),x("div",le,[t.checkExpired(l)&&l.current_quantity>0?(u(),B(b,{key:0,size:"small",color:"danger",name:"Discard Stock",style:{"font-size":"12px"},onClick:C=>t.whichPopover(C,l,"discard")},{default:s(()=>e[16]||(e[16]=[n(" Discard Stock ")])),_:2,__:[16]},1032,["onClick"])):(u(),B(b,{key:1,size:"small",color:"danger",name:"Discard Stock",style:{"font-size":"12px"},onClick:C=>t.voidStock(C,l)},{default:s(()=>e[17]||(e[17]=[n(" Void Stock ")])),_:2,__:[17]},1032,["onClick"])),a(b,{color:"success",size:"small",name:"Update Stock",style:{"font-size":"12px"},onClick:C=>t.whichPopover(C,l,"adjust")},{default:s(()=>e[18]||(e[18]=[n("Adjust Stock")])),_:2,__:[18]},1032,["onClick"])])):S("",!0)]))),128))]),p("div",ce,[t.totalPages>0?(u(),B(T,{key:0,"total-items":t.totalPages,"items-per-page":4,"max-pages-shown":2,modelValue:t.currentPage,"onUpdate:modelValue":e[1]||(e[1]=l=>t.currentPage=l),onClick:t.onClickHandler},null,8,["total-items","modelValue","onClick"])):S("",!0)])]),a(N,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!1,event:t.event,onDidDismiss:e[5]||(e[5]=l=>t.popoverOpen=!1)},{default:s(()=>[p("div",ue,[a(D,{contentData:t.stockDiscard,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:inputValue"])]),p("div",pe,[a(b,{size:"small",color:"danger",name:"Discard Stock",style:{"font-size":"14px"},onClick:e[2]||(e[2]=l=>t.closePopover())},{default:s(()=>e[19]||(e[19]=[n("Cancel")])),_:1,__:[19]}),t.popoverName=="adjust"?(u(),B(b,{key:0,color:"success",size:"small",name:"Update Stock",style:{"font-size":"14px"},onClick:e[3]||(e[3]=l=>t.adjustStock())},{default:s(()=>e[20]||(e[20]=[n("Save")])),_:1,__:[20]})):S("",!0),t.popoverName=="discard"?(u(),B(b,{key:1,color:"success",size:"small",name:"Update Stock",style:{"font-size":"14px"},onClick:e[4]||(e[4]=l=>t.updateBatch())},{default:s(()=>e[21]||(e[21]=[n("Save")])),_:1,__:[21]})):S("",!0)])]),_:1},8,["is-open","event"])]),_:1})]),_:1},8,["class"])}const he=tt(ee,[["render",me],["__scopeId","data-v-840df9ed"]]),_e=R({name:"StockManagement",mixins:[Mt],components:{IonContent:K,IonHeader:Q,IonMenuButton:mt,IonPage:pt,IonTitle:G,IonToolbar:W,Toolbar:Pt,ToolbarSearch:Ct,IonRow:ut,IonCol:ct,ImmunizationTrendsGraph:Vt,ImmunizationGroupGraph:Nt,IonCard:lt,DynamicButton:J,BasicForm:Z,IonIcon:rt,IonFab:dt,IonFabButton:it,IonFabList:nt,IonButton:ot},data(){return{reportData:[],currentStock:[],allStock:[],outStock:[],filter:"",startDate:v.sessionDate(),endDate:v.sessionDate(),options:{responsive:!0,select:!0},selectedButton:"all",isLoading:!1,combinedBatches:[],stockData:[],totalPages:0}},setup(){return{currentPage:ht(1),chevronBackOutline:xt,checkmark:Y,grid:St,chevronDownCircle:bt,chevronForwardCircle:Dt,chevronUpCircle:wt,colorPalette:vt,document:kt,globe:gt,medkit:yt,add:ft,person:_t}},computed:{...I(j,["stock"]),...I(E,["workerData"]),...I(Et,["searchName"]),...I(Tt,["apiStatus"])},watch:{stock:{async handler(){},deep:!0},$route:{async handler(t){t.name=="stockManagement"&&await this.updateBuildStockData()},deep:!0}},async mounted(){await this.updateBuildStockData()},methods:{combineDrugBatches(t){const e=t.reduce((o,d)=>{const r=d.drug_legacy_name;return o[r]||(o[r]=[]),o[r].push(d),o},{});return this.combinedBatches=Object.keys(e).map(o=>{const d=e[o];return{drug_legacy_name:o,delivered_quantity:d.reduce((r,m)=>r+m.delivered_quantity,0),current_quantity:d.reduce((r,m)=>r+m.current_quantity,0),dispensed_quantity:d.reduce((r,m)=>r+m.dispensed_quantity,0),doses_wasted:d.reduce((r,m)=>r+m.doses_wasted,0)}}),this.combinedBatches},async onClickHandler(t){await this.buildTableData(t)},formatDate(t){return v.toStandardHisDisplayFormat(t)},async handleInputData(t){t.inputHeader=="Search"&&(this.filter=t.value,await this.buildTableData())},async discardStock(t,e){await qt('Do you want to void "'.concat(e.drug_legacy_name,'", batch: ').concat(e.batch_number," ?"),t,{confirmBtnLabel:"Void"})&&(await new P().deleteItem(e.id,{reason:"voided"}),await this.buildTableData())},async updateBuildStockData(){E().postData("SYNC_STOCK_RECORD"),this.buildTableData()},async buildTableData(t=1){var e,o,d,r;this.isLoading=!0;try{if(this.apiStatus){const m=new P;this.reportData={items:await m.getItems({start_date:"2000-01-01",end_date:this.endDate,drug_name:this.filter,page:t,page_size:4,display_details:"true"})},(e=this.reportData)!=null&&e.items&&(this.totalPages=(d=(o=this.reportData)==null?void 0:o.items[0])==null?void 0:d.total_count)}else this.stockData=await $t("stock"),this.reportData=this.paginateArray(this.combineDrugBatches(this.stockData),this.currentPage),this.totalPages=(r=this.combinedBatches)==null?void 0:r.length}catch(m){k("An error occurred while loading data.")}finally{this.isLoading=!1}},paginateArray(t,e){if(!Array.isArray(t))throw new Error("Input must be an array");const o=Math.max(1,Number(e)||1),d=(o-1)*4,r=d+4,m=t.slice(d,r);return{currentPage:o,totalPages:Math.ceil(t.length/4),totalItems:t.length,items:m}},async selectButton(t){this.selectedButton=t,await this.buildTableData()},async openMoreDetailsModal(t){await H(he,{class:"fullScreenModal"},!0,{data:t})=="dismiss"&&await this.buildTableData()},async openAddStockModal(t){await H(At,{class:"fullScreenModal"},!0,{data:t})=="dismiss"&&await this.buildTableData()}}}),fe={key:0,class:"spinner-overlay"},ye={class:"container"},ge={style:{width:"80vw",top:"-10px",position:"relative","margin-right":"10px"}},ke={class:"drug_container"},ve={style:{"font-weight":"700","font-size":"16px",color:"#939393"}},we={class:"example-one"};function De(t,e,o,d,r,m){const M=i("ion-spinner"),$=i("Toolbar"),q=i("basic-form"),y=i("ion-col"),D=i("ion-row"),c=i("ion-button"),g=i("vue-awesome-paginate"),b=i("ion-icon"),T=i("ion-fab-button"),N=i("ion-fab"),L=i("ion-content"),O=i("ion-page");return u(),B(O,{class:Bt({loading:t.isLoading}),"keep-alive":!1},{default:s(()=>[t.isLoading?(u(),x("div",fe,[a(M,{name:"bubbles"}),e[2]||(e[2]=p("div",{class:"loading-text"},"Please wait...",-1))])):S("",!0),a($),a(L,{style:{"--background":"#fff"}},{default:s(()=>{var l;return[p("div",ye,[e[8]||(e[8]=p("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Inventory Management",-1)),p("div",ge,[a(q,{contentData:t.searchName,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:inputValue"])]),p("div",ke,[(u(!0),x(X,null,It((l=t.reportData)==null?void 0:l.items,(w,C)=>(u(),x("div",{class:"drug_content",key:C},[a(D,{class:"search_header"},{default:s(()=>[a(y,{class:""},{default:s(()=>[p("span",ve,_(w.drug_legacy_name),1)]),_:2},1024)]),_:2},1024),a(D,{class:"search_header"},{default:s(()=>[a(y,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:s(()=>e[3]||(e[3]=[n("Doses Received")])),_:1,__:[3]}),a(y,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:s(()=>[n(_(w.delivered_quantity),1)]),_:2},1024)]),_:2},1024),a(D,{class:"search_header"},{default:s(()=>[a(y,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:s(()=>e[4]||(e[4]=[n("Doses wasted")])),_:1,__:[4]}),a(y,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:s(()=>[n(_(w.doses_wasted),1)]),_:2},1024)]),_:2},1024),a(D,{class:"search_header"},{default:s(()=>[a(y,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:s(()=>e[5]||(e[5]=[n("Doses Issued")])),_:1,__:[5]}),a(y,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:s(()=>[n(_(w.dispensed_quantity),1)]),_:2},1024)]),_:2},1024),a(D,{class:"search_header"},{default:s(()=>[a(y,{style:{"max-width":"188px","min-width":"150px"},class:"contentBold"},{default:s(()=>e[6]||(e[6]=[n("Doses Available")])),_:1,__:[6]}),a(y,{style:{"max-width":"188px","min-width":"100px"},class:"content"},{default:s(()=>[n(_(w.current_quantity),1)]),_:2},1024)]),_:2},1024),p("div",null,[a(c,{color:"success",size:"small",name:"Update Stock",style:{"font-size":"12px"},onClick:be=>t.openMoreDetailsModal(w)},{default:s(()=>e[7]||(e[7]=[n(" More Stock Details ")])),_:2,__:[7]},1032,["onClick"])])]))),128))]),p("div",we,[t.totalPages>0?(u(),B(g,{key:0,"total-items":t.totalPages,"items-per-page":4,"max-pages-shown":2,modelValue:t.currentPage,"onUpdate:modelValue":e[0]||(e[0]=w=>t.currentPage=w),onClick:t.onClickHandler},null,8,["total-items","modelValue","onClick"])):S("",!0)])]),t.apiStatus?(u(),B(N,{key:0,slot:"fixed",vertical:"bottom",horizontal:"end",onClick:e[1]||(e[1]=w=>t.openAddStockModal(""))},{default:s(()=>[a(T,{color:"primary"},{default:s(()=>[a(b,{icon:t.add},null,8,["icon"])]),_:1})]),_:1})):S("",!0)]}),_:1})]),_:1},8,["class"])}const ze=tt(_e,[["render",De],["__scopeId","data-v-3da0763e"]]);export{ze as default};

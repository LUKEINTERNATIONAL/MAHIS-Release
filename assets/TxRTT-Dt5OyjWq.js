import{cD as m,cv as p,aE as c,aD as R}from"./index-7qwbP5UI.js";import{a as D}from"./tx_report_service-BfOA-WAF.js";import{l as v}from"./lodash-Dt8AsbQm.js";import{d as T,r as i,y as F,f as y}from"./vendor-8nEYVyB7.js";import"./age_groups-BkW1n_F5.js";const O=T({__name:"TxRTT",setup(A){const d=i("-"),g=i([]),u=i(),r=new D,_=[{path:"ageGroup",label:"Age group"},{path:"gender",label:"Gender",formatter:p},{path:"cd4_less_than_200",label:"CD4 <200",drillable:!0},{path:"cd4_greater_than_or_equal_to_200",label:"CD4 >=200",drillable:!0},{path:"unknown_cd4_count",label:"Unknown CD4",drillable:!0},{path:"not_eligible_for_cd4",label:"Not Eligible for CD4",drillable:!0},{path:"returned_less_than_3_months",label:"Returned <3 mo",drillable:!0},{path:"returned_greater_than_3_months_and_less_than_6_months",label:"Returned 3-5 mo",drillable:!0},{path:"returned_greater_than_or_equal_to_6_months",label:"Returned 6+ mo",drillable:!0}];function h(e){const o={M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}};return e.reduce((a,t)=>{if(t.age_group!=="Unknown"){const n=t.gender;a[n].rows.push({...t,ageGroup:t.age_group}),a[n].aggregate=Object.keys(t).reduce((s,l)=>Array.isArray(t[l])?{...s,[l]:[...s[l]||[],...t[l]]}:s,a[n].aggregate)}return a},o)}function b(e){const o=Object.values(e.F.aggregate).flat(1),a=Object.values(e.M.aggregate).flat(1);u.value=v.uniq([...o,...a])}async function f(e,o=!1){try{await c.show(),r.setStartDate(e.dateRange.startDate),r.setEndDate(e.dateRange.endDate),r.setOccupation(e.occupation),d.value=r.getDateIntervalPeriod();const a=await r.getTxRttReport(o),t=h(a);g.value=[...t.F.rows,...t.M.rows,{ageGroup:"All",gender:"Male",...t.M.aggregate},...await r.buildMaternityAgreggateRows(t.F.aggregate)],b(t)}catch(a){R("ERROR! Unable to load report data"),console.error(a)}await c.hide()}function w(e){return"".concat(e.column.label," | ").concat(e.row.ageGroup," | ").concat(p(e.row.gender),"s")}return(e,o)=>(y(),F(m,{title:"PEPFAR TX RTT Report",subtitle:"Clients that have their clinical dispensation visit falling \n      in the reporting period and there is a difference of 30 or more days \n      between their visit date and their previous appointment date / runout date","report-type":"PEPFAR",columns:_,rows:g.value,period:d.value,"total-clients":u.value,"drill-title":w,useDateRangeFilter:"",showIndices:"",onGenerate:f},null,8,["rows","period","total-clients"]))}});export{O as default};

var St=Object.defineProperty;var kt=(e,t,o)=>t in e?St(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var K=(e,t,o)=>kt(e,typeof t!="symbol"?t+"":t,o);import{d as W,cC as It,ar as et,r as V,c as Y,w as ie,a as pe,e as v,f as r,k as n,m as S,p as ee,B as _,l as a,u as T,ab as tt,A as P,I as G,F as x,L as z,cD as At,c1 as Pt,ay as nt,bA as Nt,bn as Tt,bV as at,b_ as Ot,E as g,z as s,R as Vt,ao as q,cE as st,cF as ot,cG as it,cH as rt,bd as Rt,cI as lt,cJ as Bt,cK as Lt,cL as Mt,cM as Ft,cN as xt,cO as Et,cP as Ut,aa as Wt,bJ as Ht,aq as zt,n as dt,y as R,aZ as We,a_ as ct,a$ as ut,b0 as Pe,aj as Ne,W as $e,ai as Te,U as re,an as Oe,S as ne,ah as ae,by as jt,af as Jt,cQ as Gt,aH as Qt,cR as Yt,cS as qt,a5 as Zt,aG as Xt,cT as pt,aP as fe,b2 as Se,a7 as ke,cU as mt,aL as ht,cV as He,cW as ue,D as he,cX as gt,bg as Kt,br as en,cy as Ve,bo as tn,T as _e,ap as ve,ak as le,G as de,X as Re,a9 as nn,cY as an,cZ as sn,c_ as on,c$ as rn,bw as Be,a8 as ft,d0 as ln,d1 as dn,cn as ze,co as cn,bR as un}from"./vendor-B22qBb2B.js";import{S as E,u as te,_ as H,H as k,A as pn,a as mn,b as _t,c as Fe,P as ye,d as vt,e as hn,f as be,E as Qe,g as gn,t as xe,r as fn,O as _n,h as vn,B as yn,i as Ye,j as je,k as we,l as bn,m as Ie,n as Ae,o as Ee,p as Dn,T as yt,U as bt,q as Cn,s as wn,v as oe,w as qe,x as Ze,y as $n,z as Xe,L as Sn}from"./index-DM7aJ-mj.js";import{m as Dt}from"./apexcharts-B3Xav3Ut.js";import{A as Ct}from"./ncd_appointment_service-6A8aHEmA.js";import{D as Je}from"./DateInputField-CqcSO-mu.js";import{u as kn,M as In,_ as An}from"./ActionButtons.vue_vue_type_script_setup_true_lang-CPWMYkXz.js";import{V as Pn}from"./ViewToggleComponent-DZZXzOaW.js";import{b as Nn}from"./bottomNavBar-DPREYuZb.js";import{C as Tn}from"./chartjs-Bfo1jCM-.js";import{l as ge}from"./lodash-Dt8AsbQm.js";import{B as De}from"./BasicForm-Dzey395D.js";import{B as Le}from"./BasicCard-qvwpLsKP.js";import{u as On}from"./AdministerOtherVaccinesStore-DnTFSfoY.js";import{_ as Vn}from"./customDatePicker.vue_vue_type_style_index_0_lang-BeSkevaP.js";import{s as Rn}from"./vaccines_service-DBjXiT2i.js";import{g as Bn}from"./dashboard_service-CYWI5COW.js";import{i as Ln}from"./Img-CJEgX1Vr.js";import"./sms_service-DCjMbIC4.js";import"./EIRreportsStore-DxICs50C.js";import"./Export-C6G6p4BD.js";class Ke extends E{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(t){return await super.getJson("fhir/patient/".concat(t),{id:t})}static async getFhirObservations(t){return await super.getJson("fhir/patient/".concat(t,"/observations/"),{id:t})}}const Mn={class:"fhir-viewer"},Fn={class:"container"},xn={key:0,class:"main-header"},En={class:"header-line"},Un={key:0,class:"last-updated-display"},Wn={key:1,class:"card initial-input-card"},Hn={class:"action-area-initial"},zn={key:0,class:"card patient-card"},jn={class:"card-title"},Jn={class:"patient-info-grid"},Gn={class:"info-item"},Qn={class:"info-value"},Yn={class:"info-item"},qn={class:"info-value"},Zn={class:"info-item"},Xn={class:"info-value"},Kn={class:"info-item"},ea={class:"info-value"},ta={class:"info-value"},na={class:"info-value"},aa={class:"info-label"},sa={class:"info-value"},oa={key:2,class:"card observations-card"},ia={class:"card-title"},ra={class:"observations-grid"},la={class:"obs-header"},da={class:"obs-title"},ca={class:"obs-details"},ua={class:"obs-detail obs-value-highlight"},pa={class:"obs-value"},ma={class:"obs-detail"},ha={class:"obs-value"},ga={key:0,class:"obs-detail"},fa={class:"obs-value"},_a={key:3,class:"no-data-found"},va={key:4,class:"no-data-found"},ya={key:5,class:"main-footer"},ba=W({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(e){It({"person-circle-outline":Ot,"clipboard-outline":at,"search-outline":Tt,"information-circle-outline":Nt,"alert-circle-outline":nt,"person-add-outline":Pt,"arrow-back-outline":At});const t=e,o=et(),i=V(!1),p=V([]),b=V(),u=V(),l=V(null),m=V([]),d=Y(()=>p.value.some($=>$.resourceType==="Bundle"&&$.entry&&$.entry.some(h=>h.resource&&h.resource.resourceType==="Patient"))),c=Y(()=>m.value.length>0),D=async()=>{if(p.value=[],u.value=null,l.value=null,m.value=[],!b.value){console.error("Please enter a Patient Identifier.");return}i.value=!0;try{const $=await Ke.getFhirPatient(b.value);if($&&$.entry&&$.entry.length>0){const h=$.entry[0].resource,U=h.id,F=await Ke.getFhirObservations(U);p.value=[$],F&&(p.value.push(F),m.value=F.entry.filter(J=>J.resource&&J.resource.resourceType==="Observation").map(J=>{const N=J.resource;return{id:N.id,display:j(N),value:ce(N),date:N.effectiveDateTime,category:N.category&&N.category[0]&&N.category[0].coding&&N.category[0].coding[0]?N.category[0].coding[0].display||N.category[0].coding[0].code:"N/A"}}));const L=h.name&&h.name[0];l.value={personInformation:{given_name:L&&L.given?L.given.join(" "):"",middle_name:L&&L.middle?L.middle.join(" "):"",family_name:L&&L.family?L.family:"",gender:h.gender=="male"?"M":(h==null?void 0:h.gender)=="female"?"F":"",birthdate:h.birthDate||"",cell_phone_number:h.telecom&&h.telecom[0]?h.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:h.contact&&h.contact[0]&&h.contact[0].telecom?h.contact[0].telecom[0].value:""}]}};const A=[$,F].filter(Boolean).reduce((J,N)=>{if(N.meta&&N.meta.lastUpdated){const X=new Date(N.meta.lastUpdated);return J===null||X>J?X:J}return J},null);A&&(u.value=I(A.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch($){console.error("Error loading FHIR data:",$),p.value=[],u.value=null,l.value=null,m.value=[]}finally{i.value=!1}},C=$=>{if($.name&&$.name[0]){const h=$.name[0],U=h.given?h.given.join(" "):"",F=h.family||"";return"".concat(U," ").concat(F).trim()||"N/A"}return"N/A"},y=$=>$.identifier&&$.identifier.length>0?$.identifier.map(h=>{let U="Unknown System";if(h.type&&h.type.coding&&h.type.coding[0]&&h.type.coding[0].display)U=h.type.coding[0].display;else if(h.system){const L=h.system.split("/");U=L[L.length-1]||h.system,h.system==="urn:oid:2.16.840.1.113883.4.6"&&(U="Social Security Number")}sessionStorage.setItem(U,h.value);let F=null;return h.assigner&&h.assigner.display?F=h.assigner.display:h.assigner&&h.assigner.reference&&(F=h.assigner.reference.split("/").pop()||h.assigner.reference),{value:h.value||"N/A",systemDisplay:U,periodStart:h.period?h.period.start:null,periodEnd:h.period?h.period.end:null,assignerDisplay:F}}):[],w=$=>$.telecom&&$.telecom.length>0?$.telecom.filter(h=>h.system==="phone"&&h.value):[],f=$=>{if($.contact&&$.contact.length>0){const h=$.contact.filter(F=>{var L;return(L=F.relationship)==null?void 0:L.some(M=>{var A;return(A=M.coding)==null?void 0:A.some(J=>J.code==="GUARD")})}),U=[];return h.forEach(F=>{F.telecom&&F.telecom.length>0&&F.telecom.filter(L=>L.system==="phone"&&L.value).forEach(L=>U.push(L))}),U}return[]},O=$=>{if(!$)return"N/A";try{return new Date($).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(h){return console.error("Invalid date string for formatDate:",$,h),"Invalid Date"}},I=$=>{if(!$)return"N/A";try{return new Date($).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(h){return console.error("Invalid date time string for formatDateTime:",$,h),"Invalid Date/Time"}},B=$=>{if(!$)return"N/A";try{const h=new Date,U=new Date($);let F=h.getFullYear()-U.getFullYear();const L=h.getMonth()-U.getMonth();return(L<0||L===0&&h.getDate()<U.getDate())&&F--,F}catch(h){return console.error("Invalid birth date string for calculateAge:",$,h),"N/A"}},Q=$=>{if($.meta&&$.meta.tag){const h=$.meta.tag.find(U=>U.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return h?h.code:"Unknown"}return"Unknown"},j=$=>$.code&&$.code.coding&&$.code.coding[0]&&($.code.coding[0].display||$.code.coding[0].code)||"Unknown Observation",ce=$=>$.valueQuantity?"".concat($.valueQuantity.value," ").concat($.valueQuantity.unit||"").trim():$.valueString?$.valueString:$.valueBoolean!==void 0?$.valueBoolean?"True":"False":"N/A",Z=()=>{te().setRecord(l.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(m.value)),$t("/registration/manual")},Ge=()=>{p.value=[],b.value="",u.value=null,l.value=null,m.value=[]},$t=$=>{o.push({path:$})};return ie(()=>o,async()=>{p.value=[],m.value=[]},{deep:!0}),pe(()=>{var $;if(t.initialData.length>0){p.value=t.initialData;const U=t.initialData.filter(Boolean).reduce((M,A)=>{if(A.meta&&A.meta.lastUpdated){const J=new Date(A.meta.lastUpdated);return M===null||J>M?J:M}return M},null);U&&(u.value=I(U.toISOString()));const F=t.initialData.find(M=>M.resourceType==="Bundle"&&M.entry&&M.entry.some(A=>A.resource&&A.resource.resourceType==="Patient"));if(F){const M=($=F.entry.find(A=>A.resource&&A.resource.resourceType==="Patient"))==null?void 0:$.resource;if(M){const A=M.name&&M.name[0];l.value={personInformation:{given_name:A&&A.given?A.given.join(" "):"",middle_name:A&&A.middle?A.middle.join(" "):"",family_name:A&&A.family?A.family:"",gender:M.gender||"",birthdate:M.birthDate||""}}}}const L=t.initialData.find(M=>M.resourceType==="Bundle"&&M.entry&&M.entry.some(A=>A.resource&&A.resource.resourceType==="Observation"));L&&(m.value=L.entry.filter(M=>M.resource&&M.resource.resourceType==="Observation").map(M=>{const A=M.resource;return{id:A.id,display:j(A),value:ce(A),date:A.effectiveDateTime,category:A.category&&A.category[0]&&A.category[0].coding&&A.category[0].coding[0]?A.category[0].coding[0].display||A.category[0].coding[0].code:"N/A"}}))}}),($,h)=>{var U,F,L,M,A,J;return r(),v("div",Mn,[n("div",Fn,[(U=p.value)!=null&&U.length?(r(),v("header",xn,[n("div",En,[h[1]||(h[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:ee(["last-updated-display","status-"+Q(p.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+_(Q(p.value[0].entry[0].resource)),3),u.value?(r(),v("span",Un,"Last Updated: "+_(u.value),1)):S("",!0)])])])):S("",!0),(F=p.value)!=null&&F.length?S("",!0):(r(),v("section",Wn,[a(T(tt),{modelValue:b.value,"onUpdate:modelValue":h[0]||(h[0]=N=>b.value=N),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",Hn,[n("button",{onClick:D,class:"load-data-btn"},[a(T(G),{name:"search-outline"}),h[2]||(h[2]=P(" Find Patient ",-1))])])])),(r(!0),v(x,null,z(p.value,N=>(r(),v("div",{key:N.id},[N.resourceType==="Bundle"&&N.entry&&N.entry[0]&&N.entry[0].resource.resourceType==="Patient"?(r(),v("section",zn,[n("h2",jn,[a(T(G),{name:"person-circle-outline"}),h[3]||(h[3]=P(" Patient Demographics",-1))]),n("div",Jn,[n("div",Gn,[h[4]||(h[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",Qn,_(C(N.entry[0].resource)),1)]),n("div",Yn,[h[5]||(h[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",qn,_(N.entry[0].resource.gender||"Not specified"),1)]),n("div",Zn,[h[6]||(h[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",Xn,_(O(N.entry[0].resource.birthDate)),1)]),n("div",Kn,[h[7]||(h[7]=n("span",{class:"info-label"},"Age",-1)),n("span",ea,_(B(N.entry[0].resource.birthDate))+" years",1)]),w(N.entry[0].resource).length?(r(!0),v(x,{key:0},z(w(N.entry[0].resource),(X,me)=>(r(),v("div",{key:"patient-phone-".concat(me),class:"info-item"},[h[8]||(h[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",ta,_(X.value),1)]))),128)):S("",!0),f(N.entry[0].resource).length?(r(!0),v(x,{key:1},z(f(N.entry[0].resource),(X,me)=>(r(),v("div",{key:"guardian-phone-".concat(me),class:"info-item"},[h[9]||(h[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",na,_(X.value),1)]))),128)):S("",!0),(r(!0),v(x,null,z(y(N.entry[0].resource),(X,me)=>(r(),v("div",{key:X.value||me,class:"info-item"},[n("span",aa,_(X.systemDisplay),1),n("span",sa,_(X.value),1)]))),128))])])):S("",!0)]))),128)),((L=m.value)==null?void 0:L.length)>0?(r(),v("section",oa,[n("h2",ia,[a(T(G),{name:"clipboard-outline"}),h[10]||(h[10]=P(" Clinical Observations",-1))]),n("div",ra,[(r(!0),v(x,null,z(m.value,N=>(r(),v("div",{key:N.id,class:"observation-item"},[n("div",la,[n("h3",da,_(N.display),1)]),n("div",ca,[n("div",ua,[h[11]||(h[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",pa,_(N.value),1)]),n("div",ma,[h[12]||(h[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",ha,_(I(N.date)),1)]),N.category&&N.category!=="N/A"?(r(),v("div",ga,[h[13]||(h[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",fa,_(N.category),1)])):S("",!0)])]))),128))])])):S("",!0),(M=p.value)!=null&&M.length&&!d.value?(r(),v("div",_a,[n("p",null,[a(T(G),{name:"alert-circle-outline"}),h[14]||(h[14]=P(" No patient data found for the provided identifier. Please try again.",-1))])])):(A=p.value)!=null&&A.length&&d.value&&!c.value?(r(),v("div",va,[n("p",null,[a(T(G),{name:"information-circle-outline"}),h[15]||(h[15]=P(" No clinical observations found for this patient.",-1))])])):S("",!0),(J=p.value)!=null&&J.length?(r(),v("footer",ya,[n("button",{onClick:Ge,class:"back-to-search-btn small-btn"},[a(T(G),{name:"arrow-back-outline"}),h[16]||(h[16]=P(" Back to Search ",-1))]),n("button",{onClick:Z,class:"register-btn small-btn"},[a(T(G),{name:"person-add-outline"}),h[17]||(h[17]=P(" Register New Patient ",-1))])])):S("",!0)])])}}}),Da=H(ba,[["__scopeId","data-v-0dc329ef"]]),Ca=W({name:"referrals",components:{ExternalReferrals:Da},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(e){this.segmentContent=e}}}),wa={key:0},$a={style:{display:"flex","margin-top":"10px"}},Sa={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},ka={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},Ia={key:1};function Aa(e,t,o,i,p,b){const u=g("ion-label"),l=g("ion-segment-button"),m=g("ion-segment"),d=g("ExternalReferrals");return r(),v(x,null,[n("div",null,[a(m,{value:e.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:s(()=>[a(l,{value:"External referrals",onClick:t[0]||(t[0]=c=>e.setSegmentContent("External referrals"))},{default:s(()=>[a(u,null,{default:s(()=>t[2]||(t[2]=[P("External referrals",-1)])),_:1,__:[2]})]),_:1}),a(l,{value:"Internal referrals",onClick:t[1]||(t[1]=c=>e.setSegmentContent("Internal referrals"))},{default:s(()=>[a(u,null,{default:s(()=>t[3]||(t[3]=[P("Internal referrals",-1)])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),e.segmentContent=="Internal referrals"?(r(),v("div",wa,[n("div",$a,[e.checkUnderFive?(r(),v("div",Sa)):S("",!0),t[4]||(t[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),e.checkUnderFive?S("",!0):(r(),v("div",ka))])])):S("",!0),e.segmentContent=="External referrals"?(r(),v("div",Ia,[a(d)])):S("",!0)],64)}const Pa=H(Ca,[["render",Aa],["__scopeId","data-v-e09d6a6b"]]),Ue=Vt("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(e){this.selectedItem=e},getSelectedItem(){return this.selectedItem}},persist:!0}),Na=()=>{const e=V(null);return{activeIteminMixin:e,setActiveItem:o=>{e.value=o,console.log("lll: ",e.value)}}},Ce=W({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:e,setActiveItem:t}=Na();return{chevronBackOutline:Ht,checkmark:Wt,grid:Ut,chevronDownCircle:Et,chevronForwardCircle:xt,chevronUpCircle:Ft,colorPalette:Mt,document:Lt,globe:Bt,medkit:lt,add:Rt,person:rt,people:it,thermometer:ot,clipboard:st,activeIteminMixin:e,setActiveItem:t}},async mounted(){await this.setAppointments()},computed:{...q(te,["patient"])},watch:{$route:{async handler(e){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await pn.getDailiyAppointments(k.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((e,t)=>e.given_name.localeCompare(t.given_name)))},formatBirthdate(e){return k.getBirthdateAge(e)},setActiveItemRefFN(e){Ue().setSelectedItem(e)}}}),Ta=W({name:"NCDDashboard",mixins:[Ce],components:{ApexChart:Dt},setup(){return{router:et()}},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await dt(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){try{return E.getJson("programs/32/reports/ncd_dashboard",{start_date:k.toStandardHisFormat(k.sessionDate()),end_date:k.toStandardHisFormat(k.sessionDate())})}catch(e){return[]}},navigationMenu(e){try{zt.close(),this.router.push(e).then(()=>{})}catch(t){console.error(t)}}}}),Oa={class:"cards-container"},Va={class:"top-card-text"},Ra={class:"text-2xl font-bold"},Ba={class:"top-card-text"},La={class:"text-2xl font-bold"},Ma={class:"top-card-text"},Fa={class:"text-2xl font-bold"},xa={class:"top-card-text"},Ea={class:"text-2xl font-bold"},Ua={class:"top-card-text"},Wa={class:"text-2xl font-bold"},Ha={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},za={ref:"chartRef1"},ja={ref:"chartRef2"};function Ja(e,t,o,i,p,b){const u=g("ion-card-content"),l=g("ion-card"),m=g("ApexChart");return r(),v(x,null,[n("div",Oa,[a(l,{class:"top-card action-card",onClick:t[0]||(t[0]=d=>e.setActiveItemRefFN("appointments"))},{default:s(()=>[a(u,null,{default:s(()=>[n("div",Va,[n("div",Ra,_(e.appointments.length),1),t[2]||(t[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]),_:1})]),_:1}),a(l,{class:"top-card action-card"},{default:s(()=>[a(u,null,{default:s(()=>{var d;return[n("div",Ba,[n("div",La,_((d=e.dashboardData)==null?void 0:d.total_pending_dispensations),1),t[3]||(t[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]}),_:1})]),_:1}),a(l,{class:"top-card action-card"},{default:s(()=>[a(u,null,{default:s(()=>{var d;return[n("div",Ma,[n("div",Fa,_((d=e.dashboardData)==null?void 0:d.total_defaulters),1),t[4]||(t[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]}),_:1})]),_:1}),a(l,{class:"top-card action-card"},{default:s(()=>[a(u,null,{default:s(()=>{var d;return[n("div",xa,[n("div",Ea,_((d=e.dashboardData)==null?void 0:d.total_complications),1),t[5]||(t[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]}),_:1})]),_:1}),a(l,{class:"top-card action-card",onClick:t[1]||(t[1]=d=>e.navigationMenu("NCDActivePatients"))},{default:s(()=>[a(u,null,{default:s(()=>{var d;return[n("div",Ua,[n("div",Wa,_((d=e.dashboardData)==null?void 0:d.total_client_registered),1),t[6]||(t[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]}),_:1})]),_:1})]),n("div",Ha,[a(l,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(u,null,{default:s(()=>[t[7]||(t[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",za,[e.isChartReady?(r(),R(m,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:e.barChartOptions,series:e.barChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1,__:[7]})]),_:1}),a(l,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(u,null,{default:s(()=>[t[8]||(t[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",ja,[e.isChartReady?(r(),R(m,{key:0,style:{width:"100%",height:"500px"},type:"line",options:e.lineChartOptions,series:e.lineChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1,__:[8]})]),_:1})])],64)}const Ga=H(Ta,[["render",Ja],["__scopeId","data-v-18251377"]]),Qa=W({name:"Home",mixins:[_t,Ce],components:{IonContent:ae,IonHeader:ne,IonPage:Oe,IonToolbar:re,IonRow:Te,DateInputField:Je,IonIcon:G,IonButton:$e,IonCol:Ne,IonCard:Pe,IonCardHeader:ut,IonCardTitle:ct,IonCardContent:We,ViewToggleComponent:Pn,bottomNavBar:Nn,HorizontalLine:mn},data(){const e=localStorage.getItem("ncdStartDate"),t=localStorage.getItem("ncdEndDate"),o=V(e||k.sessionDate()),i=V(t||k.sessionDate()),p=V(k.sessionDate()),b=V(k.sessionDate()),u=V([]),l=jt({page:1,itemsPerPage:10}),m=V(0),d=kn(),c=V("list");return{minDate:p,startDate:o,endDate:i,people:u,calendarOutline:fe,openOutline:pt,maxDate:b,alertCircleOutline:nt,personOutline:Xt,idCardOutline:Zt,manOutline:qt,womanOutline:Yt,locationOutline:Qt,timeOutline:Gt,todayOutline:Jt,pagination:l,totalCount:m,actionButtonStore:d,currentToggleView:c}},computed:{...q(Fe,["NCDAppointmentsTogglePreference"]),paginatedPeople(){const e=(this.pagination.page-1)*this.pagination.itemsPerPage,t=e+this.pagination.itemsPerPage;return this.people.slice(e,t)},groupedPaginatedPeople(){const e={};this.paginatedPeople.forEach(i=>{const p=i.appointmentDate;e[p]||(e[p]=[]),e[p].push(i)});const t=Object.keys(e).sort((i,p)=>new Date(i)-new Date(p)),o={};return t.forEach(i=>{o[i]=e[i]}),o}},$route:{async handler(){},deep:!0},watch:{NCDAppointmentsTogglePreference:{handler(e){e&&e.toggle_view&&(this.currentToggleView=e.toggle_view)},deep:!0,immediate:!0}},async mounted(){this.initTogglePreference(),this.getAppointments(),this.HideHomePageActionButton()},async unmounted(){this.actionButtonStore.resetShowActionButton()},methods:{formatBirthdate(e){return k.getBirthdateAge(e)},async getAppointments(e=!1){if(vt().apiStatus){this.people=[],this.pagination.page=1;try{e==!0&&(this.startDate=k.sessionDate(),this.endDate=k.sessionDate(),this.getAppointmentsD1(this.startDate),this.getAppointmentsD2(this.endDate)),this.startDate>this.endDate&&(this.endDate=this.startDate),console.log(this.startDate,this.endDate),(await Ct.getAppointments(this.startDate,this.endDate,"")).forEach(i=>{const p=k.toStandardHisDisplayFormat(i.appointment_date);if(!this.people.some(u=>u.person_id===i.person_id&&u.appointmentDate===p)){const u={person_id:i.person_id,npid:i.npid,appointment_id:103,encounter_id:i.encounter_id,name:i.given_name.concat(" ",i.family_name),gender:i.gender,ageDob:this.formatBirthdate(i.birthdate),village:i.city_village,appointmentDate:p};this.people.push(u)}}),this.totalCount=this.people.length}catch(o){}}},async getAppointmentsD1(e){this.startDate=k.toStandardHisFormat(e),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(e){this.endDate=k.toStandardHisFormat(e),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(e){const t=await ye.findByNpid(e);te().setPatientRecord(t[0]),this.redirectUser()},handleViewChange(e){this.currentToggleView=e,this.initTogglePreference(e,!0)},initTogglePreference(e="list",t=!1){const o={toggle_view:e},i=Fe();Object.keys(this.NCDAppointmentsTogglePreference).length===0?(o.toggle_view="list",i.setNCDAppointmentsTogglePreference(o),this.currentToggleView="list"):t===!0?i.setNCDAppointmentsTogglePreference(o):this.currentToggleView=this.NCDAppointmentsTogglePreference.toggle_view||"list"},redirectUser(){const e=JSON.parse(localStorage.getItem("userRoles")),t=e||[];t.some(o=>t.some(i=>i.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")},handlePaginationUpdate({page:e,itemsPerPage:t}){if(t!==this.pagination.itemsPerPage){const o=(this.pagination.page-1)*this.pagination.itemsPerPage,i=Math.floor(o/t)+1,p=Math.ceil(this.totalCount/t);this.pagination.page=Math.min(i,p)||1,this.pagination.itemsPerPage=t}else this.pagination.page=e},HideHomePageActionButton(){this.actionButtonStore.setShowActionButton(!1)}}}),Ya={class:"appointments-container"},qa={class:"date-filter"},Za={key:0,style:{margin:"20px"}},Xa={key:1},Ka={class:"appointments-table"},es={key:2},ts={class:"date-group-header"},ns={class:"date-header-title"},as={class:"date-header-count"},ss={class:"cards-container"},os={class:"card-details"},is={class:"detail-item"},rs={class:"detail-value"},ls={class:"detail-item"},ds={class:"detail-value"},cs={class:"detail-item"},us={class:"detail-value"},ps={class:"detail-item"},ms={class:"detail-value"};function hs(e,t,o,i,p,b){const u=g("DateInputField"),l=g("ion-col"),m=g("ion-icon"),d=g("ion-button"),c=g("ViewToggleComponent"),D=g("ion-row"),C=g("ion-card"),y=g("HorizontalLine"),w=g("ion-card-title"),f=g("ion-card-header"),O=g("ion-card-content"),I=g("ion-content"),B=g("bottomNavBar"),Q=g("ion-footer");return r(),v("div",Ya,[n("div",qa,[a(D,null,{default:s(()=>[a(l,null,{default:s(()=>[a(u,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(l,null,{default:s(()=>[a(u,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1}),a(l,null,{default:s(()=>[a(d,{color:"primary",onClick:t[0]||(t[0]=j=>e.getAppointments(!0)),class:"apt-btn"},{default:s(()=>[a(m,{icon:e.todayOutline,slot:"start"},null,8,["icon"]),t[1]||(t[1]=n("span",{style:{margin:"5px"}}," Today ",-1))]),_:1,__:[1]})]),_:1}),a(l,null,{default:s(()=>[a(c,{"initial-view":e.currentToggleView,onViewChanged:e.handleViewChange},null,8,["initial-view","onViewChanged"])]),_:1})]),_:1})]),a(I,{class:"scrollable-content"},{default:s(()=>[e.people.length===0?(r(),v("div",Za,[a(m,{icon:e.alertCircleOutline,size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),t[2]||(t[2]=n("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Appointments for selected date range",-1))])):e.currentToggleView==="list"&&e.people.length>0?(r(),v("div",Xa,[a(C,null,{default:s(()=>[n("table",Ka,[t[3]||(t[3]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(r(!0),v(x,null,z(e.paginatedPeople,j=>(r(),v("tr",{key:j.npid},[n("td",null,[a(D,null,{default:s(()=>[a(l,null,{default:s(()=>[P(_(j.name),1)]),_:2},1024),a(l,null,{default:s(()=>[a(d,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:ce=>e.openClientProfile(j.npid),color:"primary",fill:"clear",size:"small"},{default:s(()=>[a(m,{icon:e.openOutline,style:{"font-size":"28px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,_(j.npid),1),n("td",null,_(j.ageDob),1),n("td",null,_(j.gender),1),n("td",null,_(j.village),1),n("td",null,_(j.appointmentDate),1)]))),128))])])]),_:1})])):e.currentToggleView==="card"&&e.people.length>0?(r(),v("div",es,[(r(!0),v(x,null,z(e.groupedPaginatedPeople,(j,ce)=>(r(),v("div",{key:ce,class:"date-group"},[n("div",ts,[a(m,{icon:e.calendarOutline,class:"date-header-icon"},null,8,["icon"]),n("h2",ns,_(ce),1),n("div",as,_(j.length)+" appointment"+_(j.length!==1?"s":""),1)]),a(y,{color:"#006401",thickness:1,spacing:"sm"}),n("div",ss,[(r(!0),v(x,null,z(j,Z=>(r(),R(C,{key:Z.npid,class:"appointment-card"},{default:s(()=>[a(f,null,{default:s(()=>[a(D,{class:"ion-align-items-center"},{default:s(()=>[a(l,null,{default:s(()=>[a(w,{class:"card-name"},{default:s(()=>[a(m,{icon:e.personOutline,class:"name-icon"},null,8,["icon"]),P(" "+_(Z.name),1)]),_:2},1024)]),_:2},1024),a(l,{size:"auto"},{default:s(()=>[a(d,{onClick:Ge=>e.openClientProfile(Z.npid),color:"primary",fill:"clear",size:"small",class:"view-profile-btn"},{default:s(()=>[a(m,{icon:e.openOutline},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(O,null,{default:s(()=>[n("div",os,[n("div",is,[a(m,{icon:e.idCardOutline,class:"detail-icon"},null,8,["icon"]),t[4]||(t[4]=n("span",{class:"detail-label"},"NPID:",-1)),n("span",rs,_(Z.npid),1)]),n("div",ls,[a(m,{icon:e.calendarOutline,class:"detail-icon"},null,8,["icon"]),t[5]||(t[5]=n("span",{class:"detail-label"},"Age/DOB:",-1)),n("span",ds,_(Z.ageDob),1)]),n("div",cs,[a(m,{icon:Z.gender==="Male"?e.manOutline:e.womanOutline,class:"detail-icon"},null,8,["icon"]),t[6]||(t[6]=n("span",{class:"detail-label"},"Gender:",-1)),n("span",us,_(Z.gender),1)]),n("div",ps,[a(m,{icon:e.locationOutline,class:"detail-icon"},null,8,["icon"]),t[7]||(t[7]=n("span",{class:"detail-label"},"Village:",-1)),n("span",ms,_(Z.village),1)])])]),_:2},1024)]),_:2},1024))),128))])]))),128))])):S("",!0)]),_:1}),e.people.length>0?(r(),R(Q,{key:0,class:"sticky-footer"},{default:s(()=>[a(D,null,{default:s(()=>[a(l,{size:"12",style:{"max-width":"100%"}},{default:s(()=>[a(B,{totalItems:e.totalCount,currentPage:e.pagination.page,itemsPerPage:e.pagination.itemsPerPage,"onUpdate:pagination":e.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])]),_:1})]),_:1})]),_:1})):S("",!0)])}const gs=H(Qa,[["render",hs],["__scopeId","data-v-cbdb9bb6"]]),fs={key:0,class:"left_col"},_s={class:"nav-menu"},vs=["onClick"],ys={class:"ellipsis"},bs={key:1,style:{"padding-left":"20px","padding-right":"20px"}},Ds=W({__name:"NCDDashboard",setup(e){const t=Ue(),o=Y(()=>t.selectedItem),{screenWidth:i}=hn(),p=V([{id:"dashboard",label:"Dashboard",icon:mt},{id:"referrals",label:"Referrals",icon:ht},{id:"appointments",label:"Appointments",icon:fe}]),b=V("dashboard"),u=be(),{substance:l}=Se(u);ie(()=>l.value,(d,c)=>{d!==c&&console.log("Substance changed:",d)},{deep:!0,immediate:!0});const m=d=>{b.value=d,Ue().setSelectedItem(b.value)};return ie(()=>o.value,d=>{console.log("Active item from mixin changed:",d),d&&d!=null&&m(d)},{immediate:!0}),(d,c)=>{const D=g("ion-segment-button"),C=g("ion-segment");return r(),v("div",{style:ke(T(i)>940?"display: flex":"display: block")},[T(i)>940?(r(),v("div",fs,[n("nav",_s,[n("ul",null,[(r(!0),v(x,null,z(p.value,y=>(r(),v("li",{key:y.id,class:ee({active:b.value===y.id}),onClick:w=>m(y.id)},[a(T(G),{icon:y.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",ys,_(y.label),1)],10,vs))),128))])])])):S("",!0),T(i)<=940?(r(),v("div",bs,[a(C,{value:b.value,style:{"margin-top":"5px","justify-content":"left"}},{default:s(()=>[(r(!0),v(x,null,z(p.value,y=>(r(),R(D,{value:y.id,key:y.id,class:ee({active:b.value===y.id}),onClick:w=>m(y.id)},{default:s(()=>[a(T(G),{icon:y.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,_(y.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):S("",!0),n("div",{class:"right_col",style:ke(T(i)>940?"width: 85%":"width: 100%")},[n("div",null,[b.value==="referrals"?(r(),R(Pa,{key:0})):S("",!0),b.value==="dashboard"?(r(),R(Ga,{key:1})):S("",!0),b.value==="appointments"?(r(),R(gs,{key:2})):S("",!0)])],4)],4)}}}),Cs=H(Ds,[["__scopeId","data-v-a1132315"]]),ws=""+new URL("icon/checklist.svg",import.meta.url).href,$s=""+new URL("icon/dashboard.svg",import.meta.url).href,Ss={name:"Dashboard",setup(){pe(async()=>{o.value=await l(),await m();const c=await d(),{labels:D,totalVisits:C,incompleteVisits:y}=e(c);t(D,C,y)});function e(c){if(!c)return{labels:[],totalVisits:[],incompleteVisits:[]};const D=[],C=[],y=[];return Object.entries(c).forEach(([w,f])=>{const I=new Date(w).toLocaleDateString("en-US",{weekday:"long"});D.push(I),C.push(f.complete),y.push(f.incomplete)}),{labels:D,totalVisits:C,incompleteVisits:y}}function t(c,D,C){const y=document.getElementById("myChart");new Tn(y,{type:"bar",data:{labels:c,datasets:[{label:"Total visits",data:D,backgroundColor:"#5aa3b1"},{label:"Incomplete visits",data:C,backgroundColor:"#dba6a2"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}const o=V([]),i=V({}),p=c=>{const D=Object.entries(Qe).find(([C,y])=>y===c);return D?D[0]:"Unknown (".concat(c,")")},b=c=>Object.keys(c).map(D=>{var O,I;const C=Number(D),y=p(C),w=((O=c[C])==null?void 0:O.F)||0,f=((I=c[C])==null?void 0:I.M)||0;return{encounter:u(y),female:w,male:f,me:w+f,facility:w+f}}),u=c=>c.toLowerCase().replace(/_/g," ").replace(/\b\w/g,D=>D.toUpperCase()),l=async()=>{try{const c=Object.values(Qe).filter(f=>typeof f=="number"),[D,C]=await Promise.all([E.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:c}),E.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:[9,51,6,52,53,68,25,54,7],all:!0})]),y=b(C),w=b(D);return y.map(f=>{const O=w.find(I=>I.encounter===f.encounter);return{...f,me:O?O.female+O.male:0}})}catch(c){return console.error("Error fetching dashboard stats:",c),[]}},m=async()=>{try{const D=new Date().toISOString().split("T")[0],C=await E.getJson("programs/1/dashboard",{date:D});i.value=C}catch(c){console.error("Error fetching visits stats:",c)}},d=async()=>{try{const c=new Date,D=new Date;D.setDate(c.getDate()-5);const C=y=>y.toISOString().split("T")[0];return await E.getJson("programs/1/reports/visits",{name:"visits",end_date:C(c),start_date:C(D)})}catch(c){console.error("Error fetching visits stats:",c)}};return{checkListIcon:ws,dashboardIcon:$s,rows:o,dashboardScoreStats:i}}},ks={class:"dashboard-container"},Is={class:"summary-cards"},As={class:"card"},Ps={class:"card"},Ns={class:"card"},Ts={class:"card"},Os={class:"main-section"},Vs={class:"encounters-section"},Rs={class:"his-sm-text"},Bs={key:0},Ls={class:"encounter-td"},Ms={class:"other-td"},Fs={class:"other-td"},xs={class:"other-td"},Es={class:"other-td"},Us={key:1};function Ws(e,t,o,i,p,b){var u,l,m,d,c,D,C,y;return r(),v("div",ks,[n("div",Is,[n("div",As,[n("h2",null,_(((l=(u=i.dashboardScoreStats)==null?void 0:u.total_patients_today)!=null?l:[]).length||0),1),t[0]||(t[0]=n("p",null,"Total patients today",-1))]),n("div",Ps,[n("h2",null,_(((d=(m=i.dashboardScoreStats)==null?void 0:m.waiting_for_vitals)!=null?d:[]).length||0),1),t[1]||(t[1]=n("p",null,"Waiting for vitals",-1))]),n("div",Ns,[n("h2",null,_(((D=(c=i.dashboardScoreStats)==null?void 0:c.waiting_for_consultation)!=null?D:[]).length||0),1),t[2]||(t[2]=n("p",null,"Waiting for consultation",-1))]),n("div",Ts,[n("h2",null,_(((y=(C=i.dashboardScoreStats)==null?void 0:C.waiting_for_dispensation)!=null?y:[]).length||0),1),t[3]||(t[3]=n("p",null,"Waiting for dispensation",-1))])]),n("div",Os,[t[7]||(t[7]=n("div",{class:"chart-section"},[n("h3",null,"Total visits/incomplete visits: last 5 days"),n("canvas",{id:"myChart"})],-1)),n("div",Vs,[t[6]||(t[6]=n("h3",null,"Encounters created today",-1)),n("table",Rs,[t[5]||(t[5]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),i.rows.length?(r(),v("tbody",Bs,[(r(!0),v(x,null,z(i.rows,(w,f)=>(r(),v("tr",{key:f},[n("td",Ls,_(w.encounter),1),n("td",Ms,_(w.female),1),n("td",Fs,_(w.male),1),n("td",xs,_(w.me),1),n("td",Es,_(w.facility),1)]))),128))])):(r(),v("tbody",Us,t[4]||(t[4]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])))])])])])}const Hs=H(Ss,[["render",Ws]]);class Me extends E{static getlogs(t,o){return this.getJson("notification/logs",{startDate:t,endDate:o})}static clear(t){return this.putJson("notifications/clear/".concat(t),{id:t})}static read(t){return this.putJson("notifications/update",{alerts:t})}static unread(){return this.getJson("notifications")}}const se=V([]);function wt(){const e=Y(()=>se.value.filter(c=>!c.read)),t=Y(()=>se.value.length>0),o=Y(()=>e.value.length>0),i=Y(()=>e.value.length),p=Y(()=>se.value.sort((c,D)=>new Date(c.date)>new Date(D.date)?-1:1));function b(c,D){gn("Are you sure you want to clear notification?").then(C=>{C&&Me.clear(c).then(()=>{se.value=se.value.filter(y=>y.id!=c),D(c),l()}).catch(y=>{console.error(y),xe("Unable to clear notification")})})}function u(c){return k.toStandardHisDisplayFormat(c)}async function l(){se.value=[];const c=await Me.unread();if(!ge.isEmpty(c)){const D={highVL:[],normalVL:[],rejectedVL:[]};let C={};se.value=c.map(y=>{let w="General";const f=y.text;let O=null;try{const I=JSON.parse(y.text);if(I.Type.match(/lims/i)){O=()=>fn.push("/art/encounters/lab/".concat(I.PatientID)),w="".concat(I["Test type"]," results for ").concat(I["ARV-Number"]||I["Accession number"]);const B=_n.detectHighVl(I.Result[0].value,I.Result[0].value_modifier);C={handler:O,id:y.alert_id,arv:I["ARV-Number"],accession:I["Accession number"],order_date:u(I["Orde date"]),results:I.Result[0].value_modifier+" "+I.Result[0].value,results_date:u(I.Result[0].date)},B?D.highVL.push(C):I.rejection_reason?(C={handler:O,id:y.alert_id,arv:I.arv_number,accession:I.accession_number,order_date:u(I.order_date),rejection_reason:I.rejection_reason},D.rejectedVL.push(C)):B||D.normalVL.push(C)}}catch(I){console.warn(I)}return{handler:O,message:f,vlMessageObs:D,title:w,id:y.alert_id,date:u(y.date_created)}})}}async function m(c){Me.read([c.id]).then(()=>c.read=!0)}function d(c){typeof c.handler=="function"&&(m(c),c.handler())}return{markAsRead:m,openNotification:d,loadNotifications:l,clearNotification:b,sortedNotifications:p,hasUnreadNotifications:o,notificationCount:i,hasNotifications:t,notificationData:se}}const zs={class:"vl-alerts-container"},js={class:"table-container"},Js={class:"vl-table"},Gs={key:0},Qs={key:0},Ys=["colspan"],qs={key:0},Zs=W({__name:"ARTVlAlert",setup(e){const t=V("high_vl"),{notificationData:o,loadNotifications:i,clearNotification:p,openNotification:b}=wt(),u=Y(()=>{var w,f;return o.value.length?(((f=(w=o.value[0])==null?void 0:w.vlMessageObs)==null?void 0:f.highVL)||[]).length:0}),l=Y(()=>{var w,f;return o.value.length?(((f=(w=o.value[0])==null?void 0:w.vlMessageObs)==null?void 0:f.rejectedVL)||[]).length:0}),m=Y(()=>{var w,f;return o.value.length?(((f=(w=o.value[0])==null?void 0:w.vlMessageObs)==null?void 0:f.normalVL)||[]).length:0}),d=Y(()=>{var w;if(!o.value.length)return[];const y=(w=o.value[0])==null?void 0:w.vlMessageObs;if(!y)return[];switch(t.value){case"high_vl":return y.highVL||[];case"rejected":return y.rejectedVL||[];case"normal":return y.normalVL||[];default:return[]}}),c=y=>b(y),D=y=>{y.id&&p(y.id,w=>{console.log("Cleared notification ".concat(w))})},C=()=>{switch(t.value){case"high_vl":return"No high viral load results found";case"rejected":return"No rejected samples found";case"normal":return"No normal results found";default:return"No results found"}};return pe(()=>{i()}),(y,w)=>(r(),v("div",zs,[a(T(He),{mode:"ios",modelValue:t.value,"onUpdate:modelValue":w[0]||(w[0]=f=>t.value=f),class:"category-segment"},{default:s(()=>[a(T(ue),{value:"high_vl"},{default:s(()=>[a(T(he),null,{default:s(()=>[P("High VL ("+_(u.value)+")",1)]),_:1})]),_:1}),a(T(ue),{value:"rejected"},{default:s(()=>[a(T(he),null,{default:s(()=>[P("Rejected ("+_(l.value)+")",1)]),_:1})]),_:1}),a(T(ue),{value:"normal"},{default:s(()=>[a(T(he),null,{default:s(()=>[P("Normal Results ("+_(m.value)+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",js,[n("table",Js,[n("thead",null,[n("tr",null,[w[1]||(w[1]=n("th",null,"ARV #",-1)),w[2]||(w[2]=n("th",null,"Accession #",-1)),w[3]||(w[3]=n("th",null,"Order Date",-1)),t.value==="rejected"?(r(),v("th",Gs,"Rejection Reason")):S("",!0),w[4]||(w[4]=n("th",null,"View",-1)),w[5]||(w[5]=n("th",null,"Clear",-1))])]),n("tbody",null,[d.value.length===0?(r(),v("tr",Qs,[n("td",{colspan:t.value==="rejected"?6:5,class:"empty-message"},_(C()),9,Ys)])):S("",!0),(r(!0),v(x,null,z(d.value,f=>(r(),v("tr",{key:f.id},[n("td",null,_(f.arv||"-"),1),n("td",null,_(f.accession||"-"),1),n("td",null,_(f.order_date||"-"),1),t.value==="rejected"?(r(),v("td",qs,_(f.rejection_reason||"-"),1)):S("",!0),n("td",null,[a(T($e),{fill:"clear",size:"small",onClick:O=>c(f)},{default:s(()=>[a(T(G),{icon:T(gt),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"])]),n("td",null,[a(T($e),{fill:"clear",size:"small",onClick:O=>D(f),color:"success"},{default:s(()=>[a(T(G),{icon:T(Kt),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"])])]))),128))])])])]))}}),Xs=H(Zs,[["__scopeId","data-v-1aa5b6c6"]]),Ks={class:"dashboard-container"},eo={class:"segment-content"},to={key:0},no={key:1},ao=W({__name:"ARTHome",setup(e){const t=V("dashboard"),{notificationCount:o,loadNotifications:i}=wt();return pe(()=>{i()}),(p,b)=>(r(),v("div",Ks,[a(T(He),{modelValue:t.value,"onUpdate:modelValue":b[0]||(b[0]=u=>t.value=u)},{default:s(()=>[a(T(ue),{value:"dashboard"},{default:s(()=>b[1]||(b[1]=[P(" Overview ",-1)])),_:1,__:[1]}),a(T(ue),{value:"viralLoadAlerts"},{default:s(()=>[n("div",eo,[b[2]||(b[2]=P(" VL Alerts ",-1)),T(o)>0?(r(),R(T(en),{key:0,color:"primary"},{default:s(()=>[P(_(T(o)),1)]),_:1})):S("",!0)])]),_:1})]),_:1},8,["modelValue"]),t.value==="dashboard"?(r(),v("div",to,[a(Hs)])):S("",!0),t.value==="viralLoadAlerts"?(r(),v("div",no,[a(Xs)])):S("",!0)]))}}),so=H(ao,[["__scopeId","data-v-907b1bb8"]]);class oo{constructor(){K(this,"socket",null);K(this,"channel","ImmunizationReportChannel");K(this,"isConnected",!1);K(this,"pendingFetch",null);K(this,"location_id");K(this,"initPromise");K(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});K(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});K(this,"onError",t=>{console.error("WebSocket error:",t),this.isConnected=!1});this.initPromise=this.init()}async init(){const t=localStorage.getItem("apiURL"),o=localStorage.getItem("apiPort"),i=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const p="".concat(i,"://").concat(t,"/api/v1/cable");this.socket=new WebSocket(p),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(p){console.error(p),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const t={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(t))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await E.getJson("immunization/stats",{start_date:k.getDateBeforeByDays(k.sessionDate(),365),end_date:k.sessionDate()})}async setMessageHandler(t){await this.initPromise,this.socket?this.socket.onmessage=o=>{t(o)}:console.error("WebSocket connection not established.")}}const io=W({components:{IonContent:ae,IonHeader:ne,IonItem:de,IonList:le,IonMenu:ve,IonTitle:_e,IonToolbar:re,IonInput:tt,BasicInputField:yn,BasicForm:De,PreviousVitals:vn,customDatePicker:Vn,IonCol:Ne,IonRow:Te,VueMultiselect:tn,IonLabel:he,DataTable:Ve},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:je,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:k.toStandardHisDisplayFormat(E.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...q(On,["administerOtherVaccine"]),...q(Ye,["tempScannedBatchNumber"]),...q(te,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await Bn(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:rt,pulseOutline:nn,clipboardOutline:at}},methods:{formatBirthdate(e){return k.getBirthdateAge(e)},async openClientProfile(e){const t=await ye.findByID(e);await te().setPatientRecord(t),this.$router.push("patientProfile")},processData(){var t;return((t=this.data)==null?void 0:t.map(o=>{if(o.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let i=[];const p=b=>b.map(l=>{let m=0;return l.clients.map(d=>{(l.drug_name==this.drug_name&&(this.village==d.table.city_village||this.village=="All")||(l.drug_name==this.drug_name||this.village==d.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:d.table.given_name,family_name:d.table.family_name,patient_id:d.table.patient_id,birthdate:d.table.birthdate,city_village:d.table.city_village}),m++),this.villageList.push(d.table.city_village)}),[l.drug_name,m]}).filter(l=>l[1]!==0);return this.title=="Client due today"&&(i=p(o.value.due_today_antigens)),this.title=="Client due this week"&&(i=p(o.value.due_this_week_antigens)),this.title=="Client due this month"&&(i=p(o.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(i=p(o.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(i=p(o.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(b=>JSON.stringify(b)))].map(b=>JSON.parse(b)),this.villageList=[...new Set(this.villageList)],i}}))[0]},handleVillageClick(e){this.drug_name="",this.village=e,this.tableData=this.processData()},handleRowClick(e){var o;this.tableEvent=e.target;const t=this.tableEvent.closest("tr");if(t){const i=Array.from(((o=t.parentNode)==null?void 0:o.children)||[]).indexOf(t),p=this.tableData[i];this.drug_name=p[0],t.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(e){return k.calculateDisplayAge(e)},openPopover(e){this.event=e,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(e){var o;const t=e.target.value;this.batchNumber=t||((o=this.tempScannedBatchNumber)==null?void 0:o.text)||""},saveBatchWithTodayDate(){let e=E.getSessionDate();this.saveDta(e)},dismiss(){Re.dismiss()},saveBatch(){let e;ge.isEmpty(this.vaccineDate)==!0?e=E.getSessionDate():e=this.vaccineDate,this.saveDta(e)},validateVaccineName(){if(ge.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if(ge.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(e){this.currentDrugOb=e},isAlphaNumeric(e){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(e)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(e){this.batchNumber=e},saveDta(e){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){xe("Enter batch number!");return}if(this.batchNumber==""){xe("Enter batch number!");return}const t={batch_number:this.batchNumber,date_administered:e,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},o=Ye();o.setAdministeredVaccine(t),Rn(this.patient),this.dismiss(),o.setTempScannedBatchNumber(null)}}}),ro={key:0,class:"spinner-overlay"},lo={class:"header position_content"},co={style:{"font-size":"1.2em","font-weight":"700"}},uo={class:"dueCardContent"},po=["onClick"],mo={style:{"margin-right":"15px"}},ho={style:{"align-items":"center",display:"flex"}},go={style:{"line-height":"1"}},fo={class:"client_name"},_o={class:"name"},vo={class:"demographicsOtherRow"},yo={class:"demographicsText"};function bo(e,t,o,i,p,b){const u=g("ion-spinner"),l=g("ion-icon"),m=g("ion-header"),d=g("ion-card-title"),c=g("ion-card-header"),D=g("DataTable"),C=g("ion-card-content"),y=g("ion-card"),w=g("ion-item"),f=g("ion-list"),O=g("ion-popover"),I=g("ion-content");return r(),v(x,null,[e.isLoading?(r(),v("div",ro,[a(u,{name:"bubbles"}),t[3]||(t[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):S("",!0),a(m,null,{default:s(()=>[n("div",lo,[n("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=B=>e.dismiss())},[a(l,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",co,_(e.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:t[1]||(t[1]=B=>e.openPopover(B))},[a(l,{slot:"separator",size:"large",icon:e.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(I,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:s(()=>[n("div",null,[a(y,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:s(()=>[a(c,null,{default:s(()=>[a(d,{class:"sectionTitle"},{default:s(()=>t[4]||(t[4]=[P(" Summary of required doses ",-1)])),_:1,__:[4]})]),_:1}),a(C,null,{default:s(()=>[n("div",uo,[a(D,{options:e.options,data:e.tableData,class:"display nowrap",width:"100%",onClick:e.handleRowClick},{default:s(()=>t[5]||(t[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])),_:1,__:[5]},8,["options","data","onClick"])])]),_:1})]),_:1}),a(y,{class:"section",style:{"margin-inline":"0px"}},{default:s(()=>[a(c,null,{default:s(()=>[a(d,{class:"sectionTitle"},{default:s(()=>t[6]||(t[6]=[P("Client Details ",-1)])),_:1,__:[6]})]),_:1}),a(C,null,{default:s(()=>[(r(!0),v(x,null,z(e.clientDetails,(B,Q)=>(r(),v("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:Q,onClick:j=>e.openClientProfile(B.patient_id)},[n("div",mo,[n("div",{class:ee((B==null?void 0:B.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(l,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:e.person},null,8,["icon"])],2)]),n("div",ho,[n("div",go,[n("div",fo,[n("div",_o,_(B.given_name)+" "+_(B.family_name),1)]),n("div",vo,[n("div",yo,[P(_(B.gender=="M"?"Male":"Female")+" ",1),t[7]||(t[7]=n("span",{class:"dot"},".",-1)),P(_(e.formatBirthdate(B.birthdate)),1)])]),n("div",null,"Village: "+_(B.city_village),1)])])],8,po))),128))]),_:1})]),_:1})]),a(O,{style:{"--offset-x":"-10px"},"is-open":e.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:e.event,onDidDismiss:t[2]||(t[2]=B=>e.popoverOpen=!1)},{default:s(()=>[n("div",null,[t[8]||(t[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(r(!0),v(x,null,z(e.villageList,(B,Q)=>(r(),R(f,{class:ee(B==e.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:Q},{default:s(()=>[a(w,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:j=>e.handleVillageClick(B)},{default:s(()=>[P(_(B),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const Do=H(io,[["render",bo],["__scopeId","data-v-2b76e9ce"]]),Co=W({name:"Menu",mixins:[Ce],components:{IonContent:ae,IonHeader:ne,IonItem:de,IonList:le,IonMenu:ve,IonTitle:_e,IonToolbar:re,IonCheckbox:Be,BasicForm:De,BasicCard:Le,Carousel:rn,Slide:on,Pagination:sn,Navigation:an},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},computed:{...q(be,["substance"]),backgroundStyle(){return{background:"linear-gradient(180deg, rgba(150, 152, 152, 0.7) 0%, rgba(255, 255, 255, 0.9) 100%), url(".concat(Ln("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",height:"22.8vh"}}},watch:{},async mounted(){new oo().setMessageHandler(this.onMessage)},methods:{async onMessage(e){var o,i,p;const t=JSON.parse(e.data);t.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=t.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((o=this.reportData)==null?void 0:o.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((i=this.reportData)==null?void 0:i.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((p=this.reportData)==null?void 0:p.total_male_vaccinated_this_year)||0}])},openDueModal(e){const t={title:e,dashBoardData:this.reportData};we(Do,{class:"fullScreenModal"},!0,t)},async openClientProfile(e){const t=await ye.findByNpid(e);await te().setPatientRecord(t[0]),this.$router.push("patientProfile")}}}),wo={class:"topStats"},$o={class:"totalStats",style:{background:"linear-gradient(180deg, #20b2aa 0%, #40c0b0 50%, rgb(233, 233, 233) 100%)"}},So={class:"statsValue",style:{"font-size":"1.4em"}},ko={class:"statsText",style:{"font-size":"0.9em"}},Io={class:"dueCardContent"},Ao={class:"statsValue"},Po={class:"statsValue"},No={class:"statsValue"},To={class:"overDueCardContent"},Oo={class:"statsValue"},Vo={class:"statsValue"},Ro=["onClick"],Bo={style:{"margin-right":"15px"}},Lo={style:{"align-items":"center",display:"flex"}},Mo={style:{"line-height":"1"}},Fo={class:"client_name"},xo={class:"name"},Eo={class:"demographicsOtherRow"},Uo={class:"demographicsText"};function Wo(e,t,o,i,p,b){const u=g("Slide"),l=g("Pagination"),m=g("Carousel"),d=g("ion-card-title"),c=g("ion-card-header"),D=g("ion-card-content"),C=g("ion-card"),y=g("ion-icon"),w=g("ion-content");return r(),R(w,{class:"content"},{default:s(()=>[n("div",wo,[n("div",null,[n("div",{style:ke(e.backgroundStyle)},[a(m,{autoplay:4e3,"wrap-around":!0,itemsToShow:1.2,transition:600,style:{"padding-top":"20px"}},{addons:s(()=>[a(l)]),default:s(()=>[(r(!0),v(x,null,z(e.totalStats,f=>(r(),R(u,{key:f},{default:s(()=>[n("div",$o,[n("div",So,_(f.value),1),n("div",ko,_(f.name),1)])]),_:2},1024))),128))]),_:1})],4)]),a(C,{class:"section"},{default:s(()=>[a(c,null,{default:s(()=>[a(d,{class:"cardTitle"},{default:s(()=>t[5]||(t[5]=[P(" Clients due ",-1)])),_:1,__:[5]})]),_:1}),a(D,null,{default:s(()=>{var f,O,I;return[n("div",Io,[n("div",{class:"dueCard",onClick:t[0]||(t[0]=B=>e.openDueModal("Client due today")),style:{border:"1px solid rgb(158, 207, 136)"}},[n("div",Ao,_(((f=e.reportData)==null?void 0:f.due_today_count)||0),1),t[6]||(t[6]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(239, 221, 121)"},onClick:t[1]||(t[1]=B=>e.openDueModal("Client due this week"))},[n("div",Po,_(((O=e.reportData)==null?void 0:O.due_this_week_count)||0),1),t[7]||(t[7]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(241, 154, 154)"},onClick:t[2]||(t[2]=B=>e.openDueModal("Client due this month"))},[n("div",No,_(((I=e.reportData)==null?void 0:I.due_this_month_count)||0),1),t[8]||(t[8]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),a(C,{class:"section"},{default:s(()=>[a(c,null,{default:s(()=>[a(d,{class:"cardTitle"},{default:s(()=>t[9]||(t[9]=[P(" Clients overdue ",-1)])),_:1,__:[9]})]),_:1}),a(D,null,{default:s(()=>{var f,O;return[n("div",To,[n("div",{class:"overDueCard",onClick:t[3]||(t[3]=I=>e.openDueModal("Client overdue under 5yrs"))},[n("div",Oo,_(((f=e.reportData)==null?void 0:f.under_five_overdue)||0),1),t[10]||(t[10]=n("div",{class:"statsText"},"Under 5yrs",-1))]),n("div",{class:"overDueCard",onClick:t[4]||(t[4]=I=>e.openDueModal("Client overdue over 5yrs"))},[n("div",Vo,_(((O=e.reportData)==null?void 0:O.over_five_overdue)||0),1),t[11]||(t[11]=n("div",{class:"statsText"},"Over 5yrs",-1))])])]}),_:1})]),_:1}),a(C,{class:"section"},{default:s(()=>[a(c,null,{default:s(()=>[a(d,{class:"cardTitle"},{default:s(()=>{var f;return[P("Today's appointments("+_((f=e.appointments)==null?void 0:f.length)+") ",1)]}),_:1})]),_:1}),a(D,null,{default:s(()=>[(r(!0),v(x,null,z(e.appointments,(f,O)=>(r(),v("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:O,onClick:I=>e.openClientProfile(f.npid)},[n("div",Bo,[n("div",{class:ee(f.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[a(y,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:e.person},null,8,["icon"])],2)]),n("div",Lo,[n("div",Mo,[n("div",Fo,[n("div",xo,_(f.given_name)+" "+_(f.family_name),1)]),n("div",Eo,[n("div",Uo,[P(_(f.gender=="M"?"Male":"Female")+" ",1),t[12]||(t[12]=n("span",{class:"dot"},".",-1)),P(_(e.formatBirthdate(f.birthdate)),1)])]),n("div",null,"Village: "+_(f==null?void 0:f.city_village),1)])])],8,Ro))),128))]),_:1})]),_:1})])]),_:1})}const Ho=H(Co,[["render",Wo],["__scopeId","data-v-a8eeb2dc"]]),zo=W({components:{DataTable:Ve},props:{title:{type:String,default:""},list:{type:String,default:""},buttonTitle:{type:String,default:""},buttonLink:{type:String,default:""}},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:e=>this.waitingTime(e),width:"15%"},{title:"Actions",data:null,render:(e,t,o)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px";const p="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",b=(u,l,m)=>{const d=document.createElement("ion-button");return d.innerText=u,d.size="small",d.fill="solid",d.color=l,d.style.cssText=p,d.addEventListener("click",m),d};return i.appendChild(b(this.buttonTitle,"primary",()=>this.navigateTo(o.patient_id,this.buttonLink))),i.appendChild(b("Profile","warning",()=>this.navigateTo(o.patient_id,"/patientProfile"))),i.appendChild(b("Abscond","danger",()=>this.handleAbscond(o.patient_id))),i},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},computed:{...q(Ie,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{patientsWaitingForConsultation:{handler(e){this.list==="CONSULTATION"&&(this.patients=e)},deep:!0},patientsWaitingForVitals:{handler(e){this.list==="VITALS"&&(this.patients=e)},deep:!0},patientsWaitingForLab:{handler(e){this.list==="LAB"&&(this.patients=e)},deep:!0},patientsWaitingForDispensation:{handler(e){this.list==="DISPENSATION"&&(this.patients=e)},deep:!0}},mounted(){this.setList()},methods:{setList(){const e={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation},t=this.list;this.patients=e[t]||[]},waitingTime(e){if(!e)return"-";const t=Date.now()-new Date(e).getTime(),o=Math.floor(t/6e4);if(o<1)return"Just now";if(o<60)return"".concat(o," min").concat(o>1?"s":""," ago");const i=Math.floor(o/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const p=Math.floor(i/24);return"".concat(p," day").concat(p>1?"s":""," ago")},async navigateTo(e,t){console.log("Patient",e);let o=[];if(E.getUseIndexDBStatus()||E.getModsStatus()?(o=await Ae("patientRecords",{whereClause:{patientID:e}}),o=o[0]):o=await E.getJson("/patients/".concat(e,"/get_patient_record")),!o||o.length===0){Ee("Patient not found in offline records.");return}const i=o;await te().setPatientRecord(i),this.$router.push(t)},async handleAbscond(e){try{const t=String(localStorage.getItem("locationID"));await bn({patient_id:e}),await Ie().refresh(t)}catch(t){console.error("Failed to abscond patient:",t)}},dismiss(){Re.dismiss()}}}),jo={class:"modal-container"},Jo={class:"dueCardContent"};function Go(e,t,o,i,p,b){const u=g("ion-button"),l=g("ion-card-title"),m=g("ion-card-header"),d=g("DataTable"),c=g("ion-card-content"),D=g("ion-card");return r(),v("div",jo,[a(u,{class:"close-button",fill:"clear",size:"large",onClick:e.dismiss},{default:s(()=>t[0]||(t[0]=[P(" Close ",-1)])),_:1,__:[0]},8,["onClick"]),a(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:s(()=>[a(m,null,{default:s(()=>[a(l,{class:"sectionTitle"},{default:s(()=>[P(_(e.title),1)]),_:1})]),_:1}),a(c,null,{default:s(()=>[n("div",Jo,[a(d,{data:e.patients,columns:e.tableColumns,class:"display nowrap compact",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})])}const Qo=H(zo,[["render",Go],["__scopeId","data-v-6b4bbb15"]]),Yo=W({components:{IonContent:ae,IonHeader:ne,IonItem:de,IonList:le,IonIcon:G,IonCard:Pe,IonCardHeader:ut,IonCardTitle:ct,IonCardContent:We,IonPopover:ft,DataTable:Ve},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:je,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:e=>this.waitingTime(e),width:"20%"},{title:"Actions",data:null,render:(e,t,o)=>{const i=document.createElement("div");i.style.display="flex",i.style.gap="6px";const p="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",b=(u,l,m)=>{const d=document.createElement("ion-button");return d.innerText=u,d.size="small",d.fill="solid",d.color=l,d.style.cssText=p,d.addEventListener("click",m),d};return i.appendChild(b("Profile","warning",()=>this.navigateTo(o.patient_id,"/patientProfile"))),i},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const e=String(localStorage.getItem("locationID")),t=new Date().toISOString().split("T")[0],o=await Dn(),i=o.filter(l=>String(l.location_id)===e&&l.startDate>="".concat(t,"T00:00:00")&&l.startDate<="".concat(t,"T23:59:59")),p=o.map(l=>l.patientId);let b=[];E.getModsStatus()||E.getUseIndexDBStatus()?b=await Ae("patientRecords",{inClause:{patientID:p}})||[]:b=await E.getJson("get_patient_record",{patient_ids:p,paginate:!1});const u={};b.forEach(l=>{u[l.patientID]=l,u[String(l.patientID)]=l}),this.patients=i.map(l=>{var c,D,C;const m=u[l.patientId]||{};return{fullName:[(c=m==null?void 0:m.personInformation)==null?void 0:c.given_name,(D=m==null?void 0:m.personInformation)==null?void 0:D.middle_name,(C=m==null?void 0:m.personInformation)==null?void 0:C.family_name].filter(Boolean).join(" ").trim()||"Unknown (ID: ".concat(l.patientId,")"),arrivalTime:l.startDate,patient_id:l.patientId}})},methods:{openPopover(e){this.event=e,this.popoverOpen=!0},dismiss(){Re.dismiss()},waitingTime(e){if(!e)return"-";const t=Date.now()-new Date(e).getTime(),o=Math.floor(t/6e4);if(o<1)return"Just now";if(o<60)return"".concat(o," min").concat(o>1?"s":""," ago");const i=Math.floor(o/60);if(i<24)return"".concat(i," hour").concat(i>1?"s":""," ago");const p=Math.floor(i/24);return"".concat(p," day").concat(p>1?"s":""," ago")},async navigateTo(e,t){const o=await ye.findByID(e);await te().setPatientRecord(o),this.$router.push(t)}}}),qo={class:"modal-container"},Zo={class:"dueCardContent"};function Xo(e,t,o,i,p,b){const u=g("ion-button"),l=g("ion-card-title"),m=g("ion-card-header"),d=g("DataTable"),c=g("ion-card-content"),D=g("ion-card");return r(),v("div",qo,[a(u,{class:"close-button",fill:"clear",size:"large",onClick:e.dismiss},{default:s(()=>t[0]||(t[0]=[P(" Close ",-1)])),_:1,__:[0]},8,["onClick"]),a(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:s(()=>[a(m,null,{default:s(()=>[a(l,{class:"sectionTitle"},{default:s(()=>[P(_(e.title),1)]),_:1})]),_:1}),a(c,null,{default:s(()=>[n("div",Zo,[a(d,{data:e.patients,columns:e.tableColumns,class:"display nowrap compact",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})])}const Ko=H(Yo,[["render",Xo],["__scopeId","data-v-8b0a446b"]]),ei=W({name:"OPDAppointmentsModal",components:{IonPage:Oe,IonHeader:ne,IonContent:ae,IonItem:de,IonList:le,IonIcon:G,IonCard:Pe,IonCardContent:We,IonPopover:ft,DataTable:Ve,IonSegment:He,IonSegmentButton:ue,IonLabel:he,IonRow:Te,IonCol:Ne,DateInputField:Je},props:{title:{type:String,default:"OPD Appointments"},programType:{type:String,required:!0},programId:{type:Number,required:!0}},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:je,appointments:[],viewMode:"today",startDate:k.sessionDate(),endDate:k.sessionDate(),calendarOutline:fe,openOutline:pt,tableColumns:[{title:"Patient ID",data:"ID"},{title:"Name",data:"name"},{title:"Age/DOB",data:"ageDob"},{title:"Gender",data:"gender"},{title:"Village",data:"village"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(e,t,o)=>{const i=document.createElement("div"),p=document.createElement("ion-button");return p.innerText="Profile",p.size="small",p.style.color="#fff",p.style.padding="8px 12px",p.style.marginRight="8px",p.addEventListener("click",()=>this.openClientProfile(o.ID)),i.appendChild(p),i},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,dom:"Bfrtip",order:[[5,"asc"]]}}},async mounted(){await this.loadAppointments()},methods:{async loadAppointments(){var e,t;this.isLoading=!0;try{const o=k.sessionDate(),i=this.viewMode==="today"?o:this.startDate,p=this.viewMode==="today"?o:this.endDate,b=localStorage.getItem("locationID"),u=await Ae("patientRecords"),l=[];for(const m of u)[...((e=m.appointments)==null?void 0:e.saved)||[],...((t=m.appointments)==null?void 0:t.unsaved)||[]].filter(D=>{if(D.concept_id!==5096||D.program_id!==14||D.location_id!==b)return!1;const C=D.value_datetime||D.obs_datetime;if(!C)return!1;const y=k.toStandardHisFormat(C),w=k.toStandardHisFormat(i),f=k.toStandardHisFormat(p);return y>=w&&y<=f}).forEach(D=>{var C,y,w,f,O;l.push({ID:m.ID,name:[(C=m.personInformation)==null?void 0:C.given_name,(y=m.personInformation)==null?void 0:y.family_name].filter(Boolean).join(" ")||"Unknown",ageDob:(w=m.personInformation)!=null&&w.birthdate?k.getBirthdateAge(m.personInformation.birthdate):"N/A",gender:((f=m.personInformation)==null?void 0:f.gender)||"Unknown",village:((O=m.personInformation)==null?void 0:O.home_village)||"Unknown",appointmentDate:k.toStandardHisDisplayFormat(D.value_datetime||D.obs_datetime),rawData:D})});this.appointments=l.sort((m,d)=>{const c=m.rawData.value_datetime||m.rawData.obs_datetime,D=d.rawData.value_datetime||d.rawData.obs_datetime;return new Date(c).getTime()-new Date(D).getTime()})}catch(o){console.error("Error loading appointments:",o),Ee("Failed to load appointments")}finally{this.isLoading=!1}},async getAppointmentsD1(e){this.startDate=k.toStandardHisFormat(e),await this.loadAppointments()},async getAppointmentsD2(e){this.endDate=k.toStandardHisFormat(e),await this.loadAppointments()},onViewModeChange(){this.viewMode==="today"&&(this.startDate=k.sessionDate(),this.endDate=k.sessionDate()),this.loadAppointments()},async openClientProfile(e){try{const t=await Ae("patientRecords",{whereClause:{ID:e}});await te().setPatientRecord(t[0]),this.$router.push("patientProfile")}catch(t){console.error("Error opening profile:",t),Ee("Failed to open patient profile")}},openPopover(e){this.event=e,this.popoverOpen=!0},dismiss(){Re.dismiss()}}}),ti={class:"header position_content"},ni={style:{"font-size":"1.2em","font-weight":"700"}},ai={key:0,class:"date-filter"},si={class:"dueCardContent"},oi={key:1,class:"no-appointments"};function ii(e,t,o,i,p,b){const u=g("ion-icon"),l=g("ion-header"),m=g("ion-label"),d=g("ion-segment-button"),c=g("ion-segment"),D=g("DateInputField"),C=g("ion-col"),y=g("ion-row"),w=g("DataTable"),f=g("ion-card-content"),O=g("ion-card"),I=g("ion-content"),B=g("ion-page");return r(),R(B,null,{default:s(()=>[a(l,null,{default:s(()=>[n("div",ti,[n("div",{style:{display:"flex","align-items":"center"},onClick:t[0]||(t[0]=(...Q)=>e.dismiss&&e.dismiss(...Q))},[a(u,{slot:"separator",size:"large",icon:e.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",ni,_(e.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:t[1]||(t[1]=Q=>e.openPopover(Q))},[a(u,{slot:"separator",size:"large",icon:e.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),a(I,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:s(()=>[a(c,{modelValue:e.viewMode,"onUpdate:modelValue":t[2]||(t[2]=Q=>e.viewMode=Q),onIonChange:e.onViewModeChange},{default:s(()=>[a(d,{value:"today"},{default:s(()=>[a(m,null,{default:s(()=>t[3]||(t[3]=[P("Today's Appointments",-1)])),_:1,__:[3]})]),_:1}),a(d,{value:"range"},{default:s(()=>[a(m,null,{default:s(()=>t[4]||(t[4]=[P("Date Range",-1)])),_:1,__:[4]})]),_:1})]),_:1},8,["modelValue","onIonChange"]),e.viewMode==="range"?(r(),v("div",ai,[a(y,null,{default:s(()=>[a(C,null,{default:s(()=>[a(D,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:e.endDate,disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1},null,8,["icon","inputValue","maxDate","onUpdate:rawDateValue"])]),_:1}),a(C,null,{default:s(()=>[a(D,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):S("",!0),a(O,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:s(()=>[a(f,null,{default:s(()=>[n("div",si,[e.appointments.length>0?(r(),R(w,{key:0,data:e.appointments,columns:e.tableColumns,options:e.tableOptions,class:"display nowrap",width:"100%"},null,8,["data","columns","options"])):(r(),v("div",oi," No appointments found for the selected "+_(e.viewMode==="today"?"day":"date range"),1))])]),_:1})]),_:1})]),_:1})]),_:1})}const ri=H(ei,[["render",ii],["__scopeId","data-v-54fbae83"]]),li={class:"card-count"},di={class:"card-label"},ci="#ffffff",ui=W({__name:"DashboardCard",props:{icon:{},count:{},label:{},color:{}},emits:["cardClick"],setup(e,{emit:t}){const p={success:"#A5D6A7",info:"#81D4FA",warning:"#FFF59D",danger:"#EF9A9A"}[e.color||"info"]||"#E0E0E0";return(b,u)=>(r(),R(T(Pe),{class:"dashboard-card",style:ke({borderColor:T(p),backgroundColor:ci}),onClick:u[0]||(u[0]=l=>b.$emit("cardClick"))},{default:s(()=>[a(T(G),{icon:b.icon,class:"card-icon"},null,8,["icon"]),n("div",li,_(b.count),1),n("div",di,_(b.label),1)]),_:1},8,["style"]))}}),pi=H(ui,[["__scopeId","data-v-84ad3c1b"]]),mi=W({name:"OPDDashboard",components:{DashboardCard:pi},data(){return{totalPatientsToday:0,canViewVitals:!1,canViewConsultation:!1,canViewLab:!1,canViewDispensation:!1,canViewAppointments:!1,userRoles:[]}},computed:{...q(Ie,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","patientsVisits","todaysAppointmentsCount"])},watch:{$route(e,t){this.reloadRolePermissions()}},async mounted(){this.reloadRolePermissions();const e=E.getUserLocationId();e&&await Ie().refresh(e)},methods:{medkit(){return lt},flask(){return dn},clipboard(){return st},thermometer(){return ot},calendar(){return ln},people(){return it},reloadRolePermissions(){this.loadUserRoles(),this.updateCardVisibility()},loadUserRoles(){localStorage.getItem("userRoles");try{const e=localStorage.getItem("userRoles")||"[]",t=JSON.parse(e);this.userRoles=t.map(o=>typeof o=="string"?o:o.role||o.name||"")}catch(e){this.userRoles=[]}},hasAnyRole(e){const t=this.userRoles.map(o=>o.toLowerCase());return e.some(o=>t.includes(o.toLowerCase()))},updateCardVisibility(){this.canViewVitals=this.hasAnyRole(["Clinician","Nurse","Superuser"]),this.canViewConsultation=this.hasAnyRole(["Clinician","Superuser"]),this.canViewLab=this.hasAnyRole(["Lab"]),this.canViewDispensation=this.hasAnyRole(["Clinician","Pharmacist","Superuser"]),this.canViewAppointments=this.hasAnyRole(["Clinician","Nurse","Superuser"])},openAllModal(e,t,o){we(Ko,{class:"fullScreenModal"},!0,{title:e,buttonTitle:t,buttonLink:o})},openPatientsListModal(e,t,o,i){we(Qo,{class:"fullScreenModal"},!0,{title:e,list:t,buttonTitle:o,buttonLink:i})},openAppointmentsModal(e,t){we(ri,{class:"fullScreenModal"},!0,{title:e,programType:t,programId:14})}}}),hi={class:"dashboard-wrapper"};function gi(e,t,o,i,p,b){const u=g("ion-icon"),l=g("ion-card-title"),m=g("ion-card-header"),d=g("DashboardCard"),c=g("ion-row"),D=g("ion-grid"),C=g("ion-card-content"),y=g("ion-card"),w=g("ion-content");return r(),R(w,{fullscreen:!0},{default:s(()=>[n("div",hi,[a(y,{class:"dashboard-card"},{default:s(()=>[a(m,{class:"dashboard-card-header"},{default:s(()=>[a(l,{class:"dashboard-title"},{default:s(()=>[a(u,{icon:e.people(),slot:"start",class:"dashboard-icon"},null,8,["icon"]),t[6]||(t[6]=P(" Today's Patients Overview ",-1))]),_:1,__:[6]})]),_:1}),a(C,null,{default:s(()=>[a(D,{class:"centered-grid"},{default:s(()=>[a(c,{class:"centered-row"},{default:s(()=>[a(d,{icon:e.people(),color:"primary",count:e.patientsVisits.length,label:"Total patients today",onCardClick:t[0]||(t[0]=f=>e.openAllModal("All patients today","View profile","/patientProfile"))},null,8,["icon","count"]),e.canViewAppointments?(r(),R(d,{key:0,icon:e.calendar(),color:"primary",count:e.todaysAppointmentsCount.length,label:"Appointments",onCardClick:t[1]||(t[1]=f=>e.openAppointmentsModal("OPD Appointments","14"))},null,8,["icon","count"])):S("",!0),e.canViewVitals?(r(),R(d,{key:1,icon:e.thermometer(),color:"primary",count:e.patientsWaitingForVitals.length,label:"Waiting for vitals",onCardClick:t[2]||(t[2]=f=>e.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals"))},null,8,["icon","count"])):S("",!0),e.canViewConsultation?(r(),R(d,{key:2,icon:e.clipboard(),color:"primary",count:e.patientsWaitingForConsultation.length,label:"Waiting for consultation",onCardClick:t[3]||(t[3]=f=>e.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan"))},null,8,["icon","count"])):S("",!0),e.canViewLab?(r(),R(d,{key:3,icon:e.flask(),color:"primary",count:e.patientsWaitingForLab.length,label:"Waiting for lab",onCardClick:t[4]||(t[4]=f=>e.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan"))},null,8,["icon","count"])):S("",!0),e.canViewDispensation?(r(),R(d,{key:4,icon:e.medkit(),color:"primary",count:e.patientsWaitingForDispensation.length,label:"Waiting for dispensation",onCardClick:t[5]||(t[5]=f=>e.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations"))},null,8,["icon","count"])):S("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})}const fi=H(mi,[["render",gi],["__scopeId","data-v-07aedaee"]]),_i=W({name:"NCDDashboard",mixins:[Ce],components:{ApexChart:Dt},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await dt(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return E.getJson("programs/32/reports/ncd_dashboard",{start_date:k.toStandardHisFormat(k.sessionDate()),end_date:k.toStandardHisFormat(k.sessionDate())})}}}),vi={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},yi={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},bi={ref:"chartRef1"},Di={ref:"chartRef2"};function Ci(e,t,o,i,p,b){const u=g("ion-card-content"),l=g("ion-card"),m=g("ApexChart");return r(),v(x,null,[n("div",vi,[a(l,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(u,null,{default:s(()=>t[0]||(t[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])),_:1,__:[0]})]),_:1}),a(l,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(u,null,{default:s(()=>t[1]||(t[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])),_:1,__:[1]})]),_:1}),a(l,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(u,null,{default:s(()=>t[2]||(t[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])),_:1,__:[2]})]),_:1}),a(l,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:s(()=>[a(u,null,{default:s(()=>t[3]||(t[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])),_:1,__:[3]})]),_:1})]),n("div",yi,[a(l,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(u,null,{default:s(()=>[t[4]||(t[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",bi,[e.isChartReady?(r(),R(m,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:e.barChartOptions,series:e.barChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1,__:[4]})]),_:1}),a(l,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:s(()=>[a(u,null,{default:s(()=>[t[5]||(t[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",Di,[e.isChartReady?(r(),R(m,{key:0,style:{width:"100%",height:"500px"},type:"line",options:e.lineChartOptions,series:e.lineChartSeries},null,8,["options","series"])):S("",!0)],512)]),_:1,__:[5]})]),_:1})])],64)}const wi=H(_i,[["render",Ci],["__scopeId","data-v-58e2a3d8"]]),$i=W({name:"Home",mixins:[_t,Ce],components:{IonContent:ae,IonHeader:ne,IonPage:Oe,IonToolbar:re,Toolbar:yt,IonRow:Te,DateInputField:Je,IonIcon:G,IonButton:$e,IonCol:Ne},data(){const e=V(k.sessionDate()),t=V(k.sessionDate()),o=V(k.sessionDate()),i=V([]);return{segmentContent:"Today",minDate:o,startDate:e,endDate:t,people:i,calendarOutline:fe,eyeOutline:gt}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(e){this.segmentContent=e},formatBirthdate(e){return k.getBirthdateAge(e)},async getAppointments(){this.people=[],(await Ct.getAppointments(this.startDate,this.endDate,"")).forEach(t=>{const o={person_id:t.person_id,npid:t.npid,appointment_id:103,encounter_id:t.encounter_id,name:t.given_name.concat(" ",t.family_name),gender:t.gender,ageDob:this.formatBirthdate(t.birthdate),village:t.city_village,appointmentDate:k.toStandardHisDisplayFormat(t.appointment_date)};this.people.push(o)})},async getAppointmentsD1(e){this.startDate=k.toStandardHisFormat(e),await this.getAppointments()},async getAppointmentsD2(e){this.endDate=k.toStandardHisFormat(e),await this.getAppointments()},async openClientProfile(e){await ye.findByNpid(e),this.isPharmacist()},isPharmacist(){const e=JSON.parse(localStorage.getItem("userRoles")),t=e||[];t.some(o=>t.some(i=>i.role==="Pharmacist"))&&(this.$router.push("dispensation"),E.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),Si={class:"appointments-container"},ki={key:0,class:"date-filter"},Ii={class:"appointments-table"};function Ai(e,t,o,i,p,b){const u=g("ion-label"),l=g("ion-segment-button"),m=g("ion-segment"),d=g("DateInputField"),c=g("ion-col"),D=g("ion-row"),C=g("ion-icon"),y=g("ion-button"),w=g("ion-card");return r(),v("div",Si,[n("div",null,[a(m,{value:e.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:s(()=>[a(l,{value:"Today",onClick:t[0]||(t[0]=f=>e.setSegmentContent("Today"))},{default:s(()=>[a(u,null,{default:s(()=>t[3]||(t[3]=[P("Today",-1)])),_:1,__:[3]})]),_:1}),a(l,{value:"Tomorrow",onClick:t[1]||(t[1]=f=>e.setSegmentContent("Tomorrow"))},{default:s(()=>[a(u,null,{default:s(()=>t[4]||(t[4]=[P("Tomorrow",-1)])),_:1,__:[4]})]),_:1}),a(l,{value:"Date range",onClick:t[2]||(t[2]=f=>e.setSegmentContent("Date range"))},{default:s(()=>[a(u,null,{default:s(()=>t[5]||(t[5]=[P("Date range",-1)])),_:1,__:[5]})]),_:1})]),_:1},8,["value"])]),e.segmentContent==="Date range"?(r(),v("div",ki,[a(D,null,{default:s(()=>[a(c,null,{default:s(()=>[a(d,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),a(c,null,{default:s(()=>[a(d,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:e.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:e.endDate,eventType:"",minDate:e.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":e.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):S("",!0),e.people.length>0?(r(),R(w,{key:1},{default:s(()=>[n("table",Ii,[t[6]||(t[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(r(!0),v(x,null,z(e.people,f=>(r(),v("tr",{key:f.npid},[n("td",null,[a(D,null,{default:s(()=>[a(c,null,{default:s(()=>[P(_(f.name),1)]),_:2},1024),a(c,null,{default:s(()=>[a(y,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:O=>e.openClientProfile(f.npid),color:"primary",fill:"clear",size:"small"},{default:s(()=>[a(C,{icon:e.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,_(f.npid),1),n("td",null,_(f.ageDob),1),n("td",null,_(f.gender),1),n("td",null,_(f.village),1),n("td",null,_(f.appointmentDate),1)]))),128))])])]),_:1})):(r(),R(w,{key:2},{default:s(()=>t[7]||(t[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])),_:1,__:[7]}))])}const Pi=H($i,[["render",Ai],["__scopeId","data-v-c47f7768"]]),Ni=W({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(e){}}}),Ti={key:0},Oi={style:{display:"flex","margin-top":"10px"}},Vi={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},Ri={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},Bi={key:1};function Li(e,t,o,i,p,b){const u=g("ion-label"),l=g("ion-segment-button"),m=g("ion-segment"),d=g("VisitsHistory");return r(),v(x,null,[n("div",null,[a(m,{value:e.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:s(()=>[a(l,{value:"Internal referrals",onClick:t[0]||(t[0]=c=>e.setSegmentContent("Internal referrals"))},{default:s(()=>[a(u,null,{default:s(()=>t[2]||(t[2]=[P("Internal referrals",-1)])),_:1,__:[2]})]),_:1}),a(l,{value:"External referrals",onClick:t[1]||(t[1]=c=>e.setSegmentContent("External referrals"))},{default:s(()=>[a(u,null,{default:s(()=>t[3]||(t[3]=[P("External referrals",-1)])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),e.segmentContent=="Internal referrals"?(r(),v("div",Ti,[n("div",Oi,[e.checkUnderFive?(r(),v("div",Vi)):S("",!0),t[4]||(t[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),e.checkUnderFive?S("",!0):(r(),v("div",Ri))])])):S("",!0),e.segmentContent=="External referrals"?(r(),v("div",Bi,[a(d)])):S("",!0)],64)}const Mi=H(Ni,[["render",Li],["__scopeId","data-v-faad8f8b"]]),Fi=W({name:"Menu",components:{IonContent:ae,IonHeader:ne,IonItem:de,IonList:le,IonMenu:ve,IonTitle:_e,IonToolbar:re,IonCheckbox:Be,IonIcon:G,BasicForm:De,BasicCard:Le,Referrals:Mi,Dashboard:wi,ANCAppointments:Pi},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:mt},{id:"referrals",label:"Referrals",icon:ht},{id:"appointments",label:"Appointments",icon:fe}],activeItem:"dashboard"}},computed:{...q(be,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),xi={style:{display:"flex"}},Ei={class:"left_col"},Ui={class:"nav-menu"},Wi=["onClick"],Hi={class:"right_col"};function zi(e,t,o,i,p,b){const u=g("ion-icon"),l=g("Dashboard"),m=g("ANCAppointments"),d=g("Referrals");return r(),v("div",xi,[n("div",Ei,[n("nav",Ui,[n("ul",null,[(r(!0),v(x,null,z(e.menuItems,c=>(r(),v("li",{key:c.id,class:ee({active:e.activeItem===c.id}),onClick:D=>e.setActiveItem(c.id)},[a(u,{icon:c.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,_(c.label),1)],10,Wi))),128))])])]),n("div",Hi,[n("div",null,[e.activeItem==="dashboard"?(r(),R(l,{key:0})):S("",!0),e.activeItem==="appointments"?(r(),R(m,{key:1})):S("",!0),e.activeItem==="referrals"?(r(),R(d,{key:2})):S("",!0)])])])}const ji=H(Fi,[["render",zi],["__scopeId","data-v-7e786ea4"]]),Ji=W({name:"Menu",components:{IonContent:ae,IonHeader:ne,IonItem:de,IonList:le,IonMenu:ve,IonTitle:_e,IonToolbar:re,IonCheckbox:Be,BasicForm:De,BasicCard:Le},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...q(be,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),Gi={class:"left_col"},Qi={class:"nav-menu"},Yi=["onClick"];function qi(e,t,o,i,p,b){return r(),v("div",null,[n("div",Gi,[n("nav",Qi,[n("ul",null,[(r(!0),v(x,null,z(e.menuItems,u=>(r(),v("li",{key:u.id,class:ee({active:e.activeItem===u.id}),onClick:l=>e.setActiveItem(u.id)},_(u.label),11,Yi))),128))])])]),t[0]||(t[0]=n("div",{class:"right_col"},null,-1))])}const Zi=H(Ji,[["render",qi],["__scopeId","data-v-32dd02d3"]]),Xi=W({name:"Menu",components:{IonContent:ae,IonHeader:ne,IonItem:de,IonList:le,IonMenu:ve,IonTitle:_e,IonToolbar:re,IonCheckbox:Be,BasicForm:De,BasicCard:Le},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...q(be,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(e){this.activeItem=e}}}),Ki={class:"left_col"},er={class:"nav-menu"},tr=["onClick"];function nr(e,t,o,i,p,b){return r(),v("div",null,[n("div",Ki,[n("nav",er,[n("ul",null,[(r(!0),v(x,null,z(e.menuItems,u=>(r(),v("li",{key:u.id,class:ee({active:e.activeItem===u.id}),onClick:l=>e.setActiveItem(u.id)},_(u.label),11,tr))),128))])])]),t[0]||(t[0]=n("div",{class:"right_col"},null,-1))])}const ar=H(Xi,[["render",nr],["__scopeId","data-v-b49d8600"]]);function sr(){const e=ze(),t=Fe(),o=V(!1),{OPDActivities:i,NCDActivities:p}=Se(t),b=async l=>{var m;try{const d=E.getUserID(),c=await bt.getJson("user_properties",{user_id:d,property:l});return c!=null&&c.property_value?(m=c==null?void 0:c.property_value)==null?void 0:m.split(","):[]}catch(d){return console.error("Error fetching user activities:",d),[]}},u=async()=>{try{o.value=!1;const[l,m]=await Promise.all([b("OPD_activities"),b("NCD_activities")]);l.length>0&&t.setOPDActivity(l),m.length>0&&t.setNCDActivity(m)}catch(l){console.error("Error updating activities:",l)}finally{o.value=!0}};return ie(()=>e.path,async()=>{await u()},{immediate:!0,deep:!0}),{ready:o,OPDActivities:i,NCDActivities:p,getUserActivities:b,updateActivities:u}}function or(){const e=ze(),t=V(""),o=V(!1),i=V({}),p=()=>{const b=E.getUserRoles(),u=E.getProgramID(),l=E.getProgramName();t.value=b,o.value=!1,b==="Lab"&&u===14?i.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:u===14&&b!=="Lab"?i.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:u===12?i.value={url:"contact",btnName:"Back"}:l==="LABOUR AND DELIVERY PROGRAM"?i.value={url:"labour/labourHome",btnName:"Back to home"}:l==="PNC PROGRAM"?i.value={url:"pnc/home",btnName:"Back to home"}:i.value={url:"",btnName:""},o.value=!0};return ie(()=>e.path,()=>{p()},{immediate:!0,deep:!0}),{userRole:t,ready:o,userRoleSettings:i,updateUserRoleSettings:p}}const ir={key:0,class:"spinner-overlay"},Ar=W({__name:"HomePage",setup(e){const t=V(!0),o=ze(),i=Cn(),p=V(localStorage.getItem("sessionDate")||"");or();const b=wn(),{apiStatus:u}=Se(vt()),{activeProgram:l}=Se(b),m=Y(()=>{switch(l.value.program_id){case oe.IMMUNIZATION_PROGRAM:return Ho;case oe.OPD_PROGRAM:return fi;case oe.NCD_PROGRAM:return Cs;case oe.ANC_PROGRAM:return ji;case oe.PNC_PROGRAM:return ar;case oe.LABOUR_AND_DELIVERY_PROGRAM:return Zi;case oe.HIV_PROGRAM:return so;default:return null}}),d=()=>{const C=localStorage.getItem("sessionDate");(!C||C.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),Xe()),p.value=C||""};let c=null;pe(()=>{c=()=>d(),window.addEventListener("storage",c);const C=setInterval(d,1e3);cn(()=>{clearInterval(C),c&&window.removeEventListener("storage",c)}),d()}),ie(p,(C,y)=>{(!C||C.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),Xe())}),ie(()=>o.name,async C=>{C==="Home"&&(qe(),await Ze().loadGlobalProperty(),i.initWorker(),i.postData("SYNC_ALL_DATA"))},{immediate:!0,deep:!0});const D=async()=>{try{const C=E.getUserID(),y=await bt.getUserByID(C);if(y.location_id!=null){const w=await Sn.getLocation(y.location_id);localStorage.setItem("locationData",JSON.stringify(w))}}catch(C){console.error("Failed to retrieve location data:",C)}};return u.value&&(sr(),D()),pe(async()=>{try{t.value=!0,i.terminate(),qe(),await Ze().loadGlobalProperty(),ge.isEmpty(l.value)&&await $n.show(In,{},"module-picker-modal")}catch(C){console.error("Error initializing component:",C)}finally{t.value=!1}}),(C,y)=>{const w=g("ion-spinner"),f=g("ion-content");return r(),R(T(Oe),null,{default:s(()=>[t.value?(r(),v("div",ir,[a(w,{name:"bubbles"}),y[0]||(y[0]=n("div",{class:"loading-text"},"Please wait...",-1))])):S("",!0),a(yt),a(An),m.value?(r(),R(un(m.value),{key:1})):(r(),R(f,{key:2},{default:s(()=>y[1]||(y[1]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])),_:1,__:[1]}))]),_:1})}}});export{Ar as default};

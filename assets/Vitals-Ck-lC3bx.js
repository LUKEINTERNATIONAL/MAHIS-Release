import{d as y,ar as f,b8 as E,D as B,G as C,M as P,J as z,a_ as F,ca as L,a$ as M,aZ as N,b0 as O,W,U as $,T as A,af as H,ba as R,S as U,a9 as G,a2 as J,bG as Z,E as p,y as j,f as g,z as S,e as q,m as Y,l as m,k as K}from"./vendor-BBnHTtmR.js";import{z as Q,T as X,h as x,a_ as I,H as v,aZ as w,m as _,j as V,t as b,S as T,y as k,aw as aa,aJ as ta,x as sa,a1 as ea,u as ia,i as oa,_ as ra}from"./index-53Jeodb6.js";import{B as na}from"./BasicFooter-LlWEMQJQ.js";import{D as la}from"./DemographicBar-DIXLi_F8.js";import{S as ca}from"./SaveProgressModal-CHnc_RZA.js";import{S as ha}from"./Stepper-D_EaV_EM.js";import{d as pa,a as da}from"./formatServerData-8bR_ULMJ.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-DmuMXiXt.js";import"./lab_order-CWAB0aU6.js";import"./BasicForm-DbOjOBd7.js";import"./DateInputField-IBJdGgd7.js";import"./DashBox-Ca0K8opj.js";import"./group_validation-XbkYdF_9.js";import"./OPDOutcome-BaQS0CgE.js";import"./patient_complaints_service-bKwpj5R5.js";import"./useExposeFromStandardForm-gMyqG7XP.js";import"./NextAppointment-7bCHb1l2.js";import"./drug_prescription_service-JB9D9sgM.js";import"./drug_service-BhWD6soH.js";import"./ncd_appointment_service-CqWvWasq.js";import"./BasicCard-wIQ3Q9mF.js";import"./LabTestsHistory-DIveu_k6.js";import"./userService-CA2f_DOi.js";import"./Outcome-DSwElFEP.js";import"./TreatmentPlan-CcFS1dDR.js";import"./previousDiagnosis-C5QUBi45.js";import"./FeatusModal-DZvh9pJV.js";import"./PastObstreticHistoryStore-CiArkgqe.js";import"./UpcomingFeature-P5EIs2iu.js";const ma=y({name:"Home",components:{IonContent:G,IonHeader:U,IonMenuButton:R,IonPage:H,IonTitle:A,IonToolbar:$,Toolbar:X,ToolbarSearch:Q,DemographicBar:la,IonButton:W,IonCard:O,IonCardContent:N,IonCardHeader:M,IonCardSubtitle:L,IonCardTitle:F,IonAccordion:z,IonAccordionGroup:P,IonItem:C,IonLabel:B,IonModal:E,Stepper:ha,BasicFooter:na},data(){return{isLoading:!1,hasValidationErrors:[],outcomes:"",actionBtn:"",wizardData:[{title:"Vital Signs",class:"common_step",checked:!1,disabled:!1,number:1,last_step:"last_step"}],StepperData:[{title:"Vital Signs",component:"VitalSigns",value:"1"}],isOpen:!1,iconsContent:oa}},computed:{...f(ia,["patient"]),...f(ea,["vitals"]),"Height Weight Reason"(){return sa(this.vitals,"Height Weight Reason","value")}},async created(){},mounted(){this.markWizard()},watch:{vitals:{handler(){this.markWizard()},deep:!0},investigations:{handler(){this.markWizard()},deep:!0},diagnosis:{handler(){this.markWizard()},deep:!0},selectedMedicalDrugsList:{handler(){this.markWizard()}}},setup(){return{chevronBackOutline:Z,checkmark:J}},methods:{markWizard(){this.actionBtn=this.vitals[0].actionBtn;const a=v.sessionDate(),l=ta("vitals").some(i=>v.toStandardHisFormat(i.obs_datetime)===v.toStandardHisFormat(a));this.vitals.validationStatus||l?(this.wizardData[0].checked=!0,this.wizardData[0].class="open_step common_step"):this.wizardData[0].checked=!1},async saveVitals(){var a,t,l,i;try{const o=localStorage.getItem("userID")||T.getUserID();await new I(this.patient.patientID,o).onFinish(this.vitals);const s=await pa(this.vitals),c=await da(this.vitals);(c.length>0||s.length>0)&&((i=(l=(t=(a=this.patient).vitals)!=null?t:a.vitals={}).unsaved)!=null||(l.unsaved=[]),this.patient.vitals.unsaved.push(...c,...s),await aa(this.patient)),k("Vitals saved successfully")}catch(o){throw console.error("Vitals save failed:",o),o}},async moveToNextStageAndRedirect(){const a=localStorage.getItem("locationID"),t=localStorage.getItem("userRoles")||T.getUserRoles();if(!a){_("Location ID not found");return}await V.movePatientToNextStage(this.patient.patientID,"VITALS","CONSULTATION",a,this.patient.visitID||this.patient.visit_id),k("Vitals have been saved!"),t.includes("Nurse")?this.$router.push("patientProfile"):this.$router.push("OPDConsultationPlan")},async getSaveFunction(){this.isLoading=!0;try{if(!(this.actionBtn==="Finish")){if(await this.validaterowData(),!this.vitals.validationStatus){b("Please fill all required fields");return}await this.saveVitals()}await w(),await this.moveToNextStageAndRedirect()}catch(a){console.error("Error in getSaveFunction: ",a)}finally{this.isLoading=!1}},async saveData(){this.isLoading=!0;try{if(this.actionBtn!="Finish")if(this.vitals.validationStatus){await this.saveVitals(),w();const a=localStorage.getItem("locationID");if(!a){_("Location ID not found");return}await V.movePatientToNextStage(this.patient.patientID,"VITALS","CONSULTATION",a,this.patient.visitID||this.patient.visit_id),this.$router.push("OPDConsultationPlan")}else await this.validaterowData(),b("Please correct validation errors in form");else this.$router.push("OPDConsultationPlan")}catch(a){console.error("Error in saveData: ",a)}finally{this.isLoading=!1}},async validaterowData(){var i,o;this.hasValidationErrors=[];const a=localStorage.getItem("userID"),t=new I(this.patient.patientID,a),l=v.getAgeInYears((o=(i=this.patient)==null?void 0:i.personInformation)==null?void 0:o.birthdate);this.vitals.forEach((r,s)=>{var c,u;(c=r==null?void 0:r.data)!=null&&c.rowData&&((u=r==null?void 0:r.data)==null||u.rowData.forEach((D,n)=>{D.colData.some((d,h)=>{if(d.name==="Respiratory rate"&&l<=5){const e=t.validator(d);if((e==null?void 0:e.length)>0)return this.hasValidationErrors.push("false"),this.vitals[s].data.rowData[n].colData[h].alertsErrorMassage=e.flat(1/0)[0],!0;this.hasValidationErrors.push("true"),this.vitals[s].data.rowData[n].colData[h].alertsErrorMassage=!1,this.vitals[s].data.rowData[n].colData[h].alertsErrorMassage=""}else{const e=t.validator(d);if((e==null?void 0:e.length)>0)return this.hasValidationErrors.push("false"),this.vitals[s].data.rowData[n].colData[h].alertsErrorMassage=e.flat(1/0)[0],!0;this.hasValidationErrors.push("true"),this.vitals[s].data.rowData[n].colData[h].alertsErrorMassage=!1,this.vitals[s].data.rowData[n].colData[h].alertsErrorMassage=""}return!1})}))}),this.vitals.validationStatus=!this.hasValidationErrors.includes("false")},openModal(){x(ca)}}}),ua={key:0,class:"spinner-overlay"};function va(a,t,l,i,o,r){const s=p("ion-spinner"),c=p("Toolbar"),u=p("DemographicBar"),D=p("Stepper"),n=p("ion-content"),d=p("ion-page");return g(),j(d,null,{default:S(()=>[a.isLoading?(g(),q("div",ua,[m(s,{name:"bubbles"}),t[1]||(t[1]=K("div",{class:"loading-text"},"Please wait...",-1))])):Y("",!0),m(c),m(n,{fullscreen:!0},{default:S(()=>[m(u),m(D,{stepperTitle:"Vitals",wizardData:a.wizardData,onUpdateStatus:a.markWizard,onFinishBtn:t[0]||(t[0]=h=>a.saveData()),StepperData:a.StepperData,getSaveFunction:a.getSaveFunction},null,8,["wizardData","onUpdateStatus","StepperData","getSaveFunction"])]),_:1})]),_:1})}const Za=ra(ma,[["render",va],["__scopeId","data-v-c26176d1"]]);export{Za as default};

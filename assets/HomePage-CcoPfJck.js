var Se=Object.defineProperty;var $e=(t,e,s)=>e in t?Se(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Z=(t,e,s)=>$e(t,typeof e!="symbol"?e+"":e,s);import{d as U,cB as Ie,ar as Kt,r as M,c as It,w as it,a as kt,e as v,f as c,k as n,m as I,p as K,B as _,l as o,u as J,ab as te,A as P,I as j,F as x,L as W,cC as ke,b$ as Ae,ay as ee,bA as Pe,bn as Oe,bT as ne,bY as Ne,E as m,z as i,R as Te,ao as X,cD as ae,cE as se,cF as oe,cG as ie,bd as Ve,cH as re,cI as Be,cJ as Me,cK as Re,cL as Le,cM as Ee,cN as xe,cO as Fe,aa as Ue,bG as We,aq as He,n as le,y as O,aW as Ut,aX as de,aY as ce,aZ as Nt,aj as Tt,W as ue,ai as Vt,U as rt,an as Bt,S as et,ah as nt,by as ze,af as Je,cP as Ge,aH as je,cQ as Ye,cR as Xe,a5 as Qe,aG as qe,cS as pe,aP as gt,a$ as At,a7 as Pt,cT as me,aL as he,cx as Mt,D as ge,bo as Ze,T as ft,ap as _t,ak as lt,G as dt,X as Rt,a9 as Ke,cU as tn,cV as en,cW as nn,cX as an,bw as Lt,a8 as fe,cY as sn,cZ as on,c_ as rn,c$ as ln,d0 as dn,cm as Wt,cn,bO as un}from"./vendor-DHEgn6Fp.js";import{S as N,u as tt,_ as H,H as S,A as pn,a as mn,b as _e,c as xt,P as vt,d as ve,e as hn,f as yt,E as Gt,g as gn,B as fn,t as jt,h as Yt,i as Ht,j as St,k as ht,l as at,m as wt,n as ut,o as st,p as Ot,q as _n,T as ye,U as be,r as vn,s as ot,v as Xt,w as Qt,x as yn,y as qt,L as bn}from"./index-BEsNDvAD.js";import{m as De}from"./apexcharts-BKi_EpK-.js";import{A as we}from"./ncd_appointment_service-D3AEBgkP.js";import{D as zt}from"./DateInputField-D7GlIonE.js";import{u as Dn,M as wn,_ as Cn}from"./ActionButtons.vue_vue_type_script_setup_true_lang-BQQbbeVF.js";import{V as Sn}from"./ViewToggleComponent-GXb9wise.js";import{b as $n}from"./bottomNavBar-hWZkbJHY.js";import{C as In}from"./chartjs-sbA318Gx.js";import{B as bt}from"./BasicForm-CVPukSnH.js";import{B as Et}from"./BasicCard-C5AFQbP0.js";import{u as kn}from"./AdministerOtherVaccinesStore-DL7auVtg.js";import{_ as An}from"./customDatePicker.vue_vue_type_style_index_0_lang-D0Dk2NVB.js";import{s as Pn}from"./vaccines_service-zkqbEPMn.js";import{l as $t}from"./lodash-Dt8AsbQm.js";import{g as On}from"./dashboard_service-DB8rnPMM.js";import{i as Nn}from"./Img-CJEgX1Vr.js";import"./sms_service-_zLEQy9Z.js";import"./EIRreportsStore-DUpWbuNc.js";import"./Export-BWCpH95q.js";class Zt extends N{constructor(){super()}static async getFhirPatients(){return await super.getJson("fhir/patients/")}static async getFhirPatient(e){return await super.getJson("fhir/patient/".concat(e),{id:e})}static async getFhirObservations(e){return await super.getJson("fhir/patient/".concat(e,"/observations/"),{id:e})}}const Tn={class:"fhir-viewer"},Vn={class:"container"},Bn={key:0,class:"main-header"},Mn={class:"header-line"},Rn={key:0,class:"last-updated-display"},Ln={key:1,class:"card initial-input-card"},En={class:"action-area-initial"},xn={key:0,class:"card patient-card"},Fn={class:"card-title"},Un={class:"patient-info-grid"},Wn={class:"info-item"},Hn={class:"info-value"},zn={class:"info-item"},Jn={class:"info-value"},Gn={class:"info-item"},jn={class:"info-value"},Yn={class:"info-item"},Xn={class:"info-value"},Qn={class:"info-value"},qn={class:"info-value"},Zn={class:"info-label"},Kn={class:"info-value"},ta={key:2,class:"card observations-card"},ea={class:"card-title"},na={class:"observations-grid"},aa={class:"obs-header"},sa={class:"obs-title"},oa={class:"obs-details"},ia={class:"obs-detail obs-value-highlight"},ra={class:"obs-value"},la={class:"obs-detail"},da={class:"obs-value"},ca={key:0,class:"obs-detail"},ua={class:"obs-value"},pa={key:3,class:"no-data-found"},ma={key:4,class:"no-data-found"},ha={key:5,class:"main-footer"},ga=U({__name:"ExternalReferrals",props:{initialData:{type:Array,default:()=>[]},apiEndpoint:{type:String,default:"/api/fhir/patient-data"}},setup(t){Ie({"person-circle-outline":Ne,"clipboard-outline":ne,"search-outline":Oe,"information-circle-outline":Pe,"alert-circle-outline":ee,"person-add-outline":Ae,"arrow-back-outline":ke});const e=t,s=Kt(),a=M(!1),r=M([]),g=M(),u=M(),l=M(null),h=M([]),d=It(()=>r.value.some(w=>w.resourceType==="Bundle"&&w.entry&&w.entry.some(p=>p.resource&&p.resource.resourceType==="Patient"))),f=It(()=>h.value.length>0),D=async()=>{if(r.value=[],u.value=null,l.value=null,h.value=[],!g.value){console.error("Please enter a Patient Identifier.");return}a.value=!0;try{const w=await Zt.getFhirPatient(g.value);if(w&&w.entry&&w.entry.length>0){const p=w.entry[0].resource,E=p.id,L=await Zt.getFhirObservations(E);r.value=[w],L&&(r.value.push(L),h.value=L.entry.filter(G=>G.resource&&G.resource.resourceType==="Observation").map(G=>{const A=G.resource;return{id:A.id,display:z(A),value:ct(A),date:A.effectiveDateTime,category:A.category&&A.category[0]&&A.category[0].coding&&A.category[0].coding[0]?A.category[0].coding[0].display||A.category[0].coding[0].code:"N/A"}}));const T=p.name&&p.name[0];l.value={personInformation:{given_name:T&&T.given?T.given.join(" "):"",middle_name:T&&T.middle?T.middle.join(" "):"",family_name:T&&T.family?T.family:"",gender:p.gender=="male"?"M":(p==null?void 0:p.gender)=="female"?"F":"",birthdate:p.birthDate||"",cell_phone_number:p.telecom&&p.telecom[0]?p.telecom[0].value:""},guardianInformation:{saved:[{cell_phone_number:p.contact&&p.contact[0]&&p.contact[0].telecom?p.contact[0].telecom[0].value:""}]}};const $=[w,L].filter(Boolean).reduce((G,A)=>{if(A.meta&&A.meta.lastUpdated){const q=new Date(A.meta.lastUpdated);return G===null||q>G?q:G}return G},null);$&&(u.value=F($.toISOString()))}else console.warn("No patient bundle found for the provided identifier.")}catch(w){console.error("Error loading FHIR data:",w),r.value=[],u.value=null,l.value=null,h.value=[]}finally{a.value=!1}},b=w=>{if(w.name&&w.name[0]){const p=w.name[0],E=p.given?p.given.join(" "):"",L=p.family||"";return"".concat(E," ").concat(L).trim()||"N/A"}return"N/A"},C=w=>w.identifier&&w.identifier.length>0?w.identifier.map(p=>{let E="Unknown System";if(p.type&&p.type.coding&&p.type.coding[0]&&p.type.coding[0].display)E=p.type.coding[0].display;else if(p.system){const T=p.system.split("/");E=T[T.length-1]||p.system,p.system==="urn:oid:2.16.840.1.113883.4.6"&&(E="Social Security Number")}sessionStorage.setItem(E,p.value);let L=null;return p.assigner&&p.assigner.display?L=p.assigner.display:p.assigner&&p.assigner.reference&&(L=p.assigner.reference.split("/").pop()||p.assigner.reference),{value:p.value||"N/A",systemDisplay:E,periodStart:p.period?p.period.start:null,periodEnd:p.period?p.period.end:null,assignerDisplay:L}}):[],k=w=>w.telecom&&w.telecom.length>0?w.telecom.filter(p=>p.system==="phone"&&p.value):[],y=w=>{if(w.contact&&w.contact.length>0){const p=w.contact.filter(L=>{var T;return(T=L.relationship)==null?void 0:T.some(V=>{var $;return($=V.coding)==null?void 0:$.some(G=>G.code==="GUARD")})}),E=[];return p.forEach(L=>{L.telecom&&L.telecom.length>0&&L.telecom.filter(T=>T.system==="phone"&&T.value).forEach(T=>E.push(T))}),E}return[]},B=w=>{if(!w)return"N/A";try{return new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(p){return console.error("Invalid date string for formatDate:",w,p),"Invalid Date"}},F=w=>{if(!w)return"N/A";try{return new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(p){return console.error("Invalid date time string for formatDateTime:",w,p),"Invalid Date/Time"}},R=w=>{if(!w)return"N/A";try{const p=new Date,E=new Date(w);let L=p.getFullYear()-E.getFullYear();const T=p.getMonth()-E.getMonth();return(T<0||T===0&&p.getDate()<E.getDate())&&L--,L}catch(p){return console.error("Invalid birth date string for calculateAge:",w,p),"N/A"}},Y=w=>{if(w.meta&&w.meta.tag){const p=w.meta.tag.find(E=>E.system==="http://your-domain.org/fhir/StructureDefinition/sync-status");return p?p.code:"Unknown"}return"Unknown"},z=w=>w.code&&w.code.coding&&w.code.coding[0]&&(w.code.coding[0].display||w.code.coding[0].code)||"Unknown Observation",ct=w=>w.valueQuantity?"".concat(w.valueQuantity.value," ").concat(w.valueQuantity.unit||"").trim():w.valueString?w.valueString:w.valueBoolean!==void 0?w.valueBoolean?"True":"False":"N/A",Q=()=>{tt().setRecord(l.value),sessionStorage.setItem("ichis_diagnosis",JSON.stringify(h.value)),Ce("/registration/manual")},Jt=()=>{r.value=[],g.value="",u.value=null,l.value=null,h.value=[]},Ce=w=>{s.push({path:w})};return it(()=>s,async()=>{r.value=[],h.value=[]},{deep:!0}),kt(()=>{var w;if(e.initialData.length>0){r.value=e.initialData;const E=e.initialData.filter(Boolean).reduce((V,$)=>{if($.meta&&$.meta.lastUpdated){const G=new Date($.meta.lastUpdated);return V===null||G>V?G:V}return V},null);E&&(u.value=F(E.toISOString()));const L=e.initialData.find(V=>V.resourceType==="Bundle"&&V.entry&&V.entry.some($=>$.resource&&$.resource.resourceType==="Patient"));if(L){const V=(w=L.entry.find($=>$.resource&&$.resource.resourceType==="Patient"))==null?void 0:w.resource;if(V){const $=V.name&&V.name[0];l.value={personInformation:{given_name:$&&$.given?$.given.join(" "):"",middle_name:$&&$.middle?$.middle.join(" "):"",family_name:$&&$.family?$.family:"",gender:V.gender||"",birthdate:V.birthDate||""}}}}const T=e.initialData.find(V=>V.resourceType==="Bundle"&&V.entry&&V.entry.some($=>$.resource&&$.resource.resourceType==="Observation"));T&&(h.value=T.entry.filter(V=>V.resource&&V.resource.resourceType==="Observation").map(V=>{const $=V.resource;return{id:$.id,display:z($),value:ct($),date:$.effectiveDateTime,category:$.category&&$.category[0]&&$.category[0].coding&&$.category[0].coding[0]?$.category[0].coding[0].display||$.category[0].coding[0].code:"N/A"}}))}}),(w,p)=>{var E,L,T,V,$,G;return c(),v("div",Tn,[n("div",Vn,[(E=r.value)!=null&&E.length?(c(),v("header",Bn,[n("div",Mn,[p[1]||(p[1]=n("h5",{class:"header-title"},"Referred Patient Overview",-1)),n("div",null,[n("span",{style:{"margin-right":"5px"},class:K(["last-updated-display","status-"+Y(r.value[0].entry[0].resource).toLowerCase()])}," Sync Status: "+_(Y(r.value[0].entry[0].resource)),3),u.value?(c(),v("span",Rn,"Last Updated: "+_(u.value),1)):I("",!0)])])])):I("",!0),(L=r.value)!=null&&L.length?I("",!0):(c(),v("section",Ln,[o(J(te),{modelValue:g.value,"onUpdate:modelValue":p[0]||(p[0]=A=>g.value=A),placeholder:"Enter Patient Identifier (e.g., patient-id-123)",fill:"outline",label:"Patient ID","label-placement":"floating"},null,8,["modelValue"]),n("div",En,[n("button",{onClick:D,class:"load-data-btn"},[o(J(j),{name:"search-outline"}),p[2]||(p[2]=P(" Find Patient ",-1))])])])),(c(!0),v(x,null,W(r.value,A=>(c(),v("div",{key:A.id},[A.resourceType==="Bundle"&&A.entry&&A.entry[0]&&A.entry[0].resource.resourceType==="Patient"?(c(),v("section",xn,[n("h2",Fn,[o(J(j),{name:"person-circle-outline"}),p[3]||(p[3]=P(" Patient Demographics",-1))]),n("div",Un,[n("div",Wn,[p[4]||(p[4]=n("span",{class:"info-label"},"Full Name",-1)),n("span",Hn,_(b(A.entry[0].resource)),1)]),n("div",zn,[p[5]||(p[5]=n("span",{class:"info-label"},"Gender",-1)),n("span",Jn,_(A.entry[0].resource.gender||"Not specified"),1)]),n("div",Gn,[p[6]||(p[6]=n("span",{class:"info-label"},"Date of Birth",-1)),n("span",jn,_(B(A.entry[0].resource.birthDate)),1)]),n("div",Yn,[p[7]||(p[7]=n("span",{class:"info-label"},"Age",-1)),n("span",Xn,_(R(A.entry[0].resource.birthDate))+" years",1)]),k(A.entry[0].resource).length?(c(!0),v(x,{key:0},W(k(A.entry[0].resource),(q,pt)=>(c(),v("div",{key:"patient-phone-".concat(pt),class:"info-item"},[p[8]||(p[8]=n("span",{class:"info-label"},"Patient Phone ",-1)),n("span",Qn,_(q.value),1)]))),128)):I("",!0),y(A.entry[0].resource).length?(c(!0),v(x,{key:1},W(y(A.entry[0].resource),(q,pt)=>(c(),v("div",{key:"guardian-phone-".concat(pt),class:"info-item"},[p[9]||(p[9]=n("span",{class:"info-label"},"Guardian Phone ",-1)),n("span",qn,_(q.value),1)]))),128)):I("",!0),(c(!0),v(x,null,W(C(A.entry[0].resource),(q,pt)=>(c(),v("div",{key:q.value||pt,class:"info-item"},[n("span",Zn,_(q.systemDisplay),1),n("span",Kn,_(q.value),1)]))),128))])])):I("",!0)]))),128)),((T=h.value)==null?void 0:T.length)>0?(c(),v("section",ta,[n("h2",ea,[o(J(j),{name:"clipboard-outline"}),p[10]||(p[10]=P(" Clinical Observations",-1))]),n("div",na,[(c(!0),v(x,null,W(h.value,A=>(c(),v("div",{key:A.id,class:"observation-item"},[n("div",aa,[n("h3",sa,_(A.display),1)]),n("div",oa,[n("div",ia,[p[11]||(p[11]=n("span",{class:"obs-label"},"Value:",-1)),n("span",ra,_(A.value),1)]),n("div",la,[p[12]||(p[12]=n("span",{class:"obs-label"},"Date:",-1)),n("span",da,_(F(A.date)),1)]),A.category&&A.category!=="N/A"?(c(),v("div",ca,[p[13]||(p[13]=n("span",{class:"obs-label"},"Category:",-1)),n("span",ua,_(A.category),1)])):I("",!0)])]))),128))])])):I("",!0),(V=r.value)!=null&&V.length&&!d.value?(c(),v("div",pa,[n("p",null,[o(J(j),{name:"alert-circle-outline"}),p[14]||(p[14]=P(" No patient data found for the provided identifier. Please try again.",-1))])])):($=r.value)!=null&&$.length&&d.value&&!f.value?(c(),v("div",ma,[n("p",null,[o(J(j),{name:"information-circle-outline"}),p[15]||(p[15]=P(" No clinical observations found for this patient.",-1))])])):I("",!0),(G=r.value)!=null&&G.length?(c(),v("footer",ha,[n("button",{onClick:Jt,class:"back-to-search-btn small-btn"},[o(J(j),{name:"arrow-back-outline"}),p[16]||(p[16]=P(" Back to Search ",-1))]),n("button",{onClick:Q,class:"register-btn small-btn"},[o(J(j),{name:"person-add-outline"}),p[17]||(p[17]=P(" Register New Patient ",-1))])])):I("",!0)])])}}}),fa=H(ga,[["__scopeId","data-v-0dc329ef"]]),_a=U({name:"referrals",components:{ExternalReferrals:fa},data(){return{segmentContent:"External referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){this.segmentContent=t}}}),va={key:0},ya={style:{display:"flex","margin-top":"10px"}},ba={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},Da={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},wa={key:1};function Ca(t,e,s,a,r,g){const u=m("ion-label"),l=m("ion-segment-button"),h=m("ion-segment"),d=m("ExternalReferrals");return c(),v(x,null,[n("div",null,[o(h,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:i(()=>[o(l,{value:"External referrals",onClick:e[0]||(e[0]=f=>t.setSegmentContent("External referrals"))},{default:i(()=>[o(u,null,{default:i(()=>e[2]||(e[2]=[P("External referrals",-1)])),_:1,__:[2]})]),_:1}),o(l,{value:"Internal referrals",onClick:e[1]||(e[1]=f=>t.setSegmentContent("Internal referrals"))},{default:i(()=>[o(u,null,{default:i(()=>e[3]||(e[3]=[P("Internal referrals",-1)])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(c(),v("div",va,[n("div",ya,[t.checkUnderFive?(c(),v("div",ba)):I("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?I("",!0):(c(),v("div",Da))])])):I("",!0),t.segmentContent=="External referrals"?(c(),v("div",wa,[o(d)])):I("",!0)],64)}const Sa=H(_a,[["render",Ca],["__scopeId","data-v-e09d6a6b"]]),Ft=Te("NCDDashBoardStore",{state:()=>({selectedItem:null}),actions:{setSelectedItem(t){this.selectedItem=t},getSelectedItem(){return this.selectedItem}},persist:!0}),$a=()=>{const t=M(null);return{activeIteminMixin:t,setActiveItem:s=>{t.value=s,console.log("lll: ",t.value)}}},Dt=U({name:"useDashboardMixin",data(){return{isMobile:!1,appointments:[],activeIteminMixin:null}},setup(){const{activeIteminMixin:t,setActiveItem:e}=$a();return{chevronBackOutline:We,checkmark:Ue,grid:Fe,chevronDownCircle:xe,chevronForwardCircle:Ee,chevronUpCircle:Le,colorPalette:Re,document:Me,globe:Be,medkit:re,add:Ve,person:ie,people:oe,thermometer:se,clipboard:ae,activeIteminMixin:t,setActiveItem:e}},async mounted(){await this.setAppointments()},computed:{...X(tt,["patient"])},watch:{$route:{async handler(t){await this.setAppointments()},deep:!0}},methods:{async setAppointments(){this.appointments=await pn.getDailiyAppointments(S.sessionDate()),this.appointments&&(this.appointments=this.appointments.sort((t,e)=>t.given_name.localeCompare(e.given_name)))},formatBirthdate(t){return S.getBirthdateAge(t)},setActiveItemRefFN(t){Ft().setSelectedItem(t)}}}),Ia=U({name:"NCDDashboard",mixins:[Dt],components:{ApexChart:De},setup(){return{router:Kt()}},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await le(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){try{return N.getJson("programs/32/reports/ncd_dashboard",{start_date:S.toStandardHisFormat(S.sessionDate()),end_date:S.toStandardHisFormat(S.sessionDate())})}catch(t){return[]}},navigationMenu(t){try{He.close(),this.router.push(t).then(()=>{})}catch(e){console.error(e)}}}}),ka={class:"cards-container"},Aa={class:"top-card-text"},Pa={class:"text-2xl font-bold"},Oa={class:"top-card-text"},Na={class:"text-2xl font-bold"},Ta={class:"top-card-text"},Va={class:"text-2xl font-bold"},Ba={class:"top-card-text"},Ma={class:"text-2xl font-bold"},Ra={class:"top-card-text"},La={class:"text-2xl font-bold"},Ea={class:"charts",style:{gap:"20px","margin-top":"20px","padding-left":"20px","padding-right":"20px"}},xa={ref:"chartRef1"},Fa={ref:"chartRef2"};function Ua(t,e,s,a,r,g){const u=m("ion-card-content"),l=m("ion-card"),h=m("ApexChart");return c(),v(x,null,[n("div",ka,[o(l,{class:"top-card action-card",onClick:e[0]||(e[0]=d=>t.setActiveItemRefFN("appointments"))},{default:i(()=>[o(u,null,{default:i(()=>[n("div",Aa,[n("div",Pa,_(t.appointments.length),1),e[2]||(e[2]=n("h3",{class:"text-sm font-medium"},"Today's Appointments",-1))])]),_:1})]),_:1}),o(l,{class:"top-card action-card"},{default:i(()=>[o(u,null,{default:i(()=>{var d;return[n("div",Oa,[n("div",Na,_((d=t.dashboardData)==null?void 0:d.total_pending_dispensations),1),e[3]||(e[3]=n("h3",{class:"text-sm font-medium"},"Pending Dispensations",-1))])]}),_:1})]),_:1}),o(l,{class:"top-card action-card"},{default:i(()=>[o(u,null,{default:i(()=>{var d;return[n("div",Ta,[n("div",Va,_((d=t.dashboardData)==null?void 0:d.total_defaulters),1),e[4]||(e[4]=n("h3",{class:"text-sm font-medium"},"Defaulters",-1))])]}),_:1})]),_:1}),o(l,{class:"top-card action-card"},{default:i(()=>[o(u,null,{default:i(()=>{var d;return[n("div",Ba,[n("div",Ma,_((d=t.dashboardData)==null?void 0:d.total_complications),1),e[5]||(e[5]=n("h3",{class:"text-sm font-medium"},"Complications",-1))])]}),_:1})]),_:1}),o(l,{class:"top-card action-card",onClick:e[1]||(e[1]=d=>t.navigationMenu("NCDActivePatients"))},{default:i(()=>[o(u,null,{default:i(()=>{var d;return[n("div",Ra,[n("div",La,_((d=t.dashboardData)==null?void 0:d.total_client_registered),1),e[6]||(e[6]=n("h3",{class:"text-sm font-medium"},"Total active patients",-1))])]}),_:1})]),_:1})]),n("div",Ea,[o(l,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:i(()=>[o(u,null,{default:i(()=>[e[7]||(e[7]=n("div",{class:"font-medium"},"Quarterly Case Distribution",-1)),n("div",xa,[t.isChartReady?(c(),O(h,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):I("",!0)],512)]),_:1,__:[7]})]),_:1}),o(l,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:i(()=>[o(u,null,{default:i(()=>[e[8]||(e[8]=n("div",{class:"font-medium"},"Patients by gender",-1)),n("div",Fa,[t.isChartReady?(c(),O(h,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):I("",!0)],512)]),_:1,__:[8]})]),_:1})])],64)}const Wa=H(Ia,[["render",Ua],["__scopeId","data-v-18251377"]]),Ha=U({name:"Home",mixins:[_e,Dt],components:{IonContent:nt,IonHeader:et,IonPage:Bt,IonToolbar:rt,IonRow:Vt,DateInputField:zt,IonIcon:j,IonButton:ue,IonCol:Tt,IonCard:Nt,IonCardHeader:ce,IonCardTitle:de,IonCardContent:Ut,ViewToggleComponent:Sn,bottomNavBar:$n,HorizontalLine:mn},data(){const t=localStorage.getItem("ncdStartDate"),e=localStorage.getItem("ncdEndDate"),s=M(t||S.sessionDate()),a=M(e||S.sessionDate()),r=M(S.sessionDate()),g=M(S.sessionDate()),u=M([]),l=ze({page:1,itemsPerPage:10}),h=M(0),d=Dn();return{minDate:r,startDate:s,endDate:a,people:u,calendarOutline:gt,openOutline:pe,maxDate:g,alertCircleOutline:ee,personOutline:qe,idCardOutline:Qe,manOutline:Xe,womanOutline:Ye,locationOutline:je,timeOutline:Ge,todayOutline:Je,pagination:l,totalCount:h,actionButtonStore:d}},computed:{...X(xt,["NCDAppointmentsTogglePreference"]),paginatedPeople(){const t=(this.pagination.page-1)*this.pagination.itemsPerPage,e=t+this.pagination.itemsPerPage;return this.people.slice(t,e)},groupedPaginatedPeople(){const t={};this.paginatedPeople.forEach(a=>{const r=a.appointmentDate;t[r]||(t[r]=[]),t[r].push(a)});const e=Object.keys(t).sort((a,r)=>new Date(a)-new Date(r)),s={};return e.forEach(a=>{s[a]=t[a]}),s}},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments(),this.HideHomePageActionButton()},async unmounted(){this.actionButtonStore.resetShowActionButton()},methods:{formatBirthdate(t){return S.getBirthdateAge(t)},async getAppointments(t=!1){if(ve().apiStatus){this.people=[],this.pagination.page=1;try{t==!0&&(this.startDate=S.sessionDate(),this.endDate=S.sessionDate(),this.getAppointmentsD1(this.startDate),this.getAppointmentsD2(this.endDate)),this.startDate>this.endDate&&(this.endDate=this.startDate),console.log(this.startDate,this.endDate),(await we.getAppointments(this.startDate,this.endDate,"")).forEach(a=>{const r=S.toStandardHisDisplayFormat(a.appointment_date);if(!this.people.some(u=>u.person_id===a.person_id&&u.appointmentDate===r)){const u={person_id:a.person_id,npid:a.npid,appointment_id:103,encounter_id:a.encounter_id,name:a.given_name.concat(" ",a.family_name),gender:a.gender,ageDob:this.formatBirthdate(a.birthdate),village:a.city_village,appointmentDate:r};this.people.push(u)}}),this.totalCount=this.people.length}catch(s){}}},async getAppointmentsD1(t){this.startDate=S.toStandardHisFormat(t),localStorage.setItem("ncdStartDate",this.startDate),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=S.toStandardHisFormat(t),localStorage.setItem("ncdEndDate",this.endDate),await this.getAppointments()},async openClientProfile(t){const e=await vt.findByNpid(t);tt().setPatientRecord(e[0]),this.redirectUser()},handleViewChange(t){this.initTogglePreference(t,!0)},initTogglePreference(t="list",e=!1){const s={toggle_view:t},a=xt();Object.keys(this.NCDAppointmentsTogglePreference).length===0&&(s.toggle_view="list",a.setNCDAppointmentsTogglePreference(s)),Object.keys(this.NCDAppointmentsTogglePreference).length>0&&e==!0&&a.setNCDAppointmentsTogglePreference(s)},redirectUser(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(s=>e.some(a=>a.role==="Pharmacist"))?this.$router.push("NCDDispensations"):this.$router.push("patientProfile")},handlePaginationUpdate({page:t,itemsPerPage:e}){if(e!==this.pagination.itemsPerPage){const s=(this.pagination.page-1)*this.pagination.itemsPerPage,a=Math.floor(s/e)+1,r=Math.ceil(this.totalCount/e);this.pagination.page=Math.min(a,r)||1,this.pagination.itemsPerPage=e}else this.pagination.page=t},HideHomePageActionButton(){this.actionButtonStore.setShowActionButton(!1)}}}),za={class:"appointments-container"},Ja={class:"date-filter"},Ga={key:0,style:{margin:"20px"}},ja={key:1},Ya={class:"appointments-table"},Xa={key:2},Qa={class:"date-group-header"},qa={class:"date-header-title"},Za={class:"date-header-count"},Ka={class:"cards-container"},ts={class:"card-details"},es={class:"detail-item"},ns={class:"detail-value"},as={class:"detail-item"},ss={class:"detail-value"},os={class:"detail-item"},is={class:"detail-value"},rs={class:"detail-item"},ls={class:"detail-value"};function ds(t,e,s,a,r,g){const u=m("DateInputField"),l=m("ion-col"),h=m("ion-icon"),d=m("ion-button"),f=m("ViewToggleComponent"),D=m("ion-row"),b=m("ion-card"),C=m("HorizontalLine"),k=m("ion-card-title"),y=m("ion-card-header"),B=m("ion-card-content"),F=m("ion-content"),R=m("bottomNavBar"),Y=m("ion-footer");return c(),v("div",za,[n("div",Ja,[o(D,null,{default:i(()=>[o(l,null,{default:i(()=>[o(u,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),o(l,null,{default:i(()=>[o(u,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2,fontSize:"20px",bold:"600"},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1}),o(l,null,{default:i(()=>[o(d,{color:"primary",onClick:e[0]||(e[0]=z=>t.getAppointments(!0)),class:"apt-btn"},{default:i(()=>[o(h,{icon:t.todayOutline,slot:"start"},null,8,["icon"]),e[1]||(e[1]=n("span",{style:{margin:"5px"}}," Today ",-1))]),_:1,__:[1]})]),_:1}),o(l,null,{default:i(()=>[o(f,{"initial-view":t.NCDAppointmentsTogglePreference.toggle_view,onViewChanged:t.handleViewChange},null,8,["initial-view","onViewChanged"])]),_:1})]),_:1})]),o(F,{class:"scrollable-content"},{default:i(()=>[t.people.length===0?(c(),v("div",Ga,[o(h,{icon:t.alertCircleOutline,size:"large",class:"mb-4 text-gray-500"},null,8,["icon"]),e[2]||(e[2]=n("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Appointments for selected date range",-1))])):t.NCDAppointmentsTogglePreference.toggle_view==="list"&&t.people.length>0?(c(),v("div",ja,[o(b,null,{default:i(()=>[n("table",Ya,[e[3]||(e[3]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(c(!0),v(x,null,W(t.paginatedPeople,z=>(c(),v("tr",{key:z.npid},[n("td",null,[o(D,null,{default:i(()=>[o(l,null,{default:i(()=>[P(_(z.name),1)]),_:2},1024),o(l,null,{default:i(()=>[o(d,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:ct=>t.openClientProfile(z.npid),color:"primary",fill:"clear",size:"small"},{default:i(()=>[o(h,{icon:t.openOutline,style:{"font-size":"28px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,_(z.npid),1),n("td",null,_(z.ageDob),1),n("td",null,_(z.gender),1),n("td",null,_(z.village),1),n("td",null,_(z.appointmentDate),1)]))),128))])])]),_:1})])):t.NCDAppointmentsTogglePreference.toggle_view==="card"&&t.people.length>0?(c(),v("div",Xa,[(c(!0),v(x,null,W(t.groupedPaginatedPeople,(z,ct)=>(c(),v("div",{key:ct,class:"date-group"},[n("div",Qa,[o(h,{icon:t.calendarOutline,class:"date-header-icon"},null,8,["icon"]),n("h2",qa,_(ct),1),n("div",Za,_(z.length)+" appointment"+_(z.length!==1?"s":""),1)]),o(C,{color:"#006401",thickness:1,spacing:"sm"}),n("div",Ka,[(c(!0),v(x,null,W(z,Q=>(c(),O(b,{key:Q.npid,class:"appointment-card"},{default:i(()=>[o(y,null,{default:i(()=>[o(D,{class:"ion-align-items-center"},{default:i(()=>[o(l,null,{default:i(()=>[o(k,{class:"card-name"},{default:i(()=>[o(h,{icon:t.personOutline,class:"name-icon"},null,8,["icon"]),P(" "+_(Q.name),1)]),_:2},1024)]),_:2},1024),o(l,{size:"auto"},{default:i(()=>[o(d,{onClick:Jt=>t.openClientProfile(Q.npid),color:"primary",fill:"clear",size:"small",class:"view-profile-btn"},{default:i(()=>[o(h,{icon:t.openOutline},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(B,null,{default:i(()=>[n("div",ts,[n("div",es,[o(h,{icon:t.idCardOutline,class:"detail-icon"},null,8,["icon"]),e[4]||(e[4]=n("span",{class:"detail-label"},"NPID:",-1)),n("span",ns,_(Q.npid),1)]),n("div",as,[o(h,{icon:t.calendarOutline,class:"detail-icon"},null,8,["icon"]),e[5]||(e[5]=n("span",{class:"detail-label"},"Age/DOB:",-1)),n("span",ss,_(Q.ageDob),1)]),n("div",os,[o(h,{icon:Q.gender==="Male"?t.manOutline:t.womanOutline,class:"detail-icon"},null,8,["icon"]),e[6]||(e[6]=n("span",{class:"detail-label"},"Gender:",-1)),n("span",is,_(Q.gender),1)]),n("div",rs,[o(h,{icon:t.locationOutline,class:"detail-icon"},null,8,["icon"]),e[7]||(e[7]=n("span",{class:"detail-label"},"Village:",-1)),n("span",ls,_(Q.village),1)])])]),_:2},1024)]),_:2},1024))),128))])]))),128))])):I("",!0)]),_:1}),t.people.length>0?(c(),O(Y,{key:0,class:"sticky-footer"},{default:i(()=>[o(D,null,{default:i(()=>[o(l,{size:"12",style:{"max-width":"100%"}},{default:i(()=>[o(R,{totalItems:t.totalCount,currentPage:t.pagination.page,itemsPerPage:t.pagination.itemsPerPage,"onUpdate:pagination":t.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])]),_:1})]),_:1})]),_:1})):I("",!0)])}const cs=H(Ha,[["render",ds],["__scopeId","data-v-9f3d23f3"]]),us={key:0,class:"left_col"},ps={class:"nav-menu"},ms=["onClick"],hs={class:"ellipsis"},gs={key:1,style:{"padding-left":"20px","padding-right":"20px"}},fs=U({__name:"NCDDashboard",setup(t){const e=Ft(),s=It(()=>e.selectedItem),{screenWidth:a}=hn(),r=M([{id:"dashboard",label:"Dashboard",icon:me},{id:"referrals",label:"Referrals",icon:he},{id:"appointments",label:"Appointments",icon:gt}]),g=M("dashboard"),u=yt(),{substance:l}=At(u);it(()=>l.value,(d,f)=>{d!==f&&console.log("Substance changed:",d)},{deep:!0,immediate:!0});const h=d=>{g.value=d,Ft().setSelectedItem(g.value)};return it(()=>s.value,d=>{console.log("Active item from mixin changed:",d),d&&d!=null&&h(d)},{immediate:!0}),(d,f)=>{const D=m("ion-segment-button"),b=m("ion-segment");return c(),v("div",{style:Pt(J(a)>940?"display: flex":"display: block")},[J(a)>940?(c(),v("div",us,[n("nav",ps,[n("ul",null,[(c(!0),v(x,null,W(r.value,C=>(c(),v("li",{key:C.id,class:K({active:g.value===C.id}),onClick:k=>h(C.id)},[o(J(j),{icon:C.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",hs,_(C.label),1)],10,ms))),128))])])])):I("",!0),J(a)<=940?(c(),v("div",gs,[o(b,{value:g.value,style:{"margin-top":"5px","justify-content":"left"}},{default:i(()=>[(c(!0),v(x,null,W(r.value,C=>(c(),O(D,{value:C.id,key:C.id,class:K({active:g.value===C.id}),onClick:k=>h(C.id)},{default:i(()=>[o(J(j),{icon:C.icon,style:{"font-size":"20px"},class:"menu-icon"},null,8,["icon"]),n("span",null,_(C.label),1)]),_:2},1032,["value","class","onClick"]))),128))]),_:1},8,["value"])])):I("",!0),n("div",{class:"right_col",style:Pt(J(a)>940?"width: 85%":"width: 100%")},[n("div",null,[g.value==="referrals"?(c(),O(Sa,{key:0})):I("",!0),g.value==="dashboard"?(c(),O(Wa,{key:1})):I("",!0),g.value==="appointments"?(c(),O(cs,{key:2})):I("",!0)])],4)],4)}}}),_s=H(fs,[["__scopeId","data-v-a1132315"]]),vs=""+new URL("icon/checklist.svg",import.meta.url).href,ys=""+new URL("icon/dashboard.svg",import.meta.url).href,bs={name:"Dashboard",setup(){kt(async()=>{s.value=await l(),await h();const f=await d(),{labels:D,totalVisits:b,incompleteVisits:C}=t(f);e(D,b,C)});function t(f){if(!f)return{labels:[],totalVisits:[],incompleteVisits:[]};const D=[],b=[],C=[];return Object.entries(f).forEach(([k,y])=>{const F=new Date(k).toLocaleDateString("en-US",{weekday:"long"});D.push(F),b.push(y.complete),C.push(y.incomplete)}),{labels:D,totalVisits:b,incompleteVisits:C}}function e(f,D,b){const C=document.getElementById("myChart");new In(C,{type:"bar",data:{labels:f,datasets:[{label:"Total visits",data:D,backgroundColor:"#5aa3b1"},{label:"Incomplete visits",data:b,backgroundColor:"#dba6a2"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}const s=M([]),a=M({}),r=f=>{const D=Object.entries(Gt).find(([b,C])=>C===f);return D?D[0]:"Unknown (".concat(f,")")},g=f=>Object.keys(f).map(D=>{var B,F;const b=Number(D),C=r(b),k=((B=f[b])==null?void 0:B.F)||0,y=((F=f[b])==null?void 0:F.M)||0;return{encounter:u(C),female:k,male:y,me:k+y,facility:k+y}}),u=f=>f.toLowerCase().replace(/_/g," ").replace(/\b\w/g,D=>D.toUpperCase()),l=async()=>{try{const f=Object.values(Gt).filter(y=>typeof y=="number"),[D,b]=await Promise.all([N.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:f}),N.postJson("reports/encounters?date=2025-05-08&program_id=1",{encounter_types:[9,51,6,52,53,68,25,54,7],all:!0})]),C=g(b),k=g(D);return C.map(y=>{const B=k.find(F=>F.encounter===y.encounter);return{...y,me:B?B.female+B.male:0}})}catch(f){return console.error("Error fetching dashboard stats:",f),[]}},h=async()=>{try{const D=new Date().toISOString().split("T")[0],b=await N.getJson("programs/1/dashboard",{date:D});a.value=b}catch(f){console.error("Error fetching visits stats:",f)}},d=async()=>{try{const f=new Date,D=new Date;D.setDate(f.getDate()-5);const b=C=>C.toISOString().split("T")[0];return await N.getJson("programs/1/reports/visits",{name:"visits",end_date:b(f),start_date:b(D)})}catch(f){console.error("Error fetching visits stats:",f)}};return{checkListIcon:vs,dashboardIcon:ys,rows:s,dashboardScoreStats:a}}},Ds={class:"dashboard-container"},ws={class:"summary-cards"},Cs={class:"card"},Ss={class:"card"},$s={class:"card"},Is={class:"card"},ks={class:"main-section"},As={class:"encounters-section"},Ps={class:"his-sm-text"},Os={key:0},Ns={class:"encounter-td"},Ts={class:"other-td"},Vs={class:"other-td"},Bs={class:"other-td"},Ms={class:"other-td"},Rs={key:1};function Ls(t,e,s,a,r,g){var u,l,h,d,f,D,b,C;return c(),v("div",Ds,[n("div",ws,[n("div",Cs,[n("h2",null,_(((l=(u=a.dashboardScoreStats)==null?void 0:u.total_patients_today)!=null?l:[]).length||0),1),e[0]||(e[0]=n("p",null,"Total patients today",-1))]),n("div",Ss,[n("h2",null,_(((d=(h=a.dashboardScoreStats)==null?void 0:h.waiting_for_vitals)!=null?d:[]).length||0),1),e[1]||(e[1]=n("p",null,"Waiting for vitals",-1))]),n("div",$s,[n("h2",null,_(((D=(f=a.dashboardScoreStats)==null?void 0:f.waiting_for_consultation)!=null?D:[]).length||0),1),e[2]||(e[2]=n("p",null,"Waiting for consultation",-1))]),n("div",Is,[n("h2",null,_(((C=(b=a.dashboardScoreStats)==null?void 0:b.waiting_for_dispensation)!=null?C:[]).length||0),1),e[3]||(e[3]=n("p",null,"Waiting for dispensation",-1))])]),n("div",ks,[e[7]||(e[7]=n("div",{class:"chart-section"},[n("h3",null,"Total visits/incomplete visits: last 5 days"),n("canvas",{id:"myChart"})],-1)),n("div",As,[e[6]||(e[6]=n("h3",null,"Encounters created today",-1)),n("table",Ps,[e[5]||(e[5]=n("thead",null,[n("tr",null,[n("th",null,"Encounters"),n("th",null,"Female"),n("th",null,"Male"),n("th",null,"Me"),n("th",null,"Facility Total")])],-1)),a.rows.length?(c(),v("tbody",Os,[(c(!0),v(x,null,W(a.rows,(k,y)=>(c(),v("tr",{key:y},[n("td",Ns,_(k.encounter),1),n("td",Ts,_(k.female),1),n("td",Vs,_(k.male),1),n("td",Bs,_(k.me),1),n("td",Ms,_(k.facility),1)]))),128))])):(c(),v("tbody",Rs,e[4]||(e[4]=[n("tr",null,[n("td",{colspan:"5"},"Loading encounter stats...")],-1)])))])])])])}const Es=H(bs,[["render",Ls]]);class xs{constructor(){Z(this,"socket",null);Z(this,"channel","ImmunizationReportChannel");Z(this,"isConnected",!1);Z(this,"pendingFetch",null);Z(this,"location_id");Z(this,"initPromise");Z(this,"onOpen",async()=>{console.log("WebSocket connection established"),this.isConnected=!0,this.subscribe(),await this.getPatientSummary(),this.pendingFetch&&(this.pendingFetch(),this.pendingFetch=null)});Z(this,"onClose",()=>{console.log("WebSocket connection closed"),this.isConnected=!1});Z(this,"onError",e=>{console.error("WebSocket error:",e),this.isConnected=!1});this.initPromise=this.init()}async init(){const e=localStorage.getItem("apiURL"),s=localStorage.getItem("apiPort"),a=localStorage.getItem("websocketProtocol");this.location_id=localStorage.getItem("locationID");try{const r="".concat(a,"://").concat(e,"/api/v1/cable");this.socket=new WebSocket(r),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}catch(r){console.error(r),console.error("WebSocket not initialized: apiURL or apiPort is missing in localStorage.")}}subscribe(){if(this.socket){const e={command:"subscribe",identifier:JSON.stringify({channel:this.channel,location_id:this.location_id})};this.socket.send(JSON.stringify(e))}else console.error("WebSocket connection not established.")}async getPatientSummary(){await N.getJson("immunization/stats",{start_date:S.getDateBeforeByDays(S.sessionDate(),365),end_date:S.sessionDate()})}async setMessageHandler(e){await this.initPromise,this.socket?this.socket.onmessage=s=>{e(s)}:console.error("WebSocket connection not established.")}}const Fs=U({components:{IonContent:nt,IonHeader:et,IonItem:dt,IonList:lt,IonMenu:_t,IonTitle:ft,IonToolbar:rt,IonInput:te,BasicInputField:fn,BasicForm:bt,PreviousVitals:gn,customDatePicker:An,IonCol:Tt,IonRow:Vt,VueMultiselect:Ze,IonLabel:ge,DataTable:Mt},data(){return{isLoading:!1,overdueData:[],under_five_missed_visits:[],over_five_missed_visits:[],popoverOpen:!1,event:null,tableEvent:null,drug_name:null,village:null,iconsContent:Ht,showPD:!1,batchNumber:"",clientDetails:[],UnchangedClientDetails:[],villageList:[],tableData:[],options:{responsive:!0,select:!0,searching:!1,ordering:!1,pageLength:8,lengthChange:!1},vaccineName:"",currentDrugOb:{},is_batch_number_valid:!1,vaccineDate:"",is_vaccine_name_valid:!1,drugErrMsg:"",batch_number_error_message:"Enter a valid batch number",vaccine_name_error_message:"Enter a valid valid vaccine name",sessionDate:S.toStandardHisDisplayFormat(N.getSessionDate()),selectedRow:null,showDateBtns:!0,data:{}}},props:{title:{default:[]},dashBoardData:{default:""}},computed:{...X(kn,["administerOtherVaccine"]),...X(Yt,["tempScannedBatchNumber"]),...X(tt,["patient"])},async mounted(){if(this.isLoading=!0,!this.dashBoardData)return this.isLoading=!1,[];this.data=await On(),this.tableData=this.processData(),this.isLoading=!1},watch:{batchNumber:{handler(){this.validateBatchNumber()},deep:!0},tempScannedBatchNumber:{handler(){this.tempScannedBatchNumber!=null&&(this.batchNumber=this.tempScannedBatchNumber.text,this.validateBatchNumber())}},vaccineName:{handler(){this.validateVaccineName()}}},setup(){return{person:ie,pulseOutline:Ke,clipboardOutline:ne}},methods:{formatBirthdate(t){return S.getBirthdateAge(t)},async openClientProfile(t){const e=await vt.findByID(t);await tt().setPatientRecord(e),this.$router.push("patientProfile")},processData(){var e;return((e=this.data)==null?void 0:e.map(s=>{if(s.name=="missed_immunizations"){this.clientDetails=[],this.villageList=["All"];let a=[];const r=g=>g.map(l=>{let h=0;return l.clients.map(d=>{(l.drug_name==this.drug_name&&(this.village==d.table.city_village||this.village=="All")||(l.drug_name==this.drug_name||this.village==d.table.city_village)&&(!this.drug_name||!this.village)||!this.drug_name&&!this.village||!this.drug_name&&this.village=="All")&&(this.clientDetails.push({given_name:d.table.given_name,family_name:d.table.family_name,patient_id:d.table.patient_id,birthdate:d.table.birthdate,city_village:d.table.city_village}),h++),this.villageList.push(d.table.city_village)}),[l.drug_name,h]}).filter(l=>l[1]!==0);return this.title=="Client due today"&&(a=r(s.value.due_today_antigens)),this.title=="Client due this week"&&(a=r(s.value.due_this_week_antigens)),this.title=="Client due this month"&&(a=r(s.value.due_this_month_antigens)),this.title=="Client overdue over 5yrs"&&(a=r(s.value.over_five_missed_doses)),this.title=="Client overdue under 5yrs"&&(a=r(s.value.under_five_missed_doses)),this.clientDetails=[...new Set(this.clientDetails.map(g=>JSON.stringify(g)))].map(g=>JSON.parse(g)),this.villageList=[...new Set(this.villageList)],a}}))[0]},handleVillageClick(t){this.drug_name="",this.village=t,this.tableData=this.processData()},handleRowClick(t){var s;this.tableEvent=t.target;const e=this.tableEvent.closest("tr");if(e){const a=Array.from(((s=e.parentNode)==null?void 0:s.children)||[]).indexOf(e),r=this.tableData[a];this.drug_name=r[0],e.className?(this.drug_name="",this.tableData=this.processData()):this.processData()}},getAge(t){return S.calculateDisplayAge(t)},openPopover(t){this.event=t,this.popoverOpen=!0},showCPD(){this.showPD=!0,this.showDateBtns=!1},updateBatchNumber(t){var s;const e=t.target.value;this.batchNumber=e||((s=this.tempScannedBatchNumber)==null?void 0:s.text)||""},saveBatchWithTodayDate(){let t=N.getSessionDate();this.saveDta(t)},dismiss(){Rt.dismiss()},saveBatch(){let t;$t.isEmpty(this.vaccineDate)==!0?t=N.getSessionDate():t=this.vaccineDate,this.saveDta(t)},validateVaccineName(){if($t.isEmpty(this.vaccineName)==!0)return this.is_vaccine_name_valid=!0,!1;if($t.isEmpty(this.vaccineName)==!1)return this.is_vaccine_name_valid=!1,!0},updateVaccineName(t){this.currentDrugOb=t},isAlphaNumeric(t){return/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(t)},validateBatchNumber(){this.isAlphaNumeric(this.batchNumber)==!0&&(this.is_batch_number_valid=!1),this.isAlphaNumeric(this.batchNumber)==!1&&(this.is_batch_number_valid=!0)},updateBatchNumberByPassValue(t){this.batchNumber=t},saveDta(t){if(this.validateVaccineName(),this.validateBatchNumber(),this.is_batch_number_valid==!0){jt("Enter batch number!");return}if(this.batchNumber==""){jt("Enter batch number!");return}const e={batch_number:this.batchNumber,date_administered:t,drug_id:this.currentDrugOb.drug.drug_id,drug_:this.currentDrugOb},s=Yt();s.setAdministeredVaccine(e),Pn(this.patient),this.dismiss(),s.setTempScannedBatchNumber(null)}}}),Us={key:0,class:"spinner-overlay"},Ws={class:"header position_content"},Hs={style:{"font-size":"1.2em","font-weight":"700"}},zs={class:"dueCardContent"},Js=["onClick"],Gs={style:{"margin-right":"15px"}},js={style:{"align-items":"center",display:"flex"}},Ys={style:{"line-height":"1"}},Xs={class:"client_name"},Qs={class:"name"},qs={class:"demographicsOtherRow"},Zs={class:"demographicsText"};function Ks(t,e,s,a,r,g){const u=m("ion-spinner"),l=m("ion-icon"),h=m("ion-header"),d=m("ion-card-title"),f=m("ion-card-header"),D=m("DataTable"),b=m("ion-card-content"),C=m("ion-card"),k=m("ion-item"),y=m("ion-list"),B=m("ion-popover"),F=m("ion-content");return c(),v(x,null,[t.isLoading?(c(),v("div",Us,[o(u,{name:"bubbles"}),e[3]||(e[3]=n("div",{class:"loading-text"},"Please wait...",-1))])):I("",!0),o(h,null,{default:i(()=>[n("div",Ws,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=R=>t.dismiss())},[o(l,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Hs,_(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=R=>t.openPopover(R))},[o(l,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),o(F,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:i(()=>[n("div",null,[o(C,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:i(()=>[o(f,null,{default:i(()=>[o(d,{class:"sectionTitle"},{default:i(()=>e[4]||(e[4]=[P(" Summary of required doses ",-1)])),_:1,__:[4]})]),_:1}),o(b,null,{default:i(()=>[n("div",zs,[o(D,{options:t.options,data:t.tableData,class:"display nowrap",width:"100%",onClick:t.handleRowClick},{default:i(()=>e[5]||(e[5]=[n("thead",null,[n("tr",null,[n("th",null,"Vaccine"),n("th",null,"Quantity")])],-1)])),_:1,__:[5]},8,["options","data","onClick"])])]),_:1})]),_:1}),o(C,{class:"section",style:{"margin-inline":"0px"}},{default:i(()=>[o(f,null,{default:i(()=>[o(d,{class:"sectionTitle"},{default:i(()=>e[6]||(e[6]=[P("Client Details ",-1)])),_:1,__:[6]})]),_:1}),o(b,null,{default:i(()=>[(c(!0),v(x,null,W(t.clientDetails,(R,Y)=>(c(),v("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:Y,onClick:z=>t.openClientProfile(R.patient_id)},[n("div",Gs,[n("div",{class:K((R==null?void 0:R.gender)=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[o(l,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),n("div",js,[n("div",Ys,[n("div",Xs,[n("div",Qs,_(R.given_name)+" "+_(R.family_name),1)]),n("div",qs,[n("div",Zs,[P(_(R.gender=="M"?"Male":"Female")+" ",1),e[7]||(e[7]=n("span",{class:"dot"},".",-1)),P(_(t.formatBirthdate(R.birthdate)),1)])]),n("div",null,"Village: "+_(R.city_village),1)])])],8,Js))),128))]),_:1})]),_:1})]),o(B,{style:{"--offset-x":"-10px"},"is-open":t.popoverOpen,"show-backdrop":!1,"dismiss-on-select":!0,event:t.event,onDidDismiss:e[2]||(e[2]=R=>t.popoverOpen=!1)},{default:i(()=>[n("div",null,[e[8]||(e[8]=n("div",{style:{"font-weight":"700","padding-top":"10px","text-align":"center"}},"Filter by Village",-1)),(c(!0),v(x,null,W(t.villageList,(R,Y)=>(c(),O(y,{class:K(R==t.village?"active_village":"inactive_village"),style:{"--offset-x":"-30px"},key:Y},{default:i(()=>[o(k,{button:!0,detail:!1,style:{"--border-style":"none",cursor:"pointer"},onClick:z=>t.handleVillageClick(R)},{default:i(()=>[P(_(R),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"]))),128))])]),_:1},8,["is-open","event"])]),_:1})],64)}const to=H(Fs,[["render",Ks],["__scopeId","data-v-2b76e9ce"]]),eo=U({name:"Menu",mixins:[Dt],components:{IonContent:nt,IonHeader:et,IonItem:dt,IonList:lt,IonMenu:_t,IonTitle:ft,IonToolbar:rt,IonCheckbox:Lt,BasicForm:bt,BasicCard:Et,Carousel:an,Slide:nn,Pagination:en,Navigation:tn},data(){return{route:"",totalStats:[{name:"Total vaccinated this year",value:0},{name:"Total Female vaccinated this year",value:0},{name:"Total Male vaccinated this year",value:0}],reportData:""}},computed:{...X(yt,["substance"]),backgroundStyle(){return{background:"linear-gradient(180deg, rgba(150, 152, 152, 0.7) 0%, rgba(255, 255, 255, 0.9) 100%), url(".concat(Nn("backgroundImg.png"),")"),backgroundSize:"cover",backgroundBlendMode:"overlay",height:"22.8vh"}}},watch:{},async mounted(){new xs().setMessageHandler(this.onMessage)},methods:{async onMessage(t){var s,a,r;const e=JSON.parse(t.data);e.identifier===JSON.stringify({channel:"ImmunizationReportChannel",location_id:localStorage.getItem("locationID")})&&(this.reportData=e.message,console.log("DASHBOARD DATA",this.reportData),this.totalStats=[{name:"Total vaccinated this year",value:((s=this.reportData)==null?void 0:s.total_vaccinated_this_year)||0},{name:"Total Female vaccinated this year",value:((a=this.reportData)==null?void 0:a.total_female_vaccinated_this_year)||0},{name:"Total Male vaccinated this year",value:((r=this.reportData)==null?void 0:r.total_male_vaccinated_this_year)||0}])},openDueModal(t){const e={title:t,dashBoardData:this.reportData};St(to,{class:"fullScreenModal"},!0,e)},async openClientProfile(t){const e=await vt.findByNpid(t);await tt().setPatientRecord(e[0]),this.$router.push("patientProfile")}}}),no={class:"topStats"},ao={class:"totalStats",style:{background:"linear-gradient(180deg, #20b2aa 0%, #40c0b0 50%, rgb(233, 233, 233) 100%)"}},so={class:"statsValue",style:{"font-size":"1.4em"}},oo={class:"statsText",style:{"font-size":"0.9em"}},io={class:"dueCardContent"},ro={class:"statsValue"},lo={class:"statsValue"},co={class:"statsValue"},uo={class:"overDueCardContent"},po={class:"statsValue"},mo={class:"statsValue"},ho=["onClick"],go={style:{"margin-right":"15px"}},fo={style:{"align-items":"center",display:"flex"}},_o={style:{"line-height":"1"}},vo={class:"client_name"},yo={class:"name"},bo={class:"demographicsOtherRow"},Do={class:"demographicsText"};function wo(t,e,s,a,r,g){const u=m("Slide"),l=m("Pagination"),h=m("Carousel"),d=m("ion-card-title"),f=m("ion-card-header"),D=m("ion-card-content"),b=m("ion-card"),C=m("ion-icon"),k=m("ion-content");return c(),O(k,{class:"content"},{default:i(()=>[n("div",no,[n("div",null,[n("div",{style:Pt(t.backgroundStyle)},[o(h,{autoplay:4e3,"wrap-around":!0,itemsToShow:1.2,transition:600,style:{"padding-top":"20px"}},{addons:i(()=>[o(l)]),default:i(()=>[(c(!0),v(x,null,W(t.totalStats,y=>(c(),O(u,{key:y},{default:i(()=>[n("div",ao,[n("div",so,_(y.value),1),n("div",oo,_(y.name),1)])]),_:2},1024))),128))]),_:1})],4)]),o(b,{class:"section"},{default:i(()=>[o(f,null,{default:i(()=>[o(d,{class:"cardTitle"},{default:i(()=>e[5]||(e[5]=[P(" Clients due ",-1)])),_:1,__:[5]})]),_:1}),o(D,null,{default:i(()=>{var y,B,F;return[n("div",io,[n("div",{class:"dueCard",onClick:e[0]||(e[0]=R=>t.openDueModal("Client due today")),style:{border:"1px solid rgb(158, 207, 136)"}},[n("div",ro,_(((y=t.reportData)==null?void 0:y.due_today_count)||0),1),e[6]||(e[6]=n("div",{class:"statsText"},"Due today",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(239, 221, 121)"},onClick:e[1]||(e[1]=R=>t.openDueModal("Client due this week"))},[n("div",lo,_(((B=t.reportData)==null?void 0:B.due_this_week_count)||0),1),e[7]||(e[7]=n("div",{class:"statsText"},"Due this week",-1))]),n("div",{class:"dueCard",style:{border:"1px solid rgb(241, 154, 154)"},onClick:e[2]||(e[2]=R=>t.openDueModal("Client due this month"))},[n("div",co,_(((F=t.reportData)==null?void 0:F.due_this_month_count)||0),1),e[8]||(e[8]=n("div",{class:"statsText"},"Due this month",-1))])])]}),_:1})]),_:1}),o(b,{class:"section"},{default:i(()=>[o(f,null,{default:i(()=>[o(d,{class:"cardTitle"},{default:i(()=>e[9]||(e[9]=[P(" Clients overdue ",-1)])),_:1,__:[9]})]),_:1}),o(D,null,{default:i(()=>{var y,B;return[n("div",uo,[n("div",{class:"overDueCard",onClick:e[3]||(e[3]=F=>t.openDueModal("Client overdue under 5yrs"))},[n("div",po,_(((y=t.reportData)==null?void 0:y.under_five_overdue)||0),1),e[10]||(e[10]=n("div",{class:"statsText"},"Under 5yrs",-1))]),n("div",{class:"overDueCard",onClick:e[4]||(e[4]=F=>t.openDueModal("Client overdue over 5yrs"))},[n("div",mo,_(((B=t.reportData)==null?void 0:B.over_five_overdue)||0),1),e[11]||(e[11]=n("div",{class:"statsText"},"Over 5yrs",-1))])])]}),_:1})]),_:1}),o(b,{class:"section"},{default:i(()=>[o(f,null,{default:i(()=>[o(d,{class:"cardTitle"},{default:i(()=>{var y;return[P("Today's appointments("+_((y=t.appointments)==null?void 0:y.length)+") ",1)]}),_:1})]),_:1}),o(D,null,{default:i(()=>[(c(!0),v(x,null,W(t.appointments,(y,B)=>(c(),v("div",{class:"appointments",style:{display:"flex","margin-bottom":"10px"},key:B,onClick:F=>t.openClientProfile(y.npid)},[n("div",go,[n("div",{class:K(y.gender=="M"?"initialsBox maleColor":"initialsBox femaleColor")},[o(C,{style:{color:"rgb(78, 78, 78)","font-size":"30px"},icon:t.person},null,8,["icon"])],2)]),n("div",fo,[n("div",_o,[n("div",vo,[n("div",yo,_(y.given_name)+" "+_(y.family_name),1)]),n("div",bo,[n("div",Do,[P(_(y.gender=="M"?"Male":"Female")+" ",1),e[12]||(e[12]=n("span",{class:"dot"},".",-1)),P(_(t.formatBirthdate(y.birthdate)),1)])]),n("div",null,"Village: "+_(y==null?void 0:y.city_village),1)])])],8,ho))),128))]),_:1})]),_:1})])]),_:1})}const Co=H(eo,[["render",wo],["__scopeId","data-v-a8eeb2dc"]]),mt="visits",Ct="unsavedVisits";class So extends N{static getOperationMode(){const e=N.getAPIStatus(),s=N.getModsStatus(),a=N.getUseIndexDBStatus();return e&&!a?"API_ONLY":e&&a?"API_WITH_INDEXDB":s&&!a?"MODS_ONLY":s&&a?"MODS_WITH_INDEXDB":"OFFLINE"}static async startVisit(e,s,a="14"){const r=this.getOperationMode();try{if(await this.getActiveVisit(e))throw new Error("Patient already has an active visit");switch(r){case"API_ONLY":return await this._handleApiOnly(e,s,a);case"API_WITH_INDEXDB":return await this._handleApiWithIndexDB(e,s,a);case"MODS_ONLY":return await this._handleModsOnly(e,s,a);case"MODS_WITH_INDEXDB":return await this._handleModsWithIndexDB(e,s,a);default:return await this._handleOffline(e,s,a)}}catch(g){throw ht("Failed to start visit"),g}}static async closeVisit(e,s=new Date().toISOString()){const a=this.getOperationMode();try{if(!await this.getActiveVisit(e))throw new Error("No active visit found for patient");switch(a){case"API_ONLY":return await this._handleApiClose(e,s);case"API_WITH_INDEXDB":return await this._handleApiWithIndexDBClose(e,s);case"MODS_ONLY":return await this._handleModsClose(e,s);case"MODS_WITH_INDEXDB":return await this._handleModsWithIndexDBClose(e,s);default:return await this._handleOfflineClose(e,s)}}catch(r){throw ht("Failed to close visit"),r}}static async _handleApiOnly(e,s,a){const r=await super.postJson("/visits",{patientId:String(e),startDate:new Date().toISOString(),programId:a,location_id:String(s)});return at("Visit started (API only)"),r.data}static async _handleApiClose(e,s){const a=await this.getActiveVisit(e);if(!(a!=null&&a.id))throw new Error("No active visit found");const r=await super.patchJson("/visits/".concat(a.id,"/close"),{visit:{closedDateTime:s}});return at("Visit closed (API only)"),r.data}static async _handleApiWithIndexDB(e,s,a){try{const r=await this._handleApiOnly(e,s,a);return await this._storeInIndexDB(r),r}catch(r){return console.warn("API failed, falling back to IndexDB"),this._handleOffline(e,s,a)}}static async _handleApiWithIndexDBClose(e,s){try{const a=await this._handleApiClose(e,s);return await this._updateInIndexDB(a),a}catch(a){return console.warn("API failed, falling back to IndexDB"),this._handleOfflineClose(e,s)}}static async _handleModsOnly(e,s,a){if(!await wt())throw new Error("MODS connection unavailable");const g=await super.postJson("/visits",{patientId:String(e),startDate:new Date().toISOString(),programId:a,location_id:String(s)});return at("Visit started (MODS only)"),g.data}static async _handleModsClose(e,s){if(!await wt())throw new Error("MODS connection unavailable");const r=await this.getActiveVisit(e);if(!(r!=null&&r.id))throw new Error("No active visit found");const g=await super.patchJson("/visits/".concat(r.id,"/close"),{visit:{closedDateTime:s}});return at("Visit closed (MODS only)"),g.data}static async _handleModsWithIndexDB(e,s,a){try{if(await wt()){const g=await this._handleApiOnly(e,s,a);return await this._storeInIndexDB(g),at("Visit started (MODS + IndexDB)"),g}throw new Error("MODS connection unavailable")}catch(r){return console.warn("MODS failed, falling back to IndexDB"),this._handleOffline(e,s,a)}}static async _handleModsWithIndexDBClose(e,s){try{if(await wt()){const r=await this._handleApiClose(e,s);return await this._updateInIndexDB(r),at("Visit closed (MODS + IndexDB)"),r}throw new Error("MODS connection unavailable")}catch(a){return console.warn("MODS failed, falling back to IndexDB"),this._handleOfflineClose(e,s)}}static async _handleOffline(e,s,a){const r=new Date().toISOString(),g=ut(),u={patientId:e,startDate:r,closedDateTime:null,location_id:s,programId:a,sync_status:"pending",updated_at:r};return await g.postData("ADD_VISIT",{storeName:Ct,data:u}),at("Visit started (offline - will sync later)"),u}static async _handleOfflineClose(e,s){const a=await this.getActiveVisit(e);if(!a)throw new Error("No active visit found");const r=ut(),g=a.sync_status==="pending"?Ct:mt,u={closedDateTime:s,updated_at:new Date().toISOString(),sync_status:"pending"};return await r.postData("UPDATE_VISIT",{storeName:g,whereClause:{id:a.id},data:u}),at("Visit closed (offline - will sync later)"),{...a,...u}}static async _storeInIndexDB(e){if(!N.getUseIndexDBStatus())return;await ut().postData("ADD_VISIT",{storeName:mt,data:{...e,sync_status:"synced"}})}static async _updateInIndexDB(e){if(!N.getUseIndexDBStatus()||!e.id)return;await ut().postData("UPDATE_VISIT",{storeName:mt,whereClause:{id:e.id},data:{...e,sync_status:"synced"}})}static async getActiveVisit(e){if(this.getOperationMode().includes("API"))try{const a=await super.getJson("/check_patient_status/".concat(e));if(a!=null&&a.activeVisit)return a.activeVisit}catch(a){console.warn("Online active visit check failed, falling back to offline")}try{const a=d=>Array.isArray(d)?d:d.records||[],r=await st(Ct,{whereClause:{patientId:e}}),g=await st(mt,{whereClause:{patientId:e}}),u=a(r),l=a(g);return[...u,...l].find(d=>!d.closedDateTime)||null}catch(a){return console.error("Failed to get active visit from offline storage:",a),null}}static async getPatientVisits(e){if(this.getOperationMode().includes("API"))try{const a=await super.getJson("/visits",{patientId:e});if(Array.isArray(a==null?void 0:a.visits))return a.visits;if(a!=null&&a.records&&Array.isArray(a.records))return a.records}catch(a){}try{const[a,r]=await Promise.all([st(Ct,{whereClause:{patientId:e},sortBy:"startDate",sortOrder:"desc"}),st(mt,{whereClause:{patientId:e},sortBy:"startDate",sortOrder:"desc"})]);return[...a,...r].sort((g,u)=>new Date(u.startDate).getTime()-new Date(g.startDate).getTime())}catch(a){return console.error("Failed to get visits from offline storage:",a),[]}}static async syncPendingVisits(){const e=ut();try{const s=await e.postData("SYNC_UNSAVED_VISITS",{});return{success:(s==null?void 0:s.success)||!1,synced:(s==null?void 0:s.syncedCount)||0,failed:(s==null?void 0:s.failedCount)||0}}catch(s){return console.error("Failed to sync pending visits:",s),{success:!1,synced:0,failed:0}}}}const $o=U({components:{DataTable:Mt},props:{title:{type:String,default:""},list:{type:String,default:""},buttonTitle:{type:String,default:""},buttonLink:{type:String,default:""}},data(){return{patients:[],tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:t=>this.waitingTime(t),width:"15%"},{title:"Actions",data:null,render:(t,e,s)=>{const a=document.createElement("div");a.style.display="flex",a.style.gap="6px";const r="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",g=(u,l,h)=>{const d=document.createElement("ion-button");return d.innerText=u,d.size="small",d.fill="solid",d.color=l,d.style.cssText=r,d.addEventListener("click",h),d};return a.appendChild(g(this.buttonTitle,"primary",()=>this.navigateTo(s.patient_id,this.buttonLink))),a.appendChild(g("Profile","warning",()=>this.navigateTo(s.patient_id,"/patientProfile"))),a.appendChild(g("Abscond","danger",()=>this.handleAbscond(s))),a},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},computed:{...X(Ot,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation"])},watch:{patientsWaitingForConsultation:{handler(t){this.list==="CONSULTATION"&&(this.patients=t)},deep:!0},patientsWaitingForVitals:{handler(t){this.list==="VITALS"&&(this.patients=t)},deep:!0},patientsWaitingForLab:{handler(t){this.list==="LAB"&&(this.patients=t)},deep:!0},patientsWaitingForDispensation:{handler(t){this.list==="DISPENSATION"&&(this.patients=t)},deep:!0}},mounted(){this.setList()},methods:{setList(){const t={VITALS:this.patientsWaitingForVitals,CONSULTATION:this.patientsWaitingForConsultation,LAB:this.patientsWaitingForLab,DISPENSATION:this.patientsWaitingForDispensation},e=this.list;this.patients=t[e]||[]},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),s=Math.floor(e/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const a=Math.floor(s/60);if(a<24)return"".concat(a," hour").concat(a>1?"s":""," ago");const r=Math.floor(a/24);return"".concat(r," day").concat(r>1?"s":""," ago")},async navigateTo(t,e){console.log("Patient",t);let s=[];if(N.getUseIndexDBStatus()||N.getModsStatus()?(s=await st("patientRecords",{whereClause:{patientID:t}}),s=s[0]):s=await N.getJson("/patients/".concat(t,"/get_patient_record")),!s||s.length===0){ht("Patient not found in offline records.");return}const a=s;await tt().setPatientRecord(a),this.$router.push(e)},async handleAbscond(t){try{console.log("The patient being absconded",t);const e=String(localStorage.getItem("locationID"));await So.closeVisit(t.patientId,new Date().toISOString()),await Ot().refresh(e)}catch(e){console.error("Failed to abscond patient:",e)}},dismiss(){Rt.dismiss()}}}),Io={class:"modal-container"},ko={class:"dueCardContent"};function Ao(t,e,s,a,r,g){const u=m("ion-button"),l=m("ion-card-title"),h=m("ion-card-header"),d=m("DataTable"),f=m("ion-card-content"),D=m("ion-card");return c(),v("div",Io,[o(u,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:i(()=>e[0]||(e[0]=[P(" Close ",-1)])),_:1,__:[0]},8,["onClick"]),o(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:i(()=>[o(h,null,{default:i(()=>[o(l,{class:"sectionTitle"},{default:i(()=>[P(_(t.title),1)]),_:1})]),_:1}),o(f,null,{default:i(()=>[n("div",ko,[o(d,{data:t.patients,columns:t.tableColumns,class:"display nowrap compact",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})])}const Po=H($o,[["render",Ao],["__scopeId","data-v-47e49574"]]),Oo=U({components:{IonContent:nt,IonHeader:et,IonItem:dt,IonList:lt,IonIcon:j,IonCard:Nt,IonCardHeader:ce,IonCardTitle:de,IonCardContent:Ut,IonPopover:fe,DataTable:Mt},props:{title:{default:"Patient List"}},data(){return{patients:[],popoverOpen:!1,event:null,iconsContent:Ht,tableColumns:[{title:"Patient Name",data:"fullName"},{title:"Waiting Time",data:"arrivalTime",render:t=>this.waitingTime(t),width:"20%"},{title:"Actions",data:null,render:(t,e,s)=>{const a=document.createElement("div");a.style.display="flex",a.style.gap="6px";const r="\n              --padding-top: 4px;\n              --padding-bottom: 4px;\n              --padding-start: 8px;\n              --padding-end: 8px;\n              font-size: 0.8rem;\n              height: 28px;\n              min-width: 70px;\n              white-space: nowrap;\n            ",g=(u,l,h)=>{const d=document.createElement("ion-button");return d.innerText=u,d.size="small",d.fill="solid",d.color=l,d.style.cssText=r,d.addEventListener("click",h),d};return a.appendChild(g("Profile","warning",()=>this.navigateTo(s.patient_id,"/patientProfile"))),a},orderable:!1,width:"25%"}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:25,lengthChange:!1,dom:"Bfrtip",order:[[1,"desc"]],scrollX:!0,autoWidth:!1,language:{search:"_INPUT_",searchPlaceholder:"Search patients...",emptyTable:"No patients found."}}}},async mounted(){const t=String(localStorage.getItem("locationID")),e=new Date().toISOString().split("T")[0],s=await _n(),a=s.filter(l=>String(l.location_id)===t&&l.startDate>="".concat(e,"T00:00:00")&&l.startDate<="".concat(e,"T23:59:59")),r=s.map(l=>l.patientId);let g=[];N.getModsStatus()||N.getUseIndexDBStatus()?g=await st("patientRecords",{inClause:{patientID:r}})||[]:g=await N.getJson("get_patient_record",{patient_ids:r,paginate:!1});const u={};g.forEach(l=>{u[l.patientID]=l,u[String(l.patientID)]=l}),this.patients=a.map(l=>{var f,D,b;const h=u[l.patientId]||{};return{fullName:[(f=h==null?void 0:h.personInformation)==null?void 0:f.given_name,(D=h==null?void 0:h.personInformation)==null?void 0:D.middle_name,(b=h==null?void 0:h.personInformation)==null?void 0:b.family_name].filter(Boolean).join(" ").trim()||"Unknown (ID: ".concat(l.patientId,")"),arrivalTime:l.startDate,patient_id:l.patientId}})},methods:{openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Rt.dismiss()},waitingTime(t){if(!t)return"-";const e=Date.now()-new Date(t).getTime(),s=Math.floor(e/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," min").concat(s>1?"s":""," ago");const a=Math.floor(s/60);if(a<24)return"".concat(a," hour").concat(a>1?"s":""," ago");const r=Math.floor(a/24);return"".concat(r," day").concat(r>1?"s":""," ago")},async navigateTo(t,e){const s=await vt.findByID(t);await tt().setPatientRecord(s),this.$router.push(e)}}}),No={class:"modal-container"},To={class:"dueCardContent"};function Vo(t,e,s,a,r,g){const u=m("ion-button"),l=m("ion-card-title"),h=m("ion-card-header"),d=m("DataTable"),f=m("ion-card-content"),D=m("ion-card");return c(),v("div",No,[o(u,{class:"close-button",fill:"clear",size:"large",onClick:t.dismiss},{default:i(()=>e[0]||(e[0]=[P(" Close ",-1)])),_:1,__:[0]},8,["onClick"]),o(D,{class:"section",style:{"margin-bottom":"15px","margin-inline":"0"}},{default:i(()=>[o(h,null,{default:i(()=>[o(l,{class:"sectionTitle"},{default:i(()=>[P(_(t.title),1)]),_:1})]),_:1}),o(f,null,{default:i(()=>[n("div",To,[o(d,{data:t.patients,columns:t.tableColumns,class:"display nowrap compact",width:"100%"},null,8,["data","columns"])])]),_:1})]),_:1})])}const Bo=H(Oo,[["render",Vo],["__scopeId","data-v-8b0a446b"]]),Mo=U({name:"OPDAppointmentsModal",components:{IonPage:Bt,IonHeader:et,IonContent:nt,IonItem:dt,IonList:lt,IonIcon:j,IonCard:Nt,IonCardContent:Ut,IonPopover:fe,DataTable:Mt,IonSegment:on,IonSegmentButton:sn,IonLabel:ge,IonRow:Vt,IonCol:Tt,DateInputField:zt},props:{title:{type:String,default:"OPD Appointments"},programType:{type:String,required:!0},programId:{type:Number,required:!0}},data(){return{isLoading:!1,popoverOpen:!1,event:null,iconsContent:Ht,appointments:[],viewMode:"today",startDate:S.sessionDate(),endDate:S.sessionDate(),calendarOutline:gt,openOutline:pe,tableColumns:[{title:"Patient ID",data:"ID"},{title:"Name",data:"name"},{title:"Age/DOB",data:"ageDob"},{title:"Gender",data:"gender"},{title:"Village",data:"village"},{title:"Appointment Date",data:"appointmentDate"},{title:"Actions",data:null,render:(t,e,s)=>{const a=document.createElement("div"),r=document.createElement("ion-button");return r.innerText="Profile",r.size="small",r.style.color="#fff",r.style.padding="8px 12px",r.style.marginRight="8px",r.addEventListener("click",()=>this.openClientProfile(s.ID)),a.appendChild(r),a},orderable:!1}],tableOptions:{responsive:!0,searching:!0,ordering:!0,pageLength:20,lengthChange:!1,dom:"Bfrtip",order:[[5,"asc"]]}}},async mounted(){await this.loadAppointments()},methods:{async loadAppointments(){var t,e;this.isLoading=!0;try{const s=S.sessionDate(),a=this.viewMode==="today"?s:this.startDate,r=this.viewMode==="today"?s:this.endDate,g=localStorage.getItem("locationID"),u=await st("patientRecords"),l=[];for(const h of u)[...((t=h.appointments)==null?void 0:t.saved)||[],...((e=h.appointments)==null?void 0:e.unsaved)||[]].filter(D=>{if(D.concept_id!==5096||D.program_id!==14||D.location_id!==g)return!1;const b=D.value_datetime||D.obs_datetime;if(!b)return!1;const C=S.toStandardHisFormat(b),k=S.toStandardHisFormat(a),y=S.toStandardHisFormat(r);return C>=k&&C<=y}).forEach(D=>{var b,C,k,y,B;l.push({ID:h.ID,name:[(b=h.personInformation)==null?void 0:b.given_name,(C=h.personInformation)==null?void 0:C.family_name].filter(Boolean).join(" ")||"Unknown",ageDob:(k=h.personInformation)!=null&&k.birthdate?S.getBirthdateAge(h.personInformation.birthdate):"N/A",gender:((y=h.personInformation)==null?void 0:y.gender)||"Unknown",village:((B=h.personInformation)==null?void 0:B.home_village)||"Unknown",appointmentDate:S.toStandardHisDisplayFormat(D.value_datetime||D.obs_datetime),rawData:D})});this.appointments=l.sort((h,d)=>{const f=h.rawData.value_datetime||h.rawData.obs_datetime,D=d.rawData.value_datetime||d.rawData.obs_datetime;return new Date(f).getTime()-new Date(D).getTime()})}catch(s){console.error("Error loading appointments:",s),ht("Failed to load appointments")}finally{this.isLoading=!1}},async getAppointmentsD1(t){this.startDate=S.toStandardHisFormat(t),await this.loadAppointments()},async getAppointmentsD2(t){this.endDate=S.toStandardHisFormat(t),await this.loadAppointments()},onViewModeChange(){this.viewMode==="today"&&(this.startDate=S.sessionDate(),this.endDate=S.sessionDate()),this.loadAppointments()},async openClientProfile(t){try{const e=await st("patientRecords",{whereClause:{ID:t}});await tt().setPatientRecord(e[0]),this.$router.push("patientProfile")}catch(e){console.error("Error opening profile:",e),ht("Failed to open patient profile")}},openPopover(t){this.event=t,this.popoverOpen=!0},dismiss(){Rt.dismiss()}}}),Ro={class:"header position_content"},Lo={style:{"font-size":"1.2em","font-weight":"700"}},Eo={key:0,class:"date-filter"},xo={class:"dueCardContent"},Fo={key:1,class:"no-appointments"};function Uo(t,e,s,a,r,g){const u=m("ion-icon"),l=m("ion-header"),h=m("ion-label"),d=m("ion-segment-button"),f=m("ion-segment"),D=m("DateInputField"),b=m("ion-col"),C=m("ion-row"),k=m("DataTable"),y=m("ion-card-content"),B=m("ion-card"),F=m("ion-content"),R=m("ion-page");return c(),O(R,null,{default:i(()=>[o(l,null,{default:i(()=>[n("div",Ro,[n("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=(...Y)=>t.dismiss&&t.dismiss(...Y))},[o(u,{slot:"separator",size:"large",icon:t.iconsContent.arrowLeftWhite},null,8,["icon"])]),n("div",Lo,_(t.title),1),n("div",{style:{display:"flex","align-items":"center"},onClick:e[1]||(e[1]=Y=>t.openPopover(Y))},[o(u,{slot:"separator",size:"large",icon:t.iconsContent.fillerWhite},null,8,["icon"])])])]),_:1}),o(F,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:i(()=>[o(f,{modelValue:t.viewMode,"onUpdate:modelValue":e[2]||(e[2]=Y=>t.viewMode=Y),onIonChange:t.onViewModeChange},{default:i(()=>[o(d,{value:"today"},{default:i(()=>[o(h,null,{default:i(()=>e[3]||(e[3]=[P("Today's Appointments",-1)])),_:1,__:[3]})]),_:1}),o(d,{value:"range"},{default:i(()=>[o(h,null,{default:i(()=>e[4]||(e[4]=[P("Date Range",-1)])),_:1,__:[4]})]),_:1})]),_:1},8,["modelValue","onIonChange"]),t.viewMode==="range"?(c(),v("div",Eo,[o(C,null,{default:i(()=>[o(b,null,{default:i(()=>[o(D,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:t.endDate,disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","maxDate","onUpdate:rawDateValue"])]),_:1}),o(b,null,{default:i(()=>[o(D,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):I("",!0),o(B,{class:"section",style:{"margin-bottom":"25px","margin-inline":"0px"}},{default:i(()=>[o(y,null,{default:i(()=>[n("div",xo,[t.appointments.length>0?(c(),O(k,{key:0,data:t.appointments,columns:t.tableColumns,options:t.tableOptions,class:"display nowrap",width:"100%"},null,8,["data","columns","options"])):(c(),v("div",Fo," No appointments found for the selected "+_(t.viewMode==="today"?"day":"date range"),1))])]),_:1})]),_:1})]),_:1})]),_:1})}const Wo=H(Mo,[["render",Uo],["__scopeId","data-v-aff82b51"]]),Ho={class:"card-count"},zo={class:"card-label"},Jo="#ffffff",Go=U({__name:"DashboardCard",props:{icon:{},count:{},label:{},color:{}},emits:["cardClick"],setup(t,{emit:e}){const r={success:"#A5D6A7",info:"#81D4FA",warning:"#FFF59D",danger:"#EF9A9A"}[t.color||"info"]||"#E0E0E0";return(g,u)=>(c(),O(J(Nt),{class:"dashboard-card",style:Pt({borderColor:J(r),backgroundColor:Jo}),onClick:u[0]||(u[0]=l=>g.$emit("cardClick"))},{default:i(()=>[o(J(j),{icon:g.icon,class:"card-icon"},null,8,["icon"]),n("div",Ho,_(g.count),1),n("div",zo,_(g.label),1)]),_:1},8,["style"]))}}),jo=H(Go,[["__scopeId","data-v-84ad3c1b"]]),Yo=U({name:"OPDDashboard",components:{DashboardCard:jo},data(){return{totalPatientsToday:0,canViewVitals:!1,canViewConsultation:!1,canViewLab:!1,canViewDispensation:!1,canViewAppointments:!1,userRoles:[]}},computed:{...X(Ot,["patientsWaitingForVitals","patientsWaitingForConsultation","patientsWaitingForLab","patientsWaitingForDispensation","patientsVisits","todaysAppointmentsCount"])},watch:{$route(t,e){this.reloadRolePermissions()}},async mounted(){this.reloadRolePermissions();const t=N.getUserLocationId();t&&await Ot().refresh(t)},methods:{medkit(){return re},flask(){return ln},clipboard(){return ae},thermometer(){return se},calendar(){return rn},people(){return oe},reloadRolePermissions(){this.loadUserRoles(),this.updateCardVisibility()},loadUserRoles(){localStorage.getItem("userRoles");try{const t=localStorage.getItem("userRoles")||"[]",e=JSON.parse(t);this.userRoles=e.map(s=>typeof s=="string"?s:s.role||s.name||"")}catch(t){this.userRoles=[]}},hasAnyRole(t){const e=this.userRoles.map(s=>s.toLowerCase());return t.some(s=>e.includes(s.toLowerCase()))},updateCardVisibility(){this.canViewVitals=this.hasAnyRole(["Clinician","Nurse","Superuser"]),this.canViewConsultation=this.hasAnyRole(["Clinician","Superuser"]),this.canViewLab=this.hasAnyRole(["Lab"]),this.canViewDispensation=this.hasAnyRole(["Clinician","Pharmacist","Superuser"]),this.canViewAppointments=this.hasAnyRole(["Clinician","Nurse","Superuser"])},openAllModal(t,e,s){St(Bo,{class:"fullScreenModal"},!0,{title:t,buttonTitle:e,buttonLink:s})},openPatientsListModal(t,e,s,a){St(Po,{class:"fullScreenModal"},!0,{title:t,list:e,buttonTitle:s,buttonLink:a})},openAppointmentsModal(t,e){St(Wo,{class:"fullScreenModal"},!0,{title:t,programType:e,programId:14})}}}),Xo={class:"dashboard-wrapper"};function Qo(t,e,s,a,r,g){const u=m("ion-icon"),l=m("ion-card-title"),h=m("ion-card-header"),d=m("DashboardCard"),f=m("ion-row"),D=m("ion-grid"),b=m("ion-card-content"),C=m("ion-card"),k=m("ion-content");return c(),O(k,{fullscreen:!0},{default:i(()=>[n("div",Xo,[o(C,{class:"dashboard-card"},{default:i(()=>[o(h,{class:"dashboard-card-header"},{default:i(()=>[o(l,{class:"dashboard-title"},{default:i(()=>[o(u,{icon:t.people(),slot:"start",class:"dashboard-icon"},null,8,["icon"]),e[6]||(e[6]=P(" Today's Patients Overview ",-1))]),_:1,__:[6]})]),_:1}),o(b,null,{default:i(()=>[o(D,{class:"centered-grid"},{default:i(()=>[o(f,{class:"centered-row"},{default:i(()=>[o(d,{icon:t.people(),color:"primary",count:t.patientsVisits.length,label:"Total patients today",onCardClick:e[0]||(e[0]=y=>t.openAllModal("All patients today","View profile","/patientProfile"))},null,8,["icon","count"]),t.canViewAppointments?(c(),O(d,{key:0,icon:t.calendar(),color:"primary",count:t.todaysAppointmentsCount.length,label:"Appointments",onCardClick:e[1]||(e[1]=y=>t.openAppointmentsModal("OPD Appointments","14"))},null,8,["icon","count"])):I("",!0),t.canViewVitals?(c(),O(d,{key:1,icon:t.thermometer(),color:"primary",count:t.patientsWaitingForVitals.length,label:"Waiting for vitals",onCardClick:e[2]||(e[2]=y=>t.openPatientsListModal("Patients waiting for vitals","VITALS","Vitals","/OPDVitals"))},null,8,["icon","count"])):I("",!0),t.canViewConsultation?(c(),O(d,{key:2,icon:t.clipboard(),color:"primary",count:t.patientsWaitingForConsultation.length,label:"Waiting for consultation",onCardClick:e[3]||(e[3]=y=>t.openPatientsListModal("Patients waiting for consultation","CONSULTATION","Consultation","/OPDConsultationPlan"))},null,8,["icon","count"])):I("",!0),t.canViewLab?(c(),O(d,{key:3,icon:t.flask(),color:"primary",count:t.patientsWaitingForLab.length,label:"Waiting for lab",onCardClick:e[4]||(e[4]=y=>t.openPatientsListModal("Patients waiting for lab","LAB","Lab","/OPDConsultationPlan"))},null,8,["icon","count"])):I("",!0),t.canViewDispensation?(c(),O(d,{key:4,icon:t.medkit(),color:"primary",count:t.patientsWaitingForDispensation.length,label:"Waiting for dispensation",onCardClick:e[5]||(e[5]=y=>t.openPatientsListModal("Patients waiting for dispensation","DISPENSATION","Dispensation","/NCDDispensations"))},null,8,["icon","count"])):I("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})}const qo=H(Yo,[["render",Qo],["__scopeId","data-v-07aedaee"]]),Zo=U({name:"NCDDashboard",mixins:[Dt],components:{ApexChart:De},data(){return{dashboardData:"",isChartReady:!1,lineChartOptions:{chart:{height:350,type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:2},xaxis:{categories:[]},colors:["#2563eb","#10b981"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},lineChartSeries:[{name:"Male",data:[]},{name:"Female",data:[]}],barChartOptions:{chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,horizontal:!1}},xaxis:{categories:[]},colors:["#2563eb","#10b981","#f43f5e"],grid:{borderColor:"#f3f4f6",row:{colors:["transparent","transparent"],opacity:.5}},tooltip:{theme:"light"},legend:{show:!0,position:"top"}},barChartSeries:[{name:"Type 1 Diabetes",data:[]},{name:"Type 2 Diabetes",data:[]},{name:"Hypertention",data:[]}]}},watch:{$route:{async handler(){await this.initializeChartData()},deep:!0}},async mounted(){await this.initializeChartData()},methods:{async initializeChartData(){this.dashboardData=await this.getDashboardData(),this.lineChartOptions.xaxis.categories=this.dashboardData.gender_data.categories,this.lineChartSeries[0].data=this.dashboardData.gender_data.femaleSeries,this.lineChartSeries[1].data=this.dashboardData.gender_data.maleSeries,this.barChartOptions.xaxis.categories=this.dashboardData.diagnosis_data.categories,this.barChartSeries[0].data=this.dashboardData.diagnosis_data.typeOneSeries,this.barChartSeries[1].data=this.dashboardData.diagnosis_data.typeTwoSeries,this.barChartSeries[2].data=this.dashboardData.diagnosis_data.hypertentionSeries,await le(),setTimeout(()=>{this.isChartReady=!0},100)},getDashboardData(){return N.getJson("programs/32/reports/ncd_dashboard",{start_date:S.toStandardHisFormat(S.sessionDate()),end_date:S.toStandardHisFormat(S.sessionDate())})}}}),Ko={style:{display:"flex",gap:"20px",width:"100%","padding-left":"20px","padding-right":"20px"}},ti={style:{display:"flex",gap:"20px","padding-left":"20px","padding-right":"20px"}},ei={ref:"chartRef1"},ni={ref:"chartRef2"};function ai(t,e,s,a,r,g){const u=m("ion-card-content"),l=m("ion-card"),h=m("ApexChart");return c(),v(x,null,[n("div",Ko,[o(l,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:i(()=>[o(u,null,{default:i(()=>e[0]||(e[0]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's Appointments")],-1)])),_:1,__:[0]})]),_:1}),o(l,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:i(()=>[o(u,null,{default:i(()=>e[1]||(e[1]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Today's referrals")],-1)])),_:1,__:[1]})]),_:1}),o(l,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:i(()=>[o(u,null,{default:i(()=>e[2]||(e[2]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Total active pregnancies")],-1)])),_:1,__:[2]})]),_:1}),o(l,{style:{"margin-bottom":"20px","background-color":"#fff"},class:"top-card"},{default:i(()=>[o(u,null,{default:i(()=>e[3]||(e[3]=[n("div",{class:"top-card-text"},[n("div",{class:"text-2xl font-bold"},"0"),n("h3",{class:"text-sm font-medium"},"Due this week")],-1)])),_:1,__:[3]})]),_:1})]),n("div",ti,[o(l,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:i(()=>[o(u,null,{default:i(()=>[e[4]||(e[4]=n("div",{class:"font-medium"},"Patients distribution by gestation age",-1)),n("div",ei,[t.isChartReady?(c(),O(h,{key:0,style:{width:"100%",height:"500px"},type:"bar",options:t.barChartOptions,series:t.barChartSeries},null,8,["options","series"])):I("",!0)],512)]),_:1,__:[4]})]),_:1}),o(l,{style:{"margin-bottom":"20px","background-color":"#fff",width:"100%"},class:"top-card"},{default:i(()=>[o(u,null,{default:i(()=>[e[5]||(e[5]=n("div",{class:"font-medium"},"Patients distribution by age",-1)),n("div",ni,[t.isChartReady?(c(),O(h,{key:0,style:{width:"100%",height:"500px"},type:"line",options:t.lineChartOptions,series:t.lineChartSeries},null,8,["options","series"])):I("",!0)],512)]),_:1,__:[5]})]),_:1})])],64)}const si=H(Zo,[["render",ai],["__scopeId","data-v-58e2a3d8"]]),oi=U({name:"Home",mixins:[_e,Dt],components:{IonContent:nt,IonHeader:et,IonPage:Bt,IonToolbar:rt,Toolbar:ye,IonRow:Vt,DateInputField:zt,IonIcon:j,IonButton:ue,IonCol:Tt},data(){const t=M(S.sessionDate()),e=M(S.sessionDate()),s=M(S.sessionDate()),a=M([]);return{segmentContent:"Today",minDate:s,startDate:t,endDate:e,people:a,calendarOutline:gt,eyeOutline:dn}},computed:{},$route:{async handler(){},deep:!0},watch:{},async mounted(){this.getAppointments()},methods:{setSegmentContent(t){this.segmentContent=t},formatBirthdate(t){return S.getBirthdateAge(t)},async getAppointments(){this.people=[],(await we.getAppointments(this.startDate,this.endDate,"")).forEach(e=>{const s={person_id:e.person_id,npid:e.npid,appointment_id:103,encounter_id:e.encounter_id,name:e.given_name.concat(" ",e.family_name),gender:e.gender,ageDob:this.formatBirthdate(e.birthdate),village:e.city_village,appointmentDate:S.toStandardHisDisplayFormat(e.appointment_date)};this.people.push(s)})},async getAppointmentsD1(t){this.startDate=S.toStandardHisFormat(t),await this.getAppointments()},async getAppointmentsD2(t){this.endDate=S.toStandardHisFormat(t),await this.getAppointments()},async openClientProfile(t){await vt.findByNpid(t),this.isPharmacist()},isPharmacist(){const t=JSON.parse(localStorage.getItem("userRoles")),e=t||[];e.some(s=>e.some(a=>a.role==="Pharmacist"))&&(this.$router.push("dispensation"),N.getProgramID()==32?this.$router.push("NCDDispensations"):this.$router.push("patientProfile"))}}}),ii={class:"appointments-container"},ri={key:0,class:"date-filter"},li={class:"appointments-table"};function di(t,e,s,a,r,g){const u=m("ion-label"),l=m("ion-segment-button"),h=m("ion-segment"),d=m("DateInputField"),f=m("ion-col"),D=m("ion-row"),b=m("ion-icon"),C=m("ion-button"),k=m("ion-card");return c(),v("div",ii,[n("div",null,[o(h,{value:t.segmentContent,style:{"margin-top":"5px","padding-left":"0%","padding-right":"0%","justify-content":"left"}},{default:i(()=>[o(l,{value:"Today",onClick:e[0]||(e[0]=y=>t.setSegmentContent("Today"))},{default:i(()=>[o(u,null,{default:i(()=>e[3]||(e[3]=[P("Today",-1)])),_:1,__:[3]})]),_:1}),o(l,{value:"Tomorrow",onClick:e[1]||(e[1]=y=>t.setSegmentContent("Tomorrow"))},{default:i(()=>[o(u,null,{default:i(()=>e[4]||(e[4]=[P("Tomorrow",-1)])),_:1,__:[4]})]),_:1}),o(l,{value:"Date range",onClick:e[2]||(e[2]=y=>t.setSegmentContent("Date range"))},{default:i(()=>[o(u,null,{default:i(()=>e[5]||(e[5]=[P("Date range",-1)])),_:1,__:[5]})]),_:1})]),_:1},8,["value"])]),t.segmentContent==="Date range"?(c(),v("div",ri,[o(D,null,{default:i(()=>[o(f,null,{default:i(()=>[o(d,{inputHeader:"Start Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.startDate,eventType:"",minDate:"",maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD1},null,8,["icon","inputValue","onUpdate:rawDateValue"])]),_:1}),o(f,null,{default:i(()=>[o(d,{inputHeader:"End Date",sectionHeaderFontWeight:20,unit:"",icon:t.calendarOutline,placeholder:"press to select date",iconRight:"",inputWidth:"100%",inputValue:t.endDate,eventType:"",minDate:t.startDate,maxDate:"",disabled:!1,"onUpdate:rawDateValue":t.getAppointmentsD2},null,8,["icon","inputValue","minDate","onUpdate:rawDateValue"])]),_:1})]),_:1})])):I("",!0),t.people.length>0?(c(),O(k,{key:1},{default:i(()=>[n("table",li,[e[6]||(e[6]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"NPID"),n("th",null,"Age/DOB"),n("th",null,"Gender"),n("th",null,"Village"),n("th",null,"Appointment Date")])],-1)),n("tbody",null,[(c(!0),v(x,null,W(t.people,y=>(c(),v("tr",{key:y.npid},[n("td",null,[o(D,null,{default:i(()=>[o(f,null,{default:i(()=>[P(_(y.name),1)]),_:2},1024),o(f,null,{default:i(()=>[o(C,{style:{position:"absolute",right:"10px","--padding-start":"8px","--padding-end":"8px","--padding-bottom":"4px","--box-shadow":"none"},onClick:B=>t.openClientProfile(y.npid),color:"primary",fill:"clear",size:"small"},{default:i(()=>[o(b,{icon:t.eyeOutline,style:{"font-size":"24px"}},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),n("td",null,_(y.npid),1),n("td",null,_(y.ageDob),1),n("td",null,_(y.gender),1),n("td",null,_(y.village),1),n("td",null,_(y.appointmentDate),1)]))),128))])])]),_:1})):(c(),O(k,{key:2},{default:i(()=>e[7]||(e[7]=[n("div",{class:"no-appointments"},"No appointments found for the selected date range.",-1)])),_:1,__:[7]}))])}const ci=H(oi,[["render",di],["__scopeId","data-v-c47f7768"]]),ui=U({name:"referrals",components:{},data(){return{segmentContent:"Internal referrals",checkUnderFive:!1}},methods:{setSegmentContent(t){}}}),pi={key:0},mi={style:{display:"flex","margin-top":"10px"}},hi={key:0,style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},gi={key:1,style:{width:"50vw","background-color":"#fff","border-radius":"5px"}},fi={key:1};function _i(t,e,s,a,r,g){const u=m("ion-label"),l=m("ion-segment-button"),h=m("ion-segment"),d=m("VisitsHistory");return c(),v(x,null,[n("div",null,[o(h,{value:t.segmentContent,style:{"margin-top":"5px","margin-left":"20px","justify-content":"left"}},{default:i(()=>[o(l,{value:"Internal referrals",onClick:e[0]||(e[0]=f=>t.setSegmentContent("Internal referrals"))},{default:i(()=>[o(u,null,{default:i(()=>e[2]||(e[2]=[P("Internal referrals",-1)])),_:1,__:[2]})]),_:1}),o(l,{value:"External referrals",onClick:e[1]||(e[1]=f=>t.setSegmentContent("External referrals"))},{default:i(()=>[o(u,null,{default:i(()=>e[3]||(e[3]=[P("External referrals",-1)])),_:1,__:[3]})]),_:1})]),_:1},8,["value"])]),t.segmentContent=="Internal referrals"?(c(),v("div",pi,[n("div",mi,[t.checkUnderFive?(c(),v("div",hi)):I("",!0),e[4]||(e[4]=n("div",{style:{width:"50vw","background-color":"#fff","border-radius":"5px","margin-right":"5px"}},null,-1)),t.checkUnderFive?I("",!0):(c(),v("div",gi))])])):I("",!0),t.segmentContent=="External referrals"?(c(),v("div",fi,[o(d)])):I("",!0)],64)}const vi=H(ui,[["render",_i],["__scopeId","data-v-faad8f8b"]]),yi=U({name:"Menu",components:{IonContent:nt,IonHeader:et,IonItem:dt,IonList:lt,IonMenu:_t,IonTitle:ft,IonToolbar:rt,IonCheckbox:Lt,IonIcon:j,BasicForm:bt,BasicCard:Et,Referrals:vi,Dashboard:si,ANCAppointments:ci},data(){return{menuItems:[{id:"dashboard",label:"Dashboard",icon:me},{id:"referrals",label:"Referrals",icon:he},{id:"appointments",label:"Appointments",icon:gt}],activeItem:"dashboard"}},computed:{...X(yt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),bi={style:{display:"flex"}},Di={class:"left_col"},wi={class:"nav-menu"},Ci=["onClick"],Si={class:"right_col"};function $i(t,e,s,a,r,g){const u=m("ion-icon"),l=m("Dashboard"),h=m("ANCAppointments"),d=m("Referrals");return c(),v("div",bi,[n("div",Di,[n("nav",wi,[n("ul",null,[(c(!0),v(x,null,W(t.menuItems,f=>(c(),v("li",{key:f.id,class:K({active:t.activeItem===f.id}),onClick:D=>t.setActiveItem(f.id)},[o(u,{icon:f.icon,size:"large",class:"menu-icon"},null,8,["icon"]),n("span",null,_(f.label),1)],10,Ci))),128))])])]),n("div",Si,[n("div",null,[t.activeItem==="dashboard"?(c(),O(l,{key:0})):I("",!0),t.activeItem==="appointments"?(c(),O(h,{key:1})):I("",!0),t.activeItem==="referrals"?(c(),O(d,{key:2})):I("",!0)])])])}const Ii=H(yi,[["render",$i],["__scopeId","data-v-7e786ea4"]]),ki=U({name:"Menu",components:{IonContent:nt,IonHeader:et,IonItem:dt,IonList:lt,IonMenu:_t,IonTitle:ft,IonToolbar:rt,IonCheckbox:Lt,BasicForm:bt,BasicCard:Et},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...X(yt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Ai={class:"left_col"},Pi={class:"nav-menu"},Oi=["onClick"];function Ni(t,e,s,a,r,g){return c(),v("div",null,[n("div",Ai,[n("nav",Pi,[n("ul",null,[(c(!0),v(x,null,W(t.menuItems,u=>(c(),v("li",{key:u.id,class:K({active:t.activeItem===u.id}),onClick:l=>t.setActiveItem(u.id)},_(u.label),11,Oi))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const Ti=H(ki,[["render",Ni],["__scopeId","data-v-32dd02d3"]]),Vi=U({name:"Menu",components:{IonContent:nt,IonHeader:et,IonItem:dt,IonList:lt,IonMenu:_t,IonTitle:ft,IonToolbar:rt,IonCheckbox:Lt,BasicForm:bt,BasicCard:Et},data(){return{menuItems:[{id:"dashboard",label:"Dashboard"},{id:"appointments",label:"Appointments"},{id:"referrals",label:"Referrals"}],activeItem:"dashboard"}},computed:{...X(yt,["substance"])},watch:{substance:{handler(){},deep:!0}},mounted(){},methods:{setActiveItem(t){this.activeItem=t}}}),Bi={class:"left_col"},Mi={class:"nav-menu"},Ri=["onClick"];function Li(t,e,s,a,r,g){return c(),v("div",null,[n("div",Bi,[n("nav",Mi,[n("ul",null,[(c(!0),v(x,null,W(t.menuItems,u=>(c(),v("li",{key:u.id,class:K({active:t.activeItem===u.id}),onClick:l=>t.setActiveItem(u.id)},_(u.label),11,Ri))),128))])])]),e[0]||(e[0]=n("div",{class:"right_col"},null,-1))])}const Ei=H(Vi,[["render",Li],["__scopeId","data-v-b49d8600"]]);function xi(){const t=Wt(),e=xt(),s=M(!1),{OPDActivities:a,NCDActivities:r}=At(e),g=async l=>{var h;try{const d=N.getUserID(),f=await be.getJson("user_properties",{user_id:d,property:l});return f!=null&&f.property_value?(h=f==null?void 0:f.property_value)==null?void 0:h.split(","):[]}catch(d){return console.error("Error fetching user activities:",d),[]}},u=async()=>{try{s.value=!1;const[l,h]=await Promise.all([g("OPD_activities"),g("NCD_activities")]);l.length>0&&e.setOPDActivity(l),h.length>0&&e.setNCDActivity(h)}catch(l){console.error("Error updating activities:",l)}finally{s.value=!0}};return it(()=>t.path,async()=>{await u()},{immediate:!0,deep:!0}),{ready:s,OPDActivities:a,NCDActivities:r,getUserActivities:g,updateActivities:u}}function Fi(){const t=Wt(),e=M(""),s=M(!1),a=M({}),r=()=>{const g=N.getUserRoles(),u=N.getProgramID(),l=N.getProgramName();e.value=g,s.value=!1,g==="Lab"&&u===14?a.value={url:"home",btnName:"Back to home",stepperTitle:"Laboratory"}:u===14&&g!=="Lab"?a.value={url:"OPDvitals",btnName:"Back to vitals",stepperTitle:"Consultation Plan"}:u===12?a.value={url:"contact",btnName:"Back"}:l==="LABOUR AND DELIVERY PROGRAM"?a.value={url:"labour/labourHome",btnName:"Back to home"}:l==="PNC PROGRAM"?a.value={url:"pnc/home",btnName:"Back to home"}:a.value={url:"",btnName:""},s.value=!0};return it(()=>t.path,()=>{r()},{immediate:!0,deep:!0}),{userRole:e,ready:s,userRoleSettings:a,updateUserRoleSettings:r}}const Ui={key:0,class:"spinner-overlay"},dr=U({__name:"HomePage",setup(t){const e=M(!0),s=Wt(),a=ut(),r=M(localStorage.getItem("sessionDate")||"");Fi();const g=vn(),{apiStatus:u}=At(ve()),{activeProgram:l}=At(g),h=It(()=>{switch(l.value.program_id){case ot.IMMUNIZATION_PROGRAM:return Co;case ot.OPD_PROGRAM:return qo;case ot.NCD_PROGRAM:return _s;case ot.ANC_PROGRAM:return Ii;case ot.PNC_PROGRAM:return Ei;case ot.LABOUR_AND_DELIVERY_PROGRAM:return Ti;case ot.HIV_PROGRAM:return Es;default:return null}}),d=()=>{const b=localStorage.getItem("sessionDate");(!b||b.trim()==="")&&(console.log("Session date is blank or undefined, calling checkAndsetSessionDate"),qt()),r.value=b||""};let f=null;kt(()=>{f=()=>d(),window.addEventListener("storage",f);const b=setInterval(d,1e3);cn(()=>{clearInterval(b),f&&window.removeEventListener("storage",f)}),d()}),it(r,(b,C)=>{(!b||b.trim()==="")&&(console.log("Session date became blank, calling checkAndsetSessionDate"),qt())}),it(()=>s.name,async b=>{b==="Home"&&(Xt(),await Qt().loadGlobalProperty(),a.initWorker(),a.postData("SYNC_ALL_DATA"))},{immediate:!0,deep:!0});const D=async()=>{try{const b=N.getUserID(),C=await be.getUserByID(b);if(C.location_id!=null){const k=await bn.getLocation(C.location_id);localStorage.setItem("locationData",JSON.stringify(k))}}catch(b){console.error("Failed to retrieve location data:",b)}};return u.value&&(xi(),D()),kt(async()=>{try{e.value=!0,a.terminate(),Xt(),await Qt().loadGlobalProperty(),$t.isEmpty(l.value)&&await yn.show(wn,{},"module-picker-modal")}catch(b){console.error("Error initializing component:",b)}finally{e.value=!1}}),(b,C)=>{const k=m("ion-spinner"),y=m("ion-content");return c(),O(J(Bt),null,{default:i(()=>[e.value?(c(),v("div",Ui,[o(k,{name:"bubbles"}),C[0]||(C[0]=n("div",{class:"loading-text"},"Please wait...",-1))])):I("",!0),o(ye),o(Cn),h.value?(c(),O(un(h.value),{key:1})):(c(),O(y,{key:2},{default:i(()=>C[1]||(C[1]=[n("div",{class:"container"},[n("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Welcome to MAHIS"),n("p",{style:{width:"100%","text-align":"center"}},"Please select a module to get started")],-1)])),_:1,__:[1]}))]),_:1})}}});export{dr as default};

System.register(["./index-legacy-F0DdSdcI.js","./ReportTable.vue_vue_type_style_index_0_lang-legacy-Cf2ws0Z4.js","./age_groups-legacy-PcrIMUD9.js","./report_service-legacy-B9Qn8WkG.js","./lodash-legacy-C-x9g9Na.js","./vendor-legacy-90IlaDvi.js","./apexcharts-legacy-kfpkXH0D.js","./chartjs-legacy-CH72RkMY.js","./barcode-qrcode-reader-legacy-joR_bLng.js"],(function(e,t){"use strict";var a,r,l,o,n,s,d,p,i,u,_,c,g;return{setters:[e=>{a=e.p,r=e.d,l=e.e,o=e.l,n=e.a},e=>{s=e._},e=>{d=e.A},e=>{p=e.R},e=>{i=e.l},e=>{u=e.d,_=e.r,c=e.y,g=e.f},null,null,null],execute:function(){const t=["started_new_on_art","started_previously_on_art","completed_new_on_art","completed_previously_on_art"];class h extends p{constructor(){super()}getTBPrevReport(){return this.getReport(`/programs/${this.programId}/reports/tb_prev2`)}buildReportData(e){const a=[];return["F","M"].forEach((r=>{d.forEach((l=>{const o={gender:r,ageGroup:l};t.forEach((t=>{o[`3hp_${t}`]=i.get(e[l][r],`3HP.${t}`,[]),o[`6h_${t}`]=i.get(e[l][r],`6H.${t}`,[])})),a.push(o)}))})),a}aggregate(e,t,a,r){return Object.values(e).reduce(((e,l)=>[...l[t][a][r],...e]),[])}getAggregatedMaleData(e){const a={gender:"Male",ageGroup:"All"};for(const r of t)a[`3hp_${r}`]=this.aggregate(e,"M","3HP",r),a[`6h_${r}`]=this.aggregate(e,"M","6H",r);return a}async getAggregatedMaternalStatus(e){const a=t.reduce(((t,a)=>[...t,{group:"3HP",indicator:a,data:this.aggregate(e,"F","3HP",a)},{group:"6H",indicator:a,data:this.aggregate(e,"F","6H",a)}]),[]),r=i.uniq(a.reduce(((e,t)=>[...e,...t.data]),[]).map((e=>e.patient_id))),l=await this.getMaternalStatus(r),o=l.FBf.concat(l.FP),n=[],s=(e,t,r)=>a.reduce(((a,r)=>r.indicator===e&&t===r.group?[...a,...r.data]:a),[]).filter((e=>"FNP"===r?!o.includes(e.patient_id):l[r].includes(e.patient_id)));for(const d of["FP","FNP","FBf"]){const e={gender:d,ageGroup:"All"};for(const a of t)e[`3hp_${a}`]=s(a,"3HP",d),e[`6h_${a}`]=s(a,"6H",d);n.push(e)}return n}}e("default",u({__name:"TbPrev",setup(e){const t=_("-"),d=_([]),p=[{path:"ageGroup",label:"Age group"},{path:"gender",label:"Gender",formatter:r},{path:"3hp_started_new_on_art",label:"3HP Started New on ART",drillable:!0},{path:"6h_started_new_on_art",label:"6H Started New on ART",drillable:!0},{path:"3hp_started_previously_on_art",label:"3HP Started Previously on ART",drillable:!0},{path:"6h_started_previously_on_art",label:"6H Started Previously on ART",drillable:!0},{path:"3hp_completed_new_on_art",label:"3HP Completed New on ART",drillable:!0},{path:"6h_completed_new_on_art",label:"6H Completed New on ART",drillable:!0},{path:"3hp_completed_previously_on_art",label:"3HP Completed Previously on ART",drillable:!0},{path:"6h_completed_previously_on_art",label:"6H Completed Previously on ART",drillable:!0}],i=[{path:"arv_number",label:"ARV Number",preSort:a,initialSort:!0},{path:"gender",label:"Gender",formatter:r},{path:"birthdate",label:"Date of Birth",formatter:l},{path:"art_start_date",label:"ART Start Date",formatter:l},{path:"tpt_initiation_date",label:"TPT Initiation Date",formatter:l},{path:"outcome",label:"Outcome"}];async function u({dateRange:e}){try{await o.show();const a=new h;a.setStartDate(e.startDate),a.setEndDate(e.endDate),t.value=a.getDateIntervalPeriod();const r=await a.getTBPrevReport();d.value=a.buildReportData(r),d.value.push(a.getAggregatedMaleData(r)),d.value.push(...await a.getAggregatedMaternalStatus(r))}catch(a){n("ERROR! Unable to load report data"),console.error(a)}await o.hide()}function b(e){return`${e.column.label} | ${e.row.ageGroup} | ${r(e.row.gender)}s`}function m(e){return e.row[e.column.path].map((e=>({...e,person_id:e.patient_id})))}return(e,a)=>(g(),c(s,{title:"PEPFAR TB Prev Report","report-type":"PEPFAR",columns:p,rows:d.value,period:t.value,"custom-drill-columns":i,"drill-title":b,"drill-row-parser":m,useDateRangeFilter:"",showIndices:"",onGenerate:u},null,8,["rows","period"]))}}))}}}));

import{d as Ae,aO as Pe,cu as Re,r,c as xe,aV as f,w as u,a as Te,O as G,f as j,J as V,l as m,u as k,a4 as Ie,k as d,m as Ne,i as h,bG as Ve,v as D,a7 as Be,b9 as C}from"./vendor-B45YKAfe.js";import{aF as U,u as Fe,aG as Me,aH as $e,aI as ze,aJ as He,c as Le,aK as Ee,f as We,$ as Ge,d as je,T as Ue,M as Je,V as Ke,H as B,aL as A,aM as Qe,aN as J,aO as qe,t as K,n as Xe,aP as P,K as Ye,aQ as Ze,a1 as Oe,S as et}from"./index-BqZqQXlC.js";import{D as tt}from"./DemographicBar-CzIRo7XC.js";import{u as F,D as at,C as st,T as nt}from"./TreatmentPlan-DVU0CHKu.js";import{I as it,N as ot,s as lt,c as rt,u as ct}from"./NextAppointment-DovFct7e.js";import{_ as ut}from"./RiskAssessment.vue_vue_type_script_setup_true_lang-16RBhTHN.js";import{_ as mt}from"./Vitals.vue_vue_type_script_setup_true_lang-DdWPtp8O.js";import{u as vt,_ as dt}from"./useFormWizard-DNHKcHMk.js";import{l as gt}from"./lodash-NJiRuGo9.js";import{a as Q,b as ft}from"./formatServerData-C1Okhs3N.js";import{C as pt}from"./Registration-FttFaHsR.js";import{u as St}from"./usePatientProfile-CRsox1ZF.js";import"./apexcharts-T5qsywHO.js";import"./DashBox-BH5GsJyv.js";import"./BasicForm-DkU_7qSv.js";import"./DateInputField-DnpzYyAZ.js";import"./previousDiagnosis-C_KZvLYx.js";import"./group_validation-BukzCa5l.js";import"./LabOrdersList-kZ8Iv02E.js";import"./drug_prescription_service-BclmV_Up.js";import"./ncd_appointment_service-BZtEGzv5.js";import"./useLocation-CaZyDFNH.js";import"./useExposeFromStandardForm-D-pkuoEN.js";import"./vaccines_service-CtX92eaA.js";import"./sms_service-CP36AD33.js";import"./EIRreportsStore-DG7Fzi5G.js";import"./Export-DTt6Tvy4.js";import"./Outcome-Cvg7yR3v.js";const ht={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},Dt={class:"back_profile"},Xt=Ae({__name:"ConsultationPlan",setup(bt,{expose:q}){const{onTabBeforeChange:X,currentTabIndex:v}=vt("Consultation Plan"),{printVisitSummary:Y}=St(),R=Pe(),Z=Re();r([]),r([]),r(!1);const x=r(!0),T=r(!1),p=r(!1),M=xe(()=>({text:p.value?"Saving...":"Finish",icon:p.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:T.value||p.value})),O=U(),ee=Fe(),te=Me(),ae=$e();ze();const se=He(),_=Le();Ee();const ne=We(),ie=F(),oe=Ge(),{patient:i}=f(ee),{vitals:le}=f(O),{investigations:re}=f(te),{diagnosis:ce}=f(ae),{substance:ue}=f(ne),{selectedNCDMedicationList:$}=f(se),{FootScreening:me,visualScreening:ve,cvScreening:de}=f(ie),{sessionDate:z}=f(oe),{apiStatus:Ct}=f(je());u(M,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:v.value,tabsLength:n.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),u(p,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const ge=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},y=()=>{let e=!1;return S(),p.value&&(e=!0),T.value=e,!e},fe=()=>{R.push("patientProfile")},I=()=>_.NCDActivities.map(e=>({title:e,icon:""})),n=r(I()),H=r(null),L=r(null),pe=r(null),Se=r(null),he=r(null),De=r(null),be=r(null),S=()=>{var s;if(!n.value||n.value.length===0)return console.log("Tabs not yet initialized"),null;const e=v.value>=0&&v.value<n.value.length?v.value:0;switch((s=n.value[e])==null?void 0:s.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(_.NCDActivities.length>0)switch(_.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},N=()=>{x.value=!1,setTimeout(()=>{v.value=0,x.value=!0},0)},E=()=>{const e=U();e.setVitals(e.getInitialVitals(i.value.ID))},g=async()=>{var s,c;const e=Ke(z.value,"sessionDate","value")||B.sessionDate(),t=A("vitals");for(let a=0;a<n.value.length;a++){const l=n.value[a];if(l.title==="Vital Signs")n.value[a].icon=w(e,t)?C:"";else if(l.title==="Risk Assessment"){const o=A("substanceAbuse");n.value[a].icon=w(e,o)?C:""}else if(l.title==="Investigations"){const o=(c=(s=i==null?void 0:i.value)==null?void 0:s.labOrders)==null?void 0:c.saved,b=o==null?void 0:o.filter(ke=>B.toStandardHisFormat(e)===B.toStandardHisFormat(ke.order_date));n.value[a].icon=(b==null?void 0:b.length)>0?C:""}else if(l.title==="Diagnosis"){const o=A("diagnosis");n.value[a].icon=w(e,o)?C:""}else if(l.title==="Complications Screening"){const o=A("screening");n.value[a].icon=w(e,o)?C:""}else l.title==="Treatment Plan"&&($.value.length>0?n.value[a].icon=Qe()?C:"":n.value[a].icon="")}y()},w=(e,t)=>{const s=new Date(e);return s.setHours(0,0,0,0),t.some(c=>{const a=new Date(c.obs_datetime);return a.setHours(0,0,0,0),a.getTime()===s.getTime()})},Ce=async()=>{var a,l,o,b;const e=[],t=await Q(ve.value),s=await ft(me.value),c=await Q(de.value);t.length>0&&e.push({concept_id:await P.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:P.getSessionDate(),child:t}),s.length>0&&e.push({concept_id:await P.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:P.getSessionDate(),child:s}),c.length>0&&e.push(...c),e.length>0?((b=(o=(l=(a=i.value).screening)!=null?l:a.screening={}).unsaved)!=null||(o.unsaved=[]),i.value.screening.unsaved.push(...e),Ye("Complications saved successfully")):K("No complications data to save")},_e=async()=>{const e=Ze();if(!gt.isEmpty(e.selectedMedicalAllergiesList)){const c=Oe(),a=e.selectedMedicalAllergiesList.map(o=>({concept_id:o.concept_id,obs_datetime:et.getSessionDate(),value_coded:o.concept_id,location_id:c.facilityLocation.code,value_text:o.name})),l=await lt(a);i.value=Object.assign(i.value,l),console.log("Allergies staged successfully:",i.value),e.clearSelectedMedicalAllergiesList()}const t=await rt();i.value=Object.assign(i.value,t);const s=await ct().saveNonPharmaTherapyPatientData();i.value=Object.assign(i.value,s)},ye=async(e,t)=>{var c,a,l;const s=(c=n.value[t])==null?void 0:c.title;e%1===0&&(v.value=e),s=="Vital Signs"&&((a=H.value)==null||a.onSubmit()),s=="Risk Assessment"&&((l=L.value)==null||l.onSubmit()),s=="Complications Screening"&&await Ce(),s=="Treatment Plan"&&await _e(),await J(i.value)},W=async()=>{p.value=!0;try{await qe(),await J(i.value),await we(),R.push("patientProfile")}catch(e){console.error("Error saving data:",e),K("Error occurred while saving data. Please try again.")}finally{p.value=!1}},we=async()=>{await Xe(pt,{class:"small-confirm-modal "})!=="dismiss"&&await Y()};return Te(async()=>{if(_.NCDActivities.length===0){R.push("patientProfile");return}F().resetScreening(),n.value=I(),await g(),(v.value===void 0||v.value<0)&&(v.value=0,console.log("Setting initial tab index to 0")),T.value=!1,p.value=!1,y()}),u(v,async()=>{await y()}),u(le,async()=>{await g()},{deep:!0}),u(i,async()=>{F().resetScreening(),await g()},{deep:!0}),u(z,async()=>{await g()},{deep:!0}),u(re,async()=>{await g()},{deep:!0}),u(ce,async()=>{await g()},{deep:!0}),u(ue,async()=>{await g()},{deep:!0}),u($,async()=>{await g()},{deep:!0}),u(Z,async e=>{N(),E(),n.value=I()},{deep:!0}),u(i,async(e,t)=>{e.ID!=t.ID&&(N(),E())},{deep:!0}),q({saveData:W,markWizard:g,refreshWizard:N,validateDoneButtonState:y}),(e,t)=>(j(),G(k(Be),null,{default:V(()=>[m(Ue),m(k(Ie),{fullscreen:!0},{default:V(()=>[m(tt),d("div",ht,[x.value?(j(),G(dt,{key:0,ref:"wizard","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:M.value,"custom-tabs":n.value,beforeChange:k(X),onChange:ye,"onComplete:wizard":t[1]||(t[1]=s=>W()),onDoneButtonChanged:ge},{default:V(()=>[d("div",null,[d("div",Dt,[m(Je,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:k(Ve),"font-weight":"600",onClick:t[0]||(t[0]=s=>fe())},null,8,["icon"])])]),h(d("div",null,[m(mt,{ref_key:"vitalsRef",ref:H},null,512)],512),[[D,S()=="Vitals"]]),h(d("div",null,[m(ut,{ref_key:"riskAssessmentRef",ref:L},null,512)],512),[[D,S()=="RiskAssessment"]]),h(d("div",null,[m(it,{ref_key:"investigationsRef",ref:pe},null,512)],512),[[D,S()=="Investigations"]]),h(d("div",null,[m(at,{ref_key:"diagnosisRef",ref:Se},null,512)],512),[[D,S()=="DiagnosisComponent"]]),h(d("div",null,[m(st,{ref_key:"complicationsRef",ref:he},null,512)],512),[[D,S()=="ComplicationsScreening"]]),h(d("div",null,[m(nt,{ref_key:"treatmentPlanRef",ref:De},null,512)],512),[[D,S()=="TreatmentPlan"]]),h(d("div",null,[m(ot,{ref_key:"nextAppointmentRef",ref:be},null,512)],512),[[D,S()=="NextAppointment"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Ne("",!0)])]),_:1})]),_:1}))}});export{Xt as default};

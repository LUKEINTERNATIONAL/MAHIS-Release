!function(){function e(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var o=i.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}System.register(["./vendor-legacy-PwJwfeg2.js","./app_encounter_service-legacy-LJRPnsbp.js","./index-legacy-CAqY44sk.js","./DatePicker.vue_vue_type_script_setup_true_lang-legacy-C8J1u2CB.js","./LocationFieldOptions-legacy-kZOU8BBH.js","./lodash-legacy-C-x9g9Na.js"],(function(t,i){"use strict";var o,n,a,s,d,r,l,c,u,g,p,h,y,f,m,b,v,_,A,w,C,T,D,E,I,S,O,V,H,P,B,N,G,W,k,F,L,M,U,x,R,j,Y,$,q,Q;return{setters:[e=>{o=e.d,n=e.r,a=e.w,s=e.cY,d=e.a,r=e.y,l=e.f,c=e.u,u=e.aQ,g=e.z,p=e.l,h=e.e,y=e.m,f=e.k,m=e.bh,b=e.aM,v=e.aL,_=e.G,A=e.D,w=e.A,C=e.dl,T=e.dm,D=e.B,E=e.M,I=e.L,S=e.J,O=e.d9,V=e.ac,H=e.F,P=e.bq,B=e.aK,N=e.b6,G=e.bm,W=e.aN,k=e.O},e=>{F=e.A},e=>{L=e.ad,M=e.Z,U=e.L,x=e.P,R=e.t,j=e.k,Y=e.m,$=e._},e=>{q=e._},e=>{Q=e.g},null],execute:function(){var i=document.createElement("style");i.textContent=".section-header ion-label[data-v-b7e7d5d8]{font-size:1rem;font-weight:600;letter-spacing:.5px;color:var(--ion-color-primary);text-transform:uppercase}ion-checkbox[data-v-b7e7d5d8]{--size: 24px !important}ion-radio[data-v-b7e7d5d8]{--size: 27px !important}.error[data-v-b7e7d5d8]{color:red;font-weight:700;font-style:italic}\n/*$vite$:1*/",document.head.appendChild(i);const z="2016-04-30",K={"Adults with stage 4 conditions":{concept:"WHO STAGE IV ADULT",priority:1,conditions:{stage:e=>4===e}},"Classify as stage 4 when reason for ART is WHO STAGE 4":{concept:"WHO STAGE IV ADULT",priority:2,conditions:{reasonForArt:e=>"WHO STAGE IV ADULT"===e}},"Adults with stage 3 conditions":{concept:"WHO STAGE III ADULT",priority:3,conditions:{stage:e=>3===e}},"Adults with stage 2 conditions":{concept:"WHO STAGE II ADULT",priority:4,conditions:{stage:e=>2===e}},"Adults with stage 1 conditions":{concept:"WHO STAGE I ADULT",priority:5,conditions:{stage:e=>1===e}}},J={"Children with stage 4 conditions":{concept:"WHO STAGE IV PEDS",priority:1,conditions:{stage:e=>4===e}},"Classify as stage 4 when reason for ART is WHO STAGE 4":{concept:"WHO STAGE IV PEDS",priority:2,conditions:{reasonForArt:e=>"WHO STAGE IV PEDS"===e}},"For children with stage 3 conditions":{concept:"WHO STAGE III PEDS",priority:3,conditions:{stage:e=>3===e}},"Children with stage 2 conditions":{concept:"WHO STAGE II PEDS",priority:4,conditions:{stage:e=>2===e}},"Children with stage 1 conditions":{concept:"WHO STAGE I PEDS",priority:5,conditions:{stage:e=>1===e}}},Z={"Warn if Severe weight loss is selected when actual patient BMI is acceptable":{priority:1,actions:{alert:async e=>await L(`Patient's BMI of ${e.bmi} greater than 18.5, do you wish to proceed?`,{confirmBtnLabel:"Yes, keep severe weightloss",cancelBtnLabel:"No, cancel"})},conditions:{selectedCondition:e=>"Severe weight loss >10% and/or BMI <18.5kg/m^2, unexplained"===e,bmi:e=>e>18.5}},"Warn for contradicting stage defining conditions":{priority:1,actions:{alert:async e=>!!(await L("CONTRADICTING STAGE DEFINING CONDITIONS",{confirmBtnLabel:"Keep Asymptomatic",cancelBtnLabel:"Keep other(s)"}))},conditions:{selectedCondition:e=>"Asymptomatic HIV infection"===e}}},X={"Enable TB staging condition if client is TB positive":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:()=>"Client registered as a TB Patient in the TB Module"},conditions:{tbPositive:e=>e,selectedCondition:e=>/\bTuberculosis \(PTB or EPTB\)|\bPulmonary tuberculosis/i.test(e)}},"Enable TB staging condition if client is EPTB positive":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:()=>"Client registered with EPTB in TB Module"},conditions:{eptbPositive:e=>e,selectedCondition:e=>/Extrapulmonary tuberculosis/i.test(e)}},"For children whose current weight percentile is less than 70":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:e=>`Child has a low weight percentile of ${e.weightPercentile}`},conditions:{selectedCondition:e=>"Severe unexplained wasting or malnutrition not responding to treatment (weight-for-height/ -age <70% or MUAC less than 11cm or oedema)"===e,weightPercentile:e=>e<70}},"Enable Moderate unexplained malnutrition for children whose weight for height is 70-79%":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:e=>`Child has weight percentile of ${e.weightPercentile}`},conditions:{selectedCondition:e=>"Moderate unexplained wasting/malnutrition not responding to treatment (weight-for-height/ -age 70-79% or muac 11-12 cm)"===e,weightPercentile:e=>e>=70&&e<=79}},"Disable moderate weight loss when Severe unexplained weight loss is chosen":{priority:2,actions:{isChecked:!1,disabled:!0},description:{color:"secondary",show:"always",info:()=>"Severe weight loss/manutrition was already selected"},conditions:{selectedCondition:e=>"Moderate unexplained wasting/malnutrition not responding to treatment (weight-for-height/ -age 70-79% or muac 11-12 cm)"===e,selectedConditions:e=>e.includes("Severe unexplained wasting or malnutrition not responding to treatment (weight-for-height/ -age <70% or MUAC less than 11cm or oedema)")}}},ee={"Enable TB staging condition if client is TB positive":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:()=>"Client registered Positive in TB Module"},conditions:{tbPositive:e=>e,selectedCondition:e=>/\bTuberculosis \(PTB or EPTB\)|\bPulmonary tuberculosis/i.test(e)}},"Enable TB staging condition if client is EPTB positive":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:()=>"Client registered with EPTB in TB Module"},conditions:{eptbPositive:e=>e,selectedCondition:e=>/Extrapulmonary tuberculosis/i.test(e)}},"Adults with a BMI less than 16":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:e=>`Adult has a low BMI of ${e.bmi}`},conditions:{selectedCondition:e=>"Severe weight loss >10% and/or BMI <18.5kg/m^2, unexplained"===e,bmi:e=>e<16}},"Adults whose BMI is between 16 and 18":{priority:3,actions:{isChecked:!0},description:{color:"warning",show:"onChecked",info:e=>`BMI of ${e.bmi} is between 16 and 18`},conditions:{selectedCondition:e=>"Moderate weight loss less than or equal to 10 percent, unexplained"===e,bmi:e=>e>=16&&e<=18.5}},"Disable Moderate weight loss if severe weightloss is selected":{priority:2,actions:{isChecked:!1,disabled:!0},description:{color:"secondary",show:"always",info:()=>"Severe weight loss was already selected"},conditions:{selectedCondition:e=>"Moderate weight loss less than or equal to 10 percent, unexplained"===e,selectedConditions:e=>e.includes("Severe weight loss >10% and/or BMI <18.5kg/m^2, unexplained")}}},te={"Children under twelve months who tested positive on Rapid test and have presumed severe HIV":{concept:"PRESUMED SEVERE HIV",priority:1,conditions:{ageInMonths:e=>e<12,selectedConditions:e=>M.getConceptsByCategory("pshd_condition").some((t=>e.includes(t.name))),testType:e=>"HIV rapid test"===e}},"Has stage 4 conditions":{concept:"WHO STAGE IV PEDS",priority:2,conditions:{stage:e=>4===e}},"Has stage 3 conditions":{concept:"WHO STAGE III PEDS",priority:3,conditions:{stage:e=>3===e}},"Children under twelve who tested positive via HIV DNA Polymerase Chain Reaction test":{concept:"HIV DNA polymerase chain reaction",priority:4,conditions:{ageInMonths:e=>e<12,testType:e=>"HIV DNA polymerase chain reaction"===e}},"Children who are less than 24 months":{concept:"HIV infected",priority:5,conditions:{ageInMonths:e=>e<24}},"Children between 24 and 56 months who have stage 2 or 1 conditions":{concept:"CD4 COUNT LESS THAN OR EQUAL TO 750",priority:6,conditions:{ageInMonths:e=>e>=24&&e<=56,cd4Date:e=>new Date(e)<=new Date(z),cd4:e=>e<=750,cd4Modifier:e=>"<"===e||"="===e,stage:e=>e<=2}},"Children with CD4 count less than 500 and have stage 1 and stage 2 conditions":{concept:"CD4 COUNT LESS THAN OR EQUAL TO 500",priority:7,conditions:{cd4:e=>e<=500,cd4Date:e=>new Date(e)<=new Date(z),cd4Modifier:e=>"<"===e||"="===e,stage:e=>e<=2}},"Children who are more than five years old and have cd4 count less than 500":{concept:"CD4 COUNT LESS THAN OR EQUAL TO 500",priority:9,conditions:{cd4Date:e=>new Date(e)<=new Date(z),age:e=>e>5,cd4:e=>e<=500,cd4Modifier:e=>"<"===e||"="===e}},"Children over date 2014-04-01 and less than Five years old":{concept:"HIV infected",priority:10,conditions:{date:e=>e>="2014-04-01",age:e=>e<=5}},"Women who are breast feeding":{concept:"BREASTFEEDING",priority:11,conditions:{gender:e=>"F"===e,breastFeeding:e=>"Yes"===e,stage:e=>e<=2}},"Women who are pregnant":{concept:"PATIENT PREGNANT",priority:12,conditions:{gender:e=>"F"===e,pregnant:e=>"Yes"===e,stage:e=>e<=2}},"Asymptomatic patient with either stage one or stage two conditions":{concept:"Asymptomatic",priority:13,conditions:{stage:e=>e<=2}}},ie={"Has stage 4 conditions":{concept:"WHO STAGE IV ADULT",priority:1,conditions:{stage:e=>4===e}},"Has HIV wasting syndrome identified in stage 3":{concept:"WHO STAGE IV ADULT",priority:2,conditions:{selectedConditions:e=>M.getConceptsByCategory("severe_hiv_wasting_syndrome").reduce(((t,i)=>e.includes(i.name)?t+1:0),0)>=2}},"Has stage 3 conditions":{concept:"WHO STAGE III ADULT",priority:3,conditions:{stage:e=>3===e}},"CD4 less than 350 for adults before 2014":{concept:"cd4 less than or equal to 350",priority:4,conditions:{cd4Date:e=>new Date(e)<=new Date(z),cd4:e=>e<=350,cd4Modifier:e=>"<"===e||"="===e}},"CD4 less than 250 for adults after 2014":{concept:"cd4 less than or equal to 250",priority:4,conditions:{cd4Date:e=>new Date(e)<=new Date(z),cd4:e=>e<=250,cd4Modifier:e=>"<"===e||"="===e}},"CD4 less than 350 for adults after 2014":{concept:"cd4 less than or equal to 350",priority:5,conditions:{cd4Date:e=>new Date(e)<=new Date(z),cd4:e=>e<=350,cd4Modifier:e=>"<"===e||"="===e}},"CD4 less than 500 for adults after 2014":{concept:"cd4 less than or equal to 500",priority:6,conditions:{cd4Date:e=>new Date(e)<=new Date(z),cd4:e=>e<=500,cd4Modifier:e=>"<"===e||"="===e}},"Women who are breast feeding":{concept:"BREASTFEEDING",priority:8,conditions:{gender:e=>"F"===e,breastFeeding:e=>"Yes"===e,stage:e=>e<=2}},"Women who are pregnant":{concept:"PATIENT PREGNANT",priority:7,conditions:{gender:e=>"F"===e,pregnant:e=>"Yes"===e,stage:e=>e<=2}},"Asymptomatic patient with either stage one or stage two conditions":{concept:"Asymptomatic",priority:9,conditions:{stage:e=>e<=2}}};class oe extends F{constructor(t,i,o){super(t,52,o),e(this,"age",void 0),e(this,"confirmatoryTest",void 0),this.age=i,this.confirmatoryTest=null}isAdult(){return this.age>=15}isPedaid(){return this.age<=14}setAge(e){this.age=e}getFacilities(e=""){return U.getFacilities({name:e})}getConfirmatoryTestType(){return this.confirmatoryTest}cd4CountIsValid(e){try{return!!e.match(/^(=|<|>)([0-9]*)$/m)}catch(t){return!1}}getAlertGuidelines(){return Z}getWhoStageGuidelines(){return this.isAdult()?K:J}getProgramEligibilityGuidelines(){return this.isAdult()?ie:te}getRecommendedConditionGuidelines(){return this.isAdult()?ee:X}getStagingConditions(e){const t=this.getStagingCategoryByNum(e);return F.getConceptsByCategory(t)}buildWhoStageObs(e){return this.buildValueCoded("Who stage",e)}buildWhoCriteriaObs(e){return this.buildValueCoded("Who stages criteria present",e)}buildReasonForArtObs(e){return this.buildValueCoded("Reason for ART eligibility",e)}getStagingCategoryByNum(e){switch(e){case 1:return this.isAdult()?"stage_1_conditions_adults":"stage_1_conditions_pedaids";case 2:return this.isAdult()?"stage_2_conditions_adults":"stage_2_conditions_pedaids";case 3:return this.isAdult()?"stage_3_conditions_adults":"stage_3_conditions_pedaids";case 4:return this.isAdult()?"stage_4_conditions_adults":"stage_4_conditions_pedaids";default:return""}}async loadHivConfirmatoryTestType(){const e=await F.getFirstValueCoded(this.patientID,"Confirmatory hiv test type");e&&(this.confirmatoryTest=e)}}const ne={key:0,style:{"border-bottom":"dashed #ccc"},class:"ion-padding"},ae={class:"error"},se={class:"error"},de={class:"accordion_group"},re={style:{"font-weight":"bold"}},le={class:"error"},ce={class:"ion-padding",slot:"content"},ue={style:{"border-top":"dashed #ccc","border-bottom":"dashed #ccc"},class:"ion-padding"},ge={class:"ion-padding"},pe={class:"error"},he={key:0,class:"ion-padding"},ye={class:"error"},fe={class:"error"},me={class:"error"},be={class:"ion-padding",style:{"border-bottom":"dashed #ccc"}},ve=o({__name:"Staging",props:{hideSubmit:{type:Boolean,default:!1},date:{default:oe.getSessionDate()}},setup(e,{expose:t}){const i=e,o=new x,F=n({}),L=new oe(o.getID(),o.getAge(),-1);a((()=>i.date),(e=>{var t;const i=null!==(t=null==e?void 0:e.standardDate)&&void 0!==t?t:oe.getSessionDate(),n=k(i).diff(o.getBirthdate(),"years");L.setAge(n),L.setDate(i)}),{deep:!0,immediate:!0});const U=s({stage_4_conditions:{title:"Stage 4 Conditions",options:[]},stage_3_conditions:{title:"Stage 3 Conditions",options:[]},stage_2_conditions:{title:"Stage 2 Conditions",options:[]},stage_1_conditions:{title:"Stage 1 Conditions",options:[]}}),$=n([]),z=s({cd4:"",cd4Date:"",isChildBearing:!1,reasonForArt:"",pregnant:"",breastFeeding:"",cd4Available:"",cd4Location:"",whoStage:"",staging:[],confirmatoryTest:"",selectedFacilityObj:null}),K={reasonForArt:{buildObs:()=>L.buildReasonForArtObs(z.reasonForArt),suggestAvalue:()=>({"PRESUMED SEVERE HIV":{priority:1,condition:()=>o.getAgeInMonths()<12&&"HIV rapid test"===z.confirmatoryTest&&M.getConceptsByCategory("pshd_condition").some((e=>_e().includes(e.name)))},"WHO STAGE IV PEDS":{priority:2,condition:()=>L.isPedaid()&&J(["stage_4_conditions"])},"WHO STAGE III PEDS":{priority:3,condition:()=>L.isPedaid()&&J(["stage_3_conditions"])},"HIV DNA polymerase chain reaction":{priority:4,condition:()=>o.getAgeInMonths()<12&&"HIV DNA polymerase chain reaction"===z.confirmatoryTest},"CD4 COUNT LESS THAN OR EQUAL TO 750":{priority:5,condition:()=>ie(750)&&ve()&&Z()&&o.ageInMonths()>=24&&o.ageInMonths()<=56},"CD4 COUNT LESS THAN OR EQUAL TO 500":{priority:6,condition:()=>L.isPedaid()&&ie(500)&&ve()&&Z()},"HIV infected":{priority:7,condition:()=>o.getAgeInMonths()<24||o.getAge()<=5},"WHO STAGE IV ADULT":{priority:1,condition:()=>{const e=M.getConceptsByCategory("severe_hiv_wasting_syndrome");return L.isAdult()&&(J(["stage_4_conditions"])||e.filter((e=>_e().includes(e.name))).length>=2)}},"WHO STAGE III ADULT":{priority:2,condition:()=>L.isAdult()&&J(["stage_3_conditions"])},"cd4 less than or equal to 350":{priority:3,condition:()=>L.isAdult()&&ie(350)&&Z()},"cd4 less than or equal to 250":{priority:4,condition:()=>L.isAdult()&&ie(250)&&Z()},"cd4 less than or equal to 500":{priority:4,condition:()=>L.isAdult()&&ie(500)&&Z()},BREASTFEEDING:{priority:5,condition:()=>L.isAdult()&&"Yes"===z.breastFeeding&&ve()},"PATIENT PREGNANT":{priority:6,condition:()=>L.isAdult()&&"Yes"===z.pregnant&&ve()},Asymptomatic:{priority:7,condition:()=>ve()}})},whoStage:{buildObs:()=>L.buildWhoStageObs(z.whoStage),suggestAvalue:()=>({"WHO STAGE IV ADULT":{priority:1,condition:()=>L.isAdult()&&J(["stage_4_conditions"])},"WHO STAGE III ADULT":{priority:2,condition:()=>L.isAdult()&&J(["stage_3_conditions"])},"WHO STAGE II ADULT":{priority:3,condition:()=>L.isAdult()&&J(["stage_2_conditions"])},"WHO STAGE I ADULT":{priority:4,condition:()=>L.isAdult()&&J(["stage_1_conditions"])},"WHO STAGE IV PEDS":{priority:1,condition:()=>L.isPedaid()&&(J(["stage_4_conditions"])||"WHO STAGE IV PEDS"===z.reasonForArt)},"WHO STAGE III PEDS":{priority:2,condition:()=>L.isPedaid()&&J(["stage_3_conditions"])},"WHO STAGE II PEDS":{priority:3,condition:()=>L.isPedaid()&&J(["stage_2_conditions"])},"WHO STAGE I PEDS":{priority:4,condition:()=>L.isPedaid()&&J(["stage_1_conditions"])}})},cd4Available:{required:()=>!0,dataHandler:e=>{"Yes"!=e&&(z.cd4="",z.cd4Date=""),F.value.cd4="",F.value.cd4Date="",F.value.cd4Location=""}},pregnant:{required:()=>z.isChildBearing,buildObs:()=>L.buildValueCoded("Is patient pregnant?",z.pregnant)},breastFeeding:{required:()=>z.isChildBearing,buildObs:()=>L.buildValueCoded("Is patient breast feeding?",z.breastFeeding)},cd4:{required:()=>"Yes"===z.cd4Available,validation:()=>{te()?ee()>1e4&&(F.value.cd4="CD4 value cannot exceed 10,000"):F.value.cd4="Invalid cd4 count format, expected e.g. <100 or >500 or =750"},buildObs:()=>L.buildValueNumber("CD4 count",ee(),X())},cd4Date:{required:()=>"Yes"===z.cd4Available,dataHandler:e=>{e&&(z.cd4Date=k(e).format("YYYY-MM-DD"))},validation:()=>{if(isNaN(new Date(z.cd4Date).getTime()))return void(F.value.cd4Date="Invalid CD4 date");const e=k(z.cd4Date);e.isAfter(k(L.getDate()))?F.value.cd4Date=`Cd4 result date can't be greater than ${L.getDate()}`:e.isBefore(k(o.getBirthdate()))&&(F.value.cd4Date="CD4 date must not be earlier than birthdate")},buildObs:()=>L.buildValueDate("Cd4 count datetime",z.cd4Date)},cd4Location:{required:()=>"Yes"===z.cd4Available,dataHandler:e=>z.cd4Location=e.label,searchFacilities:e=>Q(e).then((e=>$.value=e)),buildObs:()=>L.buildValueText("Cd4 count location",z.cd4Location)},staging:{validation:()=>{if(Object.keys(U).every((e=>Ce(e)<=0)))return void(F.value.staging="Please select one or more staging conditions");const e=["stage_4_conditions","stage_3_conditions","stage_2_conditions"].some((e=>Ce(e)>0));U.stage_1_conditions.options.some((e=>/asymptomatic/i.test(e.name)&&e.checked))&&e&&(F.value.staging="Asymptomatic cannot be selected with other staging conditions")},buildObs:()=>Object.keys(U).reduce(((e,t)=>(U[t].options.forEach((t=>{t.checked&&e.push(t.name)})),e)),[]).map((e=>L.buildWhoCriteriaObs(e)))}};function J(e){return e.some((e=>Ce(e)>0))}function Z(){return new Date(z.cd4Date)<=new Date("2016-04-30")}function X(){var e,t,i;return null!==(e=null===(t=`${null!==(i=z.cd4)&&void 0!==i?i:""}`.match(/^([=><]{1})/))||void 0===t?void 0:t[0])&&void 0!==e?e:""}function ee(){var e,t;return parseInt(null!==(e=null===(t=`${z.cd4}`.match(/\d+$/))||void 0===t?void 0:t[0])&&void 0!==e?e:"0")}function te(){return/^([=><]{1})(\d+)$/i.test(`${z.cd4}`)}function ie(e){if(!te())return!1;const t=X(),i=ee();return"="===t&&e===i||("<"===t&&i<=e||">"===t&&i>=e)}function ve(){return J(["stage_2_conditions","stage_1_conditions"])}function _e(){return Object.keys(U).reduce(((e,t)=>(U[t].options.forEach((t=>t.checked&&e.push(t.name))),e)),[])}function Ae(e){if(F.value[e]="","function"==typeof K[e].required){if(K[e].required()&&!z[e])return void(F.value[e]="This field is required")}z[e]&&"function"==typeof K[e].validation&&K[e].validation()}function we(){return Object.keys(z).reduce(((e,t)=>{if(t in K&&z[t]&&"function"==typeof K[t].buildObs){const i=K[t].buildObs();return Array.isArray(i)?[...e,...i]:[...e,i]}return e}),[])}function Ce(e){return U[e].options.filter((e=>e.checked)).length}function Te(e,t){e in K&&"function"==typeof K[e].dataHandler&&K[e].dataHandler(t),Ae(e),Object.keys(K).forEach((e=>function(e){if(K[e]&&"suggestAvalue"in K[e]){var t,i;z[e]="";const o=K[e].suggestAvalue(),n=Object.keys(o).reduce(((e,t)=>{const i=o[t];return"function"==typeof i.condition&&i.condition()?[...e,{value:t,priority:i.priority}]:e}),[]);z[e]=null!==(t=null===(i=n.sort(((e,t)=>e.priority-t.priority)))||void 0===i||null===(i=i[0])||void 0===i?void 0:i.value)&&void 0!==t?t:""}}(e)))}function De(){Object.keys(U).forEach((e=>{var t,i;const o=Number(null!==(t=null===(i=e.match(/\d+/))||void 0===i?void 0:i[0])&&void 0!==t?t:0),n=L.getStagingConditions(o);U[e].options=n.map((e=>({checked:!1,name:e.name,concept_id:e.concept_id})))}))}function Ee(){return Object.keys(K).forEach((e=>Ae(e))),Object.keys(F.value).every((e=>`${F.value[e]}`.length<=0))}return a((()=>i.date),(e=>{L.setDate(e),o.date=e,Object.keys(z).forEach((e=>{"boolean"==typeof z[e]?z[e]=!1:Array.isArray(z[e])?z[e]=[]:z[e]=""})),Object.keys(F.value).forEach((e=>F.value[e]="")),De()})),d((async()=>{await async function(){await L.loadHivConfirmatoryTestType(),z.confirmatoryTest=L.getConfirmatoryTestType(),z.isChildBearing=o.isChildBearing()}(),De()})),t({validateStagingForm:Ee,buildPayload:we,onSubmit:async function(){if(console.log("Submitting staging"),!Ee())return R("Please review form for errors"),!1;try{const e=await Promise.all(we());return await L.createEncounter(),await L.saveObservationList(e),j("Staging Observations saved!"),!0}catch(e){return console.error(e),Y("Error has occured while saving observations"),!1}}}),(e,t)=>(l(),r(c(u),null,{default:g((()=>[p(c(W),null,{default:g((()=>[z.isChildBearing?(l(),h("div",ne,[p(c(m),null,{default:g((()=>[p(c(b),null,{default:g((()=>[p(c(v),null,{default:g((()=>[p(c(_),{color:"light"},{default:g((()=>[p(c(A),{slot:"start"},{default:g((()=>t[14]||(t[14]=[w("Pregnant?")]))),_:1,__:[14]}),p(c(C),{modelValue:z.pregnant,"onUpdate:modelValue":t[0]||(t[0]=e=>z.pregnant=e),onIonChange:t[1]||(t[1]=e=>Te("pregnant",e.detail.value)),class:"custom-segment"},{default:g((()=>[p(c(T),{value:"Yes"},{default:g((()=>[p(c(A),null,{default:g((()=>t[15]||(t[15]=[w("Yes")]))),_:1,__:[15]})])),_:1}),p(c(T),{value:"No"},{default:g((()=>[p(c(A),null,{default:g((()=>t[16]||(t[16]=[w("No")]))),_:1,__:[16]})])),_:1})])),_:1},8,["modelValue"])])),_:1}),f("div",ae,D(F.value.pregnant),1)])),_:1}),p(c(v),null,{default:g((()=>[p(c(_),{color:"light"},{default:g((()=>[p(c(A),{slot:"start"},{default:g((()=>t[17]||(t[17]=[w("Breastfeeding?")]))),_:1,__:[17]}),p(c(C),{modelValue:z.breastFeeding,"onUpdate:modelValue":t[2]||(t[2]=e=>z.breastFeeding=e),onIonChange:t[3]||(t[3]=e=>Te("breastFeeding",e.detail.value)),class:"custom-segment"},{default:g((()=>[p(c(T),{value:"Yes"},{default:g((()=>[p(c(A),null,{default:g((()=>t[18]||(t[18]=[w("Yes")]))),_:1,__:[18]})])),_:1}),p(c(T),{value:"No"},{default:g((()=>[p(c(A),null,{default:g((()=>t[19]||(t[19]=[w("No")]))),_:1,__:[19]})])),_:1})])),_:1},8,["modelValue"])])),_:1}),f("div",se,D(F.value.breastFeeding),1)])),_:1})])),_:1})])),_:1})])):y("",!0),f("div",de,[p(c(E),{color:"light"},{default:g((()=>[(l(!0),h(H,null,I(U,((e,i)=>(l(),r(c(S),{key:i},{default:g((()=>[p(c(_),{color:"light",slot:"header"},{default:g((()=>[p(c(A),{style:{color:"grey","font-size":"17px"},class:"ion-padding"},{default:g((()=>[f("b",re,[w(D(e.title)+" ",1),p(c(O),{color:Ce(`${i}`)>0?"primary":void 0},{default:g((()=>[w(" Selected: "+D(Ce(`${i}`)),1)])),_:2},1032,["color"])]),f("p",le,D(F.value.staging),1)])),_:2},1024)])),_:2},1024),f("div",ce,[p(c(V),null,{default:g((()=>[(l(!0),h(H,null,I(e.options,((e,o)=>(l(),r(c(_),{key:o},{default:g((()=>[p(c(P),{modelValue:e.checked,"onUpdate:modelValue":t=>e.checked=t,onIonChange:t=>Te("staging",{stage_type:i,raw:t,option:e})},null,8,["modelValue","onUpdate:modelValue","onIonChange"]),p(c(A),{style:{margin:"13px"}},{default:g((()=>[w(D(e.name),1)])),_:2},1024),t[20]||(t[20]=f("p",null,null,-1)),e.description?(l(),r(c(B),{key:0,color:e.color},{default:g((()=>[w(D(e.text),1)])),_:2},1032,["color"])):y("",!0)])),_:2,__:[20]},1024)))),128))])),_:2},1024)])])),_:2},1024)))),128))])),_:1})]),f("div",ue,[f("div",ge,[p(c(_),{color:"light"},{default:g((()=>[p(c(A),{slot:"start"},{default:g((()=>t[21]||(t[21]=[w("Recent CD4 count results available?")]))),_:1,__:[21]}),p(c(C),{modelValue:z.cd4Available,"onUpdate:modelValue":t[4]||(t[4]=e=>z.cd4Available=e),onIonChange:t[5]||(t[5]=e=>Te("cd4Available",e.detail.value)),class:"custom-segment"},{default:g((()=>[p(c(T),{value:"Yes"},{default:g((()=>[p(c(A),null,{default:g((()=>t[22]||(t[22]=[w("Yes")]))),_:1,__:[22]})])),_:1}),p(c(T),{value:"No"},{default:g((()=>[p(c(A),null,{default:g((()=>t[23]||(t[23]=[w("No")]))),_:1,__:[23]})])),_:1})])),_:1},8,["modelValue"])])),_:1}),f("div",pe,D(F.value.cd4Available),1)]),"Yes"===z.cd4Available?(l(),h("div",he,[p(c(m),{class:"ion-padding"},{default:g((()=>[p(c(b),null,{default:g((()=>[p(c(v),null,{default:g((()=>[p(c(A),null,{default:g((()=>t[24]||(t[24]=[w(" CD4 Count Date ")]))),_:1,__:[24]}),p(q,{place_holder:"Enter CD4 Date",onDateUpDated:t[6]||(t[6]=e=>Te("cd4Date",`${e.value.year}-${e.value.month}-${e.value.day}`)),date_prop:""}),f("div",ye,D(F.value.cd4Date),1)])),_:1})])),_:1}),p(c(b),{style:{"margin-top":"15px"}},{default:g((()=>[p(c(v),null,{default:g((()=>[p(c(N),{modelValue:z.cd4,"onUpdate:modelValue":t[7]||(t[7]=e=>z.cd4=e),onIonInput:t[8]||(t[8]=e=>Te("cd4",e)),placeholder:"CD4 count e.g. <100 or >500","label-placement":"stacked",label:"CD4 Count",fill:"outline"},null,8,["modelValue"]),f("div",fe,D(F.value.cd4),1)])),_:1}),p(c(v),null,{default:g((()=>[p(c(G),{modelValue:z.selectedFacilityObj,"onUpdate:modelValue":[t[9]||(t[9]=e=>z.selectedFacilityObj=e),t[10]||(t[10]=e=>Te("cd4Location",e))],multiple:!1,taggable:!1,"close-on-select":!0,openDirection:"bottom","tag-placeholder":"Find and select facility",placeholder:"Select CD4 Count location",selectLabel:"",label:"label",searchable:!0,"track-by":"label",onSearchChange:t[11]||(t[11]=e=>K.cd4Location.searchFacilities(e)),options:$.value},null,8,["modelValue","options"]),f("div",me,D(F.value.cd4Location),1)])),_:1})])),_:1})])),_:1})])):y("",!0)]),f("div",be,[p(c(m),null,{default:g((()=>[p(c(b),null,{default:g((()=>[p(c(v),null,{default:g((()=>[p(c(N),{readonly:"",placeholder:"N/A",label:"REASON FOR ART:",modelValue:z.reasonForArt,"onUpdate:modelValue":t[12]||(t[12]=e=>z.reasonForArt=e)},null,8,["modelValue"])])),_:1}),p(c(v),null,{default:g((()=>[p(c(N),{readonly:"",placeholder:"N/A",label:"WHO STAGE:",modelValue:z.whoStage,"onUpdate:modelValue":t[13]||(t[13]=e=>z.whoStage=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])])),_:1})])),_:1}))}});t("default",$(ve,[["__scopeId","data-v-b7e7d5d8"]]))}}}))}();

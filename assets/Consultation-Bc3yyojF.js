import{r as u,O as Oe,c as J,a as ue,d as me,y as Q,f as y,u as e,bg as ot,z as n,l as t,S as Qt,U as tt,k as s,T as ea,A as v,B as $,bf as at,W as Y,I as j,ah as He,ad as ze,an as ta,e as V,m as x,G,D as L,aw as de,ax as q,F as te,bP as De,L as ce,ay as be,V as aa,du as it,w as rt,c_ as dt,aj as ut,p as ct,aA as na,az as sa,aa as la,cv as oa,cu as ia,ab as H,ac as re,aK as ra,E as K,bZ as da,n as ua,ag as nt,M as ca,J as fe,e1 as pe,bq as va,e2 as st,av as ke,e3 as ie,ar as fa,e4 as pa,bn as ma,c$ as ga,dn as ha,dp as lt,e5 as _a,a$ as ya}from"./vendor-DowD5zKn.js";import{P as We,t as se,m as W,az as Me,k as Ve,A as ba,J as je,u as Ye,Z as Ca,_ as Ce,H as Pe,S as vt,ad as wa,a3 as Sa,cn as ft,co as Ue,e as ka}from"./index-Cd6xOYoL.js";import{a as Da}from"./lab_order-CMyy1o6a.js";import{C as Va}from"./chartjs-Cs1JiRsG.js";import{A as ee}from"./app_encounter_service-BtCPTlWa.js";import{C as Ie}from"./consultation_service-CnT5fN18.js";import{_ as pt}from"./DatePicker.vue_vue_type_script_setup_true_lang-DhIL5mOk.js";import{P as Ia}from"./patient_type_service-BpmS2uQh.js";import"./lodash-Dt8AsbQm.js";const Ea=()=>{const o=u(2),i=u(null);let r=null;const f=u(!1),b=u([]);return window.addEventListener("resize",()=>{r&&i.value&&r.resize()}),{chartPeriod:o,weightChartCanvas:i,isLoadingWeightData:f,weightData:b,loadWeightHistory:async()=>{f.value=!0;try{const T=await new We().getWeightHistory();T&&T.length>0?(b.value=T.map(E=>({date:Oe(E.date).format("MM-DD"),weight:parseFloat(E.weight)})),b.value.sort((E,I)=>Oe(E.date,"MM-DD").valueOf()-Oe(I.date,"MM-DD").valueOf())):(se("No weight history found for this patient"),b.value=[],r&&(r.destroy(),r=null))}catch(w){console.error("Error loading weight history:",w),W("Failed to load weight history"),b.value=[],r&&(r.destroy(),r=null)}finally{f.value=!1}},initializeWeightChart:()=>{var D;if(!i.value||b.value.length===0)return;r&&(r.destroy(),r=null);const w=((D=i.value.parentElement)==null?void 0:D.clientWidth)||800;i.value.width=w,i.value.height=300;const T=i.value.getContext("2d");if(!T)return;const E=b.value.map(g=>g.date),I=b.value.map(g=>g.weight),S=b.value.findIndex(g=>g.height!==void 0),C=T.createLinearGradient(0,0,0,400);C.addColorStop(0,"rgba(75, 192, 75, 0.6)"),C.addColorStop(1,"rgba(75, 192, 75, 0.1)"),r=new Va(T,{type:"line",data:{labels:E,datasets:[{label:"Weight",data:I,borderColor:"rgb(75, 192, 75)",backgroundColor:C,tension:.3,fill:!0,pointBackgroundColor:"rgb(75, 192, 75)",pointRadius:5}]},options:{responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:10,right:10,bottom:10,left:10}},scales:{y:{min:30,max:220,ticks:{stepSize:10},grid:{color:"rgba(200, 200, 200, 0.3)"}},x:{grid:{color:"rgba(200, 200, 200, 0.3)"}}},plugins:{tooltip:{callbacks:{afterLabel:g=>{if(g.dataIndex===S&&b.value[S].height)return"Height: ".concat(b.value[S].height,"cm")}}}}}})},cleanupChart:()=>{r&&(r.destroy(),r=null)}}},Ta=()=>{const o=u([]),i=u([]),r=u(["Routine","Targeted","Confirmatory","Stat","Repeat / Missing","Follow up after Low Level Viremia","Follow up after High Viral Load"]),f=u(null),b=u(null),m=u(null),p=u(""),_=u([]),w=u(null),T=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),E=async()=>{try{const d=await ba("testTypes");if(Array.isArray(d)&&d.length>0)o.value=d.map(l=>({id:l.concept_id.toString(),name:l.name,assigned_id:l.concept_id.toString()}));else if(d&&"records"in d&&d.records.length>0)o.value=d.records.map(l=>({id:l.concept_id.toString(),name:l.name,assigned_id:l.concept_id.toString()}));else{const l=await Me.getTestTypes();l&&l.length>0&&(o.value=l.map(c=>({id:c.concept_id.toString(),name:c.name,assigned_id:c.concept_id.toString()})))}}catch(d){console.error("Error loading test types:",d),W("Failed to load test types")}},I=async d=>{if(!d){i.value=[];return}try{const l=await Me.getSpecimens(d);l&&l.length>0?(i.value=l.map(c=>({id:c.concept_id.toString(),name:c.name,assigned_id:c.concept_id.toString()})),l.length===1&&(b.value=i.value[0])):(i.value=[],se("No specimens found for the selected test"))}catch(l){console.error("Error loading specimens:",l),W("Failed to load specimens")}};return{testOptions:o,specimenOptions:i,testReasons:r,selectedTest:f,selectedSpecimen:b,selectedReason:m,selectedAccessionNumber:p,labInvestigations:_,editingInvestigationId:w,loadTestTypes:E,loadSpecimens:I,handleTestChange:d=>{d&&d.name?I(d.name):(i.value=[],b.value=null)},handleBarcodeScanned:async d=>{if(!d||d.trim().length===0)return se("Barcode is required"),!1;try{return await Me.accessionNumExists(d)?(se("Barcode ".concat(d," was already used")),!1):(p.value=d,!0)}catch(l){return console.error("Error checking barcode:",l),W("Failed to confirm barcode ".concat(d,", Please try again later")),!1}},refreshTestTypes:async()=>{try{const d=await Me.getTestTypesViaDirectAPICall();d&&d.length>0?(o.value=d.map(l=>({id:l.concept_id.toString(),name:l.name,assigned_id:l.concept_id.toString()})),Ve("Test types refreshed successfully")):se("No test types found")}catch(d){console.error("Error refreshing test types:",d),W("Failed to refresh test types")}},saveLabInvestigation:async()=>{if(f.value&&b.value&&m.value){if(_.value.some(l=>{var c,k;return l.test.id===((c=f.value)==null?void 0:c.id)&&l.specimen.id===((k=b.value)==null?void 0:k.id)&&l.id!==w.value})){se("This test and specimen combination has already been added");return}if(w.value){const l=_.value.findIndex(c=>c.id===w.value);l!==-1&&(_.value[l]={..._.value[l],test:f.value,specimen:b.value,reason:m.value,accessionNumber:p.value,isEditing:!1},w.value=null)}else{const l={id:T(),test:f.value,specimen:b.value,reason:m.value,accessionNumber:p.value,dateAdded:new Date().toISOString(),isEditing:!1};_.value.push(l)}f.value=null,b.value=null,m.value=null,p.value=""}else se("Please select test, specimen, and reason for testing")},editLabInvestigation:d=>{const l=_.value.find(c=>c.id===d);l&&(f.value=l.test,b.value=l.specimen,m.value=l.reason,p.value=String(l.accessionNumber),w.value=l.id)},cancelLabInvestigation:d=>{const l=_.value.findIndex(c=>c.id===d);l!==-1&&_.value.splice(l,1),w.value===d&&(f.value=null,b.value=null,w.value=null)}}},Ne=[{category:"contraindication",concept_id:821,name:"Peripheral neuropathy"},{category:"contraindication",concept_id:215,name:"Jaundice"},{category:"contraindication",concept_id:2148,name:"Lipodystrophy"},{category:"contraindication",concept_id:9242,name:"Kidney Failure"},{category:"contraindication",concept_id:219,name:"Psychosis"},{category:"contraindication",concept_id:9440,name:"Gynaecomastia"},{category:"contraindication",concept_id:3,name:"Anemia"},{category:"contraindication",concept_id:512,name:"Skin rash"},{category:"contraindication",concept_id:867,name:"Insomnia"},{category:"side_effect",concept_id:6029,name:"Night sweats"},{category:"side_effect",concept_id:5945,name:"Fever"},{category:"side_effect",concept_id:5980,name:"Vomiting"},{category:"side_effect",concept_id:877,name:"Dizziness"},{category:"side_effect",concept_id:620,name:"Headache"},{category:"side_effect",concept_id:5978,name:"Nausea"},{category:"side_effect",concept_id:1458,name:"Lactic acidosis"},{category:"side_effect",concept_id:107,name:"Cough"},{category:"side_effect",concept_id:1773,name:"Heavy alcohol use"},{category:"side_effect",concept_id:8260,name:"Weight loss / Failure to thrive / malnutrition"}],Ma=(o="all")=>{const i=u([]),r=u({}),f=u(!1),b=u(null),m=u(null),p=J(()=>o==="all"?Ne:Ne.filter(g=>g.category===o)),_=()=>{const g=p.value.map(M=>({id:"".concat(M.concept_id),label:M.name,value:!1,concept_id:M.concept_id}));i.value=g,g.forEach(M=>{r.value[M.id]={selected:M.value}})},w=()=>{i.value.forEach(g=>{r.value[g.id]={selected:!1}})},T=()=>Object.values(r.value).some(g=>g.selected===!0),E=()=>i.value.filter(g=>{var M;return(M=r.value[g.id])==null?void 0:M.selected}).map(g=>g.label),I=g=>{const M={...r.value};o=g,_(),i.value.forEach(N=>{M[N.id]!==void 0&&(r.value[N.id]=M[N.id])})},S=g=>g.map(M=>({label:M.label,value:M.id,isChecked:M.value}));ue(()=>{_()});const C=async(g,M,N)=>{f.value=!0,m.value=null;try{const d=new ee(g,53,M,N),l=await d.createEncounter();if(!l)throw new Error("Failed to create encounter");b.value=l.encounter_id;const c={side_effect:"Malawi ART side effects",contraindication:"Other side effect",all:"Malawi ART Side Effects"},k=Ne.filter(P=>P.category==="side_effect").map(P=>({id:"".concat(P.concept_id),label:P.name,value:!1,concept_id:P.concept_id})),O=Ne.filter(P=>P.category==="contraindication").map(P=>({id:"".concat(P.concept_id),label:P.name,value:!1,concept_id:P.concept_id}));k.forEach(P=>{r.value[P.id]&&(P.value=r.value[P.id].selected)}),O.forEach(P=>{r.value[P.id]&&(P.value=r.value[P.id].selected)});const B=await d.buildOptionsGroupObs(c.side_effect,S(k)),F=await d.buildOptionsGroupObs(c.contraindication,S(O)),z=k.filter(P=>P.value&&P.reason).flatMap(P=>P.reason||[]),ae=O.filter(P=>P.value&&P.reason).flatMap(P=>P.reason||[]);return{encounter_id:l.encounter_id,observations:[...B,...F,...z,...ae]}}catch(d){return console.error("Error building side effects payload:",d),m.value="Failed to build side effects payload",null}finally{f.value=!1}};return{sideEffectOptions:i,sideEffects:r,resetSideEffects:w,hasSelectedSideEffects:T,getSelectedSideEffects:E,filterByCategory:I,isLoading:f,error:m,buildSideEffectsPayload:C,saveSideEffectsData:async(g,M,N)=>{f.value=!0,m.value=null;try{const d=await C(g,M,N);if(b.value=Number(d==null?void 0:d.encounter_id),!d)throw new Error("Failed to build payload");return await ee.saveObsArray(d.encounter_id,d.observations),Ve("Side effects saved successfully"),!0}catch(d){return console.error("Error saving side effects:",d),m.value="Failed to save side effects",W("Failed to save side effects"),!1}finally{f.value=!1}},encounterId:b}},Na=()=>{const o=u([{id:"Weight loss / Failure to thrive / malnutrition",label:"Weight loss / failure to thrive / malnutrition",value:!1},{id:"Fever",label:"Fever",value:!1},{id:"Night sweats",label:"Night sweats",value:!1},{id:"Cough",label:"Cough",value:!1}]),i=u({});return o.value.forEach(m=>{i.value[m.id]=m.value}),{tbSymptomOptions:o,tbSymptoms:i,resetTBSymptoms:()=>{o.value.forEach(m=>{i.value[m.id]=!1})},hasSelectedTBSymptoms:()=>Object.values(i.value).some(m=>m===!0),getSelectedTBSymptoms:()=>o.value.filter(m=>i.value[m.id]).map(m=>m.label)}},Oa=()=>{const o=u([]),i=u(!1),r=u(null),f=async()=>{var b,m;i.value=!0,r.value=null;try{const p=je(),w=(b=Ye().patient)==null?void 0:b.patient_id,T=parseInt(p.getUserId()||"-1"),E=((m=p.getfacilityLocation())==null?void 0:m.code)||"";if(!E)throw new Error("Location ID not found");const S=await new Ie(w,T,E).getCurrentMedications();if(S&&typeof S=="object"){const C=Object.values(S).map(D=>{const g=D;return{drug_id:g.drug_inventory_id,drug_name:g.dosage_struct.drug_name,dose:g.dose.source,units:g.units,frequency:g.frequency,start_date:g.order.start_date,end_date:g.order.auto_expire_date,quantity:g.quantity}});o.value=C}else o.value=[]}catch(p){console.error("Error loading current medications:",p),r.value=p instanceof Error?p.message:"Failed to load medications",W("Failed to load current medications")}finally{i.value=!1}};return ue(()=>{f(),o.value.length===0&&(o.value=[{drug_id:1,drug_name:"Tenofovir 300mg",dose:"1 tablet",units:"tablet",frequency:"Once daily",start_date:"2023-01-01"},{drug_id:2,drug_name:"Lamivudine 150mg",dose:"1 tablet",units:"tablet",frequency:"Twice daily",start_date:"2023-01-01"},{drug_id:3,drug_name:"Efavirenz 600mg",dose:"1 tablet",units:"tablet",frequency:"Once daily",start_date:"2023-01-01"}])}),{medications:o,isLoading:i,error:r,loadCurrentMedications:f}},Pa=me({__name:"SideEffectModal",props:{isOpen:{type:Boolean},sideEffect:{},currentReason:{}},emits:["update","close"],setup(o,{emit:i}){const r=o,f=i,{medications:b,isLoading:m}=Oa(),p=u("no"),_=u([]),w=u(void 0);ue(()=>{T()});const T=()=>{_.value=[],w.value=void 0,r.currentReason?typeof r.currentReason=="number"||r.currentReason==="drug_side_effect"||Array.isArray(r.currentReason)?(p.value="yes",Array.isArray(r.currentReason)&&r.currentReason.length>0?_.value=[...r.currentReason]:r.currentReason!=="drug_side_effect"&&(_.value=[r.currentReason])):(p.value="no",w.value=r.currentReason):(p.value="no",w.value="other_not_drug_related")},E=d=>{p.value=d.detail.value,p.value==="yes"?(_.value=[],w.value=void 0):(_.value=[],w.value="other_not_drug_related")},I=(d,l)=>{const c=l.detail.checked;c&&!_.value.includes(d)?_.value.push(d):c||(_.value=_.value.filter(k=>k!==d))},S=d=>{w.value=d},C=async(d,l)=>({concept_id:Ca.getCachedConceptID("Drug induced",!0),value_coded:d.concept_id,value_text:p.value=="no"?"Past medication history":null,value_drug:p.value=="yes"?l:null}),D=J(()=>{let d=[];return _.value.length>0&&_.value.map(l=>{r.sideEffect&&d.push(C(r.sideEffect,Number(l)))}),d}),g=()=>{p.value="no",_.value=[],w.value="other_not_drug_related"},M=()=>{g(),f("close")},N=()=>{r.sideEffect&&(f("update",{id:r.sideEffect.id,reason:D.value}),M())};return(d,l)=>(y(),Q(e(ot),{"is-open":d.isOpen,onDidDismiss:M},{default:n(()=>[t(e(Qt),null,{default:n(()=>[t(e(tt),null,{default:n(()=>[l[4]||(l[4]=s("div",{slot:"start",class:"ion-padding"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[s("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5"},[s("path",{d:"M6.01 16.607a3.495 3.495 0 1 0 0-6.99a3.495 3.495 0 0 0 0 6.99m5.242 6.616a5.243 5.243 0 0 0-10.485 0m20.968-7.821V3.751a2.996 2.996 0 1 0-5.991 0v11.651a4.493 4.493 0 1 0 5.991 0M18.74 5.249v11.983"}),s("path",{d:"M18.74 20.227a1.498 1.498 0 1 0 0-2.995a1.498 1.498 0 0 0 0 2.995M2.014 7.745a2.47 2.47 0 0 1 0-3.495a2.47 2.47 0 0 0 0-3.495m3.721 6.99a2.47 2.47 0 0 1 0-3.495a2.47 2.47 0 0 0 0-3.495m3.995 6.99a2.47 2.47 0 0 1 0-3.495a2.473 2.473 0 0 0 0-3.495"})])])],-1)),t(e(ea),null,{default:n(()=>{var c;return[v($(((c=d.sideEffect)==null?void 0:c.label)||"Side Effect Details"),1)]}),_:1}),t(e(at),{slot:"end"},{default:n(()=>[t(e(Y),{onClick:l[0]||(l[0]=c=>f("close"))},{default:n(()=>[t(e(j),{icon:e(He)},null,8,["icon"])]),_:1})]),_:1})]),_:1,__:[4]})]),_:1}),t(e(ze),{class:"ion-padding"},{default:n(()=>[t(e(ta),null,{default:n(()=>[t(e(G),null,{default:n(()=>[t(e(L),null,{default:n(()=>l[5]||(l[5]=[v("Is this drug-induced?")])),_:1,__:[5]})]),_:1}),t(e(de),{modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=c=>p.value=c),onIonChange:E},{default:n(()=>[t(e(G),null,{default:n(()=>[t(e(q),{value:"yes"},{default:n(()=>l[6]||(l[6]=[v("Yes")])),_:1,__:[6]})]),_:1}),t(e(G),null,{default:n(()=>[t(e(q),{value:"no"},{default:n(()=>l[7]||(l[7]=[v("No")])),_:1,__:[7]})]),_:1})]),_:1},8,["modelValue"]),p.value==="yes"?(y(),V(te,{key:0},[t(e(G),null,{default:n(()=>[t(e(L),null,{default:n(()=>l[8]||(l[8]=[v("Select medications:")])),_:1,__:[8]})]),_:1}),e(m)?(y(),Q(e(De),{key:0,name:"crescent"})):e(b).length===0?(y(),Q(e(G),{key:1},{default:n(()=>[t(e(L),null,{default:n(()=>l[9]||(l[9]=[v("No medications found")])),_:1,__:[9]})]),_:1})):(y(!0),V(te,{key:2},ce(e(b),c=>(y(),Q(e(G),{key:c.drug_id},{default:n(()=>[t(e(be),{value:c.drug_id,checked:_.value.includes(c.drug_id),onIonChange:k=>I(c.drug_id,k)},null,8,["value","checked","onIonChange"]),t(e(L),{class:"ion-padding-start"},{default:n(()=>[v($(c.drug_name),1)]),_:2},1024)]),_:2},1024))),128)),t(e(G),null,{default:n(()=>[t(e(be),{value:"drug_side_effect",checked:_.value.includes("drug_side_effect"),onIonChange:l[2]||(l[2]=c=>I("drug_side_effect",c))},null,8,["checked"]),t(e(L),{class:"ion-padding-start"},{default:n(()=>l[10]||(l[10]=[v("Drug side effect (unspecified)")])),_:1,__:[10]})]),_:1})],64)):x("",!0),p.value==="no"?(y(),V(te,{key:1},[t(e(G),null,{default:n(()=>[t(e(L),null,{default:n(()=>l[11]||(l[11]=[v("Reason:")])),_:1,__:[11]})]),_:1}),t(e(G),null,{default:n(()=>[t(e(q),{value:"other_not_drug_related",checked:w.value==="other_not_drug_related",onIonChange:l[3]||(l[3]=c=>S("other_not_drug_related"))},null,8,["checked"]),t(e(L),{class:"ion-padding-start"},{default:n(()=>l[12]||(l[12]=[v("Other not drug related")])),_:1,__:[12]})]),_:1})],64)):x("",!0)]),_:1})]),_:1}),t(e(aa),null,{default:n(()=>[t(e(tt),{color:"light"},{default:n(()=>[t(e(at),{slot:"end"},{default:n(()=>[t(e(Y),{onClick:N,color:"primary"},{default:n(()=>l[13]||(l[13]=[v("Save")])),_:1,__:[13]})]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"]))}}),Ba={class:"side-effects-grid"},xa={class:"checkbox-container"},La={class:"checkbox-label"},Fa={key:0,class:"reason-summary"},Ra={class:"reason-label"},Aa={key:0,class:"drug-induced"},$a={key:1,class:"not-drug-induced"},Ha=me({__name:"SideEffectsCheckboxes",props:{modelValue:{},sideEffectOptions:{}},emits:["update:modelValue"],setup(o,{emit:i}){const r=o,f=i,b=u(!1),m=u(null),p=u(void 0),_=(S,C)=>{var M;const D=C.detail.checked,g={...r.modelValue};D?(g[S.id]={selected:!0,reason:"other_not_drug_related"},f("update:modelValue",g),T(S)):(g[S.id]={selected:!1,reason:(M=g[S.id])==null?void 0:M.reason},f("update:modelValue",g))},w=S=>{var D;const C=(D=r.modelValue[S])==null?void 0:D.reason;return typeof C=="number"||C==="drug_side_effect"||Array.isArray(C)&&C.length>0?"yes":"no"},T=S=>{var C;m.value=S,p.value=(C=r.modelValue[S.id])==null?void 0:C.reason,b.value=!0},E=()=>{b.value=!1,m.value=null},I=S=>{const C={...r.modelValue};C[S.id]&&(C[S.id]={...C[S.id],reason:S.reason},f("update:modelValue",C))};return(S,C)=>(y(),V(te,null,[s("div",Ba,[(y(!0),V(te,null,ce(S.sideEffectOptions,D=>{var g,M;return y(),V("div",{key:D.id,class:"side-effect-item"},[s("div",xa,[t(e(be),{value:D.id,checked:(g=S.modelValue[D.id])==null?void 0:g.selected,onIonChange:N=>_(D,N)},null,8,["value","checked","onIonChange"]),s("span",La,$(D.label),1)]),(M=S.modelValue[D.id])!=null&&M.selected?(y(),V("div",Fa,[s("div",Ra,[w(D.id)==="yes"?(y(),V("span",Aa,"Drug-induced")):(y(),V("span",$a,"Not drug-induced"))]),t(e(Y),{fill:"clear",size:"small",class:"edit-button",onClick:N=>T(D)},{default:n(()=>[C[0]||(C[0]=v(" Edit ")),t(e(j),{slot:"end",icon:e(it)},null,8,["icon"])]),_:2,__:[0]},1032,["onClick"])])):x("",!0)])}),128))]),t(Pa,{"is-open":b.value,"side-effect":m.value,"current-reason":p.value,onUpdate:I,onClose:E},null,8,["is-open","side-effect","current-reason"])],64))}}),za=Ce(Ha,[["__scopeId","data-v-9c8f6d00"]]),Ua={class:"tb-symptoms-grid"},qa={class:"checkbox-label"},Wa=me({__name:"TBSymptomsCheckboxes",props:{modelValue:{},tbSymptomOptions:{}},emits:["update:modelValue"],setup(o,{emit:i}){const r=o,f=i,b=()=>{f("update:modelValue",r.modelValue)};return(m,p)=>(y(),V("div",Ua,[(y(!0),V(te,null,ce(m.tbSymptomOptions,_=>(y(),V("div",{key:_.id,class:"checkbox-option"},[t(e(be),{modelValue:m.modelValue[_.id],"onUpdate:modelValue":[w=>m.modelValue[_.id]=w,b],value:_.label},null,8,["modelValue","onUpdate:modelValue","value"]),s("span",qa,$(_.label),1)]))),128))]))}}),ja=Ce(Wa,[["__scopeId","data-v-d67e9ce3"]]),qe=(o,i)=>{const r=new Date;return{Months:()=>r.setMonth(r.getMonth()-o),Weeks:()=>r.setDate(r.getDate()-o*7),Days:()=>r.setDate(r.getDate()-o)}[i](),{day:r.getDate().toString().padStart(2,"0"),month:(r.getMonth()+1).toString().padStart(2,"0"),year:r.getFullYear().toString()}},Ya=()=>{const o=u("Unknown"),i=u(),r=u("3"),f=u(!1),b=u(!1),m=u(["Months","Weeks","Days"]),p=u("0"),_=u({name:"Months"}),w=u([{label:"Yes",value:"Yes"},{label:"No",value:"No"},{label:"Unknown",value:"Unknown"}]),T=u(["TB NOT suspected","TB Suspected","Confirmed TB Not on treatment"]),E=J(()=>{let c=[];return/no/i.test(o.value.toLowerCase())&&(c=["Currently on IPT","Currently on 3HP (RFP + INH)","Currently on INH 300 / RFP 300 (3HP)"]),c=c.concat(["Complete course of 3HP in the past (3 months RFP+INH)","Complete course of IPT in the past (min. 6 months of INH)","Aborted course of 3HP (RFP + INH) in the past","Aborted course of INH 300 / RFP 300 (3HP) in the past","Aborted course of IPT in the past","Never taken IPT or 3HP"]),c});rt([p,_],([c,k])=>{if(c||k){const O=qe(Number(c),_.value.name);i.value=O}});const I=async c=>{var F,z,ae;const k="".concat((F=i.value)==null?void 0:F.year,"-").concat((z=i.value)==null?void 0:z.month,"-").concat((ae=i.value)==null?void 0:ae.day),O=b.value?await c.buildValueDateEstimated("TB treatment start date",Pe.toStandardHisFormat(k)):await c.buildValueDate("TB treatment start date",Pe.toStandardHisFormat(k)),B=await c.buildValueNumber("TB treatment period",Number(r.value));return[O,B]},S=c=>{const k="Chest X-ray",O="Molecular WHO Recommended Rapid Diagnostic Test";return c[O].toLowerCase()==="normal"?!1:c[k].toLowerCase()==="abnormal"||c[O].toLowerCase()==="positive"},C=c=>Object.values(c).some(k=>k),D=(c,k)=>Object.values(c).every(O=>O.toLowerCase()==="unknown")?C(k):S(c),g=async(c,k)=>{const O=Object.entries(c).map(async([B,F])=>({...await k.buildValueCoded("Routine TB Screening",B),child:[await k.buildValueCoded(B,F?"Yes":"No")]}));return Promise.all(O)},M=async(c,k)=>{const O=Object.entries(c).map(async([B,F])=>({...await k.buildValueCoded("TB screening method used",B),child:[await k.buildValueCoded(B,F)]}));return Promise.all(O)},N=async(c,k,O,B)=>{let F="TB NOT suspected";return o.value==="Yes"?F="Confirmed TB on treatment":c&&c.trim()!==""?F=c:k&&Object.keys(k).length>0?S(k)&&(F="TB Suspected"):O&&Object.keys(O).length>0&&C(O)&&(F="TB Suspected"),B.buildValueCoded("TB Status",F)},d=(c,k)=>k.buildValueText("TB Treatment History",c);return{tbTherapyStatus:o,tbTreatmentStartDate:i,tbTreatmentPeriod:r,onTBTreatmentOptions:w,tbStatusOptions:T,tbEstimatePeriods:m,selectedEstimatePeriod:_,showEstimator:b,tbStartEstimate:p,startDateEstimator:qe,showTBStatus:D,tptHistoryOptions:E,buildTBTreatmentPayload:async(c,k=53,O,B,F)=>{const z=new ee(c,k,O,B),ae=await z.buildValueCoded("TB treatment",o.value);let P=null;F.history&&typeof F.history=="string"&&F.history.trim()!==""&&(P=await d(F.history,z));const ge=await N(F.status,F.methods,F.symptoms,z),le=[ae,ge];if(P&&le.push(P),o.value==="Yes"){const R=await I(z);le.push(...R)}else{const R=await Promise.all(await M(F.methods,z)),U=await Promise.all(await g(F.symptoms,z));le.push(...R,...U)}return le.filter(R=>R&&Object.keys(R).length>0)},submitTBTherapy:f}},Ga=(o,i,r)=>{const f=J(()=>({"weight-chart":o.value,"side-effects":i.value,"tb-therapy":r.value}));return{validate:async()=>{for(const m in f.value){const p=m;if(!f.value[p])return se("Please fill out ".concat(m.replaceAll("-"," ")," section")),!1}return!0},stepsMap:f}},Xa=()=>{const o=dt({isPregnant:null,isBreastFeeding:null}),i=u(!1),r=u(!1),f=u([]),b=()=>(f.value=[],o.isPregnant===null&&f.value.push("Pregnancy status is required."),o.isBreastFeeding===null&&f.value.push("Breastfeeding status is required."),f.value.length===0),m=async(_,w,T)=>{const E=new ee(_,53,w,T),I=[];if(o.isPregnant!==null){const S=await E.buildValueCoded("Is patient pregnant?",o.isPregnant==="yes"?"Yes":"No");I.push(S)}if(o.isBreastFeeding!==null){const S=await E.buildValueCoded("Is patient breast feeding?",o.isBreastFeeding==="yes"?"Yes":"No");I.push(S)}return I};return{pregnancyBreastFeedingData:o,isPregnancyBreastfeedingLoading:i,validationErrors:f,isPregnancyBreastfeedingSaved:r,validatePregnancyBreastFeeding:b,savePregnancyBreastFeeding:async(_,w,T)=>{if(!b())return console.error("Validation failed:",f.value),!1;i.value=!0;try{const E=await m(_,w,T);return E.length>0?(await new ee(_,53,w,T).saveObservationList(E),r.value=!0,Ve("Pregnancy or Breast Feeding data saved successfully"),!0):(console.warn("No observations to save"),!1)}catch(E){return console.error("Error saving data:",E),!1}},buildPregnancyBreastFeedingObs:m}},mt=()=>{const o=dt({selectedMethods:[],availableMethods:[]}),i=u(!1),r=u(!1),f=u([]),b=()=>{const S=new Ie(0,0).getFamilyPlanningMethods();o.availableMethods=S.map(C=>({label:C,value:C,isChecked:!1,disabled:!1}))},m=()=>(f.value=[],o.selectedMethods.length===0&&f.value.push("At least one contraceptive method must be selected."),f.value.length===0),p=I=>{const S=new Ie(0,0);if(I==="NONE")o.selectedMethods=["NONE"],o.availableMethods=o.availableMethods.map(C=>({...C,isChecked:C.value==="NONE",disabled:!1}));else{o.selectedMethods.includes("NONE")&&(o.selectedMethods=[]);const C=o.selectedMethods.indexOf(I);if(C>-1?o.selectedMethods.splice(C,1):o.selectedMethods.push(I),o.selectedMethods.length>0){const D=o.selectedMethods[0],g=S.familyPlanningMethods(D,o.availableMethods);o.availableMethods=g}else o.availableMethods=o.availableMethods.map(D=>({...D,disabled:!1}));o.availableMethods=o.availableMethods.map(D=>({...D,isChecked:o.selectedMethods.includes(D.value)}))}},_=async(I,S,C)=>{const D=new ee(I,53,S,C),g=[];for(const M of o.selectedMethods){const N=await D.buildValueCoded("Method of family planning",M);g.push(N)}return g},w=async(I,S,C)=>{if(!m())return console.error("Validation failed:",f.value),W("Please select at least one contraceptive method"),!1;i.value=!0;try{const D=await _(I,S,C);return D.length>0?(await new ee(I,53,S,C).saveObservationList(D),console.info("Contraceptive methods saved:",D),r.value=!0,!0):(console.warn("No contraceptive observations to save"),W("No contraceptive methods to save"),!1)}catch(D){return console.error("Error saving contraceptive data:",D),W("Failed to save contraceptive methods"),!1}finally{i.value=!1}},T=J(()=>o.selectedMethods.length>0),E=J(()=>o.selectedMethods.length===0?"None selected":o.selectedMethods.includes("NONE")?"None":o.selectedMethods.join(", "));return b(),{contraceptiveData:o,isContraceptivesLoading:i,isContraceptivesSaved:r,validationErrors:f,hasSelectedMethods:T,selectedMethodsText:E,validateContraceptives:m,toggleMethod:p,saveContraceptives:w,initializeContraceptiveMethods:b,buildContraceptiveObs:_}},Za={class:"contraceptives-section"},Ja={key:0,class:"selected-methods"},Ka={key:1,class:"selected-methods"},Qa={class:"method-tag none-tag"},en={class:"methods-list"},tn={key:2,class:"validation-errors"},an={class:"action-buttons"},nn=me({__name:"ContraceptivesSection",props:{patientID:{default:0},providerID:{default:-1},locationID:{default:""}},emits:["onSuccess"],setup(o,{expose:i,emit:r}){const f=o,b=r,m=je(),p=Ye(),{patient:_}=ut(p),w=J(()=>{var k;return f.patientID||((k=_.value)==null?void 0:k.patientID)||0}),T=J(()=>{var k;return f.providerID!==-1?f.providerID:(k=vt.getUserID())!=null?k:-1}),E=J(()=>{var k;return f.locationID||((k=m.getfacilityLocation())==null?void 0:k.code)||""}),{contraceptiveData:I,isContraceptivesLoading:S,isContraceptivesSaved:C,validationErrors:D,hasSelectedMethods:g,validateContraceptives:M,toggleMethod:N,saveContraceptives:d}=mt(),l=()=>{I.selectedMethods=[],I.availableMethods=I.availableMethods.map(k=>({...k,isChecked:!1,disabled:!1}))},c=async()=>{await d(w.value,T.value,E.value)&&b("onSuccess",!0)};return i({saveContraceptives:c,validateContraceptives:M,isContraceptivesSaved:C}),(k,O)=>(y(),V("div",Za,[e(g)&&!e(I).selectedMethods.includes("NONE")?(y(),V("div",Ja,[(y(!0),V(te,null,ce(e(I).selectedMethods,B=>(y(),V("div",{class:"method-tag",key:B},[v($(B)+" ",1),t(e(j),{icon:e(He),onClick:F=>e(N)(B),class:"remove-icon"},null,8,["icon","onClick"])]))),128))])):x("",!0),e(I).selectedMethods.includes("NONE")?(y(),V("div",Ka,[s("div",Qa,[O[1]||(O[1]=v(" NONE ")),t(e(j),{icon:e(He),onClick:O[0]||(O[0]=B=>e(N)("NONE")),class:"remove-icon"},null,8,["icon"])])])):x("",!0),s("div",en,[(y(!0),V(te,null,ce(e(I).availableMethods,B=>(y(),V("div",{key:B.value,class:ct(["method-item",{disabled:B.disabled}])},[t(e(be),{checked:B.isChecked,disabled:B.disabled,onIonChange:F=>e(N)(B.value),labelPlacement:"end"},{default:n(()=>[v($(B.label),1)]),_:2},1032,["checked","disabled","onIonChange"])],2))),128))]),e(D).length>0?(y(),V("div",tn,[(y(!0),V(te,null,ce(e(D),B=>(y(),V("div",{key:B,class:"error-message"},$(B),1))),128))])):x("",!0),s("div",an,[t(e(Y),{color:"medium",fill:"outline",onClick:l,disabled:e(I).selectedMethods.length==0},{default:n(()=>O[2]||(O[2]=[v(" Clear ")])),_:1,__:[2]},8,["disabled"]),t(e(Y),{color:"primary",onClick:c,disabled:e(S)||!e(g),loading:!0},{default:n(()=>O[3]||(O[3]=[v(" Save ")])),_:1,__:[3]},8,["disabled"])])]))}}),sn=Ce(nn,[["__scopeId","data-v-9a45c4b4"]]),ln={key:0,class:"info-container"},on={class:"info-card"},rn={class:"main-message"},dn={class:"message-content"},un={class:"info-list"},cn=me({__name:"vl-info-alert",props:{patientID:{}},setup(o){const i=o,r=u(!0),f=u(null),b=async()=>{await wa("Are you sure you want to close this milestone notification?")&&(r.value=!1)},m=async()=>{try{const _=await Sa.getPatientVLInfo(i.patientID);f.value=_}catch(_){console.error("Error fetching VL data:",_)}},p=_=>{const w=new Date(_);return isNaN(w.getTime())?"N/A":w.toLocaleDateString()};return ue(()=>{m()}),(_,w)=>{var T;return r.value&&((T=f.value)!=null&&T.milestone)?(y(),V("div",ln,[s("div",on,[s("button",{class:"close-button",onClick:b,"aria-label":"Close notification"},w[0]||(w[0]=[s("svg",{class:"close-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])),s("div",rn,[w[2]||(w[2]=s("svg",{class:"info-icon",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},[s("path",{fill:"currentColor",d:"M24.586 6.586A2 2 0 0 0 23.17 6H16V2h-2v4H6a2.003 2.003 0 0 0-2 2v6a2.003 2.003 0 0 0 2 2h8v14h2V16h7.171a2 2 0 0 0 1.415-.586L29 11ZM23.17 14H6V8h17.172l3 3Z"})],-1)),s("div",dn,[w[1]||(w[1]=s("h2",null,"VL milestone has been reached",-1)),s("ul",un,[s("li",null,"Patient has been on ART for "+$(f.value.period_on_art)+" months",1),s("li",null,"Treatment started on "+$(p(f.value.earliest_start_date)),1),s("li",null,"Current regimen: "+$(f.value.current_regimen.code)+" since "+$(p(f.value.current_regimen.start_date)),1),s("li",null,"Last VL order date: "+$(p(f.value.last_order_date)),1)])])])])])):x("",!0)}}}),vn=Ce(cn,[["__scopeId","data-v-0b657069"]]),fn=me({name:"CervicalCancerSection",components:{IonRow:re,IonCol:H,IonLabel:L,IonRadioGroup:de,IonRadio:q,IonButton:Y,IonSpinner:De,IonSelect:ia,IonSelectOption:oa,IonText:la,IonDatetimeButton:sa,IonDatetime:na,IonModal:ot,IonCheckbox:be,DatePicker:pt,BasicInputChangeUnits:ft},props:{providerID:{type:Number,required:!0},locationID:{type:String,required:!0}},setup(o,{emit:i}){const r=u(!0),f=u(!1),b=u(""),m=u(""),p=u(""),_=u(!1),w=u(!0),T=u(!1),E=u(0),I=u(0),S=u(!1),C=u(!1),D=u(""),g=u(""),M=u(!1),N=new We,d=new Ie(N.patient.patient_id,o.providerID,o.locationID),l=u({name:"Months"}),c=u(["Months","Weeks","Days"]),k=u(""),O=J(()=>Oe().format("YYYY-MM-DD")),B=J(()=>"1900-01-01"),F=u([{label:"Not due for screening",value:"Not due for screening"},{label:"Hysterectomy",value:"Hysterectomy"},{label:"Patient refused",value:"Patient refused"},{label:"Other",value:"Other"}]),z=J(()=>!(b.value===""||b.value==="No"&&m.value===""||m.value==="Not due for screening"&&p.value==="")),ae=R=>Pe.toStandardHisDisplayFormat(R),P=async()=>{try{if(r.value=!0,N.patient.gender==="F"&&(T.value=await Ue.cervicalCancerScreeningEnabled(),T.value)){const{start:R,end:U}=await Ue.cervicalCancerScreeningAgeBounds();E.value=U,I.value=R,S.value=await d.clientDueForCxCa(),C.value=await d.clientHasHadAHysterectomy(),D.value=await N.patient.nextAppointment(24);const ne=30;M.value=ne>Pe.dateDiffInDays(D.value,d.date)}}catch(R){console.error("Error initializing cervical cancer data:",R)}finally{r.value=!1}},ge=async()=>{try{if(!z.value)return;const R=[];R.push(d.buildValueCoded("Offer CxCa",b.value)),b.value==="No"&&(R.push(d.buildValueCoded("Reason for NOT offering CxCa",m.value)),m.value==="Not due for screening"&&p.value&&(_.value?R.push(d.buildValueDateEstimated("CxCa test date",p.value)):R.push(d.buildValueDate("CxCa test date",p.value)))),f.value=!0,i("onSuccess",{obs:R,isCxCaSaved:f.value})}catch(R){console.error("Error saving cervical cancer data:",R)}};ue(()=>{P()});function le(R,U,ne){return new Date(ne,U-1,R).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})}return rt([g,l],([R,U])=>{if(R||U){const ne=qe(Number(R),l.value.name);k.value=ne,p.value=le(Number(ne.day),Number(ne.month),Number(ne.year)),_.value=!0}}),{loading:r,isCxCaSaved:f,offerCxca:b,reasonForNoCxca:m,previousCxcaTestDate:p,isEstimated:_,showEstimateFields:w,reasonsForNoCxcaOptions:F,isFormValid:z,cxcaAppointDate:D,showReminder:M,maxDate:O,minDate:B,alertCircleOutline:ra,selectedEstimatePeriod:l,estimatePeriods:c,estimatedValue:g,dateProp:k,formatDate:ae,saveCxcaData:ge}}}),pn={class:"cervical-cancer-container"},mn={key:0,class:"loading-container"},gn={key:1},hn={key:0,class:"reminder-banner"},_n={class:"radio-group"},yn={key:1},bn={key:0},Cn={class:"save-button-container"};function wn(o,i,r,f,b,m){const p=K("ion-spinner"),_=K("ion-icon"),w=K("ion-text"),T=K("ion-label"),E=K("ion-col"),I=K("ion-radio"),S=K("ion-radio-group"),C=K("ion-row"),D=K("ion-select-option"),g=K("ion-select"),M=K("DatePicker"),N=K("BasicInputChangeUnits"),d=K("ion-button");return y(),V("div",pn,[o.loading?(y(),V("div",mn,[t(p,{name:"bubbles"}),i[6]||(i[6]=s("p",null,"Loading cervical cancer screening data...",-1))])):(y(),V("div",gn,[o.showReminder?(y(),V("div",hn,[t(w,{color:"warning"},{default:n(()=>[s("p",null,[t(_,{icon:o.alertCircleOutline},null,8,["icon"]),v(" Patient is due for Cervical Cancer Screening on "+$(o.formatDate(o.cxcaAppointDate)),1)])]),_:1})])):x("",!0),t(C,null,{default:n(()=>[t(E,null,{default:n(()=>[t(T,null,{default:n(()=>i[7]||(i[7]=[v("Offer Cervical Cancer Screening")])),_:1,__:[7]})]),_:1}),t(E,null,{default:n(()=>[s("div",_n,[t(S,{modelValue:o.offerCxca,"onUpdate:modelValue":i[0]||(i[0]=l=>o.offerCxca=l)},{default:n(()=>[t(I,{slot:"end",value:"Yes"},{default:n(()=>i[8]||(i[8]=[v("Yes")])),_:1,__:[8]}),t(I,{slot:"end",style:{"margin-left":"20px"},value:"No"},{default:n(()=>i[9]||(i[9]=[v("No")])),_:1,__:[9]})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),o.offerCxca==="No"?(y(),V("div",yn,[t(C,null,{default:n(()=>[t(E,null,{default:n(()=>[t(T,null,{default:n(()=>i[10]||(i[10]=[v("Reason for NOT offering CxCa")])),_:1,__:[10]})]),_:1}),t(E,null,{default:n(()=>[t(g,{modelValue:o.reasonForNoCxca,"onUpdate:modelValue":i[1]||(i[1]=l=>o.reasonForNoCxca=l),interface:"popover",placeholder:"Select reason"},{default:n(()=>[(y(!0),V(te,null,ce(o.reasonsForNoCxcaOptions,l=>(y(),Q(D,{key:l.value,value:l.value},{default:n(()=>[v($(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o.reasonForNoCxca==="Not due for screening"?(y(),V("div",bn,[t(C,null,{default:n(()=>[t(E,null,{default:n(()=>[t(T,null,{default:n(()=>i[11]||(i[11]=[v("Previous CxCa test date")])),_:1,__:[11]})]),_:1}),t(E,null,{default:n(()=>[t(M,{place_holder:"enter data",onDateUpDated:[()=>{},i[2]||(i[2]=l=>{o.previousCxcaTestDate=l.formattedDate})],date_prop:o.dateProp},null,8,["date_prop"])]),_:1})]),_:1}),o.showEstimateFields?(y(),Q(C,{key:0},{default:n(()=>[t(E,null,{default:n(()=>[t(T,null,{default:n(()=>i[12]||(i[12]=[v("Estimated?")])),_:1,__:[12]})]),_:1}),t(E,null,{default:n(()=>[t(N,{bold:"bold","input-header":"Estimate number of ".concat(o.selectedEstimatePeriod.name),"input-value":o.estimatedValue,"onUpdate:inputValue":[i[3]||(i[3]=l=>o.estimatedValue=l),i[4]||(i[4]=l=>o.estimatedValue=l.target.value)],showAsterisk:"",placeholder:"",unitsData:{isSingleSelect:!0,multiSelectData:o.estimatePeriods.map(l=>({name:l})),value:o.selectedEstimatePeriod,trackBy:"name"},"onUpdate:units":i[5]||(i[5]=l=>o.selectedEstimatePeriod=l)},null,8,["input-header","input-value","unitsData"])]),_:1})]),_:1})):x("",!0)])):x("",!0)])):x("",!0),s("div",Cn,[t(d,{onClick:o.saveCxcaData,disabled:!o.isFormValid},{default:n(()=>i[13]||(i[13]=[v(" Save and Continue ")])),_:1,__:[13]},8,["onClick","disabled"])])]))])}const Sn=Ce(fn,[["render",wn],["__scopeId","data-v-bee1d69f"]]),kn={class:"accordion-title-container"},Dn={key:0,class:"completed-badge"},Vn={class:"ion-padding",slot:"content",style:{overflow:"visible !important"}},In={key:0,class:"lab-investigations-list"},En={class:"table-responsive"},Tn={class:"lab-table"},Mn={class:"action-buttons"},Nn={class:"save-button-container"},On={class:"accordion-title-container"},Pn={key:0,class:"completed-badge"},Bn={slot:"content",class:"ion-padding"},xn={class:"chart-container"},Ln={class:"chart-header"},Fn={key:0,class:"loading-container"},Rn={key:1,class:"empty-data-container"},An={key:2,class:"save-button-container"},$n={class:"accordion-title-container"},Hn={key:0,class:"completed-badge"},zn={slot:"content",class:"ion-padding"},Un={class:"radio-group"},qn={class:"radio-group"},Wn={key:0,class:"save-button-container"},jn={class:"accordion-title-container"},Yn={key:0,class:"completed-badge"},Gn={slot:"content",class:"ion-padding"},Xn={class:"accordion-title-container"},Zn={key:0,class:"completed-badge"},Jn={slot:"content",class:"ion-padding"},Kn={class:"accordion-title-container"},Qn={key:0,class:"completed-badge"},es={class:"ion-padding",slot:"content"},ts={class:"side-effects-container"},as={class:"radio-group"},ns={key:0,class:"side-effects-options"},ss={key:0,class:"loading-container"},ls={class:"category-tabs"},os={class:"save-button-container"},is={class:"accordion-title-container"},rs={key:0,class:"completed-badge"},ds={class:"ion-padding",slot:"content"},us={key:0,class:"loading-container"},cs={class:"tb-therapy-container"},vs={class:"tb-treatment-section"},fs={class:"radio-group horizontal-radio-group"},ps={class:"radio-option"},ms={class:"radio-option"},gs={key:0,class:"tb-treatment-section"},hs={key:0,class:"estimator-container"},_s={style:{"margin-top":"10px"}},ys={key:1,class:"tb-treatment-section"},bs={class:"tb-symptoms-section"},Cs={class:"screening-section"},ws={class:"radio-group horizontal-radio-group"},Ss={class:"radio-option"},ks={class:"radio-option"},Ds={class:"radio-option"},Vs={class:"radio-group horizontal-radio-group"},Is={class:"radio-option"},Es={class:"radio-option"},Ts={class:"radio-option"},Ms={key:0,class:"tb-status-section"},Ns={style:{"z-index":"99999"}},Os={key:2,class:"tb-history-section"},Ps={class:"save-button-container"},Bs=me({__name:"Consultation",setup(o,{expose:i}){var Qe,et;const r=je(),f=Ye(),{patient:b}=ut(f),m=u(null),p=u(["lab-investigation"]),_=u(null),w=u(!1),T=u([]),E=u([]),I=u(""),S=u("contraindication"),C=u(!1),D=u(!1),g=u(!1),M=u(!1),N=J(()=>{var X;return(X=b.value)==null?void 0:X.patientID}),d=(Qe=vt.getUserID())!=null?Qe:-1,l=((et=r.getfacilityLocation())==null?void 0:et.code)||"",c=u(!1),k=new We,O=u(!1),B=new Ie(k.getID(),-1,l),{sideEffectOptions:F,sideEffects:z,isLoading:ae,filterByCategory:P,hasSelectedSideEffects:ge,buildSideEffectsPayload:le,encounterId:R}=Ma("side_effect"),{tbTherapyStatus:U,tbTreatmentPeriod:ne,tbTreatmentStartDate:Ge,tbEstimatePeriods:gt,selectedEstimatePeriod:Be,showEstimator:Xe,tbStartEstimate:Ee,tbStatusOptions:ht,showTBStatus:_t,tptHistoryOptions:yt,buildTBTreatmentPayload:bt,submitTBTherapy:Ct}=Ya(),{tbSymptomOptions:wt,tbSymptoms:we}=Na(),xe=u(""),Le=u(""),Fe=u(""),Re=u(""),Ze=u(!1),{pregnancyBreastFeedingData:he,isPregnancyBreastfeedingLoading:St,validatePregnancyBreastFeeding:kt,buildPregnancyBreastFeedingObs:Dt}=Xa(),{buildContraceptiveObs:Vt}=mt(),It=X=>{const a=X.detail.value;S.value=a,P(a)},Et=async()=>{if(I.value==="yes"&&!ge()){W("Please select at least one side effect or contraindication");return}C.value=!0,m.value&&(p.value=[],p.value.push("tb-therapy"))},Tt=async()=>{var X;if(Te.value.length===0){W("Please add at least one lab investigation");return}try{if(!N.value){W("Patient ID not found");return}const a=new Da,h=(X=r.getfacilityLocation())==null?void 0:X.code;if(!h){W("Location ID not found");return}const A={location_id:h,orders:Te.value.map(Z=>({concept_id:Z.test.id,name:Z.test.name,specimen:Z.specimen.name,reason:Z.reason||"Routine",specimenConcept:Z.specimen.id,accessionNumber:Z.accessionNumber||null}))};await a.postActivities(N.value,A),g.value=!0,m.value&&(p.value=[],p.value.push("weight-chart")),Ve("Lab investigations saved successfully")}catch(a){console.error("Error saving lab investigations:",a),W("Failed to save lab investigations")}},Mt=()=>{M.value=!0,m.value&&(p.value=[],p.value.push(k.isFemale()?"pregnancy-breastfeeding":"contraindications"))},Nt=()=>{m.value&&(p.value=[],p.value.push("cxca"))},Ot=X=>{w.value=X.isCxCaSaved,T.value=X.obs,m.value&&(p.value=[],p.value.push("contraindications"))},Je=J(()=>({"Chest X-ray":xe.value,"Molecular WHO Recommended Rapid Diagnostic Test":Le.value})),Pt=async()=>{if(!kt()){W("Please fill in all required pregnancy/breastfeeding fields");return}E.value=await Dt(N.value,d,l),m.value&&(p.value=[],p.value.push("contraceptives"),Ze.value=!0)},Bt=async()=>{if(U.value==="Unknown"){se("Please select a TB Therapy Status");return}D.value=!0,m.value&&(p.value=[])},{testOptions:xt,specimenOptions:Lt,testReasons:Ft,selectedTest:_e,selectedSpecimen:ye,selectedReason:Ae,selectedAccessionNumber:$e,labInvestigations:Te,editingInvestigationId:Rt,loadTestTypes:At,handleTestChange:$t,refreshTestTypes:Ht,saveLabInvestigation:zt,editLabInvestigation:Ut,cancelLabInvestigation:qt}=Ta(),{chartPeriod:Wt,weightChartCanvas:jt,isLoadingWeightData:Se,weightData:ve,loadWeightHistory:Ke,initializeWeightChart:Yt,cleanupChart:Gt}=Ea(),{validate:Xt}=Ga(M,C,D);async function Zt(){await B.createEncounter(),await B.saveValueCodedObs("None","None")}async function Jt(){try{if(O.value)return await Zt(),!0;if(!await Xt())return!1;const a=[];if(ge()&&R.value){const A=await le(N.value,d,l);A!=null&&A.observations&&a.push(...A.observations)}if(U.value){const A=new ee(N.value,53,d,l),Z={history:Re.value,status:Fe.value,methods:Je.value,symptoms:we.value,encounterService:A},oe=await bt(N.value,53,d,l,Z);oe&&oe.length>0&&a.push(...oe)}if(ve.value&&ve.value.length>0){const A=new ee(N.value,53,d,l),Z=ve.value[ve.value.length-1];if(Z!=null&&Z.weight){const oe=await A.buildValueNumber("Weight",Z.weight);a.push(oe)}}(he.isPregnant!==null||he.isBreastFeeding!==null)&&E.value&&E.value.length>0&&a.push(...E.value);try{const A=await Vt(N.value,d,l);A&&A.length>0&&a.push(...A)}catch(A){console.error("No contraceptives selected or error building contraceptives payload:",A)}T.value&&T.value.length>0&&a.push(...T.value);const h=a.filter(A=>A&&Object.keys(A).length>0);if(h.length>0){let A=R.value;if(!A){const oe=await new ee(N.value,53,d,l).createEncounter();if(!oe)return W("Failed to create encounter"),!1;A=oe.encounter_id}await ee.saveObsArray(Number(A),h),Ve("Consultation data saved successfully")}return!0}catch(X){return console.error("Error submitting consultation data:",X),W("Failed to save consultation data"),!1}}ue(async()=>{await At(),await Ke(),setTimeout(()=>{ve.value.length>0&&Yt()},500)}),da(()=>{Gt()}),i({onSubmit:Jt});const Kt=()=>{document.querySelectorAll(".multiselect").forEach(a=>{const h=a.querySelector(".multiselect__content-wrapper");if(h){const A=a.clientWidth||"320";h.style.width=A+"px"}})};return ue(()=>{ua(()=>{setTimeout(()=>{Kt()},1e3)})}),ue(async()=>{c.value=await Ue.cervicalCancerScreeningEnabled(),O.value=await B.getClient()==="No",O.value||(O.value=!!await Ia.isDrugRefillPatient(N.value))}),(X,a)=>O.value?(y(),Q(e(nt),{key:0,style:{height:"40vh"}},{default:n(()=>[t(e(ze),null,{default:n(()=>a[20]||(a[20]=[s("div",{style:{"margin-top":"10%"},class:"ion-text-center"},[s("h1",null,[v("Consultation is not required for a "),s("b",null,"Guardian only"),v(" visit or "),s("b",null,"Drug refills"),v(". ")]),s("h1",{class:"ion-padding"},[v("Press the "),s("span",{style:{color:"green","font-weight":"bold"}},"Save / Finish "),v("button to continue")])],-1)])),_:1,__:[20]})]),_:1})):(y(),Q(e(nt),{key:1},{default:n(()=>[t(e(ze),null,{default:n(()=>[t(vn,{patientID:Number(N.value)},null,8,["patientID"]),t(e(ca),{ref_key:"accordionGroup",ref:m,value:p.value,multiple:!0},{default:n(()=>[t(e(fe),{style:{position:"relative !important",overflow:"visible !important"},value:"lab-investigation"},{default:n(()=>[t(e(G),{slot:"header"},{default:n(()=>[s("div",kn,[a[23]||(a[23]=s("div",{class:"section-icon"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 48 48"},[s("g",{fill:"none",stroke:"currentColor","stroke-width":"4"},[s("path",{"stroke-linecap":"round",d:"m29.003 18.373l1.105-1.105l.53-.53a5.5 5.5 0 0 0 0-7.778v0a5.5 5.5 0 0 0-7.778 0L9.172 22.648a.143.143 0 0 0 0 .202l6.97 6.97a1 1 0 0 0 1.414 0l3.713-3.713l1.105-1.105"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m28.163 6.485l1.768-1.767a3.5 3.5 0 0 1 4.95 4.95l-1.768 1.767zM10.485 24.163l-4.242 4.243l4.95 4.95l4.242-4.243z"}),s("circle",{cx:"26.041",cy:"22.042",r:"4.5",transform:"rotate(45 26.041 22.042)"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m6 20l12.728 12.728M10 44h32M31 22c4 0 8 4 8 10c0 6.4-5.167 9.833-8 12"})])])],-1)),t(e(L),null,{default:n(()=>[a[22]||(a[22]=v(" Lab investigation ")),g.value?(y(),V("span",Dn,[t(e(j),{size:"small",icon:e(pe),style:{"margin-right":"3px"}},null,8,["icon"]),a[21]||(a[21]=v(" Completed "))])):x("",!0)]),_:1,__:[22]})])]),_:1}),s("div",Vn,[t(e(va),{class:"single-row-grid",style:{overflow:"visible !important"}},{default:n(()=>[t(e(re),{class:"align-items-center"},{default:n(()=>[t(e(H),{size:"auto"},{default:n(()=>[t(e(Y),{fill:"clear",shape:"round",size:"small",onClick:e(Ht)},{default:n(()=>[t(e(j),{icon:e(st),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])]),_:1}),t(e(H),{size:"3"},{default:n(()=>[t(e(L),{class:"labl-cls"},{default:n(()=>a[24]||(a[24]=[v(" Test ")])),_:1,__:[24]}),t(e(ke),{modelValue:e(_e),"onUpdate:modelValue":[a[0]||(a[0]=h=>ie(_e)?_e.value=h:null),e($t)],teleport:"",multiple:!1,taggable:!1,"hide-selected":!0,"close-on-select":!0,openDirection:"auto","tag-placeholder":"",placeholder:"Select test",selectLabel:"",label:"name",searchable:!0,"track-by":"assigned_id",options:e(xt),disabled:!1},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(e(H),{size:"3"},{default:n(()=>[t(e(L),{class:"labl-cls"},{default:n(()=>a[25]||(a[25]=[v(" Specimen ")])),_:1,__:[25]}),t(e(ke),{modelValue:e(ye),"onUpdate:modelValue":a[1]||(a[1]=h=>ie(ye)?ye.value=h:null),multiple:!1,taggable:!1,"hide-selected":!0,"close-on-select":!0,openDirection:"auto","tag-placeholder":"",placeholder:"Select specimen",selectLabel:"",label:"name",searchable:!0,"track-by":"assigned_id",options:e(Lt),disabled:!1,appendToBody:!0},null,8,["modelValue","options"])]),_:1}),t(e(H),{size:"3"},{default:n(()=>[t(e(L),{class:"labl-cls"},{default:n(()=>a[26]||(a[26]=[v(" Reason ")])),_:1,__:[26]}),t(e(ke),{modelValue:e(Ae),"onUpdate:modelValue":a[2]||(a[2]=h=>ie(Ae)?Ae.value=h:null),multiple:!1,taggable:!1,"hide-selected":!0,"close-on-select":!0,openDirection:"auto","tag-placeholder":"",placeholder:"Select reason",selectLabel:"",searchable:!0,options:e(Ft),disabled:!1,appendToBody:!0},null,8,["modelValue","options"])]),_:1}),e(_e)&&e(_e).name&&e(_e).name.match(/HIV viral load/i)&&e(ye)&&e(ye).name&&e(ye).name.match(/dbs|plasma/i)?(y(),Q(e(H),{key:0,size:"auto"},{default:n(()=>[t(e(L),{class:"labl-cls"},{default:n(()=>a[27]||(a[27]=[v(" Barcode ID ")])),_:1,__:[27]}),t(e(fa),{placeholder:"Scan barcode",modelValue:e($e),"onUpdate:modelValue":a[3]||(a[3]=h=>ie($e)?$e.value=h:null),class:"barcode-input"},{default:n(()=>[t(e(j),{slot:"start",icon:e(pa),"aria-hidden":"true"},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})):x("",!0)]),_:1}),t(e(H),{size:"auto"},{default:n(()=>[t(e(Y),{fill:"clear",class:"ion-margin-top",onClick:e(zt)},{default:n(()=>[t(e(j),{icon:e(ma),slot:"start"},null,8,["icon"]),v(" "+$(e(Rt)?"UPDATE ORDERS":"ADD TO ORDERS"),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),e(Te).length>0?(y(),V("div",In,[s("div",En,[s("table",Tn,[a[28]||(a[28]=s("thead",null,[s("tr",null,[s("th",null,"TEST"),s("th",null,"SPECIMEN"),s("th",null,"REASON"),s("th",null,"BARCODE"),s("th",null,"ACTIONS")])],-1)),s("tbody",null,[(y(!0),V(te,null,ce(e(Te),h=>(y(),V("tr",{key:h.id},[s("td",null,$(h.test.name),1),s("td",null,$(h.specimen.name),1),s("td",null,$(h.reason),1),s("td",null,$(h.accessionNumber||"N/A"),1),s("td",Mn,[t(e(Y),{fill:"clear",size:"small",color:"nuetral",onClick:A=>e(Ut)(h.id)},{default:n(()=>[t(e(j),{icon:e(it),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"]),t(e(Y),{fill:"clear",size:"small",color:"danger",onClick:A=>e(qt)(h.id)},{default:n(()=>[t(e(j),{icon:e(ga),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"])])]))),128))])])])])):x("",!0),s("div",Nn,[t(e(Y),{expand:"block",onClick:Tt},{default:n(()=>a[29]||(a[29]=[v(" Save and Continue ")])),_:1,__:[29]})])])]),_:1}),t(e(fe),{value:"weight-chart"},{default:n(()=>[t(e(G),{slot:"header"},{default:n(()=>[s("div",On,[a[32]||(a[32]=s("div",{class:"section-icon"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",viewBox:"0 0 24 24"},[s("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",color:"currentColor"},[s("path",{d:"M19 15v3.889C19 21.114 18.264 22 15.889 22H8.11C5.886 22 5 21.264 5 18.889V15a7 7 0 1 1 14 0"}),s("path",{d:"M16 15a4 4 0 0 0-8 0m4 2l1-2m3.312-10H7.688c-.884 0-1.326 0-1.715-.152a2 2 0 0 1-.368-.187c-.35-.22-.595-.568-1.085-1.263c-.382-.541-.573-.812-.507-1.033a.5.5 0 0 1 .107-.19C4.28 2 4.624 2 5.313 2h13.376c.689 0 1.033 0 1.192.175q.075.084.107.19c.066.221-.125.492-.507 1.033c-.49.695-.735 1.042-1.085 1.263a2 2 0 0 1-.368.187C17.637 5 17.196 5 16.312 5M14 8V5m-4 3V5"})])])],-1)),t(e(L),null,{default:n(()=>[a[31]||(a[31]=v(" Patient weight chart ")),M.value?(y(),V("span",Pn,[t(e(j),{size:"small",icon:e(pe),style:{"margin-right":"3px"}},null,8,["icon"]),a[30]||(a[30]=v(" Completed "))])):x("",!0)]),_:1,__:[31]})])]),_:1}),s("div",Bn,[s("div",xn,[s("div",Ln,[t(e(L),null,{default:n(()=>[v("Weight trail ("+$(e(Wt))+" year period)",1)]),_:1}),t(e(Y),{fill:"clear",size:"small",onClick:e(Ke),disabled:e(Se)},{default:n(()=>[t(e(j),{icon:e(st),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick","disabled"])]),e(Se)?(y(),V("div",Fn,[t(e(De),{name:"bubbles"}),a[33]||(a[33]=s("p",null,"Loading weight data...",-1))])):x("",!0),!e(Se)&&e(ve).length===0?(y(),V("div",Rn,a[34]||(a[34]=[s("p",null,"No weight data available for this patient",-1)]))):x("",!0),s("div",{class:ct(["chart-canvas-container",{hidden:e(Se)||e(ve).length===0}])},[s("canvas",{ref_key:"weightChartCanvas",ref:jt,id:"weight-chart-canvas"},null,512)],2),e(Se)?x("",!0):(y(),V("div",An,[t(e(Y),{expand:"block",onClick:Mt},{default:n(()=>a[35]||(a[35]=[v(" Continue ")])),_:1,__:[35]})]))])])]),_:1}),e(k).isFemale()?(y(),Q(e(fe),{key:0,value:"pregnancy-breastfeeding"},{default:n(()=>[t(e(G),{slot:"header"},{default:n(()=>[s("div",$n,[a[38]||(a[38]=s("div",{class:"section-icon"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},[s("g",{fill:"currentColor"},[s("path",{d:"M15.751 8.26c.2 0 .386.056.553.148c.398.14.706.485.797.913c.02.12-.08.23-.2.23h-.416h.346a.75.75 0 0 0-.05-.546a.78.78 0 0 0-.7-.434a.77.77 0 0 0-.74.98h.356h-.736c-.15 0-.27-.14-.22-.29q.013-.053.03-.103l-.03-.027a.368.368 0 0 1 .02-.57c.28-.19.64-.3.99-.3"}),s("path",{d:"m15.697 9.55l.004.01h.78l.004-.01a.444.444 0 0 0-.394-.64a.4.4 0 0 0-.168.035a.14.14 0 1 1-.21.184a.43.43 0 0 0-.062.222a.5.5 0 0 0 .046.2m4.594-1.301c.35 0 .71.11.99.3c.19.13.2.41.03.56l-.035.033q.021.057.035.117c.04.15-.08.29-.23.29h-.726l-.004.01h-.78l-.005-.01h-.415c-.12 0-.22-.11-.2-.23c.081-.412.369-.75.75-.898c.176-.106.375-.172.59-.172m.064 1.3h.346q.03-.105.03-.21a.77.77 0 0 0-.77-.77c-.43 0-.78.35-.78.77c0 .08.01.14.03.21h.355a.4.4 0 0 1-.045-.2c0-.083.024-.162.066-.229a.14.14 0 0 0 .254-.08a.14.14 0 0 0-.04-.1a.4.4 0 0 1 .16-.03a.444.444 0 0 1 .395.64m-2.345 2.409c-.45 0-.87-.11-1.23-.3c-.12-.06-.25.08-.18.2c.3.46.82.77 1.41.77s1.11-.3 1.41-.77c.07-.12-.05-.25-.18-.19c-.36.18-.78.29-1.23.29m-.76-1.39l.44-1.42c.1-.31.54-.31.63 0l.44 1.42c.09.29-.12.59-.43.59h-.65c-.3 0-.52-.3-.43-.59m-2.31-2.76a.22.22 0 0 1-.2-.12c-.07-.1-.03-.25.08-.31c.03-.02.78-.44 1.65-.28c.13.02.21.14.19.27c-.02.12-.15.21-.27.18c-.7-.13-1.33.23-1.33.23c-.04.03-.08.03-.12.03m6.02-.03q.06.03.12.03c.08 0 .16-.04.21-.12a.24.24 0 0 0-.112-.33c-.135-.068-.83-.416-1.628-.27a.23.23 0 0 0-.19.27c.02.13.15.21.27.19c.626-.117 1.203.168 1.312.222z"}),s("path",{d:"M24.251 10.63a2.86 2.86 0 0 0-.2-2.82c-.3-.46-.46-.99-.46-1.54v-.01a2.86 2.86 0 0 0-2.86-2.86c-.16 0-.3-.07-.39-.2c-.52-.73-1.37-1.2-2.33-1.2s-1.81.47-2.33 1.2c-.09.12-.24.2-.39.2a2.86 2.86 0 0 0-2.86 2.86v.01c0 .55-.16 1.08-.46 1.54a2.86 2.86 0 0 0-.2 2.82c.06.13.06.27 0 .4a2.79 2.79 0 0 0 2.437 4.01l-1.557 1.67c-.33.35-.53.82-.53 1.34c0 .5.19.96.49 1.3c.09.1.03.27-.1.29a6.385 6.385 0 0 0-5.308 6.168a1.66 1.66 0 0 0-1.198 1.444l-.001.014v.013c-.023.373.077.73.271 1.025a1.66 1.66 0 0 0 .423 1.337q.008.046.019.094l.002.01c.192.793.919 1.255 1.632 1.255h1.042c.036 0 .678.002 1.013-.054a13 13 0 0 0 .88-.162a19 19 0 0 0 2.68-.784h6.405c.96 0 1.74-.78 1.74-1.74V16.05c0-.36-.072-.702-.203-1.016a2.79 2.79 0 0 0 2.333-4.004a.5.5 0 0 1 .01-.4m-1.91-3.116a2 2 0 0 1 .04.386l-.005.125a1.4 1.4 0 0 1 1.133 1.373a1.4 1.4 0 0 1-1.257 1.392c-.227 2.284-2.049 3.79-4.24 3.79c-2.122 0-3.897-1.42-4.215-3.575q-.015-.107-.026-.216a1.399 1.399 0 0 1-.119-2.764l-.01-.265c.007-.635.3-.96.78-1.28c.267-.178.526-.364.73-.6l.005-.005q.11-.127.197-.277l.006-.01q.045-.081.081-.168l.07-.15c.07-.17.3-.2.4-.05a3.2 3.2 0 0 0 .465.545l.006.005c.605.565 1.414.89 2.26.89h2.76c.14 0 .77.061.938.854M8.93 26.74l-.3-.3a.66.66 0 0 1 0-.92c.25-.25.67-.25.92 0l.54.54c.2.2.49.28.77.21c1.24-.31 3.31-.99 4.91-2.38a7 7 0 0 0 1.154-1.275a8 8 0 0 0 .658-1.106c.25-.503.442-1.007.588-1.48v-.009h3.6q-.107.477-.266 1a13 13 0 0 1-.655 1.718a12 12 0 0 1-1.019 1.782a10.7 10.7 0 0 1-1.78 1.99c-3.166 2.74-7.354 3.38-7.78 3.445l-.03.005l-.036.005C9.95 30 9.44 30 9.391 30h-1.04c-.31 0-.59-.2-.66-.49a.67.67 0 0 1 .02-.37l-.057-.021a.645.645 0 0 1-.393-.6c0-.2.09-.38.23-.5a.64.64 0 0 1-.49-.68a.67.67 0 0 1 .67-.6z"})])])],-1)),t(e(L),null,{default:n(()=>[a[37]||(a[37]=v(" Pregnancy or Breast Feeding ")),Ze.value?(y(),V("span",Hn,[t(e(j),{size:"small",icon:e(pe),style:{"margin-right":"3px"}},null,8,["icon"]),a[36]||(a[36]=v(" Completed "))])):x("",!0)]),_:1,__:[37]})])]),_:1}),s("div",zn,[s("div",null,[t(e(re),null,{default:n(()=>[t(e(H),null,{default:n(()=>[t(e(L),null,{default:n(()=>a[39]||(a[39]=[v("Pregnant")])),_:1,__:[39]})]),_:1}),t(e(H),null,{default:n(()=>[s("div",Un,[t(e(de),{modelValue:e(he).isPregnant,"onUpdate:modelValue":a[4]||(a[4]=h=>e(he).isPregnant=h)},{default:n(()=>[t(e(q),{slot:"end",value:"yes"},{default:n(()=>a[40]||(a[40]=[v("Yes")])),_:1,__:[40]}),t(e(q),{slot:"end",style:{"margin-left":"20px"},value:"no"},{default:n(()=>a[41]||(a[41]=[v("No")])),_:1,__:[41]})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),t(e(re),null,{default:n(()=>[t(e(H),null,{default:n(()=>[t(e(L),null,{default:n(()=>a[42]||(a[42]=[v("Breastfeeding")])),_:1,__:[42]})]),_:1}),t(e(H),null,{default:n(()=>[s("div",qn,[t(e(de),{modelValue:e(he).isBreastFeeding,"onUpdate:modelValue":a[5]||(a[5]=h=>e(he).isBreastFeeding=h)},{default:n(()=>[t(e(q),{slot:"end",value:"yes"},{default:n(()=>a[43]||(a[43]=[v("Yes")])),_:1,__:[43]}),t(e(q),{slot:"end",style:{"margin-left":"20px"},value:"no"},{default:n(()=>a[44]||(a[44]=[v("No")])),_:1,__:[44]})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),e(St)?x("",!0):(y(),V("div",Wn,[t(e(Y),{expand:"block",onClick:Pt},{default:n(()=>a[45]||(a[45]=[v(" Continue ")])),_:1,__:[45]})]))])])]),_:1})):x("",!0),e(k).isFemale()?(y(),Q(e(fe),{key:1,value:"contraceptives"},{default:n(()=>[t(e(G),{slot:"header"},{default:n(()=>[s("div",jn,[a[48]||(a[48]=s("div",{class:"section-icon"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 48 48"},[s("path",{fill:"currentColor","fill-rule":"evenodd",d:"M16 7.152a2 2 0 0 1 1.347-1.89l3.018-1.043A4 4 0 0 1 21.671 4h4.658a4 4 0 0 1 1.306.22l3.018 1.042A2 2 0 0 1 32 7.152V11h-1.09a1 1 0 0 1-.206.607l-1.51 1.978l5.362 1.756A5 5 0 0 1 38 20.092V39a5 5 0 0 1-5 5H15a5 5 0 0 1-5-5V20.092a5 5 0 0 1 3.444-4.751l5.362-1.756l-1.51-1.978a1 1 0 0 1-.205-.607H16zM19.349 11h9.302l-1.046 1.371a2 2 0 0 0 .967 3.114l5.362 1.756A3 3 0 0 1 36 20.092V39a3 3 0 0 1-3 3H15a3 3 0 0 1-3-3V20.092a3 3 0 0 1 2.066-2.85l5.362-1.757a2 2 0 0 0 .967-3.114zm10.97 21.906A8 8 0 0 0 19.095 21.68l4.113 4.112l-1.414 1.414l-4.113-4.113A8 8 0 0 0 28.906 34.32l-3.113-3.112l1.414-1.414zM24 38c5.523 0 10-4.477 10-10s-4.477-10-10-10s-10 4.477-10 10s4.477 10 10 10m.567-11.99c-.27-.783-.01-1.843.737-2.687c.991-1.122 2.465-1.44 3.292-.71s.694 2.233-.298 3.355c-.648.735-1.504 1.124-2.25 1.101l-.002.005c-.207.347-.302.762-.384 1.176l-.01.045c-.074.38-.18.884-.672 1.394c-.504.523-1.431.707-2.398.872c-.641.11-.973.213-1.135.281c-.133.056-.263.351-.442.756c-.292.662-.713 1.617-1.49 2.302c-.11-.993.203-2.722.38-3.655a1.7 1.7 0 0 1 .606-.753c.473-.338 1.175-.532 2.08-.686c.835-.142 1.06-.321 1.115-.378c.047-.05.086-.11.174-.553l.01-.047c.08-.406.198-1.005.586-1.656a4 4 0 0 1 .1-.161","clip-rule":"evenodd"})])],-1)),t(e(L),null,{default:n(()=>{var h;return[a[47]||(a[47]=v(" Contraceptives ")),(h=_.value)!=null&&h.isContraceptivesSaved?(y(),V("span",Yn,[t(e(j),{size:"small",icon:e(pe),style:{"margin-right":"3px"}},null,8,["icon"]),a[46]||(a[46]=v(" Completed "))])):x("",!0)]}),_:1,__:[47]})])]),_:1}),s("div",Gn,[t(sn,{"patient-i-d":Number(N.value),"provider-i-d":e(d),"location-i-d":e(l),ref_key:"contraceptivesRef",ref:_,onOnSuccess:Nt},null,8,["patient-i-d","provider-i-d","location-i-d"])])]),_:1})):x("",!0),e(k).isFemale()&&c.value?(y(),Q(e(fe),{key:2,value:"cxca"},{default:n(()=>[t(e(G),{slot:"header"},{default:n(()=>[s("div",Xn,[a[51]||(a[51]=s("div",{class:"section-icon"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[s("g",{fill:"currentColor"},[s("path",{d:"M7.773 2.384L5.727 8.268a14.09 14.09 0 0 0 1.137 11.728l.504.864l-1.728 1.008l-.504-.864A16.09 16.09 0 0 1 3.838 7.61l2.046-5.884zm8.454 0l2.047 5.884a14.09 14.09 0 0 1-1.138 11.728l-.504.864l1.728 1.008l.504-.864A16.09 16.09 0 0 0 20.163 7.61l-2.047-5.884zM13 21v-5.086l3.207-3.207l-1.414-1.414L12 14.086l-2.793-2.793l-1.414 1.414L11 15.914V21z"}),s("path",{"fill-rule":"evenodd",d:"M11.633 3c-1.65 0-2.496 1.978-1.355 3.171l.684.715l-2.004 2.096l1.084 1.037L12 7.97l1.958 2.047l1.084-1.036l-2.004-2.096l.684-.715c1.14-1.193.296-3.17-1.355-3.17zm1.005 2.134L12 5.801l-.638-.667a.375.375 0 0 1 .27-.634h.735c.33 0 .5.396.271.634","clip-rule":"evenodd"})])])],-1)),t(e(L),null,{default:n(()=>[a[50]||(a[50]=v(" Cervical Cancer ")),w.value?(y(),V("span",Zn,[t(e(j),{size:"small",icon:e(pe),style:{"margin-right":"3px"}},null,8,["icon"]),a[49]||(a[49]=v(" Completed "))])):x("",!0)]),_:1,__:[50]})])]),_:1}),s("div",Jn,[t(Sn,{"patient-i-d":Number(N.value),"provider-i-d":e(d),"location-i-d":e(l),ref:"cxcaRef",onOnSuccess:Ot},null,8,["patient-i-d","provider-i-d","location-i-d"])])]),_:1})):x("",!0),t(e(fe),{value:"contraindications"},{default:n(()=>[t(e(G),{slot:"header"},{default:n(()=>[s("div",Kn,[a[54]||(a[54]=s("div",{class:"section-icon"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",viewBox:"0 0 16 16"},[s("path",{fill:"currentColor",d:"M3.001 3.999a1.001 1.001 0 0 1 1.836-.555a.5.5 0 1 0 .832-.555A2 2 0 0 0 2 3.999A2 2 0 0 0 4.078 6h3.259a5.5 5.5 0 0 1 3.151-1h-6.41l-.038.001L4.003 5A1 1 0 0 1 3 3.999m.495 3.003h2.76a5.5 5.5 0 0 0-.657 1H3.496a.5.5 0 1 1 0-1M2.501 9h2.706a5.5 5.5 0 0 0-.185 1h-2.52a.5.5 0 0 1 0-1m.995 2h1.526q.048.516.185 1H3.496a.5.5 0 0 1 0-1M7.5 3a.5.5 0 0 0 0 1h6a.5.5 0 1 0 0-1zm7.5 7.5a4.5 4.5 0 1 1-9 0a4.5 4.5 0 0 1 9 0m-4-2a.5.5 0 1 0-1 0V10H8.5a.5.5 0 0 0 0 1H10v1.5a.5.5 0 0 0 1 0V11h1.5a.5.5 0 1 0 0-1H11z"})])],-1)),t(e(L),null,{default:n(()=>[a[53]||(a[53]=v(" Contraindications/side effects ")),C.value?(y(),V("span",Qn,[t(e(j),{size:"small",icon:e(pe),style:{"margin-right":"3px"}},null,8,["icon"]),a[52]||(a[52]=v(" Completed "))])):x("",!0)]),_:1,__:[53]})])]),_:1}),s("div",es,[s("div",ts,[t(e(re),null,{default:n(()=>[t(e(H),null,{default:n(()=>[t(e(L),null,{default:n(()=>a[55]||(a[55]=[v("Has side effects / contraindications")])),_:1,__:[55]})]),_:1}),t(e(H),null,{default:n(()=>[s("div",as,[t(e(de),{modelValue:I.value,"onUpdate:modelValue":a[6]||(a[6]=h=>I.value=h)},{default:n(()=>[t(e(q),{slot:"end",value:"yes"},{default:n(()=>a[56]||(a[56]=[v("Yes")])),_:1,__:[56]}),t(e(q),{slot:"end",style:{"margin-left":"20px"},value:"no"},{default:n(()=>a[57]||(a[57]=[v("No")])),_:1,__:[57]})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),I.value==="yes"?(y(),V("div",ns,[e(ae)?(y(),V("div",ss,[t(e(De),{name:"bubbles"}),a[58]||(a[58]=s("p",null,"Loading side effects data...",-1))])):x("",!0),s("div",ls,[t(e(ha),{modelValue:S.value,"onUpdate:modelValue":a[7]||(a[7]=h=>S.value=h),onIonChange:It},{default:n(()=>[t(e(lt),{value:"contraindication"},{default:n(()=>[t(e(L),null,{default:n(()=>a[59]||(a[59]=[v("Side Effects/Contraindications")])),_:1,__:[59]})]),_:1}),t(e(lt),{value:"side_effect"},{default:n(()=>[t(e(L),null,{default:n(()=>a[60]||(a[60]=[v("Others")])),_:1,__:[60]})]),_:1})]),_:1},8,["modelValue"])]),t(za,{modelValue:e(z),"onUpdate:modelValue":a[8]||(a[8]=h=>ie(z)?z.value=h:null),"side-effect-options":e(F)},null,8,["modelValue","side-effect-options"])])):x("",!0),s("div",os,[t(e(Y),{expand:"block",onClick:Et},{default:n(()=>a[61]||(a[61]=[v(" Save and Continue ")])),_:1,__:[61]})])])])]),_:1}),t(e(fe),{value:"tb-therapy"},{default:n(()=>[t(e(G),{slot:"header"},{default:n(()=>[s("div",is,[a[64]||(a[64]=s("div",{class:"section-icon"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 48 48"},[s("g",{fill:"currentColor","fill-rule":"evenodd","clip-rule":"evenodd"},[s("path",{d:"M35 30.5a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0m-2 0a.5.5 0 1 1-1 0a.5.5 0 0 1 1 0"}),s("path",{d:"M23 20.5V6h2v14.5c0 1.398.564 1.942 1.004 2.199q.073.042.148.078l-.004-.377c-.038-3.528-.112-10.4 5.327-10.4c4.126 0 7.599 7.974 9.335 15.542c.11.263.175.55.188.849c1.232 5.783 1.415 11.14.057 12.27c-3.193 2.653-9.58 1.06-12.773-2.124c-2.578-2.57-2.355-8.578-2.195-12.891v-.002q.016-.393.028-.767a4.3 4.3 0 0 1-1.119-.45a3.8 3.8 0 0 1-.996-.835c-.297.352-.64.626-.996.834c-.4.234-.794.37-1.12.451l.029.769c.16 4.313.383 10.32-2.195 12.891c-3.193 3.185-9.58 4.777-12.773 2.123S9.075 12 16.525 12c5.439 0 5.365 6.872 5.327 10.4v.002l-.004.375q.075-.036.148-.078c.44-.257 1.004-.801 1.004-2.199m15.327 5.36l.038.144a2.5 2.5 0 1 0 1.065 4.817c.27 1.566.449 3.05.526 4.36c.079 1.332.049 2.413-.068 3.188a3.7 3.7 0 0 1-.206.828c-.96.73-2.598 1.022-4.633.628c-2.058-.4-4.076-1.43-5.355-2.704c-.443-.442-.84-1.172-1.137-2.261c-.293-1.076-.45-2.361-.517-3.761c-.066-1.393-.04-2.833.004-4.208l.04-1.126v-.003q.019-.472.034-.927A3.001 3.001 0 0 0 34 24a3 3 0 0 0-5.847-.95q0-.344-.005-.719c-.015-1.648-.034-3.691.411-5.466c.254-1.014.616-1.732 1.05-2.178c.375-.386.912-.687 1.866-.687c.319 0 .777.134 1.395.654c.412.346.846.824 1.289 1.434A2.503 2.503 0 0 0 31 18.5a2.5 2.5 0 0 0 4.917.642c.927 1.962 1.748 4.292 2.41 6.719m.666 2.723l-.08-.366a.5.5 0 1 0 .08.366M16.525 14c.954 0 1.49.3 1.866.687c.434.446.796 1.164 1.05 2.178c.445 1.775.426 3.817.41 5.465l-.004.816c0 .76.033 1.67.069 2.616l.04 1.129c.044 1.375.07 2.815.004 4.208c-.067 1.4-.224 2.685-.517 3.76c-.297 1.09-.694 1.82-1.137 2.262c-1.279 1.275-3.297 2.304-5.355 2.704c-2.035.394-3.673.102-4.633-.628l-.016-.04a3.7 3.7 0 0 1-.19-.788c-.117-.775-.147-1.856-.068-3.188c.157-2.65.727-6.012 1.63-9.32c.905-3.321 2.109-6.46 3.474-8.722c.683-1.133 1.357-1.96 1.982-2.485c.618-.52 1.076-.654 1.395-.654M33.5 19a.5.5 0 1 0 0-1a.5.5 0 0 0 0 1M32 24a1 1 0 1 1-2 0a1 1 0 0 1 2 0"})])])],-1)),t(e(L),null,{default:n(()=>[a[63]||(a[63]=v(" TB Preventive Therapy ")),D.value?(y(),V("span",rs,[t(e(j),{size:"small",icon:e(pe),style:{"margin-right":"3px"}},null,8,["icon"]),a[62]||(a[62]=v(" Completed "))])):x("",!0)]),_:1,__:[63]})])]),_:1}),s("div",ds,[e(Ct)?(y(),V("div",us,[t(e(De),{name:"bubbles"}),a[65]||(a[65]=s("p",null,"Loading side effects data...",-1))])):x("",!0),s("div",cs,[s("div",vs,[a[68]||(a[68]=s("label",{class:"form-label required"},"On TB treatment?",-1)),s("div",fs,[t(e(de),{modelValue:e(U),"onUpdate:modelValue":a[9]||(a[9]=h=>ie(U)?U.value=h:null)},{default:n(()=>[s("div",ps,[t(e(q),{value:"Yes"}),t(e(L),null,{default:n(()=>a[66]||(a[66]=[v("Yes")])),_:1,__:[66]})]),s("div",ms,[t(e(q),{value:"No"}),t(e(L),null,{default:n(()=>a[67]||(a[67]=[v("No")])),_:1,__:[67]})])]),_:1},8,["modelValue"])])]),e(U).toLowerCase()==="yes"&&e(U).toLowerCase()!=="unknown"?(y(),V("div",gs,[a[71]||(a[71]=s("label",{class:"form-label required"},"TB Treatment Start Date",-1)),t(e(re),null,{default:n(()=>[t(e(H),{size:"10"},{default:n(()=>[t(pt,{place_holder:"enter data",onDateUpDated:[()=>{},a[10]||(a[10]=h=>{Ge.value={day:h.value.day,month:h.value.month,year:h.value.year}})],date_prop:""})]),_:1}),t(e(H),{size:"2"},{default:n(()=>[t(e(Y),{fill:"clear","start-icon":e(_a),onClick:a[11]||(a[11]=h=>Xe.value=!0)},{default:n(()=>a[69]||(a[69]=[v("Estimate")])),_:1,__:[69]},8,["start-icon"])]),_:1})]),_:1}),e(Xe)?(y(),V("div",hs,[t(ft,{bold:"bold","input-header":"Estimate number of ".concat(e(Be).name),"input-value":e(Ee),"onUpdate:inputValue":[a[12]||(a[12]=h=>ie(Ee)?Ee.value=h:null),a[13]||(a[13]=h=>Ee.value=h.target.value)],showAsterisk:"",placeholder:"",unitsData:{isSingleSelect:!0,multiSelectData:e(gt).map(h=>({name:h})),value:e(Be),trackBy:"name"},"onUpdate:units":a[14]||(a[14]=h=>Be.value=h)},null,8,["input-header","input-value","unitsData"])])):x("",!0),s("div",_s,[a[70]||(a[70]=s("label",{position:"stacked",class:"form-label required"},"Treatment Period",-1)),t(ka,{placeholder:"",inputValue:e(ne),unit:"Months",icon:e(ya),type:"number"},null,8,["inputValue","icon"])])])):e(U).toLowerCase()==="no"&&e(U).toLowerCase()!=="unknown"?(y(),V("div",ys,[s("div",bs,[a[72]||(a[72]=s("h4",null,"TB Associated Symptoms",-1)),t(ja,{modelValue:e(we),"onUpdate:modelValue":a[15]||(a[15]=h=>ie(we)?we.value=h:null),"tb-symptom-options":e(wt)},null,8,["modelValue","tb-symptom-options"])]),s("div",Cs,[t(e(re),null,{default:n(()=>[t(e(H),null,{default:n(()=>a[73]||(a[73]=[s("label",{class:"form-label required"},"CXR (Chest X-ray) Screening Method Result",-1)])),_:1,__:[73]}),t(e(H),null,{default:n(()=>[s("div",ws,[t(e(de),{modelValue:xe.value,"onUpdate:modelValue":a[16]||(a[16]=h=>xe.value=h)},{default:n(()=>[s("div",Ss,[t(e(q),{value:"normal"}),t(e(L),null,{default:n(()=>a[74]||(a[74]=[v("Normal")])),_:1,__:[74]})]),s("div",ks,[t(e(q),{value:"abnormal"}),t(e(L),null,{default:n(()=>a[75]||(a[75]=[v("Abnormal")])),_:1,__:[75]})]),s("div",Ds,[t(e(q),{value:"unknown"}),t(e(L),null,{default:n(()=>a[76]||(a[76]=[v("Unknown/Not Done")])),_:1,__:[76]})])]),_:1},8,["modelValue"])])]),_:1})]),_:1}),t(e(re),null,{default:n(()=>[t(e(H),null,{default:n(()=>a[77]||(a[77]=[s("label",{class:"form-label required"},"mWRD (Molecular WHO Recommended Rapid Diagnostic Test) Screening Method Result",-1)])),_:1,__:[77]}),t(e(H),null,{default:n(()=>[s("div",Vs,[t(e(de),{modelValue:Le.value,"onUpdate:modelValue":a[17]||(a[17]=h=>Le.value=h)},{default:n(()=>[s("div",Is,[t(e(q),{value:"negative"}),t(e(L),null,{default:n(()=>a[78]||(a[78]=[v("Negative")])),_:1,__:[78]})]),s("div",Es,[t(e(q),{value:"positive"}),t(e(L),null,{default:n(()=>a[79]||(a[79]=[v("Positive")])),_:1,__:[79]})]),s("div",Ts,[t(e(q),{value:"unknown"}),t(e(L),null,{default:n(()=>a[80]||(a[80]=[v("Unknown/Not Done")])),_:1,__:[80]})])]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),e(_t)(Je.value,e(we))?(y(),V("div",Ms,[s("div",null,[a[81]||(a[81]=s("label",{class:"form-label"},"TB Status",-1)),s("div",Ns,[t(e(ke),{modelValue:Fe.value,"onUpdate:modelValue":a[18]||(a[18]=h=>Fe.value=h),multiple:!1,taggable:!1,"hide-selected":!1,"close-on-select":!0,openDirection:"bottom","tag-placeholder":"",placeholder:"Select TB status",selectLabel:"",label:"name",searchable:!0,"track-by":"assigned_id",options:e(ht).map(h=>({name:h,assigned_id:h})),disabled:!1},null,8,["modelValue","options"])])])])):x("",!0)])):x("",!0),e(U).toLowerCase()!=="unknown"?(y(),V("div",Os,[a[82]||(a[82]=s("label",{class:"form-label required"},"TB preventive therapy (TPT) history",-1)),s("div",null,[t(e(ke),{modelValue:Re.value,"onUpdate:modelValue":a[19]||(a[19]=h=>Re.value=h),multiple:!1,taggable:!1,"hide-selected":!0,"close-on-select":!0,openDirection:"bottom","tag-placeholder":"",placeholder:"Select option",selectLabel:"",label:"name",searchable:!0,"track-by":"assigned_id",options:e(yt).map(h=>({name:h,assigned_id:h})),disabled:!1},null,8,["modelValue","options"])])])):x("",!0),s("div",Ps,[t(e(Y),{expand:"block",onClick:Bt},{default:n(()=>a[83]||(a[83]=[v(" Save and Continue ")])),_:1,__:[83]})])])])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}))}}),qs=Ce(Bs,[["__scopeId","data-v-95ec0610"]]);export{qs as default};

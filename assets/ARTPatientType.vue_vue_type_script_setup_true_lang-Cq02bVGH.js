import{d as w,r as u,cY as L,a as S,y as T,f as p,z as l,l as r,u as i,aN as k,k as o,e as v,m as x,A as y,aE as I,F as _,L as C,G as N,aF as B,D,B as E,bm as R,aQ as q}from"./vendor-8nEYVyB7.js";import{P as A,L as G,t as c,k as U}from"./index-7qwbP5UI.js";import{P as g}from"./patient_type_service-C4tT8azK.js";const z={key:0,class:"ion-padding"},Y=w({__name:"ARTPatientType",setup(M,{expose:F}){const d=u(!1),f=u([]),m=u([]),h=new A,n=new g(h.getID(),-1),e=L({patientType:null,prevType:null,transerFacility:null});async function b(a=""){try{const t=await G.getFacilities({name:a});m.value=t}catch(t){console.error("Error fetching facilities:",t)}}async function P(){var a;if(e.patientType===e.prevType)return!0;if(!e.patientType)return c("Patient type is required"),!1;if(!/new patient/i.test(e.patientType)&&e.patientType!==e.prevType&&!e.transerFacility)return c("Facility is required"),!1;n.setPatientType(e.patientType),n.setLocationName(((a=e.transerFacility)==null?void 0:a.name)||"");try{return await n.save()?(U("Patient type saved successfully"),!0):(c("Failed to save patient type"),!1)}catch(t){return c("Failed to save patient type: ".concat(t)),!1}}return S(()=>{d.value=!0,f.value=g.getPatientTypes(),n.loadPatientType().then(()=>{const a=n.getType();a&&!/n\/a/i.test(a)&&(e.prevType=n.getType(),e.patientType=n.getType())}).finally(()=>{d.value=!1})}),F({onSubmit:P}),(a,t)=>(p(),T(i(q),{style:{height:"65vh"}},{default:l(()=>[r(i(k),null,{default:l(()=>[o("div",null,[t[2]||(t[2]=o("h2",{style:{"font-weight":"bold",margin:"12px"}},[y("Patient Type "),o("span",{style:{color:"red"}},"*")],-1)),r(i(I),{modelValue:e.patientType,"onUpdate:modelValue":t[0]||(t[0]=s=>e.patientType=s)},{default:l(()=>[(p(!0),v(_,null,C(f.value,(s,V)=>(p(),T(i(N),{key:V},{default:l(()=>[r(i(B),{slot:"start",value:s.value},null,8,["value"]),r(i(D),{style:{margin:"10px"}},{default:l(()=>[y(E(s.label),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),e.prevType!==e.patientType&&!/new patient/i.test(e.patientType)?(p(),v("div",z,[t[3]||(t[3]=o("h2",{style:{"font-weight":"bold",margin:"12px"}},[y("Facility "),o("span",{style:{color:"red"}},"*")],-1)),r(i(R),{modelValue:e.transerFacility,"onUpdate:modelValue":t[1]||(t[1]=s=>e.transerFacility=s),multiple:!1,taggable:!1,"hide-selected":!0,"close-on-select":!0,openDirection:"bottom",onSearchChange:b,"tag-placeholder":"Find and select facility",placeholder:"Find and select facility",selectLabel:"",label:"name",searchable:!0,"track-by":"code",options:m.value},null,8,["modelValue","options"])])):x("",!0)]),_:1})]),_:1}))}});export{Y as _};

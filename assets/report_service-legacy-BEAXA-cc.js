!function(){function t(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}System.register(["./vendor-legacy-BIeoxoe0.js","./index-legacy-D0ufbFk-.js","./lodash-legacy-C-x9g9Na.js"],(function(e,r){"use strict";var n,a,s,i,o,l,u,c,d,f,p,m,h,g,b,y,v,D,w,$,P,j,B,_,F,Q,A,I,S,M,V,q,O,R,U,k,x,C;return{setters:[t=>{n=t.c,a=t.r,s=t.eE,i=t.bT,o=t.bU,l=t.O,u=t.d,c=t.y,d=t.f,f=t.z,p=t.l,m=t.u,h=t.S,g=t.U,b=t.b3,y=t.W,v=t.I,D=t.aR,w=t.T,$=t.A,P=t.B,j=t.ad,B=t.eB,_=t.b8,F=t.eF},t=>{Q=t.A,A=t.h,I=t.j,S=t.s,M=t.f,V=t.k,q=t.m,O=t._,R=t.n,U=t.o,k=t.e,x=t.q},t=>{C=t.l}],execute:function(){var r=document.createElement("style");r.textContent=".close-button[data-v-dd3e8006]{float:right;margin-top:0;padding-top:0;font-size:x-large;cursor:pointer}\n/*$vite$:1*/",document.head.appendChild(r),e({a:function(t,e,r,n){return{label:"PDF",color:"primary",action:async(r,n,a,l)=>{let u=e&&await I("PDF may contain private data that will require a password to unlock, To access private data choose Secure PDF over Regular PDF",{header:"Security warning",confirmBtnLabel:"Secure PDF",cancelBtnLabel:"Regular PDF"});!function(t){const{filename:e,canHorizontalPageBreak:r,columns:n,rows:a,filters:l,safeMode:u}=t,c=[X(n,u)],d=Z(n,s(a,(null==l?void 0:l.sort)||[]),u),f=u?function(){const t=V().getUser().username;return{encryption:{userPassword:t,ownerPassword:t,userPermissions:["print"]}}}():{},p=new i({...f}),m=p.splitTextToSize(S(e),180),h=m.length<=1?20:10*m.length;p.text(m,14,10);const g={startY:h,head:c,body:d};r&&(g.tableWidth="wrap",g.horizontalPageBreak=!0,g.horizontalPageBreakRepeat=0);o(p,g);const b=`${e}.pdf`;p.save(b)}({rows:n,filters:a,columns:l,filename:t,safeMode:u})}}},e:et,g:function(t,e,r){return{label:"CSV",color:"primary",action:async(n,a,s,i)=>{et({rows:a,filters:s,columns:i,quarter:e,period:r,filename:t})}}}});const T=a(""),Y=a(""),z=a(""),E=n((()=>`${T.value||"-"} / ${Y.value||"-"}`));function L(){T.value=`v${A.version}`,z.value=A.version}async function H(){const t=await Q.get("version");let e=await t.json();Y.value=e["System version"]||"-"}function N(){const[t,e,r]=z.value.split("."),[n,a,s]=Y.value.split(".");return!((parseInt(n)||0)<(parseInt(t)||0))&&(!((parseInt(a)||0)<(parseInt(e)||0))&&!((parseInt(s)||0)<(parseInt(r)||0)))}const{appVersion:W,apiVersion:G}={appVersion:T,apiVersion:Y,minApiVersion:z,fullVersion:E,loadAppVersions:L,loadApiVersion:H,isValidApiVersion:N},{facilityUUID:J}=M();function K(t,e){return e||!1!==t.exportable}function X(t,e=!1){return t.filter((t=>K(t,e))).map((t=>t.label))}function Z(t,e,r=!1){return e.map((e=>t.filter((t=>K(t,r))).map((t=>{let r=C.get(e,t.path,"");return"function"==typeof t.formatter&&r&&(r=t.formatter(r,e)),S(`${t.drillable&&Array.isArray(r)?r.length:r}`)}))))}function tt(t){const{columns:e,rows:r,quarter:n,period:a,filters:i,safeMode:o}=t,u=X(e,o),c=Z(e,s(r,(null==i?void 0:i.sort)||[]),o);let d=u.join(",")+"\n";return d+=c.map((t=>t.join(","))).join("\n"),d+=`\nDate Created:  ${l().format("DD/MMM/YYYY HH:MM:ss")}`,n&&(d+=`\nQuarter: ${n}`),a&&(d+=`\nQuarter: ${a}`),d+=`\ne-Mastercard Version : ${W.value}`,d+=`\nAPI Version ${G.value}`,d+=`\nSite UUID: ${J}`,d}function et(t){const e=new Blob([tt(t)],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=window.URL.createObjectURL(e),r.setAttribute("download",`${t.filename}.csv`),document.body.appendChild(r),r.click(),document.body.removeChild(r)}e("D",O(u({__name:"DrilldownTable",props:{title:{type:String,default:"Drill down table"},rows:{type:Array,required:!0},columns:{type:Array,required:!1},actionButtons:{type:Array},rowActionButtons:{type:Array},config:{type:Object,default:()=>({showSubmitButton:!1})}},setup:t=>(e,r)=>(d(),c(m(_),null,{default:f((()=>[p(m(h),null,{default:f((()=>[p(m(g),null,{default:f((()=>[p(m(b),{slot:"end"},{default:f((()=>[p(m(y),{slot:"end",onClick:r[0]||(r[0]=t=>m(q).hide()),"icon-only":""},{default:f((()=>[p(m(v),{icon:m(D)},null,8,["icon"])])),_:1})])),_:1}),p(m(w),null,{default:f((()=>[$(P(t.title),1)])),_:1})])),_:1})])),_:1}),p(m(j),null,{default:f((()=>[p(m(B),{rows:t.rows,columns:t.columns,config:t.config,"row-actions-buttons":t.rowActionButtons,"actions-buttons":t.actionButtons,color:"light"},null,8,["rows","columns","config","row-actions-buttons","actions-buttons"])])),_:1})])),_:1}))}),[["__scopeId","data-v-dd3e8006"]])),e("L",23);e("R",class{constructor(){t(this,"date",void 0),t(this,"startDate",void 0),t(this,"endDate",void 0),t(this,"programId",void 0),t(this,"useDefaultParams",void 0),this.programId=1,this.date=R(),this.endDate="",this.startDate="",this.useDefaultParams=!0}setDate(t){this.date=U(t)}setStartDate(t){this.startDate=U(t)}setEndDate(t){this.endDate=U(t)}getDateIntervalPeriod(){return this.startDate&&this.endDate?`${k(this.startDate)} - ${k(this.endDate)}`:"-"}buildParams(t){let e={};return this.useDefaultParams&&(e.date=this.date,e.program_id=this.programId),this.startDate&&(e.start_date=this.startDate),this.endDate&&(e.end_date=this.endDate),t&&(e={...e,...t}),e}async getReport(t,e){return(await Q.get(x(t,this.buildParams(e)))).json()}static getReportQuarters(t=5){const e=[];let r=new Date,n=r.getFullYear();r=new Date(`${n}-${r.getMonth()+1}-${r.getDate()} 00:00`);let a=this.getQtrByDate(r).qtr,s=0;for(4===a&&e.push(this.buildQtrObj("Q1",n+1));s<t;)0===s&&a<4&&e.push(this.buildQtrObj(`Q${a+1}`,n)),e.push(this.buildQtrObj(`Q${a}`,n)),a=a>0?a-=1:a,n=0==a?n-1:n,a=0==a?a+=4:a,s++;return e}static getQtrByDate(t){const e=this.getQuarterBounds(t.getFullYear());for(const r in e){const{start:n,end:a}=e[r];if(t>=new Date(n)&&t<=new Date(a))return e[r]}return null}static buildQtrObj(t,e){const r=this.getQuarterBounds(e),{start:n,end:a}=r[t];return{start:n,end:a,name:`${t} ${e}`}}static getQuarterBounds(t){const e=e=>`${t}-${e}-01 00:00`,r=e=>`${t}-${e}-${(e=>l(`${t}-${e}-01`).daysInMonth())(e)} 00:00`;return{Q1:{qtr:1,start:e("01"),end:r("03")},Q2:{qtr:2,start:e("04"),end:r("06")},Q3:{qtr:3,start:e("07"),end:r("09")},Q4:{qtr:4,start:e("10"),end:r("12")}}}async getMaternalStatus(t,e="pepfar"){var r;if(C.isEmpty(t))return{FP:[],FBf:[]};const n=x("vl_maternal_status",this.buildParams({report_definition:e}));return null!==(r=(await F.postJson(n,{patient_ids:t})).data)&&void 0!==r?r:{FP:[],FBf:[]}}async buildMaternityAgreggateRows(t,e="pepfar"){const r=C.uniq(Object.values(t).flat(1).map((t=>t instanceof Object?t.patient_id:t))),n=Object.keys(t),a=await this.getMaternalStatus(r,e),s=a.FBf.concat(a.FP);return["FP","FNP","FBf"].map((e=>n.reduce(((r,n)=>({[n]:t[n].filter((t=>{const r=t instanceof Object?t.patient_id:t;return"FNP"===e?!s.includes(r):a[e].includes(r)})),...r})),{ageGroup:"All",gender:e})))}})}}}))}();

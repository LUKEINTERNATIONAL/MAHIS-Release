System.register(["./index-legacy-D8VDxbcK.js","./appointment_service-legacy-DIHfxziS.js","./vendor-legacy-COMGl7lq.js","./clinicalDaysStore-legacy-DTFMw3Yf.js","./lodash-legacy-C-x9g9Na.js","./app_encounter_service-legacy-CRpl_PwT.js"],(function(e,t){"use strict";var a,n,i,l,o,u,s,d,r,c,v,p,m,y,f,g,b,A,h,D,S,w,_,k,L,O,x,C,Y,j,N,I,H,M,P,R,V,E,T;return{setters:[e=>{a=e.P,n=e.m,i=e.ad,l=e.k,o=e.I,u=e.cw,s=e.S,d=e.s,r=e._},e=>{c=e.A},e=>{v=e.d,p=e.r,m=e.c,y=e.a,f=e.y,g=e.f,b=e.z,A=e.e,h=e.m,D=e.l,S=e.k,w=e.F,_=e.L,k=e.u,L=e.db,O=e.A,x=e.B,C=e.ad,Y=e.bq,j=e.ac,N=e.ab,I=e.aA,H=e.an,M=e.G,P=e.D,R=e.ag,V=e.O},e=>{E=e.u,T=e.s},null,null],execute:function(){var t=document.createElement("style");t.textContent="ion-datetime[data-v-cfd9bf61]{--background: #ffffff;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.1)}[data-v-cfd9bf61] .calendar-day{font-weight:500}.warning-section[data-v-cfd9bf61]{margin-bottom:15px;padding:10px;border-radius:5px;background-color:rgba(255,0,0,.05)}.warning-section ion-note[data-v-cfd9bf61]{display:block;margin-bottom:5px;font-weight:500}\n/*$vite$:1*/",document.head.appendChild(t);const z={key:0,class:"section-header ion-text-left",style:{"margin-bottom":"10px"}},$={class:"ion-padding"},B={key:0,style:{"font-style":"italic"}},F={key:1};e("default",r(v({__name:"ARTAppointment",setup(e,{expose:t}){const r=new a,v=new c(r.getID(),-1),U=p({}),q=p([]),G=p([]),W=p(!1),J=m((()=>Object.values(U.value).some((e=>""!==e)))),K=p({medicationRunOut:{label:"Drug runout",val:"...",formattedValue:"",isLoading:!1,apiObj:{}},userSetAppointment:{label:"Selected date",val:"",formattedValue:"",isLoading:!1},bookedAppointments:{label:"Booked Appointment",val:"",isLoading:!1,limitCache:{}},appointmentLimit:{label:"Appointment limit",val:"",isLoading:!1},clinicDays:{label:"Is clinic day?",val:"No",isLoading:!1},clinicHolidays:{label:"Is holiday?",val:"No",isLoading:!1}}),Q={clinicHolidays:{init:async()=>{U.value.clinicDays="";const e=E(),t=d();0===e.getHolidaydatesDataSize()&&(await t.loadHolidayDateProperty(),T()),G.value=e.getHolidaydates(),K.value.userSetAppointment.val&&ae(K.value.userSetAppointment.val)},onDateChange:async e=>{U.value.clinicHolidays="",K.value.clinicHolidays.val="No",Z(e)&&(U.value.clinicHolidays="Selected date is a clinic holiday",K.value.clinicHolidays.val="Yes")}},clinicDays:{init:async()=>{U.value.clinicDays="";const e=r.getAge()>18?u.ADULT_CLINIC_DAYS:u.PEADS_CLINIC_DAYS;o.get(e).then((e=>{e&&(q.value=e.split(",").map((e=>e.trim()))),K.value.userSetAppointment.val&&ae(K.value.userSetAppointment.val)})).catch((e=>{console.error(e),U.value.clinicDays="Failed to load clinic days"}))},onDateChange:async e=>{U.value.clinicDays="",K.value.clinicDays.val="Yes",Z(e)?K.value.clinicDays.val="No":X(e)||(K.value.clinicDays.val="No",U.value.clinicDays="Selected date is not a clinic day")}},userSetAppointment:{validate:()=>(U.value.userSetAppointment="",K.value.userSetAppointment.val?!(K.value.bookedAppointments.val>=K.value.appointmentLimit.val&&(U.value.userSetAppointment="Appointment limit reached",1)):(U.value.userSetAppointment="Appointment date is required",!1)),buildObs:()=>v.buildValueDate("Appointment date",K.value.userSetAppointment.val),onDateChange:async e=>{K.value.userSetAppointment.val=e,K.value.userSetAppointment.formattedValue=V(K.value.userSetAppointment.val).format("DD/MMM/YYYY")}},bookedAppointments:{onDateChange:async e=>{U.value.bookedAppointments="";let t=0;if(K.value.bookedAppointments.limitCache[e])t=K.value.bookedAppointments.limitCache[e];else{const a=await c.getDailiyAppointments(e);a.length&&(K.value.bookedAppointments.limitCache[e]=a.length,t=a.length)}K.value.bookedAppointments.val=t,K.value.appointmentLimit.val>1&&t>=K.value.appointmentLimit.val&&(U.value.bookedAppointments="Appointment limit reached")}},medicationRunOut:{init:async()=>{ae(s.getSessionDate()),U.value.medicationRunOut="";try{const e=await v.getNextAppointment();e&&(ae(e.appointment_date),K.value.medicationRunOut.apiObj=e,K.value.medicationRunOut.formattedValue=V(e.drugs_run_out_date).format("DD/MMM/YYYY"))}catch(e){U.value.medicationRunOut="No medication runout date found for this patient",K.value.medicationRunOut.formattedValue="N/A",console.log(e)}},buildObs:()=>{var e;const t=K.value.medicationRunOut.apiObj;return v.buildValueDate("Estimated date",null!==(e=t.nextAppointment)&&void 0!==e?e:v.date)}},appointmentLimit:{init:async()=>{var e;K.value.appointmentLimit.val=null!==(e=await o.get(u.APPOINTMENT_LIMIT))&&void 0!==e?e:"N/A"}}};function X(e){const t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date(e).getDay()];return q.value.some((e=>e.trim().toLowerCase()===t.toLowerCase()))}function Z(e){return new RegExp(e,"i").test(G.value)}const ee=e=>{if(!X(e)||Z(e))return{textColor:"#ff0000",backgroundColor:"rgba(255, 0, 0, 0.08)"}},te=e=>{var t;const a=new Date(e);a.setHours(0,0,0,0);const n=new Date(v.date);n.setHours(0,0,0,0);const i=null===(t=K.value.medicationRunOut.apiObj)||void 0===t?void 0:t.drugs_run_out_date;if(i){const e=new Date(i);return e.setHours(0,0,0,0),a>=n&&a<=e}return a>=n};function ae(e){const t=V(e).format("YYYY-MM-DD");Object.keys(Q).forEach((e=>{var a;"function"==typeof(null==Q||null===(a=Q[e])||void 0===a?void 0:a.onDateChange)&&(K.value[e].isLoading=!0,Q[e].onDateChange(t).finally((()=>K.value[e].isLoading=!1)))}))}return y((()=>async function(){const e=Object.keys(Q).map((e=>{var t;return"function"==typeof(null===(t=Q[e])||void 0===t?void 0:t.init)?(K.value[e].isLoading=!0,Q[e].init().catch((t=>{K.value[e].val="Error loading data...",console.error(t)})).finally((()=>K.value[e].isLoading=!1))):Promise.resolve()}));Promise.all(e).then((()=>W.value=!0))}())),t({onSubmit:async function(){if(!W.value)return n("Please wait for all data to load before submitting"),!1;if(!function(){for(const t in Q){var e;if("function"==typeof(null===(e=Q[t])||void 0===e?void 0:e.validate)&&!Q[t].validate())return!1}return!0}())return n("Please fix the validation errors before submitting"),!1;if(Object.keys(U.value).some((e=>""!==U.value[e]))&&!(await i("Are you sure you want to submit with current warnings?")))return!1;const e=await Promise.all(Object.keys(Q).map((e=>{var t;return"function"==typeof(null==Q||null===(t=Q[e])||void 0===t?void 0:t.buildObs)?Q[e].buildObs():null})).filter(Boolean));if(!e.length)return n("No observations to save"),!1;try{return await v.createEncounter(),await v.saveObservationList(e),l("Appointment saved!"),!0}catch(t){return n("Error has occured while saving observations"),console.error(t),!1}}}),(e,t)=>(g(),f(k(R),null,{default:b((()=>[J.value?(g(),A("span",z,[S("div",$,[(g(!0),A(w,null,_(U.value,((e,t)=>(g(),A(w,{key:t},[e?(g(),f(k(L),{key:0,style:{background:"red","font-weight":"bold"}},{default:b((()=>[O(x(e),1)])),_:2},1024)):h("",!0)],64)))),128))]),t[2]||(t[2]=S("hr",{style:{"border-top":"1px dashed #0c0c0c","margin-top":"10px"}},null,-1))])):h("",!0),D(k(C),null,{default:b((()=>[D(k(Y),null,{default:b((()=>[D(k(j),null,{default:b((()=>[D(k(N),{"size-sm":"12","size-md":"7"},{default:b((()=>[(g(),f(k(I),{presentation:"date",size:"cover",locale:"en-US",modelValue:K.value.userSetAppointment.val,"onUpdate:modelValue":t[0]||(t[0]=e=>K.value.userSetAppointment.val=e),onIonChange:t[1]||(t[1]=e=>{var t,a;return ae(null!==(t=null==e||null===(a=e.detail)||void 0===a?void 0:a.value)&&void 0!==t?t:"".split("T")[0])}),highlightedDates:ee,isDateEnabled:te,key:`${q.value.length}-${K.value.userSetAppointment.val}`},null,8,["modelValue"]))])),_:1}),D(k(N),{"size-sm":"12","size-md":"5"},{default:b((()=>[D(k(H),null,{default:b((()=>[(g(!0),A(w,null,_(K.value,((e,t)=>(g(),f(k(M),{key:t},{default:b((()=>{var t;return[D(k(P),null,{default:b((()=>[O(x(e.label)+": ",1)])),_:2},1024),e.isLoading?(g(),A("span",B," Please wait... ")):(g(),A("span",F,x(null!==(t=e.formattedValue)&&void 0!==t?t:e.val),1))]})),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}))}}),[["__scopeId","data-v-cfd9bf61"]]))}}}));

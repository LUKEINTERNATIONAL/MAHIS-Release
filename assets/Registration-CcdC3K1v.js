var qe=Object.defineProperty;var We=(n,e,t)=>e in n?qe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ce=(n,e,t)=>We(n,typeof e!="symbol"?e+"":e,t);import{d as A,W as R,I as ge,G as be,ac as De,ab as Fe,dk as we,aa as Se,dv as fe,D as ke,X as Z,E as k,e as x,f,m as L,l as u,k as h,z as m,A as P,F as ee,r as N,c as w,y as H,u as g,B as C,L as Te,O as Ue,cl as ze,w as Je,b2 as Ve,a as Pe,cm as je,au as Ie,bM as Re,S as Xe,a9 as Ze,i as U,v as z,V as Ke,p as me,af as Qe}from"./vendor-Oa4k5SKv.js";import{i as F,D as et,_ as oe,ar as D,as as G,H as J,S as V,C as Ce,b6 as tt,n as nt,J as at,g as Ne,P as it,u as se,a8 as j,m as ot,ax as _e,k as pe,at as st,b as rt,b7 as lt,M as ut,t as he,F as ve}from"./index-CBPAnuci.js";import{u as te}from"./useLocation-CGTBdEyC.js";import{u as q}from"./useExposeFromStandardForm-DyzqmNZh.js";import{g as dt}from"./vaccines_service-gD6urqWg.js";const ct=A({components:{IonLabel:ke,IonAvatar:fe,IonRow:Se,IonImg:we,IonCol:Fe,IonList:De,IonItem:be,IonIcon:ge,IonButton:R,DynamicButton:et},data:()=>({selectedResult:{},iconsContent:F,isAnyAccordionOpen:!0,isLoading:!1}),methods:{dismiss(n){Z.dismiss(n)}}}),mt={key:0,class:"spinner-overlay"};function _t(n,e,t,i,a,o){const s=k("ion-spinner"),d=k("ion-title"),c=k("ion-icon"),l=k("ion-header"),b=k("center"),r=k("ion-content"),y=k("DynamicButton"),E=k("ion-col"),$=k("ion-row"),T=k("ion-footer");return f(),x(ee,null,[n.isLoading?(f(),x("div",mt,[u(s,{name:"bubbles"}),e[3]||(e[3]=h("div",{class:"loading-text"},"Please wait...",-1))])):L("",!0),u(l,{style:{display:"flex","justify-content":"space-between"}},{default:m(()=>[u(d,{class:"modalTitle"},{default:m(()=>e[4]||(e[4]=[P("Printer")])),_:1,__:[4]}),u(c,{onClick:e[0]||(e[0]=B=>n.dismiss("dismiss")),style:{"padding-top":"10px","padding-right":"10px"},icon:n.iconsContent.cancel},null,8,["icon"])]),_:1}),u(r,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:m(()=>[u(b,null,{default:m(()=>e[5]||(e[5]=[h("h3",{class:"ion-padding"},"Do you want to print a barcode?",-1)])),_:1,__:[5]})]),_:1}),u(T,null,{default:m(()=>[u($,null,{default:m(()=>[u(E,null,{default:m(()=>[u(y,{color:"danger",onClick:e[1]||(e[1]=B=>n.dismiss("dismiss")),name:"No",fill:"solid",style:{float:"right","margin-right":"2%",width:"100px"}}),u(y,{onClick:e[2]||(e[2]=B=>n.dismiss("Yes")),name:"Yes",fill:"solid",style:{float:"right","margin-right":"2%",width:"100px"}})]),_:1})]),_:1})]),_:1})],64)}const pt=oe(ct,[["render",_t]]),ht=n=>{const e=N(!1),{getDistricts:t,districtList:i,selectedTraditionalAuthorityId:a,villages:o,selectedDistrictId:s,TAs:d}=te();return t(),{currentLocation:w(()=>[{componentType:"Heading",name:"Current Location",position:"center"},{componentType:"multiSelectInputField",header:"Current district",name:"current_district",trackBy:"district_id",validation:l=>D.required(l),icon:F.search,options:i.value,onChange:(l,b)=>{n!=null&&n.value&&(n.value.setFormValue("current_traditional_authority",[]),n.value.setFormValue("current_village",[])),s.value=(l==null?void 0:l.district_id)||null}},{componentType:"multiSelectInputField",header:"Current traditional authority",name:"current_traditional_authority",trackBy:"traditional_authority_id",validation:l=>D.required(l),icon:F.search,options:d.value,disabled:l=>{var b;return!((b=d==null?void 0:d.value)!=null&&b.length)},onChange:(l,b)=>{var r;n!=null&&n.value&&((r=n==null?void 0:n.value)==null||r.setFormValue("current_village",[])),a.value=(l==null?void 0:l.traditional_authority_id)||null}},{componentType:"multiSelectInputField",header:"Current village",name:"current_village",trackBy:"village_id",icon:F.search,validation:l=>D.required(l),options:o.value,disabled:l=>{var b;return console.log("ðŸš€ ~ currentLocation ~ data:",l),!((b=o==null?void 0:o.value)!=null&&b.length)}},{componentType:"multiSelectInputField",header:"Closest landmark/Plot number",name:"closestLandmark",trackBy:"id",icon:F.search,options:[{id:1,name:"Church"},{id:2,name:"Mosque"},{id:3,name:"Primary School"},{id:4,name:"Borehole"},{id:5,name:"Secondary School"},{id:6,name:"College"},{id:7,name:"Market"},{id:8,name:"Football Ground"},{id:9,name:"Other"}]}]),TAs:d,isLoadingTAs:e,selectedDistrictId:s}},vt=A({__name:"CurrentLocation",setup(n,{expose:e}){const{formRef:t,exposeFormMethods:i}=q(),{currentLocation:a}=ht(t);return e(i()),(o,s)=>(f(),H(G,{formData:g(a),ref_key:"formRef",ref:t},null,8,["formData"]))}}),yt=(n,e)=>{if(!(n!=null&&n.value)||!(e!=null&&e.value))return;const{current_district:t,current_traditional_authority:i,current_village:a}=n.value;e.value.setFormValue("home_district",t),e.value.setFormValue("home_traditional_authority",i),e.value.setFormValue("home_village",a)},gt=n=>{n!=null&&n.value&&(n.value.setFormValue("home_district",[]),n.value.setFormValue("home_traditional_authority",[]),n.value.setFormValue("home_village",[]))},bt=(n,e,t)=>{e.value=(n==null?void 0:n.district_id)||null,t!=null&&t.value&&(t.value.setFormValue("home_traditional_authority",[]),t.value.setFormValue("home_village",[]))},Dt=(n,e,t)=>{var i;e.value=(n==null?void 0:n.traditional_authority_id)||null,(i=t==null?void 0:t.value)==null||i.setFormValue("home_village",[])},ye=(n,e)=>n!=null&&n.same_as_current?!1:!(e!=null&&e.length),Ft=(n,e)=>t=>{setTimeout(()=>{t?yt(n,e):gt(e)},0)},wt=(n,e)=>{const{getDistricts:t,districtList:i,selectedTraditionalAuthorityId:a,villages:o,selectedDistrictId:s,TAs:d}=te();return t(),{homeLocation:w(()=>[{componentType:"Heading",name:"Home Location",position:"center"},{componentType:"checkboxField",type:"single",name:"same_as_current",label:"Same as current",onChange:Ft(n,e)},{componentType:"multiSelectInputField",header:"Home district",name:"home_district",trackBy:"district_id",icon:F.search,validation:D.required,options:i.value,onChange:l=>bt(l,s,e)},{componentType:"multiSelectInputField",header:"Home traditional authority",name:"home_traditional_authority",trackBy:"traditional_authority_id",validation:D.required,icon:F.search,options:d.value,disabled:l=>ye(l,d.value),onChange:l=>Dt(l,a,e),openDirection:"auto"},{componentType:"multiSelectInputField",header:"Home village",name:"home_village",trackBy:"village_id",icon:F.search,validation:D.required,options:o.value,disabled:l=>ye(l,o.value),openDirection:"auto"}])}},St=A({__name:"HomeLocation",props:{currentLocationFormValues:{}},setup(n,{expose:e}){const t=n,{formRef:i,exposeFormMethods:a}=q(),o=w(()=>t.currentLocationFormValues),{homeLocation:s}=wt(o,i);return e(a()),(d,c)=>(f(),H(G,{formData:g(s),ref_key:"formRef",ref:i},null,8,["formData"]))}}),ft=()=>{const{countriesList:n,getCountries:e}=te();return e(),{country:w(()=>[{componentType:"Heading",name:"Country",position:"center"},{componentType:"multiSelectInputField",header:"Country",name:"country",trackBy:"district_id",openDirection:"auto",icon:F.search,validation:i=>D.required(i),options:n.value}])}},kt=A({__name:"Country",setup(n,{expose:e}){const{country:t}=ft(),{formRef:i,exposeFormMethods:a}=q();return e(a()),(o,s)=>(f(),H(G,{formData:g(t),ref_key:"formRef",ref:i},null,8,["formData"]))}}),Tt=()=>{function n(t,i){const a=new Date(t);return a.setFullYear(a.getFullYear()-i),a.toISOString().split("T")[0]}return{personalInformation:w(()=>[{componentType:"Heading",name:"Personal Information",position:"center"},{componentType:"inputField",header:"National ID",name:"nationalID",placeholder:"__-__-__-__",icon:F.nationalID,validation:t=>D.isMWNationalID(t)},{componentType:"inputField",header:"First name",name:"firstname",icon:F.fullName,validation:t=>D.isName(t)},{componentType:"inputField",header:"Middle name",name:"middleName",icon:F.fullName,validation:t=>D.isNamesEmpty(t)},{componentType:"inputField",header:"Last name",name:"lastname",icon:F.fullName,validation:t=>D.isName(t)},{componentType:"radioButtonField",header:"Gender",name:"gender",type:"inline",validation:t=>D.required(t),options:[{label:"Male",value:"M"},{label:"Female",value:"F"}]},{componentType:"dateInputField",header:"Date of birth",name:"birthdate",icon:F.calenderPrimary,minDate:n(J.sessionDate(),110),validation:t=>D.required(t),condition:t=>!t.Estimate,disabled:t=>t.Estimate},{componentType:"inputField",header:"Estimated age",name:"estimation",icon:F.time,validation:t=>D.isEstimationDate(t),initialUnit:"Years",unitOptions:[{label:"Days",value:"Days"},{label:"Months",value:"Months"},{label:"Years",value:"Years"}],unitValidation:t=>!t||t===""?"Please select a unit.":null,condition:t=>t.Estimate},{componentType:"checkboxField",name:"Estimate",type:"single",label:"Estimate age"},{componentType:"phoneInputField",name:"Phone Number",header:"Phone Number",validation:t=>D.isMWPhoneNumber(t.phoneNumber)}])}},Vt=A({__name:"PersonalInformation",setup(n,{expose:e}){const{personalInformation:t}=Tt(),{formRef:i,exposeFormMethods:a}=q();return e(a()),(o,s)=>(f(),H(G,{formData:g(t),ref_key:"formRef",ref:i},null,8,["formData"]))}}),Pt=A({components:{IonLabel:ke,IonAvatar:fe,IonRow:Se,IonImg:we,IonCol:Fe,IonList:De,IonItem:be,IonIcon:ge,IonButton:R},data:()=>({selectedResult:{},iconsContent:F,isAnyAccordionOpen:!0,isLoading:!1}),methods:{updateAccordionState(n){const e=this.$refs.accordionGroup;this.isAnyAccordionOpen=e.value!==void 0},dismiss(n){Z.dismiss(n)},async init(){this.setData(this.deduplicationData[0]||{})},async onSelect(){Z.dismiss(this.selectedResult)},setData(n){this.selectedResult=n},dateFormat(n){return J.toStandardHisDisplayFormat(n)},probabilityToPercentage(n){return(n*100).toFixed(2)+"%"}},props:{deduplicationData:{default:[]},to_be_registered:{default:[]}},mounted(){this.init()},activated(){this.init()}}),Ct={key:0,class:"spinner-overlay"},Nt={class:"header position_content"},Bt={style:{"font-size":"1.2em","font-weight":"700"}},Mt={class:"due_date"},Et={class:"ion-padding",slot:"content"},$t={style:{display:"flex","justify-content":"end",gap:"10px"}};function xt(n,e,t,i,a,o){const s=k("ion-spinner"),d=k("ion-icon"),c=k("ion-header"),l=k("ion-label"),b=k("ion-item"),r=k("ion-col"),y=k("ion-row"),E=k("ion-accordion"),$=k("ion-accordion-group"),T=k("ion-content"),B=k("ion-button"),Y=k("ion-footer");return f(),x(ee,null,[n.isLoading?(f(),x("div",Ct,[u(s,{name:"bubbles"}),e[3]||(e[3]=h("div",{class:"loading-text"},"Please wait...",-1))])):L("",!0),u(c,null,{default:m(()=>[h("div",Nt,[h("div",{style:{display:"flex","align-items":"center"},onClick:e[0]||(e[0]=p=>n.dismiss("back"))},[u(d,{slot:"separator",size:"large",icon:n.iconsContent.arrowLeft},null,8,["icon"])]),h("div",Bt,"Matches found: ("+C(n.deduplicationData.length)+")",1)])]),_:1}),u(T,{fullscreen:!0,class:"ion-padding",style:{"--background":"#fff"}},{default:m(()=>[u($,{ref:"accordionGroup",class:"previousView",value:"0",onIonChange:n.updateAccordionState},{default:m(()=>[(f(!0),x(ee,null,Te(n.deduplicationData,(p,W)=>(f(),H(E,{style:{"margin-bottom":"15px"},value:W,"toggle-icon-slot":"start",class:"custom_card",button:"",key:W,detail:!0,color:p.value===n.selectedResult.value?"light":"",onClick:_=>n.setData(p)},{default:m(()=>[u(b,{slot:"header"},{default:m(()=>[u(l,{class:"previousLabel"},{default:m(()=>{var _,M;return[P(C((_=p==null?void 0:p.person)==null?void 0:_.given_name)+" "+C((M=p==null?void 0:p.person)==null?void 0:M.family_name),1)]}),_:2},1024),h("div",Mt,[e[4]||(e[4]=P(" Score: ")),h("b",null,C(n.probabilityToPercentage(p==null?void 0:p.score)||"-"),1)])]),_:2},1024),h("div",Et,[u(y,null,{default:m(()=>[u(r,null,{default:m(()=>e[5]||(e[5]=[h("b",null,"To be Registered",-1)])),_:1,__:[5]}),u(r,null,{default:m(()=>e[6]||(e[6]=[h("b",null,"Already Registered",-1)])),_:1,__:[6]})]),_:1}),u(y,null,{default:m(()=>[u(r,null,{default:m(()=>[u(y,null,{default:m(()=>{var _,M;return[e[7]||(e[7]=P(" Name: ")),h("b",null,C((_=n.to_be_registered)==null?void 0:_.given_name)+" "+C((M=n.to_be_registered)==null?void 0:M.family_name),1)]}),_:1,__:[7]}),u(y,null,{default:m(()=>{var _;return[e[8]||(e[8]=P("Gender: ")),h("b",null,C((_=n.to_be_registered)==null?void 0:_.gender),1)]}),_:1,__:[8]}),u(y,null,{default:m(()=>{var _;return[e[9]||(e[9]=P("Birthdate: ")),h("b",null,C((_=n.to_be_registered)==null?void 0:_.birthdate),1)]}),_:1,__:[9]}),u(y,null,{default:m(()=>{var _;return[e[10]||(e[10]=P("Home District: ")),h("b",null,C((_=n.to_be_registered)==null?void 0:_.home_district),1)]}),_:1,__:[10]}),u(y,null,{default:m(()=>{var _;return[e[11]||(e[11]=P("Home TA: ")),h("b",null,C((_=n.to_be_registered)==null?void 0:_.home_traditional_authority),1)]}),_:1,__:[11]})]),_:1}),u(r,null,{default:m(()=>[u(y,null,{default:m(()=>{var _,M;return[e[12]||(e[12]=P(" Name: ")),h("b",null,C((_=p==null?void 0:p.person)==null?void 0:_.given_name)+" "+C((M=p==null?void 0:p.person)==null?void 0:M.family_name),1)]}),_:2,__:[12]},1024),u(y,null,{default:m(()=>{var _;return[e[13]||(e[13]=P("Gender: ")),h("b",null,C((_=p==null?void 0:p.person)==null?void 0:_.gender),1)]}),_:2,__:[13]},1024),u(y,null,{default:m(()=>{var _;return[e[14]||(e[14]=P("Birthdate: ")),h("b",null,C(n.dateFormat((_=p==null?void 0:p.person)==null?void 0:_.birthdate)),1)]}),_:2,__:[14]},1024),u(y,null,{default:m(()=>{var _;return[e[15]||(e[15]=P("Home District: ")),h("b",null,C((_=p==null?void 0:p.person)==null?void 0:_.home_district),1)]}),_:2,__:[15]},1024),u(y,null,{default:m(()=>{var _;return[e[16]||(e[16]=P("Home TA: ")),h("b",null,C((_=p==null?void 0:p.person)==null?void 0:_.home_traditional_authority),1)]}),_:2,__:[16]},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["value","color","onClick"]))),128))]),_:1},8,["onIonChange"])]),_:1}),u(Y,{collapse:"fade",class:"ion-no-border"},{default:m(()=>[h("div",$t,[u(B,{fill:"solid",color:"secondary",onClick:e[1]||(e[1]=p=>n.dismiss("dismiss"))},{default:m(()=>e[17]||(e[17]=[P(" Not Duplicate ")])),_:1,__:[17]}),u(B,{onClick:e[2]||(e[2]=p=>n.onSelect()),fill:"solid",disabled:!n.isAnyAccordionOpen},{default:m(()=>e[18]||(e[18]=[P("Select ")])),_:1,__:[18]},8,["disabled"])])]),_:1})],64)}const Ot=oe(Pt,[["render",xt],["__scopeId","data-v-ffb46cdd"]]),Ht=nt();class ie{async getDDEIds(){const e=V.getUseIndexDBStatus(),t=V.getModsStatus(),i=V.getAPIStatus();if(e)return await Ce("dde");if(t){const a=await tt();return(a==null?void 0:a.npid)||[]}if(i)try{const a=await V.getJson("/dde/patients/sync_npids",{count:1,program_id:V.getProgramID()});return(a==null?void 0:a.npids)||[]}catch(a){return[]}return[]}async updateDDEIds(e){e=e.slice(1),Ht.postData("OVERRIDE_OBJECT_STORE",{storeName:"dde",data:e})}async possibleDuplicates(e){var t;try{const i=new at,a=await i.checkPotentialDuplicates(e);if(a.length>0){const o=await Ne(Ot,{class:"fullScreenModal"},!0,{to_be_registered:e,deduplicationData:a});if(o!="dismiss"&&o!="back"){const s=await i.importPatient((t=o==null?void 0:o.person)==null?void 0:t.id),d=await it.findByID(s.patient_id);return await se().setPatientRecord(d),!0}else if(o=="back")return!0;return!1}else return!1}catch(i){return!1}}}class At{getRegion(e){return{1:"Central Region",2:"Northern Region",3:"Southern Region",4:"Foreign"}[e]}hasValidData(e,t=[]){return!e||typeof e!="object"?!1:t.length===0?Object.values(e).some(i=>i!=null&&i!==""):t.every(i=>e[i]!==null&&e[i]!==void 0&&e[i]!=="")}async buildObservation(e,t){if(!t)return null;const i=typeof t=="object"&&t.name?t.name:t;return await j.buildValueText(e,i)}buildGuardianInfo(e){const t={};return t.given_name=(e==null?void 0:e.guardianFirstname)||"",t.middle_name=(e==null?void 0:e.guardianMiddleName)||"",t.family_name=(e==null?void 0:e.guardianLastname)||"",t.cell_phone_number=(e==null?void 0:e.guardianPhoneNumber.phoneNumber)||"",t.national_id=(e==null?void 0:e.guardianNationalID)||"",t.gender="",t.birthdate="",t.birthdate_estimated="false",t.home_region="",t.home_district="",t.home_traditional_authority="",t.home_village="",t.current_region="",t.current_district="",t.current_traditional_authority="",t.current_village="",t.landmark="",{saved:[],unsaved:[t]}}async buildVitals(e){return e!=null&&e.Weight?{saved:[],unsaved:[await this.buildObservation("Weight",e.Weight)]}:null}async buildARTPatientType(e,t){const i=[];let a=[];return e&&i.push(await j.buildValueText("Art clinic location",e)),t&&i.push(await j.buildValueCoded("Type of patient",t)),i.length===0?[]:(a=[{encounter_type:"REGISTRATION",status:"unsaved",obs:i}],a)}async buildBirthRegistrationObservations(e){if(!this.hasValidData(e))return null;const i=(await Promise.all([this.buildObservation("How many doses of Tdv did the mother receive?",e["How many doses of Tdv did the mother receive?"]),this.buildObservation("Protected at birth",e["Protected at birth"]),this.buildObservation("HIV status",e["HIV status"])])).filter(a=>a!==null);return i.length>0?i:null}async buildPatientRecord(e,t,i=""){var r,y,E,$,T,B,Y,p,W,_,M,K,I;const{personalInformation:a,currentLocation:o,homeLocation:s,birthRegistration:d,guardianInformation:c,socialHistory:l,patientType:b}=e;return{patientID:i||t||"",ID:t||"",NcdID:"",personInformation:{given_name:(a==null?void 0:a.firstname)||"",middle_name:(a==null?void 0:a.middleName)||"",family_name:(a==null?void 0:a.lastname)||"",gender:(a==null?void 0:a.gender)||"",birthdate:a!=null&&a.Estimate?new X().calculateDoB(a==null?void 0:a.estimation,(a==null?void 0:a.estimation_unit)||"Years"):(a==null?void 0:a.birthdate)||"",birthdate_estimated:a!=null&&a.Estimate?"true":"false",home_region:this.getRegion((r=s==null?void 0:s.home_district)==null?void 0:r.region_id)||"",home_district:((y=s==null?void 0:s.home_district)==null?void 0:y.name)||"",home_traditional_authority:((E=s==null?void 0:s.home_traditional_authority)==null?void 0:E.name)||"",home_village:(($=s==null?void 0:s.home_village)==null?void 0:$.name)||"",current_region:this.getRegion((T=o==null?void 0:o.current_district)==null?void 0:T.region_id)||"",current_district:((B=o==null?void 0:o.current_district)==null?void 0:B.name)||"",current_traditional_authority:((Y=o==null?void 0:o.current_traditional_authority)==null?void 0:Y.name)||"",current_village:((p=o==null?void 0:o.current_village)==null?void 0:p.name)||"",country:(e==null?void 0:e.country.country.name)||"",landmark:((W=o==null?void 0:o.closestLandmark)==null?void 0:W.name)||"",cell_phone_number:((_=a["Phone Number"])==null?void 0:_.phoneNumber)||"",occupation:(l==null?void 0:l.occupation)||"",marital_status:(l==null?void 0:l.maritalStatus)||"",religion:((M=l==null?void 0:l.religion)==null?void 0:M.name)||"",education_level:(l==null?void 0:l.highestLevelOfEducation)||""},guardianInformation:this.buildGuardianInfo(c),birthRegistration:await this.buildBirthRegistrationObservations(d),otherPersonInformation:{nationalID:(a==null?void 0:a.nationalID)||"",ichisID:V.getIchisId()||"",TEI:V.getTEI()||"",birthID:d["Serial Number"]||"",relationshipID:((K=c==null?void 0:c.relationship)==null?void 0:K.id)||""},vitals:await this.buildVitals(d),vaccineSchedule:await dt(a==null?void 0:a.gender,a==null?void 0:a.birthdate),vaccineAdministration:{orders:[],obs:[],voided:[]},observations:await this.buildARTPatientType((I=b==null?void 0:b.facility)==null?void 0:I.name,b==null?void 0:b.patient_type),appointments:{saved:[],unsaved:[]},saveStatusPersonInformation:"pending",saveStatusGuardianInformation:"pending",saveStatusBirthRegistration:"pending",saveStatusVitals:"pending",date_created:"",creator:"",sync_status:"unsynced"}}}const Lt=async n=>{const e=V.getIchisDiagnosis();if(e.length<=0)return n;const t=await Promise.all(e.map(async i=>{var s,d,c;const a=((d=(s=i==null?void 0:i.value)==null?void 0:s.match(/[\d.]+/))==null?void 0:d[0])||"",o=i==null?void 0:i.date;if(i.display=="NCD_CV_D_Likelihood of Diabetes"){const l=(c=i==null?void 0:i.id)==null?void 0:c.split("-");return await j.buildValueNumber("Unspecified Diabetes",a,null,null,o,l[1])}if(i.display=="NCD_SHD_CV_Client waist circumference")return await j.buildValueNumber("Waist circumference",a,null,null,o);if(i.display=="NCD_SHD_CV_Client systolic blood pressure")return await j.buildValueNumber("Systolic",a,null,null,o);if(i.display=="NCD_SHD_CV_Client diastolic blood pressure")return await j.buildValueNumber("Diastolic",a,null,null,o)}));return n.observations.push({encounter_type:"VITALS",status:"unsaved",obs:t}),n};class X extends V{constructor(){super();ce(this,"patientRecordBuilder");this.patientRecordBuilder=new At}async saveRegistrationData(t){var o;const i=await new ie().getDDEIds();if(i.length<=0&&ot("DDE IDs are not available."),i.length<=0&&!V.getAPIStatus())return!1;let a=await this.patientRecordBuilder.buildPatientRecord(t,(o=i[0])==null?void 0:o.npid);return V.getProgramID()==32&&(a=await Lt(a)),V.getAPIStatus()&&!V.getModsStatus()&&await new ie().possibleDuplicates(a.personInformation)?!0:await _e(a)?(pe("Registration successful"),sessionStorage.setItem("ichis_diagnosis",JSON.stringify([])),V.getUseIndexDBStatus()&&await new ie().updateDDEIds(i),await this.printBarcode(),!0):!1}async updateDemographics(t){let i=await this.patientRecordBuilder.buildPatientRecord(t,V.getNationalID(),V.getPatientID());return i.saveStatusPersonInformation="edit",i.saveStatusGuardianInformation="edit",i.saveStatusBirthRegistration="edit",i.saveStatusVitals="edit",await _e(i)?(pe("Updated successful"),!0):!1}checkIfChild(t){if(!(t!=null&&t.estimation)&&!(t!=null&&t.birthdate))return{moreThanThirteenYears:!0,underNineMonths:!1,underFiveYears:!1};let i="";return t.estimation?i=this.calculateDoB(t.estimation,t.estimation_unit||"Years")||"":i=t.birthdate,{moreThanThirteenYears:J.getAgeInYears(i)>13,underNineMonths:J.ageInMonths(i)<9,underFiveYears:J.getAgeInYears(i)<5}}async printBarcode(){await Ne(pt,{class:"small-confirm-modal "})!=="dismiss"&&new st().printData("barcode")}calculateDoB(t,i){try{let a=Ue(V.getSessionDate());if(i==="Years"&&t<0)a=a.add(Math.abs(t),"years");else switch(i){case"Days":a=a.subtract(t,"days");break;case"Months":a=a.subtract(t,"months");break;case"Years":a=a.subtract(t,"years");break;default:return null}return J.toStandardHisDisplayFormat(a.format("YYYY-MM-DD"))||""}catch(a){return console.error("Error calculating date:",a),null}}}function Yt(){const n=N([]),e=N([]),t=N([]),i=rt();ze();const a=w(()=>i.apiStatus),o=d=>{var r;const c=["Brother","Father","Son","Grandfather","Grandson","Boyfriend","Stepfather","Stepson"],l=["Sister","Mother","Daughter","Grandmother","Granddaughter","Girlfriend","Stepmother","Stepdaughter"],b=["Spouse/Partner","Aunt/Uncle","Niece/Nephew","Doctor","Other","Patient","TB Contact Person","TB Patient","treatment suporter"];((r=e.value)==null?void 0:r.length)>0&&(t.value=e.value.filter(y=>d==="M"?c.includes(y.a_is_to_b)||b.includes(y.a_is_to_b):d==="F"?l.includes(y.a_is_to_b)||b.includes(y.a_is_to_b):!1))};return{relationships:n,relationshipsData:e,filteredRelationships:t,apiStatus:a,getRelationships:async d=>{var c;if(d)return e.value=await Ce("relationship"),a.value&&e.value.length!==((c=i.offlineRelationshipStatus)==null?void 0:c.total)&&(e.value=await lt.getRelations()),o(d),n.value=n.value=t.value.map(l=>[{name:l.b_is_to_a,id:l.relationship_type_id,trackByID:l.relationship_type_id+l.b_is_to_a}]).reduce((l,b)=>l.concat(b),[]),n.value},filterRelationships:o}}const Gt=(n,e)=>{const t=w(()=>new X().checkIfChild(n.value).moreThanThirteenYears),{getRelationships:i}=Yt(),a=N();return Je(n,async s=>{s&&(a.value=await i(s.gender))}),{guardianInformation:w(()=>[{componentType:"Heading",name:"Guardian Information",position:"center"},{componentType:"inputField",header:"Guardian National ID",name:"guardianNationalID",placeholder:"__-__-__-__",icon:F.nationalID,validation:s=>D.isMWNationalID(s)},{componentType:"inputField",header:"First name",name:"guardianFirstname",icon:F.fullName,validation:s=>t.value?D.isNameEmpty(s):D.isName(s)},{componentType:"inputField",header:"Middle name",name:"guardianMiddleName",icon:F.fullName,validation:s=>D.isNameEmpty(s)},{componentType:"inputField",header:"Last name",name:"guardianLastname",icon:F.fullName,validation:s=>t.value?D.isNameEmpty(s):D.isName(s)},{componentType:"phoneInputField",name:"guardianPhoneNumber",header:"Phone Number",validation:s=>D.isMWPhoneNumber(s.phoneNumber)},{componentType:"multiSelectInputField",header:"Relationship to patient",name:"relationship",trackBy:"trackByID",icon:F.search,validation:s=>t.value?null:D.required(s==null?void 0:s.name),options:()=>a.value,disabled:()=>!a.value}])}},qt=A({__name:"GuardianInformation",props:{personalInformationFormValues:{}},setup(n,{expose:e}){const{formRef:t,exposeFormMethods:i}=q(),a=n,o=w(()=>a.personalInformationFormValues),{guardianInformation:s}=Gt(o);return e(i()),(d,c)=>(f(),H(G,{formData:g(s),ref_key:"formRef",ref:t},null,8,["formData"]))}}),Wt=()=>{const n=N();return ut.isProp("military_site=true").then(t=>{n.value=t}),{socialHistory:w(()=>[{componentType:"Heading",name:"Social History",position:"center"},{componentType:"multiSelectInputField",header:"Religion",name:"religion",icon:F.search,trackBy:"id",options:[{id:1,name:"Christianity"},{id:2,name:"Islam"},{id:3,name:"Judaism"},{id:4,name:"Hinduism"},{id:5,name:"Buddhism"},{id:6,name:"Sikhism"},{id:7,name:"Jainism"},{id:8,name:"BahÃ¡'Ã­ Faith"},{id:9,name:"Zoroastrianism"},{id:10,name:"Confucianism"},{id:11,name:"Taoism"},{id:12,name:"Shinto"},{id:13,name:"Baha'i Faith"},{id:14,name:"Juche"},{id:15,name:"Rastafari"}]},{componentType:"radioButtonField",header:"Occupation status",name:"occupation",type:"inline",validation:D.required,condition:()=>V.getProgramID()==1&&n.value,options:[{label:"Military",value:"Military"},{label:"Civilian",value:"Civilian"}]},{componentType:"radioButtonField",header:"Occupation status",name:"occupation",type:"inline",condition:t=>!n,options:[{label:"Employed",value:"employed"},{label:"Student",value:"Student"},{label:"Unemployed",value:"unemployed"},{label:"Other",value:"Other"}]},{componentType:"radioButtonField",header:"Marital status",name:"maritalStatus",type:"inline",options:[{label:"Single",value:"single"},{label:"Married",value:"married"},{label:"Widow",value:"widow"},{label:"Widower",value:"widower"},{label:"Divorced",value:"divorced"}]},{componentType:"radioButtonField",header:"Highest level of education",name:"highestLevelOfEducation",type:"inline",options:[{label:"No education",value:"No education"},{label:"Primary school",value:"primary school"},{label:"Secondary school",value:"secondary school"},{label:"Tertiary education",value:"tertiary education"}]}])}},Ut=A({__name:"SocialHistory",setup(n,{expose:e}){const{socialHistory:t}=Wt(),{formRef:i,exposeFormMethods:a}=q();return e(a()),(o,s)=>(f(),H(G,{formData:g(t),ref_key:"formRef",ref:i},null,8,["formData"]))}}),zt=()=>{const{facilityList:n,getFacilities:e}=te();return e(),{patientType:w(()=>[{componentType:"Heading",name:"Patient Type",position:"center"},{componentType:"radioButtonField",header:"Patient Type",name:"patient_type",type:"inline",validation:D.required,options:[{label:"New patient",value:"New patient"},{label:"Emergency supply",value:"Emergency supply"},{label:"External consultation",value:"External consultation"}]},{componentType:"multiSelectInputField",header:"Facility",name:"facility",trackBy:"facility_id",openDirection:"auto",icon:F.search,validation:i=>D.required(i),options:n.value.facilities,condition:i=>(i==null?void 0:i.patient_type)=="Emergency supply"||(i==null?void 0:i.patient_type)=="External consultation"}])}},Jt=A({__name:"PatientType",setup(n,{expose:e}){const{patientType:t}=zt(),{formRef:i,exposeFormMethods:a}=q();return e(a()),(o,s)=>(f(),H(G,{formData:g(t),ref_key:"formRef",ref:i},null,8,["formData"]))}}),jt=n=>({birthRegistration:w(()=>[{componentType:"Heading",name:"Birth Registration",position:"center"},{componentType:"inputField",header:"Birth certificate number",name:"Serial Number",icon:F.nationalID,placeholder:"__-__-__-__"},{componentType:"inputField",header:"Birth Weight/First weight (kg)",name:"Weight",icon:F.weight,validation:t=>D.validateWeight(t)},{componentType:"multiSelectInputField",header:"How many doses of Tdv did the mother receive?",name:"How many doses of Tdv did the mother receive?",icon:F.search,options:[{concept_id:11997,name:"0-2 doses, less than two weeks before delivery"},{concept_id:11998,name:"2-5 doses more than two weeks of delivery"},{concept_id:1067,name:"Unknown"}],trackBy:"concept_id",validation:t=>D.required(t),onChange:t=>{const i=t==null?void 0:t.name;i=="Unknown"?n.value.setFormValue("Protected at birth",{concept_id:1067,name:"Don't know"}):i=="0-2 doses, less than two weeks before delivery"?n.value.setFormValue("Protected at birth",{concept_id:1066,name:"No"}):i=="2-5 doses more than two weeks of delivery"&&n.value.setFormValue("Protected at birth",{concept_id:1065,name:"Yes"})}},{componentType:"multiSelectInputField",header:"Protected at birth (PAB)",name:"Protected at birth",icon:F.search,trackBy:"concept_id",validation:t=>D.required(t),disabled:t=>!t["How many doses of Tdv did the mother receive?"]},{componentType:"multiSelectInputField",header:"HIV status of the Child's Mother",name:"HIV status",icon:F.search,options:[{id:703,name:"Positive"},{id:664,name:"Negative"},{id:1067,name:"Unknown"}],trackBy:"id",validation:t=>D.required(t)}])}),It=A({__name:"BirthRegistration",setup(n,{expose:e}){const{formRef:t,exposeFormMethods:i}=q(),{birthRegistration:a}=jt(t);return e(i()),(o,s)=>(f(),H(G,{formData:g(a),ref_key:"formRef",ref:t},null,8,["formData"]))}});function Rt(){const n=N(1),e=N(4),t=4,i=se(),{patient:a}=Ve(i),o=()=>{const T=window.innerWidth;return T>=992?4:T>=768?3:T>=576?2:1},s=w(()=>e.value===0?t:Math.ceil(t/e.value)),d=w(()=>s.value>1),c=w(()=>d.value&&n.value>1),l=w(()=>d.value&&n.value<s.value),b=T=>{if(s.value===1)return!0;const B=(n.value-1)*e.value,Y=B+e.value-1;return T>=B&&T<=Y},r=()=>{n.value<s.value&&n.value++},y=()=>{n.value>1&&n.value--},E=T=>{T>=1&&T<=s.value&&(n.value=T)},$=()=>{e.value=o(),n.value>s.value&&(n.value=s.value),n.value===0&&s.value>0&&(n.value=1)};return Pe(()=>{window.addEventListener("resize",$),$()}),je(()=>{window.removeEventListener("resize",$)}),{currentPage:n,columnsPerRow:e,totalPages:s,showPaginationButtons:d,showPreviousButton:c,showNextButton:l,nextPage:r,prevPage:y,goToPage:E,handleResize:$,isCardVisible:b}}function Xt(){const n=se(),{patient:e}=Ve(n),t=a=>{var y,E;const{personalInformationRef:o,socialHistoryRef:s,countryRef:d,currentLocationRef:c,homeLocationRef:l,guardianInformationRef:b}=a.value,r=(y=e==null?void 0:e.value)==null?void 0:y.personInformation;o==null||o.setFormValue("nationalID",(E=e==null?void 0:e.otherPersonInformation)==null?void 0:E.nationalID),o==null||o.setFormValue("firstname",r==null?void 0:r.given_name),o==null||o.setFormValue("middleName",r==null?void 0:r.middle_name),o==null||o.setFormValue("lastname",r==null?void 0:r.family_name),o==null||o.setFormValue("gender",r==null?void 0:r.gender),o==null||o.setFormValue("birthdate",r!=null&&r.birthdate?J.toStandardHisDisplayFormat(r==null?void 0:r.birthdate):""),o==null||o.setFormValue("Phone Number",r!=null&&r.cell_phone_number?r==null?void 0:r.cell_phone_number:""),l==null||l.setFormValue("home_district",{name:r==null?void 0:r.home_district}),l==null||l.setFormValue("home_traditional_authority",{name:r==null?void 0:r.home_traditional_authority}),l==null||l.setFormValue("home_village",{name:r==null?void 0:r.home_village}),c==null||c.setFormValue("current_district",{name:r==null?void 0:r.current_district}),c==null||c.setFormValue("current_traditional_authority",{name:r==null?void 0:r.current_traditional_authority}),c==null||c.setFormValue("current_village",{name:r==null?void 0:r.current_village}),c==null||c.setFormValue("closestLandmark",{name:r==null?void 0:r.landmark}),d==null||d.setFormValue("country",r!=null&&r.country?{name:r==null?void 0:r.country}:{name:"Malawi"}),s==null||s.setFormValue("religion",{name:r==null?void 0:r.religion}),s==null||s.setFormValue("occupation",r==null?void 0:r.occupation),s==null||s.setFormValue("maritalStatus",r==null?void 0:r.marital_status),s==null||s.setFormValue("highestLevelOfEducation",r==null?void 0:r.education_level),i(b)},i=a=>{var d,c,l;const o=(c=(d=e==null?void 0:e.value)==null?void 0:d.guardianInformation)==null?void 0:c.saved[0],s=(l=o==null?void 0:o.relationship_type)!=null&&l.b_is_to_a?{name:o.relationship_type.b_is_to_a,id:o.relationship_type.relationship_type_id,trackByID:o.relationship_type.relationship_type_id+o.relationship_type.b_is_to_a}:"";a==null||a.setFormValue("guardianNationalID",(o==null?void 0:o.national_id)||""),a==null||a.setFormValue("guardianFirstname",(o==null?void 0:o.given_name)||""),a==null||a.setFormValue("guardianMiddleName",(o==null?void 0:o.middle_name)||""),a==null||a.setFormValue("guardianLastname",(o==null?void 0:o.family_name)||""),a==null||a.setFormValue("guardianPhoneNumber",o!=null&&o.cell_phone_number?o==null?void 0:o.cell_phone_number:""),a==null||a.setFormValue("relationship",s||"")};return{setFormValues:t}}const Zt={key:0,class:"spinner-overlay"},Kt={class:"header-title"},Qt={class:"masonry-grid"},en={class:"card-container"},tn={class:"custom-card"},nn={class:"card-container"},an={key:0,class:"custom-card"},on={key:1,class:"custom-card"},sn={class:"custom-card card-margin-top"},rn={key:0,class:"card-container"},ln={class:"custom-card"},un={class:"custom-card card-margin-top"},dn={class:"card-container"},cn={class:"custom-card"},mn={key:0,class:"custom-card card-margin-top"},_n={class:"footer-content"},pn={class:"footer-buttons-left"},hn={key:0,class:"pagination-dots"},vn=["onClick","aria-label"],yn={class:"footer-buttons-right"},gn=A({__name:"Registration",props:{editMode:{type:Boolean,default:!1}},setup(n){const e=N(!1),t=Ie(),i=N(null),a=N(null),o=N(null),s=N(null),d=N(null),c=N(null),l=N(null),b=N(null),r=N({personalInformationRef:i,birthRegistrationRef:a,socialHistoryRef:o,countryRef:s,currentLocationRef:d,homeLocationRef:c,guardianInformationRef:l,patientTypeRef:b}),y=w(()=>{var v;return((v=i.value)==null?void 0:v.currentFormValues)||{}}),E=w(()=>{var v;return((v=a.value)==null?void 0:v.currentFormValues)||{}}),$=w(()=>{var v;return((v=o.value)==null?void 0:v.currentFormValues)||{}}),T=w(()=>{var v;return((v=s.value)==null?void 0:v.currentFormValues)||{}}),B=w(()=>{var v;return((v=d.value)==null?void 0:v.currentFormValues)||{}}),Y=w(()=>{var v;return((v=c.value)==null?void 0:v.currentFormValues)||{}}),p=w(()=>{var v;return((v=l.value)==null?void 0:v.currentFormValues)||{}}),W=w(()=>{var v;return((v=b.value)==null?void 0:v.currentFormValues)||{}}),_=w(()=>({personalInformation:y.value,birthRegistration:E.value,socialHistory:$.value,country:T.value,currentLocation:B.value,homeLocation:Y.value,guardianInformation:p.value,patientType:W.value})),M=()=>{const v=Object.values(r.value);return v.forEach(S=>S==null?void 0:S.validateForm()),v.every(S=>(S==null?void 0:S.validateForm())==null)},K=()=>{Object.values(r.value).forEach(v=>v==null?void 0:v.resetForm())},I=w(()=>new X().checkIfChild(y.value)),{nextPage:Be,prevPage:Me,goToPage:Ee,isCardVisible:Q,showPreviousButton:$e,showPaginationButtons:xe,totalPages:re,currentPage:le,showNextButton:Oe}=Rt(),{setFormValues:He}=Xt(),Ae=async()=>{if(!M()){he("Please fill in all required fields");return}await new X().saveRegistrationData(_.value)&&(K(),V.getProgramID()==32?ne("/NCDEnrollment"):ne("/patientProfile"))},Le=async()=>{if(!M()){he("Please fill in all required fields");return}await new X().updateDemographics(_.value)&&Z.dismiss()},Ye=async()=>{await ve("Do you want to cancel registration?","",{confirmBtnLabel:"Yes",icon:"",showBackdrop:!0})&&ne("/home")},Ge=async()=>{await ve("Do you want to cancel editing of demographics?","",{confirmBtnLabel:"Yes",icon:"",showBackdrop:!0})&&Z.dismiss()},ne=v=>{t.push({path:v})};return Pe(async()=>{He(r)}),(v,S)=>(f(),H(g(Qe),{class:me({loading:e.value})},{default:m(()=>[e.value?(f(),x("div",Zt,[u(g(Re),{name:"bubbles"}),S[4]||(S[4]=h("div",{class:"loading-text"},"Please wait...",-1))])):L("",!0),u(g(Xe),null,{default:m(()=>[h("div",Kt,C(n.editMode?"Edit Patient Demographic":"New Patient Registration"),1)]),_:1}),u(g(Ze),null,{default:m(()=>{var O,ae,ue,de;return[h("div",Qt,[U(h("div",en,[h("div",tn,[u(Vt,{ref_key:"personalInformationRef",ref:i},null,512)])],512),[[z,g(Q)(0)]]),U(h("div",nn,[I.value.underNineMonths&&!n.editMode?(f(),x("div",an,[I.value.underNineMonths?(f(),H(It,{key:0,ref_key:"birthRegistrationRef",ref:a},null,512)):L("",!0)])):L("",!0),I.value.moreThanThirteenYears?(f(),x("div",on,[u(Ut,{ref_key:"socialHistoryRef",ref:o},null,512)])):L("",!0),h("div",sn,[u(kt,{ref_key:"countryRef",ref:s},null,512)])],512),[[z,g(Q)(1)]]),!((ae=(O=T.value)==null?void 0:O.country)!=null&&ae.name)||((de=(ue=T.value)==null?void 0:ue.country)==null?void 0:de.name)==="Malawi"?U((f(),x("div",rn,[h("div",ln,[u(vt,{ref_key:"currentLocationRef",ref:d},null,512)]),h("div",un,[u(St,{currentLocationFormValues:B.value,ref_key:"homeLocationRef",ref:c},null,8,["currentLocationFormValues"])])],512)),[[z,g(Q)(2)]]):L("",!0),U(h("div",dn,[h("div",cn,[u(qt,{personalInformationFormValues:y.value,ref_key:"guardianInformationRef",ref:l},null,8,["personalInformationFormValues"])]),g(V).getProgramID()==1?(f(),x("div",mn,[u(Jt,{ref_key:"patientTypeRef",ref:b},null,512)])):L("",!0)],512),[[z,g(Q)(3)]])])]}),_:1}),u(g(Ke),null,{default:m(()=>[h("div",_n,[h("div",pn,[u(g(R),{color:"danger","aria-label":"Cancel registration",onClick:S[0]||(S[0]=O=>n.editMode?Ge():Ye())},{default:m(()=>S[5]||(S[5]=[P("Cancel")])),_:1,__:[5]}),U(u(g(R),{onClick:S[1]||(S[1]=O=>g(Me)()),"aria-label":"Go to previous page"},{default:m(()=>S[6]||(S[6]=[P("Previous")])),_:1,__:[6]},512),[[z,g($e)]])]),g(xe)?(f(),x("div",hn,[(f(!0),x(ee,null,Te(g(re),O=>(f(),x("span",{key:O,class:me({dot:!0,active:O===g(le)}),onClick:ae=>g(Ee)(O),"aria-label":"Go to page ".concat(O),role:"button"},null,10,vn))),128))])):L("",!0),h("div",yn,[U(u(g(R),{name:"Save",onClick:S[2]||(S[2]=O=>n.editMode?Le():Ae()),"aria-label":"Save patient data"},{default:m(()=>[P(C(n.editMode?"Update":"Save"),1)]),_:1},512),[[z,g(le)===g(re)]]),U(u(g(R),{onClick:S[3]||(S[3]=O=>g(Be)()),"aria-label":"Go to next page"},{default:m(()=>S[7]||(S[7]=[P("Next")])),_:1,__:[7]},512),[[z,g(Oe)]])])])]),_:1})]),_:1},8,["class"]))}}),bn=oe(gn,[["__scopeId","data-v-d5a6ac21"]]),Tn=Object.freeze(Object.defineProperty({__proto__:null,default:bn},Symbol.toStringTag,{value:"Module"}));export{pt as C,bn as R,St as _,vt as a,qt as b,Vt as c,Ut as d,Tn as e};

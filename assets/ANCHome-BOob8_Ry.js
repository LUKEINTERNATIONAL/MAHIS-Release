import{d as Y,r as y,a as zt,e as Ht,f as T,l as o,N as J,m as Q,J as i,u as l,aa as D,k as p,b2 as q,P as S,K as C,a9 as x,bn as Rt,M as Z,F as Ut,Q as X,af as B,a7 as Jt,ae as Zt,a8 as Et,bF as Lt,cb as Yt,d7 as Kt,_ as Wt,$ as jt,H as w}from"./vendor-CCEOjICu.js";import{aP as Gt,u as V,H as I,S as it,P as tt,t as E,k as Qt,A as qt,K as et,bw as Xt,_ as rt,T as te,J as ee,o as nt,N as ne,v as ae,aN as oe,ah as se}from"./index-Dy9ZuUHl.js";import{D as ie}from"./DemographicBar-PpkEV7Lk.js";import{N as re,u as L,a as le,L as ce}from"./NextAppointmentModal-BVxFuc7X.js";import{S as pe}from"./SaveProgressModal-BgcSKpWL.js";import{F as ue}from"./FeatusModal-CwbpJIPL.js";import{a as de}from"./formatServerData-CRX-K7V6.js";import{u as F,A as at,a as me,v as ot}from"./vaccines_service-BqcJdMD5.js";import{S as st}from"./sms_service-Dgp5F8cS.js";import{R as fe}from"./relationship_service-rwv4vaSZ.js";import{B as ge}from"./BasicForm-CDD4jxeF.js";import"./lodash-Dt8AsbQm.js";import"./apexcharts-CkGWSImU.js";import"./EIRreportsStore-B0dCjr3W.js";import"./Export-DAPboYOx.js";import"./DateInputField-MVh0oScR.js";class he extends Gt{constructor(r,m){super(r,7,m)}}const ye={class:"lbl-ct"},De={class:"lbl-ct"},_e={style:{"margin-right":"20px",color:"black"}},ve={style:{"font-size":"16px",color:"#666","margin-top":"5px"}},Ae=Y({watch:{},name:"xxxComponent",computed:{...B(L,["nextAppointmentDate"]),...B(V,["patient"])},methods:{handleInputData(a){Xt(this.nextAppointmentDate,re,a.name,a.value),this.handleDateOfScheduledAppointmentRange(a)},closeCircleOutline(){return Jt},handleDateOfScheduledAppointmentRange(a){const r=new Date,m=new Date(r);m.setDate(m.getDate()+1);const f=m.toISOString().split("T")[0],_=new Date(r);_.setDate(_.getDate()+32);const M=_.toISOString().split("T")[0];et(this.nextAppointmentDate,"Appointment date","minDate",f),et(this.nextAppointmentDate,"Appointment date","maxDate",M)}}}),we=Y({...Ae,props:{patient_Id:{},encounter_Id:{}},setup(a){const r=V(),m=V(),f=y(),_=y(),M=y(!1),k=y(!1),P=I.toStandardHisDisplayFormat(it.getSessionDate()),g=y(!1),$=y(),O=y(0),N=y([]),v=[],A=a;async function lt(){await dt(),await vt();const e=await(A.patient_Id?new at(A.patient_Id):new at).createAppointment();pt(),ut(),W(),ct(e)}async function ct(t){if(N.value.length==0){E("No phone numbers available for sms reminder!");return}Array.isArray(t)&&t.length>0&&(k.value?await(await X.create({component:me,componentProps:{date:t[1],patient:t[0],modalaction:"saveAppointment"}})).present():await st.appointment(t[0],t[1]))}async function pt(){const t=Qt();t.setVaccineReload(!t.getVaccineReload())}async function ut(){const t=F();t.setAppointmentsReload(!t.getAppointmentsReload())}async function dt(){try{await ot(A.encounter_Id,"Rescheduled"),await ot(A.encounter_Id,"Rescheduled")}catch(t){}}zt(async()=>{F().clearAppointmentMent(),await _t(),await mt()});async function mt(){try{const t=new tt,e=A.patient_Id!==void 0?A.patient_Id:t.getID(),n=await yt(e);if(v.length>0){const s=v[v.length-1];console.log(s),await ft(s,e)==!1&&(f.value=G(s.vaccine.date_administered,j(n.age)),_.value=I.toStandardHisDisplayFormat(f.value),At(f.value),wt(f.value),M.value=!0)}}catch(t){}}async function ft(t,e){try{const n=await tt.findByID(e),s=new Date(n.person.birthdate),u=G(s,j(t.age)),c=gt(t.vaccine.date_administered),d=new Date(u);return console.log(K(c,d)),K(c,d)}catch(n){}}function gt(t){const e={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},n=t.split(/[:/ ]/),s="".concat(n[2],"-").concat(e[n[1]],"-").concat(n[0],"T").concat(n[3],":").concat(n[4],":").concat(n[5]);return new Date(s)}function K(t,e){const n=t.getFullYear(),s=t.getMonth(),u=t.getDate(),c=e.getFullYear(),d=e.getMonth(),b=e.getDate();return n!==c?n>c:s!==d?s>d:u>b}function ht(t){return t.forEach(e=>{e.antigens.forEach(n=>{n.status=="administered"&&v.push({age:e.age,vaccine:n})})}),v}async function yt(t){try{const e=m.vaccineSchedule;ht(e.vaccine_schedule);for(const n of e.vaccine_schedule)if(n.milestone_status==="current"||n.milestone_status==="upcoming")return n;return null}catch(e){return null}}async function Dt(t){try{const e=await qt.getDailyAppointments(I.toStandardHisFormat(t),I.toStandardHisFormat(t));O.value=e.length+1}catch(e){}}function W(){X.dismiss()}async function _t(){try{let t=await st.getConfigurations();k.value=t.show_sms_popup}catch(t){}}async function vt(){var t,e;try{const n=await fe.getRelationships(r.patient.patientID);if(n.length>0){const s=n[0].relation.person_attributes.find(u=>u.type.name=="Cell Phone Number");s&&N.value.push(s.value)}(e=(t=r.patient)==null?void 0:t.personInformation)!=null&&e.cell_phone_number&&N.value.push(r.patient.patientID)}catch(n){}}async function At(t){const e=F(),n={counter:1,date:t};e.setAppointmentMent(n),g.value=!1,await Dt(t),g.value=!0,$.value=I.toStandardHisDisplayFormat(t)}function wt(t){const n=F().getAppointmentMents(),s=d=>{const b=new Date(d);return b.setHours(0,0,0,0),b.getTime()},u=s(new Date(t)),c=n.find(d=>s(new Date(d.date))===u);return c?c.counter:null}function j(t){const e=/(\d+)\s*(week|month|year)s?/i,n=t.match(e);if(!n)return"Invalid input format";const s=parseInt(n[1]);switch(n[2].toLowerCase()){case"week":return s*7;case"month":return s*30;case"year":return s*365;default:return"Invalid time unit"}}function G(t,e){let n;if(t instanceof Date)n=new Date(t);else{const[h,U]=t.split(" "),[$t,Ot,Ft]=h.split("/"),[Tt,Bt,Vt]=U.split(":"),Pt={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};n=new Date(Number(Ft),Pt[Ot],Number($t),Number(Tt),Number(Bt),Number(Vt))}n.setDate(n.getDate()+e);const s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=h=>String(h).padStart(2,"0"),d=s[n.getDay()],b=u[n.getMonth()],bt=c(n.getDate()),St=n.getFullYear(),xt=c(n.getHours()),Mt=c(n.getMinutes()),Nt=c(n.getSeconds()),z=-n.getTimezoneOffset(),It=Math.floor(Math.abs(z)/60),Ct=Math.abs(z)%60,kt="GMT".concat(z>=0?"+":"-").concat(c(It)).concat(c(Ct)),H=Intl.DateTimeFormat().resolvedOptions().timeZone;let R;try{const h=new Intl.DateTimeFormat("en",{timeZone:H,timeZoneName:"long"}).formatToParts(n).find(U=>U.type==="timeZoneName");R=h?h.value:H}catch(h){console.error("Error getting localized time zone name:",h),R=H}return"Date ".concat(d," ").concat(b," ").concat(bt," ").concat(St," ").concat(xt,":").concat(Mt,":").concat(Nt," ").concat(kt," (").concat(R,")")}return(t,e)=>(T(),Ht(Ut,null,[o(l(x),{style:{"margin-top":"10px"}},{default:i(()=>[o(l(D),{style:{"margin-left":"-3px"}},{default:i(()=>e[0]||(e[0]=[p("div",{class:"om",style:{"font-weight":"600",color:"#8d8686"}},"Set Next Appointment Date",-1)])),_:1,__:[0]}),o(l(D),{size:"6",style:{"text-align":"right"}},{default:i(()=>[o(l(q),{class:"lbl-tl",style:{"font-size":"13px"}},{default:i(()=>[e[1]||(e[1]=S(" Todays Date: ",-1)),p("span",ye,C(l(P)),1)]),_:1,__:[1]})]),_:1})]),_:1}),o(l(x),{style:{"margin-top":"10px"}},{default:i(()=>[o(l(D),{style:{"margin-left":"-3px"}},{default:i(()=>e[2]||(e[2]=[p("div",{class:"om"},null,-1)])),_:1,__:[2]}),g.value?(T(),J(l(D),{key:0,size:"10",style:{"text-align":"right"}},{default:i(()=>[o(l(q),{class:"lbl-tl",style:{"font-size":"16px","font-weight":"500"}},{default:i(()=>[e[3]||(e[3]=S(" Total Appointments ",-1)),p("span",De,"("+C($.value)+")",1),e[4]||(e[4]=S(": ",-1)),p("span",_e,[o(l(Rt),{color:"primary",style:{"margin-bottom":"-5px","font-size":"15px"}},{default:i(()=>[S(C(O.value),1)]),_:1})])]),_:1,__:[3,4]})]),_:1})):Q("",!0)]),_:1}),o(l(x),{style:{"margin-top":"20px"}},{default:i(()=>[o(l(D),null,{default:i(()=>[o(ge,{contentData:t.nextAppointmentDate,"onUpdate:selected":t.handleInputData,"onUpdate:inputValue":t.handleInputData},null,8,["contentData","onUpdate:selected","onUpdate:inputValue"])]),_:1})]),_:1}),M.value?(T(),J(l(x),{key:0,style:{"margin-top":"0px","margin-bottom":"0px"}},{default:i(()=>[o(l(D),{style:{"background-color":"#f0f0f0",padding:"15px","border-radius":"8px","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)"}},{default:i(()=>[e[5]||(e[5]=p("div",{style:{"font-size":"17px",color:"#333","font-weight":"bold"}},"Suggested Date:",-1)),p("div",ve,C(_.value),1)]),_:1,__:[5]})]),_:1})):Q("",!0),o(l(x),{style:{"margin-top":"10px","margin-bottom":"10px"}},{default:i(()=>[o(l(D),null,{default:i(()=>[o(l(Z),{onClick:W,id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px"}},{default:i(()=>e[6]||(e[6]=[S(" Cancel ",-1)])),_:1,__:[6]})]),_:1}),o(l(D),{style:{"text-align":"right"}},{default:i(()=>[o(l(Z),{onClick:lt,class:"btnText",fill:"solid",style:{width:"130px"}},{default:i(()=>e[7]||(e[7]=[S(" save ",-1)])),_:1,__:[7]})]),_:1})]),_:1})],64))}}),be=rt(we,[["__scopeId","data-v-f063c32f"]]),Se=Y({name:"TB screening",components:{IonRow:x,IonButton:Z,FeatusModal:ue,DynamicButton:ee,IonContent:Et,IonPage:Zt,Toolbar:te,DemographicBar:ie,LandingPage:ce,NextAppointmentModal:le},props:{backBtn:{type:String,default:"Back to profile"},backUrl:{type:String,default:""},contact:{type:String,default:""}},data(){return{isModalOpen:!1,dateOfAppointment:""}},mounted(){this.handleAppointment()},setup(){return{checkmark:jt,pulseOutline:Wt}},computed:{...B(L,["nextAppointmentDate"]),...B(V,["patient"])},methods:{calendar(){return Kt},eye(){return Yt},chevronBackOutline(){return Lt},openBackController(){this.backUrl?this.$router.push(this.backUrl):nt(pe)},async handleAppointment(){const a=await se.getFirstObsValue(this.patient.patientID,"Appointment date","value_text");this.dateOfAppointment=a},async saveData(){if(!await L().validate()){ae("Next appointment date has errors");return}await this.saveDate(),this.closeAppointmentModal(),await this.$router.push("ANCHome"),await await oe()},async saveDate(){if(this.nextAppointmentDate.length>=0){const a=it.getUserID(),r=new he(this.patient.patientID,a);if(!await r.createEncounter())return E("Unable to create appointment date encounter");if(!await r.saveObservationList(await this.buildNextAppointment()))return E("Unable to create date!");ne("Client has been scheduled for next contact")}console.log(await this.buildNextAppointment())},openNextVaccineAppoinment(){nt(be,{class:"otherVitalsModal"},!1)},async buildNextAppointment(){return[...await de(this.nextAppointmentDate)]},cancelModal(){this.closeAppointmentModal()},async nextAppointment(){this.toggleAppointmentModal()},toggleAppointmentModal(){this.isModalOpen=!this.isModalOpen},closeAppointmentModal(){this.isModalOpen=!1},previousContacts(){this.$router.push("/contacts")},navigateToContact(){this.$router.push("/contact")}}}),xe={class:"container"},Me={class:"back_profile"},Ne={class:"AppointmentDate"},Ie={style:{color:"#0b5ed7"}},Ce={class:"button-container ion-justify-content-center ion-align-items-center"};function ke(a,r,m,f,_,M){const k=w("Toolbar"),P=w("DemographicBar"),g=w("DynamicButton"),$=w("NextAppointmentModal"),O=w("LandingPage"),N=w("ion-content"),v=w("ion-page");return T(),J(v,null,{default:i(()=>[o(k),o(N,{fullscreen:!0},{default:i(()=>[o(P),p("div",xe,[p("div",Me,[o(g,{name:a.backBtn,iconSlot:"start",fill:"clear",icon:a.chevronBackOutline(),onClick:r[0]||(r[0]=A=>a.openBackController())},null,8,["name","icon"]),p("div",Ne,[r[1]||(r[1]=p("span",{style:{"font-size":"14px"}},"Appointment Date: ",-1)),p("b",Ie,C(a.dateOfAppointment||"Not scheduled"),1)])]),p("div",Ce,[o(g,{style:{"padding-right":"1%"},name:"New ANC contact",iconSlot:"start",fill:"solid",icon:a.checkmark,onClick:a.navigateToContact},null,8,["icon","onClick"]),o(g,{style:{"padding-right":"1%"},name:"View ANC contacts",iconSlot:"start",fill:"solid",icon:a.eye(),onClick:a.previousContacts},null,8,["icon","onClick"]),o(g,{name:"Schedule next contact",iconSlot:"start",fill:"solid",icon:a.calendar(),onClick:a.nextAppointment},null,8,["icon","onClick"])]),o($,{isOpen:a.isModalOpen,title:"",closeModalFunc:a.closeAppointmentModal,onYes:a.saveData,onNo:a.cancelModal},null,8,["isOpen","closeModalFunc","onYes","onNo"]),r[2]||(r[2]=p("hr",null,null,-1)),o(O)])]),_:1})]),_:1})}const Ke=rt(Se,[["render",ke],["__scopeId","data-v-75067a76"]]);export{Ke as default};

System.register(["./vendor-legacy-BNx6hK96.js","./index-legacy-BycxVqUG.js","./vaccines_service-legacy-LVjEfNt1.js","./EIRreportsStore-legacy-DhIxWNcR.js","./bottomNavBar-legacy-4l0mYQnE.js"],function(e,t){"use strict";var a,n,i,o,r,l,s,c,d,p,u,g,f,m,h,v,y,b,w,_,x,I,P,C,E,k,D,A,T,z,F,O,R,S,B,U,j,$,L,N,V,G,K,H,M,q,J,Z,Q,Y,W,X,ee,te,ae;return{setters:[e=>{a=e.d,n=e.bK,i=e.a0,o=e.aZ,r=e.a1,l=e.ab,s=e.cb,c=e.aP,d=e.aO,p=e.E,u=e.L,g=e.I,f=e.aR,m=e.a8,h=e.aa,v=e.a9,y=e.bh,b=e.r,w=e.bq,_=e.c,x=e.a,I=e.w,P=e.ar,C=e.bf,E=e.c$,k=e.aA,D=e.az,A=e.aI,T=e.Q,z=e.H,F=e.e,O=e.f,R=e.l,S=e.J,B=e.P,U=e.K,j=e.k,$=e.N,L=e.m,N=e.F,V=e.O,G=e.af,K=e.ae,H=e.Y},e=>{M=e.B,q=e.H,J=e._,Z=e.P,Q=e.u,Y=e.n,W=e.aJ},e=>{X=e.f,ee=e.h},e=>{te=e.E},e=>{ae=e.b}],execute:function(){var t=document.createElement("style");t.textContent=".person-card[data-v-4ec49661]{border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1);margin-bottom:16px}.card-header[data-v-4ec49661]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}ion-card-title[data-v-4ec49661]{font-size:1.2rem;font-weight:700;margin-bottom:4px}ion-card-subtitle[data-v-4ec49661]{font-size:.9rem;color:var(--ion-color-medium)}.eye-icon[data-v-4ec49661]{font-size:1.5rem;cursor:pointer}ion-icon[data-v-4ec49661]{color:var(--ion-color-primary)}ion-item[data-v-4ec49661]{--padding-start: 0}.error-label[data-v-4ec49661]{color:#b42318;text-transform:none;float:right}.p-inf[data-v-4ec49661]{margin-left:30px}.solid-line[data-v-4ec49661]{border:none;border-top:1px solid black;width:90%;margin:0 10px}.s-inf[data-v-4ec49661]{font-size:16px;color:gray}.loading-spinner[data-v-4ec49661],.error-message[data-v-4ec49661],.no-results[data-v-4ec49661]{display:flex;justify-content:center;align-items:center;height:200px;flex-direction:column}.error-message ion-icon[data-v-4ec49661]{font-size:48px;color:var(--ion-color-danger)}@media (max-width: 768px){.person-card[data-v-4ec49661]{margin-bottom:8px}ion-card-title[data-v-4ec49661]{font-size:1rem}.s-inf[data-v-4ec49661]{font-size:14px}}.person-card-23[data-v-4ec49661]{min-width:100%;width:100%;box-sizing:border-box}@media (min-width: 768px){.person-card-23[data-v-4ec49661]{min-width:30rem}}@media (min-width: 1024px){.person-card-23[data-v-4ec49661]{min-width:30rem}}@media (min-width: 1440px){.person-card-23[data-v-4ec49661]{min-width:30rem}}.modalTitle[data-v-4ec49661]{font-size:17px;padding:0;margin-left:16px}[data-v-704cfbc0] ion-content{--background: white}table[data-v-704cfbc0]{width:100%;border-collapse:collapse}th[data-v-704cfbc0],td[data-v-704cfbc0]{padding:8px;text-align:center;border-bottom:1px solid #006401}thead th[data-v-704cfbc0]{background-color:#f3f3f3}th[data-v-704cfbc0]:nth-child(1),td[data-v-704cfbc0]:nth-child(1){border-right:1px solid #006401}#hugo[data-v-704cfbc0]{border-right:0px;text-align:left;background-color:#f3f3f3}tbody td[data-v-704cfbc0]:first-child{border-right:1px solid #006401}tbody td[data-v-704cfbc0]{border-left:none;border-right:none}tbody td[data-v-704cfbc0]{border-bottom:1px solid #acabab}th[data-v-704cfbc0]{background-color:#f2f2f2}tr[data-v-704cfbc0]:nth-child(2n){background-color:#fff}\n/*$vite$:1*/",document.head.appendChild(t);const ne=a({name:"PersonCardComponent",components:{IonGrid:y,IonRow:v,bottomNavBar:ae,IonCol:h,BasicInputField:M,IonContent:m,IonCard:f,IonHeader:g,IonFooter:u,IonTitle:p,IonCardContent:d,IonCardTitle:c,IonCardSubtitle:s,IonList:l,IonItem:r,IonLabel:o,IonIcon:i,IonSpinner:n},props:{people:{type:Array,required:!0},headingText:{type:String,required:!0,default:"Provide heading text"}},setup(e){const t=b(""),a=b(!1),n=b(!1),i=b(""),o=w({page:1,itemsPerPage:6}),r=_(()=>{if(!t.value)return e.people;const a=new RegExp(t.value,"i");return e.people.filter(e=>a.test(e.given_name)||a.test(e.family_name))}),l=_(()=>{const e=(o.page-1)*o.itemsPerPage,t=e+o.itemsPerPage;return r.value.slice(e,t)});return x(()=>{(async()=>{n.value=!0,i.value="";try{await new Promise(e=>setTimeout(e,1e3)),n.value=!1}catch(e){n.value=!1,i.value="Failed to fetch data. Please try again.",console.error("Error fetching data:",e)}})()}),I(t,()=>{o.page=1}),{calendarOutline:A,personOutline:D,locationOutline:k,eyeOutline:E,searchOutline:C,alertCircleOutline:P,searchText:t,searchTextError:a,isLoading:n,error:i,displayPeople:r,paginatedItems:l,getBirthdateAge:q.getBirthdateAge,searchTextUpdated:e=>{const n=e.target;var i;t.value=n.value,a.value=(i=t.value,!/^[a-zA-Z\s]*$/.test(i)),o.page=1},viewPatientProfile:async e=>{try{const t=await T.getTop();t&&t.dispatchEvent(new CustomEvent("view-client",{detail:{client_id:e}}))}catch(t){console.error("Error viewing patient profile:",t)}},dismiss:async()=>{try{await T.dismiss()}catch(e){console.error("Error dismissing modal:",e)}},handlePaginationUpdate:({page:e,itemsPerPage:t})=>{o.page=e,o.itemsPerPage=t},pagination:o}}}),ie={key:0,class:"loading-spinner"},oe={key:1,class:"error-message"},re={key:2,class:"no-results"},le={key:3,style:{"overflow-y":"auto"}},se={class:"card-header"},ce=e("P",J(ne,[["render",function(e,t,a,n,i,o){const r=z("ion-title"),l=z("ion-col"),s=z("ion-row"),c=z("BasicInputField"),d=z("ion-label"),p=z("ion-header"),u=z("ion-spinner"),g=z("ion-icon"),f=z("ion-card-title"),m=z("ion-item"),h=z("ion-list"),v=z("ion-card-content"),y=z("ion-card"),b=z("ion-content"),w=z("bottomNavBar"),_=z("ion-button"),x=z("ion-footer");return O(),F(N,null,[R(p,null,{default:S(()=>[R(s,null,{default:S(()=>[R(l,{style:{padding:"1px"}},{default:S(()=>[R(r,{class:"modalTitle"},{default:S(()=>[B(U(e.headingText),1)]),_:1})]),_:1})]),_:1}),R(s,null,{default:S(()=>[R(l,{style:{"margin-left":"10px","margin-right":"10px"}},{default:S(()=>[R(c,{placeholder:"Find client",icon:e.searchOutline,inputValue:e.searchText,"onUpdate:inputValue":e.searchTextUpdated,minHeight:40},null,8,["icon","inputValue","onUpdate:inputValue"]),j("div",null,[e.searchTextError?(O(),$(d,{key:0,class:"error-label"},{default:S(()=>[...t[1]||(t[1]=[B(" Only letters allowed ",-1)])]),_:1})):L("",!0)])]),_:1})]),_:1})]),_:1}),R(b,{fullscreen:!0,class:"ion-padding"},{default:S(()=>[e.isLoading?(O(),F("div",ie,[R(u,{name:"crescent"})])):e.error?(O(),F("div",oe,[R(g,{icon:e.alertCircleOutline},null,8,["icon"]),j("p",null,U(e.error),1)])):0===e.paginatedItems.length?(O(),F("div",re,[...t[2]||(t[2]=[j("p",null,"No results found",-1)])])):(O(),F("div",le,[R(s,null,{default:S(()=>[(O(!0),F(N,null,V(e.paginatedItems,a=>(O(),$(l,{style:{width:"900px"},key:a.id},{default:S(()=>[R(y,{class:"person-card"},{default:S(()=>[R(v,{class:"person-card-23"},{default:S(()=>[j("div",se,[j("div",null,[R(f,{style:{"font-size":"16px"}},{default:S(()=>[B(U(a.given_name)+" "+U(a.family_name),1)]),_:2},1024),R(d,{style:{"font-size":"17px"}},{default:S(()=>[B(U(e.getBirthdateAge(a.birthdate)),1)]),_:2},1024)]),R(g,{icon:e.eyeOutline,onClick:t=>e.viewPatientProfile(a.patient_id),class:"eye-icon","aria-label":"View patient profile"},null,8,["icon","onClick"])]),R(h,{lines:"none",style:{"border-radius":"6px"}},{default:S(()=>[R(m,{class:"p-inf"},{default:S(()=>[R(g,{class:"eye-icon",icon:e.personOutline,slot:"start","aria-hidden":"true"},null,8,["icon"]),R(d,null,{default:S(()=>[t[3]||(t[3]=j("span",{class:"s-inf"},"Gender:",-1)),B(" "+U(a.gender),1)]),_:2},1024)]),_:2},1024),t[5]||(t[5]=j("hr",{class:"solid-line"},null,-1)),R(m,{class:"p-inf"},{default:S(()=>[R(g,{class:"eye-icon",icon:e.locationOutline,slot:"start","aria-hidden":"true"},null,8,["icon"]),R(d,null,{default:S(()=>[t[4]||(t[4]=j("span",{class:"s-inf"},"Village:",-1)),B(" "+U(a.city_village),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1}),R(x,{collapse:"fade",class:"ion-no-border"},{default:S(()=>[R(s,null,{default:S(()=>[R(l,null,{default:S(()=>[e.displayPeople.length>0?(O(),$(w,{key:0,style:{"margin-left":"20px","margin-right":"20px"},totalItems:e.displayPeople.length,currentPage:e.pagination.page,itemsPerPage:e.pagination.itemsPerPage,"onUpdate:pagination":e.handlePaginationUpdate},null,8,["totalItems","currentPage","itemsPerPage","onUpdate:pagination"])):L("",!0)]),_:1})]),_:1}),R(s,null,{default:S(()=>[R(l,null,{default:S(()=>[R(_,{id:"cbtn",class:"btnText cbtn",fill:"solid",style:{width:"130px","margin-left":"20px"},onClick:t[0]||(t[0]=t=>e.dismiss())},{default:S(()=>[...t[6]||(t[6]=[B(" Cancel ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})],64)}],["__scopeId","data-v-4ec49661"]])),de=a({name:"TableComponent",components:{IonContent:m,IonPage:K,IonRow:v,IonCol:h},data:()=>({route:"",vaccines:[],categories:[{name:"Minor AEFIs",cases:[]},{name:"Serious AEFIs",cases:[]}],personsDemoData:b([])}),watch:{$route:{async handler(e){"EIRReport"==e.name&&await this.initReport()},deep:!0}},computed:{...G(te,["start_date","end_date","navigationPayload"])},async mounted(){await this.initReport()},methods:{async initReport(){this.vaccines=await this.UnderFiveImmunizations(),this.categories[0].cases=await this.getAEFIKnownList(this.categories[0].name,this.vaccines),this.categories[1].cases=await this.getAEFIKnownList(this.categories[1].name,this.vaccines),await this.initAefiReport(this.categories)},async initAefiReport(e){try{const t=await ee(this.start_date,this.end_date),a=new Map;t.data.forEach(e=>{const t=a.get(e.concept_id)||new Map;e.drugs.forEach(a=>{const n=t.get(a.drug_inventory_id)||{count:0,personIds:new Set};t.set(a.drug_inventory_id,{count:n.count+1,personIds:new Set(n.personIds).add(e.person_id)})}),a.set(e.concept_id,t)}),e.forEach(e=>{e.cases.forEach(e=>{const t=a.get(e.concept_id);t&&e.data.forEach(e=>{const a=t.get(e.drug_id);a&&(e.count+=a.count,e.personIds=new Set([...e.personIds||[],...a.personIds]))})})}),te().setAEFIReportData({vaccines:this.vaccines,categories:this.categories})}catch(t){console.error("Error in initAefiReport:",t)}},async UnderFiveImmunizations(){const e=[];return(await X()).forEach(t=>{e.push(t)}),e},async getAEFIKnownList(e,t){const a=[];return(await W.getConceptSet(e)).forEach(e=>{const n=t.map(e=>({...e,count:0}));a.push({concept_id:e.concept_id,name:e.name,data:n})}),a.sort((e,t)=>e.name.localeCompare(t.name)),a},async openPersonCardComponent(e){this.personsDemoData.value=await this.getClientsDemoGraphicData(e);const t=[];this.personsDemoData.value.forEach(e=>{const a={...e[0].person,...e[0].person.addresses[0],...e[0].person.names[0],patient_id:e[0].patient_id};t.push(a)});const a={people:t,headingText:`Immunization (Client Drill Down | ${this.navigationPayload.subTxt})`};Y(ce,{class:"large-modal"},!0,a,{"view-client":e=>{this.openPatientProfile(e.detail.client_id)}})},async openPatientProfile(e){this.personsDemoData.value.forEach(async t=>{if(t[0].patient_id==e)return await Q().setPatientRecord(t[0]),void this.$router.push("patientProfile")})},async getClientsDemoGraphicData(e){try{const t=Array.from(e).map(async e=>{try{const t=await Z.findByID(e);return t&&t.patient_identifiers&&0!==t.patient_identifiers.length?await Z.findByNpid(t.patient_identifiers[0].identifier):(console.warn(`No patient data or identifiers found for client ID: ${e}`),null)}catch(t){return console.error(`Error processing client ID ${e}:`,t),null}});return(await Promise.all(t)).filter(e=>null!==e)}catch(t){throw console.error("Error in getClientsDemoGraphicData:",t),t}}}}),pe=["colspan"],ue=["onClick"],ge=e("A",J(de,[["render",function(e,t,a,n,i,o){const r=z("ion-col"),l=z("ion-row");return O(),F(N,null,[R(l,null,{default:S(()=>[R(r,null,{default:S(()=>[...t[0]||(t[0]=[j("h1",{style:{width:"100%","text-align":"left","font-weight":"400"}},"Adverse Events Following Immunization - AEFI",-1)])]),_:1})]),_:1}),j("table",null,[(O(!0),F(N,null,V(e.vaccines,(t,a)=>(O(),F("colgroup",{key:a},[j("col",{style:H({width:100/e.vaccines.length+"%"})},null,4)]))),128)),j("thead",null,[j("tr",null,[t[1]||(t[1]=j("th",null,"Cases",-1)),(O(!0),F(N,null,V(e.vaccines,e=>(O(),F("th",{key:e},U(e.name),1))),128))])]),j("tbody",null,[(O(!0),F(N,null,V(e.categories,t=>(O(),F(N,{key:t.name},[j("tr",null,[j("td",{colspan:e.vaccines.length+1,id:"hugo"},[j("strong",null,U(t.name),1)],8,pe)]),(O(!0),F(N,null,V(t.cases,t=>(O(),F("tr",{key:t.name},[j("td",null,U(t.name),1),(O(!0),F(N,null,V(t.data,t=>(O(),F("td",{key:t},[j("div",{style:{cursor:"pointer"},onClick:a=>e.openPersonCardComponent(t.personIds)},U(t.count),9,ue)]))),128))]))),128))],64))),128))])])],64)}],["__scopeId","data-v-704cfbc0"]])),fe=Object.freeze(Object.defineProperty({__proto__:null,default:ge},Symbol.toStringTag,{value:"Module"}));e("a",fe)}}});

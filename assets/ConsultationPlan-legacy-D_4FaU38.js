System.register(["./vendor-legacy-C8iayC_O.js","./index-legacy-u0BlH2rR.js","./DemographicBar-legacy-CN73N-Rr.js","./TreatmentPlan-legacy-TM4AyrOt.js","./NextAppointment-legacy-xTXVKAg7.js","./RiskAssessment.vue_vue_type_script_setup_true_lang-legacy-B8OdRKxi.js","./Vitals.vue_vue_type_script_setup_true_lang-legacy-DcG4vgcg.js","./useFormWizard-legacy-BWrb1eJT.js","./lodash-legacy-pOOc9Efu.js","./formatServerData-legacy-B8xtlE56.js","./Registration-legacy-CPQRZU_L.js","./usePatientProfile-legacy-DTHvTZ9W.js","./apexcharts-legacy-DPtMxIqX.js","./DashBox-legacy-B6ehaSP4.js","./BasicForm-legacy-5bWNhhiu.js","./DateInputField-legacy-B66IONCI.js","./previousDiagnosis-legacy-0DEjFDHK.js","./group_validation-legacy-DkqsUBVp.js","./drug_service-legacy-DuKKMARE.js","./lab_order-legacy-BaHhF9g-.js","./drug_prescription_service-legacy-CVnHWkZy.js","./ncd_appointment_service-legacy-D017x3CS.js","./useLocation-legacy-sKrr2-II.js","./useExposeFromStandardForm-legacy-BcbvbXLH.js","./vaccines_service-legacy-D-Ow5fuF.js","./sms_service-legacy-DXfeNwvd.js","./EIRreportsStore-legacy-CsmqjPqc.js","./Export-legacy-buttaphe.js","./Outcome-legacy-CIjX8mK1.js"],function(e,t){"use strict";var a,n,s,l,i,o,c,u,r,v,g,d,m,p,f,y,h,b,_,D,S,w,C,j,x,A,k,I,T,P,R,N,V,F,B,z,E,L,$,H,M,O,W,G,U,Z,q,J,K,X,Y,Q,ee,te,ae,ne,se,le,ie,oe,ce,ue,re,ve,ge,de;return{setters:[e=>{a=e.d,n=e.ak,s=e.co,l=e.r,i=e.c,o=e.aT,c=e.w,u=e.a,r=e.N,v=e.f,g=e.J,d=e.l,m=e.u,p=e.a8,f=e.k,y=e.m,h=e.i,b=e.bC,_=e.v,D=e.ae,S=e.b7},e=>{w=e.az,C=e.u,j=e.aA,x=e.aB,A=e.aC,k=e.c,I=e.aD,T=e.f,P=e.X,R=e.d,N=e.T,V=e.G,F=e.K,B=e.H,z=e.aE,E=e.aF,L=e.aG,$=e.M,H=e.t,M=e.n,O=e.aH,W=e.aI,G=e.Z,U=e.S},e=>{Z=e.D},e=>{q=e.u,J=e.D,K=e.C,X=e.T},e=>{Y=e.u,Q=e.I,ee=e.N,te=e.M,ae=e.s,ne=e.c,se=e.a},e=>{le=e._},e=>{ie=e._},e=>{oe=e.u,ce=e._},e=>{ue=e.l},e=>{re=e.a,ve=e.b},e=>{ge=e.C},e=>{de=e.u},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){const t={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},me={class:"back_profile"};e("default",a({__name:"ConsultationPlan",setup(e,{expose:a}){const{onTabBeforeChange:pe,onChangeCurrentTab:fe,currentTabIndex:ye}=oe("Consultation Plan"),{printVisitSummary:he}=de(),be=n(),_e=s();l([]),l([]),l(!1);const De=l(!0),Se=l(!1),we=l(!1),Ce=i(()=>({text:we.value?"Saving...":"Finish",icon:we.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:Se.value||we.value})),je=w(),xe=C(),Ae=j(),ke=x();A();const Ie=Y(),Te=k();I();const Pe=T(),Re=q(),Ne=P(),{patient:Ve}=o(xe),{vitals:Fe}=o(je),{investigations:Be}=o(Ae),{diagnosis:ze}=o(ke),{substance:Ee}=o(Pe),{selectedNCDMedicationList:Le}=o(Ie),{FootScreening:$e,visualScreening:He,cvScreening:Me}=o(Re),{sessionDate:Oe}=o(Ne),{apiStatus:We}=o(R());c(Ce,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:ye.value,tabsLength:qe.value.length}),e.disabled!==(null==t?void 0:t.disabled)&&console.log("Done button "+(e.disabled?"disabled":"enabled")),e.text!==(null==t?void 0:t.text)&&console.log(`Done button text changed from "${null==t?void 0:t.text}" to "${e.text}"`)},{deep:!0}),c(we,(e,t)=>{e!==t&&(console.log(`Saving state changed: ${t} -> ${e}`),e?console.log("Starting save process..."):console.log("Save process completed"))});const Ge=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},Ue=()=>{let e=!1;return at(),we.value&&(e=!0),Se.value=e,!e},Ze=()=>Te.NCDActivities.map(e=>({title:e,icon:""})),qe=l(Ze()),Je=l(null),Ke=l(null),Xe=l(null),Ye=l(null),Qe=l(null),et=l(null),tt=l(null),at=()=>{var e;if(!qe.value||0===qe.value.length)return console.log("Tabs not yet initialized"),null;const t=ye.value>=0&&ye.value<qe.value.length?ye.value:0;switch(null===(e=qe.value[t])||void 0===e?void 0:e.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(Te.NCDActivities.length>0)switch(Te.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},nt=()=>{De.value=!1,setTimeout(()=>{ye.value=0,De.value=!0},0)},st=()=>{const e=w();e.setVitals(e.getInitialVitals(Ve.value.ID))},lt=async()=>{const e=F(Oe.value,"sessionDate","value")||B.sessionDate(),t=z("vitals");for(let n=0;n<qe.value.length;n++){const s=qe.value[n];if("Vital Signs"===s.title)qe.value[n].icon=it(e,t)?S:"";else if("Risk Assessment"===s.title){const t=z("substanceAbuse");qe.value[n].icon=it(e,t)?S:""}else if("Investigations"===s.title){var a;const t=null==Ve||null===(a=Ve.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,s=null==t?void 0:t.filter(t=>B.toStandardHisFormat(e)===B.toStandardHisFormat(t.order_date));qe.value[n].icon=(null==s?void 0:s.length)>0?S:""}else if("Diagnosis"===s.title){const t=z("diagnosis");qe.value[n].icon=it(e,t)?S:""}else if("Complications Screening"===s.title){const t=z("screening");qe.value[n].icon=it(e,t)?S:""}else"Treatment Plan"===s.title&&(Le.value.length>0?qe.value[n].icon=te()?S:"":qe.value[n].icon="")}Ue()},it=(e,t)=>{const a=new Date(e);return a.setHours(0,0,0,0),t.some(e=>{const t=new Date(e.obs_datetime);return t.setHours(0,0,0,0),t.getTime()===a.getTime()})},ot=async()=>{we.value=!0;try{const t=[{ref:Je,name:"Vitals"},{ref:Ke,name:"Risk Assessment"},{ref:Xe,name:"Investigations"},{ref:Ye,name:"Diagnosis"},{ref:Qe,name:"Complications Screening"},{ref:et,name:"Treatment Plan"},{ref:tt,name:"Next Appointment"}];for(const a of t)if(a.ref.value&&"function"==typeof a.ref.value.onSubmit)try{await a.ref.value.onSubmit()}catch(e){throw console.error(`Error calling ${a.name} onSubmit:`,e),e}else console.log(`${a.name} component ref not available or no onSubmit method`);await(async()=>{const e=W();if(!ue.isEmpty(e.selectedMedicalAllergiesList)){const t=G(),a=e.selectedMedicalAllergiesList.map(e=>({concept_id:e.concept_id,obs_datetime:U.getSessionDate(),value_coded:e.concept_id,location_id:t.facilityLocation.code,value_text:e.name})),n=await ae(a);Ve.value=Object.assign(Ve.value,n),console.log("Allergies staged successfully:",Ve.value),e.clearSelectedMedicalAllergiesList()}const t=await ne();Ve.value=Object.assign(Ve.value,t);const a=await se().saveNonPharmaTherapyPatientData();Ve.value=Object.assign(Ve.value,a)})(),await(async()=>{const e=[],t=await re(He.value),a=await ve($e.value),n=await re(Me.value);var s,l,i,o;t.length>0&&e.push({concept_id:await O.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:O.getSessionDate(),child:t}),a.length>0&&e.push({concept_id:await O.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:O.getSessionDate(),child:a}),n.length>0&&e.push(...n),e.length>0&&(null!==(l=(s=null!==(o=(i=Ve.value).screening)&&void 0!==o?o:i.screening={}).unsaved)&&void 0!==l||(s.unsaved=[]),Ve.value.screening.unsaved.push(...e),$("Complications saved successfully"))})(),await E(),await L(Ve.value),await ct(),$("Data saved successfully!"),be.push("patientProfile")}catch(e){console.error("Error saving data:",e),H("Error occurred while saving data. Please try again.")}finally{we.value=!1}},ct=async()=>{"dismiss"!==await M(ge,{class:"small-confirm-modal "})&&await he()};return u(async()=>{0!==Te.NCDActivities.length?(q().resetScreening(),qe.value=Ze(),await lt(),(void 0===ye.value||ye.value<0)&&(ye.value=0,console.log("Setting initial tab index to 0")),Se.value=!1,Ue()):be.push("patientProfile")}),c(ye,async()=>{await Ue()}),c(Fe,async()=>{await lt()},{deep:!0}),c(Ve,async()=>{q().resetScreening(),await lt()},{deep:!0}),c(Oe,async()=>{await lt()},{deep:!0}),c(Be,async()=>{await lt()},{deep:!0}),c(ze,async()=>{await lt()},{deep:!0}),c(Ee,async()=>{await lt()},{deep:!0}),c(Le,async()=>{await lt()},{deep:!0}),c(_e,async e=>{nt(),st(),qe.value=Ze()},{deep:!0}),c(Ve,async(e,t)=>{e.ID!=t.ID&&(nt(),st())},{deep:!0}),a({saveData:ot,markWizard:lt,refreshWizard:nt,validateDoneButtonState:Ue}),(e,a)=>(v(),r(m(D),null,{default:g(()=>[d(N),d(m(p),{fullscreen:!0},{default:g(()=>[d(Z),f("div",t,[De.value?(v(),r(ce,{key:0,ref:"wizard","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:Ce.value,"custom-tabs":qe.value,beforeChange:m(pe),onChange:m(fe),"onComplete:wizard":a[1]||(a[1]=e=>ot()),onDoneButtonChanged:Ge},{default:g(()=>[f("div",null,[f("div",me,[d(V,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:m(b),"font-weight":"600",onClick:a[0]||(a[0]=e=>{be.push("patientProfile")})},null,8,["icon"])])]),h(f("div",null,[d(ie,{ref_key:"vitalsRef",ref:Je},null,512)],512),[[_,"Vitals"==at()]]),h(f("div",null,[d(le,{ref_key:"riskAssessmentRef",ref:Ke},null,512)],512),[[_,"RiskAssessment"==at()]]),h(f("div",null,[d(Q,{ref_key:"investigationsRef",ref:Xe},null,512)],512),[[_,"Investigations"==at()]]),h(f("div",null,[d(J,{ref_key:"diagnosisRef",ref:Ye},null,512)],512),[[_,"DiagnosisComponent"==at()]]),h(f("div",null,[d(K,{ref_key:"complicationsRef",ref:Qe},null,512)],512),[[_,"ComplicationsScreening"==at()]]),h(f("div",null,[d(X,{ref_key:"treatmentPlanRef",ref:et},null,512)],512),[[_,"TreatmentPlan"==at()]]),h(f("div",null,[d(ee,{ref_key:"nextAppointmentRef",ref:tt},null,512)],512),[[_,"NextAppointment"==at()]])]),_:1},8,["doneButton","custom-tabs","beforeChange","onChange"])):y("",!0)])]),_:1})]),_:1}))}}))}}});

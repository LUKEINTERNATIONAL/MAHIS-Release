System.register(["./vendor-legacy-BZxCa0cX.js","./index-legacy-Ceg9NrRI.js","./DemographicBar-legacy-DM7dpiOK.js","./OPDOutcome-legacy-GrDr39sk.js","./NextAppointment-legacy-CDLDNBQS.js","./OPDPrintingModal-legacy-k6p_aqNz.js","./lodash-legacy-pOOc9Efu.js","./usePatientProfile-legacy-BdYz5Jj9.js","./formatServerData-legacy-zJJN_UYS.js","./diagnosis-legacy-DbldITxV.js","./apexcharts-legacy-RFRzQ_eY.js","./BasicForm-legacy-BK9BNWwv.js","./DateInputField-legacy-CBLnVWny.js","./patient_complaints_service-legacy-BxpPHoEe.js","./DashBox-legacy-D50awMvH.js","./useExposeFromStandardForm-legacy-MT9V6lbX.js","./BasicCard-legacy-BMAM6MJv.js","./lab_order-legacy--50EMpIc.js","./group_validation-legacy-C87rQmR3.js","./LabTestsHistory-legacy-CzrGb8LX.js","./userService-legacy-BqR6vQ1S.js","./drug_prescription_service-legacy-DyYVh9zK.js","./drug_service-legacy-BKQvGdq6.js","./Outcome-legacy-B0lrK4YS.js","./ncd_appointment_service-legacy-DA7aiLPU.js","./Registration-legacy-tVHI7Vj1.js","./useLocation-legacy-CuMI5fH7.js","./vaccines_service-legacy-D6fJjoz1.js","./sms_service-legacy-BMp8fJNY.js","./EIRreportsStore-legacy-d9fncAnY.js","./Export-legacy-D32MgbYK.js"],function(e,a){"use strict";var t,n,l,s,i,o,r,c,u,d,v,g,m,p,y,h,f,w,b,D,x,C,P,I,_,T,S,j,O,A,F,N,k,E,L,H,B,M,R,q,z,V,U,Y,$,W,Z,J,G,Q,X,K,ee,ae,te,ne,le,se,ie,oe,re,ce,ue,de,ve,ge,me,pe,ye,he,fe;return{setters:[e=>{t=e.r,n=e.a,l=e.n,s=e.d,i=e.au,o=e.cl,r=e.b2,c=e.w,u=e.y,d=e.f,v=e.z,g=e.l,m=e.e,p=e.m,y=e.k,h=e.u,f=e.bM,w=e.d5,b=e.a9,D=e.dF,x=e.i,C=e.bG,P=e.v,I=e.af},e=>{_=e.u,T=e.aC,S=e.aS,j=e.a0,O=e.b,A=e.aI,F=e.M,N=e.a1,k=e.aT,E=e.aU,L=e.aV,H=e.aW,B=e.aX,M=e.aY,R=e.T,q=e.D,z=e.y,V=e.m,U=e.H,Y=e.aJ,$=e.aZ,W=e.aw,Z=e.j,J=e.k,G=e.t,Q=e.S,X=e.a7,K=e._},e=>{ee=e.D},e=>{ae=e.C,te=e.I,ne=e.O,le=e.a,se=e.b},e=>{ie=e.N,oe=e.T,re=e.a,ce=e.d,ue=e.b,de=e.s},e=>{ve=e.O},e=>{ge=e.l},e=>{me=e.u},e=>{pe=e.f,ye=e.c,he=e.a},e=>{fe=e.D},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".spinner-overlay[data-v-2d18f977]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;background-color:rgba(255,255,255,.5);z-index:9999}ion-spinner[data-v-2d18f977]{width:80px;height:80px}.loading-text[data-v-2d18f977]{margin-top:20px;font-size:18px;color:#333}.pause-alert[data-v-2d18f977]{background-color:#f8d7da;color:#721c24;padding:10px;border:1px solid #f5c6cb;border-radius:5px;margin-bottom:1px;text-align:center}.loading[data-v-2d18f977]{pointer-events:none}.back_profile[data-v-2d18f977]{margin-bottom:10px}\n/*$vite$:1*/",document.head.appendChild(a);const we={key:0,class:"spinner-overlay"},be={class:"back_profile"};e("default",K(s({__name:"ConsultationPlan",setup(e){const{onTabBeforeChange:a,onChangeCurrentTab:s,currentTabIndex:K}=((e,a)=>{const s=t(""),i=a=>{const t=document.getElementsByClassName("form-wizard-vue");if(!t.length)return;const n=t[0].getElementsByClassName("fw-body-list");if(!n.length)return;const l=n[0].querySelector(".fw-custom-title");l&&l.remove();const s=document.createElement("li");s.className="fw-custom-title",s.textContent=a||e,s.style.cssText="\n            text-align: center;\n            font-weight: 700;\n            font-size: 18px;\n            flex-grow: 0.08;\n            padding: 10px 0;\n        ",n[0].insertBefore(s,n[0].firstChild)};return n(()=>{i()}),{currentTabIndex:s,onChangeCurrentTab:async(e,t)=>{if(e%1==0){if(null!=a&&a.onTabChange)try{await a.onTabChange(e,t)}catch(n){return void console.error("Error in custom tab change handler:",n)}s.value=e}},onTabBeforeChange:async(e,t)=>{var n;if(0===s.value&&console.log("First Tab"),null!=a&&null!==(n=a.tabValidations)&&void 0!==n&&n[e])try{if(!(await a.tabValidations[e]()))return console.log("Tab validation failed, preventing navigation"),!1}catch(l){return console.error("Error in tab validation:",l),!1}return console.log("All Tabs"),!0},changeBtnIconPosition:()=>{l(()=>{const e=document.querySelector(".fw-footer-left .fw-btn");if(console.log("ðŸš€ ~ changeBtnIconPosition ~ button:",e),!e)return;const a=e.querySelector("span"),t=e.querySelector("i");a&&t&&(e.removeChild(a),e.removeChild(t),e.appendChild(t),e.appendChild(a))})},addHeaderAboveList:i}})("Consultation Plan",{onTabChange:async(e,a)=>{console.log(`Tab changed from ${a} to ${e}`),0===a&&"Clinical Assessment"===De(a)&&(console.log("Leaving Clinical Assessment tab - saving data..."),await ba())},tabValidations:{0:async()=>{if("Clinical Assessment"===De(0)){var e;const a=await X.getAll(Ye.value.patientID,"Presenting complaint");let t=[];if(a&&(t=a.filter(e=>U.toStandardHisFormat(U.sessionDate())===U.toStandardHisFormat(e.obs_datetime))),!((null===(e=ea.value[0])||void 0===e||null===(e=e.selectedData)||void 0===e?void 0:e.length)>0||t.length>0))return G("Patient complaints are required before proceeding to the next step"),!1}return!0}}}),De=e=>{var a;return!ma.value||e>=ma.value.length||e<0?"":(null===(a=ma.value[e])||void 0===a?void 0:a.title)||""},{printVisitSummary:xe}=me(),Ce=i(),Pe=o(),Ie=t(!1),_e=t(!1),Te=t(!0),Se=t(!1),je=t(!1),Oe=t(!1),Ae=_(),Fe=T(),Ne=S(),ke=j(),Ee=O(),Le=A(),He=F(),Be=N(),Me=k(),Re=E(),qe=L(),ze=H(),Ve=B(),Ue=M(),{patient:Ye}=r(Ae),{investigations:$e}=r(Fe),{OPDdiagnosis:We}=r(Ne),{selectedMedicalDrugsList:Ze,nonPharmalogicalTherapyAndOtherNotes:Je,selectedMedicalAllergiesList:Ge}=r(ke),{OPDActivities:Qe}=r(Ee),{outcomes:Xe}=r(Le),{currentSelectedNextAppointmentDate:Ke}=r(Me),{presentingComplaints:ea}=r(Re),{pregnancy:aa}=r(qe),{pastMedicalHistory:ta}=r(ze),{adult:na,minor:la}=r(Ve),{physicalExam:sa}=r(Ue),{vitals:ia}=r(Be),oa=t(null),ra=t(null),ca=t(null),ua=t(null),da=t(null),va=t(null),ga=()=>Qe.value.map(e=>({title:e,icon:""})),ma=t(ga()),pa=()=>{var e;if(!ma.value||0===ma.value.length)return null;const a=K.value>=0&&K.value<ma.value.length?K.value:0;switch(null===(e=ma.value[a])||void 0===e?void 0:e.title){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome";default:if(Qe.value.length>0)switch(Qe.value[0]){case"Clinical Assessment":return"ClinicalAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"OPDDiagnosis";case"Treatment Plan":return"OPDTreatmentPlan";case"Next Appointment":return"NextAppointment";case"Outcome":return"Outcome"}return null}},ya=async()=>{_e.value=!0,z("Printing consultation summary... Please wait.");try{await xe(),z("Consultation summary printed successfully!"),setTimeout(()=>{Ce.push("home")},3500)}catch(e){V("Failed to print consultation summary.")}finally{_e.value=!1}},ha=()=>{z("Patient has finished consultation!"),Ce.push("home")},fa=async()=>{const e=U.sessionDate();Y("vitals");for(let t=0;t<ma.value.length;t++){const n=ma.value[t];if("Clinical Assessment"===n.title){const a=Y("presentingComplaints");ma.value[t].icon=wa(e,a)?"check":""}else if("Investigations"===n.title){var a;const n=null===(a=Ye.value)||void 0===a||null===(a=a.labOrders)||void 0===a?void 0:a.saved,l=null==n?void 0:n.filter(a=>U.toStandardHisFormat(e)===U.toStandardHisFormat(a.order_date));ma.value[t].icon=(null==l?void 0:l.length)>0?"check":""}else if("Diagnosis"===n.title){const a=Y("diagnosis");ma.value[t].icon=wa(e,a)?"check":""}else if("Treatment Plan"===n.title){const e=Y("treatment");ma.value[t].icon=(null==e?void 0:e.length)>0?"check":""}else if("Next Appointment"===n.title){const a=Y("appointments");ma.value[t].icon=wa(e,a)?"check":""}else if("Outcome"===n.title){const e=Y("outcomes");ma.value[t].icon=(null==e?void 0:e.length)>0?"check":""}}},wa=(e,a)=>{if(!a)return!1;const t=new Date(e);return t.setHours(0,0,0,0),a.some(e=>{const a=new Date(e.obs_datetime||e.order_date);return a.setHours(0,0,0,0),a.getTime()===t.getTime()})},ba=async()=>{Ie.value=!0;try{var e;const a=await X.getAll(Ye.value.patientID,"Presenting complaint");let t=[];if(a&&(t=a.filter(e=>U.toStandardHisFormat(U.sessionDate())===U.toStandardHisFormat(e.obs_datetime))),!((null===(e=ea.value[0])||void 0===e||null===(e=e.selectedData)||void 0===e?void 0:e.length)>0||t.length>0))throw G("Patient complaints are required"),new Error("Patient complaints are required");await Promise.all([Da(),xa(),Ca(),Pa(),_a(),Ia()]),await W(Ye.value),$()}catch(a){throw console.error("Error saving clinical assessment:",a),V("Failed to save clinical assessment"),a}finally{Ie.value=!1}},Da=async()=>{try{const l=U.getAgeInYears(Ye.value.personInformation.birthdate)<18?await pe(la.value):await pe(na.value);var e,a,t,n;l.length>0&&(null!==(a=(e=null!==(n=(t=Ye.value).levelOfConsciousness)&&void 0!==n?n:t.levelOfConsciousness={}).unsaved)&&void 0!==a||(e.unsaved=[]),Ye.value.levelOfConsciousness.unsaved.push(...l),z("Level of Consciousness saved successfully"))}catch(l){console.error("Failed to save consciousness assessment:",l),G("Failed to save consciousness assessment")}},xa=async()=>{try{var e;const s=Ta((null===(e=ea.value[0])||void 0===e?void 0:e.selectedData)||[]);var a,t,n,l;s.length>0&&(null!==(t=(a=null!==(l=(n=Ye.value).presentingComplaints)&&void 0!==l?l:n.presentingComplaints={}).unsaved)&&void 0!==t||(a.unsaved=[]),Ye.value.presentingComplaints.unsaved.push(...s),z("Patient complaints saved successfully"))}catch(s){console.error("Failed to save presenting complaints:",s),G("Failed to save presenting complaints")}},Ca=async()=>{try{const l=await pe(aa.value);var e,a,t,n;l.length>0&&(null!==(a=(e=null!==(n=(t=Ye.value).pregnancy)&&void 0!==n?n:t.pregnancy={}).unsaved)&&void 0!==a||(e.unsaved=[]),Ye.value.pregnancy.unsaved.push(...l),z("Pregnancy status saved successfully"))}catch(l){console.error("Failed to save pregnancy status:",l),G("Failed to save pregnancy status")}},Pa=async()=>{try{const l=await Sa();var e,a,t,n;l.length>0&&(null!==(a=(e=null!==(n=(t=Ye.value).pastMedicalHistory)&&void 0!==n?n:t.pastMedicalHistory={}).unsaved)&&void 0!==a||(e.unsaved=[]),Ye.value.pastMedicalHistory.unsaved.push(...l),z("Past medical history saved successfully"))}catch(l){console.error("Failed to save past medical history:",l),G("Failed to save past medical history")}},Ia=async()=>{try{const l=await ja();var e,a,t,n;l.length>0&&(null!==(a=(e=null!==(n=(t=Ye.value).physicalExam)&&void 0!==n?n:t.physicalExam={}).unsaved)&&void 0!==a||(e.unsaved=[]),Ye.value.physicalExam.unsaved.push(...l),z("Physical examination saved successfully"))}catch(l){console.error("Failed to save physical examination:",l),G("Failed to save physical examination")}},_a=async()=>{try{const e=localStorage.getItem("userID"),a=Ye.value.patientID;if(!ge.isEmpty(Ge.value)){const t=Oa(),n=new oe;await n.onSubmitAllergies(a,e,t),await de(t)}}catch(e){console.error("Failed to save allergies:",e),G("Failed to save allergies")}},Ta=e=>e?e.map(e=>(null==e?void 0:e.data[0])||(null==e?void 0:e.data)):[],Sa=async()=>[...await ye(ta.value),...await pe(ta.value),...await he(ta.value)],ja=async()=>[...await ye(sa.value),...await pe(sa.value),...await he(sa.value)],Oa=()=>Ge.value.map(e=>({concept_id:985,obs_datetime:Q.getSessionDate(),value_coded:e.concept_id,location_id:He.facilityLocation.code})),Aa=async()=>{try{await(async()=>{try{var e;if((null===(e=We.value[0])||void 0===e||null===(e=e.selectedData)||void 0===e?void 0:e.length)>0){var a,t,n,l;const e=localStorage.getItem("userID"),s=new fe;await s.onSubmit(Ye.value.patientID,e,Ta(We.value[0].selectedData));const i=Ta(We.value[0].selectedData);null!==(t=(a=null!==(l=(n=Ye.value).diagnosis)&&void 0!==l?l:n.diagnosis={}).unsaved)&&void 0!==t||(a.unsaved=[]),Ye.value.diagnosis.unsaved.push(...i)}We.value[0].selectedData=[]}catch(s){console.error("Failed to save diagnosis:",s),G("Failed to save diagnosis")}})(),await(async()=>{try{const e=localStorage.getItem("userID"),a=Ye.value.patientID,t=new oe;if(!ge.isEmpty(Ge.value)){const n=Oa();await t.onSubmitAllergies(a,e,n)}if(!ge.isEmpty(Je.value)){const e=[{concept_id:2688,obs_datetime:localStorage.getItem("sessionDate"),value_text:Je.value,location_id:He.facilityLocation.code}];await re(e)}await ce(),await ue().saveNonPharmaTherapyPatientData()}catch(e){console.error("Failed to save treatment plan:",e),G("Failed to save treatment plan")}})(),await Le.saveOutcomPatientData(),await $(),await W(Ye.value);const e=localStorage.getItem("locationID"),a=localStorage.getItem("userRoles");if(!e)return void V("Location ID could not be found. Please check your settings.");const t=a?JSON.parse(a):[];t.some(e=>"Lab"===e.role)?(await Z.movePatientToNextStage(Ye.value.patientID,"LAB","CONSULTATION",e,Ye.value.visitID||Ye.value.visit_id),await J().refresh(e),await Ce.push("home"),z("Lab results submitted. Patient can return to consultation")):(await Z.movePatientToNextStage(Ye.value.patientID,"CONSULTATION","DISPENSATION",e,Ye.value.visitID||Ye.value.visit_id),await J().refresh(e),await Ce.push("home"),z("Consultation patient saved successfully."))}catch(e){console.error("Error saving consultation data:",e),V("Failed to save consultation data")}};return n(async()=>{0!==Qe.value.length?(ma.value=ga(),await fa(),(void 0===K.value||K.value<0)&&(K.value=0)):await Ce.push("home")}),c(ia,async()=>{await fa()},{deep:!0}),c(Ye,async()=>{await fa()},{deep:!0}),c($e,async()=>{await fa()},{deep:!0}),c(We,async()=>{await fa()},{deep:!0}),c(Ze,async()=>{await fa()},{deep:!0}),c(Xe,async()=>{await fa()},{deep:!0}),c(Ke,async()=>{await fa()}),c(ea,async()=>{await fa()},{deep:!0}),c(Pe,async()=>{Te.value=!1,setTimeout(()=>{K.value=0,Te.value=!0},0)},{deep:!0}),c(Oe,e=>{je.value=e,je.value&&setTimeout(()=>{je.value=!1},15e3)}),(e,t)=>(d(),u(h(I),null,{default:v(()=>[g(ve,{onYes:ya,onNo:ha,isOpen:Se.value,title:"Do you want to print the consultation summary?"},null,8,["isOpen"]),Ie.value?(d(),m("div",we,[g(h(f),{name:"bubbles"}),t[2]||(t[2]=y("div",{class:"loading-text"},"Please wait...",-1))])):p("",!0),g(h(w),{"is-open":_e.value,message:"Printing consultation summary...",spinner:"circles"},null,8,["is-open"]),g(R),g(h(b),{fullscreen:!0},{default:v(()=>[g(ee),Te.value?(d(),u(h(D),{key:0,ref:"wizard","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:{text:"Finish",icon:"check",hideText:!1,hideIcon:!1,disabled:!1},"custom-tabs":ma.value,beforeChange:h(a),onChange:h(s),"onComplete:wizard":t[1]||(t[1]=e=>Aa())},{default:v(()=>[y("div",null,[y("div",be,[g(q,{name:"Back to Waiting list",iconSlot:"start",fill:"clear",icon:h(C),"font-weight":"600",onClick:t[0]||(t[0]=e=>{Ce.push("home")})},null,8,["icon"])])]),x(y("div",null,[g(ae,{ref_key:"clinicalAssessmentRef",ref:oa},null,512)],512),[[P,"ClinicalAssessment"===pa()]]),x(y("div",null,[g(te,{ref_key:"investigationsRef",ref:ra},null,512)],512),[[P,"Investigations"===pa()]]),x(y("div",null,[g(ne,{ref_key:"diagnosisRef",ref:ca},null,512)],512),[[P,"OPDDiagnosis"===pa()]]),x(y("div",null,[g(le,{ref_key:"treatmentPlanRef",ref:ua},null,512)],512),[[P,"OPDTreatmentPlan"===pa()]]),x(y("div",null,[g(ie,{ref_key:"nextAppointmentRef",ref:da},null,512)],512),[[P,"NextAppointment"===pa()]]),x(y("div",null,[g(se,{ref_key:"outcomeRef",ref:va},null,512)],512),[[P,"Outcome"===pa()]])]),_:1},8,["custom-tabs","beforeChange","onChange"])):p("",!0)]),_:1})]),_:1}))}}),[["__scopeId","data-v-2d18f977"]]))}}});

import{d as Ae,aH as Re,ck as Pe,r,c as Te,aR as d,w as c,a as xe,O as j,f as G,J as B,l as m,u as k,a7 as Ne,k as g,m as Ie,i as h,bC as Be,v as D,aa as Ve,b6 as C}from"./vendor-CwfdTqwT.js";import{aE as U,u as Me,aF as Fe,aG as $e,aH as He,c as ze,aI as Le,f as Ee,Z as We,d as je,T as Ge,M as Ue,Q as Je,H as V,aJ as A,aK as J,aL as Ke,t as K,n as Qe,aM as R,K as Ze,aN as qe,a0 as Xe,S as Ye}from"./index-Cff1pBEK.js";import{D as Oe}from"./DemographicBar-2RJhMUy1.js";import{u as M,D as et,C as tt,T as at}from"./TreatmentPlan-BAkCCvGz.js";import{u as st,I as nt,N as it,M as ot,s as rt,c as lt,a as ct}from"./NextAppointment-BUUJgty5.js";import{_ as ut}from"./RiskAssessment.vue_vue_type_script_setup_true_lang-Dwy9GFFO.js";import{_ as mt}from"./Vitals.vue_vue_type_script_setup_true_lang-6tDBPBky.js";import{u as vt,_ as gt}from"./useFormWizard-ev9mvLMJ.js";import{l as ft}from"./lodash-NJiRuGo9.js";import{a as Q,b as dt}from"./formatServerData-g5Vf7xoz.js";import{C as pt}from"./Registration-CyWqKpM0.js";import{u as St}from"./usePatientProfile-BJ5eHYCC.js";import"./apexcharts-DLFGMM_U.js";import"./DashBox-Cq9X4IHD.js";import"./BasicForm-BZPnz1QA.js";import"./DateInputField-DBM39pqM.js";import"./previousDiagnosis-Vdi-ITSY.js";import"./group_validation-DJiIFTtY.js";import"./drug_service-VIlUmLWA.js";import"./lab_order-GKUpFKFY.js";import"./drug_prescription_service-BxW-QWYj.js";import"./ncd_appointment_service-qJdXd4zX.js";import"./useLocation-CD2kR6sD.js";import"./useExposeFromStandardForm-CnoPDanM.js";import"./vaccines_service-BVK85nEP.js";import"./sms_service-eXnPbfqe.js";import"./EIRreportsStore-BPeEJhe1.js";import"./Export-L2KzyDNz.js";import"./Outcome-DTOHPMel.js";const ht={style:{width:"88vw",margin:"0 auto","margin-top":"10px"}},Dt={class:"back_profile"},Xt=Ae({__name:"ConsultationPlan",setup(bt,{expose:Z}){const{onTabBeforeChange:q,currentTabIndex:v}=vt("Consultation Plan"),{printVisitSummary:X}=St(),P=Re(),Y=Pe();r([]),r([]),r(!1);const T=r(!0),x=r(!1),S=r(!1),F=Te(()=>({text:S.value?"Saving...":"Finish",icon:S.value?"hourglass-outline":"checkmark",hideText:!1,hideIcon:!1,disabled:x.value||S.value})),O=U(),ee=Me(),te=Fe(),ae=$e();He();const se=st(),y=ze();Le();const ne=Ee(),ie=M(),oe=We(),{patient:n}=d(ee),{vitals:re}=d(O),{investigations:le}=d(te),{diagnosis:ce}=d(ae),{substance:ue}=d(ne),{selectedNCDMedicationList:$}=d(se),{FootScreening:me,visualScreening:ve,cvScreening:ge}=d(ie),{sessionDate:H}=d(oe),{apiStatus:Ct}=d(je());c(F,(e,t)=>{console.log("Done button options changed:",{from:t,to:e,currentStep:v.value,tabsLength:i.value.length}),e.disabled!==(t==null?void 0:t.disabled)&&console.log("Done button ".concat(e.disabled?"disabled":"enabled")),e.text!==(t==null?void 0:t.text)&&console.log('Done button text changed from "'.concat(t==null?void 0:t.text,'" to "').concat(e.text,'"'))},{deep:!0}),c(S,(e,t)=>{e!==t&&(console.log("Saving state changed: ".concat(t," -> ").concat(e)),console.log(e?"Starting save process...":"Save process completed"))});const fe=e=>{console.log("Done button change received from wizard:",e),e.newOptions.disabled&&console.log("Done button has been disabled"),e.isLastStep&&console.log("User is on the last step, done button should be visible")},_=()=>{let e=!1;return p(),S.value&&(e=!0),x.value=e,!e},de=()=>{P.push("patientProfile")},N=()=>y.NCDActivities.map(e=>({title:e,icon:""})),i=r(N()),z=r(null),L=r(null),pe=r(null),Se=r(null),he=r(null),De=r(null),be=r(null),p=()=>{var a;if(!i.value||i.value.length===0)return console.log("Tabs not yet initialized"),null;const e=v.value>=0&&v.value<i.value.length?v.value:0;switch((a=i.value[e])==null?void 0:a.title){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment";default:if(y.NCDActivities.length>0)switch(y.NCDActivities[0]){case"Vital Signs":return"Vitals";case"Risk Assessment":return"RiskAssessment";case"Investigations":return"Investigations";case"Diagnosis":return"DiagnosisComponent";case"Complications Screening":return"ComplicationsScreening";case"Treatment Plan":return"TreatmentPlan";case"Next Appointment":return"NextAppointment"}return null}},I=()=>{T.value=!1,setTimeout(()=>{v.value=0,T.value=!0},0)},E=()=>{const e=U();e.setVitals(e.getInitialVitals(n.value.ID))},f=async()=>{var a,l;const e=Je(H.value,"sessionDate","value")||V.sessionDate(),t=A("vitals");for(let s=0;s<i.value.length;s++){const u=i.value[s];if(u.title==="Vital Signs")i.value[s].icon=w(e,t)?C:"";else if(u.title==="Risk Assessment"){const o=A("substanceAbuse");i.value[s].icon=w(e,o)?C:""}else if(u.title==="Investigations"){const o=(l=(a=n==null?void 0:n.value)==null?void 0:a.labOrders)==null?void 0:l.saved,b=o==null?void 0:o.filter(ke=>V.toStandardHisFormat(e)===V.toStandardHisFormat(ke.order_date));i.value[s].icon=(b==null?void 0:b.length)>0?C:""}else if(u.title==="Diagnosis"){const o=A("diagnosis");i.value[s].icon=w(e,o)?C:""}else if(u.title==="Complications Screening"){const o=A("screening");i.value[s].icon=w(e,o)?C:""}else u.title==="Treatment Plan"&&($.value.length>0?i.value[s].icon=ot()?C:"":i.value[s].icon="")}_()},w=(e,t)=>{const a=new Date(e);return a.setHours(0,0,0,0),t.some(l=>{const s=new Date(l.obs_datetime);return s.setHours(0,0,0,0),s.getTime()===a.getTime()})},Ce=async()=>{var s,u,o,b;const e=[],t=await Q(ve.value),a=await dt(me.value),l=await Q(ge.value);t.length>0&&e.push({concept_id:await R.getConceptID("Visual acuity",!0),value_text:"visual acuity test",obs_datetime:R.getSessionDate(),child:t}),a.length>0&&e.push({concept_id:await R.getConceptID("Foot check",!0),value_text:"foot screening",obs_datetime:R.getSessionDate(),child:a}),l.length>0&&e.push(...l),e.length>0?((b=(o=(u=(s=n.value).screening)!=null?u:s.screening={}).unsaved)!=null||(o.unsaved=[]),n.value.screening.unsaved.push(...e),Ze("Complications saved successfully")):K("No complications data to save")},ye=async()=>{const e=qe();if(!ft.isEmpty(e.selectedMedicalAllergiesList)){const l=Xe(),s=e.selectedMedicalAllergiesList.map(o=>({concept_id:o.concept_id,obs_datetime:Ye.getSessionDate(),value_coded:o.concept_id,location_id:l.facilityLocation.code,value_text:o.name})),u=await rt(s);n.value=Object.assign(n.value,u),console.log("Allergies staged successfully:",n.value),e.clearSelectedMedicalAllergiesList()}const t=await lt();n.value=Object.assign(n.value,t);const a=await ct().saveNonPharmaTherapyPatientData();n.value=Object.assign(n.value,a)},_e=async(e,t)=>{var a,l;e%1===0&&(v.value=e),t==0&&((a=z.value)==null||a.onSubmit()),t==1&&((l=L.value)==null||l.onSubmit()),t==4&&await Ce(),t==5&&await ye(),await J(n.value)},W=async()=>{S.value=!0;try{await Ke(),await J(n.value),await we(),P.push("patientProfile")}catch(e){console.error("Error saving data:",e),K("Error occurred while saving data. Please try again.")}finally{S.value=!1}},we=async()=>{await Qe(pt,{class:"small-confirm-modal "})!=="dismiss"&&await X()};return xe(async()=>{if(y.NCDActivities.length===0){P.push("patientProfile");return}M().resetScreening(),i.value=N(),await f(),(v.value===void 0||v.value<0)&&(v.value=0,console.log("Setting initial tab index to 0")),x.value=!1,_()}),c(v,async()=>{await _()}),c(re,async()=>{await f()},{deep:!0}),c(n,async()=>{M().resetScreening(),await f()},{deep:!0}),c(H,async()=>{await f()},{deep:!0}),c(le,async()=>{await f()},{deep:!0}),c(ce,async()=>{await f()},{deep:!0}),c(ue,async()=>{await f()},{deep:!0}),c($,async()=>{await f()},{deep:!0}),c(Y,async e=>{I(),E(),i.value=N()},{deep:!0}),c(n,async(e,t)=>{e.ID!=t.ID&&(I(),E())},{deep:!0}),Z({saveData:W,markWizard:f,refreshWizard:I,validateDoneButtonState:_}),(e,t)=>(G(),j(k(Ve),null,{default:B(()=>[m(Ge),m(k(Ne),{fullscreen:!0},{default:B(()=>[m(Oe),g("div",ht,[T.value?(G(),j(gt,{key:0,ref:"wizard","vertical-tabs":"","navigable-tabs":"","scrollable-tabs":"",startIndex:0,doneButton:F.value,"custom-tabs":i.value,beforeChange:k(q),onChange:_e,"onComplete:wizard":t[1]||(t[1]=a=>W()),onDoneButtonChanged:fe},{default:B(()=>[g("div",null,[g("div",Dt,[m(Ue,{name:"Back to profile",iconSlot:"start",fill:"clear",icon:k(Be),"font-weight":"600",onClick:t[0]||(t[0]=a=>de())},null,8,["icon"])])]),h(g("div",null,[m(mt,{ref_key:"vitalsRef",ref:z},null,512)],512),[[D,p()=="Vitals"]]),h(g("div",null,[m(ut,{ref_key:"riskAssessmentRef",ref:L},null,512)],512),[[D,p()=="RiskAssessment"]]),h(g("div",null,[m(nt,{ref_key:"investigationsRef",ref:pe},null,512)],512),[[D,p()=="Investigations"]]),h(g("div",null,[m(et,{ref_key:"diagnosisRef",ref:Se},null,512)],512),[[D,p()=="DiagnosisComponent"]]),h(g("div",null,[m(tt,{ref_key:"complicationsRef",ref:he},null,512)],512),[[D,p()=="ComplicationsScreening"]]),h(g("div",null,[m(at,{ref_key:"treatmentPlanRef",ref:De},null,512)],512),[[D,p()=="TreatmentPlan"]]),h(g("div",null,[m(it,{ref_key:"nextAppointmentRef",ref:be},null,512)],512),[[D,p()=="NextAppointment"]])]),_:1},8,["doneButton","custom-tabs","beforeChange"])):Ie("",!0)])]),_:1})]),_:1}))}});export{Xt as default};

import{d as j,r as m,c as z,a as Y,H as q,N as _,f as n,J as o,l as b,u,a8 as J,k as l,m as A,bh as Q,a9 as X,e as d,F as y,O as p,aa as Z,aR as ee,aO as ae,ab as te,a1 as le,b1 as H,P as h,K as V,bl as ne,M as N,ae as ie}from"./vendor-B1apQUd8.js";import{P as R,T as se,ad as v,H as D,ac as E,_ as oe}from"./index-j3x6tfaM.js";import{R as ue}from"./relationship_service-BaIlAYXb.js";import{l as O}from"./lodash-NJiRuGo9.js";import"./apexcharts-CA9696WM.js";const re={class:"styled-table"},ce={key:0},de=["innerHTML"],be={key:1},ve={class:"modal-content"},ge=j({__name:"Mastercard",setup(me){const B=m([]),k=m([]),a=new R,T=m([]),w=m(!1),S=m([]),x=z(()=>O.chunk(k.value,7)),P=m(!1),f=m(!1);function C(e){return B.value.includes(e)?"Yes":"No"}function L(){k.value=[{label:"ARV Number",value:"...",staticValue:()=>a.getArvNumber(),other:{editable:!0,category:"arv_number"}},{label:"National Patient ID",value:"...",staticValue:()=>a.getNationalID()},{label:"Given Name",value:"...",staticValue:()=>a.getGivenName(),other:{editable:!0,attribute:"given_name",category:"demographics"}},{label:"Family Name",value:"...",staticValue:()=>a.getFamilyName(),other:{editable:!0,attribute:"family_name",category:"demographics"}},{label:"Age",value:"...",staticValue:()=>a.getAge(),other:{editable:!0,attribute:"year_birth_date",category:"demographics"}},{label:"Sex",value:"...",staticValue:()=>a.getGender(),other:{editable:!0,attribute:"gender",category:"demographics"}},{label:"Location",value:"...",staticValue:()=>a.getCurrentVillage(),other:{editable:!0,attribute:"home_region",category:"demographics"}},{label:"Landmark",value:"..."},{label:"Guardian",value:"...",asyncValue:async e=>{const t=await ue.getGuardianDetails(a.getID());return O.isEmpty(t)?(e.other.editable=!0,"add"):t.map(r=>" ".concat(r.name," (").concat(r.relationshipType,")")).join(" ")},other:{editable:!1,attribute:"",category:"guardian"}},{label:"Init W(KG)",value:"...",asyncValue:()=>a.getInitialWeight()},{label:"Init H(CM)",value:"...",asyncValue:()=>a.getInitialHeight()},{label:"Init BMI",value:"...",asyncValue:()=>a.getInitialBMI()},{label:"init Preg",value:"...",condition:()=>a.isFemale(),asyncValue:()=>a.getInitialObs("Is patient pregnant","value_coded")},{label:"init Breastfeeding",value:"...",condition:()=>a.isFemale(),asyncValue:()=>a.getInitialObs("Is patient breast feeding","value_coded")},{label:"cur Preg",value:"...",condition:()=>a.isFemale(),asyncValue:async()=>await a.isPregnant()?"Yes":"No"},{label:"cur Breastfeeding",value:"...",condition:()=>a.isFemale(),asyncValue:async()=>await a.isBreastfeeding()?"Yes":"No"},{label:"TI",value:"...",asyncValue:()=>v.getFirstValueCoded(a.getID(),"Ever received ART")},{label:"Agrees to follow up",value:"...",asyncValue:()=>v.getFirstValueCoded(a.getID(),"Agrees to followup")},{label:"Reason for starting ART",value:"...",asyncValue:()=>v.getFirstValueCoded(a.getID(),"Reason for ART eligibility")},{label:"HIV test date",value:"...",asyncValue:async()=>{const e=await v.getFirstValueDatetime(a.getID(),"Confirmatory HIV test date");return e?D.toStandardHisDisplayFormat(e):""}},{label:"HIV test place",value:"...",asyncValue:()=>v.getFirstValueText(a.getID(),"Confirmatory HIV test location")},{label:"Date of starting first line ART",value:"...",asyncValue:async()=>{const e=await v.getFirstValueDatetime(a.getID(),"Date ART started");return e?D.toStandardHisDisplayFormat(e):""}},{label:"Pulmonary TB within the last 2 years",value:"...",init:async()=>{B.value=await v.getAllValueCoded(a.getID(),"Who stages criteria present")||[]},staticValue:()=>C("Tuberculosis (PTB or EPTB) within the last 2 years")},{label:"Extra pulmonary TB (EPTB)",value:"...",staticValue:()=>C("Extrapulmonary tuberculosis (EPTB)")},{label:"Pulmonary TB (current)",value:"...",staticValue:()=>C("Pulmonary tuberculosis (current)")},{label:"Kaposis sarcoma",value:"...",staticValue:()=>C("Kaposis sarcoma")}]}async function G(){for(const e of k.value)typeof e.init=="function"&&await e.init(),typeof e.condition=="function"?e.visible=e.condition():e.visible=!0,typeof e.asyncValue=="function"?e.asyncValue(e).then(t=>e.value=t||""):typeof e.staticValue=="function"&&(e.value=e.staticValue())}function K(){return P.value=!1,f.value=!0,R.getPatientVisits(a.getID(),!0).then(e=>{T.value=e.map(t=>[{val:D.toStandardHisDisplayFormat(t),actualDate:t},{val:"..."},{val:"..."},{val:"..."},{val:"..."},{val:"..."},{val:"..."},{btn:{label:"More"}}])}).finally(()=>{P.value=!0,f.value=!1})}function $(e){const t=r=>r.map(([i,c])=>"".concat(i," (").concat(c,")")).join("/");S.value=[{label:"Outcome",value:e.outcome},{label:"Outcome Date",value:e.outcome_date},{label:"Side effects",value:e.side_effects},{label:"Viral load",value:e.viral_load},{label:"Pills Brought",value:t(e.pills_brought)},{label:"Pills dispensed",value:t(e.pills_dispensed)},{label:"Visit by",value:e.visit_by},{label:"Regimen",value:e.regimen},{label:"Adherence",value:t(e.adherence)},{label:"TB Status",value:e.tb_status},{label:"Height (cm)",value:e.height},{label:"Weight (Kg)",value:e.weight},{label:"BMI",value:e.bmi},{label:"Is pregnant",value:e.isPregnant,visible:a.isFemale()},{label:"Is breastfeeding",value:e.isBreastfeeding,visible:a.isFemale()}]}async function W(){f.value=!0;for(let e=0;e<T.value.length;++e){const t=T.value[e],r=t[0].actualDate,i=a.getID(),c=await E.getCurrentProgramInformation(i,r),s=await E.getMastercardDrugInformation(i,r),I=((s==null?void 0:s.pills_given)||[]).map(g=>"".concat(g.short_name||g.name," <b>(").concat(g.quantity||"?",")</b>")).join("<br/>");if(a.isFemale()){const g=await v.getFirstObs(i,"Is patient pregnant",r);g&&D.toStandardHisDisplayFormat(g.obs_datetime)===r&&g.value_coded;const F=await v.getFirstObs(i,"Is patient breast feeding",r);F&&D.toStandardHisDisplayFormat(F.obs_datetime)===r&&F.value_coded}t[1].val=c.weight,t[2].val=c.regimen,t[3].val=c.viral_load,t[4].val=c.tb_status,t[5].val=c.outcome.match(/Unk/i)?"Unknown":c.outcome,t[6].val=I,t[7].btn={label:"More",onClick:()=>U(c)}}f.value=!0}function U(e){$(e),w.value=!0}function M(){w.value=!1}return Y(()=>{L(),G(),K().then(()=>W()).finally(()=>f.value=!1)}),(e,t)=>{const r=q("ion-modal");return n(),_(u(ie),null,{default:o(()=>[b(se),b(u(J),null,{default:o(()=>[t[4]||(t[4]=l("div",{class:"container"},[l("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Mastercard")],-1)),b(u(Q),null,{default:o(()=>[b(u(X),null,{default:o(()=>[(n(!0),d(y,null,p(x.value,(i,c)=>(n(),_(u(Z),{"size-lg":"3","size-md":"4","size-sm":"12",key:c},{default:o(()=>[b(u(ee),null,{default:o(()=>[b(u(ae),null,{default:o(()=>[b(u(te),null,{default:o(()=>[(n(!0),d(y,null,p(i,(s,I)=>(n(),_(u(le),{key:I},{default:o(()=>[b(u(H),null,{default:o(()=>[h(V(s.label),1)]),_:2},1024),b(u(H),{style:{"font-weight":"bold"},slot:"end"},{default:o(()=>[h(V(s.value),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),f.value?(n(),_(u(ne),{key:0,type:"indeterminate"})):A("",!0),l("table",re,[t[1]||(t[1]=l("thead",null,[l("tr",null,[l("th",null,"VISIT DATE"),l("th",null,"WEIGHT (Kg)"),l("th",null,"REG"),l("th",null,"VIRAL LOAD"),l("th",null,"TB STATUS"),l("th",null,"OUTCOME"),l("th",null,"PILLS DISPENSED"),l("th",null,"ACTIONS")])],-1)),P.value?(n(),d("tbody",ce,[(n(!0),d(y,null,p(T.value,(i,c)=>(n(),d("tr",{key:c},[(n(!0),d(y,null,p(i,(s,I)=>(n(),d("td",{key:I},[s.val?(n(),d("span",{key:0,innerHTML:s.val},null,8,de)):s.btn&&typeof(s==null?void 0:s.btn.onClick)=="function"?(n(),_(u(N),{key:1,onClick:s.btn.onClick},{default:o(()=>[h(V(s.btn.label),1)]),_:2},1032,["onClick"])):A("",!0)]))),128))]))),128))])):(n(),d("tbody",be,[(n(),d(y,null,p(6,i=>l("tr",{key:i},t[0]||(t[0]=[l("td",null,"...",-1),l("td",null,"...",-1),l("td",null,"...",-1),l("td",null,"...",-1),l("td",null,"...",-1),l("td",null,"...",-1),l("td",null,"...",-1),l("td",null,"...",-1)]))),64))]))]),b(r,{"is-open":w.value,onIonModalDidDismiss:M},{default:o(()=>[l("div",ve,[t[3]||(t[3]=l("h3",null,"Details",-1)),l("ul",null,[(n(!0),d(y,null,p(S.value,i=>(n(),d("li",{key:i.label},[l("strong",null,V(i.label)+":",1),h(" "+V(i.value),1)]))),128))]),b(u(N),{expand:"block",onClick:M},{default:o(()=>t[2]||(t[2]=[h("Close",-1)])),_:1,__:[2]})])]),_:1},8,["is-open"])]),_:1,__:[4]})]),_:1})}}}),he=oe(ge,[["__scopeId","data-v-f0a17b1f"]]);export{he as default};
